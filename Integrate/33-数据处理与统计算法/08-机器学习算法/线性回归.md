# PostgreSQL çº¿æ€§å›å½’å®Œæ•´æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æŠ€æœ¯æ ˆ**: PostgreSQL 17+/18+ | çº¿æ€§å›å½’ | æœºå™¨å­¦ä¹ 
> **éš¾åº¦çº§åˆ«**: â­â­â­â­ (é«˜çº§)

---

## ğŸ“‹ ç›®å½•

- [PostgreSQL çº¿æ€§å›å½’å®Œæ•´æŒ‡å—](#postgresql-çº¿æ€§å›å½’å®Œæ•´æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [çº¿æ€§å›å½’æ¦‚è¿°](#çº¿æ€§å›å½’æ¦‚è¿°)
    - [ç†è®ºåŸºç¡€](#ç†è®ºåŸºç¡€)
      - [æ¨¡å‹å®šä¹‰](#æ¨¡å‹å®šä¹‰)
      - [çŸ©é˜µè¡¨ç¤º](#çŸ©é˜µè¡¨ç¤º)
      - [åŸºæœ¬å‡è®¾](#åŸºæœ¬å‡è®¾)
    - [æ ¸å¿ƒç®—æ³•](#æ ¸å¿ƒç®—æ³•)
  - [1. ç®€å•çº¿æ€§å›å½’](#1-ç®€å•çº¿æ€§å›å½’)
    - [1.1 æœ€å°äºŒä¹˜æ³•åŸç†](#11-æœ€å°äºŒä¹˜æ³•åŸç†)
      - [ç›®æ ‡å‡½æ•°](#ç›®æ ‡å‡½æ•°)
      - [å‚æ•°ä¼°è®¡](#å‚æ•°ä¼°è®¡)
      - [ç»Ÿè®¡æ€§è´¨](#ç»Ÿè®¡æ€§è´¨)
    - [1.2 æœ€å°äºŒä¹˜æ³•å®Œæ•´å®ç°](#12-æœ€å°äºŒä¹˜æ³•å®Œæ•´å®ç°)
  - [2. å¤šå…ƒçº¿æ€§å›å½’](#2-å¤šå…ƒçº¿æ€§å›å½’)
    - [2.1 å¤šå…ƒçº¿æ€§å›å½’åŸç†](#21-å¤šå…ƒçº¿æ€§å›å½’åŸç†)
      - [çŸ©é˜µå½¢å¼](#çŸ©é˜µå½¢å¼)
      - [å‚æ•°ä¼°è®¡](#å‚æ•°ä¼°è®¡-1)
      - [å‡è®¾æ£€éªŒ](#å‡è®¾æ£€éªŒ)
    - [2.2 å¤šå…ƒçº¿æ€§å›å½’å®Œæ•´å®ç°](#22-å¤šå…ƒçº¿æ€§å›å½’å®Œæ•´å®ç°)
  - [3. å›å½’è¯„ä¼°](#3-å›å½’è¯„ä¼°)
    - [3.1 RÂ²å†³å®šç³»æ•°](#31-rå†³å®šç³»æ•°)
      - [æ•°å­¦å®šä¹‰](#æ•°å­¦å®šä¹‰)
      - [RÂ²çš„è§£é‡Š](#rçš„è§£é‡Š)
      - [è°ƒæ•´RÂ²](#è°ƒæ•´r)
    - [3.2 å›å½’è¯„ä¼°æŒ‡æ ‡](#32-å›å½’è¯„ä¼°æŒ‡æ ‡)
      - [3.2.1 å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰](#321-å‡æ–¹è¯¯å·®mse)
      - [3.2.2 å‡æ–¹æ ¹è¯¯å·®ï¼ˆRMSEï¼‰](#322-å‡æ–¹æ ¹è¯¯å·®rmse)
      - [3.2.3 å¹³å‡ç»å¯¹è¯¯å·®ï¼ˆMAEï¼‰](#323-å¹³å‡ç»å¯¹è¯¯å·®mae)
      - [3.2.4 å¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®ï¼ˆMAPEï¼‰](#324-å¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®mape)
  - [4. æ­£åˆ™åŒ–æ–¹æ³•](#4-æ­£åˆ™åŒ–æ–¹æ³•)
    - [4.1 å²­å›å½’ï¼ˆRidge Regressionï¼‰](#41-å²­å›å½’ridge-regression)
    - [4.2 Lassoå›å½’](#42-lassoå›å½’)
  - [5. å®é™…åº”ç”¨æ¡ˆä¾‹](#5-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [5.1 é”€å”®é¢„æµ‹](#51-é”€å”®é¢„æµ‹)
    - [5.2 æˆ¿ä»·é¢„æµ‹](#52-æˆ¿ä»·é¢„æµ‹)
    - [5.3 éœ€æ±‚é¢„æµ‹](#53-éœ€æ±‚é¢„æµ‹)
    - [5.4 æ®‹å·®åˆ†æ](#54-æ®‹å·®åˆ†æ)
  - [6. PostgreSQL 18å¹¶è¡Œçº¿æ€§å›å½’](#6-postgresql-18å¹¶è¡Œçº¿æ€§å›å½’)
    - [6.1 å¹¶è¡Œçº¿æ€§å›å½’æ¦‚è¿°](#61-å¹¶è¡Œçº¿æ€§å›å½’æ¦‚è¿°)
      - [å¹¶è¡Œçº¿æ€§å›å½’é…ç½®](#å¹¶è¡Œçº¿æ€§å›å½’é…ç½®)
      - [å¹¶è¡Œçº¿æ€§å›å½’å®ç°](#å¹¶è¡Œçº¿æ€§å›å½’å®ç°)
  - [7. ç®—æ³•æ€§èƒ½å¯¹æ¯”ä¸ä¼˜åŒ–](#7-ç®—æ³•æ€§èƒ½å¯¹æ¯”ä¸ä¼˜åŒ–)
    - [7.1 çº¿æ€§å›å½’ vs å…¶ä»–å›å½’æ–¹æ³•](#71-çº¿æ€§å›å½’-vs-å…¶ä»–å›å½’æ–¹æ³•)
    - [7.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®](#72-æ€§èƒ½ä¼˜åŒ–å»ºè®®)
    - [7.3 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#73-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
  - [8. æœ€ä½³å®è·µ](#8-æœ€ä½³å®è·µ)
    - [8.1 æ•°æ®å‡†å¤‡](#81-æ•°æ®å‡†å¤‡)
    - [8.2 æ¨¡å‹è®­ç»ƒ](#82-æ¨¡å‹è®­ç»ƒ)
    - [8.3 æ¨¡å‹è¯„ä¼°](#83-æ¨¡å‹è¯„ä¼°)
    - [8.4 å‡è®¾æ£€éªŒ](#84-å‡è®¾æ£€éªŒ)
    - [8.5 SQLå®ç°æ³¨æ„äº‹é¡¹](#85-sqlå®ç°æ³¨æ„äº‹é¡¹)
    - [8.6 PostgreSQL 18 æ–°ç‰¹æ€§åº”ç”¨](#86-postgresql-18-æ–°ç‰¹æ€§åº”ç”¨)
    - [8.7 é«˜çº§ä¼˜åŒ–æŠ€å·§](#87-é«˜çº§ä¼˜åŒ–æŠ€å·§)
  - [ğŸ“š å‚è€ƒèµ„æº](#-å‚è€ƒèµ„æº)
    - [å­¦æœ¯æ–‡çŒ®](#å­¦æœ¯æ–‡çŒ®)
    - [åœ¨çº¿èµ„æº](#åœ¨çº¿èµ„æº)
    - [ç›¸å…³ç®—æ³•](#ç›¸å…³ç®—æ³•)

---

## çº¿æ€§å›å½’æ¦‚è¿°

**çº¿æ€§å›å½’ï¼ˆLinear Regressionï¼‰**æ˜¯æœºå™¨å­¦ä¹ ä¸­æœ€åŸºç¡€ä¸”é‡è¦çš„ç®—æ³•ï¼Œç”¨äºå»ºç«‹å› å˜é‡ï¼ˆç›®æ ‡å˜é‡ï¼‰ä¸ä¸€ä¸ªæˆ–å¤šä¸ªè‡ªå˜é‡ï¼ˆç‰¹å¾ï¼‰ä¹‹é—´çš„çº¿æ€§å…³ç³»æ¨¡å‹ã€‚çº¿æ€§å›å½’å¹¿æ³›åº”ç”¨äºé¢„æµ‹ã€è¶‹åŠ¿åˆ†æã€å› æœå…³ç³»ç ”ç©¶ç­‰é¢†åŸŸã€‚

### ç†è®ºåŸºç¡€

#### æ¨¡å‹å®šä¹‰

**ç®€å•çº¿æ€§å›å½’æ¨¡å‹**ï¼š
$$y = \beta_0 + \beta_1 x + \epsilon$$

**å¤šå…ƒçº¿æ€§å›å½’æ¨¡å‹**ï¼š
$$y = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + ... + \beta_p x_p + \epsilon$$

å…¶ä¸­ï¼š

- $y$ æ˜¯å› å˜é‡ï¼ˆå“åº”å˜é‡ï¼‰
- $x_1, x_2, ..., x_p$ æ˜¯è‡ªå˜é‡ï¼ˆç‰¹å¾å˜é‡ï¼‰
- $\beta_0$ æ˜¯æˆªè·ï¼ˆInterceptï¼‰
- $\beta_1, \beta_2, ..., \beta_p$ æ˜¯å›å½’ç³»æ•°ï¼ˆSlope Coefficientsï¼‰
- $\epsilon$ æ˜¯è¯¯å·®é¡¹ï¼ˆéšæœºè¯¯å·®ï¼‰

#### çŸ©é˜µè¡¨ç¤º

**çŸ©é˜µå½¢å¼**ï¼š
$$\mathbf{y} = \mathbf{X}\boldsymbol{\beta} + \boldsymbol{\epsilon}$$

å…¶ä¸­ï¼š

- $\mathbf{y} \in \mathbb{R}^{n}$ æ˜¯å“åº”å‘é‡
- $\mathbf{X} \in \mathbb{R}^{n \times (p+1)}$ æ˜¯è®¾è®¡çŸ©é˜µï¼ˆåŒ…å«æˆªè·åˆ—ï¼‰
- $\boldsymbol{\beta} \in \mathbb{R}^{p+1}$ æ˜¯å‚æ•°å‘é‡
- $\boldsymbol{\epsilon} \in \mathbb{R}^{n}$ æ˜¯è¯¯å·®å‘é‡

#### åŸºæœ¬å‡è®¾

1. **çº¿æ€§å…³ç³»**ï¼šå› å˜é‡ä¸è‡ªå˜é‡ä¹‹é—´å­˜åœ¨çº¿æ€§å…³ç³»
2. **ç‹¬ç«‹æ€§**ï¼šè§‚æµ‹å€¼ç›¸äº’ç‹¬ç«‹
3. **åŒæ–¹å·®æ€§**ï¼šè¯¯å·®é¡¹çš„æ–¹å·®æ’å®šï¼ˆ$\text{Var}(\epsilon_i) = \sigma^2$ï¼‰
4. **æ­£æ€æ€§**ï¼šè¯¯å·®é¡¹æœä»æ­£æ€åˆ†å¸ƒï¼ˆ$\epsilon_i \sim N(0, \sigma^2)$ï¼‰
5. **æ— å¤šé‡å…±çº¿æ€§**ï¼šè‡ªå˜é‡ä¹‹é—´ä¸å­˜åœ¨å®Œå…¨çº¿æ€§å…³ç³»

### æ ¸å¿ƒç®—æ³•

| ç®—æ³• | ç”¨é€” | å¤æ‚åº¦ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|--------|------|------|
| **æœ€å°äºŒä¹˜æ³•ï¼ˆOLSï¼‰** | ç®€å•/å¤šå…ƒçº¿æ€§å›å½’ | $O(np^2 + p^3)$ | æ— åä¼°è®¡ã€è§£æè§£ | å¯¹å¼‚å¸¸å€¼æ•æ„Ÿ |
| **å²­å›å½’ï¼ˆRidgeï¼‰** | å¤šé‡å…±çº¿æ€§å¤„ç† | $O(np^2 + p^3)$ | ç¨³å®šã€é˜²æ­¢è¿‡æ‹Ÿåˆ | ä¸è¿›è¡Œç‰¹å¾é€‰æ‹© |
| **Lassoå›å½’** | ç‰¹å¾é€‰æ‹© | $O(np^2 + p^3)$ | è‡ªåŠ¨ç‰¹å¾é€‰æ‹© | å¯èƒ½åˆ é™¤é‡è¦ç‰¹å¾ |
| **å¼¹æ€§ç½‘ç»œï¼ˆElastic Netï¼‰** | ç»“åˆRidgeå’ŒLasso | $O(np^2 + p^3)$ | å¹³è¡¡Ridgeå’ŒLasso | å‚æ•°è°ƒä¼˜å¤æ‚ |

---

## 1. ç®€å•çº¿æ€§å›å½’

### 1.1 æœ€å°äºŒä¹˜æ³•åŸç†

**æœ€å°äºŒä¹˜æ³•ï¼ˆOrdinary Least Squares, OLSï¼‰**æ˜¯çº¿æ€§å›å½’çš„å‚æ•°ä¼°è®¡æ–¹æ³•ï¼Œé€šè¿‡æœ€å°åŒ–æ®‹å·®å¹³æ–¹å’Œæ¥ä¼°è®¡å›å½’ç³»æ•°ã€‚

#### ç›®æ ‡å‡½æ•°

**æ®‹å·®å¹³æ–¹å’Œï¼ˆSum of Squared Residuals, SSRï¼‰**ï¼š
$$SSR = \sum_{i=1}^{n} (y_i - \hat{y}_i)^2 = \sum_{i=1}^{n} (y_i - \beta_0 - \beta_1 x_i)^2$$

**ç›®æ ‡**ï¼šæ‰¾åˆ° $\beta_0$ å’Œ $\beta_1$ ä½¿å¾— $SSR$ æœ€å°ã€‚

#### å‚æ•°ä¼°è®¡

**å¯¹ $\beta_1$ æ±‚åå¯¼å¹¶ä»¤å…¶ä¸ºé›¶**ï¼š
$$\frac{\partial SSR}{\partial \beta_1} = -2\sum_{i=1}^{n}(y_i - \beta_0 - \beta_1 x_i)x_i = 0$$

**å¯¹ $\beta_0$ æ±‚åå¯¼å¹¶ä»¤å…¶ä¸ºé›¶**ï¼š
$$\frac{\partial SSR}{\partial \beta_0} = -2\sum_{i=1}^{n}(y_i - \beta_0 - \beta_1 x_i) = 0$$

**æ±‚è§£å¾—åˆ°**ï¼š
$$\hat{\beta}_1 = \frac{\sum_{i=1}^{n}(x_i - \bar{x})(y_i - \bar{y})}{\sum_{i=1}^{n}(x_i - \bar{x})^2} = \frac{n\sum x_i y_i - \sum x_i \sum y_i}{n\sum x_i^2 - (\sum x_i)^2}$$

$$\hat{\beta}_0 = \bar{y} - \hat{\beta}_1 \bar{x}$$

å…¶ä¸­ $\bar{x} = \frac{1}{n}\sum_{i=1}^{n}x_i$ï¼Œ$\bar{y} = \frac{1}{n}\sum_{i=1}^{n}y_i$ã€‚

#### ç»Ÿè®¡æ€§è´¨

**Gauss-Markovå®šç†**ï¼šåœ¨æ»¡è¶³åŸºæœ¬å‡è®¾çš„æ¡ä»¶ä¸‹ï¼Œæœ€å°äºŒä¹˜ä¼°è®¡é‡æ˜¯æœ€ä½³çº¿æ€§æ— åä¼°è®¡é‡ï¼ˆBLUEï¼‰ã€‚

- **æ— åæ€§**ï¼š$E[\hat{\beta}_1] = \beta_1$
- **æœ‰æ•ˆæ€§**ï¼šåœ¨æ‰€æœ‰çº¿æ€§æ— åä¼°è®¡é‡ä¸­ï¼ŒOLSä¼°è®¡é‡çš„æ–¹å·®æœ€å°
- **ä¸€è‡´æ€§**ï¼šå½“æ ·æœ¬é‡è¶‹äºæ— ç©·æ—¶ï¼Œä¼°è®¡é‡æ”¶æ•›åˆ°çœŸå®å€¼

### 1.2 æœ€å°äºŒä¹˜æ³•å®Œæ•´å®ç°

```sql
-- åˆ›å»ºç¤ºä¾‹æ•°æ®è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'regression_data') THEN
            RAISE WARNING 'è¡¨ regression_data å·²å­˜åœ¨ï¼Œå…ˆåˆ é™¤';
            DROP TABLE regression_data CASCADE;
        END IF;

        CREATE TABLE regression_data (
            id SERIAL PRIMARY KEY,
            x NUMERIC NOT NULL,
            y NUMERIC NOT NULL
        );

        -- æ’å…¥ç¤ºä¾‹æ•°æ®
        INSERT INTO regression_data (x, y) VALUES
            (1, 2.1), (2, 4.2), (3, 6.1), (4, 8.0), (5, 10.1),
            (6, 12.2), (7, 14.1), (8, 16.0), (9, 18.1), (10, 20.0);

        RAISE NOTICE 'è¡¨ regression_data åˆ›å»ºæˆåŠŸï¼Œå·²æ’å…¥10æ¡æ•°æ®';
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ regression_data å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE EXCEPTION 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
    END;
END $$;

-- ç®€å•çº¿æ€§å›å½’è®¡ç®—ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
DECLARE
    n BIGINT;
    sum_x NUMERIC;
    sum_y NUMERIC;
    sum_xy NUMERIC;
    sum_x2 NUMERIC;
    slope NUMERIC;
    intercept NUMERIC;
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'regression_data') THEN
            RAISE WARNING 'è¡¨ regression_data ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡Œçº¿æ€§å›å½’';
            RETURN;
        END IF;

        -- æ£€æŸ¥æ•°æ®
        SELECT COUNT(*) INTO n FROM regression_data WHERE x IS NOT NULL AND y IS NOT NULL;
        IF n < 2 THEN
            RAISE WARNING 'æ•°æ®ç‚¹ä¸è¶³ï¼Œè‡³å°‘éœ€è¦2ä¸ªç‚¹';
            RETURN;
        END IF;

        RAISE NOTICE 'å¼€å§‹è®¡ç®—ç®€å•çº¿æ€§å›å½’ï¼Œæ•°æ®ç‚¹æ•°: %', n;
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'çº¿æ€§å›å½’å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- è®¡ç®—å›å½’ç³»æ•°ï¼ˆå®Œæ•´å®ç°ï¼ŒåŒ…å«ç»Ÿè®¡æ¨æ–­ï¼‰
WITH stats AS (
    SELECT
        COUNT(*) AS n,
        SUM(x) AS sum_x,
        SUM(y) AS sum_y,
        SUM(x * y) AS sum_xy,
        SUM(x * x) AS sum_x2,
        AVG(x) AS avg_x,
        AVG(y) AS avg_y,
        VARIANCE(x) AS var_x,
        VARIANCE(y) AS var_y,
        CORR(x, y) AS correlation
    FROM regression_data
    WHERE x IS NOT NULL AND y IS NOT NULL
),
regression_coefficients AS (
    SELECT
        n,
        avg_x,
        avg_y,
        var_x,
        var_y,
        correlation,
        -- æ–œç‡
        CASE
            WHEN (n * sum_x2 - sum_x * sum_x) = 0 THEN NULL
            ELSE (n * sum_xy - sum_x * sum_y) / (n * sum_x2 - sum_x * sum_x)
        END AS slope,
        -- æˆªè·
        CASE
            WHEN (n * sum_x2 - sum_x * sum_x) = 0 THEN NULL
            ELSE (sum_y * sum_x2 - sum_x * sum_xy) / (n * sum_x2 - sum_x * sum_x)
        END AS intercept
    FROM stats
),
predictions AS (
    SELECT
        rd.id,
        rd.x,
        rd.y,
        rc.slope * rd.x + rc.intercept AS y_pred,
        rd.y - (rc.slope * rd.x + rc.intercept) AS residual
    FROM regression_data rd
    CROSS JOIN regression_coefficients rc
    WHERE rd.x IS NOT NULL AND rd.y IS NOT NULL
),
residual_stats AS (
    SELECT
        COUNT(*) AS n,
        SUM(POWER(residual, 2)) AS ss_residual,
        SUM(POWER(y - (SELECT avg_y FROM regression_coefficients), 2)) AS ss_total,
        AVG(POWER(residual, 2)) AS mse,
        SQRT(AVG(POWER(residual, 2))) AS rmse,
        AVG(ABS(residual)) AS mae
    FROM predictions
),
regression_summary AS (
    SELECT
        rc.n,
        ROUND(rc.avg_x::numeric, 4) AS mean_x,
        ROUND(rc.avg_y::numeric, 4) AS mean_y,
        ROUND(rc.slope::numeric, 6) AS slope,
        ROUND(rc.intercept::numeric, 6) AS intercept,
        ROUND(rc.correlation::numeric, 4) AS correlation,
        -- RÂ²å†³å®šç³»æ•°
        ROUND((1 - rs.ss_residual / NULLIF(rs.ss_total, 0))::numeric, 4) AS r_squared,
        -- è°ƒæ•´RÂ²
        ROUND((1 - (rs.ss_residual / NULLIF(rs.n - 2, 0)) / (rs.ss_total / NULLIF(rs.n - 1, 0)))::numeric, 4) AS adjusted_r_squared,
        -- å‡æ–¹è¯¯å·®
        ROUND(rs.mse::numeric, 4) AS mse,
        ROUND(rs.rmse::numeric, 4) AS rmse,
        ROUND(rs.mae::numeric, 4) AS mae,
        -- æ ‡å‡†è¯¯å·®
        ROUND(SQRT(rs.ss_residual / NULLIF(rs.n - 2, 0))::numeric, 4) AS standard_error
    FROM regression_coefficients rc
    CROSS JOIN residual_stats rs
)
SELECT
    n,
    mean_x,
    mean_y,
    slope,
    intercept,
    correlation,
    r_squared,
    adjusted_r_squared,
    mse,
    rmse,
    mae,
    standard_error,
    CASE
        WHEN r_squared > 0.9 THEN 'ä¼˜ç§€æ‹Ÿåˆ'
        WHEN r_squared > 0.7 THEN 'è‰¯å¥½æ‹Ÿåˆ'
        WHEN r_squared > 0.5 THEN 'ä¸­ç­‰æ‹Ÿåˆ'
        ELSE 'æ‹Ÿåˆè¾ƒå·®'
    END AS model_quality
FROM regression_summary;

-- æ€§èƒ½æµ‹è¯•
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
WITH stats AS (
    SELECT
        COUNT(*) AS n,
        SUM(x) AS sum_x,
        SUM(y) AS sum_y,
        SUM(x * y) AS sum_xy,
        SUM(x * x) AS sum_x2
    FROM regression_data
    WHERE x IS NOT NULL AND y IS NOT NULL
)
SELECT
    (n * sum_xy - sum_x * sum_y) / NULLIF(n * sum_x2 - sum_x * sum_x, 0) AS slope,
    (sum_y * sum_x2 - sum_x * sum_xy) / NULLIF(n * sum_x2 - sum_x * sum_x, 0) AS intercept
FROM stats;
```

---

## 2. å¤šå…ƒçº¿æ€§å›å½’

### 2.1 å¤šå…ƒçº¿æ€§å›å½’åŸç†

**å¤šå…ƒçº¿æ€§å›å½’ï¼ˆMultiple Linear Regressionï¼‰**å¤„ç†å¤šä¸ªè‡ªå˜é‡çš„æƒ…å†µï¼Œå»ºç«‹å› å˜é‡ä¸å¤šä¸ªè‡ªå˜é‡ä¹‹é—´çš„çº¿æ€§å…³ç³»ã€‚

#### çŸ©é˜µå½¢å¼

**æ¨¡å‹**ï¼š
$$\mathbf{y} = \mathbf{X}\boldsymbol{\beta} + \boldsymbol{\epsilon}$$

**æœ€å°äºŒä¹˜ä¼°è®¡**ï¼š
$$\hat{\boldsymbol{\beta}} = (\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{y}$$

#### å‚æ•°ä¼°è®¡

**æ­£è§„æ–¹ç¨‹ï¼ˆNormal Equationï¼‰**ï¼š
$$\mathbf{X}^T\mathbf{X}\hat{\boldsymbol{\beta}} = \mathbf{X}^T\mathbf{y}$$

**è§£**ï¼š
$$\hat{\boldsymbol{\beta}} = (\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{y}$$

#### å‡è®¾æ£€éªŒ

**tæ£€éªŒ**ï¼šæ£€éªŒå•ä¸ªå›å½’ç³»æ•°æ˜¯å¦æ˜¾è‘—
$$t = \frac{\hat{\beta}_j}{SE(\hat{\beta}_j)} \sim t(n-p-1)$$

**Fæ£€éªŒ**ï¼šæ£€éªŒæ•´ä½“æ¨¡å‹æ˜¯å¦æ˜¾è‘—
$$F = \frac{MSR}{MSE} = \frac{SSR/p}{SSE/(n-p-1)} \sim F(p, n-p-1)$$

### 2.2 å¤šå…ƒçº¿æ€§å›å½’å®Œæ•´å®ç°

```sql
-- åˆ›å»ºå¤šå…ƒå›å½’æ•°æ®è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'multivariate_data') THEN
            RAISE WARNING 'è¡¨ multivariate_data å·²å­˜åœ¨ï¼Œå…ˆåˆ é™¤';
            DROP TABLE multivariate_data CASCADE;
        END IF;

        CREATE TABLE multivariate_data (
            id SERIAL PRIMARY KEY,
            x1 NUMERIC NOT NULL,
            x2 NUMERIC NOT NULL,
            y NUMERIC NOT NULL
        );

        -- æ’å…¥ç¤ºä¾‹æ•°æ®
        INSERT INTO multivariate_data (x1, x2, y) VALUES
            (1, 2, 5.1), (2, 3, 8.2), (3, 4, 11.1), (4, 5, 14.0), (5, 6, 17.1);

        RAISE NOTICE 'è¡¨ multivariate_data åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ multivariate_data å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE EXCEPTION 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
    END;
END $$;

-- å¤šå…ƒçº¿æ€§å›å½’ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'multivariate_data') THEN
            RAISE WARNING 'è¡¨ multivariate_data ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡Œå¤šå…ƒå›å½’';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡Œå¤šå…ƒçº¿æ€§å›å½’';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¤šå…ƒå›å½’å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- å¤šå…ƒçº¿æ€§å›å½’ï¼šå®Œæ•´å®ç°ï¼ˆåŒ…å«åæ–¹å·®çŸ©é˜µå’Œå›å½’ç³»æ•°ï¼‰
WITH centered_data AS (
    SELECT
        id,
        x1,
        x2,
        y,
        x1 - AVG(x1) OVER () AS x1_centered,
        x2 - AVG(x2) OVER () AS x2_centered,
        y - AVG(y) OVER () AS y_centered
    FROM multivariate_data
    WHERE x1 IS NOT NULL AND x2 IS NOT NULL AND y IS NOT NULL
),
covariance_matrix AS (
    SELECT
        SUM(x1_centered * x1_centered) AS var_x1,
        SUM(x1_centered * x2_centered) AS cov_x1x2,
        SUM(x2_centered * x2_centered) AS var_x2,
        SUM(x1_centered * y_centered) AS cov_x1y,
        SUM(x2_centered * y_centered) AS cov_x2y,
        SUM(y_centered * y_centered) AS var_y
    FROM centered_data
),
regression_coefficients AS (
    SELECT
        -- ä½¿ç”¨æœ€å°äºŒä¹˜æ³•å…¬å¼è®¡ç®—ç³»æ•°
        -- beta1 = (cov_x1y * var_x2 - cov_x2y * cov_x1x2) / (var_x1 * var_x2 - cov_x1x2^2)
        (cov_x1y * var_x2 - cov_x2y * cov_x1x2) /
        NULLIF(var_x1 * var_x2 - POWER(cov_x1x2, 2), 0) AS beta1,
        -- beta2 = (cov_x2y * var_x1 - cov_x1y * cov_x1x2) / (var_x1 * var_x2 - cov_x1x2^2)
        (cov_x2y * var_x1 - cov_x1y * cov_x1x2) /
        NULLIF(var_x1 * var_x2 - POWER(cov_x1x2, 2), 0) AS beta2,
        -- intercept = mean_y - beta1 * mean_x1 - beta2 * mean_x2
        (SELECT AVG(y) FROM multivariate_data) -
        (SELECT AVG(x1) FROM multivariate_data) *
        ((cov_x1y * var_x2 - cov_x2y * cov_x1x2) / NULLIF(var_x1 * var_x2 - POWER(cov_x1x2, 2), 0)) -
        (SELECT AVG(x2) FROM multivariate_data) *
        ((cov_x2y * var_x1 - cov_x1y * cov_x1x2) / NULLIF(var_x1 * var_x2 - POWER(cov_x1x2, 2), 0)) AS intercept
    FROM covariance_matrix
),
predictions AS (
    SELECT
        md.id,
        md.x1,
        md.x2,
        md.y,
        rc.beta1 * md.x1 + rc.beta2 * md.x2 + rc.intercept AS y_pred,
        md.y - (rc.beta1 * md.x1 + rc.beta2 * md.x2 + rc.intercept) AS residual
    FROM multivariate_data md
    CROSS JOIN regression_coefficients rc
    WHERE md.x1 IS NOT NULL AND md.x2 IS NOT NULL AND md.y IS NOT NULL
),
model_evaluation AS (
    SELECT
        COUNT(*) AS n,
        SUM(POWER(residual, 2)) AS ss_residual,
        SUM(POWER(y - (SELECT AVG(y) FROM multivariate_data), 2)) AS ss_total,
        AVG(POWER(residual, 2)) AS mse,
        SQRT(AVG(POWER(residual, 2))) AS rmse
    FROM predictions
)
SELECT
    ROUND(rc.beta1::numeric, 6) AS coefficient_x1,
    ROUND(rc.beta2::numeric, 6) AS coefficient_x2,
    ROUND(rc.intercept::numeric, 6) AS intercept,
    ROUND((1 - me.ss_residual / NULLIF(me.ss_total, 0))::numeric, 4) AS r_squared,
    ROUND(me.mse::numeric, 4) AS mse,
    ROUND(me.rmse::numeric, 4) AS rmse
FROM regression_coefficients rc
CROSS JOIN model_evaluation me;

-- æ€§èƒ½æµ‹è¯•
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
WITH stats AS (
    SELECT
        COUNT(*) AS n,
        AVG(x1) AS avg_x1,
        AVG(x2) AS avg_x2,
        AVG(y) AS avg_y
    FROM multivariate_data
    WHERE x1 IS NOT NULL AND x2 IS NOT NULL AND y IS NOT NULL
)
SELECT * FROM stats;
```

---

## 3. å›å½’è¯„ä¼°

### 3.1 RÂ²å†³å®šç³»æ•°

**RÂ²å†³å®šç³»æ•°ï¼ˆCoefficient of Determinationï¼‰**è¡¡é‡æ¨¡å‹å¯¹æ•°æ®çš„æ‹Ÿåˆç¨‹åº¦ï¼Œè¡¨ç¤ºæ¨¡å‹è§£é‡Šçš„æ–¹å·®å æ€»æ–¹å·®çš„æ¯”ä¾‹ã€‚

#### æ•°å­¦å®šä¹‰

$$R^2 = 1 - \frac{SSR}{SST} = 1 - \frac{\sum_{i=1}^{n}(y_i - \hat{y}_i)^2}{\sum_{i=1}^{n}(y_i - \bar{y})^2}$$

å…¶ä¸­ï¼š

- $SSR$ï¼ˆSum of Squared Residualsï¼‰ï¼šæ®‹å·®å¹³æ–¹å’Œ
- $SST$ï¼ˆTotal Sum of Squaresï¼‰ï¼šæ€»å¹³æ–¹å’Œ
- $SSE$ï¼ˆExplained Sum of Squaresï¼‰ï¼šå›å½’å¹³æ–¹å’Œï¼Œ$SSE = SST - SSR$

#### RÂ²çš„è§£é‡Š

- $R^2 = 1$ï¼šå®Œç¾æ‹Ÿåˆï¼Œæ¨¡å‹è§£é‡Šæ‰€æœ‰æ–¹å·®
- $R^2 = 0$ï¼šæ¨¡å‹ä¸æ¯”ç®€å•å‡å€¼é¢„æµ‹æ›´å¥½
- $R^2 < 0$ï¼šæ¨¡å‹æ¯”ç®€å•å‡å€¼é¢„æµ‹æ›´å·®ï¼ˆå¯èƒ½æ•°æ®æœ‰é—®é¢˜ï¼‰

#### è°ƒæ•´RÂ²

**è°ƒæ•´RÂ²ï¼ˆAdjusted RÂ²ï¼‰**è€ƒè™‘è‡ªç”±åº¦çš„å½±å“ï¼š
$$R_{adj}^2 = 1 - \frac{SSR/(n-p-1)}{SST/(n-1)}$$

å…¶ä¸­ $p$ æ˜¯è‡ªå˜é‡æ•°é‡ã€‚è°ƒæ•´RÂ²æƒ©ç½šè¿‡å¤šçš„è‡ªå˜é‡ï¼Œæ›´é€‚ç”¨äºæ¨¡å‹æ¯”è¾ƒã€‚

```sql
-- RÂ²å†³å®šç³»æ•°è®¡ç®—ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'regression_data') THEN
            RAISE WARNING 'è¡¨ regression_data ä¸å­˜åœ¨ï¼Œæ— æ³•è®¡ç®—RÂ²';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹è®¡ç®—RÂ²å†³å®šç³»æ•°';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'RÂ²è®¡ç®—å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- è®¡ç®—RÂ²
WITH regression AS (
    SELECT
        AVG(x) AS avg_x,
        AVG(y) AS avg_y,
        (COUNT(*) * SUM(x * y) - SUM(x) * SUM(y)) / NULLIF(COUNT(*) * SUM(x * x) - SUM(x) * SUM(x), 0) AS slope,
        (SUM(y) * SUM(x * x) - SUM(x) * SUM(x * y)) / NULLIF(COUNT(*) * SUM(x * x) - SUM(x) * SUM(x), 0) AS intercept
    FROM regression_data
    WHERE x IS NOT NULL AND y IS NOT NULL
),
predictions AS (
    SELECT
        y,
        r.slope * x + r.intercept AS y_pred,
        r.avg_y
    FROM regression_data, regression r
    WHERE x IS NOT NULL AND y IS NOT NULL
),
ss_res AS (
    SELECT SUM(POWER(y - y_pred, 2)) AS ss_residual
    FROM predictions
),
ss_tot AS (
    SELECT SUM(POWER(y - avg_y, 2)) AS ss_total
    FROM predictions
)
SELECT
    ss_residual,
    ss_total,
    CASE
        WHEN ss_total = 0 THEN NULL
        ELSE 1 - (ss_residual / ss_total)
    END AS r_squared
FROM ss_res, ss_tot;

-- æ€§èƒ½æµ‹è¯•
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
WITH regression AS (
    SELECT
        AVG(x) AS avg_x,
        AVG(y) AS avg_y,
        (COUNT(*) * SUM(x * y) - SUM(x) * SUM(y)) / NULLIF(COUNT(*) * SUM(x * x) - SUM(x) * SUM(x), 0) AS slope,
        (SUM(y) * SUM(x * x) - SUM(x) * SUM(x * y)) / NULLIF(COUNT(*) * SUM(x * x) - SUM(x) * SUM(x), 0) AS intercept
    FROM regression_data
    WHERE x IS NOT NULL AND y IS NOT NULL
)
SELECT slope, intercept FROM regression;
```

### 3.2 å›å½’è¯„ä¼°æŒ‡æ ‡

#### 3.2.1 å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰

**å‡æ–¹è¯¯å·®ï¼ˆMean Squared Error, MSEï¼‰**ï¼š
$$MSE = \frac{1}{n}\sum_{i=1}^{n}(y_i - \hat{y}_i)^2$$

#### 3.2.2 å‡æ–¹æ ¹è¯¯å·®ï¼ˆRMSEï¼‰

**å‡æ–¹æ ¹è¯¯å·®ï¼ˆRoot Mean Squared Error, RMSEï¼‰**ï¼š
$$RMSE = \sqrt{MSE} = \sqrt{\frac{1}{n}\sum_{i=1}^{n}(y_i - \hat{y}_i)^2}$$

RMSEä¸ç›®æ ‡å˜é‡å…·æœ‰ç›¸åŒçš„é‡çº²ï¼Œä¾¿äºè§£é‡Šã€‚

#### 3.2.3 å¹³å‡ç»å¯¹è¯¯å·®ï¼ˆMAEï¼‰

**å¹³å‡ç»å¯¹è¯¯å·®ï¼ˆMean Absolute Error, MAEï¼‰**ï¼š
$$MAE = \frac{1}{n}\sum_{i=1}^{n}|y_i - \hat{y}_i|$$

MAEå¯¹å¼‚å¸¸å€¼ä¸æ•æ„Ÿï¼Œæ¯”MSEæ›´ç¨³å¥ã€‚

#### 3.2.4 å¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®ï¼ˆMAPEï¼‰

**å¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®ï¼ˆMean Absolute Percentage Error, MAPEï¼‰**ï¼š
$$MAPE = \frac{100}{n}\sum_{i=1}^{n}\left|\frac{y_i - \hat{y}_i}{y_i}\right|$$

MAPEæ˜¯ç›¸å¯¹è¯¯å·®ï¼Œä¾¿äºä¸åŒé‡çº§æ•°æ®çš„æ¯”è¾ƒã€‚

```sql
-- å‡æ–¹è¯¯å·®è®¡ç®—ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'regression_data') THEN
            RAISE WARNING 'è¡¨ regression_data ä¸å­˜åœ¨ï¼Œæ— æ³•è®¡ç®—MSE';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹è®¡ç®—å‡æ–¹è¯¯å·®';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'MSEè®¡ç®—å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

WITH regression AS (
    SELECT
        (COUNT(*) * SUM(x * y) - SUM(x) * SUM(y)) / NULLIF(COUNT(*) * SUM(x * x) - SUM(x) * SUM(x), 0) AS slope,
        (SUM(y) * SUM(x * x) - SUM(x) * SUM(x * y)) / NULLIF(COUNT(*) * SUM(x * x) - SUM(x) * SUM(x), 0) AS intercept
    FROM regression_data
    WHERE x IS NOT NULL AND y IS NOT NULL
),
predictions AS (
    SELECT
        y,
        r.slope * x + r.intercept AS y_pred
    FROM regression_data, regression r
    WHERE x IS NOT NULL AND y IS NOT NULL
)
SELECT
    COUNT(*) AS n,
    AVG(POWER(y - y_pred, 2)) AS mse,
    SQRT(AVG(POWER(y - y_pred, 2))) AS rmse,
    AVG(ABS(y - y_pred)) AS mae
FROM predictions;

-- æ€§èƒ½æµ‹è¯•
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
WITH regression AS (
    SELECT
        (COUNT(*) * SUM(x * y) - SUM(x) * SUM(y)) / NULLIF(COUNT(*) * SUM(x * x) - SUM(x) * SUM(x), 0) AS slope,
        (SUM(y) * SUM(x * x) - SUM(x) * SUM(x * y)) / NULLIF(COUNT(*) * SUM(x * x) - SUM(x) * SUM(x), 0) AS intercept
    FROM regression_data
    WHERE x IS NOT NULL AND y IS NOT NULL
)
SELECT slope, intercept FROM regression;
```

---

## 4. æ­£åˆ™åŒ–æ–¹æ³•

### 4.1 å²­å›å½’ï¼ˆRidge Regressionï¼‰

**å²­å›å½’**é€šè¿‡L2æ­£åˆ™åŒ–é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œé€‚ç”¨äºå¤šé‡å…±çº¿æ€§é—®é¢˜ã€‚

**ç›®æ ‡å‡½æ•°**ï¼š
$$\min_{\boldsymbol{\beta}} ||\mathbf{y} - \mathbf{X}\boldsymbol{\beta}||^2 + \lambda ||\boldsymbol{\beta}||^2$$

**å‚æ•°ä¼°è®¡**ï¼š
$$\hat{\boldsymbol{\beta}}_{ridge} = (\mathbf{X}^T\mathbf{X} + \lambda\mathbf{I})^{-1}\mathbf{X}^T\mathbf{y}$$

å…¶ä¸­ $\lambda \geq 0$ æ˜¯æ­£åˆ™åŒ–å‚æ•°ã€‚

```sql
-- å²­å›å½’å®ç°ï¼ˆæ¦‚å¿µæ€§ï¼Œå®Œæ•´å®ç°éœ€è¦çŸ©é˜µè¿ç®—æ‰©å±•ï¼‰
WITH ridge_regression AS (
    SELECT
        -- ä½¿ç”¨ä¼ªé€†çŸ©é˜µæ–¹æ³•ï¼ˆç®€åŒ–ï¼‰
        -- å®é™…ä¸­éœ€è¦ä½¿ç”¨MADlibæˆ–å¤–éƒ¨å·¥å…·
        lambda_param := 0.1
)
-- æ³¨æ„ï¼šå®Œæ•´çš„å²­å›å½’éœ€è¦çŸ©é˜µæ±‚é€†ï¼ŒPostgreSQLåŸç”Ÿä¸æ”¯æŒ
SELECT 'Ridge regression requires matrix operations extension' AS note;
```

### 4.2 Lassoå›å½’

**Lassoå›å½’**é€šè¿‡L1æ­£åˆ™åŒ–è¿›è¡Œç‰¹å¾é€‰æ‹©ï¼Œå¯ä»¥å°†ä¸é‡è¦çš„ç‰¹å¾ç³»æ•°å‹ç¼©ä¸º0ã€‚

**ç›®æ ‡å‡½æ•°**ï¼š
$$\min_{\boldsymbol{\beta}} ||\mathbf{y} - \mathbf{X}\boldsymbol{\beta}||^2 + \lambda ||\boldsymbol{\beta}||_1$$

å…¶ä¸­ $||\boldsymbol{\beta}||_1 = \sum_{j=1}^{p}|\beta_j|$ æ˜¯L1èŒƒæ•°ã€‚

## 5. å®é™…åº”ç”¨æ¡ˆä¾‹

### 5.1 é”€å”®é¢„æµ‹

**é”€å”®é¢„æµ‹**ä½¿ç”¨çº¿æ€§å›å½’é¢„æµ‹æœªæ¥é”€å”®é¢ï¼Œæ”¯æŒä¸šåŠ¡è§„åˆ’å’Œèµ„æºåˆ†é…ã€‚

```sql
-- é”€å”®é¢„æµ‹ç¤ºä¾‹ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'sales_history') THEN
            RAISE WARNING 'è¡¨ sales_history ä¸å­˜åœ¨ï¼Œåˆ›å»ºç¤ºä¾‹è¡¨';

            CREATE TABLE sales_history (
                id SERIAL PRIMARY KEY,
                month_num INTEGER NOT NULL,
                sales_amount NUMERIC NOT NULL
            );

            INSERT INTO sales_history (month_num, sales_amount) VALUES
                (1, 1000), (2, 1200), (3, 1400), (4, 1600), (5, 1800),
                (6, 2000), (7, 2200), (8, 2400), (9, 2600), (10, 2800);

            RAISE NOTICE 'è¡¨ sales_history åˆ›å»ºæˆåŠŸ';
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡Œé”€å”®é¢„æµ‹';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'é”€å”®é¢„æµ‹å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- è®¡ç®—å›å½’æ¨¡å‹å¹¶é¢„æµ‹æœªæ¥3ä¸ªæœˆ
WITH regression AS (
    SELECT
        (COUNT(*) * SUM(month_num * sales_amount) - SUM(month_num) * SUM(sales_amount)) /
        NULLIF(COUNT(*) * SUM(month_num * month_num) - SUM(month_num) * SUM(month_num), 0) AS slope,
        (SUM(sales_amount) * SUM(month_num * month_num) - SUM(month_num) * SUM(month_num * sales_amount)) /
        NULLIF(COUNT(*) * SUM(month_num * month_num) - SUM(month_num) * SUM(month_num), 0) AS intercept
    FROM sales_history
    WHERE month_num IS NOT NULL AND sales_amount IS NOT NULL
),
predictions AS (
    SELECT
        month_num,
        sales_amount AS actual,
        r.slope * month_num + r.intercept AS predicted
    FROM sales_history, regression r
    WHERE month_num IS NOT NULL AND sales_amount IS NOT NULL

    UNION ALL

    -- é¢„æµ‹æœªæ¥3ä¸ªæœˆ
    SELECT
        11 AS month_num,
        NULL AS actual,
        r.slope * 11 + r.intercept AS predicted
    FROM regression r

    UNION ALL

    SELECT
        12 AS month_num,
        NULL AS actual,
        r.slope * 12 + r.intercept AS predicted
    FROM regression r

    UNION ALL

    SELECT
        13 AS month_num,
        NULL AS actual,
        r.slope * 13 + r.intercept AS predicted
    FROM regression r
)
SELECT
    month_num,
    actual,
    ROUND(predicted::numeric, 2) AS predicted,
    CASE WHEN actual IS NOT NULL THEN ROUND(ABS(actual - predicted)::numeric, 2) ELSE NULL END AS error
FROM predictions
ORDER BY month_num;
```

### 5.2 æˆ¿ä»·é¢„æµ‹

**åœºæ™¯**ï¼šä½¿ç”¨å¤šå…ƒçº¿æ€§å›å½’é¢„æµ‹æˆ¿ä»·ï¼Œè€ƒè™‘é¢ç§¯ã€ä½ç½®ã€æˆ¿é¾„ç­‰å¤šä¸ªå› ç´ ã€‚

```sql
-- æˆ¿ä»·é¢„æµ‹ï¼šå¤šå…ƒçº¿æ€§å›å½’
WITH house_data AS (
    SELECT
        house_id,
        area_sqm,           -- é¢ç§¯ï¼ˆå¹³æ–¹ç±³ï¼‰
        location_score,     -- ä½ç½®è¯„åˆ†
        age_years,          -- æˆ¿é¾„ï¼ˆå¹´ï¼‰
        floor_number,       -- æ¥¼å±‚
        price               -- æˆ¿ä»·ï¼ˆä¸‡å…ƒï¼‰
    FROM house_listings
    WHERE price IS NOT NULL
),
normalized_features AS (
    SELECT
        house_id,
        price,
        (area_sqm - AVG(area_sqm) OVER ()) / NULLIF(STDDEV(area_sqm) OVER (), 0) AS norm_area,
        (location_score - AVG(location_score) OVER ()) / NULLIF(STDDEV(location_score) OVER (), 0) AS norm_location,
        (age_years - AVG(age_years) OVER ()) / NULLIF(STDDEV(age_years) OVER (), 0) AS norm_age,
        (floor_number - AVG(floor_number) OVER ()) / NULLIF(STDDEV(floor_number) OVER (), 0) AS norm_floor
    FROM house_data
),
regression_model AS (
    -- ä½¿ç”¨æ ‡å‡†åŒ–ç‰¹å¾è¿›è¡Œå›å½’
    SELECT
        -- ç®€åŒ–ï¼šä½¿ç”¨ç›¸å…³ç³»æ•°ä½œä¸ºæƒé‡
        CORR(norm_area, price) AS weight_area,
        CORR(norm_location, price) AS weight_location,
        CORR(norm_age, price) AS weight_age,
        CORR(norm_floor, price) AS weight_floor,
        AVG(price) AS mean_price
    FROM normalized_features
),
predictions AS (
    SELECT
        hd.house_id,
        hd.price AS actual_price,
        rm.mean_price +
        nf.norm_area * rm.weight_area * (SELECT STDDEV(price) FROM house_data) +
        nf.norm_location * rm.weight_location * (SELECT STDDEV(price) FROM house_data) +
        nf.norm_age * rm.weight_age * (SELECT STDDEV(price) FROM house_data) +
        nf.norm_floor * rm.weight_floor * (SELECT STDDEV(price) FROM house_data) AS predicted_price
    FROM house_data hd
    JOIN normalized_features nf ON hd.house_id = nf.house_id
    CROSS JOIN regression_model rm
)
SELECT
    house_id,
    ROUND(actual_price::numeric, 2) AS actual_price,
    ROUND(predicted_price::numeric, 2) AS predicted_price,
    ROUND(ABS(actual_price - predicted_price)::numeric, 2) AS prediction_error,
    ROUND(ABS(actual_price - predicted_price) / NULLIF(actual_price, 0) * 100::numeric, 2) AS error_percentage
FROM predictions
ORDER BY prediction_error DESC
LIMIT 20;
```

### 5.3 éœ€æ±‚é¢„æµ‹

**åœºæ™¯**ï¼šé¢„æµ‹äº§å“éœ€æ±‚é‡ï¼Œè€ƒè™‘ä»·æ ¼ã€ä¿ƒé”€ã€å­£èŠ‚æ€§ç­‰å› ç´ ã€‚

```sql
-- éœ€æ±‚é¢„æµ‹ï¼šè€ƒè™‘å¤šä¸ªå½±å“å› ç´ 
WITH demand_data AS (
    SELECT
        date,
        price,
        promotion_flag,
        EXTRACT(MONTH FROM date) AS month,
        demand_quantity
    FROM product_sales
    WHERE date >= CURRENT_DATE - INTERVAL '12 months'
),
feature_engineering AS (
    SELECT
        date,
        demand_quantity,
        price,
        CASE WHEN promotion_flag THEN 1 ELSE 0 END AS is_promotion,
        CASE WHEN EXTRACT(MONTH FROM date) IN (11, 12, 1) THEN 1 ELSE 0 END AS is_holiday_season,
        EXTRACT(MONTH FROM date) AS month_num
    FROM demand_data
),
regression_coefficients AS (
    SELECT
        -- ä½¿ç”¨çª—å£å‡½æ•°è®¡ç®—å›å½’ç³»æ•°ï¼ˆç®€åŒ–ç‰ˆï¼‰
        CORR(price, demand_quantity) AS price_coef,
        CORR(is_promotion::NUMERIC, demand_quantity) AS promotion_coef,
        CORR(is_holiday_season::NUMERIC, demand_quantity) AS season_coef,
        AVG(demand_quantity) AS mean_demand
    FROM feature_engineering
),
demand_predictions AS (
    SELECT
        fe.date,
        fe.demand_quantity AS actual_demand,
        rc.mean_demand +
        (fe.price - (SELECT AVG(price) FROM feature_engineering)) * rc.price_coef +
        (fe.is_promotion - (SELECT AVG(is_promotion) FROM feature_engineering)) * rc.promotion_coef +
        (fe.is_holiday_season - (SELECT AVG(is_holiday_season) FROM feature_engineering)) * rc.season_coef AS predicted_demand
    FROM feature_engineering fe
    CROSS JOIN regression_coefficients rc
)
SELECT
    date,
    ROUND(actual_demand::numeric, 2) AS actual_demand,
    ROUND(predicted_demand::numeric, 2) AS predicted_demand,
    ROUND(ABS(actual_demand - predicted_demand)::numeric, 2) AS prediction_error
FROM demand_predictions
ORDER BY date;
```

### 5.4 æ®‹å·®åˆ†æ

**åœºæ™¯**ï¼šåˆ†æå›å½’æ¨¡å‹çš„æ®‹å·®ï¼Œæ£€æŸ¥æ¨¡å‹å‡è®¾æ˜¯å¦æ»¡è¶³ã€‚

```sql
-- æ®‹å·®åˆ†æï¼šæ£€æŸ¥æ¨¡å‹å‡è®¾
WITH regression_model AS (
    SELECT
        (COUNT(*) * SUM(x * y) - SUM(x) * SUM(y)) / NULLIF(COUNT(*) * SUM(x * x) - SUM(x) * SUM(x), 0) AS slope,
        (SUM(y) * SUM(x * x) - SUM(x) * SUM(x * y)) / NULLIF(COUNT(*) * SUM(x * x) - SUM(x) * SUM(x), 0) AS intercept
    FROM regression_data
    WHERE x IS NOT NULL AND y IS NOT NULL
),
residuals AS (
    SELECT
        rd.id,
        rd.x,
        rd.y,
        rm.slope * rd.x + rm.intercept AS y_pred,
        rd.y - (rm.slope * rd.x + rm.intercept) AS residual,
        rd.y - (SELECT AVG(y) FROM regression_data) AS deviation_from_mean
    FROM regression_data rd
    CROSS JOIN regression_model rm
    WHERE rd.x IS NOT NULL AND rd.y IS NOT NULL
),
residual_analysis AS (
    SELECT
        COUNT(*) AS n,
        AVG(residual) AS mean_residual,
        STDDEV(residual) AS std_residual,
        MIN(residual) AS min_residual,
        MAX(residual) AS max_residual,
        PERCENTILE_CONT(0.25) WITHIN GROUP (ORDER BY residual) AS q1_residual,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY residual) AS median_residual,
        PERCENTILE_CONT(0.75) WITHIN GROUP (ORDER BY residual) AS q3_residual,
        -- æ£€æŸ¥æ®‹å·®çš„æ­£æ€æ€§ï¼ˆä½¿ç”¨ååº¦å’Œå³°åº¦ï¼‰
        AVG(POWER((residual - AVG(residual) OVER ()) / NULLIF(STDDEV(residual) OVER (), 0), 3)) AS skewness,
        AVG(POWER((residual - AVG(residual) OVER ()) / NULLIF(STDDEV(residual) OVER (), 0), 4)) - 3 AS kurtosis
    FROM residuals
)
SELECT
    n,
    ROUND(mean_residual::numeric, 6) AS mean_residual,
    ROUND(std_residual::numeric, 4) AS std_residual,
    ROUND(min_residual::numeric, 4) AS min_residual,
    ROUND(max_residual::numeric, 4) AS max_residual,
    ROUND(median_residual::numeric, 4) AS median_residual,
    ROUND(skewness::numeric, 4) AS residual_skewness,
    ROUND(kurtosis::numeric, 4) AS residual_kurtosis,
    CASE
        WHEN ABS(mean_residual) > 0.1 THEN 'æ®‹å·®å‡å€¼ä¸ä¸º0ï¼Œå¯èƒ½å­˜åœ¨ç³»ç»Ÿåå·®'
        WHEN ABS(skewness) > 2 THEN 'æ®‹å·®åˆ†å¸ƒåæ–œï¼Œå¯èƒ½è¿åæ­£æ€æ€§å‡è®¾'
        WHEN ABS(kurtosis) > 3 THEN 'æ®‹å·®åˆ†å¸ƒå¼‚å¸¸ï¼Œå¯èƒ½è¿åæ­£æ€æ€§å‡è®¾'
        ELSE 'æ®‹å·®åˆ†ææ­£å¸¸'
    END AS residual_diagnosis
FROM residual_analysis;

-- æ€§èƒ½æµ‹è¯•
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
WITH regression AS (
    SELECT
        (COUNT(*) * SUM(month_num * sales_amount) - SUM(month_num) * SUM(sales_amount)) /
        NULLIF(COUNT(*) *SUM(month_num* month_num) - SUM(month_num) *SUM(month_num), 0) AS slope,
        (SUM(sales_amount)* SUM(month_num *month_num) - SUM(month_num)* SUM(month_num *sales_amount)) /
        NULLIF(COUNT(*) *SUM(month_num* month_num) - SUM(month_num) * SUM(month_num), 0) AS intercept
    FROM sales_history
    WHERE month_num IS NOT NULL AND sales_amount IS NOT NULL
)
SELECT slope, intercept FROM regression;

```

---

## 6. PostgreSQL 18å¹¶è¡Œçº¿æ€§å›å½’

### 6.1 å¹¶è¡Œçº¿æ€§å›å½’æ¦‚è¿°

**PostgreSQL 18å¹¶è¡Œçº¿æ€§å›å½’**ï¼šåˆ©ç”¨PostgreSQL 18çš„å¹¶è¡ŒæŸ¥è¯¢èƒ½åŠ›ï¼Œæ˜¾è‘—æå‡å¤§è§„æ¨¡çº¿æ€§å›å½’è®¡ç®—çš„æ€§èƒ½ã€‚

#### å¹¶è¡Œçº¿æ€§å›å½’é…ç½®

```sql
-- é…ç½®å¹¶è¡Œçº¿æ€§å›å½’å‚æ•°ï¼ˆPostgreSQL 18+ï¼‰
DO $$
BEGIN
    BEGIN
        -- è®¾ç½®å¹¶è¡Œå·¥ä½œè¿›ç¨‹æ•°
        SET max_parallel_workers_per_gather = 4;

        -- è®¾ç½®å¹¶è¡Œè¡¨æ‰«æé˜ˆå€¼
        SET min_parallel_table_scan_size = '8MB';

        -- è®¾ç½®å¹¶è¡Œèšåˆæˆæœ¬é˜ˆå€¼
        SET parallel_setup_cost = 0;
        SET parallel_tuple_cost = 0.0001;

        RAISE NOTICE 'å¹¶è¡Œçº¿æ€§å›å½’å‚æ•°å·²é…ç½®';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¹¶è¡Œçº¿æ€§å›å½’é…ç½®å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

#### å¹¶è¡Œçº¿æ€§å›å½’å®ç°

```sql
-- å¹¶è¡Œçº¿æ€§å›å½’ï¼šå¤§è§„æ¨¡æ•°æ®å›å½’åˆ†æï¼ˆPostgreSQL 18+ï¼‰
DO $$
BEGIN
    BEGIN
        -- å¯ç”¨å¹¶è¡ŒæŸ¥è¯¢
        SET max_parallel_workers_per_gather = 4;
        SET parallel_setup_cost = 0;
        SET parallel_tuple_cost = 0.0001;

        RAISE NOTICE 'å¼€å§‹æ‰§è¡Œå¹¶è¡Œçº¿æ€§å›å½’';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¹¶è¡Œçº¿æ€§å›å½’å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- å¹¶è¡Œç®€å•çº¿æ€§å›å½’ç»Ÿè®¡é‡è®¡ç®—
EXPLAIN (ANALYZE, BUFFERS, TIMING)
WITH parallel_stats AS (
    SELECT
        AVG(x) AS x_mean,
        AVG(y) AS y_mean,
        AVG(x * y) AS xy_mean,
        AVG(x * x) AS x2_mean,
        COUNT(*) AS n
    FROM regression_data
),
parallel_coefficients AS (
    SELECT
        (xy_mean - x_mean * y_mean) / NULLIF(x2_mean - x_mean * x_mean, 0) AS slope,
        y_mean - (xy_mean - x_mean * y_mean) / NULLIF(x2_mean - x_mean * x_mean, 0) * x_mean AS intercept
    FROM parallel_stats
)
SELECT
    ROUND(slope::numeric, 4) AS slope,
    ROUND(intercept::numeric, 4) AS intercept
FROM parallel_coefficients;
```

---

## 7. ç®—æ³•æ€§èƒ½å¯¹æ¯”ä¸ä¼˜åŒ–

### 7.1 çº¿æ€§å›å½’ vs å…¶ä»–å›å½’æ–¹æ³•

| æ–¹æ³• | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|
| **çº¿æ€§å›å½’** | ç®€å•ã€å¯è§£é‡Šã€å¿«é€Ÿ | å‡è®¾çº¿æ€§å…³ç³»ã€å¯¹å¼‚å¸¸å€¼æ•æ„Ÿ | çº¿æ€§å…³ç³»æ•°æ® |
| **å¤šé¡¹å¼å›å½’** | å¤„ç†éçº¿æ€§å…³ç³» | å®¹æ˜“è¿‡æ‹Ÿåˆ | éçº¿æ€§ä½†å¹³æ»‘çš„æ•°æ® |
| **å²­å›å½’** | å¤„ç†å¤šé‡å…±çº¿æ€§ã€ç¨³å®š | ä¸è¿›è¡Œç‰¹å¾é€‰æ‹© | ç‰¹å¾ç›¸å…³æ€§å¼º |
| **Lassoå›å½’** | è‡ªåŠ¨ç‰¹å¾é€‰æ‹© | å¯èƒ½åˆ é™¤é‡è¦ç‰¹å¾ | é«˜ç»´æ•°æ®ã€ç‰¹å¾é€‰æ‹© |
| **å¼¹æ€§ç½‘ç»œ** | ç»“åˆRidgeå’ŒLasso | å‚æ•°è°ƒä¼˜å¤æ‚ | é«˜ç»´æ•°æ®ã€å¤šé‡å…±çº¿æ€§ |

### 7.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **ç´¢å¼•ä¼˜åŒ–**ï¼šåœ¨å›å½’å˜é‡ä¸Šåˆ›å»ºç´¢å¼•ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½
2. **æ•°æ®é‡‡æ ·**ï¼šå¯¹äºå¤§æ•°æ®é›†ï¼Œä½¿ç”¨é‡‡æ ·æ–¹æ³•å‡å°‘è®¡ç®—é‡
3. **å¹¶è¡Œå¤„ç†**ï¼šåˆ©ç”¨PostgreSQLçš„å¹¶è¡ŒæŸ¥è¯¢åŠŸèƒ½åŠ é€Ÿè®¡ç®—
4. **çŸ©é˜µè¿ç®—**ï¼šå¯¹äºå¤šå…ƒå›å½’ï¼Œè€ƒè™‘ä½¿ç”¨MADlibæ‰©å±•æˆ–å¤–éƒ¨å·¥å…·
5. **ç‰¹å¾å·¥ç¨‹**ï¼šåˆ›å»ºäº¤äº’é¡¹ã€å¤šé¡¹å¼ç‰¹å¾æé«˜æ¨¡å‹è¡¨è¾¾èƒ½åŠ›

### 7.3 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

**é—®é¢˜1**ï¼šå¤šé‡å…±çº¿æ€§

- **è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨å²­å›å½’ã€åˆ é™¤ç›¸å…³ç‰¹å¾ã€ä½¿ç”¨ä¸»æˆåˆ†å›å½’

**é—®é¢˜2**ï¼šå¼‚æ–¹å·®æ€§ï¼ˆæ®‹å·®æ–¹å·®ä¸ç­‰ï¼‰

- **è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨åŠ æƒæœ€å°äºŒä¹˜æ³•ï¼ˆWLSï¼‰ã€æ•°æ®å˜æ¢

**é—®é¢˜3**ï¼šéçº¿æ€§å…³ç³»

- **è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨å¤šé¡¹å¼å›å½’ã€éçº¿æ€§å˜æ¢ã€å…¶ä»–å›å½’æ–¹æ³•

**é—®é¢˜4**ï¼šå¼‚å¸¸å€¼å½±å“

- **è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ç¨³å¥å›å½’ï¼ˆRobust Regressionï¼‰ã€åˆ é™¤æˆ–ä¿®æ­£å¼‚å¸¸å€¼

---

## 8. æœ€ä½³å®è·µ

### 8.1 æ•°æ®å‡†å¤‡

1. **æ•°æ®è´¨é‡æ£€æŸ¥**ï¼š
   - æ£€æŸ¥ç¼ºå¤±å€¼ï¼šåˆ é™¤æˆ–å¡«å……
   - æ£€æŸ¥å¼‚å¸¸å€¼ï¼šä½¿ç”¨IQRæ–¹æ³•è¯†åˆ«
   - æ£€æŸ¥å¤šé‡å…±çº¿æ€§ï¼šè®¡ç®—ç‰¹å¾é—´ç›¸å…³ç³»æ•°

2. **ç‰¹å¾å·¥ç¨‹**ï¼š
   - **ç‰¹å¾é€‰æ‹©**ï¼šé€‰æ‹©ä¸ç›®æ ‡å˜é‡ç›¸å…³æ€§é«˜çš„ç‰¹å¾
   - **ç‰¹å¾å˜æ¢**ï¼šå¯¹æ•°å˜æ¢ã€å¹³æ–¹æ ¹å˜æ¢å¤„ç†éçº¿æ€§
   - **ç‰¹å¾æ ‡å‡†åŒ–**ï¼šZ-scoreæ ‡å‡†åŒ–æé«˜æ•°å€¼ç¨³å®šæ€§

3. **æ•°æ®åˆ†å‰²**ï¼š
   - è®­ç»ƒé›†ï¼š70-80%
   - éªŒè¯é›†ï¼š10-15%
   - æµ‹è¯•é›†ï¼š10-15%

### 8.2 æ¨¡å‹è®­ç»ƒ

1. **å‚æ•°ä¼°è®¡**ï¼š
   - ä½¿ç”¨æœ€å°äºŒä¹˜æ³•ä¼°è®¡å‚æ•°
   - æ£€æŸ¥å‚æ•°çš„ç»Ÿè®¡æ˜¾è‘—æ€§ï¼ˆtæ£€éªŒï¼‰

2. **æ¨¡å‹è¯Šæ–­**ï¼š
   - **æ®‹å·®åˆ†æ**ï¼šæ£€æŸ¥æ®‹å·®çš„æ­£æ€æ€§ã€ç‹¬ç«‹æ€§ã€åŒæ–¹å·®æ€§
   - **Q-Qå›¾**ï¼šå¯è§†åŒ–æ®‹å·®çš„æ­£æ€æ€§
   - **æ®‹å·®å›¾**ï¼šæ£€æŸ¥æ®‹å·®ä¸é¢„æµ‹å€¼çš„å…³ç³»

3. **æ¨¡å‹é€‰æ‹©**ï¼š
   - ä½¿ç”¨AIC/BICè¿›è¡Œæ¨¡å‹æ¯”è¾ƒ
   - ä½¿ç”¨äº¤å‰éªŒè¯è¯„ä¼°æ³›åŒ–èƒ½åŠ›
   - å¹³è¡¡æ¨¡å‹å¤æ‚åº¦å’Œæ‹Ÿåˆåº¦

### 8.3 æ¨¡å‹è¯„ä¼°

1. **è¯„ä¼°æŒ‡æ ‡**ï¼š
   - **RÂ²**ï¼šè§£é‡Šæ–¹å·®æ¯”ä¾‹
   - **è°ƒæ•´RÂ²**ï¼šè€ƒè™‘è‡ªç”±åº¦çš„RÂ²
   - **RMSE**ï¼šé¢„æµ‹è¯¯å·®å¤§å°
   - **MAE**ï¼šå¹³å‡ç»å¯¹è¯¯å·®

2. **äº¤å‰éªŒè¯**ï¼š
   - kæŠ˜äº¤å‰éªŒè¯ï¼ˆé€šå¸¸k=5æˆ–k=10ï¼‰
   - ç•™ä¸€æ³•äº¤å‰éªŒè¯ï¼ˆLOOCVï¼‰
   - æ—¶é—´åºåˆ—äº¤å‰éªŒè¯ï¼ˆæ—¶é—´åºåˆ—æ•°æ®ï¼‰

3. **æ¨¡å‹æ¯”è¾ƒ**ï¼š
   - æ¯”è¾ƒä¸åŒæ¨¡å‹çš„RÂ²ã€RMSE
   - ä½¿ç”¨Fæ£€éªŒæ¯”è¾ƒåµŒå¥—æ¨¡å‹
   - è€ƒè™‘æ¨¡å‹çš„å¤æ‚åº¦å’Œå¯è§£é‡Šæ€§

### 8.4 å‡è®¾æ£€éªŒ

1. **å‚æ•°æ˜¾è‘—æ€§æ£€éªŒ**ï¼š
   - tæ£€éªŒï¼šæ£€éªŒå•ä¸ªå›å½’ç³»æ•°æ˜¯å¦æ˜¾è‘—
   - Fæ£€éªŒï¼šæ£€éªŒæ•´ä½“æ¨¡å‹æ˜¯å¦æ˜¾è‘—

2. **æ¨¡å‹å‡è®¾æ£€éªŒ**ï¼š
   - **æ­£æ€æ€§æ£€éªŒ**ï¼šShapiro-Wilkæ£€éªŒã€Kolmogorov-Smirnovæ£€éªŒ
   - **åŒæ–¹å·®æ€§æ£€éªŒ**ï¼šBreusch-Paganæ£€éªŒã€Whiteæ£€éªŒ
   - **ç‹¬ç«‹æ€§æ£€éªŒ**ï¼šDurbin-Watsonæ£€éªŒï¼ˆæ—¶é—´åºåˆ—ï¼‰

### 8.5 SQLå®ç°æ³¨æ„äº‹é¡¹

1. **æ•°å€¼ç¨³å®šæ€§**ï¼š
   - ä½¿ç”¨NUMERICç±»å‹ä¿æŒç²¾åº¦
   - æ³¨æ„é™¤é›¶é”™è¯¯ï¼ˆä½¿ç”¨NULLIFï¼‰
   - æ³¨æ„çŸ©é˜µæ±‚é€†çš„æ•°å€¼ç¨³å®šæ€§

2. **å¤§è§„æ¨¡æ•°æ®**ï¼š
   - ä½¿ç”¨é‡‡æ ·æ–¹æ³•
   - ä½¿ç”¨å¢é‡è®¡ç®—
   - è€ƒè™‘ä½¿ç”¨MADlibæ‰©å±•

3. **çŸ©é˜µè¿ç®—**ï¼š
   - PostgreSQLåŸç”Ÿä¸æ”¯æŒçŸ©é˜µè¿ç®—
   - è€ƒè™‘ä½¿ç”¨PL/Pythonè°ƒç”¨NumPy
   - æˆ–ä½¿ç”¨MADlibæ‰©å±•

### 8.6 PostgreSQL 18 æ–°ç‰¹æ€§åº”ç”¨

**PostgreSQL 18**å¼•å…¥äº†å¤šé¡¹å¢å¼ºåŠŸèƒ½ï¼Œå¯ä»¥æ˜¾è‘—æå‡çº¿æ€§å›å½’è®¡ç®—çš„æ€§èƒ½ï¼š

1. **Skip Scanä¼˜åŒ–**ï¼š
   - å¯¹äºåŒ…å«å›å½’å˜é‡çš„ç´¢å¼•ï¼ŒSkip Scanå¯ä»¥è·³è¿‡ä¸å¿…è¦çš„ç´¢å¼•æ‰«æ
   - ç‰¹åˆ«é€‚ç”¨äºç‰¹å¾é€‰æ‹©å’Œæ•°æ®é‡‡æ ·

2. **å¼‚æ­¥I/Oå¢å¼º**ï¼š
   - å¯¹äºå¤§è§„æ¨¡å›å½’è®¡ç®—ï¼Œå¼‚æ­¥I/Oå¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½
   - é€‚ç”¨äºæ‰¹é‡ç‰¹å¾è®¡ç®—å’Œå¤šå˜é‡å›å½’

3. **å¹¶è¡ŒæŸ¥è¯¢å¢å¼º**ï¼š
   - çº¿æ€§å›å½’ç»Ÿè®¡é‡è®¡ç®—æ”¯æŒæ›´å¥½çš„å¹¶è¡Œæ‰§è¡Œ
   - é€‚ç”¨äºå¤§è§„æ¨¡å›å½’åˆ†æå’Œç‰¹å¾å·¥ç¨‹

**ç¤ºä¾‹ï¼šä½¿ç”¨Skip Scanä¼˜åŒ–ç‰¹å¾é€‰æ‹©æŸ¥è¯¢**

```sql
-- ä¸ºå›å½’å˜é‡åˆ›å»ºSkip Scanä¼˜åŒ–ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_regression_features_skip_scan
ON regression_data USING btree(x DESC, y DESC);

-- Skip Scanä¼˜åŒ–æŸ¥è¯¢ï¼šæŸ¥æ‰¾æœ€ç›¸å…³çš„ç‰¹å¾
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
WITH feature_correlation AS (
    SELECT
        x,
        y,
        CORR(x, y) OVER () AS correlation_coefficient
    FROM regression_data
    WHERE x IS NOT NULL AND y IS NOT NULL
)
SELECT DISTINCT
    x,
    y,
    ROUND(correlation_coefficient::numeric, 6) AS correlation
FROM feature_correlation
ORDER BY ABS(correlation_coefficient) DESC
LIMIT 10;
```

### 8.7 é«˜çº§ä¼˜åŒ–æŠ€å·§

**1. ä½¿ç”¨ç‰©åŒ–è§†å›¾ç¼“å­˜å›å½’æ¨¡å‹å‚æ•°**

å¯¹äºé¢‘ç¹ä½¿ç”¨çš„å›å½’æ¨¡å‹ï¼Œä½¿ç”¨ç‰©åŒ–è§†å›¾ç¼“å­˜å‚æ•°ï¼š

```sql
-- åˆ›å»ºç‰©åŒ–è§†å›¾ç¼“å­˜å›å½’æ¨¡å‹å‚æ•°
CREATE MATERIALIZED VIEW IF NOT EXISTS regression_models_cache AS
WITH regression_stats AS (
    SELECT
        model_id,
        COUNT(*) AS n,
        AVG(x) AS x_mean,
        AVG(y) AS y_mean,
        AVG(x * y) AS xy_mean,
        AVG(x * x) AS x2_mean
    FROM regression_data
    WHERE x IS NOT NULL AND y IS NOT NULL
    GROUP BY model_id
)
SELECT
    model_id,
    n,
    (xy_mean - x_mean * y_mean) / NULLIF(x2_mean - x_mean * x_mean, 0) AS slope,
    y_mean - (xy_mean - x_mean * y_mean) / NULLIF(x2_mean - x_mean * x_mean, 0) * x_mean AS intercept,
    x_mean,
    y_mean
FROM regression_stats;

-- åˆ›å»ºç´¢å¼•åŠ é€Ÿç‰©åŒ–è§†å›¾æŸ¥è¯¢
CREATE INDEX idx_regression_models_cache_id ON regression_models_cache(model_id);

-- å®šæœŸåˆ·æ–°ç‰©åŒ–è§†å›¾
REFRESH MATERIALIZED VIEW CONCURRENTLY regression_models_cache;
```

**2. ä½¿ç”¨çª—å£å‡½æ•°ä¼˜åŒ–æ‰¹é‡é¢„æµ‹**

ä½¿ç”¨çª—å£å‡½æ•°ä¼˜åŒ–æ‰¹é‡é¢„æµ‹è®¡ç®—ï¼š

```sql
-- ä½¿ç”¨çª—å£å‡½æ•°ä¼˜åŒ–æ‰¹é‡é¢„æµ‹
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
WITH regression_coefficients AS (
    SELECT
        (COUNT(*) * SUM(x * y) - SUM(x) * SUM(y)) /
        NULLIF(COUNT(*) * SUM(x * x) - SUM(x) * SUM(x), 0) AS slope,
        (SUM(y) * SUM(x * x) - SUM(x) * SUM(x * y)) /
        NULLIF(COUNT(*) * SUM(x * x) - SUM(x) * SUM(x), 0) AS intercept
    FROM regression_data
    WHERE x IS NOT NULL AND y IS NOT NULL
),
predictions AS (
    SELECT
        id,
        x,
        y AS actual_value,
        rc.slope * x + rc.intercept AS predicted_value,
        -- ä½¿ç”¨çª—å£å‡½æ•°è®¡ç®—é¢„æµ‹è¯¯å·®ï¼ˆé¿å…é‡å¤è®¡ç®—ï¼‰
        ABS(y - (rc.slope * x + rc.intercept)) AS prediction_error,
        -- ä½¿ç”¨çª—å£å‡½æ•°è®¡ç®—ç´¯è®¡è¯¯å·®
        SUM(ABS(y - (rc.slope * x + rc.intercept))) OVER (ORDER BY id) AS cumulative_error
    FROM regression_data rd
    CROSS JOIN regression_coefficients rc
    WHERE rd.x IS NOT NULL AND rd.y IS NOT NULL
)
SELECT
    id,
    x,
    ROUND(actual_value::numeric, 4) AS actual_value,
    ROUND(predicted_value::numeric, 4) AS predicted_value,
    ROUND(prediction_error::numeric, 4) AS error,
    ROUND(cumulative_error::numeric, 4) AS cumulative_error
FROM predictions
ORDER BY id;
```

**3. å¢é‡å›å½’ï¼šå®æ—¶æ›´æ–°å›å½’æ¨¡å‹**

å¯¹äºæµå¼æ•°æ®ï¼Œä½¿ç”¨å¢é‡æ–¹æ³•æ›´æ–°å›å½’æ¨¡å‹ï¼š

```sql
-- å¢é‡å›å½’ï¼šå®æ—¶æ›´æ–°å›å½’æ¨¡å‹å‚æ•°ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'regression_model_state') THEN
            CREATE TABLE regression_model_state (
                model_id VARCHAR(50) PRIMARY KEY,
                n BIGINT NOT NULL,
                sum_x NUMERIC NOT NULL,
                sum_y NUMERIC NOT NULL,
                sum_xy NUMERIC NOT NULL,
                sum_x2 NUMERIC NOT NULL,
                slope NUMERIC,
                intercept NUMERIC,
                last_updated TIMESTAMPTZ DEFAULT NOW()
            );

            RAISE NOTICE 'å›å½’æ¨¡å‹çŠ¶æ€è¡¨åˆ›å»ºæˆåŠŸ';
        END IF;

        RAISE NOTICE 'å¼€å§‹æ‰§è¡Œå¢é‡å›å½’æ›´æ–°';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¢é‡å›å½’å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- å¢é‡æ›´æ–°å›å½’æ¨¡å‹å‚æ•°
WITH new_data_stats AS (
    SELECT
        COUNT(*) AS new_n,
        SUM(x) AS new_sum_x,
        SUM(y) AS new_sum_y,
        SUM(x * y) AS new_sum_xy,
        SUM(x * x) AS new_sum_x2
    FROM regression_data
    WHERE id > (SELECT COALESCE(MAX(id), 0) FROM regression_model_state)
)
UPDATE regression_model_state
SET
    n = n + new_data_stats.new_n,
    sum_x = sum_x + new_data_stats.new_sum_x,
    sum_y = sum_y + new_data_stats.new_sum_y,
    sum_xy = sum_xy + new_data_stats.new_sum_xy,
    sum_x2 = sum_x2 + new_data_stats.new_sum_x2,
    slope = (n + new_data_stats.new_n) * (sum_xy + new_data_stats.new_sum_xy) - (sum_x + new_data_stats.new_sum_x) * (sum_y + new_data_stats.new_sum_y) /
            NULLIF((n + new_data_stats.new_n) * (sum_x2 + new_data_stats.new_sum_x2) - (sum_x + new_data_stats.new_sum_x) * (sum_x + new_data_stats.new_sum_x), 0),
    intercept = (sum_y + new_data_stats.new_sum_y) -
                ((n + new_data_stats.new_n) * (sum_xy + new_data_stats.new_sum_xy) - (sum_x + new_data_stats.new_sum_x) * (sum_y + new_data_stats.new_sum_y)) /
                NULLIF((n + new_data_stats.new_n) * (sum_x2 + new_data_stats.new_sum_x2) - (sum_x + new_data_stats.new_sum_x) * (sum_x + new_data_stats.new_sum_x), 0) *
                (sum_x + new_data_stats.new_sum_x) / (n + new_data_stats.new_n),
    last_updated = NOW()
FROM new_data_stats
WHERE model_id = 'default_model';
```

---

## ğŸ“š å‚è€ƒèµ„æº

### å­¦æœ¯æ–‡çŒ®

1. **Gauss, C.F. (1809)**: "Theoria Motus Corporum Coelestium", æœ€å°äºŒä¹˜æ³•çš„å¥ åŸºå·¥ä½œ

2. **Legendre, A.M. (1805)**: "Nouvelles mÃ©thodes pour la dÃ©termination des orbites des comÃ¨tes", ç‹¬ç«‹æå‡ºæœ€å°äºŒä¹˜æ³•

3. **ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹**ï¼ˆæèˆªï¼Œ2012ï¼‰- ç¬¬1ç«  ç»Ÿè®¡å­¦ä¹ åŠç›‘ç£å­¦ä¹ æ¦‚è®º

4. **ã€ŠThe Elements of Statistical Learningã€‹**ï¼ˆHastie et al., 2009ï¼‰- Chapter 3: Linear Methods for Regression

5. **ã€ŠAn Introduction to Statistical Learningã€‹**ï¼ˆJames et al., 2013ï¼‰- Chapter 3: Linear Regression

### åœ¨çº¿èµ„æº

- **scikit-learnçº¿æ€§å›å½’**: <https://scikit-learn.org/stable/modules/linear_model.html>
- **PostgreSQL MADlibæ‰©å±•**: <https://madlib.apache.org/>
- **NumPyçº¿æ€§ä»£æ•°**: <https://numpy.org/doc/stable/reference/routines.linalg.html>
- **Rè¯­è¨€lmå‡½æ•°**: <https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/lm>

### ç›¸å…³ç®—æ³•

- **é€»è¾‘å›å½’**ï¼šåˆ†ç±»é—®é¢˜çš„çº¿æ€§æ¨¡å‹
- **å¤šé¡¹å¼å›å½’**ï¼šéçº¿æ€§å…³ç³»çš„çº¿æ€§åŒ–
- **å²­å›å½’**ï¼šL2æ­£åˆ™åŒ–çº¿æ€§å›å½’
- **Lassoå›å½’**ï¼šL1æ­£åˆ™åŒ–çº¿æ€§å›å½’
- **å¼¹æ€§ç½‘ç»œ**ï¼šL1+L2æ­£åˆ™åŒ–
- **å¹¿ä¹‰çº¿æ€§æ¨¡å‹ï¼ˆGLMï¼‰**ï¼šçº¿æ€§å›å½’çš„æ‰©å±•

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ
