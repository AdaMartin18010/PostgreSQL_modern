# PostgreSQL æ–‡æœ¬åˆ†ç±»ç®—æ³•å®Œæ•´æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æŠ€æœ¯æ ˆ**: PostgreSQL 17+/18+ | æ–‡æœ¬åˆ†ç±» | æ–‡æ¡£åˆ†ç±»
> **éš¾åº¦çº§åˆ«**: â­â­â­â­ (é«˜çº§)

---

## ğŸ“‹ ç›®å½•

- [PostgreSQL æ–‡æœ¬åˆ†ç±»ç®—æ³•å®Œæ•´æŒ‡å—](#postgresql-æ–‡æœ¬åˆ†ç±»ç®—æ³•å®Œæ•´æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [æ–‡æœ¬åˆ†ç±»ç®—æ³•æ¦‚è¿°](#æ–‡æœ¬åˆ†ç±»ç®—æ³•æ¦‚è¿°)
    - [æ ¸å¿ƒåˆ†ç±»æ–¹æ³•](#æ ¸å¿ƒåˆ†ç±»æ–¹æ³•)
  - [1. å…³é”®è¯åˆ†ç±»](#1-å…³é”®è¯åˆ†ç±»)
    - [1.1 å…³é”®è¯åŒ¹é…åˆ†ç±»](#11-å…³é”®è¯åŒ¹é…åˆ†ç±»)
  - [2. åŸºäºè§„åˆ™çš„åˆ†ç±»](#2-åŸºäºè§„åˆ™çš„åˆ†ç±»)
    - [2.1 è§„åˆ™å¼•æ“åˆ†ç±»](#21-è§„åˆ™å¼•æ“åˆ†ç±»)
  - [3. æ–‡æœ¬ç‰¹å¾æå–](#3-æ–‡æœ¬ç‰¹å¾æå–)
    - [3.1 ç‰¹å¾å‘é‡æå–](#31-ç‰¹å¾å‘é‡æå–)
  - [4. å®é™…åº”ç”¨æ¡ˆä¾‹](#4-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [4.1 æ–‡æ¡£è‡ªåŠ¨åˆ†ç±»](#41-æ–‡æ¡£è‡ªåŠ¨åˆ†ç±»)

---

## æ–‡æœ¬åˆ†ç±»ç®—æ³•æ¦‚è¿°

**æ–‡æœ¬åˆ†ç±»ç®—æ³•**ç”¨äºå°†æ–‡æœ¬è‡ªåŠ¨åˆ†ç±»åˆ°é¢„å®šä¹‰çš„ç±»åˆ«ï¼ŒPostgreSQLå¯ä»¥é€šè¿‡SQLå®ç°ç®€å•çš„åˆ†ç±»ç®—æ³•ã€‚

### æ ¸å¿ƒåˆ†ç±»æ–¹æ³•

| æ–¹æ³• | ç”¨é€” | å¤æ‚åº¦ |
|------|------|--------|
| **å…³é”®è¯åˆ†ç±»** | åŸºäºå…³é”®è¯ | O(n) |
| **è§„åˆ™åˆ†ç±»** | åŸºäºè§„åˆ™ | O(n) |
| **ç‰¹å¾åˆ†ç±»** | åŸºäºç‰¹å¾ | O(n) |

---

## 1. å…³é”®è¯åˆ†ç±»

### 1.1 å…³é”®è¯åŒ¹é…åˆ†ç±»

**å…³é”®è¯åˆ†ç±»**åŸºäºå…³é”®è¯åŒ¹é…è¿›è¡Œåˆ†ç±»ã€‚

```sql
-- å…³é”®è¯åˆ†ç±»ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'articles') THEN
            RAISE WARNING 'è¡¨ articles ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡Œå…³é”®è¯åˆ†ç±»';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡Œå…³é”®è¯åˆ†ç±»';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å…³é”®è¯åˆ†ç±»å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT
    id,
    title,
    content,
    CASE
        WHEN to_tsvector('english', content) @@ to_tsquery('english', 'technology | software | programming') THEN 'Technology'
        WHEN to_tsvector('english', content) @@ to_tsquery('english', 'business | finance | market') THEN 'Business'
        WHEN to_tsvector('english', content) @@ to_tsquery('english', 'health | medical | doctor') THEN 'Health'
        ELSE 'Other'
    END AS category
FROM articles;
```

---

## 2. åŸºäºè§„åˆ™çš„åˆ†ç±»

### 2.1 è§„åˆ™å¼•æ“åˆ†ç±»

**åŸºäºè§„åˆ™çš„åˆ†ç±»**ä½¿ç”¨è§„åˆ™å¼•æ“è¿›è¡Œåˆ†ç±»ã€‚

```sql
-- åŸºäºè§„åˆ™çš„åˆ†ç±»ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'documents') THEN
            RAISE WARNING 'è¡¨ documents ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡ŒåŸºäºè§„åˆ™çš„åˆ†ç±»';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡ŒåŸºäºè§„åˆ™çš„åˆ†ç±»';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'åŸºäºè§„åˆ™çš„åˆ†ç±»å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

WITH classification_rules AS (
    SELECT
        id,
        title,
        content,
        CASE
            WHEN length(content) > 5000 AND similarity(title, 'report') > 0.3 THEN 'Long Report'
            WHEN length(content) < 500 AND similarity(title, 'note') > 0.3 THEN 'Short Note'
            WHEN to_tsvector('english', content) @@ to_tsquery('english', 'urgent | important') THEN 'Urgent'
            WHEN to_tsvector('english', content) @@ to_tsquery('english', 'meeting | schedule') THEN 'Meeting'
            ELSE 'General'
        END AS document_category
    FROM documents
)
SELECT
    document_category,
    COUNT(*) AS count,
    AVG(length(content)) AS avg_length
FROM classification_rules
GROUP BY document_category
ORDER BY count DESC;
```

---

## 3. æ–‡æœ¬ç‰¹å¾æå–

### 3.1 ç‰¹å¾å‘é‡æå–

**æ–‡æœ¬ç‰¹å¾æå–**æå–æ–‡æœ¬çš„ç‰¹å¾å‘é‡ç”¨äºåˆ†ç±»ã€‚

```sql
-- æ–‡æœ¬ç‰¹å¾æå–ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'texts') THEN
            RAISE WARNING 'è¡¨ texts ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡Œæ–‡æœ¬ç‰¹å¾æå–';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡Œæ–‡æœ¬ç‰¹å¾æå–';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'æ–‡æœ¬ç‰¹å¾æå–å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

WITH text_features AS (
    SELECT
        id,
        text,
        length(text) AS text_length,
        array_length(string_to_array(text, ' '), 1) AS word_count,
        (SELECT COUNT(*) FROM unnest(string_to_array(lower(text), ' ')) AS word WHERE word IN ('important', 'urgent', 'critical')) AS important_words_count,
        similarity(text, 'reference text') AS similarity_score
    FROM texts
)
SELECT
    id,
    text_length,
    word_count,
    important_words_count,
    similarity_score,
    CASE
        WHEN important_words_count >= 2 THEN 'High Priority'
        WHEN similarity_score > 0.7 THEN 'Similar'
        WHEN word_count > 100 THEN 'Long'
        ELSE 'Normal'
    END AS text_class
FROM text_features;
```

---

## 4. å®é™…åº”ç”¨æ¡ˆä¾‹

### 4.1 æ–‡æ¡£è‡ªåŠ¨åˆ†ç±»

**æ–‡æ¡£è‡ªåŠ¨åˆ†ç±»**æ ¹æ®å†…å®¹è‡ªåŠ¨åˆ†ç±»æ–‡æ¡£ã€‚

```sql
-- æ–‡æ¡£è‡ªåŠ¨åˆ†ç±»ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'documents') THEN
            RAISE WARNING 'è¡¨ documents ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡Œæ–‡æ¡£è‡ªåŠ¨åˆ†ç±»';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡Œæ–‡æ¡£è‡ªåŠ¨åˆ†ç±»';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'æ–‡æ¡£è‡ªåŠ¨åˆ†ç±»å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

SELECT
    id,
    title,
    content,
    CASE
        WHEN to_tsvector('english', content) @@ to_tsquery('english', 'technology | software') THEN 'Technology'
        WHEN to_tsvector('english', content) @@ to_tsquery('english', 'business | finance') THEN 'Business'
        WHEN to_tsvector('english', content) @@ to_tsquery('english', 'health | medical') THEN 'Health'
        WHEN to_tsvector('english', content) @@ to_tsquery('english', 'education | learning') THEN 'Education'
        ELSE 'General'
    END AS category,
    ts_rank(to_tsvector('english', content), to_tsquery('english', 'keyword')) AS relevance_score
FROM documents
ORDER BY relevance_score DESC;
```

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
