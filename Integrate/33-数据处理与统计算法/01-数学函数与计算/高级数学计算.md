# PostgreSQL é«˜çº§æ•°å­¦è®¡ç®—å®Œæ•´æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æŠ€æœ¯æ ˆ**: PostgreSQL 17+/18+ | é«˜çº§æ•°å­¦ | çŸ©é˜µè¿ç®— | å‘é‡è®¡ç®—
> **éš¾åº¦çº§åˆ«**: â­â­â­â­ (é«˜çº§)

---

## ğŸ“‹ ç›®å½•

- [PostgreSQL é«˜çº§æ•°å­¦è®¡ç®—å®Œæ•´æŒ‡å—](#postgresql-é«˜çº§æ•°å­¦è®¡ç®—å®Œæ•´æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [é«˜çº§æ•°å­¦è®¡ç®—æ¦‚è¿°](#é«˜çº§æ•°å­¦è®¡ç®—æ¦‚è¿°)
    - [æ ¸å¿ƒè®¡ç®—ç±»å‹](#æ ¸å¿ƒè®¡ç®—ç±»å‹)
  - [1. å‘é‡è¿ç®—](#1-å‘é‡è¿ç®—)
    - [1.1 å‘é‡ç‚¹ç§¯](#11-å‘é‡ç‚¹ç§¯)
    - [1.2 å‘é‡èŒƒæ•°](#12-å‘é‡èŒƒæ•°)
  - [2. çŸ©é˜µè¿ç®—](#2-çŸ©é˜µè¿ç®—)
    - [2.1 çŸ©é˜µè½¬ç½®](#21-çŸ©é˜µè½¬ç½®)
  - [3. å¤æ•°è¿ç®—](#3-å¤æ•°è¿ç®—)
    - [3.1 å¤æ•°è¡¨ç¤ºå’Œè¿ç®—](#31-å¤æ•°è¡¨ç¤ºå’Œè¿ç®—)
  - [4. å®é™…åº”ç”¨æ¡ˆä¾‹](#4-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [4.1 æœºå™¨å­¦ä¹ ï¼šç‰¹å¾å‘é‡ç›¸ä¼¼åº¦](#41-æœºå™¨å­¦ä¹ ç‰¹å¾å‘é‡ç›¸ä¼¼åº¦)

---

## é«˜çº§æ•°å­¦è®¡ç®—æ¦‚è¿°

**é«˜çº§æ•°å­¦è®¡ç®—**åŒ…æ‹¬å‘é‡è¿ç®—ã€çŸ©é˜µè¿ç®—ã€å¤æ•°è¿ç®—ç­‰ï¼Œä½¿ç”¨PostgreSQLçš„æ•°ç»„ç±»å‹å’Œè‡ªå®šä¹‰å‡½æ•°å®ç°ã€‚

### æ ¸å¿ƒè®¡ç®—ç±»å‹

| è®¡ç®—ç±»å‹ | å®ç°æ–¹å¼ | å¤æ‚åº¦ | åº”ç”¨åœºæ™¯ |
|---------|---------|--------|---------|
| **å‘é‡è¿ç®—** | æ•°ç»„æ“ä½œ | O(n) | æœºå™¨å­¦ä¹ ã€æ•°æ®åˆ†æ |
| **çŸ©é˜µè¿ç®—** | äºŒç»´æ•°ç»„ | O(nÂ²) | çº¿æ€§ä»£æ•°ã€å›¾åƒå¤„ç† |
| **å¤æ•°è¿ç®—** | è‡ªå®šä¹‰ç±»å‹ | O(1) | ä¿¡å·å¤„ç†ã€å·¥ç¨‹è®¡ç®— |

---

## 1. å‘é‡è¿ç®—

### 1.1 å‘é‡ç‚¹ç§¯

**å‘é‡ç‚¹ç§¯**è®¡ç®—ä¸¤ä¸ªå‘é‡çš„å†…ç§¯ã€‚

```sql
-- å‘é‡ç‚¹ç§¯è®¡ç®—ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
DECLARE
    vector1 NUMERIC[] := ARRAY[1, 2, 3];
    vector2 NUMERIC[] := ARRAY[4, 5, 6];
    dot_product NUMERIC;
BEGIN
    BEGIN
        IF array_length(vector1, 1) IS NULL OR array_length(vector2, 1) IS NULL THEN
            RAISE WARNING 'å‘é‡ä¸èƒ½ä¸ºç©º';
            RETURN;
        END IF;

        IF array_length(vector1, 1) != array_length(vector2, 1) THEN
            RAISE WARNING 'å‘é‡ç»´åº¦å¿…é¡»ç›¸åŒ';
            RETURN;
        END IF;

        -- è®¡ç®—ç‚¹ç§¯
        SELECT SUM(a * b) INTO dot_product
        FROM unnest(vector1) WITH ORDINALITY AS t1(a, idx)
        JOIN unnest(vector2) WITH ORDINALITY AS t2(b, idx) USING (idx);

        RAISE NOTICE 'å‘é‡ç‚¹ç§¯: % Â· % = %', vector1, vector2, dot_product;
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å‘é‡ç‚¹ç§¯è®¡ç®—å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

### 1.2 å‘é‡èŒƒæ•°

**å‘é‡èŒƒæ•°**è®¡ç®—å‘é‡çš„é•¿åº¦ã€‚

```sql
-- å‘é‡L2èŒƒæ•°ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
DECLARE
    vector NUMERIC[] := ARRAY[3, 4];
    l2_norm NUMERIC;
BEGIN
    BEGIN
        IF array_length(vector, 1) IS NULL THEN
            RAISE WARNING 'å‘é‡ä¸èƒ½ä¸ºç©º';
            RETURN;
        END IF;

        -- L2èŒƒæ•°: sqrt(sum(xi^2))
        SELECT SQRT(SUM(x * x)) INTO l2_norm
        FROM unnest(vector) AS x;

        RAISE NOTICE 'å‘é‡L2èŒƒæ•°: ||%|| = %', vector, l2_norm;
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å‘é‡èŒƒæ•°è®¡ç®—å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

---

## 2. çŸ©é˜µè¿ç®—

### 2.1 çŸ©é˜µè½¬ç½®

**çŸ©é˜µè½¬ç½®**å°†çŸ©é˜µçš„è¡Œå’Œåˆ—äº’æ¢ã€‚

```sql
-- çŸ©é˜µè½¬ç½®ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
DECLARE
    matrix NUMERIC[][] := ARRAY[
        ARRAY[1, 2, 3],
        ARRAY[4, 5, 6]
    ];
    transposed NUMERIC[][];
    rows_count INTEGER;
    cols_count INTEGER;
BEGIN
    BEGIN
        rows_count := array_length(matrix, 1);
        cols_count := array_length(matrix[1], 1);

        IF rows_count IS NULL OR cols_count IS NULL THEN
            RAISE WARNING 'çŸ©é˜µæ— æ•ˆ';
            RETURN;
        END IF;

        -- è½¬ç½®çŸ©é˜µ
        SELECT array_agg(row_value ORDER BY col_idx) INTO transposed
        FROM (
            SELECT
                col_idx,
                array_agg(value ORDER BY row_idx) AS row_value
            FROM (
                SELECT
                    row_idx,
                    col_idx,
                    matrix[row_idx][col_idx] AS value
                FROM generate_series(1, rows_count) AS row_idx
                CROSS JOIN generate_series(1, cols_count) AS col_idx
            ) AS matrix_expanded
            GROUP BY col_idx
        ) AS transposed_rows;

        RAISE NOTICE 'çŸ©é˜µè½¬ç½®å®Œæˆ: % -> %', matrix, transposed;
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'çŸ©é˜µè½¬ç½®å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

---

## 3. å¤æ•°è¿ç®—

### 3.1 å¤æ•°è¡¨ç¤ºå’Œè¿ç®—

**å¤æ•°è¿ç®—**ä½¿ç”¨æ•°ç»„è¡¨ç¤ºå¤æ•°ï¼ˆå®éƒ¨ï¼Œè™šéƒ¨ï¼‰ã€‚

```sql
-- å¤æ•°è¿ç®—ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
DECLARE
    complex1 NUMERIC[] := ARRAY[3, 4];  -- 3 + 4i
    complex2 NUMERIC[] := ARRAY[1, 2];  -- 1 + 2i
    sum_result NUMERIC[];
    product_result NUMERIC[];
BEGIN
    BEGIN
        IF array_length(complex1, 1) != 2 OR array_length(complex2, 1) != 2 THEN
            RAISE WARNING 'å¤æ•°å¿…é¡»æœ‰ä¸¤ä¸ªå…ƒç´ ï¼ˆå®éƒ¨ï¼Œè™šéƒ¨ï¼‰';
            RETURN;
        END IF;

        -- å¤æ•°åŠ æ³•: (a+bi) + (c+di) = (a+c) + (b+d)i
        sum_result := ARRAY[
            complex1[1] + complex2[1],
            complex1[2] + complex2[2]
        ];
        RAISE NOTICE 'å¤æ•°åŠ æ³•: % + % = %', complex1, complex2, sum_result;

        -- å¤æ•°ä¹˜æ³•: (a+bi) * (c+di) = (ac-bd) + (ad+bc)i
        product_result := ARRAY[
            complex1[1] * complex2[1] - complex1[2] * complex2[2],
            complex1[1] * complex2[2] + complex1[2] * complex2[1]
        ];
        RAISE NOTICE 'å¤æ•°ä¹˜æ³•: % * % = %', complex1, complex2, product_result;
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¤æ•°è¿ç®—å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

---

## 4. å®é™…åº”ç”¨æ¡ˆä¾‹

### 4.1 æœºå™¨å­¦ä¹ ï¼šç‰¹å¾å‘é‡ç›¸ä¼¼åº¦

```sql
-- è®¡ç®—ç‰¹å¾å‘é‡ä½™å¼¦ç›¸ä¼¼åº¦ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
DECLARE
    feature1 NUMERIC[] := ARRAY[1, 2, 3, 4, 5];
    feature2 NUMERIC[] := ARRAY[2, 3, 4, 5, 6];
    dot_product NUMERIC;
    norm1 NUMERIC;
    norm2 NUMERIC;
    cosine_similarity NUMERIC;
BEGIN
    BEGIN
        IF array_length(feature1, 1) != array_length(feature2, 1) THEN
            RAISE WARNING 'ç‰¹å¾å‘é‡ç»´åº¦å¿…é¡»ç›¸åŒ';
            RETURN;
        END IF;

        -- è®¡ç®—ç‚¹ç§¯
        SELECT SUM(a * b) INTO dot_product
        FROM unnest(feature1) WITH ORDINALITY AS t1(a, idx)
        JOIN unnest(feature2) WITH ORDINALITY AS t2(b, idx) USING (idx);

        -- è®¡ç®—L2èŒƒæ•°
        SELECT SQRT(SUM(x * x)) INTO norm1 FROM unnest(feature1) AS x;
        SELECT SQRT(SUM(x * x)) INTO norm2 FROM unnest(feature2) AS x;

        -- ä½™å¼¦ç›¸ä¼¼åº¦: dot_product / (norm1 * norm2)
        IF norm1 = 0 OR norm2 = 0 THEN
            RAISE WARNING 'å‘é‡èŒƒæ•°ä¸ºé›¶ï¼Œæ— æ³•è®¡ç®—ç›¸ä¼¼åº¦';
            RETURN;
        END IF;

        cosine_similarity := dot_product / (norm1 * norm2);
        RAISE NOTICE 'ä½™å¼¦ç›¸ä¼¼åº¦: %', cosine_similarity;
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'ç›¸ä¼¼åº¦è®¡ç®—å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
