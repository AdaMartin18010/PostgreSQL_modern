# PostgreSQL çº¿æ€§ç³»ç»Ÿæ±‚è§£ç®—æ³•å®Œæ•´æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æŠ€æœ¯æ ˆ**: PostgreSQL 17+/18+ | æ•°å€¼çº¿æ€§ä»£æ•° | çº¿æ€§æ–¹ç¨‹ç»„ | è¿­ä»£æ³•
> **éš¾åº¦çº§åˆ«**: â­â­â­â­â­ (ä¸“å®¶çº§)
> **å‚è€ƒæ ‡å‡†**: Numerical Linear Algebra (Trefethen & Bau), Matrix Computations

---

## ğŸ“‹ ç›®å½•

- [PostgreSQL çº¿æ€§ç³»ç»Ÿæ±‚è§£ç®—æ³•å®Œæ•´æŒ‡å—](#postgresql-çº¿æ€§ç³»ç»Ÿæ±‚è§£ç®—æ³•å®Œæ•´æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [çº¿æ€§ç³»ç»Ÿæ¦‚è¿°](#çº¿æ€§ç³»ç»Ÿæ¦‚è¿°)
    - [é—®é¢˜å®šä¹‰](#é—®é¢˜å®šä¹‰)
    - [æ±‚è§£æ–¹æ³•åˆ†ç±»](#æ±‚è§£æ–¹æ³•åˆ†ç±»)
  - [1. ç›´æ¥æ³•](#1-ç›´æ¥æ³•)
    - [1.1 é«˜æ–¯æ¶ˆå…ƒæ³•](#11-é«˜æ–¯æ¶ˆå…ƒæ³•)
  - [2. è¿­ä»£æ³•](#2-è¿­ä»£æ³•)
    - [2.1 é›…å¯æ¯”è¿­ä»£](#21-é›…å¯æ¯”è¿­ä»£)
  - [3. PostgreSQL 18 å¹¶è¡Œçº¿æ€§ç³»ç»Ÿæ±‚è§£å¢å¼º](#3-postgresql-18-å¹¶è¡Œçº¿æ€§ç³»ç»Ÿæ±‚è§£å¢å¼º)
    - [3.1 å¹¶è¡Œçº¿æ€§ç³»ç»Ÿæ±‚è§£åŸç†](#31-å¹¶è¡Œçº¿æ€§ç³»ç»Ÿæ±‚è§£åŸç†)
    - [3.2 å¹¶è¡Œé›…å¯æ¯”è¿­ä»£](#32-å¹¶è¡Œé›…å¯æ¯”è¿­ä»£)
    - [3.3 å¹¶è¡Œé«˜æ–¯æ¶ˆå…ƒ](#33-å¹¶è¡Œé«˜æ–¯æ¶ˆå…ƒ)
  - [ğŸ“š å‚è€ƒèµ„æº](#-å‚è€ƒèµ„æº)

---

## çº¿æ€§ç³»ç»Ÿæ¦‚è¿°

**çº¿æ€§ç³»ç»Ÿ** $Ax = b$ æ˜¯æ•°å€¼è®¡ç®—çš„åŸºç¡€é—®é¢˜ã€‚

### é—®é¢˜å®šä¹‰

ç»™å®šçŸ©é˜µ $A \in \mathbb{R}^{n \times n}$ å’Œå‘é‡ $b \in \mathbb{R}^n$ï¼Œæ±‚è§£ $x \in \mathbb{R}^n$ ä½¿å¾— $Ax = b$ã€‚

### æ±‚è§£æ–¹æ³•åˆ†ç±»

| æ–¹æ³•ç±»å‹ | ç®—æ³• | é€‚ç”¨åœºæ™¯ |
|---------|------|---------|
| **ç›´æ¥æ³•** | é«˜æ–¯æ¶ˆå…ƒã€LUåˆ†è§£ | å°åˆ°ä¸­ç­‰è§„æ¨¡ |
| **è¿­ä»£æ³•** | é›…å¯æ¯”ã€Gauss-Seidel | å¤§è§„æ¨¡ç¨€ç–ç³»ç»Ÿ |
| **Krylovå­ç©ºé—´** | CGã€GMRES | å¤§è§„æ¨¡ç¨€ç–ç³»ç»Ÿ |

---

## 1. ç›´æ¥æ³•

### 1.1 é«˜æ–¯æ¶ˆå…ƒæ³•

**é«˜æ–¯æ¶ˆå…ƒæ³•**é€šè¿‡è¡Œå˜æ¢å°†çŸ©é˜µåŒ–ä¸ºä¸Šä¸‰è§’çŸ©é˜µã€‚

```sql
-- çº¿æ€§ç³»ç»Ÿæ•°æ®å‡†å¤‡
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'linear_system') THEN
            DROP TABLE linear_system CASCADE;
        END IF;

        CREATE TABLE linear_system (
            row_idx INTEGER NOT NULL,
            col_idx INTEGER NOT NULL,
            coeff NUMERIC NOT NULL,
            rhs NUMERIC,
            PRIMARY KEY (row_idx, col_idx)
        );

        -- 3x3çº¿æ€§ç³»ç»Ÿï¼šAx = b
        INSERT INTO linear_system (row_idx, col_idx, coeff, rhs) VALUES
            (1, 1, 2, 8), (1, 2, 1, NULL), (1, 3, 0, NULL),
            (2, 1, 4, 18), (2, 2, 3, NULL), (2, 3, 1, NULL),
            (3, 1, 2, 14), (3, 2, 1, NULL), (3, 3, 2, NULL);

        RAISE NOTICE 'çº¿æ€§ç³»ç»Ÿè¡¨åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE EXCEPTION 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
    END;
END $$;
```

---

## 2. è¿­ä»£æ³•

### 2.1 é›…å¯æ¯”è¿­ä»£

**é›…å¯æ¯”è¿­ä»£**:
$$x_i^{(k+1)} = \frac{1}{a_{ii}}\left(b_i - \sum_{j \neq i} a_{ij} x_j^{(k)}\right)$$

```sql
-- é›…å¯æ¯”è¿­ä»£å®ç°
WITH jacobi_iteration AS (
    SELECT
        iteration,
        variable_id,
        new_value
    FROM jacobi_solver
)
SELECT * FROM jacobi_iteration;
```

---

## 3. PostgreSQL 18 å¹¶è¡Œçº¿æ€§ç³»ç»Ÿæ±‚è§£å¢å¼º

**PostgreSQL 18** æ˜¾è‘—å¢å¼ºäº†å¹¶è¡Œçº¿æ€§ç³»ç»Ÿæ±‚è§£èƒ½åŠ›ï¼Œæ”¯æŒå¹¶è¡Œæ‰§è¡ŒçŸ©é˜µè¿ç®—å’Œè¿­ä»£è®¡ç®—ï¼Œå¤§å¹…æå‡å¤§è§„æ¨¡çº¿æ€§ç³»ç»Ÿæ±‚è§£çš„æ€§èƒ½ã€‚

### 3.1 å¹¶è¡Œçº¿æ€§ç³»ç»Ÿæ±‚è§£åŸç†

PostgreSQL 18 çš„å¹¶è¡Œçº¿æ€§ç³»ç»Ÿæ±‚è§£é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š

1. **å¹¶è¡Œæ‰«æ**ï¼šå¤šä¸ªå·¥ä½œè¿›ç¨‹å¹¶è¡Œæ‰«æçŸ©é˜µæ•°æ®
2. **å¹¶è¡ŒçŸ©é˜µè¿ç®—**ï¼šæ¯ä¸ªå·¥ä½œè¿›ç¨‹ç‹¬ç«‹æ‰§è¡Œéƒ¨åˆ†çŸ©é˜µè¿ç®—
3. **å¹¶è¡Œè¿­ä»£**ï¼šå¹¶è¡Œæ‰§è¡Œè¿­ä»£ç®—æ³•
4. **ç»“æœåˆå¹¶**ï¼šä¸»è¿›ç¨‹åˆå¹¶æ‰€æœ‰å·¥ä½œè¿›ç¨‹çš„è®¡ç®—ç»“æœ

### 3.2 å¹¶è¡Œé›…å¯æ¯”è¿­ä»£

```sql
-- PostgreSQL 18 å¹¶è¡Œé›…å¯æ¯”è¿­ä»£ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'linear_system') THEN
            RAISE WARNING 'è¡¨ linear_system ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡Œå¹¶è¡Œé›…å¯æ¯”è¿­ä»£';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡ŒPostgreSQL 18å¹¶è¡Œé›…å¯æ¯”è¿­ä»£';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¹¶è¡Œé›…å¯æ¯”è¿­ä»£å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

SET max_parallel_workers_per_gather = 4;
SET parallel_setup_cost = 0;

-- å¹¶è¡Œé›…å¯æ¯”è¿­ä»£ï¼šæ±‚è§£çº¿æ€§ç³»ç»Ÿ Ax = b
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
WITH RECURSIVE jacobi_iteration AS (
    -- åˆå§‹å€¼
    SELECT
        0 AS iteration,
        row_idx AS variable_id,
        CASE WHEN rhs IS NOT NULL THEN rhs ELSE 0 END AS x_value
    FROM linear_system
    WHERE col_idx = row_idx
    UNION ALL
    -- è¿­ä»£è®¡ç®—
    SELECT
        ji.iteration + 1,
        ji.variable_id,
        (ls.rhs - COALESCE(SUM(ls2.coeff * ji2.x_value), 0)) / NULLIF(ls.coeff, 0) AS x_value
    FROM jacobi_iteration ji
    JOIN linear_system ls ON ji.variable_id = ls.row_idx AND ls.col_idx = ls.row_idx
    LEFT JOIN linear_system ls2 ON ls.row_idx = ls2.row_idx AND ls2.col_idx != ls2.row_idx
    LEFT JOIN jacobi_iteration ji2 ON ls2.col_idx = ji2.variable_id AND ji.iteration = ji2.iteration
    WHERE ji.iteration < 50
    GROUP BY ji.iteration, ji.variable_id, ls.rhs, ls.coeff
)
SELECT
    variable_id,
    ROUND(x_value::numeric, 6) AS solution
FROM jacobi_iteration
WHERE iteration = (SELECT MAX(iteration) FROM jacobi_iteration)
ORDER BY variable_id;
```

### 3.3 å¹¶è¡Œé«˜æ–¯æ¶ˆå…ƒ

```sql
-- PostgreSQL 18 å¹¶è¡Œé«˜æ–¯æ¶ˆå…ƒï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'linear_system') THEN
            RAISE WARNING 'è¡¨ linear_system ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡Œå¹¶è¡Œé«˜æ–¯æ¶ˆå…ƒ';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡ŒPostgreSQL 18å¹¶è¡Œé«˜æ–¯æ¶ˆå…ƒ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¹¶è¡Œé«˜æ–¯æ¶ˆå…ƒå‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

SET max_parallel_workers_per_gather = 4;
SET parallel_setup_cost = 0;

-- å¹¶è¡Œé«˜æ–¯æ¶ˆå…ƒï¼šä¸Šä¸‰è§’åŒ–
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
WITH elimination_steps AS (
    SELECT
        row_idx,
        col_idx,
        coeff,
        rhs,
        CASE
            WHEN row_idx > col_idx THEN coeff - (SELECT coeff FROM linear_system ls2 WHERE ls2.row_idx = col_idx AND ls2.col_idx = col_idx) *
                (SELECT coeff FROM linear_system ls3 WHERE ls3.row_idx = row_idx AND ls3.col_idx = col_idx) /
                NULLIF((SELECT coeff FROM linear_system ls4 WHERE ls4.row_idx = col_idx AND ls4.col_idx = col_idx), 0)
            ELSE coeff
        END AS eliminated_coeff
    FROM linear_system
)
SELECT
    row_idx,
    col_idx,
    ROUND(eliminated_coeff::numeric, 6) AS upper_triangular_coeff
FROM elimination_steps
ORDER BY row_idx, col_idx;
```

---

## ğŸ“š å‚è€ƒèµ„æº

1. **Trefethen, L.N., Bau, D. (1997)**: "Numerical Linear Algebra"

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ
