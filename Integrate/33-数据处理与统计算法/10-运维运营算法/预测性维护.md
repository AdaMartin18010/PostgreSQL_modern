# PostgreSQL È¢ÑÊµãÊÄßÁª¥Êä§ÂÆåÊï¥ÊåáÂçó

> **ÂàõÂª∫Êó•Êúü**: 2025Âπ¥1Êúà
> **ÊäÄÊúØÊ†à**: PostgreSQL 17+/18+ | È¢ÑÊµãÊÄßÁª¥Êä§ | ÊïÖÈöúÈ¢ÑÊµã
> **ÈöæÂ∫¶Á∫ßÂà´**: ‚≠ê‚≠ê‚≠ê‚≠ê (È´òÁ∫ß)

---

## üìã ÁõÆÂΩï

- [PostgreSQL È¢ÑÊµãÊÄßÁª¥Êä§ÂÆåÊï¥ÊåáÂçó](#postgresql-È¢ÑÊµãÊÄßÁª¥Êä§ÂÆåÊï¥ÊåáÂçó)
  - [üìã ÁõÆÂΩï](#-ÁõÆÂΩï)
  - [È¢ÑÊµãÊÄßÁª¥Êä§Ê¶ÇËø∞](#È¢ÑÊµãÊÄßÁª¥Êä§Ê¶ÇËø∞)
    - [ÁêÜËÆ∫Âü∫Á°Ä](#ÁêÜËÆ∫Âü∫Á°Ä)
      - [È¢ÑÊµãÊÄßÁª¥Êä§ÈóÆÈ¢òÂÆö‰πâ](#È¢ÑÊµãÊÄßÁª¥Êä§ÈóÆÈ¢òÂÆö‰πâ)
      - [È¢ÑÊµãÊñπÊ≥ïÂàÜÁ±ª](#È¢ÑÊµãÊñπÊ≥ïÂàÜÁ±ª)
      - [È¢ÑÊµãÊñπÊ≥ïÈÄâÊã©](#È¢ÑÊµãÊñπÊ≥ïÈÄâÊã©)
    - [Ê†∏ÂøÉÊñπÊ≥ï](#Ê†∏ÂøÉÊñπÊ≥ï)
  - [1. ËÆæÂ§áÂÅ•Â∫∑Â∫¶ËØÑ‰º∞](#1-ËÆæÂ§áÂÅ•Â∫∑Â∫¶ËØÑ‰º∞)
    - [1.1 ËÆæÂ§áÂÅ•Â∫∑Â∫¶ËØÑ‰º∞ÂéüÁêÜ](#11-ËÆæÂ§áÂÅ•Â∫∑Â∫¶ËØÑ‰º∞ÂéüÁêÜ)
      - [ÂÅ•Â∫∑Â∫¶ÂÆö‰πâ](#ÂÅ•Â∫∑Â∫¶ÂÆö‰πâ)
      - [ÂÅ•Â∫∑Â∫¶ËÆ°ÁÆóÊñπÊ≥ï](#ÂÅ•Â∫∑Â∫¶ËÆ°ÁÆóÊñπÊ≥ï)
    - [1.2 ÂÅ•Â∫∑Â∫¶ËØÑÂàÜÂÆûÁé∞](#12-ÂÅ•Â∫∑Â∫¶ËØÑÂàÜÂÆûÁé∞)
    - [1.3 Â§öÊåáÊ†áÂÅ•Â∫∑Â∫¶](#13-Â§öÊåáÊ†áÂÅ•Â∫∑Â∫¶)
  - [2. ÊïÖÈöúÈ¢ÑÊµã](#2-ÊïÖÈöúÈ¢ÑÊµã)
    - [2.1 ÊïÖÈöúÈ¢ÑÊµãÂéüÁêÜ](#21-ÊïÖÈöúÈ¢ÑÊµãÂéüÁêÜ)
      - [ÊïÖÈöúÈ¢ÑÊµãÂÆö‰πâ](#ÊïÖÈöúÈ¢ÑÊµãÂÆö‰πâ)
      - [È¢ÑÊµãÊñπÊ≥ï](#È¢ÑÊµãÊñπÊ≥ï)
    - [2.2 Âü∫‰∫éË∂ãÂäøÁöÑÈ¢ÑÊµãÂÆûÁé∞](#22-Âü∫‰∫éË∂ãÂäøÁöÑÈ¢ÑÊµãÂÆûÁé∞)
    - [2.3 Âü∫‰∫éÊú∫Âô®Â≠¶‰π†ÁöÑÈ¢ÑÊµã](#23-Âü∫‰∫éÊú∫Âô®Â≠¶‰π†ÁöÑÈ¢ÑÊµã)
      - [‰º†ÁªüÊú∫Âô®Â≠¶‰π†È¢ÑÊµã](#‰º†ÁªüÊú∫Âô®Â≠¶‰π†È¢ÑÊµã)
      - [AIÂ¢ûÂº∫È¢ÑÊµãÔºàpgvector + Ê®°ÂºèËØÜÂà´Ôºâ](#aiÂ¢ûÂº∫È¢ÑÊµãpgvector--Ê®°ÂºèËØÜÂà´)
  - [3. Áª¥Êä§Âª∫ËÆÆ](#3-Áª¥Êä§Âª∫ËÆÆ)
    - [3.1 Áª¥Êä§Âª∫ËÆÆÂéüÁêÜ](#31-Áª¥Êä§Âª∫ËÆÆÂéüÁêÜ)
      - [Áª¥Êä§Âª∫ËÆÆÂÆö‰πâ](#Áª¥Êä§Âª∫ËÆÆÂÆö‰πâ)
      - [‰ºòÂÖàÁ∫ßËÆ°ÁÆó](#‰ºòÂÖàÁ∫ßËÆ°ÁÆó)
    - [3.2 Áª¥Êä§‰ºòÂÖàÁ∫ßÂÆûÁé∞](#32-Áª¥Êä§‰ºòÂÖàÁ∫ßÂÆûÁé∞)
    - [3.3 Áª¥Êä§ËÆ°Âàí‰ºòÂåñ](#33-Áª¥Êä§ËÆ°Âàí‰ºòÂåñ)
  - [4. È¢ÑÊµãÊÄßÁª¥Êä§‰ºòÂåñÁ≠ñÁï•](#4-È¢ÑÊµãÊÄßÁª¥Êä§‰ºòÂåñÁ≠ñÁï•)
    - [4.1 Á¥¢Âºï‰ºòÂåñ](#41-Á¥¢Âºï‰ºòÂåñ)
    - [4.2 ÂÅ•Â∫∑Â∫¶ËÆ°ÁÆó‰ºòÂåñ](#42-ÂÅ•Â∫∑Â∫¶ËÆ°ÁÆó‰ºòÂåñ)
    - [4.3 ÊâπÈáèÈ¢ÑÊµã‰ºòÂåñ](#43-ÊâπÈáèÈ¢ÑÊµã‰ºòÂåñ)
  - [5. ÂÆûÈôÖÂ∫îÁî®Ê°à‰æã](#5-ÂÆûÈôÖÂ∫îÁî®Ê°à‰æã)
    - [5.1 ÊúçÂä°Âô®È¢ÑÊµãÊÄßÁª¥Êä§](#51-ÊúçÂä°Âô®È¢ÑÊµãÊÄßÁª¥Êä§)
    - [5.2 Êï∞ÊçÆÂ∫ìÈ¢ÑÊµãÊÄßÁª¥Êä§](#52-Êï∞ÊçÆÂ∫ìÈ¢ÑÊµãÊÄßÁª¥Êä§)
    - [5.3 ÁΩëÁªúËÆæÂ§áÈ¢ÑÊµãÊÄßÁª¥Êä§](#53-ÁΩëÁªúËÆæÂ§áÈ¢ÑÊµãÊÄßÁª¥Êä§)
    - [5.4 ÁªºÂêàÈ¢ÑÊµãÊÄßÁª¥Êä§Á≥ªÁªü](#54-ÁªºÂêàÈ¢ÑÊµãÊÄßÁª¥Êä§Á≥ªÁªü)
  - [6. ÁÆóÊ≥ïÊÄßËÉΩÂØπÊØî‰∏é‰ºòÂåñ](#6-ÁÆóÊ≥ïÊÄßËÉΩÂØπÊØî‰∏é‰ºòÂåñ)
    - [6.1 È¢ÑÊµãÊñπÊ≥ïÂØπÊØî](#61-È¢ÑÊµãÊñπÊ≥ïÂØπÊØî)
    - [6.2 ÊÄßËÉΩ‰ºòÂåñÂª∫ËÆÆ](#62-ÊÄßËÉΩ‰ºòÂåñÂª∫ËÆÆ)
    - [6.3 Â∏∏ËßÅÈóÆÈ¢ò‰∏éËß£ÂÜ≥ÊñπÊ°à](#63-Â∏∏ËßÅÈóÆÈ¢ò‰∏éËß£ÂÜ≥ÊñπÊ°à)
  - [7. ÊúÄ‰Ω≥ÂÆûË∑µ](#7-ÊúÄ‰Ω≥ÂÆûË∑µ)
    - [7.1 ÊñπÊ≥ïÈÄâÊã©](#71-ÊñπÊ≥ïÈÄâÊã©)
    - [7.2 Êï∞ÊçÆË¥®Èáè](#72-Êï∞ÊçÆË¥®Èáè)
    - [7.3 Ê®°ÂûãÊõ¥Êñ∞](#73-Ê®°ÂûãÊõ¥Êñ∞)
    - [7.4 SQLÂÆûÁé∞Ê≥®ÊÑè‰∫ãÈ°π](#74-sqlÂÆûÁé∞Ê≥®ÊÑè‰∫ãÈ°π)
  - [üìö ÂèÇËÄÉËµÑÊ∫ê](#-ÂèÇËÄÉËµÑÊ∫ê)
    - [Â≠¶ÊúØÊñáÁåÆ](#Â≠¶ÊúØÊñáÁåÆ)
    - [PostgreSQLÂÆòÊñπÊñáÊ°£](#postgresqlÂÆòÊñπÊñáÊ°£)
    - [Âú®Á∫øËµÑÊ∫ê](#Âú®Á∫øËµÑÊ∫ê)
    - [Áõ∏ÂÖ≥ÁÆóÊ≥ï](#Áõ∏ÂÖ≥ÁÆóÊ≥ï)

---

## È¢ÑÊµãÊÄßÁª¥Êä§Ê¶ÇËø∞

**È¢ÑÊµãÊÄßÁª¥Êä§ÔºàPredictive MaintenanceÔºâ**ÈÄöËøáÂàÜÊûêËÆæÂ§áËøêË°åÊï∞ÊçÆÈ¢ÑÊµãÊïÖÈöúÔºåÊèêÂâçÂÆâÊéíÁª¥Êä§ÔºåÊòØËøêÁª¥ÁÆ°ÁêÜÁöÑÈ´òÁ∫ßÂ∫îÁî®„ÄÇ

### ÁêÜËÆ∫Âü∫Á°Ä

#### È¢ÑÊµãÊÄßÁª¥Êä§ÈóÆÈ¢òÂÆö‰πâ

**È¢ÑÊµãÊÄßÁª¥Êä§ÈóÆÈ¢ò**ÔºöÁªôÂÆöËÆæÂ§áÁõëÊéßÊï∞ÊçÆ$M = \{m_1, m_2, \ldots, m_T\}$ÔºåÈ¢ÑÊµãÊïÖÈöúÊó∂Èó¥$T_f$ÂíåÁª¥Êä§Âª∫ËÆÆ$A$Ôºö
$$T_f = f(M), \quad A = g(M, T_f)$$

ÂÖ∂‰∏≠$f$ÊòØÊïÖÈöúÈ¢ÑÊµãÂáΩÊï∞Ôºå$g$ÊòØÁª¥Êä§Âª∫ËÆÆÂáΩÊï∞„ÄÇ

#### È¢ÑÊµãÊñπÊ≥ïÂàÜÁ±ª

È¢ÑÊµãÊÄßÁª¥Êä§ÊñπÊ≥ïÂàÜÁ±ªÔºö

1. **ÂÅ•Â∫∑Â∫¶ËØÑ‰º∞**Ôºö
   - Â§öÊåáÊ†áÁªºÂêàËØÑÂàÜ
   - ÂÅ•Â∫∑Â∫¶Ë∂ãÂäøÂàÜÊûê
   - Êó∂Èó¥Â§çÊùÇÂ∫¶Ôºö$O(n)$

2. **Ë∂ãÂäøÈ¢ÑÊµã**Ôºö
   - Âü∫‰∫éË∂ãÂäøÁöÑÊïÖÈöúÈ¢ÑÊµã
   - Âü∫‰∫éÂõûÂΩíÁöÑÈ¢ÑÊµã
   - Êó∂Èó¥Â§çÊùÇÂ∫¶Ôºö$O(n)$

3. **ÂºÇÂ∏∏Ê£ÄÊµã**Ôºö
   - Âü∫‰∫éÂºÇÂ∏∏ÁöÑÊïÖÈöúÈ¢ÑÊµã
   - Âü∫‰∫éÊ®°ÂºèÁöÑÈ¢ÑÊµã
   - Êó∂Èó¥Â§çÊùÇÂ∫¶Ôºö$O(n)$

#### È¢ÑÊµãÊñπÊ≥ïÈÄâÊã©

ÈÄâÊã©È¢ÑÊµãÊñπÊ≥ïÁöÑËÄÉËôëÂõ†Á¥†Ôºö

1. **Êï∞ÊçÆÁ±ªÂûã**ÔºöËøûÁª≠Êï∞ÊçÆÁî®Ë∂ãÂäøÈ¢ÑÊµãÔºåÁ¶ªÊï£Êï∞ÊçÆÁî®ÂàÜÁ±ª
2. **ÂéÜÂè≤Êï∞ÊçÆ**ÔºöÊï∞ÊçÆÂÖÖË∂≥Áî®Â§çÊùÇÊ®°ÂûãÔºåÊï∞ÊçÆ‰∏çË∂≥Áî®ÁÆÄÂçïÊ®°Âûã
3. **Á≤æÂ∫¶Ë¶ÅÊ±Ç**ÔºöÈ´òÁ≤æÂ∫¶Áî®Êú∫Âô®Â≠¶‰π†ÔºåÂø´ÈÄüÁî®ÁªüËÆ°ÊñπÊ≥ï

### Ê†∏ÂøÉÊñπÊ≥ï

| ÊñπÊ≥ï | Êï∞Â≠¶ÂÆö‰πâ | Áî®ÈÄî | Êó∂Èó¥Â§çÊùÇÂ∫¶ | Á©∫Èó¥Â§çÊùÇÂ∫¶ | ÈÄÇÁî®Âú∫ÊôØ |
|------|---------|------|-----------|-----------|---------|
| **ÂÅ•Â∫∑Â∫¶ËØÑÂàÜ** | $H = \sum_{i=1}^{n} w_i \cdot S_i$ | ËÆæÂ§áÁä∂ÊÄÅËØÑ‰º∞ | $O(n)$ | $O(1)$ | Â§öÊåáÊ†áËØÑ‰º∞ |
| **Ë∂ãÂäøÂàÜÊûê** | $T_f = f(\text{trend}(M))$ | ÊïÖÈöúÈ¢ÑÊµã | $O(n)$ | $O(1)$ | Ë∂ãÂäøÈ¢ÑÊµã |
| **ÂºÇÂ∏∏Ê£ÄÊµã** | $T_f = f(\text{anomaly}(M))$ | ÂºÇÂ∏∏ËØÜÂà´ | $O(n)$ | $O(1)$ | ÂºÇÂ∏∏È¢ÑÊµã |

---

## 1. ËÆæÂ§áÂÅ•Â∫∑Â∫¶ËØÑ‰º∞

### 1.1 ËÆæÂ§áÂÅ•Â∫∑Â∫¶ËØÑ‰º∞ÂéüÁêÜ

**ËÆæÂ§áÂÅ•Â∫∑Â∫¶ËØÑ‰º∞ÔºàEquipment Health AssessmentÔºâ**ÁªºÂêàÂ§ö‰∏™ÊåáÊ†áËØÑ‰º∞ËÆæÂ§áÂÅ•Â∫∑Áä∂ÊÄÅ„ÄÇ

#### ÂÅ•Â∫∑Â∫¶ÂÆö‰πâ

**ÂÅ•Â∫∑Â∫¶ÔºàHealth ScoreÔºâ**ÔºöËÆæÂ§áÂÅ•Â∫∑Áä∂ÊÄÅÁöÑÈáèÂåñÊåáÊ†áÔºö
$$H = \sum_{i=1}^{n} w_i \cdot S_i$$

ÂÖ∂‰∏≠$w_i$ÊòØÊåáÊ†á$i$ÁöÑÊùÉÈáçÔºå$S_i$ÊòØÊåáÊ†á$i$ÁöÑÂÅ•Â∫∑Â∫¶ËØÑÂàÜ„ÄÇ

#### ÂÅ•Â∫∑Â∫¶ËÆ°ÁÆóÊñπÊ≥ï

**ÂÅ•Â∫∑Â∫¶ËÆ°ÁÆóÊñπÊ≥ï**Ôºö

1. **ÂçïÊåáÊ†áËØÑÂàÜ**ÔºöÂ∞ÜÊåáÊ†áÂÄºÊò†Â∞ÑÂà∞0-100ÂàÜ
2. **Â§öÊåáÊ†áÁªºÂêà**ÔºöÂä†ÊùÉÂπ≥ÂùáÂ§ö‰∏™ÊåáÊ†áËØÑÂàÜ
3. **Ë∂ãÂäøÂàÜÊûê**ÔºöËÄÉËôëÂÅ•Â∫∑Â∫¶ÂèòÂåñË∂ãÂäø

### 1.2 ÂÅ•Â∫∑Â∫¶ËØÑÂàÜÂÆûÁé∞

**ÂÅ•Â∫∑Â∫¶ËØÑÂàÜ**ÁöÑÂÆûÁé∞Âíå‰ΩøÁî®„ÄÇ

```sql
-- ÂàõÂª∫ËÆæÂ§áÁõëÊéßÊï∞ÊçÆË°®ÔºàÂ∏¶ÈîôËØØÂ§ÑÁêÜÔºâ
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'equipment_metrics') THEN
            RAISE WARNING 'Ë°® equipment_metrics Â∑≤Â≠òÂú®ÔºåÂÖàÂà†Èô§';
            DROP TABLE equipment_metrics CASCADE;
        END IF;

        CREATE TABLE equipment_metrics (
            timestamp TIMESTAMP NOT NULL,
            equipment_id VARCHAR(50) NOT NULL,
            temperature NUMERIC(5, 2),
            vibration NUMERIC(5, 2),
            pressure NUMERIC(5, 2),
            power_consumption NUMERIC(5, 2),
            PRIMARY KEY (timestamp, equipment_id)
        );

        INSERT INTO equipment_metrics (timestamp, equipment_id, temperature, vibration, pressure, power_consumption) VALUES
            ('2024-01-01 10:00:00', 'EQ001', 45.5, 2.3, 100.5, 1200.0),
            ('2024-01-01 10:01:00', 'EQ001', 46.2, 2.5, 101.2, 1210.0),
            ('2024-01-01 10:02:00', 'EQ001', 47.8, 2.8, 102.5, 1230.0),
            ('2024-01-01 10:00:00', 'EQ002', 42.0, 1.8, 95.0, 1100.0),
            ('2024-01-01 10:01:00', 'EQ002', 42.5, 1.9, 95.5, 1110.0);

        RAISE NOTICE 'Ë°® equipment_metrics ÂàõÂª∫ÊàêÂäü';
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'Ë°® equipment_metrics Â∑≤Â≠òÂú®';
        WHEN OTHERS THEN
            RAISE EXCEPTION 'ÂàõÂª∫Ë°®Â§±Ë¥•: %', SQLERRM;
    END;
END $$;

-- ËÆ°ÁÆóËÆæÂ§áÂÅ•Â∫∑Â∫¶ËØÑÂàÜÔºàÂ∏¶ÈîôËØØÂ§ÑÁêÜÂíåÊÄßËÉΩÊµãËØïÔºâ
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'equipment_metrics') THEN
            RAISE WARNING 'Ë°® equipment_metrics ‰∏çÂ≠òÂú®ÔºåÊó†Ê≥ïËÆ°ÁÆóÂÅ•Â∫∑Â∫¶ËØÑÂàÜ';
            RETURN;
        END IF;
        RAISE NOTICE 'ÂºÄÂßãËÆ°ÁÆóËÆæÂ§áÂÅ•Â∫∑Â∫¶ËØÑÂàÜ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'ÂÅ•Â∫∑Â∫¶ËØÑÂàÜËÆ°ÁÆóÂáÜÂ§áÂ§±Ë¥•: %', SQLERRM;
            RAISE;
    END;
END $$;

-- ËÆ°ÁÆóÂÅ•Â∫∑Â∫¶ËØÑÂàÜÔºàÂü∫‰∫éÂ§öÊåáÊ†áÔºâ
WITH normal_ranges AS (
    SELECT
        'temperature' AS metric, 50.0 AS max_normal, 40.0 AS min_normal
    UNION ALL SELECT 'vibration', 3.0, 1.0
    UNION ALL SELECT 'pressure', 110.0, 90.0
    UNION ALL SELECT 'power_consumption', 1300.0, 1000.0
),
latest_metrics AS (
    SELECT DISTINCT ON (equipment_id)
        equipment_id,
        temperature,
        vibration,
        pressure,
        power_consumption,
        timestamp
    FROM equipment_metrics
    ORDER BY equipment_id, timestamp DESC
),
health_scores AS (
    SELECT
        lm.equipment_id,
        lm.timestamp,
        -- Ê∏©Â∫¶ÂÅ•Â∫∑Â∫¶ (0-100)
        CASE
            WHEN lm.temperature > nr_temp.max_normal THEN 0
            WHEN lm.temperature < nr_temp.min_normal THEN 50
            ELSE 100 - ((lm.temperature - nr_temp.min_normal) / (nr_temp.max_normal - nr_temp.min_normal) * 50)
        END AS temp_score,
        -- ÊåØÂä®ÂÅ•Â∫∑Â∫¶
        CASE
            WHEN lm.vibration > nr_vib.max_normal THEN 0
            WHEN lm.vibration < nr_vib.min_normal THEN 50
            ELSE 100 - ((lm.vibration - nr_vib.min_normal) / (nr_vib.max_normal - nr_vib.min_normal) * 50)
        END AS vib_score,
        -- ÂéãÂäõÂÅ•Â∫∑Â∫¶
        CASE
            WHEN lm.pressure > nr_press.max_normal THEN 0
            WHEN lm.pressure < nr_press.min_normal THEN 50
            ELSE 100 - ((lm.pressure - nr_press.min_normal) / (nr_press.max_normal - nr_press.min_normal) * 50)
        END AS press_score,
        -- ÂäüËÄóÂÅ•Â∫∑Â∫¶
        CASE
            WHEN lm.power_consumption > nr_power.max_normal THEN 0
            WHEN lm.power_consumption < nr_power.min_normal THEN 50
            ELSE 100 - ((lm.power_consumption - nr_power.min_normal) / (nr_power.max_normal - nr_power.min_normal) * 50)
        END AS power_score
    FROM latest_metrics lm
    CROSS JOIN (SELECT * FROM normal_ranges WHERE metric = 'temperature') nr_temp
    CROSS JOIN (SELECT * FROM normal_ranges WHERE metric = 'vibration') nr_vib
    CROSS JOIN (SELECT * FROM normal_ranges WHERE metric = 'pressure') nr_press
    CROSS JOIN (SELECT * FROM normal_ranges WHERE metric = 'power_consumption') nr_power
)
SELECT
    equipment_id,
    timestamp,
    ROUND(temp_score::numeric, 2) AS temp_score,
    ROUND(vib_score::numeric, 2) AS vib_score,
    ROUND(press_score::numeric, 2) AS press_score,
    ROUND(power_score::numeric, 2) AS power_score,
    ROUND((temp_score + vib_score + press_score + power_score) / 4::numeric, 2) AS overall_health_score,
    CASE
        WHEN (temp_score + vib_score + press_score + power_score) / 4 >= 80 THEN 'Healthy'
        WHEN (temp_score + vib_score + press_score + power_score) / 4 >= 60 THEN 'Warning'
        ELSE 'Critical'
    END AS health_status
FROM health_scores
ORDER BY overall_health_score ASC;

-- ÊÄßËÉΩÊµãËØï
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT DISTINCT ON (equipment_id)
    equipment_id,
    temperature,
    vibration
FROM equipment_metrics
ORDER BY equipment_id, timestamp DESC;
```

---

### 1.3 Â§öÊåáÊ†áÂÅ•Â∫∑Â∫¶

**Â§öÊåáÊ†áÂÅ•Â∫∑Â∫¶**ÔºöÁªºÂêàÂ§ö‰∏™ÊåáÊ†áÁöÑÂÅ•Â∫∑Â∫¶ËØÑ‰º∞„ÄÇ

```sql
-- Â§öÊåáÊ†áÂÅ•Â∫∑Â∫¶ÔºàÂ∏¶ÈîôËØØÂ§ÑÁêÜÂíåÊÄßËÉΩÊµãËØïÔºâ
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'equipment_metrics') THEN
            RAISE WARNING 'Ë°® equipment_metrics ‰∏çÂ≠òÂú®ÔºåÊó†Ê≥ïËÆ°ÁÆóÂ§öÊåáÊ†áÂÅ•Â∫∑Â∫¶';
            RETURN;
        END IF;
        RAISE NOTICE 'ÂºÄÂßãËÆ°ÁÆóÂ§öÊåáÊ†áÂÅ•Â∫∑Â∫¶';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'Â§öÊåáÊ†áÂÅ•Â∫∑Â∫¶ËÆ°ÁÆóÂáÜÂ§áÂ§±Ë¥•: %', SQLERRM;
            RAISE;
    END;
END $$;

-- Â§öÊåáÊ†áÂÅ•Â∫∑Â∫¶ÔºöÁªºÂêàÊ∏©Â∫¶„ÄÅÊåØÂä®„ÄÅÂéãÂäõ„ÄÅÂäüËÄó
WITH latest_metrics AS (
    SELECT DISTINCT ON (equipment_id)
        equipment_id,
        timestamp,
        temperature,
        vibration,
        pressure,
        power_consumption
    FROM equipment_metrics
    ORDER BY equipment_id, timestamp DESC
),
health_scores AS (
    SELECT
        equipment_id,
        timestamp,
        -- Ê∏©Â∫¶ÂÅ•Â∫∑Â∫¶Ôºà0-100Ôºâ
        CASE
            WHEN temperature > 50 THEN 0
            WHEN temperature < 40 THEN 50
            ELSE 100 - ((temperature - 40) / 10 * 50)
        END AS temp_score,
        -- ÊåØÂä®ÂÅ•Â∫∑Â∫¶
        CASE
            WHEN vibration > 3 THEN 0
            WHEN vibration < 1 THEN 50
            ELSE 100 - ((vibration - 1) / 2 * 50)
        END AS vib_score,
        -- ÂéãÂäõÂÅ•Â∫∑Â∫¶
        CASE
            WHEN pressure > 110 THEN 0
            WHEN pressure < 90 THEN 50
            ELSE 100 - ((pressure - 90) / 20 * 50)
        END AS press_score,
        -- ÂäüËÄóÂÅ•Â∫∑Â∫¶
        CASE
            WHEN power_consumption > 1300 THEN 0
            WHEN power_consumption < 1000 THEN 50
            ELSE 100 - ((power_consumption - 1000) / 300 * 50)
        END AS power_score
    FROM latest_metrics
),
weighted_health AS (
    SELECT
        equipment_id,
        timestamp,
        temp_score,
        vib_score,
        press_score,
        power_score,
        -- Âä†ÊùÉÂÅ•Â∫∑Â∫¶ÔºàÊ∏©Â∫¶30%ÔºåÊåØÂä®30%ÔºåÂéãÂäõ20%ÔºåÂäüËÄó20%Ôºâ
        temp_score * 0.3 + vib_score * 0.3 + press_score * 0.2 + power_score * 0.2 AS overall_health_score
    FROM health_scores
)
SELECT
    equipment_id,
    timestamp,
    ROUND(temp_score::numeric, 2) AS temp_score,
    ROUND(vib_score::numeric, 2) AS vib_score,
    ROUND(press_score::numeric, 2) AS press_score,
    ROUND(power_score::numeric, 2) AS power_score,
    ROUND(overall_health_score::numeric, 2) AS overall_health_score,
    CASE
        WHEN overall_health_score >= 80 THEN 'Healthy'
        WHEN overall_health_score >= 60 THEN 'Warning'
        WHEN overall_health_score >= 40 THEN 'Degraded'
        ELSE 'Critical'
    END AS health_status
FROM weighted_health
ORDER BY overall_health_score ASC;
```

---

## 2. ÊïÖÈöúÈ¢ÑÊµã

### 2.1 ÊïÖÈöúÈ¢ÑÊµãÂéüÁêÜ

**ÊïÖÈöúÈ¢ÑÊµãÔºàFailure PredictionÔºâ**ÂàÜÊûêËÆæÂ§áÊï∞ÊçÆÈ¢ÑÊµãÊΩúÂú®ÊïÖÈöú„ÄÇ

#### ÊïÖÈöúÈ¢ÑÊµãÂÆö‰πâ

**ÊïÖÈöúÈ¢ÑÊµã**ÔºöÈ¢ÑÊµãËÆæÂ§áÂú®Êú™Êù•$T$Êó∂Èó¥ÂÜÖÂèëÁîüÊïÖÈöúÁöÑÊ¶ÇÁéáÔºö
$$P(\text{failure} | M, T) = f(M, T)$$

ÂÖ∂‰∏≠$f$ÊòØÈ¢ÑÊµãÂáΩÊï∞„ÄÇ

#### È¢ÑÊµãÊñπÊ≥ï

**È¢ÑÊµãÊñπÊ≥ï**Ôºö

1. **Ë∂ãÂäøÈ¢ÑÊµã**ÔºöÂü∫‰∫éÊåáÊ†áË∂ãÂäøÈ¢ÑÊµãÊïÖÈöú
2. **ÂõûÂΩíÈ¢ÑÊµã**Ôºö‰ΩøÁî®ÂõûÂΩíÊ®°ÂûãÈ¢ÑÊµãÊïÖÈöúÊó∂Èó¥
3. **ÂºÇÂ∏∏È¢ÑÊµã**ÔºöÂü∫‰∫éÂºÇÂ∏∏Ê£ÄÊµãÈ¢ÑÊµãÊïÖÈöú

### 2.2 Âü∫‰∫éË∂ãÂäøÁöÑÈ¢ÑÊµãÂÆûÁé∞

**Âü∫‰∫éË∂ãÂäøÁöÑÈ¢ÑÊµã**ÁöÑÂÆûÁé∞Âíå‰ΩøÁî®„ÄÇ

```sql
-- ÊïÖÈöúÈ¢ÑÊµãÔºàÂ∏¶ÈîôËØØÂ§ÑÁêÜÂíåÊÄßËÉΩÊµãËØïÔºâ
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'equipment_metrics') THEN
            RAISE WARNING 'Ë°® equipment_metrics ‰∏çÂ≠òÂú®ÔºåÊó†Ê≥ïËøõË°åÊïÖÈöúÈ¢ÑÊµã';
            RETURN;
        END IF;
        RAISE NOTICE 'ÂºÄÂßãËøõË°åÊïÖÈöúÈ¢ÑÊµã';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'ÊïÖÈöúÈ¢ÑÊµãÂáÜÂ§áÂ§±Ë¥•: %', SQLERRM;
            RAISE;
    END;
END $$;

-- Âü∫‰∫éË∂ãÂäøÁöÑÊïÖÈöúÈ¢ÑÊµã
WITH trend_analysis AS (
    SELECT
        equipment_id,
        timestamp,
        temperature,
        vibration,
        pressure,
        power_consumption,
        AVG(temperature) OVER (
            PARTITION BY equipment_id
            ORDER BY timestamp
            ROWS BETWEEN 9 PRECEDING AND CURRENT ROW
        ) AS temp_trend,
        AVG(vibration) OVER (
            PARTITION BY equipment_id
            ORDER BY timestamp
            ROWS BETWEEN 9 PRECEDING AND CURRENT ROW
        ) AS vib_trend,
        LAG(temperature) OVER (PARTITION BY equipment_id ORDER BY timestamp) AS prev_temp,
        LAG(vibration) OVER (PARTITION BY equipment_id ORDER BY timestamp) AS prev_vib
    FROM equipment_metrics
),
failure_risk AS (
    SELECT
        equipment_id,
        timestamp,
        temperature,
        vibration,
        temp_trend,
        vib_trend,
        CASE
            WHEN temperature > temp_trend * 1.1 AND vibration > vib_trend * 1.15 THEN 'High Risk'
            WHEN temperature > temp_trend * 1.05 OR vibration > vib_trend * 1.1 THEN 'Medium Risk'
            ELSE 'Low Risk'
        END AS failure_risk_level,
        CASE
            WHEN temperature > temp_trend * 1.1 AND vibration > vib_trend * 1.15 THEN 0.8
            WHEN temperature > temp_trend * 1.05 OR vibration > vib_trend * 1.1 THEN 0.5
            ELSE 0.2
        END AS failure_probability
    FROM trend_analysis
    WHERE temp_trend IS NOT NULL AND vib_trend IS NOT NULL
)
SELECT
    equipment_id,
    timestamp,
    ROUND(temperature::numeric, 2) AS temperature,
    ROUND(vibration::numeric, 2) AS vibration,
    ROUND(temp_trend::numeric, 2) AS temp_trend,
    ROUND(vib_trend::numeric, 2) AS vib_trend,
    failure_risk_level,
    ROUND((failure_probability * 100)::numeric, 2) AS failure_probability_pct
FROM failure_risk
WHERE failure_risk_level != 'Low Risk'
ORDER BY failure_probability DESC, timestamp;

-- ÊÄßËÉΩÊµãËØï
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT
    equipment_id,
    AVG(temperature) OVER (PARTITION BY equipment_id ORDER BY timestamp ROWS BETWEEN 9 PRECEDING AND CURRENT ROW) AS temp_trend
FROM equipment_metrics
ORDER BY equipment_id, timestamp;
```

---

### 2.3 Âü∫‰∫éÊú∫Âô®Â≠¶‰π†ÁöÑÈ¢ÑÊµã

**Âü∫‰∫éÊú∫Âô®Â≠¶‰π†ÁöÑÈ¢ÑÊµã**Ôºö‰ΩøÁî®ÁâπÂæÅÂ∑•Á®ãÂíåAIÊ®°ÂûãËøõË°åÊïÖÈöúÈ¢ÑÊµã„ÄÇ

#### ‰º†ÁªüÊú∫Âô®Â≠¶‰π†È¢ÑÊµã

**‰º†ÁªüÊú∫Âô®Â≠¶‰π†ÊñπÊ≥ï**Ôºö‰ΩøÁî®Á∫øÊÄßÂõûÂΩí„ÄÅÊó∂Èó¥Â∫èÂàóÊ®°ÂûãÁ≠âËøõË°åÈ¢ÑÊµã„ÄÇ

#### AIÂ¢ûÂº∫È¢ÑÊµãÔºàpgvector + Ê®°ÂºèËØÜÂà´Ôºâ

**AIÂ¢ûÂº∫È¢ÑÊµã**Ôºö‰ΩøÁî®pgvectorËøõË°åËÆæÂ§áÁä∂ÊÄÅÊ®°ÂºèËØÜÂà´ÔºåÁªìÂêàÂéÜÂè≤ÊïÖÈöúÊ®°ÂºèËøõË°åÈ¢ÑÊµã„ÄÇ

```sql
-- AIÂ¢ûÂº∫È¢ÑÊµãÔºöÂü∫‰∫éËÆæÂ§áÁä∂ÊÄÅÂêëÈáèÊ®°ÂºèËØÜÂà´ÔºàÈúÄË¶ÅpgvectorÊâ©Â±ïÔºâ
DO $$
BEGIN
    BEGIN
        CREATE EXTENSION IF NOT EXISTS vector;
        RAISE NOTICE 'pgvectorÊâ©Â±ïÂ∑≤ÂêØÁî®';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'pgvectorÊâ©Â±ïÂÆâË£ÖÂ§±Ë¥•: %„ÄÇËØ∑Á°Æ‰øùÂ∑≤ÂÆâË£ÖpgvectorÊâ©Â±ï„ÄÇ', SQLERRM;
            RAISE;
    END;
END $$;

-- ÂàõÂª∫ËÆæÂ§áÁä∂ÊÄÅÂêëÈáèË°®
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'equipment_state_vectors') THEN
            RAISE WARNING 'Ë°® equipment_state_vectors Â∑≤Â≠òÂú®ÔºåÂÖàÂà†Èô§';
            DROP TABLE equipment_state_vectors CASCADE;
        END IF;

        -- ÂàõÂª∫ÂåÖÂê´ËÆæÂ§áÁä∂ÊÄÅÂêëÈáèÁöÑË°®
        CREATE TABLE equipment_state_vectors (
            id SERIAL PRIMARY KEY,
            equipment_id INTEGER NOT NULL,
            timestamp TIMESTAMP NOT NULL,
            -- ËÆæÂ§áÁä∂ÊÄÅÁâπÂæÅÂêëÈáèÔºàÂ¶ÇÔºöÊ∏©Â∫¶„ÄÅÊåØÂä®„ÄÅÂéãÂäõÁ≠âÊåáÊ†áÁöÑÂêëÈáèÂåñÔºâ
            state_vector vector(128),
            -- ÊïÖÈöúÊ†áÁ≠æÔºàÂ¶ÇÊûúÊúâÂéÜÂè≤ÊïÖÈöúÊï∞ÊçÆÔºâ
            fault_type TEXT,
            fault_occurred BOOLEAN DEFAULT FALSE,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        );

        -- ÂàõÂª∫ÂêëÈáèÁõ∏‰ººÂ∫¶Á¥¢ÂºïÔºàHNSWÁ¥¢ÂºïÔºåPostgreSQL 18+Ôºâ
        CREATE INDEX idx_equipment_state_vectors_vector
        ON equipment_state_vectors
        USING hnsw (state_vector vector_cosine_ops)
        WITH (m = 16, ef_construction = 64);

        -- ÂàõÂª∫ËÆæÂ§áÂíåÊó∂Èó¥Á¥¢Âºï
        CREATE INDEX idx_equipment_state_vectors_equipment_time
        ON equipment_state_vectors(equipment_id, timestamp DESC);

        RAISE NOTICE 'ËÆæÂ§áÁä∂ÊÄÅÂêëÈáèË°®ÂàõÂª∫ÊàêÂäü';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'ÂàõÂª∫ËÆæÂ§áÁä∂ÊÄÅÂêëÈáèË°®Â§±Ë¥•: %', SQLERRM;
            RAISE;
    END;
END $$;

-- AIÈ¢ÑÊµãÔºöÂü∫‰∫éÂéÜÂè≤ÊïÖÈöúÊ®°ÂºèÈ¢ÑÊµãÂΩìÂâçËÆæÂ§áÊïÖÈöúÈ£éÈô©ÔºàÂ∏¶ÈîôËØØÂ§ÑÁêÜÂíåÊÄßËÉΩÊµãËØïÔºâ
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'equipment_state_vectors') THEN
            RAISE WARNING 'Ë°® equipment_state_vectors ‰∏çÂ≠òÂú®ÔºåÊó†Ê≥ïÊâßË°åAIÈ¢ÑÊµã';
            RETURN;
        END IF;
        RAISE NOTICE 'ÂºÄÂßãÊâßË°åAIÂ¢ûÂº∫È¢ÑÊµã';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'AIÈ¢ÑÊµãÂáÜÂ§áÂ§±Ë¥•: %', SQLERRM;
            RAISE;
    END;
END $$;

WITH current_states AS (
    SELECT
        equipment_id,
        state_vector,
        timestamp
    FROM equipment_state_vectors
    WHERE timestamp >= CURRENT_TIMESTAMP - INTERVAL '1 hour'
),
historical_faults AS (
    SELECT
        equipment_id,
        state_vector,
        fault_type,
        timestamp
    FROM equipment_state_vectors
    WHERE fault_occurred = TRUE
),
similarity_analysis AS (
    SELECT
        cs.equipment_id,
        cs.timestamp AS current_time,
        hf.fault_type,
        hf.timestamp AS fault_time,
        -- ËÆ°ÁÆó‰∏éÂéÜÂè≤ÊïÖÈöúÁä∂ÊÄÅÁöÑÁõ∏‰ººÂ∫¶
        1 - (cs.state_vector <=> hf.state_vector) AS similarity_score,
        -- ËÆ°ÁÆóÊó∂Èó¥Ë∑ùÁ¶ªÔºàË∂äËøëÁöÑÊïÖÈöúË∂äÁõ∏ÂÖ≥Ôºâ
        EXTRACT(EPOCH FROM (cs.timestamp - hf.timestamp)) / 86400 AS days_apart
    FROM current_states cs
    CROSS JOIN historical_faults hf
    WHERE cs.equipment_id = hf.equipment_id
),
risk_assessment AS (
    SELECT
        equipment_id,
        current_time,
        fault_type,
        similarity_score,
        days_apart,
        -- È£éÈô©ÂàÜÊï∞ÔºöÁõ∏‰ººÂ∫¶ * Êó∂Èó¥Ë°∞ÂáèÂõ†Â≠ê
        similarity_score * EXP(-days_apart / 30) AS risk_score
    FROM similarity_analysis
    WHERE similarity_score > 0.7  -- Áõ∏‰ººÂ∫¶ÈòàÂÄº
)
SELECT
    equipment_id,
    current_time,
    fault_type,
    ROUND(similarity_score::numeric, 4) AS similarity,
    ROUND(risk_score::numeric, 4) AS risk_score,
    CASE
        WHEN risk_score > 0.8 THEN 'High Risk'
        WHEN risk_score > 0.6 THEN 'Medium Risk'
        ELSE 'Low Risk'
    END AS risk_level
FROM risk_assessment
ORDER BY risk_score DESC;
```

```sql
-- Âü∫‰∫éÊú∫Âô®Â≠¶‰π†ÁöÑÈ¢ÑÊµãÔºàÊ¶ÇÂøµÊºîÁ§∫ÔºåÂ∏¶ÈîôËØØÂ§ÑÁêÜÔºâ
DO $$
BEGIN
    BEGIN
        RAISE NOTICE 'Âü∫‰∫éÊú∫Âô®Â≠¶‰π†ÁöÑÈ¢ÑÊµãÈúÄË¶ÅÂ§ñÈÉ®Â∑•ÂÖ∑ÊàñËá™ÂÆö‰πâÂáΩÊï∞';
        -- ÂÆûÈôÖÂÆûÁé∞ÈúÄË¶ÅÁâπÂæÅÂ∑•Á®ãÂíåÊú∫Âô®Â≠¶‰π†Ê®°Âûã
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'Êú∫Âô®Â≠¶‰π†È¢ÑÊµãÂáÜÂ§áÂ§±Ë¥•: %', SQLERRM;
            RAISE;
    END;
END $$;

-- ÁâπÂæÅÂ∑•Á®ãÔºöÊèêÂèñÈ¢ÑÊµãÁâπÂæÅ
WITH feature_engineering AS (
    SELECT
        equipment_id,
        timestamp,
        temperature,
        vibration,
        pressure,
        power_consumption,
        -- ÁâπÂæÅ1ÔºöÊ∏©Â∫¶Ë∂ãÂäø
        AVG(temperature) OVER (
            PARTITION BY equipment_id
            ORDER BY timestamp
            ROWS BETWEEN 9 PRECEDING AND CURRENT ROW
        ) AS temp_trend,
        -- ÁâπÂæÅ2ÔºöÊåØÂä®ÂèòÂåñÁéá
        ABS(vibration - LAG(vibration) OVER (PARTITION BY equipment_id ORDER BY timestamp)) AS vib_change_rate,
        -- ÁâπÂæÅ3ÔºöÂéãÂäõÁ®≥ÂÆöÊÄß
        STDDEV(pressure) OVER (
            PARTITION BY equipment_id
            ORDER BY timestamp
            ROWS BETWEEN 9 PRECEDING AND CURRENT ROW
        ) AS pressure_stability
    FROM equipment_metrics
)
SELECT
    equipment_id,
    timestamp,
    ROUND(temp_trend::numeric, 2) AS temp_trend,
    ROUND(vib_change_rate::numeric, 2) AS vib_change_rate,
    ROUND(pressure_stability::numeric, 2) AS pressure_stability,
    -- ÁÆÄÂåñÁöÑÊïÖÈöúÊ¶ÇÁéáÔºàÂü∫‰∫éÁâπÂæÅÔºâ
    CASE
        WHEN temp_trend > 50 AND vib_change_rate > 1.0 THEN 0.8
        WHEN temp_trend > 45 OR vib_change_rate > 0.5 THEN 0.5
        ELSE 0.2
    END AS failure_probability
FROM feature_engineering
WHERE temp_trend IS NOT NULL
ORDER BY equipment_id, timestamp;
```

---

## 3. Áª¥Êä§Âª∫ËÆÆ

### 3.1 Áª¥Êä§Âª∫ËÆÆÂéüÁêÜ

**Áª¥Êä§Âª∫ËÆÆÔºàMaintenance RecommendationsÔºâ**Ê†πÊçÆËÆæÂ§áÁä∂ÊÄÅÂíåÈ£éÈô©Á°ÆÂÆöÁª¥Êä§È°∫Â∫è„ÄÇ

#### Áª¥Êä§Âª∫ËÆÆÂÆö‰πâ

**Áª¥Êä§Âª∫ËÆÆ**ÔºöÂü∫‰∫éÂÅ•Â∫∑Â∫¶ÂíåÊïÖÈöúÈ¢ÑÊµãÁîüÊàêÁª¥Êä§Âª∫ËÆÆÔºö
$$A = g(H, P_f, C)$$

ÂÖ∂‰∏≠$H$ÊòØÂÅ•Â∫∑Â∫¶Ôºå$P_f$ÊòØÊïÖÈöúÊ¶ÇÁéáÔºå$C$ÊòØÁª¥Êä§ÊàêÊú¨„ÄÇ

#### ‰ºòÂÖàÁ∫ßËÆ°ÁÆó

**‰ºòÂÖàÁ∫ßËÆ°ÁÆó**Ôºö
$$\text{Priority} = w_1 \cdot (1 - H) + w_2 \cdot P_f + w_3 \cdot C$$

### 3.2 Áª¥Êä§‰ºòÂÖàÁ∫ßÂÆûÁé∞

**Áª¥Êä§‰ºòÂÖàÁ∫ß**ÁöÑÂÆûÁé∞Âíå‰ΩøÁî®„ÄÇ

```sql
-- Áª¥Êä§‰ºòÂÖàÁ∫ßËÆ°ÁÆóÔºàÂ∏¶ÈîôËØØÂ§ÑÁêÜÂíåÊÄßËÉΩÊµãËØïÔºâ
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'equipment_metrics') THEN
            RAISE WARNING 'Ë°® equipment_metrics ‰∏çÂ≠òÂú®ÔºåÊó†Ê≥ïËÆ°ÁÆóÁª¥Êä§‰ºòÂÖàÁ∫ß';
            RETURN;
        END IF;
        RAISE NOTICE 'ÂºÄÂßãËÆ°ÁÆóÁª¥Êä§‰ºòÂÖàÁ∫ß';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'Áª¥Êä§‰ºòÂÖàÁ∫ßËÆ°ÁÆóÂáÜÂ§áÂ§±Ë¥•: %', SQLERRM;
            RAISE;
    END;
END $$;

-- ËÆ°ÁÆóÁª¥Êä§‰ºòÂÖàÁ∫ß
WITH equipment_status AS (
    SELECT DISTINCT ON (equipment_id)
        equipment_id,
        timestamp,
        temperature,
        vibration,
        pressure,
        power_consumption
    FROM equipment_metrics
    ORDER BY equipment_id, timestamp DESC
),
health_scores AS (
    SELECT
        equipment_id,
        timestamp,
        CASE
            WHEN temperature > 50 THEN 0
            WHEN temperature < 40 THEN 50
            ELSE 100 - ((temperature - 40) / 10 * 50)
        END AS temp_score,
        CASE
            WHEN vibration > 3 THEN 0
            WHEN vibration < 1 THEN 50
            ELSE 100 - ((vibration - 1) / 2 * 50)
        END AS vib_score
    FROM equipment_status
),
maintenance_priority AS (
    SELECT
        es.equipment_id,
        es.timestamp AS last_check,
        ROUND((hs.temp_score + hs.vib_score) / 2::numeric, 2) AS health_score,
        CASE
            WHEN (hs.temp_score + hs.vib_score) / 2 < 50 THEN 'Immediate'
            WHEN (hs.temp_score + hs.vib_score) / 2 < 70 THEN 'High'
            WHEN (hs.temp_score + hs.vib_score) / 2 < 85 THEN 'Medium'
            ELSE 'Low'
        END AS priority,
        CASE
            WHEN (hs.temp_score + hs.vib_score) / 2 < 50 THEN 1
            WHEN (hs.temp_score + hs.vib_score) / 2 < 70 THEN 2
            WHEN (hs.temp_score + hs.vib_score) / 2 < 85 THEN 3
            ELSE 4
        END AS priority_order
    FROM equipment_status es
    JOIN health_scores hs ON es.equipment_id = hs.equipment_id
)
SELECT
    equipment_id,
    last_check,
    health_score,
    priority,
    CASE priority
        WHEN 'Immediate' THEN 'Schedule maintenance within 24 hours'
        WHEN 'High' THEN 'Schedule maintenance within 1 week'
        WHEN 'Medium' THEN 'Schedule maintenance within 1 month'
        ELSE 'Routine check recommended'
    END AS maintenance_recommendation
FROM maintenance_priority
ORDER BY priority_order, health_score ASC;

-- ÊÄßËÉΩÊµãËØï
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT DISTINCT ON (equipment_id)
    equipment_id,
    timestamp
FROM equipment_metrics
ORDER BY equipment_id, timestamp DESC;
```

---

### 3.3 Áª¥Êä§ËÆ°Âàí‰ºòÂåñ

**Áª¥Êä§ËÆ°Âàí‰ºòÂåñ**Ôºö‰ºòÂåñÁª¥Êä§ËÆ°ÂàíÂíåÊó∂Èó¥ÂÆâÊéí„ÄÇ

```sql
-- Áª¥Êä§ËÆ°Âàí‰ºòÂåñÔºàÂ∏¶ÈîôËØØÂ§ÑÁêÜÂíåÊÄßËÉΩÊµãËØïÔºâ
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'equipment_metrics') THEN
            RAISE WARNING 'Ë°® equipment_metrics ‰∏çÂ≠òÂú®ÔºåÊó†Ê≥ï‰ºòÂåñÁª¥Êä§ËÆ°Âàí';
            RETURN;
        END IF;
        RAISE NOTICE 'ÂºÄÂßã‰ºòÂåñÁª¥Êä§ËÆ°Âàí';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'Áª¥Êä§ËÆ°Âàí‰ºòÂåñÂáÜÂ§áÂ§±Ë¥•: %', SQLERRM;
            RAISE;
    END;
END $$;

-- Áª¥Êä§ËÆ°Âàí‰ºòÂåñÔºöËÄÉËôëÁª¥Êä§Á™óÂè£ÂíåËµÑÊ∫êÁ∫¶Êùü
WITH equipment_priority AS (
    SELECT
        equipment_id,
        timestamp,
        temperature,
        vibration,
        CASE
            WHEN temperature > 50 OR vibration > 3 THEN 1  -- Immediate
            WHEN temperature > 45 OR vibration > 2.5 THEN 2  -- High
            WHEN temperature > 40 OR vibration > 2 THEN 3    -- Medium
            ELSE 4  -- Low
        END AS priority_order,
        CASE
            WHEN temperature > 50 OR vibration > 3 THEN 'Immediate'
            WHEN temperature > 45 OR vibration > 2.5 THEN 'High'
            WHEN temperature > 40 OR vibration > 2 THEN 'Medium'
            ELSE 'Low'
        END AS priority_level
    FROM equipment_metrics
    WHERE timestamp >= NOW() - INTERVAL '1 day'
),
maintenance_schedule AS (
    SELECT DISTINCT ON (equipment_id)
        equipment_id,
        priority_order,
        priority_level,
        CASE priority_order
            WHEN 1 THEN NOW() + INTERVAL '24 hours'
            WHEN 2 THEN NOW() + INTERVAL '7 days'
            WHEN 3 THEN NOW() + INTERVAL '30 days'
            ELSE NOW() + INTERVAL '90 days'
        END AS recommended_date,
        CASE priority_order
            WHEN 1 THEN 'Schedule immediately'
            WHEN 2 THEN 'Schedule within 1 week'
            WHEN 3 THEN 'Schedule within 1 month'
            ELSE 'Routine check recommended'
        END AS maintenance_recommendation
    FROM equipment_priority
    ORDER BY equipment_id, priority_order ASC, timestamp DESC
)
SELECT
    equipment_id,
    priority_level,
    recommended_date,
    maintenance_recommendation
FROM maintenance_schedule
WHERE priority_order <= 3
ORDER BY priority_order, equipment_id;
```

---

## 4. È¢ÑÊµãÊÄßÁª¥Êä§‰ºòÂåñÁ≠ñÁï•

### 4.1 Á¥¢Âºï‰ºòÂåñ

**Á¥¢Âºï‰ºòÂåñ**Ôºö‰∏∫È¢ÑÊµãÊÄßÁª¥Êä§Êü•ËØ¢ÂàõÂª∫ÂêàÈÄÇÁöÑÁ¥¢Âºï„ÄÇ

```sql
-- Á¥¢Âºï‰ºòÂåñÔºàÂ∏¶ÈîôËØØÂ§ÑÁêÜÔºâ
DO $$
BEGIN
    BEGIN
        -- ËÆæÂ§áÊåáÊ†áË°®Á¥¢Âºï
        CREATE INDEX IF NOT EXISTS idx_equipment_metrics_timestamp_equipment
        ON equipment_metrics(timestamp, equipment_id);

        CREATE INDEX IF NOT EXISTS idx_equipment_metrics_equipment_timestamp
        ON equipment_metrics(equipment_id, timestamp);

        RAISE NOTICE 'È¢ÑÊµãÊÄßÁª¥Êä§Á¥¢ÂºïÂàõÂª∫ÊàêÂäü';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'Á¥¢ÂºïÂàõÂª∫Â§±Ë¥•: %', SQLERRM;
            RAISE;
    END;
END $$;
```

### 4.2 ÂÅ•Â∫∑Â∫¶ËÆ°ÁÆó‰ºòÂåñ

**ÂÅ•Â∫∑Â∫¶ËÆ°ÁÆó‰ºòÂåñ**Ôºö‰ΩøÁî®Áâ©ÂåñËßÜÂõæÁºìÂ≠òÂÅ•Â∫∑Â∫¶„ÄÇ

```sql
-- ÂÅ•Â∫∑Â∫¶ËÆ°ÁÆó‰ºòÂåñÔºö‰ΩøÁî®Áâ©ÂåñËßÜÂõæÁºìÂ≠òÂÅ•Â∫∑Â∫¶
CREATE MATERIALIZED VIEW IF NOT EXISTS equipment_health_cache AS
SELECT DISTINCT ON (equipment_id)
    equipment_id,
    timestamp,
    temperature,
    vibration,
    pressure,
    power_consumption,
    CASE
        WHEN temperature > 50 THEN 0
        WHEN temperature < 40 THEN 50
        ELSE 100 - ((temperature - 40) / 10 * 50)
    END AS temp_score,
    CASE
        WHEN vibration > 3 THEN 0
        WHEN vibration < 1 THEN 50
        ELSE 100 - ((vibration - 1) / 2 * 50)
    END AS vib_score
FROM equipment_metrics
ORDER BY equipment_id, timestamp DESC;

CREATE INDEX IF NOT EXISTS idx_equipment_health_cache_equipment
ON equipment_health_cache(equipment_id);

-- Âà∑Êñ∞Áâ©ÂåñËßÜÂõæ
REFRESH MATERIALIZED VIEW CONCURRENTLY equipment_health_cache;
```

### 4.3 ÊâπÈáèÈ¢ÑÊµã‰ºòÂåñ

**ÊâπÈáèÈ¢ÑÊµã‰ºòÂåñ**ÔºöÊâπÈáèÈ¢ÑÊµãÂ§ö‰∏™ËÆæÂ§á„ÄÇ

```sql
-- ÊâπÈáèÈ¢ÑÊµã‰ºòÂåñÔºàÂ∏¶ÈîôËØØÂ§ÑÁêÜÔºâ
DO $$
BEGIN
    BEGIN
        SET work_mem = '512MB';
        SET max_parallel_workers_per_gather = 4;
        RAISE NOTICE 'ÊâπÈáèÈ¢ÑÊµã‰ºòÂåñÈÖçÁΩÆÂ∑≤ËÆæÁΩÆ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'ÊâπÈáèÈ¢ÑÊµã‰ºòÂåñÂ§±Ë¥•: %', SQLERRM;
            RAISE;
    END;
END $$;
```

---

## 5. ÂÆûÈôÖÂ∫îÁî®Ê°à‰æã

### 5.1 ÊúçÂä°Âô®È¢ÑÊµãÊÄßÁª¥Êä§

**ÊúçÂä°Âô®È¢ÑÊµãÊÄßÁª¥Êä§**ÁõëÊéßÊúçÂä°Âô®ÂÅ•Â∫∑Áä∂ÊÄÅÂπ∂È¢ÑÊµãÊïÖÈöú„ÄÇ

```sql
-- ÊúçÂä°Âô®È¢ÑÊµãÊÄßÁª¥Êä§Á§∫‰æãÔºàÂ∏¶ÈîôËØØÂ§ÑÁêÜÂíåÊÄßËÉΩÊµãËØïÔºâ
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'server_metrics') THEN
            RAISE WARNING 'Ë°® server_metrics ‰∏çÂ≠òÂú®ÔºåÂàõÂª∫Á§∫‰æãË°®';

            CREATE TABLE server_metrics (
                timestamp TIMESTAMP NOT NULL,
                server_id VARCHAR(50) NOT NULL,
                cpu_usage NUMERIC(5, 2),
                memory_usage NUMERIC(5, 2),
                disk_io_wait NUMERIC(5, 2),
                disk_usage NUMERIC(5, 2),
                error_count INTEGER,
                PRIMARY KEY (timestamp, server_id)
            );

            INSERT INTO server_metrics (timestamp, server_id, cpu_usage, memory_usage, disk_io_wait, disk_usage, error_count) VALUES
                ('2024-01-01 10:00:00', 'SRV001', 45.5, 65.2, 5.2, 75.0, 0),
                ('2024-01-01 10:01:00', 'SRV001', 48.2, 67.8, 6.5, 75.5, 2),
                ('2024-01-01 10:02:00', 'SRV001', 52.3, 70.1, 8.1, 76.0, 5);

            RAISE NOTICE 'Ë°® server_metrics ÂàõÂª∫ÊàêÂäü';
        END IF;
        RAISE NOTICE 'ÂºÄÂßãÊâßË°åÊúçÂä°Âô®È¢ÑÊµãÊÄßÁª¥Êä§ÂàÜÊûê';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'ÊúçÂä°Âô®È¢ÑÊµãÊÄßÁª¥Êä§ÂáÜÂ§áÂ§±Ë¥•: %', SQLERRM;
            RAISE;
    END;
END $$;

-- ÊúçÂä°Âô®ÂÅ•Â∫∑Â∫¶ËØÑ‰º∞ÂíåÈ¢ÑÊµã
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
WITH server_trends AS (
    SELECT
        server_id,
        timestamp,
        cpu_usage,
        memory_usage,
        disk_io_wait,
        disk_usage,
        error_count,
        AVG(cpu_usage) OVER (PARTITION BY server_id ORDER BY timestamp ROWS BETWEEN 9 PRECEDING AND CURRENT ROW) AS avg_cpu,
        AVG(memory_usage) OVER (PARTITION BY server_id ORDER BY timestamp ROWS BETWEEN 9 PRECEDING AND CURRENT ROW) AS avg_memory,
        AVG(disk_io_wait) OVER (PARTITION BY server_id ORDER BY timestamp ROWS BETWEEN 9 PRECEDING AND CURRENT ROW) AS avg_io_wait
    FROM server_metrics
),
health_assessment AS (
    SELECT
        server_id,
        timestamp,
        cpu_usage,
        memory_usage,
        disk_usage,
        error_count,
        avg_cpu,
        avg_memory,
        avg_io_wait,
        CASE
            WHEN cpu_usage > 90 OR memory_usage > 95 OR disk_usage > 90 OR error_count > 10 THEN 'Critical'
            WHEN cpu_usage > 80 OR memory_usage > 85 OR disk_usage > 80 OR error_count > 5 THEN 'Warning'
            ELSE 'Normal'
        END AS current_status,
        CASE
            WHEN avg_cpu > 85 OR avg_memory > 90 OR avg_io_wait > 15 THEN 'High Risk'
            WHEN avg_cpu > 75 OR avg_memory > 80 OR avg_io_wait > 10 THEN 'Medium Risk'
            ELSE 'Low Risk'
        END AS failure_risk
    FROM server_trends
    WHERE avg_cpu IS NOT NULL
)
SELECT
    server_id,
    timestamp,
    ROUND(cpu_usage::numeric, 2) AS cpu_usage,
    ROUND(memory_usage::numeric, 2) AS memory_usage,
    ROUND(disk_usage::numeric, 2) AS disk_usage,
    error_count,
    current_status,
    failure_risk,
    CASE
        WHEN current_status = 'Critical' THEN 'Immediate maintenance required'
        WHEN failure_risk = 'High Risk' THEN 'Schedule maintenance within 48 hours'
        WHEN failure_risk = 'Medium Risk' THEN 'Schedule maintenance within 1 week'
        ELSE 'Monitor closely'
    END AS maintenance_action
FROM health_assessment
WHERE current_status != 'Normal' OR failure_risk != 'Low Risk'
ORDER BY
    CASE current_status WHEN 'Critical' THEN 1 WHEN 'Warning' THEN 2 ELSE 3 END,
    CASE failure_risk WHEN 'High Risk' THEN 1 WHEN 'Medium Risk' THEN 2 ELSE 3 END;
```

### 5.2 Êï∞ÊçÆÂ∫ìÈ¢ÑÊµãÊÄßÁª¥Êä§

**Êï∞ÊçÆÂ∫ìÈ¢ÑÊµãÊÄßÁª¥Êä§**ÔºöÈ¢ÑÊµãÊï∞ÊçÆÂ∫ìÊïÖÈöúÂíåÁª¥Êä§ÈúÄÊ±Ç„ÄÇ

```sql
-- Êï∞ÊçÆÂ∫ìÈ¢ÑÊµãÊÄßÁª¥Êä§ÔºàÂ∏¶ÈîôËØØÂ§ÑÁêÜÂíåÊÄßËÉΩÊµãËØïÔºâ
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'database_health') THEN
            RAISE WARNING 'Ë°® database_health ‰∏çÂ≠òÂú®ÔºåÂàõÂª∫Á§∫‰æãË°®';

            CREATE TABLE database_health (
                timestamp TIMESTAMP NOT NULL,
                database_name VARCHAR(100) NOT NULL,
                connection_count INTEGER,
                query_count BIGINT,
                slow_query_count INTEGER,
                lock_wait_count INTEGER,
                deadlock_count INTEGER,
                PRIMARY KEY (timestamp, database_name)
            );

            INSERT INTO database_health (timestamp, database_name, connection_count, query_count, slow_query_count, lock_wait_count, deadlock_count) VALUES
                ('2024-01-01 10:00:00', 'db_prod', 50, 1000000, 10, 5, 0),
                ('2024-01-01 11:00:00', 'db_prod', 55, 1050000, 15, 8, 1),
                ('2024-01-01 12:00:00', 'db_prod', 60, 1100000, 25, 15, 2);

            RAISE NOTICE 'Ë°® database_health ÂàõÂª∫ÊàêÂäü';
        END IF;

        RAISE NOTICE 'ÂºÄÂßãÊâßË°åÊï∞ÊçÆÂ∫ìÈ¢ÑÊµãÊÄßÁª¥Êä§';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'Êï∞ÊçÆÂ∫ìÈ¢ÑÊµãÊÄßÁª¥Êä§ÂáÜÂ§áÂ§±Ë¥•: %', SQLERRM;
            RAISE;
    END;
END $$;

-- Êï∞ÊçÆÂ∫ìÈ¢ÑÊµãÊÄßÁª¥Êä§ÔºöËØÑ‰º∞Êï∞ÊçÆÂ∫ìÂÅ•Â∫∑Â∫¶
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
WITH database_trends AS (
    SELECT
        database_name,
        timestamp,
        connection_count,
        query_count,
        slow_query_count,
        lock_wait_count,
        deadlock_count,
        AVG(connection_count) OVER (
            PARTITION BY database_name
            ORDER BY timestamp
            ROWS BETWEEN 9 PRECEDING AND CURRENT ROW
        ) AS avg_connections,
        AVG(slow_query_count) OVER (
            PARTITION BY database_name
            ORDER BY timestamp
            ROWS BETWEEN 9 PRECEDING AND CURRENT ROW
        ) AS avg_slow_queries,
        AVG(lock_wait_count) OVER (
            PARTITION BY database_name
            ORDER BY timestamp
            ROWS BETWEEN 9 PRECEDING AND CURRENT ROW
        ) AS avg_lock_waits
    FROM database_health
),
health_scores AS (
    SELECT
        database_name,
        timestamp,
        connection_count,
        slow_query_count,
        lock_wait_count,
        deadlock_count,
        avg_connections,
        avg_slow_queries,
        avg_lock_waits,
        -- ËøûÊé•ÂÅ•Â∫∑Â∫¶
        CASE
            WHEN connection_count > 100 THEN 0
            WHEN connection_count < 20 THEN 50
            ELSE 100 - ((connection_count - 20) / 80 * 50)
        END AS connection_score,
        -- Êü•ËØ¢ÂÅ•Â∫∑Â∫¶
        CASE
            WHEN slow_query_count > 50 THEN 0
            WHEN slow_query_count < 5 THEN 100
            ELSE 100 - ((slow_query_count - 5) / 45 * 100)
        END AS query_score,
        -- ÈîÅÂÅ•Â∫∑Â∫¶
        CASE
            WHEN lock_wait_count > 20 THEN 0
            WHEN lock_wait_count < 2 THEN 100
            ELSE 100 - ((lock_wait_count - 2) / 18 * 100)
        END AS lock_score
    FROM database_trends
    WHERE avg_connections IS NOT NULL
),
overall_health AS (
    SELECT
        database_name,
        timestamp,
        connection_count,
        slow_query_count,
        lock_wait_count,
        deadlock_count,
        connection_score,
        query_score,
        lock_score,
        (connection_score * 0.3 + query_score * 0.4 + lock_score * 0.3) AS overall_health_score,
        CASE
            WHEN deadlock_count > 0 THEN 'Critical'
            WHEN avg_slow_queries > 30 OR avg_lock_waits > 15 THEN 'High Risk'
            WHEN avg_slow_queries > 20 OR avg_lock_waits > 10 THEN 'Medium Risk'
            ELSE 'Low Risk'
        END AS failure_risk
    FROM health_scores
    JOIN database_trends USING (database_name, timestamp)
)
SELECT
    database_name,
    timestamp,
    connection_count,
    slow_query_count,
    lock_wait_count,
    deadlock_count,
    ROUND(overall_health_score::numeric, 2) AS health_score,
    failure_risk,
    CASE
        WHEN deadlock_count > 0 THEN 'Immediate investigation required'
        WHEN failure_risk = 'High Risk' THEN 'Schedule maintenance within 48 hours'
        WHEN failure_risk = 'Medium Risk' THEN 'Schedule maintenance within 1 week'
        ELSE 'Monitor closely'
    END AS maintenance_action
FROM overall_health
WHERE overall_health_score < 70 OR failure_risk != 'Low Risk'
ORDER BY overall_health_score ASC, timestamp DESC;
```

### 5.3 ÁΩëÁªúËÆæÂ§áÈ¢ÑÊµãÊÄßÁª¥Êä§

**ÁΩëÁªúËÆæÂ§áÈ¢ÑÊµãÊÄßÁª¥Êä§**ÔºöÈ¢ÑÊµãÁΩëÁªúËÆæÂ§áÊïÖÈöú„ÄÇ

```sql
-- ÁΩëÁªúËÆæÂ§áÈ¢ÑÊµãÊÄßÁª¥Êä§ÔºàÂ∏¶ÈîôËØØÂ§ÑÁêÜÂíåÊÄßËÉΩÊµãËØïÔºâ
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'network_device_metrics') THEN
            RAISE WARNING 'Ë°® network_device_metrics ‰∏çÂ≠òÂú®ÔºåÂàõÂª∫Á§∫‰æãË°®';

            CREATE TABLE network_device_metrics (
                timestamp TIMESTAMP NOT NULL,
                device_id VARCHAR(50) NOT NULL,
                cpu_usage NUMERIC(5, 2),
                memory_usage NUMERIC(5, 2),
                packet_loss_rate NUMERIC(5, 2),
                error_rate NUMERIC(5, 2),
                PRIMARY KEY (timestamp, device_id)
            );

            INSERT INTO network_device_metrics (timestamp, device_id, cpu_usage, memory_usage, packet_loss_rate, error_rate) VALUES
                ('2024-01-01 10:00:00', 'SW001', 30.5, 45.2, 0.1, 0.05),
                ('2024-01-01 11:00:00', 'SW001', 32.2, 47.8, 0.2, 0.08),
                ('2024-01-01 12:00:00', 'SW001', 35.5, 50.1, 0.5, 0.15);

            RAISE NOTICE 'Ë°® network_device_metrics ÂàõÂª∫ÊàêÂäü';
        END IF;

        RAISE NOTICE 'ÂºÄÂßãÊâßË°åÁΩëÁªúËÆæÂ§áÈ¢ÑÊµãÊÄßÁª¥Êä§';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'ÁΩëÁªúËÆæÂ§áÈ¢ÑÊµãÊÄßÁª¥Êä§ÂáÜÂ§áÂ§±Ë¥•: %', SQLERRM;
            RAISE;
    END;
END $$;

-- ÁΩëÁªúËÆæÂ§áÈ¢ÑÊµãÊÄßÁª¥Êä§ÔºöËØÑ‰º∞ÁΩëÁªúËÆæÂ§áÂÅ•Â∫∑Â∫¶
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
WITH device_trends AS (
    SELECT
        device_id,
        timestamp,
        cpu_usage,
        memory_usage,
        packet_loss_rate,
        error_rate,
        AVG(cpu_usage) OVER (
            PARTITION BY device_id
            ORDER BY timestamp
            ROWS BETWEEN 9 PRECEDING AND CURRENT ROW
        ) AS avg_cpu,
        AVG(packet_loss_rate) OVER (
            PARTITION BY device_id
            ORDER BY timestamp
            ROWS BETWEEN 9 PRECEDING AND CURRENT ROW
        ) AS avg_packet_loss,
        AVG(error_rate) OVER (
            PARTITION BY device_id
            ORDER BY timestamp
            ROWS BETWEEN 9 PRECEDING AND CURRENT ROW
        ) AS avg_error_rate
    FROM network_device_metrics
),
health_assessment AS (
    SELECT
        device_id,
        timestamp,
        cpu_usage,
        memory_usage,
        packet_loss_rate,
        error_rate,
        avg_cpu,
        avg_packet_loss,
        avg_error_rate,
        CASE
            WHEN packet_loss_rate > 1.0 OR error_rate > 0.5 THEN 'Critical'
            WHEN packet_loss_rate > 0.5 OR error_rate > 0.2 THEN 'Warning'
            ELSE 'Normal'
        END AS current_status,
        CASE
            WHEN avg_packet_loss > 0.8 OR avg_error_rate > 0.4 THEN 'High Risk'
            WHEN avg_packet_loss > 0.3 OR avg_error_rate > 0.15 THEN 'Medium Risk'
            ELSE 'Low Risk'
        END AS failure_risk
    FROM device_trends
    WHERE avg_cpu IS NOT NULL
)
SELECT
    device_id,
    timestamp,
    ROUND(cpu_usage::numeric, 2) AS cpu_usage,
    ROUND(memory_usage::numeric, 2) AS memory_usage,
    ROUND(packet_loss_rate::numeric, 2) AS packet_loss_rate,
    ROUND(error_rate::numeric, 2) AS error_rate,
    current_status,
    failure_risk,
    CASE
        WHEN current_status = 'Critical' THEN 'Immediate maintenance required'
        WHEN failure_risk = 'High Risk' THEN 'Schedule maintenance within 48 hours'
        WHEN failure_risk = 'Medium Risk' THEN 'Schedule maintenance within 1 week'
        ELSE 'Monitor closely'
    END AS maintenance_action
FROM health_assessment
WHERE current_status != 'Normal' OR failure_risk != 'Low Risk'
ORDER BY
    CASE current_status WHEN 'Critical' THEN 1 WHEN 'Warning' THEN 2 ELSE 3 END,
    CASE failure_risk WHEN 'High Risk' THEN 1 WHEN 'Medium Risk' THEN 2 ELSE 3 END;
```

### 5.4 ÁªºÂêàÈ¢ÑÊµãÊÄßÁª¥Êä§Á≥ªÁªü

**ÁªºÂêàÈ¢ÑÊµãÊÄßÁª¥Êä§Á≥ªÁªü**ÔºöÁªºÂêàÂ§öÁßçËÆæÂ§áÁöÑÈ¢ÑÊµãÊÄßÁª¥Êä§„ÄÇ

```sql
-- ÁªºÂêàÈ¢ÑÊµãÊÄßÁª¥Êä§Á≥ªÁªüÔºàÂ∏¶ÈîôËØØÂ§ÑÁêÜÂíåÊÄßËÉΩÊµãËØïÔºâ
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'equipment_metrics') THEN
            RAISE WARNING 'Ë°® equipment_metrics ‰∏çÂ≠òÂú®ÔºåÊó†Ê≥ïÊâßË°åÁªºÂêàÈ¢ÑÊµãÊÄßÁª¥Êä§';
            RETURN;
        END IF;
        RAISE NOTICE 'ÂºÄÂßãÊâßË°åÁªºÂêàÈ¢ÑÊµãÊÄßÁª¥Êä§Á≥ªÁªü';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'ÁªºÂêàÈ¢ÑÊµãÊÄßÁª¥Êä§Á≥ªÁªüÂáÜÂ§áÂ§±Ë¥•: %', SQLERRM;
            RAISE;
    END;
END $$;

-- ÁªºÂêàÈ¢ÑÊµãÊÄßÁª¥Êä§Á≥ªÁªüÔºöÁªü‰∏ÄËØÑ‰º∞ÊâÄÊúâËÆæÂ§á
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
WITH equipment_health AS (
    SELECT DISTINCT ON (equipment_id)
        equipment_id,
        timestamp,
        temperature,
        vibration,
        pressure,
        power_consumption,
        CASE
            WHEN temperature > 50 THEN 0
            WHEN temperature < 40 THEN 50
            ELSE 100 - ((temperature - 40) / 10 * 50)
        END AS temp_score,
        CASE
            WHEN vibration > 3 THEN 0
            WHEN vibration < 1 THEN 50
            ELSE 100 - ((vibration - 1) / 2 * 50)
        END AS vib_score
    FROM equipment_metrics
    ORDER BY equipment_id, timestamp DESC
),
health_summary AS (
    SELECT
        equipment_id,
        timestamp,
        (temp_score + vib_score) / 2 AS health_score,
        CASE
            WHEN (temp_score + vib_score) / 2 < 50 THEN 'Critical'
            WHEN (temp_score + vib_score) / 2 < 70 THEN 'Warning'
            WHEN (temp_score + vib_score) / 2 < 85 THEN 'Degraded'
            ELSE 'Healthy'
        END AS health_status,
        CASE
            WHEN (temp_score + vib_score) / 2 < 50 THEN 1
            WHEN (temp_score + vib_score) / 2 < 70 THEN 2
            WHEN (temp_score + vib_score) / 2 < 85 THEN 3
            ELSE 4
        END AS priority_order
    FROM equipment_health
)
SELECT
    equipment_id,
    timestamp,
    ROUND(health_score::numeric, 2) AS health_score,
    health_status,
    CASE priority_order
        WHEN 1 THEN NOW() + INTERVAL '24 hours'
        WHEN 2 THEN NOW() + INTERVAL '7 days'
        WHEN 3 THEN NOW() + INTERVAL '30 days'
        ELSE NOW() + INTERVAL '90 days'
    END AS recommended_maintenance_date,
    CASE priority_order
        WHEN 1 THEN 'Immediate maintenance required'
        WHEN 2 THEN 'Schedule maintenance within 1 week'
        WHEN 3 THEN 'Schedule maintenance within 1 month'
        ELSE 'Routine check recommended'
    END AS maintenance_recommendation
FROM health_summary
ORDER BY priority_order, health_score ASC;
```

---

## 6. ÁÆóÊ≥ïÊÄßËÉΩÂØπÊØî‰∏é‰ºòÂåñ

### 6.1 È¢ÑÊµãÊñπÊ≥ïÂØπÊØî

| ÊñπÊ≥ï | Êï∞Â≠¶ÂÆö‰πâ | Êó∂Èó¥Â§çÊùÇÂ∫¶ | Á©∫Èó¥Â§çÊùÇÂ∫¶ | ÈÄÇÁî®Âú∫ÊôØ | ‰ºòÁÇπ | Áº∫ÁÇπ |
|------|---------|-----------|-----------|---------|------|------|
| **ÂÅ•Â∫∑Â∫¶ËØÑÂàÜ** | $H = \sum_{i=1}^{n} w_i \cdot S_i$ | $O(n)$ | $O(1)$ | Â§öÊåáÊ†áËØÑ‰º∞ | ÁÆÄÂçï„ÄÅÁõ¥ËßÇ | ÈúÄË¶ÅÊùÉÈáçËÆæÁΩÆ |
| **Ë∂ãÂäøÈ¢ÑÊµã** | $T_f = f(\text{trend}(M))$ | $O(n)$ | $O(1)$ | Ë∂ãÂäøÈ¢ÑÊµã | ËÄÉËôëÊó∂Èó¥ÊÄß | ÂÅáËÆæË∂ãÂäøÂª∂Áª≠ |
| **ÂºÇÂ∏∏È¢ÑÊµã** | $T_f = f(\text{anomaly}(M))$ | $O(n)$ | $O(1)$ | ÂºÇÂ∏∏È¢ÑÊµã | Âø´ÈÄü | ÂèØËÉΩËØØÊä• |

### 6.2 ÊÄßËÉΩ‰ºòÂåñÂª∫ËÆÆ

1. **Á¥¢Âºï‰ºòÂåñ**Ôºö
   - Âú®(timestamp, equipment_id)‰∏äÂàõÂª∫Â§çÂêàÁ¥¢Âºï
   - ‰∏∫Â∏∏Áî®Êü•ËØ¢ÂàõÂª∫Á¥¢Âºï

2. **ÂÅ•Â∫∑Â∫¶ËÆ°ÁÆó‰ºòÂåñ**Ôºö
   - ‰ΩøÁî®Áâ©ÂåñËßÜÂõæÁºìÂ≠òÂÅ•Â∫∑Â∫¶
   - ÊâπÈáèËÆ°ÁÆóÂ§ö‰∏™ËÆæÂ§á

3. **È¢ÑÊµã‰ºòÂåñ**Ôºö
   - ‰ΩøÁî®Áâ©ÂåñËßÜÂõæÁºìÂ≠òÈ¢ÑÊµãÁªìÊûú
   - ÂÆöÊúüÊõ¥Êñ∞È¢ÑÊµãÊ®°Âûã

### 6.3 Â∏∏ËßÅÈóÆÈ¢ò‰∏éËß£ÂÜ≥ÊñπÊ°à

**ÈóÆÈ¢ò1**ÔºöÈ¢ÑÊµãÁ≤æÂ∫¶‰Ωé

- **Ëß£ÂÜ≥ÊñπÊ°à**ÔºöÂ¢ûÂä†ÂéÜÂè≤Êï∞ÊçÆ„ÄÅ‰ΩøÁî®Êõ¥Â§çÊùÇÊ®°Âûã„ÄÅÂ§öÊåáÊ†áÁªºÂêà

**ÈóÆÈ¢ò2**ÔºöËØØÊä•ÁéáÈ´ò

- **Ëß£ÂÜ≥ÊñπÊ°à**ÔºöË∞ÉÊï¥ÈòàÂÄº„ÄÅ‰ΩøÁî®ÁßªÂä®Âπ≥Âùá„ÄÅÊ∑ªÂä†ËøáÊª§Êù°‰ª∂

**ÈóÆÈ¢ò3**ÔºöËÆ°ÁÆóÊÄßËÉΩÊÖ¢

- **Ëß£ÂÜ≥ÊñπÊ°à**Ôºö‰ΩøÁî®Áâ©ÂåñËßÜÂõæ„ÄÅÁ¥¢Âºï‰ºòÂåñ„ÄÅÂπ∂Ë°åÊü•ËØ¢

**ÈóÆÈ¢ò4**ÔºöÁª¥Êä§ËÆ°Âàí‰∏çÂêàÁêÜ

- **Ëß£ÂÜ≥ÊñπÊ°à**ÔºöËÄÉËôëÁª¥Êä§ÊàêÊú¨„ÄÅËµÑÊ∫êÁ∫¶Êùü„ÄÅ‰ºòÂÖàÁ∫ß‰ºòÂåñ

---

## 7. ÊúÄ‰Ω≥ÂÆûË∑µ

### 7.1 ÊñπÊ≥ïÈÄâÊã©

1. **Â§öÊåáÊ†áËÆæÂ§á**Ôºö‰ΩøÁî®ÂÅ•Â∫∑Â∫¶ËØÑÂàÜ
2. **Ë∂ãÂäøÊòéÊòæ**Ôºö‰ΩøÁî®Ë∂ãÂäøÈ¢ÑÊµã
3. **ÂºÇÂ∏∏È¢ëÁπÅ**Ôºö‰ΩøÁî®ÂºÇÂ∏∏È¢ÑÊµã

### 7.2 Êï∞ÊçÆË¥®Èáè

1. **Êï∞ÊçÆÂÆåÊï¥ÊÄß**ÔºöÁ°Æ‰øùÁõëÊéßÊï∞ÊçÆÂÆåÊï¥
2. **ÂºÇÂ∏∏ÂÄºÂ§ÑÁêÜ**ÔºöËØÜÂà´ÂíåÂ§ÑÁêÜÂºÇÂ∏∏ÂÄº
3. **Êï∞ÊçÆÊõ¥Êñ∞**ÔºöÂÆûÊó∂Êõ¥Êñ∞ÁõëÊéßÊï∞ÊçÆ

### 7.3 Ê®°ÂûãÊõ¥Êñ∞

1. **ÂÆöÊúüÊõ¥Êñ∞**ÔºöÂÆöÊúüÊõ¥Êñ∞È¢ÑÊµãÊ®°Âûã
2. **ÂèçÈ¶àÂ≠¶‰π†**ÔºöÊ†πÊçÆÁª¥Êä§ÁªìÊûú‰ºòÂåñÊ®°Âûã
3. **ÈòàÂÄºË∞ÉÊï¥**ÔºöÊ†πÊçÆÂÆûÈôÖÊÉÖÂÜµË∞ÉÊï¥ÈòàÂÄº

### 7.4 SQLÂÆûÁé∞Ê≥®ÊÑè‰∫ãÈ°π

1. **Â§öÊåáÊ†áÁªºÂêà**ÔºöÂêàÁêÜËÆæÁΩÆÊùÉÈáç
2. **Êó∂Èó¥Á™óÂè£**ÔºöÂêàÁêÜËÆæÁΩÆÊó∂Èó¥Á™óÂè£
3. **‰ºòÂÖàÁ∫ßËÆ°ÁÆó**ÔºöËÄÉËôëÂ§ö‰∏™Âõ†Á¥†
4. **ÈîôËØØÂ§ÑÁêÜ**ÔºöÂ§ÑÁêÜNULLÂÄºÂíåËæπÁïåÊÉÖÂÜµ

---

## üìö ÂèÇËÄÉËµÑÊ∫ê

### Â≠¶ÊúØÊñáÁåÆ

- „ÄäÈ¢ÑÊµãÊÄßÁª¥Êä§„ÄãÔºàPredictive MaintenanceÔºâ- È¢ÑÊµãÊÄßÁª¥Êä§ÁêÜËÆ∫
- „ÄäËÆæÂ§áÂÅ•Â∫∑ÁÆ°ÁêÜ„ÄãÔºàEquipment Health ManagementÔºâ- ÂÅ•Â∫∑Â∫¶ËØÑ‰º∞

### PostgreSQLÂÆòÊñπÊñáÊ°£

- [Á™óÂè£ÂáΩÊï∞](https://www.postgresql.org/docs/current/tutorial-window.html)
- [ËÅöÂêàÂáΩÊï∞](https://www.postgresql.org/docs/current/functions-aggregate.html)
- [Êó∂Èó¥ÂáΩÊï∞](https://www.postgresql.org/docs/current/functions-datetime.html)

### Âú®Á∫øËµÑÊ∫ê

- PostgreSQLÈ¢ÑÊµãÊÄßÁª¥Êä§ÊåáÂçó
- È¢ÑÊµãÊÄßÁª¥Êä§ÊñπÊ≥ïËØ¶Ëß£
- È¢ÑÊµãÊÄßÁª¥Êä§ÊúÄ‰Ω≥ÂÆûË∑µ

### Áõ∏ÂÖ≥ÁÆóÊ≥ï

- [ÊÄßËÉΩÊåáÊ†áËÆ°ÁÆó](./ÊÄßËÉΩÊåáÊ†áËÆ°ÁÆó.md) - ÊÄßËÉΩÁõëÊéß
- [ÂºÇÂ∏∏Ê£ÄÊµãÁÆóÊ≥ï](./ÂºÇÂ∏∏Ê£ÄÊµãÁÆóÊ≥ï.md) - ÂºÇÂ∏∏Ê£ÄÊµã
- [ËµÑÊ∫ê‰ºòÂåñÁÆóÊ≥ï](./ËµÑÊ∫ê‰ºòÂåñÁÆóÊ≥ï.md) - ËµÑÊ∫ê‰ºòÂåñ

---

**ÊúÄÂêéÊõ¥Êñ∞**: 2025Âπ¥1Êúà
**ÊñáÊ°£Áä∂ÊÄÅ**: ‚úÖ Â∑≤ÂÆåÊàê
