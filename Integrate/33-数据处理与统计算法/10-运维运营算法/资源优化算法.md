# PostgreSQL èµ„æºä¼˜åŒ–ç®—æ³•å®Œæ•´æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æŠ€æœ¯æ ˆ**: PostgreSQL 17+/18+ | èµ„æºä¼˜åŒ– | æˆæœ¬ä¼˜åŒ–
> **éš¾åº¦çº§åˆ«**: â­â­â­â­ (é«˜çº§)

---

## ğŸ“‹ ç›®å½•

- [PostgreSQL èµ„æºä¼˜åŒ–ç®—æ³•å®Œæ•´æŒ‡å—](#postgresql-èµ„æºä¼˜åŒ–ç®—æ³•å®Œæ•´æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [èµ„æºä¼˜åŒ–æ¦‚è¿°](#èµ„æºä¼˜åŒ–æ¦‚è¿°)
    - [ç†è®ºåŸºç¡€](#ç†è®ºåŸºç¡€)
      - [èµ„æºä¼˜åŒ–é—®é¢˜å®šä¹‰](#èµ„æºä¼˜åŒ–é—®é¢˜å®šä¹‰)
      - [ä¼˜åŒ–æ–¹æ³•åˆ†ç±»](#ä¼˜åŒ–æ–¹æ³•åˆ†ç±»)
      - [ä¼˜åŒ–æ–¹æ³•é€‰æ‹©](#ä¼˜åŒ–æ–¹æ³•é€‰æ‹©)
    - [æ ¸å¿ƒç®—æ³•](#æ ¸å¿ƒç®—æ³•)
  - [1. èµ„æºåˆ©ç”¨ç‡åˆ†æ](#1-èµ„æºåˆ©ç”¨ç‡åˆ†æ)
    - [1.1 èµ„æºåˆ©ç”¨ç‡åˆ†æåŸç†](#11-èµ„æºåˆ©ç”¨ç‡åˆ†æåŸç†)
      - [èµ„æºåˆ©ç”¨ç‡å®šä¹‰](#èµ„æºåˆ©ç”¨ç‡å®šä¹‰)
      - [åˆ©ç”¨ç‡åˆ†ææ–¹æ³•](#åˆ©ç”¨ç‡åˆ†ææ–¹æ³•)
    - [1.2 åˆ©ç”¨ç‡ç»Ÿè®¡å®ç°](#12-åˆ©ç”¨ç‡ç»Ÿè®¡å®ç°)
    - [1.3 åˆ©ç”¨ç‡è¶‹åŠ¿åˆ†æ](#13-åˆ©ç”¨ç‡è¶‹åŠ¿åˆ†æ)
  - [2. èµ„æºåˆ†é…ä¼˜åŒ–](#2-èµ„æºåˆ†é…ä¼˜åŒ–)
    - [2.1 èµ„æºåˆ†é…ä¼˜åŒ–åŸç†](#21-èµ„æºåˆ†é…ä¼˜åŒ–åŸç†)
      - [èµ„æºåˆ†é…é—®é¢˜](#èµ„æºåˆ†é…é—®é¢˜)
      - [ä¼˜åŒ–æ–¹æ³•](#ä¼˜åŒ–æ–¹æ³•)
    - [2.2 è´Ÿè½½å‡è¡¡å®ç°](#22-è´Ÿè½½å‡è¡¡å®ç°)
    - [2.3 èµ„æºé‡åˆ†é…](#23-èµ„æºé‡åˆ†é…)
  - [3. æˆæœ¬ä¼˜åŒ–](#3-æˆæœ¬ä¼˜åŒ–)
    - [3.1 æˆæœ¬ä¼˜åŒ–åŸç†](#31-æˆæœ¬ä¼˜åŒ–åŸç†)
      - [æˆæœ¬ä¼˜åŒ–å®šä¹‰](#æˆæœ¬ä¼˜åŒ–å®šä¹‰)
      - [æˆæœ¬è®¡ç®—æ–¹æ³•](#æˆæœ¬è®¡ç®—æ–¹æ³•)
    - [3.2 æˆæœ¬åˆ†æå®ç°](#32-æˆæœ¬åˆ†æå®ç°)
    - [3.3 æˆæœ¬ä¼˜åŒ–å»ºè®®](#33-æˆæœ¬ä¼˜åŒ–å»ºè®®)
  - [4. PostgreSQL 18å¹¶è¡Œèµ„æºä¼˜åŒ–](#4-postgresql-18å¹¶è¡Œèµ„æºä¼˜åŒ–)
    - [4.1 å¹¶è¡Œèµ„æºä¼˜åŒ–æ¦‚è¿°](#41-å¹¶è¡Œèµ„æºä¼˜åŒ–æ¦‚è¿°)
      - [å¹¶è¡Œèµ„æºä¼˜åŒ–é…ç½®](#å¹¶è¡Œèµ„æºä¼˜åŒ–é…ç½®)
      - [å¹¶è¡Œèµ„æºä¼˜åŒ–å®ç°](#å¹¶è¡Œèµ„æºä¼˜åŒ–å®ç°)
  - [5. èµ„æºä¼˜åŒ–ç­–ç•¥](#5-èµ„æºä¼˜åŒ–ç­–ç•¥)
    - [5.1 ç´¢å¼•ä¼˜åŒ–](#51-ç´¢å¼•ä¼˜åŒ–)
    - [5.2 åˆ©ç”¨ç‡è®¡ç®—ä¼˜åŒ–](#52-åˆ©ç”¨ç‡è®¡ç®—ä¼˜åŒ–)
    - [5.3 æ‰¹é‡ä¼˜åŒ–](#53-æ‰¹é‡ä¼˜åŒ–)
  - [6. å®é™…åº”ç”¨æ¡ˆä¾‹](#6-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [6.1 äº‘èµ„æºä¼˜åŒ–](#61-äº‘èµ„æºä¼˜åŒ–)
    - [6.2 æ•°æ®åº“èµ„æºä¼˜åŒ–](#62-æ•°æ®åº“èµ„æºä¼˜åŒ–)
    - [6.3 è®¡ç®—èµ„æºä¼˜åŒ–](#63-è®¡ç®—èµ„æºä¼˜åŒ–)
    - [6.4 ç»¼åˆèµ„æºä¼˜åŒ–](#64-ç»¼åˆèµ„æºä¼˜åŒ–)
  - [7. ç®—æ³•æ€§èƒ½å¯¹æ¯”ä¸ä¼˜åŒ–](#7-ç®—æ³•æ€§èƒ½å¯¹æ¯”ä¸ä¼˜åŒ–)
    - [7.1 ä¼˜åŒ–æ–¹æ³•å¯¹æ¯”](#71-ä¼˜åŒ–æ–¹æ³•å¯¹æ¯”)
    - [7.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®](#72-æ€§èƒ½ä¼˜åŒ–å»ºè®®)
    - [7.3 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#73-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
  - [8. æœ€ä½³å®è·µ](#8-æœ€ä½³å®è·µ)
    - [8.1 ä¼˜åŒ–æ–¹æ³•é€‰æ‹©](#81-ä¼˜åŒ–æ–¹æ³•é€‰æ‹©)
    - [8.2 æˆæœ¬æ§åˆ¶](#82-æˆæœ¬æ§åˆ¶)
    - [8.3 æ€§èƒ½å¹³è¡¡](#83-æ€§èƒ½å¹³è¡¡)
    - [8.4 SQLå®ç°æ³¨æ„äº‹é¡¹](#84-sqlå®ç°æ³¨æ„äº‹é¡¹)
  - [ğŸ“š å‚è€ƒèµ„æº](#-å‚è€ƒèµ„æº)
    - [å­¦æœ¯æ–‡çŒ®](#å­¦æœ¯æ–‡çŒ®)
    - [PostgreSQLå®˜æ–¹æ–‡æ¡£](#postgresqlå®˜æ–¹æ–‡æ¡£)
    - [åœ¨çº¿èµ„æº](#åœ¨çº¿èµ„æº)
    - [ç›¸å…³ç®—æ³•](#ç›¸å…³ç®—æ³•)

---

## èµ„æºä¼˜åŒ–æ¦‚è¿°

**èµ„æºä¼˜åŒ–ï¼ˆResource Optimizationï¼‰**é€šè¿‡åˆç†åˆ†é…å’Œè°ƒåº¦èµ„æºï¼Œæé«˜åˆ©ç”¨ç‡å¹¶é™ä½æˆæœ¬ï¼Œæ˜¯è¿ç»´ç®¡ç†çš„é‡è¦ç›®æ ‡ã€‚

### ç†è®ºåŸºç¡€

#### èµ„æºä¼˜åŒ–é—®é¢˜å®šä¹‰

**èµ„æºä¼˜åŒ–é—®é¢˜**ï¼šç»™å®šèµ„æºé›†åˆ$R = \{r_1, r_2, \ldots, r_n\}$å’Œéœ€æ±‚é›†åˆ$D = \{d_1, d_2, \ldots, d_m\}$ï¼Œæ‰¾åˆ°æœ€ä¼˜åˆ†é…æ–¹æ¡ˆï¼š
$$\min_{A} C(A) \text{ subject to } U(A) \geq U_{min}$$

å…¶ä¸­$A$æ˜¯åˆ†é…æ–¹æ¡ˆï¼Œ$C(A)$æ˜¯æˆæœ¬ï¼Œ$U(A)$æ˜¯åˆ©ç”¨ç‡ã€‚

#### ä¼˜åŒ–æ–¹æ³•åˆ†ç±»

èµ„æºä¼˜åŒ–æ–¹æ³•åˆ†ç±»ï¼š

1. **åˆ©ç”¨ç‡åˆ†æ**ï¼š
   - åˆ©ç”¨ç‡ç»Ÿè®¡ï¼š$\text{Utilization} = \frac{\text{Used}}{\text{Total}}$
   - åˆ©ç”¨ç‡è¶‹åŠ¿åˆ†æ
   - æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$

2. **è´Ÿè½½å‡è¡¡**ï¼š
   - è´Ÿè½½åˆ†é…ï¼š$\min \sum_{i,j} (L_i - L_j)^2$
   - è´Ÿè½½é‡åˆ†é…
   - æ—¶é—´å¤æ‚åº¦ï¼š$O(n \log n)$

3. **æˆæœ¬ä¼˜åŒ–**ï¼š
   - æˆæœ¬åˆ†æï¼š$C = \sum_{i} c_i \cdot r_i$
   - æˆæœ¬æœ€å°åŒ–
   - æ—¶é—´å¤æ‚åº¦ï¼š$O(n^2)$

#### ä¼˜åŒ–æ–¹æ³•é€‰æ‹©

é€‰æ‹©ä¼˜åŒ–æ–¹æ³•çš„è€ƒè™‘å› ç´ ï¼š

1. **ä¼˜åŒ–ç›®æ ‡**ï¼šåˆ©ç”¨ç‡ä¼˜åŒ–ç”¨è´Ÿè½½å‡è¡¡ï¼Œæˆæœ¬ä¼˜åŒ–ç”¨æˆæœ¬åˆ†æ
2. **èµ„æºç±»å‹**ï¼šè®¡ç®—èµ„æºç”¨è´Ÿè½½å‡è¡¡ï¼Œå­˜å‚¨èµ„æºç”¨åˆ©ç”¨ç‡åˆ†æ
3. **çº¦æŸæ¡ä»¶**ï¼šæœ‰çº¦æŸç”¨ä¼˜åŒ–ç®—æ³•ï¼Œæ— çº¦æŸç”¨ç®€å•æ–¹æ³•

### æ ¸å¿ƒç®—æ³•

| ç®—æ³• | æ•°å­¦å®šä¹‰ | ç”¨é€” | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ |
|------|---------|------|-----------|-----------|---------|
| **åˆ©ç”¨ç‡åˆ†æ** | $\text{Utilization} = \frac{\text{Used}}{\text{Total}}$ | èµ„æºä½¿ç”¨è¯„ä¼° | $O(n)$ | $O(1)$ | èµ„æºè¯„ä¼° |
| **è´Ÿè½½å‡è¡¡** | $\min \sum_{i,j} (L_i - L_j)^2$ | èµ„æºåˆ†é… | $O(n \log n)$ | $O(n)$ | è´Ÿè½½åˆ†é… |
| **æˆæœ¬ä¼˜åŒ–** | $\min C = \sum_{i} c_i \cdot r_i$ | æˆæœ¬æœ€å°åŒ– | $O(n^2)$ | $O(n)$ | æˆæœ¬ä¼˜åŒ– |

---

## 1. èµ„æºåˆ©ç”¨ç‡åˆ†æ

### 1.1 èµ„æºåˆ©ç”¨ç‡åˆ†æåŸç†

**èµ„æºåˆ©ç”¨ç‡åˆ†æï¼ˆResource Utilization Analysisï¼‰**åˆ†æèµ„æºçš„ä½¿ç”¨æƒ…å†µã€‚

#### èµ„æºåˆ©ç”¨ç‡å®šä¹‰

**èµ„æºåˆ©ç”¨ç‡**ï¼šèµ„æºä½¿ç”¨é‡ä¸æ€»å®¹é‡çš„æ¯”å€¼ï¼š
$$\text{Utilization} = \frac{\text{Used}}{\text{Total}} \times 100\%$$

**åˆ©ç”¨ç‡åˆ†ç±»**ï¼š

- **ä½åˆ©ç”¨ç‡**ï¼š$\text{Utilization} < 30\%$ï¼ˆèµ„æºæµªè´¹ï¼‰
- **æ­£å¸¸åˆ©ç”¨ç‡**ï¼š$30\% \leq \text{Utilization} \leq 80\%$ï¼ˆåˆç†èŒƒå›´ï¼‰
- **é«˜åˆ©ç”¨ç‡**ï¼š$\text{Utilization} > 80\%$ï¼ˆå¯èƒ½ç“¶é¢ˆï¼‰

#### åˆ©ç”¨ç‡åˆ†ææ–¹æ³•

**åˆ©ç”¨ç‡åˆ†ææ–¹æ³•**ï¼š

1. **å½“å‰åˆ©ç”¨ç‡**ï¼šå½“å‰æ—¶åˆ»çš„åˆ©ç”¨ç‡
2. **å¹³å‡åˆ©ç”¨ç‡**ï¼šä¸€æ®µæ—¶é—´å†…çš„å¹³å‡åˆ©ç”¨ç‡
3. **å³°å€¼åˆ©ç”¨ç‡**ï¼šä¸€æ®µæ—¶é—´å†…çš„æœ€å¤§åˆ©ç”¨ç‡

### 1.2 åˆ©ç”¨ç‡ç»Ÿè®¡å®ç°

**åˆ©ç”¨ç‡ç»Ÿè®¡**çš„å®ç°å’Œä½¿ç”¨ã€‚

```sql
-- åˆ›å»ºèµ„æºä½¿ç”¨æ•°æ®è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'resource_usage') THEN
            RAISE WARNING 'è¡¨ resource_usage å·²å­˜åœ¨ï¼Œå…ˆåˆ é™¤';
            DROP TABLE resource_usage CASCADE;
        END IF;

        CREATE TABLE resource_usage (
            timestamp TIMESTAMP NOT NULL,
            resource_id VARCHAR(50) NOT NULL,
            resource_type VARCHAR(50) NOT NULL,
            allocated_capacity NUMERIC(10, 2) NOT NULL,
            used_capacity NUMERIC(10, 2) NOT NULL,
            PRIMARY KEY (timestamp, resource_id)
        );

        INSERT INTO resource_usage (timestamp, resource_id, resource_type, allocated_capacity, used_capacity) VALUES
            ('2024-01-01 10:00:00', 'CPU001', 'CPU', 100.0, 45.5),
            ('2024-01-01 10:01:00', 'CPU001', 'CPU', 100.0, 48.2),
            ('2024-01-01 10:00:00', 'MEM001', 'Memory', 64.0, 32.5),
            ('2024-01-01 10:01:00', 'MEM001', 'Memory', 64.0, 35.2),
            ('2024-01-01 10:00:00', 'STOR001', 'Storage', 1000.0, 750.0),
            ('2024-01-01 10:01:00', 'STOR001', 'Storage', 1000.0, 755.0);

        RAISE NOTICE 'è¡¨ resource_usage åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ resource_usage å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE EXCEPTION 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
    END;
END $$;

-- è®¡ç®—èµ„æºåˆ©ç”¨ç‡ç»Ÿè®¡ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'resource_usage') THEN
            RAISE WARNING 'è¡¨ resource_usage ä¸å­˜åœ¨ï¼Œæ— æ³•è®¡ç®—åˆ©ç”¨ç‡ç»Ÿè®¡';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹è®¡ç®—èµ„æºåˆ©ç”¨ç‡ç»Ÿè®¡';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ©ç”¨ç‡ç»Ÿè®¡è®¡ç®—å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- è®¡ç®—èµ„æºåˆ©ç”¨ç‡
SELECT
    resource_id,
    resource_type,
    COUNT(*) AS sample_count,
    ROUND(AVG(allocated_capacity)::numeric, 2) AS avg_allocated,
    ROUND(AVG(used_capacity)::numeric, 2) AS avg_used,
    ROUND(AVG(used_capacity / NULLIF(allocated_capacity, 0) * 100)::numeric, 2) AS avg_utilization_pct,
    ROUND(MIN(used_capacity / NULLIF(allocated_capacity, 0) * 100)::numeric, 2) AS min_utilization_pct,
    ROUND(MAX(used_capacity / NULLIF(allocated_capacity, 0) * 100)::numeric, 2) AS max_utilization_pct,
    ROUND((AVG(allocated_capacity) - AVG(used_capacity))::numeric, 2) AS avg_available,
    CASE
        WHEN AVG(used_capacity / NULLIF(allocated_capacity, 0)) > 0.9 THEN 'Overutilized'
        WHEN AVG(used_capacity / NULLIF(allocated_capacity, 0)) < 0.3 THEN 'Underutilized'
        ELSE 'Optimal'
    END AS utilization_status
FROM resource_usage
GROUP BY resource_id, resource_type
ORDER BY avg_utilization_pct DESC;

-- æ€§èƒ½æµ‹è¯•
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT
    resource_id,
    AVG(used_capacity / NULLIF(allocated_capacity, 0)) AS avg_utilization
FROM resource_usage
GROUP BY resource_id;
```

---

### 1.3 åˆ©ç”¨ç‡è¶‹åŠ¿åˆ†æ

**åˆ©ç”¨ç‡è¶‹åŠ¿åˆ†æ**ï¼šåˆ†æåˆ©ç”¨ç‡çš„å˜åŒ–è¶‹åŠ¿ã€‚

```sql
-- åˆ©ç”¨ç‡è¶‹åŠ¿åˆ†æï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'resource_usage') THEN
            RAISE WARNING 'è¡¨ resource_usage ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ†æåˆ©ç”¨ç‡è¶‹åŠ¿';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹åˆ†æåˆ©ç”¨ç‡è¶‹åŠ¿';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ©ç”¨ç‡è¶‹åŠ¿åˆ†æå‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- åˆ©ç”¨ç‡è¶‹åŠ¿åˆ†æï¼šè¯†åˆ«åˆ©ç”¨ç‡å˜åŒ–è¶‹åŠ¿
WITH utilization_trends AS (
    SELECT
        timestamp,
        resource_id,
        resource_type,
        allocated_capacity,
        used_capacity,
        used_capacity / NULLIF(allocated_capacity, 0) AS utilization_rate,
        AVG(used_capacity / NULLIF(allocated_capacity, 0)) OVER (
            PARTITION BY resource_id
            ORDER BY timestamp
            ROWS BETWEEN 9 PRECEDING AND CURRENT ROW
        ) AS moving_avg_utilization
    FROM resource_usage
),
trend_analysis AS (
    SELECT
        timestamp,
        resource_id,
        resource_type,
        ROUND((utilization_rate * 100)::numeric, 2) AS utilization_pct,
        ROUND((moving_avg_utilization * 100)::numeric, 2) AS moving_avg_pct,
        CASE
            WHEN utilization_rate > 0.9 THEN 'Overutilized'
            WHEN utilization_rate < 0.3 THEN 'Underutilized'
            ELSE 'Optimal'
        END AS utilization_status,
        CASE
            WHEN utilization_rate > moving_avg_utilization * 1.2 THEN 'Increasing'
            WHEN utilization_rate < moving_avg_utilization * 0.8 THEN 'Decreasing'
            ELSE 'Stable'
        END AS trend_direction
    FROM utilization_trends
    WHERE moving_avg_utilization IS NOT NULL
)
SELECT
    timestamp,
    resource_id,
    resource_type,
    utilization_pct,
    moving_avg_pct,
    utilization_status,
    trend_direction
FROM trend_analysis
WHERE utilization_status != 'Optimal' OR trend_direction != 'Stable'
ORDER BY resource_id, timestamp;
```

---

## 2. èµ„æºåˆ†é…ä¼˜åŒ–

### 2.1 èµ„æºåˆ†é…ä¼˜åŒ–åŸç†

**èµ„æºåˆ†é…ä¼˜åŒ–ï¼ˆResource Allocation Optimizationï¼‰**ä¼˜åŒ–èµ„æºåˆ†é…ï¼Œæé«˜æ•´ä½“åˆ©ç”¨ç‡ã€‚

#### èµ„æºåˆ†é…é—®é¢˜

**èµ„æºåˆ†é…é—®é¢˜**ï¼šå°†éœ€æ±‚åˆ†é…åˆ°èµ„æºï¼Œä¼˜åŒ–ç›®æ ‡å‡½æ•°ï¼š
$$\min_{A} f(A) \text{ subject to } \sum_{j} a_{ij} \leq r_i$$

å…¶ä¸­$A = \{a_{ij}\}$æ˜¯åˆ†é…çŸ©é˜µï¼Œ$r_i$æ˜¯èµ„æº$i$çš„å®¹é‡ã€‚

#### ä¼˜åŒ–æ–¹æ³•

**ä¼˜åŒ–æ–¹æ³•**ï¼š

1. **è´Ÿè½½å‡è¡¡**ï¼šå¹³è¡¡å„èµ„æºè´Ÿè½½
2. **è´ªå¿ƒç®—æ³•**ï¼šä¼˜å…ˆåˆ†é…é«˜ä¼˜å…ˆçº§éœ€æ±‚
3. **çº¿æ€§è§„åˆ’**ï¼šä½¿ç”¨çº¿æ€§è§„åˆ’æ±‚è§£

### 2.2 è´Ÿè½½å‡è¡¡å®ç°

**è´Ÿè½½å‡è¡¡**çš„å®ç°å’Œä½¿ç”¨ã€‚

```sql
-- è´Ÿè½½å‡è¡¡åˆ†æï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'resource_usage') THEN
            RAISE WARNING 'è¡¨ resource_usage ä¸å­˜åœ¨ï¼Œæ— æ³•è¿›è¡Œè´Ÿè½½å‡è¡¡åˆ†æ';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹è¿›è¡Œè´Ÿè½½å‡è¡¡åˆ†æ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'è´Ÿè½½å‡è¡¡åˆ†æå‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- åˆ†æè´Ÿè½½åˆ†å¸ƒ
WITH resource_stats AS (
    SELECT
        resource_type,
        resource_id,
        AVG(used_capacity / NULLIF(allocated_capacity, 0)) AS avg_utilization
    FROM resource_usage
    GROUP BY resource_type, resource_id
),
type_stats AS (
    SELECT
        resource_type,
        COUNT(*) AS resource_count,
        AVG(avg_utilization) AS avg_type_utilization,
        STDDEV(avg_utilization) AS std_type_utilization
    FROM resource_stats
    GROUP BY resource_type
)
SELECT
    rs.resource_type,
    rs.resource_id,
    ROUND(rs.avg_utilization::numeric, 4) AS resource_utilization,
    ROUND(ts.avg_type_utilization::numeric, 4) AS type_avg_utilization,
    ROUND(ts.std_type_utilization::numeric, 4) AS type_std_utilization,
    CASE
        WHEN rs.avg_utilization > ts.avg_type_utilization + ts.std_type_utilization THEN 'Overloaded'
        WHEN rs.avg_utilization < ts.avg_type_utilization - ts.std_type_utilization THEN 'Underloaded'
        ELSE 'Balanced'
    END AS load_status,
    CASE
        WHEN rs.avg_utilization > ts.avg_type_utilization + ts.std_type_utilization THEN
            'Consider redistributing load'
        WHEN rs.avg_utilization < ts.avg_type_utilization - ts.std_type_utilization THEN
            'Can accept more load'
        ELSE 'Optimal'
    END AS optimization_suggestion
FROM resource_stats rs
JOIN type_stats ts ON rs.resource_type = ts.resource_type
ORDER BY rs.resource_type, rs.avg_utilization DESC;

-- æ€§èƒ½æµ‹è¯•
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT
    resource_type,
    AVG(used_capacity / NULLIF(allocated_capacity, 0)) AS avg_utilization
FROM resource_usage
GROUP BY resource_type;
```

---

### 2.3 èµ„æºé‡åˆ†é…

**èµ„æºé‡åˆ†é…**ï¼šä¼˜åŒ–èµ„æºåˆ†é…æ–¹æ¡ˆã€‚

```sql
-- èµ„æºé‡åˆ†é…ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'resource_usage') THEN
            RAISE WARNING 'è¡¨ resource_usage ä¸å­˜åœ¨ï¼Œæ— æ³•è¿›è¡Œèµ„æºé‡åˆ†é…';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹è¿›è¡Œèµ„æºé‡åˆ†é…';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'èµ„æºé‡åˆ†é…å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- èµ„æºé‡åˆ†é…ï¼šè¯†åˆ«éœ€è¦é‡åˆ†é…çš„èµ„æº
WITH resource_utilization AS (
    SELECT
        resource_id,
        resource_type,
        AVG(used_capacity / NULLIF(allocated_capacity, 0)) AS avg_utilization,
        MAX(used_capacity / NULLIF(allocated_capacity, 0)) AS max_utilization
    FROM resource_usage
    GROUP BY resource_id, resource_type
),
type_averages AS (
    SELECT
        resource_type,
        AVG(avg_utilization) AS type_avg_utilization,
        STDDEV(avg_utilization) AS type_std_utilization
    FROM resource_utilization
    GROUP BY resource_type
),
redistribution_candidates AS (
    SELECT
        ru.resource_id,
        ru.resource_type,
        ROUND((ru.avg_utilization * 100)::numeric, 2) AS current_utilization_pct,
        ROUND((ta.type_avg_utilization * 100)::numeric, 2) AS type_avg_pct,
        CASE
            WHEN ru.avg_utilization > ta.type_avg_utilization + ta.type_std_utilization THEN 'Overloaded - Reduce Load'
            WHEN ru.avg_utilization < ta.type_avg_utilization - ta.type_std_utilization THEN 'Underloaded - Accept More Load'
            ELSE 'Balanced'
        END AS redistribution_action,
        CASE
            WHEN ru.avg_utilization > ta.type_avg_utilization + ta.type_std_utilization THEN
                ROUND((ru.avg_utilization - ta.type_avg_utilization) * 100::numeric, 2)
            WHEN ru.avg_utilization < ta.type_avg_utilization - ta.type_std_utilization THEN
                ROUND((ta.type_avg_utilization - ru.avg_utilization) * 100::numeric, 2)
            ELSE 0
        END AS utilization_gap_pct
    FROM resource_utilization ru
    JOIN type_averages ta ON ru.resource_type = ta.resource_type
)
SELECT
    resource_id,
    resource_type,
    current_utilization_pct,
    type_avg_pct,
    utilization_gap_pct,
    redistribution_action
FROM redistribution_candidates
WHERE redistribution_action != 'Balanced'
ORDER BY ABS(utilization_gap_pct) DESC;
```

---

## 3. æˆæœ¬ä¼˜åŒ–

### 3.1 æˆæœ¬ä¼˜åŒ–åŸç†

**æˆæœ¬ä¼˜åŒ–ï¼ˆCost Optimizationï¼‰**è¯„ä¼°èµ„æºä½¿ç”¨æˆæœ¬ï¼Œè¯†åˆ«ä¼˜åŒ–æœºä¼šã€‚

#### æˆæœ¬ä¼˜åŒ–å®šä¹‰

**æˆæœ¬ä¼˜åŒ–**ï¼šæœ€å°åŒ–èµ„æºä½¿ç”¨æˆæœ¬ï¼š
$$\min C = \sum_{i=1}^{n} c_i \cdot r_i$$

å…¶ä¸­$c_i$æ˜¯èµ„æº$i$çš„å•ä½æˆæœ¬ï¼Œ$r_i$æ˜¯èµ„æº$i$çš„ä½¿ç”¨é‡ã€‚

#### æˆæœ¬è®¡ç®—æ–¹æ³•

**æˆæœ¬è®¡ç®—æ–¹æ³•**ï¼š

1. **åˆ†é…æˆæœ¬**ï¼šåŸºäºåˆ†é…å®¹é‡çš„æˆæœ¬
2. **ä½¿ç”¨æˆæœ¬**ï¼šåŸºäºä½¿ç”¨å®¹é‡çš„æˆæœ¬
3. **æµªè´¹æˆæœ¬**ï¼šæœªä½¿ç”¨å®¹é‡çš„æˆæœ¬

### 3.2 æˆæœ¬åˆ†æå®ç°

**æˆæœ¬åˆ†æ**çš„å®ç°å’Œä½¿ç”¨ã€‚

```sql
-- åˆ›å»ºèµ„æºæˆæœ¬è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'resource_costs') THEN
            RAISE WARNING 'è¡¨ resource_costs å·²å­˜åœ¨ï¼Œå…ˆåˆ é™¤';
            DROP TABLE resource_costs CASCADE;
        END IF;

        CREATE TABLE resource_costs (
            resource_type VARCHAR(50) PRIMARY KEY,
            cost_per_unit NUMERIC(10, 4) NOT NULL,
            unit VARCHAR(20) NOT NULL
        );

        INSERT INTO resource_costs (resource_type, cost_per_unit, unit) VALUES
            ('CPU', 0.10, 'per core/hour'),
            ('Memory', 0.05, 'per GB/hour'),
            ('Storage', 0.01, 'per GB/hour');

        RAISE NOTICE 'è¡¨ resource_costs åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ resource_costs å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE EXCEPTION 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
    END;
END $$;

-- æˆæœ¬åˆ†æï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'resource_usage') THEN
            RAISE WARNING 'è¡¨ resource_usage ä¸å­˜åœ¨ï¼Œæ— æ³•è¿›è¡Œæˆæœ¬åˆ†æ';
            RETURN;
        END IF;
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'resource_costs') THEN
            RAISE WARNING 'è¡¨ resource_costs ä¸å­˜åœ¨ï¼Œæ— æ³•è¿›è¡Œæˆæœ¬åˆ†æ';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹è¿›è¡Œæˆæœ¬åˆ†æ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'æˆæœ¬åˆ†æå‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- è®¡ç®—èµ„æºæˆæœ¬
WITH usage_summary AS (
    SELECT
        resource_id,
        resource_type,
        AVG(allocated_capacity) AS avg_allocated,
        AVG(used_capacity) AS avg_used,
        COUNT(*) AS hours_count
    FROM resource_usage
    GROUP BY resource_id, resource_type
),
cost_calculation AS (
    SELECT
        us.resource_id,
        us.resource_type,
        us.avg_allocated,
        us.avg_used,
        us.hours_count,
        rc.cost_per_unit,
        rc.unit,
        -- åˆ†é…æˆæœ¬ï¼ˆåŸºäºåˆ†é…å®¹é‡ï¼‰
        us.avg_allocated * rc.cost_per_unit * us.hours_count AS allocated_cost,
        -- ä½¿ç”¨æˆæœ¬ï¼ˆåŸºäºä½¿ç”¨å®¹é‡ï¼‰
        us.avg_used * rc.cost_per_unit * us.hours_count AS used_cost,
        -- æµªè´¹æˆæœ¬ï¼ˆæœªä½¿ç”¨çš„å®¹é‡ï¼‰
        (us.avg_allocated - us.avg_used) * rc.cost_per_unit * us.hours_count AS waste_cost
    FROM usage_summary us
    JOIN resource_costs rc ON us.resource_type = rc.resource_type
)
SELECT
    resource_id,
    resource_type,
    ROUND(avg_allocated::numeric, 2) AS avg_allocated,
    ROUND(avg_used::numeric, 2) AS avg_used,
    ROUND((avg_used / NULLIF(avg_allocated, 0) * 100)::numeric, 2) AS utilization_pct,
    ROUND(allocated_cost::numeric, 2) AS allocated_cost,
    ROUND(used_cost::numeric, 2) AS used_cost,
    ROUND(waste_cost::numeric, 2) AS waste_cost,
    ROUND((waste_cost / NULLIF(allocated_cost, 0) * 100)::numeric, 2) AS waste_pct,
    CASE
        WHEN waste_pct > 50 THEN 'High Waste - Consider downsizing'
        WHEN waste_pct > 30 THEN 'Moderate Waste - Review allocation'
        ELSE 'Efficient'
    END AS optimization_recommendation
FROM cost_calculation
ORDER BY waste_cost DESC;

-- æ€§èƒ½æµ‹è¯•
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT
    resource_type,
    SUM(avg_allocated * cost_per_unit) AS total_cost
FROM (
    SELECT
        resource_type,
        AVG(allocated_capacity) AS avg_allocated
    FROM resource_usage
    GROUP BY resource_type
) us
JOIN resource_costs rc ON us.resource_type = rc.resource_type
GROUP BY resource_type;
```

---

### 3.3 æˆæœ¬ä¼˜åŒ–å»ºè®®

**æˆæœ¬ä¼˜åŒ–å»ºè®®**ï¼šç”Ÿæˆæˆæœ¬ä¼˜åŒ–å»ºè®®ã€‚

```sql
-- æˆæœ¬ä¼˜åŒ–å»ºè®®ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'resource_usage') THEN
            RAISE WARNING 'è¡¨ resource_usage ä¸å­˜åœ¨ï¼Œæ— æ³•ç”Ÿæˆæˆæœ¬ä¼˜åŒ–å»ºè®®';
            RETURN;
        END IF;
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'resource_costs') THEN
            RAISE WARNING 'è¡¨ resource_costs ä¸å­˜åœ¨ï¼Œæ— æ³•ç”Ÿæˆæˆæœ¬ä¼˜åŒ–å»ºè®®';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹ç”Ÿæˆæˆæœ¬ä¼˜åŒ–å»ºè®®';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'æˆæœ¬ä¼˜åŒ–å»ºè®®ç”Ÿæˆå‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- æˆæœ¬ä¼˜åŒ–å»ºè®®ï¼šè¯†åˆ«æˆæœ¬ä¼˜åŒ–æœºä¼š
WITH usage_summary AS (
    SELECT
        resource_id,
        resource_type,
        AVG(allocated_capacity) AS avg_allocated,
        AVG(used_capacity) AS avg_used,
        COUNT(*) AS hours_count
    FROM resource_usage
    GROUP BY resource_id, resource_type
),
cost_analysis AS (
    SELECT
        us.resource_id,
        us.resource_type,
        us.avg_allocated,
        us.avg_used,
        us.hours_count,
        rc.cost_per_unit,
        us.avg_allocated * rc.cost_per_unit * us.hours_count AS allocated_cost,
        us.avg_used * rc.cost_per_unit * us.hours_count AS used_cost,
        (us.avg_allocated - us.avg_used) * rc.cost_per_unit * us.hours_count AS waste_cost,
        us.avg_used / NULLIF(us.avg_allocated, 0) AS utilization_rate
    FROM usage_summary us
    JOIN resource_costs rc ON us.resource_type = rc.resource_type
),
optimization_recommendations AS (
    SELECT
        resource_id,
        resource_type,
        ROUND(avg_allocated::numeric, 2) AS avg_allocated,
        ROUND(avg_used::numeric, 2) AS avg_used,
        ROUND((utilization_rate * 100)::numeric, 2) AS utilization_pct,
        ROUND(allocated_cost::numeric, 2) AS allocated_cost,
        ROUND(used_cost::numeric, 2) AS used_cost,
        ROUND(waste_cost::numeric, 2) AS waste_cost,
        ROUND((waste_cost / NULLIF(allocated_cost, 0) * 100)::numeric, 2) AS waste_pct,
        CASE
            WHEN utilization_rate < 0.3 THEN 'Downsize - Low utilization'
            WHEN utilization_rate > 0.9 THEN 'Monitor - High utilization'
            WHEN waste_pct > 50 THEN 'High waste - Consider downsizing'
            WHEN waste_pct > 30 THEN 'Moderate waste - Review allocation'
            ELSE 'Efficient'
        END AS optimization_action,
        CASE
            WHEN utilization_rate < 0.3 THEN waste_cost * 0.7
            WHEN waste_pct > 50 THEN waste_cost * 0.5
            ELSE 0
        END AS potential_savings
    FROM cost_analysis
)
SELECT
    resource_id,
    resource_type,
    avg_allocated,
    avg_used,
    utilization_pct,
    allocated_cost,
    waste_cost,
    waste_pct,
    optimization_action,
    ROUND(potential_savings::numeric, 2) AS potential_savings
FROM optimization_recommendations
WHERE optimization_action != 'Efficient'
ORDER BY potential_savings DESC;
```

---

## 4. PostgreSQL 18å¹¶è¡Œèµ„æºä¼˜åŒ–

### 4.1 å¹¶è¡Œèµ„æºä¼˜åŒ–æ¦‚è¿°

**PostgreSQL 18å¹¶è¡Œèµ„æºä¼˜åŒ–**ï¼šåˆ©ç”¨PostgreSQL 18çš„å¹¶è¡ŒæŸ¥è¯¢èƒ½åŠ›ï¼Œæ˜¾è‘—æå‡å¤§è§„æ¨¡èµ„æºä¼˜åŒ–åˆ†æçš„æ€§èƒ½ã€‚

#### å¹¶è¡Œèµ„æºä¼˜åŒ–é…ç½®

```sql
-- é…ç½®å¹¶è¡Œèµ„æºä¼˜åŒ–å‚æ•°ï¼ˆPostgreSQL 18+ï¼‰
DO $$
BEGIN
    BEGIN
        -- è®¾ç½®å¹¶è¡Œå·¥ä½œè¿›ç¨‹æ•°
        SET max_parallel_workers_per_gather = 4;

        -- è®¾ç½®å¹¶è¡Œè¡¨æ‰«æé˜ˆå€¼
        SET min_parallel_table_scan_size = '8MB';

        -- è®¾ç½®å¹¶è¡Œèšåˆæˆæœ¬é˜ˆå€¼
        SET parallel_setup_cost = 0;
        SET parallel_tuple_cost = 0.0001;

        RAISE NOTICE 'å¹¶è¡Œèµ„æºä¼˜åŒ–å‚æ•°å·²é…ç½®';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¹¶è¡Œèµ„æºä¼˜åŒ–é…ç½®å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

#### å¹¶è¡Œèµ„æºä¼˜åŒ–å®ç°

```sql
-- å¹¶è¡Œèµ„æºåˆ©ç”¨ç‡åˆ†æï¼ˆPostgreSQL 18+ï¼‰
DO $$
BEGIN
    BEGIN
        -- å¯ç”¨å¹¶è¡ŒæŸ¥è¯¢
        SET max_parallel_workers_per_gather = 4;
        SET parallel_setup_cost = 0;
        SET parallel_tuple_cost = 0.0001;

        RAISE NOTICE 'å¼€å§‹æ‰§è¡Œå¹¶è¡Œèµ„æºä¼˜åŒ–';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¹¶è¡Œèµ„æºä¼˜åŒ–å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- å¹¶è¡Œèµ„æºåˆ©ç”¨ç‡ç»Ÿè®¡
EXPLAIN (ANALYZE, BUFFERS, TIMING)
WITH parallel_usage AS (
    SELECT
        resource_id,
        resource_type,
        timestamp,
        usage_value,
        capacity_value
    FROM resource_usage
    WHERE timestamp >= CURRENT_DATE - INTERVAL '30 days'
),
parallel_stats AS (
    SELECT
        resource_type,
        AVG(usage_value::numeric / NULLIF(capacity_value, 0) * 100) AS avg_utilization,
        MAX(usage_value::numeric / NULLIF(capacity_value, 0) * 100) AS max_utilization,
        MIN(usage_value::numeric / NULLIF(capacity_value, 0) * 100) AS min_utilization
    FROM parallel_usage
    GROUP BY resource_type
)
SELECT
    resource_type,
    ROUND(avg_utilization::numeric, 2) AS avg_utilization_pct,
    ROUND(max_utilization::numeric, 2) AS max_utilization_pct,
    ROUND(min_utilization::numeric, 2) AS min_utilization_pct,
    CASE
        WHEN avg_utilization > 80 THEN 'High Utilization - Optimize'
        WHEN avg_utilization < 30 THEN 'Low Utilization - Downsize'
        ELSE 'Optimal'
    END AS optimization_recommendation
FROM parallel_stats
ORDER BY avg_utilization DESC;
```

---

## 5. èµ„æºä¼˜åŒ–ç­–ç•¥

### 5.1 ç´¢å¼•ä¼˜åŒ–

**ç´¢å¼•ä¼˜åŒ–**ï¼šä¸ºèµ„æºä¼˜åŒ–æŸ¥è¯¢åˆ›å»ºåˆé€‚çš„ç´¢å¼•ã€‚

```sql
-- ç´¢å¼•ä¼˜åŒ–ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        -- èµ„æºä½¿ç”¨è¡¨ç´¢å¼•
        CREATE INDEX IF NOT EXISTS idx_resource_usage_timestamp_resource
        ON resource_usage(timestamp, resource_id);

        CREATE INDEX IF NOT EXISTS idx_resource_usage_resource_timestamp
        ON resource_usage(resource_id, timestamp);

        RAISE NOTICE 'èµ„æºä¼˜åŒ–ç´¢å¼•åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'ç´¢å¼•åˆ›å»ºå¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

### 5.2 åˆ©ç”¨ç‡è®¡ç®—ä¼˜åŒ–

**åˆ©ç”¨ç‡è®¡ç®—ä¼˜åŒ–**ï¼šä½¿ç”¨ç‰©åŒ–è§†å›¾ç¼“å­˜åˆ©ç”¨ç‡ç»Ÿè®¡ã€‚

```sql
-- åˆ©ç”¨ç‡è®¡ç®—ä¼˜åŒ–ï¼šä½¿ç”¨ç‰©åŒ–è§†å›¾ç¼“å­˜åˆ©ç”¨ç‡ç»Ÿè®¡
CREATE MATERIALIZED VIEW IF NOT EXISTS resource_utilization_summary AS
SELECT
    resource_id,
    resource_type,
    AVG(allocated_capacity) AS avg_allocated,
    AVG(used_capacity) AS avg_used,
    AVG(used_capacity / NULLIF(allocated_capacity, 0)) AS avg_utilization,
    MIN(used_capacity / NULLIF(allocated_capacity, 0)) AS min_utilization,
    MAX(used_capacity / NULLIF(allocated_capacity, 0)) AS max_utilization
FROM resource_usage
WHERE timestamp >= NOW() - INTERVAL '7 days'
GROUP BY resource_id, resource_type;

CREATE INDEX IF NOT EXISTS idx_resource_utilization_summary_resource
ON resource_utilization_summary(resource_id);

-- åˆ·æ–°ç‰©åŒ–è§†å›¾
REFRESH MATERIALIZED VIEW CONCURRENTLY resource_utilization_summary;
```

### 5.3 æ‰¹é‡ä¼˜åŒ–

**æ‰¹é‡ä¼˜åŒ–**ï¼šæ‰¹é‡ä¼˜åŒ–å¤šä¸ªèµ„æºã€‚

```sql
-- æ‰¹é‡ä¼˜åŒ–ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        SET work_mem = '512MB';
        SET max_parallel_workers_per_gather = 4;
        RAISE NOTICE 'æ‰¹é‡ä¼˜åŒ–é…ç½®å·²è®¾ç½®';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'æ‰¹é‡ä¼˜åŒ–å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

---

## 6. å®é™…åº”ç”¨æ¡ˆä¾‹

### 6.1 äº‘èµ„æºä¼˜åŒ–

**äº‘èµ„æºä¼˜åŒ–**ä¼˜åŒ–äº‘å¹³å°èµ„æºä½¿ç”¨ï¼Œé™ä½æˆæœ¬ã€‚

```sql
-- äº‘èµ„æºä¼˜åŒ–ç¤ºä¾‹ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'cloud_resources') THEN
            RAISE WARNING 'è¡¨ cloud_resources ä¸å­˜åœ¨ï¼Œåˆ›å»ºç¤ºä¾‹è¡¨';

            CREATE TABLE cloud_resources (
                timestamp TIMESTAMP NOT NULL,
                instance_id VARCHAR(50) NOT NULL,
                instance_type VARCHAR(50) NOT NULL,
                cpu_cores INTEGER NOT NULL,
                memory_gb INTEGER NOT NULL,
                cpu_usage_pct NUMERIC(5, 2),
                memory_usage_pct NUMERIC(5, 2),
                hourly_cost NUMERIC(10, 4),
                PRIMARY KEY (timestamp, instance_id)
            );

            INSERT INTO cloud_resources (timestamp, instance_id, instance_type, cpu_cores, memory_gb, cpu_usage_pct, memory_usage_pct, hourly_cost) VALUES
                ('2024-01-01 10:00:00', 'INST001', 'large', 8, 32, 25.5, 40.2, 0.50),
                ('2024-01-01 10:01:00', 'INST001', 'large', 8, 32, 26.2, 41.5, 0.50),
                ('2024-01-01 10:00:00', 'INST002', 'medium', 4, 16, 75.3, 80.1, 0.25),
                ('2024-01-01 10:01:00', 'INST002', 'medium', 4, 16, 78.5, 82.3, 0.25);

            RAISE NOTICE 'è¡¨ cloud_resources åˆ›å»ºæˆåŠŸ';
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡Œäº‘èµ„æºä¼˜åŒ–åˆ†æ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'äº‘èµ„æºä¼˜åŒ–å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- äº‘èµ„æºä¼˜åŒ–å»ºè®®
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
WITH instance_stats AS (
    SELECT
        instance_id,
        instance_type,
        cpu_cores,
        memory_gb,
        AVG(cpu_usage_pct) AS avg_cpu_usage,
        AVG(memory_usage_pct) AS avg_memory_usage,
        MAX(cpu_usage_pct) AS max_cpu_usage,
        MAX(memory_usage_pct) AS max_memory_usage,
        AVG(hourly_cost) AS avg_hourly_cost
    FROM cloud_resources
    GROUP BY instance_id, instance_type, cpu_cores, memory_gb
),
optimization_recommendations AS (
    SELECT
        instance_id,
        instance_type,
        cpu_cores,
        memory_gb,
        ROUND(avg_cpu_usage::numeric, 2) AS avg_cpu_usage,
        ROUND(avg_memory_usage::numeric, 2) AS avg_memory_usage,
        ROUND(max_cpu_usage::numeric, 2) AS max_cpu_usage,
        ROUND(max_memory_usage::numeric, 2) AS max_memory_usage,
        ROUND(avg_hourly_cost::numeric, 4) AS current_cost,
        CASE
            WHEN avg_cpu_usage < 30 AND avg_memory_usage < 40 THEN 'Downsize to smaller instance'
            WHEN avg_cpu_usage > 80 OR avg_memory_usage > 85 THEN 'Consider upgrading'
            WHEN avg_cpu_usage < 50 AND avg_memory_usage < 50 THEN 'Right-size opportunity'
            ELSE 'Current size appropriate'
        END AS optimization_action,
        CASE
            WHEN avg_cpu_usage < 30 AND avg_memory_usage < 40 THEN avg_hourly_cost * 0.5
            ELSE avg_hourly_cost
        END AS estimated_savings
    FROM instance_stats
)
SELECT
    instance_id,
    instance_type,
    cpu_cores,
    memory_gb,
    avg_cpu_usage,
    avg_memory_usage,
    current_cost,
    optimization_action,
    ROUND(estimated_savings::numeric, 4) AS estimated_savings,
    ROUND(((current_cost - estimated_savings) * 24 * 30)::numeric, 2) AS monthly_savings
FROM optimization_recommendations
WHERE optimization_action != 'Current size appropriate'
ORDER BY monthly_savings DESC;
```

### 6.2 æ•°æ®åº“èµ„æºä¼˜åŒ–

**æ•°æ®åº“èµ„æºä¼˜åŒ–**ï¼šä¼˜åŒ–æ•°æ®åº“èµ„æºä½¿ç”¨ã€‚

```sql
-- æ•°æ®åº“èµ„æºä¼˜åŒ–ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'database_resources') THEN
            RAISE WARNING 'è¡¨ database_resources ä¸å­˜åœ¨ï¼Œåˆ›å»ºç¤ºä¾‹è¡¨';

            CREATE TABLE database_resources (
                timestamp TIMESTAMP NOT NULL,
                database_name VARCHAR(100) NOT NULL,
                connection_limit INTEGER NOT NULL,
                active_connections INTEGER NOT NULL,
                max_connections INTEGER NOT NULL,
                shared_buffers_mb INTEGER,
                work_mem_mb INTEGER,
                PRIMARY KEY (timestamp, database_name)
            );

            INSERT INTO database_resources (timestamp, database_name, connection_limit, active_connections, max_connections, shared_buffers_mb, work_mem_mb) VALUES
                ('2024-01-01 10:00:00', 'db_prod', 100, 50, 80, 4096, 256),
                ('2024-01-01 11:00:00', 'db_prod', 100, 55, 85, 4096, 256);

            RAISE NOTICE 'è¡¨ database_resources åˆ›å»ºæˆåŠŸ';
        END IF;

        RAISE NOTICE 'å¼€å§‹æ‰§è¡Œæ•°æ®åº“èµ„æºä¼˜åŒ–';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'æ•°æ®åº“èµ„æºä¼˜åŒ–å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- æ•°æ®åº“èµ„æºä¼˜åŒ–ï¼šä¼˜åŒ–è¿æ¥å’Œå†…å­˜é…ç½®
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
WITH connection_analysis AS (
    SELECT
        database_name,
        AVG(active_connections) AS avg_connections,
        MAX(active_connections) AS max_connections,
        AVG(connection_limit) AS connection_limit,
        AVG(max_connections) AS peak_connections
    FROM database_resources
    GROUP BY database_name
),
memory_analysis AS (
    SELECT
        database_name,
        AVG(shared_buffers_mb) AS avg_shared_buffers,
        AVG(work_mem_mb) AS avg_work_mem
    FROM database_resources
    GROUP BY database_name
),
optimization_recommendations AS (
    SELECT
        ca.database_name,
        ROUND(ca.avg_connections::numeric, 2) AS avg_connections,
        ROUND(ca.max_connections::numeric, 2) AS max_connections,
        ROUND(ca.connection_limit::numeric, 0) AS current_limit,
        ROUND((ca.peak_connections * 1.2)::numeric, 0) AS recommended_limit,
        ROUND(ma.avg_shared_buffers::numeric, 0) AS current_shared_buffers,
        ROUND(ma.avg_work_mem::numeric, 0) AS current_work_mem,
        CASE
            WHEN ca.avg_connections / NULLIF(ca.connection_limit, 0) < 0.3 THEN 'Reduce connection limit'
            WHEN ca.peak_connections > ca.connection_limit * 0.9 THEN 'Increase connection limit'
            ELSE 'Connection limit appropriate'
        END AS connection_optimization,
        CASE
            WHEN ca.avg_connections / NULLIF(ca.connection_limit, 0) < 0.3 THEN ca.connection_limit * 0.5
            WHEN ca.peak_connections > ca.connection_limit * 0.9 THEN ca.peak_connections * 1.2
            ELSE ca.connection_limit
        END AS recommended_connection_limit
    FROM connection_analysis ca
    JOIN memory_analysis ma ON ca.database_name = ma.database_name
)
SELECT
    database_name,
    avg_connections,
    max_connections,
    current_limit,
    ROUND(recommended_limit::numeric, 0) AS recommended_limit,
    connection_optimization,
    CASE
        WHEN recommended_limit < current_limit THEN 'Can reduce resources'
        WHEN recommended_limit > current_limit THEN 'Need more resources'
        ELSE 'Optimal'
    END AS resource_status
FROM optimization_recommendations
WHERE connection_optimization != 'Connection limit appropriate'
ORDER BY database_name;
```

### 6.3 è®¡ç®—èµ„æºä¼˜åŒ–

**è®¡ç®—èµ„æºä¼˜åŒ–**ï¼šä¼˜åŒ–è®¡ç®—èµ„æºåˆ†é…ã€‚

```sql
-- è®¡ç®—èµ„æºä¼˜åŒ–ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'compute_resources') THEN
            RAISE WARNING 'è¡¨ compute_resources ä¸å­˜åœ¨ï¼Œåˆ›å»ºç¤ºä¾‹è¡¨';

            CREATE TABLE compute_resources (
                timestamp TIMESTAMP NOT NULL,
                resource_id VARCHAR(50) NOT NULL,
                cpu_cores INTEGER NOT NULL,
                cpu_usage_pct NUMERIC(5, 2),
                memory_gb INTEGER NOT NULL,
                memory_usage_pct NUMERIC(5, 2),
                PRIMARY KEY (timestamp, resource_id)
            );

            INSERT INTO compute_resources (timestamp, resource_id, cpu_cores, cpu_usage_pct, memory_gb, memory_usage_pct) VALUES
                ('2024-01-01 10:00:00', 'COMP001', 8, 25.5, 32, 40.2),
                ('2024-01-01 11:00:00', 'COMP001', 8, 26.2, 32, 41.5),
                ('2024-01-01 10:00:00', 'COMP002', 16, 75.3, 64, 80.1),
                ('2024-01-01 11:00:00', 'COMP002', 16, 78.5, 64, 82.3);

            RAISE NOTICE 'è¡¨ compute_resources åˆ›å»ºæˆåŠŸ';
        END IF;

        RAISE NOTICE 'å¼€å§‹æ‰§è¡Œè®¡ç®—èµ„æºä¼˜åŒ–';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'è®¡ç®—èµ„æºä¼˜åŒ–å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- è®¡ç®—èµ„æºä¼˜åŒ–ï¼šä¼˜åŒ–CPUå’Œå†…å­˜åˆ†é…
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
WITH resource_stats AS (
    SELECT
        resource_id,
        cpu_cores,
        memory_gb,
        AVG(cpu_usage_pct) AS avg_cpu_usage,
        AVG(memory_usage_pct) AS avg_memory_usage,
        MAX(cpu_usage_pct) AS max_cpu_usage,
        MAX(memory_usage_pct) AS max_memory_usage
    FROM compute_resources
    GROUP BY resource_id, cpu_cores, memory_gb
),
optimization_recommendations AS (
    SELECT
        resource_id,
        cpu_cores AS current_cpu_cores,
        memory_gb AS current_memory_gb,
        ROUND(avg_cpu_usage::numeric, 2) AS avg_cpu_usage,
        ROUND(avg_memory_usage::numeric, 2) AS avg_memory_usage,
        ROUND(max_cpu_usage::numeric, 2) AS max_cpu_usage,
        ROUND(max_memory_usage::numeric, 2) AS max_memory_usage,
        CASE
            WHEN avg_cpu_usage < 30 AND avg_memory_usage < 40 THEN
                CASE
                    WHEN cpu_cores >= 8 THEN cpu_cores / 2
                    ELSE cpu_cores
                END
            WHEN avg_cpu_usage > 80 OR avg_memory_usage > 85 THEN
                CASE
                    WHEN max_cpu_usage > 90 THEN cpu_cores * 2
                    WHEN max_memory_usage > 90 THEN cpu_cores * 1.5
                    ELSE cpu_cores
                END
            ELSE cpu_cores
        END AS recommended_cpu_cores,
        CASE
            WHEN avg_cpu_usage < 30 AND avg_memory_usage < 40 THEN
                CASE
                    WHEN memory_gb >= 32 THEN memory_gb / 2
                    ELSE memory_gb
                END
            WHEN avg_cpu_usage > 80 OR avg_memory_usage > 85 THEN
                CASE
                    WHEN max_memory_usage > 90 THEN memory_gb * 2
                    WHEN max_cpu_usage > 90 THEN memory_gb * 1.5
                    ELSE memory_gb
                END
            ELSE memory_gb
        END AS recommended_memory_gb
    FROM resource_stats
)
SELECT
    resource_id,
    current_cpu_cores,
    current_memory_gb,
    avg_cpu_usage,
    avg_memory_usage,
    ROUND(recommended_cpu_cores::numeric, 0) AS recommended_cpu_cores,
    ROUND(recommended_memory_gb::numeric, 0) AS recommended_memory_gb,
    CASE
        WHEN recommended_cpu_cores < current_cpu_cores OR recommended_memory_gb < current_memory_gb THEN 'Downsize'
        WHEN recommended_cpu_cores > current_cpu_cores OR recommended_memory_gb > current_memory_gb THEN 'Upsize'
        ELSE 'Optimal'
    END AS optimization_action
FROM optimization_recommendations
WHERE recommended_cpu_cores != current_cpu_cores OR recommended_memory_gb != current_memory_gb
ORDER BY resource_id;
```

### 6.4 ç»¼åˆèµ„æºä¼˜åŒ–

**ç»¼åˆèµ„æºä¼˜åŒ–**ï¼šç»¼åˆè€ƒè™‘å¤šç§èµ„æºçš„ä¼˜åŒ–ã€‚

```sql
-- ç»¼åˆèµ„æºä¼˜åŒ–ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'resource_usage') THEN
            RAISE WARNING 'è¡¨ resource_usage ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡Œç»¼åˆèµ„æºä¼˜åŒ–';
            RETURN;
        END IF;
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'resource_costs') THEN
            RAISE WARNING 'è¡¨ resource_costs ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡Œç»¼åˆèµ„æºä¼˜åŒ–';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡Œç»¼åˆèµ„æºä¼˜åŒ–';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'ç»¼åˆèµ„æºä¼˜åŒ–å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- ç»¼åˆèµ„æºä¼˜åŒ–ï¼šç»¼åˆåˆ†æå¤šä¸ªèµ„æºç±»å‹
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
WITH resource_summary AS (
    SELECT
        resource_type,
        COUNT(DISTINCT resource_id) AS resource_count,
        AVG(allocated_capacity) AS avg_allocated,
        AVG(used_capacity) AS avg_used,
        AVG(used_capacity / NULLIF(allocated_capacity, 0)) AS avg_utilization
    FROM resource_usage
    GROUP BY resource_type
),
cost_summary AS (
    SELECT
        rs.resource_type,
        rs.resource_count,
        rs.avg_allocated,
        rs.avg_used,
        rs.avg_utilization,
        rc.cost_per_unit,
        rs.avg_allocated * rc.cost_per_unit * 24 * 30 AS monthly_cost,
        rs.avg_used * rc.cost_per_unit * 24 * 30 AS monthly_used_cost,
        (rs.avg_allocated - rs.avg_used) * rc.cost_per_unit * 24 * 30 AS monthly_waste_cost
    FROM resource_summary rs
    JOIN resource_costs rc ON rs.resource_type = rc.resource_type
),
optimization_summary AS (
    SELECT
        resource_type,
        resource_count,
        ROUND((avg_utilization * 100)::numeric, 2) AS utilization_pct,
        ROUND(monthly_cost::numeric, 2) AS monthly_cost,
        ROUND(monthly_waste_cost::numeric, 2) AS monthly_waste_cost,
        ROUND((monthly_waste_cost / NULLIF(monthly_cost, 0) * 100)::numeric, 2) AS waste_pct,
        CASE
            WHEN avg_utilization < 0.3 THEN 'Underutilized - Consider consolidation'
            WHEN avg_utilization > 0.9 THEN 'Overutilized - Consider expansion'
            WHEN waste_pct > 50 THEN 'High waste - Optimize allocation'
            ELSE 'Efficient'
        END AS optimization_status,
        CASE
            WHEN avg_utilization < 0.3 THEN monthly_waste_cost * 0.7
            WHEN waste_pct > 50 THEN monthly_waste_cost * 0.5
            ELSE 0
        END AS potential_savings
    FROM cost_summary
)
SELECT
    resource_type,
    resource_count,
    utilization_pct,
    monthly_cost,
    monthly_waste_cost,
    waste_pct,
    optimization_status,
    ROUND(potential_savings::numeric, 2) AS potential_savings
FROM optimization_summary
WHERE optimization_status != 'Efficient'
ORDER BY potential_savings DESC;
```

---

## 7. ç®—æ³•æ€§èƒ½å¯¹æ¯”ä¸ä¼˜åŒ–

### 7.1 ä¼˜åŒ–æ–¹æ³•å¯¹æ¯”

| æ–¹æ³• | æ•°å­¦å®šä¹‰ | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|---------|-----------|-----------|---------|------|------|
| **åˆ©ç”¨ç‡åˆ†æ** | $\text{Utilization} = \frac{\text{Used}}{\text{Total}}$ | $O(n)$ | $O(1)$ | èµ„æºè¯„ä¼° | ç®€å•ã€å¿«é€Ÿ | ä¸è€ƒè™‘æˆæœ¬ |
| **è´Ÿè½½å‡è¡¡** | $\min \sum_{i,j} (L_i - L_j)^2$ | $O(n \log n)$ | $O(n)$ | è´Ÿè½½åˆ†é… | å¹³è¡¡è´Ÿè½½ | å¯èƒ½å¢åŠ æˆæœ¬ |
| **æˆæœ¬ä¼˜åŒ–** | $\min C = \sum_{i} c_i \cdot r_i$ | $O(n^2)$ | $O(n)$ | æˆæœ¬ä¼˜åŒ– | é™ä½æˆæœ¬ | å¯èƒ½å½±å“æ€§èƒ½ |

### 7.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **ç´¢å¼•ä¼˜åŒ–**ï¼š
   - åœ¨(timestamp, resource_id)ä¸Šåˆ›å»ºå¤åˆç´¢å¼•
   - ä¸ºå¸¸ç”¨æŸ¥è¯¢åˆ›å»ºç´¢å¼•

2. **èšåˆä¼˜åŒ–**ï¼š
   - ä½¿ç”¨ç‰©åŒ–è§†å›¾ç¼“å­˜ç»Ÿè®¡
   - æ‰¹é‡è®¡ç®—å¤šä¸ªèµ„æº

3. **ä¼˜åŒ–ç®—æ³•**ï¼š
   - ä½¿ç”¨ç®€åŒ–ç®—æ³•
   - å¹¶è¡Œå¤„ç†

### 7.3 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

**é—®é¢˜1**ï¼šä¼˜åŒ–æ•ˆæœä¸æ˜æ˜¾

- **è§£å†³æ–¹æ¡ˆ**ï¼šå¢åŠ å†å²æ•°æ®ã€è€ƒè™‘å¤šå› ç´ ã€åŠ¨æ€è°ƒæ•´

**é—®é¢˜2**ï¼šä¼˜åŒ–åæ€§èƒ½ä¸‹é™

- **è§£å†³æ–¹æ¡ˆ**ï¼šå¹³è¡¡æˆæœ¬å’Œæ€§èƒ½ã€è®¾ç½®æ€§èƒ½é˜ˆå€¼ã€ç›‘æ§æ€§èƒ½

**é—®é¢˜3**ï¼šè®¡ç®—æ€§èƒ½æ…¢

- **è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ç‰©åŒ–è§†å›¾ã€ç´¢å¼•ä¼˜åŒ–ã€å¹¶è¡ŒæŸ¥è¯¢

**é—®é¢˜4**ï¼šèµ„æºåˆ†é…ä¸åˆç†

- **è§£å†³æ–¹æ¡ˆ**ï¼šè€ƒè™‘ä¸šåŠ¡éœ€æ±‚ã€è®¾ç½®çº¦æŸæ¡ä»¶ã€å®šæœŸè¯„ä¼°

---

## 8. æœ€ä½³å®è·µ

### 8.1 ä¼˜åŒ–æ–¹æ³•é€‰æ‹©

1. **åˆ©ç”¨ç‡ä¼˜åŒ–**ï¼šä½¿ç”¨è´Ÿè½½å‡è¡¡
2. **æˆæœ¬ä¼˜åŒ–**ï¼šä½¿ç”¨æˆæœ¬åˆ†æ
3. **ç»¼åˆä¼˜åŒ–**ï¼šç»“åˆå¤šç§æ–¹æ³•

### 8.2 æˆæœ¬æ§åˆ¶

1. **æˆæœ¬ç›‘æ§**ï¼šæŒç»­ç›‘æ§èµ„æºæˆæœ¬
2. **æˆæœ¬åˆ†æ**ï¼šå®šæœŸåˆ†ææˆæœ¬ç»“æ„
3. **æˆæœ¬ä¼˜åŒ–**ï¼šè¯†åˆ«å’Œæ¶ˆé™¤æµªè´¹

### 8.3 æ€§èƒ½å¹³è¡¡

1. **æ€§èƒ½ä¼˜å…ˆ**ï¼šå…³é”®ä¸šåŠ¡ä¼˜å…ˆæ€§èƒ½
2. **æˆæœ¬ä¼˜å…ˆ**ï¼šéå…³é”®ä¸šåŠ¡ä¼˜å…ˆæˆæœ¬
3. **å¹³è¡¡ä¼˜åŒ–**ï¼šå¹³è¡¡æ€§èƒ½å’Œæˆæœ¬

### 8.4 SQLå®ç°æ³¨æ„äº‹é¡¹

1. **åˆ©ç”¨ç‡è®¡ç®—**ï¼šå¤„ç†é™¤é›¶å’ŒNULLå€¼
2. **æˆæœ¬è®¡ç®—**ï¼šæ§åˆ¶æ•°å€¼ç²¾åº¦
3. **ä¼˜åŒ–å»ºè®®**ï¼šè€ƒè™‘ä¸šåŠ¡çº¦æŸ
4. **é”™è¯¯å¤„ç†**ï¼šæ·»åŠ é”™è¯¯å¤„ç†é€»è¾‘

---

## ğŸ“š å‚è€ƒèµ„æº

### å­¦æœ¯æ–‡çŒ®

- ã€Šèµ„æºä¼˜åŒ–ç†è®ºã€‹ï¼ˆResource Optimization Theoryï¼‰- èµ„æºä¼˜åŒ–ç†è®º
- ã€Šæˆæœ¬ä¼˜åŒ–æ–¹æ³•ã€‹ï¼ˆCost Optimization Methodsï¼‰- æˆæœ¬ä¼˜åŒ–æ–¹æ³•

### PostgreSQLå®˜æ–¹æ–‡æ¡£

- [çª—å£å‡½æ•°](https://www.postgresql.org/docs/current/tutorial-window.html)
- [èšåˆå‡½æ•°](https://www.postgresql.org/docs/current/functions-aggregate.html)
- [æ•°å­¦å‡½æ•°](https://www.postgresql.org/docs/current/functions-math.html)

### åœ¨çº¿èµ„æº

- PostgreSQLèµ„æºä¼˜åŒ–æŒ‡å—
- èµ„æºä¼˜åŒ–æ–¹æ³•è¯¦è§£
- æˆæœ¬ä¼˜åŒ–æœ€ä½³å®è·µ

### ç›¸å…³ç®—æ³•

- [æ€§èƒ½æŒ‡æ ‡è®¡ç®—](./æ€§èƒ½æŒ‡æ ‡è®¡ç®—.md) - æ€§èƒ½ç›‘æ§
- [å®¹é‡è§„åˆ’ç®—æ³•](./å®¹é‡è§„åˆ’ç®—æ³•.md) - å®¹é‡è§„åˆ’
- [é¢„æµ‹æ€§ç»´æŠ¤](./é¢„æµ‹æ€§ç»´æŠ¤.md) - é¢„æµ‹æ€§ç»´æŠ¤

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ
