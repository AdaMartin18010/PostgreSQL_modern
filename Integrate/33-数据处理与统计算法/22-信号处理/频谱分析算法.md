# PostgreSQL é¢‘è°±åˆ†æç®—æ³•å®Œæ•´æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æŠ€æœ¯æ ˆ**: PostgreSQL 17+/18+ | ä¿¡å·å¤„ç† | é¢‘è°±åˆ†æ | åŠŸç‡è°±
> **éš¾åº¦çº§åˆ«**: â­â­â­â­ (é«˜çº§)
> **å‚è€ƒæ ‡å‡†**: Spectral Analysis, Power Spectral Density, Signal Processing

---

## ğŸ“‹ ç›®å½•

- [PostgreSQL é¢‘è°±åˆ†æç®—æ³•å®Œæ•´æŒ‡å—](#postgresql-é¢‘è°±åˆ†æç®—æ³•å®Œæ•´æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [é¢‘è°±åˆ†ææ¦‚è¿°](#é¢‘è°±åˆ†ææ¦‚è¿°)
    - [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
  - [1. åŠŸç‡è°±å¯†åº¦](#1-åŠŸç‡è°±å¯†åº¦)
    - [1.1 åŠŸç‡è°±å¯†åº¦å®šä¹‰](#11-åŠŸç‡è°±å¯†åº¦å®šä¹‰)
    - [1.2 åŠŸç‡è°±å¯†åº¦è®¡ç®—](#12-åŠŸç‡è°±å¯†åº¦è®¡ç®—)
    - [1.3 å³°å€¼é¢‘ç‡æ£€æµ‹](#13-å³°å€¼é¢‘ç‡æ£€æµ‹)
  - [2. è‡ªç›¸å…³å‡½æ•°](#2-è‡ªç›¸å…³å‡½æ•°)
    - [2.1 è‡ªç›¸å…³å‡½æ•°å®šä¹‰](#21-è‡ªç›¸å…³å‡½æ•°å®šä¹‰)
    - [2.2 è‡ªç›¸å…³å‡½æ•°è®¡ç®—](#22-è‡ªç›¸å…³å‡½æ•°è®¡ç®—)
    - [2.3 å‘¨æœŸæ€§æ£€æµ‹](#23-å‘¨æœŸæ€§æ£€æµ‹)
  - [3. é¢‘è°±ç‰¹å¾æå–](#3-é¢‘è°±ç‰¹å¾æå–)
    - [3.1 é¢‘è°±è´¨å¿ƒ](#31-é¢‘è°±è´¨å¿ƒ)
    - [3.2 é¢‘è°±å¸¦å®½](#32-é¢‘è°±å¸¦å®½)
  - [ğŸ“š å‚è€ƒèµ„æº](#-å‚è€ƒèµ„æº)
  - [ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®](#-æ€§èƒ½ä¼˜åŒ–å»ºè®®)
  - [ğŸ¯ æœ€ä½³å®è·µ](#-æœ€ä½³å®è·µ)

---

## é¢‘è°±åˆ†ææ¦‚è¿°

**é¢‘è°±åˆ†æ**åˆ†æä¿¡å·çš„é¢‘ç‡æˆåˆ†å’ŒåŠŸç‡åˆ†å¸ƒï¼Œç”¨äºä¿¡å·ç‰¹å¾æå–å’Œé¢‘åŸŸåˆ†æã€‚

### æ ¸å¿ƒæ¦‚å¿µ

| æ¦‚å¿µ | å®šä¹‰ | åº”ç”¨ |
|------|------|------|
| **åŠŸç‡è°±å¯†åº¦** | ä¿¡å·åŠŸç‡åœ¨é¢‘åŸŸçš„åˆ†å¸ƒ | é¢‘ç‡æˆåˆ†åˆ†æ |
| **è‡ªç›¸å…³å‡½æ•°** | ä¿¡å·ä¸å…¶è‡ªèº«çš„ç›¸å…³æ€§ | å‘¨æœŸæ€§æ£€æµ‹ |
| **é¢‘è°±** | ä¿¡å·çš„é¢‘ç‡è¡¨ç¤º | é¢‘åŸŸç‰¹å¾æå– |

---

## 1. åŠŸç‡è°±å¯†åº¦

### 1.1 åŠŸç‡è°±å¯†åº¦å®šä¹‰

**åŠŸç‡è°±å¯†åº¦ï¼ˆPSDï¼‰**ï¼š
$$S(\omega) = |X(\omega)|^2 = X(\omega) \cdot X^*(\omega)$$

å…¶ä¸­ $X(\omega)$ æ˜¯ä¿¡å·çš„å‚…é‡Œå¶å˜æ¢ã€‚

### 1.2 åŠŸç‡è°±å¯†åº¦è®¡ç®—

```sql
-- ä¿¡å·æ•°æ®å‡†å¤‡ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'signal_spectrum') THEN
            DROP TABLE signal_spectrum, dft_coefficients CASCADE;
        END IF;

        CREATE TABLE signal_spectrum (
            sample_id SERIAL PRIMARY KEY,
            sample_time TIMESTAMP NOT NULL,
            signal_value NUMERIC NOT NULL
        );

        -- æ’å…¥ç¤ºä¾‹ä¿¡å·ï¼ˆæ­£å¼¦æ³¢ + å™ªå£°ï¼‰
        INSERT INTO signal_spectrum (sample_time, signal_value)
        SELECT
            '2024-01-01'::TIMESTAMP + (i * INTERVAL '0.1 second'),
            SIN(i * 0.1) + 0.5 * SIN(i * 0.3) + (RANDOM() - 0.5) * 0.2
        FROM generate_series(1, 1000) i;

        -- DFTç³»æ•°è¡¨ï¼ˆç®€åŒ–ï¼šä½¿ç”¨çª—å£å‡½æ•°è®¡ç®—DFTï¼‰
        CREATE TABLE dft_coefficients AS
        WITH signal_data AS (
            SELECT
                sample_id,
                signal_value,
                sample_id::NUMERIC / (SELECT COUNT(*) FROM signal_spectrum) AS normalized_index
            FROM signal_spectrum
        ),
        dft_calc AS (
            SELECT
                k AS frequency_bin,
                -- ç®€åŒ–çš„DFTè®¡ç®—ï¼ˆå®éƒ¨ï¼‰
                SUM(signal_value * COS(2 * PI() * k * normalized_index)) AS real_part,
                SUM(signal_value * SIN(2 * PI() * k * normalized_index)) AS imag_part
            FROM signal_data
            CROSS JOIN generate_series(0, 50) k  -- 0åˆ°50Hz
            GROUP BY k
        )
        SELECT
            frequency_bin,
            real_part,
            imag_part,
            SQRT(POWER(real_part, 2) + POWER(imag_part, 2)) AS magnitude
        FROM dft_calc;

        CREATE INDEX idx_dft_frequency ON dft_coefficients(frequency_bin);

        RAISE NOTICE 'é¢‘è°±åˆ†ææ•°æ®è¡¨åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE EXCEPTION 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
    END;
END $$;

-- åŠŸç‡è°±å¯†åº¦è®¡ç®—
WITH psd_calculation AS (
    SELECT
        frequency_bin,
        magnitude,
        POWER(magnitude, 2) AS power_spectrum,
        -- å½’ä¸€åŒ–PSD
        POWER(magnitude, 2) / (SELECT SUM(POWER(magnitude, 2)) FROM dft_coefficients) AS normalized_psd
    FROM dft_coefficients
    WHERE frequency_bin > 0  -- æ’é™¤DCåˆ†é‡
)
SELECT
    frequency_bin,
    ROUND(magnitude::numeric, 4) AS magnitude,
    ROUND(power_spectrum::numeric, 6) AS power_spectral_density,
    ROUND(normalized_psd::numeric, 6) AS normalized_psd,
    ROUND(100.0 * normalized_psd::numeric, 2) AS psd_percentage
FROM psd_calculation
ORDER BY power_spectrum DESC
LIMIT 20;
```

### 1.3 å³°å€¼é¢‘ç‡æ£€æµ‹

```sql
-- å³°å€¼é¢‘ç‡æ£€æµ‹ï¼šæ‰¾åˆ°åŠŸç‡è°±çš„ä¸»è¦é¢‘ç‡æˆåˆ†
WITH peak_detection AS (
    SELECT
        frequency_bin,
        power_spectrum,
        LAG(power_spectrum) OVER (ORDER BY frequency_bin) AS prev_power,
        LEAD(power_spectrum) OVER (ORDER BY frequency_bin) AS next_power
    FROM (
        SELECT
            frequency_bin,
            POWER(magnitude, 2) AS power_spectrum
        FROM dft_coefficients
        WHERE frequency_bin > 0
    ) psd
),
peaks AS (
    SELECT
        frequency_bin,
        power_spectrum,
        ROUND(power_spectrum::numeric, 6) AS peak_power
    FROM peak_detection
    WHERE power_spectrum > COALESCE(prev_power, 0)
      AND power_spectrum > COALESCE(next_power, 0)
      AND power_spectrum > (
          SELECT AVG(power_spectrum) + 2 * STDDEV(power_spectrum)
          FROM peak_detection
      )
)
SELECT
    frequency_bin AS peak_frequency,
    peak_power,
    ROW_NUMBER() OVER (ORDER BY peak_power DESC) AS peak_rank
FROM peaks
ORDER BY peak_power DESC
LIMIT 10;
```

---

## 2. è‡ªç›¸å…³å‡½æ•°

### 2.1 è‡ªç›¸å…³å‡½æ•°å®šä¹‰

**è‡ªç›¸å…³å‡½æ•°ï¼ˆACFï¼‰**ï¼š
$$R(\tau) = \mathbb{E}[x(t) \cdot x(t+\tau)]$$

### 2.2 è‡ªç›¸å…³å‡½æ•°è®¡ç®—

```sql
-- è‡ªç›¸å…³å‡½æ•°è®¡ç®—
WITH autocorrelation AS (
    SELECT
        lag_value,
        -- è‡ªç›¸å…³è®¡ç®—
        AVG(s1.signal_value * s2.signal_value) AS autocorr_value,
        COUNT(*) AS sample_count
    FROM signal_spectrum s1
    CROSS JOIN generate_series(0, 100) lag_value
    JOIN signal_spectrum s2 ON s2.sample_id = s1.sample_id + lag_value
    GROUP BY lag_value
),
normalized_acf AS (
    SELECT
        lag_value,
        autocorr_value,
        -- å½’ä¸€åŒ–ï¼šé™¤ä»¥é›¶å»¶è¿Ÿçš„è‡ªç›¸å…³ï¼ˆæ–¹å·®ï¼‰
        autocorr_value / NULLIF(
            (SELECT autocorr_value FROM autocorrelation WHERE lag_value = 0),
            0
        ) AS normalized_acf
    FROM autocorrelation
)
SELECT
    lag_value,
    ROUND(autocorr_value::numeric, 6) AS autocorrelation,
    ROUND(normalized_acf::numeric, 4) AS normalized_acf,
    CASE
        WHEN ABS(normalized_acf) > 0.7 THEN 'Strong correlation'
        WHEN ABS(normalized_acf) > 0.3 THEN 'Moderate correlation'
        ELSE 'Weak correlation'
    END AS correlation_strength
FROM normalized_acf
WHERE lag_value <= 50
ORDER BY lag_value;
```

### 2.3 å‘¨æœŸæ€§æ£€æµ‹

```sql
-- å‘¨æœŸæ€§æ£€æµ‹ï¼šä½¿ç”¨è‡ªç›¸å…³å‡½æ•°æ‰¾åˆ°å‘¨æœŸ
WITH autocorrelation AS (
    SELECT
        lag_value,
        AVG(s1.signal_value * s2.signal_value) AS autocorr_value
    FROM signal_spectrum s1
    CROSS JOIN generate_series(1, 200) lag_value
    JOIN signal_spectrum s2 ON s2.sample_id = s1.sample_id + lag_value
    GROUP BY lag_value
),
normalized_acf AS (
    SELECT
        lag_value,
        autocorr_value / NULLIF(
            (SELECT autocorr_value FROM autocorrelation WHERE lag_value = 0),
            0
        ) AS normalized_acf
    FROM autocorrelation
),
period_candidates AS (
    SELECT
        lag_value,
        normalized_acf,
        LAG(normalized_acf) OVER (ORDER BY lag_value) AS prev_acf,
        LEAD(normalized_acf) OVER (ORDER BY lag_value) AS next_acf
    FROM normalized_acf
    WHERE lag_value > 0
),
periods AS (
    SELECT
        lag_value AS period,
        normalized_acf AS peak_correlation
    FROM period_candidates
    WHERE normalized_acf > 0.5  -- æœ€å°ç›¸å…³æ€§é˜ˆå€¼
      AND normalized_acf > COALESCE(prev_acf, 0)
      AND normalized_acf > COALESCE(next_acf, 0)
)
SELECT
    period,
    ROUND(peak_correlation::numeric, 4) AS peak_correlation,
    'Detected period' AS period_type
FROM periods
ORDER BY peak_correlation DESC
LIMIT 5;
```

---

## 3. é¢‘è°±ç‰¹å¾æå–

### 3.1 é¢‘è°±è´¨å¿ƒ

**é¢‘è°±è´¨å¿ƒ**ï¼šåŠŸç‡è°±çš„åŠ æƒå¹³å‡é¢‘ç‡ã€‚

$$C = \frac{\sum_k k \cdot S(k)}{\sum_k S(k)}$$

```sql
-- é¢‘è°±è´¨å¿ƒè®¡ç®—
WITH spectral_centroid AS (
    SELECT
        SUM(frequency_bin * POWER(magnitude, 2)) /
        NULLIF(SUM(POWER(magnitude, 2)), 0) AS centroid_frequency
    FROM dft_coefficients
    WHERE frequency_bin > 0
)
SELECT
    ROUND(centroid_frequency::numeric, 4) AS spectral_centroid,
    CASE
        WHEN centroid_frequency < 10 THEN 'Low frequency dominant'
        WHEN centroid_frequency < 30 THEN 'Mid frequency dominant'
        ELSE 'High frequency dominant'
    END AS frequency_characteristic
FROM spectral_centroid;
```

### 3.2 é¢‘è°±å¸¦å®½

**é¢‘è°±å¸¦å®½**ï¼šåŠŸç‡è°±çš„åˆ†æ•£ç¨‹åº¦ã€‚

```sql
-- é¢‘è°±å¸¦å®½è®¡ç®—
WITH spectral_bandwidth AS (
    SELECT
        frequency_bin,
        POWER(magnitude, 2) AS power,
        (SELECT SUM(frequency_bin * POWER(magnitude, 2)) /
                NULLIF(SUM(POWER(magnitude, 2)), 0)
         FROM dft_coefficients WHERE frequency_bin > 0) AS centroid
    FROM dft_coefficients
    WHERE frequency_bin > 0
)
SELECT
    SQRT(
        SUM(POWER(frequency_bin - centroid, 2) * power) /
        NULLIF(SUM(power), 0)
    ) AS spectral_bandwidth
FROM spectral_bandwidth;
```

---

## ğŸ“š å‚è€ƒèµ„æº

1. **Oppenheim, A.V., Schafer, R.W. (2010)**: "Discrete-Time Signal Processing", 3rd Edition
2. **Stoica, P., Moses, R.L. (2005)**: "Spectral Analysis of Signals"

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **FFTä¼˜åŒ–**ï¼šä½¿ç”¨å¿«é€Ÿå‚…é‡Œå¶å˜æ¢åŠ é€Ÿè®¡ç®—
2. **çª—å£å‡½æ•°**ï¼šä½¿ç”¨çª—å£å‡½æ•°å‡å°‘é¢‘è°±æ³„æ¼
3. **å¹¶è¡Œè®¡ç®—**ï¼šå¹¶è¡Œè®¡ç®—ä¸åŒé¢‘ç‡çš„DFTç³»æ•°
4. **ç¼“å­˜ç»“æœ**ï¼šç¼“å­˜å¸¸ç”¨çš„é¢‘è°±åˆ†æç»“æœ

---

## ğŸ¯ æœ€ä½³å®è·µ

1. **é‡‡æ ·ç‡é€‰æ‹©**ï¼šæ ¹æ®ä¿¡å·ç‰¹æ€§é€‰æ‹©åˆé€‚é‡‡æ ·ç‡
2. **çª—å£å¤§å°**ï¼šå¹³è¡¡é¢‘ç‡åˆ†è¾¨ç‡å’Œæ—¶é—´åˆ†è¾¨ç‡
3. **é¢‘è°±æ³„æ¼**ï¼šä½¿ç”¨çª—å‡½æ•°å‡å°‘é¢‘è°±æ³„æ¼
4. **å™ªå£°å¤„ç†**ï¼šé¢„å¤„ç†å»é™¤å™ªå£°å½±å“

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ
