# PostgreSQL æ•°å­—æ»¤æ³¢ç®—æ³•å®Œæ•´æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æŠ€æœ¯æ ˆ**: PostgreSQL 17+/18+ | ä¿¡å·å¤„ç† | æ•°å­—æ»¤æ³¢ | é¢‘åŸŸæ»¤æ³¢
> **éš¾åº¦çº§åˆ«**: â­â­â­â­ (é«˜çº§)
> **å‚è€ƒæ ‡å‡†**: Digital Signal Processing, Filter Design, Signal Filtering

---

## ğŸ“‹ ç›®å½•

- [PostgreSQL æ•°å­—æ»¤æ³¢ç®—æ³•å®Œæ•´æŒ‡å—](#postgresql-æ•°å­—æ»¤æ³¢ç®—æ³•å®Œæ•´æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [æ•°å­—æ»¤æ³¢æ¦‚è¿°](#æ•°å­—æ»¤æ³¢æ¦‚è¿°)
    - [æ»¤æ³¢å™¨åˆ†ç±»](#æ»¤æ³¢å™¨åˆ†ç±»)
  - [1. ç§»åŠ¨å¹³å‡æ»¤æ³¢](#1-ç§»åŠ¨å¹³å‡æ»¤æ³¢)
    - [1.1 ç®€å•ç§»åŠ¨å¹³å‡ï¼ˆSMAï¼‰](#11-ç®€å•ç§»åŠ¨å¹³å‡sma)
    - [1.2 æŒ‡æ•°ç§»åŠ¨å¹³å‡ï¼ˆEMAï¼‰](#12-æŒ‡æ•°ç§»åŠ¨å¹³å‡ema)
  - [2. ä½é€šæ»¤æ³¢](#2-ä½é€šæ»¤æ³¢)
    - [2.1 ç†æƒ³ä½é€šæ»¤æ³¢](#21-ç†æƒ³ä½é€šæ»¤æ³¢)
    - [2.2 Butterworthä½é€šæ»¤æ³¢](#22-butterworthä½é€šæ»¤æ³¢)
  - [3. é«˜é€šæ»¤æ³¢](#3-é«˜é€šæ»¤æ³¢)
    - [3.1 ç†æƒ³é«˜é€šæ»¤æ³¢](#31-ç†æƒ³é«˜é€šæ»¤æ³¢)
    - [3.2 é«˜é€šæ»¤æ³¢å®ç°](#32-é«˜é€šæ»¤æ³¢å®ç°)
  - [4. å¸¦é€šæ»¤æ³¢](#4-å¸¦é€šæ»¤æ³¢)
    - [4.1 å¸¦é€šæ»¤æ³¢åŸç†](#41-å¸¦é€šæ»¤æ³¢åŸç†)
  - [5. æ»¤æ³¢å™¨æ€§èƒ½è¯„ä¼°](#5-æ»¤æ³¢å™¨æ€§èƒ½è¯„ä¼°)
    - [5.1 ä¿¡å™ªæ¯”æ”¹å–„](#51-ä¿¡å™ªæ¯”æ”¹å–„)
  - [ğŸ“š å‚è€ƒèµ„æº](#-å‚è€ƒèµ„æº)
  - [ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®](#-æ€§èƒ½ä¼˜åŒ–å»ºè®®)
  - [ğŸ¯ æœ€ä½³å®è·µ](#-æœ€ä½³å®è·µ)

---

## æ•°å­—æ»¤æ³¢æ¦‚è¿°

**æ•°å­—æ»¤æ³¢**ç”¨äºå»é™¤ä¿¡å·ä¸­çš„å™ªå£°æˆ–æå–ç‰¹å®šé¢‘ç‡æˆåˆ†ã€‚

### æ»¤æ³¢å™¨åˆ†ç±»

| ç±»å‹ | åŠŸèƒ½ | åº”ç”¨åœºæ™¯ |
|------|------|---------|
| **ä½é€šæ»¤æ³¢** | ä¿ç•™ä½é¢‘ï¼Œå»é™¤é«˜é¢‘ | å»å™ªã€å¹³æ»‘ |
| **é«˜é€šæ»¤æ³¢** | ä¿ç•™é«˜é¢‘ï¼Œå»é™¤ä½é¢‘ | è¾¹ç¼˜æ£€æµ‹ã€è¶‹åŠ¿å»é™¤ |
| **å¸¦é€šæ»¤æ³¢** | ä¿ç•™ç‰¹å®šé¢‘æ®µ | ä¿¡å·æå– |
| **å¸¦é˜»æ»¤æ³¢** | å»é™¤ç‰¹å®šé¢‘æ®µ | å¹²æ‰°å»é™¤ |

---

## 1. ç§»åŠ¨å¹³å‡æ»¤æ³¢

### 1.1 ç®€å•ç§»åŠ¨å¹³å‡ï¼ˆSMAï¼‰

**ç®€å•ç§»åŠ¨å¹³å‡**æ˜¯æœ€åŸºæœ¬çš„ä½é€šæ»¤æ³¢å™¨ã€‚

**ä¼ é€’å‡½æ•°**ï¼š$H(z) = \frac{1}{N}\sum_{k=0}^{N-1} z^{-k}$

```sql
-- ä¿¡å·æ•°æ®å‡†å¤‡ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'signal_samples') THEN
            DROP TABLE signal_samples CASCADE;
        END IF;

        CREATE TABLE signal_samples (
            sample_id SERIAL PRIMARY KEY,
            sample_time TIMESTAMP NOT NULL,
            signal_value NUMERIC NOT NULL,
            noise_level NUMERIC DEFAULT 0.1
        );

        -- æ’å…¥ç¤ºä¾‹ä¿¡å·ï¼ˆæ­£å¼¦æ³¢ + å™ªå£°ï¼‰
        INSERT INTO signal_samples (sample_time, signal_value)
        SELECT
            '2024-01-01'::TIMESTAMP + (i * INTERVAL '1 second'),
            SIN(i * 0.1) + (RANDOM() - 0.5) * 0.5 AS signal_value
        FROM generate_series(1, 1000) i;

        CREATE INDEX idx_signal_time ON signal_samples(sample_time);

        RAISE NOTICE 'ä¿¡å·æ•°æ®è¡¨åˆ›å»ºæˆåŠŸï¼Œå…± % æ¡è®°å½•', (SELECT COUNT(*) FROM signal_samples);
    EXCEPTION
        WHEN OTHERS THEN
            RAISE EXCEPTION 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
    END;
END $$;

-- ç®€å•ç§»åŠ¨å¹³å‡æ»¤æ³¢ï¼ˆçª—å£å¤§å°=5ï¼‰
WITH sma_filtered AS (
    SELECT
        sample_id,
        sample_time,
        signal_value,
        AVG(signal_value) OVER (
            ORDER BY sample_id
            ROWS BETWEEN 4 PRECEDING AND CURRENT ROW
        ) AS filtered_value,
        COUNT(*) OVER (
            ORDER BY sample_id
            ROWS BETWEEN 4 PRECEDING AND CURRENT ROW
        ) AS window_size
    FROM signal_samples
)
SELECT
    sample_id,
    sample_time,
    ROUND(signal_value::numeric, 4) AS original_signal,
    ROUND(filtered_value::numeric, 4) AS filtered_signal,
    ROUND(ABS(signal_value - filtered_value)::numeric, 4) AS noise_reduction
FROM sma_filtered
WHERE window_size = 5  -- å®Œæ•´çª—å£
ORDER BY sample_id
LIMIT 50;
```

### 1.2 æŒ‡æ•°ç§»åŠ¨å¹³å‡ï¼ˆEMAï¼‰

**æŒ‡æ•°ç§»åŠ¨å¹³å‡**å¯¹è¿‘æœŸæ•°æ®èµ‹äºˆæ›´é«˜æƒé‡ã€‚

**æ›´æ–°å…¬å¼**ï¼š$EMA_t = \alpha \cdot x_t + (1-\alpha) \cdot EMA_{t-1}$

å…¶ä¸­ $\alpha$ æ˜¯å¹³æ»‘å› å­ï¼ˆé€šå¸¸ $\alpha = 2/(N+1)$ï¼ŒNæ˜¯çª—å£å¤§å°ï¼‰ã€‚

```sql
-- æŒ‡æ•°ç§»åŠ¨å¹³å‡æ»¤æ³¢
WITH ema_calculation AS (
    SELECT
        sample_id,
        signal_value,
        0.2 AS alpha,  -- å¹³æ»‘å› å­
        -- é€’å½’è®¡ç®—EMAï¼ˆä½¿ç”¨çª—å£å‡½æ•°è¿‘ä¼¼ï¼‰
        SUM(signal_value * POWER(1 - 0.2, ROW_NUMBER() OVER (ORDER BY sample_id DESC) - 1))
        OVER (ORDER BY sample_id ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)
        / SUM(POWER(1 - 0.2, ROW_NUMBER() OVER (ORDER BY sample_id DESC) - 1))
        OVER (ORDER BY sample_id ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS ema_value
    FROM signal_samples
)
SELECT
    sample_id,
    ROUND(signal_value::numeric, 4) AS original,
    ROUND(ema_value::numeric, 4) AS ema_filtered
FROM ema_calculation
ORDER BY sample_id
LIMIT 50;
```

---

## 2. ä½é€šæ»¤æ³¢

### 2.1 ç†æƒ³ä½é€šæ»¤æ³¢

**ç†æƒ³ä½é€šæ»¤æ³¢**åœ¨é¢‘åŸŸä¸­å®Œå…¨ä¿ç•™ä½é¢‘ï¼Œå»é™¤é«˜é¢‘ã€‚

**é¢‘ç‡å“åº”**ï¼š
$$
H(\omega) = \begin{cases}
1 & |\omega| \leq \omega_c \\
0 & |\omega| > \omega_c
\end{cases}
$$

### 2.2 Butterworthä½é€šæ»¤æ³¢

**Butterworthæ»¤æ³¢å™¨**å…·æœ‰æœ€å¹³å¦çš„é€šå¸¦å“åº”ã€‚

**ä¼ é€’å‡½æ•°**ï¼š$|H(\omega)|^2 = \frac{1}{1 + (\omega/\omega_c)^{2n}}$

å…¶ä¸­ $n$ æ˜¯æ»¤æ³¢å™¨é˜¶æ•°ï¼Œ$\omega_c$ æ˜¯æˆªæ­¢é¢‘ç‡ã€‚

```sql
-- Butterworthä½é€šæ»¤æ³¢ï¼ˆç®€åŒ–å®ç°ï¼‰
WITH frequency_analysis AS (
    SELECT
        sample_id,
        signal_value,
        -- è®¡ç®—é¢‘ç‡ï¼ˆç®€åŒ–ï¼šå‡è®¾é‡‡æ ·é¢‘ç‡=1Hzï¼‰
        sample_id::NUMERIC / (SELECT COUNT(*) FROM signal_samples) AS frequency
    FROM signal_samples
),
butterworth_filter AS (
    SELECT
        sample_id,
        signal_value,
        frequency,
        0.1 AS cutoff_frequency,  -- æˆªæ­¢é¢‘ç‡
        2 AS filter_order,  -- æ»¤æ³¢å™¨é˜¶æ•°
        -- Butterworthé¢‘ç‡å“åº”
        1.0 / SQRT(1 + POWER(frequency / 0.1, 2 * 2)) AS filter_gain
    FROM frequency_analysis
)
SELECT
    sample_id,
    ROUND(signal_value::numeric, 4) AS original,
    ROUND((signal_value * filter_gain)::numeric, 4) AS filtered,
    ROUND(filter_gain::numeric, 4) AS gain
FROM butterworth_filter
ORDER BY sample_id
LIMIT 50;
```

---

## 3. é«˜é€šæ»¤æ³¢

### 3.1 ç†æƒ³é«˜é€šæ»¤æ³¢

**ç†æƒ³é«˜é€šæ»¤æ³¢**å»é™¤ä½é¢‘ï¼Œä¿ç•™é«˜é¢‘ã€‚

**é¢‘ç‡å“åº”**ï¼š
$$
H(\omega) = \begin{cases}
0 & |\omega| \leq \omega_c \\
1 & |\omega| > \omega_c
\end{cases}
$$

### 3.2 é«˜é€šæ»¤æ³¢å®ç°

```sql
-- é«˜é€šæ»¤æ³¢ï¼šå»é™¤è¶‹åŠ¿ï¼Œä¿ç•™ç»†èŠ‚
WITH trend_removal AS (
    SELECT
        sample_id,
        signal_value,
        -- è®¡ç®—è¶‹åŠ¿ï¼ˆä½¿ç”¨ç§»åŠ¨å¹³å‡ï¼‰
        AVG(signal_value) OVER (
            ORDER BY sample_id
            ROWS BETWEEN 9 PRECEDING AND CURRENT ROW
        ) AS trend,
        -- é«˜é€šæ»¤æ³¢ï¼šåŸå§‹ä¿¡å· - è¶‹åŠ¿
        signal_value - AVG(signal_value) OVER (
            ORDER BY sample_id
            ROWS BETWEEN 9 PRECEDING AND CURRENT ROW
        ) AS highpass_filtered
    FROM signal_samples
)
SELECT
    sample_id,
    ROUND(signal_value::numeric, 4) AS original,
    ROUND(trend::numeric, 4) AS trend,
    ROUND(highpass_filtered::numeric, 4) AS highpass_signal
FROM trend_removal
ORDER BY sample_id
LIMIT 50;
```

---

## 4. å¸¦é€šæ»¤æ³¢

### 4.1 å¸¦é€šæ»¤æ³¢åŸç†

**å¸¦é€šæ»¤æ³¢**åªä¿ç•™ç‰¹å®šé¢‘ç‡èŒƒå›´çš„ä¿¡å·ã€‚

**é¢‘ç‡å“åº”**ï¼š
$$
H(\omega) = \begin{cases}
1 & \omega_1 \leq |\omega| \leq \omega_2 \\
0 & \text{å…¶ä»–}
\end{cases}
$$

```sql
-- å¸¦é€šæ»¤æ³¢ï¼šæå–ç‰¹å®šé¢‘æ®µ
WITH bandpass_filter AS (
    SELECT
        sample_id,
        signal_value,
        sample_id::NUMERIC / (SELECT COUNT(*) FROM signal_samples) AS frequency,
        0.05 AS lower_cutoff,  -- ä¸‹æˆªæ­¢é¢‘ç‡
        0.15 AS upper_cutoff   -- ä¸Šæˆªæ­¢é¢‘ç‡
    FROM signal_samples
),
filtered_signal AS (
    SELECT
        sample_id,
        signal_value,
        frequency,
        CASE
            WHEN frequency BETWEEN lower_cutoff AND upper_cutoff THEN signal_value
            ELSE 0
        END AS bandpass_filtered
    FROM bandpass_filter
)
SELECT
    sample_id,
    ROUND(signal_value::numeric, 4) AS original,
    ROUND(bandpass_filtered::numeric, 4) AS bandpass_signal,
    ROUND(frequency::numeric, 4) AS frequency
FROM filtered_signal
WHERE bandpass_filtered != 0
ORDER BY sample_id
LIMIT 50;
```

---

## 5. æ»¤æ³¢å™¨æ€§èƒ½è¯„ä¼°

### 5.1 ä¿¡å™ªæ¯”æ”¹å–„

```sql
-- æ»¤æ³¢å™¨æ€§èƒ½è¯„ä¼°ï¼šä¿¡å™ªæ¯”æ”¹å–„
WITH filter_performance AS (
    SELECT
        AVG(POWER(signal_value, 2)) AS original_power,
        AVG(POWER(
            signal_value - AVG(signal_value) OVER (
                ORDER BY sample_id
                ROWS BETWEEN 4 PRECEDING AND CURRENT ROW
            ), 2
        )) AS filtered_power
    FROM signal_samples
    WHERE sample_id > 5
),
snr_improvement AS (
    SELECT
        original_power,
        filtered_power,
        10 * LOG10(original_power / NULLIF(filtered_power, 0)) AS snr_db
    FROM filter_performance
)
SELECT
    ROUND(original_power::numeric, 4) AS original_signal_power,
    ROUND(filtered_power::numeric, 4) AS filtered_signal_power,
    ROUND(snr_db::numeric, 2) AS snr_improvement_db
FROM snr_improvement;
```

---

## ğŸ“š å‚è€ƒèµ„æº

1. **Oppenheim, A.V., Schafer, R.W. (2010)**: "Discrete-Time Signal Processing", 3rd Edition
2. **Proakis, J.G., Manolakis, D.G. (2006)**: "Digital Signal Processing", 4th Edition

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **é€‰æ‹©åˆé€‚çš„çª—å£å¤§å°**ï¼šå¹³è¡¡å¹³æ»‘åº¦å’Œå“åº”é€Ÿåº¦
2. **ä½¿ç”¨ç´¢å¼•**ï¼šåœ¨æ—¶é—´åˆ—ä¸Šåˆ›å»ºç´¢å¼•
3. **å¹¶è¡Œè®¡ç®—**ï¼šåˆ©ç”¨çª—å£å‡½æ•°çš„å¹¶è¡Œæ€§
4. **ç¼“å­˜ä¸­é—´ç»“æœ**ï¼šä½¿ç”¨ç‰©åŒ–è§†å›¾ç¼“å­˜æ»¤æ³¢ç»“æœ

---

## ğŸ¯ æœ€ä½³å®è·µ

1. **æ»¤æ³¢å™¨é€‰æ‹©**ï¼šæ ¹æ®åº”ç”¨åœºæ™¯é€‰æ‹©åˆé€‚æ»¤æ³¢å™¨
2. **å‚æ•°è°ƒä¼˜**ï¼šé€šè¿‡å®éªŒç¡®å®šæœ€ä¼˜å‚æ•°
3. **æ€§èƒ½ç›‘æ§**ï¼šç›‘æ§æ»¤æ³¢è®¡ç®—æ€§èƒ½
4. **ç»“æœéªŒè¯**ï¼šä½¿ç”¨é¢‘åŸŸåˆ†æéªŒè¯æ»¤æ³¢æ•ˆæœ

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ
