# PostgreSQL å¼ é‡åˆ†è§£ç®—æ³•å®Œæ•´æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æŠ€æœ¯æ ˆ**: PostgreSQL 17+/18+ | å¼ é‡åˆ†è§£ | å¤šç»´æ•°æ®åˆ†æ | CPåˆ†è§£
> **éš¾åº¦çº§åˆ«**: â­â­â­â­â­ (ä¸“å®¶çº§)
> **å‚è€ƒæ ‡å‡†**: Tensor Decomposition, Multilinear Algebra, Data Mining

---

## ğŸ“‹ ç›®å½•

- [PostgreSQL å¼ é‡åˆ†è§£ç®—æ³•å®Œæ•´æŒ‡å—](#postgresql-å¼ é‡åˆ†è§£ç®—æ³•å®Œæ•´æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [å¼ é‡åˆ†è§£æ¦‚è¿°](#å¼ é‡åˆ†è§£æ¦‚è¿°)
    - [ç†è®ºåŸºç¡€](#ç†è®ºåŸºç¡€)
    - [æ•°å­¦å®šä¹‰](#æ•°å­¦å®šä¹‰)
    - [åº”ç”¨åœºæ™¯](#åº”ç”¨åœºæ™¯)
  - [1. CPåˆ†è§£](#1-cpåˆ†è§£)
    - [1.1 CPåˆ†è§£åŸç†](#11-cpåˆ†è§£åŸç†)
    - [1.2 ç§©ä¼°è®¡](#12-ç§©ä¼°è®¡)
  - [ğŸ“š å‚è€ƒèµ„æº](#-å‚è€ƒèµ„æº)
    - [æƒå¨æ–‡çŒ®](#æƒå¨æ–‡çŒ®)
    - [åœ¨çº¿èµ„æº](#åœ¨çº¿èµ„æº)
  - [ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®](#-æ€§èƒ½ä¼˜åŒ–å»ºè®®)
  - [ğŸ¯ æœ€ä½³å®è·µ](#-æœ€ä½³å®è·µ)

---

## å¼ é‡åˆ†è§£æ¦‚è¿°

**å¼ é‡åˆ†è§£**å°†é«˜ç»´å¼ é‡åˆ†è§£ä¸ºä½ç»´å› å­çš„ç»„åˆï¼Œç”¨äºå¤šç»´æ•°æ®åˆ†æå’Œé™ç»´ã€‚

### ç†è®ºåŸºç¡€

**å¼ é‡**æ˜¯å¤šç»´æ•°ç»„çš„æ¨å¹¿ï¼ŒçŸ©é˜µæ˜¯2é˜¶å¼ é‡ã€‚

### æ•°å­¦å®šä¹‰

**3é˜¶å¼ é‡** $\mathcal{X} \in \mathbb{R}^{I \times J \times K}$ å¯ä»¥åˆ†è§£ä¸ºï¼š

**CPåˆ†è§£**: $\mathcal{X} \approx \sum_{r=1}^{R} a_r \circ b_r \circ c_r$

**Tuckeråˆ†è§£**: $\mathcal{X} \approx \mathcal{G} \times_1 A \times_2 B \times_3 C$

### åº”ç”¨åœºæ™¯

| åº”ç”¨é¢†åŸŸ | å…·ä½“åº”ç”¨ |
|---------|---------|
| **æ¨èç³»ç»Ÿ** | å¤šç»´æ¨è |
| **å›¾åƒå¤„ç†** | å›¾åƒå‹ç¼©ã€å»å™ª |
| **ç¤¾äº¤ç½‘ç»œ** | å¤šç»´å…³ç³»åˆ†æ |

---

## 1. CPåˆ†è§£

### 1.1 CPåˆ†è§£åŸç†

**CPï¼ˆCANDECOMP/PARAFACï¼‰åˆ†è§£**å°†å¼ é‡åˆ†è§£ä¸ºç§©1å¼ é‡çš„å’Œã€‚

**æ•°å­¦å®šä¹‰**ï¼šå¯¹äº3é˜¶å¼ é‡ $\mathcal{X} \in \mathbb{R}^{I \times J \times K}$ï¼ŒCPåˆ†è§£ä¸ºï¼š

$$\mathcal{X} \approx \sum_{r=1}^{R} a_r \circ b_r \circ c_r$$

å…¶ä¸­ï¼š

- $a_r \in \mathbb{R}^I$ï¼Œ$b_r \in \mathbb{R}^J$ï¼Œ$c_r \in \mathbb{R}^K$ æ˜¯å› å­å‘é‡
- $R$ æ˜¯ç§©ï¼ˆrankï¼‰
- $\circ$ è¡¨ç¤ºå¤–ç§¯

**å…ƒç´ å½¢å¼**ï¼š
$$x_{ijk} \approx \sum_{r=1}^{R} a_{ir} b_{jr} c_{kr}$$

**ALSç®—æ³•**ï¼ˆäº¤æ›¿æœ€å°äºŒä¹˜æ³•ï¼‰ï¼š

1. åˆå§‹åŒ–å› å­çŸ©é˜µ $A, B, C$
2. å›ºå®š $B, C$ï¼Œæ›´æ–° $A$
3. å›ºå®š $A, C$ï¼Œæ›´æ–° $B$
4. å›ºå®š $A, B$ï¼Œæ›´æ–° $C$
5. é‡å¤æ­¥éª¤2-4ç›´åˆ°æ”¶æ•›

```sql
-- å¼ é‡æ•°æ®å‡†å¤‡ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'tensor_data') THEN
            RAISE WARNING 'è¡¨ tensor_data å·²å­˜åœ¨ï¼Œå…ˆåˆ é™¤';
            DROP TABLE tensor_data CASCADE;
        END IF;

        CREATE TABLE tensor_data (
            i INTEGER NOT NULL,
            j INTEGER NOT NULL,
            k INTEGER NOT NULL,
            value NUMERIC NOT NULL,
            PRIMARY KEY (i, j, k)
        );

        -- æ’å…¥3é˜¶å¼ é‡æ•°æ®ï¼ˆç¤ºä¾‹ï¼šç”¨æˆ·-å•†å“-æ—¶é—´ï¼‰
        INSERT INTO tensor_data (i, j, k, value) VALUES
            (1, 1, 1, 5.0), (1, 1, 2, 4.0), (1, 2, 1, 3.0), (1, 2, 2, 2.0),
            (2, 1, 1, 4.0), (2, 1, 2, 3.0), (2, 2, 1, 2.0), (2, 2, 2, 1.0),
            (3, 1, 1, 3.0), (3, 1, 2, 2.0), (3, 2, 1, 1.0), (3, 2, 2, 0.5);

        RAISE NOTICE 'è¡¨ tensor_data åˆ›å»ºæˆåŠŸï¼Œå…± % æ¡è®°å½•', (SELECT COUNT(*) FROM tensor_data);
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ tensor_data å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE EXCEPTION 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
    END;
END $$;

-- CPåˆ†è§£ï¼šåˆå§‹åŒ–å› å­çŸ©é˜µ
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'cp_factor_a') THEN
            DROP TABLE cp_factor_a, cp_factor_b, cp_factor_c CASCADE;
        END IF;

        -- å› å­çŸ©é˜µA (I x R)
        CREATE TABLE cp_factor_a (
            i INTEGER NOT NULL,
            r INTEGER NOT NULL,
            value NUMERIC DEFAULT (RANDOM() * 0.1),
            PRIMARY KEY (i, r)
        );

        -- å› å­çŸ©é˜µB (J x R)
        CREATE TABLE cp_factor_b (
            j INTEGER NOT NULL,
            r INTEGER NOT NULL,
            value NUMERIC DEFAULT (RANDOM() * 0.1),
            PRIMARY KEY (j, r)
        );

        -- å› å­çŸ©é˜µC (K x R)
        CREATE TABLE cp_factor_c (
            k INTEGER NOT NULL,
            r INTEGER NOT NULL,
            value NUMERIC DEFAULT (RANDOM() * 0.1),
            PRIMARY KEY (k, r)
        );

        -- åˆå§‹åŒ–ï¼ˆR=2ï¼‰
        INSERT INTO cp_factor_a (i, r) SELECT DISTINCT i, r FROM tensor_data CROSS JOIN generate_series(1, 2) AS r;
        INSERT INTO cp_factor_b (j, r) SELECT DISTINCT j, r FROM tensor_data CROSS JOIN generate_series(1, 2) AS r;
        INSERT INTO cp_factor_c (k, r) SELECT DISTINCT k, r FROM tensor_data CROSS JOIN generate_series(1, 2) AS r;

        RAISE NOTICE 'å› å­çŸ©é˜µåˆå§‹åŒ–å®Œæˆ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE EXCEPTION 'åˆå§‹åŒ–å› å­çŸ©é˜µå¤±è´¥: %', SQLERRM;
    END;
END $$;

-- CPåˆ†è§£ï¼šALSè¿­ä»£æ›´æ–°ï¼ˆæ›´æ–°å› å­çŸ©é˜µAï¼‰
WITH reconstructed AS (
    SELECT
        td.i,
        td.j,
        td.k,
        td.value AS original_value,
        SUM(a.value * b.value * c.value) AS reconstructed_value
    FROM tensor_data td
    JOIN cp_factor_a a ON td.i = a.i
    JOIN cp_factor_b b ON td.j = b.j AND a.r = b.r
    JOIN cp_factor_c c ON td.k = c.k AND a.r = c.r
    GROUP BY td.i, td.j, td.k, td.value
),
factor_a_update AS (
    SELECT
        a.i,
        a.r,
        -- ALSæ›´æ–°å…¬å¼ï¼ˆç®€åŒ–ç‰ˆï¼‰
        a.value + 0.01 * SUM((r.original_value - r.reconstructed_value) *
            (SELECT AVG(b.value * c.value)
             FROM cp_factor_b b
             JOIN cp_factor_c c ON b.r = c.r AND b.r = a.r
             WHERE b.j IN (SELECT j FROM tensor_data WHERE i = a.i)
               AND c.k IN (SELECT k FROM tensor_data WHERE i = a.i))) AS new_value
    FROM cp_factor_a a
    JOIN reconstructed r ON a.i = r.i
    GROUP BY a.i, a.r, a.value
)
SELECT
    i,
    r,
    ROUND(new_value::numeric, 6) AS updated_value
FROM factor_a_update
ORDER BY i, r;
```

### 1.2 ç§©ä¼°è®¡

**ç§©ä¼°è®¡**ç¡®å®šCPåˆ†è§£çš„åˆé€‚ç§©æ•°ã€‚

**æ–¹æ³•**ï¼š

1. **äº¤å‰éªŒè¯**ï¼šä½¿ç”¨ä¸åŒç§©è¿›è¡Œåˆ†è§£ï¼Œé€‰æ‹©æœ€å°é‡æ„è¯¯å·®
2. **æ ¸èŒƒæ•°**ï¼šä½¿ç”¨æ ¸èŒƒæ•°ä½œä¸ºç§©çš„ä»£ç†
3. **ä¿¡æ¯å‡†åˆ™**ï¼šAICã€BICç­‰

```sql
-- ç§©ä¼°è®¡ï¼šè®¡ç®—ä¸åŒç§©çš„é‡æ„è¯¯å·®
WITH rank_candidates AS (
    SELECT r FROM generate_series(1, 5) AS r
),
reconstruction_errors AS (
    SELECT
        r.r AS rank_value,
        AVG(POWER(td.value -
            (SELECT COALESCE(SUM(a.value * b.value * c.value), 0)
             FROM cp_factor_a a
             JOIN cp_factor_b b ON a.r = b.r
             JOIN cp_factor_c c ON a.r = c.r
             WHERE a.i = td.i AND b.j = td.j AND c.k = td.k
             LIMIT 1), 2)) AS mse
    FROM rank_candidates r
    CROSS JOIN tensor_data td
    GROUP BY r.r
)
SELECT
    rank_value,
    ROUND(mse::numeric, 6) AS mean_squared_error,
    CASE
        WHEN mse = (SELECT MIN(mse) FROM reconstruction_errors) THEN 'â† Optimal'
        ELSE ''
    END AS recommendation
FROM reconstruction_errors
ORDER BY rank_value;
```

---

## ğŸ“š å‚è€ƒèµ„æº

### æƒå¨æ–‡çŒ®

1. **Kolda, T.G., Bader, B.W. (2009)**: "Tensor Decompositions and Applications", SIAM Review, 51(3), 455-500
2. **Tucker, L.R. (1966)**: "Some mathematical notes on three-mode factor analysis", Psychometrika, 31(3), 279-311
3. **Carroll, J.D., Chang, J.J. (1970)**: "Analysis of individual differences in multidimensional scaling via an N-way generalization of 'Eckart-Young' decomposition", Psychometrika, 35(3), 283-319

### åœ¨çº¿èµ„æº

- Tensor Toolbox (MATLAB): <https://www.tensortoolbox.org/>
- TensorLy (Python): <https://tensorly.org/>

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **é€‰æ‹©åˆé€‚çš„ç§©**ï¼šä½¿ç”¨äº¤å‰éªŒè¯é€‰æ‹©æœ€ä¼˜ç§©
2. **åˆå§‹åŒ–ç­–ç•¥**ï¼šä½¿ç”¨SVDåˆå§‹åŒ–å› å­çŸ©é˜µ
3. **æ­£åˆ™åŒ–**ï¼šæ·»åŠ L1/L2æ­£åˆ™åŒ–é˜²æ­¢è¿‡æ‹Ÿåˆ
4. **å¹¶è¡Œè®¡ç®—**ï¼šåˆ©ç”¨PostgreSQLå¹¶è¡ŒæŸ¥è¯¢åŠ é€Ÿ

---

## ğŸ¯ æœ€ä½³å®è·µ

1. **æ•°æ®é¢„å¤„ç†**ï¼šæ ‡å‡†åŒ–æ•°æ®ï¼Œå¤„ç†ç¼ºå¤±å€¼
2. **ç§©é€‰æ‹©**ï¼šä»è¾ƒå°ç§©å¼€å§‹ï¼Œé€æ­¥å¢åŠ 
3. **æ”¶æ•›åˆ¤æ–­**ï¼šè®¾ç½®åˆç†çš„æ”¶æ•›é˜ˆå€¼å’Œæœ€å¤§è¿­ä»£æ¬¡æ•°
4. **éªŒè¯**ï¼šä½¿ç”¨äº¤å‰éªŒè¯è¯„ä¼°åˆ†è§£è´¨é‡

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ
