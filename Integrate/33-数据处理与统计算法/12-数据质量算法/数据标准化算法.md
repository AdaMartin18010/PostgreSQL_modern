# PostgreSQL æ•°æ®æ ‡å‡†åŒ–ç®—æ³•å®Œæ•´æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æŠ€æœ¯æ ˆ**: PostgreSQL 17+/18+ | æ•°æ®æ ‡å‡†åŒ– | æ•°æ®è§„èŒƒåŒ–
> **éš¾åº¦çº§åˆ«**: â­â­â­ (ä¸­çº§)

---

## ğŸ“‹ ç›®å½•

- [PostgreSQL æ•°æ®æ ‡å‡†åŒ–ç®—æ³•å®Œæ•´æŒ‡å—](#postgresql-æ•°æ®æ ‡å‡†åŒ–ç®—æ³•å®Œæ•´æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [æ•°æ®æ ‡å‡†åŒ–æ¦‚è¿°](#æ•°æ®æ ‡å‡†åŒ–æ¦‚è¿°)
    - [ç†è®ºåŸºç¡€](#ç†è®ºåŸºç¡€)
      - [æ•°æ®æ ‡å‡†åŒ–ç›®çš„](#æ•°æ®æ ‡å‡†åŒ–ç›®çš„)
      - [æ ‡å‡†åŒ–æ–¹æ³•åˆ†ç±»](#æ ‡å‡†åŒ–æ–¹æ³•åˆ†ç±»)
      - [æ ‡å‡†åŒ– vs å½’ä¸€åŒ–](#æ ‡å‡†åŒ–-vs-å½’ä¸€åŒ–)
    - [æ ¸å¿ƒç®—æ³•](#æ ¸å¿ƒç®—æ³•)
  - [1. æ–‡æœ¬æ ‡å‡†åŒ–](#1-æ–‡æœ¬æ ‡å‡†åŒ–)
    - [1.1 æ–‡æœ¬æ ‡å‡†åŒ–åŸç†](#11-æ–‡æœ¬æ ‡å‡†åŒ–åŸç†)
      - [å¤§å°å†™è½¬æ¢](#å¤§å°å†™è½¬æ¢)
      - [ç©ºæ ¼å¤„ç†](#ç©ºæ ¼å¤„ç†)
      - [ç‰¹æ®Šå­—ç¬¦å¤„ç†](#ç‰¹æ®Šå­—ç¬¦å¤„ç†)
    - [1.2 å¤§å°å†™æ ‡å‡†åŒ–å®ç°](#12-å¤§å°å†™æ ‡å‡†åŒ–å®ç°)
    - [1.3 å»é™¤ç©ºæ ¼å®ç°](#13-å»é™¤ç©ºæ ¼å®ç°)
    - [1.4 æ–‡æœ¬è§„èŒƒåŒ–ç»¼åˆå¤„ç†](#14-æ–‡æœ¬è§„èŒƒåŒ–ç»¼åˆå¤„ç†)
  - [2. æ•°å€¼æ ‡å‡†åŒ–](#2-æ•°å€¼æ ‡å‡†åŒ–)
    - [2.1 æ•°å€¼æ ‡å‡†åŒ–åŸç†](#21-æ•°å€¼æ ‡å‡†åŒ–åŸç†)
      - [Z-scoreæ ‡å‡†åŒ–](#z-scoreæ ‡å‡†åŒ–)
      - [Min-Maxæ ‡å‡†åŒ–](#min-maxæ ‡å‡†åŒ–)
      - [Robustæ ‡å‡†åŒ–](#robustæ ‡å‡†åŒ–)
    - [2.2 Z-scoreæ ‡å‡†åŒ–å®ç°](#22-z-scoreæ ‡å‡†åŒ–å®ç°)
    - [2.3 Min-Maxæ ‡å‡†åŒ–å®ç°](#23-min-maxæ ‡å‡†åŒ–å®ç°)
    - [2.4 Robustæ ‡å‡†åŒ–å®ç°](#24-robustæ ‡å‡†åŒ–å®ç°)
    - [2.5 Decimal Scalingæ ‡å‡†åŒ–å®ç°](#25-decimal-scalingæ ‡å‡†åŒ–å®ç°)
  - [3. æ—¥æœŸæ—¶é—´æ ‡å‡†åŒ–](#3-æ—¥æœŸæ—¶é—´æ ‡å‡†åŒ–)
    - [3.1 æ—¥æœŸæ—¶é—´æ ‡å‡†åŒ–åŸç†](#31-æ—¥æœŸæ—¶é—´æ ‡å‡†åŒ–åŸç†)
      - [æ—¥æœŸæ ¼å¼æ ‡å‡†åŒ–](#æ—¥æœŸæ ¼å¼æ ‡å‡†åŒ–)
      - [æ—¶åŒºæ ‡å‡†åŒ–](#æ—¶åŒºæ ‡å‡†åŒ–)
    - [3.2 æ—¥æœŸæ ¼å¼æ ‡å‡†åŒ–å®ç°](#32-æ—¥æœŸæ ¼å¼æ ‡å‡†åŒ–å®ç°)
    - [3.3 æ—¶åŒºæ ‡å‡†åŒ–å®ç°](#33-æ—¶åŒºæ ‡å‡†åŒ–å®ç°)
  - [4. åˆ†ç±»æ•°æ®æ ‡å‡†åŒ–](#4-åˆ†ç±»æ•°æ®æ ‡å‡†åŒ–)
    - [4.1 åˆ†ç±»æ•°æ®æ ‡å‡†åŒ–åŸç†](#41-åˆ†ç±»æ•°æ®æ ‡å‡†åŒ–åŸç†)
      - [ç¼–ç ç»Ÿä¸€](#ç¼–ç ç»Ÿä¸€)
      - [ç±»åˆ«æ˜ å°„](#ç±»åˆ«æ˜ å°„)
    - [4.2 åˆ†ç±»æ•°æ®æ ‡å‡†åŒ–å®ç°](#42-åˆ†ç±»æ•°æ®æ ‡å‡†åŒ–å®ç°)
  - [5. å®é™…åº”ç”¨æ¡ˆä¾‹](#5-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [5.1 ç»¼åˆæ•°æ®æ ‡å‡†åŒ–](#51-ç»¼åˆæ•°æ®æ ‡å‡†åŒ–)
    - [5.2 å®¢æˆ·æ•°æ®æ ‡å‡†åŒ–](#52-å®¢æˆ·æ•°æ®æ ‡å‡†åŒ–)
    - [5.3 äº§å“æ•°æ®æ ‡å‡†åŒ–](#53-äº§å“æ•°æ®æ ‡å‡†åŒ–)
    - [5.4 æ—¶é—´åºåˆ—æ•°æ®æ ‡å‡†åŒ–](#54-æ—¶é—´åºåˆ—æ•°æ®æ ‡å‡†åŒ–)
    - [5.5 æ‰¹é‡æ•°æ®æ ‡å‡†åŒ–](#55-æ‰¹é‡æ•°æ®æ ‡å‡†åŒ–)
  - [6. PostgreSQL 18å¹¶è¡Œæ•°æ®æ ‡å‡†åŒ–](#6-postgresql-18å¹¶è¡Œæ•°æ®æ ‡å‡†åŒ–)
    - [6.1 å¹¶è¡Œæ•°æ®æ ‡å‡†åŒ–æ¦‚è¿°](#61-å¹¶è¡Œæ•°æ®æ ‡å‡†åŒ–æ¦‚è¿°)
      - [å¹¶è¡Œæ•°æ®æ ‡å‡†åŒ–é…ç½®](#å¹¶è¡Œæ•°æ®æ ‡å‡†åŒ–é…ç½®)
      - [å¹¶è¡Œæ•°æ®æ ‡å‡†åŒ–å®ç°](#å¹¶è¡Œæ•°æ®æ ‡å‡†åŒ–å®ç°)
  - [7. ç®—æ³•æ€§èƒ½å¯¹æ¯”ä¸ä¼˜åŒ–](#7-ç®—æ³•æ€§èƒ½å¯¹æ¯”ä¸ä¼˜åŒ–)
    - [7.1 æ ‡å‡†åŒ–æ–¹æ³•å¯¹æ¯”](#71-æ ‡å‡†åŒ–æ–¹æ³•å¯¹æ¯”)
    - [7.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®](#72-æ€§èƒ½ä¼˜åŒ–å»ºè®®)
    - [7.3 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#73-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
  - [8. æœ€ä½³å®è·µ](#8-æœ€ä½³å®è·µ)
    - [8.1 æ ‡å‡†åŒ–ç­–ç•¥](#81-æ ‡å‡†åŒ–ç­–ç•¥)
    - [8.2 æ ‡å‡†åŒ–å®æ–½](#82-æ ‡å‡†åŒ–å®æ–½)
    - [8.3 æ ‡å‡†åŒ–éªŒè¯](#83-æ ‡å‡†åŒ–éªŒè¯)
    - [8.4 SQLå®ç°æ³¨æ„äº‹é¡¹](#84-sqlå®ç°æ³¨æ„äº‹é¡¹)
    - [8.5 PostgreSQL 18 æ–°ç‰¹æ€§åº”ç”¨ï¼ˆå¢å¼ºï¼‰](#85-postgresql-18-æ–°ç‰¹æ€§åº”ç”¨å¢å¼º)
    - [8.6 é«˜çº§ä¼˜åŒ–æŠ€å·§ï¼ˆå¢å¼ºï¼‰](#86-é«˜çº§ä¼˜åŒ–æŠ€å·§å¢å¼º)
  - [ğŸ“š å‚è€ƒèµ„æº](#-å‚è€ƒèµ„æº)
    - [å­¦æœ¯æ–‡çŒ®](#å­¦æœ¯æ–‡çŒ®)
    - [PostgreSQLå®˜æ–¹æ–‡æ¡£](#postgresqlå®˜æ–¹æ–‡æ¡£)
    - [åœ¨çº¿èµ„æº](#åœ¨çº¿èµ„æº)
    - [ç›¸å…³ç®—æ³•](#ç›¸å…³ç®—æ³•)

---

## æ•°æ®æ ‡å‡†åŒ–æ¦‚è¿°

**æ•°æ®æ ‡å‡†åŒ–ï¼ˆData Standardizationï¼‰**æ˜¯å°†æ•°æ®è½¬æ¢ä¸ºç»Ÿä¸€çš„æ ¼å¼ã€èŒƒå›´å’Œè¡¨ç¤ºæ–¹æ³•çš„è¿‡ç¨‹ï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ã€å¯æ¯”æ€§å’Œå¯åˆ†ææ€§ã€‚æ•°æ®æ ‡å‡†åŒ–æ˜¯æ•°æ®é¢„å¤„ç†çš„é‡è¦ç¯èŠ‚ï¼Œä¸ºåç»­çš„æ•°æ®åˆ†æå’Œæœºå™¨å­¦ä¹ æä¾›é«˜è´¨é‡çš„æ•°æ®åŸºç¡€ã€‚

### ç†è®ºåŸºç¡€

#### æ•°æ®æ ‡å‡†åŒ–ç›®çš„

1. **æ ¼å¼ç»Ÿä¸€**ï¼šç»Ÿä¸€æ•°æ®çš„è¡¨ç¤ºæ ¼å¼
2. **èŒƒå›´ç»Ÿä¸€**ï¼šç»Ÿä¸€æ•°æ®çš„æ•°å€¼èŒƒå›´
3. **æ¶ˆé™¤é‡çº²**ï¼šæ¶ˆé™¤ä¸åŒé‡çº²çš„å½±å“
4. **æé«˜å¯æ¯”æ€§**ï¼šä½¿ä¸åŒæ¥æºçš„æ•°æ®å¯ä»¥æ¯”è¾ƒ
5. **æ”¹å–„åˆ†ææ•ˆæœ**ï¼šæé«˜æ•°æ®åˆ†æå’Œæœºå™¨å­¦ä¹ çš„æ•ˆæœ

#### æ ‡å‡†åŒ–æ–¹æ³•åˆ†ç±»

1. **æ–‡æœ¬æ ‡å‡†åŒ–**ï¼š
   - å¤§å°å†™è½¬æ¢
   - ç©ºæ ¼å¤„ç†
   - ç‰¹æ®Šå­—ç¬¦å¤„ç†
   - ç¼–ç ç»Ÿä¸€

2. **æ•°å€¼æ ‡å‡†åŒ–**ï¼š
   - **Z-scoreæ ‡å‡†åŒ–**ï¼šæ ‡å‡†åŒ–åˆ°å‡å€¼0ã€æ ‡å‡†å·®1
   - **Min-Maxæ ‡å‡†åŒ–**ï¼šæ ‡å‡†åŒ–åˆ°[0,1]èŒƒå›´
   - **Robustæ ‡å‡†åŒ–**ï¼šä½¿ç”¨ä¸­ä½æ•°å’Œå››åˆ†ä½è·
   - **Decimal Scaling**ï¼šå°æ•°ç‚¹ç¼©æ”¾

3. **æ—¥æœŸæ—¶é—´æ ‡å‡†åŒ–**ï¼š
   - æ—¥æœŸæ ¼å¼ç»Ÿä¸€
   - æ—¶åŒºæ ‡å‡†åŒ–
   - æ—¶é—´æˆ³æ ‡å‡†åŒ–

4. **åˆ†ç±»æ•°æ®æ ‡å‡†åŒ–**ï¼š
   - ç¼–ç ç»Ÿä¸€
   - ç±»åˆ«æ˜ å°„
   - ç‹¬çƒ­ç¼–ç 

#### æ ‡å‡†åŒ– vs å½’ä¸€åŒ–

**æ ‡å‡†åŒ–ï¼ˆStandardizationï¼‰**ï¼š

- æ”¹å˜æ•°æ®åˆ†å¸ƒ
- å‡å€¼0ã€æ ‡å‡†å·®1
- é€‚åˆæ­£æ€åˆ†å¸ƒæ•°æ®

**å½’ä¸€åŒ–ï¼ˆNormalizationï¼‰**ï¼š

- æ”¹å˜æ•°æ®èŒƒå›´
- [0,1]èŒƒå›´
- é€‚åˆæœ‰ç•Œæ•°æ®

### æ ¸å¿ƒç®—æ³•

| ç®—æ³• | å…¬å¼ | ç”¨é€” | æ—¶é—´å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ |
|------|------|------|-----------|---------|
| **Z-score** | $z = \frac{x - \mu}{\sigma}$ | æ ‡å‡†åŒ–åˆ°å‡å€¼0æ–¹å·®1 | $O(n)$ | æ­£æ€åˆ†å¸ƒæ•°æ® |
| **Min-Max** | $x' = \frac{x - min}{max - min}$ | æ ‡å‡†åŒ–åˆ°0-1èŒƒå›´ | $O(n)$ | æœ‰ç•Œæ•°æ® |
| **Robust** | $x' = \frac{x - median}{IQR}$ | æ ‡å‡†åŒ–åˆ°ä¸­ä½æ•°0 | $O(n \log n)$ | æœ‰å¼‚å¸¸å€¼æ•°æ® |
| **Decimal Scaling** | $x' = \frac{x}{10^j}$ | å°æ•°ç‚¹ç¼©æ”¾ | $O(n)$ | å¤§æ•°å€¼æ•°æ® |

---

## 1. æ–‡æœ¬æ ‡å‡†åŒ–

### 1.1 æ–‡æœ¬æ ‡å‡†åŒ–åŸç†

**æ–‡æœ¬æ ‡å‡†åŒ–**ç»Ÿä¸€æ–‡æœ¬çš„æ ¼å¼ï¼ŒåŒ…æ‹¬å¤§å°å†™ã€ç©ºæ ¼ã€ç‰¹æ®Šå­—ç¬¦ç­‰ï¼Œç¡®ä¿æ–‡æœ¬æ•°æ®çš„ä¸€è‡´æ€§ã€‚

#### å¤§å°å†™è½¬æ¢

**è½¬æ¢æ–¹æ³•**ï¼š

- **LOWER()**ï¼šè½¬æ¢ä¸ºå°å†™
- **UPPER()**ï¼šè½¬æ¢ä¸ºå¤§å†™
- **INITCAP()**ï¼šé¦–å­—æ¯å¤§å†™

#### ç©ºæ ¼å¤„ç†

**å¤„ç†æ–¹æ³•**ï¼š

- **TRIM()**ï¼šå»é™¤é¦–å°¾ç©ºæ ¼
- **LTRIM()**ï¼šå»é™¤å·¦ä¾§ç©ºæ ¼
- **RTRIM()**ï¼šå»é™¤å³ä¾§ç©ºæ ¼
- **REGEXP_REPLACE()**ï¼šæ›¿æ¢å¤šä¸ªç©ºæ ¼ä¸ºå•ä¸ªç©ºæ ¼

#### ç‰¹æ®Šå­—ç¬¦å¤„ç†

**å¤„ç†æ–¹æ³•**ï¼š

- å»é™¤æ§åˆ¶å­—ç¬¦
- ç»Ÿä¸€æ ‡ç‚¹ç¬¦å·
- å¤„ç†Unicodeå­—ç¬¦

### 1.2 å¤§å°å†™æ ‡å‡†åŒ–å®ç°

```sql
-- åˆ›å»ºæµ‹è¯•æ•°æ®è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'standardization_test') THEN
            RAISE WARNING 'è¡¨ standardization_test å·²å­˜åœ¨ï¼Œå…ˆåˆ é™¤';
            DROP TABLE standardization_test CASCADE;
        END IF;

        CREATE TABLE standardization_test (
            id SERIAL PRIMARY KEY,
            name VARCHAR(100),
            description TEXT,
            value NUMERIC(10, 2),
            created_date VARCHAR(50)
        );

        INSERT INTO standardization_test (name, description, value, created_date) VALUES
            ('John DOE', '  Some Description  ', 100.5, '2024-01-01'),
            ('jane smith', 'Another Description', 200.3, '01/15/2024'),
            ('BOB WILSON', '  Yet Another  ', 150.7, '2024-1-5');

        RAISE NOTICE 'è¡¨ standardization_test åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ standardization_test å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE EXCEPTION 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
    END;
END $$;

-- å¤§å°å†™æ ‡å‡†åŒ–ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'standardization_test') THEN
            RAISE WARNING 'è¡¨ standardization_test ä¸å­˜åœ¨ï¼Œæ— æ³•è¿›è¡Œå¤§å°å†™æ ‡å‡†åŒ–';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹è¿›è¡Œå¤§å°å†™æ ‡å‡†åŒ–';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¤§å°å†™æ ‡å‡†åŒ–å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- è½¬æ¢ä¸ºå°å†™
SELECT
    id,
    name,
    LOWER(name) AS name_lowercase,
    INITCAP(name) AS name_title_case,
    UPPER(name) AS name_uppercase
FROM standardization_test
ORDER BY id;

-- æ€§èƒ½æµ‹è¯•
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT
    LOWER(name) AS name_lowercase
FROM standardization_test;
```

### 1.3 å»é™¤ç©ºæ ¼å®ç°

**å»é™¤ç©ºæ ¼**æ¸…ç†æ–‡æœ¬ä¸­çš„å¤šä½™ç©ºæ ¼ï¼Œç»Ÿä¸€æ–‡æœ¬æ ¼å¼ã€‚

```sql
-- å»é™¤ç©ºæ ¼ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'standardization_test') THEN
            RAISE WARNING 'è¡¨ standardization_test ä¸å­˜åœ¨ï¼Œæ— æ³•å»é™¤ç©ºæ ¼';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹å»é™¤ç©ºæ ¼';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å»é™¤ç©ºæ ¼å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- å»é™¤é¦–å°¾ç©ºæ ¼å’Œå¤šä½™ç©ºæ ¼
SELECT
    id,
    description,
    TRIM(description) AS trimmed_description,
    REGEXP_REPLACE(TRIM(description), '\s+', ' ', 'g') AS normalized_description
FROM standardization_test
ORDER BY id;

-- æ€§èƒ½æµ‹è¯•
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT
    TRIM(description) AS trimmed
FROM standardization_test;
```

---

### 1.4 æ–‡æœ¬è§„èŒƒåŒ–ç»¼åˆå¤„ç†

**æ–‡æœ¬è§„èŒƒåŒ–**ç»¼åˆå¤„ç†æ–‡æœ¬çš„å¤šä¸ªæ–¹é¢ã€‚

```sql
-- æ–‡æœ¬è§„èŒƒåŒ–ç»¼åˆå¤„ç†
CREATE OR REPLACE FUNCTION normalize_text(input_text TEXT) RETURNS TEXT AS $$
BEGIN
    -- å»é™¤é¦–å°¾ç©ºæ ¼
    input_text := TRIM(input_text);
    -- ç»Ÿä¸€å¤šä¸ªç©ºæ ¼ä¸ºå•ä¸ªç©ºæ ¼
    input_text := REGEXP_REPLACE(input_text, '\s+', ' ', 'g');
    -- è½¬æ¢ä¸ºå°å†™
    input_text := LOWER(input_text);
    -- å»é™¤ç‰¹æ®Šå­—ç¬¦ï¼ˆä¿ç•™å­—æ¯ã€æ•°å­—ã€ç©ºæ ¼ã€è¿å­—ç¬¦ï¼‰
    input_text := REGEXP_REPLACE(input_text, '[^a-z0-9\s-]', '', 'g');
    RETURN input_text;
END;
$$ LANGUAGE plpgsql IMMUTABLE;

-- ä½¿ç”¨è§„èŒƒåŒ–å‡½æ•°
SELECT
    id,
    name,
    normalize_text(name) AS normalized_name,
    description,
    normalize_text(description) AS normalized_description
FROM standardization_test;
```

## 2. æ•°å€¼æ ‡å‡†åŒ–

### 2.1 æ•°å€¼æ ‡å‡†åŒ–åŸç†

**æ•°å€¼æ ‡å‡†åŒ–**å°†æ•°å€¼æ•°æ®è½¬æ¢ä¸ºç»Ÿä¸€çš„æ•°å€¼èŒƒå›´æˆ–åˆ†å¸ƒï¼Œæ¶ˆé™¤é‡çº²å½±å“ï¼Œæé«˜æ•°æ®çš„å¯æ¯”æ€§ã€‚

#### Z-scoreæ ‡å‡†åŒ–

**Z-scoreæ ‡å‡†åŒ–**ï¼ˆæ ‡å‡†åŒ–ï¼‰å°†æ•°æ®è½¬æ¢ä¸ºæ ‡å‡†æ­£æ€åˆ†å¸ƒï¼š
$$z = \frac{x - \mu}{\sigma}$$

å…¶ä¸­ï¼š

- $\mu$ï¼šå‡å€¼
- $\sigma$ï¼šæ ‡å‡†å·®

**ç‰¹ç‚¹**ï¼š

- å‡å€¼å˜ä¸º0
- æ ‡å‡†å·®å˜ä¸º1
- ä¿æŒåŸå§‹åˆ†å¸ƒå½¢çŠ¶

#### Min-Maxæ ‡å‡†åŒ–

**Min-Maxæ ‡å‡†åŒ–**ï¼ˆå½’ä¸€åŒ–ï¼‰å°†æ•°æ®ç¼©æ”¾åˆ°[0,1]èŒƒå›´ï¼š
$$x' = \frac{x - x_{min}}{x_{max} - x_{min}}$$

**ç‰¹ç‚¹**ï¼š

- èŒƒå›´å˜ä¸º[0,1]
- ä¿æŒåŸå§‹åˆ†å¸ƒå½¢çŠ¶
- å¯¹å¼‚å¸¸å€¼æ•æ„Ÿ

#### Robustæ ‡å‡†åŒ–

**Robustæ ‡å‡†åŒ–**ä½¿ç”¨ä¸­ä½æ•°å’Œå››åˆ†ä½è·ï¼Œå¯¹å¼‚å¸¸å€¼ä¸æ•æ„Ÿï¼š
$$x' = \frac{x - median}{IQR}$$

å…¶ä¸­$IQR = Q_3 - Q_1$ï¼ˆå››åˆ†ä½è·ï¼‰ã€‚

**ç‰¹ç‚¹**ï¼š

- å¯¹å¼‚å¸¸å€¼é²æ£’
- é€‚åˆæœ‰å¼‚å¸¸å€¼çš„æ•°æ®
- ä¸­ä½æ•°å˜ä¸º0

### 2.2 Z-scoreæ ‡å‡†åŒ–å®ç°

```sql
-- Z-scoreæ ‡å‡†åŒ–ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'standardization_test') THEN
            RAISE WARNING 'è¡¨ standardization_test ä¸å­˜åœ¨ï¼Œæ— æ³•è¿›è¡ŒZ-scoreæ ‡å‡†åŒ–';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹è¿›è¡ŒZ-scoreæ ‡å‡†åŒ–';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'Z-scoreæ ‡å‡†åŒ–å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- Z-scoreæ ‡å‡†åŒ–
WITH value_stats AS (
    SELECT
        AVG(value) AS mean_value,
        STDDEV(value) AS stddev_value
    FROM standardization_test
    WHERE value IS NOT NULL
)
SELECT
    st.id,
    st.value AS original_value,
    ROUND((st.value - vs.mean_value) / NULLIF(vs.stddev_value, 0)::numeric, 4) AS z_score
FROM standardization_test st
CROSS JOIN value_stats vs
WHERE st.value IS NOT NULL
ORDER BY st.id;

-- æ€§èƒ½æµ‹è¯•
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT
    AVG(value) AS mean_value,
    STDDEV(value) AS stddev_value
FROM standardization_test
WHERE value IS NOT NULL;
```

### 2.3 Min-Maxæ ‡å‡†åŒ–å®ç°

**Min-Maxæ ‡å‡†åŒ–**å°†æ•°æ®æ ‡å‡†åŒ–åˆ°0-1èŒƒå›´ï¼Œé€‚åˆæœ‰ç•Œæ•°æ®ã€‚

```sql
-- Min-Maxæ ‡å‡†åŒ–ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'standardization_test') THEN
            RAISE WARNING 'è¡¨ standardization_test ä¸å­˜åœ¨ï¼Œæ— æ³•è¿›è¡ŒMin-Maxæ ‡å‡†åŒ–';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹è¿›è¡ŒMin-Maxæ ‡å‡†åŒ–';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'Min-Maxæ ‡å‡†åŒ–å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- Min-Maxæ ‡å‡†åŒ–åˆ°0-1èŒƒå›´
WITH value_stats AS (
    SELECT
        MIN(value) AS min_value,
        MAX(value) AS max_value,
        MAX(value) - MIN(value) AS value_range
    FROM standardization_test
    WHERE value IS NOT NULL
)
SELECT
    st.id,
    st.value AS original_value,
    ROUND(((st.value - vs.min_value) / NULLIF(vs.value_range, 0))::numeric, 4) AS min_max_normalized
FROM standardization_test st
CROSS JOIN value_stats vs
WHERE st.value IS NOT NULL
ORDER BY st.id;

-- æ€§èƒ½æµ‹è¯•
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT
    MIN(value) AS min_value,
    MAX(value) AS max_value
FROM standardization_test
WHERE value IS NOT NULL;
```

---

### 2.4 Robustæ ‡å‡†åŒ–å®ç°

**Robustæ ‡å‡†åŒ–**ä½¿ç”¨ä¸­ä½æ•°å’Œå››åˆ†ä½è·ï¼Œå¯¹å¼‚å¸¸å€¼ä¸æ•æ„Ÿã€‚

```sql
-- Robustæ ‡å‡†åŒ–ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'standardization_test') THEN
            RAISE WARNING 'è¡¨ standardization_test ä¸å­˜åœ¨ï¼Œæ— æ³•è¿›è¡ŒRobustæ ‡å‡†åŒ–';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹è¿›è¡ŒRobustæ ‡å‡†åŒ–';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'Robustæ ‡å‡†åŒ–å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- Robustæ ‡å‡†åŒ–
WITH value_stats AS (
    SELECT
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY value) AS median_value,
        PERCENTILE_CONT(0.75) WITHIN GROUP (ORDER BY value) -
        PERCENTILE_CONT(0.25) WITHIN GROUP (ORDER BY value) AS iqr_value
    FROM standardization_test
    WHERE value IS NOT NULL
)
SELECT
    st.id,
    st.value AS original_value,
    ROUND((st.value - vs.median_value) / NULLIF(vs.iqr_value, 0)::numeric, 4) AS robust_normalized
FROM standardization_test st
CROSS JOIN value_stats vs
WHERE st.value IS NOT NULL
ORDER BY st.id;
```

### 2.5 Decimal Scalingæ ‡å‡†åŒ–å®ç°

**Decimal Scalingæ ‡å‡†åŒ–**é€šè¿‡ç§»åŠ¨å°æ•°ç‚¹è¿›è¡Œæ ‡å‡†åŒ–ã€‚

```sql
-- Decimal Scalingæ ‡å‡†åŒ–
WITH value_stats AS (
    SELECT
        MAX(ABS(value)) AS max_abs_value,
        CEILING(LOG(10, MAX(ABS(value)))) AS scaling_factor
    FROM standardization_test
    WHERE value IS NOT NULL
)
SELECT
    st.id,
    st.value AS original_value,
    ROUND((st.value / POWER(10, vs.scaling_factor))::numeric, 4) AS decimal_scaled
FROM standardization_test st
CROSS JOIN value_stats vs
WHERE st.value IS NOT NULL
ORDER BY st.id;
```

## 3. æ—¥æœŸæ—¶é—´æ ‡å‡†åŒ–

### 3.1 æ—¥æœŸæ—¶é—´æ ‡å‡†åŒ–åŸç†

**æ—¥æœŸæ—¶é—´æ ‡å‡†åŒ–**ç»Ÿä¸€æ—¥æœŸæ—¶é—´çš„æ ¼å¼ã€æ—¶åŒºå’Œè¡¨ç¤ºæ–¹æ³•ï¼Œç¡®ä¿æ—¶é—´æ•°æ®çš„ä¸€è‡´æ€§ã€‚

#### æ—¥æœŸæ ¼å¼æ ‡å‡†åŒ–

**å¸¸è§æ—¥æœŸæ ¼å¼**ï¼š

- ISO 8601ï¼š`YYYY-MM-DD`
- ç¾å›½æ ¼å¼ï¼š`MM/DD/YYYY`
- æ¬§æ´²æ ¼å¼ï¼š`DD/MM/YYYY`
- æ—¶é—´æˆ³ï¼šUnix timestamp

#### æ—¶åŒºæ ‡å‡†åŒ–

**æ—¶åŒºå¤„ç†**ï¼š

- ç»Ÿä¸€æ—¶åŒºï¼ˆå¦‚UTCï¼‰
- æ—¶åŒºè½¬æ¢
- å¤ä»¤æ—¶å¤„ç†

### 3.2 æ—¥æœŸæ ¼å¼æ ‡å‡†åŒ–å®ç°

```sql
-- æ—¥æœŸæ ¼å¼æ ‡å‡†åŒ–ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'standardization_test') THEN
            RAISE WARNING 'è¡¨ standardization_test ä¸å­˜åœ¨ï¼Œæ— æ³•è¿›è¡Œæ—¥æœŸæ ¼å¼æ ‡å‡†åŒ–';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹è¿›è¡Œæ—¥æœŸæ ¼å¼æ ‡å‡†åŒ–';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'æ—¥æœŸæ ¼å¼æ ‡å‡†åŒ–å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- æ ‡å‡†åŒ–æ—¥æœŸæ ¼å¼ä¸ºYYYY-MM-DD
SELECT
    id,
    created_date AS original_date,
    CASE
        WHEN created_date ~ '^\d{4}-\d{2}-\d{2}$' THEN created_date::DATE
        WHEN created_date ~ '^\d{2}/\d{2}/\d{4}$' THEN TO_DATE(created_date, 'MM/DD/YYYY')
        WHEN created_date ~ '^\d{4}-\d{1,2}-\d{1,2}$' THEN created_date::DATE
        ELSE NULL
    END AS standardized_date,
    TO_CHAR(
        CASE
            WHEN created_date ~ '^\d{4}-\d{2}-\d{2}$' THEN created_date::DATE
            WHEN created_date ~ '^\d{2}/\d{2}/\d{4}$' THEN TO_DATE(created_date, 'MM/DD/YYYY')
            WHEN created_date ~ '^\d{4}-\d{1,2}-\d{1,2}$' THEN created_date::DATE
            ELSE NULL
        END,
        'YYYY-MM-DD'
    ) AS formatted_date
FROM standardization_test
ORDER BY id;

-- æ€§èƒ½æµ‹è¯•
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT
    created_date::DATE AS standardized_date
FROM standardization_test
WHERE created_date ~ '^\d{4}-\d{2}-\d{2}$';
```

---

### 3.3 æ—¶åŒºæ ‡å‡†åŒ–å®ç°

**æ—¶åŒºæ ‡å‡†åŒ–**ç»Ÿä¸€æ—¶åŒºè¡¨ç¤ºã€‚

```sql
-- æ—¶åŒºæ ‡å‡†åŒ–ï¼šç»Ÿä¸€è½¬æ¢ä¸ºUTC
SELECT
    id,
    created_timestamp,
    created_timestamp AT TIME ZONE 'UTC' AS utc_timestamp,
    EXTRACT(TIMEZONE FROM created_timestamp) AS timezone_offset
FROM timestamp_test;
```

## 4. åˆ†ç±»æ•°æ®æ ‡å‡†åŒ–

### 4.1 åˆ†ç±»æ•°æ®æ ‡å‡†åŒ–åŸç†

**åˆ†ç±»æ•°æ®æ ‡å‡†åŒ–**ç»Ÿä¸€åˆ†ç±»æ•°æ®çš„ç¼–ç å’Œè¡¨ç¤ºæ–¹æ³•ã€‚

#### ç¼–ç ç»Ÿä¸€

**ç¼–ç æ–¹æ³•**ï¼š

- ç»Ÿä¸€ç¼–ç æ ¼å¼
- æ˜ å°„åˆ°æ ‡å‡†ç¼–ç 
- å¤„ç†ç¼–ç ä¸ä¸€è‡´

#### ç±»åˆ«æ˜ å°„

**æ˜ å°„æ–¹æ³•**ï¼š

- åŒä¹‰è¯åˆå¹¶
- ç±»åˆ«æ ‡å‡†åŒ–
- å±‚æ¬¡ç»“æ„ç»Ÿä¸€

### 4.2 åˆ†ç±»æ•°æ®æ ‡å‡†åŒ–å®ç°

```sql
-- åˆ†ç±»æ•°æ®æ ‡å‡†åŒ–ï¼šç»Ÿä¸€ç±»åˆ«ç¼–ç 
WITH category_mapping AS (
    SELECT 'Electronics' AS original_category, 'ELECTRONICS' AS standardized_category
    UNION ALL SELECT 'electronics', 'ELECTRONICS'
    UNION ALL SELECT 'ELECTRONICS', 'ELECTRONICS'
    UNION ALL SELECT 'Clothing', 'CLOTHING'
    UNION ALL SELECT 'clothing', 'CLOTHING'
    UNION ALL SELECT 'CLOTHING', 'CLOTHING'
)
SELECT
    p.product_id,
    p.category AS original_category,
    COALESCE(cm.standardized_category, UPPER(TRIM(p.category))) AS standardized_category
FROM products p
LEFT JOIN category_mapping cm ON LOWER(TRIM(p.category)) = LOWER(TRIM(cm.original_category));
```

## 5. å®é™…åº”ç”¨æ¡ˆä¾‹

### 5.1 ç»¼åˆæ•°æ®æ ‡å‡†åŒ–

**ç»¼åˆæ•°æ®æ ‡å‡†åŒ–**æ•´åˆå¤šç§æ ‡å‡†åŒ–æ–¹æ³•ï¼Œå¤„ç†å®Œæ•´çš„æ•°æ®é›†ã€‚

```sql
-- ç»¼åˆæ•°æ®æ ‡å‡†åŒ–ç¤ºä¾‹ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'standardization_test') THEN
            RAISE WARNING 'è¡¨ standardization_test ä¸å­˜åœ¨ï¼Œæ— æ³•è¿›è¡Œç»¼åˆæ•°æ®æ ‡å‡†åŒ–';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹è¿›è¡Œç»¼åˆæ•°æ®æ ‡å‡†åŒ–';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'ç»¼åˆæ•°æ®æ ‡å‡†åŒ–å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- ç»¼åˆæ ‡å‡†åŒ–å¤„ç†
WITH value_stats AS (
    SELECT
        AVG(value) AS mean_value,
        STDDEV(value) AS stddev_value,
        MIN(value) AS min_value,
        MAX(value) AS max_value,
        MAX(value) - MIN(value) AS value_range
    FROM standardization_test
    WHERE value IS NOT NULL
)
SELECT
    st.id,
    INITCAP(TRIM(st.name)) AS standardized_name,
    REGEXP_REPLACE(TRIM(st.description), '\s+', ' ', 'g') AS standardized_description,
    st.value AS original_value,
    ROUND((st.value - vs.mean_value) / NULLIF(vs.stddev_value, 0)::numeric, 4) AS z_score,
    ROUND(((st.value - vs.min_value) / NULLIF(vs.value_range, 0))::numeric, 4) AS min_max_normalized,
    TO_CHAR(
        CASE
            WHEN st.created_date ~ '^\d{4}-\d{2}-\d{2}$' THEN st.created_date::DATE
            WHEN st.created_date ~ '^\d{2}/\d{2}/\d{4}$' THEN TO_DATE(st.created_date, 'MM/DD/YYYY')
            WHEN st.created_date ~ '^\d{4}-\d{1,2}-\d{1,2}$' THEN st.created_date::DATE
            ELSE NULL
        END,
        'YYYY-MM-DD'
    ) AS standardized_date
FROM standardization_test st
CROSS JOIN value_stats vs
ORDER BY st.id;

-- æ€§èƒ½æµ‹è¯•
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT
    INITCAP(TRIM(name)) AS standardized_name,
    AVG(value) AS mean_value
FROM standardization_test
GROUP BY name;
```

### 5.2 å®¢æˆ·æ•°æ®æ ‡å‡†åŒ–

**åœºæ™¯**ï¼šæ ‡å‡†åŒ–å®¢æˆ·æ•°æ®ï¼Œç»Ÿä¸€æ ¼å¼å’Œè¡¨ç¤ºã€‚

```sql
-- å®¢æˆ·æ•°æ®æ ‡å‡†åŒ–ï¼šç»¼åˆå¤„ç†å®¢æˆ·ä¿¡æ¯
WITH customer_standardization AS (
    SELECT
        customer_id,
        -- å§“åæ ‡å‡†åŒ–
        INITCAP(TRIM(name)) AS standardized_name,
        -- é‚®ç®±æ ‡å‡†åŒ–
        LOWER(TRIM(email)) AS standardized_email,
        -- ç”µè¯æ ‡å‡†åŒ–ï¼ˆå»é™¤ç©ºæ ¼å’Œç‰¹æ®Šå­—ç¬¦ï¼‰
        REGEXP_REPLACE(REGEXP_REPLACE(phone, '[^\d]', '', 'g'), '^(\d{3})(\d{4})(\d{4})$', '\1-\2-\3') AS standardized_phone,
        -- åœ°å€æ ‡å‡†åŒ–
        UPPER(TRIM(address)) AS standardized_address,
        -- åˆ›å»ºæ—¥æœŸæ ‡å‡†åŒ–
        TO_CHAR(created_date, 'YYYY-MM-DD') AS standardized_date
    FROM customers
)
SELECT
    customer_id,
    standardized_name,
    standardized_email,
    standardized_phone,
    standardized_address,
    standardized_date
FROM customer_standardization
ORDER BY customer_id;
```

### 5.3 äº§å“æ•°æ®æ ‡å‡†åŒ–

**åœºæ™¯**ï¼šæ ‡å‡†åŒ–äº§å“æ•°æ®ï¼Œç»Ÿä¸€åˆ†ç±»å’Œå±æ€§ã€‚

```sql
-- äº§å“æ•°æ®æ ‡å‡†åŒ–ï¼šæ ‡å‡†åŒ–äº§å“åˆ†ç±»å’Œä»·æ ¼
WITH product_stats AS (
    SELECT
        category,
        AVG(price) AS avg_price,
        STDDEV(price) AS stddev_price,
        MIN(price) AS min_price,
        MAX(price) AS max_price
    FROM products
    WHERE price IS NOT NULL AND price > 0
    GROUP BY category
),
product_standardization AS (
    SELECT
        p.product_id,
        p.product_name,
        -- äº§å“åç§°æ ‡å‡†åŒ–
        INITCAP(TRIM(p.product_name)) AS standardized_name,
        -- åˆ†ç±»æ ‡å‡†åŒ–
        UPPER(TRIM(p.category)) AS standardized_category,
        -- ä»·æ ¼Z-scoreæ ‡å‡†åŒ–ï¼ˆæŒ‰åˆ†ç±»ï¼‰
        ROUND((p.price - ps.avg_price) / NULLIF(ps.stddev_price, 0)::numeric, 4) AS price_z_score,
        -- ä»·æ ¼Min-Maxæ ‡å‡†åŒ–ï¼ˆæŒ‰åˆ†ç±»ï¼‰
        ROUND(((p.price - ps.min_price) / NULLIF(ps.max_price - ps.min_price, 0))::numeric, 4) AS price_min_max
    FROM products p
    LEFT JOIN product_stats ps ON UPPER(TRIM(p.category)) = UPPER(TRIM(ps.category))
    WHERE p.price IS NOT NULL AND p.price > 0
)
SELECT
    product_id,
    standardized_name,
    standardized_category,
    price_z_score,
    price_min_max
FROM product_standardization
ORDER BY standardized_category, price_z_score DESC;
```

### 5.4 æ—¶é—´åºåˆ—æ•°æ®æ ‡å‡†åŒ–

**åœºæ™¯**ï¼šæ ‡å‡†åŒ–æ—¶é—´åºåˆ—æ•°æ®ï¼Œç»Ÿä¸€æ—¶é—´æ ¼å¼å’Œæ•°å€¼èŒƒå›´ã€‚

```sql
-- æ—¶é—´åºåˆ—æ•°æ®æ ‡å‡†åŒ–ï¼šæ ‡å‡†åŒ–é”€å”®æ•°æ®
WITH sales_stats AS (
    SELECT
        AVG(amount) AS mean_amount,
        STDDEV(amount) AS stddev_amount,
        MIN(amount) AS min_amount,
        MAX(amount) AS max_amount,
        MAX(amount) - MIN(amount) AS amount_range
    FROM sales
    WHERE amount IS NOT NULL
),
sales_standardization AS (
    SELECT
        s.sale_id,
        -- æ—¥æœŸæ ‡å‡†åŒ–
        TO_CHAR(s.sale_date, 'YYYY-MM-DD') AS standardized_date,
        -- æ—¶é—´æ ‡å‡†åŒ–ï¼ˆç»Ÿä¸€ä¸º24å°æ—¶åˆ¶ï¼‰
        TO_CHAR(s.sale_time, 'HH24:MI:SS') AS standardized_time,
        -- é‡‘é¢Z-scoreæ ‡å‡†åŒ–
        ROUND((s.amount - ss.mean_amount) / NULLIF(ss.stddev_amount, 0)::numeric, 4) AS amount_z_score,
        -- é‡‘é¢Min-Maxæ ‡å‡†åŒ–
        ROUND(((s.amount - ss.min_amount) / NULLIF(ss.amount_range, 0))::numeric, 4) AS amount_min_max,
        -- åŸå§‹é‡‘é¢
        s.amount AS original_amount
    FROM sales s
    CROSS JOIN sales_stats ss
    WHERE s.amount IS NOT NULL
)
SELECT
    sale_id,
    standardized_date,
    standardized_time,
    original_amount,
    amount_z_score,
    amount_min_max
FROM sales_standardization
ORDER BY standardized_date, standardized_time;
```

### 5.5 æ‰¹é‡æ•°æ®æ ‡å‡†åŒ–

**åœºæ™¯**ï¼šæ‰¹é‡æ ‡å‡†åŒ–å¤§é‡æ•°æ®ï¼Œæé«˜å¤„ç†æ•ˆç‡ã€‚

```sql
-- æ‰¹é‡æ•°æ®æ ‡å‡†åŒ–ï¼šä½¿ç”¨UPDATEæ‰¹é‡æ›´æ–°æ ‡å‡†åŒ–åçš„æ•°æ®
-- åˆ›å»ºæ ‡å‡†åŒ–åçš„è¡¨
CREATE TABLE IF NOT EXISTS customers_standardized AS
SELECT
    customer_id,
    INITCAP(TRIM(name)) AS standardized_name,
    LOWER(TRIM(email)) AS standardized_email,
    REGEXP_REPLACE(REGEXP_REPLACE(phone, '[^\d]', '', 'g'), '^(\d{3})(\d{4})(\d{4})$', '\1-\2-\3') AS standardized_phone,
    UPPER(TRIM(address)) AS standardized_address,
    TO_CHAR(created_date, 'YYYY-MM-DD') AS standardized_date
FROM customers;

-- åˆ›å»ºç´¢å¼•åŠ é€ŸæŸ¥è¯¢
CREATE INDEX IF NOT EXISTS idx_customers_std_email ON customers_standardized(standardized_email);
CREATE INDEX IF NOT EXISTS idx_customers_std_name ON customers_standardized(standardized_name);

-- éªŒè¯æ ‡å‡†åŒ–ç»“æœ
SELECT
    COUNT(*) AS total_records,
    COUNT(DISTINCT standardized_email) AS unique_emails,
    COUNT(*) FILTER (WHERE standardized_email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$') AS valid_emails
FROM customers_standardized;
```

---

## 6. PostgreSQL 18å¹¶è¡Œæ•°æ®æ ‡å‡†åŒ–

### 6.1 å¹¶è¡Œæ•°æ®æ ‡å‡†åŒ–æ¦‚è¿°

**PostgreSQL 18å¹¶è¡Œæ•°æ®æ ‡å‡†åŒ–**ï¼šåˆ©ç”¨PostgreSQL 18çš„å¹¶è¡ŒæŸ¥è¯¢èƒ½åŠ›ï¼Œæ˜¾è‘—æå‡å¤§è§„æ¨¡æ•°æ®æ ‡å‡†åŒ–çš„æ€§èƒ½ã€‚

#### å¹¶è¡Œæ•°æ®æ ‡å‡†åŒ–é…ç½®

```sql
-- é…ç½®å¹¶è¡Œæ•°æ®æ ‡å‡†åŒ–å‚æ•°ï¼ˆPostgreSQL 18+ï¼‰
DO $$
BEGIN
    BEGIN
        -- è®¾ç½®å¹¶è¡Œå·¥ä½œè¿›ç¨‹æ•°
        SET max_parallel_workers_per_gather = 4;

        -- è®¾ç½®å¹¶è¡Œè¡¨æ‰«æé˜ˆå€¼
        SET min_parallel_table_scan_size = '8MB';

        -- è®¾ç½®å¹¶è¡Œèšåˆæˆæœ¬é˜ˆå€¼
        SET parallel_setup_cost = 0;
        SET parallel_tuple_cost = 0.0001;

        RAISE NOTICE 'å¹¶è¡Œæ•°æ®æ ‡å‡†åŒ–å‚æ•°å·²é…ç½®';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¹¶è¡Œæ•°æ®æ ‡å‡†åŒ–é…ç½®å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

#### å¹¶è¡Œæ•°æ®æ ‡å‡†åŒ–å®ç°

```sql
-- å¹¶è¡Œæ•°æ®æ ‡å‡†åŒ–ï¼šå¤§è§„æ¨¡æ•°æ®Z-scoreæ ‡å‡†åŒ–ï¼ˆPostgreSQL 18+ï¼‰
DO $$
BEGIN
    BEGIN
        -- å¯ç”¨å¹¶è¡ŒæŸ¥è¯¢
        SET max_parallel_workers_per_gather = 4;
        SET parallel_setup_cost = 0;
        SET parallel_tuple_cost = 0.0001;

        RAISE NOTICE 'å¼€å§‹æ‰§è¡Œå¹¶è¡Œæ•°æ®æ ‡å‡†åŒ–';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¹¶è¡Œæ•°æ®æ ‡å‡†åŒ–å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- å¹¶è¡ŒZ-scoreæ ‡å‡†åŒ–
EXPLAIN (ANALYZE, BUFFERS, TIMING)
WITH parallel_stats AS (
    SELECT
        column_name,
        AVG(column_value) AS mean_value,
        STDDEV(column_value) AS stddev_value
    FROM data_table
    GROUP BY column_name
),
parallel_normalized AS (
    SELECT
        dt.id,
        dt.column_name,
        dt.column_value,
        ps.mean_value,
        ps.stddev_value,
        (dt.column_value - ps.mean_value) / NULLIF(ps.stddev_value, 0) AS z_score
    FROM data_table dt
    JOIN parallel_stats ps ON dt.column_name = ps.column_name
)
SELECT
    column_name,
    COUNT(*) AS total_records,
    ROUND(AVG(z_score)::numeric, 4) AS avg_z_score,
    ROUND(STDDEV(z_score)::numeric, 4) AS stddev_z_score,
    ROUND(MIN(z_score)::numeric, 4) AS min_z_score,
    ROUND(MAX(z_score)::numeric, 4) AS max_z_score
FROM parallel_normalized
GROUP BY column_name
ORDER BY column_name;
```

---

## 7. ç®—æ³•æ€§èƒ½å¯¹æ¯”ä¸ä¼˜åŒ–

### 7.1 æ ‡å‡†åŒ–æ–¹æ³•å¯¹æ¯”

| æ ‡å‡†åŒ–æ–¹æ³• | å…¬å¼ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|-----------|------|------|------|---------|
| **Z-score** | $z = \frac{x - \mu}{\sigma}$ | ä¿æŒåˆ†å¸ƒå½¢çŠ¶ã€é€‚åˆæ­£æ€åˆ†å¸ƒ | å¯¹å¼‚å¸¸å€¼æ•æ„Ÿ | æ­£æ€åˆ†å¸ƒæ•°æ® |
| **Min-Max** | $x' = \frac{x - min}{max - min}$ | èŒƒå›´å›ºå®š[0,1]ã€ç®€å•ç›´è§‚ | å¯¹å¼‚å¸¸å€¼æ•æ„Ÿ | æœ‰ç•Œæ•°æ® |
| **Robust** | $x' = \frac{x - median}{IQR}$ | å¯¹å¼‚å¸¸å€¼é²æ£’ | è®¡ç®—å¤æ‚åº¦é«˜ | æœ‰å¼‚å¸¸å€¼æ•°æ® |
| **Decimal Scaling** | $x' = \frac{x}{10^j}$ | ç®€å•å¿«é€Ÿ | èŒƒå›´ä¸å›ºå®š | å¤§æ•°å€¼æ•°æ® |

### 7.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æ‰¹é‡å¤„ç†**ï¼š
   - ä½¿ç”¨æ‰¹é‡UPDATE/INSERT
   - ä½¿ç”¨CTEå‡å°‘é‡å¤è®¡ç®—
   - ä½¿ç”¨ç‰©åŒ–è§†å›¾ç¼“å­˜ç»“æœ

2. **å‡½æ•°ä¼˜åŒ–**ï¼š
   - åˆ›å»ºIMMUTABLEå‡½æ•°
   - ä½¿ç”¨å‡½æ•°ç´¢å¼•
   - é¿å…é‡å¤è®¡ç®—ç»Ÿè®¡å€¼

3. **ç´¢å¼•ä¼˜åŒ–**ï¼š
   - åœ¨æ ‡å‡†åŒ–åçš„å­—æ®µä¸Šåˆ›å»ºç´¢å¼•
   - ä½¿ç”¨è¡¨è¾¾å¼ç´¢å¼•
   - è€ƒè™‘è¦†ç›–ç´¢å¼•

4. **å¹¶è¡Œå¤„ç†**ï¼š
   - ä½¿ç”¨å¹¶è¡ŒæŸ¥è¯¢
   - åˆ†æ‰¹å¤„ç†å¤§æ•°æ®é›†
   - ä½¿ç”¨åˆ†åŒºè¡¨

### 7.3 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

**é—®é¢˜1**ï¼šæ ‡å‡†åŒ–åæ•°æ®èŒƒå›´ä¸ç¬¦åˆé¢„æœŸ

- **è§£å†³æ–¹æ¡ˆ**ï¼šæ£€æŸ¥ç»Ÿè®¡å€¼è®¡ç®—ã€å¤„ç†NULLå€¼ã€éªŒè¯å…¬å¼

**é—®é¢˜2**ï¼šæ ‡å‡†åŒ–æ€§èƒ½æ…¢

- **è§£å†³æ–¹æ¡ˆ**ï¼šæ‰¹é‡å¤„ç†ã€ä½¿ç”¨ç‰©åŒ–è§†å›¾ã€ä¼˜åŒ–ç»Ÿè®¡å€¼è®¡ç®—

**é—®é¢˜3**ï¼šå¼‚å¸¸å€¼å½±å“æ ‡å‡†åŒ–

- **è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨Robustæ ‡å‡†åŒ–ã€å…ˆå¤„ç†å¼‚å¸¸å€¼ã€ä½¿ç”¨æˆªæ–­æ–¹æ³•

**é—®é¢˜4**ï¼šæ–‡æœ¬æ ‡å‡†åŒ–ä¸å½»åº•

- **è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ã€å¤„ç†Unicodeå­—ç¬¦ã€ç»Ÿä¸€ç¼–ç 

---

## 8. æœ€ä½³å®è·µ

### 8.1 æ ‡å‡†åŒ–ç­–ç•¥

1. **æ•°æ®æ¢ç´¢**ï¼š
   - å…ˆåˆ†ææ•°æ®åˆ†å¸ƒ
   - è¯†åˆ«å¼‚å¸¸å€¼
   - ç¡®å®šæ ‡å‡†åŒ–æ–¹æ³•

2. **æ–¹æ³•é€‰æ‹©**ï¼š
   - æ­£æ€åˆ†å¸ƒï¼šZ-score
   - æœ‰ç•Œæ•°æ®ï¼šMin-Max
   - æœ‰å¼‚å¸¸å€¼ï¼šRobust
   - å¤§æ•°å€¼ï¼šDecimal Scaling

3. **å‚æ•°ä¿å­˜**ï¼š
   - ä¿å­˜ç»Ÿè®¡å€¼ï¼ˆå‡å€¼ã€æ ‡å‡†å·®ç­‰ï¼‰
   - ç”¨äºæ–°æ•°æ®æ ‡å‡†åŒ–
   - ä¿æŒä¸€è‡´æ€§

### 8.2 æ ‡å‡†åŒ–å®æ–½

1. **é¢„å¤„ç†**ï¼š
   - å…ˆæ¸…æ´—æ•°æ®
   - å¤„ç†ç¼ºå¤±å€¼
   - å¤„ç†å¼‚å¸¸å€¼

2. **æ ‡å‡†åŒ–**ï¼š
   - æŒ‰åˆ—æ ‡å‡†åŒ–
   - ä¿å­˜æ ‡å‡†åŒ–å‚æ•°
   - éªŒè¯æ ‡å‡†åŒ–ç»“æœ

3. **åå¤„ç†**ï¼š
   - éªŒè¯æ ‡å‡†åŒ–æ•ˆæœ
   - æ£€æŸ¥æ•°æ®åˆ†å¸ƒ
   - è®°å½•æ ‡å‡†åŒ–æ—¥å¿—

### 8.3 æ ‡å‡†åŒ–éªŒè¯

1. **ç»Ÿè®¡éªŒè¯**ï¼š
   - æ£€æŸ¥å‡å€¼æ˜¯å¦ä¸º0ï¼ˆZ-scoreï¼‰
   - æ£€æŸ¥èŒƒå›´æ˜¯å¦ä¸º[0,1]ï¼ˆMin-Maxï¼‰
   - æ£€æŸ¥æ ‡å‡†å·®æ˜¯å¦ä¸º1ï¼ˆZ-scoreï¼‰

2. **åˆ†å¸ƒéªŒè¯**ï¼š
   - å¯è§†åŒ–æ•°æ®åˆ†å¸ƒ
   - æ¯”è¾ƒæ ‡å‡†åŒ–å‰ååˆ†å¸ƒ
   - æ£€æŸ¥æ˜¯å¦ä¿æŒåˆ†å¸ƒå½¢çŠ¶

3. **ä¸šåŠ¡éªŒè¯**ï¼š
   - éªŒè¯ä¸šåŠ¡é€»è¾‘
   - æ£€æŸ¥æ•°æ®å«ä¹‰
   - ç¡®è®¤æ ‡å‡†åŒ–åˆç†

### 8.4 SQLå®ç°æ³¨æ„äº‹é¡¹

1. **æ€§èƒ½è€ƒè™‘**ï¼š
   - æ‰¹é‡å¤„ç†æ•°æ®
   - ä½¿ç”¨ç‰©åŒ–è§†å›¾
   - ä¼˜åŒ–ç»Ÿè®¡å€¼è®¡ç®—

2. **å‡†ç¡®æ€§**ï¼š
   - å¤„ç†NULLå€¼
   - å¤„ç†é™¤é›¶é”™è¯¯
   - æ•°å€¼ç²¾åº¦æ§åˆ¶

3. **å¯ç»´æŠ¤æ€§**ï¼š
   - ä½¿ç”¨å‡½æ•°å°è£…é€»è¾‘
   - æ¸…æ™°çš„ä»£ç æ³¨é‡Š
   - æ¨¡å—åŒ–è®¾è®¡

### 8.5 PostgreSQL 18 æ–°ç‰¹æ€§åº”ç”¨ï¼ˆå¢å¼ºï¼‰

**PostgreSQL 18**å¼•å…¥äº†å¤šé¡¹å¢å¼ºåŠŸèƒ½ï¼Œå¯ä»¥æ˜¾è‘—æå‡æ•°æ®æ ‡å‡†åŒ–ç®—æ³•çš„æ€§èƒ½ï¼š

1. **Skip Scanä¼˜åŒ–**ï¼š
   - å¯¹äºåŒ…å«æ ‡å‡†åŒ–é”®çš„ç´¢å¼•ï¼ŒSkip Scanå¯ä»¥è·³è¿‡ä¸å¿…è¦çš„ç´¢å¼•æ‰«æ
   - ç‰¹åˆ«é€‚ç”¨äºTop-Næ ‡å‡†åŒ–æŸ¥è¯¢å’Œå¤šåˆ—æ ‡å‡†åŒ–å¯¹æ¯”æŸ¥è¯¢

2. **å¼‚æ­¥I/Oå¢å¼º**ï¼š
   - å¯¹äºå¤§è§„æ¨¡æ•°æ®æ ‡å‡†åŒ–è®¡ç®—ï¼Œå¼‚æ­¥I/Oå¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½
   - é€‚ç”¨äºæ‰¹é‡æ ‡å‡†åŒ–å’Œå¤šæ–¹æ³•æ ‡å‡†åŒ–å¯¹æ¯”

3. **å¹¶è¡ŒæŸ¥è¯¢å¢å¼º**ï¼š
   - æ•°æ®æ ‡å‡†åŒ–æ”¯æŒæ›´å¥½çš„å¹¶è¡Œæ‰§è¡Œï¼ˆå·²åœ¨6èŠ‚è¯¦ç»†è¯´æ˜ï¼‰
   - é€‚ç”¨äºå¤§è§„æ¨¡æ•°æ®æ ‡å‡†åŒ–å’Œå¤šåˆ—å¹¶è¡Œæ ‡å‡†åŒ–åˆ†æ

**ç¤ºä¾‹ï¼šä½¿ç”¨Skip Scanä¼˜åŒ–æ•°æ®æ ‡å‡†åŒ–æŸ¥è¯¢**

```sql
-- ä¸ºæ•°æ®æ ‡å‡†åŒ–åˆ›å»ºSkip Scanä¼˜åŒ–ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_data_standardization_skip_scan
ON standardization_test(id, name, value DESC);

-- Skip Scanä¼˜åŒ–æŸ¥è¯¢ï¼šæŸ¥æ‰¾æœ€æ–°æ ‡å‡†åŒ–çš„å‰10æ¡è®°å½•
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT DISTINCT ON (name)
    id,
    name,
    UPPER(TRIM(name)) AS standardized_name,
    value,
    (value - AVG(value) OVER ()) / NULLIF(STDDEV(value) OVER (), 0) AS z_score_standardized
FROM standardization_test
ORDER BY name, id DESC
LIMIT 50;
```

### 8.6 é«˜çº§ä¼˜åŒ–æŠ€å·§ï¼ˆå¢å¼ºï¼‰

**1. ä½¿ç”¨ç‰©åŒ–è§†å›¾ç¼“å­˜æ ‡å‡†åŒ–ç»“æœ**

å¯¹äºé¢‘ç¹ä½¿ç”¨çš„æ ‡å‡†åŒ–ç»“æœï¼Œä½¿ç”¨ç‰©åŒ–è§†å›¾ç¼“å­˜ï¼š

```sql
-- åˆ›å»ºç‰©åŒ–è§†å›¾ç¼“å­˜æ ‡å‡†åŒ–ç»“æœ
CREATE MATERIALIZED VIEW IF NOT EXISTS data_standardization_cache AS
WITH standardization_statistics AS (
    SELECT
        id,
        name,
        description,
        value,
        created_date,
        -- ä½¿ç”¨çª—å£å‡½æ•°è®¡ç®—æ–‡æœ¬æ ‡å‡†åŒ–ï¼ˆé¿å…é‡å¤è®¡ç®—ï¼‰
        UPPER(TRIM(name)) AS standardized_name,
        REGEXP_REPLACE(TRIM(description), '\s+', ' ', 'g') AS standardized_description,
        -- ä½¿ç”¨çª—å£å‡½æ•°è®¡ç®—æ•°å€¼æ ‡å‡†åŒ–ï¼ˆé¿å…é‡å¤è®¡ç®—ï¼‰
        (value - AVG(value) OVER ()) / NULLIF(STDDEV(value) OVER (), 0) AS z_score_standardized,
        (value - MIN(value) OVER ()) / NULLIF(MAX(value) OVER () - MIN(value) OVER (), 0) AS min_max_standardized,
        -- ä½¿ç”¨çª—å£å‡½æ•°è®¡ç®—æ—¥æœŸæ ‡å‡†åŒ–ï¼ˆé¿å…é‡å¤è®¡ç®—ï¼‰
        CASE
            WHEN created_date ~ '^\d{4}-\d{2}-\d{2}$' THEN created_date::DATE
            WHEN created_date ~ '^\d{1,2}/\d{1,2}/\d{4}$' THEN TO_DATE(created_date, 'MM/DD/YYYY')
            ELSE NULL
        END AS standardized_date
    FROM standardization_test
    WHERE created_date IS NOT NULL
)
SELECT
    id,
    name,
    standardized_name,
    description,
    standardized_description,
    value,
    ROUND(z_score_standardized::numeric, 4) AS z_score_standardized,
    ROUND(min_max_standardized::numeric, 4) AS min_max_standardized,
    created_date,
    standardized_date,
    CASE
        WHEN standardized_name IS NULL OR standardized_description IS NULL OR standardized_date IS NULL THEN 'Incomplete Standardization'
        WHEN ABS(z_score_standardized) > 3 THEN 'Outlier - Review Required'
        ELSE 'Fully Standardized'
    END AS standardization_status
FROM standardization_statistics
ORDER BY id DESC;

-- åˆ›å»ºç´¢å¼•åŠ é€Ÿç‰©åŒ–è§†å›¾æŸ¥è¯¢
CREATE INDEX idx_data_standardization_cache_id ON data_standardization_cache(id DESC);
CREATE INDEX idx_data_standardization_cache_status ON data_standardization_cache(standardization_status, z_score_standardized);

-- å®šæœŸåˆ·æ–°ç‰©åŒ–è§†å›¾
REFRESH MATERIALIZED VIEW CONCURRENTLY data_standardization_cache;
```

**2. å®æ—¶æ•°æ®æ ‡å‡†åŒ–ï¼šå¢é‡æ ‡å‡†åŒ–æ›´æ–°**

**å®æ—¶æ•°æ®æ ‡å‡†åŒ–**ï¼šå¯¹äºå®æ—¶æ•°æ®ï¼Œä½¿ç”¨å¢é‡æ–¹æ³•æ›´æ–°æ ‡å‡†åŒ–ç»“æœã€‚

```sql
-- å®æ—¶æ•°æ®æ ‡å‡†åŒ–ï¼šå¢é‡æ ‡å‡†åŒ–æ›´æ–°ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'data_standardization_state') THEN
            CREATE TABLE data_standardization_state (
                table_name VARCHAR(100) NOT NULL,
                column_name VARCHAR(100) NOT NULL,
                standardization_method VARCHAR(50) NOT NULL,  -- 'Z-score', 'Min-Max', 'Text'
                sum_values NUMERIC DEFAULT 0,
                sum_squared_values NUMERIC DEFAULT 0,
                count_samples BIGINT DEFAULT 0,
                min_value NUMERIC,
                max_value NUMERIC,
                mean_value NUMERIC,
                stddev_value NUMERIC,
                last_updated TIMESTAMPTZ DEFAULT NOW(),
                PRIMARY KEY (table_name, column_name, standardization_method)
            );

            CREATE INDEX idx_data_standardization_state_table_column ON data_standardization_state(table_name, column_name);
            CREATE INDEX idx_data_standardization_state_updated ON data_standardization_state(last_updated DESC);

            RAISE NOTICE 'æ•°æ®æ ‡å‡†åŒ–çŠ¶æ€è¡¨åˆ›å»ºæˆåŠŸ';
        END IF;

        RAISE NOTICE 'å¼€å§‹æ‰§è¡Œå¢é‡æ•°æ®æ ‡å‡†åŒ–æ›´æ–°';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¢é‡æ•°æ®æ ‡å‡†åŒ–æ›´æ–°å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- å¢é‡æ›´æ–°æ•°æ®æ ‡å‡†åŒ–ç»Ÿè®¡ï¼šå®æ—¶æ•°æ®æ ‡å‡†åŒ–
WITH new_standardization_data AS (
    SELECT
        'standardization_test' AS table_name,
        'value' AS column_name,
        'Z-score' AS standardization_method,
        value AS new_value
    FROM standardization_test
    WHERE id > (SELECT COALESCE(MAX(last_updated)::integer, 0) FROM data_standardization_state
                WHERE table_name = 'standardization_test' AND column_name = 'value' AND standardization_method = 'Z-score')
),
updated_standardization_stats AS (
    SELECT
        COALESCE(dss.table_name, nsd.table_name) AS table_name,
        COALESCE(dss.column_name, nsd.column_name) AS column_name,
        COALESCE(dss.standardization_method, nsd.standardization_method) AS standardization_method,
        COALESCE(dss.sum_values, 0) + SUM(nsd.new_value) AS new_sum_values,
        COALESCE(dss.sum_squared_values, 0) + SUM(POWER(nsd.new_value, 2)) AS new_sum_squared_values,
        COALESCE(dss.count_samples, 0) + COUNT(*) AS new_count_samples,
        LEAST(COALESCE(dss.min_value, nsd.new_value), MIN(nsd.new_value)) AS new_min_value,
        GREATEST(COALESCE(dss.max_value, nsd.new_value), MAX(nsd.new_value)) AS new_max_value,
        (COALESCE(dss.sum_values, 0) + SUM(nsd.new_value)) /
        NULLIF(COALESCE(dss.count_samples, 0) + COUNT(*), 0) AS new_mean_value,
        SQRT(((COALESCE(dss.sum_squared_values, 0) + SUM(POWER(nsd.new_value, 2))) /
              NULLIF(COALESCE(dss.count_samples, 0) + COUNT(*), 0)) -
             POWER((COALESCE(dss.sum_values, 0) + SUM(nsd.new_value)) /
                   NULLIF(COALESCE(dss.count_samples, 0) + COUNT(*), 0), 2)) AS new_stddev_value
    FROM data_standardization_state dss
    FULL OUTER JOIN new_standardization_data nsd ON dss.table_name = nsd.table_name
                                                    AND dss.column_name = nsd.column_name
                                                    AND dss.standardization_method = nsd.standardization_method
    GROUP BY dss.table_name, nsd.table_name, dss.column_name, nsd.column_name,
             dss.standardization_method, nsd.standardization_method, dss.sum_values,
             dss.sum_squared_values, dss.count_samples, dss.min_value, dss.max_value
)
-- æ›´æ–°æˆ–æ’å…¥æ•°æ®æ ‡å‡†åŒ–çŠ¶æ€
INSERT INTO data_standardization_state (
    table_name,
    column_name,
    standardization_method,
    sum_values,
    sum_squared_values,
    count_samples,
    min_value,
    max_value,
    mean_value,
    stddev_value,
    last_updated
)
SELECT
    table_name,
    column_name,
    standardization_method,
    new_sum_values,
    new_sum_squared_values,
    new_count_samples,
    new_min_value,
    new_max_value,
    new_mean_value,
    new_stddev_value,
    NOW()
FROM updated_standardization_stats
ON CONFLICT (table_name, column_name, standardization_method)
DO UPDATE SET
    sum_values = EXCLUDED.sum_values,
    sum_squared_values = EXCLUDED.sum_squared_values,
    count_samples = EXCLUDED.count_samples,
    min_value = EXCLUDED.min_value,
    max_value = EXCLUDED.max_value,
    mean_value = EXCLUDED.mean_value,
    stddev_value = EXCLUDED.stddev_value,
    last_updated = NOW();
```

**3. æ™ºèƒ½æ•°æ®æ ‡å‡†åŒ–ï¼šè‡ªé€‚åº”æ ‡å‡†åŒ–æ–¹æ³•é€‰æ‹©**

**æ™ºèƒ½æ•°æ®æ ‡å‡†åŒ–**ï¼šæ ¹æ®æ•°æ®ç‰¹å¾è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æ ‡å‡†åŒ–æ–¹æ³•ã€‚

```sql
-- æ™ºèƒ½æ•°æ®æ ‡å‡†åŒ–ï¼šè‡ªé€‚åº”æ ‡å‡†åŒ–æ–¹æ³•é€‰æ‹©ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
DECLARE
    data_distribution_type VARCHAR(50);
    data_variance NUMERIC;
    recommended_method VARCHAR(50);
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'standardization_test') THEN
            RAISE WARNING 'è¡¨ standardization_test ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡Œæ™ºèƒ½æ•°æ®æ ‡å‡†åŒ–';
            RETURN;
        END IF;

        -- è®¡ç®—æ•°æ®ç‰¹å¾
        WITH distribution_features AS (
            SELECT
                AVG(value) AS mean_val,
                STDDEV(value) AS stddev_val,
                PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY value) AS median_val,
                MIN(value) AS min_val,
                MAX(value) AS max_val
            FROM standardization_test
            WHERE value IS NOT NULL
        )
        SELECT
            CASE
                WHEN ABS(mean_val - median_val) / NULLIF(stddev_val, 0) < 0.3 THEN 'Normal'
                ELSE 'Skewed'
            END,
            stddev_val / NULLIF(mean_val, 0)
        INTO data_distribution_type, data_variance
        FROM distribution_features;

        -- æ ¹æ®æ•°æ®ç‰¹å¾è‡ªé€‚åº”é€‰æ‹©æ ‡å‡†åŒ–æ–¹æ³•
        IF data_distribution_type = 'Normal' AND data_variance < 0.5 THEN
            recommended_method := 'Z_SCORE';  -- æ­£æ€åˆ†å¸ƒä½æ–¹å·®ï¼šZ-scoreæ ‡å‡†åŒ–
        ELSIF data_distribution_type = 'Skewed' THEN
            recommended_method := 'ROBUST';  -- åæ€åˆ†å¸ƒï¼šRobustæ ‡å‡†åŒ–
        ELSIF (SELECT MAX(value) - MIN(value) FROM standardization_test WHERE value IS NOT NULL) < 1000 THEN
            recommended_method := 'MIN_MAX';  -- æœ‰ç•Œå°èŒƒå›´ï¼šMin-Maxæ ‡å‡†åŒ–
        ELSE
            recommended_method := 'DECIMAL_SCALING';  -- å¤§æ•°å€¼ï¼šDecimal Scaling
        END IF;

        RAISE NOTICE 'æ•°æ®åˆ†å¸ƒç±»å‹: %, æ•°æ®æ–¹å·®: %, æ¨èæ–¹æ³•: %',
            data_distribution_type, data_variance, recommended_method;
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'æ™ºèƒ½æ•°æ®æ ‡å‡†åŒ–å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- æ™ºèƒ½æ•°æ®æ ‡å‡†åŒ–ï¼šæ ¹æ®ç­–ç•¥é€‰æ‹©ä¸åŒçš„æ ‡å‡†åŒ–æ–¹æ³•
WITH distribution_characteristics AS (
    SELECT
        AVG(value) AS mean_val,
        STDDEV(value) AS stddev_val,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY value) AS median_val,
        MIN(value) AS min_val,
        MAX(value) AS max_val,
        MAX(value) - MIN(value) AS value_range,
        STDDEV(value) / NULLIF(AVG(value), 0) AS coefficient_of_variation
    FROM standardization_test
    WHERE value IS NOT NULL
),
adaptive_standardization AS (
    SELECT
        st.id,
        st.name,
        st.value,
        dc.mean_val,
        dc.stddev_val,
        dc.median_val,
        dc.min_val,
        dc.max_val,
        dc.value_range,
        dc.coefficient_of_variation,
        CASE
            WHEN ABS(dc.mean_val - dc.median_val) / NULLIF(dc.stddev_val, 0) < 0.3
                 AND dc.coefficient_of_variation < 0.5 THEN 'Z_SCORE'
            WHEN ABS(dc.mean_val - dc.median_val) / NULLIF(dc.stddev_val, 0) >= 0.3 THEN 'ROBUST'
            WHEN dc.value_range < 1000 THEN 'MIN_MAX'
            ELSE 'DECIMAL_SCALING'
        END AS recommended_method,
        -- æ ¹æ®æ¨èæ–¹æ³•è®¡ç®—æ ‡å‡†åŒ–å€¼ï¼ˆé¿å…é‡å¤è®¡ç®—ï¼‰
        CASE
            WHEN ABS(dc.mean_val - dc.median_val) / NULLIF(dc.stddev_val, 0) < 0.3
                 AND dc.coefficient_of_variation < 0.5 THEN
                (st.value - dc.mean_val) / NULLIF(dc.stddev_val, 0)
            ELSE NULL
        END AS z_score_standardized,
        CASE
            WHEN ABS(dc.mean_val - dc.median_val) / NULLIF(dc.stddev_val, 0) >= 0.3 THEN
                (st.value - dc.median_val) / NULLIF(PERCENTILE_CONT(0.75) WITHIN GROUP (ORDER BY st.value) OVER () -
                                                      PERCENTILE_CONT(0.25) WITHIN GROUP (ORDER BY st.value) OVER (), 0)
            ELSE NULL
        END AS robust_standardized,
        CASE
            WHEN dc.value_range < 1000 THEN
                (st.value - dc.min_val) / NULLIF(dc.value_range, 0)
            ELSE NULL
        END AS min_max_standardized
    FROM standardization_test st
    CROSS JOIN distribution_characteristics dc
    WHERE st.value IS NOT NULL
)
SELECT
    id,
    name,
    value,
    ROUND(mean_val::numeric, 2) AS mean_val,
    ROUND(stddev_val::numeric, 2) AS stddev_val,
    ROUND(coefficient_of_variation::numeric, 4) AS coefficient_of_variation,
    recommended_method,
    ROUND(COALESCE(z_score_standardized, robust_standardized, min_max_standardized, 0)::numeric, 4) AS standardized_value,
    CASE
        WHEN recommended_method = 'Z_SCORE' THEN 'Use Z-score standardization for normal distribution'
        WHEN recommended_method = 'ROBUST' THEN 'Use Robust standardization for skewed distribution'
        WHEN recommended_method = 'MIN_MAX' THEN 'Use Min-Max standardization for bounded range'
        ELSE 'Use Decimal Scaling for large values'
    END AS standardization_advice
FROM adaptive_standardization
ORDER BY id DESC
LIMIT 100;
```

---

## ğŸ“š å‚è€ƒèµ„æº

### å­¦æœ¯æ–‡çŒ®

1. **ã€Šæ•°æ®æŒ–æ˜ï¼šæ¦‚å¿µä¸æŠ€æœ¯ã€‹**ï¼ˆHan et al., 2011ï¼‰- ç¬¬3ç«  æ•°æ®é¢„å¤„ç†

2. **ã€Šæœºå™¨å­¦ä¹ ã€‹**ï¼ˆå‘¨å¿—å, 2016ï¼‰- ç¬¬11ç«  ç‰¹å¾é€‰æ‹©ä¸ç¨€ç–å­¦ä¹ 

3. **ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹**ï¼ˆæèˆª, 2012ï¼‰- æ•°æ®é¢„å¤„ç†

### PostgreSQLå®˜æ–¹æ–‡æ¡£

- **å­—ç¬¦ä¸²å‡½æ•°**: <https://www.postgresql.org/docs/current/functions-string.html>
- **æ•°å­¦å‡½æ•°**: <https://www.postgresql.org/docs/current/functions-math.html>
- **æ—¥æœŸæ—¶é—´å‡½æ•°**: <https://www.postgresql.org/docs/current/functions-datetime.html>
- **æ­£åˆ™è¡¨è¾¾å¼**: <https://www.postgresql.org/docs/current/functions-matching.html>

### åœ¨çº¿èµ„æº

- **æ•°æ®æ ‡å‡†åŒ–**: <https://en.wikipedia.org/wiki/Feature_scaling>
- **Z-score**: <https://en.wikipedia.org/wiki/Standard_score>
- **æ•°æ®é¢„å¤„ç†**: <https://scikit-learn.org/stable/modules/preprocessing.html>

### ç›¸å…³ç®—æ³•

- **æ•°æ®æ¸…æ´—ç®—æ³•**ï¼šæ•°æ®æ ‡å‡†åŒ–çš„å‰ç½®æ­¥éª¤
- **æ•°æ®éªŒè¯ç®—æ³•**ï¼šæ•°æ®æ ‡å‡†åŒ–çš„éªŒè¯
- **æ•°æ®å®Œæ•´æ€§æ£€æŸ¥**ï¼šæ•°æ®æ ‡å‡†åŒ–çš„å®Œæ•´æ€§ä¿è¯
- **æè¿°æ€§ç»Ÿè®¡**ï¼šæ ‡å‡†åŒ–ç»Ÿè®¡å€¼è®¡ç®—

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ
