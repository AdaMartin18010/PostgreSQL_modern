# PostgreSQL å·®åˆ†éšç§ç®—æ³•å®Œæ•´æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æŠ€æœ¯æ ˆ**: PostgreSQL 17+/18+ | æ•°æ®éšç§ | å·®åˆ†éšç§ | éšç§ä¿æŠ¤
> **éš¾åº¦çº§åˆ«**: â­â­â­â­â­ (ä¸“å®¶çº§)
> **å‚è€ƒæ ‡å‡†**: Differential Privacy (Dwork et al.), Privacy-Preserving Data Analysis

---

## ğŸ“‹ ç›®å½•

- [PostgreSQL å·®åˆ†éšç§ç®—æ³•å®Œæ•´æŒ‡å—](#postgresql-å·®åˆ†éšç§ç®—æ³•å®Œæ•´æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [å·®åˆ†éšç§æ¦‚è¿°](#å·®åˆ†éšç§æ¦‚è¿°)
    - [ç†è®ºåŸºç¡€](#ç†è®ºåŸºç¡€)
    - [æ•°å­¦å®šä¹‰](#æ•°å­¦å®šä¹‰)
    - [éšç§ä¿è¯](#éšç§ä¿è¯)
  - [1. æ‹‰æ™®æ‹‰æ–¯æœºåˆ¶](#1-æ‹‰æ™®æ‹‰æ–¯æœºåˆ¶)
    - [1.1 æ‹‰æ™®æ‹‰æ–¯æœºåˆ¶åŸç†](#11-æ‹‰æ™®æ‹‰æ–¯æœºåˆ¶åŸç†)
    - [1.2 æ•æ„Ÿåº¦è®¡ç®—](#12-æ•æ„Ÿåº¦è®¡ç®—)
  - [2. é«˜æ–¯æœºåˆ¶](#2-é«˜æ–¯æœºåˆ¶)
    - [2.1 é«˜æ–¯æœºåˆ¶åŸç†](#21-é«˜æ–¯æœºåˆ¶åŸç†)
  - [3. æŒ‡æ•°æœºåˆ¶](#3-æŒ‡æ•°æœºåˆ¶)
    - [3.1 æŒ‡æ•°æœºåˆ¶åŸç†](#31-æŒ‡æ•°æœºåˆ¶åŸç†)
  - [4. ç»„åˆæ€§è´¨](#4-ç»„åˆæ€§è´¨)
    - [4.1 ä¸²è¡Œç»„åˆ](#41-ä¸²è¡Œç»„åˆ)
    - [4.2 å¹¶è¡Œç»„åˆ](#42-å¹¶è¡Œç»„åˆ)
  - [5. å¤æ‚åº¦åˆ†æ](#5-å¤æ‚åº¦åˆ†æ)
  - [6. å®é™…åº”ç”¨æ¡ˆä¾‹](#6-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [6.1 ç»Ÿè®¡æŸ¥è¯¢](#61-ç»Ÿè®¡æŸ¥è¯¢)
    - [6.2 æ•°æ®å‘å¸ƒ](#62-æ•°æ®å‘å¸ƒ)
  - [ğŸ“š å‚è€ƒèµ„æº](#-å‚è€ƒèµ„æº)
  - [ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®](#-æ€§èƒ½ä¼˜åŒ–å»ºè®®)
  - [ğŸ¯ æœ€ä½³å®è·µ](#-æœ€ä½³å®è·µ)

---

## å·®åˆ†éšç§æ¦‚è¿°

**å·®åˆ†éšç§ï¼ˆDifferential Privacyï¼‰**æ˜¯ä¸€ç§ä¸¥æ ¼çš„éšç§ä¿æŠ¤æ¡†æ¶ï¼Œç¡®ä¿å•ä¸ªè®°å½•çš„å­˜åœ¨ä¸å¦ä¸ä¼šæ˜¾è‘—å½±å“æŸ¥è¯¢ç»“æœã€‚

### ç†è®ºåŸºç¡€

å·®åˆ†éšç§çš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡æ·»åŠ ç²¾å¿ƒè®¾è®¡çš„å™ªå£°æ¥ä¿æŠ¤ä¸ªä½“éšç§ï¼ŒåŒæ—¶ä¿æŒç»Ÿè®¡ç»“æœçš„å¯ç”¨æ€§ã€‚

### æ•°å­¦å®šä¹‰

**Îµ-å·®åˆ†éšç§**:
å¯¹äºæ‰€æœ‰ç›¸é‚»æ•°æ®é›† $D$ å’Œ $D'$ï¼ˆç›¸å·®ä¸€æ¡è®°å½•ï¼‰ï¼Œä»¥åŠæ‰€æœ‰è¾“å‡º $S$ï¼š

$$P(M(D) \in S) \leq e^{\epsilon} P(M(D') \in S)$$

å…¶ä¸­ï¼š

- $M$ æ˜¯æœºåˆ¶ï¼ˆç®—æ³•ï¼‰
- $\epsilon$ æ˜¯éšç§é¢„ç®—ï¼ˆè¶Šå°è¶Šéšç§ï¼‰

### éšç§ä¿è¯

| Îµå€¼ | éšç§çº§åˆ« | æ•°æ®å¯ç”¨æ€§ |
|-----|---------|-----------|
| **0.1** | é«˜éšç§ | ä½å¯ç”¨æ€§ |
| **1.0** | ä¸­ç­‰éšç§ | ä¸­ç­‰å¯ç”¨æ€§ |
| **10.0** | ä½éšç§ | é«˜å¯ç”¨æ€§ |

---

## 1. æ‹‰æ™®æ‹‰æ–¯æœºåˆ¶

### 1.1 æ‹‰æ™®æ‹‰æ–¯æœºåˆ¶åŸç†

**æ‹‰æ™®æ‹‰æ–¯æœºåˆ¶**ç”¨äºæ•°å€¼æŸ¥è¯¢ï¼Œæ·»åŠ æ‹‰æ™®æ‹‰æ–¯å™ªå£°ã€‚

**å™ªå£°è§„æ¨¡**:
$$\lambda = \frac{\Delta f}{\epsilon}$$

å…¶ä¸­ $\Delta f$ æ˜¯æŸ¥è¯¢çš„æ•æ„Ÿåº¦ã€‚

```sql
-- å·®åˆ†éšç§æ•°æ®å‡†å¤‡ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'sensitive_data') THEN
            RAISE WARNING 'è¡¨ sensitive_data å·²å­˜åœ¨ï¼Œå…ˆåˆ é™¤';
            DROP TABLE sensitive_data CASCADE;
        END IF;

        CREATE TABLE sensitive_data (
            id SERIAL PRIMARY KEY,
            value NUMERIC NOT NULL,
            category VARCHAR(20) NOT NULL
        );

        -- æ’å…¥æ•æ„Ÿæ•°æ®
        INSERT INTO sensitive_data (value, category) VALUES
            (100, 'A'), (150, 'A'), (200, 'B'), (250, 'B');

        RAISE NOTICE 'è¡¨ sensitive_data åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ sensitive_data å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE EXCEPTION 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
    END;
END $$;

-- æ‹‰æ™®æ‹‰æ–¯æœºåˆ¶å®ç°
WITH query_result AS (
    SELECT
        category,
        SUM(value) AS true_sum,
        COUNT(*) AS true_count
    FROM sensitive_data
    GROUP BY category
),
sensitivity AS (
    SELECT
        1.0 AS epsilon,  -- éšç§é¢„ç®—
        MAX(value) AS max_value,  -- æ•æ„Ÿåº¦ï¼ˆç®€åŒ–ï¼šå‡è®¾æœ€å¤§å€¼ä¸ºæ•æ„Ÿåº¦ï¼‰
        MAX(value) / 1.0 AS laplace_scale
    FROM sensitive_data
),
laplace_noise AS (
    SELECT
        category,
        true_sum,
        true_count,
        -- æ‹‰æ™®æ‹‰æ–¯å™ªå£°ï¼ˆä½¿ç”¨æŒ‡æ•°åˆ†å¸ƒè¿‘ä¼¼ï¼‰
        (RANDOM() - 0.5) * 2 * laplace_scale * LN(RANDOM() + 0.0001) AS noise
    FROM query_result
    CROSS JOIN sensitivity
),
noisy_result AS (
    SELECT
        category,
        true_sum,
        true_count,
        true_sum + noise AS noisy_sum,
        GREATEST(0, true_count + noise) AS noisy_count  -- ç¡®ä¿éè´Ÿ
    FROM laplace_noise
)
SELECT
    category,
    ROUND(true_sum::numeric, 2) AS true_sum,
    ROUND(noisy_sum::numeric, 2) AS noisy_sum,
    ROUND(ABS(true_sum - noisy_sum)::numeric, 2) AS noise_magnitude
FROM noisy_result
ORDER BY category;
```

### 1.2 æ•æ„Ÿåº¦è®¡ç®—

**å…¨å±€æ•æ„Ÿåº¦**:
$$\Delta f = \max_{D, D'} |f(D) - f(D')|$$

```sql
-- æ•æ„Ÿåº¦è®¡ç®—
WITH sensitivity_analysis AS (
    SELECT
        'SUM' AS query_type,
        MAX(value) AS global_sensitivity
    FROM sensitive_data
    UNION ALL
    SELECT
        'AVG' AS query_type,
        MAX(value) / NULLIF(MIN(COUNT(*)), 0) AS global_sensitivity
    FROM sensitive_data
    GROUP BY category
)
SELECT
    query_type,
    ROUND(global_sensitivity::numeric, 2) AS sensitivity
FROM sensitivity_analysis;
```

---

## 2. é«˜æ–¯æœºåˆ¶

### 2.1 é«˜æ–¯æœºåˆ¶åŸç†

**é«˜æ–¯æœºåˆ¶**ä½¿ç”¨é«˜æ–¯å™ªå£°ï¼Œé€‚ç”¨äº(Îµ, Î´)-å·®åˆ†éšç§ã€‚

**å™ªå£°æ ‡å‡†å·®**:
$$\sigma = \frac{\Delta f \sqrt{2\ln(1.25/\delta)}}{\epsilon}$$

```sql
-- é«˜æ–¯æœºåˆ¶å®ç°
WITH gaussian_noise AS (
    SELECT
        category,
        true_sum,
        -- é«˜æ–¯å™ªå£°ï¼ˆä½¿ç”¨Box-Mullerå˜æ¢è¿‘ä¼¼ï¼‰
        SQRT(-2 * LN(RANDOM() + 0.0001)) * COS(2 * PI() * RANDOM()) * sigma AS noise
    FROM query_result
    CROSS JOIN (
        SELECT
            1.0 AS epsilon,
            0.0001 AS delta,
            MAX(value) * SQRT(2 * LN(1.25 / 0.0001)) / 1.0 AS sigma
        FROM sensitive_data
    ) noise_params
)
SELECT
    category,
    ROUND((true_sum + noise)::numeric, 2) AS noisy_sum
FROM gaussian_noise;
```

---

## 3. æŒ‡æ•°æœºåˆ¶

### 3.1 æŒ‡æ•°æœºåˆ¶åŸç†

**æŒ‡æ•°æœºåˆ¶**ç”¨äºéæ•°å€¼æŸ¥è¯¢ï¼Œä»å€™é€‰é›†åˆä¸­é€‰æ‹©è¾“å‡ºã€‚

**é€‰æ‹©æ¦‚ç‡**:
$$P(\text{output} = r) \propto \exp\left(\frac{\epsilon q(D, r)}{2\Delta q}\right)$$

å…¶ä¸­ $q(D, r)$ æ˜¯è´¨é‡å‡½æ•°ã€‚

```sql
-- æŒ‡æ•°æœºåˆ¶å®ç°
WITH quality_scores AS (
    SELECT
        category,
        COUNT(*) AS quality_score
    FROM sensitive_data
    GROUP BY category
),
max_sensitivity AS (
    SELECT MAX(quality_score) AS delta_q FROM quality_scores
),
exponential_weights AS (
    SELECT
        category,
        quality_score,
        EXP(1.0 * quality_score / (2 * (SELECT delta_q FROM max_sensitivity))) AS weight
    FROM quality_scores
    CROSS JOIN max_sensitivity
),
normalized_probabilities AS (
    SELECT
        category,
        weight,
        weight / SUM(weight) OVER () AS selection_probability
    FROM exponential_weights
)
SELECT
    category,
    ROUND(selection_probability::numeric, 4) AS probability
FROM normalized_probabilities
ORDER BY selection_probability DESC;
```

---

## 4. ç»„åˆæ€§è´¨

### 4.1 ä¸²è¡Œç»„åˆ

**ä¸²è¡Œç»„åˆ**: å¤šä¸ªæŸ¥è¯¢çš„éšç§é¢„ç®—ç´¯åŠ ã€‚

$$\epsilon_{total} = \sum_{i=1}^{k} \epsilon_i$$

```sql
-- ä¸²è¡Œç»„åˆéšç§é¢„ç®—ç®¡ç†
WITH query_budget AS (
    SELECT
        query_id,
        epsilon_used
    FROM privacy_budget_log
),
total_budget AS (
    SELECT
        SUM(epsilon_used) AS total_epsilon_used,
        10.0 AS total_budget
    FROM query_budget
)
SELECT
    ROUND(total_epsilon_used::numeric, 4) AS used_budget,
    ROUND(total_budget::numeric, 4) AS total_budget,
    ROUND((total_budget - total_epsilon_used)::numeric, 4) AS remaining_budget,
    CASE
        WHEN total_epsilon_used < total_budget THEN 'Budget available'
        ELSE 'Budget exhausted'
    END AS budget_status
FROM total_budget;
```

### 4.2 å¹¶è¡Œç»„åˆ

**å¹¶è¡Œç»„åˆ**: ä¸ç›¸äº¤æ•°æ®é›†çš„æŸ¥è¯¢éšç§é¢„ç®—ä¸ç´¯åŠ ã€‚

---

## 5. å¤æ‚åº¦åˆ†æ

| æœºåˆ¶ | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ | éšç§ä¿è¯ |
|------|-----------|-----------|---------|
| **æ‹‰æ™®æ‹‰æ–¯** | $O(1)$ | $O(1)$ | Îµ-DP |
| **é«˜æ–¯** | $O(1)$ | $O(1)$ | (Îµ,Î´)-DP |
| **æŒ‡æ•°** | $O(|R|)$ | $O(|R|)$ | Îµ-DP |

---

## 6. å®é™…åº”ç”¨æ¡ˆä¾‹

### 6.1 ç»Ÿè®¡æŸ¥è¯¢

```sql
-- å·®åˆ†éšç§ç»Ÿè®¡æŸ¥è¯¢
WITH private_statistics AS (
    SELECT
        category,
        SUM(value) + laplace_noise(SUM(value), 1.0, MAX(value)) AS private_sum,
        AVG(value) + laplace_noise(AVG(value), 1.0, MAX(value)) AS private_avg
    FROM sensitive_data
    GROUP BY category
)
SELECT
    category,
    ROUND(private_sum::numeric, 2) AS private_sum,
    ROUND(private_avg::numeric, 2) AS private_avg
FROM private_statistics;
```

### 6.2 æ•°æ®å‘å¸ƒ

```sql
-- å·®åˆ†éšç§æ•°æ®å‘å¸ƒ
WITH private_release AS (
    SELECT
        id,
        value + laplace_noise(value, 0.5, MAX(value) OVER ()) AS private_value,
        category
    FROM sensitive_data
)
SELECT
    category,
    COUNT(*) AS private_count,
    AVG(private_value) AS private_mean
FROM private_release
GROUP BY category;
```

---

## ğŸ“š å‚è€ƒèµ„æº

1. **Dwork, C., Roth, A. (2014)**: "The Algorithmic Foundations of Differential Privacy"
2. **Dwork, C. (2006)**: "Differential Privacy"
3. **Li, N., et al. (2012)**: "Differential Privacy: From Theory to Practice"

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **éšç§é¢„ç®—ç®¡ç†**: åˆç†åˆ†é…éšç§é¢„ç®—
2. **æ•æ„Ÿåº¦ä¼˜åŒ–**: é™ä½æŸ¥è¯¢æ•æ„Ÿåº¦
3. **ç»„åˆä¼˜åŒ–**: åˆ©ç”¨å¹¶è¡Œç»„åˆæ€§è´¨

## ğŸ¯ æœ€ä½³å®è·µ

1. **éšç§é¢„ç®—**: è°¨æ…ä½¿ç”¨éšç§é¢„ç®—
2. **æ•æ„Ÿåº¦**: å°½å¯èƒ½é™ä½æ•æ„Ÿåº¦
3. **éªŒè¯**: éªŒè¯éšç§ä¿è¯
4. **æƒè¡¡**: å¹³è¡¡éšç§å’Œå¯ç”¨æ€§

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ
