# PostgreSQL ç½®ä¿¡åŒºé—´ç®—æ³•å®Œæ•´æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æŠ€æœ¯æ ˆ**: PostgreSQL 17+/18+ | ç»Ÿè®¡æ¨æ–­ | ç½®ä¿¡åŒºé—´ | Bootstrap
> **éš¾åº¦çº§åˆ«**: â­â­â­â­ (é«˜çº§)
> **å‚è€ƒæ ‡å‡†**: Statistical Inference (Casella & Berger), Bootstrap Methods

---

## ğŸ“‹ ç›®å½•

- [PostgreSQL ç½®ä¿¡åŒºé—´ç®—æ³•å®Œæ•´æŒ‡å—](#postgresql-ç½®ä¿¡åŒºé—´ç®—æ³•å®Œæ•´æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [ç½®ä¿¡åŒºé—´æ¦‚è¿°](#ç½®ä¿¡åŒºé—´æ¦‚è¿°)
    - [ç†è®ºåŸºç¡€](#ç†è®ºåŸºç¡€)
    - [æ•°å­¦å®šä¹‰](#æ•°å­¦å®šä¹‰)
    - [ç½®ä¿¡æ°´å¹³](#ç½®ä¿¡æ°´å¹³)
  - [1. æ­£æ€åˆ†å¸ƒç½®ä¿¡åŒºé—´](#1-æ­£æ€åˆ†å¸ƒç½®ä¿¡åŒºé—´)
    - [1.1 å‡å€¼ç½®ä¿¡åŒºé—´](#11-å‡å€¼ç½®ä¿¡åŒºé—´)
    - [1.2 æ–¹å·®ç½®ä¿¡åŒºé—´](#12-æ–¹å·®ç½®ä¿¡åŒºé—´)
  - [2. tåˆ†å¸ƒç½®ä¿¡åŒºé—´](#2-tåˆ†å¸ƒç½®ä¿¡åŒºé—´)
    - [2.1 å°æ ·æœ¬å‡å€¼ç½®ä¿¡åŒºé—´](#21-å°æ ·æœ¬å‡å€¼ç½®ä¿¡åŒºé—´)
  - [3. Bootstrapæ–¹æ³•](#3-bootstrapæ–¹æ³•)
    - [3.1 BootstrapåŸç†](#31-bootstrapåŸç†)
    - [3.2 Bootstrapå®ç°](#32-bootstrapå®ç°)
  - [4. æ¯”ä¾‹ç½®ä¿¡åŒºé—´](#4-æ¯”ä¾‹ç½®ä¿¡åŒºé—´)
    - [4.1 äºŒé¡¹æ¯”ä¾‹ç½®ä¿¡åŒºé—´](#41-äºŒé¡¹æ¯”ä¾‹ç½®ä¿¡åŒºé—´)
  - [5. å¤æ‚åº¦åˆ†æ](#5-å¤æ‚åº¦åˆ†æ)
  - [6. å®é™…åº”ç”¨æ¡ˆä¾‹](#6-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [6.1 å‚æ•°ä¼°è®¡](#61-å‚æ•°ä¼°è®¡)
    - [6.2 é¢„æµ‹åŒºé—´](#62-é¢„æµ‹åŒºé—´)
  - [ğŸ“š å‚è€ƒèµ„æº](#-å‚è€ƒèµ„æº)
  - [ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®](#-æ€§èƒ½ä¼˜åŒ–å»ºè®®)
  - [ğŸ¯ æœ€ä½³å®è·µ](#-æœ€ä½³å®è·µ)

---

## ç½®ä¿¡åŒºé—´æ¦‚è¿°

**ç½®ä¿¡åŒºé—´**æ˜¯å‚æ•°ä¼°è®¡çš„é‡è¦å·¥å…·ï¼Œæä¾›äº†ä¸€ä¸ªåŒ…å«çœŸå®å‚æ•°å€¼çš„åŒºé—´ï¼Œå¹¶ç»™å‡ºç½®ä¿¡æ°´å¹³ã€‚

### ç†è®ºåŸºç¡€

ç»™å®šæ ·æœ¬æ•°æ®ï¼Œç½®ä¿¡åŒºé—´ $[L, U]$ æ»¡è¶³ï¼š

$$P(L \leq \theta \leq U) = 1 - \alpha$$

å…¶ä¸­ï¼š

- $\theta$ æ˜¯å¾…ä¼°è®¡å‚æ•°
- $\alpha$ æ˜¯æ˜¾è‘—æ€§æ°´å¹³
- $1 - \alpha$ æ˜¯ç½®ä¿¡æ°´å¹³

### æ•°å­¦å®šä¹‰

**ç½®ä¿¡åŒºé—´çš„ä¸€èˆ¬å½¢å¼**:
$$\hat{\theta} \pm z_{\alpha/2} \times SE(\hat{\theta})$$

å…¶ä¸­ï¼š

- $\hat{\theta}$ æ˜¯å‚æ•°ä¼°è®¡å€¼
- $z_{\alpha/2}$ æ˜¯æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„ä¸´ç•Œå€¼
- $SE(\hat{\theta})$ æ˜¯æ ‡å‡†è¯¯å·®

### ç½®ä¿¡æ°´å¹³

| ç½®ä¿¡æ°´å¹³ | æ˜¾è‘—æ€§æ°´å¹³ | $z_{\alpha/2}$ (æ­£æ€) | $t_{\alpha/2}$ (df=9) |
|---------|-----------|---------------------|---------------------|
| **90%** | 0.10 | 1.645 | 1.833 |
| **95%** | 0.05 | 1.960 | 2.262 |
| **99%** | 0.01 | 2.576 | 3.250 |

---

## 1. æ­£æ€åˆ†å¸ƒç½®ä¿¡åŒºé—´

### 1.1 å‡å€¼ç½®ä¿¡åŒºé—´

**æ€»ä½“æ–¹å·®å·²çŸ¥æ—¶**ï¼Œå‡å€¼çš„ç½®ä¿¡åŒºé—´ä¸ºï¼š

$$\bar{x} \pm z_{\alpha/2} \times \frac{\sigma}{\sqrt{n}}$$

**æ€»ä½“æ–¹å·®æœªçŸ¥æ—¶**ï¼Œä½¿ç”¨æ ·æœ¬æ ‡å‡†å·®ï¼š

$$\bar{x} \pm z_{\alpha/2} \times \frac{s}{\sqrt{n}}$$

```sql
-- å‡å€¼ç½®ä¿¡åŒºé—´è®¡ç®—ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ci_sample_data') THEN
            RAISE WARNING 'è¡¨ ci_sample_data å·²å­˜åœ¨ï¼Œå…ˆåˆ é™¤';
            DROP TABLE ci_sample_data CASCADE;
        END IF;

        CREATE TABLE ci_sample_data (
            id SERIAL PRIMARY KEY,
            value NUMERIC NOT NULL
        );

        -- æ’å…¥ç¤ºä¾‹æ•°æ®
        INSERT INTO ci_sample_data (value) VALUES
            (10.2), (9.8), (10.5), (10.1), (9.9),
            (10.3), (10.0), (9.7), (10.4), (10.1);

        RAISE NOTICE 'è¡¨ ci_sample_data åˆ›å»ºæˆåŠŸï¼Œå·²æ’å…¥10æ¡æ•°æ®';
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ ci_sample_data å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE EXCEPTION 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
    END;
END $$;

-- 95%ç½®ä¿¡åŒºé—´è®¡ç®—
WITH sample_stats AS (
    SELECT
        COUNT(*) AS n,
        AVG(value) AS sample_mean,
        STDDEV(value) AS sample_std,
        1.96 AS z_critical  -- 95%ç½®ä¿¡æ°´å¹³
    FROM ci_sample_data
),
confidence_interval AS (
    SELECT
        n,
        sample_mean,
        sample_std,
        sample_mean - z_critical * (sample_std / SQRT(n)) AS lower_bound,
        sample_mean + z_critical * (sample_std / SQRT(n)) AS upper_bound,
        z_critical * (sample_std / SQRT(n)) AS margin_of_error
    FROM sample_stats
)
SELECT
    n AS sample_size,
    ROUND(sample_mean::numeric, 4) AS sample_mean,
    ROUND(sample_std::numeric, 4) AS sample_std,
    ROUND(lower_bound::numeric, 4) AS ci_lower_95,
    ROUND(upper_bound::numeric, 4) AS ci_upper_95,
    ROUND(margin_of_error::numeric, 4) AS margin_of_error,
    '95%' AS confidence_level
FROM confidence_interval;

-- æ€§èƒ½æµ‹è¯•
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT
    AVG(value) AS sample_mean,
    STDDEV(value) AS sample_std,
    COUNT(*) AS n
FROM ci_sample_data;
```

### 1.2 æ–¹å·®ç½®ä¿¡åŒºé—´

**æ–¹å·®çš„ç½®ä¿¡åŒºé—´**ï¼ˆæ­£æ€åˆ†å¸ƒï¼‰ï¼š

$$\frac{(n-1)s^2}{\chi^2_{\alpha/2, n-1}} \leq \sigma^2 \leq \frac{(n-1)s^2}{\chi^2_{1-\alpha/2, n-1}}$$

```sql
-- æ–¹å·®ç½®ä¿¡åŒºé—´è®¡ç®—
WITH sample_stats AS (
    SELECT
        COUNT(*) AS n,
        VARIANCE(value) AS sample_var,
        STDDEV(value) AS sample_std
    FROM ci_sample_data
),
chi_square_values AS (
    SELECT
        -- å¡æ–¹åˆ†å¸ƒä¸´ç•Œå€¼ï¼ˆç®€åŒ–ï¼šä½¿ç”¨è¿‘ä¼¼å€¼ï¼‰
        2.700 AS chi_sq_lower,  -- Ï‡Â²_{0.975, 9}
        19.023 AS chi_sq_upper   -- Ï‡Â²_{0.025, 9}
    FROM generate_series(1, 1)
),
variance_ci AS (
    SELECT
        ss.n,
        ss.sample_var,
        (ss.n - 1) * ss.sample_var / NULLIF(csv.chi_sq_upper, 0) AS var_lower,
        (ss.n - 1) * ss.sample_var / NULLIF(csv.chi_sq_lower, 0) AS var_upper,
        SQRT((ss.n - 1) * ss.sample_var / NULLIF(csv.chi_sq_upper, 0)) AS std_lower,
        SQRT((ss.n - 1) * ss.sample_var / NULLIF(csv.chi_sq_lower, 0)) AS std_upper
    FROM sample_stats ss
    CROSS JOIN chi_square_values csv
)
SELECT
    n,
    ROUND(sample_var::numeric, 4) AS sample_variance,
    ROUND(var_lower::numeric, 4) AS variance_ci_lower,
    ROUND(var_upper::numeric, 4) AS variance_ci_upper,
    ROUND(std_lower::numeric, 4) AS std_ci_lower,
    ROUND(std_upper::numeric, 4) AS std_ci_upper
FROM variance_ci;
```

---

## 2. tåˆ†å¸ƒç½®ä¿¡åŒºé—´

### 2.1 å°æ ·æœ¬å‡å€¼ç½®ä¿¡åŒºé—´

**å°æ ·æœ¬ï¼ˆn < 30ï¼‰æ—¶**ï¼Œä½¿ç”¨tåˆ†å¸ƒï¼š

$$\bar{x} \pm t_{\alpha/2, n-1} \times \frac{s}{\sqrt{n}}$$

```sql
-- tåˆ†å¸ƒç½®ä¿¡åŒºé—´è®¡ç®—
WITH sample_stats AS (
    SELECT
        COUNT(*) AS n,
        AVG(value) AS sample_mean,
        STDDEV(value) AS sample_std,
        2.262 AS t_critical  -- t_{0.025, 9} for 95% CI
    FROM ci_sample_data
),
t_confidence_interval AS (
    SELECT
        n,
        sample_mean,
        sample_std,
        sample_mean - t_critical * (sample_std / SQRT(n)) AS lower_bound,
        sample_mean + t_critical * (sample_std / SQRT(n)) AS upper_bound
    FROM sample_stats
)
SELECT
    n AS sample_size,
    ROUND(sample_mean::numeric, 4) AS sample_mean,
    ROUND(lower_bound::numeric, 4) AS ci_lower_95_t,
    ROUND(upper_bound::numeric, 4) AS ci_upper_95_t,
    't-distribution' AS distribution_type
FROM t_confidence_interval;
```

---

## 3. Bootstrapæ–¹æ³•

### 3.1 BootstrapåŸç†

**Bootstrapæ–¹æ³•**æ˜¯ä¸€ç§éå‚æ•°ç»Ÿè®¡æ–¹æ³•ï¼Œé€šè¿‡é‡é‡‡æ ·ä¼°è®¡å‚æ•°çš„ç½®ä¿¡åŒºé—´ã€‚

**ç®—æ³•æ­¥éª¤**:

1. ä»åŸå§‹æ ·æœ¬ä¸­æœ‰æ”¾å›æŠ½æ ·ï¼Œå¾—åˆ°Bootstrapæ ·æœ¬
2. è®¡ç®—Bootstrapç»Ÿè®¡é‡
3. é‡å¤æ­¥éª¤1-2å¤šæ¬¡ï¼ˆé€šå¸¸1000-10000æ¬¡ï¼‰
4. ä½¿ç”¨Bootstrapç»Ÿè®¡é‡çš„åˆ†ä½æ•°æ„å»ºç½®ä¿¡åŒºé—´

### 3.2 Bootstrapå®ç°

```sql
-- Bootstrapç½®ä¿¡åŒºé—´å®ç°ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ci_sample_data') THEN
            RAISE WARNING 'è¡¨ ci_sample_data ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡ŒBootstrap';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡ŒBootstrapç½®ä¿¡åŒºé—´è®¡ç®—';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'Bootstrapè®¡ç®—å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- Bootstrapé‡é‡‡æ ·ï¼ˆç®€åŒ–ç‰ˆï¼šå±•ç¤ºåŸç†ï¼‰
WITH bootstrap_samples AS (
    SELECT
        bootstrap_id,
        AVG(value) AS bootstrap_mean
    FROM (
        SELECT
            generate_series(1, 1000) AS bootstrap_id,
            (SELECT value FROM ci_sample_data ORDER BY RANDOM() LIMIT 1) AS value
        FROM generate_series(1, 10)  -- æ¯ä¸ªBootstrapæ ·æœ¬10ä¸ªè§‚æµ‹
    ) bootstrap_data
    GROUP BY bootstrap_id
),
bootstrap_percentiles AS (
    SELECT
        PERCENTILE_CONT(0.025) WITHIN GROUP (ORDER BY bootstrap_mean) AS ci_lower,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY bootstrap_mean) AS median,
        PERCENTILE_CONT(0.975) WITHIN GROUP (ORDER BY bootstrap_mean) AS ci_upper
    FROM bootstrap_samples
)
SELECT
    ROUND(ci_lower::numeric, 4) AS bootstrap_ci_lower_95,
    ROUND(median::numeric, 4) AS bootstrap_median,
    ROUND(ci_upper::numeric, 4) AS bootstrap_ci_upper_95
FROM bootstrap_percentiles;
```

---

## 4. æ¯”ä¾‹ç½®ä¿¡åŒºé—´

### 4.1 äºŒé¡¹æ¯”ä¾‹ç½®ä¿¡åŒºé—´

**äºŒé¡¹æ¯”ä¾‹çš„ç½®ä¿¡åŒºé—´**ï¼ˆæ­£æ€è¿‘ä¼¼ï¼‰ï¼š

$$\hat{p} \pm z_{\alpha/2} \times \sqrt{\frac{\hat{p}(1-\hat{p})}{n}}$$

```sql
-- æ¯”ä¾‹ç½®ä¿¡åŒºé—´è®¡ç®—
WITH proportion_data AS (
    SELECT
        COUNT(*) FILTER (WHERE success = 1) AS successes,
        COUNT(*) AS total,
        COUNT(*) FILTER (WHERE success = 1)::NUMERIC / COUNT(*) AS sample_proportion
    FROM binary_data
),
proportion_ci AS (
    SELECT
        successes,
        total,
        sample_proportion,
        sample_proportion - 1.96 * SQRT(sample_proportion * (1 - sample_proportion) / total) AS ci_lower,
        sample_proportion + 1.96 * SQRT(sample_proportion * (1 - sample_proportion) / total) AS ci_upper
    FROM proportion_data
)
SELECT
    successes,
    total,
    ROUND(sample_proportion::numeric, 4) AS sample_proportion,
    ROUND(ci_lower::numeric, 4) AS proportion_ci_lower_95,
    ROUND(ci_upper::numeric, 4) AS proportion_ci_upper_95
FROM proportion_ci;
```

---

## 5. å¤æ‚åº¦åˆ†æ

| æ–¹æ³• | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ |
|------|-----------|-----------|---------|
| **æ­£æ€åˆ†å¸ƒCI** | $O(n)$ | $O(1)$ | å¤§æ ·æœ¬ï¼Œæ­£æ€åˆ†å¸ƒ |
| **tåˆ†å¸ƒCI** | $O(n)$ | $O(1)$ | å°æ ·æœ¬ï¼Œæ­£æ€åˆ†å¸ƒ |
| **Bootstrap** | $O(Bn)$ | $O(B)$ | éå‚æ•°ï¼Œä»»æ„åˆ†å¸ƒ |

å…¶ä¸­ $B$ æ˜¯Bootstrapé‡é‡‡æ ·æ¬¡æ•°ã€‚

---

## 6. å®é™…åº”ç”¨æ¡ˆä¾‹

### 6.1 å‚æ•°ä¼°è®¡

```sql
-- å‚æ•°ä¼°è®¡åº”ç”¨ç¤ºä¾‹
WITH parameter_estimation AS (
    SELECT
        parameter_name,
        point_estimate,
        ci_lower,
        ci_upper,
        (ci_upper - ci_lower) / 2.0 AS margin_of_error
    FROM estimated_parameters
)
SELECT
    parameter_name,
    ROUND(point_estimate::numeric, 4) AS estimate,
    ROUND(ci_lower::numeric, 4) AS ci_lower_95,
    ROUND(ci_upper::numeric, 4) AS ci_upper_95,
    ROUND(margin_of_error::numeric, 4) AS margin_of_error
FROM parameter_estimation;
```

### 6.2 é¢„æµ‹åŒºé—´

```sql
-- é¢„æµ‹åŒºé—´è®¡ç®—ï¼ˆå›å½’é¢„æµ‹ï¼‰
WITH regression_prediction AS (
    SELECT
        x_value,
        predicted_y,
        prediction_std_error
    FROM regression_results
),
prediction_interval AS (
    SELECT
        x_value,
        predicted_y,
        predicted_y - 1.96 * prediction_std_error AS pred_lower,
        predicted_y + 1.96 * prediction_std_error AS pred_upper
    FROM regression_prediction
)
SELECT
    x_value,
    ROUND(predicted_y::numeric, 4) AS predicted_value,
    ROUND(pred_lower::numeric, 4) AS prediction_interval_lower,
    ROUND(pred_upper::numeric, 4) AS prediction_interval_upper
FROM prediction_interval;
```

---

## ğŸ“š å‚è€ƒèµ„æº

1. **Casella, G., Berger, R.L. (2002)**: "Statistical Inference"
2. **Efron, B., Tibshirani, R.J. (1994)**: "An Introduction to the Bootstrap"
3. **Davison, A.C., Hinkley, D.V. (1997)**: "Bootstrap Methods and Their Application"

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æ ·æœ¬é‡**: ç¡®ä¿è¶³å¤Ÿçš„æ ·æœ¬é‡
2. **Bootstrapæ¬¡æ•°**: æ ¹æ®ç²¾åº¦éœ€æ±‚é€‰æ‹©Bootstrapæ¬¡æ•°
3. **å¹¶è¡Œè®¡ç®—**: åˆ©ç”¨PostgreSQLå¹¶è¡Œå¤„ç†Bootstrap

## ğŸ¯ æœ€ä½³å®è·µ

1. **åˆ†å¸ƒå‡è®¾**: æ£€æŸ¥æ•°æ®æ˜¯å¦ç¬¦åˆåˆ†å¸ƒå‡è®¾
2. **æ ·æœ¬é‡**: å°æ ·æœ¬æ—¶ä½¿ç”¨tåˆ†å¸ƒ
3. **Bootstrap**: éå‚æ•°æƒ…å†µä¸‹ä½¿ç”¨Bootstrap
4. **è§£é‡Š**: æ­£ç¡®è§£é‡Šç½®ä¿¡åŒºé—´çš„å«ä¹‰

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ
