# PostgreSQL éå‚æ•°ç»Ÿè®¡æ–¹æ³•å®Œæ•´æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æŠ€æœ¯æ ˆ**: PostgreSQL 17+/18+ | ç»Ÿè®¡æ¨æ–­ | éå‚æ•°ç»Ÿè®¡ | ç§©æ£€éªŒ
> **éš¾åº¦çº§åˆ«**: â­â­â­â­ (é«˜çº§)
> **å‚è€ƒæ ‡å‡†**: Nonparametric Statistical Methods (Hollander et al.), Statistical Inference

---

## ğŸ“‹ ç›®å½•

- [PostgreSQL éå‚æ•°ç»Ÿè®¡æ–¹æ³•å®Œæ•´æŒ‡å—](#postgresql-éå‚æ•°ç»Ÿè®¡æ–¹æ³•å®Œæ•´æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [éå‚æ•°ç»Ÿè®¡æ¦‚è¿°](#éå‚æ•°ç»Ÿè®¡æ¦‚è¿°)
    - [ç†è®ºåŸºç¡€](#ç†è®ºåŸºç¡€)
    - [ä¼˜åŠ¿ç‰¹ç‚¹](#ä¼˜åŠ¿ç‰¹ç‚¹)
    - [åº”ç”¨åœºæ™¯](#åº”ç”¨åœºæ™¯)
  - [1. ç§©æ£€éªŒ](#1-ç§©æ£€éªŒ)
    - [1.1 Wilcoxonç¬¦å·ç§©æ£€éªŒ](#11-wilcoxonç¬¦å·ç§©æ£€éªŒ)
  - [2. PostgreSQL 18 å¹¶è¡Œéå‚æ•°ç»Ÿè®¡å¢å¼º](#2-postgresql-18-å¹¶è¡Œéå‚æ•°ç»Ÿè®¡å¢å¼º)
    - [2.1 å¹¶è¡Œéå‚æ•°ç»Ÿè®¡åŸç†](#21-å¹¶è¡Œéå‚æ•°ç»Ÿè®¡åŸç†)
    - [2.2 å¹¶è¡ŒWilcoxonç¬¦å·ç§©æ£€éªŒ](#22-å¹¶è¡Œwilcoxonç¬¦å·ç§©æ£€éªŒ)
    - [2.3 å¹¶è¡ŒMann-Whitney Uæ£€éªŒ](#23-å¹¶è¡Œmann-whitney-uæ£€éªŒ)
  - [ğŸ“š å‚è€ƒèµ„æº](#-å‚è€ƒèµ„æº)

---

## éå‚æ•°ç»Ÿè®¡æ¦‚è¿°

**éå‚æ•°ç»Ÿè®¡**ä¸ä¾èµ–äºæ€»ä½“åˆ†å¸ƒå‡è®¾ï¼Œé€‚ç”¨äºåˆ†å¸ƒæœªçŸ¥æˆ–éæ­£æ€çš„æ•°æ®ã€‚

### ç†è®ºåŸºç¡€

éå‚æ•°æ–¹æ³•åŸºäº**ç§©**ã€**ç¬¦å·**æˆ–**åˆ†å¸ƒå‡½æ•°**ï¼Œè€Œéå‚æ•°å€¼æœ¬èº«ã€‚

### ä¼˜åŠ¿ç‰¹ç‚¹

| ä¼˜åŠ¿ | è¯´æ˜ |
|------|------|
| **æ— åˆ†å¸ƒå‡è®¾** | ä¸è¦æ±‚æ­£æ€åˆ†å¸ƒ |
| **ç¨³å¥æ€§** | å¯¹å¼‚å¸¸å€¼ä¸æ•æ„Ÿ |
| **é€‚ç”¨æ€§å¹¿** | é€‚ç”¨äºå„ç§æ•°æ®ç±»å‹ |

### åº”ç”¨åœºæ™¯

| åº”ç”¨é¢†åŸŸ | å…·ä½“åº”ç”¨ |
|---------|---------|
| **åŒ»å­¦** | ä¸´åºŠè¯•éªŒã€ç–—æ•ˆè¯„ä¼° |
| **ç¤¾ä¼šç§‘å­¦** | è°ƒæŸ¥æ•°æ®åˆ†æ |
| **è´¨é‡æ§åˆ¶** | éæ­£æ€è¿‡ç¨‹æ§åˆ¶ |

---

## 1. ç§©æ£€éªŒ

### 1.1 Wilcoxonç¬¦å·ç§©æ£€éªŒ

**Wilcoxonç¬¦å·ç§©æ£€éªŒ**ç”¨äºé…å¯¹æ ·æœ¬çš„éå‚æ•°æ£€éªŒã€‚

```sql
-- éå‚æ•°ç»Ÿè®¡æ•°æ®å‡†å¤‡ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'nonparametric_data') THEN
            RAISE WARNING 'è¡¨ nonparametric_data å·²å­˜åœ¨ï¼Œå…ˆåˆ é™¤';
            DROP TABLE nonparametric_data CASCADE;
        END IF;

        CREATE TABLE nonparametric_data (
            id SERIAL PRIMARY KEY,
            before_value NUMERIC NOT NULL,
            after_value NUMERIC NOT NULL
        );

        INSERT INTO nonparametric_data (before_value, after_value) VALUES
            (10, 12), (15, 18), (20, 19), (25, 28), (30, 32);

        RAISE NOTICE 'è¡¨ nonparametric_data åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ nonparametric_data å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE EXCEPTION 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
    END;
END $$;

-- Wilcoxonç¬¦å·ç§©æ£€éªŒ
WITH differences AS (
    SELECT
        id,
        after_value - before_value AS difference,
        ABS(after_value - before_value) AS abs_difference
    FROM nonparametric_data
),
ranked_differences AS (
    SELECT
        id,
        difference,
        abs_difference,
        ROW_NUMBER() OVER (ORDER BY abs_difference) AS rank
    FROM differences
    WHERE difference != 0
),
signed_ranks AS (
    SELECT
        SUM(CASE WHEN difference > 0 THEN rank ELSE 0 END) AS positive_rank_sum,
        SUM(CASE WHEN difference < 0 THEN rank ELSE 0 END) AS negative_rank_sum,
        COUNT(*) AS n
    FROM ranked_differences
),
wilcoxon_statistic AS (
    SELECT
        LEAST(positive_rank_sum, negative_rank_sum) AS w_statistic,
        n
    FROM signed_ranks
)
SELECT
    w_statistic,
    n,
    CASE
        WHEN w_statistic <= 2 THEN 'Reject H0 (p < 0.05, n=5)'
        ELSE 'Fail to reject H0'
    END AS conclusion
FROM wilcoxon_statistic;
```

---

## 2. PostgreSQL 18 å¹¶è¡Œéå‚æ•°ç»Ÿè®¡å¢å¼º

**PostgreSQL 18** æ˜¾è‘—å¢å¼ºäº†å¹¶è¡Œéå‚æ•°ç»Ÿè®¡è®¡ç®—èƒ½åŠ›ï¼Œæ”¯æŒå¹¶è¡Œæ‰§è¡Œç§©æ£€éªŒã€ç¬¦å·æ£€éªŒå’Œåˆ†å¸ƒæ£€éªŒï¼Œå¤§å¹…æå‡å¤§è§„æ¨¡éå‚æ•°ç»Ÿè®¡æ£€éªŒçš„æ€§èƒ½ã€‚

### 2.1 å¹¶è¡Œéå‚æ•°ç»Ÿè®¡åŸç†

PostgreSQL 18 çš„å¹¶è¡Œéå‚æ•°ç»Ÿè®¡é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š

1. **å¹¶è¡Œæ‰«æ**ï¼šå¤šä¸ªå·¥ä½œè¿›ç¨‹å¹¶è¡Œæ‰«ææ•°æ®
2. **å¹¶è¡Œç§©è®¡ç®—**ï¼šæ¯ä¸ªå·¥ä½œè¿›ç¨‹ç‹¬ç«‹è®¡ç®—éƒ¨åˆ†ç§©
3. **å¹¶è¡Œç»Ÿè®¡é‡è®¡ç®—**ï¼šå¹¶è¡Œæ‰§è¡Œæ£€éªŒç»Ÿè®¡é‡è®¡ç®—
4. **ç»“æœåˆå¹¶**ï¼šä¸»è¿›ç¨‹åˆå¹¶æ‰€æœ‰å·¥ä½œè¿›ç¨‹çš„æ£€éªŒç»“æœ

### 2.2 å¹¶è¡ŒWilcoxonç¬¦å·ç§©æ£€éªŒ

```sql
-- PostgreSQL 18 å¹¶è¡ŒWilcoxonç¬¦å·ç§©æ£€éªŒï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'nonparametric_data') THEN
            RAISE WARNING 'è¡¨ nonparametric_data ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡Œå¹¶è¡ŒWilcoxonç¬¦å·ç§©æ£€éªŒ';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡ŒPostgreSQL 18å¹¶è¡ŒWilcoxonç¬¦å·ç§©æ£€éªŒ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¹¶è¡ŒWilcoxonç¬¦å·ç§©æ£€éªŒå‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

SET max_parallel_workers_per_gather = 4;
SET parallel_setup_cost = 0;

-- å¹¶è¡ŒWilcoxonç¬¦å·ç§©æ£€éªŒ
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
WITH differences AS (
    SELECT
        id,
        after_value - before_value AS difference,
        ABS(after_value - before_value) AS abs_difference
    FROM nonparametric_data
),
ranked_differences AS (
    SELECT
        id,
        difference,
        ROW_NUMBER() OVER (ORDER BY abs_difference) AS rank
    FROM differences
    WHERE difference != 0
),
signed_ranks AS (
    SELECT
        SUM(CASE WHEN difference > 0 THEN rank ELSE 0 END) AS positive_rank_sum,
        SUM(CASE WHEN difference < 0 THEN rank ELSE 0 END) AS negative_rank_sum,
        COUNT(*) AS n
    FROM ranked_differences
)
SELECT
    LEAST(positive_rank_sum, negative_rank_sum) AS w_statistic,
    n,
    CASE
        WHEN LEAST(positive_rank_sum, negative_rank_sum) <= 2 THEN 'Reject H0 (p < 0.05, n=5)'
        ELSE 'Fail to reject H0'
    END AS conclusion
FROM signed_ranks;
```

### 2.3 å¹¶è¡ŒMann-Whitney Uæ£€éªŒ

```sql
-- PostgreSQL 18 å¹¶è¡ŒMann-Whitney Uæ£€éªŒï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'two_group_data') THEN
            RAISE WARNING 'è¡¨ two_group_data ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡Œå¹¶è¡ŒMann-Whitney Uæ£€éªŒ';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡ŒPostgreSQL 18å¹¶è¡ŒMann-Whitney Uæ£€éªŒ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¹¶è¡ŒMann-Whitney Uæ£€éªŒå‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

SET max_parallel_workers_per_gather = 4;
SET parallel_setup_cost = 0;

-- å¹¶è¡ŒMann-Whitney Uæ£€éªŒï¼šä¸¤ç‹¬ç«‹æ ·æœ¬
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
WITH combined_ranks AS (
    SELECT
        value,
        group_id,
        ROW_NUMBER() OVER (ORDER BY value) AS rank
    FROM two_group_data
),
group_rank_sums AS (
    SELECT
        group_id,
        SUM(rank) AS rank_sum,
        COUNT(*) AS n
    FROM combined_ranks
    GROUP BY group_id
),
u_statistics AS (
    SELECT
        g1.group_id AS group1,
        g2.group_id AS group2,
        g1.n AS n1,
        g2.n AS n2,
        g1.rank_sum AS r1,
        g2.rank_sum AS r2,
        g1.n * g2.n + g1.n * (g1.n + 1) / 2 - g1.rank_sum AS u1,
        g1.n * g2.n + g2.n * (g2.n + 1) / 2 - g2.rank_sum AS u2
    FROM group_rank_sums g1
    CROSS JOIN group_rank_sums g2
    WHERE g1.group_id < g2.group_id
)
SELECT
    group1,
    group2,
    LEAST(u1, u2) AS u_statistic,
    CASE
        WHEN LEAST(u1, u2) <= 2 THEN 'Reject H0 (p < 0.05)'
        ELSE 'Fail to reject H0'
    END AS conclusion
FROM u_statistics;
```

---

## ğŸ“š å‚è€ƒèµ„æº

1. **Hollander, M., et al. (2013)**: "Nonparametric Statistical Methods"

### SQLå®ç°æ³¨æ„äº‹é¡¹

1. **ç§©è®¡ç®—**: éœ€è¦å¯¹æ•°æ®è¿›è¡Œæ’åºè®¡ç®—ç§©ï¼Œæ³¨æ„æ’åºæ€§èƒ½
2. **ç»“å¤„ç†**: ç›¸åŒå€¼éœ€è¦å¹³å‡ç§©ï¼Œæ³¨æ„ç»“çš„å¤„ç†
3. **æ•°å€¼ç²¾åº¦**: ä½¿ç”¨NUMERICç±»å‹ä¿æŒè®¡ç®—ç²¾åº¦
4. **å¤§æ ·æœ¬è¿‘ä¼¼**: å¯¹äºå¤§æ ·æœ¬ï¼Œä½¿ç”¨æ­£æ€è¿‘ä¼¼è®¡ç®—på€¼

### PostgreSQL 18 æ–°ç‰¹æ€§åº”ç”¨ï¼ˆå¢å¼ºï¼‰

**PostgreSQL 18**å¼•å…¥äº†å¤šé¡¹å¢å¼ºåŠŸèƒ½ï¼Œå¯ä»¥æ˜¾è‘—æå‡éå‚æ•°ç»Ÿè®¡æ–¹æ³•çš„æ€§èƒ½ï¼š

1. **Skip Scanä¼˜åŒ–**ï¼š
   - å¯¹äºåŒ…å«ç»„åˆ«æ ‡ç­¾çš„ç´¢å¼•ï¼ŒSkip Scanå¯ä»¥è·³è¿‡ä¸å¿…è¦çš„ç´¢å¼•æ‰«æ
   - ç‰¹åˆ«é€‚ç”¨äºTop-Nç§©æ£€éªŒæŸ¥è¯¢å’Œå¤šç»„å¯¹æ¯”æŸ¥è¯¢

2. **å¼‚æ­¥I/Oå¢å¼º**ï¼š
   - å¯¹äºå¤§è§„æ¨¡éå‚æ•°ç»Ÿè®¡ï¼Œå¼‚æ­¥I/Oå¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½
   - é€‚ç”¨äºæ‰¹é‡ç§©è®¡ç®—å’Œå¹¶è¡Œæ£€éªŒç»Ÿè®¡é‡è®¡ç®—

3. **å¹¶è¡ŒæŸ¥è¯¢å¢å¼º**ï¼š
   - éå‚æ•°ç»Ÿè®¡æ”¯æŒæ›´å¥½çš„å¹¶è¡Œæ‰§è¡Œï¼ˆå·²åœ¨2èŠ‚è¯¦ç»†è¯´æ˜ï¼‰
   - é€‚ç”¨äºå¤§è§„æ¨¡ç§©æ£€éªŒå’Œå¹¶è¡Œåˆ†å¸ƒæ£€éªŒ

**ç¤ºä¾‹ï¼šä½¿ç”¨Skip Scanä¼˜åŒ–éå‚æ•°ç»Ÿè®¡æŸ¥è¯¢**

```sql
-- ä¸ºéå‚æ•°ç»Ÿè®¡åˆ›å»ºSkip Scanä¼˜åŒ–ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_nonparametric_skip_scan
ON nonparametric_data(id DESC, ABS(after_value - before_value) DESC);

-- Skip Scanä¼˜åŒ–æŸ¥è¯¢ï¼šæŸ¥æ‰¾å·®å¼‚æœ€å¤§çš„é…å¯¹
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT DISTINCT ON (ABS(after_value - before_value))
    id,
    before_value,
    after_value,
    ABS(after_value - before_value) AS abs_difference
FROM nonparametric_data
ORDER BY ABS(after_value - before_value) DESC, id DESC
LIMIT 50;
```

### é«˜çº§ä¼˜åŒ–æŠ€å·§ï¼ˆå¢å¼ºï¼‰

**1. ä½¿ç”¨ç‰©åŒ–è§†å›¾ç¼“å­˜éå‚æ•°ç»Ÿè®¡ç»“æœ**

å¯¹äºé¢‘ç¹ä½¿ç”¨çš„éå‚æ•°ç»Ÿè®¡ç»“æœï¼Œä½¿ç”¨ç‰©åŒ–è§†å›¾ç¼“å­˜ï¼š

```sql
-- åˆ›å»ºç‰©åŒ–è§†å›¾ç¼“å­˜éå‚æ•°ç»Ÿè®¡ç»“æœ
CREATE MATERIALIZED VIEW IF NOT EXISTS nonparametric_statistics_cache AS
WITH ranked_data AS (
    SELECT
        id,
        before_value,
        after_value,
        after_value - before_value AS difference,
        ABS(after_value - before_value) AS abs_difference,
        -- ä½¿ç”¨çª—å£å‡½æ•°è®¡ç®—ç§©ï¼ˆé¿å…é‡å¤æ’åºï¼‰
        ROW_NUMBER() OVER (ORDER BY ABS(after_value - before_value)) AS rank
    FROM nonparametric_data
    WHERE after_value - before_value != 0
),
wilcoxon_stats AS (
    SELECT
        SUM(CASE WHEN difference > 0 THEN rank ELSE 0 END) AS positive_rank_sum,
        SUM(CASE WHEN difference < 0 THEN rank ELSE 0 END) AS negative_rank_sum,
        COUNT(*) AS n,
        LEAST(
            SUM(CASE WHEN difference > 0 THEN rank ELSE 0 END),
            SUM(CASE WHEN difference < 0 THEN rank ELSE 0 END)
        ) AS w_statistic
    FROM ranked_data
)
SELECT
    n,
    positive_rank_sum,
    negative_rank_sum,
    w_statistic,
    CASE
        WHEN w_statistic <= 2 AND n = 5 THEN 'Reject H0 (p < 0.05) - Significant'
        WHEN w_statistic <= 8 AND n = 10 THEN 'Reject H0 (p < 0.05) - Significant'
        ELSE 'Fail to reject H0 - Not Significant'
    END AS test_conclusion,
    CASE
        WHEN n < 10 THEN 'Use Exact Test'
        WHEN n < 30 THEN 'Use Normal Approximation'
        ELSE 'Use Asymptotic Test'
    END AS test_method_advice
FROM wilcoxon_stats;

-- åˆ›å»ºç´¢å¼•åŠ é€Ÿç‰©åŒ–è§†å›¾æŸ¥è¯¢
CREATE INDEX idx_nonparametric_statistics_cache_conclusion ON nonparametric_statistics_cache(test_conclusion, w_statistic);
CREATE INDEX idx_nonparametric_statistics_cache_method ON nonparametric_statistics_cache(test_method_advice, n);

-- å®šæœŸåˆ·æ–°ç‰©åŒ–è§†å›¾
REFRESH MATERIALIZED VIEW CONCURRENTLY nonparametric_statistics_cache;
```

**2. å®æ—¶éå‚æ•°ç»Ÿè®¡ï¼šå¢é‡ç§©æ›´æ–°**

**å®æ—¶éå‚æ•°ç»Ÿè®¡**ï¼šå¯¹äºå®æ—¶æ•°æ®ï¼Œä½¿ç”¨å¢é‡æ–¹æ³•æ›´æ–°ç§©æ£€éªŒç»“æœã€‚

```sql
-- å®æ—¶éå‚æ•°ç»Ÿè®¡ï¼šå¢é‡ç§©æ›´æ–°ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'nonparametric_statistics_state') THEN
            CREATE TABLE nonparametric_statistics_state (
                test_id VARCHAR(100) NOT NULL,
                sum_positive_ranks NUMERIC DEFAULT 0,
                sum_negative_ranks NUMERIC DEFAULT 0,
                count_pairs BIGINT DEFAULT 0,
                w_statistic NUMERIC,
                test_conclusion VARCHAR(50),
                last_updated TIMESTAMPTZ DEFAULT NOW(),
                PRIMARY KEY (test_id)
            );

            CREATE INDEX idx_nonparametric_statistics_state_test ON nonparametric_statistics_state(test_id, last_updated DESC);
            CREATE INDEX idx_nonparametric_statistics_state_updated ON nonparametric_statistics_state(last_updated DESC);

            RAISE NOTICE 'éå‚æ•°ç»Ÿè®¡çŠ¶æ€è¡¨åˆ›å»ºæˆåŠŸ';
        END IF;

        RAISE NOTICE 'å¼€å§‹æ‰§è¡Œå¢é‡éå‚æ•°ç»Ÿè®¡æ›´æ–°';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¢é‡éå‚æ•°ç»Ÿè®¡æ›´æ–°å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

**3. æ™ºèƒ½éå‚æ•°ç»Ÿè®¡ä¼˜åŒ–ï¼šè‡ªé€‚åº”æ£€éªŒæ–¹æ³•é€‰æ‹©**

**æ™ºèƒ½éå‚æ•°ç»Ÿè®¡ä¼˜åŒ–**ï¼šæ ¹æ®æ•°æ®ç‰¹å¾è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜éå‚æ•°æ£€éªŒæ–¹æ³•ã€‚

```sql
-- æ™ºèƒ½éå‚æ•°ç»Ÿè®¡ä¼˜åŒ–ï¼šè‡ªé€‚åº”æ£€éªŒæ–¹æ³•é€‰æ‹©ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
DECLARE
    sample_size BIGINT;
    is_paired BOOLEAN;
    group_count INTEGER;
    recommended_test VARCHAR(50);
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'nonparametric_data') THEN
            RAISE WARNING 'è¡¨ nonparametric_data ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡Œæ™ºèƒ½éå‚æ•°ç»Ÿè®¡ä¼˜åŒ–';
            RETURN;
        END IF;

        -- è®¡ç®—æ•°æ®ç‰¹å¾
        SELECT
            COUNT(*),
            TRUE,  -- é…å¯¹æ•°æ®
            2  -- ä¸¤ä¸ªç»„ï¼ˆbefore/afterï¼‰
        INTO sample_size, is_paired, group_count
        FROM nonparametric_data;

        -- æ ¹æ®æ•°æ®ç‰¹å¾è‡ªé€‚åº”é€‰æ‹©éå‚æ•°æ£€éªŒæ–¹æ³•
        IF is_paired AND sample_size < 30 THEN
            recommended_test := 'WILCOXON_SIGNED_RANK';  -- é…å¯¹å°æ ·æœ¬ï¼šWilcoxonç¬¦å·ç§©
        ELSIF is_paired AND sample_size >= 30 THEN
            recommended_test := 'SIGN_TEST';  -- é…å¯¹å¤§æ ·æœ¬ï¼šç¬¦å·æ£€éªŒ
        ELSIF NOT is_paired AND group_count = 2 THEN
            recommended_test := 'MANN_WHITNEY_U';  -- ä¸¤ç‹¬ç«‹ç»„ï¼šMann-Whitney U
        ELSIF group_count > 2 THEN
            recommended_test := 'KRUSKAL_WALLIS';  -- å¤šç»„ï¼šKruskal-Wallis
        ELSE
            recommended_test := 'WILCOXON_SIGNED_RANK';  -- é»˜è®¤ï¼šWilcoxonç¬¦å·ç§©
        END IF;

        RAISE NOTICE 'æ ·æœ¬å¤§å°: %, é…å¯¹: %, ç»„æ•°: %, æ¨èæ£€éªŒ: %',
            sample_size, is_paired, group_count, recommended_test;
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'æ™ºèƒ½éå‚æ•°ç»Ÿè®¡ä¼˜åŒ–å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆï¼ˆåŒ…å«å®Œæ•´ç†è®ºæ¨å¯¼ã€å®ç°å’ŒPostgreSQL 18æ–°ç‰¹æ€§æ”¯æŒï¼‰
