# PostgreSQL éžå‚æ•°ç»Ÿè®¡æ–¹æ³•å®Œæ•´æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æŠ€æœ¯æ ˆ**: PostgreSQL 17+/18+ | ç»Ÿè®¡æŽ¨æ–­ | éžå‚æ•°ç»Ÿè®¡ | ç§©æ£€éªŒ
> **éš¾åº¦çº§åˆ«**: â­â­â­â­ (é«˜çº§)
> **å‚è€ƒæ ‡å‡†**: Nonparametric Statistical Methods (Hollander et al.), Statistical Inference

---

## ðŸ“‹ ç›®å½•

- [PostgreSQL éžå‚æ•°ç»Ÿè®¡æ–¹æ³•å®Œæ•´æŒ‡å—](#postgresql-éžå‚æ•°ç»Ÿè®¡æ–¹æ³•å®Œæ•´æŒ‡å—)
  - [ðŸ“‹ ç›®å½•](#-ç›®å½•)
  - [éžå‚æ•°ç»Ÿè®¡æ¦‚è¿°](#éžå‚æ•°ç»Ÿè®¡æ¦‚è¿°)
    - [ç†è®ºåŸºç¡€](#ç†è®ºåŸºç¡€)
    - [ä¼˜åŠ¿ç‰¹ç‚¹](#ä¼˜åŠ¿ç‰¹ç‚¹)
    - [åº”ç”¨åœºæ™¯](#åº”ç”¨åœºæ™¯)
  - [1. ç§©æ£€éªŒ](#1-ç§©æ£€éªŒ)
    - [1.1 Wilcoxonç¬¦å·ç§©æ£€éªŒ](#11-wilcoxonç¬¦å·ç§©æ£€éªŒ)
  - [ðŸ“š å‚è€ƒèµ„æº](#-å‚è€ƒèµ„æº)

---

## éžå‚æ•°ç»Ÿè®¡æ¦‚è¿°

**éžå‚æ•°ç»Ÿè®¡**ä¸ä¾èµ–äºŽæ€»ä½“åˆ†å¸ƒå‡è®¾ï¼Œé€‚ç”¨äºŽåˆ†å¸ƒæœªçŸ¥æˆ–éžæ­£æ€çš„æ•°æ®ã€‚

### ç†è®ºåŸºç¡€

éžå‚æ•°æ–¹æ³•åŸºäºŽ**ç§©**ã€**ç¬¦å·**æˆ–**åˆ†å¸ƒå‡½æ•°**ï¼Œè€Œéžå‚æ•°å€¼æœ¬èº«ã€‚

### ä¼˜åŠ¿ç‰¹ç‚¹

| ä¼˜åŠ¿ | è¯´æ˜Ž |
|------|------|
| **æ— åˆ†å¸ƒå‡è®¾** | ä¸è¦æ±‚æ­£æ€åˆ†å¸ƒ |
| **ç¨³å¥æ€§** | å¯¹å¼‚å¸¸å€¼ä¸æ•æ„Ÿ |
| **é€‚ç”¨æ€§å¹¿** | é€‚ç”¨äºŽå„ç§æ•°æ®ç±»åž‹ |

### åº”ç”¨åœºæ™¯

| åº”ç”¨é¢†åŸŸ | å…·ä½“åº”ç”¨ |
|---------|---------|
| **åŒ»å­¦** | ä¸´åºŠè¯•éªŒã€ç–—æ•ˆè¯„ä¼° |
| **ç¤¾ä¼šç§‘å­¦** | è°ƒæŸ¥æ•°æ®åˆ†æž |
| **è´¨é‡æŽ§åˆ¶** | éžæ­£æ€è¿‡ç¨‹æŽ§åˆ¶ |

---

## 1. ç§©æ£€éªŒ

### 1.1 Wilcoxonç¬¦å·ç§©æ£€éªŒ

**Wilcoxonç¬¦å·ç§©æ£€éªŒ**ç”¨äºŽé…å¯¹æ ·æœ¬çš„éžå‚æ•°æ£€éªŒã€‚

```sql
-- éžå‚æ•°ç»Ÿè®¡æ•°æ®å‡†å¤‡ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'nonparametric_data') THEN
            RAISE WARNING 'è¡¨ nonparametric_data å·²å­˜åœ¨ï¼Œå…ˆåˆ é™¤';
            DROP TABLE nonparametric_data CASCADE;
        END IF;

        CREATE TABLE nonparametric_data (
            id SERIAL PRIMARY KEY,
            before_value NUMERIC NOT NULL,
            after_value NUMERIC NOT NULL
        );

        INSERT INTO nonparametric_data (before_value, after_value) VALUES
            (10, 12), (15, 18), (20, 19), (25, 28), (30, 32);

        RAISE NOTICE 'è¡¨ nonparametric_data åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ nonparametric_data å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE EXCEPTION 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
    END;
END $$;

-- Wilcoxonç¬¦å·ç§©æ£€éªŒ
WITH differences AS (
    SELECT
        id,
        after_value - before_value AS difference,
        ABS(after_value - before_value) AS abs_difference
    FROM nonparametric_data
),
ranked_differences AS (
    SELECT
        id,
        difference,
        abs_difference,
        ROW_NUMBER() OVER (ORDER BY abs_difference) AS rank
    FROM differences
    WHERE difference != 0
),
signed_ranks AS (
    SELECT
        SUM(CASE WHEN difference > 0 THEN rank ELSE 0 END) AS positive_rank_sum,
        SUM(CASE WHEN difference < 0 THEN rank ELSE 0 END) AS negative_rank_sum,
        COUNT(*) AS n
    FROM ranked_differences
),
wilcoxon_statistic AS (
    SELECT
        LEAST(positive_rank_sum, negative_rank_sum) AS w_statistic,
        n
    FROM signed_ranks
)
SELECT
    w_statistic,
    n,
    CASE
        WHEN w_statistic <= 2 THEN 'Reject H0 (p < 0.05, n=5)'
        ELSE 'Fail to reject H0'
    END AS conclusion
FROM wilcoxon_statistic;
```

---

## 2. PostgreSQL 18 å¹¶è¡Œéžå‚æ•°ç»Ÿè®¡å¢žå¼º

**PostgreSQL 18** æ˜¾è‘—å¢žå¼ºäº†å¹¶è¡Œéžå‚æ•°ç»Ÿè®¡è®¡ç®—èƒ½åŠ›ï¼Œæ”¯æŒå¹¶è¡Œæ‰§è¡Œç§©æ£€éªŒã€ç¬¦å·æ£€éªŒå’Œåˆ†å¸ƒæ£€éªŒï¼Œå¤§å¹…æå‡å¤§è§„æ¨¡éžå‚æ•°ç»Ÿè®¡æ£€éªŒçš„æ€§èƒ½ã€‚

### 2.1 å¹¶è¡Œéžå‚æ•°ç»Ÿè®¡åŽŸç†

PostgreSQL 18 çš„å¹¶è¡Œéžå‚æ•°ç»Ÿè®¡é€šè¿‡ä»¥ä¸‹æ–¹å¼å®žçŽ°ï¼š

1. **å¹¶è¡Œæ‰«æ**ï¼šå¤šä¸ªå·¥ä½œè¿›ç¨‹å¹¶è¡Œæ‰«ææ•°æ®
2. **å¹¶è¡Œç§©è®¡ç®—**ï¼šæ¯ä¸ªå·¥ä½œè¿›ç¨‹ç‹¬ç«‹è®¡ç®—éƒ¨åˆ†ç§©
3. **å¹¶è¡Œç»Ÿè®¡é‡è®¡ç®—**ï¼šå¹¶è¡Œæ‰§è¡Œæ£€éªŒç»Ÿè®¡é‡è®¡ç®—
4. **ç»“æžœåˆå¹¶**ï¼šä¸»è¿›ç¨‹åˆå¹¶æ‰€æœ‰å·¥ä½œè¿›ç¨‹çš„æ£€éªŒç»“æžœ

### 2.2 å¹¶è¡ŒWilcoxonç¬¦å·ç§©æ£€éªŒ

```sql
-- PostgreSQL 18 å¹¶è¡ŒWilcoxonç¬¦å·ç§©æ£€éªŒï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'nonparametric_data') THEN
            RAISE WARNING 'è¡¨ nonparametric_data ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡Œå¹¶è¡ŒWilcoxonç¬¦å·ç§©æ£€éªŒ';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡ŒPostgreSQL 18å¹¶è¡ŒWilcoxonç¬¦å·ç§©æ£€éªŒ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¹¶è¡ŒWilcoxonç¬¦å·ç§©æ£€éªŒå‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

SET max_parallel_workers_per_gather = 4;
SET parallel_setup_cost = 0;

-- å¹¶è¡ŒWilcoxonç¬¦å·ç§©æ£€éªŒ
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
WITH differences AS (
    SELECT
        id,
        after_value - before_value AS difference,
        ABS(after_value - before_value) AS abs_difference
    FROM nonparametric_data
),
ranked_differences AS (
    SELECT
        id,
        difference,
        ROW_NUMBER() OVER (ORDER BY abs_difference) AS rank
    FROM differences
    WHERE difference != 0
),
signed_ranks AS (
    SELECT
        SUM(CASE WHEN difference > 0 THEN rank ELSE 0 END) AS positive_rank_sum,
        SUM(CASE WHEN difference < 0 THEN rank ELSE 0 END) AS negative_rank_sum,
        COUNT(*) AS n
    FROM ranked_differences
)
SELECT
    LEAST(positive_rank_sum, negative_rank_sum) AS w_statistic,
    n,
    CASE
        WHEN LEAST(positive_rank_sum, negative_rank_sum) <= 2 THEN 'Reject H0 (p < 0.05, n=5)'
        ELSE 'Fail to reject H0'
    END AS conclusion
FROM signed_ranks;
```

### 2.3 å¹¶è¡ŒMann-Whitney Uæ£€éªŒ

```sql
-- PostgreSQL 18 å¹¶è¡ŒMann-Whitney Uæ£€éªŒï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'two_group_data') THEN
            RAISE WARNING 'è¡¨ two_group_data ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡Œå¹¶è¡ŒMann-Whitney Uæ£€éªŒ';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡ŒPostgreSQL 18å¹¶è¡ŒMann-Whitney Uæ£€éªŒ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¹¶è¡ŒMann-Whitney Uæ£€éªŒå‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

SET max_parallel_workers_per_gather = 4;
SET parallel_setup_cost = 0;

-- å¹¶è¡ŒMann-Whitney Uæ£€éªŒï¼šä¸¤ç‹¬ç«‹æ ·æœ¬
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
WITH combined_ranks AS (
    SELECT
        value,
        group_id,
        ROW_NUMBER() OVER (ORDER BY value) AS rank
    FROM two_group_data
),
group_rank_sums AS (
    SELECT
        group_id,
        SUM(rank) AS rank_sum,
        COUNT(*) AS n
    FROM combined_ranks
    GROUP BY group_id
),
u_statistics AS (
    SELECT
        g1.group_id AS group1,
        g2.group_id AS group2,
        g1.n AS n1,
        g2.n AS n2,
        g1.rank_sum AS r1,
        g2.rank_sum AS r2,
        g1.n * g2.n + g1.n * (g1.n + 1) / 2 - g1.rank_sum AS u1,
        g1.n * g2.n + g2.n * (g2.n + 1) / 2 - g2.rank_sum AS u2
    FROM group_rank_sums g1
    CROSS JOIN group_rank_sums g2
    WHERE g1.group_id < g2.group_id
)
SELECT
    group1,
    group2,
    LEAST(u1, u2) AS u_statistic,
    CASE
        WHEN LEAST(u1, u2) <= 2 THEN 'Reject H0 (p < 0.05)'
        ELSE 'Fail to reject H0'
    END AS conclusion
FROM u_statistics;
```

---

## ðŸ“š å‚è€ƒèµ„æº

1. **Hollander, M., et al. (2013)**: "Nonparametric Statistical Methods"

---

**æœ€åŽæ›´æ–°**: 2025å¹´1æœˆ
**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ
