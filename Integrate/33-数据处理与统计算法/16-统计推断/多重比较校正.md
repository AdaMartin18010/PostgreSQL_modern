# PostgreSQL å¤šé‡æ¯”è¾ƒæ ¡æ­£ç®—æ³•å®Œæ•´æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æŠ€æœ¯æ ˆ**: PostgreSQL 17+/18+ | ç»Ÿè®¡æ¨æ–­ | å¤šé‡æ¯”è¾ƒ | é”™è¯¯æ§åˆ¶
> **éš¾åº¦çº§åˆ«**: â­â­â­â­ (é«˜çº§)
> **å‚è€ƒæ ‡å‡†**: Multiple Comparisons, Family-Wise Error Rate, Statistical Inference

---

## ğŸ“‹ ç›®å½•

- [PostgreSQL å¤šé‡æ¯”è¾ƒæ ¡æ­£ç®—æ³•å®Œæ•´æŒ‡å—](#postgresql-å¤šé‡æ¯”è¾ƒæ ¡æ­£ç®—æ³•å®Œæ•´æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [å¤šé‡æ¯”è¾ƒæ¦‚è¿°](#å¤šé‡æ¯”è¾ƒæ¦‚è¿°)
  - [1. Bonferroniæ ¡æ­£](#1-bonferroniæ ¡æ­£)
  - [2. FDRæ§åˆ¶](#2-fdræ§åˆ¶)
  - [3. Holmæ–¹æ³•](#3-holmæ–¹æ³•)

---

## å¤šé‡æ¯”è¾ƒæ¦‚è¿°

**å¤šé‡æ¯”è¾ƒé—®é¢˜**ï¼šè¿›è¡Œå¤šä¸ªå‡è®¾æ£€éªŒæ—¶ï¼Œç¬¬ä¸€ç±»é”™è¯¯ç‡ä¼šç´¯ç§¯å¢åŠ ã€‚

---

## 1. Bonferroniæ ¡æ­£

**Bonferroniæ ¡æ­£**ï¼šå°†æ˜¾è‘—æ€§æ°´å¹³é™¤ä»¥æ£€éªŒæ¬¡æ•°ã€‚

$$\alpha_{adjusted} = \frac{\alpha}{m}$$

å…¶ä¸­ $m$ æ˜¯æ£€éªŒæ¬¡æ•°ã€‚

```sql
-- Bonferroniæ ¡æ­£å®ç°ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'multiple_tests') THEN
            RAISE WARNING 'è¡¨ multiple_tests å·²å­˜åœ¨ï¼Œå…ˆåˆ é™¤';
            DROP TABLE multiple_tests CASCADE;
        END IF;

        CREATE TABLE multiple_tests (
            test_id SERIAL PRIMARY KEY,
            p_value NUMERIC NOT NULL,
            test_name VARCHAR(100) NOT NULL
        );

        INSERT INTO multiple_tests (p_value, test_name) VALUES
            (0.01, 'Test1'), (0.02, 'Test2'), (0.03, 'Test3'),
            (0.04, 'Test4'), (0.05, 'Test5');

        RAISE NOTICE 'è¡¨ multiple_tests åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE EXCEPTION 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
    END;
END $$;

-- Bonferroniæ ¡æ­£
WITH test_count AS (
    SELECT COUNT(*) AS m FROM multiple_tests
),
bonferroni_correction AS (
    SELECT
        test_id,
        test_name,
        p_value,
        0.05 / (SELECT m FROM test_count) AS adjusted_alpha,
        CASE
            WHEN p_value < (0.05 / (SELECT m FROM test_count)) THEN 'Significant'
            ELSE 'Not significant'
        END AS bonferroni_result
    FROM multiple_tests
    CROSS JOIN test_count
)
SELECT
    test_id,
    test_name,
    ROUND(p_value::numeric, 4) AS p_value,
    ROUND(adjusted_alpha::numeric, 4) AS adjusted_alpha,
    bonferroni_result
FROM bonferroni_correction
ORDER BY p_value;
```

---

## 2. FDRæ§åˆ¶

**FDRï¼ˆFalse Discovery Rateï¼‰æ§åˆ¶**ä½¿ç”¨Benjamini-Hochbergæ–¹æ³•ã€‚

```sql
-- FDRæ§åˆ¶ï¼ˆBenjamini-Hochbergï¼‰
WITH ranked_tests AS (
    SELECT
        test_id,
        test_name,
        p_value,
        ROW_NUMBER() OVER (ORDER BY p_value) AS rank,
        COUNT(*) OVER () AS total_tests
    FROM multiple_tests
),
fdr_thresholds AS (
    SELECT
        test_id,
        test_name,
        p_value,
        rank,
        (rank::NUMERIC / total_tests) * 0.05 AS fdr_threshold
    FROM ranked_tests
)
SELECT
    test_id,
    test_name,
    ROUND(p_value::numeric, 4) AS p_value,
    ROUND(fdr_threshold::numeric, 4) AS fdr_threshold,
    CASE
        WHEN p_value <= fdr_threshold THEN 'Significant'
        ELSE 'Not significant'
    END AS fdr_result
FROM fdr_thresholds
ORDER BY p_value;
```

---

## 3. Holmæ–¹æ³•

**Holmæ–¹æ³•**æ˜¯Bonferroniçš„æ”¹è¿›ï¼Œæ›´powerfulã€‚

```sql
-- Holmæ–¹æ³•
WITH ranked_tests AS (
    SELECT
        test_id,
        p_value,
        ROW_NUMBER() OVER (ORDER BY p_value) AS rank,
        COUNT(*) OVER () AS total_tests
    FROM multiple_tests
),
holm_adjustment AS (
    SELECT
        test_id,
        p_value,
        rank,
        0.05 / (total_tests - rank + 1) AS holm_alpha
    FROM ranked_tests
)
SELECT
    test_id,
    ROUND(p_value::numeric, 4) AS p_value,
    ROUND(holm_alpha::numeric, 4) AS holm_alpha,
    CASE
        WHEN p_value < holm_alpha THEN 'Significant'
        ELSE 'Not significant'
    END AS holm_result
FROM holm_adjustment
ORDER BY p_value;
```

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ
