# PostgreSQL ç»Ÿè®¡å›¾è¡¨æ•°æ®ç”Ÿæˆå®Œæ•´æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æŠ€æœ¯æ ˆ**: PostgreSQL 17+/18+ | æ•°æ®å¯è§†åŒ– | ç»Ÿè®¡å›¾è¡¨ | SQLæ•°æ®å‡†å¤‡
> **éš¾åº¦çº§åˆ«**: â­â­â­ (ä¸­çº§)
> **å‚è€ƒæ ‡å‡†**: Data Visualization, Statistical Graphics, SQL for Analytics

---

## ğŸ“‹ ç›®å½•

- [PostgreSQL ç»Ÿè®¡å›¾è¡¨æ•°æ®ç”Ÿæˆå®Œæ•´æŒ‡å—](#postgresql-ç»Ÿè®¡å›¾è¡¨æ•°æ®ç”Ÿæˆå®Œæ•´æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [æ•°æ®å¯è§†åŒ–æ¦‚è¿°](#æ•°æ®å¯è§†åŒ–æ¦‚è¿°)
  - [ç†è®ºåŸºç¡€](#ç†è®ºåŸºç¡€)
    - [æ•°æ®å¯è§†åŒ–é—®é¢˜å®šä¹‰](#æ•°æ®å¯è§†åŒ–é—®é¢˜å®šä¹‰)
    - [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
    - [ç®—æ³•åˆ†ç±»](#ç®—æ³•åˆ†ç±»)
    - [å›¾è¡¨ç±»å‹å¯¹æ¯”](#å›¾è¡¨ç±»å‹å¯¹æ¯”)
    - [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
    - [æ•°æ®å‡†å¤‡](#æ•°æ®å‡†å¤‡)
  - [1. ç›´æ–¹å›¾æ•°æ®](#1-ç›´æ–¹å›¾æ•°æ®)
    - [1.1 ç­‰å®½ç›´æ–¹å›¾](#11-ç­‰å®½ç›´æ–¹å›¾)
    - [1.2 ç­‰é¢‘ç›´æ–¹å›¾](#12-ç­‰é¢‘ç›´æ–¹å›¾)
  - [2. ç®±çº¿å›¾æ•°æ®](#2-ç®±çº¿å›¾æ•°æ®)
    - [2.1 äº”æ•°æ¦‚æ‹¬](#21-äº”æ•°æ¦‚æ‹¬)
    - [2.2 å¼‚å¸¸å€¼æ£€æµ‹](#22-å¼‚å¸¸å€¼æ£€æµ‹)
  - [3. æ•£ç‚¹å›¾æ•°æ®](#3-æ•£ç‚¹å›¾æ•°æ®)
    - [3.1 åŸºç¡€æ•£ç‚¹å›¾](#31-åŸºç¡€æ•£ç‚¹å›¾)
    - [3.2 åˆ†ç»„æ•£ç‚¹å›¾](#32-åˆ†ç»„æ•£ç‚¹å›¾)
  - [4. çƒ­åŠ›å›¾æ•°æ®](#4-çƒ­åŠ›å›¾æ•°æ®)
    - [4.1 ç›¸å…³çŸ©é˜µçƒ­åŠ›å›¾](#41-ç›¸å…³çŸ©é˜µçƒ­åŠ›å›¾)
    - [4.2 äº¤å‰è¡¨çƒ­åŠ›å›¾](#42-äº¤å‰è¡¨çƒ­åŠ›å›¾)
  - [5. æ—¶é—´åºåˆ—å›¾è¡¨](#5-æ—¶é—´åºåˆ—å›¾è¡¨)
    - [5.1 æŠ˜çº¿å›¾æ•°æ®](#51-æŠ˜çº¿å›¾æ•°æ®)
    - [5.2 é¢ç§¯å›¾æ•°æ®](#52-é¢ç§¯å›¾æ•°æ®)
  - [6. å¤æ‚åº¦åˆ†æ](#6-å¤æ‚åº¦åˆ†æ)
  - [7. å®é™…åº”ç”¨æ¡ˆä¾‹](#7-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [7.1 æ•°æ®æ¢ç´¢](#71-æ•°æ®æ¢ç´¢)
    - [7.2 æŠ¥è¡¨ç”Ÿæˆ](#72-æŠ¥è¡¨ç”Ÿæˆ)
  - [8. å®é™…åº”ç”¨æ¡ˆä¾‹æ‰©å±•](#8-å®é™…åº”ç”¨æ¡ˆä¾‹æ‰©å±•)
    - [8.1 æ•°æ®è´¨é‡åˆ†æå¯è§†åŒ–](#81-æ•°æ®è´¨é‡åˆ†æå¯è§†åŒ–)
    - [8.2 å¤šç»´åº¦å¯¹æ¯”åˆ†æ](#82-å¤šç»´åº¦å¯¹æ¯”åˆ†æ)
  - [9. PostgreSQL 18 å¹¶è¡Œç»Ÿè®¡å›¾è¡¨æ•°æ®ç”Ÿæˆå¢å¼º](#9-postgresql-18-å¹¶è¡Œç»Ÿè®¡å›¾è¡¨æ•°æ®ç”Ÿæˆå¢å¼º)
    - [9.1 å¹¶è¡Œç»Ÿè®¡å›¾è¡¨æ•°æ®ç”ŸæˆåŸç†](#91-å¹¶è¡Œç»Ÿè®¡å›¾è¡¨æ•°æ®ç”ŸæˆåŸç†)
    - [9.2 å¹¶è¡Œç›´æ–¹å›¾æ•°æ®ç”Ÿæˆ](#92-å¹¶è¡Œç›´æ–¹å›¾æ•°æ®ç”Ÿæˆ)
    - [9.3 å¹¶è¡Œç®±çº¿å›¾æ•°æ®ç”Ÿæˆ](#93-å¹¶è¡Œç®±çº¿å›¾æ•°æ®ç”Ÿæˆ)
  - [ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®](#-æ€§èƒ½ä¼˜åŒ–å»ºè®®)
    - [ç´¢å¼•ä¼˜åŒ–](#ç´¢å¼•ä¼˜åŒ–)
    - [ç‰©åŒ–è§†å›¾](#ç‰©åŒ–è§†å›¾)
    - [é‡‡æ ·ç­–ç•¥](#é‡‡æ ·ç­–ç•¥)
  - [ğŸ¯ æœ€ä½³å®è·µ](#-æœ€ä½³å®è·µ)
    - [æ•°æ®è´¨é‡](#æ•°æ®è´¨é‡)
    - [å›¾è¡¨é€‰æ‹©](#å›¾è¡¨é€‰æ‹©)
    - [äº¤äº’æ€§](#äº¤äº’æ€§)
    - [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
    - [SQLå®ç°æ³¨æ„äº‹é¡¹](#sqlå®ç°æ³¨æ„äº‹é¡¹)
  - [ğŸ“ˆ å›¾è¡¨ç”Ÿæˆæ–¹æ³•å¯¹æ¯”](#-å›¾è¡¨ç”Ÿæˆæ–¹æ³•å¯¹æ¯”)
  - [ğŸ” å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
    - [é—®é¢˜1ï¼šç›´æ–¹å›¾åŒºé—´é€‰æ‹©ä¸å½“](#é—®é¢˜1ç›´æ–¹å›¾åŒºé—´é€‰æ‹©ä¸å½“)
    - [é—®é¢˜2ï¼šç®±çº¿å›¾å¼‚å¸¸å€¼è¿‡å¤š](#é—®é¢˜2ç®±çº¿å›¾å¼‚å¸¸å€¼è¿‡å¤š)
    - [é—®é¢˜3ï¼šæ•£ç‚¹å›¾æ•°æ®ç‚¹é‡å ](#é—®é¢˜3æ•£ç‚¹å›¾æ•°æ®ç‚¹é‡å )
  - [ğŸ“š å‚è€ƒèµ„æº](#-å‚è€ƒèµ„æº)
    - [PostgreSQL 18 æ–°ç‰¹æ€§åº”ç”¨ï¼ˆå¢å¼ºï¼‰](#postgresql-18-æ–°ç‰¹æ€§åº”ç”¨å¢å¼º)
    - [é«˜çº§ä¼˜åŒ–æŠ€å·§ï¼ˆå¢å¼ºï¼‰](#é«˜çº§ä¼˜åŒ–æŠ€å·§å¢å¼º)

---

## æ•°æ®å¯è§†åŒ–æ¦‚è¿°

**æ•°æ®å¯è§†åŒ–**é€šè¿‡å›¾è¡¨å’Œå›¾å½¢å±•ç¤ºæ•°æ®ï¼Œå¸®åŠ©ç†è§£æ•°æ®æ¨¡å¼å’Œè¶‹åŠ¿ã€‚

## ç†è®ºåŸºç¡€

### æ•°æ®å¯è§†åŒ–é—®é¢˜å®šä¹‰

æ•°æ®å¯è§†åŒ–æ˜¯å°†æ•°æ®è½¬æ¢ä¸ºè§†è§‰è¡¨ç¤ºçš„è¿‡ç¨‹ï¼Œé€šè¿‡å›¾è¡¨ã€å›¾å½¢å’Œäº¤äº’å¼ç•Œé¢å¸®åŠ©ç”¨æˆ·ç†è§£æ•°æ®æ¨¡å¼ã€è¶‹åŠ¿å’Œå…³ç³»ã€‚

### æ ¸å¿ƒæ¦‚å¿µ

1. **è§†è§‰ç¼–ç **ï¼š
   - ä½ç½®ç¼–ç ï¼šxè½´ã€yè½´ä½ç½®
   - é¢œè‰²ç¼–ç ï¼šé¢œè‰²æ·±æµ…ã€è‰²ç›¸
   - å¤§å°ç¼–ç ï¼šç‚¹çš„å¤§å°ã€çº¿çš„ç²—ç»†
   - å½¢çŠ¶ç¼–ç ï¼šç‚¹çš„å½¢çŠ¶ã€çº¿çš„æ ·å¼

2. **å›¾è¡¨ç±»å‹é€‰æ‹©**ï¼š
   - æ ¹æ®æ•°æ®ç»´åº¦é€‰æ‹©
   - æ ¹æ®åˆ†æç›®æ ‡é€‰æ‹©
   - æ ¹æ®æ•°æ®ç‰¹æ€§é€‰æ‹©

3. **æ•°æ®é¢„å¤„ç†**ï¼š
   - æ•°æ®æ¸…æ´—
   - æ•°æ®èšåˆ
   - æ•°æ®å½’ä¸€åŒ–

### ç®—æ³•åˆ†ç±»

1. **æŒ‰æ•°æ®ç»´åº¦åˆ†ç±»**ï¼š
   - ä¸€ç»´å¯è§†åŒ–ï¼šç›´æ–¹å›¾ã€ç®±çº¿å›¾
   - äºŒç»´å¯è§†åŒ–ï¼šæ•£ç‚¹å›¾ã€çƒ­åŠ›å›¾
   - å¤šç»´å¯è§†åŒ–ï¼šå¹³è¡Œåæ ‡ã€é›·è¾¾å›¾

2. **æŒ‰å›¾è¡¨ç±»å‹åˆ†ç±»**ï¼š
   - ç»Ÿè®¡å›¾è¡¨ï¼šç›´æ–¹å›¾ã€ç®±çº¿å›¾ã€æ•£ç‚¹å›¾
   - æ—¶é—´åºåˆ—å›¾è¡¨ï¼šæŠ˜çº¿å›¾ã€é¢ç§¯å›¾
   - å…³ç³»å›¾è¡¨ï¼šçƒ­åŠ›å›¾ã€ç½‘ç»œå›¾

### å›¾è¡¨ç±»å‹å¯¹æ¯”

| å›¾è¡¨ç±»å‹ | é€‚ç”¨åœºæ™¯ | æ•°æ®ç»´åº¦ | ä¼˜åŠ¿ | å±€é™æ€§ |
|---------|---------|---------|------|--------|
| **ç›´æ–¹å›¾** | åˆ†å¸ƒå±•ç¤º | 1ç»´è¿ç»­ | ç›´è§‚ã€æ˜“äºç†è§£ | åŒºé—´é€‰æ‹©å½±å“ç»“æœ |
| **ç®±çº¿å›¾** | åˆ†å¸ƒæ¯”è¾ƒ | 1ç»´è¿ç»­ | å±•ç¤ºäº”æ•°æ¦‚æ‹¬ã€å¼‚å¸¸å€¼ | å¯èƒ½ä¸¢å¤±ç»†èŠ‚ |
| **æ•£ç‚¹å›¾** | å…³ç³»åˆ†æ | 2ç»´è¿ç»­ | å±•ç¤ºç›¸å…³æ€§ã€æ¨¡å¼ | æ•°æ®ç‚¹è¿‡å¤šæ—¶éš¾ä»¥é˜…è¯» |
| **çƒ­åŠ›å›¾** | çŸ©é˜µæ•°æ® | 2ç»´åˆ†ç±»/è¿ç»­ | å±•ç¤ºæ¨¡å¼ã€ç›¸å…³æ€§ | éœ€è¦è¶³å¤Ÿæ•°æ® |
| **æŠ˜çº¿å›¾** | è¶‹åŠ¿åˆ†æ | æ—¶é—´åºåˆ— | å±•ç¤ºè¶‹åŠ¿ã€å˜åŒ– | æ•°æ®ç‚¹è¿‡å¤šæ—¶éš¾ä»¥é˜…è¯» |

### æŠ€æœ¯æ ˆ

- **èšåˆå‡½æ•°**ï¼šCOUNTã€SUMã€AVGã€MINã€MAXã€PERCENTILE_CONT
- **çª—å£å‡½æ•°**ï¼šROW_NUMBERã€LAGã€LEADã€AVGã€SUM
- **åˆ†ç»„å‡½æ•°**ï¼šGROUP BYã€PARTITION BY
- **æ•°å­¦å‡½æ•°**ï¼šWIDTH_BUCKETã€CORRã€SQRTã€POWER

### æ•°æ®å‡†å¤‡

SQLå¯ä»¥ç”Ÿæˆå„ç§å›¾è¡¨æ‰€éœ€çš„æ•°æ®æ ¼å¼ï¼Œä¾›å‰ç«¯å¯è§†åŒ–å·¥å…·ä½¿ç”¨ã€‚

---

## 1. ç›´æ–¹å›¾æ•°æ®

### 1.1 ç­‰å®½ç›´æ–¹å›¾

**ç­‰å®½ç›´æ–¹å›¾**å°†æ•°æ®èŒƒå›´ç­‰åˆ†ä¸ºå›ºå®šå®½åº¦çš„åŒºé—´ã€‚

```sql
-- ç›´æ–¹å›¾æ•°æ®ç”Ÿæˆï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'histogram_data') THEN
            RAISE WARNING 'è¡¨ histogram_data å·²å­˜åœ¨ï¼Œå…ˆåˆ é™¤';
            DROP TABLE histogram_data CASCADE;
        END IF;

        CREATE TABLE histogram_data (
            id SERIAL PRIMARY KEY,
            value NUMERIC NOT NULL
        );

        -- æ’å…¥ç¤ºä¾‹æ•°æ®
        INSERT INTO histogram_data (value) VALUES
            (1.2), (1.5), (1.8), (2.1), (2.3),
            (2.5), (2.7), (3.0), (3.2), (3.5),
            (3.8), (4.0), (4.2), (4.5), (4.8);

        RAISE NOTICE 'è¡¨ histogram_data åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ histogram_data å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE EXCEPTION 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
    END;
END $$;

-- ç­‰å®½ç›´æ–¹å›¾æ•°æ®ç”Ÿæˆ
WITH data_stats AS (
    SELECT
        MIN(value) AS min_val,
        MAX(value) AS max_val,
        COUNT(*) AS total_count
    FROM histogram_data
),
bins AS (
    SELECT
        generate_series(0, 4) AS bin_id,
        1.0 AS bin_width,
        1.0 + generate_series(0, 4)::NUMERIC AS bin_start,
        2.0 + generate_series(0, 4)::NUMERIC AS bin_end
),
histogram_counts AS (
    SELECT
        b.bin_id,
        b.bin_start,
        b.bin_end,
        COUNT(hd.value) AS frequency,
        COUNT(hd.value)::NUMERIC / (SELECT total_count FROM data_stats) AS relative_frequency
    FROM bins b
    LEFT JOIN histogram_data hd ON hd.value >= b.bin_start AND hd.value < b.bin_end
    GROUP BY b.bin_id, b.bin_start, b.bin_end
)
SELECT
    bin_id,
    ROUND(bin_start::numeric, 2) AS bin_start,
    ROUND(bin_end::numeric, 2) AS bin_end,
    frequency,
    ROUND((relative_frequency * 100)::numeric, 2) AS percentage
FROM histogram_counts
ORDER BY bin_id;

-- æ€§èƒ½æµ‹è¯•
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT
    WIDTH_BUCKET(value, 1.0, 5.0, 5) AS bin_id,
    COUNT(*) AS frequency
FROM histogram_data
GROUP BY bin_id
ORDER BY bin_id;
```

### 1.2 ç­‰é¢‘ç›´æ–¹å›¾

**ç­‰é¢‘ç›´æ–¹å›¾**æ¯ä¸ªåŒºé—´åŒ…å«ç›¸åŒæ•°é‡çš„æ•°æ®ç‚¹ã€‚

```sql
-- ç­‰é¢‘ç›´æ–¹å›¾æ•°æ®ç”Ÿæˆ
WITH ranked_data AS (
    SELECT
        value,
        ROW_NUMBER() OVER (ORDER BY value) AS rank,
        COUNT(*) OVER () AS total_count
    FROM histogram_data
),
percentiles AS (
    SELECT
        PERCENTILE_CONT(0.0) WITHIN GROUP (ORDER BY value) AS p0,
        PERCENTILE_CONT(0.2) WITHIN GROUP (ORDER BY value) AS p20,
        PERCENTILE_CONT(0.4) WITHIN GROUP (ORDER BY value) AS p40,
        PERCENTILE_CONT(0.6) WITHIN GROUP (ORDER BY value) AS p60,
        PERCENTILE_CONT(0.8) WITHIN GROUP (ORDER BY value) AS p80,
        PERCENTILE_CONT(1.0) WITHIN GROUP (ORDER BY value) AS p100
    FROM histogram_data
),
equal_frequency_bins AS (
    SELECT
        1 AS bin_id, p0 AS bin_start, p20 AS bin_end FROM percentiles
    UNION ALL SELECT 2, p20, p40 FROM percentiles
    UNION ALL SELECT 3, p40, p60 FROM percentiles
    UNION ALL SELECT 4, p60, p80 FROM percentiles
    UNION ALL SELECT 5, p80, p100 FROM percentiles
)
SELECT
    bin_id,
    ROUND(bin_start::numeric, 2) AS bin_start,
    ROUND(bin_end::numeric, 2) AS bin_end,
    COUNT(*) AS frequency
FROM equal_frequency_bins efb
JOIN histogram_data hd ON hd.value >= efb.bin_start AND hd.value < efb.bin_end
GROUP BY bin_id, bin_start, bin_end
ORDER BY bin_id;
```

---

## 2. ç®±çº¿å›¾æ•°æ®

### 2.1 äº”æ•°æ¦‚æ‹¬

**äº”æ•°æ¦‚æ‹¬**åŒ…æ‹¬æœ€å°å€¼ã€ç¬¬ä¸€å››åˆ†ä½æ•°ã€ä¸­ä½æ•°ã€ç¬¬ä¸‰å››åˆ†ä½æ•°ã€æœ€å¤§å€¼ã€‚

```sql
-- ç®±çº¿å›¾æ•°æ®ç”Ÿæˆï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'boxplot_data') THEN
            RAISE WARNING 'è¡¨ boxplot_data ä¸å­˜åœ¨ï¼Œåˆ›å»ºç¤ºä¾‹è¡¨';

            CREATE TABLE boxplot_data (
                id SERIAL PRIMARY KEY,
                category VARCHAR(20) NOT NULL,
                value NUMERIC NOT NULL
            );

            INSERT INTO boxplot_data (category, value) VALUES
                ('A', 10), ('A', 12), ('A', 15), ('A', 18), ('A', 20),
                ('B', 5), ('B', 8), ('B', 10), ('B', 12), ('B', 15);

            RAISE NOTICE 'è¡¨ boxplot_data åˆ›å»ºæˆåŠŸ';
        END IF;
        RAISE NOTICE 'å¼€å§‹ç”Ÿæˆç®±çº¿å›¾æ•°æ®';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'ç®±çº¿å›¾æ•°æ®ç”Ÿæˆå‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- äº”æ•°æ¦‚æ‹¬è®¡ç®—
WITH boxplot_stats AS (
    SELECT
        category,
        COUNT(*) AS n,
        MIN(value) AS min_value,
        PERCENTILE_CONT(0.25) WITHIN GROUP (ORDER BY value) AS q1,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY value) AS median,
        PERCENTILE_CONT(0.75) WITHIN GROUP (ORDER BY value) AS q3,
        MAX(value) AS max_value,
        PERCENTILE_CONT(0.75) WITHIN GROUP (ORDER BY value) -
        PERCENTILE_CONT(0.25) WITHIN GROUP (ORDER BY value) AS iqr
    FROM boxplot_data
    GROUP BY category
)
SELECT
    category,
    n,
    ROUND(min_value::numeric, 2) AS min,
    ROUND(q1::numeric, 2) AS q1,
    ROUND(median::numeric, 2) AS median,
    ROUND(q3::numeric, 2) AS q3,
    ROUND(max_value::numeric, 2) AS max,
    ROUND(iqr::numeric, 2) AS iqr,
    ROUND((q1 - 1.5 * iqr)::numeric, 2) AS lower_whisker,
    ROUND((q3 + 1.5 * iqr)::numeric, 2) AS upper_whisker
FROM boxplot_stats
ORDER BY category;

-- æ€§èƒ½æµ‹è¯•
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT
    category,
    PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY value) AS median
FROM boxplot_data
GROUP BY category;
```

### 2.2 å¼‚å¸¸å€¼æ£€æµ‹

**å¼‚å¸¸å€¼**å®šä¹‰ä¸ºè¶…å‡º $Q1 - 1.5 \times IQR$ æˆ– $Q3 + 1.5 \times IQR$ çš„å€¼ã€‚

```sql
-- å¼‚å¸¸å€¼æ£€æµ‹
WITH quartiles AS (
    SELECT
        category,
        PERCENTILE_CONT(0.25) WITHIN GROUP (ORDER BY value) AS q1,
        PERCENTILE_CONT(0.75) WITHIN GROUP (ORDER BY value) AS q3,
        PERCENTILE_CONT(0.75) WITHIN GROUP (ORDER BY value) -
        PERCENTILE_CONT(0.25) WITHIN GROUP (ORDER BY value) AS iqr
    FROM boxplot_data
    GROUP BY category
),
outliers AS (
    SELECT
        bd.id,
        bd.category,
        bd.value,
        q.q1 - 1.5 * q.iqr AS lower_bound,
        q.q3 + 1.5 * q.iqr AS upper_bound
    FROM boxplot_data bd
    JOIN quartiles q ON bd.category = q.category
    WHERE bd.value < q.q1 - 1.5 * q.iqr OR bd.value > q.q3 + 1.5 * q.iqr
)
SELECT
    id,
    category,
    ROUND(value::numeric, 2) AS outlier_value,
    ROUND(lower_bound::numeric, 2) AS lower_bound,
    ROUND(upper_bound::numeric, 2) AS upper_bound
FROM outliers;
```

---

## 3. æ•£ç‚¹å›¾æ•°æ®

### 3.1 åŸºç¡€æ•£ç‚¹å›¾

**æ•£ç‚¹å›¾**å±•ç¤ºä¸¤ä¸ªè¿ç»­å˜é‡ä¹‹é—´çš„å…³ç³»ã€‚

```sql
-- æ•£ç‚¹å›¾æ•°æ®ç”Ÿæˆ
WITH scatter_data AS (
    SELECT
        x_value,
        y_value,
        category
    FROM scatter_source_data
)
SELECT
    x_value,
    y_value,
    category,
    -- å¯ä»¥æ·»åŠ å¯†åº¦ä¿¡æ¯
    COUNT(*) OVER (PARTITION BY category) AS category_count
FROM scatter_data
ORDER BY x_value, y_value;
```

### 3.2 åˆ†ç»„æ•£ç‚¹å›¾

**åˆ†ç»„æ•£ç‚¹å›¾**æŒ‰ç±»åˆ«å±•ç¤ºå¤šä¸ªæ•£ç‚¹å›¾ã€‚

```sql
-- åˆ†ç»„æ•£ç‚¹å›¾æ•°æ®
SELECT
    category,
    x_value,
    y_value,
    -- è®¡ç®—æ¯ä¸ªç±»åˆ«çš„ç»Ÿè®¡ä¿¡æ¯
    AVG(y_value) OVER (PARTITION BY category) AS category_mean_y,
    AVG(x_value) OVER (PARTITION BY category) AS category_mean_x
FROM scatter_source_data
ORDER BY category, x_value;
```

---

## 4. çƒ­åŠ›å›¾æ•°æ®

### 4.1 ç›¸å…³çŸ©é˜µçƒ­åŠ›å›¾

**ç›¸å…³çŸ©é˜µçƒ­åŠ›å›¾**å±•ç¤ºå˜é‡é—´çš„ç›¸å…³æ€§ã€‚

```sql
-- ç›¸å…³çŸ©é˜µçƒ­åŠ›å›¾æ•°æ®ç”Ÿæˆ
WITH correlation_matrix AS (
    SELECT
        var1,
        var2,
        CORR(value1, value2) AS correlation
    FROM correlation_data
    GROUP BY var1, var2
)
SELECT
    var1 AS row_variable,
    var2 AS column_variable,
    ROUND(correlation::numeric, 4) AS correlation_coefficient,
    CASE
        WHEN ABS(correlation) > 0.7 THEN 'Strong'
        WHEN ABS(correlation) > 0.4 THEN 'Moderate'
        ELSE 'Weak'
    END AS correlation_strength
FROM correlation_matrix
ORDER BY var1, var2;
```

### 4.2 äº¤å‰è¡¨çƒ­åŠ›å›¾

**äº¤å‰è¡¨çƒ­åŠ›å›¾**å±•ç¤ºåˆ†ç±»å˜é‡é—´çš„é¢‘ç‡å…³ç³»ã€‚

```sql
-- äº¤å‰è¡¨çƒ­åŠ›å›¾æ•°æ®
WITH crosstab_data AS (
    SELECT
        category1,
        category2,
        COUNT(*) AS frequency,
        COUNT(*)::NUMERIC / SUM(COUNT(*)) OVER () AS relative_frequency
    FROM categorical_data
    GROUP BY category1, category2
)
SELECT
    category1,
    category2,
    frequency,
    ROUND((relative_frequency * 100)::numeric, 2) AS percentage
FROM crosstab_data
ORDER BY category1, category2;
```

---

## 5. æ—¶é—´åºåˆ—å›¾è¡¨

### 5.1 æŠ˜çº¿å›¾æ•°æ®

**æŠ˜çº¿å›¾**å±•ç¤ºæ—¶é—´åºåˆ—æ•°æ®çš„è¶‹åŠ¿ã€‚

```sql
-- æŠ˜çº¿å›¾æ•°æ®ç”Ÿæˆ
WITH time_series_data AS (
    SELECT
        date,
        value,
        category
    FROM time_series_source
)
SELECT
    date,
    value,
    category,
    -- è®¡ç®—ç§»åŠ¨å¹³å‡
    AVG(value) OVER (
        PARTITION BY category
        ORDER BY date
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) AS moving_average_7
FROM time_series_data
ORDER BY category, date;
```

### 5.2 é¢ç§¯å›¾æ•°æ®

**é¢ç§¯å›¾**æ˜¯å¡«å……çš„æŠ˜çº¿å›¾ï¼Œå±•ç¤ºç´¯ç§¯æ•ˆæœã€‚

```sql
-- é¢ç§¯å›¾æ•°æ®ç”Ÿæˆ
WITH cumulative_data AS (
    SELECT
        date,
        category,
        value,
        SUM(value) OVER (
            PARTITION BY category
            ORDER BY date
        ) AS cumulative_value
    FROM time_series_source
)
SELECT
    date,
    category,
    value,
    cumulative_value
FROM cumulative_data
ORDER BY category, date;
```

---

## 6. å¤æ‚åº¦åˆ†æ

| æ“ä½œ | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ |
|------|-----------|-----------|
| **ç›´æ–¹å›¾** | $O(n)$ | $O(b)$ |
| **ç®±çº¿å›¾** | $O(n \log n)$ | $O(1)$ |
| **æ•£ç‚¹å›¾** | $O(n)$ | $O(n)$ |
| **çƒ­åŠ›å›¾** | $O(n^2)$ | $O(n^2)$ |

å…¶ä¸­ $n$ æ˜¯æ•°æ®ç‚¹æ•°ï¼Œ$b$ æ˜¯åŒºé—´æ•°ã€‚

---

## 7. å®é™…åº”ç”¨æ¡ˆä¾‹

### 7.1 æ•°æ®æ¢ç´¢

```sql
-- ç»¼åˆæ•°æ®æ¢ç´¢å¯è§†åŒ–æ•°æ®ç”Ÿæˆ
WITH exploration_data AS (
    SELECT
        -- ç›´æ–¹å›¾æ•°æ®
        WIDTH_BUCKET(value, min_val, max_val, 20) AS histogram_bin,
        -- ç®±çº¿å›¾ç»Ÿè®¡
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY value) AS median,
        -- æ•£ç‚¹å›¾æ•°æ®
        x_value,
        y_value
    FROM source_data
)
SELECT * FROM exploration_data;
```

### 7.2 æŠ¥è¡¨ç”Ÿæˆ

```sql
-- æŠ¥è¡¨æ•°æ®ç”Ÿæˆï¼ˆå¤šå›¾è¡¨ï¼‰
WITH report_data AS (
    SELECT
        'histogram' AS chart_type,
        bin_id AS x_axis,
        frequency AS y_axis
    FROM histogram_data
    UNION ALL
    SELECT
        'boxplot' AS chart_type,
        category AS x_axis,
        median AS y_axis
    FROM boxplot_stats
)
SELECT
    chart_type,
    x_axis,
    y_axis
FROM report_data
ORDER BY chart_type, x_axis;
```

---

## 8. å®é™…åº”ç”¨æ¡ˆä¾‹æ‰©å±•

### 8.1 æ•°æ®è´¨é‡åˆ†æå¯è§†åŒ–

```sql
-- æ•°æ®è´¨é‡åˆ†æå¯è§†åŒ–ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        -- åˆ›å»ºæ•°æ®è´¨é‡åˆ†æè¡¨
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'data_quality_metrics') THEN
            DROP TABLE data_quality_metrics CASCADE;
        END IF;

        CREATE TABLE data_quality_metrics (
            metric_date DATE NOT NULL,
            metric_name VARCHAR(50) NOT NULL,
            metric_value NUMERIC NOT NULL,
            threshold_value NUMERIC,
            PRIMARY KEY (metric_date, metric_name)
        );

        -- æ’å…¥ç¤ºä¾‹æ•°æ®è´¨é‡æŒ‡æ ‡
        INSERT INTO data_quality_metrics (metric_date, metric_name, metric_value, threshold_value) VALUES
            ('2024-01-01', 'Completeness', 95.5, 90.0),
            ('2024-01-01', 'Accuracy', 98.2, 95.0),
            ('2024-01-01', 'Consistency', 97.8, 95.0),
            ('2024-01-02', 'Completeness', 96.1, 90.0),
            ('2024-01-02', 'Accuracy', 98.5, 95.0),
            ('2024-01-02', 'Consistency', 98.0, 95.0);

        RAISE NOTICE 'æ•°æ®è´¨é‡æŒ‡æ ‡è¡¨åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'æ•°æ®è´¨é‡åˆ†æå¯è§†åŒ–å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- æ•°æ®è´¨é‡ä»ªè¡¨æ¿æ•°æ®
WITH quality_dashboard AS (
    SELECT
        metric_date,
        metric_name,
        metric_value,
        threshold_value,
        CASE
            WHEN metric_value >= threshold_value THEN 'Pass'
            ELSE 'Fail'
        END AS status,
        metric_value - threshold_value AS margin
    FROM data_quality_metrics
)
SELECT
    metric_date,
    metric_name,
    ROUND(metric_value::numeric, 2) AS metric_value,
    ROUND(threshold_value::numeric, 2) AS threshold_value,
    status,
    ROUND(margin::numeric, 2) AS margin
FROM quality_dashboard
ORDER BY metric_date, metric_name;
```

### 8.2 å¤šç»´åº¦å¯¹æ¯”åˆ†æ

```sql
-- å¤šç»´åº¦å¯¹æ¯”åˆ†æå¯è§†åŒ–ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'boxplot_data') THEN
            RAISE WARNING 'è¡¨ boxplot_data ä¸å­˜åœ¨ï¼Œæ— æ³•è¿›è¡Œå¤šç»´åº¦å¯¹æ¯”åˆ†æ';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹è¿›è¡Œå¤šç»´åº¦å¯¹æ¯”åˆ†æ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¤šç»´åº¦å¯¹æ¯”åˆ†æå‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- å¤šç»´åº¦å¯¹æ¯”ï¼šç®±çº¿å›¾ + æ•£ç‚¹å›¾ç»„åˆ
WITH comparison_stats AS (
    SELECT
        category,
        COUNT(*) AS n,
        MIN(value) AS min_value,
        PERCENTILE_CONT(0.25) WITHIN GROUP (ORDER BY value) AS q1,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY value) AS median,
        PERCENTILE_CONT(0.75) WITHIN GROUP (ORDER BY value) AS q3,
        MAX(value) AS max_value,
        AVG(value) AS mean_value,
        STDDEV(value) AS stddev_value
    FROM boxplot_data
    GROUP BY category
)
SELECT
    category,
    n,
    ROUND(min_value::numeric, 2) AS min,
    ROUND(q1::numeric, 2) AS q1,
    ROUND(median::numeric, 2) AS median,
    ROUND(q3::numeric, 2) AS q3,
    ROUND(max_value::numeric, 2) AS max,
    ROUND(mean_value::numeric, 2) AS mean,
    ROUND(stddev_value::numeric, 2) AS stddev,
    ROUND((q3 - q1)::numeric, 2) AS iqr
FROM comparison_stats
ORDER BY category;
```

---

## 9. PostgreSQL 18 å¹¶è¡Œç»Ÿè®¡å›¾è¡¨æ•°æ®ç”Ÿæˆå¢å¼º

**PostgreSQL 18** æ˜¾è‘—å¢å¼ºäº†å¹¶è¡Œç»Ÿè®¡å›¾è¡¨æ•°æ®ç”Ÿæˆè®¡ç®—èƒ½åŠ›ï¼Œæ”¯æŒå¹¶è¡Œæ‰§è¡Œç›´æ–¹å›¾ã€ç®±çº¿å›¾ã€æ•£ç‚¹å›¾å’Œçƒ­åŠ›å›¾æ•°æ®ç”Ÿæˆï¼Œå¤§å¹…æå‡å¤§è§„æ¨¡æ•°æ®å¯è§†åŒ–æ•°æ®å‡†å¤‡çš„æ€§èƒ½ã€‚

### 9.1 å¹¶è¡Œç»Ÿè®¡å›¾è¡¨æ•°æ®ç”ŸæˆåŸç†

PostgreSQL 18 çš„å¹¶è¡Œç»Ÿè®¡å›¾è¡¨æ•°æ®ç”Ÿæˆé€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š

1. **å¹¶è¡Œæ‰«æ**ï¼šå¤šä¸ªå·¥ä½œè¿›ç¨‹å¹¶è¡Œæ‰«ææ•°æ®
2. **å¹¶è¡Œç»Ÿè®¡è®¡ç®—**ï¼šæ¯ä¸ªå·¥ä½œè¿›ç¨‹ç‹¬ç«‹è®¡ç®—ç»Ÿè®¡æŒ‡æ ‡
3. **å¹¶è¡Œæ•°æ®è½¬æ¢**ï¼šå¹¶è¡Œæ‰§è¡Œæ•°æ®æ ¼å¼è½¬æ¢
4. **ç»“æœåˆå¹¶**ï¼šä¸»è¿›ç¨‹åˆå¹¶æ‰€æœ‰å·¥ä½œè¿›ç¨‹çš„è®¡ç®—ç»“æœ

### 9.2 å¹¶è¡Œç›´æ–¹å›¾æ•°æ®ç”Ÿæˆ

```sql
-- PostgreSQL 18 å¹¶è¡Œç›´æ–¹å›¾æ•°æ®ç”Ÿæˆï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'histogram_data') THEN
            RAISE WARNING 'è¡¨ histogram_data ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡Œå¹¶è¡Œç›´æ–¹å›¾æ•°æ®ç”Ÿæˆ';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡ŒPostgreSQL 18å¹¶è¡Œç›´æ–¹å›¾æ•°æ®ç”Ÿæˆ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¹¶è¡Œç›´æ–¹å›¾æ•°æ®ç”Ÿæˆå‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

SET max_parallel_workers_per_gather = 4;
SET parallel_setup_cost = 0;

-- å¹¶è¡Œç­‰å®½ç›´æ–¹å›¾
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
WITH value_stats AS (
    SELECT
        MIN(value) AS min_val,
        MAX(value) AS max_val,
        COUNT(*) AS total_count
    FROM histogram_data
),
histogram_bins AS (
    SELECT
        bucket,
        min_val + (max_val - min_val) * bucket / 10.0 AS bin_start,
        min_val + (max_val - min_val) * (bucket + 1) / 10.0 AS bin_end
    FROM value_stats
    CROSS JOIN generate_series(0, 9) AS bucket
)
SELECT
    hb.bucket,
    ROUND(hb.bin_start::numeric, 2) AS bin_start,
    ROUND(hb.bin_end::numeric, 2) AS bin_end,
    COUNT(hd.value) AS frequency
FROM histogram_bins hb
LEFT JOIN histogram_data hd ON hd.value >= hb.bin_start AND hd.value < hb.bin_end
GROUP BY hb.bucket, hb.bin_start, hb.bin_end
ORDER BY hb.bucket;
```

### 9.3 å¹¶è¡Œç®±çº¿å›¾æ•°æ®ç”Ÿæˆ

```sql
-- PostgreSQL 18 å¹¶è¡Œç®±çº¿å›¾æ•°æ®ç”Ÿæˆï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'boxplot_data') THEN
            RAISE WARNING 'è¡¨ boxplot_data ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡Œå¹¶è¡Œç®±çº¿å›¾æ•°æ®ç”Ÿæˆ';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡ŒPostgreSQL 18å¹¶è¡Œç®±çº¿å›¾æ•°æ®ç”Ÿæˆ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¹¶è¡Œç®±çº¿å›¾æ•°æ®ç”Ÿæˆå‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

SET max_parallel_workers_per_gather = 4;
SET parallel_setup_cost = 0;

-- å¹¶è¡Œäº”æ•°æ¦‚æ‹¬
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT
    category,
    MIN(value) AS min_value,
    PERCENTILE_CONT(0.25) WITHIN GROUP (ORDER BY value) AS q1,
    PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY value) AS median,
    PERCENTILE_CONT(0.75) WITHIN GROUP (ORDER BY value) AS q3,
    MAX(value) AS max_value,
    AVG(value) AS mean_value
FROM boxplot_data
GROUP BY category
ORDER BY category;
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### ç´¢å¼•ä¼˜åŒ–

```sql
-- åˆ›å»ºå…³é”®ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_histogram_value ON histogram_data(value);
CREATE INDEX IF NOT EXISTS idx_boxplot_category ON boxplot_data(category);
CREATE INDEX IF NOT EXISTS idx_boxplot_category_value ON boxplot_data(category, value);
```

### ç‰©åŒ–è§†å›¾

```sql
-- åˆ›å»ºå¸¸ç”¨å›¾è¡¨æ•°æ®çš„ç‰©åŒ–è§†å›¾
CREATE MATERIALIZED VIEW IF NOT EXISTS mv_boxplot_stats AS
SELECT
    category,
    COUNT(*) AS n,
    PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY value) AS median,
    PERCENTILE_CONT(0.25) WITHIN GROUP (ORDER BY value) AS q1,
    PERCENTILE_CONT(0.75) WITHIN GROUP (ORDER BY value) AS q3
FROM boxplot_data
GROUP BY category;

CREATE UNIQUE INDEX ON mv_boxplot_stats(category);

-- å®šæœŸåˆ·æ–°ç‰©åŒ–è§†å›¾
REFRESH MATERIALIZED VIEW CONCURRENTLY mv_boxplot_stats;
```

### é‡‡æ ·ç­–ç•¥

```sql
-- å¤§æ•°æ®é›†é‡‡æ ·ï¼šä½¿ç”¨TABLESAMPLE
SELECT
    WIDTH_BUCKET(value, 1.0, 5.0, 20) AS bin_id,
    COUNT(*) AS frequency
FROM histogram_data TABLESAMPLE SYSTEM(10)  -- 10%é‡‡æ ·
GROUP BY bin_id
ORDER BY bin_id;
```

---

## ğŸ¯ æœ€ä½³å®è·µ

### æ•°æ®è´¨é‡

1. **æ•°æ®æ¸…æ´—**ï¼šç¡®ä¿æ•°æ®è´¨é‡ï¼Œå¤„ç†ç¼ºå¤±å€¼
2. **å¼‚å¸¸å€¼å¤„ç†**ï¼šè¯†åˆ«å’Œå¤„ç†å¼‚å¸¸å€¼
3. **æ•°æ®éªŒè¯**ï¼šéªŒè¯æ•°æ®çš„å®Œæ•´æ€§å’Œå‡†ç¡®æ€§

### å›¾è¡¨é€‰æ‹©

1. **æ ¹æ®æ•°æ®ç»´åº¦**ï¼šä¸€ç»´æ•°æ®ç”¨ç›´æ–¹å›¾ï¼ŒäºŒç»´æ•°æ®ç”¨æ•£ç‚¹å›¾
2. **æ ¹æ®åˆ†æç›®æ ‡**ï¼šåˆ†å¸ƒåˆ†æç”¨ç›´æ–¹å›¾ï¼Œå…³ç³»åˆ†æç”¨æ•£ç‚¹å›¾
3. **æ ¹æ®æ•°æ®ç‰¹æ€§**ï¼šè¿ç»­æ•°æ®ç”¨ç›´æ–¹å›¾ï¼Œåˆ†ç±»æ•°æ®ç”¨æŸ±çŠ¶å›¾

### äº¤äº’æ€§

1. **åŠ¨æ€ç­›é€‰**ï¼šæä¾›ç­›é€‰å’Œè¿‡æ»¤åŠŸèƒ½
2. **é’»å–åˆ†æ**ï¼šæ”¯æŒä»æ±‡æ€»åˆ°æ˜ç»†çš„é’»å–
3. **å®æ—¶æ›´æ–°**ï¼šæ”¯æŒæ•°æ®çš„å®æ—¶æ›´æ–°

### æ€§èƒ½ä¼˜åŒ–

1. **ç´¢å¼•ä¼˜åŒ–**ï¼šåœ¨åˆ†ç»„å’Œæ’åºå­—æ®µä¸Šåˆ›å»ºç´¢å¼•
2. **ç‰©åŒ–è§†å›¾**ï¼šå¯¹å¸¸ç”¨å›¾è¡¨æ•°æ®åˆ›å»ºç‰©åŒ–è§†å›¾
3. **é‡‡æ ·**ï¼šå¤§æ•°æ®é›†æ—¶ä½¿ç”¨é‡‡æ ·
4. **æŸ¥è¯¢ä¼˜åŒ–**ï¼šä½¿ç”¨EXPLAIN (ANALYZE, BUFFERS, TIMING)åˆ†ææŸ¥è¯¢æ€§èƒ½

### SQLå®ç°æ³¨æ„äº‹é¡¹

1. **é”™è¯¯å¤„ç†**ï¼šä½¿ç”¨DOå—è¿›è¡Œé”™è¯¯å¤„ç†
2. **NULLå€¼å¤„ç†**ï¼šä½¿ç”¨COALESCEå’ŒNULLIFå¤„ç†NULLå€¼
3. **æ•°æ®ç±»å‹è½¬æ¢**ï¼šæ³¨æ„æ•°æ®ç±»å‹è½¬æ¢å’Œç²¾åº¦
4. **æ€§èƒ½æµ‹è¯•**ï¼šä½¿ç”¨EXPLAIN (ANALYZE, BUFFERS, TIMING)æµ‹è¯•æ€§èƒ½

---

## ğŸ“ˆ å›¾è¡¨ç”Ÿæˆæ–¹æ³•å¯¹æ¯”

| æ–¹æ³• | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ | ä¼˜åŠ¿ | å±€é™æ€§ |
|------|-----------|-----------|---------|------|--------|
| ç›´æ–¹å›¾ | $O(n)$ | $O(b)$ | åˆ†å¸ƒå±•ç¤º | ç®€å•ã€å¿«é€Ÿ | åŒºé—´é€‰æ‹©å½±å“ç»“æœ |
| ç®±çº¿å›¾ | $O(n \log n)$ | $O(1)$ | åˆ†å¸ƒæ¯”è¾ƒ | å±•ç¤ºäº”æ•°æ¦‚æ‹¬ | å¯èƒ½ä¸¢å¤±ç»†èŠ‚ |
| æ•£ç‚¹å›¾ | $O(n)$ | $O(n)$ | å…³ç³»åˆ†æ | å±•ç¤ºç›¸å…³æ€§ | æ•°æ®ç‚¹è¿‡å¤šæ—¶éš¾ä»¥é˜…è¯» |
| çƒ­åŠ›å›¾ | $O(n^2)$ | $O(n^2)$ | çŸ©é˜µæ•°æ® | å±•ç¤ºæ¨¡å¼ | éœ€è¦è¶³å¤Ÿæ•°æ® |

---

## ğŸ” å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### é—®é¢˜1ï¼šç›´æ–¹å›¾åŒºé—´é€‰æ‹©ä¸å½“

**åŸå› **ï¼š

- åŒºé—´æ•°é‡é€‰æ‹©ä¸å½“
- åŒºé—´å®½åº¦é€‰æ‹©ä¸å½“

**è§£å†³æ–¹æ¡ˆ**ï¼š

- ä½¿ç”¨Sturgesè§„åˆ™ï¼š$k = \lceil \log_2(n) + 1 \rceil$
- ä½¿ç”¨Freedman-Diaconisè§„åˆ™
- æ ¹æ®æ•°æ®ç‰¹æ€§è°ƒæ•´

### é—®é¢˜2ï¼šç®±çº¿å›¾å¼‚å¸¸å€¼è¿‡å¤š

**åŸå› **ï¼š

- æ•°æ®åˆ†å¸ƒå¼‚å¸¸
- IQRé˜ˆå€¼é€‰æ‹©ä¸å½“

**è§£å†³æ–¹æ¡ˆ**ï¼š

- è°ƒæ•´IQRå€æ•°ï¼ˆ1.5å€æˆ–3å€ï¼‰
- ä½¿ç”¨å…¶ä»–å¼‚å¸¸å€¼æ£€æµ‹æ–¹æ³•
- åˆ†æå¼‚å¸¸å€¼åŸå› 

### é—®é¢˜3ï¼šæ•£ç‚¹å›¾æ•°æ®ç‚¹é‡å 

**åŸå› **ï¼š

- æ•°æ®ç‚¹è¿‡å¤š
- æ•°æ®å€¼é‡å¤

**è§£å†³æ–¹æ¡ˆ**ï¼š

- ä½¿ç”¨é‡‡æ ·å‡å°‘æ•°æ®ç‚¹
- ä½¿ç”¨é€æ˜åº¦æ˜¾ç¤ºå¯†åº¦
- ä½¿ç”¨2Dç›´æ–¹å›¾

---

## ğŸ“š å‚è€ƒèµ„æº

1. **Tufte, E.R. (2001)**: "The Visual Display of Quantitative Information"
2. **Few, S. (2009)**: "Now You See It: Simple Visualization Techniques for Quantitative Analysis"
3. **Wickham, H. (2016)**: "ggplot2: Elegant Graphics for Data Analysis"
4. **Cleveland, W.S. (1993)**: "Visualizing Data"

---

### PostgreSQL 18 æ–°ç‰¹æ€§åº”ç”¨ï¼ˆå¢å¼ºï¼‰

**PostgreSQL 18**å¼•å…¥äº†å¤šé¡¹å¢å¼ºåŠŸèƒ½ï¼Œå¯ä»¥æ˜¾è‘—æå‡ç»Ÿè®¡å›¾è¡¨æ•°æ®ç”Ÿæˆçš„æ€§èƒ½ï¼š

1. **Skip Scanä¼˜åŒ–**ï¼š
   - å¯¹äºåŒ…å«ç±»åˆ«æ ‡ç­¾çš„ç´¢å¼•ï¼ŒSkip Scanå¯ä»¥è·³è¿‡ä¸å¿…è¦çš„ç´¢å¼•æ‰«æ
   - ç‰¹åˆ«é€‚ç”¨äºTop-Nç±»åˆ«æŸ¥è¯¢å’Œå¤šç»´åº¦å¯¹æ¯”æŸ¥è¯¢

2. **å¼‚æ­¥I/Oå¢å¼º**ï¼š
   - å¯¹äºå¤§è§„æ¨¡ç»Ÿè®¡å›¾è¡¨ç”Ÿæˆï¼Œå¼‚æ­¥I/Oå¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½
   - é€‚ç”¨äºæ‰¹é‡ç›´æ–¹å›¾ç”Ÿæˆå’Œå¹¶è¡Œç®±çº¿å›¾è®¡ç®—

3. **å¹¶è¡ŒæŸ¥è¯¢å¢å¼º**ï¼š
   - ç»Ÿè®¡å›¾è¡¨ç”Ÿæˆæ”¯æŒæ›´å¥½çš„å¹¶è¡Œæ‰§è¡Œï¼ˆå·²åœ¨9èŠ‚è¯¦ç»†è¯´æ˜ï¼‰
   - é€‚ç”¨äºå¤§è§„æ¨¡æ•°æ®å¯è§†åŒ–å’Œå¹¶è¡Œå›¾è¡¨æ•°æ®è®¡ç®—

**ç¤ºä¾‹ï¼šä½¿ç”¨Skip Scanä¼˜åŒ–ç»Ÿè®¡å›¾è¡¨æŸ¥è¯¢**

```sql
-- ä¸ºç»Ÿè®¡å›¾è¡¨æ•°æ®åˆ›å»ºSkip Scanä¼˜åŒ–ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_chart_data_skip_scan
ON chart_data(category, value DESC);

-- Skip Scanä¼˜åŒ–æŸ¥è¯¢ï¼šæŸ¥æ‰¾æ¯ä¸ªç±»åˆ«çš„æœ€å¤§å€¼
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT DISTINCT ON (category)
    category,
    value,
    label
FROM chart_data
ORDER BY category, value DESC
LIMIT 50;
```

### é«˜çº§ä¼˜åŒ–æŠ€å·§ï¼ˆå¢å¼ºï¼‰

**1. ä½¿ç”¨ç‰©åŒ–è§†å›¾ç¼“å­˜ç»Ÿè®¡å›¾è¡¨æ•°æ®**

å¯¹äºé¢‘ç¹ä½¿ç”¨çš„ç»Ÿè®¡å›¾è¡¨æ•°æ®ï¼Œä½¿ç”¨ç‰©åŒ–è§†å›¾ç¼“å­˜ï¼š

```sql
-- åˆ›å»ºç‰©åŒ–è§†å›¾ç¼“å­˜ç»Ÿè®¡å›¾è¡¨æ•°æ®
CREATE MATERIALIZED VIEW IF NOT EXISTS statistical_chart_data_cache AS
WITH histogram_data AS (
    SELECT
        category,
        -- ä½¿ç”¨çª—å£å‡½æ•°è®¡ç®—ç›´æ–¹å›¾åŒºé—´ï¼ˆé¿å…é‡å¤è®¡ç®—ï¼‰
        WIDTH_BUCKET(value, MIN(value) OVER (PARTITION BY category), MAX(value) OVER (PARTITION BY category), 10) AS bucket_id,
        COUNT(*) AS bucket_count
    FROM chart_data
    GROUP BY category, WIDTH_BUCKET(value, MIN(value) OVER (PARTITION BY category), MAX(value) OVER (PARTITION BY category), 10)
),
boxplot_stats AS (
    SELECT
        category,
        COUNT(*) AS sample_count,
        PERCENTILE_CONT(0.25) WITHIN GROUP (ORDER BY value) AS q1,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY value) AS median,
        PERCENTILE_CONT(0.75) WITHIN GROUP (ORDER BY value) AS q3,
        MIN(value) AS min_value,
        MAX(value) AS max_value
    FROM chart_data
    GROUP BY category
)
SELECT
    bps.category,
    bps.sample_count,
    ROUND(bps.min_value::numeric, 4) AS min_value,
    ROUND(bps.q1::numeric, 4) AS q1,
    ROUND(bps.median::numeric, 4) AS median,
    ROUND(bps.q3::numeric, 4) AS q3,
    ROUND(bps.max_value::numeric, 4) AS max_value,
    ROUND((bps.q3 - bps.q1)::numeric, 4) AS iqr,
    CASE
        WHEN (bps.q3 - bps.q1) > (bps.max_value - bps.min_value) * 0.5 THEN 'High Variability'
        WHEN (bps.q3 - bps.q1) > (bps.max_value - bps.min_value) * 0.2 THEN 'Moderate Variability'
        ELSE 'Low Variability'
    END AS variability_category
FROM boxplot_stats bps
ORDER BY bps.category;

-- åˆ›å»ºç´¢å¼•åŠ é€Ÿç‰©åŒ–è§†å›¾æŸ¥è¯¢
CREATE INDEX idx_statistical_chart_cache_category ON statistical_chart_data_cache(category);
CREATE INDEX idx_statistical_chart_cache_variability ON statistical_chart_data_cache(variability_category, iqr DESC);

-- å®šæœŸåˆ·æ–°ç‰©åŒ–è§†å›¾
REFRESH MATERIALIZED VIEW CONCURRENTLY statistical_chart_data_cache;
```

**2. å®æ—¶ç»Ÿè®¡å›¾è¡¨ï¼šå¢é‡æ•°æ®æ›´æ–°**

**å®æ—¶ç»Ÿè®¡å›¾è¡¨**ï¼šå¯¹äºå®æ—¶æ•°æ®ï¼Œä½¿ç”¨å¢é‡æ–¹æ³•æ›´æ–°å›¾è¡¨æ•°æ®ã€‚

```sql
-- å®æ—¶ç»Ÿè®¡å›¾è¡¨ï¼šå¢é‡æ•°æ®æ›´æ–°ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'statistical_chart_state') THEN
            CREATE TABLE statistical_chart_state (
                chart_id VARCHAR(100) NOT NULL,
                category VARCHAR(100) NOT NULL,
                chart_type VARCHAR(50) NOT NULL,  -- 'histogram', 'boxplot', 'scatter', 'heatmap'
                sum_values NUMERIC DEFAULT 0,
                sum_squared_values NUMERIC DEFAULT 0,
                count_samples BIGINT DEFAULT 0,
                min_value NUMERIC,
                max_value NUMERIC,
                q1_value NUMERIC,
                median_value NUMERIC,
                q3_value NUMERIC,
                last_updated TIMESTAMPTZ DEFAULT NOW(),
                PRIMARY KEY (chart_id, category, chart_type)
            );

            CREATE INDEX idx_statistical_chart_state_chart ON statistical_chart_state(chart_id, last_updated DESC);
            CREATE INDEX idx_statistical_chart_state_updated ON statistical_chart_state(last_updated DESC);

            RAISE NOTICE 'ç»Ÿè®¡å›¾è¡¨çŠ¶æ€è¡¨åˆ›å»ºæˆåŠŸ';
        END IF;

        RAISE NOTICE 'å¼€å§‹æ‰§è¡Œå¢é‡ç»Ÿè®¡å›¾è¡¨æ›´æ–°';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¢é‡ç»Ÿè®¡å›¾è¡¨æ›´æ–°å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

**3. æ™ºèƒ½ç»Ÿè®¡å›¾è¡¨ä¼˜åŒ–ï¼šè‡ªé€‚åº”å›¾è¡¨ç±»å‹é€‰æ‹©**

**æ™ºèƒ½ç»Ÿè®¡å›¾è¡¨ä¼˜åŒ–**ï¼šæ ¹æ®æ•°æ®ç‰¹å¾è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜å›¾è¡¨ç±»å‹ã€‚

```sql
-- æ™ºèƒ½ç»Ÿè®¡å›¾è¡¨ä¼˜åŒ–ï¼šè‡ªé€‚åº”å›¾è¡¨ç±»å‹é€‰æ‹©ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
DECLARE
    data_dimension INTEGER;
    category_count INTEGER;
    data_type VARCHAR(50);
    recommended_chart_type VARCHAR(50);
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'chart_data') THEN
            RAISE WARNING 'è¡¨ chart_data ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡Œæ™ºèƒ½ç»Ÿè®¡å›¾è¡¨ä¼˜åŒ–';
            RETURN;
        END IF;

        -- è®¡ç®—æ•°æ®ç‰¹å¾
        SELECT
            COUNT(DISTINCT category),
            CASE
                WHEN COUNT(DISTINCT value::text) < COUNT(*) * 0.1 THEN 'Categorical'
                ELSE 'Continuous'
            END
        INTO category_count, data_type
        FROM chart_data;

        -- æ ¹æ®æ•°æ®ç‰¹å¾è‡ªé€‚åº”é€‰æ‹©å›¾è¡¨ç±»å‹
        IF data_type = 'Categorical' AND category_count < 10 THEN
            recommended_chart_type := 'BAR_CHART';  -- åˆ†ç±»æ•°æ®å°‘é‡ç±»åˆ«ï¼šæŸ±çŠ¶å›¾
        ELSIF data_type = 'Categorical' AND category_count >= 10 THEN
            recommended_chart_type := 'PIE_CHART';  -- åˆ†ç±»æ•°æ®å¤šç±»åˆ«ï¼šé¥¼å›¾
        ELSIF category_count = 1 THEN
            recommended_chart_type := 'HISTOGRAM';  -- å•ä¸€ç±»åˆ«ï¼šç›´æ–¹å›¾
        ELSE
            recommended_chart_type := 'BOXPLOT';  -- å…¶ä»–ï¼šç®±çº¿å›¾
        END IF;

        RAISE NOTICE 'ç±»åˆ«æ•°: %, æ•°æ®ç±»å‹: %, æ¨èå›¾è¡¨ç±»å‹: %',
            category_count, data_type, recommended_chart_type;
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'æ™ºèƒ½ç»Ÿè®¡å›¾è¡¨ä¼˜åŒ–å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆï¼ˆåŒ…å«å®Œæ•´ç†è®ºæ¨å¯¼ã€å®ç°å’ŒPostgreSQL 18æ–°ç‰¹æ€§æ”¯æŒï¼‰
