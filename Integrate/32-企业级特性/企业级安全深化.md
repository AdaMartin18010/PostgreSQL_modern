# PostgreSQLä¼ä¸šçº§å®‰å…¨æ·±åŒ–æŒ‡å—

> **PostgreSQLç‰ˆæœ¬**: 17+/18+
> **é€‚ç”¨åœºæ™¯**: ä¼ä¸šçº§å®‰å…¨è¦æ±‚
> **éš¾åº¦ç­‰çº§**: â­â­â­â­ é«˜çº§

---

## ğŸ“Š çŸ¥è¯†ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((ä¼ä¸šçº§å®‰å…¨))
    é«˜çº§å®‰å…¨ç­–ç•¥
      è®¿é—®æ§åˆ¶
      è§’è‰²ç®¡ç†
      æƒé™ç®¡ç†
      è¡Œçº§å®‰å…¨RLS
      å®‰å…¨å®¡è®¡
      å®¡è®¡æ—¥å¿—
      ä¸å¯ç¯¡æ”¹æ—¥å¿—
      å®‰å…¨ç›‘æ§
    åˆè§„æ€§ç®¡ç†
      GDPRåˆè§„
      HIPAAåˆè§„
      SOC2åˆè§„
      è¡Œä¸šåˆè§„
    æ•°æ®ä¿æŠ¤
      æ•°æ®åŠ å¯†
      é€æ˜åŠ å¯†
      åº”ç”¨å±‚åŠ å¯†
      æ•°æ®è„±æ•
      æ•°æ®æº¯æº
```

---

## ğŸ“Š ä¼ä¸šçº§å®‰å…¨æ–¹æ¡ˆé€‰å‹å†³ç­–æ ‘

```mermaid
flowchart TD
    A[éœ€è¦ä¼ä¸šçº§å®‰å…¨?] --> B{å®‰å…¨çº§åˆ«è¦æ±‚?}
    B -->|åŸºç¡€å®‰å…¨| C[è®¿é—®æ§åˆ¶ + å®¡è®¡æ—¥å¿—]
    B -->|é«˜çº§å®‰å…¨| D[RLS + åŠ å¯† + å®¡è®¡]
    B -->|ä¼ä¸šçº§å®‰å…¨| E[å…¨é¢å®‰å…¨æ–¹æ¡ˆ]

    C --> F[ä¼˜åŠ¿: ç®€å•<br/>é€‚ç”¨: ä¸€èˆ¬ä¼ä¸š]
    D --> G[ä¼˜åŠ¿: å…¨é¢<br/>é€‚ç”¨: æ•æ„Ÿæ•°æ®]
    E --> H[ä¼˜åŠ¿: ä¼ä¸šçº§<br/>é€‚ç”¨: é«˜å®‰å…¨è¦æ±‚]

    A --> I{åˆè§„è¦æ±‚?}
    I -->|GDPR| J[æ•°æ®ä¿æŠ¤ + å®¡è®¡]
    I -->|HIPAA| K[PHIä¿æŠ¤ + åŠ å¯†]
    I -->|SOC2| L[è®¿é—®æ§åˆ¶ + ç›‘æ§]
```

---

## ğŸ“Š ä¼ä¸šçº§å®‰å…¨æ–¹æ¡ˆå¯¹æ¯”çŸ©é˜µ

| å®‰å…¨æ–¹æ¡ˆ | å®‰å…¨çº§åˆ« | å®æ–½å¤æ‚åº¦ | æ€§èƒ½å½±å“ | æˆæœ¬ | é€‚ç”¨åœºæ™¯ |
| --- | --- | --- | --- | --- | --- |
| **åŸºç¡€å®‰å…¨** | â­â­â­ | â­â­ | ä½ | ä½ | ä¸€èˆ¬ä¼ä¸š |
| **é«˜çº§å®‰å…¨** | â­â­â­â­ | â­â­â­ | ä¸­ | ä¸­ | æ•æ„Ÿæ•°æ® |
| **ä¼ä¸šçº§å®‰å…¨** | â­â­â­â­â­ | â­â­â­â­ | ä¸­-é«˜ | é«˜ | é«˜å®‰å…¨è¦æ±‚ |
| **åˆè§„æ€§å®‰å…¨** | â­â­â­â­â­ | â­â­â­â­â­ | ä¸­-é«˜ | é«˜ | åˆè§„è¦æ±‚é«˜ |

---

> **PostgreSQLç‰ˆæœ¬**: 17+/18+
> **é€‚ç”¨åœºæ™¯**: ä¼ä¸šçº§æ•°æ®åº“ã€åˆè§„æ€§è¦æ±‚é«˜çš„è¡Œä¸š
> **éš¾åº¦ç­‰çº§**: â­â­â­â­â­ ä¸“å®¶çº§
> **å‚è€ƒ**: [05-å®‰å…¨ä¸åˆè§„/å®‰å…¨åŠ å›º](../05-å®‰å…¨ä¸åˆè§„/å®‰å…¨åŠ å›º/PostgreSQLå®‰å…¨åŠ å›ºå®Œæ•´æŒ‡å—.md)

---

## ğŸ“‹ ç›®å½•

- [PostgreSQLä¼ä¸šçº§å®‰å…¨æ·±åŒ–æŒ‡å—](#postgresqlä¼ä¸šçº§å®‰å…¨æ·±åŒ–æŒ‡å—)
  - [ğŸ“Š çŸ¥è¯†ä½“ç³»æ€ç»´å¯¼å›¾](#-çŸ¥è¯†ä½“ç³»æ€ç»´å¯¼å›¾)
  - [ğŸ“Š ä¼ä¸šçº§å®‰å…¨æ–¹æ¡ˆé€‰å‹å†³ç­–æ ‘](#-ä¼ä¸šçº§å®‰å…¨æ–¹æ¡ˆé€‰å‹å†³ç­–æ ‘)
  - [ğŸ“Š ä¼ä¸šçº§å®‰å…¨æ–¹æ¡ˆå¯¹æ¯”çŸ©é˜µ](#-ä¼ä¸šçº§å®‰å…¨æ–¹æ¡ˆå¯¹æ¯”çŸ©é˜µ)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 ä¼ä¸šçº§å®‰å…¨ç›®æ ‡](#11-ä¼ä¸šçº§å®‰å…¨ç›®æ ‡)
    - [1.2 å®‰å…¨å±‚æ¬¡](#12-å®‰å…¨å±‚æ¬¡)
  - [2. é«˜çº§å®‰å…¨ç­–ç•¥](#2-é«˜çº§å®‰å…¨ç­–ç•¥)
    - [2.1 ç»†ç²’åº¦è®¿é—®æ§åˆ¶](#21-ç»†ç²’åº¦è®¿é—®æ§åˆ¶)
      - [2.1.1 åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰](#211-åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶rbac)
    - [2.2 æ•°æ®åŠ å¯†](#22-æ•°æ®åŠ å¯†)
      - [2.2.1 é€æ˜æ•°æ®åŠ å¯†ï¼ˆTDEï¼‰](#221-é€æ˜æ•°æ®åŠ å¯†tde)
      - [2.2.2 åˆ—çº§åŠ å¯†](#222-åˆ—çº§åŠ å¯†)
    - [2.3 æ•°æ®è„±æ•](#23-æ•°æ®è„±æ•)
    - [3.2 å®¡è®¡æŸ¥è¯¢](#32-å®¡è®¡æŸ¥è¯¢)
  - [4. åˆè§„æ€§ç®¡ç†](#4-åˆè§„æ€§ç®¡ç†)
    - [4.1 GDPRåˆè§„](#41-gdpråˆè§„)
      - [4.1.1 æ•°æ®ä¸»ä½“æƒåˆ©](#411-æ•°æ®ä¸»ä½“æƒåˆ©)
    - [4.2 HIPAAåˆè§„](#42-hipaaåˆè§„)
    - [4.3 SOC2åˆè§„](#43-soc2åˆè§„)
  - [5. æ•°æ®ä¸»æƒç®¡ç†](#5-æ•°æ®ä¸»æƒç®¡ç†)
    - [5.1 æ•°æ®æœ¬åœ°åŒ–](#51-æ•°æ®æœ¬åœ°åŒ–)
    - [5.2 è·¨å¢ƒæ•°æ®ä¼ è¾“æ§åˆ¶](#52-è·¨å¢ƒæ•°æ®ä¼ è¾“æ§åˆ¶)
  - [6. å®‰å…¨äº‹ä»¶å“åº”](#6-å®‰å…¨äº‹ä»¶å“åº”)
    - [6.1 å¨èƒæ£€æµ‹](#61-å¨èƒæ£€æµ‹)
    - [6.2 å®‰å…¨äº‹ä»¶å“åº”æµç¨‹](#62-å®‰å…¨äº‹ä»¶å“åº”æµç¨‹)
  - [7. æœ€ä½³å®è·µ](#7-æœ€ä½³å®è·µ)
    - [7.1 å®‰å…¨ç­–ç•¥](#71-å®‰å…¨ç­–ç•¥)
    - [7.2 åˆè§„æ€§ç®¡ç†](#72-åˆè§„æ€§ç®¡ç†)
    - [7.3 æ•°æ®ä¿æŠ¤](#73-æ•°æ®ä¿æŠ¤)
  - [ğŸ“š ç›¸å…³æ–‡æ¡£](#-ç›¸å…³æ–‡æ¡£)

---

## 1. æ¦‚è¿°

### 1.1 ä¼ä¸šçº§å®‰å…¨ç›®æ ‡

ä¼ä¸šçº§å®‰å…¨æ·±åŒ–æ˜¯åœ¨åŸºç¡€å®‰å…¨åŠ å›ºä¹‹ä¸Šçš„é«˜çº§å®‰å…¨æªæ–½ï¼Œæ—¨åœ¨ï¼š

- âœ… **æ·±åº¦é˜²å¾¡**: å¤šå±‚å®‰å…¨é˜²æŠ¤
- âœ… **åˆè§„æ€§**: æ»¡è¶³GDPRã€HIPAAã€SOC2ç­‰åˆè§„è¦æ±‚
- âœ… **å®¡è®¡è¿½è¸ª**: å®Œæ•´çš„æ“ä½œå®¡è®¡
- âœ… **æ•°æ®ä¿æŠ¤**: æ•°æ®åŠ å¯†ã€è„±æ•ã€ä¸»æƒç®¡ç†
- âœ… **å¨èƒæ£€æµ‹**: å®æ—¶å¨èƒæ£€æµ‹å’Œå“åº”

### 1.2 å®‰å…¨å±‚æ¬¡

```text
åº”ç”¨å±‚å®‰å…¨
    â†“
æ•°æ®åº“å±‚å®‰å…¨
    â†“
æ“ä½œç³»ç»Ÿå±‚å®‰å…¨
    â†“
ç½‘ç»œå±‚å®‰å…¨
```

---

## 2. é«˜çº§å®‰å…¨ç­–ç•¥

### 2.1 ç»†ç²’åº¦è®¿é—®æ§åˆ¶

#### 2.1.1 åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰

```sql
-- åˆ›å»ºè§’è‰²å±‚æ¬¡ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'security_admin') THEN
            CREATE ROLE security_admin;
            RAISE NOTICE 'è§’è‰² security_admin åˆ›å»ºæˆåŠŸ';
        ELSE
            RAISE NOTICE 'è§’è‰² security_admin å·²å­˜åœ¨';
        END IF;
    EXCEPTION
        WHEN duplicate_object THEN
            RAISE WARNING 'è§’è‰² security_admin å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè§’è‰² security_admin å¤±è´¥: %', SQLERRM;
            RAISE;
    END;

    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'data_admin') THEN
            CREATE ROLE data_admin;
            RAISE NOTICE 'è§’è‰² data_admin åˆ›å»ºæˆåŠŸ';
        ELSE
            RAISE NOTICE 'è§’è‰² data_admin å·²å­˜åœ¨';
        END IF;
    EXCEPTION
        WHEN duplicate_object THEN
            RAISE WARNING 'è§’è‰² data_admin å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè§’è‰² data_admin å¤±è´¥: %', SQLERRM;
            RAISE;
    END;

    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'app_user') THEN
            CREATE ROLE app_user;
            RAISE NOTICE 'è§’è‰² app_user åˆ›å»ºæˆåŠŸ';
        ELSE
            RAISE NOTICE 'è§’è‰² app_user å·²å­˜åœ¨';
        END IF;
    EXCEPTION
        WHEN duplicate_object THEN
            RAISE WARNING 'è§’è‰² app_user å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè§’è‰² app_user å¤±è´¥: %', SQLERRM;
            RAISE;
    END;

    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'readonly_user') THEN
            CREATE ROLE readonly_user;
            RAISE NOTICE 'è§’è‰² readonly_user åˆ›å»ºæˆåŠŸ';
        ELSE
            RAISE NOTICE 'è§’è‰² readonly_user å·²å­˜åœ¨';
        END IF;
    EXCEPTION
        WHEN duplicate_object THEN
            RAISE WARNING 'è§’è‰² readonly_user å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè§’è‰² readonly_user å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- æˆäºˆæƒé™ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'security_admin') OR
           NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'data_admin') THEN
            RAISE WARNING 'è§’è‰² security_admin æˆ– data_admin ä¸å­˜åœ¨';
            RETURN;
        END IF;

        GRANT security_admin TO data_admin;
        RAISE NOTICE 'å·²æˆäºˆ security_admin ç»™ data_admin';
    EXCEPTION
        WHEN undefined_object THEN
            RAISE WARNING 'è§’è‰²ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'æˆäºˆæƒé™å¤±è´¥: %', SQLERRM;
            RAISE;
    END;

    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'data_admin') OR
           NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'app_user') THEN
            RAISE WARNING 'è§’è‰² data_admin æˆ– app_user ä¸å­˜åœ¨';
            RETURN;
        END IF;

        GRANT data_admin TO app_user;
        RAISE NOTICE 'å·²æˆäºˆ data_admin ç»™ app_user';
    EXCEPTION
        WHEN undefined_object THEN
            RAISE WARNING 'è§’è‰²ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'æˆäºˆæƒé™å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- è¡¨çº§æƒé™ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'orders') THEN
            RAISE WARNING 'è¡¨ orders ä¸å­˜åœ¨';
            RETURN;
        END IF;

        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'app_user') THEN
            RAISE WARNING 'è§’è‰² app_user ä¸å­˜åœ¨';
            RETURN;
        END IF;

        GRANT SELECT, INSERT, UPDATE ON orders TO app_user;
        RAISE NOTICE 'å·²æˆäºˆ app_user å¯¹è¡¨ orders çš„ SELECT, INSERT, UPDATE æƒé™';
    EXCEPTION
        WHEN undefined_table THEN
            RAISE WARNING 'è¡¨ orders ä¸å­˜åœ¨';
        WHEN undefined_object THEN
            RAISE WARNING 'è§’è‰² app_user ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'æˆäºˆè¡¨çº§æƒé™å¤±è´¥: %', SQLERRM;
            RAISE;
    END;

    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'orders') THEN
            RAISE WARNING 'è¡¨ orders ä¸å­˜åœ¨';
            RETURN;
        END IF;

        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'readonly_user') THEN
            RAISE WARNING 'è§’è‰² readonly_user ä¸å­˜åœ¨';
            RETURN;
        END IF;

        GRANT SELECT ON orders TO readonly_user;
        RAISE NOTICE 'å·²æˆäºˆ readonly_user å¯¹è¡¨ orders çš„ SELECT æƒé™';
    EXCEPTION
        WHEN undefined_table THEN
            RAISE WARNING 'è¡¨ orders ä¸å­˜åœ¨';
        WHEN undefined_object THEN
            RAISE WARNING 'è§’è‰² readonly_user ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'æˆäºˆè¡¨çº§æƒé™å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

#### 2.1.2 è¡Œçº§å®‰å…¨ï¼ˆRLSï¼‰æ·±åŒ–

```sql
-- å¯ç”¨RLSï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'sensitive_data') THEN
            RAISE WARNING 'è¡¨ sensitive_data ä¸å­˜åœ¨';
            RETURN;
        END IF;

        ALTER TABLE sensitive_data ENABLE ROW LEVEL SECURITY;
        RAISE NOTICE 'è¡¨ sensitive_data å·²å¯ç”¨è¡Œçº§å®‰å…¨';
    EXCEPTION
        WHEN undefined_table THEN
            RAISE WARNING 'è¡¨ sensitive_data ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'å¯ç”¨RLSå¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- åŸºäºè§’è‰²çš„RLSç­–ç•¥ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'sensitive_data') THEN
            RAISE WARNING 'è¡¨ sensitive_data ä¸å­˜åœ¨';
            RETURN;
        END IF;

        IF EXISTS (SELECT 1 FROM pg_policies WHERE schemaname = 'public' AND tablename = 'sensitive_data' AND policyname = 'manager_access') THEN
            DROP POLICY manager_access ON sensitive_data;
            RAISE NOTICE 'å·²åˆ é™¤ç°æœ‰ç­–ç•¥ manager_access';
        END IF;

        CREATE POLICY manager_access ON sensitive_data
            FOR ALL
            USING (
                current_user = 'manager'
                OR department_id = (
                    SELECT department_id
                    FROM employees
                    WHERE employee_id = current_user
                )
            );
        RAISE NOTICE 'åŸºäºè§’è‰²çš„RLSç­–ç•¥ manager_access åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN undefined_table THEN
            RAISE WARNING 'è¡¨ sensitive_data æˆ– employees ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºåŸºäºè§’è‰²çš„RLSç­–ç•¥å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- åŸºäºæ—¶é—´çš„RLSç­–ç•¥ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'sensitive_data') THEN
            RAISE WARNING 'è¡¨ sensitive_data ä¸å­˜åœ¨';
            RETURN;
        END IF;

        IF EXISTS (SELECT 1 FROM pg_policies WHERE schemaname = 'public' AND tablename = 'sensitive_data' AND policyname = 'business_hours_access') THEN
            DROP POLICY business_hours_access ON sensitive_data;
            RAISE NOTICE 'å·²åˆ é™¤ç°æœ‰ç­–ç•¥ business_hours_access';
        END IF;

        CREATE POLICY business_hours_access ON sensitive_data
            FOR SELECT
            USING (
                EXTRACT(HOUR FROM NOW()) BETWEEN 9 AND 17
                AND EXTRACT(DOW FROM NOW()) BETWEEN 1 AND 5
            );
        RAISE NOTICE 'åŸºäºæ—¶é—´çš„RLSç­–ç•¥ business_hours_access åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN undefined_table THEN
            RAISE WARNING 'è¡¨ sensitive_data ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºåŸºäºæ—¶é—´çš„RLSç­–ç•¥å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

### 2.2 æ•°æ®åŠ å¯†

#### 2.2.1 é€æ˜æ•°æ®åŠ å¯†ï¼ˆTDEï¼‰

```sql
-- PostgreSQL 15+æ”¯æŒTDEï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
-- æ³¨æ„ï¼šTDEéœ€è¦ç‰¹æ®Šçš„ç¼–è¯‘é€‰é¡¹å’Œé…ç½®ï¼Œè¿™é‡Œæä¾›ç¤ºä¾‹
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = current_user AND rolsuper = true) THEN
            RAISE EXCEPTION 'éœ€è¦è¶…çº§ç”¨æˆ·æƒé™æ¥é…ç½®åŠ å¯†';
        END IF;

        -- æ³¨æ„ï¼šä»¥ä¸‹é…ç½®éœ€è¦æ ¹æ®å®é™…ç¯å¢ƒè°ƒæ•´
        -- ALTER SYSTEM SET encryption_key = 'your-encryption-key';
        -- ALTER SYSTEM SET encryption_algorithm = 'AES-256';
        -- PERFORM pg_reload_conf();

        RAISE NOTICE 'TDEé…ç½®è¯´æ˜ï¼šéœ€è¦åœ¨postgresql.confä¸­é…ç½®æˆ–ä½¿ç”¨ALTER SYSTEM';
    EXCEPTION
        WHEN insufficient_privilege THEN
            RAISE WARNING 'æƒé™ä¸è¶³ï¼Œæ— æ³•é…ç½®åŠ å¯†';
        WHEN OTHERS THEN
            RAISE WARNING 'é…ç½®åŠ å¯†å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- åˆ›å»ºåŠ å¯†è¡¨ç©ºé—´ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = current_user AND rolsuper = true) THEN
            RAISE EXCEPTION 'éœ€è¦è¶…çº§ç”¨æˆ·æƒé™æ¥åˆ›å»ºè¡¨ç©ºé—´';
        END IF;

        IF NOT EXISTS (SELECT 1 FROM pg_tablespace WHERE spcname = 'encrypted_tablespace') THEN
            CREATE TABLESPACE encrypted_tablespace
            LOCATION '/data/encrypted'
            WITH (encryption = 'on');
            RAISE NOTICE 'åŠ å¯†è¡¨ç©ºé—´ encrypted_tablespace åˆ›å»ºæˆåŠŸ';
        ELSE
            RAISE NOTICE 'åŠ å¯†è¡¨ç©ºé—´ encrypted_tablespace å·²å­˜åœ¨';
        END IF;
    EXCEPTION
        WHEN duplicate_object THEN
            RAISE WARNING 'è¡¨ç©ºé—´ encrypted_tablespace å·²å­˜åœ¨';
        WHEN insufficient_privilege THEN
            RAISE WARNING 'æƒé™ä¸è¶³ï¼Œæ— æ³•åˆ›å»ºè¡¨ç©ºé—´';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºåŠ å¯†è¡¨ç©ºé—´å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

#### 2.2.2 åˆ—çº§åŠ å¯†

```sql
-- ä½¿ç”¨pgcryptoæ‰©å±•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_extension WHERE extname = 'pgcrypto') THEN
            CREATE EXTENSION pgcrypto;
            RAISE NOTICE 'pgcrypto æ‰©å±•åˆ›å»ºæˆåŠŸ';
        ELSE
            RAISE NOTICE 'pgcrypto æ‰©å±•å·²å­˜åœ¨';
        END IF;
    EXCEPTION
        WHEN insufficient_privilege THEN
            RAISE WARNING 'æƒé™ä¸è¶³ï¼Œæ— æ³•åˆ›å»º pgcrypto æ‰©å±•';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»º pgcrypto æ‰©å±•å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- åŠ å¯†å­˜å‚¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'users') THEN
            RAISE WARNING 'è¡¨ users å·²å­˜åœ¨';
        ELSE
            CREATE TABLE users (
                id SERIAL PRIMARY KEY,
                username TEXT,
                password_hash BYTEA,
                email_encrypted BYTEA,
                ssn_encrypted BYTEA
            );
            RAISE NOTICE 'è¡¨ users åˆ›å»ºæˆåŠŸï¼ˆæ”¯æŒåŠ å¯†å­˜å‚¨ï¼‰';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ users å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨ users å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- åŠ å¯†å‡½æ•°ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
CREATE OR REPLACE FUNCTION encrypt_sensitive(data TEXT, key TEXT)
RETURNS BYTEA AS $$
BEGIN
    BEGIN
        -- å‚æ•°éªŒè¯
        IF data IS NULL OR key IS NULL THEN
            RAISE EXCEPTION 'å‚æ•°ä¸èƒ½ä¸ºNULL';
        END IF;

        -- æ£€æŸ¥pgcryptoæ‰©å±•
        IF NOT EXISTS (SELECT 1 FROM pg_extension WHERE extname = 'pgcrypto') THEN
            RAISE EXCEPTION 'pgcrypto æ‰©å±•æœªå®‰è£…';
        END IF;

        RETURN pgp_sym_encrypt(data, key);
    EXCEPTION
        WHEN undefined_function THEN
            RAISE EXCEPTION 'pgcrypto æ‰©å±•æœªå®‰è£…ï¼Œæ— æ³•ä½¿ç”¨åŠ å¯†åŠŸèƒ½';
        WHEN OTHERS THEN
            RAISE;
    END;
END;
$$ LANGUAGE plpgsql;

-- è§£å¯†å‡½æ•°ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
CREATE OR REPLACE FUNCTION decrypt_sensitive(data BYTEA, key TEXT)
RETURNS TEXT AS $$
BEGIN
    BEGIN
        -- å‚æ•°éªŒè¯
        IF data IS NULL OR key IS NULL THEN
            RAISE EXCEPTION 'å‚æ•°ä¸èƒ½ä¸ºNULL';
        END IF;

        -- æ£€æŸ¥pgcryptoæ‰©å±•
        IF NOT EXISTS (SELECT 1 FROM pg_extension WHERE extname = 'pgcrypto') THEN
            RAISE EXCEPTION 'pgcrypto æ‰©å±•æœªå®‰è£…';
        END IF;

        RETURN pgp_sym_decrypt(data, key);
END;
$$ LANGUAGE plpgsql;

-- ä½¿ç”¨åŠ å¯†
INSERT INTO users (username, email_encrypted)
VALUES ('user1', encrypt_sensitive('user1@example.com', 'encryption_key'));

-- è§£å¯†æŸ¥è¯¢
SELECT username, decrypt_sensitive(email_encrypted, 'encryption_key') as email
FROM users;
```

### 2.3 æ•°æ®è„±æ•

```sql
-- åˆ›å»ºè„±æ•å‡½æ•°ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
CREATE OR REPLACE FUNCTION mask_email(email TEXT)
RETURNS TEXT AS $$
BEGIN
    BEGIN
        -- å‚æ•°éªŒè¯
        IF email IS NULL THEN
            RETURN NULL;
        END IF;

        IF LENGTH(email) = 0 THEN
            RETURN '';
        END IF;

        RETURN regexp_replace(email, '(.)(.*)(@)', '\1***\3', 'g');
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'é‚®ä»¶è„±æ•å¤±è´¥: %', SQLERRM;
            RETURN email;  -- å¤±è´¥æ—¶è¿”å›åŸé‚®ä»¶
    END;
END;
$$ LANGUAGE plpgsql;

-- åˆ›å»ºè„±æ•è§†å›¾ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'users') THEN
            RAISE WARNING 'è¡¨ users ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºè„±æ•è§†å›¾';
            RETURN;
        END IF;

        IF EXISTS (SELECT 1 FROM information_schema.views WHERE table_schema = 'public' AND table_name = 'users_masked') THEN
            DROP VIEW users_masked;
            RAISE NOTICE 'å·²åˆ é™¤ç°æœ‰è§†å›¾ users_masked';
        END IF;

        CREATE VIEW users_masked AS
        SELECT
            id,
            username,
            mask_email(email) as email,
            '***-**-****' as ssn
        FROM users;
        RAISE NOTICE 'è„±æ•è§†å›¾ users_masked åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN undefined_table THEN
            RAISE WARNING 'è¡¨ users ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè„±æ•è§†å›¾å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- æˆäºˆè„±æ•è§†å›¾è®¿é—®æƒé™ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.views WHERE table_schema = 'public' AND table_name = 'users_masked') THEN
            RAISE WARNING 'è§†å›¾ users_masked ä¸å­˜åœ¨';
            RETURN;
        END IF;

        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'readonly_user') THEN
            RAISE WARNING 'è§’è‰² readonly_user ä¸å­˜åœ¨';
            RETURN;
        END IF;

        GRANT SELECT ON users_masked TO readonly_user;
        RAISE NOTICE 'å·²æˆäºˆ readonly_user å¯¹è§†å›¾ users_masked çš„ SELECT æƒé™';
    EXCEPTION
        WHEN undefined_object THEN
            RAISE WARNING 'è§†å›¾æˆ–è§’è‰²ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'æˆäºˆè§†å›¾è®¿é—®æƒé™å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

---

## 3. å®‰å…¨å®¡è®¡æ·±åŒ–

### 3.1 å®Œæ•´å®¡è®¡æ—¥å¿—

#### 3.1.1 pgAudité…ç½®

```sql
-- å®‰è£…pgAuditï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_extension WHERE extname = 'pgaudit') THEN
            CREATE EXTENSION pgaudit;
            RAISE NOTICE 'pgaudit æ‰©å±•åˆ›å»ºæˆåŠŸ';
        ELSE
            RAISE NOTICE 'pgaudit æ‰©å±•å·²å­˜åœ¨';
        END IF;
    EXCEPTION
        WHEN insufficient_privilege THEN
            RAISE WARNING 'æƒé™ä¸è¶³ï¼Œæ— æ³•åˆ›å»º pgaudit æ‰©å±•';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»º pgaudit æ‰©å±•å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- é…ç½®å®¡è®¡æ—¥å¿—ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_database WHERE datname = 'mydb') THEN
            RAISE WARNING 'æ•°æ®åº“ mydb ä¸å­˜åœ¨';
            RETURN;
        END IF;

        ALTER DATABASE mydb SET pgaudit.log = 'all';
        ALTER DATABASE mydb SET pgaudit.log_catalog = 'on';
        ALTER DATABASE mydb SET pgaudit.log_parameter = 'on';
        ALTER DATABASE mydb SET pgaudit.log_statement_once = 'off';
        RAISE NOTICE 'æ•°æ®åº“ mydb çš„pgaudité…ç½®å·²è®¾ç½®';
    EXCEPTION
        WHEN undefined_object THEN
            RAISE WARNING 'æ•°æ®åº“ mydb ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'é…ç½®å®¡è®¡æ—¥å¿—å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

#### 3.1.2 è‡ªå®šä¹‰å®¡è®¡è¡¨

```sql
-- åˆ›å»ºå®¡è®¡è¡¨
CREATE TABLE audit_log (
    id BIGSERIAL PRIMARY KEY,
    event_time TIMESTAMPTZ DEFAULT NOW(),
    username TEXT,
    database_name TEXT,
    table_name TEXT,
    operation TEXT,
    old_values JSONB,
    new_values JSONB,
    ip_address INET,
    user_agent TEXT
);

-- åˆ›å»ºå®¡è®¡è§¦å‘å™¨å‡½æ•°
CREATE OR REPLACE FUNCTION audit_trigger_func()
RETURNS TRIGGER AS $$
DECLARE
    v_ip_address INET;
BEGIN
    BEGIN
        -- æ£€æŸ¥å®¡è®¡è¡¨æ˜¯å¦å­˜åœ¨
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'audit_log') THEN
            RAISE WARNING 'è¡¨ audit_log ä¸å­˜åœ¨ï¼Œè·³è¿‡å®¡è®¡è®°å½•';
            IF TG_OP = 'DELETE' THEN
                RETURN OLD;
            ELSE
                RETURN NEW;
            END IF;
        END IF;

        -- è·å–å®¢æˆ·ç«¯IPåœ°å€ï¼ˆå¦‚æœå¯ç”¨ï¼‰
        BEGIN
            SELECT inet_client_addr() INTO v_ip_address;
        EXCEPTION
            WHEN OTHERS THEN
                v_ip_address := NULL;
        END;

        IF TG_OP = 'INSERT' THEN
            INSERT INTO audit_log (username, database_name, table_name, operation, new_values, ip_address)
            VALUES (
                current_user,
                current_database(),
                TG_TABLE_NAME,
                'INSERT',
                to_jsonb(NEW),
                v_ip_address
            );
            RETURN NEW;
        ELSIF TG_OP = 'UPDATE' THEN
            INSERT INTO audit_log (username, database_name, table_name, operation, old_values, new_values, ip_address)
            VALUES (
                current_user,
                current_database(),
                TG_TABLE_NAME,
                'UPDATE',
                to_jsonb(OLD),
                to_jsonb(NEW),
                v_ip_address
            );
            RETURN NEW;
        ELSIF TG_OP = 'DELETE' THEN
            INSERT INTO audit_log (username, database_name, table_name, operation, old_values, ip_address)
            VALUES (
                current_user,
                current_database(),
                TG_TABLE_NAME,
                'DELETE',
                to_jsonb(OLD),
                v_ip_address
            );
            RETURN OLD;
        END IF;
    EXCEPTION
        WHEN undefined_table THEN
            RAISE WARNING 'è¡¨ audit_log ä¸å­˜åœ¨ï¼Œè·³è¿‡å®¡è®¡è®°å½•';
            IF TG_OP = 'DELETE' THEN
                RETURN OLD;
            ELSE
                RETURN NEW;
            END IF;
        WHEN OTHERS THEN
            RAISE WARNING 'å®¡è®¡è®°å½•å¤±è´¥: %', SQLERRM;
            IF TG_OP = 'DELETE' THEN
                RETURN OLD;
            ELSE
                RETURN NEW;
            END IF;
    END;
END;
$$ LANGUAGE plpgsql;

-- åˆ›å»ºå®¡è®¡è§¦å‘å™¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'sensitive_data') THEN
            RAISE WARNING 'è¡¨ sensitive_data ä¸å­˜åœ¨';
            RETURN;
        END IF;

        IF NOT EXISTS (SELECT 1 FROM pg_proc WHERE proname = 'audit_trigger_func') THEN
            RAISE WARNING 'å‡½æ•° audit_trigger_func ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºè§¦å‘å™¨';
            RETURN;
        END IF;

        IF EXISTS (SELECT 1 FROM pg_trigger WHERE tgname = 'audit_trigger') THEN
            DROP TRIGGER audit_trigger ON sensitive_data;
            RAISE NOTICE 'å·²åˆ é™¤ç°æœ‰è§¦å‘å™¨ audit_trigger';
        END IF;

        CREATE TRIGGER audit_trigger
        AFTER INSERT OR UPDATE OR DELETE ON sensitive_data
        FOR EACH ROW EXECUTE FUNCTION audit_trigger_func();
        RAISE NOTICE 'å®¡è®¡è§¦å‘å™¨ audit_trigger åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN undefined_table THEN
            RAISE WARNING 'è¡¨ sensitive_data ä¸å­˜åœ¨';
        WHEN undefined_function THEN
            RAISE WARNING 'å‡½æ•° audit_trigger_func ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºå®¡è®¡è§¦å‘å™¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

### 3.2 å®¡è®¡æŸ¥è¯¢

```sql
-- æŸ¥è¯¢å®¡è®¡æ—¥å¿—ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
DECLARE
    log_count INT;
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'audit_log') THEN
            RAISE WARNING 'è¡¨ audit_log ä¸å­˜åœ¨ï¼Œæ— æ³•æŸ¥è¯¢å®¡è®¡æ—¥å¿—';
            RETURN;
        END IF;

        SELECT COUNT(*) INTO log_count
        FROM audit_log
        WHERE event_time >= NOW() - INTERVAL '24 hours';

        RAISE NOTICE 'æ‰¾åˆ° % æ¡å®¡è®¡æ—¥å¿—è®°å½•ï¼ˆæœ€è¿‘24å°æ—¶ï¼‰', log_count;
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'æŸ¥è¯¢å®¡è®¡æ—¥å¿—å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

EXPLAIN ANALYZE
SELECT
    event_time,
    username,
    table_name,
    operation,
    ip_address
FROM audit_log
WHERE event_time >= NOW() - INTERVAL '24 hours'
ORDER BY event_time DESC
LIMIT 1000;

-- ç»Ÿè®¡å®¡è®¡äº‹ä»¶ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
DECLARE
    event_count INT;
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'audit_log') THEN
            RAISE WARNING 'è¡¨ audit_log ä¸å­˜åœ¨ï¼Œæ— æ³•ç»Ÿè®¡å®¡è®¡äº‹ä»¶';
            RETURN;
        END IF;

        SELECT COUNT(*) INTO event_count
        FROM audit_log
        WHERE event_time >= NOW() - INTERVAL '7 days';

        RAISE NOTICE 'æ‰¾åˆ° % æ¡å®¡è®¡äº‹ä»¶è®°å½•ï¼ˆæœ€è¿‘7å¤©ï¼‰', event_count;
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'ç»Ÿè®¡å®¡è®¡äº‹ä»¶å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

EXPLAIN ANALYZE
SELECT
    operation,
    COUNT(*) as event_count,
    COUNT(DISTINCT username) as user_count
FROM audit_log
WHERE event_time >= NOW() - INTERVAL '7 days'
GROUP BY operation
ORDER BY event_count DESC;
```

---

## 4. åˆè§„æ€§ç®¡ç†

### 4.1 GDPRåˆè§„

#### 4.1.1 æ•°æ®ä¸»ä½“æƒåˆ©

```sql
-- æ•°æ®è®¿é—®æƒï¼ˆRight to Accessï¼Œå¸¦é”™è¯¯å¤„ç†ï¼‰
CREATE OR REPLACE FUNCTION get_user_data(user_id INT)
RETURNS TABLE (
    table_name TEXT,
    data JSONB
) AS $$
BEGIN
    BEGIN
        -- å‚æ•°éªŒè¯
        IF user_id IS NULL THEN
            RAISE EXCEPTION 'user_id ä¸èƒ½ä¸ºNULL';
        END IF;

        RETURN QUERY
        SELECT
            'users'::TEXT,
            to_jsonb(u.*)
        FROM users u
        WHERE u.id = user_id;
    EXCEPTION
        WHEN undefined_table THEN
            RAISE EXCEPTION 'è¡¨ users ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE;
    END;
END;
$$ LANGUAGE plpgsql;

-- æ•°æ®åˆ é™¤æƒï¼ˆRight to Erasureï¼Œå¸¦é”™è¯¯å¤„ç†ï¼‰
CREATE OR REPLACE FUNCTION delete_user_data(user_id INT)
RETURNS void AS $$
DECLARE
    deleted_users_count INT;
    deleted_orders_count INT;
BEGIN
    BEGIN
        -- å‚æ•°éªŒè¯
        IF user_id IS NULL THEN
            RAISE EXCEPTION 'user_id ä¸èƒ½ä¸ºNULL';
        END IF;

        -- æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨
        IF NOT EXISTS (SELECT 1 FROM users WHERE id = user_id) THEN
            RAISE WARNING 'ç”¨æˆ· ID % ä¸å­˜åœ¨', user_id;
            RETURN;
        END IF;

        -- åˆ é™¤ç”¨æˆ·æ•°æ®
        DELETE FROM orders WHERE user_id = user_id;
        GET DIAGNOSTICS deleted_orders_count = ROW_COUNT;

        DELETE FROM users WHERE id = user_id;
        GET DIAGNOSTICS deleted_users_count = ROW_COUNT;

        RAISE NOTICE 'å·²åˆ é™¤ç”¨æˆ·æ•°æ®: è®¢å• % æ¡, ç”¨æˆ· % æ¡', deleted_orders_count, deleted_users_count;

        -- è®°å½•åˆ é™¤æ“ä½œï¼ˆå¦‚æœå­˜åœ¨å®¡è®¡æ—¥å¿—è¡¨ï¼‰
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'audit_log') THEN
            BEGIN
                INSERT INTO audit_log (username, operation, new_values, event_time)
                VALUES (current_user, 'GDPR_DELETE', jsonb_build_object('user_id', user_id), NOW());
            EXCEPTION
                WHEN OTHERS THEN
                    RAISE WARNING 'è®°å½•å®¡è®¡æ—¥å¿—å¤±è´¥: %', SQLERRM;
            END;
        END IF;
    EXCEPTION
        WHEN undefined_table THEN
            RAISE EXCEPTION 'è¡¨ users æˆ– orders ä¸å­˜åœ¨';
        WHEN foreign_key_violation THEN
            RAISE EXCEPTION 'å­˜åœ¨å¤–é”®çº¦æŸï¼Œæ— æ³•åˆ é™¤ç”¨æˆ·æ•°æ®';
        WHEN OTHERS THEN
            RAISE;
    END;
END;
$$ LANGUAGE plpgsql;
```

### 4.2 HIPAAåˆè§„

```sql
-- å¥åº·ä¿¡æ¯è®¿é—®æ§åˆ¶ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'patient_records') THEN
            RAISE WARNING 'è¡¨ patient_records ä¸å­˜åœ¨';
            RETURN;
        END IF;

        -- å¯ç”¨RLS
        ALTER TABLE patient_records ENABLE ROW LEVEL SECURITY;

        IF EXISTS (SELECT 1 FROM pg_policies WHERE schemaname = 'public' AND tablename = 'patient_records' AND policyname = 'hipaa_access') THEN
            DROP POLICY hipaa_access ON patient_records;
            RAISE NOTICE 'å·²åˆ é™¤ç°æœ‰ç­–ç•¥ hipaa_access';
        END IF;

        CREATE POLICY hipaa_access ON patient_records
            FOR ALL
            USING (
                current_user IN (
                    SELECT employee_id
                    FROM authorized_healthcare_providers
                    WHERE department = 'authorized'
                )
            );
        RAISE NOTICE 'HIPAAè®¿é—®æ§åˆ¶ç­–ç•¥ hipaa_access åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN undefined_table THEN
            RAISE WARNING 'è¡¨ patient_records æˆ– authorized_healthcare_providers ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºHIPAAè®¿é—®æ§åˆ¶ç­–ç•¥å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- å®¡è®¡å¥åº·ä¿¡æ¯è®¿é—®ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'patient_records') THEN
            RAISE WARNING 'è¡¨ patient_records ä¸å­˜åœ¨';
            RETURN;
        END IF;

        IF NOT EXISTS (SELECT 1 FROM pg_proc WHERE proname = 'audit_trigger_func') THEN
            RAISE WARNING 'å‡½æ•° audit_trigger_func ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºè§¦å‘å™¨';
            RETURN;
        END IF;

        IF EXISTS (SELECT 1 FROM pg_trigger WHERE tgname = 'hipaa_audit_trigger') THEN
            DROP TRIGGER hipaa_audit_trigger ON patient_records;
            RAISE NOTICE 'å·²åˆ é™¤ç°æœ‰è§¦å‘å™¨ hipaa_audit_trigger';
        END IF;

        CREATE TRIGGER hipaa_audit_trigger
        AFTER INSERT OR UPDATE OR DELETE ON patient_records
        FOR EACH ROW EXECUTE FUNCTION audit_trigger_func();
        RAISE NOTICE 'HIPAAå®¡è®¡è§¦å‘å™¨ hipaa_audit_trigger åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN undefined_table THEN
            RAISE WARNING 'è¡¨ patient_records ä¸å­˜åœ¨';
        WHEN undefined_function THEN
            RAISE WARNING 'å‡½æ•° audit_trigger_func ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºHIPAAå®¡è®¡è§¦å‘å™¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

### 4.3 SOC2åˆè§„

```sql
-- è®¿é—®æ§åˆ¶å®¡è®¡ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
DECLARE
    access_count INT;
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'audit_log') THEN
            RAISE WARNING 'è¡¨ audit_log ä¸å­˜åœ¨ï¼Œæ— æ³•è¿›è¡Œè®¿é—®æ§åˆ¶å®¡è®¡';
            RETURN;
        END IF;

        SELECT COUNT(*) INTO access_count
        FROM audit_log
        WHERE event_time >= NOW() - INTERVAL '90 days';

        RAISE NOTICE 'æ‰¾åˆ° % æ¡è®¿é—®è®°å½•ï¼ˆæœ€è¿‘90å¤©ï¼‰', access_count;
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'è®¿é—®æ§åˆ¶å®¡è®¡å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

EXPLAIN ANALYZE
SELECT
    username,
    COUNT(*) as access_count,
    MIN(event_time) as first_access,
    MAX(event_time) as last_access
FROM audit_log
WHERE event_time >= NOW() - INTERVAL '90 days'
GROUP BY username
ORDER BY access_count DESC;

-- å˜æ›´ç®¡ç†å®¡è®¡ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
DECLARE
    change_count INT;
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'audit_log') THEN
            RAISE WARNING 'è¡¨ audit_log ä¸å­˜åœ¨ï¼Œæ— æ³•è¿›è¡Œå˜æ›´ç®¡ç†å®¡è®¡';
            RETURN;
        END IF;

        SELECT COUNT(*) INTO change_count
        FROM audit_log
        WHERE operation IN ('INSERT', 'UPDATE', 'DELETE')
        AND event_time >= NOW() - INTERVAL '30 days';

        RAISE NOTICE 'æ‰¾åˆ° % æ¡å˜æ›´è®°å½•ï¼ˆæœ€è¿‘30å¤©ï¼‰', change_count;
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å˜æ›´ç®¡ç†å®¡è®¡å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

EXPLAIN ANALYZE
SELECT
    table_name,
    operation,
    COUNT(*) as change_count
FROM audit_log
WHERE operation IN ('INSERT', 'UPDATE', 'DELETE')
AND event_time >= NOW() - INTERVAL '30 days'
GROUP BY table_name, operation
ORDER BY change_count DESC;
```

---

## 5. æ•°æ®ä¸»æƒç®¡ç†

### 5.1 æ•°æ®æœ¬åœ°åŒ–

```sql
-- æŒ‰åœ°åŒºåˆ›å»ºè¡¨ç©ºé—´ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = current_user AND rolsuper = true) THEN
            RAISE EXCEPTION 'éœ€è¦è¶…çº§ç”¨æˆ·æƒé™æ¥åˆ›å»ºè¡¨ç©ºé—´';
        END IF;

        IF NOT EXISTS (SELECT 1 FROM pg_tablespace WHERE spcname = 'eu_tablespace') THEN
            CREATE TABLESPACE eu_tablespace LOCATION '/data/eu';
            RAISE NOTICE 'è¡¨ç©ºé—´ eu_tablespace åˆ›å»ºæˆåŠŸ';
        ELSE
            RAISE NOTICE 'è¡¨ç©ºé—´ eu_tablespace å·²å­˜åœ¨';
        END IF;
    EXCEPTION
        WHEN duplicate_object THEN
            RAISE WARNING 'è¡¨ç©ºé—´ eu_tablespace å·²å­˜åœ¨';
        WHEN insufficient_privilege THEN
            RAISE WARNING 'æƒé™ä¸è¶³ï¼Œæ— æ³•åˆ›å»ºè¡¨ç©ºé—´';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨ç©ºé—´ eu_tablespace å¤±è´¥: %', SQLERRM;
            RAISE;
    END;

    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_tablespace WHERE spcname = 'us_tablespace') THEN
            CREATE TABLESPACE us_tablespace LOCATION '/data/us';
            RAISE NOTICE 'è¡¨ç©ºé—´ us_tablespace åˆ›å»ºæˆåŠŸ';
        ELSE
            RAISE NOTICE 'è¡¨ç©ºé—´ us_tablespace å·²å­˜åœ¨';
        END IF;
    EXCEPTION
        WHEN duplicate_object THEN
            RAISE WARNING 'è¡¨ç©ºé—´ us_tablespace å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨ç©ºé—´ us_tablespace å¤±è´¥: %', SQLERRM;
            RAISE;
    END;

    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_tablespace WHERE spcname = 'asia_tablespace') THEN
            CREATE TABLESPACE asia_tablespace LOCATION '/data/asia';
            RAISE NOTICE 'è¡¨ç©ºé—´ asia_tablespace åˆ›å»ºæˆåŠŸ';
        ELSE
            RAISE NOTICE 'è¡¨ç©ºé—´ asia_tablespace å·²å­˜åœ¨';
        END IF;
    EXCEPTION
        WHEN duplicate_object THEN
            RAISE WARNING 'è¡¨ç©ºé—´ asia_tablespace å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨ç©ºé—´ asia_tablespace å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- æŒ‰åœ°åŒºå­˜å‚¨æ•°æ®ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_tablespace WHERE spcname = 'eu_tablespace') THEN
            RAISE WARNING 'è¡¨ç©ºé—´ eu_tablespace ä¸å­˜åœ¨';
            RETURN;
        END IF;

        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'eu_users') THEN
            RAISE WARNING 'è¡¨ eu_users å·²å­˜åœ¨';
        ELSE
            CREATE TABLE eu_users (
                id SERIAL PRIMARY KEY,
                username TEXT,
                email TEXT
            ) TABLESPACE eu_tablespace;
            RAISE NOTICE 'è¡¨ eu_users åˆ›å»ºæˆåŠŸ';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ eu_users å·²å­˜åœ¨';
        WHEN undefined_object THEN
            RAISE WARNING 'è¡¨ç©ºé—´ eu_tablespace ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨ eu_users å¤±è´¥: %', SQLERRM;
            RAISE;
    END;

    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_tablespace WHERE spcname = 'us_tablespace') THEN
            RAISE WARNING 'è¡¨ç©ºé—´ us_tablespace ä¸å­˜åœ¨';
            RETURN;
        END IF;

        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'us_users') THEN
            RAISE WARNING 'è¡¨ us_users å·²å­˜åœ¨';
        ELSE
            CREATE TABLE us_users (
                id SERIAL PRIMARY KEY,
                username TEXT,
                email TEXT
            ) TABLESPACE us_tablespace;
            RAISE NOTICE 'è¡¨ us_users åˆ›å»ºæˆåŠŸ';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ us_users å·²å­˜åœ¨';
        WHEN undefined_object THEN
            RAISE WARNING 'è¡¨ç©ºé—´ us_tablespace ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨ us_users å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

### 5.2 è·¨å¢ƒæ•°æ®ä¼ è¾“æ§åˆ¶

```sql
-- æ•°æ®å¯¼å‡ºæ§åˆ¶ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
CREATE OR REPLACE FUNCTION export_data_with_consent(
    table_name TEXT,
    region TEXT,
    consent_given BOOLEAN
)
RETURNS TABLE (data JSONB) AS $$
DECLARE
    v_current_region TEXT;
BEGIN
    BEGIN
        -- å‚æ•°éªŒè¯
        IF table_name IS NULL OR region IS NULL THEN
            RAISE EXCEPTION 'å‚æ•°ä¸èƒ½ä¸ºNULL';
        END IF;

        IF consent_given IS NULL THEN
            RAISE EXCEPTION 'consent_given ä¸èƒ½ä¸ºNULL';
        END IF;

        IF NOT consent_given THEN
            RAISE EXCEPTION 'Data export requires explicit consent';
        END IF;

        -- è·å–å½“å‰åŒºåŸŸè®¾ç½®
        BEGIN
            v_current_region := current_setting('app.data_region', true);
        EXCEPTION
            WHEN undefined_object THEN
                RAISE WARNING 'è®¾ç½® app.data_region ä¸å­˜åœ¨ï¼Œè·³è¿‡åŒºåŸŸæ£€æŸ¥';
                v_current_region := NULL;
        END;

        IF v_current_region IS NOT NULL AND region != v_current_region THEN
            RAISE EXCEPTION 'Cross-region data transfer not allowed: requested region % but current region is %', region, v_current_region;
        END IF;

        -- æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = export_data_with_consent.table_name) THEN
            RAISE EXCEPTION 'è¡¨ % ä¸å­˜åœ¨', table_name;
        END IF;

        RETURN QUERY
        EXECUTE format('SELECT to_jsonb(t.*) FROM %I t', table_name);
    EXCEPTION
        WHEN undefined_table THEN
            RAISE EXCEPTION 'è¡¨ % ä¸å­˜åœ¨', table_name;
        WHEN OTHERS THEN
            RAISE;
    END;
END;
$$ LANGUAGE plpgsql;
```

---

## 6. å®‰å…¨äº‹ä»¶å“åº”

### 6.1 å¨èƒæ£€æµ‹

```sql
-- å¼‚å¸¸ç™»å½•æ£€æµ‹ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
DECLARE
    suspicious_count INT;
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'audit_log') THEN
            RAISE WARNING 'è¡¨ audit_log ä¸å­˜åœ¨ï¼Œæ— æ³•è¿›è¡Œå¼‚å¸¸ç™»å½•æ£€æµ‹';
            RETURN;
        END IF;

        SELECT COUNT(*) INTO suspicious_count
        FROM (
            SELECT username, ip_address
            FROM audit_log
            WHERE operation = 'LOGIN'
            AND event_time >= NOW() - INTERVAL '1 hour'
            GROUP BY username, ip_address
            HAVING COUNT(*) > 5
        ) suspicious_logins;

        IF suspicious_count > 0 THEN
            RAISE WARNING 'å‘ç° % ä¸ªå¯ç–‘ç™»å½•æ´»åŠ¨', suspicious_count;
        ELSE
            RAISE NOTICE 'æœªå‘ç°å¼‚å¸¸ç™»å½•æ´»åŠ¨';
        END IF;
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¼‚å¸¸ç™»å½•æ£€æµ‹å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

EXPLAIN ANALYZE
SELECT
    username,
    ip_address,
    COUNT(*) as login_attempts,
    MIN(event_time) as first_attempt,
    MAX(event_time) as last_attempt
FROM audit_log
WHERE operation = 'LOGIN'
AND event_time >= NOW() - INTERVAL '1 hour'
GROUP BY username, ip_address
HAVING COUNT(*) > 5;  -- è¶…è¿‡5æ¬¡ç™»å½•å°è¯•

-- å¼‚å¸¸æŸ¥è¯¢æ£€æµ‹ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
DECLARE
    pg_stat_available BOOLEAN;
BEGIN
    BEGIN
        SELECT EXISTS (SELECT 1 FROM pg_extension WHERE extname = 'pg_stat_statements') INTO pg_stat_available;

        IF NOT pg_stat_available THEN
            RAISE WARNING 'pg_stat_statements æ‰©å±•æœªå®‰è£…ï¼Œæ— æ³•è¿›è¡Œå¼‚å¸¸æŸ¥è¯¢æ£€æµ‹';
            RETURN;
        END IF;

        RAISE NOTICE 'å¼€å§‹å¼‚å¸¸æŸ¥è¯¢æ£€æµ‹';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¼‚å¸¸æŸ¥è¯¢æ£€æµ‹å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

EXPLAIN ANALYZE
SELECT
    username,
    LEFT(query, 100) as query_preview,
    COUNT(*) as query_count
FROM pg_stat_statements
WHERE calls > 1000
AND mean_exec_time > 1000
GROUP BY username, query
ORDER BY query_count DESC
LIMIT 100;
```

### 6.2 å®‰å…¨äº‹ä»¶å“åº”æµç¨‹

```sql
-- åˆ›å»ºå®‰å…¨äº‹ä»¶è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'security_incidents') THEN
            RAISE WARNING 'è¡¨ security_incidents å·²å­˜åœ¨';
        ELSE
            CREATE TABLE security_incidents (
                id SERIAL PRIMARY KEY,
                incident_time TIMESTAMPTZ DEFAULT NOW(),
                incident_type TEXT,
                severity TEXT,
                description TEXT,
                username TEXT,
                ip_address INET,
                status TEXT DEFAULT 'open',
                resolution TEXT
            );
            RAISE NOTICE 'è¡¨ security_incidents åˆ›å»ºæˆåŠŸ';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ security_incidents å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨ security_incidents å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- è‡ªåŠ¨è®°å½•å®‰å…¨äº‹ä»¶ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
CREATE OR REPLACE FUNCTION log_security_incident(
    p_type TEXT,
    p_severity TEXT,
    p_description TEXT
)
RETURNS void AS $$
DECLARE
    v_ip_address INET;
BEGIN
    BEGIN
        -- å‚æ•°éªŒè¯
        IF p_type IS NULL OR p_severity IS NULL OR p_description IS NULL THEN
            RAISE EXCEPTION 'å¿…éœ€å‚æ•°ä¸èƒ½ä¸ºNULL';
        END IF;

        -- æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'security_incidents') THEN
            RAISE EXCEPTION 'è¡¨ security_incidents ä¸å­˜åœ¨';
        END IF;

        -- è·å–å®¢æˆ·ç«¯IPåœ°å€ï¼ˆå¦‚æœå¯ç”¨ï¼‰
        BEGIN
            SELECT inet_client_addr() INTO v_ip_address;
        EXCEPTION
            WHEN OTHERS THEN
                v_ip_address := NULL;
        END;

        INSERT INTO security_incidents (
            incident_type,
            severity,
            description,
            username,
            ip_address
        )
        VALUES (
            p_type,
            p_severity,
            p_description,
            current_user,
            v_ip_address
        );

        RAISE NOTICE 'å®‰å…¨äº‹ä»¶å·²è®°å½•: type=%, severity=%', p_type, p_severity;
    EXCEPTION
        WHEN undefined_table THEN
            RAISE EXCEPTION 'è¡¨ security_incidents ä¸å­˜åœ¨';
        WHEN NOT_NULL_VIOLATION THEN
            RAISE EXCEPTION 'å¿…éœ€å­—æ®µä¸èƒ½ä¸ºNULL';
        WHEN OTHERS THEN
            RAISE;
    END;
END;
$$ LANGUAGE plpgsql;
```

---

## 7. æœ€ä½³å®è·µ

### 7.1 å®‰å…¨ç­–ç•¥

- âœ… **æœ€å°æƒé™åŸåˆ™**: åªæˆäºˆå¿…è¦çš„æƒé™
- âœ… **æ·±åº¦é˜²å¾¡**: å¤šå±‚å®‰å…¨é˜²æŠ¤
- âœ… **å®šæœŸå®¡è®¡**: å®šæœŸå®¡æŸ¥å®‰å…¨é…ç½®
- âœ… **æŒç»­ç›‘æ§**: 24/7å®‰å…¨ç›‘æ§

### 7.2 åˆè§„æ€§ç®¡ç†

- âœ… **æ˜ç¡®åˆè§„è¦æ±‚**: äº†è§£é€‚ç”¨çš„åˆè§„æ ‡å‡†
- âœ… **å®æ–½åˆè§„æªæ–½**: å®æ–½å¿…è¦çš„æŠ€æœ¯æªæ–½
- âœ… **å®šæœŸåˆè§„å®¡è®¡**: å®šæœŸè¿›è¡Œåˆè§„æ€§æ£€æŸ¥
- âœ… **æ–‡æ¡£åŒ–**: å®Œæ•´è®°å½•åˆè§„æªæ–½

### 7.3 æ•°æ®ä¿æŠ¤

- âœ… **æ•°æ®åŠ å¯†**: æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
- âœ… **æ•°æ®è„±æ•**: éç”Ÿäº§ç¯å¢ƒä½¿ç”¨è„±æ•æ•°æ®
- âœ… **æ•°æ®å¤‡ä»½**: å®šæœŸå¤‡ä»½åŠ å¯†æ•°æ®
- âœ… **æ•°æ®é”€æ¯**: å®‰å…¨çš„æ•°æ®é”€æ¯æµç¨‹

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [05-å®‰å…¨ä¸åˆè§„/å®‰å…¨åŠ å›º](../05-å®‰å…¨ä¸åˆè§„/å®‰å…¨åŠ å›º/PostgreSQLå®‰å…¨åŠ å›ºå®Œæ•´æŒ‡å—.md) - åŸºç¡€å®‰å…¨åŠ å›º
- [åˆè§„æ€§ç®¡ç†](./åˆè§„æ€§ç®¡ç†.md) - åˆè§„æ€§ç®¡ç†è¯¦ç»†æŒ‡å—
- [æ•°æ®ä¸»æƒç®¡ç†](./æ•°æ®ä¸»æƒç®¡ç†.md) - æ•°æ®ä¸»æƒç®¡ç†
- [å¤šç§Ÿæˆ·æ¶æ„å®Œæ•´æŒ‡å—](./å¤šç§Ÿæˆ·æ¶æ„å®Œæ•´æŒ‡å—.md) - å¤šç§Ÿæˆ·å®‰å…¨

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**çŠ¶æ€**: âœ… å®Œæˆ
