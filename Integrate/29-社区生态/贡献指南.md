# PostgreSQL贡献指南

> **创建日期**: 2025年1月
> **技术版本**: PostgreSQL 通用
> **难度等级**: ⭐⭐ 初级

---

## 📋 目录

- [PostgreSQL贡献指南](#postgresql贡献指南)
  - [📋 目录](#-目录)
  - [1. 概述](#1-概述)
  - [2. 贡献方式](#2-贡献方式)
    - [2.1 代码贡献](#21-代码贡献)
    - [2.2 文档贡献](#22-文档贡献)
  - [3. 代码贡献](#3-代码贡献)
    - [3.1 贡献流程](#31-贡献流程)
    - [3.2 代码规范](#32-代码规范)
  - [4. 文档贡献](#4-文档贡献)
    - [4.1 文档类型](#41-文档类型)
    - [4.2 贡献流程](#42-贡献流程)
  - [5. 社区支持](#5-社区支持)
    - [5.1 支持方式](#51-支持方式)
    - [5.2 参与渠道](#52-参与渠道)
  - [6. 贡献奖励与认可](#6-贡献奖励与认可)
    - [6.1 贡献认可](#61-贡献认可)
    - [6.2 贡献路径](#62-贡献路径)
  - [7. 贡献最佳实践](#7-贡献最佳实践)
    - [✅ 推荐做法](#-推荐做法)
    - [⚠️ 注意事项](#️-注意事项)
  - [📚 相关文档](#-相关文档)

---

## 1. 概述

PostgreSQL欢迎社区贡献，有多种贡献方式。

**贡献类型**:

- 代码贡献
- 文档贡献
- 社区支持
- 资金支持

---

## 2. 贡献方式

### 2.1 代码贡献

**代码贡献完整流程**：

```text
PostgreSQL代码贡献流程
├── 阶段1：准备工作
│   ├── 1.1 Fork项目
│   │   ├── 访问：https://github.com/postgres/postgres
│   │   ├── 点击Fork按钮
│   │   └── 克隆到本地
│   ├── 1.2 配置开发环境
│   │   ├── 安装PostgreSQL开发依赖
│   │   ├── 配置编译环境
│   │   └── 运行测试套件
│   └── 1.3 了解代码规范
│       ├── 阅读代码风格指南
│       ├── 查看现有代码示例
│       └── 了解测试要求
├── 阶段2：开发工作
│   ├── 2.1 创建功能分支
│   │   ├── git checkout -b feature/my-feature
│   │   └── 分支命名规范：feature/、bugfix/、hotfix/
│   ├── 2.2 编写代码
│   │   ├── 实现功能或修复Bug
│   │   ├── 遵循代码规范
│   │   └── 编写测试用例
│   └── 2.3 本地测试
│       ├── 运行单元测试
│       ├── 运行回归测试
│       └── 验证功能正确性
├── 阶段3：提交代码
│   ├── 3.1 提交代码
│   │   ├── git add .
│   │   ├── git commit -m "描述性提交信息"
│   │   └── git push origin feature/my-feature
│   ├── 3.2 创建Pull Request
│   │   ├── 在GitHub上创建PR
│   │   ├── 填写PR描述
│   │   └── 关联相关Issue
│   └── 3.3 等待审查
│       ├── 代码审查
│       ├── 测试验证
│       └── 反馈修改
└── 阶段4：代码合并
    ├── 4.1 根据反馈修改
    ├── 4.2 重新提交
    └── 4.3 代码合并
```

**代码贡献详细步骤**：

```bash
#!/bin/bash
# PostgreSQL代码贡献准备脚本（带错误处理）

set -euo pipefail

# 1. Fork项目（手动操作）
echo "1. 请在GitHub上Fork项目: https://github.com/postgres/postgres"
echo "   点击Fork按钮，将项目Fork到你的账户"

# 2. 克隆项目
REPO_URL="https://github.com/YOUR_USERNAME/postgres.git"
LOCAL_DIR="postgres"

if [ ! -d "$LOCAL_DIR" ]; then
    echo "2. 克隆项目到本地..."
    git clone "$REPO_URL" "$LOCAL_DIR"
    cd "$LOCAL_DIR"
else
    echo "2. 项目已存在，更新代码..."
    cd "$LOCAL_DIR"
    git pull origin master
fi

# 3. 配置远程仓库
echo "3. 配置远程仓库..."
git remote add upstream https://github.com/postgres/postgres.git || true
git remote set-url --push upstream no_push || true

# 4. 创建功能分支
BRANCH_NAME="feature/my-feature"
echo "4. 创建功能分支: $BRANCH_NAME"
git checkout -b "$BRANCH_NAME" || git checkout "$BRANCH_NAME"

# 5. 配置开发环境
echo "5. 配置开发环境..."
echo "   请确保已安装以下依赖："
echo "   - PostgreSQL开发库"
echo "   - 编译工具（gcc, make等）"
echo "   - 测试工具"

# 6. 运行测试
echo "6. 运行测试套件..."
echo "   make check  # 运行基本测试"
echo "   make installcheck  # 运行安装测试"

echo "代码贡献环境准备完成！"
```

### 2.2 文档贡献

**文档贡献完整流程**：

```text
PostgreSQL文档贡献流程
├── 阶段1：发现问题
│   ├── 1.1 发现文档问题
│   │   ├── 错误信息
│   │   ├── 过时信息
│   │   ├── 缺失信息
│   │   └── 翻译问题
│   ├── 1.2 记录问题
│   │   ├── 记录问题位置
│   │   ├── 记录问题描述
│   │   └── 记录建议修复
│   └── 1.3 提交Issue（可选）
│       ├── 在GitHub上提交Issue
│       ├── 描述问题
│       └── 等待确认
├── 阶段2：修复文档
│   ├── 2.1 Fork文档仓库
│   │   ├── 访问文档仓库
│   │   ├── Fork到本地
│   │   └── 克隆到本地
│   ├── 2.2 修改文档
│   │   ├── 修复错误
│   │   ├── 更新信息
│   │   ├── 添加内容
│   │   └── 翻译文档
│   └── 2.3 本地验证
│       ├── 检查格式
│       ├── 检查链接
│       └── 检查内容
├── 阶段3：提交修复
│   ├── 3.1 提交修改
│   │   ├── git add .
│   │   ├── git commit -m "修复文档问题"
│   │   └── git push origin doc-fix
│   ├── 3.2 创建Pull Request
│   │   ├── 在GitHub上创建PR
│   │   ├── 描述修复内容
│   │   └── 关联相关Issue
│   └── 3.3 等待审查
│       ├── 文档审查
│       ├── 格式检查
│       └── 内容验证
└── 阶段4：文档合并
    ├── 4.1 根据反馈修改
    ├── 4.2 重新提交
    └── 4.3 文档合并
```

---

## 3. 代码贡献

### 3.1 贡献流程

**详细代码贡献流程**：

```bash
#!/bin/bash
# PostgreSQL代码贡献完整流程（带错误处理）

set -euo pipefail

# 配置
YOUR_USERNAME="your_username"
FEATURE_NAME="my-feature"
BRANCH_NAME="feature/$FEATURE_NAME"

# 1. Fork项目（手动操作）
echo "=== 步骤1: Fork项目 ==="
echo "请在GitHub上Fork项目: https://github.com/postgres/postgres"
echo "然后按Enter继续..."
read

# 2. 克隆项目
echo "=== 步骤2: 克隆项目 ==="
REPO_URL="https://github.com/$YOUR_USERNAME/postgres.git"
LOCAL_DIR="postgres"

if [ ! -d "$LOCAL_DIR" ]; then
    echo "克隆项目..."
    git clone "$REPO_URL" "$LOCAL_DIR"
    cd "$LOCAL_DIR"
else
    echo "项目已存在，更新代码..."
    cd "$LOCAL_DIR"
    git checkout master
    git pull origin master
fi

# 3. 配置远程仓库
echo "=== 步骤3: 配置远程仓库 ==="
git remote add upstream https://github.com/postgres/postgres.git 2>/dev/null || true
git remote set-url --push upstream no_push || true

# 4. 创建功能分支
echo "=== 步骤4: 创建功能分支 ==="
git checkout -b "$BRANCH_NAME" || git checkout "$BRANCH_NAME"
echo "已创建/切换到分支: $BRANCH_NAME"

# 5. 编写代码提示
echo "=== 步骤5: 编写代码 ==="
echo "请在编辑器中编写代码，然后运行以下命令提交："
echo "  git add ."
echo "  git commit -m \"描述性提交信息\""
echo "  git push origin $BRANCH_NAME"
echo ""
echo "代码编写完成后，按Enter继续..."
read

# 6. 检查代码
echo "=== 步骤6: 检查代码 ==="
echo "运行代码检查..."
echo "  make check  # 运行基本测试"
echo "  make installcheck  # 运行安装测试"

# 7. 提交代码
echo "=== 步骤7: 提交代码 ==="
echo "如果代码检查通过，运行以下命令提交："
echo "  git add ."
echo "  git commit -m \"Add $FEATURE_NAME\""
echo "  git push origin $BRANCH_NAME"

# 8. 创建Pull Request
echo "=== 步骤8: 创建Pull Request ==="
echo "请在GitHub上创建Pull Request:"
echo "  https://github.com/$YOUR_USERNAME/postgres/compare/$BRANCH_NAME"
echo ""
echo "代码贡献流程完成！"
```

### 3.2 代码规范

**PostgreSQL代码规范详解**：

```text
PostgreSQL代码规范
├── 代码风格
│   ├── 缩进：使用Tab（8个空格）
│   ├── 行长度：不超过80字符（注释可到100字符）
│   ├── 命名规范：
│   │   ├── 函数名：小写+下划线（snake_case）
│   │   ├── 变量名：小写+下划线
│   │   ├── 常量名：大写+下划线
│   │   └── 类型名：PascalCase
│   └── 注释规范：
│       ├── 函数注释：说明功能、参数、返回值
│       ├── 复杂逻辑注释：说明算法和实现
│       └── TODO注释：标记待完成工作
├── 测试要求
│   ├── 单元测试：为新功能编写单元测试
│   ├── 回归测试：添加到回归测试套件
│   ├── 测试覆盖：确保关键路径有测试
│   └── 测试通过：所有测试必须通过
├── 文档要求
│   ├── 代码注释：关键函数和复杂逻辑需要注释
│   ├── 用户文档：新功能需要更新用户文档
│   ├── 开发者文档：需要更新开发者文档
│   └── 变更日志：需要更新变更日志
└── 审查要求
    ├── 代码审查：需要通过代码审查
    ├── 测试审查：需要通过测试审查
    ├── 文档审查：需要通过文档审查
    └── 性能审查：需要性能测试（如适用）
```

**代码规范检查工具**：

```bash
#!/bin/bash
# PostgreSQL代码规范检查脚本（带错误处理）

set -euo pipefail

# 检查代码风格
check_code_style() {
    echo "检查代码风格..."
    # 使用pgindent格式化代码
    if command -v pgindent &> /dev/null; then
        echo "运行pgindent检查..."
        # pgindent --check src/
    else
        echo "警告: pgindent未安装，跳过代码风格检查"
    fi
}

# 检查编译
check_compile() {
    echo "检查编译..."
    if [ -f "Makefile" ]; then
        make clean
        make -j$(nproc)
        echo "✓ 编译成功"
    else
        echo "错误: 未找到Makefile"
        return 1
    fi
}

# 运行测试
run_tests() {
    echo "运行测试..."
    if [ -f "Makefile" ]; then
        make check
        echo "✓ 测试通过"
    else
        echo "错误: 未找到Makefile"
        return 1
    fi
}

# 主函数
main() {
    echo "=== PostgreSQL代码规范检查 ==="
    check_code_style
    check_compile
    run_tests
    echo "代码规范检查完成！"
}

main
```

---

## 4. 文档贡献

### 4.1 文档类型

**PostgreSQL文档类型详解**：

| 文档类型 | 说明 | 位置 | 贡献方式 |
| --- | --- | --- | --- |
| **用户手册** | 用户使用文档 | `doc/src/sgml/` | 修复错误、添加示例、更新内容 |
| **管理员指南** | 管理员文档 | `doc/src/sgml/` | 添加管理技巧、更新配置说明 |
| **开发者文档** | 开发者文档 | `doc/src/sgml/` | 添加开发指南、更新API文档 |
| **参考手册** | SQL参考文档 | `doc/src/sgml/ref/` | 更新SQL语法、添加示例 |
| **教程文档** | 教程和示例 | `doc/src/sgml/tutorial/` | 添加教程、更新示例 |
| **中文文档** | 中文翻译文档 | `doc/src/sgml/zh_CN/` | 翻译文档、更新翻译 |

**文档格式**：

- **SGML格式**：PostgreSQL文档使用SGML格式编写
- **DocBook DTD**：使用DocBook DTD定义文档结构
- **编译工具**：使用DocBook工具链编译为HTML/PDF

### 4.2 贡献流程

**文档贡献详细流程**：

```bash
#!/bin/bash
# PostgreSQL文档贡献流程脚本（带错误处理）

set -euo pipefail

# 配置
YOUR_USERNAME="your_username"
DOC_FIX_NAME="doc-fix"
BRANCH_NAME="doc/$DOC_FIX_NAME"

# 1. Fork文档仓库（手动操作）
echo "=== 步骤1: Fork文档仓库 ==="
echo "文档在PostgreSQL主仓库中: https://github.com/postgres/postgres"
echo "请Fork主仓库，然后按Enter继续..."
read

# 2. 克隆项目
echo "=== 步骤2: 克隆项目 ==="
REPO_URL="https://github.com/$YOUR_USERNAME/postgres.git"
LOCAL_DIR="postgres"

if [ ! -d "$LOCAL_DIR" ]; then
    echo "克隆项目..."
    git clone "$REPO_URL" "$LOCAL_DIR"
    cd "$LOCAL_DIR"
else
    echo "项目已存在，更新代码..."
    cd "$LOCAL_DIR"
    git checkout master
    git pull origin master
fi

# 3. 创建文档分支
echo "=== 步骤3: 创建文档分支 ==="
git checkout -b "$BRANCH_NAME" || git checkout "$BRANCH_NAME"
echo "已创建/切换到分支: $BRANCH_NAME"

# 4. 修改文档提示
echo "=== 步骤4: 修改文档 ==="
echo "文档位置: doc/src/sgml/"
echo "请在编辑器中修改文档，然后运行以下命令提交："
echo "  git add doc/src/sgml/"
echo "  git commit -m \"修复文档问题\""
echo "  git push origin $BRANCH_NAME"
echo ""
echo "文档修改完成后，按Enter继续..."
read

# 5. 检查文档格式
echo "=== 步骤5: 检查文档格式 ==="
echo "运行文档格式检查..."
if [ -f "doc/src/sgml/Makefile" ]; then
    cd doc/src/sgml
    make check 2>&1 | head -20
    cd ../../..
    echo "文档格式检查完成"
else
    echo "警告: 未找到文档Makefile，跳过格式检查"
fi

# 6. 提交文档
echo "=== 步骤6: 提交文档 ==="
echo "如果文档检查通过，运行以下命令提交："
echo "  git add doc/src/sgml/"
echo "  git commit -m \"修复文档: 描述修复内容\""
echo "  git push origin $BRANCH_NAME"

# 7. 创建Pull Request
echo "=== 步骤7: 创建Pull Request ==="
echo "请在GitHub上创建Pull Request:"
echo "  https://github.com/$YOUR_USERNAME/postgres/compare/$BRANCH_NAME"
echo ""
echo "文档贡献流程完成！"
```

**文档贡献最佳实践**：

1. **仔细检查** - 修改前仔细阅读相关文档
2. **保持风格** - 遵循现有文档风格和格式
3. **测试链接** - 确保所有链接有效
4. **更新索引** - 如果添加新章节，更新文档索引
5. **多语言支持** - 如果修改英文文档，考虑更新翻译

---

## 5. 社区支持

### 5.1 支持方式

**社区支持详细方式**：

1. **回答问题**
   - **邮件列表**：在<pgsql-general@postgresql.org>回答问题
   - **IRC频道**：在#postgresql频道回答问题
   - **Stack Overflow**：在PostgreSQL标签下回答问题
   - **支持原则**：
     - 提供准确、详细的答案
     - 引用官方文档
     - 提供代码示例
     - 耐心帮助初学者

2. **报告Bug**
   - **GitHub Issues**：在GitHub上提交Bug报告
   - **邮件列表**：在<pgsql-bugs@postgresql.org>报告Bug
   - **Bug报告要求**：
     - 详细描述问题
     - 提供复现步骤
     - 提供环境信息（PostgreSQL版本、操作系统等）
     - 提供错误日志
     - 提供最小复现示例

3. **分享经验**
   - **博客文章**：撰写PostgreSQL相关博客
   - **技术分享**：在会议和活动中分享经验
   - **案例研究**：分享实际应用案例
   - **最佳实践**：分享使用最佳实践

4. **翻译文档**
   - **中文翻译**：参与PostgreSQL中文文档翻译
   - **其他语言**：参与其他语言文档翻译
   - **翻译要求**：
     - 准确翻译技术术语
     - 保持文档格式
     - 及时更新翻译

### 5.2 参与渠道

**详细参与渠道**：

| 渠道 | 地址 | 用途 | 参与方式 |
| --- | --- | --- | --- |
| **邮件列表** | <pgsql-general@postgresql.org> | 一般技术讨论 | 订阅、参与讨论、回答问题 |
| **邮件列表** | <pgsql-hackers@postgresql.org> | 开发讨论 | 参与开发讨论、提交补丁 |
| **邮件列表** | <pgsql-admin@postgresql.org> | 管理问题 | 参与管理讨论、分享经验 |
| **IRC频道** | `#postgresql` | 实时技术支持 | 加入频道、实时交流 |
| **Slack工作区** | PostgreSQL Slack | 社区协作 | 加入工作区、参与讨论 |
| **GitHub** | <https://github.com/postgres/postgres> - PostgreSQL官方代码仓库 | 代码贡献 | Fork、提交PR、报告Issue |
| **Stack Overflow** | PostgreSQL标签 | 问答社区 | 回答问题、提问 |
| **PostgreSQL Wiki** | <https://wiki.postgresql.org/> - PostgreSQL Wiki知识库 | 知识库 | 编辑Wiki、添加内容 |

**参与建议**：

1. **选择合适的渠道** - 根据问题类型选择合适的渠道
2. **遵守社区规范** - 遵守社区行为准则
3. **提供有价值的内容** - 提供准确、有用的信息
4. **尊重他人** - 尊重其他社区成员
5. **持续参与** - 持续参与社区活动，建立信任

---

## 6. 贡献奖励与认可

### 6.1 贡献认可

PostgreSQL社区通过以下方式认可贡献：

1. **代码贡献者列表** - 在PostgreSQL发布说明中列出贡献者
2. **社区感谢** - 在社区会议和活动中感谢贡献者
3. **贡献者徽章** - GitHub贡献者徽章
4. **社区地位** - 通过贡献获得社区认可和信任

### 6.2 贡献路径

**从贡献者到核心成员的路径**：

```text
社区成员
  ↓ (持续贡献)
贡献者
  ├── 代码贡献 → 功能开发者
  ├── 文档贡献 → 文档维护者
  ├── 测试贡献 → 测试人员
  └── 社区支持 → 社区支持者
  ↓ (持续贡献、能力提升)
维护者
  ├── 模块维护 → 模块维护者
  ├── 功能维护 → 功能维护者
  └── 文档维护 → 文档维护者
  ↓ (长期贡献、技术能力)
提交者
  ├── 代码审查 → 补丁审查者
  ├── 代码合并 → 提交者
  └── 版本管理 → 版本管理者
  ↓ (核心贡献、社区认可)
核心团队成员
  ├── 技术决策 → 核心开发者
  ├── 架构设计 → 架构师
  └── 版本发布 → 发布管理者
```

## 7. 贡献最佳实践

### ✅ 推荐做法

1. **从小处开始** - 从简单的问题报告、文档修复开始
2. **持续贡献** - 持续参与社区活动，建立信任
3. **学习成长** - 学习PostgreSQL技术，提升能力
4. **遵守规范** - 遵守代码规范、文档规范、社区规范
5. **接受反馈** - 接受代码审查反馈，持续改进
6. **帮助他人** - 帮助其他贡献者，共同成长

### ⚠️ 注意事项

1. **不要急于求成** - 贡献是一个长期过程，需要耐心
2. **尊重他人** - 尊重其他贡献者和社区成员
3. **保持专业** - 保持专业态度，避免个人攻击
4. **持续学习** - 持续学习PostgreSQL技术，提升能力

## 📚 相关文档

- [PostgreSQL基金会介绍.md](./PostgreSQL基金会介绍.md) - 基金会介绍
- [社区治理结构.md](./社区治理结构.md) - 社区治理结构
- [社区活动与会议.md](./社区活动与会议.md) - 社区活动与会议
- [社区资源导航.md](./社区资源导航.md) - 社区资源导航
- [29-社区生态/README.md](./README.md) - 社区生态主题

---

**最后更新**: 2025年1月
