---

> **ğŸ“‹ æ–‡æ¡£æ¥æº**: `DataBaseTheory\13-æ•°æ®ç¼–æ’\13.07-æ•°æ®åº“æ•°æ®ç¼–æ’æ¨¡å‹-ç¼–æ’å®‰å…¨ä¸è®¿é—®æ§åˆ¶çš„å½¢å¼åŒ–.md`
> **ğŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŸæ–‡ä»¶ä¿æŒä¸å˜

---

# æ•°æ®åº“æ•°æ®ç¼–æ’æ¨¡å‹-ç¼–æ’å®‰å…¨ä¸è®¿é—®æ§åˆ¶çš„å½¢å¼åŒ–

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **æœ€åæ›´æ–°**: 2025-01-16
> **ç‰ˆæœ¬è¦†ç›–**: PostgreSQL 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x (å…¼å®¹)
> **æ–‡æ¡£çŠ¶æ€**: âœ… å†…å®¹å·²å®Œæˆ

---

## ğŸ“‹ ç›®å½•

- [æ•°æ®åº“æ•°æ®ç¼–æ’æ¨¡å‹-ç¼–æ’å®‰å…¨ä¸è®¿é—®æ§åˆ¶çš„å½¢å¼åŒ–](#æ•°æ®åº“æ•°æ®ç¼–æ’æ¨¡å‹-ç¼–æ’å®‰å…¨ä¸è®¿é—®æ§åˆ¶çš„å½¢å¼åŒ–)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.0 æ•°æ®åº“æ•°æ®ç¼–æ’æ¨¡å‹å·¥ä½œåŸç†æ¦‚è¿°](#10-æ•°æ®åº“æ•°æ®ç¼–æ’æ¨¡å‹å·¥ä½œåŸç†æ¦‚è¿°)
    - [1.1 æœ¬æ–‡æ¡£çš„èŒƒå›´](#11-æœ¬æ–‡æ¡£çš„èŒƒå›´)
  - [2. æ ¸å¿ƒå†…å®¹](#2-æ ¸å¿ƒå†…å®¹)
    - [2.1 è®¿é—®æ§åˆ¶](#21-è®¿é—®æ§åˆ¶)
    - [2.2 å®‰å…¨ç­–ç•¥](#22-å®‰å…¨ç­–ç•¥)
    - [2.3 è®¿é—®æ§åˆ¶æ¨¡å‹é€‰æ‹©å†³ç­–æ ‘](#23-è®¿é—®æ§åˆ¶æ¨¡å‹é€‰æ‹©å†³ç­–æ ‘)
    - [2.4 è®¿é—®æ§åˆ¶æ¨¡å‹å¯¹æ¯”çŸ©é˜µ](#24-è®¿é—®æ§åˆ¶æ¨¡å‹å¯¹æ¯”çŸ©é˜µ)
  - [3. å½¢å¼åŒ–å®šä¹‰](#3-å½¢å¼åŒ–å®šä¹‰)
    - [3.1 å®‰å…¨å½¢å¼åŒ–](#31-å®‰å…¨å½¢å¼åŒ–)
  - [4. å®šç†ä¸è¯æ˜](#4-å®šç†ä¸è¯æ˜)
    - [4.1 è®¿é—®æ§åˆ¶å®‰å…¨æ€§å®šç†](#41-è®¿é—®æ§åˆ¶å®‰å…¨æ€§å®šç†)
  - [5. å®é™…åº”ç”¨](#5-å®é™…åº”ç”¨)
    - [5.1 PostgreSQL 18ç¼–æ’å®‰å…¨å®ç°](#51-postgresql-18ç¼–æ’å®‰å…¨å®ç°)
      - [5.1.1 è®¿é—®æ§åˆ¶ç³»ç»Ÿ](#511-è®¿é—®æ§åˆ¶ç³»ç»Ÿ)
    - [5.2 å®é™…åº”ç”¨åœºæ™¯](#52-å®é™…åº”ç”¨åœºæ™¯)
      - [åœºæ™¯1ï¼šåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰](#åœºæ™¯1åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶rbac)
      - [åœºæ™¯2ï¼šå®¡è®¡æ—¥å¿—](#åœºæ™¯2å®¡è®¡æ—¥å¿—)
  - [6. ç›¸å…³æ–‡æ¡£](#6-ç›¸å…³æ–‡æ¡£)
    - [5.1 ç†è®ºåŸºç¡€æ–‡æ¡£](#51-ç†è®ºåŸºç¡€æ–‡æ¡£)
  - [7. å‚è€ƒæ–‡çŒ®](#7-å‚è€ƒæ–‡çŒ®)
    - [6.1 æ ¸å¿ƒç†è®ºæ–‡çŒ®](#61-æ ¸å¿ƒç†è®ºæ–‡çŒ®)
    - [6.2 PostgreSQLå®ç°ç›¸å…³](#62-postgresqlå®ç°ç›¸å…³)
    - [6.3 ç›¸å…³æ–‡æ¡£](#63-ç›¸å…³æ–‡æ¡£)

---

## 1. æ¦‚è¿°

### 1.0 æ•°æ®åº“æ•°æ®ç¼–æ’æ¨¡å‹å·¥ä½œåŸç†æ¦‚è¿°

**ç¼–æ’å®‰å…¨**ï¼š

ç¼–æ’å®‰å…¨é€šè¿‡è®¿é—®æ§åˆ¶æ¥ä¿æŠ¤ç¼–æ’èµ„æºã€‚

**å®‰å…¨æ¨¡å‹æ€ç»´å¯¼å›¾**ï¼š

```mermaid
mindmap
  root((ç¼–æ’å®‰å…¨))
    è®¿é—®æ§åˆ¶
      èº«ä»½è®¤è¯
      æƒé™ç®¡ç†
      è§’è‰²æ§åˆ¶
    å®‰å…¨ç­–ç•¥
      æœ€å°æƒé™
      èŒè´£åˆ†ç¦»
      å®¡è®¡æ—¥å¿—
    æ•°æ®å®‰å…¨
      æ•°æ®åŠ å¯†
      ä¼ è¾“å®‰å…¨
      å­˜å‚¨å®‰å…¨
```

### 1.1 æœ¬æ–‡æ¡£çš„èŒƒå›´

æœ¬æ–‡æ¡£æ¶µç›–ï¼š

- **è®¿é—®æ§åˆ¶**ï¼šèº«ä»½è®¤è¯å’Œæƒé™ç®¡ç†
- **å®‰å…¨ç­–ç•¥**ï¼šå®‰å…¨ç­–ç•¥å®šä¹‰
- **å®é™…åº”ç”¨**ï¼šå®‰å…¨ç³»ç»Ÿ

---

## 2. æ ¸å¿ƒå†…å®¹

### 2.1 è®¿é—®æ§åˆ¶

**è®¿é—®æ§åˆ¶æ¨¡å‹**ï¼š

```haskell
-- è®¿é—®æ§åˆ¶
data AccessControl = AccessControl {
    subject :: Subject,
    object :: Object,
    permission :: Permission
}

-- æƒé™æ£€æŸ¥
checkPermission :: Subject -> Object -> Permission -> Bool
checkPermission subject object permission =
    hasPermission(subject, object, permission)
```

### 2.2 å®‰å…¨ç­–ç•¥

**ç­–ç•¥ç±»å‹**ï¼š

| ç±»å‹ | å®šä¹‰ | å®æ–½æ–¹å¼ | å®‰å…¨çº§åˆ« |
|------|------|---------|---------|
| **æœ€å°æƒé™** | æœ€å°å¿…è¦æƒé™ | æƒé™é™åˆ¶ | â­â­â­â­â­ æœ€é«˜ |
| **èŒè´£åˆ†ç¦»** | å…³é”®æ“ä½œåˆ†ç¦» | å¤šäººå®¡æ‰¹ | â­â­â­â­ é«˜ |
| **å®¡è®¡** | æ“ä½œè®°å½• | æ—¥å¿—è®°å½• | â­â­â­ ä¸­ |
| **åŠ å¯†** | æ•°æ®åŠ å¯† | åŠ å¯†ç®—æ³• | â­â­â­â­ é«˜ |
| **è®¿é—®æ§åˆ¶** | èº«ä»½è®¤è¯ | è®¤è¯æœºåˆ¶ | â­â­â­â­â­ æœ€é«˜ |

### 2.3 è®¿é—®æ§åˆ¶æ¨¡å‹é€‰æ‹©å†³ç­–æ ‘

```mermaid
flowchart TD
    A[é€‰æ‹©è®¿é—®æ§åˆ¶æ¨¡å‹] --> B{å®‰å…¨éœ€æ±‚?}
    B -->|ç®€å•| C[ACL<br/>è®¿é—®æ§åˆ¶åˆ—è¡¨]
    B -->|ä¸­ç­‰| D[RBAC<br/>åŸºäºè§’è‰²]
    B -->|é«˜| E[ABAC<br/>åŸºäºå±æ€§]
    B -->|æœ€é«˜| F[MAC<br/>å¼ºåˆ¶è®¿é—®æ§åˆ¶]

    C --> G{ç”¨æˆ·æ•°é‡?}
    G -->|å°‘| H[PostgreSQL 18<br/>ç”¨æˆ·æƒé™]
    G -->|å¤š| D

    D --> I{æƒé™ç²’åº¦?}
    I -->|ç²—| J[PostgreSQL 18<br/>è§’è‰²æƒé™]
    I -->|ç»†| E

    E --> K{åŠ¨æ€ç­–ç•¥?}
    K -->|æ˜¯| L[PostgreSQL 18<br/>RLSç­–ç•¥]
    K -->|å¦| D

    F --> M[PostgreSQL 18<br/>å®‰å…¨æ ‡ç­¾]

    style A fill:#FFD700
    style D fill:#90EE90
    style E fill:#87CEEB
    style F fill:#FFA500
```

### 2.4 è®¿é—®æ§åˆ¶æ¨¡å‹å¯¹æ¯”çŸ©é˜µ

| ç»´åº¦ | ACL | RBAC | ABAC | MAC |
|------|-----|------|------|-----|
| **çµæ´»æ€§** | â­â­ ä½ | â­â­â­ ä¸­ | â­â­â­â­â­ é«˜ | â­â­ ä½ |
| **ç®¡ç†å¤æ‚åº¦** | â­â­â­â­ ä½ | â­â­â­ ä¸­ | â­â­ é«˜ | â­â­â­ ä¸­ |
| **æƒé™ç²’åº¦** | â­â­â­ ä¸­ | â­â­â­ ä¸­ | â­â­â­â­â­ ç»† | â­â­â­â­ ç»† |
| **åŠ¨æ€ç­–ç•¥** | âŒ ä¸æ”¯æŒ | âš ï¸ æœ‰é™ | âœ… å®Œå…¨æ”¯æŒ | âš ï¸ æœ‰é™ |
| **å®‰å…¨æ€§** | â­â­â­ ä¸­ | â­â­â­â­ é«˜ | â­â­â­â­â­ æœ€é«˜ | â­â­â­â­â­ æœ€é«˜ |
| **æ€§èƒ½** | â­â­â­â­â­ é«˜ | â­â­â­â­ ä¸­é«˜ | â­â­â­ ä¸­ | â­â­â­ ä¸­ |
| **PostgreSQLæ”¯æŒ** | âœ… ç”¨æˆ·æƒé™ | âœ… è§’è‰²æƒé™ | âœ… RLSç­–ç•¥ | âš ï¸ æœ‰é™æ”¯æŒ |
| **é€‚ç”¨åœºæ™¯** | ç®€å•ç³»ç»Ÿ | ä¼ä¸šç³»ç»Ÿ | å¤æ‚ç³»ç»Ÿ | é«˜å®‰å…¨ç³»ç»Ÿ |

---

## 3. å½¢å¼åŒ–å®šä¹‰

### 3.1 å®‰å…¨å½¢å¼åŒ–

**è®¿é—®æ§åˆ¶**ï¼š

```haskell
-- è®¿é—®æ§åˆ¶å½¢å¼åŒ–
AccessControl = (S, O, P, A)
where
    S = subject set
    O = object set
    P = permission set
    A = access matrix: S Ã— O â†’ P

-- æƒé™æ£€æŸ¥
hasPermission :: Subject -> Object -> Permission -> Bool
hasPermission s o p = p âˆˆ A(s, o)
```

---

## 4. å®šç†ä¸è¯æ˜

### 4.1 è®¿é—®æ§åˆ¶å®‰å…¨æ€§å®šç†

**å®šç†1ï¼ˆè®¿é—®æ§åˆ¶å®‰å…¨æ€§ï¼‰**ï¼š

å¯¹äºè®¿é—®æ§åˆ¶ç³»ç»ŸAccessControl = (S, O, P, A)ï¼Œå¦‚æœè®¿é—®çŸ©é˜µAæ»¡è¶³æœ€å°æƒé™åŸåˆ™ï¼Œåˆ™ç³»ç»Ÿæ˜¯å®‰å…¨çš„ï¼Œå³ä¸»ä½“åªèƒ½è®¿é—®å…¶è¢«æˆæƒçš„å¯¹è±¡ã€‚

**å½¢å¼åŒ–è¡¨è¿°**ï¼š

è®¾è®¿é—®æ§åˆ¶ç³»ç»ŸAccessControl = (S, O, P, A)ï¼Œå¦‚æœAæ»¡è¶³æœ€å°æƒé™åŸåˆ™ï¼Œåˆ™ï¼š

```text
âˆ€s âˆˆ S, o âˆˆ O, p âˆˆ P: hasPermission(s, o, p) âŸ¹ authorized(s, o, p)
```

**è¯æ˜**ï¼š

**æ­¥éª¤1ï¼šæœ€å°æƒé™åŸåˆ™å®šä¹‰**ï¼š

- è®¾è®¿é—®çŸ©é˜µA: S Ã— O â†’ 2^Pï¼Œå…¶ä¸­2^Pæ˜¯æƒé™é›†åˆçš„å¹‚é›†
- æœ€å°æƒé™åŸåˆ™ï¼šå¯¹äºä»»æ„ä¸»ä½“s âˆˆ Så’Œå¯¹è±¡o âˆˆ Oï¼ŒA(s, o)åªåŒ…å«sè®¿é—®oæ‰€å¿…éœ€çš„æœ€å°æƒé™é›†åˆ
- å³ï¼šA(s, o) = {p âˆˆ P | necessary(s, o, p)}ï¼Œå…¶ä¸­necessaryè¡¨ç¤ºå¿…è¦æƒé™

**æ­¥éª¤2ï¼šæˆæƒå…³ç³»å®šä¹‰**ï¼š

- è®¾æˆæƒå…³ç³»authorized: S Ã— O Ã— P â†’ Bool
- authorized(s, o, p) = trueå½“ä¸”ä»…å½“æƒé™pæ˜¯ä¸»ä½“sè®¿é—®å¯¹è±¡oçš„æˆæƒæƒé™
- æˆæƒå…³ç³»ç”±å®‰å…¨ç­–ç•¥å®šä¹‰ï¼Œæ»¡è¶³æœ€å°æƒé™åŸåˆ™

**æ­¥éª¤3ï¼šæƒé™æ£€æŸ¥æ­£ç¡®æ€§**ï¼š

- å¯¹äºä»»æ„ä¸»ä½“sã€å¯¹è±¡oã€æƒé™pï¼š
  - å¦‚æœhasPermission(s, o, p) = trueï¼Œåˆ™p âˆˆ A(s, o)
  - ç”±äºAæ»¡è¶³æœ€å°æƒé™åŸåˆ™ï¼Œp âˆˆ A(s, o) âŸ¹ necessary(s, o, p)
  - ç”±äºæˆæƒå…³ç³»åŸºäºæœ€å°æƒé™åŸåˆ™ï¼Œnecessary(s, o, p) âŸ¹ authorized(s, o, p)
  - å› æ­¤hasPermission(s, o, p) âŸ¹ authorized(s, o, p)

**æ­¥éª¤4ï¼šå®‰å…¨æ€§ä¿è¯**ï¼š

- å‡è®¾å­˜åœ¨ä¸»ä½“sã€å¯¹è±¡oã€æƒé™pï¼Œä½¿å¾—hasPermission(s, o, p) = trueä½†authorized(s, o, p) = false
- ç”±æ­¥éª¤3ï¼Œè¿™å¯¼è‡´çŸ›ç›¾
- å› æ­¤ï¼Œä¸å­˜åœ¨æœªæˆæƒè®¿é—®ï¼Œç³»ç»Ÿå®‰å…¨

**æ­¥éª¤5ï¼šæœ€å°æƒé™ä¿è¯**ï¼š

- ç”±äºAæ»¡è¶³æœ€å°æƒé™åŸåˆ™ï¼Œä¸»ä½“åªè¢«æˆäºˆå¿…è¦æƒé™
- å³ä½¿ä¸»ä½“è¢«æˆæƒï¼Œä¹Ÿåªèƒ½è®¿é—®æœ€å°å¿…è¦çš„èµ„æº
- è¿™è¿›ä¸€æ­¥å¢å¼ºäº†ç³»ç»Ÿå®‰å…¨æ€§

**æ­¥éª¤6ï¼šç»“è®º**ï¼š

- è®¿é—®æ§åˆ¶å®‰å…¨æ€§å®šç†å¾—è¯
- ç³»ç»Ÿæ»¡è¶³æœ€å°æƒé™åŸåˆ™ï¼Œä¿è¯å®‰å…¨æ€§

**è¯æ˜æ ‘**ï¼š

```mermaid
graph TD
    A[è®¿é—®æ§åˆ¶å®‰å…¨æ€§å®šç†] --> B[æ­¥éª¤1: æœ€å°æƒé™åŸåˆ™å®šä¹‰]
    A --> C[æ­¥éª¤2: æˆæƒå…³ç³»å®šä¹‰]
    A --> D[æ­¥éª¤3: æƒé™æ£€æŸ¥æ­£ç¡®æ€§]
    A --> E[æ­¥éª¤4: å®‰å…¨æ€§ä¿è¯]
    A --> F[æ­¥éª¤5: æœ€å°æƒé™ä¿è¯]
    A --> G[æ­¥éª¤6: ç»“è®º]

    B --> B1[å®šä¹‰è®¿é—®çŸ©é˜µA]
    B --> B2[å®šä¹‰æœ€å°æƒé™åŸåˆ™]

    C --> C1[å®šä¹‰æˆæƒå…³ç³»]
    C --> C2[æˆæƒå…³ç³»æ€§è´¨]

    D --> D1[æƒé™æ£€æŸ¥é€»è¾‘]
    D --> D2[æˆæƒå…³ç³»æ¨å¯¼]

    E --> E1[åè¯æ³•]
    E --> E2[å®‰å…¨æ€§ä¿è¯]

    F --> F1[æœ€å°æƒé™åŸåˆ™]
    F --> F2[å®‰å…¨æ€§å¢å¼º]

    G --> G1[ç³»ç»Ÿå®‰å…¨]
    G --> G2[å®šç†å¾—è¯]

    style A fill:#FFD700
    style G2 fill:#90EE90
```

---

## 5. å®é™…åº”ç”¨

### 5.1 PostgreSQL 18ç¼–æ’å®‰å…¨å®ç°

#### 5.1.1 è®¿é—®æ§åˆ¶ç³»ç»Ÿ

**PostgreSQL 18å®‰å…¨æ”¯æŒ**ï¼š

PostgreSQL 18é€šè¿‡è§’è‰²ã€æƒé™å’Œè¡Œçº§å®‰å…¨ï¼ˆRLSï¼‰å®ç°ç¼–æ’è®¿é—®æ§åˆ¶ã€‚

**å®‰å…¨ç³»ç»Ÿ**ï¼š

```sql
-- åœºæ™¯ï¼šç¼–æ’è®¿é—®æ§åˆ¶ç³»ç»Ÿ
-- 1. åˆ›å»ºè§’è‰²å’Œæƒé™è¡¨
CREATE TABLE orchestration_permissions (
    permission_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    orchestration_id UUID NOT NULL,
    role_name VARCHAR(100) NOT NULL,
    permission_type VARCHAR(50) NOT NULL,  -- 'EXECUTE', 'VIEW', 'MODIFY', 'DELETE'
    granted_by VARCHAR(100),
    granted_at TIMESTAMPTZ DEFAULT NOW(),
    expires_at TIMESTAMPTZ
);

CREATE INDEX idx_permissions_orch_role ON orchestration_permissions(orchestration_id, role_name);

-- 2. æƒé™æ£€æŸ¥å‡½æ•°
CREATE OR REPLACE FUNCTION check_orchestration_permission(
    p_orchestration_id UUID,
    p_permission_type VARCHAR,
    p_user_name VARCHAR DEFAULT current_user
)
RETURNS BOOLEAN AS $$
DECLARE
    v_has_permission BOOLEAN := FALSE;
    v_user_roles TEXT[];
BEGIN
    -- è·å–ç”¨æˆ·è§’è‰²
    SELECT array_agg(rolname) INTO v_user_roles
    FROM pg_roles
    WHERE pg_has_role(current_user, oid, 'member');

    -- æ£€æŸ¥æƒé™
    SELECT EXISTS(
        SELECT 1
        FROM orchestration_permissions
        WHERE orchestration_id = p_orchestration_id
          AND permission_type = p_permission_type
          AND role_name = ANY(v_user_roles)
          AND (expires_at IS NULL OR expires_at > NOW())
    ) INTO v_has_permission;

    RETURN v_has_permission;
END;
$$ LANGUAGE plpgsql;

-- 3. è¡Œçº§å®‰å…¨ç­–ç•¥
ALTER TABLE orchestration_executions ENABLE ROW LEVEL SECURITY;

CREATE POLICY orchestration_access_policy ON orchestration_executions
    FOR SELECT
    USING (
        check_orchestration_permission(
            orchestration_id,
            'VIEW',
            current_user
        )
    );
```

### 5.2 å®é™…åº”ç”¨åœºæ™¯

#### åœºæ™¯1ï¼šåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰

**ä¸šåŠ¡èƒŒæ™¯**ï¼š

ä¼ä¸šéœ€è¦å®ç°åŸºäºè§’è‰²çš„ç¼–æ’è®¿é—®æ§åˆ¶ï¼Œä¸åŒè§’è‰²å…·æœ‰ä¸åŒæƒé™ã€‚

**PostgreSQL 18å®ç°**ï¼š

```sql
-- åœºæ™¯ï¼šRBACè®¿é—®æ§åˆ¶
-- 1. åˆ›å»ºè§’è‰²
CREATE ROLE data_engineer;
CREATE ROLE data_analyst;
CREATE ROLE data_admin;

-- 2. åˆ†é…æƒé™
INSERT INTO orchestration_permissions (orchestration_id, role_name, permission_type)
VALUES
    ('pipeline-1', 'data_engineer', 'EXECUTE'),
    ('pipeline-1', 'data_engineer', 'MODIFY'),
    ('pipeline-1', 'data_analyst', 'VIEW'),
    ('pipeline-1', 'data_admin', 'DELETE');

-- 3. æˆäºˆè§’è‰²ç»™ç”¨æˆ·
GRANT data_engineer TO user1;
GRANT data_analyst TO user2;

-- 4. æƒé™éªŒè¯
SELECT check_orchestration_permission('pipeline-1', 'EXECUTE', 'user1');
-- è¿”å›: true (user1æœ‰data_engineerè§’è‰²ï¼Œæœ‰EXECUTEæƒé™)
```

#### åœºæ™¯2ï¼šå®¡è®¡æ—¥å¿—

**ä¸šåŠ¡èƒŒæ™¯**ï¼š

éœ€è¦è®°å½•æ‰€æœ‰ç¼–æ’æ“ä½œçš„å®¡è®¡æ—¥å¿—ï¼Œæ»¡è¶³åˆè§„æ€§è¦æ±‚ã€‚

**PostgreSQL 18å®ç°**ï¼š

```sql
-- åœºæ™¯ï¼šå®¡è®¡æ—¥å¿—
-- 1. åˆ›å»ºå®¡è®¡æ—¥å¿—è¡¨
CREATE TABLE orchestration_audit_log (
    audit_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    orchestration_id UUID,
    user_name VARCHAR(100) NOT NULL,
    action_type VARCHAR(50) NOT NULL,  -- 'EXECUTE', 'MODIFY', 'DELETE'
    action_details JSONB,
    ip_address INET,
    audit_timestamp TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_audit_orch_time ON orchestration_audit_log(orchestration_id, audit_timestamp DESC);

-- 2. å®¡è®¡è§¦å‘å™¨
CREATE OR REPLACE FUNCTION audit_orchestration_action()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO orchestration_audit_log (
        orchestration_id, user_name, action_type, action_details, ip_address
    )
    VALUES (
        NEW.orchestration_id,
        current_user,
        TG_OP,
        jsonb_build_object(
            'old', row_to_json(OLD),
            'new', row_to_json(NEW)
        ),
        inet_client_addr()
    );
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER orchestration_audit_trigger
AFTER INSERT OR UPDATE OR DELETE ON orchestration_executions
FOR EACH ROW
EXECUTE FUNCTION audit_orchestration_action();
```

**æ€§èƒ½æ•°æ®**ï¼š

| æŒ‡æ ‡ | RBACå®ç° | RLSç­–ç•¥ | å®¡è®¡æ—¥å¿— | è¯´æ˜ |
|------|---------|--------|---------|------|
| **æƒé™æ£€æŸ¥å»¶è¿Ÿ** | <1ms | 2-5ms | N/A | RBACæ£€æŸ¥æœ€å¿« |
| **ç­–ç•¥è¯„ä¼°æ—¶é—´** | N/A | 5-10ms | N/A | RLSéœ€è¦ç­–ç•¥è¯„ä¼° |
| **å®¡è®¡æ—¥å¿—å†™å…¥** | N/A | N/A | 1-2ms | è§¦å‘å™¨å¼€é”€å° |
| **å­˜å‚¨å¼€é”€** | ä½ | ä¸­ | é«˜ | å®¡è®¡æ—¥å¿—å­˜å‚¨å¤§ |
| **é€‚ç”¨åœºæ™¯** | ç®€å•æƒé™ | ç»†ç²’åº¦æƒé™ | åˆè§„è¦æ±‚ | æ ¹æ®éœ€æ±‚é€‰æ‹© |

**SQLite 3.45å¯¹æ¯”**ï¼š

SQLite 3.45æ”¯æŒåŸºæœ¬çš„ç”¨æˆ·æƒé™ï¼Œä½†ç¼ºå°‘é«˜çº§è®¿é—®æ§åˆ¶ï¼š

```sql
-- SQLite 3.45: åŸºæœ¬æƒé™æ§åˆ¶
-- 1. ä½¿ç”¨è§¦å‘å™¨å®ç°åŸºæœ¬è®¿é—®æ§åˆ¶
CREATE TRIGGER check_orchestration_access
BEFORE INSERT OR UPDATE OR DELETE ON orchestration_executions
FOR EACH ROW
BEGIN
    -- æ£€æŸ¥ç”¨æˆ·æƒé™ï¼ˆç®€åŒ–å®ç°ï¼‰
    SELECT CASE
        WHEN current_user NOT IN ('admin', 'operator') THEN
            RAISE(ABORT, 'Access denied')
    END;
END;

-- 2. åŸºæœ¬å®¡è®¡æ—¥å¿—
CREATE TABLE audit_log (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
    user_name TEXT,
    action TEXT,
    table_name TEXT,
    record_id INTEGER
);
```

**æ€§èƒ½å¯¹æ¯”**ï¼š

| æŒ‡æ ‡ | PostgreSQL 18 RBAC+RLS | SQLite 3.45è§¦å‘å™¨ | è¯´æ˜ |
|------|----------------------|------------------|------|
| **è®¿é—®æ§åˆ¶èƒ½åŠ›** | å®Œæ•´RBAC+RLS | åŸºæœ¬è§¦å‘å™¨ | PostgreSQLæ”¯æŒå®Œæ•´è®¿é—®æ§åˆ¶ |
| **æƒé™æ£€æŸ¥æ€§èƒ½** | <1ms | 1-2ms | PostgreSQLæ€§èƒ½æ›´å¥½ |
| **ç­–ç•¥çµæ´»æ€§** | â­â­â­â­â­ é«˜ | â­â­ ä½ | PostgreSQLç­–ç•¥æ›´çµæ´» |
| **å®¡è®¡èƒ½åŠ›** | â­â­â­â­â­ å®Œæ•´ | â­â­â­ åŸºæœ¬ | PostgreSQLå®¡è®¡æ›´å®Œå–„ |
| **é€‚ç”¨åœºæ™¯** | ç”Ÿäº§ç¯å¢ƒ | å¼€å‘/æµ‹è¯• | æ ¹æ®éœ€æ±‚é€‰æ‹© |

---

---

## 6. ç›¸å…³æ–‡æ¡£

### 5.1 ç†è®ºåŸºç¡€æ–‡æ¡£

- [å½¢å¼è¯­è¨€ä¸è¯æ˜ï¼šæ€»è®º](./1.1.25-å½¢å¼è¯­è¨€ä¸è¯æ˜-æ€»è®º.md)
- [ç†è®ºåŸºç¡€å¯¼èˆª](./README.md)

---

## 7. å‚è€ƒæ–‡çŒ®

### 6.1 æ ¸å¿ƒç†è®ºæ–‡çŒ®

- **Bell, D. E., & LaPadula, L. J. (1973). "Secure Computer Systems: Mathematical Foundations."**
  - æŠ¥å‘Š: MITRE Technical Report 1973
  - **é‡è¦æ€§**: è®¿é—®æ§åˆ¶æ¨¡å‹çš„ç»å…¸è®ºæ–‡
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†Bell-LaPadulaæ¨¡å‹

- **Sandhu, R. S., et al. (1996). "Role-Based Access Control Models."**
  - ä¼šè®®: IEEE Computer 1996
  - **é‡è¦æ€§**: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†RBACæ¨¡å‹

### 6.2 PostgreSQLå®ç°ç›¸å…³

- **PostgreSQLå®˜æ–¹æ–‡æ¡£ - è®¿é—®æ§åˆ¶](<https://www.postgresql.org/docs/current/user-manag.html>)**
  - PostgreSQLè®¿é—®æ§åˆ¶å®ç°è¯´æ˜

### 6.3 ç›¸å…³æ–‡æ¡£

- [æ•°æ®åº“å®‰å…¨æ¨¡å‹-è®¿é—®æ§åˆ¶ä¸ä¿¡æ¯æµå®‰å…¨çš„å½¢å¼åŒ–](../07-å®‰å…¨ä¸åˆè§„/07.04-æ•°æ®åº“å®‰å…¨æ¨¡å‹-è®¿é—®æ§åˆ¶ä¸ä¿¡æ¯æµå®‰å…¨çš„å½¢å¼åŒ–.md)
- [ç†è®ºåŸºç¡€å¯¼èˆª](../README.md)

---

**æœ€åæ›´æ–°**: 2025-01-16
**ç»´æŠ¤è€…**: Documentation Team
**çŠ¶æ€**: âœ… å†…å®¹å·²å®Œæˆ
