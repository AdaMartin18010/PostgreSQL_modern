# åˆ†åŒºè¡¨ç›‘æŽ§

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 17+/18+
> **éš¾åº¦ç­‰çº§**: â­â­â­ ä¸­çº§

---

## ðŸ“‹ ç›®å½•

- [åˆ†åŒºè¡¨ç›‘æŽ§](#åˆ†åŒºè¡¨ç›‘æŽ§)
  - [ðŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
  - [2. åˆ†åŒºä¿¡æ¯ç›‘æŽ§](#2-åˆ†åŒºä¿¡æ¯ç›‘æŽ§)
    - [2.1 æŸ¥çœ‹æ‰€æœ‰åˆ†åŒº](#21-æŸ¥çœ‹æ‰€æœ‰åˆ†åŒº)
    - [2.2 æŸ¥çœ‹åˆ†åŒºå…³ç³»](#22-æŸ¥çœ‹åˆ†åŒºå…³ç³»)
  - [3. åˆ†åŒºå¤§å°ç›‘æŽ§](#3-åˆ†åŒºå¤§å°ç›‘æŽ§)
    - [3.1 åˆ†åŒºå¤§å°ç»Ÿè®¡](#31-åˆ†åŒºå¤§å°ç»Ÿè®¡)
    - [3.2 åˆ†åŒºå¢žé•¿è¶‹åŠ¿](#32-åˆ†åŒºå¢žé•¿è¶‹åŠ¿)
  - [4. åˆ†åŒºä½¿ç”¨ç›‘æŽ§](#4-åˆ†åŒºä½¿ç”¨ç›‘æŽ§)
    - [4.1 åˆ†åŒºç»Ÿè®¡ä¿¡æ¯](#41-åˆ†åŒºç»Ÿè®¡ä¿¡æ¯)
    - [4.2 åˆ†åŒºæ•°æ®åˆ†å¸ƒ](#42-åˆ†åŒºæ•°æ®åˆ†å¸ƒ)
  - [5. æ€§èƒ½ç›‘æŽ§](#5-æ€§èƒ½ç›‘æŽ§)
    - [5.1 åˆ†åŒºè£å‰ªç›‘æŽ§](#51-åˆ†åŒºè£å‰ªç›‘æŽ§)
    - [5.2 æŸ¥è¯¢æ€§èƒ½ç›‘æŽ§](#52-æŸ¥è¯¢æ€§èƒ½ç›‘æŽ§)
  - [6. æœ€ä½³å®žè·µ](#6-æœ€ä½³å®žè·µ)
    - [âœ… æŽ¨èåšæ³•](#-æŽ¨èåšæ³•)
    - [âŒ é¿å…åšæ³•](#-é¿å…åšæ³•)
  - [ðŸ“š ç›¸å…³æ–‡æ¡£](#-ç›¸å…³æ–‡æ¡£)

---

## 1. æ¦‚è¿°

åˆ†åŒºè¡¨ç›‘æŽ§æ˜¯åˆ†åŒºè¡¨ç®¡ç†çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚é€šè¿‡ç›‘æŽ§å¯ä»¥ï¼š

- äº†è§£åˆ†åŒºçŠ¶æ€
- å‘çŽ°æ€§èƒ½é—®é¢˜
- ä¼˜åŒ–åˆ†åŒºç­–ç•¥
- è§„åˆ’å®¹é‡

---

## 2. åˆ†åŒºä¿¡æ¯ç›‘æŽ§

### 2.1 æŸ¥çœ‹æ‰€æœ‰åˆ†åŒº

```sql
-- æŸ¥çœ‹æ‰€æœ‰åˆ†åŒº
SELECT
    schemaname,
    tablename,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS size
FROM pg_tables
WHERE tablename LIKE 'orders_%'
ORDER BY tablename;
```

### 2.2 æŸ¥çœ‹åˆ†åŒºå…³ç³»

```sql
-- æŸ¥çœ‹åˆ†åŒºå±‚æ¬¡å…³ç³»
SELECT
    n.nspname AS schema_name,
    c.relname AS partition_name,
    pg_get_expr(c.relpartbound, c.oid) AS partition_bound
FROM pg_class c
JOIN pg_namespace n ON n.oid = c.relnamespace
WHERE c.relispartition = true
  AND c.relname LIKE 'orders_%'
ORDER BY c.relname;
```

---

## 3. åˆ†åŒºå¤§å°ç›‘æŽ§

### 3.1 åˆ†åŒºå¤§å°ç»Ÿè®¡

```sql
-- æŸ¥çœ‹æ¯ä¸ªåˆ†åŒºçš„å¤§å°
SELECT
    schemaname,
    tablename,
    pg_size_pretty(pg_relation_size(schemaname||'.'||tablename)) AS table_size,
    pg_size_pretty(pg_indexes_size(schemaname||'.'||tablename)) AS indexes_size,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS total_size
FROM pg_tables
WHERE tablename LIKE 'orders_%'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;
```

### 3.2 åˆ†åŒºå¢žé•¿è¶‹åŠ¿

```sql
-- ç›‘æŽ§åˆ†åŒºå¢žé•¿ï¼ˆéœ€è¦åŽ†å²æ•°æ®ï¼‰
-- å¯ä»¥å®šæœŸè®°å½•åˆ†åŒºå¤§å°åˆ°ç›‘æŽ§è¡¨
CREATE TABLE partition_size_history (
    partition_name TEXT,
    size_bytes BIGINT,
    recorded_at TIMESTAMPTZ DEFAULT NOW()
);

-- å®šæœŸè®°å½•
INSERT INTO partition_size_history (partition_name, size_bytes)
SELECT
    tablename,
    pg_total_relation_size(schemaname||'.'||tablename)
FROM pg_tables
WHERE tablename LIKE 'orders_%';
```

---

## 4. åˆ†åŒºä½¿ç”¨ç›‘æŽ§

### 4.1 åˆ†åŒºç»Ÿè®¡ä¿¡æ¯

```sql
-- æŸ¥çœ‹åˆ†åŒºç»Ÿè®¡ä¿¡æ¯
SELECT
    schemaname,
    tablename,
    n_live_tup,
    n_dead_tup,
    n_tup_ins,
    n_tup_upd,
    n_tup_del,
    last_vacuum,
    last_autovacuum,
    last_analyze,
    last_autoanalyze
FROM pg_stat_user_tables
WHERE tablename LIKE 'orders_%'
ORDER BY tablename;
```

### 4.2 åˆ†åŒºæ•°æ®åˆ†å¸ƒ

```sql
-- æŸ¥çœ‹æ¯ä¸ªåˆ†åŒºçš„æ•°æ®é‡
SELECT
    tablename,
    n_live_tup AS row_count,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS size
FROM pg_stat_user_tables
WHERE tablename LIKE 'orders_%'
ORDER BY tablename;
```

---

## 5. æ€§èƒ½ç›‘æŽ§

### 5.1 åˆ†åŒºè£å‰ªç›‘æŽ§

```sql
-- åˆ†æžæŸ¥è¯¢è®¡åˆ’ï¼Œæ£€æŸ¥åˆ†åŒºè£å‰ª
EXPLAIN (ANALYZE, VERBOSE, BUFFERS)
SELECT * FROM orders
WHERE order_date >= '2024-01-01'
  AND order_date < '2024-02-01';

-- æ£€æŸ¥æ˜¯å¦åªæ‰«æäº†ç›®æ ‡åˆ†åŒº
```

### 5.2 æŸ¥è¯¢æ€§èƒ½ç›‘æŽ§

```sql
-- ä½¿ç”¨pg_stat_statementsç›‘æŽ§æŸ¥è¯¢æ€§èƒ½
SELECT
    query,
    calls,
    total_exec_time,
    mean_exec_time,
    max_exec_time
FROM pg_stat_statements
WHERE query LIKE '%orders%'
ORDER BY mean_exec_time DESC
LIMIT 10;
```

---

## 6. æœ€ä½³å®žè·µ

### âœ… æŽ¨èåšæ³•

1. **å®šæœŸç›‘æŽ§** - å®šæœŸæ£€æŸ¥åˆ†åŒºçŠ¶æ€
2. **ç›‘æŽ§å¤§å°** - ç›‘æŽ§åˆ†åŒºå¤§å°å’Œå¢žé•¿
3. **ç›‘æŽ§ä½¿ç”¨** - ç›‘æŽ§åˆ†åŒºä½¿ç”¨æƒ…å†µ
4. **ç›‘æŽ§æ€§èƒ½** - ç›‘æŽ§æŸ¥è¯¢æ€§èƒ½
5. **è®¾ç½®å‘Šè­¦** - è®¾ç½®åˆ†åŒºå¤§å°å’Œæ€§èƒ½å‘Šè­¦

### âŒ é¿å…åšæ³•

1. **ä¸ç›‘æŽ§** - æ— æ³•å‘çŽ°é—®é¢˜
2. **ä¸è®°å½•åŽ†å²** - æ— æ³•åˆ†æžè¶‹åŠ¿
3. **ä¸è®¾ç½®å‘Šè­¦** - æ— æ³•åŠæ—¶å‘çŽ°é—®é¢˜
4. **ä¸åˆ†æžæ€§èƒ½** - æ— æ³•ä¼˜åŒ–æ€§èƒ½

---

## ðŸ“š ç›¸å…³æ–‡æ¡£

- [åˆ†åŒºè¡¨å®Œæ•´æŒ‡å—.md](./åˆ†åŒºè¡¨å®Œæ•´æŒ‡å—.md) - åˆ†åŒºè¡¨å®Œæ•´æŒ‡å—
- [åˆ†åŒºè¡¨ç»´æŠ¤.md](./åˆ†åŒºè¡¨ç»´æŠ¤.md) - åˆ†åŒºè¡¨ç»´æŠ¤
- [åˆ†åŒºè¡¨æ€§èƒ½ä¼˜åŒ–.md](./åˆ†åŒºè¡¨æ€§èƒ½ä¼˜åŒ–.md) - æ€§èƒ½ä¼˜åŒ–
- [26-æ•°æ®ç®¡ç†/README.md](../README.md) - æ•°æ®ç®¡ç†ä¸»é¢˜

---

**æœ€åŽæ›´æ–°**: 2025å¹´1æœˆ
