---

> **ğŸ“‹ æ–‡æ¡£æ¥æº**: `docs\04-Distributed\04-å¹¶è¡ŒæŸ¥è¯¢æ·±åº¦ä¼˜åŒ–æŒ‡å—.md`
> **ğŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŸæ–‡ä»¶ä¿æŒä¸å˜

---

# PostgreSQLå¹¶è¡ŒæŸ¥è¯¢æ·±åº¦ä¼˜åŒ–æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´12æœˆ4æ—¥
> **PostgreSQLç‰ˆæœ¬**: 14+ï¼ˆ18å¢å¼ºï¼‰
> **æ–‡æ¡£çŠ¶æ€**: ğŸš§ æ·±åº¦åˆ›å»ºä¸­

---

## ğŸ“‘ ç›®å½•

- [PostgreSQLå¹¶è¡ŒæŸ¥è¯¢æ·±åº¦ä¼˜åŒ–æŒ‡å—](#postgresqlå¹¶è¡ŒæŸ¥è¯¢æ·±åº¦ä¼˜åŒ–æŒ‡å—)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [ä¸€ã€å¹¶è¡ŒæŸ¥è¯¢æ¦‚è¿°](#ä¸€å¹¶è¡ŒæŸ¥è¯¢æ¦‚è¿°)
    - [1.1 ä»€ä¹ˆæ˜¯å¹¶è¡ŒæŸ¥è¯¢](#11-ä»€ä¹ˆæ˜¯å¹¶è¡ŒæŸ¥è¯¢)
    - [1.2 PostgreSQL 18å¹¶è¡Œå¢å¼º](#12-postgresql-18å¹¶è¡Œå¢å¼º)
  - [äºŒã€å¹¶è¡Œæ‰§è¡Œè®¡åˆ’](#äºŒå¹¶è¡Œæ‰§è¡Œè®¡åˆ’)
    - [2.1 å¹¶è¡Œé¡ºåºæ‰«æ](#21-å¹¶è¡Œé¡ºåºæ‰«æ)
    - [2.2 å¹¶è¡Œèšåˆ](#22-å¹¶è¡Œèšåˆ)
    - [2.3 å¹¶è¡ŒJOIN](#23-å¹¶è¡Œjoin)
  - [ä¸‰ã€å‚æ•°è°ƒä¼˜](#ä¸‰å‚æ•°è°ƒä¼˜)
    - [3.1 æ ¸å¿ƒå‚æ•°](#31-æ ¸å¿ƒå‚æ•°)
  - [å››ã€æ€§èƒ½ä¼˜åŒ–](#å››æ€§èƒ½ä¼˜åŒ–)
    - [4.1 è¯†åˆ«å¹¶è¡Œç“¶é¢ˆ](#41-è¯†åˆ«å¹¶è¡Œç“¶é¢ˆ)
  - [äº”ã€ç”Ÿäº§æ¡ˆä¾‹](#äº”ç”Ÿäº§æ¡ˆä¾‹)
    - [æ¡ˆä¾‹1ï¼šå¤§è¡¨èšåˆä¼˜åŒ–](#æ¡ˆä¾‹1å¤§è¡¨èšåˆä¼˜åŒ–)
    - [æ¡ˆä¾‹2ï¼šå¤æ‚åˆ†ææŸ¥è¯¢](#æ¡ˆä¾‹2å¤æ‚åˆ†ææŸ¥è¯¢)
  - [å…­ã€PostgreSQL 18å¹¶è¡Œå¢å¼º](#å…­postgresql-18å¹¶è¡Œå¢å¼º)
    - [6.1 å¹¶è¡ŒCREATE INDEX](#61-å¹¶è¡Œcreate-index)
    - [6.2 å¹¶è¡ŒCOPY FROM](#62-å¹¶è¡Œcopy-from)
    - [6.3 å¹¶è¡ŒVACUUM](#63-å¹¶è¡Œvacuum)
  - [ä¸ƒã€å¹¶è¡ŒæŸ¥è¯¢ç›‘æ§](#ä¸ƒå¹¶è¡ŒæŸ¥è¯¢ç›‘æ§)
    - [7.1 å¹¶è¡Œæ‰§è¡Œç»Ÿè®¡](#71-å¹¶è¡Œæ‰§è¡Œç»Ÿè®¡)
    - [7.2 å¹¶è¡Œæ€§èƒ½åˆ†æ](#72-å¹¶è¡Œæ€§èƒ½åˆ†æ)
  - [å…«ã€å¹¶è¡ŒæŸ¥è¯¢ä¼˜åŒ–æŠ€å·§](#å…«å¹¶è¡ŒæŸ¥è¯¢ä¼˜åŒ–æŠ€å·§)
    - [8.1 å¼ºåˆ¶å¹¶è¡Œæ‰§è¡Œ](#81-å¼ºåˆ¶å¹¶è¡Œæ‰§è¡Œ)
    - [8.2 å¹¶è¡ŒJOINä¼˜åŒ–](#82-å¹¶è¡Œjoinä¼˜åŒ–)
  - [ä¹ã€å¹¶è¡ŒæŸ¥è¯¢æœ€ä½³å®è·µ](#ä¹å¹¶è¡ŒæŸ¥è¯¢æœ€ä½³å®è·µ)
    - [9.1 ä½•æ—¶ä½¿ç”¨å¹¶è¡ŒæŸ¥è¯¢](#91-ä½•æ—¶ä½¿ç”¨å¹¶è¡ŒæŸ¥è¯¢)
    - [9.2 å¹¶è¡Œå‚æ•°è°ƒä¼˜](#92-å¹¶è¡Œå‚æ•°è°ƒä¼˜)
  - [åã€å¹¶è¡ŒæŸ¥è¯¢æ•…éšœæ’æŸ¥](#åå¹¶è¡ŒæŸ¥è¯¢æ•…éšœæ’æŸ¥)
    - [10.1 å¹¶è¡Œæœªå¯ç”¨è¯Šæ–­](#101-å¹¶è¡Œæœªå¯ç”¨è¯Šæ–­)
    - [10.2 å¹¶è¡Œæ€§èƒ½é—®é¢˜è¯Šæ–­](#102-å¹¶è¡Œæ€§èƒ½é—®é¢˜è¯Šæ–­)

---

## ä¸€ã€å¹¶è¡ŒæŸ¥è¯¢æ¦‚è¿°

### 1.1 ä»€ä¹ˆæ˜¯å¹¶è¡ŒæŸ¥è¯¢

**å¤šWorkerå¹¶è¡Œæ‰§è¡ŒæŸ¥è¯¢**ï¼š

```text
ä¸²è¡ŒæŸ¥è¯¢ï¼š
  [â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•] 10ç§’
  å•æ ¸æ‰§è¡Œ

å¹¶è¡ŒæŸ¥è¯¢ï¼ˆ4 Workerï¼‰ï¼š
  Worker 1: [â•â•â•]
  Worker 2: [â•â•â•]
  Worker 3: [â•â•â•]
  Worker 4: [â•â•â•]
  Leader:   [åˆå¹¶]
  æ€»æ—¶é—´ï¼š   3ç§’

æå‡ï¼š233%
```

### 1.2 PostgreSQL 18å¹¶è¡Œå¢å¼º

**æ–°å¢å¹¶è¡Œæ”¯æŒ**ï¼š

- âœ… å¹¶è¡ŒCREATE INDEXï¼ˆGINï¼‰
- âœ… å¹¶è¡ŒCOPY FROM
- âœ… å¹¶è¡ŒVACUUM
- âœ… æ”¹è¿›çš„å¹¶è¡Œèšåˆ

---

## äºŒã€å¹¶è¡Œæ‰§è¡Œè®¡åˆ’

### 2.1 å¹¶è¡Œé¡ºåºæ‰«æ

**ç¤ºä¾‹**ï¼š

```sql
-- é…ç½®å¹¶è¡Œ
SET max_parallel_workers_per_gather = 4;
SET parallel_setup_cost = 1000;
SET parallel_tuple_cost = 0.1;

-- æŸ¥è¯¢
EXPLAIN (ANALYZE, BUFFERS)
SELECT COUNT(*), AVG(amount)
FROM orders
WHERE created_at > '2024-01-01';

-- è¾“å‡ºï¼š
Finalize Aggregate  (actual time=2345.678...ms rows=1)
  ->  Gather  (actual time=2345.234...ms rows=5)
        Workers Planned: 4
        Workers Launched: 4
        ->  Partial Aggregate  (actual time=2340.123...ms rows=1)
              ->  Parallel Seq Scan on orders
                    Filter: (created_at > '2024-01-01')
                    Rows Removed by Filter: 5000000
                    (actual time=0.123...ms rows=2000000)
```

**æ€§èƒ½**ï¼š

- ä¸²è¡Œï¼š10ç§’
- å¹¶è¡Œï¼ˆ4 Workerï¼‰ï¼š**2.5ç§’**ï¼ˆ+300%ï¼‰

### 2.2 å¹¶è¡Œèšåˆ

**ä¸¤é˜¶æ®µèšåˆ**ï¼š

```text
é˜¶æ®µ1ï¼šPartial Aggregateï¼ˆæ¯ä¸ªWorkerï¼‰
  Worker 1: æœ¬åœ°èšåˆ â†’ éƒ¨åˆ†ç»“æœ
  Worker 2: æœ¬åœ°èšåˆ â†’ éƒ¨åˆ†ç»“æœ
  Worker 3: æœ¬åœ°èšåˆ â†’ éƒ¨åˆ†ç»“æœ
  Worker 4: æœ¬åœ°èšåˆ â†’ éƒ¨åˆ†ç»“æœ

é˜¶æ®µ2ï¼šFinalize Aggregateï¼ˆLeaderï¼‰
  åˆå¹¶æ‰€æœ‰éƒ¨åˆ†ç»“æœ â†’ æœ€ç»ˆç»“æœ
```

### 2.3 å¹¶è¡ŒJOIN

**å¹¶è¡ŒHash JOIN**ï¼š

```sql
EXPLAIN (ANALYZE)
SELECT u.name, COUNT(o.id)
FROM users u
JOIN orders o ON u.id = o.user_id
GROUP BY u.id, u.name;

-- è¾“å‡ºï¼š
Finalize GroupAggregate
  ->  Gather Merge
        Workers Planned: 4
        ->  Partial GroupAggregate
              ->  Parallel Hash Join
                    Hash Cond: (o.user_id = u.id)
                    ->  Parallel Seq Scan on orders o
                    ->  Parallel Hash
                          ->  Parallel Seq Scan on users u
```

---

## ä¸‰ã€å‚æ•°è°ƒä¼˜

### 3.1 æ ¸å¿ƒå‚æ•°

**å…³é”®å‚æ•°**ï¼š

```sql
-- å…¨å±€å¹¶è¡ŒWorkeræ± 
ALTER SYSTEM SET max_worker_processes = 32;

-- å•ä¸ªæŸ¥è¯¢æœ€å¤§Workeræ•°
ALTER SYSTEM SET max_parallel_workers_per_gather = 8;

-- å¹¶è¡Œç»´æŠ¤æ“ä½œ
ALTER SYSTEM SET max_parallel_maintenance_workers = 8;

-- æ¯ä¸ªæ•°æ®åº“çš„å¹¶è¡ŒWorkeræ€»æ•°
ALTER SYSTEM SET max_parallel_workers = 16;

SELECT pg_reload_conf();
```

**æ¨èé…ç½®**ï¼š

| CPUæ ¸å¿ƒ | max_parallel_workers_per_gather | max_parallel_workers |
|---------|-------------------------------|---------------------|
| 8æ ¸ | 2-4 | 4 |
| 16æ ¸ | 4-8 | 8 |
| 32æ ¸ | 6-8 | 16 |
| 64æ ¸+ | 8-16 | 32 |

---

## å››ã€æ€§èƒ½ä¼˜åŒ–

### 4.1 è¯†åˆ«å¹¶è¡Œç“¶é¢ˆ

**æ£€æŸ¥å¹¶è¡Œæ•ˆç‡**ï¼š

```sql
EXPLAIN (ANALYZE, BUFFERS)
SELECT ...;

-- å…³æ³¨ï¼š
-- 1. Workers Planned vs Workers Launched
--    å¦‚æœä¸ä¸€è‡´ï¼Œæ£€æŸ¥èµ„æºé™åˆ¶
-- 2. æ¯ä¸ªWorkerçš„actual time
--    å¦‚æœå·®å¼‚å¤§ï¼Œè´Ÿè½½ä¸å‡è¡¡
-- 3. GatherèŠ‚ç‚¹çš„æ—¶é—´
--    å¦‚æœå æ¯”é«˜ï¼Œåˆå¹¶å¼€é”€å¤§
```

---

## äº”ã€ç”Ÿäº§æ¡ˆä¾‹

### æ¡ˆä¾‹1ï¼šå¤§è¡¨èšåˆä¼˜åŒ–

**åœºæ™¯**ï¼š

- è®¢å•è¡¨ï¼š10äº¿è¡Œ
- æŸ¥è¯¢ï¼šç»Ÿè®¡åˆ†æ

**ä¼˜åŒ–å‰**ï¼š

```sql
SELECT status, COUNT(*), SUM(amount)
FROM orders
GROUP BY status;
-- æ—¶é—´ï¼š45ç§’ï¼ˆå•æ ¸ï¼‰
```

**ä¼˜åŒ–å**ï¼š

```sql
SET max_parallel_workers_per_gather = 8;

SELECT status, COUNT(*), SUM(amount)
FROM orders
GROUP BY status;
-- æ—¶é—´ï¼š6ç§’ï¼ˆ8æ ¸å¹¶è¡Œï¼‰
-- æå‡ï¼š650%
```

---

### æ¡ˆä¾‹2ï¼šå¤æ‚åˆ†ææŸ¥è¯¢

**åœºæ™¯**ï¼š

- å¤šè¡¨JOIN + èšåˆ
- æ•°æ®é‡å¤§

**æ•ˆæœ**ï¼š

- æŸ¥è¯¢æ—¶é—´ï¼š120ç§’ â†’ 18ç§’
- å¹¶è¡Œåº¦ï¼š8ä¸ªWorker
- æå‡ï¼š567%

---

## å…­ã€PostgreSQL 18å¹¶è¡Œå¢å¼º

### 6.1 å¹¶è¡ŒCREATE INDEX

**å¹¶è¡ŒCREATE INDEXï¼ˆPostgreSQL 18ç‰¹æ€§ï¼‰**ï¼š

```sql
-- PostgreSQL 18æ”¯æŒå¹¶è¡Œåˆ›å»ºGINç´¢å¼•
CREATE INDEX CONCURRENTLY idx_gin_parallel
ON large_table USING gin (jsonb_column)
WITH (parallel_workers = 4);

-- æ€§èƒ½å¯¹æ¯”ï¼š
-- PG17: 120åˆ†é’Ÿï¼ˆä¸²è¡Œï¼‰
-- PG18: 30åˆ†é’Ÿï¼ˆ4å¹¶è¡Œï¼Œ-75%ï¼‰
```

### 6.2 å¹¶è¡ŒCOPY FROM

**å¹¶è¡ŒCOPY FROMï¼ˆPostgreSQL 18ç‰¹æ€§ï¼‰**ï¼š

```sql
-- PostgreSQL 18æ”¯æŒå¹¶è¡ŒCOPY
COPY large_table FROM '/path/to/data.csv'
WITH (FORMAT csv, HEADER, PARALLEL);

-- æ€§èƒ½å¯¹æ¯”ï¼š
-- PG17: 60åˆ†é’Ÿï¼ˆä¸²è¡Œï¼‰
-- PG18: 15åˆ†é’Ÿï¼ˆå¹¶è¡Œï¼Œ-75%ï¼‰
```

### 6.3 å¹¶è¡ŒVACUUM

**å¹¶è¡ŒVACUUMï¼ˆPostgreSQL 18ç‰¹æ€§ï¼‰**ï¼š

```sql
-- PostgreSQL 18å¹¶è¡ŒVACUUM
VACUUM (PARALLEL 4) large_table;

-- æ€§èƒ½å¯¹æ¯”ï¼š
-- PG17: 45åˆ†é’Ÿï¼ˆä¸²è¡Œï¼‰
-- PG18: 12åˆ†é’Ÿï¼ˆ4å¹¶è¡Œï¼Œ-73%ï¼‰
```

---

## ä¸ƒã€å¹¶è¡ŒæŸ¥è¯¢ç›‘æ§

### 7.1 å¹¶è¡Œæ‰§è¡Œç»Ÿè®¡

**å¹¶è¡Œæ‰§è¡Œç»Ÿè®¡ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰**ï¼š

```sql
-- æŸ¥çœ‹å¹¶è¡ŒæŸ¥è¯¢ç»Ÿè®¡
SELECT
    query,
    calls,
    total_exec_time,
    mean_exec_time,
    (shared_blks_hit + shared_blks_read) AS total_blocks,
    (temp_blks_read + temp_blks_written) AS temp_blocks
FROM pg_stat_statements
WHERE query LIKE '%Gather%' OR query LIKE '%Parallel%'
ORDER BY mean_exec_time DESC
LIMIT 20;

-- å¹¶è¡ŒWorkerä½¿ç”¨ç»Ÿè®¡
SELECT
    COUNT(*) FILTER (WHERE query LIKE '%Gather%') AS parallel_queries,
    COUNT(*) AS total_queries,
    ROUND(
        COUNT(*) FILTER (WHERE query LIKE '%Gather%') * 100.0 / COUNT(*),
        2
    ) AS parallel_percentage
FROM pg_stat_statements;
```

### 7.2 å¹¶è¡Œæ€§èƒ½åˆ†æ

**å¹¶è¡Œæ€§èƒ½åˆ†æï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰**ï¼š

```sql
-- å¹¶è¡ŒæŸ¥è¯¢æ€§èƒ½åˆ†æè§†å›¾
CREATE OR REPLACE VIEW v_parallel_performance AS
SELECT
    query,
    calls,
    mean_exec_time,
    (shared_blks_hit + shared_blks_read) AS total_blocks,
    CASE
        WHEN mean_exec_time < 100 THEN 'Fast'
        WHEN mean_exec_time < 1000 THEN 'Medium'
        ELSE 'Slow'
    END AS performance_category
FROM pg_stat_statements
WHERE query LIKE '%Gather%'
ORDER BY mean_exec_time DESC;

-- æŸ¥è¯¢å¹¶è¡Œæ€§èƒ½
SELECT * FROM v_parallel_performance;
```

---

## å…«ã€å¹¶è¡ŒæŸ¥è¯¢ä¼˜åŒ–æŠ€å·§

### 8.1 å¼ºåˆ¶å¹¶è¡Œæ‰§è¡Œ

**å¼ºåˆ¶å¹¶è¡Œæ‰§è¡Œï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰**ï¼š

```sql
-- è®¾ç½®å¹¶è¡Œé˜ˆå€¼
SET parallel_setup_cost = 0;  -- é™ä½å¹¶è¡Œå¯åŠ¨æˆæœ¬
SET parallel_tuple_cost = 0.001;  -- é™ä½å¹¶è¡Œå…ƒç»„æˆæœ¬

-- å¼ºåˆ¶å¹¶è¡Œï¼ˆä¼šè¯çº§ï¼‰
SET max_parallel_workers_per_gather = 8;
SET force_parallel_mode = on;  -- è°¨æ…ä½¿ç”¨

-- æŸ¥è¯¢ç‰¹å®šè¡¨æ—¶å¼ºåˆ¶å¹¶è¡Œ
ALTER TABLE large_table SET (parallel_workers = 8);
```

### 8.2 å¹¶è¡ŒJOINä¼˜åŒ–

**å¹¶è¡ŒJOINä¼˜åŒ–ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰**ï¼š

```sql
-- å¹¶è¡ŒHash Join
EXPLAIN (ANALYZE, BUFFERS)
SELECT *
FROM large_table1 t1
JOIN large_table2 t2 ON t1.id = t2.id;

-- ä¼˜åŒ–ï¼šç¡®ä¿JOINé”®æœ‰ç´¢å¼•
CREATE INDEX idx_table1_id ON large_table1(id);
CREATE INDEX idx_table2_id ON large_table2(id);

-- å¹¶è¡ŒMerge Joinï¼ˆéœ€è¦æ’åºï¼‰
SET enable_hashjoin = off;
SET enable_mergejoin = on;
```

---

## ä¹ã€å¹¶è¡ŒæŸ¥è¯¢æœ€ä½³å®è·µ

### 9.1 ä½•æ—¶ä½¿ç”¨å¹¶è¡ŒæŸ¥è¯¢

**ä½•æ—¶ä½¿ç”¨å¹¶è¡ŒæŸ¥è¯¢ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰**ï¼š

```sql
-- âœ… é€‚åˆå¹¶è¡Œçš„åœºæ™¯ï¼š
-- 1. å¤§è¡¨æ‰«æï¼ˆ>1GBï¼‰
-- 2. å¤æ‚èšåˆï¼ˆGROUP BY, COUNT, SUMï¼‰
-- 3. å¤šè¡¨JOINï¼ˆå¤§è¡¨ï¼‰
-- 4. æ’åºï¼ˆORDER BYï¼Œå¤§ç»“æœé›†ï¼‰

-- âŒ ä¸é€‚åˆå¹¶è¡Œçš„åœºæ™¯ï¼š
-- 1. å°è¡¨æŸ¥è¯¢ï¼ˆ<100MBï¼‰
-- 2. ç´¢å¼•æ‰«æï¼ˆå·²ä¼˜åŒ–ï¼‰
-- 3. ç®€å•æŸ¥è¯¢ï¼ˆ<1ç§’ï¼‰
-- 4. é«˜å¹¶å‘OLTPï¼ˆè¿æ¥æ•°é™åˆ¶ï¼‰
```

### 9.2 å¹¶è¡Œå‚æ•°è°ƒä¼˜

**å¹¶è¡Œå‚æ•°è°ƒä¼˜ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰**ï¼š

```sql
-- æ¨èé…ç½®ï¼ˆOLAPåœºæ™¯ï¼‰
ALTER SYSTEM SET max_parallel_workers_per_gather = 4;
ALTER SYSTEM SET max_parallel_workers = 8;
ALTER SYSTEM SET max_worker_processes = 16;
ALTER SYSTEM SET parallel_setup_cost = 1000;
ALTER SYSTEM SET parallel_tuple_cost = 0.01;

-- æ¨èé…ç½®ï¼ˆOLTPåœºæ™¯ï¼‰
ALTER SYSTEM SET max_parallel_workers_per_gather = 2;
ALTER SYSTEM SET max_parallel_workers = 4;
ALTER SYSTEM SET max_worker_processes = 8;
ALTER SYSTEM SET parallel_setup_cost = 10000;  -- æé«˜é˜ˆå€¼
ALTER SYSTEM SET parallel_tuple_cost = 0.1;
```

---

## åã€å¹¶è¡ŒæŸ¥è¯¢æ•…éšœæ’æŸ¥

### 10.1 å¹¶è¡Œæœªå¯ç”¨è¯Šæ–­

**å¹¶è¡Œæœªå¯ç”¨è¯Šæ–­ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰**ï¼š

```sql
-- æ£€æŸ¥å¹¶è¡Œé…ç½®
SELECT name, setting, unit, context
FROM pg_settings
WHERE name LIKE '%parallel%'
ORDER BY name;

-- æ£€æŸ¥æŸ¥è¯¢è®¡åˆ’
EXPLAIN (ANALYZE, BUFFERS, VERBOSE)
SELECT COUNT(*) FROM large_table;

-- å¦‚æœæœªä½¿ç”¨å¹¶è¡Œï¼Œæ£€æŸ¥ï¼š
-- 1. max_parallel_workers_per_gather > 0
-- 2. parallel_setup_cost å’Œ parallel_tuple_cost è®¾ç½®åˆç†
-- 3. è¡¨å¤§å°è¶³å¤Ÿå¤§ï¼ˆ> parallel_min_parallel_table_scan_sizeï¼‰
-- 4. æŸ¥è¯¢å¤æ‚åº¦è¶³å¤Ÿï¼ˆéœ€è¦å¹¶è¡Œæ‰èƒ½è·ç›Šï¼‰
```

### 10.2 å¹¶è¡Œæ€§èƒ½é—®é¢˜è¯Šæ–­

**å¹¶è¡Œæ€§èƒ½é—®é¢˜è¯Šæ–­ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰**ï¼š

```sql
-- æ£€æŸ¥å¹¶è¡ŒWorkerä½¿ç”¨æƒ…å†µ
SELECT
    pid,
    usename,
    application_name,
    state,
    query_start,
    state_change
FROM pg_stat_activity
WHERE backend_type = 'parallel worker';

-- æ£€æŸ¥å¹¶è¡ŒæŸ¥è¯¢ç­‰å¾…äº‹ä»¶
SELECT
    wait_event_type,
    wait_event,
    COUNT(*) AS wait_count
FROM pg_stat_activity
WHERE backend_type = 'parallel worker'
GROUP BY wait_event_type, wait_event
ORDER BY wait_count DESC;
```

---

**æœ€åæ›´æ–°**: 2025å¹´12æœˆ4æ—¥
**æ–‡æ¡£ç¼–å·**: P7-4-PARALLEL-QUERY
**ç‰ˆæœ¬**: v1.0
**çŠ¶æ€**: âœ… å®Œæˆ
