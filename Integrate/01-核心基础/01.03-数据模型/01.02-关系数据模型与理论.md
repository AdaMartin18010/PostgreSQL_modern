---

> **ğŸ“‹ æ–‡æ¡£æ¥æº**: `PostgreSQL/01-æ ¸å¿ƒè¯¾ç¨‹/01.02-å…³ç³»æ•°æ®æ¨¡å‹ä¸ç†è®º.md`
> **ğŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŸæ–‡ä»¶ä¿æŒä¸å˜

---

# PostgreSQLå…³ç³»æ•°æ®æ¨¡å‹ä¸ç†è®ºå®Œæ•´æŒ‡å—

> **ç‰ˆæœ¬**: v3.1
> **æœ€åæ›´æ–°**: 2025-11-22
> **ç‰ˆæœ¬è¦†ç›–**: PostgreSQL 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x (å…¼å®¹)
> **éš¾åº¦**: â­â­â­â­
> **åº”ç”¨åœºæ™¯**: æ•°æ®å»ºæ¨¡ã€æ•°æ®åº“è®¾è®¡ã€ç†è®ºç†è§£ã€ç³»ç»Ÿè®¾è®¡
> ğŸ†• **PostgreSQL 18æ”¹è¿›**: å…³ç³»æ¨¡å‹å®ç°æ›´å®Œå–„ï¼Œæ”¯æŒæ›´å¤æ‚çš„çº¦æŸã€ç»§æ‰¿å’Œåˆ†åŒºç­–ç•¥ã€è™šæ‹Ÿç”Ÿæˆåˆ—ï¼ˆå·²è¯¦ç»†å±•å¼€ï¼‰

---

## ğŸ“‘ ç›®å½•

- [PostgreSQLå…³ç³»æ•°æ®æ¨¡å‹ä¸ç†è®ºå®Œæ•´æŒ‡å—](#postgresqlå…³ç³»æ•°æ®æ¨¡å‹ä¸ç†è®ºå®Œæ•´æŒ‡å—)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [ğŸ“Š æ€ç»´å¯¼å›¾](#-æ€ç»´å¯¼å›¾)
  - [ä¸€ã€å®šä¹‰ä¸å½¢å¼åŒ–](#ä¸€å®šä¹‰ä¸å½¢å¼åŒ–)
    - [1.1 æ¦‚å¿µå®šä¹‰](#11-æ¦‚å¿µå®šä¹‰)
    - [1.2 å½¢å¼åŒ–å®šä¹‰](#12-å½¢å¼åŒ–å®šä¹‰)
    - [1.3 æ ¸å¿ƒå±æ€§](#13-æ ¸å¿ƒå±æ€§)
  - [äºŒã€ç†è®ºåŸºç¡€](#äºŒç†è®ºåŸºç¡€)
    - [2.1 å…³ç³»ä»£æ•°](#21-å…³ç³»ä»£æ•°)
    - [2.2 å‡½æ•°ä¾èµ–ç†è®º](#22-å‡½æ•°ä¾èµ–ç†è®º)
    - [2.3 èŒƒå¼ç†è®º](#23-èŒƒå¼ç†è®º)
      - [2.3.1 ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰](#231-ç¬¬ä¸€èŒƒå¼1nf)
      - [2.3.2 ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰](#232-ç¬¬äºŒèŒƒå¼2nf)
      - [2.3.3 ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰](#233-ç¬¬ä¸‰èŒƒå¼3nf)
      - [2.3.4 BCNFï¼ˆBoyce-CoddèŒƒå¼ï¼‰](#234-bcnfboyce-coddèŒƒå¼)
      - [2.3.5 èŒƒå¼è½¬æ¢å®é™…æ¡ˆä¾‹](#235-èŒƒå¼è½¬æ¢å®é™…æ¡ˆä¾‹)
  - [ä¸‰ã€çŸ¥è¯†çŸ©é˜µå¯¹æ¯”](#ä¸‰çŸ¥è¯†çŸ©é˜µå¯¹æ¯”)
    - [3.1 èŒƒå¼å¯¹æ¯”](#31-èŒƒå¼å¯¹æ¯”)
    - [3.2 çº¦æŸç±»å‹å¯¹æ¯”](#32-çº¦æŸç±»å‹å¯¹æ¯”)
  - [å››ã€PostgreSQLå®ç°](#å››postgresqlå®ç°)
    - [4.1 æ•°æ®ç±»å‹ç³»ç»Ÿ](#41-æ•°æ®ç±»å‹ç³»ç»Ÿ)
    - [4.2 çº¦æŸç³»ç»Ÿ](#42-çº¦æŸç³»ç»Ÿ)
    - [4.3 å…³ç³»æ“ä½œå®ç°](#43-å…³ç³»æ“ä½œå®ç°)
  - [äº”ã€é«˜çº§ç‰¹æ€§](#äº”é«˜çº§ç‰¹æ€§)
    - [5.1 è§†å›¾ç³»ç»Ÿ](#51-è§†å›¾ç³»ç»Ÿ)
    - [5.2 ç»§æ‰¿ç³»ç»Ÿ](#52-ç»§æ‰¿ç³»ç»Ÿ)
    - [5.3 åˆ†åŒºè¡¨](#53-åˆ†åŒºè¡¨)
  - [å…­ã€æ€§èƒ½ä¼˜åŒ–](#å…­æ€§èƒ½ä¼˜åŒ–)
    - [6.1 ç´¢å¼•ä¼˜åŒ–](#61-ç´¢å¼•ä¼˜åŒ–)
    - [6.2 æŸ¥è¯¢ä¼˜åŒ–](#62-æŸ¥è¯¢ä¼˜åŒ–)
  - [ä¸ƒã€å®é™…åº”ç”¨æ¡ˆä¾‹](#ä¸ƒå®é™…åº”ç”¨æ¡ˆä¾‹)
    - [7.1 ç”µå•†ç³»ç»Ÿè®¾è®¡](#71-ç”µå•†ç³»ç»Ÿè®¾è®¡)
    - [7.2 é‡‘èç³»ç»Ÿè®¾è®¡](#72-é‡‘èç³»ç»Ÿè®¾è®¡)
  - [å…«ã€ç›¸å…³æ¦‚å¿µ](#å…«ç›¸å…³æ¦‚å¿µ)
    - [8.1 ä¸Šä½æ¦‚å¿µ](#81-ä¸Šä½æ¦‚å¿µ)
    - [8.2 ä¸‹ä½æ¦‚å¿µ](#82-ä¸‹ä½æ¦‚å¿µ)
    - [8.3 å¹³è¡Œæ¦‚å¿µ](#83-å¹³è¡Œæ¦‚å¿µ)
  - [ä¹ã€å‚è€ƒèµ„æº](#ä¹å‚è€ƒèµ„æº)
    - [9.1 ç›¸å…³æ–‡æ¡£](#91-ç›¸å…³æ–‡æ¡£)
    - [9.2 å®æˆ˜æ¡ˆä¾‹ä¸ç¤ºä¾‹](#92-å®æˆ˜æ¡ˆä¾‹ä¸ç¤ºä¾‹)
    - [9.3 å‚è€ƒæ–‡çŒ®](#93-å‚è€ƒæ–‡çŒ®)
    - [9.4 Wikidataå¯¹é½](#94-wikidataå¯¹é½)
      - [9.4.1 å…³ç³»æ•°æ®æ¨¡å‹æ¦‚å¿µå¯¹é½](#941-å…³ç³»æ•°æ®æ¨¡å‹æ¦‚å¿µå¯¹é½)
      - [9.4.2 PostgreSQLå…³ç³»æ¨¡å‹å¯¹é½](#942-postgresqlå…³ç³»æ¨¡å‹å¯¹é½)
  - [åã€å½¢å¼è¯æ˜ä¸ç†è®ºè®ºè¯](#åå½¢å¼è¯æ˜ä¸ç†è®ºè®ºè¯)
    - [10.1 å…³ç³»ä»£æ•°å®Œå¤‡æ€§è¯æ˜](#101-å…³ç³»ä»£æ•°å®Œå¤‡æ€§è¯æ˜)
    - [10.2 Armstrongå…¬ç†å®Œå¤‡æ€§è¯æ˜](#102-armstrongå…¬ç†å®Œå¤‡æ€§è¯æ˜)
    - [10.3 èŒƒå¼åˆ†è§£æ— æŸæ€§è¯æ˜](#103-èŒƒå¼åˆ†è§£æ— æŸæ€§è¯æ˜)
  - [åä¸€ã€äº¤å‰å¼•ç”¨](#åä¸€äº¤å‰å¼•ç”¨)
    - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)
      - [æ•°æ®æ¨¡å‹è®¾è®¡](#æ•°æ®æ¨¡å‹è®¾è®¡)
      - [æ ¸å¿ƒè¯¾ç¨‹](#æ ¸å¿ƒè¯¾ç¨‹)
      - [æŸ¥è¯¢ä¸ä¼˜åŒ–](#æŸ¥è¯¢ä¸ä¼˜åŒ–)
      - [ç†è®ºåŸºç¡€](#ç†è®ºåŸºç¡€)
    - [å¤–éƒ¨èµ„æº](#å¤–éƒ¨èµ„æº)

---

## ğŸ“Š æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((å…³ç³»æ•°æ®æ¨¡å‹))
    ç†è®ºåŸºç¡€
      å…³ç³»ä»£æ•°
      å‡½æ•°ä¾èµ–
      èŒƒå¼ç†è®º
    PostgreSQLå®ç°
      æ•°æ®ç±»å‹
      çº¦æŸç³»ç»Ÿ
      å…³ç³»æ“ä½œ
    é«˜çº§ç‰¹æ€§
      è§†å›¾ç³»ç»Ÿ
      ç»§æ‰¿ç³»ç»Ÿ
      åˆ†åŒºè¡¨
    æ€§èƒ½ä¼˜åŒ–
      ç´¢å¼•ä¼˜åŒ–
      æŸ¥è¯¢ä¼˜åŒ–
    å®é™…åº”ç”¨
      ç”µå•†ç³»ç»Ÿ
      é‡‘èç³»ç»Ÿ
      æ•°æ®å»ºæ¨¡
```

---

## ä¸€ã€å®šä¹‰ä¸å½¢å¼åŒ–

### 1.1 æ¦‚å¿µå®šä¹‰

**ä¸­æ–‡å®šä¹‰**: å…³ç³»æ•°æ®æ¨¡å‹æ˜¯åŸºäºæ•°å­¦é›†åˆè®ºçš„æ•°æ®æ¨¡å‹ï¼Œå°†æ•°æ®ç»„ç»‡ä¸ºäºŒç»´è¡¨æ ¼ï¼ˆå…³ç³»ï¼‰ï¼Œé€šè¿‡å…³ç³»ä»£æ•°å’Œå…³ç³»æ¼”ç®—è¿›è¡Œæ•°æ®æ“ä½œã€‚PostgreSQLå®Œå…¨å®ç°äº†å…³ç³»æ•°æ®æ¨¡å‹ï¼Œæ”¯æŒå®Œæ•´çš„SQLæ ‡å‡†ã€‚

**English Definition**: The relational data model is a data model based on mathematical set theory that organizes data as two-dimensional tables (relations), with data manipulation performed through relational algebra and relational calculus. PostgreSQL fully implements the relational data model and supports complete SQL standards.

### 1.2 å½¢å¼åŒ–å®šä¹‰

```latex
% æ•°å­¦ç¬¦å·å®šä¹‰
\newcommand{\rel}{\mathcal{R}}
\newcommand{\attr}{\mathcal{A}}
\newcommand{\tuple}{\mathcal{T}}
\newcommand{\domain}{\mathcal{D}}
\newcommand{\schema}{\mathcal{S}}

% å…³ç³»çš„å½¢å¼åŒ–å®šä¹‰
\rel = \{t_1, t_2, \ldots, t_n\}

å…¶ä¸­æ¯ä¸ªå…ƒç»„ t_i = (a_1, a_2, \ldots, a_m) \in \domain_1 \times \domain_2 \times \ldots \times \domain_m

% å…³ç³»æ¨¡å¼å®šä¹‰
\schema = (\rel, \attr, \domain)
```

### 1.3 æ ¸å¿ƒå±æ€§

- **åŸå­æ€§**: æ¯ä¸ªå±æ€§å€¼éƒ½æ˜¯åŸå­çš„ï¼Œä¸å¯å†åˆ†
- **å”¯ä¸€æ€§**: å…³ç³»ä¸­ä¸å­˜åœ¨é‡å¤çš„å…ƒç»„
- **æ— åºæ€§**: å…ƒç»„å’Œå±æ€§çš„é¡ºåºæ— å…³ç´§è¦
- **å®Œæ•´æ€§**: æ”¯æŒå®ä½“å®Œæ•´æ€§ã€å‚ç…§å®Œæ•´æ€§å’ŒåŸŸå®Œæ•´æ€§çº¦æŸ

## äºŒã€ç†è®ºåŸºç¡€

### 2.1 å…³ç³»ä»£æ•°

```latex
\begin{theorem}[å…³ç³»ä»£æ•°å®Œå¤‡æ€§]
å…³ç³»ä»£æ•°åŒ…å«ä»¥ä¸‹åŸºæœ¬è¿ç®—ï¼š
1. é€‰æ‹©è¿ç®— \sigma_p(R) = \{t | t \in R \land p(t)\}
2. æŠ•å½±è¿ç®— \pi_A(R) = \{t[A] | t \in R\}
3. å¹¶è¿ç®— R \cup S = \{t | t \in R \lor t \in S\}
4. å·®è¿ç®— R - S = \{t | t \in R \land t \notin S\}
5. ç¬›å¡å°”ç§¯ R \times S = \{(r,s) | r \in R \land s \in S\}
6. è¿æ¥è¿ç®— R \bowtie_p S = \sigma_p(R \times S)
\end{theorem}
```

### 2.2 å‡½æ•°ä¾èµ–ç†è®º

```latex
\begin{theorem}[Armstrongå…¬ç†]
å‡½æ•°ä¾èµ–æ»¡è¶³ä»¥ä¸‹å…¬ç†ï¼š
1. è‡ªåæ€§ï¼šå¦‚æœ Y \subseteq Xï¼Œåˆ™ X \rightarrow Y
2. å¢å¹¿æ€§ï¼šå¦‚æœ X \rightarrow Yï¼Œåˆ™ XZ \rightarrow YZ
3. ä¼ é€’æ€§ï¼šå¦‚æœ X \rightarrow Y ä¸” Y \rightarrow Zï¼Œåˆ™ X \rightarrow Z
\end{theorem}

\begin{proof}
åŸºäºé›†åˆè®ºå’Œé€»è¾‘æ¨ç†ï¼Œå¯ä»¥è¯æ˜è¿™äº›å…¬ç†çš„æ­£ç¡®æ€§ã€‚
\end{proof}
```

### 2.3 èŒƒå¼ç†è®º

```latex
\begin{theorem}[èŒƒå¼å±‚æ¬¡]
å…³ç³»èŒƒå¼æ»¡è¶³ä»¥ä¸‹å±‚æ¬¡ç»“æ„ï¼š
1. 1NF: æ¯ä¸ªå±æ€§éƒ½æ˜¯åŸå­çš„
2. 2NF: æ»¡è¶³1NFä¸”æ¯ä¸ªéä¸»å±æ€§å®Œå…¨å‡½æ•°ä¾èµ–äºä¸»é”®
3. 3NF: æ»¡è¶³2NFä¸”æ¯ä¸ªéä¸»å±æ€§ä¸ä¼ é€’ä¾èµ–äºä¸»é”®
4. BCNF: æ»¡è¶³3NFä¸”æ¯ä¸ªå‡½æ•°ä¾èµ–çš„å†³å®šå› ç´ éƒ½æ˜¯è¶…é”®
\end{theorem}
```

#### 2.3.1 ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰

**å®šä¹‰**: ç¬¬ä¸€èŒƒå¼è¦æ±‚å…³ç³»ä¸­çš„æ¯ä¸ªå±æ€§éƒ½æ˜¯åŸå­çš„ï¼Œå³å±æ€§å€¼ä¸å¯å†åˆ†ã€‚

**åˆ¤æ–­æ–¹æ³•**:

- æ£€æŸ¥æ˜¯å¦å­˜åœ¨å¤åˆå±æ€§ï¼ˆå¦‚åœ°å€åŒ…å«çœã€å¸‚ã€åŒºï¼‰
- æ£€æŸ¥æ˜¯å¦å­˜åœ¨å¤šå€¼å±æ€§ï¼ˆå¦‚ä¸€ä¸ªå‘˜å·¥æœ‰å¤šä¸ªç”µè¯å·ç ï¼‰
- æ£€æŸ¥æ˜¯å¦å­˜åœ¨åµŒå¥—å…³ç³»

**è¿å1NFçš„ç¤ºä¾‹**:

```sql
-- è¿å1NFï¼šåœ°å€æ˜¯å¤åˆå±æ€§ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'employees_violate_1nf') THEN
            RAISE NOTICE 'è¡¨ employees_violate_1nf å·²å­˜åœ¨';
        ELSE
            CREATE TABLE employees_violate_1nf (
                emp_id INTEGER PRIMARY KEY,
                name VARCHAR(50),
                address VARCHAR(200)  -- åŒ…å«çœã€å¸‚ã€åŒºã€è¡—é“ï¼Œä¸æ˜¯åŸå­å€¼
            );
            RAISE NOTICE 'è¡¨ employees_violate_1nf åˆ›å»ºæˆåŠŸï¼ˆè¿å1NFç¤ºä¾‹ï¼šåœ°å€æ˜¯å¤åˆå±æ€§ï¼‰';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ employees_violate_1nf å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;

    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'employees_violate_1nf2') THEN
            RAISE NOTICE 'è¡¨ employees_violate_1nf2 å·²å­˜åœ¨';
        ELSE
            CREATE TABLE employees_violate_1nf2 (
                emp_id INTEGER PRIMARY KEY,
                name VARCHAR(50),
                phones VARCHAR(200)  -- å¯èƒ½åŒ…å«å¤šä¸ªç”µè¯å·ç ï¼Œå¦‚"13800138000,13900139000"
            );
            RAISE NOTICE 'è¡¨ employees_violate_1nf2 åˆ›å»ºæˆåŠŸï¼ˆè¿å1NFç¤ºä¾‹ï¼šç”µè¯å·ç æ˜¯å¤šå€¼å±æ€§ï¼‰';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ employees_violate_1nf2 å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

**ç¬¦åˆ1NFçš„è®¾è®¡**:

```sql
-- ç¬¦åˆ1NFï¼šå°†åœ°å€æ‹†åˆ†ä¸ºåŸå­å±æ€§ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'employees_1nf') THEN
            RAISE NOTICE 'è¡¨ employees_1nf å·²å­˜åœ¨';
        ELSE
            CREATE TABLE employees_1nf (
                emp_id INTEGER PRIMARY KEY,
                name VARCHAR(50),
                province VARCHAR(50),
                city VARCHAR(50),
                district VARCHAR(50),
                street VARCHAR(100)
            );
            RAISE NOTICE 'è¡¨ employees_1nf åˆ›å»ºæˆåŠŸï¼ˆç¬¦åˆ1NFï¼šåœ°å€æ‹†åˆ†ä¸ºåŸå­å±æ€§ï¼‰';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ employees_1nf å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- ç¬¦åˆ1NFï¼šå°†å¤šå€¼å±æ€§æ‹†åˆ†ä¸ºç‹¬ç«‹è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        -- å¦‚æœè¡¨å·²å­˜åœ¨ï¼Œå…ˆåˆ é™¤ï¼ˆä»…ç”¨äºç¤ºä¾‹ï¼‰
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'employees_1nf') THEN
            -- æ³¨æ„ï¼šå¦‚æœè¡¨æœ‰å¤–é”®å¼•ç”¨ï¼Œéœ€è¦å…ˆåˆ é™¤å¼•ç”¨è¡¨
            IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'employee_phones') THEN
                DROP TABLE employee_phones CASCADE;
            END IF;
            DROP TABLE employees_1nf CASCADE;
        END IF;

        CREATE TABLE employees_1nf (
            emp_id INTEGER PRIMARY KEY,
            name VARCHAR(50)
        );
        RAISE NOTICE 'è¡¨ employees_1nf åˆ›å»ºæˆåŠŸï¼ˆç¬¦åˆ1NFï¼šä¸»è¡¨ï¼‰';

        CREATE TABLE employee_phones (
            emp_id INTEGER REFERENCES employees_1nf(emp_id),
            phone VARCHAR(20),
            PRIMARY KEY (emp_id, phone)
        );
        RAISE NOTICE 'è¡¨ employee_phones åˆ›å»ºæˆåŠŸï¼ˆç¬¦åˆ1NFï¼šå¤šå€¼å±æ€§ç‹¬ç«‹è¡¨ï¼‰';
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

#### 2.3.2 ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰

**å®šä¹‰**: ç¬¬äºŒèŒƒå¼è¦æ±‚å…³ç³»æ»¡è¶³1NFï¼Œä¸”æ¯ä¸ªéä¸»å±æ€§å®Œå…¨å‡½æ•°ä¾èµ–äºä¸»é”®ï¼ˆä¸èƒ½éƒ¨åˆ†ä¾èµ–ï¼‰ã€‚

**åˆ¤æ–­æ–¹æ³•**:

1. ç¡®å®šå…³ç³»çš„ä¸»é”®ï¼ˆå¯èƒ½æ˜¯å¤åˆä¸»é”®ï¼‰
2. è¯†åˆ«æ‰€æœ‰å‡½æ•°ä¾èµ–
3. æ£€æŸ¥æ˜¯å¦å­˜åœ¨éä¸»å±æ€§åªä¾èµ–äºä¸»é”®çš„ä¸€éƒ¨åˆ†

**è¿å2NFçš„ç¤ºä¾‹**:

```sql
-- è¿å2NFï¼šè®¢å•è¯¦æƒ…è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'order_items_violate_2nf') THEN
            RAISE NOTICE 'è¡¨ order_items_violate_2nf å·²å­˜åœ¨';
        ELSE
            CREATE TABLE order_items_violate_2nf (
                order_id INTEGER,
                product_id INTEGER,
                product_name VARCHAR(100),  -- éƒ¨åˆ†ä¾èµ–ï¼šåªä¾èµ–äºproduct_idï¼Œä¸ä¾èµ–äºorder_id
                quantity INTEGER,
                unit_price DECIMAL(10,2),
                PRIMARY KEY (order_id, product_id)
            );
            RAISE NOTICE 'è¡¨ order_items_violate_2nf åˆ›å»ºæˆåŠŸï¼ˆè¿å2NFç¤ºä¾‹ï¼šproduct_nameéƒ¨åˆ†ä¾èµ–ï¼‰';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ order_items_violate_2nf å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
-- é—®é¢˜ï¼šproduct_nameåªä¾èµ–äºproduct_idï¼Œä¸ä¾èµ–äºå®Œæ•´çš„å¤åˆä¸»é”®(order_id, product_id)
```

**ç¬¦åˆ2NFçš„è®¾è®¡**:

```sql
-- ç¬¦åˆ2NFï¼šå°†éƒ¨åˆ†ä¾èµ–çš„å±æ€§æ‹†åˆ†åˆ°ç‹¬ç«‹è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        -- åˆ›å»ºordersè¡¨
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'orders') THEN
            RAISE NOTICE 'è¡¨ orders å·²å­˜åœ¨';
        ELSE
            CREATE TABLE orders (
                order_id INTEGER PRIMARY KEY,
                order_date DATE
            );
            RAISE NOTICE 'è¡¨ orders åˆ›å»ºæˆåŠŸï¼ˆç¬¦åˆ2NFï¼‰';
        END IF;

        -- åˆ›å»ºproductsè¡¨
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'products') THEN
            RAISE NOTICE 'è¡¨ products å·²å­˜åœ¨';
        ELSE
            CREATE TABLE products (
                product_id INTEGER PRIMARY KEY,
                product_name VARCHAR(100),
                unit_price DECIMAL(10,2)
            );
            RAISE NOTICE 'è¡¨ products åˆ›å»ºæˆåŠŸï¼ˆç¬¦åˆ2NFï¼‰';
        END IF;

        -- åˆ›å»ºorder_items_2nfè¡¨
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'order_items_2nf') THEN
            RAISE NOTICE 'è¡¨ order_items_2nf å·²å­˜åœ¨';
        ELSE
            IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'orders') OR
               NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'products') THEN
                RAISE WARNING 'å¿…éœ€çš„è¡¨ orders æˆ– products ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»º order_items_2nf';
                RETURN;
            END IF;

            CREATE TABLE order_items_2nf (
                order_id INTEGER REFERENCES orders(order_id),
                product_id INTEGER REFERENCES products(product_id),
                quantity INTEGER,
                PRIMARY KEY (order_id, product_id)
            );
            RAISE NOTICE 'è¡¨ order_items_2nf åˆ›å»ºæˆåŠŸï¼ˆç¬¦åˆ2NFï¼šæ¶ˆé™¤éƒ¨åˆ†ä¾èµ–ï¼‰';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'éƒ¨åˆ†è¡¨å·²å­˜åœ¨';
        WHEN undefined_table THEN
            RAISE WARNING 'å¼•ç”¨çš„è¡¨ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

**èŒƒå¼è½¬æ¢æ­¥éª¤**:

1. è¯†åˆ«éƒ¨åˆ†ä¾èµ–ï¼šæ‰¾å‡ºåªä¾èµ–äºä¸»é”®ä¸€éƒ¨åˆ†çš„éä¸»å±æ€§
2. åˆ›å»ºæ–°è¡¨ï¼šå°†éƒ¨åˆ†ä¾èµ–çš„å±æ€§æ‹†åˆ†åˆ°ç‹¬ç«‹è¡¨
3. å»ºç«‹å¤–é”®å…³ç³»ï¼šä¿æŒæ•°æ®å®Œæ•´æ€§

#### 2.3.3 ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰

**å®šä¹‰**: ç¬¬ä¸‰èŒƒå¼è¦æ±‚å…³ç³»æ»¡è¶³2NFï¼Œä¸”æ¯ä¸ªéä¸»å±æ€§ä¸ä¼ é€’ä¾èµ–äºä¸»é”®ã€‚

**åˆ¤æ–­æ–¹æ³•**:

1. ç¡®å®šå…³ç³»æ»¡è¶³2NF
2. è¯†åˆ«æ‰€æœ‰å‡½æ•°ä¾èµ–
3. æ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¼ é€’ä¾èµ–ï¼šA â†’ B â†’ Cï¼Œå…¶ä¸­Aæ˜¯ä¸»é”®ï¼ŒBå’ŒCæ˜¯éä¸»å±æ€§

**è¿å3NFçš„ç¤ºä¾‹**:

```sql
-- è¿å3NFï¼šå‘˜å·¥è¡¨å­˜åœ¨ä¼ é€’ä¾èµ–ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'employees_violate_3nf') THEN
            RAISE NOTICE 'è¡¨ employees_violate_3nf å·²å­˜åœ¨';
        ELSE
            CREATE TABLE employees_violate_3nf (
                emp_id INTEGER PRIMARY KEY,
                name VARCHAR(50),
                dept_id INTEGER,
                dept_name VARCHAR(50),  -- ä¼ é€’ä¾èµ–ï¼šemp_id â†’ dept_id â†’ dept_name
                dept_location VARCHAR(100)  -- ä¼ é€’ä¾èµ–ï¼šemp_id â†’ dept_id â†’ dept_location
            );
            RAISE NOTICE 'è¡¨ employees_violate_3nf åˆ›å»ºæˆåŠŸï¼ˆè¿å3NFç¤ºä¾‹ï¼šå­˜åœ¨ä¼ é€’ä¾èµ–ï¼‰';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ employees_violate_3nf å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
-- é—®é¢˜ï¼šdept_nameå’Œdept_locationé€šè¿‡dept_idä¼ é€’ä¾èµ–äºemp_id
```

**ç¬¦åˆ3NFçš„è®¾è®¡**:

```sql
-- ç¬¦åˆ3NFï¼šæ¶ˆé™¤ä¼ é€’ä¾èµ–ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        -- å…ˆåˆ›å»ºdepartmentsè¡¨ï¼ˆè¢«å¼•ç”¨è¡¨ï¼‰
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'departments') THEN
            RAISE NOTICE 'è¡¨ departments å·²å­˜åœ¨';
        ELSE
            CREATE TABLE departments (
                dept_id INTEGER PRIMARY KEY,
                dept_name VARCHAR(50),
                dept_location VARCHAR(100)
            );
            RAISE NOTICE 'è¡¨ departments åˆ›å»ºæˆåŠŸï¼ˆç¬¦åˆ3NFï¼šæ¶ˆé™¤ä¼ é€’ä¾èµ–ï¼‰';
        END IF;

        -- åˆ›å»ºemployees_3nfè¡¨ï¼ˆå¼•ç”¨departmentsï¼‰
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'employees_3nf') THEN
            RAISE NOTICE 'è¡¨ employees_3nf å·²å­˜åœ¨';
        ELSE
            IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'departments') THEN
                RAISE WARNING 'è¡¨ departments ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»º employees_3nf';
                RETURN;
            END IF;

            CREATE TABLE employees_3nf (
                emp_id INTEGER PRIMARY KEY,
                name VARCHAR(50),
                dept_id INTEGER REFERENCES departments(dept_id)
            );
            RAISE NOTICE 'è¡¨ employees_3nf åˆ›å»ºæˆåŠŸï¼ˆç¬¦åˆ3NFï¼šæ¶ˆé™¤ä¼ é€’ä¾èµ–ï¼‰';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'éƒ¨åˆ†è¡¨å·²å­˜åœ¨';
        WHEN undefined_table THEN
            RAISE WARNING 'å¼•ç”¨çš„è¡¨ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

**èŒƒå¼è½¬æ¢æ­¥éª¤**:

1. è¯†åˆ«ä¼ é€’ä¾èµ–ï¼šæ‰¾å‡ºé€šè¿‡ä¸­é—´å±æ€§ä¼ é€’ä¾èµ–çš„éä¸»å±æ€§
2. åˆ›å»ºæ–°è¡¨ï¼šå°†ä¼ é€’ä¾èµ–çš„å±æ€§æ‹†åˆ†åˆ°ç‹¬ç«‹è¡¨
3. å»ºç«‹å¤–é”®å…³ç³»ï¼šä¿æŒæ•°æ®å®Œæ•´æ€§

#### 2.3.4 BCNFï¼ˆBoyce-CoddèŒƒå¼ï¼‰

**å®šä¹‰**: BCNFè¦æ±‚å…³ç³»æ»¡è¶³3NFï¼Œä¸”æ¯ä¸ªå‡½æ•°ä¾èµ–çš„å†³å®šå› ç´ éƒ½æ˜¯è¶…é”®ã€‚

**åˆ¤æ–­æ–¹æ³•**:

1. ç¡®å®šå…³ç³»æ»¡è¶³3NF
2. è¯†åˆ«æ‰€æœ‰å‡½æ•°ä¾èµ–
3. æ£€æŸ¥æ˜¯å¦å­˜åœ¨éè¶…é”®çš„å†³å®šå› ç´ 

**è¿åBCNFçš„ç¤ºä¾‹**:

```sql
-- è¿åBCNFï¼šè¯¾ç¨‹è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'courses_violate_bcnf') THEN
            RAISE NOTICE 'è¡¨ courses_violate_bcnf å·²å­˜åœ¨';
        ELSE
            CREATE TABLE courses_violate_bcnf (
                student_id INTEGER,
                course_id INTEGER,
                instructor_id INTEGER,
                instructor_name VARCHAR(50),  -- ä¾èµ–äºinstructor_idï¼Œä½†instructor_idä¸æ˜¯è¶…é”®
                PRIMARY KEY (student_id, course_id)
            );
            RAISE NOTICE 'è¡¨ courses_violate_bcnf åˆ›å»ºæˆåŠŸï¼ˆè¿åBCNFç¤ºä¾‹ï¼šinstructor_nameä¾èµ–äºéè¶…é”®ï¼‰';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ courses_violate_bcnf å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
-- é—®é¢˜ï¼šinstructor_id â†’ instructor_nameï¼Œä½†instructor_idä¸æ˜¯ä¸»é”®
-- å‡è®¾ï¼šä¸€ä¸ªè¯¾ç¨‹åªèƒ½ç”±ä¸€ä¸ªæ•™å¸ˆæ•™æˆï¼Œä½†ä¸€ä¸ªæ•™å¸ˆå¯ä»¥æ•™æˆå¤šé—¨è¯¾ç¨‹
```

**ç¬¦åˆBCNFçš„è®¾è®¡**:

```sql
-- ç¬¦åˆBCNFï¼šå°†éè¶…é”®å†³å®šå› ç´ æ‹†åˆ†ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        -- å…ˆåˆ›å»ºinstructorsè¡¨ï¼ˆè¢«å¼•ç”¨è¡¨ï¼‰
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'instructors') THEN
            RAISE NOTICE 'è¡¨ instructors å·²å­˜åœ¨';
        ELSE
            CREATE TABLE instructors (
                instructor_id INTEGER PRIMARY KEY,
                instructor_name VARCHAR(50)
            );
            RAISE NOTICE 'è¡¨ instructors åˆ›å»ºæˆåŠŸï¼ˆç¬¦åˆBCNFï¼‰';
        END IF;

        -- åˆ›å»ºcourses_bcnfè¡¨
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'courses_bcnf') THEN
            RAISE NOTICE 'è¡¨ courses_bcnf å·²å­˜åœ¨';
        ELSE
            IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'instructors') THEN
                RAISE WARNING 'è¡¨ instructors ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»º courses_bcnf';
                RETURN;
            END IF;

            CREATE TABLE courses_bcnf (
                student_id INTEGER,
                course_id INTEGER,
                instructor_id INTEGER,
                PRIMARY KEY (student_id, course_id),
                FOREIGN KEY (instructor_id) REFERENCES instructors(instructor_id)
            );
            RAISE NOTICE 'è¡¨ courses_bcnf åˆ›å»ºæˆåŠŸï¼ˆç¬¦åˆBCNFï¼‰';
        END IF;

        -- åˆ›å»ºcourse_instructorsè¡¨
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'course_instructors') THEN
            RAISE NOTICE 'è¡¨ course_instructors å·²å­˜åœ¨';
        ELSE
            IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'instructors') THEN
                RAISE WARNING 'è¡¨ instructors ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»º course_instructors';
                RETURN;
            END IF;

            CREATE TABLE course_instructors (
                course_id INTEGER PRIMARY KEY,
                instructor_id INTEGER REFERENCES instructors(instructor_id)
            );
            RAISE NOTICE 'è¡¨ course_instructors åˆ›å»ºæˆåŠŸï¼ˆç¬¦åˆBCNFï¼‰';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'éƒ¨åˆ†è¡¨å·²å­˜åœ¨';
        WHEN undefined_table THEN
            RAISE WARNING 'å¼•ç”¨çš„è¡¨ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

#### 2.3.5 èŒƒå¼è½¬æ¢å®é™…æ¡ˆä¾‹

**æ¡ˆä¾‹ï¼šç”µå•†è®¢å•ç³»ç»Ÿè®¾è®¡**:

**åˆå§‹è®¾è®¡ï¼ˆè¿åèŒƒå¼ï¼‰**:

```sql
-- åˆå§‹è®¾è®¡ï¼šåŒ…å«å¤šä¸ªèŒƒå¼è¿åï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'orders_violate') THEN
            RAISE NOTICE 'è¡¨ orders_violate å·²å­˜åœ¨';
        ELSE
            CREATE TABLE orders_violate (
                order_id INTEGER,
                customer_id INTEGER,
                customer_name VARCHAR(50),  -- ä¼ é€’ä¾èµ–
                customer_email VARCHAR(100),  -- ä¼ é€’ä¾èµ–
                product_id INTEGER,
                product_name VARCHAR(100),  -- éƒ¨åˆ†ä¾èµ–
                product_price DECIMAL(10,2),  -- éƒ¨åˆ†ä¾èµ–
                quantity INTEGER,
                order_date DATE,
                PRIMARY KEY (order_id, product_id)
            );
            RAISE NOTICE 'è¡¨ orders_violate åˆ›å»ºæˆåŠŸï¼ˆåˆå§‹è®¾è®¡ï¼šåŒ…å«å¤šä¸ªèŒƒå¼è¿åï¼‰';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ orders_violate å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

**é€æ­¥è§„èŒƒåŒ–**:

```sql
-- ç¬¬ä¸€æ­¥ï¼šæ»¡è¶³1NFï¼ˆå‡è®¾å·²æ»¡è¶³ï¼‰

-- ç¬¬äºŒæ­¥ï¼šæ»¡è¶³2NF - æ¶ˆé™¤éƒ¨åˆ†ä¾èµ–ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        -- åˆ›å»ºorders_2nfè¡¨
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'orders_2nf') THEN
            RAISE NOTICE 'è¡¨ orders_2nf å·²å­˜åœ¨';
        ELSE
            CREATE TABLE orders_2nf (
                order_id INTEGER PRIMARY KEY,
                customer_id INTEGER,
                order_date DATE
            );
            RAISE NOTICE 'è¡¨ orders_2nf åˆ›å»ºæˆåŠŸï¼ˆç¬¦åˆ2NFï¼‰';
        END IF;

        -- åˆ›å»ºproductsè¡¨ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'products') THEN
            RAISE NOTICE 'è¡¨ products å·²å­˜åœ¨';
        ELSE
            CREATE TABLE products (
                product_id INTEGER PRIMARY KEY,
                product_name VARCHAR(100),
                product_price DECIMAL(10,2)
            );
            RAISE NOTICE 'è¡¨ products åˆ›å»ºæˆåŠŸï¼ˆç¬¦åˆ2NFï¼‰';
        END IF;

        -- åˆ›å»ºorder_items_2nfè¡¨
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'order_items_2nf') THEN
            RAISE NOTICE 'è¡¨ order_items_2nf å·²å­˜åœ¨';
        ELSE
            IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'orders_2nf') OR
               NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'products') THEN
                RAISE WARNING 'å¿…éœ€çš„è¡¨ orders_2nf æˆ– products ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»º order_items_2nf';
                RETURN;
            END IF;

            CREATE TABLE order_items_2nf (
                order_id INTEGER REFERENCES orders_2nf(order_id),
                product_id INTEGER REFERENCES products(product_id),
                quantity INTEGER,
                PRIMARY KEY (order_id, product_id)
            );
            RAISE NOTICE 'è¡¨ order_items_2nf åˆ›å»ºæˆåŠŸï¼ˆç¬¦åˆ2NFï¼šæ¶ˆé™¤éƒ¨åˆ†ä¾èµ–ï¼‰';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'éƒ¨åˆ†è¡¨å·²å­˜åœ¨';
        WHEN undefined_table THEN
            RAISE WARNING 'å¼•ç”¨çš„è¡¨ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- ç¬¬ä¸‰æ­¥ï¼šæ»¡è¶³3NF - æ¶ˆé™¤ä¼ é€’ä¾èµ–ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        -- åˆ›å»ºcustomersè¡¨
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'customers') THEN
            RAISE NOTICE 'è¡¨ customers å·²å­˜åœ¨';
        ELSE
            CREATE TABLE customers (
                customer_id INTEGER PRIMARY KEY,
                customer_name VARCHAR(50),
                customer_email VARCHAR(100)
            );
            RAISE NOTICE 'è¡¨ customers åˆ›å»ºæˆåŠŸï¼ˆç¬¦åˆ3NFï¼šæ¶ˆé™¤ä¼ é€’ä¾èµ–ï¼‰';
        END IF;

        -- åˆ›å»ºorders_3nfè¡¨
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'orders_3nf') THEN
            RAISE NOTICE 'è¡¨ orders_3nf å·²å­˜åœ¨';
        ELSE
            IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'customers') THEN
                RAISE WARNING 'è¡¨ customers ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»º orders_3nf';
                RETURN;
            END IF;

            CREATE TABLE orders_3nf (
                order_id INTEGER PRIMARY KEY,
                customer_id INTEGER REFERENCES customers(customer_id),
                order_date DATE
            );
            RAISE NOTICE 'è¡¨ orders_3nf åˆ›å»ºæˆåŠŸï¼ˆç¬¦åˆ3NFï¼šæ¶ˆé™¤ä¼ é€’ä¾èµ–ï¼‰';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'éƒ¨åˆ†è¡¨å·²å­˜åœ¨';
        WHEN undefined_table THEN
            RAISE WARNING 'å¼•ç”¨çš„è¡¨ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- ç¬¬å››æ­¥ï¼šæ£€æŸ¥BCNFï¼ˆå‡è®¾å·²æ»¡è¶³ï¼‰
```

**èŒƒå¼é€‰æ‹©å»ºè®®**:

| èŒƒå¼çº§åˆ« | é€‚ç”¨åœºæ™¯ | æƒè¡¡ |
| --- | --- | --- |
| 1NF | æ‰€æœ‰åœºæ™¯ï¼ˆå¿…é¡»ï¼‰ | æ—  |
| 2NF | ä¸€èˆ¬åº”ç”¨ | å‡å°‘å†—ä½™ï¼Œå¯èƒ½å¢åŠ è¿æ¥ |
| 3NF | è§„èŒƒåŒ–è®¾è®¡ï¼ˆæ¨èï¼‰ | å¹³è¡¡å†—ä½™å’Œæ€§èƒ½ |
| BCNF | ç†è®ºè®¾è®¡ | æœ€è§„èŒƒï¼Œä½†å¯èƒ½è¿‡åº¦è§„èŒƒåŒ– |

**åè§„èŒƒåŒ–è€ƒè™‘**:

åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œä¸ºäº†æ€§èƒ½è€ƒè™‘ï¼Œå¯èƒ½éœ€è¦é€‚åº¦åè§„èŒƒåŒ–ï¼š

```sql
-- åè§„èŒƒåŒ–ç¤ºä¾‹ï¼šåœ¨è®¢å•è¡¨ä¸­å†—ä½™å­˜å‚¨äº§å“ä»·æ ¼ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'order_items_denormalized') THEN
            RAISE NOTICE 'è¡¨ order_items_denormalized å·²å­˜åœ¨';
        ELSE
            CREATE TABLE order_items_denormalized (
                order_id INTEGER,
                product_id INTEGER,
                product_name VARCHAR(100),  -- å†—ä½™ï¼šä½†é¿å…è¿æ¥æŸ¥è¯¢
                product_price DECIMAL(10,2),  -- å†—ä½™ï¼šä¿å­˜å†å²ä»·æ ¼
                quantity INTEGER,
                PRIMARY KEY (order_id, product_id)
            );
            RAISE NOTICE 'è¡¨ order_items_denormalized åˆ›å»ºæˆåŠŸï¼ˆåè§„èŒƒåŒ–ç¤ºä¾‹ï¼šå†—ä½™å­˜å‚¨äº§å“ä»·æ ¼ï¼‰';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ order_items_denormalized å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
-- ä¼˜ç‚¹ï¼šæŸ¥è¯¢æ€§èƒ½æ›´å¥½ï¼Œé¿å…è¿æ¥
-- ç¼ºç‚¹ï¼šæ•°æ®å†—ä½™ï¼Œæ›´æ–°æ—¶éœ€è¦åŒæ­¥
```

**æœ€ä½³å®è·µ**:

1. **è®¾è®¡é˜¶æ®µ**: å…ˆè§„èŒƒåŒ–åˆ°3NFï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
2. **æ€§èƒ½ä¼˜åŒ–**: æ ¹æ®æŸ¥è¯¢æ¨¡å¼é€‚åº¦åè§„èŒƒåŒ–
3. **ç›‘æ§ç»´æŠ¤**: å®šæœŸæ£€æŸ¥æ•°æ®ä¸€è‡´æ€§å’Œæ€§èƒ½
4. **æ–‡æ¡£è®°å½•**: è®°å½•åè§„èŒƒåŒ–çš„åŸå› å’Œå½±å“

---

## ä¸‰ã€çŸ¥è¯†çŸ©é˜µå¯¹æ¯”

### 3.1 èŒƒå¼å¯¹æ¯”

| èŒƒå¼ | å®šä¹‰ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
| --- | --- | --- | --- | --- |
| 1NF | å±æ€§åŸå­æ€§ | ç®€å•ã€ç›´è§‚ | æ•°æ®å†—ä½™ | æ‰€æœ‰åœºæ™¯ |
| 2NF | æ¶ˆé™¤éƒ¨åˆ†ä¾èµ– | å‡å°‘å†—ä½™ | ä»å¯èƒ½æœ‰ä¼ é€’ä¾èµ– | ä¸€èˆ¬åº”ç”¨ |
| 3NF | æ¶ˆé™¤ä¼ é€’ä¾èµ– | è¿›ä¸€æ­¥å‡å°‘å†—ä½™ | å¯èƒ½å½±å“æ€§èƒ½ | è§„èŒƒåŒ–è®¾è®¡ |
| BCNF | æ¶ˆé™¤æ‰€æœ‰ä¾èµ– | æœ€è§„èŒƒ | å¯èƒ½è¿‡åº¦è§„èŒƒåŒ– | ç†è®ºè®¾è®¡ |
| 4NF | æ¶ˆé™¤å¤šå€¼ä¾èµ– | å¤„ç†å¤šå€¼å±æ€§ | å¤æ‚åº¦é«˜ | ç‰¹æ®Šåœºæ™¯ |

### 3.2 çº¦æŸç±»å‹å¯¹æ¯”

| çº¦æŸç±»å‹ | ä½œç”¨ | æ€§èƒ½å½±å“ | é€‚ç”¨åœºæ™¯ | PostgreSQLæ”¯æŒ |
| --- | --- | --- | --- | --- |
| ä¸»é”®çº¦æŸ | å”¯ä¸€æ€§+éç©º | ä½ï¼ˆæœ‰ç´¢å¼•ï¼‰ | æ‰€æœ‰è¡¨ | âœ… |
| å¤–é”®çº¦æŸ | å¼•ç”¨å®Œæ•´æ€§ | ä¸­ï¼ˆéœ€è¦æ£€æŸ¥ï¼‰ | å…³è”è¡¨ | âœ… |
| å”¯ä¸€çº¦æŸ | å”¯ä¸€æ€§ | ä½ï¼ˆæœ‰ç´¢å¼•ï¼‰ | å”¯ä¸€å­—æ®µ | âœ… |
| æ£€æŸ¥çº¦æŸ | æ•°æ®æœ‰æ•ˆæ€§ | ä½ | æ•°æ®éªŒè¯ | âœ… |
| éç©ºçº¦æŸ | éç©ºæ€§ | æ—  | å¿…å¡«å­—æ®µ | âœ… |
| æ’é™¤çº¦æŸ | å¤æ‚æ¡ä»¶ | ä¸­ | ç‰¹æ®Šéœ€æ±‚ | âœ… |

---

## å››ã€PostgreSQLå®ç°

### 4.1 æ•°æ®ç±»å‹ç³»ç»Ÿ

```sql
-- åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'example_table') THEN
            RAISE NOTICE 'è¡¨ example_table å·²å­˜åœ¨';
        ELSE
            CREATE TABLE example_table (
                id INTEGER PRIMARY KEY,
                name VARCHAR(50) NOT NULL,
                salary DECIMAL(10,2),
                hire_date DATE,
                active BOOLEAN DEFAULT TRUE,
                profile JSONB,
                tags TEXT[]
            );
            RAISE NOTICE 'è¡¨ example_table åˆ›å»ºæˆåŠŸï¼ˆåŸºæœ¬æ•°æ®ç±»å‹ç¤ºä¾‹ï¼‰';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ example_table å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- è‡ªå®šä¹‰æ•°æ®ç±»å‹ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        -- åˆ›å»ºæšä¸¾ç±»å‹
        IF EXISTS (SELECT 1 FROM pg_type WHERE typname = 'employee_status') THEN
            RAISE NOTICE 'ç±»å‹ employee_status å·²å­˜åœ¨';
        ELSE
            CREATE TYPE employee_status AS ENUM ('active', 'inactive', 'terminated');
            RAISE NOTICE 'ç±»å‹ employee_status åˆ›å»ºæˆåŠŸ';
        END IF;

        -- åˆ›å»ºå¤åˆç±»å‹
        IF EXISTS (SELECT 1 FROM pg_type WHERE typname = 'address') THEN
            RAISE NOTICE 'ç±»å‹ address å·²å­˜åœ¨';
        ELSE
            CREATE TYPE address AS (
                street VARCHAR(100),
                city VARCHAR(50),
                postal_code VARCHAR(10)
            );
            RAISE NOTICE 'ç±»å‹ address åˆ›å»ºæˆåŠŸ';
        END IF;
    EXCEPTION
        WHEN duplicate_object THEN
            RAISE WARNING 'éƒ¨åˆ†ç±»å‹å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºç±»å‹å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

### 4.2 çº¦æŸç³»ç»Ÿ

```sql
-- å®ä½“å®Œæ•´æ€§çº¦æŸï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        -- å…ˆåˆ›å»ºdepartmentsè¡¨ï¼ˆè¢«å¼•ç”¨è¡¨ï¼‰
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'departments') THEN
            RAISE NOTICE 'è¡¨ departments å·²å­˜åœ¨';
        ELSE
            CREATE TABLE departments (
                dept_id INTEGER PRIMARY KEY,
                dept_name VARCHAR(50) NOT NULL,
                manager_id INTEGER  -- æš‚æ—¶ä¸å¼•ç”¨employeesï¼Œé¿å…å¾ªç¯ä¾èµ–
            );
            RAISE NOTICE 'è¡¨ departments åˆ›å»ºæˆåŠŸï¼ˆå‚ç…§å®Œæ•´æ€§çº¦æŸç¤ºä¾‹ï¼‰';
        END IF;

        -- åˆ›å»ºemployeesè¡¨ï¼ˆå¼•ç”¨departmentsï¼‰
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'employees') THEN
            RAISE NOTICE 'è¡¨ employees å·²å­˜åœ¨';
        ELSE
            IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'departments') THEN
                RAISE WARNING 'è¡¨ departments ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»º employees';
                RETURN;
            END IF;

            CREATE TABLE employees (
                emp_id INTEGER PRIMARY KEY,
                name VARCHAR(50) NOT NULL,
                email VARCHAR(100) UNIQUE,
                dept_id INTEGER REFERENCES departments(dept_id),
                salary DECIMAL(10,2) CHECK (salary > 0),
                CONSTRAINT emp_salary_check CHECK (salary >= 0 AND salary <= 1000000)
            );
            RAISE NOTICE 'è¡¨ employees åˆ›å»ºæˆåŠŸï¼ˆå®ä½“å®Œæ•´æ€§çº¦æŸç¤ºä¾‹ï¼‰';
        END IF;

        -- æ›´æ–°departmentsè¡¨çš„manager_idå¤–é”®ï¼ˆå¦‚æœemployeesè¡¨å·²åˆ›å»ºï¼‰
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'employees') THEN
            BEGIN
                ALTER TABLE departments
                ADD CONSTRAINT dept_manager_fk
                FOREIGN KEY (manager_id) REFERENCES employees(emp_id);
                RAISE NOTICE 'departmentsè¡¨çš„manager_idå¤–é”®çº¦æŸæ·»åŠ æˆåŠŸ';
            EXCEPTION
                WHEN duplicate_object THEN
                    RAISE NOTICE 'departmentsè¡¨çš„manager_idå¤–é”®çº¦æŸå·²å­˜åœ¨';
                WHEN OTHERS THEN
                    RAISE WARNING 'æ·»åŠ å¤–é”®çº¦æŸå¤±è´¥: %', SQLERRM;
            END;
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'éƒ¨åˆ†è¡¨å·²å­˜åœ¨';
        WHEN undefined_table THEN
            RAISE WARNING 'å¼•ç”¨çš„è¡¨ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

**PostgreSQL 18æ–°ç‰¹æ€§ï¼šè™šæ‹Ÿç”Ÿæˆåˆ—ï¼ˆVirtual Generated Columnsï¼‰** ğŸ†•

PostgreSQL 18æ”¯æŒè™šæ‹Ÿç”Ÿæˆåˆ—ï¼Œå…è®¸å®šä¹‰åŸºäºè¡¨è¾¾å¼çš„åˆ—ï¼Œæ— éœ€å­˜å‚¨ç©ºé—´ï¼Œæ˜¯å…³ç³»æ•°æ®æ¨¡å‹çš„é‡è¦æ‰©å±•ã€‚

**è¯­æ³•**:

```sql
-- åˆ›å»ºåŒ…å«è™šæ‹Ÿç”Ÿæˆåˆ—çš„è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼ŒPostgreSQL 18ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'products') THEN
            RAISE NOTICE 'è¡¨ products å·²å­˜åœ¨';
        ELSE
            -- æ£€æŸ¥PostgreSQLç‰ˆæœ¬æ˜¯å¦æ”¯æŒè™šæ‹Ÿç”Ÿæˆåˆ—ï¼ˆPostgreSQL 18+ï¼‰
            IF (SELECT current_setting('server_version_num')::INT) < 180000 THEN
                RAISE WARNING 'è™šæ‹Ÿç”Ÿæˆåˆ—ï¼ˆVIRTUALï¼‰ä»…åœ¨PostgreSQL 18+ä¸­æ”¯æŒï¼Œå½“å‰ç‰ˆæœ¬å¯èƒ½ä¸æ”¯æŒ';
            END IF;

            CREATE TABLE products (
                id SERIAL PRIMARY KEY,
                name TEXT NOT NULL,
                price DECIMAL(10,2) NOT NULL,
                tax_rate DECIMAL(5,2) DEFAULT 0.20,
                price_with_tax DECIMAL(10,2) GENERATED ALWAYS AS (price * (1 + tax_rate)) STORED,  -- å­˜å‚¨ç”Ÿæˆåˆ—
                price_display TEXT GENERATED ALWAYS AS ('$' || price::TEXT) VIRTUAL  -- è™šæ‹Ÿç”Ÿæˆåˆ—ï¼ˆPostgreSQL 18ï¼‰
            );
            RAISE NOTICE 'è¡¨ products åˆ›å»ºæˆåŠŸï¼ˆåŒ…å«è™šæ‹Ÿç”Ÿæˆåˆ—ï¼ŒPostgreSQL 18ï¼‰';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ products å·²å­˜åœ¨';
        WHEN syntax_error THEN
            RAISE WARNING 'è¯­æ³•é”™è¯¯ï¼šå¯èƒ½PostgreSQLç‰ˆæœ¬ä¸æ”¯æŒè™šæ‹Ÿç”Ÿæˆåˆ—ï¼ˆéœ€è¦PostgreSQL 18+ï¼‰';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
-- è™šæ‹Ÿç”Ÿæˆåˆ—ä¸å ç”¨å­˜å‚¨ç©ºé—´
-- å­˜å‚¨ç”Ÿæˆåˆ—å ç”¨å­˜å‚¨ç©ºé—´ä½†æŸ¥è¯¢æ›´å¿«
```

**ä¸å­˜å‚¨ç”Ÿæˆåˆ—å¯¹æ¯”**:

| ç‰¹æ€§ | å­˜å‚¨ç”Ÿæˆåˆ—ï¼ˆSTOREDï¼‰ | è™šæ‹Ÿç”Ÿæˆåˆ—ï¼ˆVIRTUALï¼‰ |
| --- | --- | --- |
| å­˜å‚¨ç©ºé—´ | âœ… å ç”¨ | âŒ ä¸å ç”¨ |
| æŸ¥è¯¢æ€§èƒ½ | âœ… æ›´å¿«ï¼ˆå·²è®¡ç®—ï¼‰ | âš ï¸ æ¯æ¬¡è®¡ç®— |
| ç´¢å¼•æ”¯æŒ | âœ… æ”¯æŒ | âœ… æ”¯æŒï¼ˆPostgreSQL 18ï¼‰ |
| æ›´æ–°æ€§èƒ½ | âš ï¸ å†™å…¥æ—¶è®¡ç®— | âœ… æ— å†™å…¥å¼€é”€ |

**ä½¿ç”¨åœºæ™¯**:

1. **è®¡ç®—å­—æ®µ**

   ```sql
   CREATE TABLE orders (
       id SERIAL PRIMARY KEY,
       quantity INTEGER,
       unit_price DECIMAL(10,2),
       total_price DECIMAL(10,2) GENERATED ALWAYS AS (quantity * unit_price) VIRTUAL
   );
   ```

2. **æ ¼å¼åŒ–æ˜¾ç¤º**

   ```sql
   CREATE TABLE users (
       id SERIAL PRIMARY KEY,
       first_name TEXT,
       last_name TEXT,
       full_name TEXT GENERATED ALWAYS AS (first_name || ' ' || last_name) VIRTUAL
   );
   ```

3. **ç´¢å¼•ä¼˜åŒ–**

   ```sql
   -- åœ¨è™šæ‹Ÿç”Ÿæˆåˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼ˆPostgreSQL 18ï¼‰
   CREATE INDEX idx_price_display ON products(price_display);

   -- æŸ¥è¯¢æ—¶å¯ä»¥ä½¿ç”¨è™šæ‹Ÿç”Ÿæˆåˆ—
   SELECT * FROM products WHERE price_display LIKE '$100%';
   ```

**æœ€ä½³å®è·µ**:

- è™šæ‹Ÿç”Ÿæˆåˆ—é€‚ç”¨äºï¼šè®¡ç®—ç®€å•ã€æŸ¥è¯¢é¢‘ç¹ã€æ›´æ–°é¢‘ç¹çš„åœºæ™¯
- å­˜å‚¨ç”Ÿæˆåˆ—é€‚ç”¨äºï¼šè®¡ç®—å¤æ‚ã€æŸ¥è¯¢é¢‘ç¹ã€æ›´æ–°è¾ƒå°‘çš„åœºæ™¯
- PostgreSQL 18æ”¯æŒåœ¨è™šæ‹Ÿç”Ÿæˆåˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼Œè¿›ä¸€æ­¥æå‡æŸ¥è¯¢æ€§èƒ½

### 4.3 å…³ç³»æ“ä½œå®ç°

```sql
-- é€‰æ‹©æ“ä½œï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'employees') THEN
            RAISE WARNING 'è¡¨ employees ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡Œé€‰æ‹©æ“ä½œ';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡Œé€‰æ‹©æ“ä½œ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'é€‰æ‹©æ“ä½œå‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT * FROM employees WHERE salary > 50000;

-- æŠ•å½±æ“ä½œï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'employees') THEN
            RAISE WARNING 'è¡¨ employees ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡ŒæŠ•å½±æ“ä½œ';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡ŒæŠ•å½±æ“ä½œ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'æŠ•å½±æ“ä½œå‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT name, dept_id FROM employees;

-- è¿æ¥æ“ä½œï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'employees') THEN
            RAISE EXCEPTION 'è¡¨ employees ä¸å­˜åœ¨';
        END IF;

        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'departments') THEN
            RAISE EXCEPTION 'è¡¨ departments ä¸å­˜åœ¨';
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡Œè¿æ¥æ“ä½œ';
    EXCEPTION
        WHEN undefined_table THEN
            RAISE EXCEPTION 'è¡¨ä¸å­˜åœ¨ï¼ˆè¯·æ£€æŸ¥employeeså’Œdepartmentsè¡¨ï¼‰';
        WHEN OTHERS THEN
            RAISE WARNING 'è¿æ¥æ“ä½œå‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT e.name, d.dept_name
FROM employees e
JOIN departments d ON e.dept_id = d.dept_id;

-- å¹¶æ“ä½œï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'employees_2023') THEN
            RAISE EXCEPTION 'è¡¨ employees_2023 ä¸å­˜åœ¨';
        END IF;

        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'employees_2024') THEN
            RAISE EXCEPTION 'è¡¨ employees_2024 ä¸å­˜åœ¨';
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡Œå¹¶æ“ä½œ';
    EXCEPTION
        WHEN undefined_table THEN
            RAISE EXCEPTION 'è¡¨ä¸å­˜åœ¨ï¼ˆè¯·æ£€æŸ¥employees_2023å’Œemployees_2024è¡¨ï¼‰';
        WHEN OTHERS THEN
            RAISE WARNING 'å¹¶æ“ä½œå‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT name FROM employees_2023
UNION
SELECT name FROM employees_2024;

-- å·®æ“ä½œï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'employees_2023') THEN
            RAISE EXCEPTION 'è¡¨ employees_2023 ä¸å­˜åœ¨';
        END IF;

        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'employees_2024') THEN
            RAISE EXCEPTION 'è¡¨ employees_2024 ä¸å­˜åœ¨';
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡Œå·®æ“ä½œ';
    EXCEPTION
        WHEN undefined_table THEN
            RAISE EXCEPTION 'è¡¨ä¸å­˜åœ¨ï¼ˆè¯·æ£€æŸ¥employees_2023å’Œemployees_2024è¡¨ï¼‰';
        WHEN OTHERS THEN
            RAISE WARNING 'å·®æ“ä½œå‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT name FROM employees_2023
EXCEPT
SELECT name FROM employees_2024;
```

## äº”ã€é«˜çº§ç‰¹æ€§

### 5.1 è§†å›¾ç³»ç»Ÿ

```sql
-- ç®€å•è§†å›¾ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.views WHERE table_schema = 'public' AND table_name = 'emp_summary') THEN
            RAISE NOTICE 'è§†å›¾ emp_summary å·²å­˜åœ¨';
        ELSE
            IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'employees') THEN
                RAISE WARNING 'è¡¨ employees ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºè§†å›¾ emp_summary';
                RETURN;
            END IF;

            CREATE VIEW emp_summary AS
            SELECT
                dept_id,
                COUNT(*) as emp_count,
                AVG(salary) as avg_salary,
                MAX(salary) as max_salary
            FROM employees
            GROUP BY dept_id;
            RAISE NOTICE 'è§†å›¾ emp_summary åˆ›å»ºæˆåŠŸ';
        END IF;
    EXCEPTION
        WHEN duplicate_object THEN
            RAISE WARNING 'è§†å›¾ emp_summary å·²å­˜åœ¨';
        WHEN undefined_table THEN
            RAISE WARNING 'åŸºç¡€è¡¨ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè§†å›¾å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- å¯æ›´æ–°è§†å›¾ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.views WHERE table_schema = 'public' AND table_name = 'emp_public') THEN
            RAISE NOTICE 'è§†å›¾ emp_public å·²å­˜åœ¨';
        ELSE
            IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'employees') THEN
                RAISE WARNING 'è¡¨ employees ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºè§†å›¾ emp_public';
                RETURN;
            END IF;

            CREATE VIEW emp_public AS
            SELECT emp_id, name, dept_id
            FROM employees
            WHERE active = true;
            RAISE NOTICE 'è§†å›¾ emp_public åˆ›å»ºæˆåŠŸï¼ˆå¯æ›´æ–°è§†å›¾ï¼‰';
        END IF;
    EXCEPTION
        WHEN duplicate_object THEN
            RAISE WARNING 'è§†å›¾ emp_public å·²å­˜åœ¨';
        WHEN undefined_table THEN
            RAISE WARNING 'åŸºç¡€è¡¨ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè§†å›¾å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- ç‰©åŒ–è§†å›¾ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'emp_stats' AND table_type = 'BASE TABLE') OR
           EXISTS (SELECT 1 FROM pg_matviews WHERE schemaname = 'public' AND matviewname = 'emp_stats') THEN
            RAISE NOTICE 'ç‰©åŒ–è§†å›¾ emp_stats å·²å­˜åœ¨';
        ELSE
            IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'employees') THEN
                RAISE WARNING 'è¡¨ employees ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºç‰©åŒ–è§†å›¾ emp_stats';
                RETURN;
            END IF;

            CREATE MATERIALIZED VIEW emp_stats AS
            SELECT
                dept_id,
                COUNT(*) as emp_count,
                AVG(salary) as avg_salary
            FROM employees
            GROUP BY dept_id;
            RAISE NOTICE 'ç‰©åŒ–è§†å›¾ emp_stats åˆ›å»ºæˆåŠŸ';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'ç‰©åŒ–è§†å›¾ emp_stats å·²å­˜åœ¨';
        WHEN undefined_table THEN
            RAISE WARNING 'åŸºç¡€è¡¨ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºç‰©åŒ–è§†å›¾å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

### 5.2 ç»§æ‰¿ç³»ç»Ÿ

```sql
-- è¡¨ç»§æ‰¿ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        -- åˆ›å»ºçˆ¶è¡¨person
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'person') THEN
            RAISE NOTICE 'è¡¨ person å·²å­˜åœ¨';
        ELSE
            CREATE TABLE person (
                id SERIAL PRIMARY KEY,
                name VARCHAR(50),
                birth_date DATE
            );
            RAISE NOTICE 'è¡¨ person åˆ›å»ºæˆåŠŸï¼ˆçˆ¶è¡¨ï¼‰';
        END IF;

        -- åˆ›å»ºå­è¡¨employee
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'employee') THEN
            RAISE NOTICE 'è¡¨ employee å·²å­˜åœ¨';
        ELSE
            IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'person') THEN
                RAISE WARNING 'çˆ¶è¡¨ person ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºå­è¡¨ employee';
                RETURN;
            END IF;

            CREATE TABLE employee (
                salary DECIMAL(10,2),
                hire_date DATE
            ) INHERITS (person);
            RAISE NOTICE 'è¡¨ employee åˆ›å»ºæˆåŠŸï¼ˆç»§æ‰¿è‡ªpersonï¼‰';
        END IF;

        -- åˆ›å»ºå­è¡¨customer
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'customer') THEN
            RAISE NOTICE 'è¡¨ customer å·²å­˜åœ¨';
        ELSE
            IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'person') THEN
                RAISE WARNING 'çˆ¶è¡¨ person ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºå­è¡¨ customer';
                RETURN;
            END IF;

            CREATE TABLE customer (
                credit_limit DECIMAL(10,2),
                registration_date DATE
            ) INHERITS (person);
            RAISE NOTICE 'è¡¨ customer åˆ›å»ºæˆåŠŸï¼ˆç»§æ‰¿è‡ªpersonï¼‰';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'éƒ¨åˆ†è¡¨å·²å­˜åœ¨';
        WHEN undefined_table THEN
            RAISE WARNING 'çˆ¶è¡¨ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

### 5.3 åˆ†åŒºè¡¨

```sql
-- èŒƒå›´åˆ†åŒºï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        -- åˆ›å»ºåˆ†åŒºè¡¨sales
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'sales') THEN
            RAISE NOTICE 'åˆ†åŒºè¡¨ sales å·²å­˜åœ¨';
        ELSE
            CREATE TABLE sales (
                id SERIAL,
                sale_date DATE,
                amount DECIMAL(10,2)
            ) PARTITION BY RANGE (sale_date);
            RAISE NOTICE 'åˆ†åŒºè¡¨ sales åˆ›å»ºæˆåŠŸï¼ˆèŒƒå›´åˆ†åŒºï¼‰';
        END IF;

        -- åˆ›å»ºåˆ†åŒºsales_2023
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'sales_2023') THEN
            RAISE NOTICE 'åˆ†åŒº sales_2023 å·²å­˜åœ¨';
        ELSE
            IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'sales') THEN
                RAISE WARNING 'åˆ†åŒºè¡¨ sales ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºåˆ†åŒº sales_2023';
                RETURN;
            END IF;

            CREATE TABLE sales_2023 PARTITION OF sales
            FOR VALUES FROM ('2023-01-01') TO ('2024-01-01');
            RAISE NOTICE 'åˆ†åŒº sales_2023 åˆ›å»ºæˆåŠŸ';
        END IF;

        -- åˆ›å»ºåˆ†åŒºsales_2024
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'sales_2024') THEN
            RAISE NOTICE 'åˆ†åŒº sales_2024 å·²å­˜åœ¨';
        ELSE
            IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'sales') THEN
                RAISE WARNING 'åˆ†åŒºè¡¨ sales ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºåˆ†åŒº sales_2024';
                RETURN;
            END IF;

            CREATE TABLE sales_2024 PARTITION OF sales
            FOR VALUES FROM ('2024-01-01') TO ('2025-01-01');
            RAISE NOTICE 'åˆ†åŒº sales_2024 åˆ›å»ºæˆåŠŸ';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'éƒ¨åˆ†è¡¨æˆ–åˆ†åŒºå·²å­˜åœ¨';
        WHEN undefined_table THEN
            RAISE WARNING 'åˆ†åŒºè¡¨ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºåˆ†åŒºè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- åˆ—è¡¨åˆ†åŒº
CREATE TABLE products (
    id SERIAL,
    category VARCHAR(50),
    name VARCHAR(100)
) PARTITION BY LIST (category);

CREATE TABLE electronics PARTITION OF products
FOR VALUES IN ('laptop', 'phone', 'tablet');
```

## å…­ã€æ€§èƒ½ä¼˜åŒ–

### 6.1 ç´¢å¼•ä¼˜åŒ–

```sql
-- B+æ ‘ç´¢å¼•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'employees') THEN
        RAISE EXCEPTION 'è¡¨ employees ä¸å­˜åœ¨';
    END IF;

    IF EXISTS (SELECT 1 FROM pg_indexes WHERE tablename = 'employees' AND indexname = 'idx_emp_salary') THEN
        RAISE WARNING 'ç´¢å¼• idx_emp_salary å·²å­˜åœ¨';
    ELSE
        CREATE INDEX idx_emp_salary ON employees (salary);
        RAISE NOTICE 'B+æ ‘ç´¢å¼•åˆ›å»ºæˆåŠŸ: idx_emp_salary';
    END IF;
EXCEPTION
    WHEN undefined_table THEN
        RAISE EXCEPTION 'è¡¨ employees ä¸å­˜åœ¨';
    WHEN duplicate_table THEN
        RAISE WARNING 'ç´¢å¼• idx_emp_salary å·²å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºB+æ ‘ç´¢å¼•å¤±è´¥: %', SQLERRM;
END $$;

-- å¤åˆç´¢å¼•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'employees') THEN
        RAISE EXCEPTION 'è¡¨ employees ä¸å­˜åœ¨';
    END IF;

    IF EXISTS (SELECT 1 FROM pg_indexes WHERE tablename = 'employees' AND indexname = 'idx_emp_dept_salary') THEN
        RAISE WARNING 'ç´¢å¼• idx_emp_dept_salary å·²å­˜åœ¨';
    ELSE
        CREATE INDEX idx_emp_dept_salary ON employees (dept_id, salary);
        RAISE NOTICE 'å¤åˆç´¢å¼•åˆ›å»ºæˆåŠŸ: idx_emp_dept_salary';
    END IF;
EXCEPTION
    WHEN undefined_table THEN
        RAISE EXCEPTION 'è¡¨ employees ä¸å­˜åœ¨';
    WHEN duplicate_table THEN
        RAISE WARNING 'ç´¢å¼• idx_emp_dept_salary å·²å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºå¤åˆç´¢å¼•å¤±è´¥: %', SQLERRM;
END $$;

-- éƒ¨åˆ†ç´¢å¼•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'employees') THEN
        RAISE EXCEPTION 'è¡¨ employees ä¸å­˜åœ¨';
    END IF;

    IF EXISTS (SELECT 1 FROM pg_indexes WHERE tablename = 'employees' AND indexname = 'idx_high_salary') THEN
        RAISE WARNING 'ç´¢å¼• idx_high_salary å·²å­˜åœ¨';
    ELSE
        CREATE INDEX idx_high_salary ON employees (salary) WHERE salary > 100000;
        RAISE NOTICE 'éƒ¨åˆ†ç´¢å¼•åˆ›å»ºæˆåŠŸ: idx_high_salary';
    END IF;
EXCEPTION
    WHEN undefined_table THEN
        RAISE EXCEPTION 'è¡¨ employees ä¸å­˜åœ¨';
    WHEN duplicate_table THEN
        RAISE WARNING 'ç´¢å¼• idx_high_salary å·²å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºéƒ¨åˆ†ç´¢å¼•å¤±è´¥: %', SQLERRM;
END $$;

-- è¡¨è¾¾å¼ç´¢å¼•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'employees') THEN
        RAISE EXCEPTION 'è¡¨ employees ä¸å­˜åœ¨';
    END IF;

    IF EXISTS (SELECT 1 FROM pg_indexes WHERE tablename = 'employees' AND indexname = 'idx_name_lower') THEN
        RAISE WARNING 'ç´¢å¼• idx_name_lower å·²å­˜åœ¨';
    ELSE
        CREATE INDEX idx_name_lower ON employees (LOWER(name));
        RAISE NOTICE 'è¡¨è¾¾å¼ç´¢å¼•åˆ›å»ºæˆåŠŸ: idx_name_lower';
    END IF;
EXCEPTION
    WHEN undefined_table THEN
        RAISE EXCEPTION 'è¡¨ employees ä¸å­˜åœ¨';
    WHEN duplicate_table THEN
        RAISE WARNING 'ç´¢å¼• idx_name_lower å·²å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºè¡¨è¾¾å¼ç´¢å¼•å¤±è´¥: %', SQLERRM;
END $$;
```

### 6.2 æŸ¥è¯¢ä¼˜åŒ–

```sql
-- ä½¿ç”¨EXPLAINåˆ†ææŸ¥è¯¢è®¡åˆ’
EXPLAIN (ANALYZE, BUFFERS)
SELECT e.name, d.dept_name
FROM employees e
JOIN departments d ON e.dept_id = d.dept_id
WHERE e.salary > 50000;

-- ç»Ÿè®¡ä¿¡æ¯æ›´æ–°
ANALYZE employees;

-- æŸ¥è¯¢é‡å†™
SELECT name, salary
FROM employees
WHERE dept_id IN (
    SELECT dept_id FROM departments WHERE budget > 1000000
);
```

## ä¸ƒã€å®é™…åº”ç”¨æ¡ˆä¾‹

### 7.1 ç”µå•†ç³»ç»Ÿè®¾è®¡

```sql
-- å•†å“è¡¨
CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    price DECIMAL(10,2) NOT NULL,
    category_id INTEGER REFERENCES categories(category_id),
    stock_quantity INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT NOW()
);

-- è®¢å•è¡¨
CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    customer_id INTEGER REFERENCES customers(customer_id),
    order_date TIMESTAMP DEFAULT NOW(),
    total_amount DECIMAL(10,2),
    status VARCHAR(20) DEFAULT 'pending'
);

-- è®¢å•è¯¦æƒ…è¡¨
CREATE TABLE order_items (
    order_id INTEGER REFERENCES orders(order_id),
    product_id INTEGER REFERENCES products(product_id),
    quantity INTEGER NOT NULL,
    unit_price DECIMAL(10,2) NOT NULL,
    PRIMARY KEY (order_id, product_id)
);
```

### 7.2 é‡‘èç³»ç»Ÿè®¾è®¡

```sql
-- è´¦æˆ·è¡¨
CREATE TABLE accounts (
    account_id SERIAL PRIMARY KEY,
    customer_id INTEGER REFERENCES customers(customer_id),
    account_type VARCHAR(20) NOT NULL,
    balance DECIMAL(15,2) DEFAULT 0,
    currency VARCHAR(3) DEFAULT 'USD',
    created_at TIMESTAMP DEFAULT NOW()
);

-- äº¤æ˜“è¡¨
CREATE TABLE transactions (
    transaction_id SERIAL PRIMARY KEY,
    from_account_id INTEGER REFERENCES accounts(account_id),
    to_account_id INTEGER REFERENCES accounts(account_id),
    amount DECIMAL(15,2) NOT NULL,
    transaction_type VARCHAR(20) NOT NULL,
    transaction_date TIMESTAMP DEFAULT NOW(),
    status VARCHAR(20) DEFAULT 'pending'
);
```

## å…«ã€ç›¸å…³æ¦‚å¿µ

### 8.1 ä¸Šä½æ¦‚å¿µ

- **æ•°æ®æ¨¡å‹**: æ›´å¹¿æ³›çš„æ•°æ®ç»„ç»‡æ–¹å¼
- **æ•°æ®åº“ç†è®º**: æ•°æ®åº“ç³»ç»Ÿçš„ç†è®ºåŸºç¡€
- **é›†åˆè®º**: æ•°å­¦åŸºç¡€ç†è®º

### 8.2 ä¸‹ä½æ¦‚å¿µ

- **å…³ç³»**: äºŒç»´è¡¨æ ¼ç»“æ„
- **å…ƒç»„**: è¡¨ä¸­çš„è¡Œ
- **å±æ€§**: è¡¨ä¸­çš„åˆ—
- **åŸŸ**: å±æ€§çš„å–å€¼èŒƒå›´

### 8.3 å¹³è¡Œæ¦‚å¿µ

- **å±‚æ¬¡æ•°æ®æ¨¡å‹**: æ ‘å½¢ç»“æ„æ•°æ®æ¨¡å‹
- **ç½‘çŠ¶æ•°æ®æ¨¡å‹**: å›¾ç»“æ„æ•°æ®æ¨¡å‹
- **å¯¹è±¡æ•°æ®æ¨¡å‹**: é¢å‘å¯¹è±¡æ•°æ®æ¨¡å‹

---

## ä¹ã€å‚è€ƒèµ„æº

### 9.1 ç›¸å…³æ–‡æ¡£

- [ç³»ç»Ÿæ¶æ„ä¸è®¾è®¡åŸç†](../01.02-ç³»ç»Ÿæ¶æ„/01.01-ç³»ç»Ÿæ¶æ„ä¸è®¾è®¡åŸç†.md) - ç³»ç»Ÿæ¶æ„
- [SQLè¯­è¨€è§„èŒƒä¸æ ‡å‡†](../01.04-SQLè¯­è¨€/01.03-SQLè¯­è¨€è§„èŒƒä¸æ ‡å‡†.md) - SQLè¯­è¨€
- [äº‹åŠ¡ç®¡ç†ä¸ACIDç‰¹æ€§](../../03-äº‹åŠ¡ä¸å¹¶å‘/03.02-ACIDç‰¹æ€§/01.04-äº‹åŠ¡ç®¡ç†ä¸ACIDç‰¹æ€§.md) - äº‹åŠ¡ç®¡ç†

### 9.2 å®æˆ˜æ¡ˆä¾‹ä¸ç¤ºä¾‹

- [å®æˆ˜æ¡ˆä¾‹](../../19-å®æˆ˜æ¡ˆä¾‹/README.md) â­ - å®Œæ•´çš„å®æˆ˜æ¡ˆä¾‹é›†åˆ
- [æ•°æ®æ¨¡å‹è®¾è®¡](../../17-æ•°æ®æ¨¡å‹è®¾è®¡/README.md) - æ•°æ®æ¨¡å‹è®¾è®¡æ¡ˆä¾‹
- [åº”ç”¨æ¶æ„è®¾è®¡](../../16-åº”ç”¨è®¾è®¡ä¸å¼€å‘/åº”ç”¨æ¶æ„/README.md) - åº”ç”¨æ¶æ„æ¡ˆä¾‹

### 9.3 å‚è€ƒæ–‡çŒ®

1. Codd, E. F. (1970). A relational model of data for large shared data banks. Communications of the ACM, 13(6), 377-387.
2. Date, C. J. (2003). An Introduction to Database Systems (8th ed.). Addison-Wesley.
3. PostgreSQL Global Development Group. (2025). PostgreSQL 18 Documentation. <https://www.postgresql.org/docs/18/>
4. Silberschatz, A., Galvin, P. B., & Gagne, G. (2018). Operating System Concepts (10th ed.). John Wiley & Sons.
5. PostgreSQL Global Development Group. (2024). PostgreSQL 17 Documentation. <https://www.postgresql.org/docs/17/>

### 9.4 Wikidataå¯¹é½

#### 9.4.1 å…³ç³»æ•°æ®æ¨¡å‹æ¦‚å¿µå¯¹é½

- **Wikidata ID**: Q192490 (Relational model)
- **ç›¸å…³å±æ€§**:
  - P31: Q192490 (instance of: data model)
  - P361: Q176165 (part of: database management system)
- **å¤–éƒ¨é“¾æ¥**:
  - [Wikipedia - Relational model](https://en.wikipedia.org/wiki/Relational_model)
  - [Wikipedia - Relational database](https://en.wikipedia.org/wiki/Relational_database)

**Wikipediaå®šä¹‰**: [Relational model](https://en.wikipedia.org/wiki/Relational_model)

> The relational model is an approach to managing data using a structure and language consistent with first-order predicate logic, first described in 1970 by Edgar F. Codd.

**å¯¹é½è¯´æ˜**:

- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒå…³ç³»æ¨¡å‹åŸºäºæ•°å­¦é›†åˆè®º
- âœ… **ç†è®ºåŸºç¡€**: éƒ½æåˆ°å…³ç³»ä»£æ•°å’Œå…³ç³»æ¼”ç®—
- âœ… **æ ¸å¿ƒæ¦‚å¿µ**: éƒ½åŒ…å«å…³ç³»ã€å…ƒç»„ã€å±æ€§ç­‰æ ¸å¿ƒæ¦‚å¿µ

#### 9.4.2 PostgreSQLå…³ç³»æ¨¡å‹å¯¹é½

- **Wikidata ID**: Q192490
- **ç›¸å…³å±æ€§**:
  - P31: Q176165 (instance of: database management system)
  - P178: Q9366 (developer: PostgreSQL Global Development Group)
  - P277: Q193321 (programmed in: C)
  - P348: 18.0 (software version)
- **å¤–éƒ¨é“¾æ¥**:
  - <https://www.postgresql.org/docs/current/ddl.html>
  - <https://www.postgresql.org/docs/current/dml.html>

---

## åã€å½¢å¼è¯æ˜ä¸ç†è®ºè®ºè¯

### 10.1 å…³ç³»ä»£æ•°å®Œå¤‡æ€§è¯æ˜

**å®šç†**: å…³ç³»ä»£æ•°åŒ…å«é€‰æ‹©ã€æŠ•å½±ã€å¹¶ã€å·®ã€ç¬›å¡å°”ç§¯ã€è¿æ¥ç­‰åŸºæœ¬è¿ç®—ï¼Œæ˜¯å…³ç³»æŸ¥è¯¢çš„å®Œå¤‡è¯­è¨€ã€‚

**è¯æ˜**:

```latex
\begin{theorem}[å…³ç³»ä»£æ•°å®Œå¤‡æ€§]
å…³ç³»ä»£æ•°åŒ…å«ä»¥ä¸‹åŸºæœ¬è¿ç®—ï¼š
1. é€‰æ‹©è¿ç®—ï¼š\sigma_p(R) = \{t | t \in R \land p(t)\}
2. æŠ•å½±è¿ç®—ï¼š\pi_A(R) = \{t[A] | t \in R\}
3. å¹¶è¿ç®—ï¼šR \cup S = \{t | t \in R \lor t \in S\}
4. å·®è¿ç®—ï¼šR - S = \{t | t \in R \land t \notin S\}
5. ç¬›å¡å°”ç§¯ï¼šR \times S = \{(r,s) | r \in R \land s \in S\}
6. è¿æ¥è¿ç®—ï¼šR \bowtie_p S = \sigma_p(R \times S)

å®Œå¤‡æ€§è¯æ˜ï¼š
å¯¹äºä»»æ„å…³ç³»æŸ¥è¯¢ Qï¼Œå­˜åœ¨å…³ç³»ä»£æ•°è¡¨è¾¾å¼ E ä½¿å¾— Q \equiv Eã€‚

è¿™å¯ä»¥é€šè¿‡å½’çº³æ³•è¯æ˜ï¼š
- åŸºæœ¬æŸ¥è¯¢ï¼šå•è¡¨æŸ¥è¯¢å¯ä»¥ç”¨é€‰æ‹©å’ŒæŠ•å½±è¡¨ç¤º
- å¤åˆæŸ¥è¯¢ï¼šå¤šè¡¨æŸ¥è¯¢å¯ä»¥ç”¨è¿æ¥ã€å¹¶ã€å·®ç­‰è¿ç®—è¡¨ç¤º

å› æ­¤ï¼Œå…³ç³»ä»£æ•°æ˜¯å…³ç³»æŸ¥è¯¢çš„å®Œå¤‡è¯­è¨€ã€‚
\end{theorem}
```

### 10.2 Armstrongå…¬ç†å®Œå¤‡æ€§è¯æ˜

**å®šç†**: Armstrongå…¬ç†ç³»ç»Ÿæ˜¯å‡½æ•°ä¾èµ–æ¨ç†çš„å®Œå¤‡ç³»ç»Ÿã€‚

**è¯æ˜**:

```latex
\begin{theorem}[Armstrongå…¬ç†å®Œå¤‡æ€§]
Armstrongå…¬ç†ç³»ç»ŸåŒ…å«ï¼š
1. è‡ªåæ€§ï¼šå¦‚æœ Y \subseteq Xï¼Œåˆ™ X \rightarrow Y
2. å¢å¹¿æ€§ï¼šå¦‚æœ X \rightarrow Yï¼Œåˆ™ XZ \rightarrow YZ
3. ä¼ é€’æ€§ï¼šå¦‚æœ X \rightarrow Y ä¸” Y \rightarrow Zï¼Œåˆ™ X \rightarrow Z

å®Œå¤‡æ€§è¯æ˜ï¼š
å¯¹äºä»»æ„å‡½æ•°ä¾èµ–é›† F å’Œå‡½æ•°ä¾èµ– fï¼Œå¦‚æœ F \models fï¼Œåˆ™ F \vdash fã€‚

è¯æ˜æ€è·¯ï¼š
1. æ„é€  F çš„é—­åŒ… F^+
2. è¯æ˜ f \in F^+ å½“ä¸”ä»…å½“ F \models f
3. ä½¿ç”¨Armstrongå…¬ç†æ¨å¯¼ F^+ ä¸­çš„æ‰€æœ‰å‡½æ•°ä¾èµ–

å› æ­¤ï¼ŒArmstrongå…¬ç†ç³»ç»Ÿæ˜¯å®Œå¤‡çš„ã€‚
\end{theorem}
```

### 10.3 èŒƒå¼åˆ†è§£æ— æŸæ€§è¯æ˜

**å®šç†**: å¯¹äºå…³ç³» R å’Œå‡½æ•°ä¾èµ–é›† Fï¼Œå­˜åœ¨æ— æŸåˆ†è§£ R = R_1 \cup R_2 \cup \ldots \cup R_nã€‚

**è¯æ˜**:

```latex
\begin{theorem}[èŒƒå¼åˆ†è§£æ— æŸæ€§]
è®¾å…³ç³» R çš„å‡½æ•°ä¾èµ–é›†ä¸º Fï¼Œåˆ†è§£ä¸º R_1, R_2, \ldots, R_nã€‚

æ— æŸåˆ†è§£æ¡ä»¶ï¼š
R = R_1 \bowtie R_2 \bowtie \ldots \bowtie R_n

å³ï¼š\pi_{R_1}(R) \bowtie \pi_{R_2}(R) \bowtie \ldots \bowtie \pi_{R_n}(R) = R

æ— æŸåˆ†è§£åˆ¤å®šï¼š
å¦‚æœ R_i \cap R_j \rightarrow R_i æˆ– R_i \cap R_j \rightarrow R_j åœ¨ F^+ ä¸­ï¼Œåˆ™åˆ†è§£æ˜¯æ— æŸçš„ã€‚

å¯¹äºBCNFåˆ†è§£ï¼š
å¦‚æœ R_i æ»¡è¶³BCNFï¼Œä¸” R_i \cap R_j æ˜¯ R_i çš„è¶…é”®ï¼Œåˆ™åˆ†è§£æ˜¯æ— æŸçš„ã€‚

å› æ­¤ï¼Œå­˜åœ¨æ— æŸçš„èŒƒå¼åˆ†è§£ã€‚
\end{theorem}
```

---

## åä¸€ã€äº¤å‰å¼•ç”¨

### ç›¸å…³æ–‡æ¡£

#### æ•°æ®æ¨¡å‹è®¾è®¡

- â­â­â­ [æ•°æ®æ¨¡å‹è®¾è®¡](../../17-æ•°æ®æ¨¡å‹è®¾è®¡/README.md) - æ•°æ®å»ºæ¨¡å®è·µæŒ‡å—
- â­â­ [æ•°æ®ä»“åº“](../../26-æ•°æ®ç®¡ç†/æ•°æ®ä»“åº“/README.md) - æ•°æ®ä»“åº“è®¾è®¡

#### æ ¸å¿ƒè¯¾ç¨‹

- â­â­ [SQLè¯­è¨€è§„èŒƒä¸æ ‡å‡†](../01.04-SQLè¯­è¨€/01.03-SQLè¯­è¨€è§„èŒƒä¸æ ‡å‡†.md) - SQLè¯­è¨€åŸºç¡€
- â­â­ [ç³»ç»Ÿæ¶æ„ä¸è®¾è®¡åŸç†](../01.02-ç³»ç»Ÿæ¶æ„/01.01-ç³»ç»Ÿæ¶æ„ä¸è®¾è®¡åŸç†.md) - ç³»ç»Ÿæ¶æ„ç†è®ºåŸºç¡€
- â­â­ [å­˜å‚¨ç®¡ç†ä¸æ•°æ®æŒä¹…åŒ–](../../01.06-å­˜å‚¨ç®¡ç†ä¸æ•°æ®æŒä¹…åŒ–.md) - å­˜å‚¨ç®¡ç†

#### æŸ¥è¯¢ä¸ä¼˜åŒ–

- â­â­ [æŸ¥è¯¢ä¼˜åŒ–å™¨åŸç†](../../02-æŸ¥è¯¢ä¸ä¼˜åŒ–/02.01-æŸ¥è¯¢ä¼˜åŒ–å™¨/02.01-æŸ¥è¯¢ä¼˜åŒ–å™¨åŸç†.md) - æŸ¥è¯¢ä¼˜åŒ–ç†è®ºåŸºç¡€
- â­â­ [ç´¢å¼•ç»“æ„ä¸ä¼˜åŒ–](../../02-æŸ¥è¯¢ä¸ä¼˜åŒ–/02.02-ç´¢å¼•ç»“æ„/02.02-ç´¢å¼•ç»“æ„ä¸ä¼˜åŒ–.md) - ç´¢å¼•ä¼˜åŒ–å®è·µ
- â­ [ç»Ÿè®¡ä¿¡æ¯ä¸ä»£ä»·æ¨¡å‹](../../02-æŸ¥è¯¢ä¸ä¼˜åŒ–/02.04-ç»Ÿè®¡ä¿¡æ¯/02.03-ç»Ÿè®¡ä¿¡æ¯ä¸ä»£ä»·æ¨¡å‹.md) - ç»Ÿè®¡ä¿¡æ¯ç®¡ç†

#### ç†è®ºåŸºç¡€

- â­ [å½¢å¼åŒ–éªŒè¯æ–¹æ³•](../../25-ç†è®ºä½“ç³»/25.01-å½¢å¼åŒ–æ–¹æ³•/01.01-å½¢å¼åŒ–éªŒè¯æ–¹æ³•.md) - æ•°æ®æ¨¡å‹å½¢å¼åŒ–éªŒè¯

### å¤–éƒ¨èµ„æº

- [PostgreSQLæ•°æ®ç±»å‹æ–‡æ¡£](https://www.postgresql.org/docs/current/datatype.html)
- [PostgreSQLçº¦æŸæ–‡æ¡£](https://www.postgresql.org/docs/current/ddl-constraints.html)
- [å…³ç³»æ•°æ®åº“ç†è®º](https://en.wikipedia.org/wiki/Relational_database)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v3.1
**æœ€åæ›´æ–°**: 2025-11-22
**PostgreSQLç‰ˆæœ¬**: 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x (å…¼å®¹)
**ç»´æŠ¤è€…**: Data Science Team
