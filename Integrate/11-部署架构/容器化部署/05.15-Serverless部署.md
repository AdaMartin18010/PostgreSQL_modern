---

> **ğŸ“‹ æ–‡æ¡£æ¥æº**: `PostgreSQL\05-éƒ¨ç½²æ¶æ„\å®¹å™¨åŒ–éƒ¨ç½²\05.15-Serverlesséƒ¨ç½².md`
> **ğŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŸæ–‡ä»¶ä¿æŒä¸å˜

---

# Serverless éƒ¨ç½²æŒ‡å—

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **æœ€åæ›´æ–°**: 2025-11-13
> **ç‰ˆæœ¬è¦†ç›–**: PostgreSQL 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x (å…¼å®¹)
> **æ–‡æ¡£çŠ¶æ€**: âœ… å·²åˆ›å»º

---

## ğŸ“‹ ç›®å½•

- [Serverless éƒ¨ç½²æŒ‡å—](#serverless-éƒ¨ç½²æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [ä¸»è¦ Serverless æ–¹æ¡ˆ](#ä¸»è¦-serverless-æ–¹æ¡ˆ)
  - [2. Neon Serverless PostgreSQL](#2-neon-serverless-postgresql)
    - [2.1 æ¦‚è¿°](#21-æ¦‚è¿°)
    - [2.2 å¿«é€Ÿå¼€å§‹](#22-å¿«é€Ÿå¼€å§‹)
      - [åˆ›å»ºé¡¹ç›®](#åˆ›å»ºé¡¹ç›®)
      - [è¿æ¥æ•°æ®åº“](#è¿æ¥æ•°æ®åº“)
    - [2.3 åˆ†æ”¯åŠŸèƒ½](#23-åˆ†æ”¯åŠŸèƒ½)
      - [åˆ›å»ºåˆ†æ”¯](#åˆ›å»ºåˆ†æ”¯)
      - [ä½¿ç”¨åˆ†æ”¯](#ä½¿ç”¨åˆ†æ”¯)
    - [2.4 é…ç½®ä¼˜åŒ–](#24-é…ç½®ä¼˜åŒ–)
      - [è¿æ¥æ± é…ç½®](#è¿æ¥æ± é…ç½®)
      - [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
  - [3. Supabase](#3-supabase)
    - [3.1 æ¦‚è¿°](#31-æ¦‚è¿°)
    - [3.2 å¿«é€Ÿå¼€å§‹](#32-å¿«é€Ÿå¼€å§‹)
      - [3.2.1 åˆ›å»ºé¡¹ç›®](#321-åˆ›å»ºé¡¹ç›®)
      - [3.2.2 è¿æ¥æ•°æ®åº“](#322-è¿æ¥æ•°æ®åº“)
    - [3.3 å®æ—¶åŠŸèƒ½](#33-å®æ—¶åŠŸèƒ½)
    - [3.4 å­˜å‚¨é›†æˆ](#34-å­˜å‚¨é›†æˆ)
  - [4. AWS RDS Serverless v2](#4-aws-rds-serverless-v2)
    - [4.1 æ¦‚è¿°](#41-æ¦‚è¿°)
    - [4.2 åˆ›å»º Serverless é›†ç¾¤](#42-åˆ›å»º-serverless-é›†ç¾¤)
      - [ä½¿ç”¨ AWS CLI](#ä½¿ç”¨-aws-cli)
      - [ä½¿ç”¨ Terraform](#ä½¿ç”¨-terraform)
    - [4.3 é…ç½®è‡ªåŠ¨æ‰©ç¼©å®¹](#43-é…ç½®è‡ªåŠ¨æ‰©ç¼©å®¹)
  - [5. Azure Database for PostgreSQL Flexible Server](#5-azure-database-for-postgresql-flexible-server)
    - [5.1 æ¦‚è¿°](#51-æ¦‚è¿°)
    - [5.2 åˆ›å»º Flexible Server](#52-åˆ›å»º-flexible-server)
      - [ä½¿ç”¨ Azure CLI](#ä½¿ç”¨-azure-cli)
      - [ä½¿ç”¨ Azure Portal](#ä½¿ç”¨-azure-portal)
    - [5.3 é…ç½®è‡ªåŠ¨æ‰©ç¼©å®¹](#53-é…ç½®è‡ªåŠ¨æ‰©ç¼©å®¹)
  - [6. åˆ†æ”¯ä¸å¼€å‘å·¥ä½œæµ](#6-åˆ†æ”¯ä¸å¼€å‘å·¥ä½œæµ)
    - [6.1 Neon åˆ†æ”¯å·¥ä½œæµ](#61-neon-åˆ†æ”¯å·¥ä½œæµ)
    - [6.2 Supabase åˆ†æ”¯å·¥ä½œæµ](#62-supabase-åˆ†æ”¯å·¥ä½œæµ)
    - [6.3 æœ€ä½³å®è·µ](#63-æœ€ä½³å®è·µ)
  - [7. æˆæœ¬ä¼˜åŒ–](#7-æˆæœ¬ä¼˜åŒ–)
    - [7.1 Neon æˆæœ¬ä¼˜åŒ–](#71-neon-æˆæœ¬ä¼˜åŒ–)
    - [7.2 AWS RDS Serverless æˆæœ¬ä¼˜åŒ–](#72-aws-rds-serverless-æˆæœ¬ä¼˜åŒ–)
    - [7.3 é€šç”¨ä¼˜åŒ–å»ºè®®](#73-é€šç”¨ä¼˜åŒ–å»ºè®®)
  - [8. è¿ç§»åˆ° Serverless](#8-è¿ç§»åˆ°-serverless)
    - [8.1 ä»è‡ªå»º PostgreSQL è¿ç§»](#81-ä»è‡ªå»º-postgresql-è¿ç§»)
      - [ä½¿ç”¨ pg\_dump](#ä½¿ç”¨-pg_dump)
      - [ä½¿ç”¨é€»è¾‘å¤åˆ¶](#ä½¿ç”¨é€»è¾‘å¤åˆ¶)
    - [11.2 è¿ç§»æ£€æŸ¥æ¸…å•](#112-è¿ç§»æ£€æŸ¥æ¸…å•)
    - [11.3 è¿ç§»åéªŒè¯å’Œä¼˜åŒ–](#113-è¿ç§»åéªŒè¯å’Œä¼˜åŒ–)
  - [8. Neonè¯¦ç»†é…ç½®å’Œä¼˜åŒ–](#8-neonè¯¦ç»†é…ç½®å’Œä¼˜åŒ–)
    - [8.1 ç”Ÿäº§ç¯å¢ƒé…ç½®](#81-ç”Ÿäº§ç¯å¢ƒé…ç½®)
    - [8.2 æ€§èƒ½ä¼˜åŒ–é…ç½®](#82-æ€§èƒ½ä¼˜åŒ–é…ç½®)
    - [8.3 æˆæœ¬ä¼˜åŒ–ç­–ç•¥](#83-æˆæœ¬ä¼˜åŒ–ç­–ç•¥)
    - [8.4 ç›‘æ§å’Œå‘Šè­¦é…ç½®](#84-ç›‘æ§å’Œå‘Šè­¦é…ç½®)
  - [9. Supabaseè¯¦ç»†é…ç½®](#9-supabaseè¯¦ç»†é…ç½®)
    - [9.1 ç”Ÿäº§ç¯å¢ƒé…ç½®](#91-ç”Ÿäº§ç¯å¢ƒé…ç½®)
    - [9.2 å®æ—¶åŠŸèƒ½é…ç½®](#92-å®æ—¶åŠŸèƒ½é…ç½®)
    - [9.3 å­˜å‚¨é›†æˆé…ç½®](#93-å­˜å‚¨é›†æˆé…ç½®)
    - [9.4 å®‰å…¨é…ç½®](#94-å®‰å…¨é…ç½®)
  - [10. AWS RDS Serverless v2è¯¦ç»†é…ç½®](#10-aws-rds-serverless-v2è¯¦ç»†é…ç½®)
    - [10.1 ç”Ÿäº§ç¯å¢ƒé…ç½®](#101-ç”Ÿäº§ç¯å¢ƒé…ç½®)
    - [10.2 è‡ªåŠ¨æ‰©ç¼©å®¹é…ç½®](#102-è‡ªåŠ¨æ‰©ç¼©å®¹é…ç½®)
    - [10.3 é«˜å¯ç”¨é…ç½®](#103-é«˜å¯ç”¨é…ç½®)
    - [10.4 ç›‘æ§å’Œå‘Šè­¦é…ç½®](#104-ç›‘æ§å’Œå‘Šè­¦é…ç½®)
  - [12. æ·±å…¥é˜…è¯»](#12-æ·±å…¥é˜…è¯»)
    - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)
      - [éƒ¨ç½²æ¶æ„](#éƒ¨ç½²æ¶æ„)
      - [å‰æ²¿æŠ€æœ¯](#å‰æ²¿æŠ€æœ¯)
    - [å¤–éƒ¨èµ„æº](#å¤–éƒ¨èµ„æº)

---

## 1. æ¦‚è¿°

Serverless PostgreSQL æä¾›æŒ‰éœ€æ‰©å±•ã€è‡ªåŠ¨æ‰©ç¼©å®¹ã€æŒ‰ä½¿ç”¨é‡è®¡è´¹çš„æ•°æ®åº“æœåŠ¡ï¼Œç‰¹åˆ«é€‚åˆï¼š

- **å¼€å‘æµ‹è¯•ç¯å¢ƒ**: å¿«é€Ÿå¯åŠ¨ï¼ŒæŒ‰éœ€ä»˜è´¹
- **ä¸­å°å‹åº”ç”¨**: è‡ªåŠ¨æ‰©ç¼©å®¹ï¼Œé™ä½è¿ç»´æˆæœ¬
- **çªå‘æµé‡åœºæ™¯**: è‡ªåŠ¨åº”å¯¹æµé‡å³°å€¼
- **å¤šç¯å¢ƒç®¡ç†**: åˆ†æ”¯åŠŸèƒ½æ”¯æŒå¿«é€Ÿåˆ›å»ºæµ‹è¯•ç¯å¢ƒ

### ä¸»è¦ Serverless æ–¹æ¡ˆ

| æ–¹æ¡ˆ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|---------|
| **Neon** | åˆ†æ”¯åŠŸèƒ½ã€å†·å¯åŠ¨å¿«ã€æŒ‰éœ€è®¡è´¹ | å¼€å‘æµ‹è¯•ã€å¤šç¯å¢ƒ |
| **Supabase** | å…¨æ ˆå¹³å°ã€å®æ—¶åŠŸèƒ½ã€å­˜å‚¨é›†æˆ | å…¨æ ˆåº”ç”¨ã€å®æ—¶åº”ç”¨ |
| **AWS RDS Serverless v2** | ä¼ä¸šçº§ã€é«˜å¯ç”¨ã€è‡ªåŠ¨æ‰©ç¼©å®¹ | ç”Ÿäº§ç¯å¢ƒã€ä¼ä¸šåº”ç”¨ |
| **Azure Flexible Server** | ä¼ä¸šçº§ã€é«˜å¯ç”¨ã€æ··åˆéƒ¨ç½² | ä¼ä¸šåº”ç”¨ã€æ··åˆäº‘ |

---

## 2. Neon Serverless PostgreSQL

### 2.1 æ¦‚è¿°

Neon æ˜¯ä¸“ä¸º Serverless è®¾è®¡çš„ PostgreSQL æœåŠ¡ï¼Œæä¾›ï¼š

- âœ… **åˆ†æ”¯åŠŸèƒ½**: å¿«é€Ÿåˆ›å»ºæ•°æ®åº“åˆ†æ”¯
- âœ… **å†·å¯åŠ¨ä¼˜åŒ–**: ç§’çº§å¯åŠ¨
- âœ… **æŒ‰éœ€è®¡è´¹**: æŒ‰è®¡ç®—å’Œå­˜å‚¨ä½¿ç”¨é‡è®¡è´¹
- âœ… **è‡ªåŠ¨æ‰©ç¼©å®¹**: æ ¹æ®è´Ÿè½½è‡ªåŠ¨è°ƒæ•´
- âœ… **PostgreSQL 18 æ”¯æŒ**: æœ€æ–°ç‰ˆæœ¬æ”¯æŒ

### 2.2 å¿«é€Ÿå¼€å§‹

#### åˆ›å»ºé¡¹ç›®

```bash
# å®‰è£… Neon CLI
npm install -g neonctl

# ç™»å½•
neonctl auth

# åˆ›å»ºé¡¹ç›®
neonctl projects create --name myproject

# è·å–è¿æ¥å­—ç¬¦ä¸²
neonctl connection-string --project-id <project-id>
```

#### è¿æ¥æ•°æ®åº“

```bash
# ä½¿ç”¨è¿æ¥å­—ç¬¦ä¸²
psql "postgresql://user:password@ep-xxx.us-east-2.aws.neon.tech/neondb?sslmode=require"

# æˆ–ä½¿ç”¨ç¯å¢ƒå˜é‡
export DATABASE_URL="postgresql://user:password@ep-xxx.us-east-2.aws.neon.tech/neondb?sslmode=require"
psql $DATABASE_URL
```

### 2.3 åˆ†æ”¯åŠŸèƒ½

#### åˆ›å»ºåˆ†æ”¯

```bash
# åˆ›å»ºå¼€å‘åˆ†æ”¯
neonctl branches create --project-id <project-id> --name dev

# åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
neonctl branches create --project-id <project-id> --name feature-auth --parent-id <parent-branch-id>

# åˆ—å‡ºæ‰€æœ‰åˆ†æ”¯
neonctl branches list --project-id <project-id>
```

#### ä½¿ç”¨åˆ†æ”¯

```bash
# è·å–åˆ†æ”¯è¿æ¥å­—ç¬¦ä¸²
neonctl connection-string --project-id <project-id> --branch-name dev

# åœ¨åˆ†æ”¯ä¸Šæµ‹è¯•
psql "postgresql://user:password@ep-dev-xxx.us-east-2.aws.neon.tech/neondb?sslmode=require"
```

### 2.4 é…ç½®ä¼˜åŒ–

#### è¿æ¥æ± é…ç½®

```bash
# ä½¿ç”¨è¿æ¥æ± ï¼ˆæ¨èï¼‰
# Neon æä¾›å†…ç½®è¿æ¥æ± ï¼Œä½¿ç”¨ pooler ç«¯ç‚¹
psql "postgresql://user:password@ep-xxx-pooler.us-east-2.aws.neon.tech/neondb?sslmode=require"

# æˆ–ä½¿ç”¨ PgBouncer
# Neon è‡ªåŠ¨æä¾› PgBouncer è¿æ¥æ± 
```

#### æ€§èƒ½ä¼˜åŒ–

```sql
-- å¯ç”¨æŸ¥è¯¢ç¼“å­˜
SET enable_query_cache = on;

-- ä¼˜åŒ–è¿æ¥æ•°
-- Neon è‡ªåŠ¨ç®¡ç†è¿æ¥æ± ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
```

---

## 3. Supabase

### 3.1 æ¦‚è¿°

Supabase æä¾›å®Œæ•´çš„åç«¯å³æœåŠ¡ï¼ˆBaaSï¼‰å¹³å°ï¼š

- âœ… **PostgreSQL æ•°æ®åº“**: æ‰˜ç®¡ PostgreSQL
- âœ… **å®æ—¶åŠŸèƒ½**: å®æ—¶è®¢é˜…å’Œæ›´æ–°
- âœ… **å­˜å‚¨æœåŠ¡**: å¯¹è±¡å­˜å‚¨é›†æˆ
- âœ… **è®¤è¯æœåŠ¡**: ç”¨æˆ·è®¤è¯å’Œæˆæƒ
- âœ… **è¾¹ç¼˜å‡½æ•°**: Serverless å‡½æ•°æ”¯æŒ

### 3.2 å¿«é€Ÿå¼€å§‹

#### 3.2.1 åˆ›å»ºé¡¹ç›®

```bash
# å®‰è£… Supabase CLI
npm install -g supabase

# ç™»å½•
supabase login

# åˆ›å»ºé¡¹ç›®ï¼ˆé€šè¿‡ Web æ§åˆ¶å°ï¼‰
# è®¿é—® https://supabase.com/dashboard
```

#### 3.2.2 è¿æ¥æ•°æ®åº“

```bash
# è·å–è¿æ¥å­—ç¬¦ä¸²
# åœ¨ Supabase Dashboard ä¸­è·å–

# ä½¿ç”¨è¿æ¥å­—ç¬¦ä¸²
psql "postgresql://postgres:[YOUR-PASSWORD]@db.xxx.supabase.co:5432/postgres"
```

### 3.3 å®æ—¶åŠŸèƒ½

```sql
-- å¯ç”¨å®æ—¶è®¢é˜…
ALTER PUBLICATION supabase_realtime ADD TABLE messages;

-- åœ¨åº”ç”¨ä¸­è®¢é˜…
-- JavaScript ç¤ºä¾‹
import { createClient } from '@supabase/supabase-js'

const supabase = createClient(SUPABASE_URL, SUPABASE_KEY)

// è®¢é˜…è¡¨å˜åŒ–
supabase
  .channel('messages')
  .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages' }, payload => {
    console.log('New message:', payload.new)
  })
  .subscribe()
```

### 3.4 å­˜å‚¨é›†æˆ

```sql
-- åˆ›å»ºå­˜å‚¨æ¡¶
INSERT INTO storage.buckets (id, name, public)
VALUES ('avatars', 'avatars', true);

-- ä¸Šä¼ æ–‡ä»¶ï¼ˆé€šè¿‡ APIï¼‰
-- JavaScript ç¤ºä¾‹
const { data, error } = await supabase.storage
  .from('avatars')
  .upload('avatar.png', file)
```

---

## 4. AWS RDS Serverless v2

### 4.1 æ¦‚è¿°

AWS RDS Serverless v2 æä¾›ï¼š

- âœ… **è‡ªåŠ¨æ‰©ç¼©å®¹**: æ ¹æ®è´Ÿè½½è‡ªåŠ¨è°ƒæ•´å®¹é‡
- âœ… **é«˜å¯ç”¨**: å¤šå¯ç”¨åŒºéƒ¨ç½²
- âœ… **ä¼ä¸šçº§å®‰å…¨**: VPCã€åŠ å¯†ã€å®¡è®¡
- âœ… **æŒ‰éœ€è®¡è´¹**: æŒ‰å®é™…ä½¿ç”¨é‡è®¡è´¹

### 4.2 åˆ›å»º Serverless é›†ç¾¤

#### ä½¿ç”¨ AWS CLI

```bash
# åˆ›å»º Serverless v2 é›†ç¾¤
aws rds create-db-cluster \
  --db-cluster-identifier my-serverless-cluster \
  --engine postgres \
  --engine-version 18.0 \
  --serverless-v2-scaling-configuration MinCapacity=0.5,MaxCapacity=16 \
  --master-username postgres \
  --master-user-password MyPassword123 \
  --database-name mydb
```

#### ä½¿ç”¨ Terraform

```hcl
resource "aws_rds_cluster" "serverless" {
  cluster_identifier      = "my-serverless-cluster"
  engine                 = "aurora-postgresql"
  engine_version         = "18.0"
  database_name          = "mydb"
  master_username       = "postgres"
  master_password       = var.db_password

  serverlessv2_scaling_configuration {
    min_capacity = 0.5
    max_capacity = 16
  }
}

resource "aws_rds_cluster_instance" "serverless" {
  identifier         = "my-serverless-instance"
  cluster_identifier = aws_rds_cluster.serverless.id
  instance_class     = "db.serverless"
  engine             = aws_rds_cluster.serverless.engine
  engine_version     = aws_rds_cluster.serverless.engine_version
}
```

### 4.3 é…ç½®è‡ªåŠ¨æ‰©ç¼©å®¹

```bash
# æ›´æ–°æ‰©ç¼©å®¹é…ç½®
aws rds modify-db-cluster \
  --db-cluster-identifier my-serverless-cluster \
  --serverless-v2-scaling-configuration MinCapacity=1,MaxCapacity=32
```

---

## 5. Azure Database for PostgreSQL Flexible Server

### 5.1 æ¦‚è¿°

Azure Flexible Server æä¾›ï¼š

- âœ… **çµæ´»éƒ¨ç½²**: å•æœåŠ¡å™¨æˆ–é«˜å¯ç”¨éƒ¨ç½²
- âœ… **è‡ªåŠ¨å¤‡ä»½**: è‡ªåŠ¨å¤‡ä»½å’Œç‚¹å¯¹ç‚¹æ¢å¤
- âœ… **ç›‘æ§å’Œè¯Šæ–­**: é›†æˆ Azure Monitor
- âœ… **å®‰å…¨åŠŸèƒ½**: ç§æœ‰é“¾æ¥ã€é˜²ç«å¢™è§„åˆ™

### 5.2 åˆ›å»º Flexible Server

#### ä½¿ç”¨ Azure CLI

```bash
# åˆ›å»ºèµ„æºç»„
az group create --name myResourceGroup --location eastus

# åˆ›å»º Flexible Server
az postgres flexible-server create \
  --resource-group myResourceGroup \
  --name mypostgresql \
  --location eastus \
  --admin-user postgres \
  --admin-password MyPassword123 \
  --sku-name Standard_B1ms \
  --tier Burstable \
  --version 18 \
  --storage-size 32 \
  --public-access 0.0.0.0
```

#### ä½¿ç”¨ Azure Portal

1. ç™»å½• Azure Portal
2. åˆ›å»º PostgreSQL Flexible Server èµ„æº
3. é…ç½®æœåŠ¡å™¨å‚æ•°
4. è®¾ç½®é˜²ç«å¢™è§„åˆ™
5. è·å–è¿æ¥å­—ç¬¦ä¸²

### 5.3 é…ç½®è‡ªåŠ¨æ‰©ç¼©å®¹

```bash
# æ›´æ–°æœåŠ¡å™¨é…ç½®ï¼ˆè‡ªåŠ¨æ‰©ç¼©å®¹é€šè¿‡ SKU è°ƒæ•´ï¼‰
az postgres flexible-server update \
  --resource-group myResourceGroup \
  --name mypostgresql \
  --sku-name Standard_B2s
```

---

## 6. åˆ†æ”¯ä¸å¼€å‘å·¥ä½œæµ

### 6.1 Neon åˆ†æ”¯å·¥ä½œæµ

```bash
# 1. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
neonctl branches create --project-id <project-id> --name feature-auth

# 2. åœ¨åˆ†æ”¯ä¸Šå¼€å‘
psql "postgresql://user:password@ep-feature-auth-xxx.neon.tech/neondb"

# 3. æµ‹è¯•å®Œæˆååˆå¹¶åˆ°ä¸»åˆ†æ”¯
# ï¼ˆé€šè¿‡ Neon Dashboard æˆ– APIï¼‰

# 4. åˆ é™¤åŠŸèƒ½åˆ†æ”¯
neonctl branches delete --project-id <project-id> --branch-id <branch-id>
```

### 6.2 Supabase åˆ†æ”¯å·¥ä½œæµ

```bash
# 1. åˆ›å»ºè¿ç§»
supabase migration new add_users_table

# 2. åœ¨æœ¬åœ°å¼€å‘
supabase start

# 3. æ¨é€åˆ°å¼€å‘ç¯å¢ƒ
supabase db push

# 4. æ¨é€åˆ°ç”Ÿäº§ç¯å¢ƒ
supabase db push --linked
```

### 6.3 æœ€ä½³å®è·µ

- **åˆ†æ”¯å‘½å**: ä½¿ç”¨æœ‰æ„ä¹‰çš„åç§°ï¼ˆfeature-xxx, bugfix-xxxï¼‰
- **å®šæœŸæ¸…ç†**: åˆ é™¤ä¸å†éœ€è¦çš„åˆ†æ”¯
- **æ•°æ®éš”ç¦»**: æ¯ä¸ªåˆ†æ”¯ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®
- **æµ‹è¯•éªŒè¯**: åœ¨åˆ†æ”¯ä¸Šå……åˆ†æµ‹è¯•åå†åˆå¹¶

---

## 7. æˆæœ¬ä¼˜åŒ–

### 7.1 Neon æˆæœ¬ä¼˜åŒ–

```bash
# ä½¿ç”¨æš‚åœåŠŸèƒ½ï¼ˆè‡ªåŠ¨æš‚åœï¼‰
# Neon è‡ªåŠ¨æš‚åœä¸æ´»è·ƒçš„æ•°æ®åº“

# æ‰‹åŠ¨æš‚åœ
neonctl branches suspend --project-id <project-id> --branch-id <branch-id>

# æ¢å¤
neonctl branches resume --project-id <project-id> --branch-id <branch-id>
```

### 7.2 AWS RDS Serverless æˆæœ¬ä¼˜åŒ–

```bash
# è®¾ç½®æœ€å°å®¹é‡ï¼ˆé™ä½æˆæœ¬ï¼‰
aws rds modify-db-cluster \
  --db-cluster-identifier my-serverless-cluster \
  --serverless-v2-scaling-configuration MinCapacity=0.5,MaxCapacity=8

# ä½¿ç”¨é¢„ç•™å®¹é‡ï¼ˆé•¿æœŸä½¿ç”¨ï¼‰
aws rds purchase-reserved-db-instances-offering \
  --reserved-db-instances-offering-id <offering-id>
```

### 7.3 é€šç”¨ä¼˜åŒ–å»ºè®®

- **è¿æ¥æ± **: ä½¿ç”¨è¿æ¥æ± å‡å°‘è¿æ¥æ•°
- **æŸ¥è¯¢ä¼˜åŒ–**: ä¼˜åŒ–æ…¢æŸ¥è¯¢ï¼Œå‡å°‘è®¡ç®—èµ„æº
- **ç´¢å¼•ä¼˜åŒ–**: åˆç†ä½¿ç”¨ç´¢å¼•ï¼Œå‡å°‘æ‰«æ
- **å®šæœŸæ¸…ç†**: æ¸…ç†ä¸å¿…è¦çš„æ•°æ®å’Œåˆ†æ”¯

---

## 8. è¿ç§»åˆ° Serverless

### 8.1 ä»è‡ªå»º PostgreSQL è¿ç§»

#### ä½¿ç”¨ pg_dump

```bash
# å¯¼å‡ºæ•°æ®
pg_dump -h localhost -U postgres -d mydb -F c -f mydb.dump

# å¯¼å…¥åˆ° Neon
pg_restore -h ep-xxx.neon.tech -U user -d neondb -F c mydb.dump
```

#### ä½¿ç”¨é€»è¾‘å¤åˆ¶

```sql
-- åœ¨æºæ•°æ®åº“åˆ›å»ºå‘å¸ƒ
CREATE PUBLICATION mypub FOR ALL TABLES;

-- åœ¨ç›®æ ‡æ•°æ®åº“åˆ›å»ºè®¢é˜…
CREATE SUBSCRIPTION mysub
CONNECTION 'host=source_host port=5432 user=replicator password=password dbname=mydb'
PUBLICATION mypub;
```

### 11.2 è¿ç§»æ£€æŸ¥æ¸…å•

- [ ] å¤‡ä»½æºæ•°æ®åº“
- [ ] æ£€æŸ¥æ‰©å±•å…¼å®¹æ€§
- [ ] æµ‹è¯•è¿æ¥å’Œæ€§èƒ½
- [ ] è¿ç§»æ•°æ®
- [ ] éªŒè¯æ•°æ®å®Œæ•´æ€§
- [ ] æ›´æ–°åº”ç”¨è¿æ¥å­—ç¬¦ä¸²
- [ ] ç›‘æ§æ€§èƒ½å’Œæˆæœ¬

### 11.3 è¿ç§»åéªŒè¯å’Œä¼˜åŒ–

**è¿ç§»åéªŒè¯æ­¥éª¤**:

```bash
# 1. éªŒè¯æ•°æ®å®Œæ•´æ€§
psql -h ep-xxx.neon.tech -U user -d neondb -c "SELECT count(*) FROM table_name;"

# 2. éªŒè¯æ‰©å±•
psql -h ep-xxx.neon.tech -U user -d neondb -c "\dx"

# 3. æ€§èƒ½æµ‹è¯•
psql -h ep-xxx.neon.tech -U user -d neondb -c "EXPLAIN (ANALYZE, BUFFERS, TIMING) SELECT * FROM table_name WHERE id = 1;"

# 4. è¿æ¥æµ‹è¯•
psql -h ep-xxx.neon.tech -U user -d neondb -c "SELECT version();"
```

**è¿ç§»åä¼˜åŒ–**:

```sql
-- 1. æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
ANALYZE;

-- 2. é‡å»ºç´¢å¼•
REINDEX DATABASE neondb;

-- 3. ä¼˜åŒ–æŸ¥è¯¢
EXPLAIN (ANALYZE, BUFFERS, TIMING) SELECT * FROM table_name WHERE condition;

-- 4. é…ç½®è¿æ¥æ± 
-- ä½¿ç”¨Neonçš„è¿æ¥æ± ç«¯ç‚¹
```

---

## 8. Neonè¯¦ç»†é…ç½®å’Œä¼˜åŒ–

### 8.1 ç”Ÿäº§ç¯å¢ƒé…ç½®

**ç”Ÿäº§çº§Neoné¡¹ç›®é…ç½®**:

```bash
# 1. åˆ›å»ºç”Ÿäº§é¡¹ç›®
neonctl projects create \
  --name production-db \
  --region us-east-2 \
  --pg-version 18

# 2. è·å–é¡¹ç›®ID
PROJECT_ID=$(neonctl projects list --output json | jq -r '.[0].id')

# 3. åˆ›å»ºç”Ÿäº§åˆ†æ”¯
neonctl branches create \
  --project-id $PROJECT_ID \
  --name production \
  --parent-id main

# 4. è·å–è¿æ¥å­—ç¬¦ä¸²
neonctl connection-string \
  --project-id $PROJECT_ID \
  --branch-name production \
  --pooled  # ä½¿ç”¨è¿æ¥æ± 
```

**ç¯å¢ƒå˜é‡é…ç½®**:

```bash
# .env.production
DATABASE_URL=postgresql://user:password@ep-xxx-pooler.us-east-2.aws.neon.tech/neondb?sslmode=require
DATABASE_POOL_SIZE=25
DATABASE_MAX_CONNECTIONS=100
```

**åº”ç”¨è¿æ¥é…ç½®**:

```python
# Pythonç¤ºä¾‹
import os
import psycopg2
from psycopg2 import pool

# åˆ›å»ºè¿æ¥æ± 
connection_pool = psycopg2.pool.SimpleConnectionPool(
    1,
    int(os.getenv('DATABASE_POOL_SIZE', 25)),
    os.getenv('DATABASE_URL')
)

def get_connection():
    return connection_pool.getconn()

def return_connection(conn):
    connection_pool.putconn(conn)
```

### 8.2 æ€§èƒ½ä¼˜åŒ–é…ç½®

**æŸ¥è¯¢ä¼˜åŒ–**:

```sql
-- 1. åˆ›å»ºç´¢å¼•
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_orders_user_id ON orders(user_id);

-- 2. åˆ†æè¡¨
ANALYZE users;
ANALYZE orders;

-- 3. ä½¿ç”¨è¿æ¥æ± 
-- ä½¿ç”¨poolerç«¯ç‚¹è¿æ¥
-- postgresql://user:password@ep-xxx-pooler.neon.tech/neondb

-- 4. ä¼˜åŒ–æŸ¥è¯¢
EXPLAIN (ANALYZE, BUFFERS, TIMING) SELECT * FROM users WHERE email = 'user@example.com';
```

**è¿æ¥æ± é…ç½®**:

```bash
# ä½¿ç”¨PgBouncerè¿æ¥æ± ï¼ˆNeonè‡ªåŠ¨æä¾›ï¼‰
# è¿æ¥å­—ç¬¦ä¸²ä½¿ç”¨poolerç«¯ç‚¹
DATABASE_URL=postgresql://user:password@ep-xxx-pooler.us-east-2.aws.neon.tech/neondb?sslmode=require

# è¿æ¥æ± æ¨¡å¼
# - transaction: äº‹åŠ¡çº§è¿æ¥æ± ï¼ˆæ¨èï¼‰
# - session: ä¼šè¯çº§è¿æ¥æ± 
```

### 8.3 æˆæœ¬ä¼˜åŒ–ç­–ç•¥

**æˆæœ¬ä¼˜åŒ–æ–¹æ³•**:

```bash
# 1. ä½¿ç”¨è‡ªåŠ¨æš‚åœåŠŸèƒ½
# Neonè‡ªåŠ¨æš‚åœä¸æ´»è·ƒçš„åˆ†æ”¯

# 2. æ‰‹åŠ¨æš‚åœä¸ä½¿ç”¨çš„åˆ†æ”¯
neonctl branches suspend \
  --project-id $PROJECT_ID \
  --branch-id $BRANCH_ID

# 3. åˆ é™¤ä¸éœ€è¦çš„åˆ†æ”¯
neonctl branches delete \
  --project-id $PROJECT_ID \
  --branch-id $BRANCH_ID

# 4. ç›‘æ§ä½¿ç”¨é‡
neonctl projects show \
  --project-id $PROJECT_ID
```

**æˆæœ¬ç›‘æ§**:

```bash
# æŸ¥çœ‹é¡¹ç›®ä½¿ç”¨æƒ…å†µ
neonctl projects show --project-id $PROJECT_ID --output json | jq '.usage'

# æŸ¥çœ‹åˆ†æ”¯ä½¿ç”¨æƒ…å†µ
neonctl branches list --project-id $PROJECT_ID --output json | jq '.[] | {name: .name, active: .active}'
```

### 8.4 ç›‘æ§å’Œå‘Šè­¦é…ç½®

**Neonç›‘æ§é›†æˆ**:

```python
# Pythonç›‘æ§è„šæœ¬
import requests
import os

def check_neon_health():
    """æ£€æŸ¥Neonæ•°æ®åº“å¥åº·çŠ¶æ€"""
    url = os.getenv('DATABASE_URL')
    try:
        conn = psycopg2.connect(url)
        cursor = conn.cursor()
        cursor.execute("SELECT 1")
        cursor.close()
        conn.close()
        return True
    except Exception as e:
        print(f"Health check failed: {e}")
        return False

# å®šæœŸå¥åº·æ£€æŸ¥
import time
while True:
    if not check_neon_health():
        # å‘é€å‘Šè­¦
        send_alert("Neon database health check failed")
    time.sleep(60)
```

## 9. Supabaseè¯¦ç»†é…ç½®

### 9.1 ç”Ÿäº§ç¯å¢ƒé…ç½®

**ç”Ÿäº§çº§Supabaseé¡¹ç›®é…ç½®**:

```bash
# 1. åˆ›å»ºSupabaseé¡¹ç›®ï¼ˆé€šè¿‡Webæ§åˆ¶å°ï¼‰
# è®¿é—® https://supabase.com/dashboard

# 2. è·å–è¿æ¥å­—ç¬¦ä¸²
# åœ¨é¡¹ç›®è®¾ç½®ä¸­è·å–è¿æ¥å­—ç¬¦ä¸²

# 3. é…ç½®ç¯å¢ƒå˜é‡
export SUPABASE_URL=https://xxx.supabase.co
export SUPABASE_KEY=your-anon-key
export SUPABASE_SERVICE_KEY=your-service-key
```

**åº”ç”¨é…ç½®**:

```javascript
// JavaScriptç¤ºä¾‹
import { createClient } from '@supabase/supabase-js'

const supabaseUrl = process.env.SUPABASE_URL
const supabaseKey = process.env.SUPABASE_KEY

const supabase = createClient(supabaseUrl, supabaseKey)

// ä½¿ç”¨è¿æ¥æ± 
const supabasePooled = createClient(supabaseUrl, supabaseKey, {
  db: {
    schema: 'public',
  },
  auth: {
    persistSession: true,
    autoRefreshToken: true,
  },
})
```

### 9.2 å®æ—¶åŠŸèƒ½é…ç½®

**å®æ—¶è®¢é˜…é…ç½®**:

```sql
-- 1. å¯ç”¨å®æ—¶åŠŸèƒ½
ALTER PUBLICATION supabase_realtime ADD TABLE messages;
ALTER PUBLICATION supabase_realtime ADD TABLE notifications;

-- 2. é…ç½®è¡Œçº§å®‰å…¨ç­–ç•¥
ALTER TABLE messages ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view their own messages"
ON messages FOR SELECT
USING (auth.uid() = user_id);
```

**JavaScriptå®æ—¶è®¢é˜…**:

```javascript
// è®¢é˜…è¡¨å˜åŒ–
const channel = supabase
  .channel('messages')
  .on('postgres_changes',
    {
      event: 'INSERT',
      schema: 'public',
      table: 'messages'
    },
    (payload) => {
      console.log('New message:', payload.new)
    }
  )
  .subscribe()

// è®¢é˜…æ›´æ–°
const updateChannel = supabase
  .channel('updates')
  .on('postgres_changes',
    {
      event: 'UPDATE',
      schema: 'public',
      table: 'messages'
    },
    (payload) => {
      console.log('Message updated:', payload.new)
    }
  )
  .subscribe()
```

### 9.3 å­˜å‚¨é›†æˆé…ç½®

**å­˜å‚¨æ¡¶é…ç½®**:

```sql
-- 1. åˆ›å»ºå­˜å‚¨æ¡¶
INSERT INTO storage.buckets (id, name, public)
VALUES ('avatars', 'avatars', true);

-- 2. é…ç½®å­˜å‚¨ç­–ç•¥
CREATE POLICY "Users can upload avatars"
ON storage.objects FOR INSERT
WITH CHECK (
  bucket_id = 'avatars' AND
  auth.uid()::text = (storage.foldername(name))[1]
);

CREATE POLICY "Public can view avatars"
ON storage.objects FOR SELECT
USING (bucket_id = 'avatars');
```

**æ–‡ä»¶ä¸Šä¼ ç¤ºä¾‹**:

```javascript
// ä¸Šä¼ æ–‡ä»¶
const { data, error } = await supabase.storage
  .from('avatars')
  .upload(`${userId}/avatar.png`, file, {
    cacheControl: '3600',
    upsert: true
  })

// è·å–å…¬å…±URL
const { data: { publicUrl } } = supabase.storage
  .from('avatars')
  .getPublicUrl(`${userId}/avatar.png`)
```

### 9.4 å®‰å…¨é…ç½®

**è¡Œçº§å®‰å…¨ç­–ç•¥é…ç½®**:

```sql
-- 1. å¯ç”¨è¡Œçº§å®‰å…¨
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE orders ENABLE ROW LEVEL SECURITY;

-- 2. åˆ›å»ºç­–ç•¥
CREATE POLICY "Users can view own profile"
ON users FOR SELECT
USING (auth.uid() = id);

CREATE POLICY "Users can update own profile"
ON users FOR UPDATE
USING (auth.uid() = id);

CREATE POLICY "Users can view own orders"
ON orders FOR SELECT
USING (auth.uid() = user_id);
```

**APIå¯†é’¥ç®¡ç†**:

```bash
# ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†å¯†é’¥
export SUPABASE_ANON_KEY=your-anon-key
export SUPABASE_SERVICE_KEY=your-service-key

# åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨æœåŠ¡å¯†é’¥ï¼ˆä»…æœåŠ¡å™¨ç«¯ï¼‰
# åœ¨å®¢æˆ·ç«¯ä½¿ç”¨åŒ¿åå¯†é’¥
```

## 10. AWS RDS Serverless v2è¯¦ç»†é…ç½®

### 10.1 ç”Ÿäº§ç¯å¢ƒé…ç½®

**ç”Ÿäº§çº§RDS Serverless v2é…ç½®**:

```bash
# åˆ›å»ºç”Ÿäº§çº§Serverless v2é›†ç¾¤
aws rds create-db-cluster \
  --db-cluster-identifier production-serverless \
  --engine aurora-postgresql \
  --engine-version 18.0 \
  --database-name mydb \
  --master-username postgres \
  --master-user-password $(aws secretsmanager get-secret-value --secret-id db-password --query SecretString --output text) \
  --serverless-v2-scaling-configuration MinCapacity=2,MaxCapacity=32 \
  --backup-retention-period 7 \
  --preferred-backup-window "03:00-04:00" \
  --preferred-maintenance-window "sun:04:00-sun:05:00" \
  --storage-encrypted \
  --kms-key-id alias/aws/rds \
  --enable-http-endpoint \
  --enable-global-write-forwarding \
  --db-cluster-parameter-group-name default.aurora-postgresql18 \
  --vpc-security-group-ids sg-xxx \
  --db-subnet-group-name default \
  --tags Key=Environment,Value=Production Key=Application,Value=MyApp
```

**Terraformé…ç½®**:

```hcl
# rds-serverless.tf
resource "aws_rds_cluster" "serverless" {
  cluster_identifier      = "production-serverless"
  engine                 = "aurora-postgresql"
  engine_version         = "18.0"
  database_name          = "mydb"
  master_username       = "postgres"
  master_password       = var.db_password

  serverlessv2_scaling_configuration {
    min_capacity = 2
    max_capacity = 32
  }

  backup_retention_period = 7
  preferred_backup_window = "03:00-04:00"
  preferred_maintenance_window = "sun:04:00-sun:05:00"

  storage_encrypted = true
  kms_key_id        = aws_kms_key.rds.arn

  enabled_cloudwatch_logs_exports = ["postgresql", "upgrade"]

  vpc_security_group_ids = [aws_security_group.rds.id]
  db_subnet_group_name   = aws_db_subnet_group.main.name

  tags = {
    Environment = "Production"
    Application = "MyApp"
  }
}

resource "aws_rds_cluster_instance" "serverless" {
  identifier         = "production-serverless-instance"
  cluster_identifier = aws_rds_cluster.serverless.id
  instance_class     = "db.serverless"
  engine             = aws_rds_cluster.serverless.engine
  engine_version     = aws_rds_cluster.serverless.engine_version
}
```

### 10.2 è‡ªåŠ¨æ‰©ç¼©å®¹é…ç½®

**æ‰©ç¼©å®¹é…ç½®ä¼˜åŒ–**:

```bash
# æ›´æ–°æ‰©ç¼©å®¹é…ç½®
aws rds modify-db-cluster \
  --db-cluster-identifier production-serverless \
  --serverless-v2-scaling-configuration MinCapacity=4,MaxCapacity=64 \
  --apply-immediately

# æŸ¥çœ‹å½“å‰é…ç½®
aws rds describe-db-clusters \
  --db-cluster-identifier production-serverless \
  --query 'DBClusters[0].ServerlessV2ScalingConfiguration'
```

**è‡ªåŠ¨æ‰©ç¼©å®¹ç›‘æ§**:

```bash
# ç›‘æ§ACUä½¿ç”¨æƒ…å†µ
aws cloudwatch get-metric-statistics \
  --namespace AWS/RDS \
  --metric-name ServerlessDatabaseCapacity \
  --dimensions Name=DBClusterIdentifier,Value=production-serverless \
  --start-time $(date -u -d '1 hour ago' +%Y-%m-%dT%H:%M:%S) \
  --end-time $(date -u +%Y-%m-%dT%H:%M:%S) \
  --period 300 \
  --statistics Average,Maximum
```

### 10.3 é«˜å¯ç”¨é…ç½®

**å¤šå¯ç”¨åŒºé…ç½®**:

```bash
# åˆ›å»ºå¤šå¯ç”¨åŒºé›†ç¾¤
aws rds create-db-cluster \
  --db-cluster-identifier production-serverless \
  --engine aurora-postgresql \
  --engine-version 18.0 \
  --serverless-v2-scaling-configuration MinCapacity=2,MaxCapacity=32 \
  --availability-zones us-east-1a us-east-1b us-east-1c \
  --database-name mydb \
  --master-username postgres \
  --master-user-password $PASSWORD
```

**æ•…éšœè½¬ç§»é…ç½®**:

```bash
# é…ç½®è‡ªåŠ¨æ•…éšœè½¬ç§»
aws rds modify-db-cluster \
  --db-cluster-identifier production-serverless \
  --preferred-maintenance-window "sun:04:00-sun:05:00" \
  --backup-retention-period 7 \
  --preferred-backup-window "03:00-04:00"

# æµ‹è¯•æ•…éšœè½¬ç§»
aws rds failover-db-cluster \
  --db-cluster-identifier production-serverless
```

### 10.4 ç›‘æ§å’Œå‘Šè­¦é…ç½®

**CloudWatchå‘Šè­¦é…ç½®**:

```bash
# åˆ›å»ºCPUä½¿ç”¨ç‡å‘Šè­¦
aws cloudwatch put-metric-alarm \
  --alarm-name rds-serverless-cpu-high \
  --alarm-description "Alert when RDS Serverless CPU is high" \
  --metric-name CPUUtilization \
  --namespace AWS/RDS \
  --statistic Average \
  --period 300 \
  --threshold 80 \
  --comparison-operator GreaterThanThreshold \
  --evaluation-periods 2 \
  --dimensions Name=DBClusterIdentifier,Value=production-serverless

# åˆ›å»ºACUä½¿ç”¨ç‡å‘Šè­¦
aws cloudwatch put-metric-alarm \
  --alarm-name rds-serverless-acu-high \
  --alarm-description "Alert when ACU usage is high" \
  --metric-name ServerlessDatabaseCapacity \
  --namespace AWS/RDS \
  --statistic Average \
  --period 300 \
  --threshold 28 \
  --comparison-operator GreaterThanThreshold \
  --evaluation-periods 2 \
  --dimensions Name=DBClusterIdentifier,Value=production-serverless
```

**æ€§èƒ½ç›‘æ§**:

```bash
# æŸ¥çœ‹æ€§èƒ½æŒ‡æ ‡
aws rds describe-db-cluster-performance-insights \
  --db-cluster-identifier production-serverless

# å¯ç”¨æ€§èƒ½æ´å¯Ÿ
aws rds modify-db-cluster \
  --db-cluster-identifier production-serverless \
  --enable-performance-insights \
  --performance-insights-retention-period 7
```

---

## 12. æ·±å…¥é˜…è¯»

### ç›¸å…³æ–‡æ¡£

#### éƒ¨ç½²æ¶æ„

- â­â­â­ [äº‘åŸç”Ÿä¸å®¹å™¨åŒ–](./05.12-äº‘åŸç”Ÿä¸å®¹å™¨åŒ–.md) - äº‘åŸç”Ÿæ¶æ„
- â­â­â­ [Kubernetes éƒ¨ç½²æŒ‡å—](./05.13-Kuberneteséƒ¨ç½².md) - Kuberneteséƒ¨ç½²
- â­â­ [Docker éƒ¨ç½²æŒ‡å—](./05.12-Dockeréƒ¨ç½².md) - Dockeréƒ¨ç½²

#### å‰æ²¿æŠ€æœ¯

- â­â­â­ [AIä¸æœºå™¨å­¦ä¹ ](../../00-å½’æ¡£-é¡¹ç›®ç®¡ç†æ–‡æ¡£/README.md) - Serverlessæ¶æ„ä¸åˆ†æ”¯åŠŸèƒ½

### å¤–éƒ¨èµ„æº

- [Neon å®˜æ–¹æ–‡æ¡£](https://neon.tech/docs)
- [Supabase å®˜æ–¹æ–‡æ¡£](https://supabase.com/docs)
- [AWS RDS Serverless v2 æ–‡æ¡£](https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/aurora-serverless-v2.html)
- [Azure Flexible Server æ–‡æ¡£](https://docs.microsoft.com/azure/postgresql/flexible-server/)

---

**æœ€åæ›´æ–°**: 2025-11-13
