---

> **ðŸ“‹ æ–‡æ¡£æ¥æº**: `PostgreSQL\cases\æ—¶åºç›‘æŽ§.md`
> **ðŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŽŸæ–‡ä»¶ä¿æŒä¸å˜

---

# æ¡ˆä¾‹ï¼šæ—¶åºç›‘æŽ§ï¼ˆå ä½ï¼‰

## æž¶æž„

- æŒ‡æ ‡é‡‡é›† â†’ PostgreSQL åˆ†åŒºè¡¨ â†’ BRIN ç´¢å¼•/èšåˆ â†’ æŠ¥è¡¨

## å…³é”®ç‚¹

- åˆ†åŒºç­–ç•¥ã€åŽ‹ç¼©ä¸Žä¿ç•™ç­–ç•¥ã€èšåˆç‰©åŒ–ä¸ŽæŸ¥è¯¢è£å‰ª

## éªŒè¯

- æŸ¥è¯¢å»¶è¿Ÿã€å­˜å‚¨æˆæœ¬ã€å†™å…¥åžåä¸Žä¿ç•™åˆè§„

## æœ€å°å¯å¤çŽ°ï¼ˆå ä½ï¼‰

```sql
CREATE TABLE metrics(
  ts timestamptz NOT NULL,
  name text NOT NULL,
  value double precision,
  PRIMARY KEY (ts, name)
) PARTITION BY RANGE (ts);
-- åˆ›å»ºæ¯æ—¥åˆ†åŒºï¼ˆç¤ºæ„ï¼‰
-- CREATE TABLE metrics_20250911 PARTITION OF metrics FOR VALUES FROM ('2025-09-11') TO ('2025-09-12');
CREATE INDEX ON metrics USING brin (ts);

-- æŸ¥è¯¢è£å‰ªæ¼”ç¤º
EXPLAIN SELECT avg(value) FROM metrics WHERE ts >= now() - interval '1 day' AND name = 'cpu';
```
