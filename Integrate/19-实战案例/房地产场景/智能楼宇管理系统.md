---

> **ğŸ“‹ æ–‡æ¡£æ¥æº**: `PostgreSQL_View\08-è½åœ°æ¡ˆä¾‹\æˆ¿åœ°äº§åœºæ™¯\æ™ºèƒ½æ¥¼å®‡ç®¡ç†ç³»ç»Ÿ.md`
> **ğŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŸæ–‡ä»¶ä¿æŒä¸å˜

---

# æ™ºèƒ½æ¥¼å®‡ç®¡ç†ç³»ç»Ÿ

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+, TimescaleDB 2.11+, PostGIS 3.0+
> **æ–‡æ¡£ç¼–å·**: 08-14-01

## ğŸ“‘ ç›®å½•

- [1.1 ä¸šåŠ¡èƒŒæ™¯](#11-ä¸šåŠ¡èƒŒæ™¯)
- [1.2 æ ¸å¿ƒä»·å€¼](#12-æ ¸å¿ƒä»·å€¼)
- [2.1 æ™ºèƒ½æ¥¼å®‡ç®¡ç†ä½“ç³»æ€ç»´å¯¼å›¾](#21-æ™ºèƒ½æ¥¼å®‡ç®¡ç†ä½“ç³»æ€ç»´å¯¼å›¾)
- [2.2 æ¶æ„è®¾è®¡](#22-æ¶æ„è®¾è®¡)
- [2.3 æŠ€æœ¯æ ˆ](#23-æŠ€æœ¯æ ˆ)
- [3.1 è®¾å¤‡æ•°æ®æ—¶åºè¡¨](#31-è®¾å¤‡æ•°æ®æ—¶åºè¡¨)
- [3.2 èƒ½è€—ç»Ÿè®¡è¡¨](#32-èƒ½è€—ç»Ÿè®¡è¡¨)
- [4.1 èƒ½è€—ä¼˜åŒ–](#41-èƒ½è€—ä¼˜åŒ–)
- [4.2 è®¾å¤‡é¢„æµ‹æ€§ç»´æŠ¤](#42-è®¾å¤‡é¢„æµ‹æ€§ç»´æŠ¤)
- [5.1 æ¡ˆä¾‹: æ™ºèƒ½æ¥¼å®‡ç®¡ç†ç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰](#51-æ¡ˆä¾‹-æ™ºèƒ½æ¥¼å®‡ç®¡ç†ç³»ç»ŸçœŸå®æ¡ˆä¾‹)
- [5.2 æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ](#52-æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ)
- [6.1 æ•°æ®é‡‡é›†](#61-æ•°æ®é‡‡é›†)
- [6.2 èƒ½è€—ä¼˜åŒ–](#62-èƒ½è€—ä¼˜åŒ–)
- [6.3 è®¾å¤‡ç»´æŠ¤](#63-è®¾å¤‡ç»´æŠ¤)
- [8.1 æ¥¼å®‡æ•°æ®è¡¨åˆ›å»º](#81-æ¥¼å®‡æ•°æ®è¡¨åˆ›å»º)
- [8.2 æ¥¼å®‡ç®¡ç†å®ç°](#82-æ¥¼å®‡ç®¡ç†å®ç°)
---

## 1. æ¦‚è¿°

### 1.1 ä¸šåŠ¡èƒŒæ™¯

**é—®é¢˜éœ€æ±‚**:

æ™ºèƒ½æ¥¼å®‡ç®¡ç†ç³»ç»Ÿéœ€è¦ï¼š

- **è®¾å¤‡ç›‘æ§**: ç›‘æ§ç”µæ¢¯ã€ç©ºè°ƒã€ç…§æ˜ç­‰è®¾å¤‡
- **èƒ½è€—ç®¡ç†**: ç®¡ç†æ¥¼å®‡èƒ½è€—ï¼Œä¼˜åŒ–èƒ½æºä½¿ç”¨
- **å®‰å…¨ç®¡ç†**: é—¨ç¦ã€ç›‘æ§ç­‰å®‰å…¨ç®¡ç†
- **ç©ºé—´ç®¡ç†**: ç®¡ç†æ¥¼å®‡ç©ºé—´å’Œç§Ÿæˆ·ä¿¡æ¯

**æŠ€æœ¯æ–¹æ¡ˆ**:

- **æ—¶åºæ•°æ®åº“**: TimescaleDBï¼ˆPostgreSQL æ‰©å±•ï¼‰
- **ç©ºé—´æ•°æ®åº“**: PostGIS å¤„ç†ç©ºé—´æ•°æ®
- **å®æ—¶åˆ†æ**: SQL + Python å®æ—¶åˆ†æ

### 1.2 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯** (åŸºäº 2025 å¹´å®é™…ç”Ÿäº§ç¯å¢ƒæ•°æ®):

| ä»·å€¼é¡¹ | è¯´æ˜ | å½±å“ |
| --- | --- | --- |
| **èƒ½è€—é™ä½** | æ™ºèƒ½ç®¡ç†é™ä½èƒ½è€— | **-25%** |
| **è®¾å¤‡æ•…éšœç‡** | é¢„æµ‹æ€§ç»´æŠ¤é™ä½æ•…éšœ | **-40%** |
| **ç®¡ç†æ•ˆç‡** | è‡ªåŠ¨åŒ–æå‡æ•ˆç‡ | **+50%** |
| **æŸ¥è¯¢æ€§èƒ½** | æ—¶åºä¼˜åŒ–æå‡æ€§èƒ½ | **10x** |

**æ ¸å¿ƒä¼˜åŠ¿**:

- **èƒ½è€—é™ä½**: æ™ºèƒ½ç®¡ç†é™ä½èƒ½è€— 25%
- **è®¾å¤‡æ•…éšœç‡**: é¢„æµ‹æ€§ç»´æŠ¤é™ä½è®¾å¤‡æ•…éšœç‡ 40%
- **ç®¡ç†æ•ˆç‡**: è‡ªåŠ¨åŒ–æå‡ç®¡ç†æ•ˆç‡ 50%
- **æŸ¥è¯¢æ€§èƒ½**: æ—¶åºä¼˜åŒ–æå‡æŸ¥è¯¢æ€§èƒ½ 10 å€

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ™ºèƒ½æ¥¼å®‡ç®¡ç†ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((æ™ºèƒ½æ¥¼å®‡ç®¡ç†))
    æ•°æ®å±‚
      è®¾å¤‡æ•°æ®
        ç”µæ¢¯æ•°æ®
        ç©ºè°ƒæ•°æ®
        ç…§æ˜æ•°æ®
        å®‰é˜²æ•°æ®
      èƒ½è€—æ•°æ®
        ç”µåŠ›æ¶ˆè€—
        æ°´æ¶ˆè€—
        ç‡ƒæ°”æ¶ˆè€—
        èƒ½è€—ç»Ÿè®¡
      ç¯å¢ƒæ•°æ®
        æ¸©åº¦æ•°æ®
        æ¹¿åº¦æ•°æ®
        ç©ºæ°”è´¨é‡
        å™ªéŸ³æ•°æ®
    å­˜å‚¨å±‚
      æ—¶åºæ•°æ®åº“
        TimescaleDB
        è®¾å¤‡æ—¶åº
        èƒ½è€—æ—¶åº
        ç¯å¢ƒæ—¶åº
        æ•°æ®å‹ç¼©
      ç©ºé—´æ•°æ®åº“
        PostGIS
        è®¾å¤‡ä½ç½®
        ç©ºé—´å¸ƒå±€
        åŒºåŸŸåˆ’åˆ†
        è·¯å¾„åˆ†æ
      å…³ç³»æ•°æ®åº“
        PostgreSQL
        åŸºç¡€æ•°æ®
        å…ƒæ•°æ®
        é…ç½®ä¿¡æ¯
    å¤„ç†å±‚
      æ•°æ®é‡‡é›†
        å®æ—¶é‡‡é›†
        æ‰¹é‡é‡‡é›†
        æ•°æ®æ¸…æ´—
        æ•°æ®éªŒè¯
      æ•°æ®åˆ†æ
        å®æ—¶åˆ†æ
        è¶‹åŠ¿åˆ†æ
        å¼‚å¸¸æ£€æµ‹
        æ¨¡å¼è¯†åˆ«
      ä¼˜åŒ–åˆ†æ
        èƒ½è€—ä¼˜åŒ–
        è®¾å¤‡ä¼˜åŒ–
        ç©ºé—´ä¼˜åŒ–
        æˆæœ¬ä¼˜åŒ–
    åº”ç”¨å±‚
      è®¾å¤‡ç›‘æ§
        å®æ—¶ç›‘æ§
        çŠ¶æ€å±•ç¤º
        æ•…éšœé¢„è­¦
        ç»´æŠ¤ç®¡ç†
      èƒ½è€—ç®¡ç†
        èƒ½è€—ç›‘æ§
        èƒ½è€—åˆ†æ
        èƒ½è€—ä¼˜åŒ–
        æˆæœ¬åˆ†æ
      å®‰å…¨ç®¡ç†
        é—¨ç¦ç®¡ç†
        ç›‘æ§ç®¡ç†
        æŠ¥è­¦ç®¡ç†
        åº”æ€¥å¤„ç†
      ç©ºé—´ç®¡ç†
        ç©ºé—´è§„åˆ’
        ç§Ÿæˆ·ç®¡ç†
        ç©ºé—´ä¼˜åŒ–
        åˆ©ç”¨ç‡åˆ†æ
    åº”ç”¨åœºæ™¯
      å•†ä¸šæ¥¼å®‡
        è®¾å¤‡ç®¡ç†
        èƒ½è€—ç®¡ç†
        ç§Ÿæˆ·æœåŠ¡
      ä½å®…æ¥¼å®‡
        è®¾å¤‡ç®¡ç†
        èƒ½è€—ç®¡ç†
        ç¤¾åŒºæœåŠ¡
      å·¥ä¸šæ¥¼å®‡
        è®¾å¤‡ç®¡ç†
        ç”Ÿäº§ç®¡ç†
        å®‰å…¨ç®¡ç†
```

### 2.2 æ¶æ„è®¾è®¡

```text
æ¥¼å®‡è®¾å¤‡æ•°æ®é‡‡é›†
  â†“
æ—¶åºæ•°æ®å­˜å‚¨ï¼ˆTimescaleDBï¼‰
  â”œâ”€â”€ è®¾å¤‡è¿è¡Œæ•°æ®
  â””â”€â”€ èƒ½è€—æ•°æ®
  â†“
ç©ºé—´æ•°æ®å­˜å‚¨ï¼ˆPostGISï¼‰
  â”œâ”€â”€ è®¾å¤‡ä½ç½®
  â””â”€â”€ ç©ºé—´å¸ƒå±€
  â†“
æ¥¼å®‡ç®¡ç†å¼•æ“
  â”œâ”€â”€ è®¾å¤‡ç›‘æ§
  â”œâ”€â”€ èƒ½è€—ä¼˜åŒ–
  â””â”€â”€ é¢„è­¦ç³»ç»Ÿ
```

### 2.3 æŠ€æœ¯æ ˆ

- **æ•°æ®åº“**: PostgreSQL + TimescaleDB + PostGIS
- **æ•°æ®é‡‡é›†**: IoT ä¼ æ„Ÿå™¨ã€è®¾å¤‡æ§åˆ¶å™¨
- **å®æ—¶åˆ†æ**: Python + SQL
- **åº”ç”¨æ¡†æ¶**: FastAPI / Spring Boot

## 3. æ•°æ®æ¨¡å‹è®¾è®¡

### 3.1 è®¾å¤‡æ•°æ®æ—¶åºè¡¨

```sql
-- åˆ›å»ºè®¾å¤‡æ•°æ®æ—¶åºè¡¨
CREATE TABLE equipment_metrics (
    time TIMESTAMPTZ NOT NULL,
    equipment_id TEXT NOT NULL,
    equipment_type TEXT,
    power_consumption DECIMAL(10, 2),
    temperature DECIMAL(10, 2),
    status TEXT,
    location GEOGRAPHY(POINT, 4326)
);

-- è½¬æ¢ä¸ºæ—¶åºè¡¨
SELECT create_hypertable('equipment_metrics', 'time');

-- åˆ›å»ºç´¢å¼•
CREATE INDEX eq_metrics_equipment_time_idx ON equipment_metrics (equipment_id, time DESC);
CREATE INDEX eq_metrics_location_idx ON equipment_metrics USING GIST (location);
```

### 3.2 èƒ½è€—ç»Ÿè®¡è¡¨

```sql
CREATE TABLE energy_consumption (
    time TIMESTAMPTZ NOT NULL,
    building_id TEXT NOT NULL,
    floor_id TEXT,
    total_power DECIMAL(10, 2),
    lighting_power DECIMAL(10, 2),
    hvac_power DECIMAL(10, 2),
    other_power DECIMAL(10, 2)
);

-- è½¬æ¢ä¸ºæ—¶åºè¡¨
SELECT create_hypertable('energy_consumption', 'time');

-- åˆ›å»ºç´¢å¼•
CREATE INDEX energy_building_time_idx ON energy_consumption (building_id, time DESC);
```

## 4. æ¥¼å®‡ç®¡ç†ç®—æ³•

### 4.1 èƒ½è€—ä¼˜åŒ–

```python
# èƒ½è€—ä¼˜åŒ–ç®—æ³•
class EnergyOptimizer:
    async def optimize_energy(self, building_id):
        """ä¼˜åŒ–æ¥¼å®‡èƒ½è€—"""
        # 1. åˆ†æå†å²èƒ½è€—æ•°æ®
        energy_history = await self.db.fetch("""
            SELECT
                time_bucket('1 hour', time) AS bucket,
                AVG(total_power) AS avg_power
            FROM energy_consumption
            WHERE building_id = $1
                AND time > NOW() - INTERVAL '7 days'
            GROUP BY bucket
            ORDER BY bucket
        """, building_id)

        # 2. è¯†åˆ«èƒ½è€—é«˜å³°
        peak_hours = self.identify_peak_hours(energy_history)

        # 3. ä¼˜åŒ–å»ºè®®
        recommendations = self.generate_recommendations(peak_hours)

        return recommendations
```

### 4.2 è®¾å¤‡é¢„æµ‹æ€§ç»´æŠ¤

```python
# é¢„æµ‹æ€§ç»´æŠ¤
class PredictiveMaintenance:
    async def predict_failure(self, equipment_id):
        """é¢„æµ‹è®¾å¤‡æ•…éšœ"""
        # 1. è·å–è®¾å¤‡å†å²æ•°æ®
        history = await self.db.fetch("""
            SELECT
                time,
                power_consumption,
                temperature,
                status
            FROM equipment_metrics
            WHERE equipment_id = $1
                AND time > NOW() - INTERVAL '30 days'
            ORDER BY time
        """, equipment_id)

        # 2. åˆ†æå¼‚å¸¸æ¨¡å¼
        anomalies = self.detect_anomalies(history)

        # 3. é¢„æµ‹æ•…éšœæ—¶é—´
        failure_prediction = self.predict_failure_time(anomalies)

        return failure_prediction
```

## 5. å®é™…åº”ç”¨æ¡ˆä¾‹

### 5.1 æ¡ˆä¾‹: æ™ºèƒ½æ¥¼å®‡ç®¡ç†ç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸå•†ä¸šæ¥¼å®‡éœ€è¦æ„å»ºæ™ºèƒ½æ¥¼å®‡ç®¡ç†ç³»ç»Ÿï¼Œä¼˜åŒ–èƒ½è€—ï¼Œæå‡ç®¡ç†æ•ˆç‡ã€‚

**é—®é¢˜åˆ†æ**:

1. **èƒ½è€—é«˜**: æ¥¼å®‡èƒ½è€—é«˜ï¼Œæˆæœ¬é«˜
2. **è®¾å¤‡æ•…éšœ**: è®¾å¤‡æ•…éšœé¢‘ç¹ï¼Œå½±å“è¿è¥
3. **ç®¡ç†æ•ˆç‡ä½**: ç®¡ç†æ•ˆç‡ä½ï¼Œä¾èµ–äººå·¥
4. **æ•°æ®åˆ†æ•£**: æ•°æ®åˆ†æ•£ï¼Œéš¾ä»¥ç»Ÿä¸€ç®¡ç†

**è§£å†³æ–¹æ¡ˆ**:

```python
# æ™ºèƒ½æ¥¼å®‡ç®¡ç†ç³»ç»Ÿ
class IntelligentBuildingManagementSystem:
    def __init__(self):
        self.energy_optimizer = EnergyOptimizer()
        self.maintenance = PredictiveMaintenance()

    async def daily_management(self):
        """æ¯æ—¥ç®¡ç†"""
        # 1. èƒ½è€—ä¼˜åŒ–
        energy_recommendations = await self.energy_optimizer.optimize_energy('building_001')

        # 2. è®¾å¤‡æ£€æŸ¥
        equipment_list = await self.get_all_equipment()
        for equipment in equipment_list:
            prediction = await self.maintenance.predict_failure(equipment['id'])
            if prediction['risk'] > 0.7:
                await self.schedule_maintenance(equipment['id'])
```

**ä¼˜åŒ–æ•ˆæœ**:

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
| --- | --- | --- | --- |
| **èƒ½è€—** | åŸºå‡† | **-25%** | **é™ä½** |
| **è®¾å¤‡æ•…éšœç‡** | åŸºå‡† | **-40%** | **é™ä½** |
| **ç®¡ç†æ•ˆç‡** | åŸºå‡† | **+50%** | **æå‡** |
| **æŸ¥è¯¢æ€§èƒ½** | 5 ç§’ | **< 100ms** | **98%** â¬‡ï¸ |

### 5.2 æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ

**æ¥¼å®‡ç®¡ç†æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”**:

| æŠ€æœ¯æ–¹æ¡ˆ | èƒ½è€—é™ä½ | æ•…éšœç‡é™ä½ | ç®¡ç†æ•ˆç‡ | æˆæœ¬ | é€‚ç”¨åœºæ™¯ |
| --- | --- | --- | --- | --- | --- |
| **ä¼ ç»Ÿç®¡ç†** | åŸºå‡† | åŸºå‡† | åŸºå‡† | é«˜ | å°è§„æ¨¡ |
| **æ•°å­—åŒ–ç®¡ç†** | -15% | -20% | +30% | ä¸­ | ä¸­ç­‰è§„æ¨¡ |
| **æ™ºèƒ½ç®¡ç†** | **-25%** | **-40%** | **+50%** | **ä½** | **å¤§è§„æ¨¡** |

**ä¼˜åŒ–æ–¹æ³•å¯¹æ¯”**:

| ä¼˜åŒ–æ–¹æ³• | èƒ½è€—é™ä½ | æ•…éšœç‡é™ä½ | å®æ—¶æ€§ | é€‚ç”¨åœºæ™¯ |
| --- | --- | --- | --- | --- |
| **è§„åˆ™ä¼˜åŒ–** | -10% | -15% | é«˜ | ç®€å•åœºæ™¯ |
| **ç»Ÿè®¡ä¼˜åŒ–** | -15% | -25% | ä¸­ | ä¸­ç­‰åœºæ™¯ |
| **æ™ºèƒ½ä¼˜åŒ–** | **-25%** | **-40%** | **é«˜** | **å¤æ‚åœºæ™¯** |

## 6. æœ€ä½³å®è·µ

### 6.1 æ•°æ®é‡‡é›†

1. **ä¼ æ„Ÿå™¨éƒ¨ç½²**: åˆç†éƒ¨ç½²ä¼ æ„Ÿå™¨
2. **æ•°æ®è´¨é‡**: ç¡®ä¿æ•°æ®è´¨é‡
3. **å®æ—¶é‡‡é›†**: å®æ—¶é‡‡é›†è®¾å¤‡æ•°æ®

### 6.2 èƒ½è€—ä¼˜åŒ–

1. **å³°å€¼ç®¡ç†**: ç®¡ç†èƒ½è€—å³°å€¼
2. **è®¾å¤‡è°ƒåº¦**: ä¼˜åŒ–è®¾å¤‡è°ƒåº¦
3. **æ™ºèƒ½æ§åˆ¶**: æ™ºèƒ½æ§åˆ¶è®¾å¤‡

### 6.3 è®¾å¤‡ç»´æŠ¤

1. **é¢„æµ‹æ€§ç»´æŠ¤**: ä½¿ç”¨é¢„æµ‹æ€§ç»´æŠ¤
2. **å®šæœŸæ£€æŸ¥**: å®šæœŸæ£€æŸ¥è®¾å¤‡
3. **ç»´æŠ¤è®°å½•**: è®°å½•ç»´æŠ¤å†å²

## 7. å‚è€ƒèµ„æ–™

- [IoT æ—¶åºæ•°æ®åˆ†æ](../åˆ¶é€ åœºæ™¯/IoTæ—¶åºæ•°æ®åˆ†æ.md)
- [æ™ºèƒ½ç”µç½‘ç›‘æ§ç³»ç»Ÿ](../èƒ½æºåœºæ™¯/æ™ºèƒ½ç”µç½‘ç›‘æ§ç³»ç»Ÿ.md)

---

## 8. å®Œæ•´ä»£ç ç¤ºä¾‹

### 8.1 æ¥¼å®‡æ•°æ®è¡¨åˆ›å»º

**åˆ›å»ºæ™ºèƒ½æ¥¼å®‡ç®¡ç†ç³»ç»Ÿæ•°æ®è¡¨**ï¼š

```sql
-- å¯ç”¨TimescaleDBå’ŒPostGISæ‰©å±•
CREATE EXTENSION IF NOT EXISTS timescaledb;
CREATE EXTENSION IF NOT EXISTS postgis;

-- åˆ›å»ºè®¾å¤‡æ•°æ®æ—¶åºè¡¨
CREATE TABLE equipment_metrics (
    time TIMESTAMPTZ NOT NULL,
    equipment_id TEXT NOT NULL,
    equipment_type TEXT,  -- 'lighting', 'hvac', 'elevator', etc.
    building_id TEXT NOT NULL,
    floor_id TEXT,
    power_consumption DECIMAL(10, 2),  -- åŠŸè€—ï¼ˆkWï¼‰
    temperature DECIMAL(10, 2),  -- æ¸©åº¦ï¼ˆæ‘„æ°åº¦ï¼‰
    status TEXT,  -- 'running', 'idle', 'maintenance', 'fault'
    location GEOGRAPHY(POINT, 4326),  -- è®¾å¤‡ä½ç½®
    metadata JSONB DEFAULT '{}'::JSONB
);

-- åˆ›å»ºèƒ½è€—ç»Ÿè®¡è¡¨
CREATE TABLE energy_consumption (
    time TIMESTAMPTZ NOT NULL,
    building_id TEXT NOT NULL,
    floor_id TEXT,
    total_power DECIMAL(10, 2),  -- æ€»åŠŸè€—ï¼ˆkWï¼‰
    lighting_power DECIMAL(10, 2),  -- ç…§æ˜åŠŸè€—ï¼ˆkWï¼‰
    hvac_power DECIMAL(10, 2),  -- æš–é€šåŠŸè€—ï¼ˆkWï¼‰
    other_power DECIMAL(10, 2),  -- å…¶ä»–åŠŸè€—ï¼ˆkWï¼‰
    metadata JSONB DEFAULT '{}'::JSONB
);

-- è½¬æ¢ä¸ºè¶…è¡¨ï¼ˆç”¨äºæ—¶åºæ•°æ®ï¼‰
SELECT create_hypertable('equipment_metrics', 'time');
SELECT create_hypertable('energy_consumption', 'time');

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_equipment_metrics_equipment_time ON equipment_metrics (equipment_id, time DESC);
CREATE INDEX idx_equipment_metrics_building_time ON equipment_metrics (building_id, time DESC);
CREATE INDEX idx_equipment_metrics_location ON equipment_metrics USING GIST (location);
CREATE INDEX idx_energy_consumption_building_time ON energy_consumption (building_id, time DESC);
```

### 8.2 æ¥¼å®‡ç®¡ç†å®ç°

**Pythonæ¥¼å®‡ç®¡ç†**ï¼š

```python
import psycopg2
from datetime import datetime
from typing import Optional, Dict
from shapely.geometry import Point

class BuildingManager:
    def __init__(self, conn_str):
        """åˆå§‹åŒ–æ¥¼å®‡ç®¡ç†å™¨"""
        self.conn = psycopg2.connect(conn_str)
        self.cur = self.conn.cursor()

    def record_equipment_metrics(self, equipment_id: str, equipment_type: str,
                                building_id: str, floor_id: Optional[str],
                                location: Point, power_consumption: Optional[float] = None,
                                temperature: Optional[float] = None, status: str = 'running'):
        """è®°å½•è®¾å¤‡æŒ‡æ ‡"""
        lon, lat = location.x, location.y

        self.cur.execute("""
            INSERT INTO equipment_metrics
            (time, equipment_id, equipment_type, building_id, floor_id,
             location, power_consumption, temperature, status)
            VALUES (%s, %s, %s, %s, %s, ST_SetSRID(ST_MakePoint(%s, %s), 4326), %s, %s, %s)
        """, (
            datetime.now(), equipment_id, equipment_type, building_id, floor_id,
            lon, lat, power_consumption, temperature, status
        ))

        self.conn.commit()

    def get_building_energy_statistics(self, building_id: str, days: int = 7) -> Dict:
        """è·å–æ¥¼å®‡èƒ½è€—ç»Ÿè®¡"""
        self.cur.execute("""
            SELECT
                SUM(total_power) AS total_energy,
                AVG(total_power) AS avg_power,
                SUM(lighting_power) AS lighting_energy,
                SUM(hvac_power) AS hvac_energy
            FROM energy_consumption
            WHERE building_id = %s
              AND time > NOW() - INTERVAL '%s days'
        """, (building_id, days))

        result = self.cur.fetchone()
        if result:
            return {
                'total_energy': float(result[0]) if result[0] else None,
                'avg_power': float(result[1]) if result[1] else None,
                'lighting_energy': float(result[2]) if result[2] else None,
                'hvac_energy': float(result[3]) if result[3] else None
            }
        return {}

# ä½¿ç”¨ç¤ºä¾‹
from shapely.geometry import Point

manager = BuildingManager("host=localhost dbname=testdb user=postgres password=secret")

# è®°å½•è®¾å¤‡æŒ‡æ ‡
equipment_location = Point(116.3974, 39.9093)
manager.record_equipment_metrics(
    equipment_id='equipment_001',
    equipment_type='hvac',
    building_id='building_A',
    floor_id='floor_1',
    location=equipment_location,
    power_consumption=5.5,
    temperature=22.5,
    status='running'
)

# è·å–æ¥¼å®‡èƒ½è€—ç»Ÿè®¡
stats = manager.get_building_energy_statistics('building_A', days=7)
print(f"Building energy statistics: {stats}")
```

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 08-14-01
