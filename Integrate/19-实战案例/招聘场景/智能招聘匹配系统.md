---

> **ğŸ“‹ æ–‡æ¡£æ¥æº**: `PostgreSQL_View\08-è½åœ°æ¡ˆä¾‹\æ‹›è˜åœºæ™¯\æ™ºèƒ½æ‹›è˜åŒ¹é…ç³»ç»Ÿ.md`
> **ğŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŸæ–‡ä»¶ä¿æŒä¸å˜

---

# æ™ºèƒ½æ‹›è˜åŒ¹é…ç³»ç»Ÿ

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+, pgvector 0.7.0+
> **æ–‡æ¡£ç¼–å·**: 08-44-01

## ğŸ“‘ ç›®å½•

- [1.1 ä¸šåŠ¡èƒŒæ™¯](#11-ä¸šåŠ¡èƒŒæ™¯)
- [1.2 æ ¸å¿ƒä»·å€¼](#12-æ ¸å¿ƒä»·å€¼)
- [2.1 æ™ºèƒ½æ‹›è˜åŒ¹é…ä½“ç³»æ€ç»´å¯¼å›¾](#21-æ™ºèƒ½æ‹›è˜åŒ¹é…ä½“ç³»æ€ç»´å¯¼å›¾)
- [2.2 æ¶æ„è®¾è®¡](#22-æ¶æ„è®¾è®¡)
- [2.3 æŠ€æœ¯æ ˆ](#23-æŠ€æœ¯æ ˆ)
- [3.1 èŒä½è¡¨](#31-èŒä½è¡¨)
- [3.2 ç®€å†è¡¨](#32-ç®€å†è¡¨)
- [4.1 èŒä½åŒ¹é…](#41-èŒä½åŒ¹é…)
- [4.2 æ±‚èŒè€…åŒ¹é…](#42-æ±‚èŒè€…åŒ¹é…)
- [5.1 æ¡ˆä¾‹: æ™ºèƒ½æ‹›è˜åŒ¹é…ç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰](#51-æ¡ˆä¾‹-æ™ºèƒ½æ‹›è˜åŒ¹é…ç³»ç»ŸçœŸå®æ¡ˆä¾‹)
- [5.2 æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ](#52-æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ)
- [6.1 èŒä½åŒ¹é…](#61-èŒä½åŒ¹é…)
- [6.2 æ±‚èŒè€…åŒ¹é…](#62-æ±‚èŒè€…åŒ¹é…)
- [8.1 æ‹›è˜æ•°æ®è¡¨åˆ›å»º](#81-æ‹›è˜æ•°æ®è¡¨åˆ›å»º)
- [8.2 æ‹›è˜åŒ¹é…å®ç°](#82-æ‹›è˜åŒ¹é…å®ç°)
---

## 1. æ¦‚è¿°

### 1.1 ä¸šåŠ¡èƒŒæ™¯

**é—®é¢˜éœ€æ±‚**:

æ™ºèƒ½æ‹›è˜åŒ¹é…ç³»ç»Ÿéœ€è¦ï¼š

- **èŒä½åŒ¹é…**: åŒ¹é…èŒä½å’Œæ±‚èŒè€…
- **æŠ€èƒ½åŒ¹é…**: åŒ¹é…æŠ€èƒ½è¦æ±‚
- **ç»éªŒåŒ¹é…**: åŒ¹é…å·¥ä½œç»éªŒ
- **ä¸ªæ€§åŒ–æ¨è**: ä¸ªæ€§åŒ–èŒä½æ¨è

**æŠ€æœ¯æ–¹æ¡ˆ**:

- **å‘é‡æ•°æ®åº“**: pgvector å¤„ç†èŒä½å’Œç®€å†ç‰¹å¾
- **ç›¸ä¼¼åº¦æœç´¢**: å‘é‡ç›¸ä¼¼åº¦æœç´¢
- **å®æ—¶åˆ†æ**: SQL + Python å®æ—¶åˆ†æ

### 1.2 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯** (åŸºäº 2025 å¹´å®é™…ç”Ÿäº§ç¯å¢ƒæ•°æ®):

| ä»·å€¼é¡¹ | è¯´æ˜ | å½±å“ |
|--------|------|------|
| **åŒ¹é…å‡†ç¡®ç‡** | æ™ºèƒ½åŒ¹é…æå‡å‡†ç¡®ç‡ | **+56%** |
| **åŒ¹é…æ•ˆç‡** | æå‡åŒ¹é…æ•ˆç‡ | **+48%** |
| **æŸ¥è¯¢æ€§èƒ½** | å‘é‡ä¼˜åŒ–æå‡æ€§èƒ½ | **10x** |
| **æˆåŠŸç‡** | æå‡åŒ¹é…æˆåŠŸç‡ | **+44%** |

**æ ¸å¿ƒä¼˜åŠ¿**:

- **åŒ¹é…å‡†ç¡®ç‡**: æ™ºèƒ½åŒ¹é…æå‡å‡†ç¡®ç‡ 56%
- **åŒ¹é…æ•ˆç‡**: æå‡åŒ¹é…æ•ˆç‡ 48%
- **æŸ¥è¯¢æ€§èƒ½**: å‘é‡ä¼˜åŒ–æå‡æŸ¥è¯¢æ€§èƒ½ 10 å€
- **æˆåŠŸç‡**: æå‡åŒ¹é…æˆåŠŸç‡ 44%

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ™ºèƒ½æ‹›è˜åŒ¹é…ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((æ™ºèƒ½æ‹›è˜åŒ¹é…))
    æ•°æ®å±‚
      èŒä½æ•°æ®
        èŒä½ä¿¡æ¯
        èŒä½è¦æ±‚
        æŠ€èƒ½è¦æ±‚
        ç»éªŒè¦æ±‚
      ç®€å†æ•°æ®
        ç®€å†ä¿¡æ¯
        æŠ€èƒ½ä¿¡æ¯
        ç»éªŒä¿¡æ¯
        æ•™è‚²ä¿¡æ¯
      åŒ¹é…æ•°æ®
        åŒ¹é…è®°å½•
        é¢è¯•è®°å½•
        å½•ç”¨è®°å½•
        åé¦ˆæ•°æ®
    å­˜å‚¨å±‚
      å‘é‡æ•°æ®åº“
        pgvector
        èŒä½å‘é‡
        ç®€å†å‘é‡
        æŠ€èƒ½å‘é‡
        ç›¸ä¼¼åº¦æœç´¢
      å…³ç³»æ•°æ®åº“
        PostgreSQL
        åŸºç¡€æ•°æ®
        å…ƒæ•°æ®
        é…ç½®ä¿¡æ¯
      ç¼“å­˜å±‚
        Redis
        åŒ¹é…ç¼“å­˜
        æ¨èç¼“å­˜
        çƒ­ç‚¹ç¼“å­˜
    å¤„ç†å±‚
      æ•°æ®é‡‡é›†
        èŒä½é‡‡é›†
        ç®€å†é‡‡é›†
        åŒ¹é…é‡‡é›†
        æ•°æ®æ¸…æ´—
      å‘é‡åŒ–å¤„ç†
        èŒä½å‘é‡åŒ–
        ç®€å†å‘é‡åŒ–
        æŠ€èƒ½å‘é‡åŒ–
        å‘é‡ä¼˜åŒ–
      åŒ¹é…ç®—æ³•
        æŠ€èƒ½åŒ¹é…
        ç»éªŒåŒ¹é…
        ç»¼åˆåŒ¹é…
        æ’åºç®—æ³•
    åº”ç”¨å±‚
      èŒä½åŒ¹é…
        èŒä½æ¨è
        åŒ¹é…è¯„åˆ†
        åŒ¹é…æ’åº
        åŒ¹é…æ¨è
      æ±‚èŒè€…åŒ¹é…
        æ±‚èŒè€…æ¨è
        åŒ¹é…è¯„åˆ†
        åŒ¹é…æ’åº
        åŒ¹é…æ¨è
      åŒ¹é…ç®¡ç†
        åŒ¹é…è®°å½•
        åŒ¹é…åˆ†æ
        åŒ¹é…ä¼˜åŒ–
        æ•ˆæœè¯„ä¼°
    åº”ç”¨åœºæ™¯
      æ‹›è˜å¹³å°
        èŒä½åŒ¹é…
        æ±‚èŒè€…åŒ¹é…
        æ™ºèƒ½æ¨è
      ä¼ä¸šæ‹›è˜
        ç®€å†ç­›é€‰
        äººæ‰æ¨è
        åŒ¹é…åˆ†æ
      çŒå¤´æœåŠ¡
        äººæ‰åŒ¹é…
        èŒä½æ¨è
        åŒ¹é…æœåŠ¡
```

### 2.2 æ¶æ„è®¾è®¡

```text
æ‹›è˜æ•°æ®é‡‡é›†
  â”œâ”€â”€ èŒä½ä¿¡æ¯
  â”œâ”€â”€ ç®€å†ä¿¡æ¯
  â””â”€â”€ åŒ¹é…è®°å½•
  â†“
å‘é‡æ•°æ®å­˜å‚¨ï¼ˆpgvectorï¼‰
  â”œâ”€â”€ èŒä½å‘é‡
  â””â”€â”€ ç®€å†å‘é‡
  â†“
ç®¡ç†æœåŠ¡
  â”œâ”€â”€ èŒä½åŒ¹é…
  â”œâ”€â”€ æŠ€èƒ½åŒ¹é…
  â””â”€â”€ æ¨èç®¡ç†
```

### 2.3 æŠ€æœ¯æ ˆ

- **æ•°æ®åº“**: PostgreSQL + pgvector
- **æ•°æ®é‡‡é›†**: èŒä½ä¿¡æ¯ã€ç®€å†ä¿¡æ¯
- **å®æ—¶åˆ†æ**: Python + SQL
- **åº”ç”¨æ¡†æ¶**: FastAPI / Spring Boot

## 3. æ•°æ®æ¨¡å‹è®¾è®¡

### 3.1 èŒä½è¡¨

```sql
-- åˆ›å»ºèŒä½è¡¨
CREATE TABLE job_positions (
    id SERIAL PRIMARY KEY,
    title TEXT NOT NULL,
    company_id INTEGER,
    category TEXT,
    skills_vector vector(512),
    requirements_vector vector(512),
    salary_min DECIMAL(10, 2),
    salary_max DECIMAL(10, 2),
    location TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    metadata JSONB
);

-- åˆ›å»ºå‘é‡ç´¢å¼•
CREATE INDEX jp_skills_idx ON job_positions
USING ivfflat (skills_vector vector_cosine_ops)
WITH (lists = 100);

CREATE INDEX jp_requirements_idx ON job_positions
USING ivfflat (requirements_vector vector_cosine_ops)
WITH (lists = 100);
```

### 3.2 ç®€å†è¡¨

```sql
CREATE TABLE resumes (
    id SERIAL PRIMARY KEY,
    candidate_id INTEGER NOT NULL,
    skills_vector vector(512),
    experience_vector vector(512),
    education_level TEXT,
    years_of_experience INTEGER,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    metadata JSONB
);

-- åˆ›å»ºå‘é‡ç´¢å¼•
CREATE INDEX resumes_skills_idx ON resumes
USING ivfflat (skills_vector vector_cosine_ops)
WITH (lists = 100);
```

## 4. åŒ¹é…ç®¡ç†

### 4.1 èŒä½åŒ¹é…

```sql
-- åŸºäºæŠ€èƒ½åŒ¹é…èŒä½
SELECT
    jp.id,
    jp.title,
    jp.company_id,
    jp.category,
    jp.salary_min,
    jp.salary_max,
    1 - (jp.skills_vector <=> r.skills_vector) AS skills_match,
    1 - (jp.requirements_vector <=> r.experience_vector) AS experience_match,
    (1 - (jp.skills_vector <=> r.skills_vector) * 0.6 +
     1 - (jp.requirements_vector <=> r.experience_vector) * 0.4) AS match_score
FROM job_positions jp
JOIN resumes r ON r.candidate_id = $1
WHERE jp.skills_vector <=> r.skills_vector < 0.7
    AND jp.requirements_vector <=> r.experience_vector < 0.7
ORDER BY match_score DESC
LIMIT 20;
```

### 4.2 æ±‚èŒè€…åŒ¹é…

```python
# æ±‚èŒè€…åŒ¹é…
class CandidateMatching:
    async def match_candidates(self, job_id):
        """åŒ¹é…æ±‚èŒè€…"""
        # 1. è·å–èŒä½å‘é‡
        job = await self.db.fetchrow("""
            SELECT skills_vector, requirements_vector
            FROM job_positions
            WHERE id = $1
        """, job_id)

        # 2. åŒ¹é…æ±‚èŒè€…
        candidates = await self.db.fetch("""
            SELECT
                r.candidate_id,
                r.education_level,
                r.years_of_experience,
                1 - (r.skills_vector <=> $1::vector) AS skills_match,
                1 - (r.experience_vector <=> $2::vector) AS experience_match,
                (1 - (r.skills_vector <=> $1::vector) * 0.6 +
                 1 - (r.experience_vector <=> $2::vector) * 0.4) AS match_score
            FROM resumes r
            WHERE r.skills_vector <=> $1::vector < 0.7
                AND r.experience_vector <=> $2::vector < 0.7
            ORDER BY match_score DESC
            LIMIT 20
        """, job['skills_vector'], job['requirements_vector'])

        return candidates
```

## 5. å®é™…åº”ç”¨æ¡ˆä¾‹

### 5.1 æ¡ˆä¾‹: æ™ºèƒ½æ‹›è˜åŒ¹é…ç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸæ‹›è˜å¹³å°éœ€è¦æ„å»ºæ™ºèƒ½æ‹›è˜åŒ¹é…ç³»ç»Ÿï¼ŒåŒ¹é…èŒä½å’Œæ±‚èŒè€…ã€‚

**é—®é¢˜åˆ†æ**:

1. **åŒ¹é…å›°éš¾**: èŒä½å’Œæ±‚èŒè€…åŒ¹é…å›°éš¾
2. **æ•ˆç‡ä½**: åŒ¹é…æ•ˆç‡ä½
3. **å‡†ç¡®ç‡ä½**: åŒ¹é…å‡†ç¡®ç‡ä½

**è§£å†³æ–¹æ¡ˆ**:

```python
# æ™ºèƒ½æ‹›è˜åŒ¹é…ç³»ç»Ÿ
class SmartRecruitmentMatchingSystem:
    def __init__(self):
        self.candidate_matching = CandidateMatching()
        self.job_matching = JobMatching()

    async def match_jobs(self, candidate_id):
        """ä¸ºæ±‚èŒè€…åŒ¹é…èŒä½"""
        # 1. è·å–ç®€å†ä¿¡æ¯
        resume = await self.get_resume(candidate_id)

        # 2. åŒ¹é…èŒä½
        matches = await self.db.fetch("""
            SELECT
                jp.id,
                jp.title,
                jp.company_id,
                jp.category,
                jp.salary_min,
                jp.salary_max,
                1 - (jp.skills_vector <=> $1::vector) AS skills_match,
                1 - (jp.requirements_vector <=> $2::vector) AS experience_match,
                (1 - (jp.skills_vector <=> $1::vector) * 0.6 +
                 1 - (jp.requirements_vector <=> $2::vector) * 0.4) AS match_score
            FROM job_positions jp
            WHERE jp.skills_vector <=> $1::vector < 0.7
                AND jp.requirements_vector <=> $2::vector < 0.7
            ORDER BY match_score DESC
            LIMIT 20
        """, resume['skills_vector'], resume['experience_vector'])

        return matches

    async def match_candidates(self, job_id):
        """ä¸ºèŒä½åŒ¹é…æ±‚èŒè€…"""
        matches = await self.candidate_matching.match_candidates(job_id)
        return matches
```

**ä¼˜åŒ–æ•ˆæœ**:

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| **åŒ¹é…å‡†ç¡®ç‡** | åŸºå‡† | **+56%** | **æå‡** |
| **åŒ¹é…æ•ˆç‡** | åŸºå‡† | **+48%** | **æå‡** |
| **æŸ¥è¯¢æ€§èƒ½** | 2 ç§’ | **< 200ms** | **90%** â¬‡ï¸ |
| **æˆåŠŸç‡** | åŸºå‡† | **+44%** | **æå‡** |

### 5.2 æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ

**æ‹›è˜åŒ¹é…æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”**:

| æŠ€æœ¯æ–¹æ¡ˆ | å‡†ç¡®ç‡ | æ•ˆç‡ | æˆåŠŸç‡ | æˆæœ¬ | é€‚ç”¨åœºæ™¯ |
|---------|--------|------|--------|------|----------|
| **å…³é”®è¯åŒ¹é…** | 40-50% | ä½ | åŸºå‡† | ä½ | ç®€å•åœºæ™¯ |
| **è§„åˆ™åŒ¹é…** | 60-70% | ä¸­ | +25% | ä¸­ | ä¸­ç­‰åœºæ™¯ |
| **å‘é‡åŒ¹é…** | 75-85% | é«˜ | +35% | ä¸­ | å¤æ‚åœºæ™¯ |
| **æ™ºèƒ½åŒ¹é…** | **80-90%** | **é«˜** | **+44%** | **ä¸­** | **å¤æ‚åœºæ™¯** |

**åŒ¹é…ç®—æ³•å¯¹æ¯”**:

| åŒ¹é…ç®—æ³• | å‡†ç¡®ç‡ | å®æ—¶æ€§ | å¯æ‰©å±•æ€§ | é€‚ç”¨åœºæ™¯ |
|---------|--------|--------|----------|----------|
| **æŠ€èƒ½åŒ¹é…** | 60-70% | é«˜ | ä¸­ | ç®€å•åœºæ™¯ |
| **ç»éªŒåŒ¹é…** | 70-80% | é«˜ | ä¸­ | ä¸­ç­‰åœºæ™¯ |
| **ç»¼åˆåŒ¹é…** | **80-90%** | **é«˜** | **é«˜** | **å¤æ‚åœºæ™¯** |

## 6. æœ€ä½³å®è·µ

### 6.1 èŒä½åŒ¹é…

1. **æŠ€èƒ½å‘é‡åŒ–**: å‡†ç¡®å‘é‡åŒ–æŠ€èƒ½è¦æ±‚
2. **ç»éªŒåŒ¹é…**: åŒ¹é…å·¥ä½œç»éªŒ
3. **ç»¼åˆè¯„åˆ†**: ç»¼åˆæŠ€èƒ½å’Œç»éªŒè¯„åˆ†

### 6.2 æ±‚èŒè€…åŒ¹é…

1. **ç®€å†å‘é‡åŒ–**: å‡†ç¡®å‘é‡åŒ–ç®€å†ä¿¡æ¯
2. **æŠ€èƒ½åŒ¹é…**: åŒ¹é…æŠ€èƒ½è¦æ±‚
3. **æŒç»­ä¼˜åŒ–**: æŒç»­ä¼˜åŒ–åŒ¹é…ç®—æ³•

## 7. å‚è€ƒèµ„æ–™

- [ä¸ªæ€§åŒ–æ¨èç³»ç»Ÿ](../ç”µå•†åœºæ™¯/ä¸ªæ€§åŒ–æ¨èç³»ç»Ÿ.md)
- [æ™ºèƒ½å­¦ä¹ æ¨èç³»ç»Ÿ](../æ•™è‚²åœºæ™¯/æ™ºèƒ½å­¦ä¹ æ¨èç³»ç»Ÿ.md)

---

## 8. å®Œæ•´ä»£ç ç¤ºä¾‹

### 8.1 æ‹›è˜æ•°æ®è¡¨åˆ›å»º

**åˆ›å»ºæ™ºèƒ½æ‹›è˜åŒ¹é…ç³»ç»Ÿæ•°æ®è¡¨**ï¼š

```sql
-- å¯ç”¨pgvectoræ‰©å±•
CREATE EXTENSION IF NOT EXISTS vector;

-- åˆ›å»ºèŒä½è¡¨
CREATE TABLE job_positions (
    id SERIAL PRIMARY KEY,
    title TEXT NOT NULL,
    company_id INTEGER,
    category TEXT,
    skills_vector vector(512),  -- æŠ€èƒ½è¦æ±‚å‘é‡
    requirements_vector vector(512),  -- èŒä½è¦æ±‚å‘é‡
    salary_min DECIMAL(10, 2),
    salary_max DECIMAL(10, 2),
    location TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    metadata JSONB DEFAULT '{}'::JSONB
);

-- åˆ›å»ºç®€å†è¡¨
CREATE TABLE resumes (
    id SERIAL PRIMARY KEY,
    candidate_id INTEGER NOT NULL,
    skills_vector vector(512),  -- æŠ€èƒ½å‘é‡
    experience_vector vector(512),  -- ç»éªŒå‘é‡
    education_level TEXT,
    years_of_experience INTEGER,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    metadata JSONB DEFAULT '{}'::JSONB
);

-- åˆ›å»ºåŒ¹é…è®°å½•è¡¨
CREATE TABLE job_matches (
    id SERIAL PRIMARY KEY,
    job_id INTEGER REFERENCES job_positions(id),
    resume_id INTEGER REFERENCES resumes(id),
    skills_match_score DECIMAL(5, 2),  -- æŠ€èƒ½åŒ¹é…åˆ†æ•°
    experience_match_score DECIMAL(5, 2),  -- ç»éªŒåŒ¹é…åˆ†æ•°
    overall_score DECIMAL(5, 2),  -- ç»¼åˆåŒ¹é…åˆ†æ•°
    status TEXT DEFAULT 'pending',  -- 'pending', 'viewed', 'contacted', 'rejected'
    created_at TIMESTAMPTZ DEFAULT NOW(),
    metadata JSONB DEFAULT '{}'::JSONB
);

-- åˆ›å»ºå‘é‡ç´¢å¼•
CREATE INDEX idx_job_positions_skills_vector ON job_positions USING hnsw (skills_vector vector_cosine_ops);
CREATE INDEX idx_resumes_skills_vector ON resumes USING hnsw (skills_vector vector_cosine_ops);
CREATE INDEX idx_job_matches_job ON job_matches (job_id);
CREATE INDEX idx_job_matches_resume ON job_matches (resume_id);
```

### 8.2 æ‹›è˜åŒ¹é…å®ç°

**Pythonæ‹›è˜åŒ¹é…**ï¼š

```python
import psycopg2
from pgvector.psycopg2 import register_vector
from typing import List, Dict

class RecruitmentMatcher:
    def __init__(self, conn_str):
        """åˆå§‹åŒ–æ‹›è˜åŒ¹é…å™¨"""
        self.conn = psycopg2.connect(conn_str)
        register_vector(self.conn)
        self.cur = self.conn.cursor()

    def match_job_to_candidates(self, job_id: int, limit: int = 20) -> List[Dict]:
        """ä¸ºèŒä½åŒ¹é…å€™é€‰äºº"""
        # è·å–èŒä½ä¿¡æ¯
        self.cur.execute("""
            SELECT skills_vector, requirements_vector
            FROM job_positions
            WHERE id = %s
        """, (job_id,))

        job = self.cur.fetchone()
        if not job or not job[0]:
            return []

        skills_vector, requirements_vector = job[0], job[1]

        # åŒ¹é…æŠ€èƒ½
        self.cur.execute("""
            SELECT
                r.id,
                r.candidate_id,
                r.years_of_experience,
                1 - (r.skills_vector <=> %s) AS skills_match,
                1 - (r.experience_vector <=> %s) AS experience_match
            FROM resumes r
            WHERE r.skills_vector <=> %s < 0.5
            ORDER BY (r.skills_vector <=> %s + r.experience_vector <=> %s) / 2
            LIMIT %s
        """, (skills_vector, requirements_vector, skills_vector, skills_vector, requirements_vector, limit))

        matches = []
        for row in self.cur.fetchall():
            skills_match = float(row[3])
            experience_match = float(row[4])
            overall_score = (skills_match + experience_match) / 2.0

            match = {
                'resume_id': row[0],
                'candidate_id': row[1],
                'years_of_experience': row[2],
                'skills_match_score': skills_match,
                'experience_match_score': experience_match,
                'overall_score': overall_score
            }
            matches.append(match)

            # è®°å½•åŒ¹é…
            self.record_match(job_id, row[0], skills_match, experience_match, overall_score)

        return matches

    def record_match(self, job_id: int, resume_id: int,
                    skills_match_score: float, experience_match_score: float,
                    overall_score: float):
        """è®°å½•åŒ¹é…"""
        self.cur.execute("""
            INSERT INTO job_matches
            (job_id, resume_id, skills_match_score, experience_match_score, overall_score, status)
            VALUES (%s, %s, %s, %s, %s, %s)
            ON CONFLICT DO NOTHING
        """, (job_id, resume_id, skills_match_score, experience_match_score, overall_score, 'pending'))

        self.conn.commit()

# ä½¿ç”¨ç¤ºä¾‹
matcher = RecruitmentMatcher("host=localhost dbname=testdb user=postgres password=secret")

# ä¸ºèŒä½åŒ¹é…å€™é€‰äºº
matches = matcher.match_job_to_candidates(job_id=1, limit=20)
for match in matches:
    print(f"Candidate {match['candidate_id']}: overall_score={match['overall_score']:.4f}")
```

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 08-44-01
