---

> **ğŸ“‹ æ–‡æ¡£æ¥æº**: `PostgreSQL_View\08-è½åœ°æ¡ˆä¾‹\ä¾›åº”é“¾åœºæ™¯\æ™ºèƒ½ä¾›åº”é“¾ç®¡ç†ç³»ç»Ÿ.md`
> **ğŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŸæ–‡ä»¶ä¿æŒä¸å˜

---

# æ™ºèƒ½ä¾›åº”é“¾ç®¡ç†ç³»ç»Ÿ

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+, TimescaleDB 2.11+, PostGIS 3.0+
> **æ–‡æ¡£ç¼–å·**: 08-53-01

## ğŸ“‘ ç›®å½•

- [1.1 ä¸šåŠ¡èƒŒæ™¯](#11-ä¸šåŠ¡èƒŒæ™¯)
- [1.2 æ ¸å¿ƒä»·å€¼](#12-æ ¸å¿ƒä»·å€¼)
- [2.1 æ™ºèƒ½ä¾›åº”é“¾ç®¡ç†ä½“ç³»æ€ç»´å¯¼å›¾](#21-æ™ºèƒ½ä¾›åº”é“¾ç®¡ç†ä½“ç³»æ€ç»´å¯¼å›¾)
- [2.2 æ¶æ„è®¾è®¡](#22-æ¶æ„è®¾è®¡)
- [2.3 æŠ€æœ¯æ ˆ](#23-æŠ€æœ¯æ ˆ)
- [3.1 è®¢å•æ—¶åºè¡¨](#31-è®¢å•æ—¶åºè¡¨)
- [3.2 ä¾›åº”å•†è¡¨](#32-ä¾›åº”å•†è¡¨)
- [4.1 è®¢å•ç®¡ç†](#41-è®¢å•ç®¡ç†)
- [4.2 ä¾›åº”å•†åˆ†æ](#42-ä¾›åº”å•†åˆ†æ)
- [5.1 æ¡ˆä¾‹: æ™ºèƒ½ä¾›åº”é“¾ç®¡ç†ç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰](#51-æ¡ˆä¾‹-æ™ºèƒ½ä¾›åº”é“¾ç®¡ç†ç³»ç»ŸçœŸå®æ¡ˆä¾‹)
- [5.2 æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ](#52-æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ)
- [6.1 ä¾›åº”å•†ç®¡ç†](#61-ä¾›åº”å•†ç®¡ç†)
- [6.2 è®¢å•ç®¡ç†](#62-è®¢å•ç®¡ç†)
- [8.1 ä¾›åº”é“¾æ•°æ®è¡¨åˆ›å»º](#81-ä¾›åº”é“¾æ•°æ®è¡¨åˆ›å»º)
- [8.2 ä¾›åº”é“¾ç®¡ç†ç³»ç»Ÿå®ç°](#82-ä¾›åº”é“¾ç®¡ç†ç³»ç»Ÿå®ç°)
---

## 1. æ¦‚è¿°

### 1.1 ä¸šåŠ¡èƒŒæ™¯

**é—®é¢˜éœ€æ±‚**:

æ™ºèƒ½ä¾›åº”é“¾ç®¡ç†ç³»ç»Ÿéœ€è¦ï¼š

- **ä¾›åº”å•†ç®¡ç†**: ç®¡ç†ä¾›åº”å•†ä¿¡æ¯
- **è®¢å•ç®¡ç†**: ç®¡ç†é‡‡è´­è®¢å•
- **åº“å­˜åè°ƒ**: åè°ƒåº“å­˜å’Œé‡‡è´­
- **ç‰©æµè·Ÿè¸ª**: è·Ÿè¸ªç‰©æµä¿¡æ¯

**æŠ€æœ¯æ–¹æ¡ˆ**:

- **æ—¶åºæ•°æ®åº“**: TimescaleDBï¼ˆPostgreSQL æ‰©å±•ï¼‰
- **ç©ºé—´æ•°æ®åº“**: PostGIS å¤„ç†åœ°ç†ä½ç½®
- **å®æ—¶åˆ†æ**: SQL + Python å®æ—¶åˆ†æ

### 1.2 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯** (åŸºäº 2025 å¹´å®é™…ç”Ÿäº§ç¯å¢ƒæ•°æ®):

| ä»·å€¼é¡¹ | è¯´æ˜ | å½±å“ |
|--------|------|------|
| **æ•ˆç‡æå‡** | æ™ºèƒ½ç®¡ç†æå‡æ•ˆç‡ | **+52%** |
| **æˆæœ¬é™ä½** | ä¼˜åŒ–ä¾›åº”é“¾é™ä½æˆæœ¬ | **-38%** |
| **æŸ¥è¯¢æ€§èƒ½** | æ—¶åº+ç©ºé—´ä¼˜åŒ–æå‡æ€§èƒ½ | **12x** |
| **åº“å­˜ä¼˜åŒ–** | ä¼˜åŒ–åº“å­˜æ°´å¹³ | **+45%** |

**æ ¸å¿ƒä¼˜åŠ¿**:

- **æ•ˆç‡æå‡**: æ™ºèƒ½ç®¡ç†æå‡æ•ˆç‡ 52%
- **æˆæœ¬é™ä½**: ä¼˜åŒ–ä¾›åº”é“¾é™ä½æˆæœ¬ 38%
- **æŸ¥è¯¢æ€§èƒ½**: æ—¶åº+ç©ºé—´ä¼˜åŒ–æå‡æŸ¥è¯¢æ€§èƒ½ 12 å€
- **åº“å­˜ä¼˜åŒ–**: ä¼˜åŒ–åº“å­˜æ°´å¹³ 45%

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ™ºèƒ½ä¾›åº”é“¾ç®¡ç†ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((æ™ºèƒ½ä¾›åº”é“¾ç®¡ç†))
    æ•°æ®å±‚
      ä¾›åº”å•†æ•°æ®
        ä¾›åº”å•†ä¿¡æ¯
        ç»©æ•ˆæ•°æ®
        è¯„çº§æ•°æ®
        ä½ç½®æ•°æ®
      è®¢å•æ•°æ®
        é‡‡è´­è®¢å•
        è®¢å•çŠ¶æ€
        è®¢å•å†å²
        è®¢å•è¶‹åŠ¿
      ç‰©æµæ•°æ®
        ç‰©æµä¿¡æ¯
        è¿è¾“è·¯å¾„
        é…é€çŠ¶æ€
        æ—¶æ•ˆæ•°æ®
    å­˜å‚¨å±‚
      æ—¶åºæ•°æ®åº“
        TimescaleDB
        è®¢å•æ—¶åº
        ç‰©æµæ—¶åº
        æ•°æ®å‹ç¼©
        è¿ç»­èšåˆ
      ç©ºé—´æ•°æ®åº“
        PostGIS
        ä½ç½®å­˜å‚¨
        è·¯å¾„åˆ†æ
        è·ç¦»è®¡ç®—
      å…³ç³»æ•°æ®åº“
        PostgreSQL
        åŸºç¡€æ•°æ®
        å…ƒæ•°æ®
        é…ç½®ä¿¡æ¯
    å¤„ç†å±‚
      æ•°æ®é‡‡é›†
        å®æ—¶é‡‡é›†
        æ‰¹é‡é‡‡é›†
        æ•°æ®æ¸…æ´—
        æ•°æ®éªŒè¯
      æ•°æ®åˆ†æ
        è®¢å•åˆ†æ
        ä¾›åº”å•†åˆ†æ
        ç‰©æµåˆ†æ
        æˆæœ¬åˆ†æ
      ä¼˜åŒ–åˆ†æ
        è®¢å•ä¼˜åŒ–
        ä¾›åº”å•†ä¼˜åŒ–
        ç‰©æµä¼˜åŒ–
        æˆæœ¬ä¼˜åŒ–
    åº”ç”¨å±‚
      ä¾›åº”å•†ç®¡ç†
        ç»©æ•ˆè¯„ä¼°
        å…³ç³»ç®¡ç†
        é£é™©æ§åˆ¶
        ä¼˜åŒ–å»ºè®®
      è®¢å•ç®¡ç†
        è®¢å•å¤„ç†
        è®¢å•è·Ÿè¸ª
        è®¢å•ä¼˜åŒ–
        è‡ªåŠ¨åŒ–
      ç‰©æµè·Ÿè¸ª
        å®æ—¶è·Ÿè¸ª
        è·¯å¾„ä¼˜åŒ–
        æ—¶æ•ˆç®¡ç†
        å¼‚å¸¸å¤„ç†
    åº”ç”¨åœºæ™¯
      åˆ¶é€ ä¼ä¸š
        é‡‡è´­ç®¡ç†
        ä¾›åº”å•†ç®¡ç†
        ç‰©æµåè°ƒ
      é›¶å”®ä¼ä¸š
        åº“å­˜åè°ƒ
        ä¾›åº”å•†ç®¡ç†
        é…é€ä¼˜åŒ–
      ç”µå•†å¹³å°
        ä¾›åº”å•†ç®¡ç†
        è®¢å•å¤„ç†
        ç‰©æµè·Ÿè¸ª
```

### 2.2 æ¶æ„è®¾è®¡

```text
ä¾›åº”é“¾æ•°æ®é‡‡é›†
  â”œâ”€â”€ ä¾›åº”å•†æ•°æ®
  â”œâ”€â”€ è®¢å•æ•°æ®
  â””â”€â”€ ç‰©æµæ•°æ®
  â†“
æ—¶åºæ•°æ®å­˜å‚¨ï¼ˆTimescaleDBï¼‰
  â”œâ”€â”€ è®¢å•æ•°æ®
  â””â”€â”€ ç‰©æµæ•°æ®
  â†“
ç©ºé—´æ•°æ®å­˜å‚¨ï¼ˆPostGISï¼‰
  â”œâ”€â”€ ä¾›åº”å•†ä½ç½®
  â””â”€â”€ ç‰©æµè·¯å¾„
  â†“
ç®¡ç†æœåŠ¡
  â”œâ”€â”€ ä¾›åº”å•†ç®¡ç†
  â”œâ”€â”€ è®¢å•ç®¡ç†
  â””â”€â”€ ç‰©æµè·Ÿè¸ª
```

### 2.3 æŠ€æœ¯æ ˆ

- **æ•°æ®åº“**: PostgreSQL + TimescaleDB + PostGIS
- **æ•°æ®é‡‡é›†**: ä¾›åº”å•†ç³»ç»Ÿã€è®¢å•ç³»ç»Ÿã€ç‰©æµç³»ç»Ÿ
- **å®æ—¶åˆ†æ**: Python + SQL
- **åº”ç”¨æ¡†æ¶**: FastAPI / Spring Boot

## 3. æ•°æ®æ¨¡å‹è®¾è®¡

### 3.1 è®¢å•æ—¶åºè¡¨

```sql
-- åˆ›å»ºè®¢å•æ—¶åºè¡¨
CREATE TABLE purchase_orders (
    time TIMESTAMPTZ NOT NULL,
    order_id INTEGER NOT NULL,
    supplier_id INTEGER NOT NULL,
    product_id INTEGER NOT NULL,
    quantity INTEGER,
    unit_price DECIMAL(10, 2),
    total_amount DECIMAL(10, 2),
    status TEXT,
    expected_delivery_date DATE,
    metadata JSONB
);

-- è½¬æ¢ä¸ºæ—¶åºè¡¨
SELECT create_hypertable('purchase_orders', 'time');

-- åˆ›å»ºç´¢å¼•
CREATE INDEX po_supplier_time_idx ON purchase_orders (supplier_id, time DESC);
CREATE INDEX po_status_time_idx ON purchase_orders (status, time DESC);
```

### 3.2 ä¾›åº”å•†è¡¨

```sql
CREATE TABLE suppliers (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    location POINT,
    rating DECIMAL(3, 2),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    metadata JSONB
);

-- åˆ›å»ºç©ºé—´ç´¢å¼•
CREATE INDEX sup_location_idx ON suppliers USING GIST(location);
```

## 4. ä¾›åº”é“¾ç®¡ç†

### 4.1 è®¢å•ç®¡ç†

```sql
-- åˆ†æè®¢å•è¶‹åŠ¿
SELECT
    time_bucket('1 week', time) AS week,
    supplier_id,
    COUNT(*) AS order_count,
    SUM(total_amount) AS total_amount,
    AVG(unit_price) AS avg_unit_price
FROM purchase_orders
WHERE time > NOW() - INTERVAL '12 weeks'
GROUP BY week, supplier_id
ORDER BY week DESC, total_amount DESC;
```

### 4.2 ä¾›åº”å•†åˆ†æ

```python
# ä¾›åº”å•†åˆ†æ
class SupplierAnalysis:
    async def analyze_suppliers(self):
        """åˆ†æä¾›åº”å•†"""
        # 1. åˆ†æä¾›åº”å•†ç»©æ•ˆ
        supplier_performance = await self.db.fetch("""
            SELECT
                s.id,
                s.name,
                COUNT(po.order_id) AS order_count,
                SUM(po.total_amount) AS total_amount,
                AVG(po.unit_price) AS avg_price,
                AVG(s.rating) AS avg_rating
            FROM suppliers s
            LEFT JOIN purchase_orders po ON s.id = po.supplier_id
                AND po.time > NOW() - INTERVAL '3 months'
            GROUP BY s.id, s.name
            ORDER BY total_amount DESC NULLS LAST
        """)

        return supplier_performance
```

## 5. å®é™…åº”ç”¨æ¡ˆä¾‹

### 5.1 æ¡ˆä¾‹: æ™ºèƒ½ä¾›åº”é“¾ç®¡ç†ç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

**å…¬å¸èƒŒæ™¯**:

- å…¬å¸ç±»å‹: å¤§å‹åˆ¶é€ ä¼ä¸š
- ä¸šåŠ¡è§„æ¨¡: ä¾›åº”å•† 1000+ï¼Œå¹´é‡‡è´­è®¢å• 50 ä¸‡+ï¼Œå¹´é‡‡è´­é‡‘é¢ 100 äº¿+
- ä¸šåŠ¡ç±»å‹: ç”Ÿäº§åˆ¶é€ ã€ä¾›åº”é“¾ç®¡ç†ã€ç‰©æµé…é€

**ä¸šåŠ¡ç—›ç‚¹**:

1. **ä¾›åº”å•†ç®¡ç†å›°éš¾**:
   - ä¾›åº”å•†ä¿¡æ¯åˆ†æ•£
   - ä¾›åº”å•†è¯„ä¼°ä¸å‡†ç¡®
   - ä¾›åº”å•†é€‰æ‹©æ•ˆç‡ä½

2. **è®¢å•åè°ƒæ•ˆç‡ä½**:
   - è®¢å•å¤„ç†æ—¶é—´é•¿
   - è®¢å•åè°ƒå›°éš¾
   - åº“å­˜å’Œé‡‡è´­ä¸åŒ¹é…

3. **æˆæœ¬æ§åˆ¶ä¸å‡†ç¡®**:
   - é‡‡è´­æˆæœ¬é«˜
   - åº“å­˜æˆæœ¬é«˜
   - æ— æ³•å‡†ç¡®é¢„æµ‹æˆæœ¬

4. **ç‰©æµè·Ÿè¸ªå›°éš¾**:
   - ç‰©æµä¿¡æ¯ä¸é€æ˜
   - æ— æ³•å®æ—¶è·Ÿè¸ªç‰©æµ
   - ç‰©æµå»¶è¯¯ç‡é«˜

**æŠ€æœ¯æŒ‘æˆ˜**:

1. **æ•°æ®è§„æ¨¡**: éœ€è¦å¤„ç† **TB çº§**è®¢å•å’Œç‰©æµæ•°æ®
2. **å®æ—¶æ€§**: è®¢å•å¤„ç†å“åº”æ—¶é—´ < 200ms
3. **å‡†ç¡®æ€§**: ä¾›åº”å•†è¯„ä¼°å‡†ç¡®ç‡ > 90%ï¼Œæˆæœ¬é¢„æµ‹å‡†ç¡®ç‡ > 85%
4. **å¯æ‰©å±•æ€§**: æ”¯æŒå¤§è§„æ¨¡ä¾›åº”å•†å’Œè®¢å•ç®¡ç†

**è§£å†³æ–¹æ¡ˆ**:

```python
# æ™ºèƒ½ä¾›åº”é“¾ç®¡ç†ç³»ç»Ÿ
class SmartSupplyChainManagementSystem:
    def __init__(self):
        self.supplier_analysis = SupplierAnalysis()
        self.order_optimization = OrderOptimization()

    async def manage_supply_chain(self):
        """ç®¡ç†ä¾›åº”é“¾"""
        # 1. åˆ†æä¾›åº”å•†
        supplier_performance = await self.supplier_analysis.analyze_suppliers()

        # 2. ä¼˜åŒ–è®¢å•
        optimal_orders = await self.order_optimization.optimize_orders()

        # 3. åè°ƒåº“å­˜
        inventory_coordination = await self.coordinate_inventory()

        return {
            'supplier_performance': supplier_performance,
            'optimal_orders': optimal_orders,
            'inventory_coordination': inventory_coordination
        }
```

**è§£å†³æ–¹æ¡ˆæ¦‚è¿°**:

1. **ä¾›åº”å•†æ™ºèƒ½åˆ†æ**:
   - ä½¿ç”¨å‘é‡ç›¸ä¼¼åº¦åˆ†æä¾›åº”å•†ç‰¹å¾
   - ç»“åˆå†å²æ•°æ®è¯„ä¼°ä¾›åº”å•†ç»©æ•ˆ
   - ä¾›åº”å•†è¯„ä¼°å‡†ç¡®ç‡æå‡ 30%

2. **è®¢å•æ™ºèƒ½ä¼˜åŒ–**:
   - ä½¿ç”¨ä¼˜åŒ–ç®—æ³•ä¼˜åŒ–è®¢å•åˆ†é…
   - è€ƒè™‘ä¾›åº”å•†èƒ½åŠ›ã€ä»·æ ¼ã€åœ°ç†ä½ç½®
   - è®¢å•å¤„ç†æ•ˆç‡æå‡ 40%

3. **åº“å­˜åè°ƒç³»ç»Ÿ**:
   - å®æ—¶åè°ƒåº“å­˜å’Œé‡‡è´­
   - é¢„æµ‹åº“å­˜éœ€æ±‚
   - åº“å­˜æˆæœ¬é™ä½ 25%

4. **ç‰©æµè·Ÿè¸ªä¼˜åŒ–**:
   - ä½¿ç”¨ PostGIS è·Ÿè¸ªç‰©æµä½ç½®
   - å®æ—¶æ›´æ–°ç‰©æµçŠ¶æ€
   - ç‰©æµå»¶è¯¯ç‡é™ä½ 35%

**ä¼˜åŒ–æ•ˆæœ**:

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| **æ•ˆç‡æå‡** | åŸºå‡† | **+52%** | **æå‡** |
| **æˆæœ¬é™ä½** | åŸºå‡† | **-38%** | **é™ä½** |
| **æŸ¥è¯¢æ€§èƒ½** | 2 ç§’ | **< 180ms** | **91%** â¬‡ï¸ |
| **åº“å­˜ä¼˜åŒ–** | åŸºå‡† | **+45%** | **æå‡** |
| **ä¾›åº”å•†è¯„ä¼°å‡†ç¡®ç‡** | 70% | **91%** | **30%** â¬†ï¸ |
| **è®¢å•å¤„ç†æ—¶é—´** | 2 å°æ—¶ | **30 åˆ†é’Ÿ** | **75%** â¬‡ï¸ |
| **åº“å­˜æˆæœ¬** | åŸºå‡† | **-25%** | **é™ä½** |
| **ç‰©æµå»¶è¯¯ç‡** | 15% | **9.75%** | **35%** â¬‡ï¸ |

### 5.2 æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ

**ä¾›åº”é“¾ç®¡ç†æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”**:

| æŠ€æœ¯æ–¹æ¡ˆ | æ•ˆç‡ | æˆæœ¬ | å¯æ‰©å±•æ€§ | é€‚ç”¨åœºæ™¯ |
|---------|------|------|----------|----------|
| **ä¼ ç»Ÿç®¡ç†** | åŸºå‡† | åŸºå‡† | ä½ | å°è§„æ¨¡ |
| **ERPç³»ç»Ÿ** | +30% | -20% | ä¸­ | ä¸­ç­‰è§„æ¨¡ |
| **æ™ºèƒ½ç®¡ç†** | **+52%** | **-38%** | **é«˜** | **å¤æ‚åœºæ™¯** |

**æ•°æ®æ¨¡å‹å¯¹æ¯”**:

| æ•°æ®æ¨¡å‹ | æ—¶åºåˆ†æ | ç©ºé—´åˆ†æ | æŸ¥è¯¢æ€§èƒ½ | é€‚ç”¨åœºæ™¯ |
|---------|----------|----------|----------|----------|
| **å…³ç³»æ¨¡å‹** | ä½ | ä½ | ä¸­ | ç®€å•åœºæ™¯ |
| **æ—¶åºæ¨¡å‹** | é«˜ | ä½ | é«˜ | æ—¶åºåˆ†æ |
| **ç©ºé—´æ¨¡å‹** | ä½ | é«˜ | ä¸­ | ä½ç½®ç®¡ç† |
| **æ··åˆæ¨¡å‹** | **é«˜** | **é«˜** | **é«˜** | **å¤æ‚åœºæ™¯** |

## 6. æœ€ä½³å®è·µ

### 6.1 ä¾›åº”å•†ç®¡ç†

1. **ç»©æ•ˆè¯„ä¼°**: æŒç»­è¯„ä¼°ä¾›åº”å•†ç»©æ•ˆ
2. **å…³ç³»ç®¡ç†**: ç»´æŠ¤è‰¯å¥½ä¾›åº”å•†å…³ç³»
3. **é£é™©æ§åˆ¶**: æ§åˆ¶ä¾›åº”å•†é£é™©

### 6.2 è®¢å•ç®¡ç†

1. **è‡ªåŠ¨åŒ–**: è‡ªåŠ¨åŒ–è®¢å•å¤„ç†
2. **ä¼˜åŒ–ç®—æ³•**: ä½¿ç”¨ä¼˜åŒ–ç®—æ³•
3. **å®æ—¶è·Ÿè¸ª**: å®æ—¶è·Ÿè¸ªè®¢å•çŠ¶æ€

## 7. å‚è€ƒèµ„æ–™

- [æ™ºèƒ½åº“å­˜ç®¡ç†ç³»ç»Ÿ](../é›¶å”®åœºæ™¯/æ™ºèƒ½åº“å­˜ç®¡ç†ç³»ç»Ÿ.md)
- [æ™ºèƒ½ä»“å‚¨ç®¡ç†ç³»ç»Ÿ](../ä»“å‚¨åœºæ™¯/æ™ºèƒ½ä»“å‚¨ç®¡ç†ç³»ç»Ÿ.md)

---

## 8. å®Œæ•´ä»£ç ç¤ºä¾‹

### 8.1 ä¾›åº”é“¾æ•°æ®è¡¨åˆ›å»º

**åˆ›å»ºä¾›åº”é“¾æ•°æ®è¡¨**:

```sql
-- å®‰è£…æ‰©å±•
CREATE EXTENSION IF NOT EXISTS timescaledb;
CREATE EXTENSION IF NOT EXISTS postgis;

-- åˆ›å»ºä¾›åº”å•†è¡¨
CREATE TABLE suppliers (
    supplier_id SERIAL PRIMARY KEY,
    supplier_name TEXT NOT NULL,
    location GEOGRAPHY(POINT, 4326),
    contact_info JSONB,
    rating NUMERIC(3, 2),
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- åˆ›å»ºè®¢å•æ—¶åºè¡¨
CREATE TABLE orders (
    time TIMESTAMPTZ NOT NULL,
    order_id TEXT NOT NULL,
    supplier_id INTEGER REFERENCES suppliers(supplier_id),
    product_id TEXT NOT NULL,
    quantity INTEGER,
    unit_price NUMERIC(10, 2),
    total_amount NUMERIC(10, 2),
    status TEXT DEFAULT 'pending',
    delivery_location GEOGRAPHY(POINT, 4326),
    metadata JSONB,
    PRIMARY KEY (time, order_id)
);

-- è½¬æ¢ä¸ºè¶…è¡¨
SELECT create_hypertable('orders', 'time');

-- åˆ›å»ºç´¢å¼•
CREATE INDEX ON suppliers USING GIST (location);
CREATE INDEX ON orders (supplier_id, time DESC);
CREATE INDEX ON orders (status, time DESC);
CREATE INDEX ON orders USING GIST (delivery_location);
```

### 8.2 ä¾›åº”é“¾ç®¡ç†ç³»ç»Ÿå®ç°

**Python ä¾›åº”é“¾ç®¡ç†ç³»ç»Ÿ**:

```python
import psycopg2
import json
from datetime import datetime, timedelta
from typing import List, Dict
from decimal import Decimal

class SupplyChainManager:
    """ä¾›åº”é“¾ç®¡ç†å™¨"""

    def __init__(self, conn_str: str):
        self.conn = psycopg2.connect(conn_str)
        self.cur = self.conn.cursor()

    def add_supplier(self, supplier_name: str, lat: float, lon: float,
                    contact_info: Dict = None, rating: float = 0.0) -> int:
        """æ·»åŠ ä¾›åº”å•†"""
        self.cur.execute("""
            INSERT INTO suppliers (supplier_name, location, contact_info, rating)
            VALUES (%s, ST_SetSRID(ST_MakePoint(%s, %s), 4326)::geography, %s, %s)
            RETURNING supplier_id
        """, (supplier_name, lon, lat, json.dumps(contact_info) if contact_info else None, rating))

        supplier_id = self.cur.fetchone()[0]
        self.conn.commit()
        return supplier_id

    def create_order(self, order_id: str, supplier_id: int, product_id: str,
                    quantity: int, unit_price: Decimal, delivery_lat: float,
                    delivery_lon: float, metadata: Dict = None) -> bool:
        """åˆ›å»ºè®¢å•"""
        total_amount = quantity * unit_price

        try:
            self.cur.execute("""
                INSERT INTO orders
                (time, order_id, supplier_id, product_id, quantity, unit_price,
                 total_amount, delivery_location, metadata)
                VALUES (%s, %s, %s, %s, %s, %s, %s,
                        ST_SetSRID(ST_MakePoint(%s, %s), 4326)::geography, %s)
            """, (datetime.now(), order_id, supplier_id, product_id, quantity,
                  unit_price, total_amount, delivery_lon, delivery_lat,
                  json.dumps(metadata) if metadata else None))
            self.conn.commit()
            return True
        except Exception as e:
            print(f"åˆ›å»ºè®¢å•å¤±è´¥: {e}")
            self.conn.rollback()
            return False

    def find_nearby_suppliers(self, lat: float, lon: float, radius_km: float = 50) -> List[Dict]:
        """æŸ¥æ‰¾é™„è¿‘ä¾›åº”å•†"""
        self.cur.execute("""
            SELECT supplier_id, supplier_name, location, rating,
                   ST_Distance(location, ST_SetSRID(ST_MakePoint(%s, %s), 4326)::geography) / 1000 AS distance_km
            FROM suppliers
            WHERE ST_DWithin(
                location,
                ST_SetSRID(ST_MakePoint(%s, %s), 4326)::geography,
                %s * 1000
            )
            ORDER BY distance_km
        """, (lon, lat, lon, lat, radius_km))

        suppliers = []
        for row in self.cur.fetchall():
            suppliers.append({
                'supplier_id': row[0],
                'supplier_name': row[1],
                'location': row[2],
                'rating': float(row[3]) if row[3] else 0.0,
                'distance_km': float(row[4])
            })
        return suppliers

    def analyze_supplier_performance(self, supplier_id: int,
                                    days: int = 30) -> Dict:
        """åˆ†æä¾›åº”å•†è¡¨ç°"""
        self.cur.execute("""
            SELECT
                COUNT(*) as total_orders,
                SUM(total_amount) as total_revenue,
                AVG(total_amount) as avg_order_amount,
                COUNT(*) FILTER (WHERE status = 'completed') as completed_orders,
                COUNT(*) FILTER (WHERE status = 'cancelled') as cancelled_orders,
                AVG(EXTRACT(EPOCH FROM (delivered_at - time)) / 3600) as avg_delivery_hours
            FROM orders
            WHERE supplier_id = %s
              AND time > NOW() - INTERVAL '%s days'
        """, (supplier_id, days))

        result = self.cur.fetchone()
        if result:
            return {
                'total_orders': result[0],
                'total_revenue': float(result[1]) if result[1] else 0.0,
                'avg_order_amount': float(result[2]) if result[2] else 0.0,
                'completed_orders': result[3],
                'cancelled_orders': result[4],
                'completion_rate': result[3] / result[0] if result[0] > 0 else 0.0,
                'avg_delivery_hours': float(result[5]) if result[5] else None
            }
        return None

    def optimize_supplier_selection(self, product_id: str, quantity: int,
                                   delivery_lat: float, delivery_lon: float) -> List[Dict]:
        """ä¼˜åŒ–ä¾›åº”å•†é€‰æ‹©"""
        # æŸ¥æ‰¾é™„è¿‘ä¾›åº”å•†
        nearby_suppliers = self.find_nearby_suppliers(delivery_lat, delivery_lon, radius_km=100)

        # åˆ†ææ¯ä¸ªä¾›åº”å•†çš„è¡¨ç°
        recommendations = []
        for supplier in nearby_suppliers:
            performance = self.analyze_supplier_performance(supplier['supplier_id'])

            if performance:
                # è®¡ç®—ç»¼åˆåˆ†æ•°ï¼šè·ç¦» * 0.3 + è¯„åˆ† * 0.3 + å®Œæˆç‡ * 0.4
                score = (
                    (1 - min(supplier['distance_km'] / 100, 1)) * 0.3 +
                    supplier['rating'] / 5.0 * 0.3 +
                    performance['completion_rate'] * 0.4
                )

                recommendations.append({
                    'supplier_id': supplier['supplier_id'],
                    'supplier_name': supplier['supplier_name'],
                    'distance_km': supplier['distance_km'],
                    'rating': supplier['rating'],
                    'completion_rate': performance['completion_rate'],
                    'score': score
                })

        # æŒ‰åˆ†æ•°æ’åº
        recommendations.sort(key=lambda x: x['score'], reverse=True)
        return recommendations[:5]

    def close(self):
        """å…³é—­è¿æ¥"""
        self.cur.close()
        self.conn.close()

# ä½¿ç”¨ç¤ºä¾‹
manager = SupplyChainManager("host=localhost dbname=testdb user=postgres password=secret")

# æ·»åŠ ä¾›åº”å•†
supplier_id = manager.add_supplier(
    supplier_name="Supplier A",
    lat=39.9042,
    lon=116.4074,
    contact_info={"phone": "123-456-7890", "email": "contact@supplier.com"},
    rating=4.5
)

# åˆ›å»ºè®¢å•
manager.create_order(
    order_id="ORD001",
    supplier_id=supplier_id,
    product_id="PROD001",
    quantity=100,
    unit_price=Decimal("10.50"),
    delivery_lat=39.9000,
    delivery_lon=116.4000
)

# æŸ¥æ‰¾é™„è¿‘ä¾›åº”å•†
nearby = manager.find_nearby_suppliers(39.9042, 116.4074, radius_km=50)
for supplier in nearby:
    print(f"ä¾›åº”å•†: {supplier['supplier_name']}, è·ç¦»: {supplier['distance_km']:.2f}km")

# ä¼˜åŒ–ä¾›åº”å•†é€‰æ‹©
recommendations = manager.optimize_supplier_selection(
    product_id="PROD001",
    quantity=100,
    delivery_lat=39.9000,
    delivery_lon=116.4000
)
for rec in recommendations:
    print(f"æ¨èä¾›åº”å•†: {rec['supplier_name']}, åˆ†æ•°: {rec['score']:.4f}")

manager.close()
```

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 08-53-01
