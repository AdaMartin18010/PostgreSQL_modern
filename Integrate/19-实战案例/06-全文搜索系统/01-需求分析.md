---

> **ğŸ“‹ æ–‡æ¡£æ¥æº**: `DataBaseTheory\19-åœºæ™¯æ¡ˆä¾‹åº“\06-å…¨æ–‡æœç´¢ç³»ç»Ÿ\01-éœ€æ±‚åˆ†æ.md`
> **ğŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŸæ–‡ä»¶ä¿æŒä¸å˜

---

# å…¨æ–‡æœç´¢ç³»ç»Ÿ - éœ€æ±‚åˆ†æ

> **PostgreSQLç‰ˆæœ¬**: 18.x
> **æ–‡æ¡£æ•°**: ç™¾ä¸‡çº§

---

## ä¸€ã€ä¸šåŠ¡åœºæ™¯

### æ–‡æ¡£æœç´¢å¹³å°

- **æ–‡æ¡£ç±»å‹**: æŠ€æœ¯æ–‡ç« ã€äº§å“æ–‡æ¡£ã€ç”¨æˆ·æ‰‹å†Œ
- **æ–‡æ¡£æ•°é‡**: 100ä¸‡+
- **æŸ¥è¯¢ç±»å‹**: å…³é”®è¯æœç´¢ã€çŸ­è¯­æœç´¢ã€æ¨¡ç³Šæœç´¢
- **æ’åº**: ç›¸å…³æ€§æ’åº

---

## äºŒã€æ•°æ®æ¨¡å‹

```sql
-- æ–‡æ¡£è¡¨
CREATE TABLE documents (
    doc_id BIGSERIAL PRIMARY KEY,
    title TEXT NOT NULL,
    content TEXT NOT NULL,
    author VARCHAR(100),
    category VARCHAR(50),
    tags TEXT[],
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- â­ PostgreSQL 18ï¼šå…¨æ–‡æœç´¢ç´¢å¼•
CREATE INDEX idx_documents_fts_title
ON documents USING GIN (to_tsvector('chinese', title));

CREATE INDEX idx_documents_fts_content
ON documents USING GIN (to_tsvector('chinese', content));

-- ç»„åˆæœç´¢ç´¢å¼•
CREATE INDEX idx_documents_fts_combined
ON documents USING GIN (
    to_tsvector('chinese', title || ' ' || content)
);
```

---

## ä¸‰ã€æœç´¢æŸ¥è¯¢

### åŸºç¡€æœç´¢

```sql
-- ç®€å•å…³é”®è¯æœç´¢
SELECT
    doc_id,
    title,
    ts_rank(to_tsvector('chinese', content), query) as rank
FROM documents,
    to_tsquery('chinese', 'æ•°æ®åº“ & ä¼˜åŒ–') query
WHERE to_tsvector('chinese', content) @@ query
ORDER BY rank DESC
LIMIT 20;
```

### é«˜çº§æœç´¢

```sql
-- ä½¿ç”¨websearch_to_tsqueryï¼ˆæ”¯æŒè‡ªç„¶è¯­è¨€ï¼‰
SELECT
    doc_id,
    title,
    ts_rank_cd(
        to_tsvector('chinese', title || ' ' || content),
        query,
        32  -- è¦†ç›–å¯†åº¦æƒé‡
    ) as rank,
    ts_headline(
        'chinese',
        content,
        query,
        'MaxWords=50, MinWords=20'
    ) as snippet
FROM documents,
    websearch_to_tsquery('chinese', 'PostgreSQLæ•°æ®åº“ä¼˜åŒ–') query
WHERE to_tsvector('chinese', title || ' ' || content) @@ query
ORDER BY rank DESC
LIMIT 20;

-- PostgreSQL 18ï¼šä¸­æ–‡åˆ†è¯ä¼˜åŒ–ï¼Œç›¸å…³æ€§æå‡20-40%
```

---

## å››ã€æ€§èƒ½ä¼˜åŒ–

### é¢„è®¡ç®—tsvector

```sql
-- æ·»åŠ tsvectoråˆ—ï¼ˆé¿å…å®æ—¶è®¡ç®—ï¼‰
ALTER TABLE documents
ADD COLUMN tsv tsvector
GENERATED ALWAYS AS (
    to_tsvector('chinese', coalesce(title, '') || ' ' || coalesce(content, ''))
) STORED;

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_documents_tsv ON documents USING GIN (tsv);

-- æŸ¥è¯¢ï¼ˆæ›´å¿«ï¼‰
SELECT doc_id, title,
    ts_rank(tsv, query) as rank
FROM documents,
    to_tsquery('chinese', 'æ•°æ®åº“ & ä¼˜åŒ–') query
WHERE tsv @@ query
ORDER BY rank DESC;
```

---

## äº”ã€PostgreSQL 18ç‰¹æ€§

- **ä¸­æ–‡åˆ†è¯ä¼˜åŒ–**: æ›´å‡†ç¡®çš„åˆ†è¯
- **ç›¸å…³æ€§ç®—æ³•**: ts_rankæ”¹è¿›ï¼Œ+20-40%å‡†ç¡®åº¦
- **GINç´¢å¼•**: æ€§èƒ½ä¼˜åŒ–

---

**æ–‡æ¡£å®Œæˆ** âœ…
