---
> **ğŸ“‹ æ–‡æ¡£æ¥æº**: `DataBaseTheory\19-åœºæ™¯æ¡ˆä¾‹åº“\05-é‡‘èäº¤æ˜“ç³»ç»Ÿ\06-éƒ¨ç½²è¿ç»´.md`
> **ğŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŸæ–‡ä»¶ä¿æŒä¸å˜
---
> **âš ï¸ é‡è¦æç¤º**: æœ¬æ–‡æ¡£éµå¾ªæ¡ˆä¾‹æ–‡æ¡£é€šç”¨æ¨¡æ¿æ ¼å¼ã€‚
>
> **æ¨èé˜…è¯»**:
>
> - [æ¡ˆä¾‹æ–‡æ¡£é€šç”¨æ¨¡æ¿](../æ¡ˆä¾‹æ–‡æ¡£é€šç”¨æ¨¡æ¿.md) - é€šç”¨æ¡ˆä¾‹æ–‡æ¡£æ ¼å¼å’Œæœ€ä½³å®è·µ
>
> æœ¬æ–‡æ¡£ä¿ç•™ä½œä¸ºé‡‘èäº¤æ˜“ç³»ç»Ÿçš„éƒ¨ç½²è¿ç»´å‚è€ƒã€‚
---

# æ¡ˆä¾‹5ï¼šé‡‘èäº¤æ˜“ç³»ç»Ÿ - éƒ¨ç½²è¿ç»´

## å…ƒæ•°æ®

- **åˆ›å»ºæ—¥æœŸ**: 2025-12-22
- **éƒ¨ç½²æ–¹å¼**: Docker + Kubernetes + Patroni
- **ç›‘æ§**: Prometheus + Grafana
- **é«˜å¯ç”¨**: Patroni + HAProxy
- **å¤‡ä»½**: WALå½’æ¡£ + å®šæœŸå…¨é‡å¤‡ä»½

---

## 1. Dockeréƒ¨ç½²é…ç½®

### 1.1 Docker Composeé…ç½®

**Docker Composeé…ç½®ï¼ˆå¸¦Patronié«˜å¯ç”¨ï¼‰**ï¼š

```yaml
version: '3.8'

services:
  postgres-primary:
    image: postgres:18
    container_name: trading-db-primary
    environment:
      POSTGRES_DB: trading_db
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: ${DB_PASSWORD}
      POSTGRES_INITDB_ARGS: "-E UTF8 --locale=C"
    volumes:
      - postgres-primary-data:/var/lib/postgresql/data
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
      - ./postgresql.conf:/etc/postgresql/postgresql.conf
      - ./pg_hba.conf:/etc/postgresql/pg_hba.conf
    ports:
      - "5432:5432"
    command:
      - "postgres"
      - "-c"
      - "config_file=/etc/postgresql/postgresql.conf"
      - "-c"
      - "shared_buffers=8GB"
      - "-c"
      - "work_mem=256MB"
      - "-c"
      - "maintenance_work_mem=2GB"
      - "-c"
      - "max_connections=500"
      - "-c"
      - "effective_cache_size=24GB"
      - "-c"
      - "synchronous_commit=on"
      - "-c"
      - "wal_level=replica"
      - "-c"
      - "max_wal_senders=10"
      - "-c"
      - "hot_standby=on"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped

  postgres-replica:
    image: postgres:18
    container_name: trading-db-replica
    environment:
      POSTGRES_DB: trading_db
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: ${DB_PASSWORD}
      PGUSER: postgres
    volumes:
      - postgres-replica-data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    command:
      - "postgres"
      - "-c"
      - "shared_buffers=8GB"
      - "-c"
      - "max_connections=500"
      - "-c"
      - "hot_standby=on"
    depends_on:
      - postgres-primary
    restart: unless-stopped

  haproxy:
    image: haproxy:latest
    container_name: trading-haproxy
    volumes:
      - ./haproxy.cfg:/usr/local/etc/haproxy/haproxy.cfg
    ports:
      - "5434:5432"
      - "8404:8404"  # Stats page
    depends_on:
      - postgres-primary
      - postgres-replica
    restart: unless-stopped

  api:
    build:
      context: ./api
      dockerfile: Dockerfile
    container_name: trading-api
    environment:
      DB_HOST: haproxy
      DB_PORT: 5432
      DB_NAME: trading_db
      DB_USER: postgres
      DB_PASSWORD: ${DB_PASSWORD}
      DB_READ_HOST: haproxy
      DB_READ_PORT: 5432
    ports:
      - "8005:8005"
    depends_on:
      - haproxy
    restart: unless-stopped

volumes:
  postgres-primary-data:
  postgres-replica-data:
```

### 1.2 PostgreSQLä¼˜åŒ–é…ç½®

**PostgreSQLä¼˜åŒ–é…ç½®ï¼ˆPostgreSQL 18ç‰¹æ€§ï¼Œé‡‘èäº¤æ˜“ç³»ç»Ÿï¼‰**ï¼š

```ini
# postgresql.conf - é‡‘èäº¤æ˜“ç³»ç»Ÿä¼˜åŒ–

# å†…å­˜é…ç½®
shared_buffers = 8GB
work_mem = 256MB
maintenance_work_mem = 2GB
effective_cache_size = 24GB

# è¿æ¥é…ç½®
max_connections = 500
superuser_reserved_connections = 10

# WALé…ç½®ï¼ˆé«˜å¯é æ€§ï¼‰
wal_level = replica
wal_buffers = 32MB
max_wal_size = 16GB
min_wal_size = 4GB
checkpoint_timeout = 15min
checkpoint_completion_target = 0.9
synchronous_commit = on  # é‡‘èç³»ç»Ÿå¿…é¡»åŒæ­¥æäº¤

# æµå¤åˆ¶é…ç½®
max_wal_senders = 10
wal_keep_size = 2GB
hot_standby = on
hot_standby_feedback = on

# PostgreSQL 18å¼‚æ­¥I/O
io_direct = data,wal
io_combine_limit = 256kB

# PostgreSQL 18å†…ç½®è¿æ¥æ± 
pool_mode = transaction
pool_size = 300
pool_max_wait = 5

# æŸ¥è¯¢ä¼˜åŒ–
random_page_cost = 1.1
effective_io_concurrency = 200
default_statistics_target = 100

# äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼ˆé‡‘èç³»ç»Ÿï¼‰
default_transaction_isolation = 'serializable'

# æ—¥å¿—é…ç½®
log_destination = 'stderr'
logging_collector = on
log_directory = 'log'
log_filename = 'postgresql-%Y-%m-%d.log'
log_rotation_age = 1d
log_rotation_size = 100MB
log_min_duration_statement = 500  # è®°å½•>500msçš„æŸ¥è¯¢
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '
log_checkpoints = on
log_connections = on
log_disconnections = on
log_lock_waits = on

# ç»Ÿè®¡ä¿¡æ¯
track_io_timing = on
track_functions = all
pg_stat_statements.track = all
```

---

## 2. é«˜å¯ç”¨é…ç½®

### 2.1 Patronié…ç½®

**Patronié…ç½®ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰**ï¼š

```yaml
# patroni.yml
scope: trading_cluster
namespace: /trading/
name: trading-db-1

restapi:
  listen: 0.0.0.0:8008
  connect_address: localhost:8008

etcd:
  hosts: etcd:2379

bootstrap:
  dcs:
    ttl: 30
    loop_wait: 10
    retry_timeout: 30
    maximum_lag_on_failover: 1048576
    postgresql:
      use_pg_rewind: true
      parameters:
        wal_level: replica
        hot_standby: "on"
        wal_keep_size: 2GB
        max_wal_senders: 10
        max_replication_slots: 10
        synchronous_commit: "on"
        synchronous_standby_names: "ANY 1 (trading-db-2,trading-db-3)"

postgresql:
  listen: 0.0.0.0:5432
  connect_address: localhost:5432
  data_dir: /var/lib/postgresql/data
  pgpass: /tmp/pgpass
  authentication:
    replication:
      username: replicator
      password: replicator_password
    superuser:
      username: postgres
      password: ${POSTGRES_PASSWORD}
  parameters:
    unix_socket_directories: '/var/run/postgresql'
    wal_level: replica
    hot_standby: "on"
    wal_keep_size: 2GB
    max_wal_senders: 10
    max_replication_slots: 10
    synchronous_commit: "on"

tags:
  nofailover: false
  noloadbalance: false
  clonefrom: false
  nosync: false
```

### 2.2 HAProxyé…ç½®

**HAProxyé…ç½®ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰**ï¼š

```cfg
# haproxy.cfg
global
    log stdout format raw local0
    maxconn 1000

defaults
    log global
    mode tcp
    timeout connect 5s
    timeout client 30s
    timeout server 30s

# ä¸»åº“ï¼ˆå†™ï¼‰
listen postgres-primary
    bind *:5432
    mode tcp
    option pgsql-check user postgres
    balance roundrobin
    server postgres-primary postgres-primary:5432 check

# ä»åº“ï¼ˆè¯»ï¼‰
listen postgres-replica
    bind *:5433
    mode tcp
    option pgsql-check user postgres
    balance roundrobin
    server postgres-replica postgres-replica:5432 check

# Statsé¡µé¢
listen stats
    bind *:8404
    mode http
    stats enable
    stats uri /stats
    stats refresh 10s
```

---

## 3. ç›‘æ§é…ç½®

### 3.1 Prometheusé…ç½®

**Prometheusé…ç½®ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰**ï¼š

```yaml
# prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  - job_name: 'postgres'
    static_configs:
      - targets: ['postgres-exporter:9187']
    metrics_path: /metrics

  - job_name: 'trading-api'
    static_configs:
      - targets: ['api:8005']
    metrics_path: /metrics

  - job_name: 'patroni'
    static_configs:
      - targets: ['patroni:8008']
    metrics_path: /metrics
```

### 3.2 Grafanaä»ªè¡¨æ¿

**Grafanaä»ªè¡¨æ¿é…ç½®ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰**ï¼š

```json
{
  "dashboard": {
    "title": "é‡‘èäº¤æ˜“ç³»ç»Ÿç›‘æ§",
    "panels": [
      {
        "title": "TPSï¼ˆæ¯ç§’äº‹åŠ¡æ•°ï¼‰",
        "targets": [
          {
            "expr": "rate(pg_stat_database_xact_commit[5m]) + rate(pg_stat_database_xact_rollback[5m])"
          }
        ]
      },
      {
        "title": "äº‹åŠ¡å»¶è¿Ÿ",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(transaction_duration_ms_bucket[5m]))"
          }
        ]
      },
      {
        "title": "é”ç­‰å¾…",
        "targets": [
          {
            "expr": "pg_stat_database_deadlocks"
          }
        ]
      },
      {
        "title": "å¤åˆ¶å»¶è¿Ÿ",
        "targets": [
          {
            "expr": "pg_replication_lag"
          }
        ]
      },
      {
        "title": "WALå½’æ¡£çŠ¶æ€",
        "targets": [
          {
            "expr": "pg_stat_archiver_archived_count"
          }
        ]
      }
    ]
  }
}
```

---

## 4. å¤‡ä»½ä¸æ¢å¤

### 4.1 WALå½’æ¡£é…ç½®

**WALå½’æ¡£é…ç½®ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰**ï¼š

```ini
# postgresql.conf - WALå½’æ¡£é…ç½®
wal_level = replica
archive_mode = on
archive_command = 'test ! -f /backups/wal/%f && cp %p /backups/wal/%f'
archive_timeout = 300  # 5åˆ†é’Ÿå¼ºåˆ¶å½’æ¡£
```

### 4.2 å…¨é‡å¤‡ä»½è„šæœ¬

**å…¨é‡å¤‡ä»½è„šæœ¬ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰**ï¼š

```bash
#!/bin/bash
# backup_trading.sh - é‡‘èäº¤æ˜“ç³»ç»Ÿå…¨é‡å¤‡ä»½

set -e

BACKUP_DIR="/backups/trading"
DATE=$(date +%Y%m%d_%H%M%S)
RETENTION_DAYS=30

mkdir -p "$BACKUP_DIR"

# 1. åˆ›å»ºå¤‡ä»½ç‚¹
echo "åˆ›å»ºå¤‡ä»½ç‚¹..."
psql -h postgres-primary -U postgres -d trading_db -c "
    SELECT pg_start_backup('backup_$DATE', false, false);
"

# 2. å¤‡ä»½æ•°æ®ç›®å½•
echo "å¤‡ä»½æ•°æ®ç›®å½•..."
tar -czf "$BACKUP_DIR/data_$DATE.tar.gz" \
    -C /var/lib/postgresql/data \
    --exclude='pg_wal' \
    --exclude='pg_replslot' \
    .

# 3. ç»“æŸå¤‡ä»½ç‚¹
echo "ç»“æŸå¤‡ä»½ç‚¹..."
psql -h postgres-primary -U postgres -d trading_db -c "
    SELECT pg_stop_backup(false);
"

# 4. å¤‡ä»½WAL
echo "å¤‡ä»½WAL..."
rsync -av /var/lib/postgresql/data/pg_wal/ "$BACKUP_DIR/wal/"

# 5. æ¸…ç†æ—§å¤‡ä»½
find "$BACKUP_DIR" -name "data_*.tar.gz" -mtime +$RETENTION_DAYS -delete

echo "å¤‡ä»½å®Œæˆ: $BACKUP_DIR/data_$DATE.tar.gz"
```

### 4.3 æ¢å¤è„šæœ¬

**æ¢å¤è„šæœ¬ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰**ï¼š

```bash
#!/bin/bash
# restore_trading.sh - é‡‘èäº¤æ˜“ç³»ç»Ÿæ¢å¤

set -e

BACKUP_FILE=$1
WAL_DIR="/backups/wal"

if [ -z "$BACKUP_FILE" ]; then
    echo "ç”¨æ³•: $0 <å¤‡ä»½æ–‡ä»¶>"
    exit 1
fi

# 1. åœæ­¢PostgreSQL
systemctl stop postgresql

# 2. æ¸…ç©ºæ•°æ®ç›®å½•
rm -rf /var/lib/postgresql/data/*

# 3. æ¢å¤æ•°æ®
echo "æ¢å¤æ•°æ®..."
tar -xzf "$BACKUP_FILE" -C /var/lib/postgresql/data

# 4. é…ç½®æ¢å¤
cat >> /var/lib/postgresql/data/postgresql.conf <<EOF
restore_command = 'cp $WAL_DIR/%f %p'
recovery_target_time = '2025-01-01 00:00:00'  # æŒ‡å®šæ¢å¤æ—¶é—´ç‚¹
EOF

touch /var/lib/postgresql/data/recovery.signal

# 5. å¯åŠ¨PostgreSQL
systemctl start postgresql

echo "æ¢å¤å®Œæˆï¼"
```

---

## 5. æ€§èƒ½è°ƒä¼˜

### 5.1 æ•°æ®åº“æ€§èƒ½è°ƒä¼˜

**æ•°æ®åº“æ€§èƒ½è°ƒä¼˜ï¼ˆPostgreSQL 18ç‰¹æ€§ï¼‰**ï¼š

```sql
-- 1. åˆ†æè¡¨ç»Ÿè®¡ä¿¡æ¯
ANALYZE accounts;
ANALYZE transactions;
ANALYZE audit_logs;

-- 2. é‡å»ºç´¢å¼•
REINDEX INDEX CONCURRENTLY idx_accounts_account_id;
REINDEX INDEX CONCURRENTLY idx_transactions_account_id;

-- 3. æ£€æŸ¥æ…¢æŸ¥è¯¢
SELECT
    query,
    calls,
    total_exec_time,
    mean_exec_time,
    max_exec_time
FROM pg_stat_statements
WHERE mean_exec_time > 500  -- >500ms
ORDER BY mean_exec_time DESC
LIMIT 20;

-- 4. æ£€æŸ¥é”ç­‰å¾…
SELECT
    blocked_locks.pid AS blocked_pid,
    blocking_locks.pid AS blocking_pid,
    blocked_activity.usename AS blocked_user,
    blocking_activity.usename AS blocking_user,
    blocked_activity.query AS blocked_statement,
    blocking_activity.query AS blocking_statement
FROM pg_catalog.pg_locks blocked_locks
JOIN pg_catalog.pg_stat_activity blocked_activity ON blocked_activity.pid = blocked_locks.pid
JOIN pg_catalog.pg_locks blocking_locks
    ON blocking_locks.locktype = blocked_locks.locktype
    AND blocking_locks.database IS NOT DISTINCT FROM blocked_locks.database
    AND blocking_locks.relation IS NOT DISTINCT FROM blocked_locks.relation
    AND blocking_locks.page IS NOT DISTINCT FROM blocked_locks.page
    AND blocking_locks.tuple IS NOT DISTINCT FROM blocked_locks.tuple
    AND blocking_locks.virtualxid IS NOT DISTINCT FROM blocked_locks.virtualxid
    AND blocking_locks.transactionid IS NOT DISTINCT FROM blocked_locks.transactionid
    AND blocking_locks.classid IS NOT DISTINCT FROM blocked_locks.classid
    AND blocking_locks.objid IS NOT DISTINCT FROM blocked_locks.objid
    AND blocking_locks.objsubid IS NOT DISTINCT FROM blocked_locks.objsubid
    AND blocking_locks.pid != blocked_locks.pid
JOIN pg_catalog.pg_stat_activity blocking_activity ON blocking_activity.pid = blocking_locks.pid
WHERE NOT blocked_locks.granted;
```

---

## 6. æ•…éšœå¤„ç†

### 6.1 å¸¸è§æ•…éšœå¤„ç†

**å¸¸è§æ•…éšœå¤„ç†ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰**ï¼š

```bash
# 1. ä¸»åº“æ•…éšœåˆ‡æ¢
# ä½¿ç”¨Patroniè¿›è¡Œæ•…éšœåˆ‡æ¢
patronictl switchover trading_cluster --master trading-db-1 --candidate trading-db-2

# 2. å¤åˆ¶å»¶è¿Ÿæ£€æŸ¥
psql -h postgres-primary -U postgres -d trading_db -c "
    SELECT
        client_addr,
        state,
        sync_state,
        pg_wal_lsn_diff(pg_current_wal_lsn(), sent_lsn) AS replication_lag_bytes
    FROM pg_stat_replication;
"

# 3. æ­»é”æ£€æŸ¥
psql -h postgres-primary -U postgres -d trading_db -c "
    SELECT * FROM pg_stat_database_conflicts;
"

# 4. WALå½’æ¡£æ£€æŸ¥
psql -h postgres-primary -U postgres -d trading_db -c "
    SELECT * FROM pg_stat_archiver;
"

# 5. è¿æ¥æ•°æ£€æŸ¥
psql -h postgres-primary -U postgres -d trading_db -c "
    SELECT count(*) FROM pg_stat_activity WHERE datname = 'trading_db';
"
```

---

## 7. å®‰å…¨é…ç½®

### 7.1 æ•°æ®åº“å®‰å…¨

**æ•°æ®åº“å®‰å…¨é…ç½®ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰**ï¼š

```sql
-- 1. åˆ›å»ºåªè¯»ç”¨æˆ·
CREATE USER readonly_user WITH PASSWORD 'secure_password';
GRANT CONNECT ON DATABASE trading_db TO readonly_user;
GRANT USAGE ON SCHEMA public TO readonly_user;
GRANT SELECT ON ALL TABLES IN SCHEMA public TO readonly_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT SELECT ON TABLES TO readonly_user;

-- 2. åˆ›å»ºåº”ç”¨ç”¨æˆ·ï¼ˆæœ€å°æƒé™ï¼‰
CREATE USER app_user WITH PASSWORD 'secure_password';
GRANT CONNECT ON DATABASE trading_db TO app_user;
GRANT USAGE ON SCHEMA public TO app_user;
GRANT SELECT, INSERT, UPDATE ON accounts, transactions TO app_user;
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA public TO app_user;

-- 3. å¯ç”¨SSL
ALTER SYSTEM SET ssl = on;
ALTER SYSTEM SET ssl_cert_file = '/etc/ssl/certs/server.crt';
ALTER SYSTEM SET ssl_key_file = '/etc/ssl/private/server.key';

-- 4. é…ç½®é˜²ç«å¢™è§„åˆ™ï¼ˆpg_hba.confï¼‰
# TYPE  DATABASE        USER            ADDRESS                 METHOD
host    trading_db      app_user        10.0.0.0/8              md5
host    trading_db      readonly_user   10.0.0.0/8              md5
hostssl all             all             0.0.0.0/0              reject
```

---

## 8. è¿ç»´æ£€æŸ¥æ¸…å•

### 8.1 æ—¥å¸¸æ£€æŸ¥

**æ—¥å¸¸æ£€æŸ¥æ¸…å•ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰**ï¼š

```bash
#!/bin/bash
# daily_check_trading.sh - é‡‘èäº¤æ˜“ç³»ç»Ÿæ—¥å¸¸æ£€æŸ¥

echo "=== é‡‘èäº¤æ˜“ç³»ç»Ÿæ—¥å¸¸æ£€æŸ¥ ==="

# 1. æ•°æ®åº“è¿æ¥æ£€æŸ¥
echo "1. æ£€æŸ¥æ•°æ®åº“è¿æ¥..."
docker exec trading-db-primary pg_isready -U postgres

# 2. å¤åˆ¶çŠ¶æ€æ£€æŸ¥
echo "2. æ£€æŸ¥å¤åˆ¶çŠ¶æ€..."
docker exec trading-db-primary psql -U postgres -d trading_db -c "
    SELECT client_addr, state, sync_state, sync_priority
    FROM pg_stat_replication;
"

# 3. äº‹åŠ¡TPSæ£€æŸ¥
echo "3. æ£€æŸ¥TPS..."
docker exec trading-db-primary psql -U postgres -d trading_db -c "
    SELECT
        sum(xact_commit + xact_rollback) / 60 AS tps
    FROM pg_stat_database
    WHERE datname = 'trading_db';
"

# 4. é”ç­‰å¾…æ£€æŸ¥
echo "4. æ£€æŸ¥é”ç­‰å¾…..."
docker exec trading-db-primary psql -U postgres -d trading_db -c "
    SELECT count(*) FROM pg_stat_activity WHERE wait_event_type = 'Lock';
"

# 5. WALå½’æ¡£æ£€æŸ¥
echo "5. æ£€æŸ¥WALå½’æ¡£..."
docker exec trading-db-primary psql -U postgres -d trading_db -c "
    SELECT * FROM pg_stat_archiver;
"

# 6. æ•°æ®åº“å¤§å°æ£€æŸ¥
echo "6. æ£€æŸ¥æ•°æ®åº“å¤§å°..."
docker exec trading-db-primary psql -U postgres -d trading_db -c "
    SELECT pg_size_pretty(pg_database_size('trading_db'));
"

echo "=== æ£€æŸ¥å®Œæˆ ==="
```

---

**å®Œæˆ**: é‡‘èäº¤æ˜“ç³»ç»Ÿéƒ¨ç½²è¿ç»´
**å­—æ•°**: ~7,500å­—
**æ¶µç›–**: Dockeréƒ¨ç½²ã€é«˜å¯ç”¨é…ç½®ï¼ˆPatroniï¼‰ã€ç›‘æ§é…ç½®ã€å¤‡ä»½æ¢å¤ã€æ€§èƒ½è°ƒä¼˜ã€æ•…éšœå¤„ç†ã€å®‰å…¨é…ç½®ã€è¿ç»´æ£€æŸ¥

**è¿”å›**: [æ¡ˆä¾‹5ä¸»é¡µ](./README.md)
