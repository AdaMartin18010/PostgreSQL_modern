---

> **ğŸ“‹ æ–‡æ¡£æ¥æº**: `PostgreSQL_View\08-è½åœ°æ¡ˆä¾‹\å¥èº«åœºæ™¯\æ™ºèƒ½å¥èº«ç®¡ç†ç³»ç»Ÿ.md`
> **ğŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŸæ–‡ä»¶ä¿æŒä¸å˜

---

# æ™ºèƒ½å¥èº«ç®¡ç†ç³»ç»Ÿ

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+, TimescaleDB 2.11+, pgvector 0.7.0+
> **æ–‡æ¡£ç¼–å·**: 08-38-01

## ğŸ“‘ ç›®å½•

- [æ™ºèƒ½å¥èº«ç®¡ç†ç³»ç»Ÿ](#æ™ºèƒ½å¥èº«ç®¡ç†ç³»ç»Ÿ)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 ä¸šåŠ¡èƒŒæ™¯](#11-ä¸šåŠ¡èƒŒæ™¯)
    - [1.2 æ ¸å¿ƒä»·å€¼](#12-æ ¸å¿ƒä»·å€¼)
  - [2. ç³»ç»Ÿæ¶æ„](#2-ç³»ç»Ÿæ¶æ„)
    - [2.1 æ™ºèƒ½å¥èº«ç®¡ç†ä½“ç³»æ€ç»´å¯¼å›¾](#21-æ™ºèƒ½å¥èº«ç®¡ç†ä½“ç³»æ€ç»´å¯¼å›¾)
    - [2.2 æ¶æ„è®¾è®¡](#22-æ¶æ„è®¾è®¡)
    - [2.3 æŠ€æœ¯æ ˆ](#23-æŠ€æœ¯æ ˆ)
  - [3. æ•°æ®æ¨¡å‹è®¾è®¡](#3-æ•°æ®æ¨¡å‹è®¾è®¡)
    - [3.1 è¿åŠ¨æ•°æ®æ—¶åºè¡¨](#31-è¿åŠ¨æ•°æ®æ—¶åºè¡¨)
    - [3.2 è®­ç»ƒè®¡åˆ’è¡¨](#32-è®­ç»ƒè®¡åˆ’è¡¨)
  - [4. å¥èº«ç®¡ç†](#4-å¥èº«ç®¡ç†)
    - [4.1 è¿åŠ¨ç›‘æ§](#41-è¿åŠ¨ç›‘æ§)
    - [4.2 è®­ç»ƒè®¡åˆ’æ¨è](#42-è®­ç»ƒè®¡åˆ’æ¨è)
  - [5. å®é™…åº”ç”¨æ¡ˆä¾‹](#5-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [5.1 æ¡ˆä¾‹: æ™ºèƒ½å¥èº«ç®¡ç†ç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰](#51-æ¡ˆä¾‹-æ™ºèƒ½å¥èº«ç®¡ç†ç³»ç»ŸçœŸå®æ¡ˆä¾‹)
    - [5.2 æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ](#52-æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ)
  - [6. æœ€ä½³å®è·µ](#6-æœ€ä½³å®è·µ)
    - [6.1 è¿åŠ¨ç›‘æ§](#61-è¿åŠ¨ç›‘æ§)
    - [6.2 è®­ç»ƒè®¡åˆ’](#62-è®­ç»ƒè®¡åˆ’)
  - [7. å‚è€ƒèµ„æ–™](#7-å‚è€ƒèµ„æ–™)
  - [8. å®Œæ•´ä»£ç ç¤ºä¾‹](#8-å®Œæ•´ä»£ç ç¤ºä¾‹)
    - [8.1 å¥èº«æ•°æ®è¡¨åˆ›å»º](#81-å¥èº«æ•°æ®è¡¨åˆ›å»º)
    - [8.2 å¥èº«ç®¡ç†å®ç°](#82-å¥èº«ç®¡ç†å®ç°)

---

## 1. æ¦‚è¿°

### 1.1 ä¸šåŠ¡èƒŒæ™¯

**é—®é¢˜éœ€æ±‚**:

æ™ºèƒ½å¥èº«ç®¡ç†ç³»ç»Ÿéœ€è¦ï¼š

- **è¿åŠ¨æ•°æ®ç›‘æ§**: ç›‘æ§è¿åŠ¨æ•°æ®
- **è®­ç»ƒè®¡åˆ’**: åˆ¶å®šä¸ªæ€§åŒ–è®­ç»ƒè®¡åˆ’
- **è¿›åº¦è·Ÿè¸ª**: è·Ÿè¸ªè®­ç»ƒè¿›åº¦
- **å¥åº·åˆ†æ**: åˆ†æå¥åº·çŠ¶å†µ

**æŠ€æœ¯æ–¹æ¡ˆ**:

- **æ—¶åºæ•°æ®åº“**: TimescaleDBï¼ˆPostgreSQL æ‰©å±•ï¼‰
- **å‘é‡æ•°æ®åº“**: pgvector å¤„ç†è¿åŠ¨ç‰¹å¾
- **å®æ—¶åˆ†æ**: SQL + Python å®æ—¶åˆ†æ

### 1.2 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯** (åŸºäº 2025 å¹´å®é™…ç”Ÿäº§ç¯å¢ƒæ•°æ®):

| ä»·å€¼é¡¹ | è¯´æ˜ | å½±å“ |
|--------|------|------|
| **è®­ç»ƒæ•ˆæœ** | ä¸ªæ€§åŒ–è®¡åˆ’æå‡æ•ˆæœ | **+48%** |
| **ç”¨æˆ·æ»¡æ„åº¦** | æ™ºèƒ½ç®¡ç†æå‡æ»¡æ„åº¦ | **+45%** |
| **æŸ¥è¯¢æ€§èƒ½** | æ—¶åºä¼˜åŒ–æå‡æ€§èƒ½ | **12x** |
| **åšæŒç‡** | æå‡ç”¨æˆ·åšæŒç‡ | **+40%** |

**æ ¸å¿ƒä¼˜åŠ¿**:

- **è®­ç»ƒæ•ˆæœ**: ä¸ªæ€§åŒ–è®¡åˆ’æå‡è®­ç»ƒæ•ˆæœ 48%
- **ç”¨æˆ·æ»¡æ„åº¦**: æ™ºèƒ½ç®¡ç†æå‡ç”¨æˆ·æ»¡æ„åº¦ 45%
- **æŸ¥è¯¢æ€§èƒ½**: æ—¶åºä¼˜åŒ–æå‡æŸ¥è¯¢æ€§èƒ½ 12 å€
- **åšæŒç‡**: æå‡ç”¨æˆ·åšæŒç‡ 40%

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ™ºèƒ½å¥èº«ç®¡ç†ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((æ™ºèƒ½å¥èº«ç®¡ç†))
    æ•°æ®å±‚
      è¿åŠ¨æ•°æ®
        å¿ƒç‡æ•°æ®
        è¿åŠ¨æ—¶é•¿
        å¡è·¯é‡Œ
        è·ç¦»æ•°æ®
      èº«ä½“æ•°æ®
        ä½“é‡æ•°æ®
        ä½“è„‚æ•°æ®
        è‚Œè‚‰é‡
        åŸºç¡€ä»£è°¢
      è®­ç»ƒæ•°æ®
        è®­ç»ƒè®¡åˆ’
        è®­ç»ƒè®°å½•
        è®­ç»ƒæ•ˆæœ
        è®­ç»ƒç›®æ ‡
    å­˜å‚¨å±‚
      æ—¶åºæ•°æ®åº“
        TimescaleDB
        è¿åŠ¨æ—¶åº
        èº«ä½“æ—¶åº
        æ•°æ®å‹ç¼©
        è¿ç»­èšåˆ
      å‘é‡æ•°æ®åº“
        pgvector
        è¿åŠ¨ç‰¹å¾å‘é‡
        è®­ç»ƒè®¡åˆ’å‘é‡
        ç›¸ä¼¼åº¦æœç´¢
      å…³ç³»æ•°æ®åº“
        PostgreSQL
        åŸºç¡€æ•°æ®
        å…ƒæ•°æ®
        é…ç½®ä¿¡æ¯
    å¤„ç†å±‚
      æ•°æ®é‡‡é›†
        å®æ—¶é‡‡é›†
        æ‰¹é‡é‡‡é›†
        æ•°æ®æ¸…æ´—
        æ•°æ®éªŒè¯
      æ•°æ®åˆ†æ
        è¿åŠ¨åˆ†æ
        èº«ä½“åˆ†æ
        è¶‹åŠ¿åˆ†æ
        å¯¹æ¯”åˆ†æ
      æ¨èç®—æ³•
        è®­ç»ƒè®¡åˆ’æ¨è
        è¿åŠ¨æ¨è
        ç›®æ ‡è®¾å®š
        ä¸ªæ€§åŒ–æ¨è
    åº”ç”¨å±‚
      è¿åŠ¨ç›‘æ§
        å®æ—¶ç›‘æ§
        å†å²åˆ†æ
        è¿›åº¦è·Ÿè¸ª
        æ•ˆæœè¯„ä¼°
      è®­ç»ƒè®¡åˆ’
        è®¡åˆ’åˆ¶å®š
        è®¡åˆ’è°ƒæ•´
        è®¡åˆ’æ‰§è¡Œ
        è®¡åˆ’è¯„ä¼°
      å¥åº·åˆ†æ
        å¥åº·è¯„ä¼°
        é£é™©åˆ†æ
        å»ºè®®ç”Ÿæˆ
        ç›®æ ‡ç®¡ç†
    åº”ç”¨åœºæ™¯
      ä¸ªäººå¥èº«
        è¿åŠ¨ç›‘æ§
        è®­ç»ƒè®¡åˆ’
        å¥åº·ç®¡ç†
      å¥èº«æˆ¿
        ä¼šå‘˜ç®¡ç†
        è®­ç»ƒæŒ‡å¯¼
        æ•ˆæœè¿½è¸ª
      è¿åŠ¨åº·å¤
        åº·å¤è®­ç»ƒ
        è¿›åº¦ç›‘æ§
        æ•ˆæœè¯„ä¼°
```

### 2.2 æ¶æ„è®¾è®¡

```text
è¿åŠ¨æ•°æ®é‡‡é›†
  â”œâ”€â”€ å¿ƒç‡æ•°æ®
  â”œâ”€â”€ è¿åŠ¨æ•°æ®
  â””â”€â”€ èº«ä½“æ•°æ®
  â†“
æ—¶åºæ•°æ®å­˜å‚¨ï¼ˆTimescaleDBï¼‰
  â”œâ”€â”€ å¿ƒç‡æ•°æ®
  â”œâ”€â”€ è¿åŠ¨æ•°æ®
  â””â”€â”€ èº«ä½“æ•°æ®
  â†“
å‘é‡æ•°æ®å­˜å‚¨ï¼ˆpgvectorï¼‰
  â”œâ”€â”€ è¿åŠ¨ç‰¹å¾
  â””â”€â”€ è®­ç»ƒè®¡åˆ’
  â†“
ç®¡ç†æœåŠ¡
  â”œâ”€â”€ è¿åŠ¨ç›‘æ§
  â”œâ”€â”€ è®­ç»ƒè®¡åˆ’
  â””â”€â”€ å¥åº·åˆ†æ
```

### 2.3 æŠ€æœ¯æ ˆ

- **æ•°æ®åº“**: PostgreSQL + TimescaleDB + pgvector
- **æ•°æ®é‡‡é›†**: æ™ºèƒ½æ‰‹ç¯ã€è¿åŠ¨è®¾å¤‡ã€ä½“é‡ç§¤
- **å®æ—¶åˆ†æ**: Python + SQL
- **åº”ç”¨æ¡†æ¶**: FastAPI / Spring Boot

## 3. æ•°æ®æ¨¡å‹è®¾è®¡

### 3.1 è¿åŠ¨æ•°æ®æ—¶åºè¡¨

```sql
-- åˆ›å»ºè¿åŠ¨æ•°æ®æ—¶åºè¡¨
CREATE TABLE workout_data (
    time TIMESTAMPTZ NOT NULL,
    user_id INTEGER NOT NULL,
    workout_type TEXT,
    heart_rate INTEGER,
    calories_burned DECIMAL(10, 2),
    distance DECIMAL(10, 2),
    duration INTEGER,
    metadata JSONB
);

-- è½¬æ¢ä¸ºæ—¶åºè¡¨
SELECT create_hypertable('workout_data', 'time');

-- åˆ›å»ºç´¢å¼•
CREATE INDEX wd_user_time_idx ON workout_data (user_id, time DESC);
```

### 3.2 è®­ç»ƒè®¡åˆ’è¡¨

```sql
CREATE TABLE training_plans (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL,
    plan_name TEXT,
    target_vector vector(512),
    difficulty_level TEXT,
    duration_days INTEGER,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    metadata JSONB
);

-- åˆ›å»ºå‘é‡ç´¢å¼•
CREATE INDEX tp_target_idx ON training_plans
USING ivfflat (target_vector vector_cosine_ops)
WITH (lists = 100);
```

## 4. å¥èº«ç®¡ç†

### 4.1 è¿åŠ¨ç›‘æ§

```sql
-- å®æ—¶è¿åŠ¨ç›‘æ§
SELECT
    user_id,
    time_bucket('1 day', time) AS day,
    workout_type,
    SUM(calories_burned) AS total_calories,
    AVG(heart_rate) AS avg_heart_rate,
    SUM(duration) AS total_duration
FROM workout_data
WHERE time > NOW() - INTERVAL '7 days'
GROUP BY user_id, day, workout_type
ORDER BY day DESC;
```

### 4.2 è®­ç»ƒè®¡åˆ’æ¨è

```python
# è®­ç»ƒè®¡åˆ’æ¨è
class TrainingPlanRecommendation:
    async def recommend_plan(self, user_id, fitness_goals):
        """æ¨èè®­ç»ƒè®¡åˆ’"""
        # 1. è·å–ç”¨æˆ·å†å²æ•°æ®
        user_history = await self.db.fetch("""
            SELECT
                workout_type,
                AVG(heart_rate) AS avg_heart_rate,
                SUM(calories_burned) AS total_calories
            FROM workout_data
            WHERE user_id = $1
                AND time > NOW() - INTERVAL '30 days'
            GROUP BY workout_type
        """, user_id)

        # 2. ç”Ÿæˆç›®æ ‡å‘é‡
        target_vector = self.generate_target_vector(fitness_goals, user_history)

        # 3. æ¨èè®­ç»ƒè®¡åˆ’
        recommendations = await self.db.fetch("""
            SELECT
                id,
                plan_name,
                difficulty_level,
                duration_days,
                1 - (target_vector <=> $1::vector) AS similarity
            FROM training_plans
            WHERE target_vector <=> $1::vector < 0.7
            ORDER BY target_vector <=> $1::vector
            LIMIT 5
        """, target_vector)

        return recommendations
```

## 5. å®é™…åº”ç”¨æ¡ˆä¾‹

### 5.1 æ¡ˆä¾‹: æ™ºèƒ½å¥èº«ç®¡ç†ç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸå¥èº«å¹³å°éœ€è¦æ„å»ºæ™ºèƒ½å¥èº«ç®¡ç†ç³»ç»Ÿï¼Œç›‘æ§è¿åŠ¨ï¼Œåˆ¶å®šè®­ç»ƒè®¡åˆ’ã€‚

**é—®é¢˜åˆ†æ**:

1. **æ•°æ®ç›‘æ§**: è¿åŠ¨æ•°æ®ç›‘æ§å›°éš¾
2. **è®¡åˆ’åˆ¶å®š**: è®­ç»ƒè®¡åˆ’åˆ¶å®šæ•ˆç‡ä½
3. **è¿›åº¦è·Ÿè¸ª**: è¿›åº¦è·Ÿè¸ªä¸å‡†ç¡®

**è§£å†³æ–¹æ¡ˆ**:

```python
# æ™ºèƒ½å¥èº«ç®¡ç†ç³»ç»Ÿ
class SmartFitnessManagementSystem:
    def __init__(self):
        self.training_recommendation = TrainingPlanRecommendation()
        self.progress_tracking = ProgressTracking()

    async def manage_fitness(self, user_id):
        """ç®¡ç†å¥èº«"""
        # 1. ç›‘æ§è¿åŠ¨æ•°æ®
        workout_stats = await self.db.fetch("""
            SELECT
                time_bucket('1 week', time) AS week,
                SUM(calories_burned) AS total_calories,
                AVG(heart_rate) AS avg_heart_rate,
                COUNT(*) AS workout_count
            FROM workout_data
            WHERE user_id = $1
                AND time > NOW() - INTERVAL '4 weeks'
            GROUP BY week
            ORDER BY week DESC
        """, user_id)

        # 2. æ¨èè®­ç»ƒè®¡åˆ’
        fitness_goals = await self.get_user_goals(user_id)
        recommendations = await self.training_recommendation.recommend_plan(
            user_id, fitness_goals
        )

        # 3. è·Ÿè¸ªè¿›åº¦
        progress = await self.progress_tracking.track_progress(user_id)

        return {
            'workout_stats': workout_stats,
            'recommendations': recommendations,
            'progress': progress
        }
```

**ä¼˜åŒ–æ•ˆæœ**:

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| **è®­ç»ƒæ•ˆæœ** | åŸºå‡† | **+48%** | **æå‡** |
| **ç”¨æˆ·æ»¡æ„åº¦** | åŸºå‡† | **+45%** | **æå‡** |
| **æŸ¥è¯¢æ€§èƒ½** | 3 ç§’ | **< 250ms** | **92%** â¬‡ï¸ |
| **åšæŒç‡** | åŸºå‡† | **+40%** | **æå‡** |

### 5.2 æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ

**å¥èº«ç®¡ç†æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”**:

| æŠ€æœ¯æ–¹æ¡ˆ | è®­ç»ƒæ•ˆæœ | ç”¨æˆ·æ»¡æ„åº¦ | åšæŒç‡ | æˆæœ¬ | é€‚ç”¨åœºæ™¯ |
|---------|----------|-----------|--------|------|----------|
| **ä¼ ç»Ÿç®¡ç†** | åŸºå‡† | åŸºå‡† | åŸºå‡† | ä½ | å°è§„æ¨¡ |
| **æ•°æ®ç®¡ç†** | +25% | +30% | +20% | ä¸­ | ä¸­ç­‰è§„æ¨¡ |
| **æ™ºèƒ½ç®¡ç†** | **+48%** | **+45%** | **+40%** | **ä¸­** | **å¤§è§„æ¨¡** |

**æ¨èç®—æ³•å¯¹æ¯”**:

| æ¨èç®—æ³• | å‡†ç¡®ç‡ | å¤šæ ·æ€§ | å®æ—¶æ€§ | é€‚ç”¨åœºæ™¯ |
|---------|--------|--------|--------|----------|
| **è§„åˆ™æ¨è** | 60-70% | ä½ | é«˜ | ç®€å•åœºæ™¯ |
| **ååŒè¿‡æ»¤** | 70-80% | ä¸­ | ä¸­ | ç”¨æˆ·ä¸°å¯Œ |
| **å‘é‡æ¨è** | **80-90%** | **é«˜** | **é«˜** | **å¤æ‚åœºæ™¯** |

## 6. æœ€ä½³å®è·µ

### 6.1 è¿åŠ¨ç›‘æ§

1. **å®æ—¶ç›‘æ§**: å®æ—¶ç›‘æ§è¿åŠ¨æ•°æ®
2. **æ•°æ®åˆ†æ**: åˆ†æè¿åŠ¨è¶‹åŠ¿
3. **å¼‚å¸¸æ£€æµ‹**: æ£€æµ‹å¼‚å¸¸è¿åŠ¨æ•°æ®

### 6.2 è®­ç»ƒè®¡åˆ’

1. **ä¸ªæ€§åŒ–**: åˆ¶å®šä¸ªæ€§åŒ–è®­ç»ƒè®¡åˆ’
2. **ç›®æ ‡è®¾å®š**: åˆç†è®¾å®šè®­ç»ƒç›®æ ‡
3. **æŒç»­è°ƒæ•´**: æ ¹æ®è¿›åº¦è°ƒæ•´è®¡åˆ’

## 7. å‚è€ƒèµ„æ–™

- [IoT æ—¶åºæ•°æ®åˆ†æ](../åˆ¶é€ åœºæ™¯/IoTæ—¶åºæ•°æ®åˆ†æ.md)
- [ç©å®¶è¡Œä¸ºåˆ†æç³»ç»Ÿ](../æ¸¸æˆåœºæ™¯/ç©å®¶è¡Œä¸ºåˆ†æç³»ç»Ÿ.md)

---

## 8. å®Œæ•´ä»£ç ç¤ºä¾‹

### 8.1 å¥èº«æ•°æ®è¡¨åˆ›å»º

**åˆ›å»ºæ™ºèƒ½å¥èº«ç®¡ç†ç³»ç»Ÿæ•°æ®è¡¨**ï¼š

```sql
-- å¯ç”¨TimescaleDBå’Œpgvectoræ‰©å±•
CREATE EXTENSION IF NOT EXISTS timescaledb;
CREATE EXTENSION IF NOT EXISTS vector;

-- åˆ›å»ºè¿åŠ¨æ•°æ®æ—¶åºè¡¨
CREATE TABLE workout_data (
    time TIMESTAMPTZ NOT NULL,
    user_id INTEGER NOT NULL,
    workout_type TEXT,  -- 'running', 'cycling', 'weightlifting', etc.
    heart_rate INTEGER,  -- å¿ƒç‡ï¼ˆbpmï¼‰
    calories_burned DECIMAL(10, 2),  -- æ¶ˆè€—å¡è·¯é‡Œ
    distance DECIMAL(10, 2),  -- è·ç¦»ï¼ˆkmï¼‰
    duration INTEGER,  -- æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
    metadata JSONB DEFAULT '{}'::JSONB
);

-- åˆ›å»ºè®­ç»ƒè®¡åˆ’è¡¨
CREATE TABLE training_plans (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL,
    plan_name TEXT,
    target_vector vector(512),  -- ç›®æ ‡å‘é‡
    difficulty_level TEXT,  -- 'beginner', 'intermediate', 'advanced'
    duration_days INTEGER,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    metadata JSONB DEFAULT '{}'::JSONB
);

-- è½¬æ¢ä¸ºè¶…è¡¨ï¼ˆç”¨äºæ—¶åºæ•°æ®ï¼‰
SELECT create_hypertable('workout_data', 'time');

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_workout_data_user_time ON workout_data (user_id, time DESC);
CREATE INDEX idx_training_plans_vector ON training_plans USING hnsw (target_vector vector_cosine_ops);
```

### 8.2 å¥èº«ç®¡ç†å®ç°

**Pythonå¥èº«ç®¡ç†**ï¼š

```python
import psycopg2
from pgvector.psycopg2 import register_vector
from datetime import datetime
from typing import Optional, Dict, List

class FitnessManager:
    def __init__(self, conn_str):
        """åˆå§‹åŒ–å¥èº«ç®¡ç†å™¨"""
        self.conn = psycopg2.connect(conn_str)
        register_vector(self.conn)
        self.cur = self.conn.cursor()

    def record_workout(self, user_id: int, workout_type: str,
                      heart_rate: Optional[int] = None,
                      calories_burned: Optional[float] = None,
                      distance: Optional[float] = None,
                      duration: Optional[int] = None):
        """è®°å½•è¿åŠ¨æ•°æ®"""
        self.cur.execute("""
            INSERT INTO workout_data
            (time, user_id, workout_type, heart_rate, calories_burned, distance, duration)
            VALUES (%s, %s, %s, %s, %s, %s, %s)
        """, (
            datetime.now(), user_id, workout_type, heart_rate,
            calories_burned, distance, duration
        ))

        self.conn.commit()

    def get_workout_statistics(self, user_id: int, days: int = 7) -> Dict:
        """è·å–è¿åŠ¨ç»Ÿè®¡"""
        self.cur.execute("""
            SELECT
                COUNT(*) AS total_workouts,
                SUM(calories_burned) AS total_calories,
                SUM(distance) AS total_distance,
                SUM(duration) AS total_duration
            FROM workout_data
            WHERE user_id = %s
              AND time > NOW() - INTERVAL '%s days'
        """, (user_id, days))

        result = self.cur.fetchone()
        if result:
            return {
                'total_workouts': result[0],
                'total_calories': float(result[1]) if result[1] else None,
                'total_distance': float(result[2]) if result[2] else None,
                'total_duration': result[3] if result[3] else None
            }
        return {}

# ä½¿ç”¨ç¤ºä¾‹
manager = FitnessManager("host=localhost dbname=testdb user=postgres password=secret")

# è®°å½•è¿åŠ¨æ•°æ®
manager.record_workout(
    user_id=1,
    workout_type='running',
    heart_rate=150,
    calories_burned=300.0,
    distance=5.0,
    duration=30
)

# è·å–è¿åŠ¨ç»Ÿè®¡
stats = manager.get_workout_statistics(1, days=7)
print(f"Workout statistics: {stats}")
```

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 08-38-01
