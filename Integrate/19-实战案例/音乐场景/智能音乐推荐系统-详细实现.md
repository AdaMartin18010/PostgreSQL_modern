# æ™ºèƒ½éŸ³ä¹æ¨èç³»ç»Ÿ - è¯¦ç»†å®ç°

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **ç”¨é€”**: éŸ³ä¹æ¨èåœºæ™¯çš„è¯¦ç»†å®ç°æ–‡æ¡£
> **é€šç”¨æ¶æ„**: è¯·å‚è€ƒ [é€šç”¨æ¨èç³»ç»Ÿæ¶æ„](../é€šç”¨æ¨èç³»ç»Ÿæ¶æ„.md)

---

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£ä¸“æ³¨äºéŸ³ä¹æ¨èåœºæ™¯çš„ç‰¹å®šå®ç°ç»†èŠ‚ã€‚é€šç”¨æ¶æ„å’Œæœ€ä½³å®è·µè¯·å‚è€ƒé€šç”¨æ–‡æ¡£ã€‚

**åŸå§‹æ–‡æ¡£æ¥æº**: `PostgreSQL_View\08-è½åœ°æ¡ˆä¾‹\éŸ³ä¹åœºæ™¯\æ™ºèƒ½éŸ³ä¹æ¨èç³»ç»Ÿ.md`

---

## 1. éŸ³ä¹åœºæ™¯ç‰¹å®šè®¾è®¡

### 1.1 éŸ³ä¹æ•°æ®æ¨¡å‹

```sql
-- éŸ³ä¹è¡¨ï¼ˆéŸ³ä¹ç‰¹å®šå­—æ®µï¼‰
CREATE TABLE songs (
    id SERIAL PRIMARY KEY,
    title TEXT NOT NULL,
    artist TEXT,
    album TEXT,
    genre TEXT,
    audio_vector vector(512),  -- éŸ³é¢‘ç‰¹å¾å‘é‡
    genre_vector vector(256),  -- é£æ ¼ç‰¹å¾å‘é‡
    duration INTEGER,  -- æ—¶é•¿ï¼ˆç§’ï¼‰
    release_date DATE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    metadata JSONB
);

-- ç”¨æˆ·æ’­æ”¾å†å²è¡¨ï¼ˆéŸ³ä¹ç‰¹å®šï¼‰
CREATE TABLE user_play_history (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL,
    song_id INTEGER NOT NULL,
    play_count INTEGER DEFAULT 1,
    last_played_at TIMESTAMPTZ DEFAULT NOW(),
    rating INTEGER,
    metadata JSONB
);
```

### 1.2 éŸ³ä¹æ¨èç®—æ³•

**è€ƒè™‘æ’­æ”¾æ¬¡æ•°**:

```sql
-- éŸ³ä¹æ¨èï¼ˆè€ƒè™‘æ’­æ”¾æ¬¡æ•°ï¼‰
SELECT
    c.content_id,
    c.title,
    COUNT(ub.behavior_id) AS play_count,
    1 - (c.feature_vector <=> up.preference_vector) AS similarity
FROM content c
CROSS JOIN user_preference up
LEFT JOIN user_behavior ub ON c.content_id = ub.content_id
    AND ub.user_id = up.user_id
    AND ub.behavior_type = 'play'
WHERE c.content_type = 'music'
  AND up.user_id = $1
GROUP BY c.content_id, c.title, c.feature_vector, up.preference_vector
ORDER BY (similarity * (1 + LOG(1 + play_count))) DESC
LIMIT 20;
```

---

## 2. éŸ³ä¹åœºæ™¯æœ€ä½³å®è·µ

### 2.1 éŸ³é¢‘ç‰¹å¾æå–

- éŸ³é¢‘é¢‘è°±ç‰¹å¾æå–
- èŠ‚å¥ç‰¹å¾æå–
- éŸ³è°ƒç‰¹å¾æå–
- å¤šç‰¹å¾èåˆ

### 2.2 æ’­æ”¾è¡Œä¸ºåˆ†æ

- æ’­æ”¾æ¬¡æ•°åˆ†æ
- æ’­æ”¾æ—¶é—´æ¨¡å¼åˆ†æ
- éŸ³ä¹é£æ ¼åå¥½åˆ†æ
- æ’­æ”¾åˆ—è¡¨ç”Ÿæˆ

---

## 3. å®Œæ•´ä»£ç ç¤ºä¾‹

### 3.1 éŸ³ä¹æ¨èå®ç°

```python
class MusicRecommendationSystem:
    def recommend_music(self, user_id, limit=20):
        """éŸ³ä¹æ¨è"""
        # è€ƒè™‘æ’­æ”¾æ¬¡æ•°çš„æ¨èç®—æ³•
        recommendations = self.db.execute("""
            SELECT
                s.id,
                s.title,
                s.artist,
                COUNT(ph.id) AS play_count,
                1 - (s.audio_vector <=> up.preference_vector) AS similarity
            FROM songs s
            JOIN user_preferences up ON up.user_id = %s
            LEFT JOIN user_play_history ph ON s.id = ph.song_id
            WHERE s.id NOT IN (
                SELECT song_id FROM user_play_history WHERE user_id = %s
            )
            GROUP BY s.id, s.title, s.artist, s.audio_vector, up.preference_vector
            ORDER BY (similarity * (1 + LOG(1 + play_count))) DESC
            LIMIT %s
        """, (user_id, user_id, limit))

        return recommendations
```

---

## 4. å‚è€ƒæ–‡æ¡£

- [é€šç”¨æ¨èç³»ç»Ÿæ¶æ„](../é€šç”¨æ¨èç³»ç»Ÿæ¶æ„.md) - é€šç”¨æ¶æ„å’Œæœ€ä½³å®è·µ
- [æ™ºèƒ½è§†é¢‘æ¨èç³»ç»Ÿ-è¯¦ç»†å®ç°](../è§†é¢‘åœºæ™¯/æ™ºèƒ½è§†é¢‘æ¨èç³»ç»Ÿ-è¯¦ç»†å®ç°.md) - è§†é¢‘åœºæ™¯å®ç°

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**çŠ¶æ€**: éŸ³ä¹åœºæ™¯ç‰¹å®šå®ç°æ–‡æ¡£
