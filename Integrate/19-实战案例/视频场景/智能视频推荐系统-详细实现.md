# æ™ºèƒ½è§†é¢‘æ¨èç³»ç»Ÿ - è¯¦ç»†å®ç°

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **ç”¨é€”**: è§†é¢‘æ¨èåœºæ™¯çš„è¯¦ç»†å®ç°æ–‡æ¡£
> **é€šç”¨æ¶æ„**: è¯·å‚è€ƒ [é€šç”¨æ¨èç³»ç»Ÿæ¶æ„](../é€šç”¨æ¨èç³»ç»Ÿæ¶æ„.md)

---

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£ä¸“æ³¨äºè§†é¢‘æ¨èåœºæ™¯çš„ç‰¹å®šå®ç°ç»†èŠ‚ã€‚é€šç”¨æ¶æ„å’Œæœ€ä½³å®è·µè¯·å‚è€ƒé€šç”¨æ–‡æ¡£ã€‚

**åŸå§‹æ–‡æ¡£æ¥æº**: `PostgreSQL_View\08-è½åœ°æ¡ˆä¾‹\è§†é¢‘åœºæ™¯\æ™ºèƒ½è§†é¢‘æ¨èç³»ç»Ÿ.md`

---

## 1. è§†é¢‘åœºæ™¯ç‰¹å®šè®¾è®¡

### 1.1 è§†é¢‘æ•°æ®æ¨¡å‹

```sql
-- è§†é¢‘è¡¨ï¼ˆè§†é¢‘ç‰¹å®šå­—æ®µï¼‰
CREATE TABLE videos (
    id SERIAL PRIMARY KEY,
    title TEXT NOT NULL,
    creator TEXT,
    category TEXT,
    content_vector vector(512),  -- è§†é¢‘å†…å®¹å‘é‡
    category_vector vector(256),  -- åˆ†ç±»ç‰¹å¾å‘é‡
    duration INTEGER,  -- æ—¶é•¿ï¼ˆç§’ï¼‰
    view_count INTEGER DEFAULT 0,
    like_count INTEGER DEFAULT 0,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    metadata JSONB
);

-- ç”¨æˆ·è§‚çœ‹å†å²è¡¨ï¼ˆè§†é¢‘ç‰¹å®šï¼‰
CREATE TABLE user_watch_history (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL,
    video_id INTEGER NOT NULL,
    watch_duration INTEGER,  -- è§‚çœ‹æ—¶é•¿ï¼ˆç§’ï¼‰
    completion_rate DECIMAL(5, 2),  -- å®Œæˆç‡ï¼ˆ0-100ï¼‰
    watched_at TIMESTAMPTZ DEFAULT NOW(),
    rating INTEGER,
    metadata JSONB
);
```

### 1.2 è§†é¢‘æ¨èç®—æ³•

**è€ƒè™‘è§‚çœ‹å®Œæˆç‡**:

```sql
-- è§†é¢‘æ¨èï¼ˆè€ƒè™‘è§‚çœ‹å®Œæˆç‡ï¼‰
SELECT
    c.content_id,
    c.title,
    AVG(ub.duration::FLOAT / c.metadata->>'duration') AS avg_completion_rate,
    1 - (c.feature_vector <=> up.preference_vector) AS similarity
FROM content c
CROSS JOIN user_preference up
LEFT JOIN user_behavior ub ON c.content_id = ub.content_id
    AND ub.user_id = up.user_id
WHERE c.content_type = 'video'
  AND up.user_id = $1
GROUP BY c.content_id, c.title, c.feature_vector, up.preference_vector
ORDER BY (similarity * COALESCE(avg_completion_rate, 0.5)) DESC
LIMIT 20;
```

---

## 2. è§†é¢‘åœºæ™¯æœ€ä½³å®è·µ

### 2.1 è§†é¢‘ç‰¹å¾æå–

- è§†é¢‘å¸§ç‰¹å¾æå–
- éŸ³é¢‘ç‰¹å¾æå–
- å­—å¹•æ–‡æœ¬ç‰¹å¾æå–
- å¤šæ¨¡æ€ç‰¹å¾èåˆ

### 2.2 è§‚çœ‹è¡Œä¸ºåˆ†æ

- è§‚çœ‹æ—¶é•¿åˆ†æ
- è§‚çœ‹å®Œæˆç‡åˆ†æ
- è§‚çœ‹æ—¶é—´æ¨¡å¼åˆ†æ
- è§†é¢‘åˆ†ç±»åå¥½åˆ†æ

---

## 3. å®Œæ•´ä»£ç ç¤ºä¾‹

### 3.1 è§†é¢‘æ¨èå®ç°

```python
class VideoRecommendationSystem:
    def recommend_videos(self, user_id, limit=20):
        """è§†é¢‘æ¨è"""
        # è€ƒè™‘è§‚çœ‹å®Œæˆç‡çš„æ¨èç®—æ³•
        recommendations = self.db.execute("""
            SELECT
                v.id,
                v.title,
                v.creator,
                AVG(wh.completion_rate) AS avg_completion,
                1 - (v.content_vector <=> up.preference_vector) AS similarity
            FROM videos v
            JOIN user_preferences up ON up.user_id = %s
            LEFT JOIN user_watch_history wh ON v.id = wh.video_id
            WHERE v.id NOT IN (
                SELECT video_id FROM user_watch_history WHERE user_id = %s
            )
            GROUP BY v.id, v.title, v.creator, v.content_vector, up.preference_vector
            ORDER BY (similarity * COALESCE(avg_completion, 0.5)) DESC
            LIMIT %s
        """, (user_id, user_id, limit))

        return recommendations
```

---

## 4. å‚è€ƒæ–‡æ¡£

- [é€šç”¨æ¨èç³»ç»Ÿæ¶æ„](../é€šç”¨æ¨èç³»ç»Ÿæ¶æ„.md) - é€šç”¨æ¶æ„å’Œæœ€ä½³å®è·µ
- [æ™ºèƒ½éŸ³ä¹æ¨èç³»ç»Ÿ-è¯¦ç»†å®ç°](../éŸ³ä¹åœºæ™¯/æ™ºèƒ½éŸ³ä¹æ¨èç³»ç»Ÿ-è¯¦ç»†å®ç°.md) - éŸ³ä¹åœºæ™¯å®ç°

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**çŠ¶æ€**: è§†é¢‘åœºæ™¯ç‰¹å®šå®ç°æ–‡æ¡£
