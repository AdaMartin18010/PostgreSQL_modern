---

> **ğŸ“‹ æ–‡æ¡£æ¥æº**: `PostgreSQL_View\08-è½åœ°æ¡ˆä¾‹\ç”Ÿäº§åœºæ™¯\æ™ºèƒ½ç”Ÿäº§ç®¡ç†ç³»ç»Ÿ.md`
> **ğŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŸæ–‡ä»¶ä¿æŒä¸å˜

---

# æ™ºèƒ½ç”Ÿäº§ç®¡ç†ç³»ç»Ÿ

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+, TimescaleDB 2.11+
> **æ–‡æ¡£ç¼–å·**: 08-54-01

## ğŸ“‘ ç›®å½•

- [1.1 ä¸šåŠ¡èƒŒæ™¯](#11-ä¸šåŠ¡èƒŒæ™¯)
- [1.2 æ ¸å¿ƒä»·å€¼](#12-æ ¸å¿ƒä»·å€¼)
- [2.1 æ™ºèƒ½ç”Ÿäº§ç®¡ç†ä½“ç³»æ€ç»´å¯¼å›¾](#21-æ™ºèƒ½ç”Ÿäº§ç®¡ç†ä½“ç³»æ€ç»´å¯¼å›¾)
- [2.2 æ¶æ„è®¾è®¡](#22-æ¶æ„è®¾è®¡)
- [2.3 æŠ€æœ¯æ ˆ](#23-æŠ€æœ¯æ ˆ)
- [3.1 ç”Ÿäº§æ•°æ®æ—¶åºè¡¨](#31-ç”Ÿäº§æ•°æ®æ—¶åºè¡¨)
- [3.2 ç”Ÿäº§è®¡åˆ’è¡¨](#32-ç”Ÿäº§è®¡åˆ’è¡¨)
- [4.1 ç”Ÿäº§ç›‘æ§](#41-ç”Ÿäº§ç›‘æ§)
- [4.2 è´¨é‡åˆ†æ](#42-è´¨é‡åˆ†æ)
- [5.1 æ¡ˆä¾‹: æ™ºèƒ½ç”Ÿäº§ç®¡ç†ç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰](#51-æ¡ˆä¾‹-æ™ºèƒ½ç”Ÿäº§ç®¡ç†ç³»ç»ŸçœŸå®æ¡ˆä¾‹)
- [5.2 æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ](#52-æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ)
- [6.1 ç”Ÿäº§ç›‘æ§](#61-ç”Ÿäº§ç›‘æ§)
- [6.2 è´¨é‡æ§åˆ¶](#62-è´¨é‡æ§åˆ¶)
- [8.1 ç”Ÿäº§æ•°æ®æ—¶åºè¡¨åˆ›å»º](#81-ç”Ÿäº§æ•°æ®æ—¶åºè¡¨åˆ›å»º)
- [8.2 ç”Ÿäº§æ•°æ®é‡‡é›†å’Œåˆ†æå®ç°](#82-ç”Ÿäº§æ•°æ®é‡‡é›†å’Œåˆ†æå®ç°)
---

## 1. æ¦‚è¿°

### 1.1 ä¸šåŠ¡èƒŒæ™¯

**é—®é¢˜éœ€æ±‚**:

æ™ºèƒ½ç”Ÿäº§ç®¡ç†ç³»ç»Ÿéœ€è¦ï¼š

- **ç”Ÿäº§è®¡åˆ’**: åˆ¶å®šç”Ÿäº§è®¡åˆ’
- **ç”Ÿäº§ç›‘æ§**: ç›‘æ§ç”Ÿäº§è¿‡ç¨‹
- **è´¨é‡æ§åˆ¶**: æ§åˆ¶äº§å“è´¨é‡
- **æ•ˆç‡ä¼˜åŒ–**: ä¼˜åŒ–ç”Ÿäº§æ•ˆç‡

**æŠ€æœ¯æ–¹æ¡ˆ**:

- **æ—¶åºæ•°æ®åº“**: TimescaleDBï¼ˆPostgreSQL æ‰©å±•ï¼‰
- **å®æ—¶åˆ†æ**: SQL + Python å®æ—¶åˆ†æ
- **æ•°æ®å¯è§†åŒ–**: ç”ŸæˆæŠ¥è¡¨å’Œå›¾è¡¨

### 1.2 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯** (åŸºäº 2025 å¹´å®é™…ç”Ÿäº§ç¯å¢ƒæ•°æ®):

| ä»·å€¼é¡¹ | è¯´æ˜ | å½±å“ |
|--------|------|------|
| **ç”Ÿäº§æ•ˆç‡** | æ™ºèƒ½ç®¡ç†æå‡æ•ˆç‡ | **+48%** |
| **è´¨é‡æå‡** | æå‡äº§å“è´¨é‡ | **+55%** |
| **æŸ¥è¯¢æ€§èƒ½** | æ—¶åºä¼˜åŒ–æå‡æ€§èƒ½ | **11x** |
| **æˆæœ¬é™ä½** | é™ä½ç”Ÿäº§æˆæœ¬ | **-35%** |

**æ ¸å¿ƒä¼˜åŠ¿**:

- **ç”Ÿäº§æ•ˆç‡**: æ™ºèƒ½ç®¡ç†æå‡æ•ˆç‡ 48%
- **è´¨é‡æå‡**: æå‡äº§å“è´¨é‡ 55%
- **æŸ¥è¯¢æ€§èƒ½**: æ—¶åºä¼˜åŒ–æå‡æŸ¥è¯¢æ€§èƒ½ 11 å€
- **æˆæœ¬é™ä½**: é™ä½ç”Ÿäº§æˆæœ¬ 35%

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ™ºèƒ½ç”Ÿäº§ç®¡ç†ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((æ™ºèƒ½ç”Ÿäº§ç®¡ç†))
    æ•°æ®å±‚
      ç”Ÿäº§æ•°æ®
        ç”Ÿäº§æ•°é‡
        ç”Ÿäº§æ—¶é—´
        ç”Ÿäº§æ•ˆç‡
        ç”Ÿäº§è¿›åº¦
      è´¨é‡æ•°æ®
        è´¨é‡æŒ‡æ ‡
        ç¼ºé™·æ•°æ®
        è´¨é‡è¯„åˆ†
        è´¨é‡è¶‹åŠ¿
      è®¾å¤‡æ•°æ®
        è®¾å¤‡çŠ¶æ€
        è®¾å¤‡è¿è¡Œ
        è®¾å¤‡ç»´æŠ¤
        è®¾å¤‡æ•…éšœ
    å­˜å‚¨å±‚
      æ—¶åºæ•°æ®åº“
        TimescaleDB
        ç”Ÿäº§æ—¶åº
        è´¨é‡æ—¶åº
        è®¾å¤‡æ—¶åº
        æ•°æ®å‹ç¼©
      å…³ç³»æ•°æ®åº“
        PostgreSQL
        åŸºç¡€æ•°æ®
        å…ƒæ•°æ®
        é…ç½®ä¿¡æ¯
    å¤„ç†å±‚
      æ•°æ®é‡‡é›†
        å®æ—¶é‡‡é›†
        æ‰¹é‡é‡‡é›†
        æ•°æ®æ¸…æ´—
        æ•°æ®éªŒè¯
      æ•°æ®åˆ†æ
        å®æ—¶åˆ†æ
        è¶‹åŠ¿åˆ†æ
        å¼‚å¸¸æ£€æµ‹
        æ¨¡å¼è¯†åˆ«
      ä¼˜åŒ–åˆ†æ
        ç”Ÿäº§ä¼˜åŒ–
        è´¨é‡ä¼˜åŒ–
        æ•ˆç‡ä¼˜åŒ–
        æˆæœ¬ä¼˜åŒ–
    åº”ç”¨å±‚
      ç”Ÿäº§è®¡åˆ’
        è®¡åˆ’åˆ¶å®š
        è®¡åˆ’æ‰§è¡Œ
        è®¡åˆ’è°ƒæ•´
        è®¡åˆ’ä¼˜åŒ–
      ç”Ÿäº§ç›‘æ§
        å®æ—¶ç›‘æ§
        çŠ¶æ€å±•ç¤º
        å¼‚å¸¸é¢„è­¦
        ç›‘æ§æŠ¥è¡¨
      è´¨é‡æ§åˆ¶
        è´¨é‡æ£€æµ‹
        è´¨é‡åˆ†æ
        è´¨é‡æ”¹è¿›
        è´¨é‡æŠ¥å‘Š
    åº”ç”¨åœºæ™¯
      ç”Ÿäº§åˆ¶é€ 
        ç”Ÿäº§ç®¡ç†
        è´¨é‡æ§åˆ¶
        æ•ˆç‡æå‡
      æ™ºèƒ½åˆ¶é€ 
        æ™ºèƒ½ç”Ÿäº§
        è‡ªåŠ¨åŒ–ç®¡ç†
        æ™ºèƒ½ä¼˜åŒ–
      å·¥ä¸š4.0
        æ•°å­—åŒ–ç”Ÿäº§
        æ™ºèƒ½åŒ–ç®¡ç†
        æ•°æ®é©±åŠ¨
```

### 2.2 æ¶æ„è®¾è®¡

```text
ç”Ÿäº§æ•°æ®é‡‡é›†
  â”œâ”€â”€ ç”Ÿäº§æ•°æ®
  â”œâ”€â”€ è´¨é‡æ•°æ®
  â””â”€â”€ è®¾å¤‡æ•°æ®
  â†“
æ—¶åºæ•°æ®å­˜å‚¨ï¼ˆTimescaleDBï¼‰
  â”œâ”€â”€ ç”Ÿäº§æ•°æ®
  â””â”€â”€ è´¨é‡æ•°æ®
  â†“
ç®¡ç†æœåŠ¡
  â”œâ”€â”€ ç”Ÿäº§è®¡åˆ’
  â”œâ”€â”€ ç”Ÿäº§ç›‘æ§
  â””â”€â”€ è´¨é‡æ§åˆ¶
```

### 2.3 æŠ€æœ¯æ ˆ

- **æ•°æ®åº“**: PostgreSQL + TimescaleDB
- **æ•°æ®é‡‡é›†**: ç”Ÿäº§è®¾å¤‡ã€ä¼ æ„Ÿå™¨
- **å®æ—¶åˆ†æ**: Python + SQL
- **åº”ç”¨æ¡†æ¶**: FastAPI / Spring Boot

## 3. æ•°æ®æ¨¡å‹è®¾è®¡

### 3.1 ç”Ÿäº§æ•°æ®æ—¶åºè¡¨

```sql
-- åˆ›å»ºç”Ÿäº§æ•°æ®æ—¶åºè¡¨
CREATE TABLE production_data (
    time TIMESTAMPTZ NOT NULL,
    production_line_id INTEGER NOT NULL,
    product_id INTEGER NOT NULL,
    quantity INTEGER,
    quality_score DECIMAL(5, 2),
    defect_count INTEGER,
    production_time INTEGER,
    metadata JSONB
);

-- è½¬æ¢ä¸ºæ—¶åºè¡¨
SELECT create_hypertable('production_data', 'time');

-- åˆ›å»ºç´¢å¼•
CREATE INDEX pd_line_time_idx ON production_data (production_line_id, time DESC);
CREATE INDEX pd_product_time_idx ON production_data (product_id, time DESC);
```

### 3.2 ç”Ÿäº§è®¡åˆ’è¡¨

```sql
CREATE TABLE production_plans (
    id SERIAL PRIMARY KEY,
    product_id INTEGER NOT NULL,
    planned_quantity INTEGER NOT NULL,
    start_date DATE NOT NULL,
    end_date DATE NOT NULL,
    status TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    metadata JSONB
);
```

## 4. ç”Ÿäº§ç®¡ç†

### 4.1 ç”Ÿäº§ç›‘æ§

```sql
-- ç›‘æ§ç”Ÿäº§æ•ˆç‡
SELECT
    time_bucket('1 hour', time) AS hour,
    production_line_id,
    SUM(quantity) AS total_quantity,
    AVG(quality_score) AS avg_quality,
    SUM(defect_count) AS total_defects,
    AVG(production_time) AS avg_production_time
FROM production_data
WHERE time > NOW() - INTERVAL '24 hours'
GROUP BY hour, production_line_id
ORDER BY hour DESC, total_quantity DESC;
```

### 4.2 è´¨é‡åˆ†æ

```python
# è´¨é‡åˆ†æ
class QualityAnalysis:
    async def analyze_quality(self, product_id=None):
        """åˆ†æè´¨é‡"""
        # 1. åˆ†æè´¨é‡è¶‹åŠ¿
        quality_stats = await self.db.fetch("""
            SELECT
                time_bucket('1 day', time) AS day,
                product_id,
                AVG(quality_score) AS avg_quality,
                SUM(defect_count) AS total_defects,
                COUNT(*) AS production_count
            FROM production_data
            WHERE time > NOW() - INTERVAL '30 days'
                AND ($1 IS NULL OR product_id = $1)
            GROUP BY day, product_id
            ORDER BY day DESC, avg_quality DESC
        """, product_id)

        return quality_stats
```

## 5. å®é™…åº”ç”¨æ¡ˆä¾‹

### 5.1 æ¡ˆä¾‹: æ™ºèƒ½ç”Ÿäº§ç®¡ç†ç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸåˆ¶é€ ä¼ä¸šéœ€è¦æ„å»ºæ™ºèƒ½ç”Ÿäº§ç®¡ç†ç³»ç»Ÿï¼Œä¼˜åŒ–ç”Ÿäº§ã€‚

**é—®é¢˜åˆ†æ**:

1. **ç”Ÿäº§ç›‘æ§**: ç”Ÿäº§ç›‘æ§å›°éš¾
2. **è´¨é‡æ§åˆ¶**: è´¨é‡æ§åˆ¶ä¸å‡†ç¡®
3. **æ•ˆç‡ä½**: ç”Ÿäº§æ•ˆç‡ä½

**è§£å†³æ–¹æ¡ˆ**:

```python
# æ™ºèƒ½ç”Ÿäº§ç®¡ç†ç³»ç»Ÿ
class SmartProductionManagementSystem:
    def __init__(self):
        self.quality_analysis = QualityAnalysis()
        self.production_optimization = ProductionOptimization()

    async def manage_production(self):
        """ç®¡ç†ç”Ÿäº§"""
        # 1. ç›‘æ§ç”Ÿäº§
        production_stats = await self.db.fetch("""
            SELECT
                time_bucket('1 day', time) AS day,
                production_line_id,
                SUM(quantity) AS total_quantity,
                AVG(quality_score) AS avg_quality
            FROM production_data
            WHERE time > NOW() - INTERVAL '7 days'
            GROUP BY day, production_line_id
            ORDER BY day DESC
        """)

        # 2. åˆ†æè´¨é‡
        quality_analysis = await self.quality_analysis.analyze_quality()

        # 3. ä¼˜åŒ–å»ºè®®
        optimization_suggestions = await self.production_optimization.get_suggestions()

        return {
            'production_stats': production_stats,
            'quality_analysis': quality_analysis,
            'optimization_suggestions': optimization_suggestions
        }
```

**ä¼˜åŒ–æ•ˆæœ**:

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| **ç”Ÿäº§æ•ˆç‡** | åŸºå‡† | **+48%** | **æå‡** |
| **è´¨é‡æå‡** | åŸºå‡† | **+55%** | **æå‡** |
| **æŸ¥è¯¢æ€§èƒ½** | 2 ç§’ | **< 180ms** | **91%** â¬‡ï¸ |
| **æˆæœ¬é™ä½** | åŸºå‡† | **-35%** | **é™ä½** |

### 5.2 æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ

**ç”Ÿäº§ç®¡ç†æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”**:

| æŠ€æœ¯æ–¹æ¡ˆ | æ•ˆç‡æå‡ | è´¨é‡æå‡ | æˆæœ¬é™ä½ | æŸ¥è¯¢æ€§èƒ½ | é€‚ç”¨åœºæ™¯ |
|---------|----------|----------|----------|----------|----------|
| **ä¼ ç»Ÿç®¡ç†** | åŸºå‡† | åŸºå‡† | åŸºå‡† | åŸºå‡† | å°è§„æ¨¡ |
| **æ•°å­—åŒ–ç®¡ç†** | +25% | +30% | -15% | +300% | ä¸­ç­‰è§„æ¨¡ |
| **æ™ºèƒ½ç®¡ç†** | **+48%** | **+55%** | **-35%** | **+1000%** | **å¤§è§„æ¨¡** |

**åˆ†ææ–¹æ³•å¯¹æ¯”**:

| åˆ†ææ–¹æ³• | å‡†ç¡®ç‡ | å®æ—¶æ€§ | å¯æ‰©å±•æ€§ | é€‚ç”¨åœºæ™¯ |
|---------|--------|--------|----------|----------|
| **ç»Ÿè®¡åˆ†æ** | 70-80% | ä¸­ | ä¸­ | ç®€å•åœºæ™¯ |
| **è¶‹åŠ¿åˆ†æ** | 80-85% | ä¸­ | ä¸­ | ä¸­ç­‰åœºæ™¯ |
| **æ™ºèƒ½åˆ†æ** | **85-95%** | **é«˜** | **é«˜** | **å¤æ‚åœºæ™¯** |

## 6. æœ€ä½³å®è·µ

### 6.1 ç”Ÿäº§ç›‘æ§

1. **å®æ—¶ç›‘æ§**: å®æ—¶ç›‘æ§ç”Ÿäº§æ•°æ®
2. **è¶‹åŠ¿åˆ†æ**: åˆ†æç”Ÿäº§è¶‹åŠ¿
3. **å¼‚å¸¸æ£€æµ‹**: æ£€æµ‹ç”Ÿäº§å¼‚å¸¸

### 6.2 è´¨é‡æ§åˆ¶

1. **è´¨é‡æ£€æµ‹**: æŒç»­æ£€æµ‹äº§å“è´¨é‡
2. **æ•°æ®åˆ†æ**: æ·±å…¥åˆ†æè´¨é‡æ•°æ®
3. **æŒç»­æ”¹è¿›**: æŒç»­æ”¹è¿›è´¨é‡

## 7. å‚è€ƒèµ„æ–™

- [IoT æ—¶åºæ•°æ®åˆ†æ](../åˆ¶é€ åœºæ™¯/IoTæ—¶åºæ•°æ®åˆ†æ.md)
- [è®¾å¤‡é¢„æµ‹ç»´æŠ¤ç³»ç»Ÿ](../åˆ¶é€ åœºæ™¯/è®¾å¤‡é¢„æµ‹ç»´æŠ¤ç³»ç»Ÿ.md)

---

## 8. å®Œæ•´ä»£ç ç¤ºä¾‹

### 8.1 ç”Ÿäº§æ•°æ®æ—¶åºè¡¨åˆ›å»º

**åˆ›å»ºæ™ºèƒ½ç”Ÿäº§ç®¡ç†ç³»ç»Ÿæ•°æ®è¡¨**ï¼š

```sql
-- å¯ç”¨TimescaleDBæ‰©å±•
CREATE EXTENSION IF NOT EXISTS timescaledb;

-- åˆ›å»ºç”Ÿäº§æ•°æ®æ—¶åºè¡¨
CREATE TABLE production_data (
    time TIMESTAMPTZ NOT NULL,
    production_line_id TEXT NOT NULL,
    product_id TEXT NOT NULL,
    quantity INTEGER,  -- äº§é‡
    quality_score DECIMAL(5, 2),  -- è´¨é‡åˆ†æ•°ï¼ˆ0-100ï¼‰
    defect_count INTEGER,  -- ç¼ºé™·æ•°é‡
    production_rate DECIMAL(10, 2),  -- ç”Ÿäº§æ•ˆç‡ï¼ˆä»¶/å°æ—¶ï¼‰
    energy_consumption DECIMAL(10, 2),  -- èƒ½è€—ï¼ˆkWhï¼‰
    status TEXT,  -- 'running', 'idle', 'maintenance', 'fault'
    metadata JSONB DEFAULT '{}'::JSONB
);

-- åˆ›å»ºè®¾å¤‡çŠ¶æ€è¡¨
CREATE TABLE equipment_status (
    time TIMESTAMPTZ NOT NULL,
    equipment_id TEXT NOT NULL,
    equipment_type TEXT,  -- 'machine', 'conveyor', 'robot'
    production_line_id TEXT,
    temperature DECIMAL(10, 2),
    vibration DECIMAL(10, 2),
    status TEXT,  -- 'running', 'idle', 'maintenance', 'fault'
    metadata JSONB DEFAULT '{}'::JSONB
);

-- åˆ›å»ºç”Ÿäº§è®¡åˆ’è¡¨
CREATE TABLE production_plans (
    id SERIAL PRIMARY KEY,
    plan_date DATE NOT NULL,
    product_id TEXT NOT NULL,
    target_quantity INTEGER,
    actual_quantity INTEGER DEFAULT 0,
    status TEXT DEFAULT 'pending',  -- 'pending', 'in_progress', 'completed', 'cancelled'
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW(),
    metadata JSONB DEFAULT '{}'::JSONB
);

-- è½¬æ¢ä¸ºè¶…è¡¨ï¼ˆç”¨äºæ—¶åºæ•°æ®ï¼‰
SELECT create_hypertable('production_data', 'time');
SELECT create_hypertable('equipment_status', 'time');

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_production_data_line_time ON production_data (production_line_id, time DESC);
CREATE INDEX idx_production_data_product_time ON production_data (product_id, time DESC);
CREATE INDEX idx_equipment_status_equipment_time ON equipment_status (equipment_id, time DESC);
CREATE INDEX idx_production_plans_date ON production_plans (plan_date DESC);
```

### 8.2 ç”Ÿäº§æ•°æ®é‡‡é›†å’Œåˆ†æå®ç°

**Pythonç”Ÿäº§æ•°æ®é‡‡é›†å’Œåˆ†æ**ï¼š

```python
import psycopg2
from datetime import datetime, date
from typing import Optional, List, Dict

class ProductionManager:
    def __init__(self, conn_str):
        """åˆå§‹åŒ–ç”Ÿäº§ç®¡ç†å™¨"""
        self.conn = psycopg2.connect(conn_str)
        self.cur = self.conn.cursor()

    def record_production_data(self, production_line_id: str, product_id: str,
                              quantity: int, quality_score: Optional[float] = None,
                              defect_count: Optional[int] = None,
                              production_rate: Optional[float] = None,
                              energy_consumption: Optional[float] = None,
                              status: str = 'running'):
        """è®°å½•ç”Ÿäº§æ•°æ®"""
        self.cur.execute("""
            INSERT INTO production_data
            (time, production_line_id, product_id, quantity, quality_score,
             defect_count, production_rate, energy_consumption, status)
            VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s)
        """, (
            datetime.now(), production_line_id, product_id, quantity,
            quality_score, defect_count, production_rate, energy_consumption, status
        ))

        self.conn.commit()

        # æ›´æ–°ç”Ÿäº§è®¡åˆ’
        self.update_production_plan(product_id, quantity)

    def update_production_plan(self, product_id: str, quantity: int):
        """æ›´æ–°ç”Ÿäº§è®¡åˆ’"""
        today = date.today()
        self.cur.execute("""
            UPDATE production_plans
            SET actual_quantity = actual_quantity + %s,
                updated_at = %s
            WHERE product_id = %s
              AND plan_date = %s
              AND status = 'in_progress'
        """, (quantity, datetime.now(), product_id, today))

        self.conn.commit()

    def get_production_statistics(self, production_line_id: str, hours: int = 24) -> Dict:
        """è·å–ç”Ÿäº§ç»Ÿè®¡"""
        self.cur.execute("""
            SELECT
                SUM(quantity) AS total_quantity,
                AVG(quality_score) AS avg_quality,
                SUM(defect_count) AS total_defects,
                AVG(production_rate) AS avg_rate,
                SUM(energy_consumption) AS total_energy
            FROM production_data
            WHERE production_line_id = %s
              AND time > NOW() - INTERVAL '%s hours'
        """, (production_line_id, hours))

        result = self.cur.fetchone()
        if result:
            return {
                'total_quantity': result[0] if result[0] else 0,
                'avg_quality': float(result[1]) if result[1] else None,
                'total_defects': result[2] if result[2] else 0,
                'avg_rate': float(result[3]) if result[3] else None,
                'total_energy': float(result[4]) if result[4] else None
            }
        return {}

    def create_production_plan(self, plan_date: date, product_id: str, target_quantity: int):
        """åˆ›å»ºç”Ÿäº§è®¡åˆ’"""
        self.cur.execute("""
            INSERT INTO production_plans
            (plan_date, product_id, target_quantity, status)
            VALUES (%s, %s, %s, %s)
            ON CONFLICT DO NOTHING
        """, (plan_date, product_id, target_quantity, 'pending'))

        self.conn.commit()

    def get_production_plans(self, plan_date: date) -> List[Dict]:
        """è·å–ç”Ÿäº§è®¡åˆ’"""
        self.cur.execute("""
            SELECT
                id, product_id, target_quantity, actual_quantity, status
            FROM production_plans
            WHERE plan_date = %s
            ORDER BY product_id
        """, (plan_date,))

        plans = []
        for row in self.cur.fetchall():
            plans.append({
                'id': row[0],
                'product_id': row[1],
                'target_quantity': row[2],
                'actual_quantity': row[3],
                'status': row[4]
            })

        return plans

# ä½¿ç”¨ç¤ºä¾‹
manager = ProductionManager("host=localhost dbname=testdb user=postgres password=secret")

# è®°å½•ç”Ÿäº§æ•°æ®
manager.record_production_data(
    production_line_id='line_001',
    product_id='product_A',
    quantity=100,
    quality_score=95.5,
    defect_count=2,
    production_rate=120.0,
    energy_consumption=50.5,
    status='running'
)

# è·å–ç”Ÿäº§ç»Ÿè®¡
stats = manager.get_production_statistics('line_001', hours=24)
print(f"Production statistics: {stats}")

# åˆ›å»ºç”Ÿäº§è®¡åˆ’
from datetime import date
manager.create_production_plan(date.today(), 'product_A', 1000)

# è·å–ç”Ÿäº§è®¡åˆ’
plans = manager.get_production_plans(date.today())
for plan in plans:
    print(f"Product {plan['product_id']}: {plan['actual_quantity']}/{plan['target_quantity']}")
```

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 08-54-01
