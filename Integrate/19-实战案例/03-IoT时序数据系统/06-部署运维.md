---

> **ğŸ“‹ æ–‡æ¡£æ¥æº**: `DataBaseTheory\19-åœºæ™¯æ¡ˆä¾‹åº“\03-IoTæ—¶åºæ•°æ®ç³»ç»Ÿ\06-éƒ¨ç½²è¿ç»´.md`
> **ğŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŸæ–‡ä»¶ä¿æŒä¸å˜

---

# æ¡ˆä¾‹3ï¼šIoTæ—¶åºæ•°æ®ç³»ç»Ÿ - éƒ¨ç½²è¿ç»´

## å…ƒæ•°æ®

- **åˆ›å»ºæ—¥æœŸ**: 2025-12-04
- **éƒ¨ç½²æ–¹å¼**: Docker + TimescaleDB
- **ç›‘æ§**: Prometheus + Grafana

---

## 1. éƒ¨ç½²é…ç½®

### 1.1 Docker Compose

```yaml
version: '3.8'

services:
  timescaledb:
    image: timescale/timescaledb:latest-pg18
    container_name: iot-timescaledb
    environment:
      POSTGRES_DB: iot_db
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - timescale-data:/var/lib/postgresql/data
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "5432:5432"
    command:
      - "postgres"
      - "-c"
      - "shared_buffers=2GB"
      - "-c"
      - "work_mem=128MB"
      - "-c"
      - "maintenance_work_mem=512MB"
      - "-c"
      - "max_connections=500"
      - "-c"
      - "effective_cache_size=6GB"

  collector:
    build: ./collector
    container_name: iot-collector
    depends_on:
      - timescaledb
    environment:
      DB_HOST: timescaledb
      DB_NAME: iot_db

  api:
    build: ./api
    container_name: iot-api
    depends_on:
      - timescaledb
    ports:
      - "8001:8001"

volumes:
  timescale-data:
```

---

## 2. PostgreSQLä¼˜åŒ–é…ç½®

### 2.1 IoTæ—¶åºä¼˜åŒ–

```ini
# postgresql.conf - IoTæ—¶åºä¼˜åŒ–

# å†…å­˜é…ç½®ï¼ˆå†™ä¼˜åŒ–ï¼‰
shared_buffers = 2GB
work_mem = 128MB
maintenance_work_mem = 512MB

# WALé…ç½®ï¼ˆé«˜é¢‘å†™å…¥ï¼‰
wal_buffers = 16MB
max_wal_size = 4GB
checkpoint_timeout = 15min
checkpoint_completion_target = 0.9

# å¼‚æ­¥I/O (PostgreSQL 18)
io_direct = data
io_combine_limit = 128kB

# è¿æ¥
max_connections = 500

# ç»Ÿè®¡
track_io_timing = on
```

---

## 3. æ•°æ®ä¿ç•™ç­–ç•¥

### 3.1 è‡ªåŠ¨åˆ é™¤æ—§æ•°æ®

```sql
-- TimescaleDBæ•°æ®ä¿ç•™ç­–ç•¥
SELECT add_retention_policy('iot_data', INTERVAL '365 days');

-- æ‰‹åŠ¨åˆ é™¤ï¼ˆå¦‚æœä¸ä½¿ç”¨TimescaleDBï¼‰
DELETE FROM iot_data
WHERE timestamp < NOW() - INTERVAL '365 days';
```

---

## 4. ç›‘æ§å‘Šè­¦

### 4.1 å…³é”®ç›‘æ§æŒ‡æ ‡

```text
å†™å…¥æ€§èƒ½:
â”œâ”€ å†™å…¥ååé‡ (points/ç§’)
â”œâ”€ å†™å…¥å»¶è¿Ÿ
â””â”€ æ‰¹æ¬¡å¤§å°

æŸ¥è¯¢æ€§èƒ½:
â”œâ”€ æŸ¥è¯¢å»¶è¿Ÿ
â”œâ”€ ç¼“å­˜å‘½ä¸­ç‡
â””â”€ å¹¶å‘æŸ¥è¯¢æ•°

å­˜å‚¨:
â”œâ”€ æ•°æ®åº“å¤§å°
â”œâ”€ å‹ç¼©ç‡
â”œâ”€ ç£ç›˜ä½¿ç”¨ç‡
â””â”€ åˆ†åŒºæ•°é‡

ç³»ç»Ÿ:
â”œâ”€ CPUä½¿ç”¨ç‡
â”œâ”€ å†…å­˜ä½¿ç”¨ç‡
â””â”€ ç£ç›˜I/O
```

---

**å®Œæˆæ—¥æœŸ**: 2025-12-04
**éƒ¨ç½²æ–¹å¼**: Docker Compose + TimescaleDB
**ç›‘æ§**: Prometheus + Grafana

**è¿”å›**: [æ¡ˆä¾‹3ä¸»é¡µ](./README.md)
