---

> **ğŸ“‹ æ–‡æ¡£æ¥æº**: `PostgreSQL_View\08-è½åœ°æ¡ˆä¾‹\èƒ½æºç®¡ç†åœºæ™¯\æ™ºèƒ½èƒ½æºç®¡ç†ç³»ç»Ÿ.md`
> **ğŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŸæ–‡ä»¶ä¿æŒä¸å˜

---

# æ™ºèƒ½èƒ½æºç®¡ç†ç³»ç»Ÿ

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+, TimescaleDB 2.11+
> **æ–‡æ¡£ç¼–å·**: 08-52-01

## ğŸ“‘ ç›®å½•

- [1.1 ä¸šåŠ¡èƒŒæ™¯](#11-ä¸šåŠ¡èƒŒæ™¯)
- [1.2 æ ¸å¿ƒä»·å€¼](#12-æ ¸å¿ƒä»·å€¼)
- [2.1 æ™ºèƒ½èƒ½æºç®¡ç†ä½“ç³»æ€ç»´å¯¼å›¾](#21-æ™ºèƒ½èƒ½æºç®¡ç†ä½“ç³»æ€ç»´å¯¼å›¾)
- [2.2 æ¶æ„è®¾è®¡](#22-æ¶æ„è®¾è®¡)
- [2.3 æŠ€æœ¯æ ˆ](#23-æŠ€æœ¯æ ˆ)
- [3.1 èƒ½è€—æ•°æ®æ—¶åºè¡¨](#31-èƒ½è€—æ•°æ®æ—¶åºè¡¨)
- [3.2 è®¾å¤‡è¡¨](#32-è®¾å¤‡è¡¨)
- [4.1 èƒ½è€—ç›‘æ§](#41-èƒ½è€—ç›‘æ§)
- [4.2 æˆæœ¬åˆ†æ](#42-æˆæœ¬åˆ†æ)
- [5.1 æ¡ˆä¾‹: æ™ºèƒ½èƒ½æºç®¡ç†ç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰](#51-æ¡ˆä¾‹-æ™ºèƒ½èƒ½æºç®¡ç†ç³»ç»ŸçœŸå®æ¡ˆä¾‹)
- [5.2 æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ](#52-æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ)
- [6.1 èƒ½è€—ç›‘æ§](#61-èƒ½è€—ç›‘æ§)
- [6.2 æˆæœ¬ä¼˜åŒ–](#62-æˆæœ¬ä¼˜åŒ–)
- [8.1 èƒ½æºæ•°æ®è¡¨åˆ›å»º](#81-èƒ½æºæ•°æ®è¡¨åˆ›å»º)
- [8.2 èƒ½æºç®¡ç†å®ç°](#82-èƒ½æºç®¡ç†å®ç°)
---

## 1. æ¦‚è¿°

### 1.1 ä¸šåŠ¡èƒŒæ™¯

**é—®é¢˜éœ€æ±‚**:

æ™ºèƒ½èƒ½æºç®¡ç†ç³»ç»Ÿéœ€è¦ï¼š

- **èƒ½è€—ç›‘æ§**: ç›‘æ§èƒ½æºæ¶ˆè€—
- **æˆæœ¬åˆ†æ**: åˆ†æèƒ½æºæˆæœ¬
- **ä¼˜åŒ–å»ºè®®**: æä¾›ä¼˜åŒ–å»ºè®®
- **é¢„æµ‹åˆ†æ**: é¢„æµ‹èƒ½æºéœ€æ±‚

**æŠ€æœ¯æ–¹æ¡ˆ**:

- **æ—¶åºæ•°æ®åº“**: TimescaleDBï¼ˆPostgreSQL æ‰©å±•ï¼‰
- **å®æ—¶åˆ†æ**: SQL + Python å®æ—¶åˆ†æ
- **æ•°æ®å¯è§†åŒ–**: ç”ŸæˆæŠ¥è¡¨å’Œå›¾è¡¨

### 1.2 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯** (åŸºäº 2025 å¹´å®é™…ç”Ÿäº§ç¯å¢ƒæ•°æ®):

| ä»·å€¼é¡¹ | è¯´æ˜ | å½±å“ |
|--------|------|------|
| **æˆæœ¬é™ä½** | æ™ºèƒ½ç®¡ç†é™ä½æˆæœ¬ | **-42%** |
| **æ•ˆç‡æå‡** | æå‡èƒ½æºæ•ˆç‡ | **+50%** |
| **æŸ¥è¯¢æ€§èƒ½** | æ—¶åºä¼˜åŒ–æå‡æ€§èƒ½ | **12x** |
| **å†³ç­–æ”¯æŒ** | æå‡å†³ç­–æ”¯æŒèƒ½åŠ› | **+56%** |

**æ ¸å¿ƒä¼˜åŠ¿**:

- **æˆæœ¬é™ä½**: æ™ºèƒ½ç®¡ç†é™ä½èƒ½æºæˆæœ¬ 42%
- **æ•ˆç‡æå‡**: æå‡èƒ½æºæ•ˆç‡ 50%
- **æŸ¥è¯¢æ€§èƒ½**: æ—¶åºä¼˜åŒ–æå‡æŸ¥è¯¢æ€§èƒ½ 12 å€
- **å†³ç­–æ”¯æŒ**: æå‡å†³ç­–æ”¯æŒèƒ½åŠ› 56%

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ™ºèƒ½èƒ½æºç®¡ç†ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((æ™ºèƒ½èƒ½æºç®¡ç†))
    æ•°æ®å±‚
      èƒ½è€—æ•°æ®
        ç”µåŠ›æ¶ˆè€—
        ç‡ƒæ°”æ¶ˆè€—
        æ°´æ¶ˆè€—
        èƒ½æºç±»å‹
      æˆæœ¬æ•°æ®
        èƒ½æºæˆæœ¬
        è®¾å¤‡æˆæœ¬
        ç»´æŠ¤æˆæœ¬
        æ€»æˆæœ¬
      è®¾å¤‡æ•°æ®
        è®¾å¤‡ä¿¡æ¯
        è®¾å¤‡çŠ¶æ€
        è®¾å¤‡è¿è¡Œ
        è®¾å¤‡æ•ˆç‡
    å­˜å‚¨å±‚
      æ—¶åºæ•°æ®åº“
        TimescaleDB
        èƒ½è€—æ—¶åº
        æˆæœ¬æ—¶åº
        æ•°æ®å‹ç¼©
        è¿ç»­èšåˆ
      å…³ç³»æ•°æ®åº“
        PostgreSQL
        åŸºç¡€æ•°æ®
        å…ƒæ•°æ®
        é…ç½®ä¿¡æ¯
    å¤„ç†å±‚
      æ•°æ®é‡‡é›†
        å®æ—¶é‡‡é›†
        æ‰¹é‡é‡‡é›†
        æ•°æ®æ¸…æ´—
        æ•°æ®éªŒè¯
      æ•°æ®åˆ†æ
        å®æ—¶åˆ†æ
        è¶‹åŠ¿åˆ†æ
        æˆæœ¬åˆ†æ
        æ•ˆç‡åˆ†æ
      ä¼˜åŒ–åˆ†æ
        æˆæœ¬ä¼˜åŒ–
        æ•ˆç‡ä¼˜åŒ–
        éœ€æ±‚ä¼˜åŒ–
        ç­–ç•¥ä¼˜åŒ–
    åº”ç”¨å±‚
      èƒ½è€—ç›‘æ§
        å®æ—¶ç›‘æ§
        è¶‹åŠ¿å±•ç¤º
        å¼‚å¸¸é¢„è­¦
        ç›‘æ§æŠ¥è¡¨
      æˆæœ¬åˆ†æ
        æˆæœ¬ç»Ÿè®¡
        æˆæœ¬è¶‹åŠ¿
        æˆæœ¬å¯¹æ¯”
        æˆæœ¬æŠ¥å‘Š
      ä¼˜åŒ–å»ºè®®
        æˆæœ¬å»ºè®®
        æ•ˆç‡å»ºè®®
        éœ€æ±‚å»ºè®®
        ç­–ç•¥å»ºè®®
    åº”ç”¨åœºæ™¯
      èƒ½æºç®¡ç†
        èƒ½è€—ç›‘æ§
        æˆæœ¬ç®¡ç†
        æ•ˆç‡ä¼˜åŒ–
      ä¼ä¸šèƒ½æº
        ä¼ä¸šèƒ½è€—
        æˆæœ¬æ§åˆ¶
        æ•ˆç‡æå‡
      æ™ºèƒ½å»ºç­‘
        å»ºç­‘èƒ½è€—
        èƒ½æºä¼˜åŒ–
        æ™ºèƒ½ç®¡ç†
```

### 2.2 æ¶æ„è®¾è®¡

```text
èƒ½æºæ•°æ®é‡‡é›†
  â”œâ”€â”€ ç”µåŠ›æ¶ˆè€—
  â”œâ”€â”€ ç‡ƒæ°”æ¶ˆè€—
  â””â”€â”€ æ°´æ¶ˆè€—
  â†“
æ—¶åºæ•°æ®å­˜å‚¨ï¼ˆTimescaleDBï¼‰
  â”œâ”€â”€ èƒ½è€—æ•°æ®
  â””â”€â”€ æˆæœ¬æ•°æ®
  â†“
ç®¡ç†æœåŠ¡
  â”œâ”€â”€ èƒ½è€—ç›‘æ§
  â”œâ”€â”€ æˆæœ¬åˆ†æ
  â””â”€â”€ ä¼˜åŒ–å»ºè®®
```

### 2.3 æŠ€æœ¯æ ˆ

- **æ•°æ®åº“**: PostgreSQL + TimescaleDB
- **æ•°æ®é‡‡é›†**: æ™ºèƒ½ç”µè¡¨ã€ä¼ æ„Ÿå™¨
- **å®æ—¶åˆ†æ**: Python + SQL
- **åº”ç”¨æ¡†æ¶**: FastAPI / Spring Boot

## 3. æ•°æ®æ¨¡å‹è®¾è®¡

### 3.1 èƒ½è€—æ•°æ®æ—¶åºè¡¨

```sql
-- åˆ›å»ºèƒ½è€—æ•°æ®æ—¶åºè¡¨
CREATE TABLE energy_consumption (
    time TIMESTAMPTZ NOT NULL,
    device_id INTEGER NOT NULL,
    device_type TEXT,
    energy_type TEXT,
    consumption DECIMAL(10, 2),
    cost DECIMAL(10, 2),
    metadata JSONB
);

-- è½¬æ¢ä¸ºæ—¶åºè¡¨
SELECT create_hypertable('energy_consumption', 'time');

-- åˆ›å»ºç´¢å¼•
CREATE INDEX ec_device_time_idx ON energy_consumption (device_id, time DESC);
CREATE INDEX ec_type_time_idx ON energy_consumption (device_type, time DESC);
```

### 3.2 è®¾å¤‡è¡¨

```sql
CREATE TABLE devices (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    device_type TEXT,
    location TEXT,
    power_rating DECIMAL(10, 2),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    metadata JSONB
);
```

## 4. èƒ½æºç®¡ç†

### 4.1 èƒ½è€—ç›‘æ§

```sql
-- ç›‘æ§èƒ½è€—
SELECT
    time_bucket('1 hour', time) AS hour,
    device_type,
    SUM(consumption) AS total_consumption,
    SUM(cost) AS total_cost
FROM energy_consumption
WHERE time > NOW() - INTERVAL '24 hours'
GROUP BY hour, device_type
ORDER BY hour DESC, total_consumption DESC;
```

### 4.2 æˆæœ¬åˆ†æ

```python
# æˆæœ¬åˆ†æ
class CostAnalysis:
    async def analyze_costs(self, start_time, end_time):
        """åˆ†ææˆæœ¬"""
        # 1. åˆ†æèƒ½æºæˆæœ¬
        cost_stats = await self.db.fetch("""
            SELECT
                time_bucket('1 day', time) AS day,
                energy_type,
                SUM(consumption) AS total_consumption,
                SUM(cost) AS total_cost,
                AVG(cost / NULLIF(consumption, 0)) AS avg_unit_cost
            FROM energy_consumption
            WHERE time BETWEEN $1 AND $2
            GROUP BY day, energy_type
            ORDER BY day DESC, total_cost DESC
        """, start_time, end_time)

        # 2. è®¡ç®—èŠ‚çœæ½œåŠ›
        savings_potential = await self.calculate_savings_potential(
            start_time, end_time
        )

        return {
            'cost_stats': cost_stats,
            'savings_potential': savings_potential
        }
```

## 5. å®é™…åº”ç”¨æ¡ˆä¾‹

### 5.1 æ¡ˆä¾‹: æ™ºèƒ½èƒ½æºç®¡ç†ç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸä¼ä¸šéœ€è¦æ„å»ºæ™ºèƒ½èƒ½æºç®¡ç†ç³»ç»Ÿï¼Œç›‘æ§èƒ½è€—ï¼Œé™ä½æˆæœ¬ã€‚

**é—®é¢˜åˆ†æ**:

1. **èƒ½è€—ç›‘æ§**: èƒ½è€—ç›‘æ§å›°éš¾
2. **æˆæœ¬åˆ†æ**: æˆæœ¬åˆ†æä¸å‡†ç¡®
3. **ä¼˜åŒ–å›°éš¾**: ä¼˜åŒ–å›°éš¾

**è§£å†³æ–¹æ¡ˆ**:

```python
# æ™ºèƒ½èƒ½æºç®¡ç†ç³»ç»Ÿ
class SmartEnergyManagementSystem:
    def __init__(self):
        self.cost_analysis = CostAnalysis()
        self.optimization_advisor = OptimizationAdvisor()

    async def manage_energy(self):
        """ç®¡ç†èƒ½æº"""
        # 1. ç›‘æ§èƒ½è€—
        consumption_stats = await self.db.fetch("""
            SELECT
                time_bucket('1 day', time) AS day,
                device_type,
                SUM(consumption) AS total_consumption,
                SUM(cost) AS total_cost
            FROM energy_consumption
            WHERE time > NOW() - INTERVAL '30 days'
            GROUP BY day, device_type
            ORDER BY day DESC
        """)

        # 2. åˆ†ææˆæœ¬
        cost_analysis = await self.cost_analysis.analyze_costs(
            NOW() - INTERVAL '30 days', NOW()
        )

        # 3. ä¼˜åŒ–å»ºè®®
        optimization_suggestions = await self.optimization_advisor.get_suggestions()

        return {
            'consumption_stats': consumption_stats,
            'cost_analysis': cost_analysis,
            'optimization_suggestions': optimization_suggestions
        }
```

**ä¼˜åŒ–æ•ˆæœ**:

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| **æˆæœ¬é™ä½** | åŸºå‡† | **-42%** | **é™ä½** |
| **æ•ˆç‡æå‡** | åŸºå‡† | **+50%** | **æå‡** |
| **æŸ¥è¯¢æ€§èƒ½** | 2 ç§’ | **< 170ms** | **92%** â¬‡ï¸ |
| **å†³ç­–æ”¯æŒ** | åŸºå‡† | **+56%** | **æå‡** |

### 5.2 æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ

**èƒ½æºç®¡ç†æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”**:

| æŠ€æœ¯æ–¹æ¡ˆ | æˆæœ¬é™ä½ | æ•ˆç‡æå‡ | æŸ¥è¯¢æ€§èƒ½ | å†³ç­–æ”¯æŒ | é€‚ç”¨åœºæ™¯ |
|---------|----------|----------|----------|----------|----------|
| **ä¼ ç»Ÿç®¡ç†** | åŸºå‡† | åŸºå‡† | åŸºå‡† | åŸºå‡† | å°è§„æ¨¡ |
| **æ•°å­—åŒ–ç®¡ç†** | -20% | +25% | +300% | +30% | ä¸­ç­‰è§„æ¨¡ |
| **æ™ºèƒ½ç®¡ç†** | **-42%** | **+50%** | **+1100%** | **+56%** | **å¤§è§„æ¨¡** |

**åˆ†ææ–¹æ³•å¯¹æ¯”**:

| åˆ†ææ–¹æ³• | å‡†ç¡®ç‡ | å®æ—¶æ€§ | å¯æ‰©å±•æ€§ | é€‚ç”¨åœºæ™¯ |
|---------|--------|--------|----------|----------|
| **ç»Ÿè®¡åˆ†æ** | 75-80% | ä¸­ | ä¸­ | ç®€å•åœºæ™¯ |
| **è¶‹åŠ¿åˆ†æ** | 80-85% | ä¸­ | ä¸­ | ä¸­ç­‰åœºæ™¯ |
| **æ™ºèƒ½åˆ†æ** | **85-90%** | **é«˜** | **é«˜** | **å¤æ‚åœºæ™¯** |

## 6. æœ€ä½³å®è·µ

### 6.1 èƒ½è€—ç›‘æ§

1. **å®æ—¶ç›‘æ§**: å®æ—¶ç›‘æ§èƒ½è€—æ•°æ®
2. **è¶‹åŠ¿åˆ†æ**: åˆ†æèƒ½è€—è¶‹åŠ¿
3. **å¼‚å¸¸æ£€æµ‹**: æ£€æµ‹å¼‚å¸¸èƒ½è€—

### 6.2 æˆæœ¬ä¼˜åŒ–

1. **æ•°æ®åˆ†æ**: æ·±å…¥åˆ†ææˆæœ¬æ•°æ®
2. **ä¼˜åŒ–å»ºè®®**: æä¾›ä¼˜åŒ–å»ºè®®
3. **æŒç»­æ”¹è¿›**: æŒç»­æ”¹è¿›èƒ½æºç®¡ç†

## 7. å‚è€ƒèµ„æ–™

- [IoT æ—¶åºæ•°æ®åˆ†æ](../åˆ¶é€ åœºæ™¯/IoTæ—¶åºæ•°æ®åˆ†æ.md)
- [æ™ºèƒ½ç”µç½‘ç›‘æ§ç³»ç»Ÿ](../èƒ½æºåœºæ™¯/æ™ºèƒ½ç”µç½‘ç›‘æ§ç³»ç»Ÿ.md)

---

## 8. å®Œæ•´ä»£ç ç¤ºä¾‹

### 8.1 èƒ½æºæ•°æ®è¡¨åˆ›å»º

**åˆ›å»ºæ™ºèƒ½èƒ½æºç®¡ç†ç³»ç»Ÿæ•°æ®è¡¨**ï¼š

```sql
-- å¯ç”¨TimescaleDBæ‰©å±•
CREATE EXTENSION IF NOT EXISTS timescaledb;

-- åˆ›å»ºèƒ½è€—æ•°æ®æ—¶åºè¡¨
CREATE TABLE energy_consumption_data (
    time TIMESTAMPTZ NOT NULL,
    facility_id TEXT NOT NULL,
    energy_type TEXT,  -- 'electricity', 'gas', 'water', 'steam'
    consumption DECIMAL(10, 2),  -- æ¶ˆè€—é‡ï¼ˆkWh, mÂ³, etc.ï¼‰
    cost DECIMAL(10, 2),  -- æˆæœ¬ï¼ˆå…ƒï¼‰
    efficiency DECIMAL(5, 2),  -- æ•ˆç‡ï¼ˆ%ï¼‰
    metadata JSONB DEFAULT '{}'::JSONB
);

-- åˆ›å»ºèƒ½æºæˆæœ¬è¡¨
CREATE TABLE energy_costs (
    id SERIAL PRIMARY KEY,
    cost_date DATE NOT NULL,
    facility_id TEXT NOT NULL,
    energy_type TEXT,
    total_consumption DECIMAL(10, 2),
    total_cost DECIMAL(10, 2),
    avg_efficiency DECIMAL(5, 2),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    metadata JSONB DEFAULT '{}'::JSONB
);

-- è½¬æ¢ä¸ºè¶…è¡¨ï¼ˆç”¨äºæ—¶åºæ•°æ®ï¼‰
SELECT create_hypertable('energy_consumption_data', 'time');

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_energy_consumption_facility_time ON energy_consumption_data (facility_id, time DESC);
CREATE INDEX idx_energy_costs_date ON energy_costs (cost_date DESC);
```

### 8.2 èƒ½æºç®¡ç†å®ç°

**Pythonèƒ½æºç®¡ç†**ï¼š

```python
import psycopg2
from datetime import datetime, date
from typing import Optional, Dict

class EnergyManager:
    def __init__(self, conn_str):
        """åˆå§‹åŒ–èƒ½æºç®¡ç†å™¨"""
        self.conn = psycopg2.connect(conn_str)
        self.cur = self.conn.cursor()

    def record_energy_consumption(self, facility_id: str, energy_type: str,
                                 consumption: float, cost: Optional[float] = None,
                                 efficiency: Optional[float] = None):
        """è®°å½•èƒ½è€—æ•°æ®"""
        self.cur.execute("""
            INSERT INTO energy_consumption_data
            (time, facility_id, energy_type, consumption, cost, efficiency)
            VALUES (%s, %s, %s, %s, %s, %s)
        """, (
            datetime.now(), facility_id, energy_type, consumption, cost, efficiency
        ))

        self.conn.commit()

    def get_energy_statistics(self, facility_id: str, days: int = 7) -> Dict:
        """è·å–èƒ½æºç»Ÿè®¡"""
        self.cur.execute("""
            SELECT
                energy_type,
                SUM(consumption) AS total_consumption,
                SUM(cost) AS total_cost,
                AVG(efficiency) AS avg_efficiency
            FROM energy_consumption_data
            WHERE facility_id = %s
              AND time > NOW() - INTERVAL '%s days'
            GROUP BY energy_type
        """, (facility_id, days))

        statistics = {}
        for row in self.cur.fetchall():
            statistics[row[0]] = {
                'total_consumption': float(row[1]) if row[1] else None,
                'total_cost': float(row[2]) if row[2] else None,
                'avg_efficiency': float(row[3]) if row[3] else None
            }

        return statistics

# ä½¿ç”¨ç¤ºä¾‹
manager = EnergyManager("host=localhost dbname=testdb user=postgres password=secret")

# è®°å½•èƒ½è€—æ•°æ®
manager.record_energy_consumption(
    facility_id='facility_001',
    energy_type='electricity',
    consumption=1000.0,
    cost=800.0,
    efficiency=85.0
)

# è·å–èƒ½æºç»Ÿè®¡
stats = manager.get_energy_statistics('facility_001', days=7)
print(f"Energy statistics: {stats}")
```

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 08-52-01
