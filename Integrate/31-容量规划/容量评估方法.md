# PostgreSQLå®¹é‡è¯„ä¼°æ–¹æ³•

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 17+/18+
> **éš¾åº¦ç­‰çº§**: â­â­â­ ä¸­çº§

---

## ğŸ“‹ ç›®å½•

- [PostgreSQLå®¹é‡è¯„ä¼°æ–¹æ³•](#postgresqlå®¹é‡è¯„ä¼°æ–¹æ³•)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
  - [2. å­˜å‚¨å®¹é‡è¯„ä¼°](#2-å­˜å‚¨å®¹é‡è¯„ä¼°)
    - [2.1 æ•°æ®åº“å¤§å°](#21-æ•°æ®åº“å¤§å°)
    - [2.2 è¡¨å¤§å°](#22-è¡¨å¤§å°)
  - [3. è®¡ç®—å®¹é‡è¯„ä¼°](#3-è®¡ç®—å®¹é‡è¯„ä¼°)
    - [3.1 CPUä½¿ç”¨ç‡](#31-cpuä½¿ç”¨ç‡)
    - [3.2 å†…å­˜ä½¿ç”¨ç‡](#32-å†…å­˜ä½¿ç”¨ç‡)
  - [4. ç½‘ç»œå®¹é‡è¯„ä¼°](#4-ç½‘ç»œå®¹é‡è¯„ä¼°)
    - [4.1 ç½‘ç»œæµé‡](#41-ç½‘ç»œæµé‡)
    - [4.2 è¿æ¥æ•°](#42-è¿æ¥æ•°)
  - [5. å®¹é‡æŠ¥å‘Š](#5-å®¹é‡æŠ¥å‘Š)
    - [5.1 å®¹é‡æŠ¥å‘Šæ¨¡æ¿](#51-å®¹é‡æŠ¥å‘Šæ¨¡æ¿)
  - [ğŸ“š ç›¸å…³æ–‡æ¡£](#-ç›¸å…³æ–‡æ¡£)

---

## 1. æ¦‚è¿°

å®¹é‡è¯„ä¼°æ˜¯å®¹é‡è§„åˆ’çš„åŸºç¡€ï¼Œéœ€è¦å‡†ç¡®è¯„ä¼°å½“å‰å®¹é‡ä½¿ç”¨æƒ…å†µã€‚

**è¯„ä¼°å†…å®¹**:

- å­˜å‚¨å®¹é‡
- è®¡ç®—å®¹é‡
- ç½‘ç»œå®¹é‡
- è¿æ¥å®¹é‡

---

## 2. å­˜å‚¨å®¹é‡è¯„ä¼°

### 2.1 æ•°æ®åº“å¤§å°

```sql
-- æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“å¤§å°
SELECT
    datname,
    pg_size_pretty(pg_database_size(datname)) AS size
FROM pg_database
ORDER BY pg_database_size(datname) DESC;
```

### 2.2 è¡¨å¤§å°

```sql
-- æŸ¥çœ‹è¡¨å¤§å°
SELECT
    schemaname,
    tablename,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS total_size,
    pg_size_pretty(pg_relation_size(schemaname||'.'||tablename)) AS table_size,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename) -
                   pg_relation_size(schemaname||'.'||tablename)) AS indexes_size
FROM pg_tables
WHERE schemaname = 'public'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;
```

---

## 3. è®¡ç®—å®¹é‡è¯„ä¼°

### 3.1 CPUä½¿ç”¨ç‡

```sql
-- æŸ¥çœ‹CPUä½¿ç”¨æƒ…å†µï¼ˆéœ€è¦pg_stat_statementsï¼‰
SELECT
    query,
    calls,
    total_exec_time,
    mean_exec_time
FROM pg_stat_statements
ORDER BY total_exec_time DESC
LIMIT 10;
```

### 3.2 å†…å­˜ä½¿ç”¨ç‡

```sql
-- æŸ¥çœ‹å…±äº«å†…å­˜ä½¿ç”¨
SELECT
    name,
    setting,
    unit
FROM pg_settings
WHERE name IN ('shared_buffers', 'effective_cache_size', 'work_mem');
```

---

## 4. ç½‘ç»œå®¹é‡è¯„ä¼°

### 4.1 ç½‘ç»œæµé‡

```text
ç›‘æ§ç½‘ç»œæµé‡
- å…¥ç«™æµé‡
- å‡ºç«™æµé‡
- å³°å€¼æµé‡
```

### 4.2 è¿æ¥æ•°

```sql
-- æŸ¥çœ‹è¿æ¥æ•°ä½¿ç”¨
SELECT
    count(*) AS current_connections,
    (SELECT setting::int FROM pg_settings WHERE name = 'max_connections') AS max_connections,
    round(100.0 * count(*) / (SELECT setting::int FROM pg_settings WHERE name = 'max_connections'), 2) AS usage_percent
FROM pg_stat_activity;
```

---

## 5. å®¹é‡æŠ¥å‘Š

### 5.1 å®¹é‡æŠ¥å‘Šæ¨¡æ¿

```text
å®¹é‡è¯„ä¼°æŠ¥å‘Š
- å½“å‰å®¹é‡ä½¿ç”¨æƒ…å†µ
- å®¹é‡ä½¿ç”¨è¶‹åŠ¿
- å®¹é‡ç“¶é¢ˆè¯†åˆ«
- å®¹é‡å¢é•¿é¢„æµ‹
- å®¹é‡è§„åˆ’å»ºè®®
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®¹é‡è§„åˆ’å®Œæ•´æŒ‡å—.md](./å®¹é‡è§„åˆ’å®Œæ•´æŒ‡å—.md) - å®¹é‡è§„åˆ’å®Œæ•´æŒ‡å—
- [å¢é•¿é¢„æµ‹.md](./å¢é•¿é¢„æµ‹.md) - å¢é•¿é¢„æµ‹æŒ‡å—
- [31-å®¹é‡è§„åˆ’/README.md](./README.md) - å®¹é‡è§„åˆ’ä¸»é¢˜

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
