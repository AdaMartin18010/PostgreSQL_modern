# OLAPäº‹å®è¡¨æŠ€æœ¯å®Œæ•´æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æ¥æº**: Kimballã€Šæ•°æ®ä»“åº“å·¥å…·ç®±ã€‹+ æƒå¨èµ„æºå¯¹é½
> **çŠ¶æ€**: åŸºäºæƒå¨èµ„æºæ·±åŒ–æ‰©å±•
> **æ–‡æ¡£ç¼–å·**: 05-02

---

## ğŸ“‘ ç›®å½•

- [1. æ¦‚è¿°](#1-æ¦‚è¿°)
- [2. äº‹å®è¡¨ç±»å‹](#2-äº‹å®è¡¨ç±»å‹)
  - [2.1 äº‹åŠ¡äº‹å®è¡¨ï¼ˆTransaction Fact Tableï¼‰](#21-äº‹åŠ¡äº‹å®è¡¨transaction-fact-table)
  - [2.2 å‘¨æœŸå¿«ç…§äº‹å®è¡¨ï¼ˆPeriodic Snapshot Fact Tableï¼‰](#22-å‘¨æœŸå¿«ç…§äº‹å®è¡¨periodic-snapshot-fact-table)
  - [2.3 ç´¯ç§¯å¿«ç…§äº‹å®è¡¨ï¼ˆAccumulating Snapshot Fact Tableï¼‰](#23-ç´¯ç§¯å¿«ç…§äº‹å®è¡¨accumulating-snapshot-fact-table)
- [3. äº‹å®è¡¨è®¾è®¡åŸåˆ™](#3-äº‹å®è¡¨è®¾è®¡åŸåˆ™)
- [4. åº¦é‡å€¼ç±»å‹](#4-åº¦é‡å€¼ç±»å‹)
- [5. é€€åŒ–ç»´åº¦](#5-é€€åŒ–ç»´åº¦)
- [6. PostgreSQLå®ç°](#6-postgresqlå®ç°)
- [7. ç›¸å…³èµ„æº](#7-ç›¸å…³èµ„æº)

---

## 1. æ¦‚è¿°

äº‹å®è¡¨æ˜¯ç»´åº¦å»ºæ¨¡çš„æ ¸å¿ƒï¼Œå­˜å‚¨ä¸šåŠ¡è¿‡ç¨‹çš„åº¦é‡å€¼ã€‚Kimballå®šä¹‰äº†ä¸‰ç§äº‹å®è¡¨ç±»å‹ï¼šäº‹åŠ¡äº‹å®è¡¨ã€å‘¨æœŸå¿«ç…§äº‹å®è¡¨ã€ç´¯ç§¯å¿«ç…§äº‹å®è¡¨ã€‚æ­£ç¡®é€‰æ‹©äº‹å®è¡¨ç±»å‹å¯¹æ•°æ®ä»“åº“æ€§èƒ½è‡³å…³é‡è¦ã€‚

---

## 2. äº‹å®è¡¨ç±»å‹

### 2.1 äº‹åŠ¡äº‹å®è¡¨ï¼ˆTransaction Fact Tableï¼‰

**å®šä¹‰**: è®°å½•ä¸šåŠ¡è¿‡ç¨‹å‘ç”Ÿæ—¶çš„æ¯ä¸ªäº‹ä»¶ï¼Œä¸€è¡Œä»£è¡¨ä¸€ä¸ªä¸šåŠ¡äº‹ä»¶ã€‚

**ç‰¹ç‚¹**:

- ç²’åº¦æœ€ç»†ï¼ˆæ¯ä¸ªäº‹åŠ¡ä¸€è¡Œï¼‰
- æ•°æ®é‡æœ€å¤§
- ä¸å¯æ›´æ–°ï¼ˆä»…è¿½åŠ ï¼‰
- é€‚åˆåˆ†æè¯¦ç»†äº¤æ˜“

**é€‚ç”¨åœºæ™¯**:

- é”€å”®äº¤æ˜“
- è®¢å•æ˜ç»†
- æ”¯ä»˜äº¤æ˜“
- ç‚¹å‡»äº‹ä»¶

**PostgreSQLå®ç°**:

```sql
-- é”€å”®äº‹åŠ¡äº‹å®è¡¨
CREATE TABLE fact_sales_transaction (
    sale_id BIGSERIAL PRIMARY KEY,
    -- ç»´åº¦é”®
    date_key INT NOT NULL REFERENCES dim_date(date_key),
    time_key INT NOT NULL REFERENCES dim_time(time_key),
    product_key INT NOT NULL REFERENCES dim_product(product_key),
    customer_key INT NOT NULL REFERENCES dim_customer(customer_key),
    store_key INT NOT NULL REFERENCES dim_store(store_key),
    promotion_key INT REFERENCES dim_promotion(promotion_key),
    -- é€€åŒ–ç»´åº¦
    transaction_number VARCHAR(50),  -- äº¤æ˜“ç¼–å·
    receipt_number VARCHAR(50),      -- æ”¶æ®ç¼–å·
    -- åº¦é‡å€¼
    sales_amount NUMERIC(10,2) NOT NULL,
    sales_quantity INT NOT NULL,
    discount_amount NUMERIC(10,2) DEFAULT 0,
    cost_amount NUMERIC(10,2),
    profit_amount NUMERIC(10,2) GENERATED ALWAYS AS (sales_amount - cost_amount) STORED,
    -- å…ƒæ•°æ®
    created_at TIMESTAMPTZ DEFAULT NOW()
) PARTITION BY RANGE (date_key);

-- åˆ›å»ºåˆ†åŒº
CREATE TABLE fact_sales_transaction_2024_01 PARTITION OF fact_sales_transaction
    FOR VALUES FROM (20240101) TO (20240201);

-- ç´¢å¼•ç­–ç•¥
CREATE INDEX idx_fact_sales_date ON fact_sales_transaction(date_key);
CREATE INDEX idx_fact_sales_product ON fact_sales_transaction(product_key);
CREATE INDEX idx_fact_sales_customer ON fact_sales_transaction(customer_key);
CREATE INDEX idx_fact_sales_transaction_num ON fact_sales_transaction(transaction_number);
```

**æŸ¥è¯¢ç¤ºä¾‹**:

```sql
-- æŸ¥è¯¢æ¯æ—¥é”€å”®æ€»é¢
SELECT
    d.date_actual,
    SUM(f.sales_amount) AS daily_sales,
    SUM(f.sales_quantity) AS daily_quantity,
    COUNT(*) AS transaction_count
FROM fact_sales_transaction f
JOIN dim_date d ON f.date_key = d.date_key
WHERE d.year_number = 2024
GROUP BY d.date_actual
ORDER BY d.date_actual;
```

---

### 2.2 å‘¨æœŸå¿«ç…§äº‹å®è¡¨ï¼ˆPeriodic Snapshot Fact Tableï¼‰

**å®šä¹‰**: å®šæœŸè®°å½•ä¸šåŠ¡çŠ¶æ€ï¼Œä¸€è¡Œä»£è¡¨ä¸€ä¸ªæ—¶é—´å‘¨æœŸçš„å¿«ç…§ã€‚

**ç‰¹ç‚¹**:

- å®šæœŸå¿«ç…§ï¼ˆæ¯å¤©ã€æ¯å‘¨ã€æ¯æœˆï¼‰
- å¯æ›´æ–°ï¼ˆè¦†ç›–å†å²å¿«ç…§ï¼‰
- é€‚åˆåˆ†æè¶‹åŠ¿å’ŒçŠ¶æ€
- æ•°æ®é‡ä¸­ç­‰

**é€‚ç”¨åœºæ™¯**:

- è´¦æˆ·ä½™é¢
- åº“å­˜æ°´å¹³
- è´¦æˆ·çŠ¶æ€
- æœˆåº¦é”€å”®æ±‡æ€»

**PostgreSQLå®ç°**:

```sql
-- è´¦æˆ·ä½™é¢å‘¨æœŸå¿«ç…§äº‹å®è¡¨ï¼ˆæ¯æ—¥å¿«ç…§ï¼‰
CREATE TABLE fact_account_balance_snapshot (
    snapshot_id BIGSERIAL PRIMARY KEY,
    -- ç»´åº¦é”®
    date_key INT NOT NULL REFERENCES dim_date(date_key),
    account_key INT NOT NULL REFERENCES dim_account(account_key),
    -- åº¦é‡å€¼ï¼ˆåŠå¯åŠ ï¼‰
    opening_balance NUMERIC(15,2) NOT NULL,  -- æœŸåˆä½™é¢
    closing_balance NUMERIC(15,2) NOT NULL,   -- æœŸæœ«ä½™é¢
    deposit_amount NUMERIC(15,2) DEFAULT 0,    -- å­˜æ¬¾é‡‘é¢
    withdrawal_amount NUMERIC(15,2) DEFAULT 0, -- å–æ¬¾é‡‘é¢
    interest_amount NUMERIC(15,2) DEFAULT 0,   -- åˆ©æ¯é‡‘é¢
    -- å”¯ä¸€çº¦æŸï¼ˆæ¯ä¸ªè´¦æˆ·æ¯å¤©ä¸€ä¸ªå¿«ç…§ï¼‰
    UNIQUE(date_key, account_key)
) PARTITION BY RANGE (date_key);

-- åˆ›å»ºåˆ†åŒº
CREATE TABLE fact_account_balance_snapshot_2024_01 PARTITION OF fact_account_balance_snapshot
    FOR VALUES FROM (20240101) TO (20240201);

-- ç´¢å¼•ç­–ç•¥
CREATE INDEX idx_fact_account_balance_date ON fact_account_balance_snapshot(date_key);
CREATE INDEX idx_fact_account_balance_account ON fact_account_balance_snapshot(account_key);
CREATE INDEX idx_fact_account_balance_date_account ON fact_account_balance_snapshot(date_key, account_key);
```

**å¿«ç…§ç”Ÿæˆ**:

```sql
-- æ¯æ—¥å¿«ç…§ç”Ÿæˆå‡½æ•°
CREATE OR REPLACE FUNCTION generate_daily_account_snapshot(snapshot_date DATE)
RETURNS VOID AS $$
BEGIN
    INSERT INTO fact_account_balance_snapshot (
        date_key,
        account_key,
        opening_balance,
        closing_balance,
        deposit_amount,
        withdrawal_amount,
        interest_amount
    )
    SELECT
        TO_CHAR(snapshot_date, 'YYYYMMDD')::INT AS date_key,
        a.account_key,
        COALESCE(
            (SELECT closing_balance
             FROM fact_account_balance_snapshot
             WHERE account_key = a.account_key
               AND date_key < TO_CHAR(snapshot_date, 'YYYYMMDD')::INT
             ORDER BY date_key DESC LIMIT 1),
            0
        ) AS opening_balance,
        COALESCE(
            (SELECT closing_balance
             FROM fact_account_balance_snapshot
             WHERE account_key = a.account_key
               AND date_key < TO_CHAR(snapshot_date, 'YYYYMMDD')::INT
             ORDER BY date_key DESC LIMIT 1),
            0
        ) +
        COALESCE(SUM(CASE WHEN t.transaction_type = 'DEPOSIT' THEN t.amount ELSE 0 END), 0) -
        COALESCE(SUM(CASE WHEN t.transaction_type = 'WITHDRAWAL' THEN t.amount ELSE 0 END), 0) +
        COALESCE(SUM(CASE WHEN t.transaction_type = 'INTEREST' THEN t.amount ELSE 0 END), 0) AS closing_balance,
        COALESCE(SUM(CASE WHEN t.transaction_type = 'DEPOSIT' THEN t.amount ELSE 0 END), 0) AS deposit_amount,
        COALESCE(SUM(CASE WHEN t.transaction_type = 'WITHDRAWAL' THEN t.amount ELSE 0 END), 0) AS withdrawal_amount,
        COALESCE(SUM(CASE WHEN t.transaction_type = 'INTEREST' THEN t.amount ELSE 0 END), 0) AS interest_amount
    FROM dim_account a
    LEFT JOIN fact_account_transactions t ON a.account_key = t.account_key
        AND DATE(t.transaction_date) = snapshot_date
    GROUP BY a.account_key
    ON CONFLICT (date_key, account_key) DO UPDATE SET
        opening_balance = EXCLUDED.opening_balance,
        closing_balance = EXCLUDED.closing_balance,
        deposit_amount = EXCLUDED.deposit_amount,
        withdrawal_amount = EXCLUDED.withdrawal_amount,
        interest_amount = EXCLUDED.interest_amount;
END;
$$ LANGUAGE plpgsql;
```

---

### 2.3 ç´¯ç§¯å¿«ç…§äº‹å®è¡¨ï¼ˆAccumulating Snapshot Fact Tableï¼‰

**å®šä¹‰**: è®°å½•ä¸šåŠ¡è¿‡ç¨‹çš„å¤šä¸ªé‡Œç¨‹ç¢‘ï¼Œä¸€è¡Œä»£è¡¨ä¸€ä¸ªä¸šåŠ¡å®ä¾‹çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸã€‚

**ç‰¹ç‚¹**:

- è®°å½•å¤šä¸ªæ—¶é—´ç‚¹ï¼ˆè®¢å•æ—¥æœŸã€å‘è´§æ—¥æœŸã€äº¤ä»˜æ—¥æœŸï¼‰
- å¯æ›´æ–°ï¼ˆæ›´æ–°é‡Œç¨‹ç¢‘ï¼‰
- é€‚åˆåˆ†ææµç¨‹æ•ˆç‡
- æ•°æ®é‡è¾ƒå°

**é€‚ç”¨åœºæ™¯**:

- è®¢å•å¤„ç†æµç¨‹
- ç´¢èµ”å¤„ç†æµç¨‹
- äº§å“åˆ¶é€ æµç¨‹
- é¡¹ç›®ç”Ÿå‘½å‘¨æœŸ

**PostgreSQLå®ç°**:

```sql
-- è®¢å•ç´¯ç§¯å¿«ç…§äº‹å®è¡¨
CREATE TABLE fact_order_accumulating (
    order_key BIGSERIAL PRIMARY KEY,
    -- ç»´åº¦é”®
    order_date_key INT NOT NULL REFERENCES dim_date(date_key),
    ship_date_key INT REFERENCES dim_date(date_key),
    delivery_date_key INT REFERENCES dim_date(date_key),
    cancel_date_key INT REFERENCES dim_date(date_key),
    product_key INT NOT NULL REFERENCES dim_product(product_key),
    customer_key INT NOT NULL REFERENCES dim_customer(customer_key),
    -- é€€åŒ–ç»´åº¦
    order_number VARCHAR(50) UNIQUE NOT NULL,
    -- åº¦é‡å€¼
    order_amount NUMERIC(10,2) NOT NULL,
    order_quantity INT NOT NULL,
    -- æ—¶é—´é—´éš”åº¦é‡å€¼ï¼ˆå¤©æ•°ï¼‰
    days_to_ship INT GENERATED ALWAYS AS (
        CASE WHEN ship_date_key IS NOT NULL
        THEN ship_date_key - order_date_key
        ELSE NULL END
    ) STORED,
    days_to_delivery INT GENERATED ALWAYS AS (
        CASE WHEN delivery_date_key IS NOT NULL
        THEN delivery_date_key - order_date_key
        ELSE NULL END
    ) STORED,
    days_to_cancel INT GENERATED ALWAYS AS (
        CASE WHEN cancel_date_key IS NOT NULL
        THEN cancel_date_key - order_date_key
        ELSE NULL END
    ) STORED,
    -- çŠ¶æ€æ ‡å¿—
    is_shipped BOOLEAN DEFAULT FALSE,
    is_delivered BOOLEAN DEFAULT FALSE,
    is_cancelled BOOLEAN DEFAULT FALSE,
    -- å…ƒæ•°æ®
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- ç´¢å¼•ç­–ç•¥
CREATE INDEX idx_fact_order_order_date ON fact_order_accumulating(order_date_key);
CREATE INDEX idx_fact_order_ship_date ON fact_order_accumulating(ship_date_key) WHERE ship_date_key IS NOT NULL;
CREATE INDEX idx_fact_order_delivery_date ON fact_order_accumulating(delivery_date_key) WHERE delivery_date_key IS NOT NULL;
CREATE INDEX idx_fact_order_customer ON fact_order_accumulating(customer_key);
```

**æ›´æ–°é‡Œç¨‹ç¢‘**:

```sql
-- æ›´æ–°å‘è´§æ—¥æœŸ
UPDATE fact_order_accumulating
SET
    ship_date_key = TO_CHAR('2024-01-15'::DATE, 'YYYYMMDD')::INT,
    is_shipped = TRUE,
    updated_at = NOW()
WHERE order_number = 'ORD20240101001';

-- æ›´æ–°äº¤ä»˜æ—¥æœŸ
UPDATE fact_order_accumulating
SET
    delivery_date_key = TO_CHAR('2024-01-20'::DATE, 'YYYYMMDD')::INT,
    is_delivered = TRUE,
    updated_at = NOW()
WHERE order_number = 'ORD20240101001';
```

**æŸ¥è¯¢ç¤ºä¾‹**:

```sql
-- åˆ†æè®¢å•å¤„ç†æ•ˆç‡
SELECT
    p.category_name,
    AVG(f.days_to_ship) AS avg_days_to_ship,
    AVG(f.days_to_delivery) AS avg_days_to_delivery,
    COUNT(*) FILTER (WHERE f.is_cancelled) AS cancelled_count,
    COUNT(*) FILTER (WHERE f.is_delivered) AS delivered_count
FROM fact_order_accumulating f
JOIN dim_product p ON f.product_key = p.product_key
WHERE f.order_date_key >= 20240101
GROUP BY p.category_name
ORDER BY avg_days_to_delivery;
```

---

## 3. äº‹å®è¡¨è®¾è®¡åŸåˆ™

### 3.1 ç²’åº¦å£°æ˜

**åŸåˆ™**: æ˜ç¡®å£°æ˜äº‹å®è¡¨çš„ç²’åº¦ï¼ˆGrainï¼‰

**ç¤ºä¾‹**:

```sql
-- âœ… æ­£ç¡®ï¼šç²’åº¦æ˜ç¡®
-- ç²’åº¦ï¼šæ¯ä¸ªè®¢å•è¡Œçš„æ¯ä¸ªäº§å“
CREATE TABLE fact_sales (
    order_line_id BIGINT,  -- ç²’åº¦æ ‡è¯†
    ...
);

-- âŒ é”™è¯¯ï¼šç²’åº¦ä¸æ˜ç¡®
CREATE TABLE fact_sales (
    order_id BIGINT,  -- ç²’åº¦ä¸æ˜ç¡®ï¼ˆè®¢å•è¿˜æ˜¯è®¢å•è¡Œï¼Ÿï¼‰
    ...
);
```

---

### 3.2 å¯åŠ æ€§è§„åˆ™

**å¯åŠ åº¦é‡å€¼**: å¯ä»¥è·¨æ‰€æœ‰ç»´åº¦ç›¸åŠ 

- é”€å”®é¢ã€æ•°é‡ã€æˆæœ¬

**åŠå¯åŠ åº¦é‡å€¼**: åªèƒ½è·¨éƒ¨åˆ†ç»´åº¦ç›¸åŠ 

- è´¦æˆ·ä½™é¢ï¼ˆä¸èƒ½è·¨æ—¶é—´ç›¸åŠ ï¼‰
- åº“å­˜æ°´å¹³ï¼ˆä¸èƒ½è·¨æ—¶é—´ç›¸åŠ ï¼‰

**ä¸å¯åŠ åº¦é‡å€¼**: ä¸èƒ½ç›¸åŠ 

- æ¯”ç‡ã€ç™¾åˆ†æ¯”ã€å¹³å‡å€¼

---

### 3.3 äº‹å®è¡¨å¤§å°æ§åˆ¶

**ç­–ç•¥1: ä½¿ç”¨åˆ†åŒº**:

```sql
-- æŒ‰æœˆåˆ†åŒº
CREATE TABLE fact_sales (
    ...
) PARTITION BY RANGE (date_key);
```

**ç­–ç•¥2: ä½¿ç”¨èšåˆè¡¨**:

```sql
-- åˆ›å»ºæœˆåº¦èšåˆè¡¨
CREATE MATERIALIZED VIEW mv_sales_monthly AS
SELECT
    date_key / 100 AS month_key,
    product_key,
    SUM(sales_amount) AS monthly_sales
FROM fact_sales
GROUP BY date_key / 100, product_key;
```

---

## 4. åº¦é‡å€¼ç±»å‹

### 4.1 å¯åŠ åº¦é‡å€¼

```sql
-- å¯åŠ åº¦é‡å€¼ç¤ºä¾‹
CREATE TABLE fact_sales (
    sales_amount NUMERIC(10,2),      -- å¯åŠ 
    sales_quantity INT,               -- å¯åŠ 
    discount_amount NUMERIC(10,2),   -- å¯åŠ 
    cost_amount NUMERIC(10,2)        -- å¯åŠ 
);
```

---

### 4.2 åŠå¯åŠ åº¦é‡å€¼

```sql
-- åŠå¯åŠ åº¦é‡å€¼ç¤ºä¾‹
CREATE TABLE fact_account_balance (
    account_key INT,
    date_key INT,
    balance NUMERIC(15,2),  -- åŠå¯åŠ ï¼ˆä¸èƒ½è·¨æ—¶é—´ç›¸åŠ ï¼‰
    -- å¯ä»¥è·¨è´¦æˆ·ç›¸åŠ ï¼Œä½†ä¸èƒ½è·¨æ—¶é—´ç›¸åŠ 
    UNIQUE(account_key, date_key)
);
```

---

### 4.3 ä¸å¯åŠ åº¦é‡å€¼

```sql
-- ä¸å¯åŠ åº¦é‡å€¼ç¤ºä¾‹
CREATE TABLE fact_sales (
    sales_amount NUMERIC(10,2),
    sales_quantity INT,
    profit_margin NUMERIC(5,2),  -- ä¸å¯åŠ ï¼ˆæ¯”ç‡ï¼‰
    -- è®¡ç®—å¹³å‡å€¼è€Œä¸æ˜¯æ±‚å’Œ
    avg_unit_price NUMERIC(10,2) GENERATED ALWAYS AS
        (sales_amount / NULLIF(sales_quantity, 0)) STORED
);
```

---

## 5. é€€åŒ–ç»´åº¦

**å®šä¹‰**: ç»´åº¦å±æ€§ç›´æ¥å­˜å‚¨åœ¨äº‹å®è¡¨ä¸­ï¼Œä¸å•ç‹¬åˆ›å»ºç»´åº¦è¡¨ã€‚

**é€‚ç”¨åœºæ™¯**:

- äº¤æ˜“ç¼–å·
- æ”¶æ®ç¼–å·
- è®¢å•ç¼–å·
- å‘ç¥¨ç¼–å·

**PostgreSQLå®ç°**:

```sql
-- é€€åŒ–ç»´åº¦ç¤ºä¾‹
CREATE TABLE fact_sales (
    sale_id BIGSERIAL PRIMARY KEY,
    -- ç»´åº¦é”®
    date_key INT NOT NULL REFERENCES dim_date(date_key),
    product_key INT NOT NULL REFERENCES dim_product(product_key),
    -- é€€åŒ–ç»´åº¦ï¼ˆç›´æ¥å­˜å‚¨åœ¨äº‹å®è¡¨ä¸­ï¼‰
    transaction_number VARCHAR(50),  -- äº¤æ˜“ç¼–å·
    receipt_number VARCHAR(50),      -- æ”¶æ®ç¼–å·
    -- åº¦é‡å€¼
    sales_amount NUMERIC(10,2) NOT NULL
);

-- ä¸ºé€€åŒ–ç»´åº¦åˆ›å»ºç´¢å¼•
CREATE INDEX idx_fact_sales_transaction_num ON fact_sales(transaction_number);
CREATE INDEX idx_fact_sales_receipt_num ON fact_sales(receipt_number);
```

---

## 6. PostgreSQLå®ç°

### 6.1 äº‹å®è¡¨åˆ†åŒºç­–ç•¥

```sql
-- æŒ‰æ—¥æœŸåˆ†åŒºï¼ˆæ¨èï¼‰
CREATE TABLE fact_sales (
    sale_id BIGSERIAL,
    date_key INT NOT NULL,
    ...
    PRIMARY KEY (sale_id, date_key)
) PARTITION BY RANGE (date_key);

-- åˆ›å»ºæœˆåº¦åˆ†åŒº
CREATE TABLE fact_sales_2024_01 PARTITION OF fact_sales
    FOR VALUES FROM (20240101) TO (20240201);
```

---

### 6.2 ç‰©åŒ–è§†å›¾ä¼˜åŒ–

```sql
-- åˆ›å»ºé¢„èšåˆç‰©åŒ–è§†å›¾
CREATE MATERIALIZED VIEW mv_sales_daily AS
SELECT
    date_key,
    product_key,
    SUM(sales_amount) AS daily_sales,
    SUM(sales_quantity) AS daily_quantity,
    COUNT(*) AS transaction_count
FROM fact_sales
GROUP BY date_key, product_key;

-- åˆ›å»ºç´¢å¼•
CREATE UNIQUE INDEX idx_mv_sales_daily_pk ON mv_sales_daily(date_key, product_key);

-- å®šæœŸåˆ·æ–°
REFRESH MATERIALIZED VIEW CONCURRENTLY mv_sales_daily;
```

---

## 7. ç›¸å…³èµ„æº

- [Kimballç»´åº¦å»ºæ¨¡](../02-æƒå¨èµ„æºä¸æ ‡å‡†/Kimballç»´åº¦å»ºæ¨¡.md) - äº‹å®è¡¨æŠ€æœ¯æ¥æº
- [ç»´åº¦å»ºæ¨¡åŸºç¡€](./ç»´åº¦å»ºæ¨¡åŸºç¡€.md) - ç»´åº¦å»ºæ¨¡åŸºç¡€
- [ç»´åº¦è¡¨æŠ€æœ¯](./ç»´åº¦è¡¨æŠ€æœ¯.md) - ç»´åº¦è¡¨è®¾è®¡æŠ€æœ¯
- [åˆ†åŒºç­–ç•¥](../08-PostgreSQLå»ºæ¨¡å®è·µ/åˆ†åŒºç­–ç•¥.md) - äº‹å®è¡¨åˆ†åŒºç­–ç•¥
- [ç´¢å¼•ç­–ç•¥](../08-PostgreSQLå»ºæ¨¡å®è·µ/ç´¢å¼•ç­–ç•¥.md) - äº‹å®è¡¨ç´¢å¼•ç­–ç•¥

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
