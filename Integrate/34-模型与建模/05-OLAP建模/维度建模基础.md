# OLAPç»´åº¦å»ºæ¨¡åŸºç¡€å®Œæ•´æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æ¥æº**: Kimballã€Šæ•°æ®ä»“åº“å·¥å…·ç®±ã€‹+ å®è·µæ€»ç»“
> **çŠ¶æ€**: åŸºäºæƒå¨èµ„æºæ·±åŒ–æ‰©å±•
> **æ–‡æ¡£ç¼–å·**: 05-01

---

## ğŸ“‘ ç›®å½•

- [1. æ¦‚è¿°](#1-æ¦‚è¿°)
- [2. ç»´åº¦å»ºæ¨¡æ ¸å¿ƒæ¦‚å¿µ](#2-ç»´åº¦å»ºæ¨¡æ ¸å¿ƒæ¦‚å¿µ)
  - [2.1 äº‹å®è¡¨ï¼ˆFact Tableï¼‰](#21-äº‹å®è¡¨fact-table)
  - [2.2 ç»´åº¦è¡¨ï¼ˆDimension Tableï¼‰](#22-ç»´åº¦è¡¨dimension-table)
- [3. æ˜Ÿå‹æ¨¡å¼ï¼ˆStar Schemaï¼‰](#3-æ˜Ÿå‹æ¨¡å¼star-schema)
- [4. é›ªèŠ±æ¨¡å¼ï¼ˆSnowflake Schemaï¼‰](#4-é›ªèŠ±æ¨¡å¼snowflake-schema)
- [5. æ˜Ÿå‹æ¨¡å¼ vs é›ªèŠ±æ¨¡å¼](#5-æ˜Ÿå‹æ¨¡å¼-vs-é›ªèŠ±æ¨¡å¼)
- [6. ç»´åº¦å»ºæ¨¡è®¾è®¡æ­¥éª¤](#6-ç»´åº¦å»ºæ¨¡è®¾è®¡æ­¥éª¤)
- [7. PostgreSQLå®ç°](#7-postgresqlå®ç°)
- [8. ç›¸å…³èµ„æº](#8-ç›¸å…³èµ„æº)

---

## 1. æ¦‚è¿°

ç»´åº¦å»ºæ¨¡ï¼ˆDimensional Modelingï¼‰æ˜¯æ•°æ®ä»“åº“è®¾è®¡çš„æ ¸å¿ƒæ–¹æ³•ï¼Œç”±Ralph Kimballæå‡ºã€‚ç»´åº¦å»ºæ¨¡ä»¥ä¸šåŠ¡éœ€æ±‚ä¸ºé©±åŠ¨ï¼Œé‡‡ç”¨æ˜Ÿå‹æ¨¡å¼è®¾è®¡ï¼Œå¼ºè°ƒæ˜“ç”¨æ€§å’ŒæŸ¥è¯¢æ€§èƒ½ï¼Œæ˜¯OLAPç³»ç»Ÿçš„ä¸»æµå»ºæ¨¡æ–¹æ³•ã€‚

---

## 2. ç»´åº¦å»ºæ¨¡æ ¸å¿ƒæ¦‚å¿µ

### 2.1 äº‹å®è¡¨ï¼ˆFact Tableï¼‰

**å®šä¹‰**: å­˜å‚¨ä¸šåŠ¡è¿‡ç¨‹çš„åº¦é‡å€¼ï¼ˆMeasureï¼‰ï¼Œæ˜¯æ˜Ÿå‹æ¨¡å¼çš„ä¸­å¿ƒã€‚

**ç‰¹ç‚¹**:

- åŒ…å«åº¦é‡å€¼ï¼ˆå¯åŠ ã€åŠå¯åŠ ã€ä¸å¯åŠ ï¼‰
- åŒ…å«å¤–é”®æŒ‡å‘ç»´åº¦è¡¨
- è¡Œæ•°é€šå¸¸å¾ˆå¤§ï¼ˆç™¾ä¸‡åˆ°æ•°åäº¿è¡Œï¼‰
- åˆ—æ•°ç›¸å¯¹è¾ƒå°‘ï¼ˆ10-20åˆ—ï¼‰

**åº¦é‡å€¼ç±»å‹**:

- **å¯åŠ åº¦é‡å€¼**: å¯ä»¥è·¨æ‰€æœ‰ç»´åº¦ç›¸åŠ ï¼ˆå¦‚é”€å”®é¢ã€æ•°é‡ï¼‰
- **åŠå¯åŠ åº¦é‡å€¼**: åªèƒ½è·¨éƒ¨åˆ†ç»´åº¦ç›¸åŠ ï¼ˆå¦‚è´¦æˆ·ä½™é¢ã€åº“å­˜ï¼‰
- **ä¸å¯åŠ åº¦é‡å€¼**: ä¸èƒ½ç›¸åŠ ï¼ˆå¦‚æ¯”ç‡ã€ç™¾åˆ†æ¯”ï¼‰

**ç¤ºä¾‹**:

```sql
-- é”€å”®äº‹å®è¡¨
CREATE TABLE fact_sales (
    sale_id BIGSERIAL PRIMARY KEY,
    -- å¤–é”®ï¼ˆç»´åº¦é”®ï¼‰
    date_key INT NOT NULL REFERENCES dim_date(date_key),
    product_key INT NOT NULL REFERENCES dim_product(product_key),
    customer_key INT NOT NULL REFERENCES dim_customer(customer_key),
    store_key INT NOT NULL REFERENCES dim_store(store_key),
    -- åº¦é‡å€¼
    sales_amount NUMERIC(10,2) NOT NULL,  -- å¯åŠ 
    sales_quantity INT NOT NULL,          -- å¯åŠ 
    discount_amount NUMERIC(10,2),        -- å¯åŠ 
    profit_margin NUMERIC(5,2)            -- ä¸å¯åŠ ï¼ˆæ¯”ç‡ï¼‰
);
```

---

### 2.2 ç»´åº¦è¡¨ï¼ˆDimension Tableï¼‰

**å®šä¹‰**: æè¿°ä¸šåŠ¡è¿‡ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œæä¾›æŸ¥è¯¢å’Œè¿‡æ»¤æ¡ä»¶ã€‚

**ç‰¹ç‚¹**:

- åŒ…å«æè¿°æ€§å±æ€§
- è¡Œæ•°ç›¸å¯¹è¾ƒå°‘ï¼ˆæ•°åƒåˆ°æ•°ç™¾ä¸‡è¡Œï¼‰
- åˆ—æ•°è¾ƒå¤šï¼ˆ10-100åˆ—ï¼‰
- é€šå¸¸å»èŒƒå¼åŒ–ï¼ˆDenormalizedï¼‰

**ç»´åº¦ç±»å‹**:

- **æ—¶é—´ç»´åº¦**: æ—¥æœŸã€æ—¶é—´å±‚æ¬¡ç»“æ„
- **äº§å“ç»´åº¦**: äº§å“å±æ€§ã€åˆ†ç±»
- **å®¢æˆ·ç»´åº¦**: å®¢æˆ·å±æ€§ã€åœ°ç†ä¿¡æ¯
- **å•†åº—ç»´åº¦**: å•†åº—å±æ€§ã€ä½ç½®ä¿¡æ¯

**ç¤ºä¾‹**:

```sql
-- äº§å“ç»´åº¦è¡¨
CREATE TABLE dim_product (
    product_key SERIAL PRIMARY KEY,
    product_id INT NOT NULL,  -- ä¸šåŠ¡é”®
    product_name VARCHAR(200) NOT NULL,
    category_name VARCHAR(100),  -- å»èŒƒå¼åŒ–
    brand_name VARCHAR(100),     -- å»èŒƒå¼åŒ–
    unit_price NUMERIC(10,2),
    is_active BOOLEAN DEFAULT TRUE,
    valid_from DATE NOT NULL,
    valid_to DATE,
    -- SCD Type 2å­—æ®µ
    is_current BOOLEAN DEFAULT TRUE,
    version_number INT DEFAULT 1
);

-- æ—¶é—´ç»´åº¦è¡¨
CREATE TABLE dim_date (
    date_key INT PRIMARY KEY,  -- YYYYMMDDæ ¼å¼
    date_actual DATE NOT NULL UNIQUE,
    day_name VARCHAR(10),
    day_of_week INT,
    day_of_month INT,
    day_of_year INT,
    week_of_year INT,
    month_name VARCHAR(10),
    month_number INT,
    quarter_number INT,
    year_number INT,
    is_weekend BOOLEAN,
    is_holiday BOOLEAN,
    holiday_name VARCHAR(50)
);
```

---

## 3. æ˜Ÿå‹æ¨¡å¼ï¼ˆStar Schemaï¼‰

**å®šä¹‰**: ä¸€ä¸ªäº‹å®è¡¨è¢«å¤šä¸ªç»´åº¦è¡¨å›´ç»•ï¼Œå½¢ä¼¼æ˜Ÿå‹ã€‚

**ç‰¹ç‚¹**:

- ç»´åº¦è¡¨å»èŒƒå¼åŒ–
- æŸ¥è¯¢æ€§èƒ½å¥½ï¼ˆJOINå°‘ï¼‰
- æ˜“äºç†è§£å’Œä½¿ç”¨
- é€‚åˆOLAPæŸ¥è¯¢

**ç¤ºä¾‹**:

```sql
-- æ˜Ÿå‹æ¨¡å¼ç¤ºä¾‹
-- äº‹å®è¡¨ï¼šé”€å”®äº‹å®
CREATE TABLE fact_sales (
    sale_id BIGSERIAL PRIMARY KEY,
    date_key INT NOT NULL REFERENCES dim_date(date_key),
    product_key INT NOT NULL REFERENCES dim_product(product_key),
    customer_key INT NOT NULL REFERENCES dim_customer(customer_key),
    store_key INT NOT NULL REFERENCES dim_store(store_key),
    sales_amount NUMERIC(10,2) NOT NULL,
    sales_quantity INT NOT NULL
);

-- ç»´åº¦è¡¨ï¼šæ—¥æœŸç»´åº¦
CREATE TABLE dim_date (
    date_key INT PRIMARY KEY,
    date_actual DATE NOT NULL,
    day_name VARCHAR(10),
    month_name VARCHAR(10),
    quarter_number INT,
    year_number INT
);

-- ç»´åº¦è¡¨ï¼šäº§å“ç»´åº¦
CREATE TABLE dim_product (
    product_key SERIAL PRIMARY KEY,
    product_id INT NOT NULL,
    product_name VARCHAR(200),
    category_name VARCHAR(100),  -- å»èŒƒå¼åŒ–
    brand_name VARCHAR(100)     -- å»èŒƒå¼åŒ–
);

-- ç»´åº¦è¡¨ï¼šå®¢æˆ·ç»´åº¦
CREATE TABLE dim_customer (
    customer_key SERIAL PRIMARY KEY,
    customer_id INT NOT NULL,
    customer_name VARCHAR(100),
    city_name VARCHAR(50),      -- å»èŒƒå¼åŒ–
    state_name VARCHAR(50),     -- å»èŒƒå¼åŒ–
    country_name VARCHAR(50)    -- å»èŒƒå¼åŒ–
);

-- ç»´åº¦è¡¨ï¼šå•†åº—ç»´åº¦
CREATE TABLE dim_store (
    store_key SERIAL PRIMARY KEY,
    store_id INT NOT NULL,
    store_name VARCHAR(100),
    city_name VARCHAR(50),      -- å»èŒƒå¼åŒ–
    region_name VARCHAR(50)     -- å»èŒƒå¼åŒ–
);
```

**æŸ¥è¯¢ç¤ºä¾‹**:

```sql
-- æ˜Ÿå‹æ¨¡å¼æŸ¥è¯¢ï¼ˆç®€å•JOINï¼‰
SELECT
    d.year_number,
    d.month_name,
    p.category_name,
    SUM(f.sales_amount) AS total_sales,
    SUM(f.sales_quantity) AS total_quantity
FROM fact_sales f
JOIN dim_date d ON f.date_key = d.date_key
JOIN dim_product p ON f.product_key = p.product_key
WHERE d.year_number = 2024
GROUP BY d.year_number, d.month_name, p.category_name
ORDER BY d.year_number, d.month_name, p.category_name;
```

---

## 4. é›ªèŠ±æ¨¡å¼ï¼ˆSnowflake Schemaï¼‰

**å®šä¹‰**: ç»´åº¦è¡¨è¿›ä¸€æ­¥è§„èŒƒåŒ–ï¼Œå½¢æˆå±‚æ¬¡ç»“æ„ï¼Œå½¢ä¼¼é›ªèŠ±ã€‚

**ç‰¹ç‚¹**:

- ç»´åº¦è¡¨è§„èŒƒåŒ–
- å‡å°‘æ•°æ®å†—ä½™
- JOINæ•°é‡å¢åŠ 
- æŸ¥è¯¢æ€§èƒ½ç•¥å·®

**ç¤ºä¾‹**:

```sql
-- é›ªèŠ±æ¨¡å¼ç¤ºä¾‹
-- äº§å“ç»´åº¦è¡¨ï¼ˆè§„èŒƒåŒ–ï¼‰
CREATE TABLE dim_product (
    product_key SERIAL PRIMARY KEY,
    product_id INT NOT NULL,
    product_name VARCHAR(200),
    category_key INT NOT NULL REFERENCES dim_category(category_key),
    brand_key INT NOT NULL REFERENCES dim_brand(brand_key)
);

-- äº§å“åˆ†ç±»ç»´åº¦è¡¨
CREATE TABLE dim_category (
    category_key SERIAL PRIMARY KEY,
    category_id INT NOT NULL,
    category_name VARCHAR(100),
    department_key INT NOT NULL REFERENCES dim_department(department_key)
);

-- éƒ¨é—¨ç»´åº¦è¡¨
CREATE TABLE dim_department (
    department_key SERIAL PRIMARY KEY,
    department_id INT NOT NULL,
    department_name VARCHAR(100)
);

-- å“ç‰Œç»´åº¦è¡¨
CREATE TABLE dim_brand (
    brand_key SERIAL PRIMARY KEY,
    brand_id INT NOT NULL,
    brand_name VARCHAR(100),
    manufacturer_key INT NOT NULL REFERENCES dim_manufacturer(manufacturer_key)
);

-- åˆ¶é€ å•†ç»´åº¦è¡¨
CREATE TABLE dim_manufacturer (
    manufacturer_key SERIAL PRIMARY KEY,
    manufacturer_id INT NOT NULL,
    manufacturer_name VARCHAR(100)
);
```

**æŸ¥è¯¢ç¤ºä¾‹**:

```sql
-- é›ªèŠ±æ¨¡å¼æŸ¥è¯¢ï¼ˆå¤šçº§JOINï¼‰
SELECT
    d.year_number,
    dept.department_name,
    cat.category_name,
    SUM(f.sales_amount) AS total_sales
FROM fact_sales f
JOIN dim_date d ON f.date_key = d.date_key
JOIN dim_product p ON f.product_key = p.product_key
JOIN dim_category cat ON p.category_key = cat.category_key
JOIN dim_department dept ON cat.department_key = dept.department_key
WHERE d.year_number = 2024
GROUP BY d.year_number, dept.department_name, cat.category_name;
```

---

## 5. æ˜Ÿå‹æ¨¡å¼ vs é›ªèŠ±æ¨¡å¼

### 5.1 å¯¹æ¯”çŸ©é˜µ

| ç»´åº¦ | æ˜Ÿå‹æ¨¡å¼ | é›ªèŠ±æ¨¡å¼ |
|------|---------|---------|
| **æ•°æ®å†—ä½™** | é«˜ï¼ˆå»èŒƒå¼åŒ–ï¼‰ | ä½ï¼ˆè§„èŒƒåŒ–ï¼‰ |
| **JOINæ•°é‡** | å°‘ï¼ˆ1çº§JOINï¼‰ | å¤šï¼ˆå¤šçº§JOINï¼‰ |
| **æŸ¥è¯¢æ€§èƒ½** | å¿« | è¾ƒæ…¢ |
| **å­˜å‚¨ç©ºé—´** | å¤§ | å° |
| **ç»´æŠ¤å¤æ‚åº¦** | ä½ | é«˜ |
| **æ˜“ç”¨æ€§** | é«˜ | ä½ |
| **é€‚ç”¨åœºæ™¯** | OLAPæŸ¥è¯¢ | æ•°æ®è§„èŒƒåŒ–è¦æ±‚é«˜ |

---

### 5.2 é€‰æ‹©å»ºè®®

**ä½¿ç”¨æ˜Ÿå‹æ¨¡å¼**:

- âœ… OLAPæŸ¥è¯¢ä¸ºä¸»
- âœ… æŸ¥è¯¢æ€§èƒ½ä¼˜å…ˆ
- âœ… ç»´åº¦è¡¨å˜åŒ–ä¸é¢‘ç¹
- âœ… å­˜å‚¨æˆæœ¬å¯æ¥å—

**ä½¿ç”¨é›ªèŠ±æ¨¡å¼**:

- âœ… æ•°æ®è§„èŒƒåŒ–è¦æ±‚é«˜
- âœ… ç»´åº¦è¡¨å±‚æ¬¡ç»“æ„å¤æ‚
- âœ… å­˜å‚¨ç©ºé—´æœ‰é™
- âœ… ç»´åº¦è¡¨æ›´æ–°é¢‘ç¹

---

## 6. ç»´åº¦å»ºæ¨¡è®¾è®¡æ­¥éª¤

### 6.1 Kimballçš„å››ä¸ªå…³é”®å†³ç­–

**1. ä¸šåŠ¡è¿‡ç¨‹ï¼ˆBusiness Processï¼‰**:

- è¯†åˆ«æ ¸å¿ƒä¸šåŠ¡æ´»åŠ¨
- å¦‚ï¼šé”€å”®ã€è®¢å•ã€æ”¯ä»˜ã€å‘è´§

**2. ç²’åº¦ï¼ˆGrainï¼‰**:

- å®šä¹‰äº‹å®è¡¨çš„è¯¦ç»†ç¨‹åº¦
- å¦‚ï¼šæ¯ä¸ªè®¢å•è¡Œã€æ¯ä¸ªäº¤æ˜“ã€æ¯å¤©æ±‡æ€»

**3. ç»´åº¦ï¼ˆDimensionsï¼‰**:

- æè¿°ä¸šåŠ¡è¿‡ç¨‹çš„ä¸Šä¸‹æ–‡
- å¦‚ï¼šæ—¶é—´ã€äº§å“ã€å®¢æˆ·ã€å•†åº—

**4. äº‹å®ï¼ˆFactsï¼‰**:

- ä¸šåŠ¡è¿‡ç¨‹çš„åº¦é‡å€¼
- å¦‚ï¼šé”€å”®é¢ã€æ•°é‡ã€æˆæœ¬

---

### 6.2 è®¾è®¡æ­¥éª¤

**æ­¥éª¤1: é€‰æ‹©ä¸šåŠ¡è¿‡ç¨‹**:

```sql
-- ä¸šåŠ¡è¿‡ç¨‹ï¼šé”€å”®äº¤æ˜“
-- ç²’åº¦ï¼šæ¯ä¸ªé”€å”®äº¤æ˜“è¡Œ
```

**æ­¥éª¤2: å£°æ˜ç²’åº¦**:

```sql
-- ç²’åº¦å£°æ˜ï¼šæ¯ä¸ªè®¢å•è¡Œçš„æ¯ä¸ªäº§å“
-- æ„å‘³ç€ï¼šä¸€ä¸ªè®¢å•å¯ä»¥æœ‰å¤šä¸ªäº‹å®è¡Œ
```

**æ­¥éª¤3: è¯†åˆ«ç»´åº¦**:

```sql
-- ç»´åº¦ï¼š
-- - æ—¥æœŸï¼ˆè®¢å•æ—¥æœŸï¼‰
-- - äº§å“ï¼ˆäº§å“IDï¼‰
-- - å®¢æˆ·ï¼ˆå®¢æˆ·IDï¼‰
-- - å•†åº—ï¼ˆå•†åº—IDï¼‰
-- - ä¿ƒé”€ï¼ˆä¿ƒé”€IDï¼Œå¯é€‰ï¼‰
```

**æ­¥éª¤4: è¯†åˆ«äº‹å®**:

```sql
-- äº‹å®ï¼ˆåº¦é‡å€¼ï¼‰ï¼š
-- - é”€å”®é‡‘é¢ï¼ˆå¯åŠ ï¼‰
-- - é”€å”®æ•°é‡ï¼ˆå¯åŠ ï¼‰
-- - æŠ˜æ‰£é‡‘é¢ï¼ˆå¯åŠ ï¼‰
-- - åˆ©æ¶¦ç‡ï¼ˆä¸å¯åŠ ï¼‰
```

---

## 7. PostgreSQLå®ç°

### 7.1 äº‹å®è¡¨è®¾è®¡

```sql
-- é”€å”®äº‹å®è¡¨
CREATE TABLE fact_sales (
    sale_id BIGSERIAL PRIMARY KEY,
    -- ç»´åº¦é”®
    date_key INT NOT NULL REFERENCES dim_date(date_key),
    product_key INT NOT NULL REFERENCES dim_product(product_key),
    customer_key INT NOT NULL REFERENCES dim_customer(customer_key),
    store_key INT NOT NULL REFERENCES dim_store(store_key),
    promotion_key INT REFERENCES dim_promotion(promotion_key),
    -- åº¦é‡å€¼
    sales_amount NUMERIC(10,2) NOT NULL,
    sales_quantity INT NOT NULL,
    discount_amount NUMERIC(10,2) DEFAULT 0,
    cost_amount NUMERIC(10,2),
    profit_amount NUMERIC(10,2) GENERATED ALWAYS AS (sales_amount - cost_amount) STORED,
    -- å…ƒæ•°æ®
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_fact_sales_date ON fact_sales(date_key);
CREATE INDEX idx_fact_sales_product ON fact_sales(product_key);
CREATE INDEX idx_fact_sales_customer ON fact_sales(customer_key);
CREATE INDEX idx_fact_sales_store ON fact_sales(store_key);

-- å¤åˆç´¢å¼•ï¼ˆå¸¸ç”¨æŸ¥è¯¢ç»„åˆï¼‰
CREATE INDEX idx_fact_sales_date_product ON fact_sales(date_key, product_key);
```

---

### 7.2 ç»´åº¦è¡¨è®¾è®¡

```sql
-- æ—¶é—´ç»´åº¦è¡¨ï¼ˆé¢„å¡«å……ï¼‰
CREATE TABLE dim_date (
    date_key INT PRIMARY KEY,  -- YYYYMMDD
    date_actual DATE NOT NULL UNIQUE,
    day_name VARCHAR(10),
    day_of_week INT,
    day_of_month INT,
    day_of_year INT,
    week_of_year INT,
    month_name VARCHAR(10),
    month_number INT,
    quarter_number INT,
    year_number INT,
    is_weekend BOOLEAN,
    is_holiday BOOLEAN,
    holiday_name VARCHAR(50)
);

-- å¡«å……æ—¶é—´ç»´åº¦ï¼ˆ2020-2030ï¼‰
CREATE OR REPLACE FUNCTION populate_date_dimension()
RETURNS VOID AS $$
DECLARE
    current_date DATE := '2020-01-01';
    end_date DATE := '2030-12-31';
BEGIN
    WHILE current_date <= end_date LOOP
        INSERT INTO dim_date (
            date_key, date_actual, day_name, day_of_week,
            day_of_month, day_of_year, week_of_year,
            month_name, month_number, quarter_number, year_number,
            is_weekend, is_holiday
        ) VALUES (
            TO_CHAR(current_date, 'YYYYMMDD')::INT,
            current_date,
            TO_CHAR(current_date, 'Day'),
            EXTRACT(DOW FROM current_date),
            EXTRACT(DAY FROM current_date),
            EXTRACT(DOY FROM current_date),
            EXTRACT(WEEK FROM current_date),
            TO_CHAR(current_date, 'Month'),
            EXTRACT(MONTH FROM current_date),
            EXTRACT(QUARTER FROM current_date),
            EXTRACT(YEAR FROM current_date),
            EXTRACT(DOW FROM current_date) IN (0, 6),
            FALSE
        )
        ON CONFLICT (date_key) DO NOTHING;

        current_date := current_date + INTERVAL '1 day';
    END LOOP;
END;
$$ LANGUAGE plpgsql;

SELECT populate_date_dimension();
```

---

### 7.3 ç‰©åŒ–è§†å›¾ä¼˜åŒ–

```sql
-- åˆ›å»ºç‰©åŒ–è§†å›¾ï¼ˆé¢„èšåˆï¼‰
CREATE MATERIALIZED VIEW mv_sales_monthly AS
SELECT
    d.year_number,
    d.month_number,
    p.category_name,
    SUM(f.sales_amount) AS total_sales,
    SUM(f.sales_quantity) AS total_quantity,
    COUNT(*) AS transaction_count
FROM fact_sales f
JOIN dim_date d ON f.date_key = d.date_key
JOIN dim_product p ON f.product_key = p.product_key
GROUP BY d.year_number, d.month_number, p.category_name;

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_mv_sales_monthly_date ON mv_sales_monthly(year_number, month_number);
CREATE INDEX idx_mv_sales_monthly_category ON mv_sales_monthly(category_name);

-- å®šæœŸåˆ·æ–°
REFRESH MATERIALIZED VIEW CONCURRENTLY mv_sales_monthly;
```

---

## 8. ç›¸å…³èµ„æº

- [Kimballç»´åº¦å»ºæ¨¡](../02-æƒå¨èµ„æºä¸æ ‡å‡†/Kimballç»´åº¦å»ºæ¨¡.md) - ç»´åº¦å»ºæ¨¡æƒå¨æŒ‡å—
- [äº‹å®è¡¨æŠ€æœ¯](./äº‹å®è¡¨æŠ€æœ¯.md) - äº‹å®è¡¨è®¾è®¡æŠ€æœ¯
- [ç»´åº¦è¡¨æŠ€æœ¯](./ç»´åº¦è¡¨æŠ€æœ¯.md) - ç»´åº¦è¡¨è®¾è®¡æŠ€æœ¯
- [ç´¢å¼•ç­–ç•¥](../08-PostgreSQLå»ºæ¨¡å®è·µ/ç´¢å¼•ç­–ç•¥.md) - ç»´åº¦è¡¨ç´¢å¼•ç­–ç•¥
- [åˆ†åŒºç­–ç•¥](../08-PostgreSQLå»ºæ¨¡å®è·µ/åˆ†åŒºç­–ç•¥.md) - äº‹å®è¡¨åˆ†åŒºç­–ç•¥

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
