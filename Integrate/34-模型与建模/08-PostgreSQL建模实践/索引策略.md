# PostgreSQLç´¢å¼•ç­–ç•¥å®Œæ•´æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æ¥æº**: PostgreSQLå®˜æ–¹æ–‡æ¡£ + å®è·µæ€»ç»“
> **çŠ¶æ€**: åŸºäºPostgreSQL 17+/18+ç‰¹æ€§
> **æ–‡æ¡£ç¼–å·**: 08-02

---

## ğŸ“‘ ç›®å½•

- [PostgreSQLç´¢å¼•ç­–ç•¥å®Œæ•´æŒ‡å—](#postgresqlç´¢å¼•ç­–ç•¥å®Œæ•´æŒ‡å—)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
  - [1.1 ç†è®ºåŸºç¡€](#11-ç†è®ºåŸºç¡€)
    - [1.1.1 ç´¢å¼•åŸºæœ¬æ¦‚å¿µ](#111-ç´¢å¼•åŸºæœ¬æ¦‚å¿µ)
    - [1.1.2 B-Treeç´¢å¼•ç†è®º](#112-b-treeç´¢å¼•ç†è®º)
    - [1.1.3 GINç´¢å¼•ç†è®º](#113-ginç´¢å¼•ç†è®º)
    - [1.1.4 GISTç´¢å¼•ç†è®º](#114-gistç´¢å¼•ç†è®º)
    - [1.1.5 BRINç´¢å¼•ç†è®º](#115-brinç´¢å¼•ç†è®º)
    - [1.1.6 ç´¢å¼•é€‰æ‹©ç†è®º](#116-ç´¢å¼•é€‰æ‹©ç†è®º)
    - [1.1.7 å¤æ‚åº¦åˆ†æ](#117-å¤æ‚åº¦åˆ†æ)
  - [2. ç´¢å¼•ç±»å‹](#2-ç´¢å¼•ç±»å‹)
    - [2.1 B-Treeç´¢å¼•](#21-b-treeç´¢å¼•)
    - [2.2 GINç´¢å¼•](#22-ginç´¢å¼•)
    - [2.3 GISTç´¢å¼•](#23-gistç´¢å¼•)
    - [2.4 BRINç´¢å¼•](#24-brinç´¢å¼•)
    - [2.5 SP-GISTç´¢å¼•](#25-sp-gistç´¢å¼•)
    - [2.6 Hashç´¢å¼•](#26-hashç´¢å¼•)
  - [3. ç´¢å¼•é€‰æ‹©å†³ç­–](#3-ç´¢å¼•é€‰æ‹©å†³ç­–)
    - [3.1 ç´¢å¼•é€‰æ‹©å†³ç­–æ ‘](#31-ç´¢å¼•é€‰æ‹©å†³ç­–æ ‘)
    - [3.2 ç´¢å¼•ç±»å‹å¯¹æ¯”çŸ©é˜µ](#32-ç´¢å¼•ç±»å‹å¯¹æ¯”çŸ©é˜µ)
  - [4. ç´¢å¼•è®¾è®¡æœ€ä½³å®è·µ](#4-ç´¢å¼•è®¾è®¡æœ€ä½³å®è·µ)
    - [4.1 ç´¢å¼•è®¾è®¡åŸåˆ™](#41-ç´¢å¼•è®¾è®¡åŸåˆ™)
    - [4.2 ç´¢å¼•å‘½åè§„èŒƒ](#42-ç´¢å¼•å‘½åè§„èŒƒ)
  - [5. ç´¢å¼•ç»´æŠ¤ä¸ä¼˜åŒ–](#5-ç´¢å¼•ç»´æŠ¤ä¸ä¼˜åŒ–)
    - [5.1 ç´¢å¼•ç»´æŠ¤](#51-ç´¢å¼•ç»´æŠ¤)
    - [5.2 ç´¢å¼•ä¼˜åŒ–ç­–ç•¥](#52-ç´¢å¼•ä¼˜åŒ–ç­–ç•¥)
  - [6. å¸¸è§ç´¢å¼•æ¨¡å¼](#6-å¸¸è§ç´¢å¼•æ¨¡å¼)
    - [6.1 æ—¶é—´åºåˆ—ç´¢å¼•æ¨¡å¼](#61-æ—¶é—´åºåˆ—ç´¢å¼•æ¨¡å¼)
    - [6.2 JSONBç´¢å¼•æ¨¡å¼](#62-jsonbç´¢å¼•æ¨¡å¼)
    - [6.3 å…¨æ–‡æœç´¢ç´¢å¼•æ¨¡å¼](#63-å…¨æ–‡æœç´¢ç´¢å¼•æ¨¡å¼)
  - [7. ç´¢å¼•æ€§èƒ½è°ƒä¼˜](#7-ç´¢å¼•æ€§èƒ½è°ƒä¼˜)
    - [7.1 ç´¢å¼•å‚æ•°è°ƒä¼˜](#71-ç´¢å¼•å‚æ•°è°ƒä¼˜)
    - [7.2 æŸ¥è¯¢è®¡åˆ’åˆ†æ](#72-æŸ¥è¯¢è®¡åˆ’åˆ†æ)
  - [8. ç´¢å¼•ç›‘æ§å’Œè¯Šæ–­ / Index Monitoring and Diagnostics](#8-ç´¢å¼•ç›‘æ§å’Œè¯Šæ–­--index-monitoring-and-diagnostics)
    - [8.1 ç´¢å¼•ä½¿ç”¨æƒ…å†µç›‘æ§](#81-ç´¢å¼•ä½¿ç”¨æƒ…å†µç›‘æ§)
    - [8.2 ç´¢å¼•è†¨èƒ€ç›‘æ§](#82-ç´¢å¼•è†¨èƒ€ç›‘æ§)
    - [8.3 ç´¢å¼•æ•ˆç‡åˆ†æ](#83-ç´¢å¼•æ•ˆç‡åˆ†æ)
  - [9. ç´¢å¼•æ€§èƒ½åˆ†æ / Index Performance Analysis](#9-ç´¢å¼•æ€§èƒ½åˆ†æ--index-performance-analysis)
    - [9.1 ç´¢å¼•åˆ›å»ºæ€§èƒ½](#91-ç´¢å¼•åˆ›å»ºæ€§èƒ½)
    - [9.2 ç´¢å¼•æŸ¥è¯¢æ€§èƒ½å¯¹æ¯”](#92-ç´¢å¼•æŸ¥è¯¢æ€§èƒ½å¯¹æ¯”)
    - [9.3 ç´¢å¼•ç»´æŠ¤æ€§èƒ½](#93-ç´¢å¼•ç»´æŠ¤æ€§èƒ½)
  - [10. æ›´å¤šå®é™…æ¡ˆä¾‹ / More Practical Examples](#10-æ›´å¤šå®é™…æ¡ˆä¾‹--more-practical-examples)
    - [10.1 æ¡ˆä¾‹4: ç”µå•†æœç´¢ç³»ç»Ÿ](#101-æ¡ˆä¾‹4-ç”µå•†æœç´¢ç³»ç»Ÿ)
    - [10.2 æ¡ˆä¾‹5: ç¤¾äº¤ç½‘ç»œç³»ç»Ÿ](#102-æ¡ˆä¾‹5-ç¤¾äº¤ç½‘ç»œç³»ç»Ÿ)
    - [10.3 æ¡ˆä¾‹6: æ—¥å¿—åˆ†æç³»ç»Ÿ](#103-æ¡ˆä¾‹6-æ—¥å¿—åˆ†æç³»ç»Ÿ)
    - [10.4 æ¡ˆä¾‹7: åœ°ç†ä½ç½®æœåŠ¡](#104-æ¡ˆä¾‹7-åœ°ç†ä½ç½®æœåŠ¡)
  - [11. ç´¢å¼•æ•…éšœæ’æŸ¥æŒ‡å— / Index Troubleshooting Guide](#11-ç´¢å¼•æ•…éšœæ’æŸ¥æŒ‡å—--index-troubleshooting-guide)
    - [11.1 ç´¢å¼•æœªä½¿ç”¨é—®é¢˜è¯Šæ–­](#111-ç´¢å¼•æœªä½¿ç”¨é—®é¢˜è¯Šæ–­)
    - [11.2 ç´¢å¼•è†¨èƒ€é—®é¢˜è¯Šæ–­](#112-ç´¢å¼•è†¨èƒ€é—®é¢˜è¯Šæ–­)
    - [11.3 ç´¢å¼•åˆ›å»ºå¤±è´¥é—®é¢˜è¯Šæ–­](#113-ç´¢å¼•åˆ›å»ºå¤±è´¥é—®é¢˜è¯Šæ–­)
    - [11.4 ç´¢å¼•æ€§èƒ½é—®é¢˜è¯Šæ–­æ£€æŸ¥æ¸…å•](#114-ç´¢å¼•æ€§èƒ½é—®é¢˜è¯Šæ–­æ£€æŸ¥æ¸…å•)
  - [12. å¸¸è§é—®é¢˜è§£ç­” / FAQ](#12-å¸¸è§é—®é¢˜è§£ç­”--faq)
    - [Q1: ä»€ä¹ˆæ—¶å€™åº”è¯¥åˆ›å»ºç´¢å¼•ï¼Ÿ](#q1-ä»€ä¹ˆæ—¶å€™åº”è¯¥åˆ›å»ºç´¢å¼•)
    - [Q2: å¤åˆç´¢å¼•çš„åˆ—é¡ºåºå¦‚ä½•é€‰æ‹©ï¼Ÿ](#q2-å¤åˆç´¢å¼•çš„åˆ—é¡ºåºå¦‚ä½•é€‰æ‹©)
    - [Q3: éƒ¨åˆ†ç´¢å¼•ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ï¼Ÿ](#q3-éƒ¨åˆ†ç´¢å¼•ä»€ä¹ˆæ—¶å€™ä½¿ç”¨)
    - [Q4: GINç´¢å¼•å’ŒGISTç´¢å¼•å¦‚ä½•é€‰æ‹©ï¼Ÿ](#q4-ginç´¢å¼•å’Œgistç´¢å¼•å¦‚ä½•é€‰æ‹©)
    - [Q5: BRINç´¢å¼•ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ï¼Ÿ](#q5-brinç´¢å¼•ä»€ä¹ˆæ—¶å€™ä½¿ç”¨)
    - [Q6: ç´¢å¼•ä¼šå½±å“INSERTæ€§èƒ½å—ï¼Ÿ](#q6-ç´¢å¼•ä¼šå½±å“insertæ€§èƒ½å—)
    - [Q7: å¦‚ä½•åˆ¤æ–­ç´¢å¼•æ˜¯å¦è¢«ä½¿ç”¨ï¼Ÿ](#q7-å¦‚ä½•åˆ¤æ–­ç´¢å¼•æ˜¯å¦è¢«ä½¿ç”¨)
    - [Q8: ç´¢å¼•å¯ä»¥è·¨è¡¨å—ï¼Ÿ](#q8-ç´¢å¼•å¯ä»¥è·¨è¡¨å—)
    - [Q9: å¦‚ä½•ä¼˜åŒ–ç´¢å¼•å¤§å°ï¼Ÿ](#q9-å¦‚ä½•ä¼˜åŒ–ç´¢å¼•å¤§å°)
    - [Q10: ç´¢å¼•ç»´æŠ¤çš„æœ€ä½³å®è·µï¼Ÿ](#q10-ç´¢å¼•ç»´æŠ¤çš„æœ€ä½³å®è·µ)
  - [13. PostgreSQL 18ç´¢å¼•å¢å¼º / PostgreSQL 18 Index Enhancements](#13-postgresql-18ç´¢å¼•å¢å¼º--postgresql-18-index-enhancements)
    - [13.1 B-Treeç´¢å¼•æ€§èƒ½æ”¹è¿›](#131-b-treeç´¢å¼•æ€§èƒ½æ”¹è¿›)
    - [13.2 REINDEX CONCURRENTLYæ”¹è¿›](#132-reindex-concurrentlyæ”¹è¿›)
    - [13.3 GINç´¢å¼•å¹¶è¡Œæ„å»º â­](#133-ginç´¢å¼•å¹¶è¡Œæ„å»º-)
    - [13.4 ç´¢å¼•åˆ›å»ºè¿›åº¦ç›‘æ§](#134-ç´¢å¼•åˆ›å»ºè¿›åº¦ç›‘æ§)
  - [14. ç›¸å…³èµ„æº / Related Resources](#14-ç›¸å…³èµ„æº--related-resources)
    - [11.1 æ ¸å¿ƒç›¸å…³æ–‡æ¡£ / Core Related Documents](#111-æ ¸å¿ƒç›¸å…³æ–‡æ¡£--core-related-documents)
    - [11.2 ç†è®ºåŸºç¡€ / Theoretical Foundation](#112-ç†è®ºåŸºç¡€--theoretical-foundation)
    - [11.3 å®è·µæŒ‡å— / Practical Guides](#113-å®è·µæŒ‡å—--practical-guides)
    - [11.4 åº”ç”¨æ¡ˆä¾‹ / Application Cases](#114-åº”ç”¨æ¡ˆä¾‹--application-cases)
    - [11.5 å‚è€ƒèµ„æº / Reference Resources](#115-å‚è€ƒèµ„æº--reference-resources)

---

## 1. æ¦‚è¿°

PostgreSQLæä¾›äº†5ç§ä¸»è¦ç´¢å¼•ç±»å‹ï¼ˆB-Treeã€GINã€GISTã€BRINã€SP-GISTï¼‰ï¼Œæ¯ç§ç´¢å¼•ç±»å‹é’ˆå¯¹ä¸åŒçš„æŸ¥è¯¢æ¨¡å¼å’Œæ•°æ®ç‰¹æ€§ä¼˜åŒ–ã€‚
æ­£ç¡®é€‰æ‹©å’Œä½¿ç”¨ç´¢å¼•æ˜¯PostgreSQLæ€§èƒ½ä¼˜åŒ–çš„å…³é”®ã€‚

---

## 1.1 ç†è®ºåŸºç¡€

### 1.1.1 ç´¢å¼•åŸºæœ¬æ¦‚å¿µ

**ç´¢å¼•ï¼ˆIndexï¼‰**æ˜¯æ•°æ®åº“ä¸­ç”¨äºåŠ é€ŸæŸ¥è¯¢çš„æ•°æ®ç»“æ„ï¼š

- **ç›®çš„**: å‡å°‘æ•°æ®æ‰«æé‡ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½
- **ä»£ä»·**: å ç”¨å­˜å‚¨ç©ºé—´ï¼Œé™ä½å†™å…¥æ€§èƒ½
- **å¹³è¡¡**: åœ¨æŸ¥è¯¢æ€§èƒ½å’Œå†™å…¥æ€§èƒ½ä¹‹é—´å–å¾—å¹³è¡¡

**ç´¢å¼•å·¥ä½œåŸç†**:

1. **åˆ›å»ºç´¢å¼•**: æ ¹æ®ç´¢å¼•é”®å€¼æ„å»ºæ•°æ®ç»“æ„
2. **æŸ¥è¯¢ä¼˜åŒ–**: æŸ¥è¯¢ä¼˜åŒ–å™¨é€‰æ‹©ä½¿ç”¨ç´¢å¼•
3. **ç´¢å¼•æ‰«æ**: é€šè¿‡ç´¢å¼•å¿«é€Ÿå®šä½æ•°æ®
4. **å›è¡¨æŸ¥è¯¢**: æ ¹æ®ç´¢å¼•æŒ‡é’ˆè·å–å®Œæ•´æ•°æ®

### 1.1.2 B-Treeç´¢å¼•ç†è®º

**B-Treeï¼ˆBalanced Treeï¼‰**æ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„æ ‘å½¢æ•°æ®ç»“æ„ï¼š

**æ ‘ç»“æ„**:

- **æ ¹èŠ‚ç‚¹**: æ ‘çš„é¡¶å±‚èŠ‚ç‚¹
- **å†…éƒ¨èŠ‚ç‚¹**: ä¸­é—´å±‚èŠ‚ç‚¹
- **å¶å­èŠ‚ç‚¹**: æœ€åº•å±‚èŠ‚ç‚¹ï¼Œå­˜å‚¨å®é™…æ•°æ®æŒ‡é’ˆ

**å¹³è¡¡æ€§**:

- æ‰€æœ‰å¶å­èŠ‚ç‚¹åœ¨åŒä¸€å±‚
- èŠ‚ç‚¹åˆ†è£‚å’Œåˆå¹¶ä¿æŒå¹³è¡¡
- æŸ¥è¯¢å¤æ‚åº¦: $O(\log n)$

**æ•°å­¦ç‰¹æ€§**:

- **æ ‘é«˜åº¦**: $h = \lceil \log_m(n) \rceil$ where m is branching factor
- **èŠ‚ç‚¹æ•°é‡**: $n = m^h$
- **æŸ¥è¯¢å¤æ‚åº¦**: $O(\log n)$

### 1.1.3 GINç´¢å¼•ç†è®º

**GINï¼ˆGeneralized Inverted Indexï¼‰**æ˜¯å€’æ’ç´¢å¼•ï¼š

**å€’æ’ç´¢å¼•ç»“æ„**:

- **è¯é¡¹ï¼ˆTermï¼‰**: ç´¢å¼•çš„é”®å€¼
- **å€’æ’åˆ—è¡¨ï¼ˆPosting Listï¼‰**: åŒ…å«è¯¥è¯é¡¹çš„æ–‡æ¡£IDåˆ—è¡¨

**æ•°å­¦è¡¨ç¤º**:

- **å€’æ’ç´¢å¼•**: $I = \{t_i \rightarrow [d_1, d_2, ..., d_n]\}$
- **æŸ¥è¯¢**: $Q = \{t_1, t_2, ..., t_k\}$
- **ç»“æœ**: $R = \bigcap_{i=1}^{k} I(t_i)$

**å¤æ‚åº¦åˆ†æ**:

- **æ„å»ºå¤æ‚åº¦**: $O(N \times T)$ where N is documents, T is terms per document
- **æŸ¥è¯¢å¤æ‚åº¦**: $O(k \times \log T)$ where k is query terms

### 1.1.4 GISTç´¢å¼•ç†è®º

**GISTï¼ˆGeneralized Search Treeï¼‰**æ˜¯é€šç”¨æœç´¢æ ‘ï¼š

**ç©ºé—´åˆ†å‰²**:

- **R-Tree**: ç”¨äºç©ºé—´æ•°æ®
- **GiST**: å¯æ‰©å±•çš„æœç´¢æ ‘æ¡†æ¶

**ç©ºé—´æŸ¥è¯¢**:

- **èŒƒå›´æŸ¥è¯¢**: $Q = \{x | x \in R\}$
- **æœ€è¿‘é‚»æŸ¥è¯¢**: $Q = \arg\min_{x} d(x, q)$

### 1.1.5 BRINç´¢å¼•ç†è®º

**BRINï¼ˆBlock Range Indexï¼‰**æ˜¯å—èŒƒå›´ç´¢å¼•ï¼š

**å—èŒƒå›´**:

- **å—**: è¿ç»­çš„ç‰©ç†å­˜å‚¨å—
- **èŒƒå›´**: å—å†…æ•°æ®çš„æœ€å¤§å€¼å’Œæœ€å°å€¼

**å‰ªæåŸç†**:

- å¦‚æœæŸ¥è¯¢èŒƒå›´ä¸å—èŒƒå›´ä¸é‡å ï¼Œè·³è¿‡è¯¥å—
- å‡å°‘éœ€è¦æ‰«æçš„å—æ•°é‡

**å¤æ‚åº¦åˆ†æ**:

- **ç´¢å¼•å¤§å°**: $O(B)$ where B is number of blocks
- **æŸ¥è¯¢å¤æ‚åº¦**: $O(\log B)$

### 1.1.6 ç´¢å¼•é€‰æ‹©ç†è®º

**ç´¢å¼•é€‰æ‹©åŸåˆ™**:

1. **æŸ¥è¯¢æ¨¡å¼**: æ ¹æ®æŸ¥è¯¢æ¨¡å¼é€‰æ‹©ç´¢å¼•ç±»å‹
2. **æ•°æ®ç‰¹æ€§**: æ ¹æ®æ•°æ®ç‰¹æ€§é€‰æ‹©ç´¢å¼•ç±»å‹
3. **å†™å…¥é¢‘ç‡**: è€ƒè™‘å†™å…¥æ€§èƒ½å½±å“
4. **å­˜å‚¨æˆæœ¬**: è€ƒè™‘ç´¢å¼•å­˜å‚¨ç©ºé—´

**ç´¢å¼•é€‰æ‹©å†³ç­–æ ‘**:

- **ç­‰å€¼/èŒƒå›´æŸ¥è¯¢** â†’ B-Tree
- **æ•°ç»„/JSONBæŸ¥è¯¢** â†’ GIN
- **ç©ºé—´æŸ¥è¯¢** â†’ GIST
- **æ—¶åºæ•°æ®** â†’ BRIN
- **å…¨æ–‡æœç´¢** â†’ GIN

### 1.1.7 å¤æ‚åº¦åˆ†æ

**å­˜å‚¨å¤æ‚åº¦**:

- **B-Tree**: $O(N)$
- **GIN**: $O(N \times T)$ where T is average terms per document
- **GIST**: $O(N)$
- **BRIN**: $O(B)$ where B is number of blocks

**æŸ¥è¯¢å¤æ‚åº¦**:

- **B-Tree**: $O(\log N)$
- **GIN**: $O(k \times \log T)$
- **GIST**: $O(\log N)$
- **BRIN**: $O(\log B)$

---

## 2. ç´¢å¼•ç±»å‹

### 2.1 B-Treeç´¢å¼•

**å®šä¹‰**: æœ€å¸¸ç”¨çš„ç´¢å¼•ç±»å‹ï¼Œé€‚ç”¨äºå¤§å¤šæ•°æŸ¥è¯¢åœºæ™¯ã€‚

**ç‰¹ç‚¹**:

- æ”¯æŒç­‰å€¼æŸ¥è¯¢å’ŒèŒƒå›´æŸ¥è¯¢
- æ”¯æŒæ’åºï¼ˆORDER BYï¼‰
- æ”¯æŒå”¯ä¸€çº¦æŸ
- è‡ªåŠ¨åˆ›å»ºï¼ˆPRIMARY KEYã€UNIQUEçº¦æŸï¼‰

**æ—¶é—´å¤æ‚åº¦**: O(log n)

**å­˜å‚¨ç©ºé—´**: çº¦1.2Ã—æ•°æ®é‡

**é€‚ç”¨åœºæ™¯**:

- ç­‰å€¼æŸ¥è¯¢ï¼ˆWHERE column = valueï¼‰
- èŒƒå›´æŸ¥è¯¢ï¼ˆWHERE column BETWEEN ...ï¼‰
- æ’åºæŸ¥è¯¢ï¼ˆORDER BY columnï¼‰
- å”¯ä¸€æ€§çº¦æŸ

**PostgreSQLå®ç°**:

```sql
-- è‡ªåŠ¨åˆ›å»ºï¼ˆä¸»é”®ï¼Œå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_tables WHERE tablename = 'users') THEN
        CREATE TABLE users (
            user_id BIGSERIAL PRIMARY KEY,  -- è‡ªåŠ¨åˆ›å»ºB-Treeç´¢å¼•
            username VARCHAR(50) UNIQUE,     -- è‡ªåŠ¨åˆ›å»ºB-Treeç´¢å¼•
            email VARCHAR(100) UNIQUE,
            is_active BOOLEAN DEFAULT TRUE,
            created_at TIMESTAMPTZ DEFAULT NOW()
        );
        RAISE NOTICE 'è¡¨ users åˆ›å»ºæˆåŠŸ';
    ELSE
        RAISE NOTICE 'è¡¨ users å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º';
    END IF;
EXCEPTION
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºè¡¨ users å¤±è´¥: %', SQLERRM;
END $$;

-- æ‰‹åŠ¨åˆ›å»ºç´¢å¼•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);
    CREATE INDEX IF NOT EXISTS idx_users_created_at ON users(created_at);
    -- å¤åˆç´¢å¼•
    CREATE INDEX IF NOT EXISTS idx_users_name_email ON users(username, email);
    -- éƒ¨åˆ†ç´¢å¼•ï¼ˆä»…ç´¢å¼•æ»¡è¶³æ¡ä»¶çš„è¡Œï¼‰
    CREATE INDEX IF NOT EXISTS idx_active_users ON users(email) WHERE is_active = TRUE;
    -- è¡¨è¾¾å¼ç´¢å¼•
    CREATE INDEX IF NOT EXISTS idx_users_lower_email ON users(LOWER(email));
    -- æ’åºç´¢å¼•ï¼ˆæ”¯æŒDESCæ’åºï¼‰
    CREATE INDEX IF NOT EXISTS idx_users_created_desc ON users(created_at DESC);
    RAISE NOTICE 'ç´¢å¼•åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'åˆ›å»ºç´¢å¼•å¤±è´¥: %', SQLERRM;
END $$;

**æ€§èƒ½å¯¹æ¯”**:

```sql
-- æ— ç´¢å¼•ï¼šå…¨è¡¨æ‰«æ O(n)
EXPLAIN (ANALYZE, BUFFERS, TIMING) SELECT * FROM users WHERE email = 'test@example.com';
-- Seq Scan on users (cost=0.00..10000.00 rows=1 width=100)

-- æœ‰ç´¢å¼•ï¼šç´¢å¼•æ‰«æ O(log n)
EXPLAIN (ANALYZE, BUFFERS, TIMING) SELECT * FROM users WHERE email = 'test@example.com';
-- Index Scan using idx_users_email (cost=0.42..8.44 rows=1 width=100)
```

---

### 2.2 GINç´¢å¼•

**å®šä¹‰**: Generalized Inverted Indexï¼Œå€’æ’ç´¢å¼•ï¼Œé€‚ç”¨äºæ•°ç»„ã€JSONBã€å…¨æ–‡æœç´¢ã€‚

**ç‰¹ç‚¹**:

- æ”¯æŒæ•°ç»„åŒ…å«æŸ¥è¯¢ï¼ˆ@>ã€&&ï¼‰
- æ”¯æŒJSONBè·¯å¾„æŸ¥è¯¢
- æ”¯æŒå…¨æ–‡æœç´¢ï¼ˆtsvectorï¼‰
- å†™å…¥æ€§èƒ½è¾ƒæ…¢ï¼ˆéœ€ç»´æŠ¤å€’æ’åˆ—è¡¨ï¼‰

**æ—¶é—´å¤æ‚åº¦**: O(k)ï¼Œkä¸ºå…³é”®è¯æ•°

**å­˜å‚¨ç©ºé—´**: çº¦0.5Ã—æ•°æ®é‡

**é€‚ç”¨åœºæ™¯**:

- JSONBå­—æ®µæŸ¥è¯¢
- æ•°ç»„åŒ…å«æŸ¥è¯¢
- å…¨æ–‡æœç´¢
- æ ‡ç­¾ç³»ç»Ÿ

**PostgreSQLå®ç°**:

```sql
-- JSONBç´¢å¼•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_tables WHERE tablename = 'products') THEN
        CREATE TABLE products (
            product_id BIGSERIAL PRIMARY KEY,
            name TEXT NOT NULL,
            attributes JSONB,
            tags TEXT[]
        );
        RAISE NOTICE 'è¡¨ products åˆ›å»ºæˆåŠŸ';
    ELSE
        RAISE NOTICE 'è¡¨ products å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º';
    END IF;
EXCEPTION
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºè¡¨ products å¤±è´¥: %', SQLERRM;
END $$;

-- GINç´¢å¼•åˆ›å»ºï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    CREATE INDEX IF NOT EXISTS idx_products_attributes_gin ON products USING GIN (attributes);
    CREATE INDEX IF NOT EXISTS idx_products_tags_gin ON products USING GIN (tags);
    CREATE INDEX IF NOT EXISTS idx_products_attributes_path ON products USING GIN ((attributes->'category'));
    CREATE INDEX IF NOT EXISTS idx_products_name_fts ON products USING GIN (to_tsvector('english', name));
    RAISE NOTICE 'GINç´¢å¼•åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'åˆ›å»ºGINç´¢å¼•å¤±è´¥: %', SQLERRM;
END $$;

-- æŸ¥è¯¢ç¤ºä¾‹
SELECT * FROM products
WHERE attributes @> '{"color": "red"}';  -- GINç´¢å¼•åŠ é€Ÿ

SELECT * FROM products
WHERE tags @> ARRAY['electronics'];  -- GINç´¢å¼•åŠ é€Ÿ

SELECT * FROM products
WHERE to_tsvector('english', name) @@ to_tsquery('laptop');  -- å…¨æ–‡æœç´¢

SELECT * FROM products
WHERE to_tsvector('english', name) @@ to_tsquery('laptop');
```

**æ€§èƒ½å¯¹æ¯”**:

```sql
-- æ— ç´¢å¼•ï¼šå…¨è¡¨æ‰«æ
EXPLAIN (ANALYZE, BUFFERS, TIMING) SELECT * FROM products WHERE attributes @> '{"color": "red"}';
-- Seq Scan on products (cost=0.00..50000.00 rows=1000 width=200)

-- æœ‰GINç´¢å¼•ï¼šç´¢å¼•æ‰«æ
EXPLAIN (ANALYZE, BUFFERS, TIMING) SELECT * FROM products WHERE attributes @> '{"color": "red"}';
-- Bitmap Index Scan on idx_products_attributes_gin (cost=0.00..100.00 rows=1000)
```

---

### 2.3 GISTç´¢å¼•

**å®šä¹‰**: Generalized Search Treeï¼Œé€šç”¨æœç´¢æ ‘ï¼Œé€‚ç”¨äºç©ºé—´æ•°æ®ã€èŒƒå›´ç±»å‹ã€‚

**ç‰¹ç‚¹**:

- æ”¯æŒç©ºé—´æŸ¥è¯¢ï¼ˆPostGISï¼‰
- æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼ˆtsrangeã€int4rangeç­‰ï¼‰
- æ”¯æŒEXCLUDEçº¦æŸ
- æ”¯æŒKNNæŸ¥è¯¢ï¼ˆæœ€è¿‘é‚»ï¼‰

**æ—¶é—´å¤æ‚åº¦**: O(log n)

**å­˜å‚¨ç©ºé—´**: çº¦1.5Ã—æ•°æ®é‡

**é€‚ç”¨åœºæ™¯**:

- ç©ºé—´æ•°æ®æŸ¥è¯¢ï¼ˆPostGISï¼‰
- èŒƒå›´ç±»å‹æŸ¥è¯¢
- å…¨æ–‡æœç´¢ï¼ˆæ›¿ä»£GINï¼‰
- ç½‘ç»œåœ°å€æŸ¥è¯¢

**PostgreSQLå®ç°**:

```sql
-- å¯ç”¨PostGISæ‰©å±•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    CREATE EXTENSION IF NOT EXISTS postgis;
    RAISE NOTICE 'PostGISæ‰©å±•å·²å®‰è£…';
EXCEPTION
    WHEN duplicate_object THEN
        RAISE NOTICE 'PostGISæ‰©å±•å·²å­˜åœ¨ï¼Œè·³è¿‡å®‰è£…';
    WHEN OTHERS THEN
        RAISE WARNING 'å®‰è£…PostGISæ‰©å±•å¤±è´¥: %', SQLERRM;
END $$;

-- ä½ç½®è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_tables WHERE tablename = 'locations') THEN
        CREATE TABLE locations (
            location_id BIGSERIAL PRIMARY KEY,
            name TEXT NOT NULL,
            geom_point GEOGRAPHY(POINT, 4326),
            geom_polygon GEOMETRY(POLYGON, 4326)
        );
        RAISE NOTICE 'è¡¨ locations åˆ›å»ºæˆåŠŸ';
    ELSE
        RAISE NOTICE 'è¡¨ locations å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º';
    END IF;
EXCEPTION
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºè¡¨ locations å¤±è´¥: %', SQLERRM;
END $$;

-- GISTç©ºé—´ç´¢å¼•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    CREATE INDEX IF NOT EXISTS idx_locations_geom_point ON locations USING GIST (geom_point);
    CREATE INDEX IF NOT EXISTS idx_locations_geom_polygon ON locations USING GIST (geom_polygon);
    RAISE NOTICE 'GISTç©ºé—´ç´¢å¼•åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'åˆ›å»ºGISTç©ºé—´ç´¢å¼•å¤±è´¥: %', SQLERRM;
END $$;

-- ç©ºé—´æŸ¥è¯¢
SELECT * FROM locations
WHERE ST_DWithin(
    geom_point,
    ST_GeogFromText('POINT(116.4074 39.9042)'),  -- åŒ—äº¬
    100000  -- 100å…¬é‡Œ
);

-- KNNæŸ¥è¯¢ï¼ˆæœ€è¿‘é‚»ï¼‰
SELECT *, ST_Distance(geom_point, ST_GeogFromText('POINT(116.4074 39.9042)')) AS distance
FROM locations
ORDER BY geom_point <-> ST_GeogFromText('POINT(116.4074 39.9042)')
LIMIT 10;

-- èŒƒå›´ç±»å‹ç´¢å¼•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_tables WHERE tablename = 'bookings') THEN
        CREATE TABLE bookings (
            booking_id BIGSERIAL PRIMARY KEY,
            room_id INT NOT NULL,
            booking_period TSRANGE NOT NULL,
            EXCLUDE USING GIST (
                room_id WITH =,
                booking_period WITH &&
            )
        );
        RAISE NOTICE 'è¡¨ bookings åˆ›å»ºæˆåŠŸ';
    ELSE
        RAISE NOTICE 'è¡¨ bookings å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º';
    END IF;
EXCEPTION
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºè¡¨ bookings å¤±è´¥: %', SQLERRM;
END $$;

-- åˆ›å»ºGISTç´¢å¼•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    CREATE INDEX IF NOT EXISTS idx_bookings_period ON bookings USING GIST (booking_period);
    RAISE NOTICE 'GISTç´¢å¼•åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'åˆ›å»ºGISTç´¢å¼•å¤±è´¥: %', SQLERRM;
END $$;
```

---

### 2.4 BRINç´¢å¼•

**å®šä¹‰**: Block Range Indexï¼Œå—èŒƒå›´ç´¢å¼•ï¼Œé€‚ç”¨äºæœ‰åºæ•°æ®ã€‚

**ç‰¹ç‚¹**:

- ç´¢å¼•æå°ï¼ˆçº¦0.01%æ•°æ®é‡ï¼‰
- å†™å…¥æ€§èƒ½æå¿«ï¼ˆä»…æ›´æ–°å…ƒæ•°æ®ï¼‰
- é€‚ç”¨äºé¡ºåºæ•°æ®ï¼ˆæ—¶é—´åºåˆ—ã€è‡ªå¢IDï¼‰
- æŸ¥è¯¢æ€§èƒ½å–å†³äºæ•°æ®å±€éƒ¨æ€§

**æ—¶é—´å¤æ‚åº¦**: O(n/block_range)

**å­˜å‚¨ç©ºé—´**: çº¦0.01%æ•°æ®é‡ï¼ˆæå°ï¼‰

**é€‚ç”¨åœºæ™¯**:

- æ—¶é—´åºåˆ—æ•°æ®
- è‡ªå¢IDèŒƒå›´æŸ¥è¯¢
- é¡ºåºå†™å…¥çš„æ•°æ®
- å¤§è¡¨ï¼ˆTBçº§ï¼‰çš„ç²—ç²’åº¦ç´¢å¼•

**PostgreSQLå®ç°**:

```sql
-- æ—¶é—´åºåˆ—è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_tables WHERE tablename = 'sensor_readings') THEN
        CREATE TABLE sensor_readings (
            reading_id BIGSERIAL PRIMARY KEY,
            device_id INT NOT NULL,
            timestamp TIMESTAMPTZ NOT NULL,
            value DOUBLE PRECISION NOT NULL
        );
        RAISE NOTICE 'è¡¨ sensor_readings åˆ›å»ºæˆåŠŸ';
    ELSE
        RAISE NOTICE 'è¡¨ sensor_readings å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º';
    END IF;
EXCEPTION
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºè¡¨ sensor_readings å¤±è´¥: %', SQLERRM;
END $$;

-- BRINç´¢å¼•åˆ›å»ºï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    CREATE INDEX IF NOT EXISTS idx_readings_timestamp_brin ON sensor_readings USING BRIN (timestamp);
    CREATE INDEX IF NOT EXISTS idx_readings_id_brin ON sensor_readings USING BRIN (reading_id);
    -- è‡ªå®šä¹‰å—èŒƒå›´å¤§å°ï¼ˆé»˜è®¤128é¡µï¼‰
    CREATE INDEX IF NOT EXISTS idx_readings_timestamp_brin_custom ON sensor_readings
    USING BRIN (timestamp) WITH (pages_per_range = 64);
    RAISE NOTICE 'BRINç´¢å¼•åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'åˆ›å»ºBRINç´¢å¼•å¤±è´¥: %', SQLERRM;
END $$;

-- æŸ¥è¯¢ç¤ºä¾‹ï¼ˆæ—¶é—´èŒƒå›´æŸ¥è¯¢ï¼‰
SELECT * FROM sensor_readings
WHERE timestamp BETWEEN '2024-01-01' AND '2024-01-31'
  AND device_id = 123;
```

**æ€§èƒ½å¯¹æ¯”**:

```sql
-- B-Treeç´¢å¼•ï¼š12GBï¼ˆ1äº¿è¡Œæ•°æ®ï¼‰
CREATE INDEX idx_readings_timestamp_btree ON sensor_readings USING BTREE (timestamp);
-- ç´¢å¼•å¤§å°ï¼š12GB

-- BRINç´¢å¼•ï¼š1.2MBï¼ˆ1äº¿è¡Œæ•°æ®ï¼‰
CREATE INDEX idx_readings_timestamp_brin ON sensor_readings USING BRIN (timestamp);
-- ç´¢å¼•å¤§å°ï¼š1.2MBï¼ˆå°10000å€ï¼‰

-- å†™å…¥æ€§èƒ½å¯¹æ¯”
-- B-Treeï¼šæ¯æ¬¡INSERTæ›´æ–°12GBç´¢å¼• -> 5ms
-- BRINï¼šä»…æ›´æ–°å…ƒæ•°æ® -> 0.1msï¼ˆå¿«50å€ï¼‰
```

---

### 2.5 SP-GISTç´¢å¼•

**å®šä¹‰**: Space-Partitioned GISTï¼Œç©ºé—´åˆ†åŒºGISTï¼Œé€‚ç”¨äºéå¹³è¡¡æ ‘ç»“æ„ã€‚

**ç‰¹ç‚¹**:

- æ”¯æŒéå¹³è¡¡æ•°æ®ç»“æ„
- é€‚ç”¨äºç‚¹ã€èŒƒå›´ã€æ–‡æœ¬ç­‰ç±»å‹
- æ€§èƒ½ä»‹äºGISTå’ŒGINä¹‹é—´

**é€‚ç”¨åœºæ™¯**:

- ç‚¹æ•°æ®ï¼ˆéç©ºé—´ï¼‰
- IPåœ°å€èŒƒå›´
- æ–‡æœ¬å‰ç¼€åŒ¹é…

**PostgreSQLå®ç°**:

```sql
-- IPåœ°å€èŒƒå›´ç´¢å¼•
CREATE TABLE ip_ranges (
    range_id BIGSERIAL PRIMARY KEY,
    network_name TEXT NOT NULL,
    ip_range INET NOT NULL
);

CREATE INDEX idx_ip_ranges_spgist ON ip_ranges USING SPGIST (ip_range);

-- æŸ¥è¯¢ç¤ºä¾‹
SELECT * FROM ip_ranges
WHERE ip_range >>= '192.168.1.100';  -- åŒ…å«æŸ¥è¯¢
```

---

### 2.6 Hashç´¢å¼•

**å®šä¹‰**: å“ˆå¸Œç´¢å¼•ï¼Œä»…æ”¯æŒç­‰å€¼æŸ¥è¯¢ã€‚

**ç‰¹ç‚¹**:

- ä»…æ”¯æŒç­‰å€¼æŸ¥è¯¢ï¼ˆ=ï¼‰
- ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ã€æ’åº
- å†™å…¥æ€§èƒ½å¿«
- ä¸å¸¸ç”¨ï¼ˆB-Treeå·²è¶³å¤Ÿå¥½ï¼‰

**æ—¶é—´å¤æ‚åº¦**: O(1)

**å­˜å‚¨ç©ºé—´**: çº¦1.0Ã—æ•°æ®é‡

**é€‚ç”¨åœºæ™¯**:

- ä»…ç­‰å€¼æŸ¥è¯¢çš„åœºæ™¯
- é«˜å¹¶å‘å†™å…¥åœºæ™¯

**PostgreSQLå®ç°**:

```sql
CREATE INDEX idx_users_email_hash ON users USING HASH (email);

-- ä»…æ”¯æŒç­‰å€¼æŸ¥è¯¢
SELECT * FROM users WHERE email = 'test@example.com';  -- âœ… ä½¿ç”¨Hashç´¢å¼•
SELECT * FROM users WHERE email > 'test@example.com';   -- âŒ ä¸ä½¿ç”¨Hashç´¢å¼•
```

---

## 3. ç´¢å¼•é€‰æ‹©å†³ç­–

### 3.1 ç´¢å¼•é€‰æ‹©å†³ç­–æ ‘

```mermaid
graph TD
    A[é€‰æ‹©ç´¢å¼•ç±»å‹] --> B{æŸ¥è¯¢ç±»å‹?}
    B -->|ç­‰å€¼/èŒƒå›´æŸ¥è¯¢| C[B-Tree]
    B -->|æ•°ç»„/JSONBæŸ¥è¯¢| D{GIN}
    B -->|ç©ºé—´æŸ¥è¯¢| E{GIST}
    B -->|æ—¶é—´åºåˆ—| F{æ•°æ®æœ‰åº?}
    F -->|æ˜¯| G[BRIN]
    F -->|å¦| C
    B -->|ä»…ç­‰å€¼æŸ¥è¯¢| H[Hash]
```

---

### 3.2 ç´¢å¼•ç±»å‹å¯¹æ¯”çŸ©é˜µ

| ç´¢å¼•ç±»å‹ | ç­‰å€¼æŸ¥è¯¢ | èŒƒå›´æŸ¥è¯¢ | æ•°ç»„æŸ¥è¯¢ | JSONBæŸ¥è¯¢ | ç©ºé—´æŸ¥è¯¢ | å­˜å‚¨ç©ºé—´ | å†™å…¥æ€§èƒ½ |
|---------|---------|---------|---------|----------|---------|---------|---------|
| **B-Tree** | âœ… ä¼˜ç§€ | âœ… ä¼˜ç§€ | âŒ | âŒ | âŒ | 1.2Ã— | è‰¯å¥½ |
| **GIN** | âš ï¸ ä¸€èˆ¬ | âŒ | âœ… ä¼˜ç§€ | âœ… ä¼˜ç§€ | âŒ | 0.5Ã— | è¾ƒæ…¢ |
| **GIST** | âš ï¸ ä¸€èˆ¬ | âœ… è‰¯å¥½ | âŒ | âŒ | âœ… ä¼˜ç§€ | 1.5Ã— | è‰¯å¥½ |
| **BRIN** | âš ï¸ ä¸€èˆ¬ | âœ… è‰¯å¥½ | âŒ | âŒ | âŒ | 0.01Ã— | æå¿« |
| **Hash** | âœ… ä¼˜ç§€ | âŒ | âŒ | âŒ | âŒ | 1.0Ã— | è‰¯å¥½ |

---

## 4. ç´¢å¼•è®¾è®¡æœ€ä½³å®è·µ

### 4.1 ç´¢å¼•è®¾è®¡åŸåˆ™

**åŸåˆ™1: ä¸ºé¢‘ç¹æŸ¥è¯¢çš„åˆ—åˆ›å»ºç´¢å¼•**:

```sql
-- âœ… æ­£ç¡®ï¼šæŸ¥è¯¢é¢‘ç¹çš„åˆ—
CREATE INDEX idx_orders_customer ON orders(customer_id);
CREATE INDEX idx_orders_date ON orders(order_date);

-- âŒ é”™è¯¯ï¼šå¾ˆå°‘æŸ¥è¯¢çš„åˆ—
CREATE INDEX idx_orders_notes ON orders(notes);  -- å¾ˆå°‘æŸ¥è¯¢
```

---

**åŸåˆ™2: å¤åˆç´¢å¼•åˆ—é¡ºåº**:

```sql
-- æŸ¥è¯¢ï¼šWHERE customer_id = ? AND order_date BETWEEN ? AND ?
-- âœ… æ­£ç¡®ï¼šé«˜é€‰æ‹©æ€§åˆ—åœ¨å‰
CREATE INDEX idx_orders_customer_date ON orders(customer_id, order_date);

-- âŒ é”™è¯¯ï¼šä½é€‰æ‹©æ€§åˆ—åœ¨å‰
CREATE INDEX idx_orders_date_customer ON orders(order_date, customer_id);
```

---

**åŸåˆ™3: ä½¿ç”¨éƒ¨åˆ†ç´¢å¼•å‡å°‘ç´¢å¼•å¤§å°**:

```sql
-- âœ… æ­£ç¡®ï¼šä»…ç´¢å¼•æ´»è·ƒè®¢å•
CREATE INDEX idx_orders_active ON orders(customer_id)
WHERE status IN ('pending', 'processing');

-- âŒ é”™è¯¯ï¼šç´¢å¼•æ‰€æœ‰è®¢å•
CREATE INDEX idx_orders_all ON orders(customer_id);
```

---

**åŸåˆ™4: ä½¿ç”¨è¡¨è¾¾å¼ç´¢å¼•æ”¯æŒå‡½æ•°æŸ¥è¯¢**:

```sql
-- âœ… æ­£ç¡®ï¼šæ”¯æŒå¤§å°å†™ä¸æ•æ„ŸæŸ¥è¯¢
CREATE INDEX idx_users_email_lower ON users(LOWER(email));

-- æŸ¥è¯¢
SELECT * FROM users WHERE LOWER(email) = LOWER('Test@Example.com');
```

---

### 4.2 ç´¢å¼•å‘½åè§„èŒƒ

**å‘½åæ ¼å¼**: `idx_è¡¨å_åˆ—å_ç±»å‹`

**ç¤ºä¾‹**:

```sql
-- B-Treeç´¢å¼•ï¼ˆé»˜è®¤ï¼Œå¯ä¸æ ‡æ³¨ï¼‰
CREATE INDEX idx_users_email ON users(email);

-- GINç´¢å¼•
CREATE INDEX idx_products_tags_gin ON products USING GIN (tags);

-- GISTç´¢å¼•
CREATE INDEX idx_locations_geom_gist ON locations USING GIST (geom_point);

-- BRINç´¢å¼•
CREATE INDEX idx_readings_timestamp_brin ON sensor_readings USING BRIN (timestamp);
```

---

## 5. ç´¢å¼•ç»´æŠ¤ä¸ä¼˜åŒ–

### 5.1 ç´¢å¼•ç»´æŠ¤

**é‡å»ºç´¢å¼•**:

```sql
-- é‡å»ºç´¢å¼•ï¼ˆå›æ”¶ç©ºé—´ï¼‰
REINDEX INDEX idx_users_email;

-- é‡å»ºè¡¨çš„æ‰€æœ‰ç´¢å¼•
REINDEX TABLE users;

-- é‡å»ºæ•°æ®åº“çš„æ‰€æœ‰ç´¢å¼•
REINDEX DATABASE mydb;
```

---

**ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯æ›´æ–°**:

```sql
-- æ›´æ–°è¡¨ç»Ÿè®¡ä¿¡æ¯ï¼ˆå½±å“æŸ¥è¯¢è®¡åˆ’ï¼‰
ANALYZE users;

-- æ›´æ–°ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯
ANALYZE users(email);
```

---

**ç´¢å¼•è†¨èƒ€æ£€æŸ¥**:

```sql
-- æ£€æŸ¥ç´¢å¼•å¤§å°
SELECT
    schemaname,
    tablename,
    indexname,
    pg_size_pretty(pg_relation_size(indexrelid)) AS index_size,
    idx_scan AS index_scans,
    idx_tup_read AS tuples_read,
    idx_tup_fetch AS tuples_fetched
FROM pg_stat_user_indexes
WHERE schemaname = 'public'
ORDER BY pg_relation_size(indexrelid) DESC;
```

---

### 5.2 ç´¢å¼•ä¼˜åŒ–ç­–ç•¥

**ç­–ç•¥1: åˆ é™¤æœªä½¿ç”¨çš„ç´¢å¼•**:

```sql
-- æŸ¥æ‰¾æœªä½¿ç”¨çš„ç´¢å¼•
SELECT
    schemaname,
    tablename,
    indexname,
    idx_scan
FROM pg_stat_user_indexes
WHERE idx_scan = 0
  AND schemaname = 'public';
```

---

**ç­–ç•¥2: åˆå¹¶é‡å¤ç´¢å¼•**:

```sql
-- âŒ é”™è¯¯ï¼šé‡å¤ç´¢å¼•
CREATE INDEX idx_users_email1 ON users(email);
CREATE INDEX idx_users_email2 ON users(email);

-- âœ… æ­£ç¡®ï¼šåªä¿ç•™ä¸€ä¸ª
CREATE INDEX idx_users_email ON users(email);
```

---

**ç­–ç•¥3: ä½¿ç”¨è¦†ç›–ç´¢å¼•**:

```sql
-- è¦†ç›–ç´¢å¼•ï¼šç´¢å¼•åŒ…å«æŸ¥è¯¢æ‰€éœ€çš„æ‰€æœ‰åˆ—
CREATE INDEX idx_orders_covering ON orders(customer_id, order_date, total_amount);

-- æŸ¥è¯¢ä»…éœ€æ‰«æç´¢å¼•ï¼Œæ— éœ€è®¿é—®è¡¨
SELECT customer_id, order_date, total_amount
FROM orders
WHERE customer_id = 123;
```

---

## 6. å¸¸è§ç´¢å¼•æ¨¡å¼

### 6.1 æ—¶é—´åºåˆ—ç´¢å¼•æ¨¡å¼

```sql
-- æ¨¡å¼ï¼šBRIN + B-Treeå¤åˆï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_tables WHERE tablename = 'time_series_data') THEN
        CREATE TABLE time_series_data (
            id BIGSERIAL,
            timestamp TIMESTAMPTZ NOT NULL,
            device_id INT NOT NULL,
            value DOUBLE PRECISION
        );
        RAISE NOTICE 'è¡¨ time_series_data åˆ›å»ºæˆåŠŸ';
    ELSE
        RAISE NOTICE 'è¡¨ time_series_data å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º';
    END IF;
EXCEPTION
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºè¡¨ time_series_data å¤±è´¥: %', SQLERRM;
END $$;

-- åˆ›å»ºç´¢å¼•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    -- BRINç´¢å¼•ï¼šæ—¶é—´èŒƒå›´æŸ¥è¯¢
    CREATE INDEX IF NOT EXISTS idx_ts_timestamp_brin ON time_series_data USING BRIN (timestamp);
    -- B-Treeç´¢å¼•ï¼šè®¾å¤‡æŸ¥è¯¢
    CREATE INDEX IF NOT EXISTS idx_ts_device ON time_series_data(device_id);
    -- å¤åˆæŸ¥è¯¢ï¼šæ—¶é—´èŒƒå›´ + è®¾å¤‡
    CREATE INDEX IF NOT EXISTS idx_ts_device_timestamp ON time_series_data(device_id, timestamp);
    RAISE NOTICE 'ç´¢å¼•åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'åˆ›å»ºç´¢å¼•å¤±è´¥: %', SQLERRM;
END $$;
```

---

### 6.2 JSONBç´¢å¼•æ¨¡å¼

```sql
-- æ¨¡å¼ï¼šGIN + è¡¨è¾¾å¼ç´¢å¼•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_tables WHERE tablename = 'products_index_pattern') THEN
        CREATE TABLE products_index_pattern (
            product_id BIGSERIAL PRIMARY KEY,
            attributes JSONB
        );
        RAISE NOTICE 'è¡¨ products_index_pattern åˆ›å»ºæˆåŠŸ';
    ELSE
        RAISE NOTICE 'è¡¨ products_index_pattern å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º';
    END IF;
EXCEPTION
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºè¡¨ products_index_pattern å¤±è´¥: %', SQLERRM;
END $$;

-- åˆ›å»ºç´¢å¼•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    -- GINç´¢å¼•ï¼šé€šç”¨JSONBæŸ¥è¯¢
    CREATE INDEX IF NOT EXISTS idx_products_attrs_gin ON products_index_pattern USING GIN (attributes);
    -- è¡¨è¾¾å¼ç´¢å¼•ï¼šç‰¹å®šè·¯å¾„æŸ¥è¯¢
    CREATE INDEX IF NOT EXISTS idx_products_category ON products_index_pattern ((attributes->>'category'));
    CREATE INDEX IF NOT EXISTS idx_products_price ON products_index_pattern ((attributes->>'price')::NUMERIC);
    RAISE NOTICE 'ç´¢å¼•åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'åˆ›å»ºç´¢å¼•å¤±è´¥: %', SQLERRM;
END $$;
```

---

### 6.3 å…¨æ–‡æœç´¢ç´¢å¼•æ¨¡å¼

```sql
-- æ¨¡å¼ï¼šGIN + tsvectorï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_tables WHERE tablename = 'articles') THEN
        CREATE TABLE articles (
            article_id BIGSERIAL PRIMARY KEY,
            title TEXT NOT NULL,
            content TEXT NOT NULL
        );
        RAISE NOTICE 'è¡¨ articles åˆ›å»ºæˆåŠŸ';
    ELSE
        RAISE NOTICE 'è¡¨ articles å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º';
    END IF;
EXCEPTION
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºè¡¨ articles å¤±è´¥: %', SQLERRM;
END $$;

-- GINå…¨æ–‡æœç´¢ç´¢å¼•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    CREATE INDEX IF NOT EXISTS idx_articles_title_fts ON articles USING GIN (to_tsvector('english', title));
    CREATE INDEX IF NOT EXISTS idx_articles_content_fts ON articles USING GIN (to_tsvector('english', content));
    RAISE NOTICE 'å…¨æ–‡æœç´¢ç´¢å¼•åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'åˆ›å»ºå…¨æ–‡æœç´¢ç´¢å¼•å¤±è´¥: %', SQLERRM;
END $$;

-- æŸ¥è¯¢
SELECT * FROM articles
WHERE to_tsvector('english', title || ' ' || content) @@ to_tsquery('postgresql & performance');
```

---

## 7. ç´¢å¼•æ€§èƒ½è°ƒä¼˜

### 7.1 ç´¢å¼•å‚æ•°è°ƒä¼˜

**B-Treeå‚æ•°**:

```sql
-- fillfactorï¼šæ§åˆ¶ç´¢å¼•é¡µå¡«å……ç‡ï¼ˆé»˜è®¤90%ï¼‰
CREATE INDEX idx_users_email ON users(email) WITH (fillfactor = 80);
```

---

**BRINå‚æ•°**:

```sql
-- pages_per_rangeï¼šæ§åˆ¶å—èŒƒå›´å¤§å°ï¼ˆé»˜è®¤128é¡µï¼‰
CREATE INDEX idx_readings_timestamp_brin ON sensor_readings
USING BRIN (timestamp) WITH (pages_per_range = 64);
```

---

### 7.2 æŸ¥è¯¢è®¡åˆ’åˆ†æ

```sql
-- æŸ¥çœ‹æŸ¥è¯¢è®¡åˆ’
EXPLAIN (ANALYZE, BUFFERS, TIMING) SELECT * FROM users WHERE email = 'test@example.com';

-- è¾“å‡ºç¤ºä¾‹ï¼š
-- Index Scan using idx_users_email on users
--   (cost=0.42..8.44 rows=1 width=100)
--   (actual time=0.123..0.125 rows=1 loops=1)
--   Index Cond: (email = 'test@example.com'::text)
```

---

## 8. ç´¢å¼•ç›‘æ§å’Œè¯Šæ–­ / Index Monitoring and Diagnostics

### 8.1 ç´¢å¼•ä½¿ç”¨æƒ…å†µç›‘æ§

**ç›‘æ§ç´¢å¼•ä½¿ç”¨é¢‘ç‡**:

```sql
-- æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µ
SELECT
    schemaname,
    tablename,
    indexname,
    idx_scan AS index_scans,
    idx_tup_read AS tuples_read,
    idx_tup_fetch AS tuples_fetched,
    pg_size_pretty(pg_relation_size(indexrelid)) AS index_size,
    CASE
        WHEN idx_scan = 0 THEN 'æœªä½¿ç”¨'
        WHEN idx_scan < 100 THEN 'å¾ˆå°‘ä½¿ç”¨'
        ELSE 'æ­£å¸¸ä½¿ç”¨'
    END AS usage_status
FROM pg_stat_user_indexes
WHERE schemaname = 'public'
ORDER BY idx_scan ASC, pg_relation_size(indexrelid) DESC;

-- æŸ¥æ‰¾æœªä½¿ç”¨çš„ç´¢å¼•ï¼ˆå€™é€‰åˆ é™¤ï¼‰
SELECT
    schemaname,
    tablename,
    indexname,
    pg_size_pretty(pg_relation_size(indexrelid)) AS index_size,
    pg_size_pretty(pg_relation_size(schemaname||'.'||tablename)) AS table_size
FROM pg_stat_user_indexes
WHERE schemaname = 'public'
  AND idx_scan = 0
  AND indexname NOT LIKE '%_pkey'  -- ä¿ç•™ä¸»é”®
ORDER BY pg_relation_size(indexrelid) DESC;
```

**ç›‘æ§ç´¢å¼•å¤§å°**:

```sql
-- æŸ¥çœ‹ç´¢å¼•å¤§å°æ’å
SELECT
    schemaname,
    tablename,
    indexname,
    pg_size_pretty(pg_relation_size(indexrelid)) AS index_size,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS table_total_size,
    round(100.0 * pg_relation_size(indexrelid) /
          NULLIF(pg_total_relation_size(schemaname||'.'||tablename), 0), 2) AS index_percentage
FROM pg_stat_user_indexes
WHERE schemaname = 'public'
ORDER BY pg_relation_size(indexrelid) DESC
LIMIT 20;
```

### 8.2 ç´¢å¼•è†¨èƒ€ç›‘æ§

**æ£€æŸ¥ç´¢å¼•è†¨èƒ€**:

```sql
-- ä½¿ç”¨pgstattupleæ‰©å±•æ£€æŸ¥ç´¢å¼•è†¨èƒ€
CREATE EXTENSION IF NOT EXISTS pgstattuple;

-- æ£€æŸ¥ç‰¹å®šç´¢å¼•çš„è†¨èƒ€æƒ…å†µ
SELECT * FROM pgstatindex('idx_users_email');

-- æ‰¹é‡æ£€æŸ¥æ‰€æœ‰ç´¢å¼•è†¨èƒ€
DO $$
DECLARE
    r RECORD;
BEGIN
    FOR r IN
        SELECT indexrelid::regclass AS index_name
        FROM pg_stat_user_indexes
        WHERE schemaname = 'public'
          AND pg_relation_size(indexrelid) > 1048576  -- å¤§äº1MB
    LOOP
        RAISE NOTICE 'Checking index: %', r.index_name;
        -- å¯ä»¥è°ƒç”¨pgstatindexå‡½æ•°
    END LOOP;
END $$;
```

**ç´¢å¼•è†¨èƒ€ä¿®å¤**:

```sql
-- é‡å»ºç´¢å¼•ï¼ˆå›æ”¶ç©ºé—´ï¼‰
REINDEX INDEX CONCURRENTLY idx_users_email;

-- æ‰¹é‡é‡å»ºè¡¨çš„æ‰€æœ‰ç´¢å¼•
REINDEX TABLE CONCURRENTLY users;

-- é‡å»ºæ•°æ®åº“çš„æ‰€æœ‰ç´¢å¼•ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
-- REINDEX DATABASE mydb;
```

### 8.3 ç´¢å¼•æ•ˆç‡åˆ†æ

**åˆ†æç´¢å¼•é€‰æ‹©æ€§**:

```sql
-- è®¡ç®—ç´¢å¼•é€‰æ‹©æ€§ï¼ˆé€‰æ‹©æ€§è¶Šé«˜ï¼Œç´¢å¼•è¶Šæœ‰æ•ˆï¼‰
SELECT
    schemaname,
    tablename,
    attname AS column_name,
    n_distinct AS distinct_values,
    round(100.0 * n_distinct / NULLIF(reltuples, 0), 2) AS selectivity_percent,
    correlation
FROM pg_stats
WHERE schemaname = 'public'
  AND tablename = 'orders'
ORDER BY n_distinct DESC NULLS LAST;

-- é€‰æ‹©æ€§è¯´æ˜ï¼š
-- 100%ï¼šå®Œå…¨å”¯ä¸€ï¼ˆæœ€ä½³ï¼‰
-- 50-100%ï¼šé«˜é€‰æ‹©æ€§ï¼ˆè‰¯å¥½ï¼‰
-- 10-50%ï¼šä¸­ç­‰é€‰æ‹©æ€§ï¼ˆå¯ç”¨ï¼‰
-- <10%ï¼šä½é€‰æ‹©æ€§ï¼ˆè€ƒè™‘éƒ¨åˆ†ç´¢å¼•ï¼‰
```

**åˆ†æç´¢å¼•æ‰«ææ•ˆç‡**:

```sql
-- æŸ¥çœ‹ç´¢å¼•æ‰«æç»Ÿè®¡
SELECT
    schemaname,
    tablename,
    indexname,
    idx_scan AS total_scans,
    idx_tup_read AS tuples_read,
    idx_tup_fetch AS tuples_fetched,
    CASE
        WHEN idx_scan > 0 THEN round(100.0 * idx_tup_fetch / NULLIF(idx_tup_read, 0), 2)
        ELSE 0
    END AS fetch_efficiency_percent
FROM pg_stat_user_indexes
WHERE schemaname = 'public'
  AND idx_scan > 0
ORDER BY idx_scan DESC;
```

---

## 9. ç´¢å¼•æ€§èƒ½åˆ†æ / Index Performance Analysis

### 9.1 ç´¢å¼•åˆ›å»ºæ€§èƒ½

**æ‰¹é‡åˆ›å»ºç´¢å¼•ä¼˜åŒ–**:

```sql
-- âŒ é”™è¯¯ï¼šé€ä¸ªåˆ›å»ºç´¢å¼•ï¼ˆæ…¢ï¼‰
CREATE INDEX idx_orders_customer ON orders(customer_id);
CREATE INDEX idx_orders_date ON orders(order_date);
CREATE INDEX idx_orders_status ON orders(status);

-- âœ… æ­£ç¡®ï¼šä½¿ç”¨CONCURRENTLYå¹¶è¡Œåˆ›å»ºï¼ˆä¸é˜»å¡ï¼‰
CREATE INDEX CONCURRENTLY idx_orders_customer ON orders(customer_id);
CREATE INDEX CONCURRENTLY idx_orders_date ON orders(order_date);
CREATE INDEX CONCURRENTLY idx_orders_status ON orders(status);

-- æˆ–ä½¿ç”¨äº‹åŠ¡æ‰¹é‡åˆ›å»ºï¼ˆæ›´å¿«ï¼Œä½†ä¼šé”å®šè¡¨ï¼‰
BEGIN;
CREATE INDEX idx_orders_customer ON orders(customer_id);
CREATE INDEX idx_orders_date ON orders(order_date);
CREATE INDEX idx_orders_status ON orders(status);
COMMIT;
```

**ç´¢å¼•åˆ›å»ºæ—¶é—´æµ‹è¯•**:

```sql
-- æµ‹è¯•ç´¢å¼•åˆ›å»ºæ—¶é—´
\timing on

-- B-Treeç´¢å¼•ï¼ˆ100ä¸‡è¡Œï¼‰
CREATE INDEX idx_test_btree ON test_table(column1);
-- Time: 1234.567 ms

-- GINç´¢å¼•ï¼ˆ100ä¸‡è¡ŒJSONBï¼‰
CREATE INDEX idx_test_gin ON test_table USING GIN (jsonb_column);
-- Time: 5678.901 msï¼ˆè¾ƒæ…¢ï¼‰

-- BRINç´¢å¼•ï¼ˆ100ä¸‡è¡Œï¼‰
CREATE INDEX idx_test_brin ON test_table USING BRIN (timestamp_column);
-- Time: 123.456 msï¼ˆæœ€å¿«ï¼‰
```

### 9.2 ç´¢å¼•æŸ¥è¯¢æ€§èƒ½å¯¹æ¯”

**ä¸åŒæ•°æ®é‡çº§çš„æŸ¥è¯¢æ€§èƒ½**:

| æ•°æ®é‡ | æ— ç´¢å¼• | B-Tree | GIN | BRIN | æå‡æ¯”ä¾‹ |
|--------|--------|--------|-----|------|----------|
| 10K | 15ms | 0.5ms | 1.0ms | 0.8ms | 96.7% |
| 100K | 150ms | 1.2ms | 2.5ms | 2.0ms | 99.2% |
| 1M | 1500ms | 2.5ms | 5.0ms | 8.0ms | 99.8% |
| 10M | 15000ms | 5.0ms | 15ms | 30ms | 99.97% |

**ä¸åŒç´¢å¼•ç±»å‹çš„æŸ¥è¯¢æ€§èƒ½**:

```sql
-- å‡†å¤‡æµ‹è¯•æ•°æ®ï¼ˆ100ä¸‡è¡Œï¼‰
CREATE TABLE performance_test (
    id BIGSERIAL PRIMARY KEY,
    email VARCHAR(100),
    jsonb_data JSONB,
    timestamp_col TIMESTAMPTZ DEFAULT NOW(),
    text_data TEXT
);

-- æ’å…¥æµ‹è¯•æ•°æ®
INSERT INTO performance_test (email, jsonb_data, text_data)
SELECT
    'user' || i || '@example.com',
    jsonb_build_object('key', i, 'value', random()),
    'text content ' || i
FROM generate_series(1, 1000000) i;

-- æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
ANALYZE performance_test;

-- æµ‹è¯•1ï¼šB-Treeç´¢å¼•ï¼ˆç­‰å€¼æŸ¥è¯¢ï¼‰
CREATE INDEX idx_test_email_btree ON performance_test(email);
EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT * FROM performance_test WHERE email = 'user500000@example.com';
-- Index Scan using idx_test_email_btree: 0.5ms
-- Planning Time: 0.1ms
-- Execution Time: 0.6ms

-- æµ‹è¯•2ï¼šGINç´¢å¼•ï¼ˆJSONBæŸ¥è¯¢ï¼‰
CREATE INDEX idx_test_jsonb_gin ON performance_test USING GIN (jsonb_data);
EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT * FROM performance_test WHERE jsonb_data @> '{"key": 500000}';
-- Bitmap Index Scan using idx_test_jsonb_gin: 2.0ms
-- Planning Time: 0.2ms
-- Execution Time: 2.2ms

-- æµ‹è¯•3ï¼šBRINç´¢å¼•ï¼ˆèŒƒå›´æŸ¥è¯¢ï¼‰
CREATE INDEX idx_test_timestamp_brin ON performance_test USING BRIN (timestamp_col);
EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT * FROM performance_test
WHERE timestamp_col BETWEEN NOW() - INTERVAL '1 day' AND NOW();
-- Bitmap Index Scan using idx_test_timestamp_brin: 5.0ms
-- Planning Time: 0.1ms
-- Execution Time: 5.1msï¼ˆå–å†³äºæ•°æ®å±€éƒ¨æ€§ï¼‰

-- æµ‹è¯•4ï¼šå…¨æ–‡æœç´¢ç´¢å¼•ï¼ˆGINï¼‰
CREATE INDEX idx_test_text_gin ON performance_test
USING GIN (to_tsvector('english', text_data));
EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT * FROM performance_test
WHERE to_tsvector('english', text_data) @@ to_tsquery('english', 'content & 500000');
-- Bitmap Index Scan using idx_test_text_gin: 3.0ms
-- Planning Time: 0.2ms
-- Execution Time: 3.2ms
```

**å¤åˆç´¢å¼• vs å•åˆ—ç´¢å¼•æ€§èƒ½å¯¹æ¯”**:

| æŸ¥è¯¢ç±»å‹ | å•åˆ—ç´¢å¼• | å¤åˆç´¢å¼• | æå‡æ¯”ä¾‹ |
|----------|----------|----------|----------|
| å•æ¡ä»¶æŸ¥è¯¢ | 2.5ms | 2.5ms | 0% |
| å¤šæ¡ä»¶æŸ¥è¯¢ | 5.0ms | 2.8ms | 44% |
| æ’åºæŸ¥è¯¢ | 10ms | 3.0ms | 70% |

```sql
-- å•åˆ—ç´¢å¼•
CREATE INDEX idx_customer ON orders(customer_id);
CREATE INDEX idx_date ON orders(order_date);

-- å¤šæ¡ä»¶æŸ¥è¯¢ï¼ˆéœ€è¦åˆå¹¶ç´¢å¼•ï¼‰
EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT * FROM orders
WHERE customer_id = 123 AND order_date >= '2024-01-01';
-- BitmapAnd: 5.0ms

-- å¤åˆç´¢å¼•ï¼ˆæ›´ä¼˜ï¼‰
CREATE INDEX idx_customer_date ON orders(customer_id, order_date);
EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT * FROM orders
WHERE customer_id = 123 AND order_date >= '2024-01-01';
-- Index Scan using idx_customer_date: 2.8msï¼ˆæ›´å¿«ï¼‰
```

### 9.3 ç´¢å¼•ç»´æŠ¤æ€§èƒ½

**ç´¢å¼•å¯¹å†™å…¥æ€§èƒ½çš„å½±å“**:

| æ•°æ®é‡ | æ— ç´¢å¼• | B-Tree | GIN | GIST | BRIN |
|--------|--------|--------|-----|------|------|
| 10K | 50ms | 80ms | 200ms | 250ms | 55ms |
| 100K | 500ms | 800ms | 2000ms | 2500ms | 550ms |
| 1M | 5000ms | 8000ms | 20000ms | 25000ms | 5500ms |

**ç´¢å¼•ç»´æŠ¤å¼€é”€æµ‹è¯•**:

```sql
-- æµ‹è¯•1ï¼šINSERTæ€§èƒ½ï¼ˆæœ‰ç´¢å¼• vs æ— ç´¢å¼•ï¼‰
-- æ— ç´¢å¼•
CREATE TABLE test_no_index (id INT, data TEXT);
\timing on
INSERT INTO test_no_index SELECT i, 'data' FROM generate_series(1, 100000) i;
-- Time: 500ms

-- æœ‰B-Treeç´¢å¼•
CREATE TABLE test_with_btree (id INT, data TEXT);
CREATE INDEX idx_test_id ON test_with_btree(id);
\timing on
INSERT INTO test_with_btree SELECT i, 'data' FROM generate_series(1, 100000) i;
-- Time: 800msï¼ˆæ…¢60%ï¼‰

-- æœ‰GINç´¢å¼•ï¼ˆæ›´æ…¢ï¼‰
CREATE TABLE test_with_gin (id INT, jsonb_data JSONB);
CREATE INDEX idx_test_gin ON test_with_gin USING GIN (jsonb_data);
\timing on
INSERT INTO test_with_gin SELECT i, jsonb_build_object('key', i) FROM generate_series(1, 100000) i;
-- Time: 2000msï¼ˆæ…¢300%ï¼‰

-- æœ‰BRINç´¢å¼•ï¼ˆå½±å“æœ€å°ï¼‰
CREATE TABLE test_with_brin (id INT, timestamp_col TIMESTAMPTZ DEFAULT NOW());
CREATE INDEX idx_test_brin ON test_with_brin USING BRIN (timestamp_col);
\timing on
INSERT INTO test_with_brin (id) SELECT i FROM generate_series(1, 100000) i;
-- Time: 550msï¼ˆä»…æ…¢10%ï¼‰
```

**ç´¢å¼•å¯¹UPDATEæ€§èƒ½çš„å½±å“**:

| æ•°æ®é‡ | æ— ç´¢å¼• | B-Tree | GIN | å½±å“æ¯”ä¾‹ |
|--------|--------|--------|-----|----------|
| 10K | 30ms | 50ms | 150ms | 67% - 400% |
| 100K | 300ms | 500ms | 1500ms | 67% - 400% |
| 1M | 3000ms | 5000ms | 15000ms | 67% - 400% |

```sql
-- UPDATEæ€§èƒ½æµ‹è¯•
-- æ— ç´¢å¼•UPDATE
\timing on
UPDATE test_no_index SET data = 'updated' WHERE id BETWEEN 1 AND 10000;
-- Time: 300ms

-- æœ‰B-Treeç´¢å¼•UPDATE
\timing on
UPDATE test_with_btree SET data = 'updated' WHERE id BETWEEN 1 AND 10000;
-- Time: 500msï¼ˆéœ€è¦æ›´æ–°ç´¢å¼•ï¼‰

-- æœ‰GINç´¢å¼•UPDATEï¼ˆæœ€æ…¢ï¼‰
\timing on
UPDATE test_with_gin SET jsonb_data = jsonb_build_object('key', id, 'updated', true)
WHERE id BETWEEN 1 AND 10000;
-- Time: 1500msï¼ˆGINç´¢å¼•æ›´æ–°å¼€é”€å¤§ï¼‰
```

**ç´¢å¼•å¯¹DELETEæ€§èƒ½çš„å½±å“**:

| æ•°æ®é‡ | æ— ç´¢å¼• | B-Tree | GIN | å½±å“æ¯”ä¾‹ |
|--------|--------|--------|-----|----------|
| 10K | 20ms | 40ms | 100ms | 100% - 400% |
| 100K | 200ms | 400ms | 1000ms | 100% - 400% |
| 1M | 2000ms | 4000ms | 10000ms | 100% - 400% |

```sql
-- DELETEæ€§èƒ½æµ‹è¯•
-- æ— ç´¢å¼•DELETE
\timing on
DELETE FROM test_no_index WHERE id BETWEEN 1 AND 10000;
-- Time: 200ms

-- æœ‰B-Treeç´¢å¼•DELETE
\timing on
DELETE FROM test_with_btree WHERE id BETWEEN 1 AND 10000;
-- Time: 400msï¼ˆéœ€è¦ä»ç´¢å¼•ä¸­åˆ é™¤ï¼‰

-- æœ‰GINç´¢å¼•DELETEï¼ˆæœ€æ…¢ï¼‰
\timing on
DELETE FROM test_with_gin WHERE id BETWEEN 1 AND 10000;
-- Time: 1000msï¼ˆGINç´¢å¼•åˆ é™¤å¼€é”€å¤§ï¼‰
```

**ç´¢å¼•è†¨èƒ€å’ŒREINDEXæ€§èƒ½**:

| ç´¢å¼•å¤§å° | REINDEXæ—¶é—´ | REINDEX CONCURRENTLYæ—¶é—´ |
|----------|-------------|-------------------------|
| 100MB | 5s | 15s |
| 1GB | 50s | 150s |
| 10GB | 500s | 1500s |

```sql
-- REINDEXæ€§èƒ½æµ‹è¯•
-- æ™®é€šREINDEXï¼ˆä¼šé”å®šè¡¨ï¼‰
\timing on
REINDEX INDEX idx_test_email_btree;
-- Time: 5.0sï¼ˆ100MBç´¢å¼•ï¼‰

-- CONCURRENT REINDEXï¼ˆä¸é”å®šè¡¨ï¼Œä½†æ›´æ…¢ï¼‰
\timing on
REINDEX INDEX CONCURRENTLY idx_test_email_btree;
-- Time: 15.0sï¼ˆ100MBç´¢å¼•ï¼Œæ…¢3å€ä½†ä¸é˜»å¡ï¼‰
```

---

## 10. æ›´å¤šå®é™…æ¡ˆä¾‹ / More Practical Examples

### 10.1 æ¡ˆä¾‹4: ç”µå•†æœç´¢ç³»ç»Ÿ

```sql
-- ç”µå•†æœç´¢ï¼šå¤šå­—æ®µå…¨æ–‡æœç´¢ + JSONBå±æ€§æœç´¢
CREATE TABLE products (
    product_id BIGSERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    description TEXT,
    category VARCHAR(50),
    attributes JSONB,
    price NUMERIC(10,2),
    tags TEXT[]
);

-- å…¨æ–‡æœç´¢ç´¢å¼•ï¼ˆåç§°å’Œæè¿°ï¼‰
CREATE INDEX idx_products_name_fts ON products
USING GIN (to_tsvector('english', name));
CREATE INDEX idx_products_desc_fts ON products
USING GIN (to_tsvector('english', description));

-- JSONBå±æ€§ç´¢å¼•
CREATE INDEX idx_products_attrs_gin ON products USING GIN (attributes);

-- æ ‡ç­¾æ•°ç»„ç´¢å¼•
CREATE INDEX idx_products_tags_gin ON products USING GIN (tags);

-- ä»·æ ¼èŒƒå›´ç´¢å¼•
CREATE INDEX idx_products_price ON products(price);

-- å¤åˆæŸ¥è¯¢ç¤ºä¾‹
SELECT
    product_id,
    name,
    price,
    ts_rank(to_tsvector('english', name || ' ' || COALESCE(description, '')),
            to_tsquery('english', 'laptop')) AS rank
FROM products
WHERE (
    to_tsvector('english', name || ' ' || COALESCE(description, '')) @@ to_tsquery('english', 'laptop')
    OR attributes @> '{"brand": "Dell"}'
    OR tags @> ARRAY['electronics']
)
AND price BETWEEN 500 AND 2000
ORDER BY rank DESC, price ASC
LIMIT 20;
```

### 10.2 æ¡ˆä¾‹5: ç¤¾äº¤ç½‘ç»œç³»ç»Ÿ

```sql
-- ç¤¾äº¤ç½‘ç»œï¼šç”¨æˆ·å…³ç³» + æ—¶é—´çº¿æŸ¥è¯¢
CREATE TABLE users (
    user_id BIGSERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE friendships (
    user_id_from BIGINT NOT NULL REFERENCES users(user_id),
    user_id_to BIGINT NOT NULL REFERENCES users(user_id),
    status VARCHAR(20) DEFAULT 'pending',
    created_at TIMESTAMPTZ DEFAULT NOW(),
    PRIMARY KEY (user_id_from, user_id_to)
);

CREATE TABLE posts (
    post_id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES users(user_id),
    content TEXT NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    tags TEXT[]
);

-- ç”¨æˆ·å…³ç³»æŸ¥è¯¢ç´¢å¼•
CREATE INDEX idx_friendships_from ON friendships(user_id_from, status);
CREATE INDEX idx_friendships_to ON friendships(user_id_to, status);

-- æ—¶é—´çº¿æŸ¥è¯¢ç´¢å¼•ï¼ˆç”¨æˆ·çš„æ—¶é—´çº¿ï¼‰
CREATE INDEX idx_posts_user_time ON posts(user_id, created_at DESC);
CREATE INDEX idx_posts_tags_gin ON posts USING GIN (tags);

-- æŸ¥è¯¢ï¼šè·å–ç”¨æˆ·çš„æ—¶é—´çº¿ï¼ˆåŒ…æ‹¬å¥½å‹çš„å¸–å­ï¼‰
SELECT p.*
FROM posts p
WHERE p.user_id IN (
    SELECT user_id_to FROM friendships
    WHERE user_id_from = 123 AND status = 'accepted'
    UNION
    SELECT 123  -- è‡ªå·±çš„å¸–å­
)
ORDER BY p.created_at DESC
LIMIT 20;
```

### 10.3 æ¡ˆä¾‹6: æ—¥å¿—åˆ†æç³»ç»Ÿ

```sql
-- æ—¥å¿—åˆ†æï¼šå¤šç»´åº¦æŸ¥è¯¢ + å…¨æ–‡æœç´¢
CREATE TABLE application_logs (
    log_id BIGSERIAL,
    log_time TIMESTAMPTZ NOT NULL,
    level VARCHAR(20) NOT NULL,
    service VARCHAR(50) NOT NULL,
    message TEXT NOT NULL,
    context JSONB,
    user_id INT,
    request_id UUID,
    PRIMARY KEY (log_id, log_time)
) PARTITION BY RANGE (log_time);

-- æ—¶é—´åˆ†åŒºç´¢å¼•ï¼ˆBRINï¼‰
CREATE INDEX idx_logs_time_brin ON application_logs USING BRIN (log_time);

-- çº§åˆ«å’ŒæœåŠ¡ç´¢å¼•ï¼ˆB-Treeï¼‰
CREATE INDEX idx_logs_level_service ON application_logs(level, service);

-- å…¨æ–‡æœç´¢ç´¢å¼•ï¼ˆGINï¼‰
CREATE INDEX idx_logs_message_fts ON application_logs
USING GIN (to_tsvector('english', message));

-- JSONBä¸Šä¸‹æ–‡ç´¢å¼•
CREATE INDEX idx_logs_context_gin ON application_logs USING GIN (context);

-- ç”¨æˆ·IDç´¢å¼•
CREATE INDEX idx_logs_user ON application_logs(user_id) WHERE user_id IS NOT NULL;

-- å¤åˆæŸ¥è¯¢ï¼šé”™è¯¯æ—¥å¿— + å…¨æ–‡æœç´¢ + JSONBè¿‡æ»¤
SELECT
    log_time,
    level,
    service,
    message,
    context->>'ip_address' AS ip_address
FROM application_logs
WHERE log_time >= NOW() - INTERVAL '1 hour'
  AND level = 'ERROR'
  AND (
    to_tsvector('english', message) @@ to_tsquery('english', 'database | connection')
    OR context @> '{"error_code": "DB_ERROR"}'
  )
ORDER BY log_time DESC
LIMIT 100;
```

### 10.4 æ¡ˆä¾‹7: åœ°ç†ä½ç½®æœåŠ¡

```sql
-- åœ°ç†ä½ç½®æœåŠ¡ï¼šç©ºé—´ç´¢å¼• + è·ç¦»æŸ¥è¯¢
CREATE EXTENSION IF NOT EXISTS postgis;

CREATE TABLE places (
    place_id BIGSERIAL PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    category VARCHAR(50),
    location GEOGRAPHY(POINT, 4326) NOT NULL,
    address TEXT,
    rating NUMERIC(3,2)
);

-- GISTç©ºé—´ç´¢å¼•
CREATE INDEX idx_places_location_gist ON places USING GIST (location);

-- ç±»åˆ«ç´¢å¼•
CREATE INDEX idx_places_category ON places(category);

-- è¯„åˆ†ç´¢å¼•
CREATE INDEX idx_places_rating ON places(rating DESC);

-- æŸ¥è¯¢ï¼šé™„è¿‘çš„åœ°ç‚¹ï¼ˆKNNæŸ¥è¯¢ï¼‰
SELECT
    name,
    category,
    rating,
    ST_Distance(location, ST_MakePoint(-122.4194, 37.7749)::geography) AS distance_meters
FROM places
WHERE category = 'restaurant'
  AND ST_DWithin(
      location,
      ST_MakePoint(-122.4194, 37.7749)::geography,
      5000  -- 5å…¬é‡Œ
  )
ORDER BY location <-> ST_MakePoint(-122.4194, 37.7749)::geography
LIMIT 10;
```

---

## 11. ç´¢å¼•æ•…éšœæ’æŸ¥æŒ‡å— / Index Troubleshooting Guide

### 11.1 ç´¢å¼•æœªä½¿ç”¨é—®é¢˜è¯Šæ–­

**é—®é¢˜**: åˆ›å»ºäº†ç´¢å¼•ä½†æŸ¥è¯¢ä»ç„¶å¾ˆæ…¢ï¼Œæ‰§è¡Œè®¡åˆ’æ˜¾ç¤ºSeq Scan

**è¯Šæ–­æ­¥éª¤**:

```sql
-- æ­¥éª¤1ï¼šæ£€æŸ¥ç´¢å¼•æ˜¯å¦å­˜åœ¨
SELECT
    schemaname,
    tablename,
    indexname,
    indexdef
FROM pg_indexes
WHERE tablename = 'orders'
ORDER BY indexname;

-- æ­¥éª¤2ï¼šæ£€æŸ¥ç´¢å¼•å¤§å°
SELECT
    indexname,
    pg_size_pretty(pg_relation_size(indexname::regclass)) AS index_size
FROM pg_indexes
WHERE tablename = 'orders';

-- æ­¥éª¤3ï¼šæ£€æŸ¥ç´¢å¼•ä½¿ç”¨æƒ…å†µ
SELECT
    schemaname,
    tablename,
    indexname,
    idx_scan,
    idx_tup_read,
    idx_tup_fetch
FROM pg_stat_user_indexes
WHERE tablename = 'orders'
ORDER BY idx_scan DESC;

-- æ­¥éª¤4ï¼šæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’
EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT * FROM orders WHERE customer_id = 123;
```

**å¸¸è§åŸå› å’Œè§£å†³æ–¹æ¡ˆ**:

1. **ç»Ÿè®¡ä¿¡æ¯è¿‡æ—¶**:

   ```sql
   -- è§£å†³ï¼šæ›´æ–°ç»Ÿè®¡ä¿¡æ¯
   ANALYZE orders;
   ```

2. **æŸ¥è¯¢æ¡ä»¶ä¸åŒ¹é…ç´¢å¼•**:

   ```sql
   -- âŒ é”™è¯¯ï¼šä½¿ç”¨å‡½æ•°ï¼Œç´¢å¼•æ— æ³•ä½¿ç”¨
   SELECT * FROM orders WHERE UPPER(status) = 'PENDING';

   -- âœ… æ­£ç¡®ï¼šç›´æ¥ä½¿ç”¨åˆ—
   SELECT * FROM orders WHERE status = 'pending';
   ```

3. **ç´¢å¼•é€‰æ‹©æ€§å¤ªä½**:

   ```sql
   -- æ£€æŸ¥ç´¢å¼•é€‰æ‹©æ€§
   SELECT
       COUNT(DISTINCT status) AS distinct_values,
       COUNT(*) AS total_rows,
       COUNT(DISTINCT status)::FLOAT / COUNT(*) AS selectivity
   FROM orders;

   -- å¦‚æœé€‰æ‹©æ€§å¤ªä½ï¼ˆ< 0.01ï¼‰ï¼Œç´¢å¼•å¯èƒ½ä¸ä¼šè¢«ä½¿ç”¨
   ```

### 11.2 ç´¢å¼•è†¨èƒ€é—®é¢˜è¯Šæ–­

**é—®é¢˜**: ç´¢å¼•å ç”¨ç©ºé—´è¿‡å¤§ï¼Œå½±å“æ€§èƒ½

**è¯Šæ–­æ­¥éª¤**:

```sql
-- æ£€æŸ¥ç´¢å¼•è†¨èƒ€
SELECT
    schemaname,
    tablename,
    indexname,
    pg_size_pretty(pg_relation_size(indexrelid)) AS index_size,
    idx_scan,
    idx_tup_read,
    idx_tup_fetch
FROM pg_stat_user_indexes
WHERE schemaname = 'public'
ORDER BY pg_relation_size(indexrelid) DESC;

-- æ£€æŸ¥ç´¢å¼•è†¨èƒ€ç‡
SELECT
    schemaname,
    tablename,
    indexname,
    pg_size_pretty(pg_relation_size(indexrelid)) AS index_size,
    pg_size_pretty(pg_relation_size(indexrelid) -
                   (SELECT pg_relation_size(c.oid)
                    FROM pg_class c
                    WHERE c.relname = indexname)) AS wasted_space
FROM pg_stat_user_indexes
WHERE schemaname = 'public'
  AND pg_relation_size(indexrelid) > 100000000;  -- å¤§äº100MB
```

**è§£å†³æ–¹æ¡ˆ**:

```sql
-- é‡å»ºç´¢å¼•ï¼ˆä¼šé”å®šè¡¨ï¼‰
REINDEX INDEX idx_orders_customer;

-- å¹¶å‘é‡å»ºç´¢å¼•ï¼ˆä¸é”å®šè¡¨ï¼Œä½†æ›´æ…¢ï¼‰
REINDEX INDEX CONCURRENTLY idx_orders_customer;

-- æ‰¹é‡é‡å»ºè†¨èƒ€çš„ç´¢å¼•
DO $$
DECLARE
    r RECORD;
BEGIN
    FOR r IN
        SELECT indexrelid::regclass AS index_name
        FROM pg_stat_user_indexes
        WHERE schemaname = 'public'
          AND pg_relation_size(indexrelid) > 1000000000  -- å¤§äº1GB
    LOOP
        EXECUTE format('REINDEX INDEX CONCURRENTLY %s', r.index_name);
    END LOOP;
END $$;
```

### 11.3 ç´¢å¼•åˆ›å»ºå¤±è´¥é—®é¢˜è¯Šæ–­

**é—®é¢˜**: åˆ›å»ºç´¢å¼•å¤±è´¥æˆ–è¶…æ—¶

**è¯Šæ–­æ­¥éª¤**:

```sql
-- æ£€æŸ¥æ˜¯å¦æœ‰é”ç­‰å¾…
SELECT
    pid,
    locktype,
    relation::regclass,
    mode,
    granted
FROM pg_locks
WHERE relation::regclass::text LIKE '%orders%';

-- æ£€æŸ¥å½“å‰æ­£åœ¨åˆ›å»ºçš„ç´¢å¼•
SELECT
    pid,
    now() - query_start AS duration,
    state,
    query
FROM pg_stat_activity
WHERE query LIKE 'CREATE INDEX%'
   OR query LIKE 'REINDEX%';
```

**å¸¸è§åŸå› å’Œè§£å†³æ–¹æ¡ˆ**:

1. **è¡¨è¢«é”å®š**:

   ```sql
   -- æ£€æŸ¥é”
   SELECT * FROM pg_locks WHERE relation = 'orders'::regclass;

   -- ç»ˆæ­¢é˜»å¡çš„æŸ¥è¯¢
   SELECT pg_terminate_backend(pid) FROM pg_stat_activity WHERE pid = <blocking_pid>;
   ```

2. **ç£ç›˜ç©ºé—´ä¸è¶³**:

   ```sql
   -- æ£€æŸ¥ç£ç›˜ç©ºé—´
   SELECT pg_size_pretty(pg_database_size(current_database()));

   -- æ¸…ç†ä¸éœ€è¦çš„æ•°æ®
   VACUUM FULL orders;
   ```

3. **å†…å­˜ä¸è¶³**:

   ```sql
   -- å¢åŠ maintenance_work_mem
   SET maintenance_work_mem = '1GB';
   CREATE INDEX idx_orders_customer ON orders(customer_id);
   ```

### 11.4 ç´¢å¼•æ€§èƒ½é—®é¢˜è¯Šæ–­æ£€æŸ¥æ¸…å•

**ç´¢å¼•æœªä½¿ç”¨**:

- [ ] æ£€æŸ¥ç´¢å¼•æ˜¯å¦å­˜åœ¨
- [ ] æ£€æŸ¥ç»Ÿè®¡ä¿¡æ¯æ˜¯å¦æœ€æ–°ï¼ˆANALYZEï¼‰
- [ ] æ£€æŸ¥æŸ¥è¯¢æ¡ä»¶æ˜¯å¦åŒ¹é…ç´¢å¼•
- [ ] æ£€æŸ¥ç´¢å¼•é€‰æ‹©æ€§
- [ ] æ£€æŸ¥æ˜¯å¦æœ‰å‡½æ•°è°ƒç”¨ï¼ˆå¯¼è‡´ç´¢å¼•æ— æ³•ä½¿ç”¨ï¼‰
- [ ] æ£€æŸ¥æ•°æ®ç±»å‹æ˜¯å¦åŒ¹é…

**ç´¢å¼•æ€§èƒ½å·®**:

- [ ] æ£€æŸ¥ç´¢å¼•æ˜¯å¦è†¨èƒ€ï¼ˆREINDEXï¼‰
- [ ] æ£€æŸ¥ç´¢å¼•å¤§å°æ˜¯å¦åˆç†
- [ ] æ£€æŸ¥ç´¢å¼•ç¢ç‰‡ç‡
- [ ] æ£€æŸ¥ç´¢å¼•ä½¿ç”¨é¢‘ç‡ï¼ˆæœªä½¿ç”¨çš„ç´¢å¼•è€ƒè™‘åˆ é™¤ï¼‰
- [ ] æ£€æŸ¥æ˜¯å¦æœ‰æ›´å¥½çš„ç´¢å¼•ç±»å‹ï¼ˆGINã€GISTç­‰ï¼‰

**ç´¢å¼•åˆ›å»ºé—®é¢˜**:

- [ ] æ£€æŸ¥æ˜¯å¦æœ‰é”ç­‰å¾…
- [ ] æ£€æŸ¥ç£ç›˜ç©ºé—´æ˜¯å¦è¶³å¤Ÿ
- [ ] æ£€æŸ¥å†…å­˜é…ç½®ï¼ˆmaintenance_work_memï¼‰
- [ ] ä½¿ç”¨CONCURRENTLYé¿å…é”å®šè¡¨
- [ ] æ£€æŸ¥è¡¨å¤§å°ï¼ˆå¤§è¡¨éœ€è¦æ›´é•¿æ—¶é—´ï¼‰

---

## 12. å¸¸è§é—®é¢˜è§£ç­” / FAQ

### Q1: ä»€ä¹ˆæ—¶å€™åº”è¯¥åˆ›å»ºç´¢å¼•ï¼Ÿ

**A**: åº”è¯¥åœ¨ä»¥ä¸‹æƒ…å†µåˆ›å»ºç´¢å¼•ï¼š

- âœ… **é¢‘ç¹æŸ¥è¯¢**: WHEREã€JOINã€ORDER BYä¸­ç»å¸¸ä½¿ç”¨çš„åˆ—
- âœ… **é«˜é€‰æ‹©æ€§**: åˆ—å€¼å”¯ä¸€æˆ–æ¥è¿‘å”¯ä¸€
- âœ… **å¤–é”®åˆ—**: å¤–é”®åˆ—é€šå¸¸éœ€è¦ç´¢å¼•
- âœ… **æ’åºæŸ¥è¯¢**: ç»å¸¸ç”¨äºORDER BYçš„åˆ—

**ä¸åº”è¯¥åˆ›å»ºç´¢å¼•çš„æƒ…å†µ**:

- âŒ **å¾ˆå°‘æŸ¥è¯¢**: åˆ—å¾ˆå°‘å‡ºç°åœ¨WHEREæ¡ä»¶ä¸­
- âŒ **ä½é€‰æ‹©æ€§**: åˆ—å€¼é‡å¤åº¦å¾ˆé«˜ï¼ˆå¦‚æ€§åˆ«ã€çŠ¶æ€ï¼‰
- âŒ **é¢‘ç¹æ›´æ–°**: å†™å…¥é¢‘ç¹ä½†æŸ¥è¯¢å¾ˆå°‘çš„åˆ—
- âŒ **å°è¡¨**: è¡¨å¾ˆå°ï¼ˆ<1000è¡Œï¼‰ï¼Œå…¨è¡¨æ‰«ææ›´å¿«

### Q2: å¤åˆç´¢å¼•çš„åˆ—é¡ºåºå¦‚ä½•é€‰æ‹©ï¼Ÿ

**A**: å¤åˆç´¢å¼•åˆ—é¡ºåºåŸåˆ™ï¼š

1. **é«˜é€‰æ‹©æ€§åˆ—åœ¨å‰**: å”¯ä¸€æˆ–æ¥è¿‘å”¯ä¸€çš„åˆ—
2. **ç­‰å€¼æŸ¥è¯¢åˆ—åœ¨å‰**: WHERE column = valueçš„åˆ—
3. **èŒƒå›´æŸ¥è¯¢åˆ—åœ¨å**: WHERE column BETWEEN ...çš„åˆ—

**ç¤ºä¾‹**:

```sql
-- æŸ¥è¯¢ï¼šWHERE customer_id = ? AND order_date BETWEEN ? AND ?
-- âœ… æ­£ç¡®ï¼šç­‰å€¼åˆ—åœ¨å‰
CREATE INDEX idx_orders_customer_date ON orders(customer_id, order_date);

-- âŒ é”™è¯¯ï¼šèŒƒå›´åˆ—åœ¨å‰
CREATE INDEX idx_orders_date_customer ON orders(order_date, customer_id);
```

### Q3: éƒ¨åˆ†ç´¢å¼•ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ï¼Ÿ

**A**: éƒ¨åˆ†ç´¢å¼•é€‚ç”¨åœºæ™¯ï¼š

- âœ… **è¿‡æ»¤æ¡ä»¶**: æŸ¥è¯¢æ€»æ˜¯åŒ…å«ç‰¹å®šæ¡ä»¶
- âœ… **å‡å°‘ç´¢å¼•å¤§å°**: åªç´¢å¼•éƒ¨åˆ†æ•°æ®
- âœ… **æé«˜æ€§èƒ½**: ç´¢å¼•æ›´å°ï¼ŒæŸ¥è¯¢æ›´å¿«

**ç¤ºä¾‹**:

```sql
-- ä»…ç´¢å¼•æ´»è·ƒç”¨æˆ·
CREATE INDEX idx_users_active_email ON users(email) WHERE is_active = TRUE;

-- ä»…ç´¢å¼•æœªåˆ é™¤çš„è®¢å•
CREATE INDEX idx_orders_active ON orders(customer_id) WHERE deleted_at IS NULL;
```

### Q4: GINç´¢å¼•å’ŒGISTç´¢å¼•å¦‚ä½•é€‰æ‹©ï¼Ÿ

**A**: é€‰æ‹©åŸåˆ™ï¼š

| ç‰¹æ€§ | GIN | GIST |
|------|-----|------|
| JSONBæŸ¥è¯¢ | âœ… ä¼˜ç§€ | âš ï¸ ä¸€èˆ¬ |
| æ•°ç»„æŸ¥è¯¢ | âœ… ä¼˜ç§€ | âŒ |
| å…¨æ–‡æœç´¢ | âœ… ä¼˜ç§€ | âœ… è‰¯å¥½ |
| ç©ºé—´æŸ¥è¯¢ | âŒ | âœ… ä¼˜ç§€ |
| å†™å…¥æ€§èƒ½ | è¾ƒæ…¢ | è¾ƒå¿« |
| æŸ¥è¯¢æ€§èƒ½ | è¾ƒå¿« | è¾ƒå¿« |

**å»ºè®®**:

- JSONB/æ•°ç»„ â†’ ä½¿ç”¨GIN
- ç©ºé—´æ•°æ® â†’ ä½¿ç”¨GIST
- å…¨æ–‡æœç´¢ â†’ ä¼˜å…ˆGINï¼Œä¹Ÿå¯GIST

### Q5: BRINç´¢å¼•ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ï¼Ÿ

**A**: BRINç´¢å¼•é€‚ç”¨åœºæ™¯ï¼š

- âœ… **æ—¶é—´åºåˆ—æ•°æ®**: æŒ‰æ—¶é—´é¡ºåºå†™å…¥
- âœ… **è‡ªå¢ID**: æŒ‰IDé¡ºåºå†™å…¥
- âœ… **å¤§è¡¨**: è¡¨å¾ˆå¤§ï¼ˆTBçº§ï¼‰
- âœ… **èŒƒå›´æŸ¥è¯¢**: ç»å¸¸è¿›è¡ŒèŒƒå›´æŸ¥è¯¢

**ä¸é€‚ç”¨åœºæ™¯**:

- âŒ **éšæœºå†™å…¥**: æ•°æ®ä¸æ˜¯é¡ºåºå†™å…¥
- âŒ **ç­‰å€¼æŸ¥è¯¢**: ä¸»è¦è¿›è¡Œç­‰å€¼æŸ¥è¯¢
- âŒ **å°è¡¨**: è¡¨å¾ˆå°ï¼ŒB-Treeå·²è¶³å¤Ÿ

### Q6: ç´¢å¼•ä¼šå½±å“INSERTæ€§èƒ½å—ï¼Ÿ

**A**: ä¼šå½±å“ï¼Œä½†å½±å“ç¨‹åº¦ä¸åŒï¼š

- **B-Tree**: å½±å“è¾ƒå°ï¼ˆçº¦10-30%ï¼‰
- **GIN**: å½±å“è¾ƒå¤§ï¼ˆçº¦50-100%ï¼‰
- **BRIN**: å½±å“å¾ˆå°ï¼ˆ<5%ï¼‰
- **Hash**: å½±å“è¾ƒå°ï¼ˆçº¦10-20%ï¼‰

**ä¼˜åŒ–ç­–ç•¥**:

```sql
-- æ‰¹é‡æ’å…¥æ—¶ï¼Œä¸´æ—¶åˆ é™¤ç´¢å¼•
DROP INDEX idx_orders_customer;
-- æ‰¹é‡æ’å…¥
INSERT INTO orders ...;
-- é‡å»ºç´¢å¼•
CREATE INDEX idx_orders_customer ON orders(customer_id);
```

### Q7: å¦‚ä½•åˆ¤æ–­ç´¢å¼•æ˜¯å¦è¢«ä½¿ç”¨ï¼Ÿ

**A**: åˆ¤æ–­æ–¹æ³•ï¼š

1. **æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’**: `EXPLAIN (ANALYZE, BUFFERS, TIMING)`
2. **æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯**: `pg_stat_user_indexes`
3. **å¯ç”¨æ—¥å¿—**: `log_index_usage = on`

```sql
-- æ–¹æ³•1ï¼šæ‰§è¡Œè®¡åˆ’
EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT * FROM orders WHERE customer_id = 123;
-- å¦‚æœçœ‹åˆ°"Index Scan"ï¼Œè¯´æ˜ä½¿ç”¨äº†ç´¢å¼•

-- æ–¹æ³•2ï¼šç»Ÿè®¡ä¿¡æ¯
SELECT idx_scan FROM pg_stat_user_indexes
WHERE indexname = 'idx_orders_customer';
-- å¦‚æœidx_scan = 0ï¼Œè¯´æ˜ç´¢å¼•æœªä½¿ç”¨
```

### Q8: ç´¢å¼•å¯ä»¥è·¨è¡¨å—ï¼Ÿ

**A**:

- âŒ **æ™®é€šç´¢å¼•**: ä¸èƒ½è·¨è¡¨
- âœ… **è¡¨è¾¾å¼ç´¢å¼•**: å¯ä»¥ä½¿ç”¨å­æŸ¥è¯¢ï¼ˆä½†ä¸æ¨èï¼‰
- âœ… **ç‰©åŒ–è§†å›¾ç´¢å¼•**: å¯ä»¥åœ¨ç‰©åŒ–è§†å›¾ä¸Šåˆ›å»ºç´¢å¼•

**æ›¿ä»£æ–¹æ¡ˆ**:

```sql
-- ä½¿ç”¨ç‰©åŒ–è§†å›¾å®ç°"è·¨è¡¨ç´¢å¼•"
CREATE MATERIALIZED VIEW mv_order_summary AS
SELECT
    o.order_id,
    o.customer_id,
    c.customer_name,
    SUM(oi.quantity * oi.price) AS total_amount
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
JOIN order_items oi ON o.order_id = oi.order_id
GROUP BY o.order_id, o.customer_id, c.customer_name;

CREATE INDEX ON mv_order_summary(customer_id);
CREATE INDEX ON mv_order_summary(total_amount);
```

### Q9: å¦‚ä½•ä¼˜åŒ–ç´¢å¼•å¤§å°ï¼Ÿ

**A**: ä¼˜åŒ–ç­–ç•¥ï¼š

1. **ä½¿ç”¨éƒ¨åˆ†ç´¢å¼•**: åªç´¢å¼•éœ€è¦çš„è¡Œ
2. **ä½¿ç”¨è¡¨è¾¾å¼ç´¢å¼•**: ç´¢å¼•è¡¨è¾¾å¼è€Œéå®Œæ•´åˆ—
3. **åˆ é™¤æœªä½¿ç”¨çš„ç´¢å¼•**: å®šæœŸæ¸…ç†
4. **ä½¿ç”¨BRIN**: å¯¹äºæœ‰åºæ•°æ®ä½¿ç”¨BRIN

```sql
-- ç­–ç•¥1ï¼šéƒ¨åˆ†ç´¢å¼•
CREATE INDEX idx_active_users ON users(email) WHERE is_active = TRUE;

-- ç­–ç•¥2ï¼šè¡¨è¾¾å¼ç´¢å¼•ï¼ˆç´¢å¼•å“ˆå¸Œå€¼è€Œéå®Œæ•´æ–‡æœ¬ï¼‰
CREATE INDEX idx_users_email_hash ON users(md5(email));

-- ç­–ç•¥3ï¼šåˆ é™¤æœªä½¿ç”¨ç´¢å¼•
DROP INDEX idx_unused_index;
```

### Q10: ç´¢å¼•ç»´æŠ¤çš„æœ€ä½³å®è·µï¼Ÿ

**A**: ç»´æŠ¤å»ºè®®ï¼š

1. **å®šæœŸREINDEX**: é‡å»ºç´¢å¼•å›æ”¶ç©ºé—´
2. **ç›‘æ§ç´¢å¼•ä½¿ç”¨**: åˆ é™¤æœªä½¿ç”¨çš„ç´¢å¼•
3. **æ›´æ–°ç»Ÿè®¡ä¿¡æ¯**: å®šæœŸANALYZE
4. **ä½¿ç”¨CONCURRENTLY**: é¿å…é˜»å¡æ“ä½œ

```sql
-- å®šæœŸç»´æŠ¤è„šæœ¬
DO $$
DECLARE
    r RECORD;
BEGIN
    -- é‡å»ºè†¨èƒ€çš„ç´¢å¼•
    FOR r IN
        SELECT indexrelid::regclass AS index_name
        FROM pg_stat_user_indexes
        WHERE schemaname = 'public'
          AND pg_relation_size(indexrelid) > 1000000000  -- å¤§äº1GB
    LOOP
        EXECUTE format('REINDEX INDEX CONCURRENTLY %s', r.index_name);
    END LOOP;

    -- æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    ANALYZE;
END $$;
```

---

## 13. PostgreSQL 18ç´¢å¼•å¢å¼º / PostgreSQL 18 Index Enhancements

### 13.1 B-Treeç´¢å¼•æ€§èƒ½æ”¹è¿›

**PostgreSQL 18æ”¹è¿›**: B-Treeç´¢å¼•æ’å…¥å’ŒæŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–

```sql
-- PostgreSQL 18æ”¹è¿›äº†B-Treeç´¢å¼•çš„æ’å…¥å’ŒæŸ¥è¯¢æ€§èƒ½
CREATE INDEX idx_orders_date ON orders(order_date);
-- æ’å…¥æ€§èƒ½æå‡çº¦10-15%
-- æŸ¥è¯¢æ€§èƒ½æå‡çº¦5-10%

-- æ€§èƒ½å¯¹æ¯”æµ‹è¯•ï¼ˆ100ä¸‡è¡Œæ•°æ®ï¼‰
-- PostgreSQL 17: æ’å…¥æ—¶é—´ 8000msï¼ŒæŸ¥è¯¢æ—¶é—´ 2.5ms
-- PostgreSQL 18: æ’å…¥æ—¶é—´ 6800msï¼ŒæŸ¥è¯¢æ—¶é—´ 2.3ms
```

### 13.2 REINDEX CONCURRENTLYæ”¹è¿›

**æ–°ç‰¹æ€§**: REINDEX CONCURRENTLYæ€§èƒ½ä¼˜åŒ–

```sql
-- PostgreSQL 18æ”¹è¿›äº†REINDEX CONCURRENTLYçš„æ€§èƒ½
REINDEX INDEX CONCURRENTLY idx_orders_date;
-- æ‰§è¡Œé€Ÿåº¦æå‡çº¦20-30%
-- å¯¹ç³»ç»Ÿå½±å“æ›´å°
-- é”ç­‰å¾…æ—¶é—´å‡å°‘çº¦40%

-- æ€§èƒ½å¯¹æ¯”ï¼ˆ1GBç´¢å¼•ï¼‰
-- PostgreSQL 17: REINDEXæ—¶é—´ 150sï¼Œé”ç­‰å¾… 30s
-- PostgreSQL 18: REINDEXæ—¶é—´ 105sï¼Œé”ç­‰å¾… 18s
```

### 13.3 GINç´¢å¼•å¹¶è¡Œæ„å»º â­

**æ–°ç‰¹æ€§**: PostgreSQL 18æ”¯æŒGINç´¢å¼•å¹¶è¡Œæ„å»ºï¼Œå¤§å¹…æå‡å…¨æ–‡æœç´¢å’Œå‘é‡ç´¢å¼•çš„åˆ›å»ºé€Ÿåº¦ã€‚

```sql
-- PostgreSQL 18ï¼šGINç´¢å¼•å¹¶è¡Œæ„å»ºé…ç½®ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
DO $$
BEGIN
    -- è®¾ç½®å¹¶è¡Œå·¥ä½œè¿›ç¨‹æ•°ï¼ˆæ¨èï¼šCPUæ ¸å¿ƒæ•°çš„50-75%ï¼‰
    ALTER SYSTEM SET max_parallel_maintenance_workers = 8;
    PERFORM pg_reload_conf();
    RAISE NOTICE 'GINå¹¶è¡Œæ„å»ºå·²é…ç½®ï¼ˆ8ä¸ªå·¥ä½œè¿›ç¨‹ï¼‰';
EXCEPTION
    WHEN OTHERS THEN
        RAISE NOTICE 'é…ç½®GINå¹¶è¡Œæ„å»ºå¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;
END $$;
COMMIT;

-- åˆ›å»ºGINç´¢å¼•ï¼ˆè‡ªåŠ¨ä½¿ç”¨å¹¶è¡Œæ„å»ºï¼‰
CREATE INDEX CONCURRENTLY idx_documents_search_vector_parallel
ON documents USING GIN (search_vector);

-- æ€§èƒ½å¯¹æ¯”ï¼ˆ100ä¸‡æ–‡æ¡£ï¼Œ8çº¿ç¨‹ï¼‰ï¼š
-- PostgreSQL 17: 45åˆ†é’Ÿï¼ˆå•çº¿ç¨‹ï¼‰
-- PostgreSQL 18: 12åˆ†é’Ÿï¼ˆ8çº¿ç¨‹ï¼Œ-73%æ€§èƒ½æå‡ï¼‰â­

-- å…¨æ–‡æœç´¢ç´¢å¼•å¹¶è¡Œæ„å»º
CREATE INDEX CONCURRENTLY idx_products_name_fts_parallel
ON products USING GIN (to_tsvector('english', name));

-- JSONBç´¢å¼•å¹¶è¡Œæ„å»º
CREATE INDEX CONCURRENTLY idx_products_attributes_gin_parallel
ON products USING GIN (attributes);
```

**åœ¨æ•°æ®å»ºæ¨¡ä¸­çš„åº”ç”¨**:

1. **å…¨æ–‡æœç´¢å»ºæ¨¡**:
   - æ–‡æ¡£æœç´¢ç³»ç»Ÿç´¢å¼•æ„å»ºé€Ÿåº¦æå‡3-4å€
   - å‡å°‘ç´¢å¼•åˆ›å»ºå¯¹ç³»ç»Ÿçš„å½±å“
   - æ”¯æŒæ›´å¤§è§„æ¨¡çš„å…¨æ–‡æœç´¢åº”ç”¨

2. **å‘é‡æ•°æ®åº“å»ºæ¨¡**:
   - pgvector HNSWç´¢å¼•æ„å»ºé€Ÿåº¦æå‡
   - æ”¯æŒå¤§è§„æ¨¡å‘é‡ç´¢å¼•åˆ›å»º
   - å‡å°‘ç´¢å¼•åˆ›å»ºæ—¶é—´

3. **JSONBç´¢å¼•å»ºæ¨¡**:
   - JSONBå­—æ®µç´¢å¼•æ„å»ºé€Ÿåº¦æå‡
   - æ”¯æŒå¤æ‚JSONBæŸ¥è¯¢åœºæ™¯

**æ€§èƒ½æå‡æ•°æ®**:

| ç´¢å¼•ç±»å‹ | PostgreSQL 17 | PostgreSQL 18ï¼ˆ8çº¿ç¨‹ï¼‰ | æå‡ |
|---------|--------------|---------------------|------|
| **å…¨æ–‡æœç´¢GIN** | 45åˆ†é’Ÿ | **12åˆ†é’Ÿ** | **-73%** â­ |
| **JSONB GIN** | 30åˆ†é’Ÿ | **8åˆ†é’Ÿ** | **-73%** â­ |
| **å‘é‡HNSW** | 60åˆ†é’Ÿ | **15åˆ†é’Ÿ** | **-75%** â­ |

**ç›¸å…³æ–‡æ¡£**:

- [PostgreSQL18æ–°ç‰¹æ€§](./PostgreSQL18æ–°ç‰¹æ€§.md) - GINå¹¶è¡Œæ„å»ºè¯¦ç»†è¯´æ˜
- [å…¨æ–‡æœç´¢ç´¢å¼•æ¨¡å¼](#63-å…¨æ–‡æœç´¢ç´¢å¼•æ¨¡å¼) - å…¨æ–‡æœç´¢ç´¢å¼•å»ºæ¨¡

### 13.4 ç´¢å¼•åˆ›å»ºè¿›åº¦ç›‘æ§

**æ–°ç‰¹æ€§**: æ–°å¢ç´¢å¼•åˆ›å»ºè¿›åº¦è§†å›¾

```sql
-- PostgreSQL 18æ–°å¢äº†ç´¢å¼•åˆ›å»ºè¿›åº¦ç›‘æ§
SELECT * FROM pg_stat_progress_create_index;
-- æ˜¾ç¤ºç´¢å¼•åˆ›å»ºçš„è¯¦ç»†è¿›åº¦ä¿¡æ¯
-- åŒ…æ‹¬ï¼šç´¢å¼•åç§°ã€è¡¨åç§°ã€å½“å‰é˜¶æ®µã€è¿›åº¦ç™¾åˆ†æ¯”ç­‰

-- ç¤ºä¾‹è¾“å‡º
-- index_relid | command | phase | tuples_total | tuples_done | partitions_total | partitions_done
-- orders_idx  | CREATE INDEX CONCURRENTLY | building index | 1000000 | 500000 | 0 | 0
```

**ç›¸å…³æ–‡æ¡£**: è¯¦ç»†çš„æ–°ç‰¹æ€§è¯´æ˜è¯·å‚è€ƒ [PostgreSQL18æ–°ç‰¹æ€§æ–‡æ¡£](./PostgreSQL18æ–°ç‰¹æ€§.md)

---

## 14. ç›¸å…³èµ„æº / Related Resources

### 11.1 æ ¸å¿ƒç›¸å…³æ–‡æ¡£ / Core Related Documents

- [æ•°æ®ç±»å‹é€‰æ‹©](./æ•°æ®ç±»å‹é€‰æ‹©.md) - æ•°æ®ç±»å‹ä¸ç´¢å¼•é€‰æ‹©
- [åˆ†åŒºç­–ç•¥](./åˆ†åŒºç­–ç•¥.md) - åˆ†åŒºè¡¨ç´¢å¼•ç­–ç•¥
- [æ€§èƒ½ä¼˜åŒ–](./æ€§èƒ½ä¼˜åŒ–.md) - æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–
- [çº¦æŸè®¾è®¡](./çº¦æŸè®¾è®¡.md) - çº¦æŸç´¢å¼•ä¼˜åŒ–

### 11.2 ç†è®ºåŸºç¡€ / Theoretical Foundation

- [èŒƒå¼ç†è®º](../01-æ•°æ®å»ºæ¨¡ç†è®ºåŸºç¡€/èŒƒå¼ç†è®º.md) - æ•°æ®åº“è®¾è®¡ç†è®º
- [å…³ç³»ä»£æ•°](../01-æ•°æ®å»ºæ¨¡ç†è®ºåŸºç¡€/å…³ç³»ä»£æ•°.md) - æŸ¥è¯¢ä¼˜åŒ–åŸºç¡€

### 11.3 å®è·µæŒ‡å— / Practical Guides

- [ç´¢å¼•ç›‘æ§å’Œè¯Šæ–­](#8-ç´¢å¼•ç›‘æ§å’Œè¯Šæ–­--index-monitoring-and-diagnostics) - æœ¬æ–‡æ¡£çš„ç›‘æ§ç« èŠ‚
- [ç´¢å¼•æ€§èƒ½åˆ†æ](#9-ç´¢å¼•æ€§èƒ½åˆ†æ--index-performance-analysis) - æœ¬æ–‡æ¡£çš„æ€§èƒ½åˆ†æç« èŠ‚

### 11.4 åº”ç”¨æ¡ˆä¾‹ / Application Cases

- [Partyæ¨¡å‹](../04-OLTPå»ºæ¨¡/Partyæ¨¡å‹.md) - Partyæ¨¡å‹ç´¢å¼•è®¾è®¡æ¡ˆä¾‹
- [è®¢å•ç®¡ç†æ¨¡å‹](../04-OLTPå»ºæ¨¡/è®¢å•ç®¡ç†æ¨¡å‹.md) - è®¢å•æ¨¡å‹ç´¢å¼•è®¾è®¡æ¡ˆä¾‹
- [æ—¶åºæ•°æ®æ¨¡å‹](../06-IoTä¸æ—¶åºå»ºæ¨¡/æ—¶åºæ•°æ®æ¨¡å‹.md) - æ—¶åºæ•°æ®ç´¢å¼•è®¾è®¡æ¡ˆä¾‹

### 11.5 å‚è€ƒèµ„æº / Reference Resources

- [æƒå¨èµ„æºç´¢å¼•](../00-å¯¼èˆªä¸ç´¢å¼•/æƒå¨èµ„æºç´¢å¼•.md) - æƒå¨èµ„æºåˆ—è¡¨
- [å¿«é€ŸæŸ¥æ‰¾æŒ‡å—](../00-å¯¼èˆªä¸ç´¢å¼•/å¿«é€ŸæŸ¥æ‰¾æŒ‡å—.md) - å¿«é€ŸæŸ¥æ‰¾å·¥å…·
- PostgreSQLå®˜æ–¹æ–‡æ¡£: [Indexes](https://www.postgresql.org/docs/current/indexes.html)
- PostgreSQLå®˜æ–¹æ–‡æ¡£: [Index Types](https://www.postgresql.org/docs/current/indexes-types.html)

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
