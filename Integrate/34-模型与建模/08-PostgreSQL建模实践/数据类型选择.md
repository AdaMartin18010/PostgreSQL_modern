# PostgreSQLæ•°æ®ç±»å‹é€‰æ‹©å®Œæ•´æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æ¥æº**: PostgreSQLå®˜æ–¹æ–‡æ¡£ + å®è·µæ€»ç»“
> **çŠ¶æ€**: åŸºäºPostgreSQL 17+/18+ç‰¹æ€§
> **æ–‡æ¡£ç¼–å·**: 08-01

---

## ğŸ“‘ ç›®å½•

- [1. æ¦‚è¿°](#1-æ¦‚è¿°)
- [2. æ•°å€¼ç±»å‹](#2-æ•°å€¼ç±»å‹)
  - [2.1 æ•´æ•°ç±»å‹](#21-æ•´æ•°ç±»å‹)
  - [2.2 ç²¾ç¡®æ•°å€¼ç±»å‹](#22-ç²¾ç¡®æ•°å€¼ç±»å‹)
  - [2.3 æµ®ç‚¹ç±»å‹](#23-æµ®ç‚¹ç±»å‹)
- [3. å­—ç¬¦ä¸²ç±»å‹](#3-å­—ç¬¦ä¸²ç±»å‹)
  - [3.1 å›ºå®šé•¿åº¦ vs å¯å˜é•¿åº¦](#31-å›ºå®šé•¿åº¦-vs-å¯å˜é•¿åº¦)
  - [3.2 å­—ç¬¦ä¸²ç¼–ç ](#32-å­—ç¬¦ä¸²ç¼–ç )
- [4. æ—¥æœŸæ—¶é—´ç±»å‹](#4-æ—¥æœŸæ—¶é—´ç±»å‹)
  - [4.1 æ—¶é—´æˆ³ç±»å‹](#41-æ—¶é—´æˆ³ç±»å‹)
  - [4.2 æ—¶é—´é—´éš”ç±»å‹](#42-æ—¶é—´é—´éš”ç±»å‹)
- [5. JSONç±»å‹](#5-jsonç±»å‹)
  - [5.1 JSON vs JSONB](#51-json-vs-jsonb)
- [6. æ•°ç»„ç±»å‹](#6-æ•°ç»„ç±»å‹)
- [7. å¸ƒå°”ç±»å‹](#7-å¸ƒå°”ç±»å‹)
- [8. ç½‘ç»œåœ°å€ç±»å‹](#8-ç½‘ç»œåœ°å€ç±»å‹)
- [9. å‡ ä½•ç±»å‹ï¼ˆPostGISï¼‰](#9-å‡ ä½•ç±»å‹postgis)
- [10. UUIDç±»å‹](#10-uuidç±»å‹)
- [11. æ•°æ®ç±»å‹é€‰æ‹©å†³ç­–æ ‘](#11-æ•°æ®ç±»å‹é€‰æ‹©å†³ç­–æ ‘)
- [12. å¸¸è§åœºæ™¯ç±»å‹é€‰æ‹©](#12-å¸¸è§åœºæ™¯ç±»å‹é€‰æ‹©)
- [13. å¸¸è§é”™è¯¯ä¸é¿å…](#13-å¸¸è§é”™è¯¯ä¸é¿å…)
- [14. ç›¸å…³èµ„æº](#14-ç›¸å…³èµ„æº)

---

## 1. æ¦‚è¿°

PostgreSQLæä¾›äº†43ç§å†…ç½®æ•°æ®ç±»å‹ï¼Œä»¥åŠè‡ªå®šä¹‰ç±»å‹ã€æ•°ç»„ã€JSONBç­‰é«˜çº§ç‰¹æ€§ã€‚
æ­£ç¡®é€‰æ‹©æ•°æ®ç±»å‹å¯¹æ•°æ®å»ºæ¨¡è‡³å…³é‡è¦ï¼Œå½±å“å­˜å‚¨æ•ˆç‡ã€æŸ¥è¯¢æ€§èƒ½å’ŒåŠŸèƒ½å®Œæ•´æ€§ã€‚

---

## 2. æ•°å€¼ç±»å‹

### 2.1 æ•´æ•°ç±»å‹

| ç±»å‹ | å­˜å‚¨ç©ºé—´ | èŒƒå›´ | ä½¿ç”¨åœºæ™¯ |
|------|---------|------|---------|
| `SMALLINT` | 2å­—èŠ‚ | -32,768 åˆ° 32,767 | å¹´é¾„ã€æ•°é‡ï¼ˆå°èŒƒå›´ï¼‰ |
| `INTEGER` / `INT` | 4å­—èŠ‚ | -2,147,483,648 åˆ° 2,147,483,647 | ä¸»é”®ã€å¤–é”®ã€è®¡æ•°å™¨ |
| `BIGINT` | 8å­—èŠ‚ | -9,223,372,036,854,775,808 åˆ° 9,223,372,036,854,775,807 | å¤§æ•°å€¼ã€æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ |
| `SERIAL` | 4å­—èŠ‚ | 1 åˆ° 2,147,483,647 | è‡ªå¢ä¸»é”® |
| `BIGSERIAL` | 8å­—èŠ‚ | 1 åˆ° 9,223,372,036,854,775,807 | å¤§è¡¨è‡ªå¢ä¸»é”® |

**é€‰æ‹©å»ºè®®**:

- ä¸»é”®ï¼šä¼˜å…ˆä½¿ç”¨`BIGSERIAL`ï¼ˆæœªæ¥æ‰©å±•æ€§ï¼‰
- å¤–é”®ï¼šä¸ä¸»é”®ç±»å‹ä¸€è‡´
- è®¡æ•°å™¨ï¼šæ ¹æ®æœ€å¤§å€¼é€‰æ‹©`INT`æˆ–`BIGINT`

**ç¤ºä¾‹**:

```sql
CREATE TABLE users (
    user_id BIGSERIAL PRIMARY KEY,  -- æ¨èï¼šBIGSERIAL
    age SMALLINT CHECK (age >= 0 AND age <= 150),
    login_count INT DEFAULT 0,
    total_points BIGINT DEFAULT 0
);
```

---

### 2.2 ç²¾ç¡®æ•°å€¼ç±»å‹

**`NUMERIC(p, s)` / `DECIMAL(p, s)`**:

- **p**: ç²¾åº¦ï¼ˆæ€»ä½æ•°ï¼Œ1-131072ï¼‰
- **s**: æ ‡åº¦ï¼ˆå°æ•°ä½æ•°ï¼Œ0-pï¼‰
- **å­˜å‚¨**: å˜é•¿ï¼Œæ¯4ä½æ•°å­—2å­—èŠ‚

**ä½¿ç”¨åœºæ™¯**: é‡‘èé‡‘é¢ã€ç§‘å­¦è®¡ç®—ï¼ˆéœ€è¦ç²¾ç¡®ç²¾åº¦ï¼‰

**ç¤ºä¾‹**:

```sql
CREATE TABLE orders (
    order_id BIGSERIAL PRIMARY KEY,
    amount NUMERIC(10,2) NOT NULL,        -- é‡‘é¢ï¼š99999999.99
    tax_rate NUMERIC(5,4) DEFAULT 0.0000, -- ç¨ç‡ï¼š0.0000-9.9999
    discount NUMERIC(10,2) DEFAULT 0.00
);

-- è®¡ç®—ç¤ºä¾‹ï¼ˆç²¾ç¡®è®¡ç®—ï¼‰
SELECT
    amount,
    amount * tax_rate AS tax,
    amount - discount AS final_amount
FROM orders;
```

---

### 2.3 æµ®ç‚¹ç±»å‹

| ç±»å‹ | å­˜å‚¨ç©ºé—´ | ç²¾åº¦ | ä½¿ç”¨åœºæ™¯ |
|------|---------|------|---------|
| `REAL` | 4å­—èŠ‚ | 6ä½å°æ•° | ç§‘å­¦è®¡ç®—ï¼ˆå¯æ¥å—è¯¯å·®ï¼‰ |
| `DOUBLE PRECISION` | 8å­—èŠ‚ | 15ä½å°æ•° | ç§‘å­¦è®¡ç®—ã€ç»Ÿè®¡ |

**æ³¨æ„**: æµ®ç‚¹ç±»å‹æœ‰ç²¾åº¦æŸå¤±ï¼Œé‡‘èåœºæ™¯é¿å…ä½¿ç”¨ã€‚

**ç¤ºä¾‹**:

```sql
-- âŒ é”™è¯¯ï¼šé‡‘èé‡‘é¢ä½¿ç”¨æµ®ç‚¹
CREATE TABLE bad_orders (
    amount DOUBLE PRECISION  -- ç²¾åº¦æŸå¤±é£é™©
);

-- âœ… æ­£ç¡®ï¼šä½¿ç”¨NUMERIC
CREATE TABLE good_orders (
    amount NUMERIC(10,2)  -- ç²¾ç¡®è®¡ç®—
);
```

---

## 3. å­—ç¬¦ä¸²ç±»å‹

### 3.1 å›ºå®šé•¿åº¦ vs å¯å˜é•¿åº¦

| ç±»å‹ | ç‰¹ç‚¹ | ä½¿ç”¨åœºæ™¯ |
|------|------|---------|
| `CHAR(n)` | å›ºå®šé•¿åº¦ï¼Œä¸è¶³è¡¥ç©ºæ ¼ | å¾ˆå°‘ä½¿ç”¨ |
| `VARCHAR(n)` | å¯å˜é•¿åº¦ï¼Œæœ€å¤§nå­—ç¬¦ | å·²çŸ¥æœ€å¤§é•¿åº¦çš„å­—æ®µ |
| `TEXT` | æ— é•¿åº¦é™åˆ¶ | æ¨èï¼šå¤§å¤šæ•°æ–‡æœ¬å­—æ®µ |

**é€‰æ‹©å»ºè®®**:

- **ä¼˜å…ˆä½¿ç”¨`TEXT`**: PostgreSQLå†…éƒ¨ä¼˜åŒ–ï¼Œæ€§èƒ½ä¸VARCHARç›¸å½“
- **VARCHAR(n)**: ä»…å½“éœ€è¦æ•°æ®åº“å±‚é•¿åº¦é™åˆ¶æ—¶ä½¿ç”¨
- **é¿å…CHAR(n)**: æµªè´¹å­˜å‚¨ç©ºé—´

**ç¤ºä¾‹**:

```sql
CREATE TABLE products (
    product_id BIGSERIAL PRIMARY KEY,
    sku VARCHAR(50) UNIQUE NOT NULL,      -- æœ‰é•¿åº¦é™åˆ¶
    name TEXT NOT NULL,                   -- æ¨èï¼šæ— é™åˆ¶
    description TEXT,                     -- é•¿æ–‡æœ¬
    short_code CHAR(10)                   -- å›ºå®šé•¿åº¦ä»£ç 
);
```

---

### 3.2 å­—ç¬¦ä¸²ç¼–ç 

**PostgreSQLæ”¯æŒå¤šç§å­—ç¬¦é›†**:

- `UTF8`: æ¨èï¼Œæ”¯æŒæ‰€æœ‰Unicodeå­—ç¬¦
- `LATIN1`: ä»…è¥¿æ¬§å­—ç¬¦
- `SQL_ASCII`: ä¸æ¨è

**è®¾ç½®å­—ç¬¦é›†**:

```sql
-- æ•°æ®åº“çº§åˆ«
CREATE DATABASE mydb WITH ENCODING 'UTF8';

-- åˆ—çº§åˆ«
CREATE TABLE users (
    name TEXT COLLATE "en_US.utf8",
    email TEXT COLLATE "C"  -- C collationï¼šå¤§å°å†™æ•æ„Ÿ
);
```

---

## 4. æ—¥æœŸæ—¶é—´ç±»å‹

### 4.1 æ—¶é—´æˆ³ç±»å‹

| ç±»å‹ | å­˜å‚¨ç©ºé—´ | ç²¾åº¦ | æ—¶åŒº | ä½¿ç”¨åœºæ™¯ |
|------|---------|------|------|---------|
| `TIMESTAMP` | 8å­—èŠ‚ | å¾®ç§’ | æ— æ—¶åŒº | æœ¬åœ°æ—¶é—´ï¼ˆä¸æ¨èï¼‰ |
| `TIMESTAMPTZ` | 8å­—èŠ‚ | å¾®ç§’ | æœ‰æ—¶åŒº | **æ¨è**ï¼šæ‰€æœ‰æ—¶é—´æˆ³ |
| `DATE` | 4å­—èŠ‚ | å¤© | N/A | æ—¥æœŸï¼ˆæ— æ—¶é—´ï¼‰ |
| `TIME` | 8å­—èŠ‚ | å¾®ç§’ | æ— æ—¶åŒº | æ—¶é—´ï¼ˆæ— æ—¥æœŸï¼‰ |
| `TIMETZ` | 12å­—èŠ‚ | å¾®ç§’ | æœ‰æ—¶åŒº | æ—¶é—´+æ—¶åŒº |

**é€‰æ‹©å»ºè®®**:

- **ä¼˜å…ˆä½¿ç”¨`TIMESTAMPTZ`**: è‡ªåŠ¨å¤„ç†æ—¶åŒºè½¬æ¢
- **é¿å…`TIMESTAMP`**: æ—¶åŒºé—®é¢˜å¯¼è‡´æ•°æ®ä¸ä¸€è‡´

**ç¤ºä¾‹**:

```sql
CREATE TABLE events (
    event_id BIGSERIAL PRIMARY KEY,
    created_at TIMESTAMPTZ DEFAULT NOW(),  -- æ¨èï¼šå¸¦æ—¶åŒº
    event_date DATE NOT NULL,              -- ä»…æ—¥æœŸ
    start_time TIMESTAMPTZ NOT NULL,
    end_time TIMESTAMPTZ NOT NULL,
    CHECK (end_time > start_time)
);

-- æ—¶åŒºè½¬æ¢ç¤ºä¾‹
SELECT
    created_at AT TIME ZONE 'UTC' AS utc_time,
    created_at AT TIME ZONE 'Asia/Shanghai' AS beijing_time
FROM events;
```

---

### 4.2 æ—¶é—´é—´éš”ç±»å‹

**`INTERVAL`**: å­˜å‚¨æ—¶é—´é—´éš”

**ç¤ºä¾‹**:

```sql
CREATE TABLE subscriptions (
    subscription_id BIGSERIAL PRIMARY KEY,
    start_date DATE NOT NULL,
    duration INTERVAL NOT NULL,  -- å¦‚ï¼š'1 year', '30 days'
    end_date DATE GENERATED ALWAYS AS (start_date + duration) STORED
);

INSERT INTO subscriptions (start_date, duration)
VALUES ('2024-01-01', INTERVAL '1 year');
```

---

## 5. JSONç±»å‹

### 5.1 JSON vs JSONB

| ç‰¹æ€§ | JSON | JSONB |
|------|------|-------|
| **å­˜å‚¨** | æ–‡æœ¬æ ¼å¼ | äºŒè¿›åˆ¶æ ¼å¼ |
| **å†™å…¥é€Ÿåº¦** | å¿« | è¾ƒæ…¢ï¼ˆéœ€è§£æï¼‰ |
| **æŸ¥è¯¢é€Ÿåº¦** | æ…¢ï¼ˆéœ€è§£æï¼‰ | **å¿«**ï¼ˆæœ‰ç´¢å¼•ï¼‰ |
| **ç´¢å¼•æ”¯æŒ** | âŒ | âœ… GINç´¢å¼• |
| **æ¨è** | âŒ | âœ… **ä¼˜å…ˆä½¿ç”¨** |

**é€‰æ‹©å»ºè®®**: **ä¼˜å…ˆä½¿ç”¨`JSONB`**ï¼Œé™¤ééœ€è¦ä¿ç•™JSONæ ¼å¼ã€‚

**ç¤ºä¾‹**:

```sql
CREATE TABLE products (
    product_id BIGSERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    attributes JSONB,  -- æ¨èï¼šJSONB
    metadata JSONB,
    raw_json JSON      -- ä»…å½“éœ€è¦ä¿ç•™æ ¼å¼æ—¶ä½¿ç”¨
);

-- JSONBæ“ä½œç¬¦
SELECT
    product_id,
    name,
    attributes->>'color' AS color,           -- è·å–æ–‡æœ¬å€¼
    attributes->'price' AS price_json,       -- è·å–JSONå€¼
    attributes->>'price'::NUMERIC AS price, -- ç±»å‹è½¬æ¢
    attributes @> '{"color": "red"}' AS is_red  -- åŒ…å«æ£€æŸ¥
FROM products
WHERE attributes ? 'color';  -- é”®å­˜åœ¨æ£€æŸ¥

-- GINç´¢å¼•ä¼˜åŒ–JSONBæŸ¥è¯¢
CREATE INDEX idx_products_attributes_gin ON products USING GIN (attributes);
CREATE INDEX idx_products_attributes_gin_path ON products USING GIN ((attributes->'tags'));
```

---

## 6. æ•°ç»„ç±»å‹

**PostgreSQLæ”¯æŒä»»æ„ç±»å‹çš„æ•°ç»„**ã€‚

**ç¤ºä¾‹**:

```sql
CREATE TABLE products (
    product_id BIGSERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    tags TEXT[],                    -- æ–‡æœ¬æ•°ç»„
    prices NUMERIC(10,2)[],         -- æ•°å€¼æ•°ç»„
    images JSONB[],                 -- JSONBæ•°ç»„
    dimensions INTEGER[3]           -- å›ºå®šé•¿åº¦æ•°ç»„ï¼ˆ3ç»´ï¼‰
);

-- æ’å…¥æ•°ç»„
INSERT INTO products (name, tags, prices)
VALUES (
    'Laptop',
    ARRAY['electronics', 'computers', 'laptops'],
    ARRAY[999.99, 899.99, 799.99]
);

-- æ•°ç»„æŸ¥è¯¢
SELECT
    name,
    tags,
    tags[1] AS first_tag,           -- è®¿é—®å…ƒç´ 
    array_length(tags, 1) AS tag_count,  -- æ•°ç»„é•¿åº¦
    unnest(tags) AS tag             -- å±•å¼€æ•°ç»„
FROM products
WHERE 'electronics' = ANY(tags);    -- åŒ…å«æ£€æŸ¥

-- æ•°ç»„æ“ä½œç¬¦
SELECT * FROM products
WHERE tags @> ARRAY['electronics'];  -- åŒ…å«æ•°ç»„
WHERE tags && ARRAY['electronics', 'phones'];  -- é‡å 
WHERE tags <@ ARRAY['electronics', 'computers'];  -- è¢«åŒ…å«

-- æ•°ç»„ç´¢å¼•ï¼ˆGINï¼‰
CREATE INDEX idx_products_tags_gin ON products USING GIN (tags);
```

---

## 7. å¸ƒå°”ç±»å‹

**`BOOLEAN`**: å­˜å‚¨true/false/null

**ç¤ºä¾‹**:

```sql
CREATE TABLE users (
    user_id BIGSERIAL PRIMARY KEY,
    is_active BOOLEAN DEFAULT TRUE,
    is_verified BOOLEAN DEFAULT FALSE,
    is_premium BOOLEAN DEFAULT FALSE
);

-- å¸ƒå°”æŸ¥è¯¢
SELECT * FROM users
WHERE is_active = TRUE;        -- æ˜¾å¼æ¯”è¾ƒ
WHERE is_active;               -- ç®€å†™ï¼ˆæ¨èï¼‰
WHERE NOT is_active;           -- å–å
WHERE is_active IS NULL;       -- NULLæ£€æŸ¥
```

---

## 8. ç½‘ç»œåœ°å€ç±»å‹

| ç±»å‹ | å­˜å‚¨ç©ºé—´ | ä½¿ç”¨åœºæ™¯ |
|------|---------|---------|
| `INET` | 7æˆ–19å­—èŠ‚ | IPv4/IPv6åœ°å€ |
| `CIDR` | 7æˆ–19å­—èŠ‚ | ç½‘ç»œåœ°å€æ®µ |
| `MACADDR` | 6å­—èŠ‚ | MACåœ°å€ |

**ç¤ºä¾‹**:

```sql
CREATE TABLE network_devices (
    device_id BIGSERIAL PRIMARY KEY,
    ip_address INET NOT NULL,
    network CIDR NOT NULL,
    mac_address MACADDR,
    CHECK (ip_address << network)  -- IPåœ¨ç½‘æ®µå†…
);

-- ç½‘ç»œåœ°å€æŸ¥è¯¢
SELECT * FROM network_devices
WHERE ip_address <<= '192.168.1.0/24';  -- åœ¨ç½‘æ®µå†…
WHERE ip_address = '192.168.1.100';      -- ç²¾ç¡®åŒ¹é…
```

---

## 9. å‡ ä½•ç±»å‹ï¼ˆPostGISï¼‰

**éœ€è¦å®‰è£…PostGISæ‰©å±•**:

```sql
CREATE EXTENSION IF NOT EXISTS postgis;
```

**å¸¸ç”¨ç±»å‹**:

- `POINT`: ç‚¹ï¼ˆç»çº¬åº¦ï¼‰
- `LINESTRING`: çº¿
- `POLYGON`: å¤šè¾¹å½¢
- `GEOGRAPHY`: åœ°ç†åæ ‡ï¼ˆçƒé¢è®¡ç®—ï¼‰

**ç¤ºä¾‹**:

```sql
CREATE TABLE locations (
    location_id BIGSERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    geom_point GEOMETRY(POINT, 4326),        -- å¹³é¢åæ ‡
    geog_point GEOGRAPHY(POINT, 4326)       -- åœ°ç†åæ ‡ï¼ˆæ¨èï¼‰
);

-- æ’å…¥åæ ‡
INSERT INTO locations (name, geog_point)
VALUES (
    'Beijing',
    ST_GeogFromText('POINT(116.4074 39.9042)')
);

-- ç©ºé—´æŸ¥è¯¢
SELECT
    name,
    ST_Distance(
        geog_point,
        ST_GeogFromText('POINT(121.4737 31.2304)')  -- ä¸Šæµ·
    ) / 1000 AS distance_km  -- è·ç¦»ï¼ˆå…¬é‡Œï¼‰
FROM locations
WHERE ST_DWithin(
    geog_point,
    ST_GeogFromText('POINT(121.4737 31.2304)'),
    1000000  -- 1000å…¬é‡Œå†…
);

-- GISTç©ºé—´ç´¢å¼•
CREATE INDEX idx_locations_geog ON locations USING GIST (geog_point);
```

---

## 10. UUIDç±»å‹

**`UUID`**: 128ä½å”¯ä¸€æ ‡è¯†ç¬¦

**ä½¿ç”¨åœºæ™¯**: åˆ†å¸ƒå¼ç³»ç»Ÿã€å¾®æœåŠ¡ã€éœ€è¦å…¨å±€å”¯ä¸€ID

**ç¤ºä¾‹**:

```sql
-- å¯ç”¨UUIDæ‰©å±•
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

CREATE TABLE users (
    user_id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),  -- UUID v4
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL
);

-- æˆ–ä½¿ç”¨UUID v7ï¼ˆæ—¶é—´æ’åºï¼‰
-- éœ€è¦å®‰è£…pg_uuidv7æ‰©å±•
CREATE EXTENSION IF NOT EXISTS pg_uuidv7;

CREATE TABLE orders (
    order_id UUID PRIMARY KEY DEFAULT uuid_generate_v7(),  -- UUID v7
    customer_id UUID NOT NULL,
    order_date TIMESTAMPTZ DEFAULT NOW()
);
```

---

## 11. æ•°æ®ç±»å‹é€‰æ‹©å†³ç­–æ ‘

```mermaid
graph TD
    A[é€‰æ‹©æ•°æ®ç±»å‹] --> B{æ˜¯æ•°å€¼?}
    B -->|æ˜¯| C{éœ€è¦ç²¾ç¡®?}
    C -->|æ˜¯| D[NUMERIC]
    C -->|å¦| E{èŒƒå›´å¤§å°?}
    E -->|å°| F[SMALLINT/INT]
    E -->|å¤§| G[BIGINT]

    B -->|å¦| H{æ˜¯æ–‡æœ¬?}
    H -->|æ˜¯| I[TEXTä¼˜å…ˆ]

    H -->|å¦| J{æ˜¯æ—¶é—´?}
    J -->|æ˜¯| K[TIMESTAMPTZ]

    J -->|å¦| L{æ˜¯JSON?}
    L -->|æ˜¯| M[JSONB]

    L -->|å¦| N{æ˜¯æ•°ç»„?}
    N -->|æ˜¯| O[ç±»å‹[]]

    N -->|å¦| P{æ˜¯å¸ƒå°”?}
    P -->|æ˜¯| Q[BOOLEAN]

    P -->|å¦| R{æ˜¯UUID?}
    R -->|æ˜¯| S[UUID]
```

---

## 12. å¸¸è§åœºæ™¯ç±»å‹é€‰æ‹©

### åœºæ™¯1: ç”µå•†è®¢å•ç³»ç»Ÿ

```sql
CREATE TABLE orders (
    order_id BIGSERIAL PRIMARY KEY,
    order_number VARCHAR(50) UNIQUE NOT NULL,
    customer_id BIGINT NOT NULL,
    order_date TIMESTAMPTZ DEFAULT NOW(),
    total_amount NUMERIC(10,2) NOT NULL,  -- é‡‘é¢ï¼šç²¾ç¡®
    status VARCHAR(20) DEFAULT 'pending',
    shipping_address JSONB,                -- åœ°å€ï¼šçµæ´»ç»“æ„
    items JSONB[],                         -- è®¢å•é¡¹ï¼šæ•°ç»„
    metadata JSONB                         -- æ‰©å±•å­—æ®µ
);
```

---

### åœºæ™¯2: IoTä¼ æ„Ÿå™¨æ•°æ®

```sql
CREATE TABLE sensor_readings (
    reading_id BIGSERIAL PRIMARY KEY,
    device_id INT NOT NULL,
    timestamp TIMESTAMPTZ NOT NULL,
    temperature DOUBLE PRECISION,         -- æ¸©åº¦ï¼šå¯æ¥å—è¯¯å·®
    humidity DOUBLE PRECISION,
    location GEOGRAPHY(POINT, 4326),      -- ä½ç½®ï¼šåœ°ç†åæ ‡
    metadata JSONB                         -- æ‰©å±•æ•°æ®
);
```

---

### åœºæ™¯3: ç”¨æˆ·ç³»ç»Ÿ

```sql
CREATE TABLE users (
    user_id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash TEXT NOT NULL,
    profile JSONB,                         -- ç”¨æˆ·èµ„æ–™ï¼šçµæ´»
    tags TEXT[],                           -- æ ‡ç­¾ï¼šæ•°ç»„
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## 13. å¸¸è§é”™è¯¯ä¸é¿å…

### é”™è¯¯1: é‡‘èé‡‘é¢ä½¿ç”¨æµ®ç‚¹

```sql
-- âŒ é”™è¯¯
CREATE TABLE orders (
    amount DOUBLE PRECISION  -- ç²¾åº¦æŸå¤±
);

-- âœ… æ­£ç¡®
CREATE TABLE orders (
    amount NUMERIC(10,2)  -- ç²¾ç¡®è®¡ç®—
);
```

---

### é”™è¯¯2: æ—¶é—´æˆ³ä¸ä½¿ç”¨æ—¶åŒº

```sql
-- âŒ é”™è¯¯
CREATE TABLE events (
    created_at TIMESTAMP  -- æ—¶åŒºé—®é¢˜
);

-- âœ… æ­£ç¡®
CREATE TABLE events (
    created_at TIMESTAMPTZ  -- è‡ªåŠ¨å¤„ç†æ—¶åŒº
);
```

---

### é”™è¯¯3: æ–‡æœ¬å­—æ®µä½¿ç”¨VARCHARé™åˆ¶è¿‡å°

```sql
-- âŒ é”™è¯¯
CREATE TABLE products (
    description VARCHAR(100)  -- å¯èƒ½æˆªæ–­
);

-- âœ… æ­£ç¡®
CREATE TABLE products (
    description TEXT  -- æ— é™åˆ¶
);
```

---

## 14. ç›¸å…³èµ„æº

- [ç´¢å¼•ç­–ç•¥](./ç´¢å¼•ç­–ç•¥.md) - æ•°æ®ç±»å‹ä¸ç´¢å¼•é€‰æ‹©
- [çº¦æŸè®¾è®¡](./çº¦æŸè®¾è®¡.md) - æ•°æ®ç±»å‹çº¦æŸ
- PostgreSQLå®˜æ–¹æ–‡æ¡£: [Data Types](https://www.postgresql.org/docs/current/datatype.html)

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
