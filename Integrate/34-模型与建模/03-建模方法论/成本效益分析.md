# æˆæœ¬æ•ˆç›Šåˆ†æ

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æ¥æº**: æ•°æ®å»ºæ¨¡ç»æµå­¦
> **çŠ¶æ€**: âœ… å·²å®Œæˆ
> **æ–‡æ¡£ç¼–å·**: 03-03

---

## ğŸ“‘ ç›®å½•

- [æˆæœ¬æ•ˆç›Šåˆ†æ](#æˆæœ¬æ•ˆç›Šåˆ†æ)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
  - [1.1 ç†è®ºåŸºç¡€](#11-ç†è®ºåŸºç¡€)
    - [1.1.1 æˆæœ¬æ•ˆç›Šåˆ†æç†è®º](#111-æˆæœ¬æ•ˆç›Šåˆ†æç†è®º)
    - [1.1.2 æˆæœ¬åˆ†æç†è®º](#112-æˆæœ¬åˆ†æç†è®º)
    - [1.1.3 æ•ˆç›Šåˆ†æç†è®º](#113-æ•ˆç›Šåˆ†æç†è®º)
    - [1.1.4 ROIè®¡ç®—ç†è®º](#114-roiè®¡ç®—ç†è®º)
    - [1.1.5 å†³ç­–ç†è®º](#115-å†³ç­–ç†è®º)
    - [1.1.6 å¤æ‚åº¦åˆ†æ](#116-å¤æ‚åº¦åˆ†æ)
  - [2. å»ºæ¨¡æˆæœ¬åˆ†æ](#2-å»ºæ¨¡æˆæœ¬åˆ†æ)
    - [2.1 æˆæœ¬åˆ†ç±»](#21-æˆæœ¬åˆ†ç±»)
    - [2.2 æˆæœ¬ä¼°ç®—æ¨¡å‹](#22-æˆæœ¬ä¼°ç®—æ¨¡å‹)
    - [2.3 ä¸åŒå»ºæ¨¡æ–¹æ¡ˆæˆæœ¬å¯¹æ¯”](#23-ä¸åŒå»ºæ¨¡æ–¹æ¡ˆæˆæœ¬å¯¹æ¯”)
  - [3. æ€§èƒ½æ•ˆç›Šåˆ†æ](#3-æ€§èƒ½æ•ˆç›Šåˆ†æ)
    - [3.1 æ€§èƒ½æŒ‡æ ‡](#31-æ€§èƒ½æŒ‡æ ‡)
    - [3.2 æ€§èƒ½æ•ˆç›Šé‡åŒ–](#32-æ€§èƒ½æ•ˆç›Šé‡åŒ–)
    - [3.3 æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–æ•ˆç›Š](#33-æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–æ•ˆç›Š)
  - [4. ç»´æŠ¤æˆæœ¬åˆ†æ](#4-ç»´æŠ¤æˆæœ¬åˆ†æ)
    - [4.1 ç»´æŠ¤æˆæœ¬æ„æˆ](#41-ç»´æŠ¤æˆæœ¬æ„æˆ)
    - [4.2 ç»´æŠ¤æˆæœ¬ä¼°ç®—](#42-ç»´æŠ¤æˆæœ¬ä¼°ç®—)
    - [4.3 ä¸åŒå»ºæ¨¡æ–¹æ¡ˆçš„ç»´æŠ¤æˆæœ¬å¯¹æ¯”](#43-ä¸åŒå»ºæ¨¡æ–¹æ¡ˆçš„ç»´æŠ¤æˆæœ¬å¯¹æ¯”)
  - [5. ROIè®¡ç®—æ–¹æ³•](#5-roiè®¡ç®—æ–¹æ³•)
    - [5.1 ROIåŸºæœ¬å…¬å¼](#51-roiåŸºæœ¬å…¬å¼)
    - [5.2 ç»¼åˆROIè®¡ç®—](#52-ç»¼åˆroiè®¡ç®—)
    - [5.3 å¤šæ–¹æ¡ˆROIå¯¹æ¯”](#53-å¤šæ–¹æ¡ˆroiå¯¹æ¯”)
  - [6. PostgreSQLå®ç°](#6-postgresqlå®ç°)
    - [6.1 ç»¼åˆæˆæœ¬æ•ˆç›Šåˆ†æç³»ç»Ÿ](#61-ç»¼åˆæˆæœ¬æ•ˆç›Šåˆ†æç³»ç»Ÿ)
  - [7. å®é™…åº”ç”¨æ¡ˆä¾‹ / Practical Application Examples](#7-å®é™…åº”ç”¨æ¡ˆä¾‹--practical-application-examples)
    - [7.1 æ¡ˆä¾‹1: ç´¢å¼•ä¼˜åŒ–æˆæœ¬æ•ˆç›Šåˆ†æ](#71-æ¡ˆä¾‹1-ç´¢å¼•ä¼˜åŒ–æˆæœ¬æ•ˆç›Šåˆ†æ)
    - [7.2 æ¡ˆä¾‹2: åˆ†åŒºç­–ç•¥æˆæœ¬æ•ˆç›Šåˆ†æ](#72-æ¡ˆä¾‹2-åˆ†åŒºç­–ç•¥æˆæœ¬æ•ˆç›Šåˆ†æ)
    - [7.3 æ¡ˆä¾‹3: åˆ—å­˜è¡¨æˆæœ¬æ•ˆç›Šåˆ†æ](#73-æ¡ˆä¾‹3-åˆ—å­˜è¡¨æˆæœ¬æ•ˆç›Šåˆ†æ)
  - [8. å¸¸è§é—®é¢˜è§£ç­” / FAQ](#8-å¸¸è§é—®é¢˜è§£ç­”--faq)
    - [Q1: å¦‚ä½•é‡åŒ–å»ºæ¨¡æˆæœ¬ï¼Ÿ](#q1-å¦‚ä½•é‡åŒ–å»ºæ¨¡æˆæœ¬)
    - [Q2: å¦‚ä½•è¯„ä¼°æ€§èƒ½æ•ˆç›Šï¼Ÿ](#q2-å¦‚ä½•è¯„ä¼°æ€§èƒ½æ•ˆç›Š)
    - [Q3: ROIè®¡ç®—åº”è¯¥è€ƒè™‘å“ªäº›å› ç´ ï¼Ÿ](#q3-roiè®¡ç®—åº”è¯¥è€ƒè™‘å“ªäº›å› ç´ )
    - [Q4: å¦‚ä½•æ¯”è¾ƒå¤šä¸ªå»ºæ¨¡æ–¹æ¡ˆï¼Ÿ](#q4-å¦‚ä½•æ¯”è¾ƒå¤šä¸ªå»ºæ¨¡æ–¹æ¡ˆ)
    - [Q5: æˆæœ¬æ•ˆç›Šåˆ†æå¦‚ä½•æŒç»­è·Ÿè¸ªï¼Ÿ](#q5-æˆæœ¬æ•ˆç›Šåˆ†æå¦‚ä½•æŒç»­è·Ÿè¸ª)
  - [7. ç›¸å…³èµ„æº](#7-ç›¸å…³èµ„æº)

---

## 1. æ¦‚è¿°

æˆæœ¬æ•ˆç›Šåˆ†æå¸®åŠ©è¯„ä¼°ä¸åŒå»ºæ¨¡æ–¹æ¡ˆçš„æŠ•å…¥äº§å‡ºæ¯”ï¼Œä¸ºå†³ç­–æä¾›é‡åŒ–ä¾æ®ã€‚
é€šè¿‡ç³»ç»ŸåŒ–çš„æˆæœ¬æ•ˆç›Šåˆ†æï¼Œå¯ä»¥åœ¨å¤šä¸ªå»ºæ¨¡æ–¹æ¡ˆä¸­é€‰æ‹©æœ€ä¼˜è§£ã€‚

**æ ¸å¿ƒä»·å€¼**:

- **é‡åŒ–å†³ç­–**ï¼šå°†ä¸»è§‚åˆ¤æ–­è½¬åŒ–ä¸ºå®¢è§‚æ•°æ®
- **èµ„æºä¼˜åŒ–**ï¼šåˆç†åˆ†é…å»ºæ¨¡èµ„æº
- **é£é™©æ§åˆ¶**ï¼šè¯†åˆ«é«˜æˆæœ¬ä½æ•ˆç›Šçš„æ–¹æ¡ˆ
- **æŒç»­æ”¹è¿›**ï¼šè·Ÿè¸ªå»ºæ¨¡æ•ˆæœï¼ŒæŒç»­ä¼˜åŒ–

---

## 1.1 ç†è®ºåŸºç¡€

### 1.1.1 æˆæœ¬æ•ˆç›Šåˆ†æç†è®º

**æˆæœ¬æ•ˆç›Šåˆ†æï¼ˆCost-Benefit Analysisï¼‰**:

- **å®šä¹‰**: è¯„ä¼°ä¸åŒæ–¹æ¡ˆçš„æŠ•å…¥äº§å‡ºæ¯”
- **ç›®çš„**: ä¸ºå†³ç­–æä¾›é‡åŒ–ä¾æ®
- **æ–¹æ³•**: æˆæœ¬åˆ†æã€æ•ˆç›Šåˆ†æã€ROIè®¡ç®—

**åˆ†æåŸåˆ™**:

- **é‡åŒ–**: å°½å¯èƒ½é‡åŒ–æˆæœ¬å’Œæ•ˆç›Š
- **å…¨é¢**: è€ƒè™‘æ‰€æœ‰æˆæœ¬å’Œæ•ˆç›Š
- **æ—¶é—´**: è€ƒè™‘æ—¶é—´ä»·å€¼

### 1.1.2 æˆæœ¬åˆ†æç†è®º

**æˆæœ¬åˆ†æ**:

- **æˆæœ¬åˆ†ç±»**: äººåŠ›æˆæœ¬ã€æ—¶é—´æˆæœ¬ã€æŠ€æœ¯æˆæœ¬ã€æœºä¼šæˆæœ¬ã€é£é™©æˆæœ¬
- **æˆæœ¬ä¼°ç®—**: æˆæœ¬ä¼°ç®—æ¨¡å‹å’Œæ–¹æ³•
- **æˆæœ¬å¯¹æ¯”**: ä¸åŒæ–¹æ¡ˆçš„æˆæœ¬å¯¹æ¯”

**æˆæœ¬ä¼°ç®—**:

- **äººåŠ›æˆæœ¬**: $C_{human} = \sum_{i=1}^{n} D_i \times R_i$ where D is days, R is rate
- **æ—¶é—´æˆæœ¬**: $C_{time} = T \times R_t$ where T is time, R_t is time rate
- **æ€»æˆæœ¬**: $C_{total} = C_{human} + C_{time} + C_{tech} + C_{risk}$

### 1.1.3 æ•ˆç›Šåˆ†æç†è®º

**æ•ˆç›Šåˆ†æ**:

- **æ•ˆç›Šåˆ†ç±»**: æ€§èƒ½æ•ˆç›Šã€ç»´æŠ¤æ•ˆç›Šã€æ‰©å±•æ•ˆç›Š
- **æ•ˆç›Šé‡åŒ–**: æ•ˆç›Šé‡åŒ–æ–¹æ³•
- **æ•ˆç›Šå¯¹æ¯”**: ä¸åŒæ–¹æ¡ˆçš„æ•ˆç›Šå¯¹æ¯”

**æ•ˆç›Šé‡åŒ–**:

- **æ€§èƒ½æ•ˆç›Š**: $B_{perf} = \Delta T \times V$ where $\Delta T$ is time saved, V is value
- **ç»´æŠ¤æ•ˆç›Š**: $B_{maint} = \Delta M \times V$ where $\Delta M$ is maintenance saved
- **æ€»æ•ˆç›Š**: $B_{total} = B_{perf} + B_{maint} + B_{ext}$

### 1.1.4 ROIè®¡ç®—ç†è®º

**ROIï¼ˆReturn on Investmentï¼‰**:

- **å®šä¹‰**: æŠ•èµ„å›æŠ¥ç‡
- **å…¬å¼**: $ROI = \frac{B - C}{C} \times 100\%$ where B is benefit, C is cost
- **åº”ç”¨**: è¯„ä¼°æŠ•èµ„å›æŠ¥

**ROIè®¡ç®—**:

- **ç®€å•ROI**: $ROI = \frac{B - C}{C}$
- **æ—¶é—´ROI**: $ROI_t = \frac{\sum_{i=1}^{n} \frac{B_i - C_i}{(1+r)^i}}{C_0}$ where r is discount rate
- **ç»¼åˆROI**: è€ƒè™‘å¤šä¸ªå› ç´ çš„ROI

### 1.1.5 å†³ç­–ç†è®º

**å†³ç­–æ–¹æ³•**:

- **å¤šæ–¹æ¡ˆå¯¹æ¯”**: å¯¹æ¯”å¤šä¸ªæ–¹æ¡ˆçš„ROI
- **é£é™©è¯„ä¼°**: è¯„ä¼°æ–¹æ¡ˆé£é™©
- **å†³ç­–å»ºè®®**: åŸºäºROIå’Œé£é™©åšå†³ç­–

**å†³ç­–åŸåˆ™**:

- **ROIä¼˜å…ˆ**: ä¼˜å…ˆé€‰æ‹©ROIé«˜çš„æ–¹æ¡ˆ
- **é£é™©æ§åˆ¶**: æ§åˆ¶æ–¹æ¡ˆé£é™©
- **ç»¼åˆè¯„ä¼°**: ç»¼åˆROIå’Œé£é™©

### 1.1.6 å¤æ‚åº¦åˆ†æ

**åˆ†æå¤æ‚åº¦**:

- **æˆæœ¬åˆ†æ**: $O(C)$ where C is cost categories
- **æ•ˆç›Šåˆ†æ**: $O(B)$ where B is benefit categories
- **ROIè®¡ç®—**: $O(1)$ (constant time)

---

## 2. å»ºæ¨¡æˆæœ¬åˆ†æ

### 2.1 æˆæœ¬åˆ†ç±»

**å»ºæ¨¡æˆæœ¬æ„æˆ**:

| æˆæœ¬ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|---------|------|------|
| äººåŠ›æˆæœ¬ | å»ºæ¨¡å¸ˆã€å¼€å‘äººå‘˜å·¥æ—¶ | 1000å…ƒ/äººå¤© |
| æ—¶é—´æˆæœ¬ | é¡¹ç›®å»¶æœŸæˆæœ¬ | 5000å…ƒ/å¤© |
| æŠ€æœ¯æˆæœ¬ | å·¥å…·ã€åŸ¹è®­è´¹ç”¨ | 10000å…ƒ |
| æœºä¼šæˆæœ¬ | é€‰æ‹©Aæ–¹æ¡ˆæ”¾å¼ƒBæ–¹æ¡ˆçš„æˆæœ¬ | éš¾ä»¥é‡åŒ– |
| é£é™©æˆæœ¬ | æ–¹æ¡ˆå¤±è´¥çš„é£é™© | æ¦‚ç‡Ã—æŸå¤± |

### 2.2 æˆæœ¬ä¼°ç®—æ¨¡å‹

```sql
-- å»ºæ¨¡æˆæœ¬ä¼°ç®—è¡¨
CREATE TABLE modeling_cost_estimate (
    estimate_id SERIAL PRIMARY KEY,
    project_name VARCHAR(200) NOT NULL,
    -- äººåŠ›æˆæœ¬
    designer_days INT DEFAULT 0,
    developer_days INT DEFAULT 0,
    tester_days INT DEFAULT 0,
    daily_rate NUMERIC(10,2) DEFAULT 1000.00,
    -- æ—¶é—´æˆæœ¬
    project_duration_days INT,
    delay_cost_per_day NUMERIC(10,2) DEFAULT 5000.00,
    -- æŠ€æœ¯æˆæœ¬
    tool_license_cost NUMERIC(10,2) DEFAULT 0,
    training_cost NUMERIC(10,2) DEFAULT 0,
    -- é£é™©æˆæœ¬
    risk_probability NUMERIC(5,2) DEFAULT 0, -- 0-1
    risk_loss NUMERIC(10,2) DEFAULT 0,
    -- è®¡ç®—æ€»æˆæœ¬
    total_cost NUMERIC(12,2) GENERATED ALWAYS AS (
        -- äººåŠ›æˆæœ¬
        (designer_days + developer_days + tester_days) * daily_rate +
        -- æ—¶é—´æˆæœ¬ï¼ˆå»¶æœŸï¼‰
        GREATEST(0, project_duration_days - 30) * delay_cost_per_day +
        -- æŠ€æœ¯æˆæœ¬
        tool_license_cost + training_cost +
        -- é£é™©æˆæœ¬
        risk_probability * risk_loss
    ) STORED,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ç¤ºä¾‹ï¼šç”µå•†ç³»ç»Ÿå»ºæ¨¡æˆæœ¬ä¼°ç®—
INSERT INTO modeling_cost_estimate (
    project_name, designer_days, developer_days, tester_days,
    project_duration_days, tool_license_cost, training_cost,
    risk_probability, risk_loss
) VALUES (
    'ç”µå•†ç³»ç»Ÿ', 10, 20, 5,
    45, 5000, 3000,
    0.1, 50000
);

-- æŸ¥è¯¢æˆæœ¬æ˜ç»†
SELECT
    project_name,
    (designer_days + developer_days + tester_days) * daily_rate AS labor_cost,
    GREATEST(0, project_duration_days - 30) * delay_cost_per_day AS delay_cost,
    tool_license_cost + training_cost AS tech_cost,
    risk_probability * risk_loss AS risk_cost,
    total_cost
FROM modeling_cost_estimate;
```

### 2.3 ä¸åŒå»ºæ¨¡æ–¹æ¡ˆæˆæœ¬å¯¹æ¯”

```sql
-- å»ºæ¨¡æ–¹æ¡ˆæˆæœ¬å¯¹æ¯”è¡¨
CREATE TABLE modeling_option_cost (
    option_id SERIAL PRIMARY KEY,
    project_name VARCHAR(200) NOT NULL,
    option_name VARCHAR(200) NOT NULL,
    -- æˆæœ¬å› ç´ 
    complexity_level VARCHAR(50), -- 'low', 'medium', 'high'
    estimated_days INT,
    risk_level VARCHAR(50), -- 'low', 'medium', 'high'
    -- æˆæœ¬ä¼°ç®—
    estimated_cost NUMERIC(12,2),
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- æˆæœ¬ä¼°ç®—å‡½æ•°
CREATE OR REPLACE FUNCTION estimate_modeling_cost(
    p_complexity VARCHAR,
    p_days INT,
    p_risk_level VARCHAR
)
RETURNS NUMERIC AS $$
DECLARE
    v_base_rate NUMERIC := 1000.00;
    v_complexity_multiplier NUMERIC;
    v_risk_multiplier NUMERIC;
BEGIN
    -- å¤æ‚åº¦ç³»æ•°
    v_complexity_multiplier := CASE p_complexity
        WHEN 'low' THEN 1.0
        WHEN 'medium' THEN 1.5
        WHEN 'high' THEN 2.0
        ELSE 1.0
    END;

    -- é£é™©ç³»æ•°
    v_risk_multiplier := CASE p_risk_level
        WHEN 'low' THEN 1.0
        WHEN 'medium' THEN 1.2
        WHEN 'high' THEN 1.5
        ELSE 1.0
    END;

    RETURN p_days * v_base_rate * v_complexity_multiplier * v_risk_multiplier;
END;
$$ LANGUAGE plpgsql;
```

---

## 3. æ€§èƒ½æ•ˆç›Šåˆ†æ

### 3.1 æ€§èƒ½æŒ‡æ ‡

**å…³é”®æ€§èƒ½æŒ‡æ ‡**:

| æŒ‡æ ‡ | è¯´æ˜ | ç›®æ ‡å€¼ |
|------|------|--------|
| æŸ¥è¯¢å“åº”æ—¶é—´ | å¹³å‡æŸ¥è¯¢è€—æ—¶ | <100ms |
| å†™å…¥ååé‡ | æ¯ç§’å†™å…¥æ¬¡æ•° | >1000 TPS |
| å¹¶å‘ç”¨æˆ·æ•° | åŒæ—¶åœ¨çº¿ç”¨æˆ· | >1000 |
| æ•°æ®å‹ç¼©æ¯” | å‹ç¼©å/å‹ç¼©å‰ | >3:1 |
| ç´¢å¼•æ•ˆç‡ | ç´¢å¼•å‘½ä¸­ç‡ | >95% |

### 3.2 æ€§èƒ½æ•ˆç›Šé‡åŒ–

```sql
-- æ€§èƒ½æ•ˆç›Šåˆ†æè¡¨
CREATE TABLE performance_benefit (
    benefit_id SERIAL PRIMARY KEY,
    project_name VARCHAR(200) NOT NULL,
    -- æ€§èƒ½æŒ‡æ ‡
    metric_name VARCHAR(100) NOT NULL,
    baseline_value NUMERIC(12,2),
    improved_value NUMERIC(12,2),
    -- æ•ˆç›Šè®¡ç®—
    improvement_percentage NUMERIC(5,2) GENERATED ALWAYS AS (
        CASE
            WHEN baseline_value > 0 THEN
                ((baseline_value - improved_value) / baseline_value * 100)
            ELSE 0
        END
    ) STORED,
    -- ä¸šåŠ¡ä»·å€¼
    business_impact_score INT CHECK (business_impact_score BETWEEN 1 AND 10),
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ç¤ºä¾‹ï¼šç´¢å¼•ä¼˜åŒ–æ•ˆç›Š
INSERT INTO performance_benefit (project_name, metric_name, baseline_value, improved_value, business_impact_score) VALUES
    ('ç”µå•†ç³»ç»Ÿ', 'æŸ¥è¯¢å“åº”æ—¶é—´(ms)', 500, 50, 9),
    ('ç”µå•†ç³»ç»Ÿ', 'å†™å…¥ååé‡(TPS)', 500, 1200, 8),
    ('ç”µå•†ç³»ç»Ÿ', 'å¹¶å‘ç”¨æˆ·æ•°', 500, 1500, 10);

-- æŸ¥è¯¢æ€§èƒ½æ•ˆç›Šæ±‡æ€»
SELECT
    project_name,
    metric_name,
    baseline_value,
    improved_value,
    improvement_percentage,
    business_impact_score,
    improvement_percentage * business_impact_score AS weighted_benefit
FROM performance_benefit
ORDER BY weighted_benefit DESC;
```

### 3.3 æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–æ•ˆç›Š

```sql
-- æŸ¥è¯¢æ€§èƒ½å¯¹æ¯”è¡¨
CREATE TABLE query_performance_comparison (
    comparison_id SERIAL PRIMARY KEY,
    query_name VARCHAR(200) NOT NULL,
    -- ä¼˜åŒ–å‰
    before_execution_time_ms NUMERIC(10,2),
    before_index_size_mb NUMERIC(10,2),
    -- ä¼˜åŒ–å
    after_execution_time_ms NUMERIC(10,2),
    after_index_size_mb NUMERIC(10,2),
    -- æ•ˆç›Šè®¡ç®—
    speedup_ratio NUMERIC(5,2) GENERATED ALWAYS AS (
        CASE
            WHEN after_execution_time_ms > 0 THEN
                before_execution_time_ms / after_execution_time_ms
            ELSE 0
        END
    ) STORED,
    space_savings_mb NUMERIC(10,2) GENERATED ALWAYS AS (
        before_index_size_mb - after_index_size_mb
    ) STORED
);

-- ç¤ºä¾‹ï¼šè®¢å•æŸ¥è¯¢ä¼˜åŒ–
INSERT INTO query_performance_comparison (
    query_name, before_execution_time_ms, before_index_size_mb,
    after_execution_time_ms, after_index_size_mb
) VALUES (
    'è®¢å•æŸ¥è¯¢', 500, 500,
    50, 200
);

-- æŸ¥è¯¢ä¼˜åŒ–æ•ˆç›Š
SELECT
    query_name,
    before_execution_time_ms,
    after_execution_time_ms,
    speedup_ratio,
    before_index_size_mb,
    after_index_size_mb,
    space_savings_mb,
    CASE
        WHEN speedup_ratio > 5 THEN 'ä¼˜ç§€'
        WHEN speedup_ratio > 2 THEN 'è‰¯å¥½'
        ELSE 'ä¸€èˆ¬'
    END AS optimization_level
FROM query_performance_comparison;
```

---

## 4. ç»´æŠ¤æˆæœ¬åˆ†æ

### 4.1 ç»´æŠ¤æˆæœ¬æ„æˆ

**ç»´æŠ¤æˆæœ¬ç±»å‹**:

| æˆæœ¬ç±»å‹ | è¯´æ˜ | å æ¯” |
|---------|------|------|
| æ—¥å¸¸ç»´æŠ¤ | ç›‘æ§ã€å¤‡ä»½ã€ä¼˜åŒ– | 40% |
| é—®é¢˜ä¿®å¤ | Bugä¿®å¤ã€æ€§èƒ½è°ƒä¼˜ | 30% |
| åŠŸèƒ½æ‰©å±• | æ–°éœ€æ±‚ã€åŠŸèƒ½å¢å¼º | 20% |
| æ–‡æ¡£æ›´æ–° | æ–‡æ¡£ç»´æŠ¤ã€åŸ¹è®­ | 10% |

### 4.2 ç»´æŠ¤æˆæœ¬ä¼°ç®—

```sql
-- ç»´æŠ¤æˆæœ¬ä¼°ç®—è¡¨
CREATE TABLE maintenance_cost (
    cost_id SERIAL PRIMARY KEY,
    project_name VARCHAR(200) NOT NULL,
    -- å¹´åº¦ç»´æŠ¤æˆæœ¬
    daily_maintenance_hours NUMERIC(5,2) DEFAULT 2.0,
    hourly_rate NUMERIC(10,2) DEFAULT 200.00,
    -- é—®é¢˜ä¿®å¤æˆæœ¬
    avg_incidents_per_month INT DEFAULT 2,
    avg_fix_hours NUMERIC(5,2) DEFAULT 4.0,
    -- åŠŸèƒ½æ‰©å±•æˆæœ¬
    feature_requests_per_year INT DEFAULT 10,
    avg_feature_hours NUMERIC(5,2) DEFAULT 16.0,
    -- å¹´åº¦æ€»æˆæœ¬
    annual_cost NUMERIC(12,2) GENERATED ALWAYS AS (
        -- æ—¥å¸¸ç»´æŠ¤ï¼š2å°æ—¶/å¤© Ã— 200å…ƒ/å°æ—¶ Ã— 250å·¥ä½œæ—¥
        daily_maintenance_hours * hourly_rate * 250 +
        -- é—®é¢˜ä¿®å¤ï¼š2æ¬¡/æœˆ Ã— 4å°æ—¶ Ã— 200å…ƒ/å°æ—¶ Ã— 12æœˆ
        avg_incidents_per_month * avg_fix_hours * hourly_rate * 12 +
        -- åŠŸèƒ½æ‰©å±•ï¼š10æ¬¡/å¹´ Ã— 16å°æ—¶ Ã— 200å…ƒ/å°æ—¶
        feature_requests_per_year * avg_feature_hours * hourly_rate
    ) STORED,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ç¤ºä¾‹ï¼šç”µå•†ç³»ç»Ÿç»´æŠ¤æˆæœ¬
INSERT INTO maintenance_cost (
    project_name, daily_maintenance_hours, avg_incidents_per_month,
    feature_requests_per_year
) VALUES (
    'ç”µå•†ç³»ç»Ÿ', 3.0, 3, 15
);

-- æŸ¥è¯¢ç»´æŠ¤æˆæœ¬
SELECT
    project_name,
    daily_maintenance_hours * hourly_rate * 250 AS daily_maintenance_cost,
    avg_incidents_per_month * avg_fix_hours * hourly_rate * 12 AS incident_cost,
    feature_requests_per_year * avg_feature_hours * hourly_rate AS feature_cost,
    annual_cost
FROM maintenance_cost;
```

### 4.3 ä¸åŒå»ºæ¨¡æ–¹æ¡ˆçš„ç»´æŠ¤æˆæœ¬å¯¹æ¯”

```sql
-- å»ºæ¨¡æ–¹æ¡ˆç»´æŠ¤æˆæœ¬å¯¹æ¯”
CREATE TABLE modeling_maintenance_comparison (
    comparison_id SERIAL PRIMARY KEY,
    option_name VARCHAR(200) NOT NULL,
    -- ç»´æŠ¤å¤æ‚åº¦
    maintenance_complexity VARCHAR(50), -- 'low', 'medium', 'high'
    -- é¢„ä¼°ç»´æŠ¤æˆæœ¬
    estimated_annual_maintenance_cost NUMERIC(12,2),
    -- å¯ç»´æŠ¤æ€§è¯„åˆ†ï¼ˆ1-10ï¼‰
    maintainability_score INT CHECK (maintainability_score BETWEEN 1 AND 10)
);

-- ç»´æŠ¤æˆæœ¬ä¼°ç®—å‡½æ•°
CREATE OR REPLACE FUNCTION estimate_maintenance_cost(
    p_complexity VARCHAR,
    p_base_cost NUMERIC
)
RETURNS NUMERIC AS $$
DECLARE
    v_multiplier NUMERIC;
BEGIN
    v_multiplier := CASE p_complexity
        WHEN 'low' THEN 1.0
        WHEN 'medium' THEN 1.5
        WHEN 'high' THEN 2.5
        ELSE 1.0
    END;

    RETURN p_base_cost * v_multiplier;
END;
$$ LANGUAGE plpgsql;
```

---

## 5. ROIè®¡ç®—æ–¹æ³•

### 5.1 ROIåŸºæœ¬å…¬å¼

**ROIè®¡ç®—å…¬å¼**:

```text
ROI = (æ”¶ç›Š - æˆæœ¬) / æˆæœ¬ Ã— 100%
```

### 5.2 ç»¼åˆROIè®¡ç®—

```sql
-- ROIè®¡ç®—è¡¨
CREATE TABLE roi_analysis (
    roi_id SERIAL PRIMARY KEY,
    project_name VARCHAR(200) NOT NULL,
    -- æˆæœ¬
    initial_investment NUMERIC(12,2) NOT NULL,
    annual_maintenance_cost NUMERIC(12,2) DEFAULT 0,
    -- æ”¶ç›Š
    annual_revenue_increase NUMERIC(12,2) DEFAULT 0,
    annual_cost_savings NUMERIC(12,2) DEFAULT 0,
    -- æ—¶é—´å‘¨æœŸ
    analysis_period_years INT DEFAULT 3,
    -- è®¡ç®—ROI
    total_cost NUMERIC(12,2) GENERATED ALWAYS AS (
        initial_investment + annual_maintenance_cost * analysis_period_years
    ) STORED,
    total_benefit NUMERIC(12,2) GENERATED ALWAYS AS (
        (annual_revenue_increase + annual_cost_savings) * analysis_period_years
    ) STORED,
    roi_percentage NUMERIC(10,2) GENERATED ALWAYS AS (
        CASE
            WHEN total_cost > 0 THEN
                ((total_benefit - total_cost) / total_cost * 100)
            ELSE 0
        END
    ) STORED,
    payback_period_years NUMERIC(5,2) GENERATED ALWAYS AS (
        CASE
            WHEN (annual_revenue_increase + annual_cost_savings) > 0 THEN
                initial_investment / (annual_revenue_increase + annual_cost_savings)
            ELSE NULL
        END
    ) STORED,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ç¤ºä¾‹ï¼šç”µå•†ç³»ç»ŸROIåˆ†æ
INSERT INTO roi_analysis (
    project_name, initial_investment, annual_maintenance_cost,
    annual_revenue_increase, annual_cost_savings, analysis_period_years
) VALUES (
    'ç”µå•†ç³»ç»Ÿ', 500000, 100000,
    300000, 150000, 3
);

-- æŸ¥è¯¢ROIåˆ†æç»“æœ
SELECT
    project_name,
    initial_investment,
    total_cost,
    total_benefit,
    roi_percentage,
    payback_period_years,
    CASE
        WHEN roi_percentage > 100 THEN 'ä¼˜ç§€æŠ•èµ„'
        WHEN roi_percentage > 50 THEN 'è‰¯å¥½æŠ•èµ„'
        WHEN roi_percentage > 0 THEN 'ä¸€èˆ¬æŠ•èµ„'
        ELSE 'ä¸æ¨è'
    END AS investment_recommendation
FROM roi_analysis;
```

### 5.3 å¤šæ–¹æ¡ˆROIå¯¹æ¯”

```sql
-- å¤šæ–¹æ¡ˆROIå¯¹æ¯”è§†å›¾
CREATE VIEW option_roi_comparison AS
SELECT
    option_name,
    initial_investment,
    total_cost,
    total_benefit,
    roi_percentage,
    payback_period_years,
    RANK() OVER (ORDER BY roi_percentage DESC) AS roi_rank
FROM roi_analysis
ORDER BY roi_percentage DESC;
```

---

## 6. PostgreSQLå®ç°

### 6.1 ç»¼åˆæˆæœ¬æ•ˆç›Šåˆ†æç³»ç»Ÿ

```sql
-- æˆæœ¬æ•ˆç›Šç»¼åˆåˆ†æè§†å›¾
CREATE VIEW comprehensive_cost_benefit AS
SELECT
    c.project_name,
    -- æˆæœ¬
    c.total_cost AS modeling_cost,
    m.annual_cost AS maintenance_cost,
    -- æ•ˆç›Š
    SUM(p.improvement_percentage * p.business_impact_score) AS performance_benefit_score,
    -- ROI
    r.roi_percentage,
    r.payback_period_years,
    -- ç»¼åˆè¯„åˆ†
    (
        CASE WHEN r.roi_percentage > 0 THEN 1 ELSE 0 END * 0.4 +
        CASE WHEN r.payback_period_years < 2 THEN 1 ELSE 0 END * 0.3 +
        CASE WHEN SUM(p.improvement_percentage) > 50 THEN 1 ELSE 0 END * 0.3
    ) * 10 AS overall_score
FROM modeling_cost_estimate c
LEFT JOIN maintenance_cost m ON c.project_name = m.project_name
LEFT JOIN performance_benefit p ON c.project_name = p.project_name
LEFT JOIN roi_analysis r ON c.project_name = r.project_name
GROUP BY c.project_name, c.total_cost, m.annual_cost, r.roi_percentage, r.payback_period_years;
```

---

## 7. å®é™…åº”ç”¨æ¡ˆä¾‹ / Practical Application Examples

### 7.1 æ¡ˆä¾‹1: ç´¢å¼•ä¼˜åŒ–æˆæœ¬æ•ˆç›Šåˆ†æ

**åœºæ™¯**: ä¸ºè®¢å•è¡¨æ·»åŠ ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½

**æˆæœ¬åˆ†æ**:

```sql
-- æˆæœ¬è®¡ç®—
INSERT INTO modeling_cost (
    project_name, cost_type, cost_item, cost_amount, cost_unit
) VALUES
    ('index_optimization', 'development', 'ç´¢å¼•è®¾è®¡æ—¶é—´', 8, 'hours'),
    ('index_optimization', 'development', 'ç´¢å¼•åˆ›å»ºæ—¶é—´', 2, 'hours'),
    ('index_optimization', 'maintenance', 'ç´¢å¼•ç»´æŠ¤æ—¶é—´', 1, 'hours_per_month'),
    ('index_optimization', 'storage', 'ç´¢å¼•å­˜å‚¨ç©ºé—´', 5, 'GB');

-- æ•ˆç›Šåˆ†æ
INSERT INTO performance_benefit (
    project_name, metric_name, before_value, after_value, improvement_percent
) VALUES
    ('index_optimization', 'query_time', 1000, 50, 95),  -- æŸ¥è¯¢æ—¶é—´ä»1000msé™åˆ°50ms
    ('index_optimization', 'throughput', 100, 2000, 1900);  -- ååé‡æå‡20å€

-- ROIè®¡ç®—
SELECT
    project_name,
    SUM(cost_amount) AS total_cost,
    AVG(improvement_percent) AS avg_improvement,
    (AVG(improvement_percent) / SUM(cost_amount)) AS roi_ratio
FROM modeling_cost mc
JOIN performance_benefit pb ON mc.project_name = pb.project_name
WHERE mc.project_name = 'index_optimization'
GROUP BY project_name;
```

### 7.2 æ¡ˆä¾‹2: åˆ†åŒºç­–ç•¥æˆæœ¬æ•ˆç›Šåˆ†æ

**åœºæ™¯**: ä¸ºè®¢å•è¡¨å®æ–½æ—¶é—´åˆ†åŒº

**æˆæœ¬æ•ˆç›Šå¯¹æ¯”**:

```sql
-- æ–¹æ¡ˆå¯¹æ¯”
CREATE TABLE cost_benefit_comparison (
    option_name VARCHAR(100) PRIMARY KEY,
    development_cost NUMERIC(10,2),
    maintenance_cost_per_month NUMERIC(10,2),
    query_performance_score INT,
    storage_cost_per_month NUMERIC(10,2),
    total_cost_per_year NUMERIC(10,2)
);

INSERT INTO cost_benefit_comparison VALUES
    ('no_partitioning', 0, 0, 30, 1000, 12000),
    ('monthly_partitioning', 40, 2, 80, 800, 10240),
    ('quarterly_partitioning', 20, 1, 60, 900, 11120);

-- é€‰æ‹©æœ€ä¼˜æ–¹æ¡ˆ
SELECT
    option_name,
    query_performance_score,
    total_cost_per_year,
    (query_performance_score / total_cost_per_year) AS efficiency_score
FROM cost_benefit_comparison
ORDER BY efficiency_score DESC;
```

### 7.3 æ¡ˆä¾‹3: åˆ—å­˜è¡¨æˆæœ¬æ•ˆç›Šåˆ†æ

**åœºæ™¯**: å°†OLAPäº‹å®è¡¨ä»è¡Œå­˜è¿ç§»åˆ°åˆ—å­˜

**ROIåˆ†æ**:

```sql
-- æˆæœ¬åˆ†æ
INSERT INTO modeling_cost (
    project_name, cost_type, cost_item, cost_amount, cost_unit
) VALUES
    ('columnar_migration', 'development', 'è¿ç§»å¼€å‘', 40, 'hours'),
    ('columnar_migration', 'testing', 'æµ‹è¯•éªŒè¯', 16, 'hours'),
    ('columnar_migration', 'deployment', 'éƒ¨ç½²ä¸Šçº¿', 8, 'hours');

-- æ•ˆç›Šåˆ†æ
INSERT INTO performance_benefit (
    project_name, metric_name, before_value, after_value, improvement_percent
) VALUES
    ('columnar_migration', 'query_time', 5000, 500, 90),  -- æŸ¥è¯¢æ—¶é—´å‡å°‘90%
    ('columnar_migration', 'storage_size', 1000, 200, 80);  -- å­˜å‚¨ç©ºé—´å‡å°‘80%

-- ROIè®¡ç®—
SELECT
    'columnar_migration' AS project_name,
    SUM(cost_amount) AS total_cost_hours,
    AVG(improvement_percent) AS avg_improvement_percent,
    CASE
        WHEN AVG(improvement_percent) > 50 THEN 'High ROI'
        WHEN AVG(improvement_percent) > 20 THEN 'Medium ROI'
        ELSE 'Low ROI'
    END AS roi_assessment
FROM modeling_cost mc
JOIN performance_benefit pb ON mc.project_name = pb.project_name
WHERE mc.project_name = 'columnar_migration'
GROUP BY mc.project_name;
```

---

## 8. å¸¸è§é—®é¢˜è§£ç­” / FAQ

### Q1: å¦‚ä½•é‡åŒ–å»ºæ¨¡æˆæœ¬ï¼Ÿ

**A**: æˆæœ¬é‡åŒ–æ–¹æ³•ï¼š

```sql
-- æˆæœ¬åˆ†ç±»å’Œé‡åŒ–
CREATE TABLE cost_breakdown (
    cost_category VARCHAR(50),
    cost_item VARCHAR(100),
    unit_cost NUMERIC(10,2),
    unit_type VARCHAR(20)
);

INSERT INTO cost_breakdown VALUES
    ('development', 'æ•°æ®åº“è®¾è®¡', 100, 'hour'),
    ('development', 'SQLå¼€å‘', 80, 'hour'),
    ('development', 'æµ‹è¯•éªŒè¯', 60, 'hour'),
    ('maintenance', 'æ—¥å¸¸ç»´æŠ¤', 50, 'hour'),
    ('infrastructure', 'å­˜å‚¨æˆæœ¬', 0.1, 'GB_per_month'),
    ('infrastructure', 'è®¡ç®—èµ„æº', 0.5, 'CPU_hour');
```

### Q2: å¦‚ä½•è¯„ä¼°æ€§èƒ½æ•ˆç›Šï¼Ÿ

**A**: æ€§èƒ½æ•ˆç›Šè¯„ä¼°ï¼š

```sql
-- æ€§èƒ½æŒ‡æ ‡å®šä¹‰
CREATE TABLE performance_metrics (
    metric_name VARCHAR(50) PRIMARY KEY,
    metric_type VARCHAR(20),  -- 'query_time', 'throughput', 'storage'
    target_value NUMERIC(10,2),
    unit VARCHAR(20)
);

INSERT INTO performance_metrics VALUES
    ('query_time', 'query_time', 100, 'ms'),
    ('throughput', 'throughput', 1000, 'qps'),
    ('storage_size', 'storage', 100, 'GB');

-- æ•ˆç›Šè®¡ç®—
SELECT
    project_name,
    metric_name,
    before_value,
    after_value,
    (before_value - after_value) / before_value * 100 AS improvement_percent,
    CASE
        WHEN (before_value - after_value) / before_value * 100 > 50 THEN 'Excellent'
        WHEN (before_value - after_value) / before_value * 100 > 20 THEN 'Good'
        ELSE 'Fair'
    END AS improvement_level
FROM performance_benefit;
```

### Q3: ROIè®¡ç®—åº”è¯¥è€ƒè™‘å“ªäº›å› ç´ ï¼Ÿ

**A**: ROIè®¡ç®—å› ç´ ï¼š

1. **å¼€å‘æˆæœ¬**: è®¾è®¡ã€å¼€å‘ã€æµ‹è¯•æ—¶é—´
2. **ç»´æŠ¤æˆæœ¬**: æ—¥å¸¸ç»´æŠ¤ã€ç›‘æ§ã€ä¼˜åŒ–æ—¶é—´
3. **åŸºç¡€è®¾æ–½æˆæœ¬**: å­˜å‚¨ã€è®¡ç®—èµ„æºæˆæœ¬
4. **æ€§èƒ½æ•ˆç›Š**: æŸ¥è¯¢æ€§èƒ½ã€ååé‡æå‡
5. **ä¸šåŠ¡ä»·å€¼**: ç”¨æˆ·ä½“éªŒã€ä¸šåŠ¡æ•ˆç‡æå‡

```sql
-- ç»¼åˆROIè®¡ç®—
CREATE OR REPLACE FUNCTION calculate_comprehensive_roi(
    p_project_name VARCHAR
)
RETURNS TABLE(
    total_cost NUMERIC,
    total_benefit NUMERIC,
    roi_percent NUMERIC,
    payback_months NUMERIC
) AS $$
DECLARE
    v_cost NUMERIC;
    v_benefit NUMERIC;
BEGIN
    -- è®¡ç®—æ€»æˆæœ¬ï¼ˆè½¬æ¢ä¸ºè´§å¸å•ä½ï¼‰
    SELECT SUM(cost_amount * unit_cost) INTO v_cost
    FROM modeling_cost mc
    JOIN cost_breakdown cb ON mc.cost_item = cb.cost_item
    WHERE mc.project_name = p_project_name;

    -- è®¡ç®—æ€»æ•ˆç›Šï¼ˆæ€§èƒ½æå‡å¸¦æ¥çš„ä»·å€¼ï¼‰
    SELECT SUM(improvement_percent * 1000) INTO v_benefit  -- å‡è®¾1%æå‡=1000å…ƒä»·å€¼
    FROM performance_benefit
    WHERE project_name = p_project_name;

    RETURN QUERY SELECT
        v_cost,
        v_benefit,
        ((v_benefit - v_cost) / NULLIF(v_cost, 0) * 100) AS roi_percent,
        (v_cost / NULLIF(v_benefit / 12, 0)) AS payback_months;
END;
$$ LANGUAGE plpgsql;
```

### Q4: å¦‚ä½•æ¯”è¾ƒå¤šä¸ªå»ºæ¨¡æ–¹æ¡ˆï¼Ÿ

**A**: æ–¹æ¡ˆå¯¹æ¯”æ–¹æ³•ï¼š

```sql
-- å¤šæ–¹æ¡ˆå¯¹æ¯”è§†å›¾
CREATE VIEW modeling_option_comparison AS
SELECT
    option_name,
    SUM(development_cost) AS dev_cost,
    SUM(maintenance_cost) AS maint_cost,
    AVG(performance_score) AS perf_score,
    AVG(cost_score) AS cost_score,
    (AVG(performance_score) / NULLIF(SUM(development_cost + maintenance_cost), 0)) AS efficiency
FROM (
    SELECT
        'option_a' AS option_name,
        100 AS development_cost,
        10 AS maintenance_cost,
        80 AS performance_score,
        70 AS cost_score
    UNION ALL
    SELECT
        'option_b' AS option_name,
        150 AS development_cost,
        15 AS maintenance_cost,
        90 AS performance_score,
        60 AS cost_score
    UNION ALL
    SELECT
        'option_c' AS option_name,
        80 AS development_cost,
        8 AS maintenance_cost,
        70 AS performance_score,
        80 AS cost_score
) options
GROUP BY option_name
ORDER BY efficiency DESC;
```

### Q5: æˆæœ¬æ•ˆç›Šåˆ†æå¦‚ä½•æŒç»­è·Ÿè¸ªï¼Ÿ

**A**: æŒç»­è·Ÿè¸ªæ–¹æ³•ï¼š

```sql
-- æˆæœ¬æ•ˆç›Šè·Ÿè¸ªè¡¨
CREATE TABLE cost_benefit_tracking (
    tracking_id BIGSERIAL PRIMARY KEY,
    project_name VARCHAR(100) NOT NULL,
    tracking_date DATE NOT NULL,
    actual_cost NUMERIC(10,2),
    actual_benefit NUMERIC(10,2),
    performance_metrics JSONB,
    notes TEXT
);

-- å®šæœŸè·Ÿè¸ª
INSERT INTO cost_benefit_tracking (
    project_name, tracking_date, actual_cost, actual_benefit, performance_metrics
) VALUES (
    'index_optimization',
    CURRENT_DATE,
    1000,
    5000,
    '{"query_time_ms": 45, "throughput_qps": 2100}'::jsonb
);

-- ç”Ÿæˆè·Ÿè¸ªæŠ¥å‘Š
SELECT
    project_name,
    tracking_date,
    actual_cost,
    actual_benefit,
    (actual_benefit - actual_cost) AS net_benefit,
    ((actual_benefit - actual_cost) / NULLIF(actual_cost, 0) * 100) AS roi_percent
FROM cost_benefit_tracking
ORDER BY tracking_date DESC;
```

---

## 7. ç›¸å…³èµ„æº

- [å»ºæ¨¡å†³ç­–æ¡†æ¶](./å»ºæ¨¡å†³ç­–æ¡†æ¶.md) - å†³ç­–æ¡†æ¶æ–¹æ³•
- [æ€§èƒ½ä¼˜åŒ–](../08-PostgreSQLå»ºæ¨¡å®è·µ/æ€§èƒ½ä¼˜åŒ–.md) - æ€§èƒ½ä¼˜åŒ–æŒ‡å—
- [ç´¢å¼•ç­–ç•¥](../08-PostgreSQLå»ºæ¨¡å®è·µ/ç´¢å¼•ç­–ç•¥.md) - ç´¢å¼•ä¼˜åŒ–ç­–ç•¥
- [åˆ†åŒºç­–ç•¥](../08-PostgreSQLå»ºæ¨¡å®è·µ/åˆ†åŒºç­–ç•¥.md) - åˆ†åŒºä¼˜åŒ–ç­–ç•¥

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
