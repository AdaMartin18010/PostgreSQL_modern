# æ¨¡å‹è®­ç»ƒæ•°æ®ç®¡ç†æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æ¥æº**: PostgreSQL 18+ + TimescaleDB + å®è·µæ€»ç»“
> **çŠ¶æ€**: PostgreSQL 18+æ–°ç‰¹æ€§
> **æ–‡æ¡£ç¼–å·**: 11-03

---

## ğŸ“‘ ç›®å½•

- [æ¨¡å‹è®­ç»ƒæ•°æ®ç®¡ç†æŒ‡å—](#æ¨¡å‹è®­ç»ƒæ•°æ®ç®¡ç†æŒ‡å—)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
  - [1.1 ç†è®ºåŸºç¡€](#11-ç†è®ºåŸºç¡€)
    - [1.1.1 è®­ç»ƒæ•°æ®ç®¡ç†æ¦‚å¿µ](#111-è®­ç»ƒæ•°æ®ç®¡ç†æ¦‚å¿µ)
    - [1.1.2 æ•°æ®é›†åˆ†å‰²ç†è®º](#112-æ•°æ®é›†åˆ†å‰²ç†è®º)
    - [1.1.3 æ•°æ®æ ‡æ³¨ç†è®º](#113-æ•°æ®æ ‡æ³¨ç†è®º)
    - [1.1.4 æ•°æ®ç‰ˆæœ¬ç®¡ç†ç†è®º](#114-æ•°æ®ç‰ˆæœ¬ç®¡ç†ç†è®º)
    - [1.1.5 å¤æ‚åº¦åˆ†æ](#115-å¤æ‚åº¦åˆ†æ)
  - [2. è®­ç»ƒæ•°æ®é›†ç®¡ç†](#2-è®­ç»ƒæ•°æ®é›†ç®¡ç†)
    - [2.1 æ•°æ®é›†è¡¨](#21-æ•°æ®é›†è¡¨)
    - [2.2 æ—¶åºè®­ç»ƒæ•°æ®è¡¨ï¼ˆTimescaleDBï¼‰](#22-æ—¶åºè®­ç»ƒæ•°æ®è¡¨timescaledb)
    - [2.3 å‘é‡è®­ç»ƒæ•°æ®è¡¨ï¼ˆpgvectorï¼‰](#23-å‘é‡è®­ç»ƒæ•°æ®è¡¨pgvector)
  - [3. æ•°æ®æ ‡æ³¨ç®¡ç†](#3-æ•°æ®æ ‡æ³¨ç®¡ç†)
    - [3.1 æ ‡æ³¨ä»»åŠ¡è¡¨](#31-æ ‡æ³¨ä»»åŠ¡è¡¨)
    - [3.2 æ ‡æ³¨è®°å½•è¡¨](#32-æ ‡æ³¨è®°å½•è¡¨)
  - [4. æ•°æ®ç‰ˆæœ¬ç®¡ç†](#4-æ•°æ®ç‰ˆæœ¬ç®¡ç†)
    - [4.1 æ•°æ®é›†ç‰ˆæœ¬è¡¨](#41-æ•°æ®é›†ç‰ˆæœ¬è¡¨)
    - [4.2 æ•°æ®å˜æ›´æ—¥å¿—](#42-æ•°æ®å˜æ›´æ—¥å¿—)
  - [5. æ•°æ®è´¨é‡ç›‘æ§](#5-æ•°æ®è´¨é‡ç›‘æ§)
    - [5.1 æ•°æ®è´¨é‡æŒ‡æ ‡è¡¨](#51-æ•°æ®è´¨é‡æŒ‡æ ‡è¡¨)
    - [5.2 æ•°æ®è´¨é‡æŠ¥å‘Š](#52-æ•°æ®è´¨é‡æŠ¥å‘Š)
  - [6. PostgreSQL 18ä¼˜åŒ–](#6-postgresql-18ä¼˜åŒ–)
    - [6.1 è™šæ‹Ÿç”Ÿæˆåˆ—ä¼˜åŒ–](#61-è™šæ‹Ÿç”Ÿæˆåˆ—ä¼˜åŒ–)
    - [6.2 å¼‚æ­¥I/Oä¼˜åŒ–](#62-å¼‚æ­¥ioä¼˜åŒ–)
    - [6.3 TimescaleDBè¿ç»­èšåˆ](#63-timescaledbè¿ç»­èšåˆ)
  - [7. æ€§èƒ½ä¼˜åŒ–å»ºè®®](#7-æ€§èƒ½ä¼˜åŒ–å»ºè®®)
    - [7.1 ç´¢å¼•ä¼˜åŒ–ç­–ç•¥](#71-ç´¢å¼•ä¼˜åŒ–ç­–ç•¥)
    - [7.2 åˆ†åŒºç­–ç•¥ä¼˜åŒ–](#72-åˆ†åŒºç­–ç•¥ä¼˜åŒ–)
    - [7.3 TimescaleDBè¿ç»­èšåˆä¼˜åŒ–](#73-timescaledbè¿ç»­èšåˆä¼˜åŒ–)
    - [7.4 æ‰¹é‡æ“ä½œä¼˜åŒ–](#74-æ‰¹é‡æ“ä½œä¼˜åŒ–)
    - [7.5 PostgreSQL 18å¼‚æ­¥I/Oä¼˜åŒ–](#75-postgresql-18å¼‚æ­¥ioä¼˜åŒ–)
  - [8. æœ€ä½³å®è·µ](#8-æœ€ä½³å®è·µ)
    - [8.1 æ•°æ®é›†ç®¡ç†](#81-æ•°æ®é›†ç®¡ç†)
    - [8.2 æ•°æ®æ ‡æ³¨](#82-æ•°æ®æ ‡æ³¨)
    - [8.3 æ•°æ®è´¨é‡](#83-æ•°æ®è´¨é‡)
    - [8.4 SQLå®ç°æ³¨æ„äº‹é¡¹](#84-sqlå®ç°æ³¨æ„äº‹é¡¹)
  - [9. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#9-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
    - [é—®é¢˜1: è®­ç»ƒæ•°æ®æŸ¥è¯¢æ€§èƒ½æ…¢](#é—®é¢˜1-è®­ç»ƒæ•°æ®æŸ¥è¯¢æ€§èƒ½æ…¢)
    - [é—®é¢˜2: æ—¶åºè®­ç»ƒæ•°æ®å­˜å‚¨ç©ºé—´è¿‡å¤§](#é—®é¢˜2-æ—¶åºè®­ç»ƒæ•°æ®å­˜å‚¨ç©ºé—´è¿‡å¤§)
    - [é—®é¢˜3: æ•°æ®æ ‡æ³¨ä¸€è‡´æ€§ä½](#é—®é¢˜3-æ•°æ®æ ‡æ³¨ä¸€è‡´æ€§ä½)
    - [é—®é¢˜4: æ•°æ®é›†ç‰ˆæœ¬ç®¡ç†å¤æ‚](#é—®é¢˜4-æ•°æ®é›†ç‰ˆæœ¬ç®¡ç†å¤æ‚)
  - [10. ç›¸å…³èµ„æº](#10-ç›¸å…³èµ„æº)
    - [10.1 æ ¸å¿ƒç›¸å…³æ–‡æ¡£](#101-æ ¸å¿ƒç›¸å…³æ–‡æ¡£)
    - [10.2 å®˜æ–¹èµ„æº](#102-å®˜æ–¹èµ„æº)

---

## 1. æ¦‚è¿°

æ¨¡å‹è®­ç»ƒæ•°æ®ç®¡ç†æ¶‰åŠè®­ç»ƒæ•°æ®é›†çš„å­˜å‚¨ã€ç‰ˆæœ¬æ§åˆ¶ã€æ ‡æ³¨ç®¡ç†å’Œè´¨é‡ç›‘æ§ã€‚

**æ ¸å¿ƒéœ€æ±‚**:

- è®­ç»ƒæ•°æ®é›†ç®¡ç†
- æ•°æ®æ ‡æ³¨ç®¡ç†
- æ•°æ®ç‰ˆæœ¬æ§åˆ¶
- æ•°æ®è´¨é‡ç›‘æ§

---

## 1.1 ç†è®ºåŸºç¡€

### 1.1.1 è®­ç»ƒæ•°æ®ç®¡ç†æ¦‚å¿µ

**è®­ç»ƒæ•°æ®ç®¡ç†**æ˜¯æœºå™¨å­¦ä¹ ç”Ÿå‘½å‘¨æœŸä¸­çš„å…³é”®ç¯èŠ‚ï¼ŒåŒ…æ‹¬ï¼š

1. **æ•°æ®æ”¶é›†**: ä»å„ç§æ•°æ®æºæ”¶é›†åŸå§‹æ•°æ®
2. **æ•°æ®å­˜å‚¨**: é«˜æ•ˆå­˜å‚¨å¤§è§„æ¨¡è®­ç»ƒæ•°æ®
3. **æ•°æ®æ ‡æ³¨**: ä¸ºç›‘ç£å­¦ä¹ æä¾›æ ‡ç­¾æ•°æ®
4. **æ•°æ®ç‰ˆæœ¬æ§åˆ¶**: è·Ÿè¸ªæ•°æ®é›†çš„å˜æ›´å†å²
5. **æ•°æ®è´¨é‡ç›‘æ§**: ç¡®ä¿æ•°æ®è´¨é‡å’Œä¸€è‡´æ€§

### 1.1.2 æ•°æ®é›†åˆ†å‰²ç†è®º

**æ•°æ®é›†åˆ†å‰²åŸåˆ™**:

- **è®­ç»ƒé›†ï¼ˆTraining Setï¼‰**: ç”¨äºæ¨¡å‹è®­ç»ƒï¼Œé€šå¸¸å 60-80%
- **éªŒè¯é›†ï¼ˆValidation Setï¼‰**: ç”¨äºè¶…å‚æ•°è°ƒä¼˜ï¼Œé€šå¸¸å 10-20%
- **æµ‹è¯•é›†ï¼ˆTest Setï¼‰**: ç”¨äºæœ€ç»ˆè¯„ä¼°ï¼Œé€šå¸¸å 10-20%

**åˆ†å‰²æ–¹æ³•**:

- **éšæœºåˆ†å‰²**: éšæœºåˆ†é…æ ·æœ¬åˆ°ä¸åŒé›†åˆ
- **åˆ†å±‚åˆ†å‰²**: ä¿æŒç±»åˆ«åˆ†å¸ƒçš„åˆ†å‰²
- **æ—¶é—´åˆ†å‰²**: æŒ‰æ—¶é—´é¡ºåºåˆ†å‰²ï¼ˆæ—¶åºæ•°æ®ï¼‰

### 1.1.3 æ•°æ®æ ‡æ³¨ç†è®º

**æ ‡æ³¨è´¨é‡è¯„ä¼°**:

- **ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰**: æ ‡æ³¨è€…å†…éƒ¨ä¸€è‡´æ€§
- **å‡†ç¡®æ€§ï¼ˆAccuracyï¼‰**: æ ‡æ³¨ç»“æœå‡†ç¡®æ€§
- **å®Œæ•´æ€§ï¼ˆCompletenessï¼‰**: æ ‡æ³¨è¦†ç›–ç‡

**æ ‡æ³¨ä¸€è‡´æ€§åº¦é‡**:

- **Cohen's Kappa**: $\kappa = \frac{p_o - p_e}{1 - p_e}$
  - $p_o$: è§‚å¯Ÿä¸€è‡´æ€§
  - $p_e$: æœŸæœ›ä¸€è‡´æ€§

### 1.1.4 æ•°æ®ç‰ˆæœ¬ç®¡ç†ç†è®º

**æ•°æ®ç‰ˆæœ¬æ§åˆ¶åŸåˆ™**:

1. **ä¸å¯å˜æ€§**: å·²å‘å¸ƒçš„æ•°æ®é›†ç‰ˆæœ¬ä¸å¯ä¿®æ”¹
2. **å¯è¿½æº¯æ€§**: è®°å½•æ•°æ®é›†çš„æ¥æºå’Œå˜æ›´å†å²
3. **å¯é‡ç°æ€§**: èƒ½å¤Ÿé‡ç°æ•°æ®é›†çš„å¤„ç†è¿‡ç¨‹
4. **ç‰ˆæœ¬æ¯”è¾ƒ**: æ”¯æŒç‰ˆæœ¬é—´çš„å·®å¼‚åˆ†æ

### 1.1.5 å¤æ‚åº¦åˆ†æ

**å­˜å‚¨å¤æ‚åº¦**:

- **æ•°æ®é›†å…ƒæ•°æ®**: $O(D)$ where D is number of datasets
- **è®­ç»ƒæ•°æ®**: $O(S)$ where S is total samples
- **æ ‡æ³¨æ•°æ®**: $O(A)$ where A is number of annotations
- **ç‰ˆæœ¬å†å²**: $O(D \times V)$ where V is number of versions

**æŸ¥è¯¢å¤æ‚åº¦**:

- **æ•°æ®é›†æŸ¥æ‰¾**: $O(\log D)$ with index
- **æ ·æœ¬æŸ¥è¯¢**: $O(\log S)$ with index
- **æ ‡æ³¨æŸ¥è¯¢**: $O(\log A)$ with index

---

## 2. è®­ç»ƒæ•°æ®é›†ç®¡ç†

### 2.1 æ•°æ®é›†è¡¨

```sql
-- è®­ç»ƒæ•°æ®é›†è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    CREATE TABLE IF NOT EXISTS training_datasets (
        id SERIAL PRIMARY KEY,
        dataset_name VARCHAR(255) NOT NULL,
        dataset_type VARCHAR(50) NOT NULL,  -- 'text', 'image', 'tabular', 'time_series', etc.
        description TEXT,
        data_source VARCHAR(255),  -- æ•°æ®æ¥æº
        total_samples BIGINT,
        train_samples BIGINT,
        validation_samples BIGINT,
        test_samples BIGINT,
        data_path TEXT,  -- æ•°æ®é›†æ–‡ä»¶è·¯å¾„
        metadata JSONB DEFAULT '{}',
        created_at TIMESTAMPTZ DEFAULT NOW(),
        updated_at TIMESTAMPTZ DEFAULT NOW(),
        UNIQUE(dataset_name)
    );
    RAISE NOTICE 'è¡¨ training_datasets åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN duplicate_table THEN
        RAISE NOTICE 'è¡¨ training_datasets å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºè¡¨ training_datasets å¤±è´¥: %', SQLERRM;
END $$;

-- åˆ›å»ºç´¢å¼•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    CREATE INDEX IF NOT EXISTS idx_training_datasets_type ON training_datasets(dataset_type);
    CREATE INDEX IF NOT EXISTS idx_training_datasets_created_at ON training_datasets(created_at DESC);
    RAISE NOTICE 'ç´¢å¼•åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'åˆ›å»ºç´¢å¼•å¤±è´¥: %', SQLERRM;
END $$;
```

### 2.2 æ—¶åºè®­ç»ƒæ•°æ®è¡¨ï¼ˆTimescaleDBï¼‰

```sql
-- æ—¶åºè®­ç»ƒæ•°æ®ï¼ˆä½¿ç”¨TimescaleDBï¼Œå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    CREATE TABLE IF NOT EXISTS time_series_training_data (
        time TIMESTAMPTZ NOT NULL,
        series_id VARCHAR(255) NOT NULL,
        features JSONB NOT NULL,  -- ç‰¹å¾æ•°æ®
        label NUMERIC,  -- æ ‡ç­¾ï¼ˆå¦‚æœæœ‰ï¼‰
        metadata JSONB DEFAULT '{}',
        created_at TIMESTAMPTZ DEFAULT NOW()
    );
    RAISE NOTICE 'è¡¨ time_series_training_data åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN duplicate_table THEN
        RAISE NOTICE 'è¡¨ time_series_training_data å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºè¡¨ time_series_training_data å¤±è´¥: %', SQLERRM;
END $$;

-- åˆ›å»ºTimescaleDBè¶…è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    PERFORM create_hypertable(
        'time_series_training_data',
        'time',
        chunk_time_interval => INTERVAL '1 day',
        if_not_exists => TRUE
    );
    RAISE NOTICE 'TimescaleDBè¶…è¡¨åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'åˆ›å»ºTimescaleDBè¶…è¡¨å¤±è´¥: %', SQLERRM;
END $$;

-- åˆ›å»ºç´¢å¼•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    CREATE INDEX IF NOT EXISTS idx_time_series_training_data_series ON time_series_training_data(series_id, time DESC);
    CREATE INDEX IF NOT EXISTS idx_time_series_training_data_features ON time_series_training_data USING GIN (features);
    RAISE NOTICE 'ç´¢å¼•åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'åˆ›å»ºç´¢å¼•å¤±è´¥: %', SQLERRM;
END $$;
```

### 2.3 å‘é‡è®­ç»ƒæ•°æ®è¡¨ï¼ˆpgvectorï¼‰

```sql
-- å‘é‡è®­ç»ƒæ•°æ®ï¼ˆä½¿ç”¨pgvectorï¼Œå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    CREATE TABLE IF NOT EXISTS vector_training_data (
        id SERIAL PRIMARY KEY,
        dataset_id INTEGER NOT NULL REFERENCES training_datasets(id),
        input_vector vector(1536) NOT NULL,  -- è¾“å…¥å‘é‡
        output_vector vector(1536),  -- è¾“å‡ºå‘é‡ï¼ˆå¦‚æœæœ‰ï¼‰
        label INTEGER,  -- æ ‡ç­¾
        metadata JSONB DEFAULT '{}',
        created_at TIMESTAMPTZ DEFAULT NOW()
    );
    RAISE NOTICE 'è¡¨ vector_training_data åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN duplicate_table THEN
        RAISE NOTICE 'è¡¨ vector_training_data å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºè¡¨ vector_training_data å¤±è´¥: %', SQLERRM;
END $$;

-- åˆ›å»ºå‘é‡ç´¢å¼•ï¼ˆHNSWï¼Œå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    CREATE INDEX IF NOT EXISTS idx_vector_training_data_input_hnsw
    ON vector_training_data USING hnsw (input_vector vector_cosine_ops)
    WITH (m = 16, ef_construction = 64);
    RAISE NOTICE 'å‘é‡ç´¢å¼•åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'åˆ›å»ºå‘é‡ç´¢å¼•å¤±è´¥: %', SQLERRM;
END $$;

-- åˆ›å»ºæ•°æ®é›†ç´¢å¼•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    CREATE INDEX IF NOT EXISTS idx_vector_training_data_dataset ON vector_training_data(dataset_id);
    RAISE NOTICE 'æ•°æ®é›†ç´¢å¼•åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'åˆ›å»ºæ•°æ®é›†ç´¢å¼•å¤±è´¥: %', SQLERRM;
END $$;
```

---

## 3. æ•°æ®æ ‡æ³¨ç®¡ç†

### 3.1 æ ‡æ³¨ä»»åŠ¡è¡¨

```sql
-- æ ‡æ³¨ä»»åŠ¡è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    CREATE TABLE IF NOT EXISTS labeling_tasks (
        id SERIAL PRIMARY KEY,
        task_name VARCHAR(255) NOT NULL,
        dataset_id INTEGER NOT NULL REFERENCES training_datasets(id),
        task_type VARCHAR(50) NOT NULL,  -- 'classification', 'regression', 'segmentation', etc.
        status VARCHAR(20) NOT NULL CHECK (status IN ('pending', 'in_progress', 'completed', 'cancelled')),
        total_samples INTEGER,
        labeled_samples INTEGER DEFAULT 0,
        progress_percentage NUMERIC(5,2) GENERATED ALWAYS AS (
            CASE
                WHEN total_samples > 0 THEN (labeled_samples::NUMERIC / total_samples * 100)
                ELSE 0
            END
        ) VIRTUAL,  -- PostgreSQL 18è™šæ‹Ÿç”Ÿæˆåˆ—
        labeling_guidelines TEXT,
        created_at TIMESTAMPTZ DEFAULT NOW(),
        updated_at TIMESTAMPTZ DEFAULT NOW(),
        completed_at TIMESTAMPTZ,
        created_by VARCHAR(255)
    );
    RAISE NOTICE 'è¡¨ labeling_tasks åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN duplicate_table THEN
        RAISE NOTICE 'è¡¨ labeling_tasks å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºè¡¨ labeling_tasks å¤±è´¥: %', SQLERRM;
END $$;

-- åˆ›å»ºç´¢å¼•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    CREATE INDEX IF NOT EXISTS idx_labeling_tasks_dataset ON labeling_tasks(dataset_id);
    CREATE INDEX IF NOT EXISTS idx_labeling_tasks_status ON labeling_tasks(status);
    RAISE NOTICE 'ç´¢å¼•åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'åˆ›å»ºç´¢å¼•å¤±è´¥: %', SQLERRM;
END $$;

```

### 3.2 æ ‡æ³¨è®°å½•è¡¨

```sql
-- æ ‡æ³¨è®°å½•è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    CREATE TABLE IF NOT EXISTS labeling_records (
        id BIGSERIAL PRIMARY KEY,
        task_id INTEGER NOT NULL REFERENCES labeling_tasks(id),
        sample_id VARCHAR(255) NOT NULL,
        label_value JSONB NOT NULL,  -- æ ‡ç­¾å€¼ï¼ˆæ”¯æŒå„ç§ç±»å‹ï¼‰
        confidence_score NUMERIC(5,4),  -- æ ‡æ³¨ç½®ä¿¡åº¦
        annotator_id VARCHAR(255),  -- æ ‡æ³¨å‘˜ID
        annotation_time INTERVAL,  -- æ ‡æ³¨è€—æ—¶
        quality_score NUMERIC(5,4),  -- è´¨é‡è¯„åˆ†
        notes TEXT,
        created_at TIMESTAMPTZ DEFAULT NOW(),
        updated_at TIMESTAMPTZ DEFAULT NOW(),
        UNIQUE(task_id, sample_id)
    );
    RAISE NOTICE 'è¡¨ labeling_records åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN duplicate_table THEN
        RAISE NOTICE 'è¡¨ labeling_records å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºè¡¨ labeling_records å¤±è´¥: %', SQLERRM;
END $$;

-- åˆ›å»ºç´¢å¼•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    CREATE INDEX IF NOT EXISTS idx_labeling_records_task ON labeling_records(task_id);
    CREATE INDEX IF NOT EXISTS idx_labeling_records_annotator ON labeling_records(annotator_id);
    CREATE INDEX IF NOT EXISTS idx_labeling_records_created_at ON labeling_records(created_at DESC);
    RAISE NOTICE 'ç´¢å¼•åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'åˆ›å»ºç´¢å¼•å¤±è´¥: %', SQLERRM;
END $$;
```

---

## 4. æ•°æ®ç‰ˆæœ¬ç®¡ç†

### 4.1 æ•°æ®é›†ç‰ˆæœ¬è¡¨

```sql
-- æ•°æ®é›†ç‰ˆæœ¬è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    CREATE TABLE IF NOT EXISTS dataset_versions (
        id SERIAL PRIMARY KEY,
        dataset_id INTEGER NOT NULL REFERENCES training_datasets(id),
        version VARCHAR(50) NOT NULL,
        version_type VARCHAR(20) NOT NULL CHECK (version_type IN ('major', 'minor', 'patch')),
        changes_description TEXT,
        data_path TEXT NOT NULL,
        checksum VARCHAR(64),  -- æ•°æ®é›†æ ¡éªŒå’Œ
        total_samples BIGINT,
        train_samples BIGINT,
        validation_samples BIGINT,
        test_samples BIGINT,
        is_active BOOLEAN DEFAULT FALSE,
        created_at TIMESTAMPTZ DEFAULT NOW(),
        created_by VARCHAR(255),
        UNIQUE(dataset_id, version)
    );
    RAISE NOTICE 'è¡¨ dataset_versions åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN duplicate_table THEN
        RAISE NOTICE 'è¡¨ dataset_versions å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºè¡¨ dataset_versions å¤±è´¥: %', SQLERRM;
END $$;

-- åˆ›å»ºç´¢å¼•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    CREATE INDEX IF NOT EXISTS idx_dataset_versions_dataset ON dataset_versions(dataset_id);
    RAISE NOTICE 'ç´¢å¼•åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'åˆ›å»ºç´¢å¼•å¤±è´¥: %', SQLERRM;
END $$;

-- åˆ›å»ºéƒ¨åˆ†ç´¢å¼•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    CREATE INDEX IF NOT EXISTS idx_dataset_versions_active ON dataset_versions(dataset_id, is_active) WHERE is_active = TRUE;
    RAISE NOTICE 'éƒ¨åˆ†ç´¢å¼•åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'åˆ›å»ºéƒ¨åˆ†ç´¢å¼•å¤±è´¥: %', SQLERRM;
END $$;

```

### 4.2 æ•°æ®å˜æ›´æ—¥å¿—

```sql
-- æ•°æ®å˜æ›´æ—¥å¿—è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_tables WHERE tablename = 'dataset_change_logs') THEN
        CREATE TABLE dataset_change_logs (
            id BIGSERIAL,
            dataset_id INTEGER NOT NULL REFERENCES training_datasets(id),
            version_id INTEGER REFERENCES dataset_versions(id),
            change_type VARCHAR(50) NOT NULL,  -- 'add', 'remove', 'modify', 'split', 'merge'
            change_details JSONB DEFAULT '{}',
            samples_affected BIGINT,
            created_at TIMESTAMPTZ DEFAULT NOW(),
            created_by VARCHAR(255),
            PRIMARY KEY (id, created_at)
        ) PARTITION BY RANGE (created_at);
        RAISE NOTICE 'åˆ†åŒºè¡¨ dataset_change_logs åˆ›å»ºæˆåŠŸ';
    ELSE
        RAISE NOTICE 'è¡¨ dataset_change_logs å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º';
    END IF;
EXCEPTION
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºåˆ†åŒºè¡¨ dataset_change_logs å¤±è´¥: %', SQLERRM;
END $$;

-- åˆ›å»ºæœˆåº¦åˆ†åŒºï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    CREATE TABLE IF NOT EXISTS dataset_change_logs_2024_01 PARTITION OF dataset_change_logs
    FOR VALUES FROM ('2024-01-01') TO ('2024-02-01');
    RAISE NOTICE 'åˆ†åŒºåˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN duplicate_table THEN
        RAISE NOTICE 'åˆ†åŒºå·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º';
    WHEN OTHERS THEN
        RAISE WARNING 'åˆ›å»ºåˆ†åŒºå¤±è´¥: %', SQLERRM;
END $$;

-- åˆ›å»ºç´¢å¼•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    CREATE INDEX IF NOT EXISTS idx_dataset_change_logs_dataset ON dataset_change_logs(dataset_id, created_at DESC);
    RAISE NOTICE 'ç´¢å¼•åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'åˆ›å»ºç´¢å¼•å¤±è´¥: %', SQLERRM;
END $$;
```

---

## 5. æ•°æ®è´¨é‡ç›‘æ§

### 5.1 æ•°æ®è´¨é‡æŒ‡æ ‡è¡¨

```sql
-- æ•°æ®è´¨é‡æŒ‡æ ‡è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    CREATE TABLE IF NOT EXISTS data_quality_metrics (
        id SERIAL PRIMARY KEY,
        dataset_id INTEGER NOT NULL REFERENCES training_datasets(id),
        version_id INTEGER REFERENCES dataset_versions(id),
        metric_name VARCHAR(100) NOT NULL,  -- 'completeness', 'accuracy', 'consistency', etc.
        metric_value NUMERIC(10,6) NOT NULL,
        threshold_value NUMERIC(10,6),  -- é˜ˆå€¼
        status VARCHAR(20) GENERATED ALWAYS AS (
            CASE
                WHEN threshold_value IS NULL THEN 'unknown'
                WHEN metric_value >= threshold_value THEN 'pass'
                ELSE 'fail'
            END
        ) VIRTUAL,  -- PostgreSQL 18è™šæ‹Ÿç”Ÿæˆåˆ—
        evaluated_at TIMESTAMPTZ DEFAULT NOW(),
        notes TEXT
    );
    RAISE NOTICE 'è¡¨ data_quality_metrics åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN duplicate_table THEN
        RAISE NOTICE 'è¡¨ data_quality_metrics å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºè¡¨ data_quality_metrics å¤±è´¥: %', SQLERRM;
END $$;

-- åˆ›å»ºç´¢å¼•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    CREATE INDEX IF NOT EXISTS idx_data_quality_metrics_dataset ON data_quality_metrics(dataset_id);
    CREATE INDEX IF NOT EXISTS idx_data_quality_metrics_status ON data_quality_metrics(status);
    CREATE INDEX IF NOT EXISTS idx_data_quality_metrics_evaluated_at ON data_quality_metrics(evaluated_at DESC);
    RAISE NOTICE 'ç´¢å¼•åˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'åˆ›å»ºç´¢å¼•å¤±è´¥: %', SQLERRM;
END $$;
```

### 5.2 æ•°æ®è´¨é‡æŠ¥å‘Š

```sql
-- ç”Ÿæˆæ•°æ®è´¨é‡æŠ¥å‘Š
CREATE OR REPLACE FUNCTION generate_data_quality_report(
    p_dataset_id INTEGER,
    p_version_id INTEGER DEFAULT NULL
)
RETURNS TABLE (
    metric_name VARCHAR(100),
    metric_value NUMERIC(10,6),
    threshold_value NUMERIC(10,6),
    status VARCHAR(20),
    evaluated_at TIMESTAMPTZ
) AS $$
BEGIN
    RETURN QUERY
    SELECT
        dqm.metric_name,
        dqm.metric_value,
        dqm.threshold_value,
        dqm.status,
        dqm.evaluated_at
    FROM data_quality_metrics dqm
    WHERE dqm.dataset_id = p_dataset_id
      AND (p_version_id IS NULL OR dqm.version_id = p_version_id)
    ORDER BY dqm.evaluated_at DESC;
END;
$$ LANGUAGE plpgsql;
```

---

## 6. PostgreSQL 18ä¼˜åŒ–

### 6.1 è™šæ‹Ÿç”Ÿæˆåˆ—ä¼˜åŒ–

```sql
-- PostgreSQL 18ï¼šä½¿ç”¨è™šæ‹Ÿç”Ÿæˆåˆ—ä¼˜åŒ–è®¡ç®—å­—æ®µ
ALTER TABLE labeling_tasks
ADD COLUMN progress_percentage NUMERIC(5,2) GENERATED ALWAYS AS (
    CASE
        WHEN total_samples > 0 THEN (labeled_samples::NUMERIC / total_samples * 100)
        ELSE 0
    END
) VIRTUAL;

ALTER TABLE data_quality_metrics
ADD COLUMN status VARCHAR(20) GENERATED ALWAYS AS (
    CASE
        WHEN threshold_value IS NULL THEN 'unknown'
        WHEN metric_value >= threshold_value THEN 'pass'
        ELSE 'fail'
    END
) VIRTUAL;
```

### 6.2 å¼‚æ­¥I/Oä¼˜åŒ–

```sql
-- PostgreSQL 18ï¼šå¼‚æ­¥I/Oä¼˜åŒ–ï¼ˆæ—¶åºè®­ç»ƒæ•°æ®å†™å…¥ï¼‰
BEGIN;
DO $$
BEGIN
    ALTER SYSTEM SET io_direct = 'data';
    ALTER SYSTEM SET io_combine_limit = '256kB';
    PERFORM pg_reload_conf();
    RAISE NOTICE 'å¼‚æ­¥I/Oé…ç½®å·²æ›´æ–°ï¼ˆæ—¶åºè®­ç»ƒæ•°æ®å†™å…¥æ€§èƒ½æå‡50-60%ï¼‰';
EXCEPTION
    WHEN OTHERS THEN
        RAISE NOTICE 'é…ç½®å¼‚æ­¥I/Oå¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;
END $$;
COMMIT;
```

### 6.3 TimescaleDBè¿ç»­èšåˆ

```sql
-- åˆ›å»ºæ—¶åºè®­ç»ƒæ•°æ®çš„è¿ç»­èšåˆï¼ˆç”¨äºå¿«é€Ÿç»Ÿè®¡ï¼‰
CREATE MATERIALIZED VIEW time_series_training_data_hourly
WITH (timescaledb.continuous) AS
SELECT
    time_bucket('1 hour', time) AS bucket,
    series_id,
    COUNT(*) AS sample_count,
    AVG((features->>'value')::NUMERIC) AS avg_value,
    MIN((features->>'value')::NUMERIC) AS min_value,
    MAX((features->>'value')::NUMERIC) AS max_value
FROM time_series_training_data
GROUP BY bucket, series_id;

-- åˆ›å»ºåˆ·æ–°ç­–ç•¥
SELECT add_continuous_aggregate_policy(
    'time_series_training_data_hourly',
    start_offset => INTERVAL '1 day',
    end_offset => INTERVAL '1 hour',
    schedule_interval => INTERVAL '1 hour'
);
```

---

## 7. æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 7.1 ç´¢å¼•ä¼˜åŒ–ç­–ç•¥

**æ•°æ®é›†æŸ¥è¯¢ä¼˜åŒ–**:

```sql
-- ä¸ºå¸¸ç”¨æŸ¥è¯¢åˆ›å»ºå¤åˆç´¢å¼•
CREATE INDEX idx_training_datasets_type_created ON training_datasets(dataset_type, created_at DESC);
CREATE INDEX idx_training_datasets_name_type ON training_datasets(dataset_name, dataset_type);

-- ä¸ºJSONBå­—æ®µåˆ›å»ºGINç´¢å¼•
CREATE INDEX idx_training_datasets_metadata ON training_datasets USING gin(metadata);
```

**æ—¶åºæ•°æ®ç´¢å¼•ä¼˜åŒ–**:

```sql
-- TimescaleDBè‡ªåŠ¨ç´¢å¼•ä¼˜åŒ–
CREATE INDEX idx_time_series_training_data_series_time
ON time_series_training_data(series_id, time DESC);

-- JSONBç‰¹å¾ç´¢å¼•
CREATE INDEX idx_time_series_training_data_features
ON time_series_training_data USING gin(features);
```

**å‘é‡æ•°æ®ç´¢å¼•ä¼˜åŒ–**:

```sql
-- pgvector HNSWç´¢å¼•ä¼˜åŒ–
CREATE INDEX idx_vector_training_data_input_hnsw
ON vector_training_data USING hnsw (input_vector vector_cosine_ops)
WITH (m = 16, ef_construction = 64);
```

### 7.2 åˆ†åŒºç­–ç•¥ä¼˜åŒ–

**æ—¶åºæ•°æ®åˆ†åŒºï¼ˆTimescaleDBï¼‰**:

```sql
-- TimescaleDBè‡ªåŠ¨åˆ†åŒºä¼˜åŒ–
SELECT create_hypertable(
    'time_series_training_data',
    'time',
    chunk_time_interval => INTERVAL '1 day',
    if_not_exists => TRUE
);

-- è°ƒæ•´chunkå¤§å°ä»¥ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
SELECT set_chunk_time_interval('time_series_training_data', INTERVAL '1 day');
```

**å‘é‡æ•°æ®åˆ†åŒº**:

```sql
-- æŒ‰æ•°æ®é›†IDåˆ†åŒº
CREATE TABLE vector_training_data (
    id BIGSERIAL,
    dataset_id INTEGER NOT NULL,
    input_vector vector(1536) NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    PRIMARY KEY (id, dataset_id)
) PARTITION BY HASH (dataset_id);

-- åˆ›å»ºåˆ†åŒº
CREATE TABLE vector_training_data_0 PARTITION OF vector_training_data
FOR VALUES WITH (MODULUS 4, REMAINDER 0);
```

### 7.3 TimescaleDBè¿ç»­èšåˆä¼˜åŒ–

**é¢„èšåˆå¸¸ç”¨ç»Ÿè®¡**:

```sql
-- åˆ›å»ºè¿ç»­èšåˆè§†å›¾
CREATE MATERIALIZED VIEW time_series_training_data_hourly
WITH (timescaledb.continuous) AS
SELECT
    time_bucket('1 hour', time) AS bucket,
    series_id,
    COUNT(*) AS sample_count,
    AVG((features->>'value')::NUMERIC) AS avg_value
FROM time_series_training_data
GROUP BY bucket, series_id;

-- è‡ªåŠ¨åˆ·æ–°ç­–ç•¥
SELECT add_continuous_aggregate_policy(
    'time_series_training_data_hourly',
    start_offset => INTERVAL '1 day',
    end_offset => INTERVAL '1 hour',
    schedule_interval => INTERVAL '1 hour'
);
```

### 7.4 æ‰¹é‡æ“ä½œä¼˜åŒ–

**æ‰¹é‡æ•°æ®æ’å…¥**:

```sql
-- ä½¿ç”¨COPYå‘½ä»¤æ‰¹é‡æ’å…¥ï¼ˆæ€§èƒ½æå‡10-100å€ï¼‰
COPY vector_training_data (dataset_id, input_vector, label)
FROM STDIN WITH (FORMAT csv);

-- æˆ–ä½¿ç”¨INSERT ... VALUESæ‰¹é‡æ’å…¥
INSERT INTO vector_training_data (dataset_id, input_vector, label)
VALUES
    (1, '[0.1,0.2,0.3]'::vector, 0),
    (1, '[0.4,0.5,0.6]'::vector, 1);
```

### 7.5 PostgreSQL 18å¼‚æ­¥I/Oä¼˜åŒ–

**å¼‚æ­¥I/Oé…ç½®**:

```sql
-- PostgreSQL 18ï¼šå¯ç”¨å¼‚æ­¥I/Oä¼˜åŒ–æ•°æ®å†™å…¥
ALTER SYSTEM SET io_direct = 'data';
ALTER SYSTEM SET io_combine_limit = '256kB';
SELECT pg_reload_conf();
```

---

## 8. æœ€ä½³å®è·µ

### 8.1 æ•°æ®é›†ç®¡ç†

1. **ç‰ˆæœ¬æ§åˆ¶**: å¯¹æ•°æ®é›†è¿›è¡Œç‰ˆæœ¬ç®¡ç†ï¼Œè®°å½•å˜æ›´å†å²
2. **æ•°æ®åˆ†å‰²**: æ˜ç¡®è®°å½•è®­ç»ƒ/éªŒè¯/æµ‹è¯•é›†åˆ†å‰²
3. **æ•°æ®æ ¡éªŒ**: ä½¿ç”¨æ ¡éªŒå’Œç¡®ä¿æ•°æ®å®Œæ•´æ€§
4. **æ•°æ®å¤‡ä»½**: å®šæœŸå¤‡ä»½é‡è¦æ•°æ®é›†

### 8.2 æ•°æ®æ ‡æ³¨

1. **æ ‡æ³¨æŒ‡å—**: æä¾›æ¸…æ™°çš„æ ‡æ³¨æŒ‡å—
2. **è´¨é‡æ§åˆ¶**: å¯¹æ ‡æ³¨è´¨é‡è¿›è¡Œç›‘æ§å’Œè¯„ä¼°
3. **å¤šäººæ ‡æ³¨**: æ”¯æŒå¤šäººæ ‡æ³¨å’Œä¸€è‡´æ€§æ£€æŸ¥
4. **æ ‡æ³¨å®¡æ ¸**: å»ºç«‹æ ‡æ³¨å®¡æ ¸æœºåˆ¶

### 8.3 æ•°æ®è´¨é‡

1. **å®šæœŸæ£€æŸ¥**: å®šæœŸæ£€æŸ¥æ•°æ®è´¨é‡æŒ‡æ ‡
2. **é˜ˆå€¼è®¾ç½®**: è®¾ç½®åˆç†çš„æ•°æ®è´¨é‡é˜ˆå€¼
3. **å¼‚å¸¸å¤„ç†**: åŠæ—¶å‘ç°å’Œå¤„ç†æ•°æ®å¼‚å¸¸
4. **è´¨é‡æŠ¥å‘Š**: ç”Ÿæˆæ•°æ®è´¨é‡æŠ¥å‘Š

### 8.4 SQLå®ç°æ³¨æ„äº‹é¡¹

1. **é”™è¯¯å¤„ç†**: ä½¿ç”¨DOå—å¤„ç†æ•°æ®æ“ä½œé”™è¯¯
2. **äº‹åŠ¡ç®¡ç†**: æ•°æ®é›†æ›´æ–°åº”åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œ
3. **æ€§èƒ½ç›‘æ§**: ä½¿ç”¨EXPLAIN (ANALYZE, BUFFERS, TIMING)åˆ†ææŸ¥è¯¢æ€§èƒ½
4. **æ•°æ®ä¸€è‡´æ€§**: ç¡®ä¿æ•°æ®é›†å’Œæ ·æœ¬æ•°æ®çš„ä¸€è‡´æ€§

---

## 9. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: è®­ç»ƒæ•°æ®æŸ¥è¯¢æ€§èƒ½æ…¢

**åŸå› **:

- ç¼ºå°‘ç´¢å¼•
- å…¨è¡¨æ‰«æ
- æ•°æ®é‡è¿‡å¤§

**è§£å†³æ–¹æ¡ˆ**:

- ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µåˆ›å»ºç´¢å¼•
- ä½¿ç”¨TimescaleDBåˆ†åŒºä¼˜åŒ–æ—¶åºæ•°æ®
- ä½¿ç”¨pgvectorç´¢å¼•ä¼˜åŒ–å‘é‡æŸ¥è¯¢

**ç¤ºä¾‹**:

```sql
-- ä¼˜åŒ–å‰ï¼šå…¨è¡¨æ‰«æ
SELECT * FROM vector_training_data
WHERE dataset_id = 1;

-- ä¼˜åŒ–åï¼šä½¿ç”¨ç´¢å¼•å’Œåˆ†åŒº
CREATE INDEX idx_vector_training_data_dataset
ON vector_training_data(dataset_id);

SELECT * FROM vector_training_data
WHERE dataset_id = 1
LIMIT 1000;
```

### é—®é¢˜2: æ—¶åºè®­ç»ƒæ•°æ®å­˜å‚¨ç©ºé—´è¿‡å¤§

**åŸå› **:

- æ•°æ®æœªå‹ç¼©
- å†å²æ•°æ®æœªå½’æ¡£
- ç¼ºå°‘æ•°æ®ä¿ç•™ç­–ç•¥

**è§£å†³æ–¹æ¡ˆ**:

- ä½¿ç”¨TimescaleDBå‹ç¼©ç­–ç•¥
- å®šæœŸå½’æ¡£å†å²æ•°æ®
- å®æ–½æ•°æ®ä¿ç•™ç­–ç•¥

**ç¤ºä¾‹**:

```sql
-- TimescaleDBå‹ç¼©ç­–ç•¥
SELECT add_compression_policy('time_series_training_data', INTERVAL '7 days');

-- å½’æ¡£æ—§æ•°æ®
CREATE TABLE time_series_training_data_archive (LIKE time_series_training_data INCLUDING ALL);
INSERT INTO time_series_training_data_archive
SELECT * FROM time_series_training_data
WHERE time < NOW() - INTERVAL '1 year';
DELETE FROM time_series_training_data
WHERE time < NOW() - INTERVAL '1 year';
```

### é—®é¢˜3: æ•°æ®æ ‡æ³¨ä¸€è‡´æ€§ä½

**åŸå› **:

- æ ‡æ³¨æŒ‡å—ä¸æ¸…æ™°
- ç¼ºå°‘æ ‡æ³¨è´¨é‡æ§åˆ¶
- å¤šäººæ ‡æ³¨æœªè¿›è¡Œä¸€è‡´æ€§æ£€æŸ¥

**è§£å†³æ–¹æ¡ˆ**:

- æä¾›è¯¦ç»†çš„æ ‡æ³¨æŒ‡å—
- å®æ–½æ ‡æ³¨è´¨é‡æ§åˆ¶æœºåˆ¶
- è®¡ç®—æ ‡æ³¨ä¸€è‡´æ€§æŒ‡æ ‡

**ç¤ºä¾‹**:

```sql
-- è®¡ç®—æ ‡æ³¨ä¸€è‡´æ€§ï¼ˆCohen's Kappaï¼‰
WITH annotation_stats AS (
    SELECT
        sample_id,
        COUNT(DISTINCT annotator_id) AS annotator_count,
        COUNT(DISTINCT label) AS label_count,
        MODE() WITHIN GROUP (ORDER BY label) AS majority_label
    FROM labeling_records
    GROUP BY sample_id
)
SELECT
    AVG(CASE WHEN annotator_count > 1 AND label_count = 1 THEN 1.0 ELSE 0.0 END) AS consistency_rate
FROM annotation_stats;
```

### é—®é¢˜4: æ•°æ®é›†ç‰ˆæœ¬ç®¡ç†å¤æ‚

**åŸå› **:

- ç‰ˆæœ¬ä¿¡æ¯åˆ†æ•£
- ç¼ºå°‘ç‰ˆæœ¬æ¯”è¾ƒå·¥å…·
- ç‰ˆæœ¬å›æ»šå›°éš¾

**è§£å†³æ–¹æ¡ˆ**:

- é›†ä¸­ç®¡ç†ç‰ˆæœ¬ä¿¡æ¯
- åˆ›å»ºç‰ˆæœ¬æ¯”è¾ƒè§†å›¾
- å®ç°ç‰ˆæœ¬å›æ»šæœºåˆ¶

**ç¤ºä¾‹**:

```sql
-- åˆ›å»ºç‰ˆæœ¬æ¯”è¾ƒè§†å›¾
CREATE VIEW v_dataset_version_comparison AS
SELECT
    dv1.dataset_id,
    dv1.version AS version1,
    dv2.version AS version2,
    dv1.total_samples AS samples1,
    dv2.total_samples AS samples2,
    dv2.total_samples - dv1.total_samples AS sample_diff
FROM dataset_versions dv1
JOIN dataset_versions dv2 ON dv1.dataset_id = dv2.dataset_id
WHERE dv1.version != dv2.version;

-- ç‰ˆæœ¬å›æ»šå‡½æ•°
CREATE OR REPLACE FUNCTION rollback_dataset_version(
    p_dataset_id INTEGER,
    p_target_version VARCHAR(50)
)
RETURNS VOID AS $$
BEGIN
    -- åœç”¨å½“å‰ç‰ˆæœ¬
    UPDATE dataset_versions
    SET is_active = FALSE
    WHERE dataset_id = p_dataset_id AND is_active = TRUE;

    -- æ¿€æ´»ç›®æ ‡ç‰ˆæœ¬
    UPDATE dataset_versions
    SET is_active = TRUE
    WHERE dataset_id = p_dataset_id AND version = p_target_version;
END;
$$ LANGUAGE plpgsql;
```

---

## 10. ç›¸å…³èµ„æº

### 10.1 æ ¸å¿ƒç›¸å…³æ–‡æ¡£

- [æ—¶åºæ•°æ®å»ºæ¨¡](../06-IoTä¸æ—¶åºå»ºæ¨¡/æ—¶åºæ•°æ®æ¨¡å‹.md) - TimescaleDBå»ºæ¨¡æŒ‡å—
- [å‘é‡æ•°æ®åº“å»ºæ¨¡](../08-PostgreSQLå»ºæ¨¡å®è·µ/å‘é‡æ•°æ®åº“å»ºæ¨¡.md) - pgvectorå»ºæ¨¡æŒ‡å—
- [PostgreSQL18æ–°ç‰¹æ€§](../08-PostgreSQLå»ºæ¨¡å®è·µ/PostgreSQL18æ–°ç‰¹æ€§.md) - PostgreSQL 18æ–°ç‰¹æ€§æŒ‡å—

### 10.2 å®˜æ–¹èµ„æº

- [TimescaleDBæ–‡æ¡£](https://docs.timescale.com/) - TimescaleDBå®˜æ–¹æ–‡æ¡£
- [pgvector GitHub](https://github.com/pgvector/pgvector) - pgvectorå®˜æ–¹ä»“åº“
- [PostgreSQL 18æ–‡æ¡£](https://www.postgresql.org/docs/18/) - PostgreSQL 18å®˜æ–¹æ–‡æ¡£

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**çŠ¶æ€**: âœ… å·²å®Œæˆ
