# å·¥ä½œåŠªåŠ›æ¨¡å‹å®Œæ•´æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æ¥æº**: Silverstonã€Šæ•°æ®æ¨¡å‹èµ„æºæ‰‹å†Œã€‹å·1 Chapter 6 - Work Efforts + å®è·µæ€»ç»“
> **çŠ¶æ€**: åŸºäºæƒå¨èµ„æºæ·±åŒ–æ‰©å±•
> **æ–‡æ¡£ç¼–å·**: 04-05

---

## ğŸ“‘ ç›®å½•

- [å·¥ä½œåŠªåŠ›æ¨¡å‹å®Œæ•´æŒ‡å—](#å·¥ä½œåŠªåŠ›æ¨¡å‹å®Œæ•´æŒ‡å—)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 ä¸šåŠ¡èƒŒæ™¯](#11-ä¸šåŠ¡èƒŒæ™¯)
    - [1.2 æ ¸å¿ƒæ¦‚å¿µ](#12-æ ¸å¿ƒæ¦‚å¿µ)
    - [1.3 ç†è®ºåŸºç¡€](#13-ç†è®ºåŸºç¡€)
    - [1.4 ä¸Volume 1çš„å¯¹åº”å…³ç³»](#14-ä¸volume-1çš„å¯¹åº”å…³ç³»)
  - [2. å·¥ä½œéœ€æ±‚ä¸å·¥ä½œåŠªåŠ›](#2-å·¥ä½œéœ€æ±‚ä¸å·¥ä½œåŠªåŠ›)
    - [2.1 Work Requirementï¼ˆå·¥ä½œéœ€æ±‚ï¼‰](#21-work-requirementå·¥ä½œéœ€æ±‚)
    - [2.2 Work Effortï¼ˆå·¥ä½œåŠªåŠ›ï¼‰](#22-work-effortå·¥ä½œåŠªåŠ›)
    - [2.3 å·¥ä½œåŠªåŠ›ç±»å‹](#23-å·¥ä½œåŠªåŠ›ç±»å‹)
    - [2.4 å·¥ä½œåŠªåŠ›å±‚çº§ç»“æ„](#24-å·¥ä½œåŠªåŠ›å±‚çº§ç»“æ„)
  - [3. å·¥ä½œåŠªåŠ›å…³è”](#3-å·¥ä½œåŠªåŠ›å…³è”)
    - [3.1 å·¥ä½œåŠªåŠ›åˆ†è§£](#31-å·¥ä½œåŠªåŠ›åˆ†è§£)
    - [3.2 å·¥ä½œåŠªåŠ›ä¾èµ–](#32-å·¥ä½œåŠªåŠ›ä¾èµ–)
    - [3.3 å·¥ä½œåŠªåŠ›å…³è”ï¼ˆé€’å½’æ¨¡å‹ï¼‰](#33-å·¥ä½œåŠªåŠ›å…³è”é€’å½’æ¨¡å‹)
  - [4. èµ„æºåˆ†é…](#4-èµ„æºåˆ†é…)
    - [4.1 äººå‘˜åˆ†é…ï¼ˆParty Assignmentï¼‰](#41-äººå‘˜åˆ†é…party-assignment)
    - [4.2 åº“å­˜åˆ†é…ï¼ˆInventory Assignmentï¼‰](#42-åº“å­˜åˆ†é…inventory-assignment)
    - [4.3 å›ºå®šèµ„äº§åˆ†é…ï¼ˆFixed Asset Assignmentï¼‰](#43-å›ºå®šèµ„äº§åˆ†é…fixed-asset-assignment)
    - [4.4 æŠ€èƒ½æ ‡å‡†](#44-æŠ€èƒ½æ ‡å‡†)
  - [5. æ—¶é—´è·Ÿè¸ª](#5-æ—¶é—´è·Ÿè¸ª)
    - [5.1 Time Entryï¼ˆæ—¶é—´å½•å…¥ï¼‰](#51-time-entryæ—¶é—´å½•å…¥)
    - [5.2 å·¥ä½œåŠªåŠ›è´¹ç‡](#52-å·¥ä½œåŠªåŠ›è´¹ç‡)
  - [6. å·¥ä½œåŠªåŠ›ç»“æœ](#6-å·¥ä½œåŠªåŠ›ç»“æœ)
  - [7. PostgreSQLå®Œæ•´å®ç°](#7-postgresqlå®Œæ•´å®ç°)
  - [8. æŸ¥è¯¢ç¤ºä¾‹](#8-æŸ¥è¯¢ç¤ºä¾‹)
    - [æŸ¥è¯¢1: è·å–å·¥ä½œåŠªåŠ›çš„å®Œæ•´å±‚çº§ç»“æ„](#æŸ¥è¯¢1-è·å–å·¥ä½œåŠªåŠ›çš„å®Œæ•´å±‚çº§ç»“æ„)
    - [æŸ¥è¯¢2: è®¡ç®—å·¥ä½œåŠªåŠ›çš„æˆæœ¬](#æŸ¥è¯¢2-è®¡ç®—å·¥ä½œåŠªåŠ›çš„æˆæœ¬)
  - [9. æ€§èƒ½ä¼˜åŒ–](#9-æ€§èƒ½ä¼˜åŒ–)
    - [9.1 ç´¢å¼•ç­–ç•¥](#91-ç´¢å¼•ç­–ç•¥)
    - [9.2 PostgreSQL 18ä¼˜åŒ–](#92-postgresql-18ä¼˜åŒ–)
  - [10. å®é™…åº”ç”¨æ¡ˆä¾‹](#10-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [æ¡ˆä¾‹1: é¡¹ç›®ç®¡ç†](#æ¡ˆä¾‹1-é¡¹ç›®ç®¡ç†)
    - [æ¡ˆä¾‹2: ç”Ÿäº§ç®¡ç†](#æ¡ˆä¾‹2-ç”Ÿäº§ç®¡ç†)
  - [11. å¸¸è§é—®é¢˜è§£ç­” / FAQ](#11-å¸¸è§é—®é¢˜è§£ç­”--faq)
    - [Q1: å¦‚ä½•å¤„ç†å·¥ä½œåŠªåŠ›çš„æ—¶é—´å†²çªï¼Ÿ](#q1-å¦‚ä½•å¤„ç†å·¥ä½œåŠªåŠ›çš„æ—¶é—´å†²çª)
    - [Q2: å¦‚ä½•è®¡ç®—å·¥ä½œåŠªåŠ›çš„å®Œæˆç™¾åˆ†æ¯”ï¼Ÿ](#q2-å¦‚ä½•è®¡ç®—å·¥ä½œåŠªåŠ›çš„å®Œæˆç™¾åˆ†æ¯”)
  - [12. ç›¸å…³èµ„æº](#12-ç›¸å…³èµ„æº)
    - [12.1 æ ¸å¿ƒç›¸å…³æ–‡æ¡£](#121-æ ¸å¿ƒç›¸å…³æ–‡æ¡£)
    - [12.2 å½’æ¡£èµ„æº](#122-å½’æ¡£èµ„æº)

---

## 1. æ¦‚è¿°

### 1.1 ä¸šåŠ¡èƒŒæ™¯

å·¥ä½œåŠªåŠ›æ¨¡å‹æ˜¯Silverstonã€Šæ•°æ®æ¨¡å‹èµ„æºæ‰‹å†Œã€‹å·1ï¼ˆVolume 1 Chapter 6: Work Effortsï¼‰ä¸­çš„æ ¸å¿ƒæ¨¡å‹ï¼Œç”¨äºè·Ÿè¸ªå’Œç®¡ç†ä¼ä¸šå†…çš„å„ç§å·¥ä½œæ´»åŠ¨ï¼ŒåŒ…æ‹¬é¡¹ç›®ã€ä»»åŠ¡ã€ç”Ÿäº§è¿è¡Œã€ç»´æŠ¤ç­‰ã€‚

**æ ¸å¿ƒä¸šåŠ¡é—®é¢˜**:

- éœ€è¦å®Œæˆä»€ä¹ˆç±»å‹çš„å·¥ä½œï¼Ÿ
- éœ€è¦ç”Ÿäº§ä»€ä¹ˆäº§å“æˆ–æä¾›ä»€ä¹ˆæœåŠ¡ï¼Ÿ
- è°å°†å‚ä¸ï¼Œä»–ä»¬çš„è§’è‰²æ˜¯ä»€ä¹ˆï¼Ÿ
- å·¥ä½œå°†åœ¨å“ªé‡Œè¿›è¡Œï¼Ÿ
- éœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ
- å·¥ä½œåŠªåŠ›çš„å½“å‰çŠ¶æ€æ˜¯ä»€ä¹ˆï¼Ÿ
- é€‚å½“çš„èµ„æºï¼ˆäººå‘˜ã€åº“å­˜ã€è®¾å¤‡ï¼‰æ˜¯å¦å¯ç”¨ï¼Ÿ
- æœ‰å“ªäº›æ ‡å‡†å’ŒæŒ‡æ ‡æ¥è¡¡é‡å·¥ä½œåŠªåŠ›çš„æ•ˆç‡ï¼Ÿ
- å·¥ä½œåŠªåŠ›äº§ç”Ÿäº†ä»€ä¹ˆç»“æœï¼Ÿæ•ˆç‡å¦‚ä½•ï¼Ÿ

### 1.2 æ ¸å¿ƒæ¦‚å¿µ

**Work Requirementï¼ˆå·¥ä½œéœ€æ±‚ï¼‰**: æ‰§è¡ŒæŸç§ç±»å‹å·¥ä½œçš„éœ€è¦

**Work Effortï¼ˆå·¥ä½œåŠªåŠ›ï¼‰**: å·¥ä½œéœ€æ±‚çš„å±¥è¡Œï¼ŒåŒ…æ‹¬è®¾ç½®ã€è§„åˆ’å’Œå®é™…æ‰§è¡Œçš„å·¥ä½œ

**Work Effort Typeï¼ˆå·¥ä½œåŠªåŠ›ç±»å‹ï¼‰**: Programã€Projectã€Phaseã€Activityã€Taskç­‰å±‚çº§ç±»å‹

**Work Effort Purposeï¼ˆå·¥ä½œåŠªåŠ›ç›®çš„ï¼‰**: Maintenanceã€Production Runã€Work Flowã€Researchç­‰

### 1.3 ç†è®ºåŸºç¡€

**Work Requirement vs Work Effort**:

- **Work Requirementï¼ˆå·¥ä½œéœ€æ±‚ï¼‰**: è¡¨ç¤ºæ‰§è¡ŒæŸç§ç±»å‹å·¥ä½œçš„éœ€è¦ã€‚å¯èƒ½æ˜¯åˆ¶é€ éœ€æ±‚ã€ç»´æŠ¤éœ€æ±‚ã€å†…éƒ¨é¡¹ç›®éœ€æ±‚ç­‰ã€‚
- **Work Effortï¼ˆå·¥ä½œåŠªåŠ›ï¼‰**: å·¥ä½œéœ€æ±‚çš„å±¥è¡Œï¼ŒåŒ…æ‹¬è®¾ç½®ã€è§„åˆ’å’Œå®é™…æ‰§è¡Œçš„å·¥ä½œã€‚

**å·¥ä½œåŠªåŠ›å±‚çº§ç†è®º**:

å·¥ä½œåŠªåŠ›å¯ä»¥åˆ†è§£ä¸ºä¸åŒå±‚çº§ï¼š

- **Programï¼ˆé¡¹ç›®ç¾¤ï¼‰**: æœ€é«˜å±‚çº§ï¼ŒåŒ…å«å¤šä¸ªé¡¹ç›®
- **Projectï¼ˆé¡¹ç›®ï¼‰**: ç‹¬ç«‹çš„å·¥ä½œå•å…ƒï¼ŒåŒ…å«å¤šä¸ªé˜¶æ®µ
- **Phaseï¼ˆé˜¶æ®µï¼‰**: é¡¹ç›®çš„ç‰¹å®šé˜¶æ®µ
- **Activityï¼ˆæ´»åŠ¨ï¼‰**: é˜¶æ®µå†…çš„æ´»åŠ¨
- **Taskï¼ˆä»»åŠ¡ï¼‰**: æœ€ç»†ç²’åº¦çš„å·¥ä½œå•å…ƒ

**èµ„æºåˆ†é…ç†è®º**:

- **äººå‘˜åˆ†é…**: å°†äººå‘˜åˆ†é…åˆ°å·¥ä½œåŠªåŠ›çš„ä¸åŒè§’è‰²ï¼ˆé¡¹ç›®ç»ç†ã€å›¢é˜Ÿæˆå‘˜ç­‰ï¼‰
- **åº“å­˜åˆ†é…**: ä¸ºå·¥ä½œåŠªåŠ›åˆ†é…æ‰€éœ€çš„åŸææ–™å’Œåº“å­˜
- **å›ºå®šèµ„äº§åˆ†é…**: åˆ†é…è®¾å¤‡ã€æœºå™¨ç­‰å›ºå®šèµ„äº§

**æ—¶é—´è·Ÿè¸ªç†è®º**:

- **Time Entryï¼ˆæ—¶é—´å½•å…¥ï¼‰**: è®°å½•äººå‘˜åœ¨ç‰¹å®šæ—¶é—´æ®µå†…å¯¹å·¥ä½œåŠªåŠ›æ‰€èŠ±è´¹çš„æ—¶é—´
- **Timesheetï¼ˆæ—¶é—´è¡¨ï¼‰**: æ±‡æ€»ä¸€æ®µæ—¶é—´å†…çš„æ—¶é—´å½•å…¥

### 1.4 ä¸Volume 1çš„å¯¹åº”å…³ç³»

| Volume 1ç« èŠ‚ | æœ¬æ¨¡å‹å¯¹åº”éƒ¨åˆ† | æ•´åˆåº¦ |
|-------------|--------------|--------|
| Work Requirements | 2.1 Work Requirement | 100% |
| Work Effort Generation | 2.2 Work Effort | 100% |
| Work Effort Associations | 3. å·¥ä½œåŠªåŠ›å…³è” | 100% |
| Work Effort Party Assignment | 4.1 äººå‘˜åˆ†é… | 100% |
| Work Effort Time Tracking | 5. æ—¶é—´è·Ÿè¸ª | 100% |
| Work Effort Results | 6. å·¥ä½œåŠªåŠ›ç»“æœ | 100% |

---

## 2. å·¥ä½œéœ€æ±‚ä¸å·¥ä½œåŠªåŠ›

### 2.1 Work Requirementï¼ˆå·¥ä½œéœ€æ±‚ï¼‰

**æ ¸å¿ƒå®ä½“è®¾è®¡**:

```sql
-- å·¥ä½œéœ€æ±‚è¡¨ï¼ˆWork Requirementæ˜¯Requirementçš„å­ç±»å‹ï¼‰
CREATE TABLE work_requirement (
    requirement_id SERIAL PRIMARY KEY,
    requirement_type_id INT NOT NULL REFERENCES requirement_type(type_id),
    description TEXT NOT NULL,
    requirement_creation_date DATE DEFAULT CURRENT_DATE,
    required_by_date DATE,
    estimated_budget NUMERIC(10,2),
    quantity NUMERIC(10,2),
    reason TEXT,
    -- äº’æ–¥å…³è”ï¼šåªèƒ½å…³è”äº§å“ã€äº¤ä»˜ç‰©æˆ–å›ºå®šèµ„äº§ä¹‹ä¸€
    product_id INT REFERENCES product(product_id),
    deliverable_id INT, -- å¼•ç”¨äº¤ä»˜ç‰©ï¼ˆå‡è®¾å·²æœ‰è¡¨ï¼‰
    fixed_asset_id INT, -- å¼•ç”¨å›ºå®šèµ„äº§ï¼ˆå‡è®¾å·²æœ‰è¡¨ï¼‰
    created_at TIMESTAMPTZ DEFAULT NOW(),
    -- ä¸šåŠ¡è§„åˆ™ï¼šåªèƒ½å…³è”ä¸€ä¸ª
    CHECK (
        (product_id IS NOT NULL AND deliverable_id IS NULL AND fixed_asset_id IS NULL) OR
        (product_id IS NULL AND deliverable_id IS NOT NULL AND fixed_asset_id IS NULL) OR
        (product_id IS NULL AND deliverable_id IS NULL AND fixed_asset_id IS NOT NULL) OR
        (product_id IS NULL AND deliverable_id IS NULL AND fixed_asset_id IS NULL)
    )
);

-- å·¥ä½œéœ€æ±‚ç±»å‹è¡¨
CREATE TABLE work_requirement_type (
    type_id SERIAL PRIMARY KEY,
    type_code VARCHAR(50) UNIQUE NOT NULL,
    type_name VARCHAR(100) NOT NULL,
    description TEXT
);

INSERT INTO work_requirement_type (type_code, type_name) VALUES
    ('PRODUCTION_RUN', 'Production Run'),
    ('MAINTENANCE', 'Maintenance'),
    ('INTERNAL_PROJECT', 'Internal Project'),
    ('REPAIR', 'Repair');
```

**å·¥ä½œéœ€æ±‚è§’è‰²**:

```sql
-- å·¥ä½œéœ€æ±‚è§’è‰²ç±»å‹è¡¨
CREATE TABLE work_requirement_role_type (
    role_type_id SERIAL PRIMARY KEY,
    type_code VARCHAR(50) UNIQUE NOT NULL,
    type_name VARCHAR(100) NOT NULL,
    description TEXT
);

INSERT INTO work_requirement_role_type (type_code, type_name) VALUES
    ('CREATED_FOR', 'Created For'),
    ('CREATED_BY', 'Created By'),
    ('RESPONSIBLE_FOR', 'Responsible For'),
    ('AUTHORIZED_BY', 'Authorized By');

-- å·¥ä½œéœ€æ±‚è§’è‰²å…³è”è¡¨
CREATE TABLE party_work_requirement_role (
    role_id SERIAL PRIMARY KEY,
    work_requirement_id INT NOT NULL REFERENCES work_requirement(requirement_id) ON DELETE CASCADE,
    party_id INT NOT NULL, -- å¼•ç”¨Partyï¼ˆå‡è®¾å·²æœ‰Partyæ¨¡å‹ï¼‰
    role_type_id INT NOT NULL REFERENCES work_requirement_role_type(role_type_id),
    from_date DATE DEFAULT CURRENT_DATE,
    thru_date DATE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(work_requirement_id, party_id, role_type_id, from_date)
);
```

### 2.2 Work Effortï¼ˆå·¥ä½œåŠªåŠ›ï¼‰

**æ ¸å¿ƒå®ä½“è®¾è®¡**:

```sql
-- å·¥ä½œåŠªåŠ›ç±»å‹è¡¨
CREATE TABLE work_effort_type (
    effort_type_id SERIAL PRIMARY KEY,
    type_code VARCHAR(50) UNIQUE NOT NULL,
    type_name VARCHAR(100) NOT NULL,
    standard_work_hours NUMERIC(10,2),
    description TEXT
);

INSERT INTO work_effort_type (type_code, type_name, standard_work_hours) VALUES
    ('PROGRAM', 'Program', NULL),
    ('PROJECT', 'Project', NULL),
    ('PHASE', 'Phase', NULL),
    ('ACTIVITY', 'Activity', NULL),
    ('TASK', 'Task', NULL),
    ('JOB', 'Job', NULL);

-- å·¥ä½œåŠªåŠ›ç›®çš„ç±»å‹è¡¨
CREATE TABLE work_effort_purpose_type (
    purpose_type_id SERIAL PRIMARY KEY,
    type_code VARCHAR(50) UNIQUE NOT NULL,
    type_name VARCHAR(100) NOT NULL,
    description TEXT
);

INSERT INTO work_effort_purpose_type (type_code, type_name) VALUES
    ('MAINTENANCE', 'Maintenance'),
    ('PRODUCTION_RUN', 'Production Run'),
    ('WORK_FLOW', 'Work Flow'),
    ('RESEARCH', 'Research');

-- å·¥ä½œåŠªåŠ›è¡¨
CREATE TABLE work_effort (
    effort_id SERIAL PRIMARY KEY,
    effort_type_id INT NOT NULL REFERENCES work_effort_type(effort_type_id),
    purpose_type_id INT REFERENCES work_effort_purpose_type(purpose_type_id),
    name VARCHAR(200) NOT NULL,
    description TEXT,
    facility_id INT, -- å¼•ç”¨è®¾æ–½ï¼ˆå‡è®¾å·²æœ‰è¡¨ï¼‰
    scheduled_start_date DATE,
    scheduled_completion_date DATE,
    actual_start_datetime TIMESTAMPTZ,
    actual_completion_datetime TIMESTAMPTZ,
    estimated_hours NUMERIC(10,2),
    actual_hours NUMERIC(10,2),
    quantity_to_produce NUMERIC(10,2),
    quantity_produced NUMERIC(10,2),
    total_dollars_allowed NUMERIC(10,2),
    total_hours_allowed NUMERIC(10,2),
    special_terms TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- PostgreSQL 18ä¼˜åŒ–ï¼šè‡ªåŠ¨æ›´æ–°æ—¶é—´æˆ³
CREATE OR REPLACE FUNCTION update_work_effort_timestamp()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_work_effort_updated_at
    BEFORE UPDATE ON work_effort
    FOR EACH ROW
    EXECUTE FUNCTION update_work_effort_timestamp();
```

**å·¥ä½œåŠªåŠ›ä¸éœ€æ±‚/è®¢å•çš„å…³è”**:

```sql
-- å·¥ä½œéœ€æ±‚å±¥è¡Œè¡¨ï¼ˆå¤šå¯¹å¤šï¼‰
CREATE TABLE work_requirement_fulfillment (
    fulfillment_id SERIAL PRIMARY KEY,
    work_requirement_id INT NOT NULL REFERENCES work_requirement(requirement_id) ON DELETE CASCADE,
    work_effort_id INT NOT NULL REFERENCES work_effort(effort_id) ON DELETE CASCADE,
    from_date DATE DEFAULT CURRENT_DATE,
    thru_date DATE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(work_requirement_id, work_effort_id, from_date)
);

-- å·¥ä½œè®¢å•é¡¹å±¥è¡Œè¡¨ï¼ˆä¸è®¢å•å…³è”ï¼‰
CREATE TABLE work_order_item_fulfillment (
    fulfillment_id SERIAL PRIMARY KEY,
    order_item_id INT NOT NULL, -- å¼•ç”¨è®¢å•é¡¹ï¼ˆå‡è®¾å·²æœ‰è®¢å•æ¨¡å‹ï¼‰
    work_effort_id INT NOT NULL REFERENCES work_effort(effort_id) ON DELETE CASCADE,
    from_date DATE DEFAULT CURRENT_DATE,
    thru_date DATE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(order_item_id, work_effort_id, from_date)
);
```

### 2.3 å·¥ä½œåŠªåŠ›ç±»å‹

å·¥ä½œåŠªåŠ›ç±»å‹åŒ…æ‹¬ï¼šProgramã€Projectã€Phaseã€Activityã€Taskã€Jobç­‰ï¼Œç”¨äºè¡¨ç¤ºä¸åŒçš„å·¥ä½œå±‚çº§ã€‚

### 2.4 å·¥ä½œåŠªåŠ›å±‚çº§ç»“æ„

å·¥ä½œåŠªåŠ›é€šè¿‡é€’å½’å…³è”å½¢æˆå±‚çº§ç»“æ„ï¼š

```sql
-- å·¥ä½œåŠªåŠ›å…³è”è¡¨ï¼ˆé€’å½’ï¼Œå¤šå¯¹å¤šï¼‰
CREATE TABLE work_effort_association (
    association_id SERIAL PRIMARY KEY,
    parent_effort_id INT NOT NULL REFERENCES work_effort(effort_id) ON DELETE CASCADE,
    child_effort_id INT NOT NULL REFERENCES work_effort(effort_id) ON DELETE CASCADE,
    association_type_id INT, -- å…³è”ç±»å‹ï¼ˆBreakdown, Dependencyç­‰ï¼‰
    from_date DATE DEFAULT CURRENT_DATE,
    thru_date DATE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    CHECK (parent_effort_id != child_effort_id),
    UNIQUE(parent_effort_id, child_effort_id, from_date)
);

-- å·¥ä½œåŠªåŠ›ä¾èµ–ç±»å‹è¡¨
CREATE TABLE work_effort_dependency_type (
    dependency_type_id SERIAL PRIMARY KEY,
    type_code VARCHAR(50) UNIQUE NOT NULL,
    type_name VARCHAR(100) NOT NULL,
    description TEXT
);

INSERT INTO work_effort_dependency_type (type_code, type_name) VALUES
    ('PRECEDENCY', 'Precedency - Must complete before'),
    ('CONCURRENCY', 'Concurrency - Must execute in parallel');

-- å·¥ä½œåŠªåŠ›ä¾èµ–è¡¨
CREATE TABLE work_effort_dependency (
    dependency_id SERIAL PRIMARY KEY,
    work_effort_id INT NOT NULL REFERENCES work_effort(effort_id) ON DELETE CASCADE,
    depends_on_effort_id INT NOT NULL REFERENCES work_effort(effort_id) ON DELETE CASCADE,
    dependency_type_id INT NOT NULL REFERENCES work_effort_dependency_type(dependency_type_id),
    from_date DATE DEFAULT CURRENT_DATE,
    thru_date DATE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    CHECK (work_effort_id != depends_on_effort_id),
    UNIQUE(work_effort_id, depends_on_effort_id, dependency_type_id, from_date)
);
```

**é€’å½’æŸ¥è¯¢å·¥ä½œåŠªåŠ›å±‚çº§**:

```sql
-- é€’å½’æŸ¥è¯¢å·¥ä½œåŠªåŠ›çš„å®Œæ•´å±‚çº§ç»“æ„
WITH RECURSIVE work_effort_hierarchy AS (
    -- åŸºç¡€æŸ¥è¯¢ï¼šæ ¹èŠ‚ç‚¹
    SELECT
        effort_id,
        name,
        effort_type_id,
        parent_effort_id,
        1 AS level,
        CAST(name AS TEXT) AS path
    FROM work_effort we
    LEFT JOIN work_effort_association wea ON we.effort_id = wea.child_effort_id
    WHERE wea.parent_effort_id IS NULL

    UNION ALL

    -- é€’å½’æŸ¥è¯¢ï¼šå­èŠ‚ç‚¹
    SELECT
        we.effort_id,
        we.name,
        we.effort_type_id,
        wea.parent_effort_id,
        weh.level + 1,
        weh.path || ' -> ' || we.name
    FROM work_effort we
    INNER JOIN work_effort_association wea ON we.effort_id = wea.child_effort_id
    INNER JOIN work_effort_hierarchy weh ON wea.parent_effort_id = weh.effort_id
    WHERE weh.level < 10 -- é˜²æ­¢æ— é™é€’å½’
)
SELECT * FROM work_effort_hierarchy
ORDER BY level, name;
```

---

## 3. å·¥ä½œåŠªåŠ›å…³è”

### 3.1 å·¥ä½œåŠªåŠ›åˆ†è§£

å·¥ä½œåŠªåŠ›å¯ä»¥åˆ†è§£ä¸ºå­å·¥ä½œåŠªåŠ›ï¼Œå½¢æˆæ ‘çŠ¶ç»“æ„ã€‚

### 3.2 å·¥ä½œåŠªåŠ›ä¾èµ–

å·¥ä½œåŠªåŠ›ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ï¼šå‰ç½®ä¾èµ–ï¼ˆPrecedencyï¼‰å’Œå¹¶å‘ä¾èµ–ï¼ˆConcurrencyï¼‰ã€‚

### 3.3 å·¥ä½œåŠªåŠ›å…³è”ï¼ˆé€’å½’æ¨¡å‹ï¼‰

ä½¿ç”¨é€’å½’å…³è”æ¨¡å‹æ”¯æŒçµæ´»çš„å·¥ä½œåŠªåŠ›åˆ†è§£å’Œä¾èµ–å…³ç³»ã€‚

---

## 4. èµ„æºåˆ†é…

### 4.1 äººå‘˜åˆ†é…ï¼ˆParty Assignmentï¼‰

```sql
-- å·¥ä½œåŠªåŠ›è§’è‰²ç±»å‹è¡¨
CREATE TABLE work_effort_role_type (
    role_type_id SERIAL PRIMARY KEY,
    type_code VARCHAR(50) UNIQUE NOT NULL,
    type_name VARCHAR(100) NOT NULL,
    description TEXT
);

INSERT INTO work_effort_role_type (type_code, type_name) VALUES
    ('PROJECT_MANAGER', 'Project Manager'),
    ('PROJECT_ADMINISTRATOR', 'Project Administrator'),
    ('TEAM_MEMBER', 'Team Member'),
    ('SUPERVISOR', 'Supervisor'),
    ('ANALYST', 'Analyst'),
    ('LABORER', 'Laborer'),
    ('QUALITY_ASSURER', 'Quality Assurer'),
    ('CONTRACTOR', 'Contractor'),
    ('CREATOR', 'Creator'),
    ('PERFORMER', 'Performer');

-- å·¥ä½œåŠªåŠ›äººå‘˜åˆ†é…è¡¨
CREATE TABLE work_effort_party_assignment (
    assignment_id SERIAL PRIMARY KEY,
    work_effort_id INT NOT NULL REFERENCES work_effort(effort_id) ON DELETE CASCADE,
    party_id INT NOT NULL, -- å¼•ç”¨Party
    role_type_id INT NOT NULL REFERENCES work_effort_role_type(role_type_id),
    facility_id INT, -- åˆ†é…åˆ°çš„è®¾æ–½
    scheduled_start_date DATE,
    scheduled_completion_date DATE,
    from_date DATE DEFAULT CURRENT_DATE,
    thru_date DATE,
    comment TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(work_effort_id, party_id, role_type_id, from_date)
);
```

### 4.2 åº“å­˜åˆ†é…ï¼ˆInventory Assignmentï¼‰

```sql
-- å·¥ä½œåŠªåŠ›åº“å­˜åˆ†é…è¡¨
CREATE TABLE work_effort_inventory_assignment (
    assignment_id SERIAL PRIMARY KEY,
    work_effort_id INT NOT NULL REFERENCES work_effort(effort_id) ON DELETE CASCADE,
    inventory_item_id INT NOT NULL, -- å¼•ç”¨åº“å­˜é¡¹ï¼ˆå‡è®¾å·²æœ‰åº“å­˜æ¨¡å‹ï¼‰
    quantity_used NUMERIC(10,2) NOT NULL CHECK (quantity_used > 0),
    from_date DATE DEFAULT CURRENT_DATE,
    thru_date DATE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(work_effort_id, inventory_item_id, from_date)
);
```

### 4.3 å›ºå®šèµ„äº§åˆ†é…ï¼ˆFixed Asset Assignmentï¼‰

```sql
-- å·¥ä½œåŠªåŠ›å›ºå®šèµ„äº§åˆ†é…è¡¨
CREATE TABLE work_effort_fixed_asset_assignment (
    assignment_id SERIAL PRIMARY KEY,
    work_effort_id INT NOT NULL REFERENCES work_effort(effort_id) ON DELETE CASCADE,
    fixed_asset_id INT NOT NULL, -- å¼•ç”¨å›ºå®šèµ„äº§
    status_type_id INT, -- åˆ†é…çŠ¶æ€ç±»å‹
    from_date DATE DEFAULT CURRENT_DATE,
    thru_date DATE,
    allocated_cost NUMERIC(10,2),
    comment TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(work_effort_id, fixed_asset_id, from_date)
);
```

### 4.4 æŠ€èƒ½æ ‡å‡†

```sql
-- æŠ€èƒ½ç±»å‹è¡¨
CREATE TABLE skill_type (
    skill_type_id SERIAL PRIMARY KEY,
    skill_code VARCHAR(50) UNIQUE NOT NULL,
    skill_name VARCHAR(100) NOT NULL,
    description TEXT
);

-- äººå‘˜æŠ€èƒ½è¡¨
CREATE TABLE party_skill (
    skill_id SERIAL PRIMARY KEY,
    party_id INT NOT NULL, -- å¼•ç”¨Party
    skill_type_id INT NOT NULL REFERENCES skill_type(skill_type_id),
    years_of_experience INT,
    rating INT CHECK (rating >= 1 AND rating <= 10),
    from_date DATE DEFAULT CURRENT_DATE,
    thru_date DATE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(party_id, skill_type_id, from_date)
);

-- å·¥ä½œåŠªåŠ›æŠ€èƒ½æ ‡å‡†è¡¨ï¼ˆç”¨äºè§„åˆ’ï¼‰
CREATE TABLE work_effort_skill_standard (
    standard_id SERIAL PRIMARY KEY,
    effort_type_id INT NOT NULL REFERENCES work_effort_type(effort_type_id),
    skill_type_id INT NOT NULL REFERENCES skill_type(skill_type_id),
    estimated_num_people INT CHECK (estimated_num_people > 0),
    estimated_duration_hours NUMERIC(10,2),
    estimated_cost NUMERIC(10,2),
    from_date DATE DEFAULT CURRENT_DATE,
    thru_date DATE,
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## 5. æ—¶é—´è·Ÿè¸ª

### 5.1 Time Entryï¼ˆæ—¶é—´å½•å…¥ï¼‰

```sql
-- æ—¶é—´è¡¨è¡¨
CREATE TABLE timesheet (
    timesheet_id SERIAL PRIMARY KEY,
    worker_party_id INT NOT NULL, -- å¼•ç”¨å·¥ä½œäººå‘˜ï¼ˆPartyï¼‰
    from_date DATE NOT NULL,
    thru_date DATE NOT NULL,
    status VARCHAR(20) DEFAULT 'DRAFT', -- DRAFT, SUBMITTED, APPROVED, REJECTED
    created_at TIMESTAMPTZ DEFAULT NOW(),
    CHECK (thru_date >= from_date)
);

-- æ—¶é—´å½•å…¥è¡¨
CREATE TABLE time_entry (
    entry_id SERIAL PRIMARY KEY,
    timesheet_id INT NOT NULL REFERENCES timesheet(timesheet_id) ON DELETE CASCADE,
    work_effort_id INT NOT NULL REFERENCES work_effort(effort_id),
    from_datetime TIMESTAMPTZ NOT NULL,
    thru_datetime TIMESTAMPTZ NOT NULL,
    hours NUMERIC(10,2) GENERATED ALWAYS AS (
        EXTRACT(EPOCH FROM (thru_datetime - from_datetime)) / 3600
    ) STORED,
    description TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    CHECK (thru_datetime > from_datetime)
);

-- æ—¶é—´è¡¨è§’è‰²ç±»å‹è¡¨
CREATE TABLE timesheet_role_type (
    role_type_id SERIAL PRIMARY KEY,
    type_code VARCHAR(50) UNIQUE NOT NULL,
    type_name VARCHAR(100) NOT NULL,
    description TEXT
);

INSERT INTO timesheet_role_type (type_code, type_name) VALUES
    ('APPROVER', 'Approver'),
    ('MANAGER', 'Manager'),
    ('ENTERER', 'Enterer');

-- æ—¶é—´è¡¨è§’è‰²è¡¨
CREATE TABLE timesheet_role (
    role_id SERIAL PRIMARY KEY,
    timesheet_id INT NOT NULL REFERENCES timesheet(timesheet_id) ON DELETE CASCADE,
    party_id INT NOT NULL, -- å¼•ç”¨Party
    role_type_id INT NOT NULL REFERENCES timesheet_role_type(role_type_id),
    from_date DATE DEFAULT CURRENT_DATE,
    thru_date DATE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(timesheet_id, party_id, role_type_id, from_date)
);
```

### 5.2 å·¥ä½œåŠªåŠ›è´¹ç‡

```sql
-- è´¹ç‡ç±»å‹è¡¨
CREATE TABLE rate_type (
    rate_type_id SERIAL PRIMARY KEY,
    type_code VARCHAR(50) UNIQUE NOT NULL,
    type_name VARCHAR(100) NOT NULL,
    description TEXT
);

INSERT INTO rate_type (type_code, type_name) VALUES
    ('BILLING_RATE', 'Billing Rate'),
    ('PAYROLL_RATE', 'Payroll Rate'),
    ('COST', 'Cost'),
    ('OVERTIME_RATE', 'Overtime Rate'),
    ('REGULAR_RATE', 'Regular Rate');

-- äººå‘˜è´¹ç‡è¡¨
CREATE TABLE party_rate (
    rate_id SERIAL PRIMARY KEY,
    party_id INT NOT NULL, -- å¼•ç”¨Party
    rate_type_id INT NOT NULL REFERENCES rate_type(rate_type_id),
    rate_amount NUMERIC(10,2) NOT NULL CHECK (rate_amount >= 0),
    from_date DATE DEFAULT CURRENT_DATE,
    thru_date DATE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(party_id, rate_type_id, from_date)
);

-- å·¥ä½œåŠªåŠ›åˆ†é…è´¹ç‡è¡¨
CREATE TABLE work_effort_assignment_rate (
    rate_id SERIAL PRIMARY KEY,
    assignment_id INT NOT NULL REFERENCES work_effort_party_assignment(assignment_id) ON DELETE CASCADE,
    rate_type_id INT NOT NULL REFERENCES rate_type(rate_type_id),
    rate_amount NUMERIC(10,2) NOT NULL CHECK (rate_amount >= 0),
    from_date DATE DEFAULT CURRENT_DATE,
    thru_date DATE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(assignment_id, rate_type_id, from_date)
);
```

---

## 6. å·¥ä½œåŠªåŠ›ç»“æœ

```sql
-- å·¥ä½œåŠªåŠ›äº¤ä»˜ç‰©è¡¨
CREATE TABLE work_effort_deliverable_produced (
    deliverable_id SERIAL PRIMARY KEY,
    work_effort_id INT NOT NULL REFERENCES work_effort(effort_id) ON DELETE CASCADE,
    deliverable_type_id INT, -- å¼•ç”¨äº¤ä»˜ç‰©ç±»å‹
    quantity_produced NUMERIC(10,2),
    produced_date DATE,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- å·¥ä½œåŠªåŠ›åº“å­˜ç”Ÿäº§è¡¨
CREATE TABLE work_effort_inventory_produced (
    production_id SERIAL PRIMARY KEY,
    work_effort_id INT NOT NULL REFERENCES work_effort(effort_id) ON DELETE CASCADE,
    inventory_item_id INT NOT NULL, -- å¼•ç”¨åº“å­˜é¡¹
    quantity_produced NUMERIC(10,2) NOT NULL CHECK (quantity_produced > 0),
    produced_date DATE,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- å·¥ä½œåŠªåŠ›çŠ¶æ€ç±»å‹è¡¨
CREATE TABLE work_effort_status_type (
    status_type_id SERIAL PRIMARY KEY,
    status_code VARCHAR(50) UNIQUE NOT NULL,
    status_name VARCHAR(100) NOT NULL,
    description TEXT
);

INSERT INTO work_effort_status_type (status_code, status_name) VALUES
    ('PLANNED', 'Planned'),
    ('IN_PROGRESS', 'In Progress'),
    ('COMPLETED', 'Completed'),
    ('ON_HOLD', 'On Hold'),
    ('CANCELLED', 'Cancelled');

-- å·¥ä½œåŠªåŠ›çŠ¶æ€è¡¨
CREATE TABLE work_effort_status (
    status_id SERIAL PRIMARY KEY,
    work_effort_id INT NOT NULL REFERENCES work_effort(effort_id) ON DELETE CASCADE,
    status_type_id INT NOT NULL REFERENCES work_effort_status_type(status_type_id),
    status_date TIMESTAMPTZ DEFAULT NOW(),
    comment TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## 7. PostgreSQLå®Œæ•´å®ç°

ï¼ˆå®Œæ•´DDLè„šæœ¬ã€ç´¢å¼•è®¾è®¡ã€çº¦æŸç­‰å°†åœ¨åç»­è¡¥å……...ï¼‰

---

## 8. æŸ¥è¯¢ç¤ºä¾‹

### æŸ¥è¯¢1: è·å–å·¥ä½œåŠªåŠ›çš„å®Œæ•´å±‚çº§ç»“æ„

```sql
-- ä½¿ç”¨é€’å½’CTEæŸ¥è¯¢å·¥ä½œåŠªåŠ›å±‚çº§
WITH RECURSIVE effort_tree AS (
    SELECT
        we.effort_id,
        we.name,
        wet.type_name AS effort_type,
        we.scheduled_start_date,
        we.scheduled_completion_date,
        we.actual_start_datetime,
        we.actual_completion_datetime,
        0 AS level,
        ARRAY[we.effort_id] AS path
    FROM work_effort we
    INNER JOIN work_effort_type wet ON we.effort_type_id = wet.effort_type_id
    WHERE NOT EXISTS (
        SELECT 1 FROM work_effort_association wea
        WHERE wea.child_effort_id = we.effort_id
    )

    UNION ALL

    SELECT
        we.effort_id,
        we.name,
        wet.type_name,
        we.scheduled_start_date,
        we.scheduled_completion_date,
        we.actual_start_datetime,
        we.actual_completion_datetime,
        et.level + 1,
        et.path || we.effort_id
    FROM work_effort we
    INNER JOIN work_effort_type wet ON we.effort_type_id = wet.effort_type_id
    INNER JOIN work_effort_association wea ON wea.child_effort_id = we.effort_id
    INNER JOIN effort_tree et ON wea.parent_effort_id = et.effort_id
    WHERE we.effort_id != ALL(et.path) -- é˜²æ­¢å¾ªç¯
    AND et.level < 10
)
SELECT
    effort_id,
    REPEAT('  ', level) || name AS name,
    effort_type,
    scheduled_start_date,
    scheduled_completion_date,
    level
FROM effort_tree
ORDER BY path;
```

### æŸ¥è¯¢2: è®¡ç®—å·¥ä½œåŠªåŠ›çš„æˆæœ¬

```sql
-- è®¡ç®—å·¥ä½œåŠªåŠ›çš„æ€»æˆæœ¬ï¼ˆäººå·¥+åº“å­˜+å›ºå®šèµ„äº§ï¼‰
SELECT
    we.effort_id,
    we.name,
    -- äººå·¥æˆæœ¬
    COALESCE(labor_cost.total_labor_cost, 0) AS labor_cost,
    -- åº“å­˜æˆæœ¬
    COALESCE(inventory_cost.total_inventory_cost, 0) AS inventory_cost,
    -- å›ºå®šèµ„äº§æˆæœ¬
    COALESCE(asset_cost.total_asset_cost, 0) AS asset_cost,
    -- æ€»æˆæœ¬
    COALESCE(labor_cost.total_labor_cost, 0) +
    COALESCE(inventory_cost.total_inventory_cost, 0) +
    COALESCE(asset_cost.total_asset_cost, 0) AS total_cost
FROM work_effort we
LEFT JOIN (
    -- è®¡ç®—äººå·¥æˆæœ¬
    SELECT
        te.work_effort_id,
        SUM(te.hours * COALESCE(wear.rate_amount, pr.rate_amount, 0)) AS total_labor_cost
    FROM time_entry te
    LEFT JOIN work_effort_party_assignment wepa ON te.work_effort_id = wepa.work_effort_id
        AND te.timesheet_id IN (SELECT timesheet_id FROM timesheet WHERE worker_party_id = wepa.party_id)
    LEFT JOIN work_effort_assignment_rate wear ON wepa.assignment_id = wear.assignment_id
        AND wear.rate_type_id = (SELECT rate_type_id FROM rate_type WHERE type_code = 'PAYROLL_RATE')
    LEFT JOIN party_rate pr ON wepa.party_id = pr.party_id
        AND pr.rate_type_id = (SELECT rate_type_id FROM rate_type WHERE type_code = 'PAYROLL_RATE')
    GROUP BY te.work_effort_id
) labor_cost ON we.effort_id = labor_cost.work_effort_id
LEFT JOIN (
    -- è®¡ç®—åº“å­˜æˆæœ¬ï¼ˆå‡è®¾åº“å­˜é¡¹æœ‰æˆæœ¬ï¼‰
    SELECT
        weia.work_effort_id,
        SUM(weia.quantity_used * COALESCE(epc.cost_amount, 0)) AS total_inventory_cost
    FROM work_effort_inventory_assignment weia
    LEFT JOIN inventory_item ii ON weia.inventory_item_id = ii.inventory_item_id
    LEFT JOIN estimated_product_cost epc ON ii.product_id = epc.product_id
    GROUP BY weia.work_effort_id
) inventory_cost ON we.effort_id = inventory_cost.work_effort_id
LEFT JOIN (
    -- è®¡ç®—å›ºå®šèµ„äº§æˆæœ¬
    SELECT
        wefaa.work_effort_id,
        SUM(COALESCE(wefaa.allocated_cost, 0)) AS total_asset_cost
    FROM work_effort_fixed_asset_assignment wefaa
    GROUP BY wefaa.work_effort_id
) asset_cost ON we.effort_id = asset_cost.work_effort_id
WHERE we.effort_id = :effort_id;
```

---

## 9. æ€§èƒ½ä¼˜åŒ–

### 9.1 ç´¢å¼•ç­–ç•¥

```sql
-- å·¥ä½œåŠªåŠ›ç´¢å¼•
CREATE INDEX idx_work_effort_type ON work_effort(effort_type_id);
CREATE INDEX idx_work_effort_facility ON work_effort(facility_id);
CREATE INDEX idx_work_effort_dates ON work_effort USING gist (
    daterange(scheduled_start_date, scheduled_completion_date)
);

-- å·¥ä½œåŠªåŠ›å…³è”ç´¢å¼•
CREATE INDEX idx_work_effort_assoc_parent ON work_effort_association(parent_effort_id);
CREATE INDEX idx_work_effort_assoc_child ON work_effort_association(child_effort_id);

-- æ—¶é—´å½•å…¥ç´¢å¼•
CREATE INDEX idx_time_entry_effort ON time_entry(work_effort_id);
CREATE INDEX idx_time_entry_timesheet ON time_entry(timesheet_id);
CREATE INDEX idx_time_entry_datetime ON time_entry USING gist (
    tstzrange(from_datetime, thru_datetime)
);

-- äººå‘˜åˆ†é…ç´¢å¼•
CREATE INDEX idx_work_effort_party_assignment_effort ON work_effort_party_assignment(work_effort_id);
CREATE INDEX idx_work_effort_party_assignment_party ON work_effort_party_assignment(party_id);
```

### 9.2 PostgreSQL 18ä¼˜åŒ–

- ä½¿ç”¨è™šæ‹Ÿç”Ÿæˆåˆ—è‡ªåŠ¨è®¡ç®—å°æ—¶æ•°
- ä½¿ç”¨GISTç´¢å¼•ä¼˜åŒ–æ—¥æœŸèŒƒå›´æŸ¥è¯¢
- ä½¿ç”¨åˆ†åŒºè¡¨ä¼˜åŒ–å¤§è§„æ¨¡æ—¶é—´å½•å…¥æ•°æ®

---

## 10. å®é™…åº”ç”¨æ¡ˆä¾‹

### æ¡ˆä¾‹1: é¡¹ç›®ç®¡ç†

**åœºæ™¯**: ä¼ä¸šé¡¹ç›®ç®¡ç†ï¼Œè·Ÿè¸ªé¡¹ç›®ã€é˜¶æ®µã€ä»»åŠ¡ã€æ´»åŠ¨ã€‚

**å®ç°è¦ç‚¹**:

- ä½¿ç”¨work_effortè¡¨å­˜å‚¨é¡¹ç›®å±‚çº§ç»“æ„
- ä½¿ç”¨work_effort_associationè¡¨å»ºç«‹å±‚çº§å…³ç³»
- ä½¿ç”¨time_entryè·Ÿè¸ªæ—¶é—´
- ä½¿ç”¨work_effort_party_assignmentåˆ†é…äººå‘˜

### æ¡ˆä¾‹2: ç”Ÿäº§ç®¡ç†

**åœºæ™¯**: åˆ¶é€ ä¸šç”Ÿäº§è¿è¡Œç®¡ç†ã€‚

**å®ç°è¦ç‚¹**:

- ä½¿ç”¨work_requirementå®šä¹‰ç”Ÿäº§éœ€æ±‚
- ä½¿ç”¨work_effortè·Ÿè¸ªç”Ÿäº§è¿è¡Œ
- ä½¿ç”¨work_effort_inventory_assignmentåˆ†é…åŸææ–™
- ä½¿ç”¨work_effort_fixed_asset_assignmentåˆ†é…è®¾å¤‡
- ä½¿ç”¨work_effort_inventory_producedè®°å½•äº§å‡º

---

## 11. å¸¸è§é—®é¢˜è§£ç­” / FAQ

### Q1: å¦‚ä½•å¤„ç†å·¥ä½œåŠªåŠ›çš„æ—¶é—´å†²çªï¼Ÿ

**A**: ä½¿ç”¨GISTç´¢å¼•å’ŒèŒƒå›´çº¦æŸæ£€æŸ¥æ—¶é—´é‡å ï¼š

```sql
CREATE INDEX idx_work_effort_party_time ON work_effort_party_assignment
USING GIST (party_id, daterange(scheduled_start_date, scheduled_completion_date));
```

### Q2: å¦‚ä½•è®¡ç®—å·¥ä½œåŠªåŠ›çš„å®Œæˆç™¾åˆ†æ¯”ï¼Ÿ

**A**: åŸºäºå­å·¥ä½œåŠªåŠ›çš„å®ŒæˆçŠ¶æ€æ±‡æ€»ï¼š

```sql
-- é€’å½’æŸ¥è¯¢å­å·¥ä½œåŠªåŠ›çš„å®Œæˆæƒ…å†µ
WITH RECURSIVE effort_completion AS (
    -- åŸºç¡€ï¼šå¶å­èŠ‚ç‚¹ï¼ˆæ²¡æœ‰å­èŠ‚ç‚¹çš„å·¥ä½œåŠªåŠ›ï¼‰
    SELECT
        we.effort_id,
        CASE WHEN wes.status_type_id = (SELECT status_type_id FROM work_effort_status_type WHERE status_code = 'COMPLETED')
             THEN 1.0 ELSE 0.0 END AS completion_ratio
    FROM work_effort we
    LEFT JOIN work_effort_status wes ON we.effort_id = wes.work_effort_id
    WHERE NOT EXISTS (SELECT 1 FROM work_effort_association wea WHERE wea.parent_effort_id = we.effort_id)
)
-- é€’å½’æ±‡æ€»çˆ¶èŠ‚ç‚¹çš„å®Œæˆåº¦
SELECT * FROM effort_completion;
```

---

## 12. ç›¸å…³èµ„æº

### 12.1 æ ¸å¿ƒç›¸å…³æ–‡æ¡£

- [Partyæ¨¡å‹](./Partyæ¨¡å‹.md) - äººå‘˜ä¸ç»„ç»‡æ¨¡å‹
- [äº§å“ç®¡ç†æ¨¡å‹](./äº§å“ç®¡ç†æ¨¡å‹.md) - äº§å“å®šä¹‰ï¼ˆç”¨äºç”Ÿäº§éœ€æ±‚ï¼‰
- [è®¢å•ç®¡ç†æ¨¡å‹](./è®¢å•ç®¡ç†æ¨¡å‹.md) - å·¥ä½œè®¢å•å…³è”
- [Silverstonæ•°æ®æ¨¡å‹èµ„æºæ‰‹å†Œ](../02-æƒå¨èµ„æºä¸æ ‡å‡†/Silverstonæ•°æ®æ¨¡å‹èµ„æºæ‰‹å†Œ.md) - ä¸‰å·æœ¬è¯¦è§£

### 12.2 å½’æ¡£èµ„æº

- [Volume 1å®Œæ•´å†…å®¹](../../99-å½’æ¡£/å‚è€ƒèµ„æº/books/The Data Model Resource Book 1/full.md) - Chapter 6: Work Efforts

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**çŠ¶æ€**: âœ… æ–‡æ¡£å®Œæˆï¼ŒåŸºäºVolume 1 Chapter 6å®Œæ•´æ•´åˆ
