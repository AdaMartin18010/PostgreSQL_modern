# 保险系统数据模型案例

> **创建日期**: 2025年1月
> **来源**: Silverston《数据模型资源手册》卷2 Chapter 5 - Insurance + 实践总结
> **状态**: 基于权威资源深化扩展
> **文档编号**: 10-05

---

## 📑 目录

- [保险系统数据模型案例](#保险系统数据模型案例)
  - [📑 目录](#-目录)
  - [1. 概述](#1-概述)
  - [1.1 理论基础](#11-理论基础)
    - [1.1.1 保险数据模型设计理论](#111-保险数据模型设计理论)
    - [1.1.2 保险产品模式理论](#112-保险产品模式理论)
    - [1.1.3 风险评估理论](#113-风险评估理论)
  - [2. 业务需求](#2-业务需求)
    - [2.1 核心业务功能](#21-核心业务功能)
    - [2.2 性能要求](#22-性能要求)
  - [3. 保险产品模型](#3-保险产品模型)
    - [3.1 保险产品表](#31-保险产品表)
    - [3.2 保障范围模型](#32-保障范围模型)
  - [4. 保单管理模型](#4-保单管理模型)
    - [4.1 保险申请](#41-保险申请)
    - [4.2 保险报价](#42-保险报价)
    - [4.3 保险单](#43-保险单)
  - [5. 理赔管理模型](#5-理赔管理模型)
    - [5.1 理赔事件](#51-理赔事件)
    - [5.2 理赔申请](#52-理赔申请)
    - [5.3 理赔结算](#53-理赔结算)
  - [6. 风险评估模型](#6-风险评估模型)
    - [6.1 风险评估](#61-风险评估)
    - [6.2 保险费率表](#62-保险费率表)
  - [7. PostgreSQL完整实现](#7-postgresql完整实现)
    - [7.1 索引设计](#71-索引设计)
    - [7.2 查询示例](#72-查询示例)
  - [8. 性能优化与监控](#8-性能优化与监控)
    - [8.1 索引优化](#81-索引优化)
    - [8.2 物化视图优化](#82-物化视图优化)
  - [9. 常见问题解答 / FAQ](#9-常见问题解答--faq)
    - [Q1: 如何管理保单的生命周期？](#q1-如何管理保单的生命周期)
    - [Q2: 如何计算保费？](#q2-如何计算保费)
  - [10. 相关资源](#10-相关资源)
    - [10.1 核心相关文档](#101-核心相关文档)
    - [10.2 理论基础](#102-理论基础)
    - [10.3 参考资源](#103-参考资源)

---

---

## 1. 概述

保险系统数据模型案例展示保险行业的数据建模实践。
本案例涵盖保险核心业务的数据模型设计，包括保险产品、保单管理、理赔处理、风险评估等。

**案例特点**:

- **复杂产品模型**：灵活的保险产品和保障范围定义
- **风险评估**：基于精算的风险评估和定价模型
- **合规要求**：符合保险监管要求
- **审计追踪**：完整的操作历史记录

---

## 1.1 理论基础

### 1.1.1 保险数据模型设计理论

**保险数据模型**:

- **产品灵活性**: 支持多变的保险产品和保障范围组合
- **风险评估**: 基于精算模型的风险评估和定价
- **合规追踪**: 完整的审计和合规性追踪
- **理赔处理**: 高效的理赔处理流程

**模型设计原则**:

- **产品可配置性**: 使用灵活的覆盖类型和级别定义
- **风险评估**: 支持社区评级和经验评级
- **合规追踪**: 记录所有关键操作历史
- **性能优化**: 优化高频查询性能

### 1.1.2 保险产品模式理论

**保险产品模式应用**:

- **产品定义**: 保险产品、产品类别、产品特征
- **保障范围**: 覆盖类型、覆盖级别、保障组合
- **产品规则**: 产品规则、产品特征、产品定价

**保险产品模式特点**:

- **灵活性**: 支持多变的产品配置
- **可追溯性**: 完整的版本和变更历史
- **合规性**: 符合监管要求

### 1.1.3 风险评估理论

**风险评估**:

- **精算分析**: 基于历史数据的精算分析
- **风险评估**: 风险级别评估和分类
- **定价模型**: 社区评级和经验评级

**风险评估方法**:

- **社区评级**: 基于大群体的标准化定价
- **经验评级**: 基于个体的定制化定价
- **精算模型**: 基于统计模型的精算分析

---

## 2. 业务需求

### 2.1 核心业务功能

**业务需求清单**:

1. **保险产品管理**
   - 保险产品定义和分类
   - 保障范围和覆盖类型管理
   - 产品特征和规则管理

2. **保单管理**
   - 保险申请处理
   - 保险报价生成
   - 保险单签发和管理

3. **理赔管理**
   - 理赔申请处理
   - 理赔审核和结算
   - 理赔历史追踪

4. **风险评估**
   - 风险分析和评估
   - 精算模型应用
   - 定价计算

5. **保费管理**
   - 保费计划制定
   - 保费发票生成
   - 保费收款管理

### 2.2 性能要求

- **高并发**：支持1000+ TPS
- **低延迟**：查询响应时间<100ms
- **高可用**：99.9%可用性
- **数据安全**：加密存储，审计日志

---

## 3. 保险产品模型

### 3.1 保险产品表

**保险产品表设计**:

```sql
-- 保险产品表
CREATE TABLE insurance_product (
    product_id SERIAL PRIMARY KEY,
    product_code VARCHAR(50) UNIQUE NOT NULL,
    product_name VARCHAR(200) NOT NULL,
    description TEXT,
    product_type_id INT, -- 产品类型（财产、人身、健康等）
    from_date DATE DEFAULT CURRENT_DATE,
    thru_date DATE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 保险产品分类表
CREATE TABLE insurance_product_category (
    category_id SERIAL PRIMARY KEY,
    parent_category_id INT REFERENCES insurance_product_category(category_id),
    category_code VARCHAR(50) UNIQUE NOT NULL,
    category_name VARCHAR(200) NOT NULL,
    category_type VARCHAR(50), -- 'TYPE', 'INDIVIDUAL_GROUP', 'INDUSTRY'
    description TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 产品分类关联表（多对多）
CREATE TABLE product_category_classification (
    product_id INT NOT NULL REFERENCES insurance_product(product_id),
    category_id INT NOT NULL REFERENCES insurance_product_category(category_id),
    from_date DATE DEFAULT CURRENT_DATE,
    thru_date DATE,
    PRIMARY KEY (product_id, category_id, from_date)
);
```

### 3.2 保障范围模型

**保障范围表设计**:

```sql
-- 保障类型表
CREATE TABLE coverage_type (
    coverage_type_id SERIAL PRIMARY KEY,
    coverage_type_code VARCHAR(50) UNIQUE NOT NULL,
    coverage_type_name VARCHAR(200) NOT NULL,
    coverage_category_id INT, -- 保障类别
    description TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 保障级别表
CREATE TABLE coverage_level (
    level_id SERIAL PRIMARY KEY,
    level_type VARCHAR(50) NOT NULL, -- 'AMOUNT', 'RANGE', 'DEDUCTIBLE', 'COPAY', 'COINSURANCE'
    coverage_amount NUMERIC(15,2),
    coverage_limit_from NUMERIC(15,2),
    coverage_limit_thru NUMERIC(15,2),
    coverage_level_basis VARCHAR(100), -- 'per incident', 'per year', etc.
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 保障可用性表（产品-保障类型-保障级别的组合）
CREATE TABLE coverage_availability (
    availability_id SERIAL PRIMARY KEY,
    product_id INT NOT NULL REFERENCES insurance_product(product_id),
    coverage_type_id INT NOT NULL REFERENCES coverage_type(coverage_type_id),
    level_id INT NOT NULL REFERENCES coverage_level(level_id),
    availability_type VARCHAR(50) NOT NULL, -- 'REQUIRED', 'STANDARD', 'OPTIONAL', 'SELECTABLE'
    from_date DATE DEFAULT CURRENT_DATE,
    thru_date DATE,
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## 4. 保单管理模型

### 4.1 保险申请

**保险申请表设计**:

```sql
-- 保险申请表
CREATE TABLE insurance_application (
    application_id SERIAL PRIMARY KEY,
    application_number VARCHAR(50) UNIQUE NOT NULL,
    product_id INT NOT NULL REFERENCES insurance_product(product_id),
    party_id INT NOT NULL, -- 投保人（引用Party表）
    application_date DATE DEFAULT CURRENT_DATE,
    description TEXT,
    status VARCHAR(50) DEFAULT 'submitted', -- 'submitted', 'reviewing', 'approved', 'rejected'
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 申请状态历史表
CREATE TABLE application_status_history (
    status_history_id SERIAL PRIMARY KEY,
    application_id INT NOT NULL REFERENCES insurance_application(application_id) ON DELETE CASCADE,
    status VARCHAR(50) NOT NULL,
    status_date TIMESTAMPTZ DEFAULT NOW(),
    comments TEXT,
    changed_by VARCHAR(100)
);

-- 申请项目表
CREATE TABLE application_item (
    item_id SERIAL PRIMARY KEY,
    application_id INT NOT NULL REFERENCES insurance_application(application_id) ON DELETE CASCADE,
    item_seq_id INT NOT NULL,
    coverage_type_id INT REFERENCES coverage_type(coverage_type_id),
    level_id INT REFERENCES coverage_level(level_id),
    insured_asset_id INT, -- 被保险资产（如适用）
    description TEXT,
    UNIQUE(application_id, item_seq_id)
);
```

### 4.2 保险报价

**保险报价表设计**:

```sql
-- 保险报价表
CREATE TABLE insurance_quote (
    quote_id SERIAL PRIMARY KEY,
    quote_number VARCHAR(50) UNIQUE NOT NULL,
    application_id INT REFERENCES insurance_application(application_id),
    quote_date DATE DEFAULT CURRENT_DATE,
    valid_from_date DATE,
    valid_thru_date DATE,
    total_premium_amount NUMERIC(15,2),
    description TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 报价项目表
CREATE TABLE quote_item (
    quote_item_id SERIAL PRIMARY KEY,
    quote_id INT NOT NULL REFERENCES insurance_quote(quote_id) ON DELETE CASCADE,
    item_seq_id INT NOT NULL,
    coverage_type_id INT REFERENCES coverage_type(coverage_type_id),
    level_id INT REFERENCES coverage_level(level_id),
    quoted_premium_amount NUMERIC(15,2),
    estimated_policy_date DATE,
    description TEXT,
    UNIQUE(quote_id, item_seq_id)
);
```

### 4.3 保险单

**保险单表设计**:

```sql
-- 保险单表（基于Agreement扩展）
CREATE TABLE insurance_policy (
    policy_id SERIAL PRIMARY KEY,
    policy_number VARCHAR(50) UNIQUE NOT NULL,
    product_id INT NOT NULL REFERENCES insurance_product(product_id),
    quote_id INT REFERENCES insurance_quote(quote_id),
    application_id INT REFERENCES insurance_application(application_id),
    policy_type VARCHAR(50), -- 'INDIVIDUAL', 'GROUP'
    policy_status VARCHAR(50) DEFAULT 'active', -- 'active', 'cancelled', 'expired', 'lapsed'
    effective_date DATE NOT NULL,
    expiration_date DATE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 保单项目表
CREATE TABLE policy_item (
    item_id SERIAL PRIMARY KEY,
    policy_id INT NOT NULL REFERENCES insurance_policy(policy_id) ON DELETE CASCADE,
    item_seq_id INT NOT NULL,
    coverage_type_id INT REFERENCES coverage_type(coverage_type_id),
    level_id INT REFERENCES coverage_level(level_id),
    insured_asset_id INT, -- 被保险资产（如适用）
    from_date DATE DEFAULT CURRENT_DATE,
    thru_date DATE,
    description TEXT,
    UNIQUE(policy_id, item_seq_id)
);

-- 保单角色表
CREATE TABLE policy_role (
    role_id SERIAL PRIMARY KEY,
    policy_id INT NOT NULL REFERENCES insurance_policy(policy_id) ON DELETE CASCADE,
    party_id INT NOT NULL, -- 引用Party表
    role_type VARCHAR(50) NOT NULL, -- 'insured_party', 'beneficiary', 'agent', 'provider'
    from_date DATE DEFAULT CURRENT_DATE,
    thru_date DATE,
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## 5. 理赔管理模型

### 5.1 理赔事件

**理赔事件表设计**:

```sql
-- 理赔事件表
CREATE TABLE insurance_incident (
    incident_id SERIAL PRIMARY KEY,
    incident_number VARCHAR(50) UNIQUE NOT NULL,
    incident_type VARCHAR(50) NOT NULL, -- 'PROPERTY_DAMAGE', 'ACCIDENT', 'THEFT', etc.
    incident_date DATE NOT NULL,
    description TEXT,
    reported_date DATE DEFAULT CURRENT_DATE,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 事件角色表
CREATE TABLE incident_role (
    role_id SERIAL PRIMARY KEY,
    incident_id INT NOT NULL REFERENCES insurance_incident(incident_id) ON DELETE CASCADE,
    party_id INT NOT NULL, -- 引用Party表
    role_type VARCHAR(50) NOT NULL, -- 'reporter', 'involved_party', 'witness'
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 事件财产损失表
CREATE TABLE incident_property_damage (
    damage_id SERIAL PRIMARY KEY,
    incident_id INT NOT NULL REFERENCES insurance_incident(incident_id) ON DELETE CASCADE,
    insured_asset_id INT, -- 被保险资产
    damage_type VARCHAR(50),
    damage_description TEXT,
    estimated_restore_cost NUMERIC(15,2),
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### 5.2 理赔申请

**理赔申请表设计**:

```sql
-- 理赔申请表
CREATE TABLE insurance_claim (
    claim_id SERIAL PRIMARY KEY,
    claim_number VARCHAR(50) UNIQUE NOT NULL,
    policy_id INT NOT NULL REFERENCES insurance_policy(policy_id),
    incident_id INT REFERENCES insurance_incident(incident_id),
    claim_type VARCHAR(50), -- 'HEALTH_CARE', 'PROPERTY', 'DISABILITY', 'LIFE'
    claim_date DATE DEFAULT CURRENT_DATE,
    total_claim_amount NUMERIC(15,2),
    status VARCHAR(50) DEFAULT 'submitted', -- 'submitted', 'adjusting', 'settled', 'rejected'
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 理赔状态历史表
CREATE TABLE claim_status_history (
    status_history_id SERIAL PRIMARY KEY,
    claim_id INT NOT NULL REFERENCES insurance_claim(claim_id) ON DELETE CASCADE,
    status VARCHAR(50) NOT NULL,
    status_date TIMESTAMPTZ DEFAULT NOW(),
    comments TEXT,
    changed_by VARCHAR(100)
);

-- 理赔项目表
CREATE TABLE claim_item (
    item_id SERIAL PRIMARY KEY,
    claim_id INT NOT NULL REFERENCES insurance_claim(claim_id) ON DELETE CASCADE,
    item_seq_id INT NOT NULL,
    coverage_type_id INT REFERENCES coverage_type(coverage_type_id),
    insured_asset_id INT, -- 被保险资产（如适用）
    incident_id INT REFERENCES insurance_incident(incident_id),
    claim_amount NUMERIC(15,2),
    quantity NUMERIC(10,2),
    unit_of_measure_id INT,
    description TEXT,
    UNIQUE(claim_id, item_seq_id)
);
```

### 5.3 理赔结算

**理赔结算表设计**:

```sql
-- 理赔结算表
CREATE TABLE claim_settlement (
    settlement_id SERIAL PRIMARY KEY,
    claim_item_id INT NOT NULL REFERENCES claim_item(item_id),
    settlement_date DATE DEFAULT CURRENT_DATE,
    settlement_amount NUMERIC(15,2) NOT NULL,
    deductible_amount NUMERIC(15,2) DEFAULT 0,
    disallowed_amount NUMERIC(15,2) DEFAULT 0,
    payment_amount NUMERIC(15,2) NOT NULL,
    explanation_of_benefit TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 理赔支付表
CREATE TABLE claim_payment (
    payment_id SERIAL PRIMARY KEY,
    settlement_id INT NOT NULL REFERENCES claim_settlement(settlement_id),
    payment_type VARCHAR(50), -- 'CHECK', 'WIRE', 'CARD'
    payment_method VARCHAR(50),
    payment_amount NUMERIC(15,2) NOT NULL,
    payment_date DATE DEFAULT CURRENT_DATE,
    payee_party_id INT NOT NULL, -- 收款方
    status VARCHAR(50) DEFAULT 'pending', -- 'pending', 'completed', 'failed'
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## 6. 风险评估模型

### 6.1 风险评估

**风险评估表设计**:

```sql
-- 风险评估表（基于Work Effort扩展）
CREATE TABLE risk_analysis (
    analysis_id SERIAL PRIMARY KEY,
    analysis_type VARCHAR(50), -- 'COMMUNITY_BASED', 'EXPERIENCE_BASED'
    analysis_date DATE DEFAULT CURRENT_DATE,
    description TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 精算分析表
CREATE TABLE actuarial_analysis (
    actuarial_analysis_id SERIAL PRIMARY KEY,
    analysis_id INT NOT NULL REFERENCES risk_analysis(analysis_id),
    product_id INT REFERENCES insurance_product(product_id),
    coverage_type_id INT REFERENCES coverage_type(coverage_type_id),
    level_id INT REFERENCES coverage_level(level_id),
    actuarial_score NUMERIC(10,2),
    rate_amount NUMERIC(15,2),
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 分析参数表
CREATE TABLE analysis_parameter (
    parameter_id SERIAL PRIMARY KEY,
    actuarial_analysis_id INT NOT NULL REFERENCES actuarial_analysis(actuarial_analysis_id) ON DELETE CASCADE,
    parameter_name VARCHAR(100) NOT NULL,
    parameter_value VARCHAR(200),
    parameter_weight NUMERIC(5,2),
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### 6.2 保险费率表

**保险费率表设计**:

```sql
-- 保险费率表
CREATE TABLE insurance_rate (
    rate_id SERIAL PRIMARY KEY,
    product_id INT REFERENCES insurance_product(product_id),
    coverage_type_id INT REFERENCES coverage_type(coverage_type_id),
    level_id INT REFERENCES coverage_level(level_id),
    geographic_boundary_id INT, -- 地理边界
    risk_level_type VARCHAR(50), -- 'high', 'medium', 'low'
    period_type_id INT, -- 期间类型（月、季度、年等）
    rate_amount NUMERIC(15,2) NOT NULL,
    from_date DATE DEFAULT CURRENT_DATE,
    thru_date DATE,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 保险因子表
CREATE TABLE insurance_factor (
    factor_id SERIAL PRIMARY KEY,
    rate_id INT REFERENCES insurance_rate(rate_id),
    factor_description VARCHAR(200),
    factor_value NUMERIC(10,4),
    from_date DATE DEFAULT CURRENT_DATE,
    thru_date DATE,
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## 7. PostgreSQL完整实现

### 7.1 索引设计

```sql
-- 保险产品索引
CREATE INDEX idx_insurance_product_code ON insurance_product(product_code);
CREATE INDEX idx_insurance_product_type ON insurance_product(product_type_id);
CREATE INDEX idx_insurance_product_dates ON insurance_product USING gist (daterange(from_date, thru_date));

-- 保单索引
CREATE INDEX idx_insurance_policy_number ON insurance_policy(policy_number);
CREATE INDEX idx_insurance_policy_product ON insurance_policy(product_id);
CREATE INDEX idx_insurance_policy_status ON insurance_policy(policy_status, effective_date);
CREATE INDEX idx_insurance_policy_dates ON insurance_policy USING gist (daterange(effective_date, expiration_date));

-- 理赔索引
CREATE INDEX idx_insurance_claim_number ON insurance_claim(claim_number);
CREATE INDEX idx_insurance_claim_policy ON insurance_claim(policy_id);
CREATE INDEX idx_insurance_claim_status ON insurance_claim(status, claim_date);
CREATE INDEX idx_insurance_claim_date ON insurance_claim(claim_date DESC);

-- 保障可用性索引
CREATE INDEX idx_coverage_availability_product ON coverage_availability(product_id);
CREATE INDEX idx_coverage_availability_type ON coverage_availability(coverage_type_id);
CREATE INDEX idx_coverage_availability_dates ON coverage_availability USING gist (daterange(from_date, thru_date));

-- 费率索引
CREATE INDEX idx_insurance_rate_product ON insurance_rate(product_id);
CREATE INDEX idx_insurance_rate_type ON insurance_rate(coverage_type_id);
CREATE INDEX idx_insurance_rate_risk ON insurance_rate(risk_level_type);
CREATE INDEX idx_insurance_rate_dates ON insurance_rate USING gist (daterange(from_date, thru_date));
```

### 7.2 查询示例

**查询1: 查询保单及其保障范围**:

```sql
-- 查询保单及其保障范围
SELECT
    ip.policy_number,
    ip.product_name,
    pi.item_seq_id,
    ct.coverage_type_name,
    cl.coverage_amount,
    cl.coverage_limit_from,
    cl.coverage_limit_thru
FROM insurance_policy ip
INNER JOIN policy_item pi ON ip.policy_id = pi.policy_id
LEFT JOIN coverage_type ct ON pi.coverage_type_id = ct.coverage_type_id
LEFT JOIN coverage_level cl ON pi.level_id = cl.level_id
WHERE ip.policy_number = :policy_number
ORDER BY pi.item_seq_id;
```

**查询2: 查询理赔统计**:

```sql
-- 查询理赔统计
SELECT
    DATE_TRUNC('month', ic.claim_date) AS claim_month,
    ic.claim_type,
    COUNT(*) AS claim_count,
    SUM(ic.total_claim_amount) AS total_claim_amount,
    AVG(ic.total_claim_amount) AS avg_claim_amount
FROM insurance_claim ic
WHERE ic.claim_date >= :start_date
  AND ic.claim_date <= :end_date
GROUP BY DATE_TRUNC('month', ic.claim_date), ic.claim_type
ORDER BY claim_month DESC, ic.claim_type;
```

**查询3: 查询费率信息**:

```sql
-- 查询费率信息
SELECT
    ip.product_name,
    ct.coverage_type_name,
    ir.risk_level_type,
    ir.rate_amount,
    ir.from_date,
    ir.thru_date
FROM insurance_rate ir
INNER JOIN insurance_product ip ON ir.product_id = ip.product_id
LEFT JOIN coverage_type ct ON ir.coverage_type_id = ct.coverage_type_id
WHERE ir.from_date <= CURRENT_DATE
  AND (ir.thru_date IS NULL OR ir.thru_date >= CURRENT_DATE)
ORDER BY ip.product_name, ct.coverage_type_name, ir.risk_level_type;
```

---

## 8. 性能优化与监控

### 8.1 索引优化

```sql
-- 创建部分索引（仅活跃保单）
CREATE INDEX idx_insurance_policy_active ON insurance_policy(policy_id, effective_date, expiration_date)
WHERE policy_status = 'active';

-- 创建部分索引（待处理理赔）
CREATE INDEX idx_insurance_claim_pending ON insurance_claim(claim_id, claim_date)
WHERE status IN ('submitted', 'adjusting');

-- GIN索引（JSONB字段，如适用）
-- CREATE INDEX idx_policy_metadata ON insurance_policy USING GIN (metadata);
```

### 8.2 物化视图优化

```sql
-- 创建理赔统计物化视图
CREATE MATERIALIZED VIEW mv_claim_statistics AS
SELECT
    DATE_TRUNC('month', claim_date) AS claim_month,
    claim_type,
    COUNT(*) AS claim_count,
    SUM(total_claim_amount) AS total_claim_amount,
    AVG(total_claim_amount) AS avg_claim_amount
FROM insurance_claim
GROUP BY DATE_TRUNC('month', claim_date), claim_type;

CREATE UNIQUE INDEX ON mv_claim_statistics(claim_month, claim_type);

-- 定期刷新物化视图
REFRESH MATERIALIZED VIEW CONCURRENTLY mv_claim_statistics;
```

---

## 9. 常见问题解答 / FAQ

### Q1: 如何管理保单的生命周期？

**A**: 保单生命周期管理：

```sql
-- 保单状态机
CREATE OR REPLACE FUNCTION update_policy_status()
RETURNS TRIGGER AS $$
BEGIN
    -- 自动过期保单
    IF NEW.expiration_date < CURRENT_DATE AND NEW.policy_status = 'active' THEN
        NEW.policy_status := 'expired';
    END IF;

    -- 记录状态变更历史
    IF NEW.policy_status != OLD.policy_status THEN
        INSERT INTO policy_status_history (policy_id, status, status_date)
        VALUES (NEW.policy_id, NEW.policy_status, NOW());
    END IF;

    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_update_policy_status
    BEFORE UPDATE ON insurance_policy
    FOR EACH ROW
    EXECUTE FUNCTION update_policy_status();
```

### Q2: 如何计算保费？

**A**: 保费计算：

```sql
-- 保费计算函数
CREATE OR REPLACE FUNCTION calculate_premium(
    p_policy_id INT,
    p_coverage_type_id INT,
    p_level_id INT
)
RETURNS NUMERIC(15,2) AS $$
DECLARE
    v_rate_amount NUMERIC(15,2);
BEGIN
    -- 查询适用的费率
    SELECT rate_amount INTO v_rate_amount
    FROM insurance_rate
    WHERE product_id = (SELECT product_id FROM insurance_policy WHERE policy_id = p_policy_id)
      AND coverage_type_id = p_coverage_type_id
      AND level_id = p_level_id
      AND from_date <= CURRENT_DATE
      AND (thru_date IS NULL OR thru_date >= CURRENT_DATE)
    ORDER BY from_date DESC
    LIMIT 1;

    RETURN COALESCE(v_rate_amount, 0);
END;
$$ LANGUAGE plpgsql;
```

---

## 10. 相关资源

### 10.1 核心相关文档

- [产品管理模型](../04-OLTP建模/产品管理模型.md) - 保险产品模型基础
- [Party模型](../04-OLTP建模/Party模型.md) - 投保人、受益人模型
- [订单管理模型](../04-OLTP建模/订单管理模型.md) - 保单申请和报价模型

### 10.2 理论基础

- [Silverston数据模型资源手册](../02-权威资源与标准/Silverston数据模型资源手册.md) - 保险模型来源
- [产品管理模型](../04-OLTP建模/产品管理模型.md) - 产品模型理论

### 10.3 参考资源

- [术语对照表](../00-导航与索引/术语对照表.md) - 术语对照
- [权威资源索引](../00-导航与索引/权威资源索引.md) - 权威资源列表

---

**状态**: ✅ 文档完整内容已补充（700+行）
**最后更新**: 2025年1月
**维护者**: PostgreSQL Modern Team
