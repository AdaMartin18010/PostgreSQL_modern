# 开源数据模型

> **创建日期**: 2025年1月
> **来源**: 开源社区数据模型资源
> **状态**: 完整
> **文档编号**: 02-04

---

## 📑 目录

- [开源数据模型](#开源数据模型)
  - [📑 目录](#-目录)
  - [1. 概述](#1-概述)
  - [1.1 理论基础](#11-理论基础)
    - [1.1.1 开源数据模型理论](#111-开源数据模型理论)
    - [1.1.2 数据模型复用理论](#112-数据模型复用理论)
    - [1.1.3 数据模型学习理论](#113-数据模型学习理论)
    - [1.1.4 复杂度分析](#114-复杂度分析)
  - [2. AdventureWorks](#2-adventureworks)
    - [2.1 概述](#21-概述)
    - [2.2 数据模型结构](#22-数据模型结构)
    - [2.3 PostgreSQL版本](#23-postgresql版本)
    - [2.4 学习价值](#24-学习价值)
  - [3. Sakila](#3-sakila)
    - [3.1 概述](#31-概述)
    - [3.2 数据模型结构](#32-数据模型结构)
    - [3.3 学习价值](#33-学习价值)
  - [4. OSDM（开源数据模型）](#4-osdm开源数据模型)
    - [4.1 概述](#41-概述)
    - [4.2 模型结构](#42-模型结构)
  - [5. PostgreSQL示例数据库](#5-postgresql示例数据库)
    - [5.1 PostgreSQL官方示例](#51-postgresql官方示例)
    - [5.2 Pagila示例](#52-pagila示例)
  - [6. 其他开源模型](#6-其他开源模型)
    - [6.1 Northwind](#61-northwind)
    - [6.2 Chinook](#62-chinook)
    - [6.3 行业特定模型](#63-行业特定模型)
  - [7. 使用建议](#7-使用建议)
    - [7.1 学习路径](#71-学习路径)
    - [7.2 实践建议](#72-实践建议)
    - [7.3 PostgreSQL迁移](#73-postgresql迁移)
  - [8. 相关资源](#8-相关资源)
    - [8.1 下载链接](#81-下载链接)
    - [8.2 文档资源](#82-文档资源)
    - [8.3 工具推荐](#83-工具推荐)

---

## 1. 概述

开源数据模型是学习和实践数据建模的宝贵资源，提供了经过验证的、可直接使用的数据模型设计。

**核心价值**:

- **学习参考**：理解实际业务场景的数据模型设计
- **快速启动**：作为项目起点，节省设计时间
- **最佳实践**：学习行业标准的数据建模方法
- **社区支持**：活跃的社区和丰富的文档

---

## 1.1 理论基础

### 1.1.1 开源数据模型理论

**开源数据模型**:

- **定义**: 经过验证的、可直接使用的数据模型设计
- **特点**: 开源、可复用、经过验证
- **应用**: 学习参考、快速启动、最佳实践

**开源模型优势**:

- **学习价值**: 学习实际业务场景的数据模型设计
- **快速启动**: 作为项目起点，节省设计时间
- **最佳实践**: 学习行业标准的数据建模方法

### 1.1.2 数据模型复用理论

**模型复用**:

- **复用层次**: 完全复用 → 部分复用 → 参考复用
- **复用原则**: 适配业务需求、保持模型质量
- **复用方法**: 直接使用、修改适配、参考设计

**复用策略**:

- **直接使用**: 完全符合业务需求
- **修改适配**: 部分符合业务需求
- **参考设计**: 作为设计参考

### 1.1.3 数据模型学习理论

**模型学习**:

- **学习目标**: 理解数据模型设计原理
- **学习方法**: 分析模型结构、理解设计思路、实践应用
- **学习价值**: 提高数据建模能力

**学习路径**:

- **基础学习**: 学习基础数据模型
- **进阶学习**: 学习复杂数据模型
- **实践应用**: 在实际项目中应用

### 1.1.4 复杂度分析

**学习复杂度**:

- **模型理解**: $O(M)$ where M is model complexity
- **适配复杂度**: $O(A)$ where A is adaptation complexity
- **实施复杂度**: $O(I)$ where I is implementation complexity

---

## 2. AdventureWorks

### 2.1 概述

**AdventureWorks**是Microsoft提供的示例数据库，包含OLTP和OLAP两个版本。

**特点**:

- **完整业务场景**：自行车制造和销售业务
- **双模型设计**：OLTP事务数据库 + OLAP数据仓库
- **标准设计**：遵循数据库设计最佳实践
- **多数据库支持**：SQL Server、PostgreSQL、MySQL版本

### 2.2 数据模型结构

**核心业务模块**:

1. **销售模块**
   - Customer（客户）
   - SalesOrderHeader（订单头）
   - SalesOrderDetail（订单明细）
   - Product（产品）

2. **采购模块**
   - Vendor（供应商）
   - PurchaseOrderHeader（采购订单）
   - PurchaseOrderDetail（采购明细）

3. **生产模块**
   - Product（产品）
   - BillOfMaterials（物料清单）
   - WorkOrder（工作订单）

4. **人力资源模块**
   - Employee（员工）
   - Department（部门）
   - JobCandidate（求职者）

### 2.3 PostgreSQL版本

**PostgreSQL移植版本**:

```sql
-- AdventureWorks PostgreSQL版本示例
-- 下载地址：https://github.com/lorint/AdventureWorks-for-Postgres

-- 核心表结构示例（带错误处理，需要先创建sales schema）
DO $$
BEGIN
    CREATE SCHEMA IF NOT EXISTS sales;
    RAISE NOTICE 'Schema sales 创建成功';
EXCEPTION
    WHEN duplicate_schema THEN
        RAISE NOTICE 'Schema sales 已存在，跳过创建';
    WHEN OTHERS THEN
        RAISE WARNING '创建Schema失败: %', SQLERRM;
END $$;

DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_tables WHERE schemaname = 'sales' AND tablename = 'customer') THEN
        CREATE TABLE sales.customer (
            customerid SERIAL PRIMARY KEY,
            personid INT,
            storeid INT,
            territoryid INT,
            accountnumber VARCHAR(10) NOT NULL,
            rowguid UUID DEFAULT gen_random_uuid(),
            modifieddate TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
        );
        RAISE NOTICE '表 sales.customer 创建成功';
    ELSE
        RAISE NOTICE '表 sales.customer 已存在，跳过创建';
    END IF;
EXCEPTION
    WHEN OTHERS THEN
        RAISE EXCEPTION '创建表 sales.customer 失败: %', SQLERRM;
END $$;

DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_tables WHERE schemaname = 'sales' AND tablename = 'salesorderheader') THEN
        CREATE TABLE sales.salesorderheader (
            salesorderid SERIAL PRIMARY KEY,
            revisionnumber SMALLINT NOT NULL DEFAULT 0,
            orderdate TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
            duedate TIMESTAMP NOT NULL,
            shipdate TIMESTAMP,
            status SMALLINT NOT NULL DEFAULT 1,
            onlineorderflag BOOLEAN NOT NULL DEFAULT TRUE,
            salesordernumber VARCHAR(25) NOT NULL,
            purchaseordernumber VARCHAR(25),
            accountnumber VARCHAR(15),
            customerid INT NOT NULL REFERENCES sales.customer(customerid),
            salespersonid INT,
            territoryid INT,
            billtoaddressid INT NOT NULL,
            shiptoaddressid INT NOT NULL,
            shipmethodid INT NOT NULL,
            creditcardid INT,
            creditcardapprovalcode VARCHAR(15),
            currencyrateid INT,
            subtotal NUMERIC(19,4) NOT NULL DEFAULT 0,
            taxamt NUMERIC(19,4) NOT NULL DEFAULT 0,
            freight NUMERIC(19,4) NOT NULL DEFAULT 0,
            totaldue NUMERIC(19,4) GENERATED ALWAYS AS (subtotal + taxamt + freight) STORED,
            comment TEXT,
            rowguid UUID DEFAULT gen_random_uuid(),
            modifieddate TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
        );
        RAISE NOTICE '表 sales.salesorderheader 创建成功';
    ELSE
        RAISE NOTICE '表 sales.salesorderheader 已存在，跳过创建';
    END IF;
EXCEPTION
    WHEN undefined_table THEN
        RAISE EXCEPTION '请先创建 sales.customer 表';
    WHEN OTHERS THEN
        RAISE EXCEPTION '创建表 sales.salesorderheader 失败: %', SQLERRM;
END $$;
```

### 2.4 学习价值

**适用场景**:

- 学习OLTP数据库设计
- 学习数据仓库设计（AdventureWorksDW）
- 学习ETL流程设计
- 学习报表和分析查询

---

## 3. Sakila

### 3.1 概述

**Sakila**是MySQL官方提供的示例数据库，模拟DVD租赁业务。

**特点**:

- **简单易懂**：业务场景清晰（DVD租赁）
- **完整功能**：涵盖租赁、库存、客户管理等
- **多语言支持**：包含多语言数据
- **PostgreSQL版本**：有PostgreSQL移植版本

### 3.2 数据模型结构

**核心表结构**:

```sql
-- Sakila PostgreSQL版本
-- 下载地址：https://github.com/jOOQ/sakila

-- 客户表（Sakila示例，带错误处理）
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_tables WHERE tablename = 'customer') THEN
        CREATE TABLE customer (
            customer_id SERIAL PRIMARY KEY,
            store_id SMALLINT NOT NULL,
            first_name VARCHAR(45) NOT NULL,
            last_name VARCHAR(45) NOT NULL,
            email VARCHAR(50),
            address_id SMALLINT NOT NULL,
            activebool BOOLEAN DEFAULT TRUE,
            create_date DATE DEFAULT CURRENT_DATE,
            last_update TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            active INT
        );
        RAISE NOTICE '表 customer 创建成功';
    ELSE
        RAISE NOTICE '表 customer 已存在，跳过创建';
    END IF;
EXCEPTION
    WHEN OTHERS THEN
        RAISE EXCEPTION '创建表 customer 失败: %', SQLERRM;
END $$;

-- 租赁表（带错误处理）
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_tables WHERE tablename = 'rental') THEN
        CREATE TABLE rental (
            rental_id SERIAL PRIMARY KEY,
            rental_date TIMESTAMP NOT NULL,
            inventory_id INT NOT NULL,
            customer_id SMALLINT NOT NULL REFERENCES customer(customer_id),
            return_date TIMESTAMP,
            staff_id SMALLINT NOT NULL,
            last_update TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        );
        RAISE NOTICE '表 rental 创建成功';
    ELSE
        RAISE NOTICE '表 rental 已存在，跳过创建';
    END IF;
EXCEPTION
    WHEN undefined_table THEN
        RAISE EXCEPTION '请先创建 customer 表';
    WHEN OTHERS THEN
        RAISE EXCEPTION '创建表 rental 失败: %', SQLERRM;
END $$;

-- 电影表（带错误处理，注意YEAR类型在PostgreSQL中应使用INTEGER）
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_tables WHERE tablename = 'film') THEN
        CREATE TABLE film (
            film_id SERIAL PRIMARY KEY,
            title VARCHAR(255) NOT NULL,
            description TEXT,
            release_year INTEGER,  -- PostgreSQL中YEAR类型使用INTEGER
            language_id SMALLINT NOT NULL,
            original_language_id SMALLINT,
            rental_duration SMALLINT NOT NULL DEFAULT 3,
            rental_rate NUMERIC(4,2) NOT NULL DEFAULT 4.99,
            length SMALLINT,
            replacement_cost NUMERIC(5,2) NOT NULL DEFAULT 19.99,
            rating VARCHAR(10),
            last_update TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            special_features TEXT[],
            fulltext TSVECTOR
        );
        RAISE NOTICE '表 film 创建成功';
    ELSE
        RAISE NOTICE '表 film 已存在，跳过创建';
    END IF;
EXCEPTION
    WHEN OTHERS THEN
        RAISE EXCEPTION '创建表 film 失败: %', SQLERRM;
END $$;
```

### 3.3 学习价值

**适用场景**:

- 学习关系数据库基础设计
- 学习外键和约束设计
- 学习视图和存储过程
- 学习报表查询编写

---

## 4. OSDM（开源数据模型）

### 4.1 概述

**OSDM（Open Source Data Model）**是一个开源的数据模型项目，提供多个行业的通用数据模型。

**特点**:

- **多行业覆盖**：零售、制造、服务等
- **标准化设计**：遵循数据建模标准
- **可扩展性**：易于定制和扩展

### 4.2 模型结构

**核心模型**:

- **通用模型**：Party、Product、Order等
- **零售模型**：Store、Inventory、Sales等
- **制造模型**：BillOfMaterials、WorkOrder等

---

## 5. PostgreSQL示例数据库

### 5.1 PostgreSQL官方示例

**PostgreSQL官方提供的示例**:

1. **dvdrental**：DVD租赁业务（类似Sakila）
2. **pagila**：PostgreSQL版本的Sakila
3. **world**：世界国家数据库

### 5.2 Pagila示例

**Pagila数据库结构**:

```sql
-- Pagila是PostgreSQL版本的Sakila
-- 下载地址：https://github.com/devrimgunduz/pagila

-- 核心表示例（Pagila示例，带错误处理）
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_tables WHERE tablename = 'actor') THEN
        CREATE TABLE actor (
            actor_id SERIAL PRIMARY KEY,
            first_name VARCHAR(45) NOT NULL,
            last_name VARCHAR(45) NOT NULL,
            last_update TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
        );
        RAISE NOTICE '表 actor 创建成功';
    ELSE
        RAISE NOTICE '表 actor 已存在，跳过创建';
    END IF;
EXCEPTION
    WHEN OTHERS THEN
        RAISE EXCEPTION '创建表 actor 失败: %', SQLERRM;
END $$;

DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_tables WHERE tablename = 'film_pagila') THEN
        CREATE TABLE film_pagila (
            film_id SERIAL PRIMARY KEY,
            title VARCHAR(255) NOT NULL,
            description TEXT,
            release_year INTEGER,
            language_id SMALLINT NOT NULL,
            rental_duration SMALLINT NOT NULL DEFAULT 3,
            rental_rate NUMERIC(4,2) NOT NULL DEFAULT 4.99,
            length SMALLINT,
            replacement_cost NUMERIC(5,2) NOT NULL DEFAULT 19.99,
            rating VARCHAR(10),
            last_update TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
            special_features TEXT[],
            fulltext TSVECTOR
        );
        RAISE NOTICE '表 film_pagila 创建成功';
    ELSE
        RAISE NOTICE '表 film_pagila 已存在，跳过创建';
    END IF;
EXCEPTION
    WHEN OTHERS THEN
        RAISE EXCEPTION '创建表 film_pagila 失败: %', SQLERRM;
END $$;
```

---

## 6. 其他开源模型

### 6.1 Northwind

**Northwind**：经典的贸易业务示例数据库

- **业务场景**：食品贸易公司
- **核心模块**：订单、产品、客户、供应商
- **适用场景**：学习基础SQL和数据库设计

### 6.2 Chinook

**Chinook**：音乐商店数据库

- **业务场景**：数字音乐商店
- **特点**：多对多关系丰富
- **适用场景**：学习复杂关系查询

### 6.3 行业特定模型

**其他行业模型**:

- **医疗**：HL7 FHIR数据模型
- **金融**：FIBO（金融业务本体）
- **地理**：PostGIS示例数据

---

## 7. 使用建议

### 7.1 学习路径

**推荐学习顺序**:

1. **入门**：Sakila/Pagila（简单业务场景）
2. **进阶**：AdventureWorks（复杂业务场景）
3. **专业**：OSDM（行业模型）

### 7.2 实践建议

**如何使用开源模型**:

1. **下载和安装**：按照官方文档安装示例数据库
2. **探索结构**：使用ER工具查看数据模型
3. **运行查询**：执行示例查询，理解业务逻辑
4. **修改实验**：尝试修改模型，学习设计原则
5. **应用到项目**：参考设计思路，应用到实际项目

### 7.3 PostgreSQL迁移

**从其他数据库迁移到PostgreSQL**:

```sql
-- 迁移注意事项
-- 1. 数据类型转换
--    SQL Server: INT -> INTEGER
--    MySQL: YEAR -> INTEGER
--    SQL Server: DATETIME -> TIMESTAMP

-- 2. 语法差异
--    SQL Server: IDENTITY -> SERIAL
--    MySQL: AUTO_INCREMENT -> SERIAL
--    SQL Server: GETDATE() -> NOW()

-- 3. 约束差异
--    检查约束语法
--    外键约束语法
--    唯一约束语法

-- 4. 索引差异
--    全文索引：SQL Server -> PostgreSQL GIN索引
--    空间索引：SQL Server -> PostGIS GIST索引
```

---

## 8. 相关资源

### 8.1 下载链接

- **AdventureWorks PostgreSQL**: <https://github.com/lorint/AdventureWorks-for-Postgres>
- **Sakila**: <https://dev.mysql.com/doc/sakila/en/>
- **Pagila**: <https://github.com/devrimgunduz/pagila>
- **OSDM**: <https://github.com/osdm-project>

### 8.2 文档资源

- [Silverston数据模型资源手册](./Silverston数据模型资源手册.md) - 权威数据模型资源
- [Kimball维度建模](./Kimball维度建模.md) - 数据仓库建模
- [行业标准与规范](./行业标准与规范.md) - 行业标准参考

### 8.3 工具推荐

- **pgModeler**: PostgreSQL数据建模工具
- **DBeaver**: 数据库管理和ER图工具
- **dbdiagram.io**: 在线ER图工具

---

**最后更新**: 2025年1月
**维护者**: PostgreSQL Modern Team
