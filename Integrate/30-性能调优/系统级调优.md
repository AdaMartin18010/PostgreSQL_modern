# PostgreSQLç³»ç»Ÿçº§è°ƒä¼˜æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 17+/18+
> **éš¾åº¦ç­‰çº§**: â­â­â­â­ é«˜çº§

---

## ğŸ“‹ ç›®å½•

- [PostgreSQLç³»ç»Ÿçº§è°ƒä¼˜æŒ‡å—](#postgresqlç³»ç»Ÿçº§è°ƒä¼˜æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
  - [2. æ“ä½œç³»ç»Ÿè°ƒä¼˜](#2-æ“ä½œç³»ç»Ÿè°ƒä¼˜)
    - [2.1 å†…æ ¸å‚æ•°](#21-å†…æ ¸å‚æ•°)
    - [2.2 ç³»ç»Ÿé™åˆ¶](#22-ç³»ç»Ÿé™åˆ¶)
  - [3. å†…å­˜è°ƒä¼˜](#3-å†…å­˜è°ƒä¼˜)
    - [3.1 å…±äº«å†…å­˜](#31-å…±äº«å†…å­˜)
    - [3.2 å†…å­˜ç›‘æ§](#32-å†…å­˜ç›‘æ§)
  - [4. I/Oè°ƒä¼˜](#4-ioè°ƒä¼˜)
    - [4.1 I/Oè°ƒåº¦å™¨](#41-ioè°ƒåº¦å™¨)
    - [4.2 é¢„è¯»å‚æ•°](#42-é¢„è¯»å‚æ•°)
  - [5. CPUè°ƒä¼˜](#5-cpuè°ƒä¼˜)
    - [5.1 CPUäº²å’Œæ€§](#51-cpuäº²å’Œæ€§)
    - [5.2 å¹¶è¡ŒæŸ¥è¯¢](#52-å¹¶è¡ŒæŸ¥è¯¢)
  - [ğŸ“š ç›¸å…³æ–‡æ¡£](#-ç›¸å…³æ–‡æ¡£)

---

## 1. æ¦‚è¿°

ç³»ç»Ÿçº§è°ƒä¼˜æ˜¯æ€§èƒ½ä¼˜åŒ–çš„åŸºç¡€ï¼Œæ¶‰åŠæ“ä½œç³»ç»Ÿã€å†…å­˜ã€I/Oã€CPUç­‰ç³»ç»Ÿèµ„æºã€‚

**è°ƒä¼˜ç›®æ ‡**:

- ä¼˜åŒ–ç³»ç»Ÿèµ„æºé…ç½®
- æé«˜ç³»ç»Ÿèµ„æºåˆ©ç”¨ç‡
- å‡å°‘ç³»ç»Ÿèµ„æºç«äº‰

---

## 2. æ“ä½œç³»ç»Ÿè°ƒä¼˜

### 2.1 å†…æ ¸å‚æ•°

```bash
# /etc/sysctl.conf
# å…±äº«å†…å­˜
kernel.shmmax = 68719476736
kernel.shmall = 4294967296

# æ–‡ä»¶æè¿°ç¬¦
fs.file-max = 65536

# ç½‘ç»œå‚æ•°
net.core.somaxconn = 4096
```

### 2.2 ç³»ç»Ÿé™åˆ¶

```bash
# /etc/security/limits.conf
postgres soft nofile 65536
postgres hard nofile 65536
```

---

## 3. å†…å­˜è°ƒä¼˜

### 3.1 å…±äº«å†…å­˜

```sql
-- postgresql.conf
shared_buffers = 8GB          -- å…±äº«ç¼“å†²åŒº
effective_cache_size = 24GB   -- æœ‰æ•ˆç¼“å­˜å¤§å°
work_mem = 256MB             -- å·¥ä½œå†…å­˜
maintenance_work_mem = 2GB   -- ç»´æŠ¤å·¥ä½œå†…å­˜
```

### 3.2 å†…å­˜ç›‘æ§

```sql
-- æŸ¥çœ‹å†…å­˜ä½¿ç”¨
SELECT
    name,
    setting,
    unit
FROM pg_settings
WHERE name LIKE '%memory%' OR name LIKE '%cache%';
```

---

## 4. I/Oè°ƒä¼˜

### 4.1 I/Oè°ƒåº¦å™¨

```bash
# è®¾ç½®I/Oè°ƒåº¦å™¨
echo deadline > /sys/block/sda/queue/scheduler
```

### 4.2 é¢„è¯»å‚æ•°

```sql
-- postgresql.conf
random_page_cost = 1.1       -- éšæœºé¡µé¢ä»£ä»·
effective_io_concurrency = 200  -- æœ‰æ•ˆI/Oå¹¶å‘
```

---

## 5. CPUè°ƒä¼˜

### 5.1 CPUäº²å’Œæ€§

```bash
# è®¾ç½®CPUäº²å’Œæ€§
taskset -cp 0-7 <pid>
```

### 5.2 å¹¶è¡ŒæŸ¥è¯¢

```sql
-- postgresql.conf
max_parallel_workers_per_gather = 4
max_parallel_workers = 8
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [PostgreSQLæ€§èƒ½è°ƒä¼˜å®Œæ•´æŒ‡å—.md](./PostgreSQLæ€§èƒ½è°ƒä¼˜å®Œæ•´æŒ‡å—.md) - æ€§èƒ½è°ƒä¼˜å®Œæ•´æŒ‡å—
- [æ•°æ®åº“çº§è°ƒä¼˜.md](./æ•°æ®åº“çº§è°ƒä¼˜.md) - æ•°æ®åº“çº§è°ƒä¼˜è¯¦è§£
- [30-æ€§èƒ½è°ƒä¼˜/README.md](./README.md) - æ€§èƒ½è°ƒä¼˜ä¸»é¢˜

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
