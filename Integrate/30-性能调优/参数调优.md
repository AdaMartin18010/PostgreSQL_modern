# PostgreSQL参数调优指南

> **创建日期**: 2025年1月
> **技术版本**: PostgreSQL 17+/18+
> **难度等级**: ⭐⭐⭐⭐ 高级

---

## 📋 目录

- [PostgreSQL参数调优指南](#postgresql参数调优指南)
  - [📋 目录](#-目录)
  - [1. 概述](#1-概述)
  - [2. 内存参数](#2-内存参数)
    - [2.1 核心内存参数](#21-核心内存参数)
    - [2.2 内存参数计算](#22-内存参数计算)
  - [3. 连接参数](#3-连接参数)
    - [3.1 连接配置](#31-连接配置)
    - [3.2 连接池建议](#32-连接池建议)
  - [4. 查询参数](#4-查询参数)
    - [4.1 查询优化参数](#41-查询优化参数)
    - [4.2 并行查询参数](#42-并行查询参数)
  - [5. 维护参数](#5-维护参数)
    - [5.1 自动清理参数](#51-自动清理参数)
    - [5.2 检查点参数](#52-检查点参数)
  - [📚 相关文档](#-相关文档)

---

## 1. 概述

参数调优是PostgreSQL性能优化的重要组成部分。

**调优目标**:

- 优化数据库配置参数
- 提高数据库性能
- 优化资源使用

---

## 2. 内存参数

### 2.1 核心内存参数

```sql
-- postgresql.conf
shared_buffers = 8GB          -- 共享缓冲区（25% RAM）
effective_cache_size = 24GB   -- 有效缓存大小（75% RAM）
work_mem = 256MB             -- 工作内存
maintenance_work_mem = 2GB   -- 维护工作内存
```

### 2.2 内存参数计算

```text
shared_buffers = RAM * 0.25
effective_cache_size = RAM * 0.75
work_mem = (RAM - shared_buffers) / (max_connections * 3)
```

---

## 3. 连接参数

### 3.1 连接配置

```sql
-- postgresql.conf
max_connections = 200         -- 最大连接数
superuser_reserved_connections = 3  -- 超级用户保留连接
```

### 3.2 连接池建议

```text
使用PgBouncer连接池
- 减少连接开销
- 提高连接复用
- 降低资源消耗
```

---

## 4. 查询参数

### 4.1 查询优化参数

```sql
-- postgresql.conf
random_page_cost = 1.1       -- 随机页面代价（SSD）
effective_io_concurrency = 200  -- 有效I/O并发
default_statistics_target = 100  -- 默认统计目标
```

### 4.2 并行查询参数

```sql
-- postgresql.conf
max_parallel_workers_per_gather = 4  -- 每个Gather的最大并行工作进程
max_parallel_workers = 8            -- 最大并行工作进程
parallel_tuple_cost = 0.1            -- 并行元组代价
```

---

## 5. 维护参数

### 5.1 自动清理参数

```sql
-- postgresql.conf
autovacuum = on               -- 启用自动清理
autovacuum_max_workers = 3    -- 自动清理最大工作进程
autovacuum_naptime = 1min     -- 自动清理间隔
```

### 5.2 检查点参数

```sql
-- postgresql.conf
checkpoint_timeout = 15min    -- 检查点超时
checkpoint_completion_target = 0.9  -- 检查点完成目标
max_wal_size = 4GB           -- 最大WAL大小
```

---

## 📚 相关文档

- [PostgreSQL性能调优完整指南.md](./PostgreSQL性能调优完整指南.md) - 性能调优完整指南
- [系统级调优.md](./系统级调优.md) - 系统级调优详解
- [30-性能调优/README.md](./README.md) - 性能调优主题

---

**最后更新**: 2025年1月
