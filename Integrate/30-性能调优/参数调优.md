# PostgreSQLå‚æ•°è°ƒä¼˜æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 17+/18+
> **éš¾åº¦ç­‰çº§**: â­â­â­â­ é«˜çº§

---

## ğŸ“‹ ç›®å½•

- [PostgreSQLå‚æ•°è°ƒä¼˜æŒ‡å—](#postgresqlå‚æ•°è°ƒä¼˜æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
  - [2. å†…å­˜å‚æ•°](#2-å†…å­˜å‚æ•°)
    - [2.1 æ ¸å¿ƒå†…å­˜å‚æ•°](#21-æ ¸å¿ƒå†…å­˜å‚æ•°)
    - [2.2 å†…å­˜å‚æ•°è®¡ç®—](#22-å†…å­˜å‚æ•°è®¡ç®—)
  - [3. è¿æ¥å‚æ•°](#3-è¿æ¥å‚æ•°)
    - [3.1 è¿æ¥é…ç½®](#31-è¿æ¥é…ç½®)
    - [3.2 è¿æ¥æ± å»ºè®®](#32-è¿æ¥æ± å»ºè®®)
  - [4. æŸ¥è¯¢å‚æ•°](#4-æŸ¥è¯¢å‚æ•°)
    - [4.1 æŸ¥è¯¢ä¼˜åŒ–å‚æ•°](#41-æŸ¥è¯¢ä¼˜åŒ–å‚æ•°)
    - [4.2 å¹¶è¡ŒæŸ¥è¯¢å‚æ•°](#42-å¹¶è¡ŒæŸ¥è¯¢å‚æ•°)
  - [5. ç»´æŠ¤å‚æ•°](#5-ç»´æŠ¤å‚æ•°)
    - [5.1 è‡ªåŠ¨æ¸…ç†å‚æ•°](#51-è‡ªåŠ¨æ¸…ç†å‚æ•°)
    - [5.2 æ£€æŸ¥ç‚¹å‚æ•°](#52-æ£€æŸ¥ç‚¹å‚æ•°)
  - [6. PostgreSQL 18å‚æ•°ä¼˜åŒ–æ–°ç‰¹æ€§](#6-postgresql-18å‚æ•°ä¼˜åŒ–æ–°ç‰¹æ€§)
    - [6.1 å¼‚æ­¥I/Oå‚æ•°ï¼ˆPostgreSQL 18ï¼‰](#61-å¼‚æ­¥ioå‚æ•°postgresql-18)
    - [6.2 å‚æ•°è°ƒä¼˜å·¥å…·](#62-å‚æ•°è°ƒä¼˜å·¥å…·)
    - [6.3 PostgreSQL 18å¹¶è¡Œå‚æ•°ä¼˜åŒ–å¢å¼º](#63-postgresql-18å¹¶è¡Œå‚æ•°ä¼˜åŒ–å¢å¼º)
      - [6.3.1 å¹¶è¡Œå‚æ•°é…ç½®ä¼˜åŒ–](#631-å¹¶è¡Œå‚æ•°é…ç½®ä¼˜åŒ–)
      - [6.3.2 å¹¶è¡Œå‚æ•°åŠ¨æ€è°ƒæ•´](#632-å¹¶è¡Œå‚æ•°åŠ¨æ€è°ƒæ•´)
  - [7. æœ€ä½³å®è·µ](#7-æœ€ä½³å®è·µ)
    - [âœ… æ¨èåšæ³•](#-æ¨èåšæ³•)
    - [âš ï¸ æ³¨æ„äº‹é¡¹](#ï¸-æ³¨æ„äº‹é¡¹)
  - [ğŸ“š ç›¸å…³æ–‡æ¡£](#-ç›¸å…³æ–‡æ¡£)

---

## 1. æ¦‚è¿°

å‚æ•°è°ƒä¼˜æ˜¯PostgreSQLæ€§èƒ½ä¼˜åŒ–çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚

**è°ƒä¼˜ç›®æ ‡**:

- ä¼˜åŒ–æ•°æ®åº“é…ç½®å‚æ•°
- æé«˜æ•°æ®åº“æ€§èƒ½
- ä¼˜åŒ–èµ„æºä½¿ç”¨

---

## 2. å†…å­˜å‚æ•°

### 2.1 æ ¸å¿ƒå†…å­˜å‚æ•°

**å†…å­˜å‚æ•°è¯¦ç»†è¯´æ˜**ï¼š

```sql
-- PostgreSQLå†…å­˜å‚æ•°é…ç½®ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
DECLARE
    total_mem_gb numeric := 64;  -- ç³»ç»Ÿæ€»å†…å­˜ï¼ˆGBï¼‰
    shared_buffers_gb numeric;
    effective_cache_size_gb numeric;
    work_mem_mb numeric;
    maintenance_work_mem_gb numeric;
    temp_buffers_mb numeric;
    max_connections int;
BEGIN
    RAISE NOTICE '=== PostgreSQLå†…å­˜å‚æ•°é…ç½®æ¨è ===';
    RAISE NOTICE 'ç³»ç»Ÿæ€»å†…å­˜: %GB', total_mem_gb;

    -- è®¡ç®—æ¨èé…ç½®
    shared_buffers_gb := total_mem_gb * 0.25;  -- ç³»ç»Ÿå†…å­˜çš„25%
    effective_cache_size_gb := total_mem_gb * 0.75;  -- ç³»ç»Ÿå†…å­˜çš„75%

    -- è·å–æœ€å¤§è¿æ¥æ•°
    SELECT setting::int INTO max_connections
    FROM pg_settings
    WHERE name = 'max_connections';

    -- è®¡ç®—work_memï¼ˆå‡è®¾ç›®æ ‡ä¸ºæ¯ä¸ªè¿æ¥4MBï¼‰
    work_mem_mb := CEIL((total_mem_gb * 1024 - shared_buffers_gb * 1024) / NULLIF(max_connections, 0) * 0.1);
    IF work_mem_mb > 256 THEN
        work_mem_mb := 256;  -- é™åˆ¶æœ€å¤§256MB
    END IF;

    maintenance_work_mem_gb := total_mem_gb * 0.1;  -- ç³»ç»Ÿå†…å­˜çš„10%
    IF maintenance_work_mem_gb > 2 THEN
        maintenance_work_mem_gb := 2;  -- é™åˆ¶æœ€å¤§2GB
    END IF;

    temp_buffers_mb := 16;  -- ä¸´æ—¶ç¼“å†²åŒºï¼ˆå›ºå®šå€¼ï¼‰

    RAISE NOTICE 'shared_buffers: %GB (ç³»ç»Ÿå†…å­˜çš„25%%)', shared_buffers_gb;
    RAISE NOTICE 'effective_cache_size: %GB (ç³»ç»Ÿå†…å­˜çš„75%%)', effective_cache_size_gb;
    RAISE NOTICE 'work_mem: %MB (æ¯ä¸ªè¿æ¥)', work_mem_mb;
    RAISE NOTICE 'maintenance_work_mem: %GB (ç»´æŠ¤æ“ä½œ)', maintenance_work_mem_gb;
    RAISE NOTICE 'temp_buffers: %MB (ä¸´æ—¶ç¼“å†²åŒº)', temp_buffers_mb;
    RAISE NOTICE '';
    RAISE NOTICE 'é…ç½®ç¤ºä¾‹ï¼ˆpostgresql.confï¼‰:';
    RAISE NOTICE 'shared_buffers = %GB', shared_buffers_gb;
    RAISE NOTICE 'effective_cache_size = %GB', effective_cache_size_gb;
    RAISE NOTICE 'work_mem = %MB', work_mem_mb;
    RAISE NOTICE 'maintenance_work_mem = %GB', maintenance_work_mem_gb;
    RAISE NOTICE 'temp_buffers = %MB', temp_buffers_mb;
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'è®¡ç®—å†…å­˜å‚æ•°å¤±è´¥: %', SQLERRM;
END $$;
```

**å†…å­˜å‚æ•°è¯´æ˜**ï¼š

| å‚æ•° | è¯´æ˜ | æ¨èå€¼ | å½±å“ | PostgreSQL 18ä¼˜åŒ– |
| --- | --- | --- | --- | --- |
| `shared_buffers` | å…±äº«ç¼“å†²åŒºå¤§å° | ç³»ç»Ÿå†…å­˜çš„25% | å½±å“ç¼“å­˜å‘½ä¸­ç‡ | å¼‚æ­¥I/Oå‡å°‘ç¼“å†²åŒºéœ€æ±‚ |
| `effective_cache_size` | æœ‰æ•ˆç¼“å­˜å¤§å° | ç³»ç»Ÿå†…å­˜çš„50-75% | å½±å“æŸ¥è¯¢ä¼˜åŒ–å™¨å†³ç­– | è€ƒè™‘æ“ä½œç³»ç»Ÿç¼“å­˜ |
| `work_mem` | å·¥ä½œå†…å­˜ | æ ¹æ®è¿æ¥æ•°è®¡ç®— | å½±å“æ’åºã€å“ˆå¸Œæ“ä½œ | å¼‚æ­¥I/Oå‡å°‘å†…å­˜éœ€æ±‚ |
| `maintenance_work_mem` | ç»´æŠ¤å·¥ä½œå†…å­˜ | ç³»ç»Ÿå†…å­˜çš„10% | å½±å“VACUUMã€CREATE INDEX | å¼‚æ­¥I/Oæå‡ç»´æŠ¤æ€§èƒ½ |
| `temp_buffers` | ä¸´æ—¶ç¼“å†²åŒº | 16MB | å½±å“ä¸´æ—¶è¡¨æ“ä½œ | ä¿æŒä¸å˜ |

### 2.2 å†…å­˜å‚æ•°è®¡ç®—

**å†…å­˜å‚æ•°è®¡ç®—å…¬å¼**ï¼š

```sql
-- å†…å­˜å‚æ•°è‡ªåŠ¨è®¡ç®—å·¥å…·ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
DECLARE
    total_mem_gb numeric;
    max_connections int;
    shared_buffers_gb numeric;
    effective_cache_size_gb numeric;
    work_mem_mb numeric;
    maintenance_work_mem_gb numeric;
    total_work_mem_gb numeric;
    total_memory_usage_gb numeric;
    memory_warning_threshold numeric := 0.9;  -- 90%è­¦å‘Šé˜ˆå€¼
BEGIN
    -- å‡è®¾ç³»ç»Ÿæ€»å†…å­˜ï¼ˆå®é™…åº”ä»ç³»ç»Ÿè·å–ï¼‰
    total_mem_gb := 64;

    -- è·å–æœ€å¤§è¿æ¥æ•°
    SELECT setting::int INTO max_connections
    FROM pg_settings
    WHERE name = 'max_connections';

    RAISE NOTICE '=== å†…å­˜å‚æ•°è‡ªåŠ¨è®¡ç®— ===';
    RAISE NOTICE 'ç³»ç»Ÿæ€»å†…å­˜: %GB', total_mem_gb;
    RAISE NOTICE 'æœ€å¤§è¿æ¥æ•°: %', max_connections;

    -- è®¡ç®—å†…å­˜å‚æ•°
    shared_buffers_gb := total_mem_gb * 0.25;
    effective_cache_size_gb := total_mem_gb * 0.75;
    work_mem_mb := CEIL((total_mem_gb * 1024 - shared_buffers_gb * 1024) / NULLIF(max_connections, 0) * 0.1);
    IF work_mem_mb > 256 THEN
        work_mem_mb := 256;
    END IF;
    maintenance_work_mem_gb := LEAST(total_mem_gb * 0.1, 2);

    -- è®¡ç®—æ€»å†…å­˜ä½¿ç”¨
    total_work_mem_gb := (work_mem_mb::numeric / 1024) * max_connections;
    total_memory_usage_gb := shared_buffers_gb + total_work_mem_gb + maintenance_work_mem_gb;

    RAISE NOTICE '';
    RAISE NOTICE 'è®¡ç®—çš„å†…å­˜å‚æ•°:';
    RAISE NOTICE 'shared_buffers: %GB', shared_buffers_gb;
    RAISE NOTICE 'effective_cache_size: %GB', effective_cache_size_gb;
    RAISE NOTICE 'work_mem: %MB (æ¯ä¸ªè¿æ¥)', work_mem_mb;
    RAISE NOTICE 'maintenance_work_mem: %GB', maintenance_work_mem_gb;
    RAISE NOTICE '';
    RAISE NOTICE 'æ€»å†…å­˜ä½¿ç”¨ä¼°ç®—:';
    RAISE NOTICE 'shared_buffers: %GB', shared_buffers_gb;
    RAISE NOTICE 'work_memæ€»è®¡: %GB (%ä¸ªè¿æ¥ Ã— %MB)', total_work_mem_gb, max_connections, work_mem_mb;
    RAISE NOTICE 'maintenance_work_mem: %GB', maintenance_work_mem_gb;
    RAISE NOTICE 'æ€»å†…å­˜ä½¿ç”¨: %GB / %GB (%%%)',
        total_memory_usage_gb,
        total_mem_gb,
        ROUND(100.0 * total_memory_usage_gb / NULLIF(total_mem_gb, 0), 2);

    -- æ£€æŸ¥å†…å­˜ä½¿ç”¨
    IF total_memory_usage_gb / NULLIF(total_mem_gb, 0) > memory_warning_threshold THEN
        RAISE WARNING 'å†…å­˜ä½¿ç”¨è¶…è¿‡%%ï¼Œå»ºè®®å‡å°‘max_connectionsæˆ–work_mem',
            memory_warning_threshold * 100;
    ELSE
        RAISE NOTICE 'å†…å­˜ä½¿ç”¨æ­£å¸¸';
    END IF;
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'å†…å­˜å‚æ•°è®¡ç®—å¤±è´¥: %', SQLERRM;
END $$;
```

---

## 3. è¿æ¥å‚æ•°

### 3.1 è¿æ¥é…ç½®

**è¿æ¥å‚æ•°è¯¦ç»†é…ç½®**ï¼š

```sql
-- PostgreSQLè¿æ¥å‚æ•°é…ç½®ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
DECLARE
    total_mem_gb numeric := 64;  -- ç³»ç»Ÿæ€»å†…å­˜ï¼ˆGBï¼‰
    max_connections int;
    superuser_reserved_connections int;
    work_mem_mb numeric;
    shared_buffers_gb numeric;
    total_work_mem_gb numeric;
    memory_per_connection_mb numeric;
BEGIN
    RAISE NOTICE '=== PostgreSQLè¿æ¥å‚æ•°é…ç½®æ¨è ===';
    RAISE NOTICE 'ç³»ç»Ÿæ€»å†…å­˜: %GB', total_mem_gb;

    -- è®¡ç®—æœ€å¤§è¿æ¥æ•°ï¼ˆæ¯GBå†…å­˜çº¦3-5ä¸ªè¿æ¥ï¼‰
    max_connections := LEAST(total_mem_gb::int * 3, 500);
    superuser_reserved_connections := 3;

    -- è®¡ç®—shared_buffers
    shared_buffers_gb := total_mem_gb * 0.25;

    -- è®¡ç®—work_memï¼ˆå‡è®¾æ¯ä¸ªè¿æ¥éœ€è¦4MBï¼‰
    work_mem_mb := CEIL((total_mem_gb * 1024 - shared_buffers_gb * 1024) / NULLIF(max_connections, 0) * 0.1);
    IF work_mem_mb > 256 THEN
        work_mem_mb := 256;  -- é™åˆ¶æœ€å¤§256MB
    END IF;

    -- è®¡ç®—æ€»work_mem
    total_work_mem_gb := (work_mem_mb::numeric / 1024) * max_connections;
    memory_per_connection_mb := work_mem_mb;

    RAISE NOTICE 'max_connections: % (å»ºè®®å€¼)', max_connections;
    RAISE NOTICE 'superuser_reserved_connections: %', superuser_reserved_connections;
    RAISE NOTICE 'work_mem: %MB (æ¯ä¸ªè¿æ¥)', work_mem_mb;
    RAISE NOTICE 'æ€»work_mem: %GB (%ä¸ªè¿æ¥)', total_work_mem_gb, max_connections;
    RAISE NOTICE 'æ¯ä¸ªè¿æ¥å†…å­˜: %MB', memory_per_connection_mb;
    RAISE NOTICE '';
    RAISE NOTICE 'é…ç½®ç¤ºä¾‹ï¼ˆpostgresql.confï¼‰:';
    RAISE NOTICE 'max_connections = %', max_connections;
    RAISE NOTICE 'superuser_reserved_connections = %', superuser_reserved_connections;
    RAISE NOTICE 'work_mem = %MB', work_mem_mb;
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'è®¡ç®—è¿æ¥å‚æ•°å¤±è´¥: %', SQLERRM;
END $$;
```

**è¿æ¥å‚æ•°è¯´æ˜**ï¼š

| å‚æ•° | è¯´æ˜ | æ¨èå€¼ | è®¡ç®—å…¬å¼ | æ³¨æ„äº‹é¡¹ |
| --- | --- | --- | --- | --- |
| `max_connections` | æœ€å¤§è¿æ¥æ•° | ç³»ç»Ÿå†…å­˜(GB) Ã— 3-5 | `RAM_GB * 3` | ä¸è¦è®¾ç½®è¿‡å¤§ï¼Œå½±å“æ€§èƒ½ |
| `superuser_reserved_connections` | è¶…çº§ç”¨æˆ·ä¿ç•™è¿æ¥ | 3 | å›ºå®šå€¼ | ç¡®ä¿ç®¡ç†å‘˜å¯ä»¥è¿æ¥ |
| `work_mem` | å·¥ä½œå†…å­˜ | æ ¹æ®è¿æ¥æ•°è®¡ç®— | `(RAM - shared_buffers) / (max_connections * 3)` | æ¯ä¸ªè¿æ¥éƒ½ä¼šä½¿ç”¨ |

### 3.2 è¿æ¥æ± å»ºè®®

**è¿æ¥æ± é…ç½®å»ºè®®**ï¼š

```ini
# PgBouncerè¿æ¥æ± é…ç½®ï¼ˆ/etc/pgbouncer/pgbouncer.iniï¼‰
[databases]
mydb = host=localhost port=5432 dbname=mydb

[pgbouncer]
# è¿æ¥æ± æ¨¡å¼
pool_mode = transaction          # äº‹åŠ¡çº§è¿æ¥æ± ï¼ˆæ¨èï¼‰

# è¿æ¥æ•°é…ç½®
max_client_conn = 1000           # æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°
default_pool_size = 25           # é»˜è®¤è¿æ¥æ± å¤§å°
min_pool_size = 5                # æœ€å°è¿æ¥æ± å¤§å°
reserve_pool_size = 5            # ä¿ç•™è¿æ¥æ± å¤§å°
reserve_pool_timeout = 3         # ä¿ç•™è¿æ¥æ± è¶…æ—¶ï¼ˆç§’ï¼‰

# æ•°æ®åº“è¿æ¥é™åˆ¶
max_db_connections = 100         # æ¯ä¸ªæ•°æ®åº“æœ€å¤§è¿æ¥æ•°
max_user_connections = 50         # æ¯ä¸ªç”¨æˆ·æœ€å¤§è¿æ¥æ•°

# ç»Ÿè®¡å’Œæ—¥å¿—
stats_period = 60                # ç»Ÿè®¡å‘¨æœŸï¼ˆç§’ï¼‰
log_connections = 1              # è®°å½•è¿æ¥
log_disconnections = 1           # è®°å½•æ–­å¼€è¿æ¥
log_pooler_errors = 1            # è®°å½•è¿æ¥æ± é”™è¯¯
```

**è¿æ¥æ± æ¨¡å¼å¯¹æ¯”**ï¼š

| æ¨¡å¼ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ | æ€§èƒ½ç‰¹ç‚¹ |
| --- | --- | --- | --- |
| `session` | ä¼šè¯çº§è¿æ¥æ±  | éœ€è¦ä¿æŒä¼šè¯çŠ¶æ€çš„åº”ç”¨ | æ€§èƒ½ä¸­ç­‰ |
| `transaction` | äº‹åŠ¡çº§è¿æ¥æ±  | å¤§å¤šæ•°Webåº”ç”¨ï¼ˆæ¨èï¼‰ | æ€§èƒ½æœ€å¥½ |
| `statement` | è¯­å¥çº§è¿æ¥æ±  | ç®€å•æŸ¥è¯¢åº”ç”¨ | æ€§èƒ½æœ€å¥½ä½†é™åˆ¶å¤š |

---

## 4. æŸ¥è¯¢å‚æ•°

### 4.1 æŸ¥è¯¢ä¼˜åŒ–å‚æ•°

**æŸ¥è¯¢ä¼˜åŒ–å‚æ•°è¯¦ç»†é…ç½®**ï¼š

```sql
-- PostgreSQLæŸ¥è¯¢ä¼˜åŒ–å‚æ•°é…ç½®ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
DECLARE
    storage_type text := 'SSD';  -- å­˜å‚¨ç±»å‹ï¼ˆSSD/NVMe/HDDï¼‰
    random_page_cost numeric;
    effective_io_concurrency int;
    maintenance_io_concurrency int;
    default_statistics_target int;
BEGIN
    RAISE NOTICE '=== PostgreSQLæŸ¥è¯¢ä¼˜åŒ–å‚æ•°é…ç½®æ¨è ===';
    RAISE NOTICE 'å­˜å‚¨ç±»å‹: %', storage_type;

    -- æ ¹æ®å­˜å‚¨ç±»å‹è®¾ç½®å‚æ•°
    IF storage_type = 'SSD' OR storage_type = 'NVMe' THEN
        random_page_cost := 1.1;
        effective_io_concurrency := 200;  -- PostgreSQL 18æ¨èå€¼
        maintenance_io_concurrency := 200;  -- PostgreSQL 18æ–°å¢
        RAISE NOTICE 'SSD/NVMeé…ç½®:';
    ELSIF storage_type = 'HDD' THEN
        random_page_cost := 4.0;
        effective_io_concurrency := 2;
        maintenance_io_concurrency := 10;
        RAISE NOTICE 'HDDé…ç½®:';
    ELSE
        random_page_cost := 2.0;
        effective_io_concurrency := 100;
        maintenance_io_concurrency := 50;
        RAISE NOTICE 'é»˜è®¤é…ç½®:';
    END IF;

    default_statistics_target := 100;  -- é»˜è®¤ç»Ÿè®¡ç›®æ ‡

    RAISE NOTICE 'random_page_cost: %', random_page_cost;
    RAISE NOTICE 'effective_io_concurrency: % (PostgreSQL 18å¼‚æ­¥I/O)', effective_io_concurrency;
    RAISE NOTICE 'maintenance_io_concurrency: % (PostgreSQL 18æ–°å¢)', maintenance_io_concurrency;
    RAISE NOTICE 'default_statistics_target: %', default_statistics_target;
    RAISE NOTICE '';
    RAISE NOTICE 'é…ç½®ç¤ºä¾‹ï¼ˆpostgresql.confï¼‰:';
    RAISE NOTICE 'random_page_cost = %', random_page_cost;
    RAISE NOTICE 'effective_io_concurrency = %', effective_io_concurrency;
    RAISE NOTICE 'maintenance_io_concurrency = %', maintenance_io_concurrency;
    RAISE NOTICE 'default_statistics_target = %', default_statistics_target;
    RAISE NOTICE 'seq_page_cost = 1.0';
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'è®¡ç®—æŸ¥è¯¢ä¼˜åŒ–å‚æ•°å¤±è´¥: %', SQLERRM;
END $$;
```

**æŸ¥è¯¢ä¼˜åŒ–å‚æ•°è¯´æ˜**ï¼š

| å‚æ•° | è¯´æ˜ | SSDæ¨èå€¼ | HDDæ¨èå€¼ | PostgreSQL 18ä¼˜åŒ– |
| --- | --- | --- | --- | --- |
| `random_page_cost` | éšæœºé¡µé¢è®¿é—®ä»£ä»· | 1.1 | 4.0 | å¼‚æ­¥I/Oé™ä½å®é™…ä»£ä»· |
| `seq_page_cost` | é¡ºåºé¡µé¢è®¿é—®ä»£ä»· | 1.0 | 1.0 | ä¿æŒä¸å˜ |
| `effective_io_concurrency` | æœ‰æ•ˆI/Oå¹¶å‘æ•° | 200-300 | 2-4 | **PostgreSQL 18å¼‚æ­¥I/Oæ ¸å¿ƒå‚æ•°** |
| `maintenance_io_concurrency` | ç»´æŠ¤I/Oå¹¶å‘æ•° | 200 | 10 | **PostgreSQL 18æ–°å¢** |
| `default_statistics_target` | é»˜è®¤ç»Ÿè®¡ç›®æ ‡ | 100 | 100 | ä¿æŒä¸å˜ |

### 4.2 å¹¶è¡ŒæŸ¥è¯¢å‚æ•°

**å¹¶è¡ŒæŸ¥è¯¢å‚æ•°è¯¦ç»†é…ç½®**ï¼š

```sql
-- PostgreSQLå¹¶è¡ŒæŸ¥è¯¢å‚æ•°é…ç½®ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
DECLARE
    cpu_cores int := 8;  -- CPUæ ¸å¿ƒæ•°
    max_parallel_workers_per_gather int;
    max_parallel_workers int;
    max_worker_processes int;
    parallel_tuple_cost numeric;
    parallel_setup_cost numeric;
BEGIN
    RAISE NOTICE '=== PostgreSQLå¹¶è¡ŒæŸ¥è¯¢å‚æ•°é…ç½®æ¨è ===';
    RAISE NOTICE 'CPUæ ¸å¿ƒæ•°: %', cpu_cores;

    -- è®¡ç®—æ¨èé…ç½®
    max_parallel_workers_per_gather := LEAST(cpu_cores / 2, 4);  -- æ¯ä¸ªæŸ¥è¯¢æœ€å¤š4ä¸ªå¹¶è¡Œworker
    max_parallel_workers := cpu_cores;  -- æ€»å¹¶è¡Œworkeræ•°
    max_worker_processes := cpu_cores * 2;  -- æ€»workerè¿›ç¨‹æ•°ï¼ˆåŒ…æ‹¬å¹¶è¡Œå’Œå…¶ä»–ï¼‰
    parallel_tuple_cost := 0.1;  -- å¹¶è¡Œå…ƒç»„å¤„ç†ä»£ä»·
    parallel_setup_cost := 1000.0;  -- å¹¶è¡Œè®¾ç½®ä»£ä»·

    RAISE NOTICE 'max_parallel_workers_per_gather: % (æ¯ä¸ªæŸ¥è¯¢)', max_parallel_workers_per_gather;
    RAISE NOTICE 'max_parallel_workers: % (æ€»å¹¶è¡Œworker)', max_parallel_workers;
    RAISE NOTICE 'max_worker_processes: % (æ€»workerè¿›ç¨‹)', max_worker_processes;
    RAISE NOTICE 'parallel_tuple_cost: %', parallel_tuple_cost;
    RAISE NOTICE 'parallel_setup_cost: %', parallel_setup_cost;
    RAISE NOTICE '';
    RAISE NOTICE 'é…ç½®ç¤ºä¾‹ï¼ˆpostgresql.confï¼‰:';
    RAISE NOTICE 'max_parallel_workers_per_gather = %', max_parallel_workers_per_gather;
    RAISE NOTICE 'max_parallel_workers = %', max_parallel_workers;
    RAISE NOTICE 'max_worker_processes = %', max_worker_processes;
    RAISE NOTICE 'parallel_tuple_cost = %', parallel_tuple_cost;
    RAISE NOTICE 'parallel_setup_cost = %', parallel_setup_cost;
    RAISE NOTICE 'min_parallel_table_scan_size = 8MB';
    RAISE NOTICE 'min_parallel_index_scan_size = 512KB';
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'è®¡ç®—å¹¶è¡ŒæŸ¥è¯¢å‚æ•°å¤±è´¥: %', SQLERRM;
END $$;
```

**å¹¶è¡ŒæŸ¥è¯¢å‚æ•°è¯´æ˜**ï¼š

| å‚æ•° | è¯´æ˜ | æ¨èå€¼ | å½±å“ |
| --- | --- | --- | --- |
| `max_parallel_workers_per_gather` | æ¯ä¸ªæŸ¥è¯¢çš„æœ€å¤§å¹¶è¡Œworkeræ•° | CPUæ ¸å¿ƒæ•°/2ï¼Œæœ€å¤§4 | å½±å“å¹¶è¡ŒæŸ¥è¯¢æ€§èƒ½ |
| `max_parallel_workers` | ç³»ç»Ÿæœ€å¤§å¹¶è¡Œworkeræ•° | CPUæ ¸å¿ƒæ•° | é™åˆ¶æ€»å¹¶è¡Œworkeræ•° |
| `max_worker_processes` | ç³»ç»Ÿæœ€å¤§workerè¿›ç¨‹æ•° | CPUæ ¸å¿ƒæ•°*2 | é™åˆ¶æ€»workerè¿›ç¨‹æ•° |
| `parallel_tuple_cost` | å¹¶è¡Œå…ƒç»„å¤„ç†ä»£ä»· | 0.1 | å½±å“å¹¶è¡ŒæŸ¥è¯¢é€‰æ‹© |
| `parallel_setup_cost` | å¹¶è¡Œè®¾ç½®ä»£ä»· | 1000.0 | å½±å“å¹¶è¡ŒæŸ¥è¯¢é€‰æ‹© |
| `min_parallel_table_scan_size` | å¯ç”¨å¹¶è¡Œæ‰«æçš„æœ€å°è¡¨å¤§å° | 8MB | æ§åˆ¶å¹¶è¡Œæ‰«æè§¦å‘ |
| `min_parallel_index_scan_size` | å¯ç”¨å¹¶è¡Œç´¢å¼•æ‰«æçš„æœ€å°ç´¢å¼•å¤§å° | 512KB | æ§åˆ¶å¹¶è¡Œç´¢å¼•æ‰«æè§¦å‘ |

---

## 5. ç»´æŠ¤å‚æ•°

### 5.1 è‡ªåŠ¨æ¸…ç†å‚æ•°

**è‡ªåŠ¨æ¸…ç†å‚æ•°è¯¦ç»†é…ç½®**ï¼š

```sql
-- PostgreSQLè‡ªåŠ¨æ¸…ç†å‚æ•°é…ç½®ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
DECLARE
    cpu_cores int := 8;  -- CPUæ ¸å¿ƒæ•°
    autovacuum_max_workers int;
    autovacuum_naptime_sec int;
    autovacuum_vacuum_cost_delay_ms int;
    autovacuum_vacuum_cost_limit int;
    autovacuum_analyze_scale_factor numeric;
    autovacuum_analyze_threshold int;
BEGIN
    RAISE NOTICE '=== PostgreSQLè‡ªåŠ¨æ¸…ç†å‚æ•°é…ç½®æ¨è ===';
    RAISE NOTICE 'CPUæ ¸å¿ƒæ•°: %', cpu_cores;

    -- è®¡ç®—æ¨èé…ç½®
    autovacuum_max_workers := LEAST(cpu_cores / 2, 3);  -- CPUæ ¸å¿ƒæ•°çš„ä¸€åŠï¼Œæœ€å¤§3
    autovacuum_naptime_sec := 60;  -- 1åˆ†é’Ÿ
    autovacuum_vacuum_cost_delay_ms := 2;  -- 2æ¯«ç§’
    autovacuum_vacuum_cost_limit := 200;  -- 200
    autovacuum_analyze_scale_factor := 0.05;  -- 5%ï¼ˆæ›´é¢‘ç¹åˆ†æï¼‰
    autovacuum_analyze_threshold := 50;  -- 50è¡Œ

    RAISE NOTICE 'autovacuum_max_workers: %', autovacuum_max_workers;
    RAISE NOTICE 'autovacuum_naptime: %ç§’', autovacuum_naptime_sec;
    RAISE NOTICE 'autovacuum_vacuum_cost_delay: %ms', autovacuum_vacuum_cost_delay_ms;
    RAISE NOTICE 'autovacuum_vacuum_cost_limit: %', autovacuum_vacuum_cost_limit;
    RAISE NOTICE 'autovacuum_analyze_scale_factor: %', autovacuum_analyze_scale_factor;
    RAISE NOTICE 'autovacuum_analyze_threshold: %', autovacuum_analyze_threshold;
    RAISE NOTICE '';
    RAISE NOTICE 'é…ç½®ç¤ºä¾‹ï¼ˆpostgresql.confï¼‰:';
    RAISE NOTICE 'autovacuum = on';
    RAISE NOTICE 'autovacuum_max_workers = %', autovacuum_max_workers;
    RAISE NOTICE 'autovacuum_naptime = %s', autovacuum_naptime_sec;
    RAISE NOTICE 'autovacuum_vacuum_cost_delay = %ms', autovacuum_vacuum_cost_delay_ms;
    RAISE NOTICE 'autovacuum_vacuum_cost_limit = %', autovacuum_vacuum_cost_limit;
    RAISE NOTICE 'autovacuum_analyze_scale_factor = %', autovacuum_analyze_scale_factor;
    RAISE NOTICE 'autovacuum_analyze_threshold = %', autovacuum_analyze_threshold;
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'è®¡ç®—è‡ªåŠ¨æ¸…ç†å‚æ•°å¤±è´¥: %', SQLERRM;
END $$;
```

**è‡ªåŠ¨æ¸…ç†å‚æ•°è¯´æ˜**ï¼š

| å‚æ•° | è¯´æ˜ | æ¨èå€¼ | PostgreSQL 18ä¼˜åŒ– |
| --- | --- | --- | --- |
| `autovacuum` | å¯ç”¨è‡ªåŠ¨æ¸…ç† | on | å¿…é¡»å¯ç”¨ |
| `autovacuum_max_workers` | è‡ªåŠ¨æ¸…ç†æœ€å¤§å·¥ä½œè¿›ç¨‹ | CPUæ ¸å¿ƒæ•°/2ï¼Œæœ€å¤§3 | å¼‚æ­¥I/Oæå‡æ¸…ç†æ€§èƒ½ |
| `autovacuum_naptime` | è‡ªåŠ¨æ¸…ç†é—´éš” | 1åˆ†é’Ÿ | æ ¹æ®è´Ÿè½½è°ƒæ•´ |
| `autovacuum_vacuum_cost_delay` | æ¸…ç†æˆæœ¬å»¶è¿Ÿ | 2ms | æ§åˆ¶æ¸…ç†I/Oè´Ÿè½½ |
| `autovacuum_vacuum_cost_limit` | æ¸…ç†æˆæœ¬é™åˆ¶ | 200 | æ§åˆ¶æ¸…ç†é€Ÿåº¦ |
| `autovacuum_analyze_scale_factor` | è‡ªåŠ¨åˆ†ææ¯”ä¾‹å› å­ | 0.05 | æ›´é¢‘ç¹åˆ†æ |
| `autovacuum_analyze_threshold` | è‡ªåŠ¨åˆ†æé˜ˆå€¼ | 50 | æ ¹æ®è¡¨å¤§å°è°ƒæ•´ |

### 5.2 æ£€æŸ¥ç‚¹å‚æ•°

**æ£€æŸ¥ç‚¹å‚æ•°è¯¦ç»†é…ç½®**ï¼š

```sql
-- PostgreSQLæ£€æŸ¥ç‚¹å‚æ•°é…ç½®ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
DECLARE
    total_mem_gb numeric := 64;  -- ç³»ç»Ÿæ€»å†…å­˜ï¼ˆGBï¼‰
    checkpoint_timeout_min int;
    checkpoint_completion_target numeric;
    max_wal_size_gb numeric;
    min_wal_size_gb numeric;
    wal_buffers_mb int;
BEGIN
    RAISE NOTICE '=== PostgreSQLæ£€æŸ¥ç‚¹å‚æ•°é…ç½®æ¨è ===';
    RAISE NOTICE 'ç³»ç»Ÿæ€»å†…å­˜: %GB', total_mem_gb;

    -- è®¡ç®—æ¨èé…ç½®
    checkpoint_timeout_min := 15;  -- 15åˆ†é’Ÿ
    checkpoint_completion_target := 0.9;  -- 90%å®Œæˆç›®æ ‡
    max_wal_size_gb := total_mem_gb * 0.1;  -- ç³»ç»Ÿå†…å­˜çš„10%
    IF max_wal_size_gb > 4 THEN
        max_wal_size_gb := 4;  -- é™åˆ¶æœ€å¤§4GB
    END IF;
    min_wal_size_gb := max_wal_size_gb * 0.25;  -- max_wal_sizeçš„25%
    wal_buffers_mb := LEAST(CEIL(total_mem_gb * 1024 * 0.01), 16);  -- ç³»ç»Ÿå†…å­˜çš„1%ï¼Œæœ€å¤§16MB

    RAISE NOTICE 'checkpoint_timeout: %åˆ†é’Ÿ', checkpoint_timeout_min;
    RAISE NOTICE 'checkpoint_completion_target: %', checkpoint_completion_target;
    RAISE NOTICE 'max_wal_size: %GB', max_wal_size_gb;
    RAISE NOTICE 'min_wal_size: %GB', min_wal_size_gb;
    RAISE NOTICE 'wal_buffers: %MB', wal_buffers_mb;
    RAISE NOTICE '';
    RAISE NOTICE 'é…ç½®ç¤ºä¾‹ï¼ˆpostgresql.confï¼‰:';
    RAISE NOTICE 'checkpoint_timeout = %min', checkpoint_timeout_min;
    RAISE NOTICE 'checkpoint_completion_target = %', checkpoint_completion_target;
    RAISE NOTICE 'max_wal_size = %GB', max_wal_size_gb;
    RAISE NOTICE 'min_wal_size = %GB', min_wal_size_gb;
    RAISE NOTICE 'wal_buffers = %MB', wal_buffers_mb;
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'è®¡ç®—æ£€æŸ¥ç‚¹å‚æ•°å¤±è´¥: %', SQLERRM;
END $$;
```

**æ£€æŸ¥ç‚¹å‚æ•°è¯´æ˜**ï¼š

| å‚æ•° | è¯´æ˜ | æ¨èå€¼ | PostgreSQL 18ä¼˜åŒ– |
| --- | --- | --- | --- |
| `checkpoint_timeout` | æ£€æŸ¥ç‚¹è¶…æ—¶æ—¶é—´ | 15åˆ†é’Ÿ | å¼‚æ­¥I/Oæå‡æ£€æŸ¥ç‚¹æ€§èƒ½ |
| `checkpoint_completion_target` | æ£€æŸ¥ç‚¹å®Œæˆç›®æ ‡ | 0.9 | æ§åˆ¶æ£€æŸ¥ç‚¹å†™å…¥é€Ÿåº¦ |
| `max_wal_size` | æœ€å¤§WALå¤§å° | ç³»ç»Ÿå†…å­˜çš„10% | è¶…è¿‡æ­¤å€¼ä¼šå¼ºåˆ¶æ£€æŸ¥ç‚¹ |
| `min_wal_size` | æœ€å°WALå¤§å° | max_wal_sizeçš„25% | WALæ–‡ä»¶æœ€å°ä¿ç•™å¤§å° |
| `wal_buffers` | WALç¼“å†²åŒºå¤§å° | ç³»ç»Ÿå†…å­˜çš„1%ï¼Œæœ€å¤§16MB | å¼‚æ­¥I/Oå‡å°‘ç¼“å†²åŒºéœ€æ±‚ |

## 6. PostgreSQL 18å‚æ•°ä¼˜åŒ–æ–°ç‰¹æ€§

### 6.1 å¼‚æ­¥I/Oå‚æ•°ï¼ˆPostgreSQL 18ï¼‰

PostgreSQL 18æ–°å¢å¼‚æ­¥I/Oç›¸å…³å‚æ•°ï¼š

```ini
# postgresql.conf (PostgreSQL 18)
# å¼‚æ­¥I/Oé…ç½®ï¼ˆPostgreSQL 18æ–°ç‰¹æ€§ï¼‰
effective_io_concurrency = 200        # æŸ¥è¯¢å¼‚æ­¥I/Oå¹¶å‘æ•°ï¼ˆSSDæ¨èï¼š200-300ï¼‰
maintenance_io_concurrency = 200      # ç»´æŠ¤æ“ä½œå¼‚æ­¥I/Oå¹¶å‘æ•°ï¼ˆPostgreSQL 18æ–°å¢ï¼‰

# æ€§èƒ½æå‡
# - I/Oæ€§èƒ½æå‡2-3å€
# - æ£€æŸ¥ç‚¹æ€§èƒ½æå‡2-3å€
# - WALå†™å…¥æ€§èƒ½æå‡2-3å€
# - è‡ªåŠ¨æ¸…ç†æ€§èƒ½æå‡2-3å€
```

### 6.2 å‚æ•°è°ƒä¼˜å·¥å…·

**å‚æ•°è°ƒä¼˜è¾…åŠ©å·¥å…·**ï¼š

```sql
-- æŸ¥çœ‹å½“å‰å‚æ•°é…ç½®ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
DECLARE
    param_record RECORD;
    param_categories text[] := ARRAY['memory', 'connection', 'query', 'maintenance', 'checkpoint', 'io'];
    category text;
BEGIN
    RAISE NOTICE '=== PostgreSQLå‚æ•°é…ç½®æŸ¥çœ‹ ===';

    FOREACH category IN ARRAY param_categories
    LOOP
        RAISE NOTICE '';
        RAISE NOTICE '=== %å‚æ•° ===', category;
        FOR param_record IN
            SELECT name, setting, unit, source, context
            FROM pg_settings
            WHERE name LIKE '%' || category || '%'
            OR (category = 'memory' AND (name LIKE '%buffer%' OR name LIKE '%cache%' OR name LIKE '%mem%'))
            OR (category = 'connection' AND name LIKE '%connection%')
            OR (category = 'query' AND (name LIKE '%cost%' OR name LIKE '%statistics%' OR name LIKE '%parallel%'))
            OR (category = 'maintenance' AND name LIKE '%vacuum%')
            OR (category = 'checkpoint' AND name LIKE '%checkpoint%')
            OR (category = 'io' AND (name LIKE '%io%' OR name LIKE '%wal%'))
            ORDER BY name
            LIMIT 20
        LOOP
            RAISE NOTICE 'å‚æ•°: % = % % (æ¥æº: % | ä¸Šä¸‹æ–‡: %)',
                param_record.name,
                param_record.setting,
                COALESCE(param_record.unit, ''),
                param_record.source,
                param_record.context;
        END LOOP;
    END LOOP;
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'æŸ¥çœ‹å‚æ•°é…ç½®å¤±è´¥: %', SQLERRM;
END $$;
```

### 6.3 PostgreSQL 18å¹¶è¡Œå‚æ•°ä¼˜åŒ–å¢å¼º

**PostgreSQL 18** æ˜¾è‘—å¢å¼ºäº†å¹¶è¡ŒæŸ¥è¯¢å‚æ•°é…ç½®ï¼Œæ”¯æŒæ›´ç²¾ç»†çš„å¹¶è¡Œæ§åˆ¶å’Œæ€§èƒ½ä¼˜åŒ–ã€‚

#### 6.3.1 å¹¶è¡Œå‚æ•°é…ç½®ä¼˜åŒ–

```sql
-- PostgreSQL 18 å¹¶è¡Œå‚æ•°é…ç½®ä¼˜åŒ–ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
DECLARE
    cpu_cores int;
    total_mem_gb numeric;
    max_parallel_workers int;
    max_parallel_workers_per_gather int;
    max_parallel_maintenance_workers int;
BEGIN
    BEGIN
        -- è·å–CPUæ ¸å¿ƒæ•°
        SELECT setting::int INTO cpu_cores
        FROM pg_settings
        WHERE name = 'max_worker_processes';

        -- è·å–ç³»ç»Ÿå†…å­˜ï¼ˆå‡è®¾64GBï¼‰
        total_mem_gb := 64;

        -- è®¡ç®—å¹¶è¡Œå‚æ•°
        max_parallel_workers := LEAST(cpu_cores, 8);  -- æœ€å¤§8ä¸ªå¹¶è¡Œworker
        max_parallel_workers_per_gather := LEAST(cpu_cores / 2, 4);  -- æ¯ä¸ªæŸ¥è¯¢æœ€å¤š4ä¸ª
        max_parallel_maintenance_workers := LEAST(cpu_cores / 4, 4);  -- ç»´æŠ¤æ“ä½œæœ€å¤š4ä¸ª

        RAISE NOTICE '=== PostgreSQL 18å¹¶è¡Œå‚æ•°é…ç½®æ¨è ===';
        RAISE NOTICE 'CPUæ ¸å¿ƒæ•°: %', cpu_cores;
        RAISE NOTICE 'ç³»ç»Ÿå†…å­˜: %GB', total_mem_gb;
        RAISE NOTICE '';
        RAISE NOTICE 'æ¨èé…ç½®:';
        RAISE NOTICE 'max_parallel_workers = %', max_parallel_workers;
        RAISE NOTICE 'max_parallel_workers_per_gather = %', max_parallel_workers_per_gather;
        RAISE NOTICE 'max_parallel_maintenance_workers = %', max_parallel_maintenance_workers;
        RAISE NOTICE 'parallel_setup_cost = 0';
        RAISE NOTICE 'parallel_tuple_cost = 0.0001';
        RAISE NOTICE 'min_parallel_table_scan_size = 8MB';
        RAISE NOTICE '';
        RAISE NOTICE 'PostgreSQL 18ä¼˜åŒ–:';
        RAISE NOTICE '- å¹¶è¡ŒæŸ¥è¯¢æ€§èƒ½æå‡2-4å€';
        RAISE NOTICE '- å¹¶è¡Œç´¢å¼•æ„å»ºé€Ÿåº¦æå‡2-4å€';
        RAISE NOTICE '- å¹¶è¡ŒèšåˆæŸ¥è¯¢é€Ÿåº¦æå‡2-4å€';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¹¶è¡Œå‚æ•°é…ç½®ä¼˜åŒ–å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

#### 6.3.2 å¹¶è¡Œå‚æ•°åŠ¨æ€è°ƒæ•´

```sql
-- PostgreSQL 18 å¹¶è¡Œå‚æ•°åŠ¨æ€è°ƒæ•´ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        -- åŠ¨æ€è°ƒæ•´å¹¶è¡Œå‚æ•°
        SET max_parallel_workers_per_gather = 4;
        SET parallel_setup_cost = 0;
        SET parallel_tuple_cost = 0.0001;
        SET min_parallel_table_scan_size = '8MB';

        RAISE NOTICE 'å¹¶è¡Œå‚æ•°å·²åŠ¨æ€è°ƒæ•´';
        RAISE NOTICE 'max_parallel_workers_per_gather = 4';
        RAISE NOTICE 'parallel_setup_cost = 0';
        RAISE NOTICE 'parallel_tuple_cost = 0.0001';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¹¶è¡Œå‚æ•°åŠ¨æ€è°ƒæ•´å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

## 7. æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•

1. **æ ¹æ®ç³»ç»Ÿèµ„æºè®¡ç®—å‚æ•°** - æ ¹æ®ç³»ç»Ÿå†…å­˜ã€CPUæ ¸å¿ƒæ•°è®¡ç®—å‚æ•°
2. **æµ‹è¯•å‚æ•°æ•ˆæœ** - æ¯æ¬¡å‚æ•°è°ƒæ•´åæµ‹è¯•æ•ˆæœ
3. **ç›‘æ§å‚æ•°å½±å“** - æŒç»­ç›‘æ§å‚æ•°å¯¹ç³»ç»Ÿçš„å½±å“
4. **ä½¿ç”¨è¿æ¥æ± ** - ä½¿ç”¨PgBouncerç­‰è¿æ¥æ± å‡å°‘è¿æ¥å¼€é”€
5. **åˆ©ç”¨PostgreSQL 18æ–°ç‰¹æ€§** - ä½¿ç”¨å¼‚æ­¥I/Oç­‰æ–°ç‰¹æ€§ä¼˜åŒ–å‚æ•°

### âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä¸è¦è¿‡åº¦é…ç½®** - å‚æ•°åº”è¯¥åŸºäºå®é™…è´Ÿè½½å’Œç³»ç»Ÿèµ„æº
2. **å¤‡ä»½é…ç½®** - å‚æ•°è°ƒæ•´å‰å¤‡ä»½åŸå§‹é…ç½®
3. **æ¸è¿›å¼è°ƒæ•´** - ä¸€æ¬¡è°ƒæ•´ä¸€ä¸ªå‚æ•°ï¼Œæµ‹è¯•æ•ˆæœåå†ç»§ç»­
4. **ç›‘æ§å½±å“** - å‚æ•°è°ƒæ•´åæŒç»­ç›‘æ§ç³»ç»Ÿå½±å“

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [PostgreSQLæ€§èƒ½è°ƒä¼˜å®Œæ•´æŒ‡å—.md](./PostgreSQLæ€§èƒ½è°ƒä¼˜å®Œæ•´æŒ‡å—.md) - æ€§èƒ½è°ƒä¼˜å®Œæ•´æŒ‡å—
- [æ€§èƒ½è°ƒä¼˜æ–¹æ³•è®º.md](./æ€§èƒ½è°ƒä¼˜æ–¹æ³•è®º.md) - æ€§èƒ½è°ƒä¼˜æ–¹æ³•è®º
- [ç³»ç»Ÿçº§è°ƒä¼˜.md](./ç³»ç»Ÿçº§è°ƒä¼˜.md) - ç³»ç»Ÿçº§è°ƒä¼˜è¯¦è§£
- [æ•°æ®åº“çº§è°ƒä¼˜.md](./æ•°æ®åº“çº§è°ƒä¼˜.md) - æ•°æ®åº“çº§è°ƒä¼˜è¯¦è§£
- [æŸ¥è¯¢çº§è°ƒä¼˜.md](./æŸ¥è¯¢çº§è°ƒä¼˜.md) - æŸ¥è¯¢çº§è°ƒä¼˜è¯¦è§£
- [ç´¢å¼•è°ƒä¼˜.md](./ç´¢å¼•è°ƒä¼˜.md) - ç´¢å¼•è°ƒä¼˜è¯¦è§£
- [30-æ€§èƒ½è°ƒä¼˜/README.md](./README.md) - æ€§èƒ½è°ƒä¼˜ä¸»é¢˜

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
