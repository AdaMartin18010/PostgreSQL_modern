---
> **ğŸ“‹ æ–‡æ¡£æ¥æº**: æ–°å¢æ·±åŒ–æ–‡æ¡£
> **ğŸ“… åˆ›å»ºæ—¥æœŸ**: 2025-01
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£èšç„¦æ•°æ®åº“è¿ç§»ä¸å‡çº§åœºæ™¯åˆ†æä¸é€‰å‹å†³ç­–

---

# PostgreSQLæ•°æ®åº“è¿ç§»ä¸å‡çº§åœºæ™¯åˆ†ææŒ‡å—

## å…ƒæ•°æ®

- **æ–‡æ¡£ç‰ˆæœ¬**: v1.1
- **åˆ›å»ºæ—¥æœŸ**: 2025-01
- **æœ€åæ›´æ–°**: 2025-01
- **æŠ€æœ¯æ ˆ**: PostgreSQL 17+/18+ | è¿ç§» | å‡çº§ | pg_upgrade | pg_dump
- **ç‰ˆæœ¬è¦†ç›–**: PostgreSQL 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x (å…¼å®¹)
- **éš¾åº¦çº§åˆ«**: â­â­â­â­â­ (ä¸“å®¶çº§)
- **é¢„è®¡é˜…è¯»**: 180åˆ†é’Ÿ
- **å‰ç½®è¦æ±‚**: ç†Ÿæ‚‰PostgreSQLåŸºç¡€ã€å¤‡ä»½æ¢å¤åŸºç¡€ã€è¿ç§»åŸºç¡€

## ğŸ†• PostgreSQL 18 å‡çº§å¢å¼º

### pg_upgrade ä¿ç•™ä¼˜åŒ–å™¨ç»Ÿè®¡ä¿¡æ¯ â­â­â­â­

PostgreSQL 18 çš„ `pg_upgrade` å·¥å…·ç°åœ¨å¯ä»¥ä¿ç•™ä¼˜åŒ–å™¨ç»Ÿè®¡ä¿¡æ¯ï¼Œæ˜¾è‘—å‡å°‘å‡çº§åçš„æ€§èƒ½å½±å“ã€‚

**ç‰¹æ€§è¯´æ˜**:
- **ä¼˜åŠ¿**: å‡çº§åæ— éœ€é‡æ–°è¿è¡Œ ANALYZEï¼ŒæŸ¥è¯¢è®¡åˆ’å™¨å¯ä»¥ç«‹å³ä½¿ç”¨å‡†ç¡®çš„ç»Ÿè®¡ä¿¡æ¯
- **æ€§èƒ½å½±å“**: å‡å°‘å‡çº§åçš„æ€§èƒ½ä¸‹é™ï¼Œé¿å…"å†·å¯åŠ¨"é—®é¢˜
- **ä½¿ç”¨æ–¹æ³•**: ä½¿ç”¨ `--copy` æ¨¡å¼æ—¶è‡ªåŠ¨ä¿ç•™ï¼Œ`--link` æ¨¡å¼éœ€è¦é¢å¤–é…ç½®

**ç›¸å…³æ–‡æ¡£**: [18-ç‰ˆæœ¬ç‰¹æ€§/18.01-PostgreSQL18æ–°ç‰¹æ€§/10-pg_upgradeå‡çº§å®Œæ•´æŒ‡å—.md](../18-ç‰ˆæœ¬ç‰¹æ€§/18.01-PostgreSQL18æ–°ç‰¹æ€§/10-pg_upgradeå‡çº§å®Œæ•´æŒ‡å—.md)

### MD5 å¯†ç è®¤è¯è¿ç§» âš ï¸

PostgreSQL 18 å·²å¼ƒç”¨ MD5 å¯†ç è®¤è¯ï¼Œå‡çº§æ—¶éœ€è¦è¿ç§»åˆ°æ›´å®‰å…¨çš„è®¤è¯æ–¹æ³•ã€‚

**è¿ç§»è¦æ±‚**:
- **å¼ƒç”¨åŸå› **: MD5 ç®—æ³•å­˜åœ¨å®‰å…¨æ¼æ´ï¼Œä¸å†æ¨èä½¿ç”¨
- **æ¨èæ–¹æ¡ˆ**: è¿ç§»åˆ° `scram-sha-256` æˆ– OAuth 2.0
- **è¿ç§»æ­¥éª¤**: å‚è§ä¸‹æ–¹ MD5 è¿ç§»æŒ‡å—

**ç›¸å…³æ–‡æ¡£**: [05-å®‰å…¨ä¸åˆè§„/README.md](../05-å®‰å…¨ä¸åˆè§„/README.md)

---

## ğŸ“‹ å®Œæ•´ç›®å½•

- [PostgreSQLæ•°æ®åº“è¿ç§»ä¸å‡çº§åœºæ™¯åˆ†ææŒ‡å—](#postgresqlæ•°æ®åº“è¿ç§»ä¸å‡çº§åœºæ™¯åˆ†ææŒ‡å—)
  - [å…ƒæ•°æ®](#å…ƒæ•°æ®)
  - [ğŸ“‹ å®Œæ•´ç›®å½•](#-å®Œæ•´ç›®å½•)
  - [1. è¿ç§»ä¸å‡çº§æ¦‚è¿°](#1-è¿ç§»ä¸å‡çº§æ¦‚è¿°)
    - [1.1 è¿ç§»ä½“ç³»](#11-è¿ç§»ä½“ç³»)
      - [è¿ç§»ä½“ç³»æ€ç»´å¯¼å›¾](#è¿ç§»ä½“ç³»æ€ç»´å¯¼å›¾)
    - [1.2 å‡çº§ä½“ç³»](#12-å‡çº§ä½“ç³»)
      - [å‡çº§ä½“ç³»å†³ç­–çŸ©é˜µ](#å‡çº§ä½“ç³»å†³ç­–çŸ©é˜µ)
  - [2. ç‰ˆæœ¬å‡çº§åœºæ™¯åˆ†æ](#2-ç‰ˆæœ¬å‡çº§åœºæ™¯åˆ†æ)
    - [2.1 å¤§ç‰ˆæœ¬å‡çº§åœºæ™¯](#21-å¤§ç‰ˆæœ¬å‡çº§åœºæ™¯)
      - [2.1.1 åœºæ™¯æè¿°](#211-åœºæ™¯æè¿°)
      - [2.1.2 å‡çº§ç­–ç•¥å®ç°](#212-å‡çº§ç­–ç•¥å®ç°)
      - [2.1.3 æ€§èƒ½è®ºè¯](#213-æ€§èƒ½è®ºè¯)
    - [2.2 å‡çº§é£é™©è¯„ä¼°åœºæ™¯](#22-å‡çº§é£é™©è¯„ä¼°åœºæ™¯)
      - [2.2.1 åœºæ™¯æè¿°](#221-åœºæ™¯æè¿°)
      - [2.2.2 é£é™©è¯„ä¼°å®ç°](#222-é£é™©è¯„ä¼°å®ç°)
      - [2.2.3 é£é™©è®ºè¯](#223-é£é™©è®ºè¯)
  - [3. æ•°æ®åº“è¿ç§»åœºæ™¯](#3-æ•°æ®åº“è¿ç§»åœºæ™¯)
    - [3.1 Oracleåˆ°PostgreSQLè¿ç§»åœºæ™¯](#31-oracleåˆ°postgresqlè¿ç§»åœºæ™¯)
      - [3.1.1 åœºæ™¯æè¿°](#311-åœºæ™¯æè¿°)
      - [3.1.2 è¿ç§»å®ç°](#312-è¿ç§»å®ç°)
      - [3.1.3 æ€§èƒ½è®ºè¯](#313-æ€§èƒ½è®ºè¯)
    - [3.2 MySQLåˆ°PostgreSQLè¿ç§»åœºæ™¯](#32-mysqlåˆ°postgresqlè¿ç§»åœºæ™¯)
      - [3.2.1 åœºæ™¯æè¿°](#321-åœºæ™¯æè¿°)
      - [3.2.2 è¿ç§»å®ç°](#322-è¿ç§»å®ç°)
      - [3.2.3 æ€§èƒ½è®ºè¯](#323-æ€§èƒ½è®ºè¯)
    - [3.3 SQL Serveråˆ°PostgreSQLè¿ç§»åœºæ™¯](#33-sql-serveråˆ°postgresqlè¿ç§»åœºæ™¯)
      - [3.3.1 åœºæ™¯æè¿°](#331-åœºæ™¯æè¿°)
      - [3.3.2 è¿ç§»å®ç°](#332-è¿ç§»å®ç°)
      - [3.3.3 æ€§èƒ½è®ºè¯](#333-æ€§èƒ½è®ºè¯)
  - [4. è¿ç§»å·¥å…·å¯¹æ¯”ä¸é€‰å‹](#4-è¿ç§»å·¥å…·å¯¹æ¯”ä¸é€‰å‹)
    - [4.1 pg\_dumpåœºæ™¯](#41-pg_dumpåœºæ™¯)
      - [4.1.1 åœºæ™¯æè¿°](#411-åœºæ™¯æè¿°)
      - [4.1.2 å·¥å…·ä½¿ç”¨](#412-å·¥å…·ä½¿ç”¨)
      - [4.1.3 æ€§èƒ½è®ºè¯](#413-æ€§èƒ½è®ºè¯)
    - [4.2 pg\_upgradeåœºæ™¯](#42-pg_upgradeåœºæ™¯)
      - [4.2.1 åœºæ™¯æè¿°](#421-åœºæ™¯æè¿°)
      - [4.2.2 å·¥å…·ä½¿ç”¨](#422-å·¥å…·ä½¿ç”¨)
      - [4.2.3 æ€§èƒ½è®ºè¯](#423-æ€§èƒ½è®ºè¯)
    - [4.3 ç¬¬ä¸‰æ–¹å·¥å…·åœºæ™¯](#43-ç¬¬ä¸‰æ–¹å·¥å…·åœºæ™¯)
      - [4.3.1 åœºæ™¯æè¿°](#431-åœºæ™¯æè¿°)
      - [4.3.2 å·¥å…·ä½¿ç”¨](#432-å·¥å…·ä½¿ç”¨)
      - [4.3.3 æ€§èƒ½è®ºè¯](#433-æ€§èƒ½è®ºè¯)
    - [4.4 è¿ç§»å·¥å…·é€‰å‹å†³ç­–çŸ©é˜µ](#44-è¿ç§»å·¥å…·é€‰å‹å†³ç­–çŸ©é˜µ)
  - [5. è¿ç§»é£é™©è¯„ä¼°åœºæ™¯](#5-è¿ç§»é£é™©è¯„ä¼°åœºæ™¯)
    - [5.1 æ•°æ®ä¸€è‡´æ€§é£é™©åœºæ™¯](#51-æ•°æ®ä¸€è‡´æ€§é£é™©åœºæ™¯)
      - [5.1.1 åœºæ™¯æè¿°](#511-åœºæ™¯æè¿°)
      - [5.1.2 é£é™©æ§åˆ¶å®ç°](#512-é£é™©æ§åˆ¶å®ç°)
      - [5.1.3 é£é™©è®ºè¯](#513-é£é™©è®ºè¯)
    - [5.2 æ€§èƒ½å½±å“é£é™©åœºæ™¯](#52-æ€§èƒ½å½±å“é£é™©åœºæ™¯)
      - [5.2.1 åœºæ™¯æè¿°](#521-åœºæ™¯æè¿°)
      - [5.2.2 é£é™©æ§åˆ¶å®ç°](#522-é£é™©æ§åˆ¶å®ç°)
      - [5.2.3 é£é™©è®ºè¯](#523-é£é™©è®ºè¯)
    - [5.3 ä¸šåŠ¡å½±å“é£é™©åœºæ™¯](#53-ä¸šåŠ¡å½±å“é£é™©åœºæ™¯)
      - [5.3.1 åœºæ™¯æè¿°](#531-åœºæ™¯æè¿°)
      - [5.3.2 é£é™©æ§åˆ¶å®ç°](#532-é£é™©æ§åˆ¶å®ç°)
      - [5.3.3 é£é™©è®ºè¯](#533-é£é™©è®ºè¯)
  - [6. ç»¼åˆé€‰å‹æ¡ˆä¾‹](#6-ç»¼åˆé€‰å‹æ¡ˆä¾‹)
    - [6.1 æ¡ˆä¾‹1ï¼šå¤§ç‰ˆæœ¬å‡çº§åœºæ™¯](#61-æ¡ˆä¾‹1å¤§ç‰ˆæœ¬å‡çº§åœºæ™¯)
    - [6.2 æ¡ˆä¾‹2ï¼šOracleåˆ°PostgreSQLè¿ç§»åœºæ™¯](#62-æ¡ˆä¾‹2oracleåˆ°postgresqlè¿ç§»åœºæ™¯)
  - [ğŸ“š å‚è€ƒèµ„æº](#-å‚è€ƒèµ„æº)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)
  - [ğŸ“ æ›´æ–°æ—¥å¿—](#-æ›´æ–°æ—¥å¿—)

---

## 1. è¿ç§»ä¸å‡çº§æ¦‚è¿°

### 1.1 è¿ç§»ä½“ç³»

è¿ç§»ä½“ç³»åŒ…æ‹¬ç‰ˆæœ¬å‡çº§ã€æ•°æ®åº“è¿ç§»ã€æ•°æ®è¿ç§»ç­‰ã€‚

#### è¿ç§»ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((è¿ç§»ä½“ç³»))
    ç‰ˆæœ¬å‡çº§
      pg_upgrade
        åŸåœ°å‡çº§
        é“¾æ¥æ¨¡å¼
        å¤åˆ¶æ¨¡å¼
      pg_dumpå‡çº§
        é€»è¾‘å‡çº§
        è·¨ç‰ˆæœ¬å…¼å®¹
    æ•°æ®åº“è¿ç§»
      Oracleè¿ç§»
        ora2pgå·¥å…·
        æ•°æ®ç±»å‹è½¬æ¢
        å‡½æ•°è¿ç§»
      MySQLè¿ç§»
        mysqldump
        æ•°æ®ç±»å‹è½¬æ¢
        è¯­æ³•è½¬æ¢
      SQL Serverè¿ç§»
        bcpå·¥å…·
        æ•°æ®ç±»å‹è½¬æ¢
        å­˜å‚¨è¿‡ç¨‹è¿ç§»
    è¿ç§»å·¥å…·
      pg_dump
        é€»è¾‘å¤‡ä»½
        è·¨ç‰ˆæœ¬
      pg_upgrade
        åŸåœ°å‡çº§
        å¿«é€Ÿå‡çº§
      ç¬¬ä¸‰æ–¹å·¥å…·
        ora2pg
        mysql2pgsql
```

### 1.2 å‡çº§ä½“ç³»

#### å‡çº§ä½“ç³»å†³ç­–çŸ©é˜µ

| å‡çº§æ–¹å¼ | å‡çº§æ—¶é—´ | åœæœºæ—¶é—´ | é£é™© | é€‚ç”¨åœºæ™¯ |
| --- | --- | --- | --- | --- |
| **pg_upgrade** | å¿« | çŸ­ | ä¸­ | å¤§ç‰ˆæœ¬å‡çº§ |
| **pg_dump** | æ…¢ | é•¿ | ä½ | è·¨ç‰ˆæœ¬å‡çº§ |
| **é€»è¾‘å¤åˆ¶** | ä¸­ | çŸ­ | ä½ | é›¶åœæœºå‡çº§ |

---

## 2. ç‰ˆæœ¬å‡çº§åœºæ™¯åˆ†æ

### 2.1 å¤§ç‰ˆæœ¬å‡çº§åœºæ™¯

#### 2.1.1 åœºæ™¯æè¿°

**ä¸šåŠ¡éœ€æ±‚**:

```text
åœºæ™¯ï¼šPostgreSQL 16å‡çº§åˆ°18
éœ€æ±‚ï¼š
1. å¿«é€Ÿå‡çº§
2. æœ€å°åœæœºæ—¶é—´
3. æ•°æ®å®Œæ•´æ€§
4. æ€§èƒ½éªŒè¯

ç³»ç»Ÿç‰¹å¾ï¼š
- æ•°æ®åº“å¤§å° 1TB
- 7x24å°æ—¶æœåŠ¡
- åœæœºçª—å£ 2å°æ—¶
- æ€§èƒ½è¦æ±‚é«˜
```

#### 2.1.2 å‡çº§ç­–ç•¥å®ç°

**pg_upgradeå‡çº§ï¼ˆæ¨èï¼‰**:

```bash
#!/bin/bash
# pg_upgrade_upgrade.sh

OLD_VERSION=16
NEW_VERSION=18
OLD_DATA="/var/lib/postgresql/${OLD_VERSION}/main"
NEW_DATA="/var/lib/postgresql/${NEW_VERSION}/main"
BACKUP_DIR="/backup/pre_upgrade"

# 1. å¤‡ä»½æ•°æ®
echo "Step 1: å¤‡ä»½æ•°æ®"
pg_basebackup -D $BACKUP_DIR -Ft -z

# 2. å®‰è£…æ–°ç‰ˆæœ¬PostgreSQL
echo "Step 2: å®‰è£…PostgreSQL ${NEW_VERSION}"
apt-get install -y postgresql-${NEW_VERSION}

# 3. åˆå§‹åŒ–æ–°ç‰ˆæœ¬æ•°æ®ç›®å½•
echo "Step 3: åˆå§‹åŒ–æ–°ç‰ˆæœ¬æ•°æ®ç›®å½•"
/usr/lib/postgresql/${NEW_VERSION}/bin/initdb -D $NEW_DATA

# 4. æ£€æŸ¥å…¼å®¹æ€§
echo "Step 4: æ£€æŸ¥å…¼å®¹æ€§"
/usr/lib/postgresql/${NEW_VERSION}/bin/pg_upgrade \
    --check \
    --old-bindir=/usr/lib/postgresql/${OLD_VERSION}/bin \
    --new-bindir=/usr/lib/postgresql/${NEW_VERSION}/bin \
    --old-datadir=$OLD_DATA \
    --new-datadir=$NEW_DATA

# 5. æ‰§è¡Œå‡çº§ï¼ˆé“¾æ¥æ¨¡å¼ï¼Œå¿«é€Ÿï¼‰
echo "Step 5: æ‰§è¡Œå‡çº§"
/usr/lib/postgresql/${NEW_VERSION}/bin/pg_upgrade \
    --link \
    --old-bindir=/usr/lib/postgresql/${OLD_VERSION}/bin \
    --new-bindir=/usr/lib/postgresql/${NEW_VERSION}/bin \
    --old-datadir=$OLD_DATA \
    --new-datadir=$NEW_DATA

# 6. å¯åŠ¨æ–°ç‰ˆæœ¬
echo "Step 6: å¯åŠ¨æ–°ç‰ˆæœ¬"
systemctl start postgresql@${NEW_VERSION}-main

# 7. éªŒè¯å‡çº§
echo "Step 7: éªŒè¯å‡çº§"
psql -c "SELECT version();"
psql -c "SELECT count(*) FROM pg_database;"
```

**pg_dumpå‡çº§ï¼ˆå¤‡é€‰ï¼‰**:

```bash
#!/bin/bash
# pg_dump_upgrade.sh

OLD_VERSION=16
NEW_VERSION=18
BACKUP_FILE="/backup/mydb_${OLD_VERSION}.dump"

# 1. å¤‡ä»½æ—§ç‰ˆæœ¬
echo "Step 1: å¤‡ä»½æ—§ç‰ˆæœ¬"
pg_dump -Fc -d mydb -f $BACKUP_FILE

# 2. å®‰è£…æ–°ç‰ˆæœ¬
echo "Step 2: å®‰è£…PostgreSQL ${NEW_VERSION}"
apt-get install -y postgresql-${NEW_VERSION}

# 3. åˆ›å»ºæ•°æ®åº“
echo "Step 3: åˆ›å»ºæ•°æ®åº“"
createdb -p 5433 mydb

# 4. æ¢å¤æ•°æ®
echo "Step 4: æ¢å¤æ•°æ®"
pg_restore -d mydb -j 8 $BACKUP_FILE

# 5. éªŒè¯æ•°æ®
echo "Step 5: éªŒè¯æ•°æ®"
psql -d mydb -c "SELECT count(*) FROM pg_tables;"
```

#### 2.1.3 æ€§èƒ½è®ºè¯

**å‡çº§æ–¹å¼å¯¹æ¯”**:

| å‡çº§æ–¹å¼ | å‡çº§æ—¶é—´ | åœæœºæ—¶é—´ | æ•°æ®å®Œæ•´æ€§ | é€‚ç”¨åœºæ™¯ |
| --- | --- | --- | --- | --- |
| **pg_upgrade** | 30åˆ†é’Ÿ | 30åˆ†é’Ÿ | å®Œæ•´ | å¤§ç‰ˆæœ¬å‡çº§ |
| **pg_dump** | 4å°æ—¶ | 4å°æ—¶ | å®Œæ•´ | è·¨ç‰ˆæœ¬å‡çº§ |
| **é€»è¾‘å¤åˆ¶** | å®æ—¶ | 5åˆ†é’Ÿ | å®Œæ•´ | é›¶åœæœºå‡çº§ |

---

### 2.2 å‡çº§é£é™©è¯„ä¼°åœºæ™¯

#### 2.2.1 åœºæ™¯æè¿°

**ä¸šåŠ¡éœ€æ±‚**:

```text
åœºæ™¯ï¼šå‡çº§é£é™©è¯„ä¼°
éœ€æ±‚ï¼š
1. è¯†åˆ«å‡çº§é£é™©
2. è¯„ä¼°å½±å“èŒƒå›´
3. åˆ¶å®šåº”å¯¹ç­–ç•¥
4. é™ä½é£é™©

ç³»ç»Ÿç‰¹å¾ï¼š
- å…³é”®ä¸šåŠ¡ç³»ç»Ÿ
- å¤æ‚æ•°æ®æ¨¡å‹
- è‡ªå®šä¹‰æ‰©å±•
- æ€§èƒ½æ•æ„Ÿ
```

#### 2.2.2 é£é™©è¯„ä¼°å®ç°

**å…¼å®¹æ€§æ£€æŸ¥**:

```bash
#!/bin/bash
# upgrade_risk_assessment.sh

OLD_VERSION=16
NEW_VERSION=18

# 1. æ£€æŸ¥æ‰©å±•å…¼å®¹æ€§
echo "Step 1: æ£€æŸ¥æ‰©å±•å…¼å®¹æ€§"
psql -c "
SELECT
    extname,
    extversion,
    CASE
        WHEN extname IN ('pgvector', 'postgis', 'timescaledb') THEN 'éœ€è¦æ£€æŸ¥'
        ELSE 'å…¼å®¹'
    END AS compatibility
FROM pg_extension
ORDER BY extname;
"

# 2. æ£€æŸ¥ä¸å…¼å®¹ç‰¹æ€§
echo "Step 2: æ£€æŸ¥ä¸å…¼å®¹ç‰¹æ€§"
psql -c "
SELECT
    schemaname,
    tablename,
    attname,
    atttypid::regtype
FROM pg_attribute
WHERE atttypid::regtype::text LIKE '%deprecated%'
OR atttypid::regtype::text LIKE '%removed%';
"

# 3. æ£€æŸ¥è‡ªå®šä¹‰å‡½æ•°
echo "Step 3: æ£€æŸ¥è‡ªå®šä¹‰å‡½æ•°"
psql -c "
SELECT
    proname,
    prosrc,
    CASE
        WHEN prosrc LIKE '%deprecated%' THEN 'éœ€è¦æ›´æ–°'
        ELSE 'å…¼å®¹'
    END AS status
FROM pg_proc
WHERE pronamespace = 'public'::regnamespace
AND prokind = 'f';
"

# 4. æ€§èƒ½åŸºå‡†æµ‹è¯•
echo "Step 4: æ€§èƒ½åŸºå‡†æµ‹è¯•"
psql -c "
SELECT
    query,
    calls,
    mean_exec_time,
    max_exec_time
FROM pg_stat_statements
ORDER BY mean_exec_time DESC
LIMIT 20;
"
```

**é£é™©è¯„ä¼°æŠ¥å‘Š**:

```sql
-- åˆ›å»ºé£é™©è¯„ä¼°è§†å›¾
CREATE VIEW upgrade_risk_assessment AS
SELECT
    'Extension Compatibility' AS risk_category,
    count(*) FILTER (WHERE extname IN ('pgvector', 'postgis', 'timescaledb')) AS high_risk_count,
    count(*) FILTER (WHERE extname NOT IN ('pgvector', 'postgis', 'timescaledb')) AS low_risk_count
FROM pg_extension
UNION ALL
SELECT
    'Custom Functions' AS risk_category,
    count(*) FILTER (WHERE prosrc LIKE '%deprecated%') AS high_risk_count,
    count(*) FILTER (WHERE prosrc NOT LIKE '%deprecated%') AS low_risk_count
FROM pg_proc
WHERE pronamespace = 'public'::regnamespace;
```

#### 2.2.3 é£é™©è®ºè¯

**é£é™©ç­‰çº§**:

| é£é™©ç±»å‹ | é£é™©ç­‰çº§ | å½±å“èŒƒå›´ | åº”å¯¹ç­–ç•¥ |
| --- | --- | --- | --- |
| **æ‰©å±•ä¸å…¼å®¹** | é«˜ | åŠŸèƒ½å½±å“ | å‡çº§æ‰©å±•æˆ–æ›¿æ¢ |
| **å‡½æ•°ä¸å…¼å®¹** | ä¸­ | åŠŸèƒ½å½±å“ | é‡å†™å‡½æ•° |
| **æ€§èƒ½ä¸‹é™** | ä¸­ | æ€§èƒ½å½±å“ | ä¼˜åŒ–æŸ¥è¯¢ |
| **æ•°æ®ä¸¢å¤±** | å¾ˆé«˜ | æ•°æ®å®Œæ•´æ€§ | å®Œæ•´å¤‡ä»½ |

---

## 3. æ•°æ®åº“è¿ç§»åœºæ™¯

### 3.1 Oracleåˆ°PostgreSQLè¿ç§»åœºæ™¯

#### 3.1.1 åœºæ™¯æè¿°

**ä¸šåŠ¡éœ€æ±‚**:

```text
åœºæ™¯ï¼šOracleåˆ°PostgreSQLè¿ç§»
éœ€æ±‚ï¼š
1. æ•°æ®è¿ç§»
2. å‡½æ•°è¿ç§»
3. å­˜å‚¨è¿‡ç¨‹è¿ç§»
4. æ€§èƒ½éªŒè¯

ç³»ç»Ÿç‰¹å¾ï¼š
- Oracle 12cæ•°æ®åº“
- 100GBæ•°æ®
- å¤æ‚å­˜å‚¨è¿‡ç¨‹
- éœ€è¦è¿ç§»åˆ°PostgreSQL 18
```

#### 3.1.2 è¿ç§»å®ç°

**ä½¿ç”¨ora2pgå·¥å…·**:

```bash
#!/bin/bash
# oracle_to_postgresql_migration.sh

# 1. å®‰è£…ora2pg
apt-get install -y ora2pg

# 2. é…ç½®ora2pg
cat > /etc/ora2pg/ora2pg.conf <<EOF
ORACLE_DSN dbi:Oracle:host=oracle_host;sid=oracle_sid;port=1521
ORACLE_USER oracle_user
ORACLE_PWD oracle_password

PG_DSN dbi:Pg:dbname=postgres_db;host=postgres_host;port=5432
PG_USER postgres_user
PG_PWD postgres_password

TYPE TABLE,SEQUENCE,VIEW,INDEX,TRIGGER,FUNCTION,PROCEDURE,PACKAGE
SCHEMA oracle_schema
OUTPUT_DIR /migration/output
EOF

# 3. è¯„ä¼°è¿ç§»
ora2pg -c /etc/ora2pg/ora2pg.conf -t SHOW_VERSION
ora2pg -c /etc/ora2pg/ora2pg.conf -t SHOW_SCHEMA
ora2pg -c /etc/ora2pg/ora2pg.conf -t ESTIMATE_COST

# 4. å¯¼å‡ºè¡¨ç»“æ„
ora2pg -c /etc/ora2pg/ora2pg.conf -t TABLE -o table_schema.sql

# 5. å¯¼å‡ºæ•°æ®
ora2pg -c /etc/ora2pg/ora2pg.conf -t COPY -o data_export.sql

# 6. å¯¼å‡ºå‡½æ•°å’Œå­˜å‚¨è¿‡ç¨‹
ora2pg -c /etc/ora2pg/ora2pg.conf -t FUNCTION -o functions.sql
ora2pg -c /etc/ora2pg/ora2pg.conf -t PROCEDURE -o procedures.sql

# 7. å¯¼å…¥åˆ°PostgreSQL
psql -d postgres_db -f table_schema.sql
psql -d postgres_db -f data_export.sql
psql -d postgres_db -f functions.sql
psql -d postgres_db -f procedures.sql
```

**æ•°æ®ç±»å‹è½¬æ¢**:

```sql
-- Oracleåˆ°PostgreSQLæ•°æ®ç±»å‹æ˜ å°„
-- Oracle          PostgreSQL
-- NUMBER          NUMERIC
-- VARCHAR2        VARCHAR
-- DATE            TIMESTAMP
-- CLOB            TEXT
-- BLOB            BYTEA
-- RAW             BYTEA

-- åˆ›å»ºè½¬æ¢å‡½æ•°
CREATE OR REPLACE FUNCTION convert_oracle_date(oracle_date TEXT)
RETURNS TIMESTAMP AS $$
BEGIN
    RETURN to_timestamp(oracle_date, 'YYYY-MM-DD HH24:MI:SS');
END;
$$ LANGUAGE plpgsql;
```

#### 3.1.3 æ€§èƒ½è®ºè¯

**è¿ç§»æ•ˆæœ**:

| æŒ‡æ ‡ | Oracle | PostgreSQL | å˜åŒ– |
| --- | --- | --- | --- |
| **æŸ¥è¯¢æ€§èƒ½** | åŸºå‡† | +20% | æå‡ |
| **å­˜å‚¨æˆæœ¬** | åŸºå‡† | -40% | é™ä½ |
| **è®¸å¯æˆæœ¬** | é«˜ | å…è´¹ | -100% |

---

### 3.2 MySQLåˆ°PostgreSQLè¿ç§»åœºæ™¯

#### 3.2.1 åœºæ™¯æè¿°

**ä¸šåŠ¡éœ€æ±‚**:

```text
åœºæ™¯ï¼šMySQLåˆ°PostgreSQLè¿ç§»
éœ€æ±‚ï¼š
1. æ•°æ®è¿ç§»
2. è¯­æ³•è½¬æ¢
3. å‡½æ•°è¿ç§»
4. æ€§èƒ½éªŒè¯

ç³»ç»Ÿç‰¹å¾ï¼š
- MySQL 8.0æ•°æ®åº“
- 50GBæ•°æ®
- ç®€å•å­˜å‚¨è¿‡ç¨‹
- éœ€è¦è¿ç§»åˆ°PostgreSQL 18
```

#### 3.2.2 è¿ç§»å®ç°

**ä½¿ç”¨mysqldump + è½¬æ¢**:

```bash
#!/bin/bash
# mysql_to_postgresql_migration.sh

# 1. å¯¼å‡ºMySQLæ•°æ®
mysqldump -u mysql_user -p mysql_db > mysql_dump.sql

# 2. è½¬æ¢SQLè¯­æ³•
sed -i 's/ENGINE=InnoDB//g' mysql_dump.sql
sed -i 's/AUTO_INCREMENT/SERIAL/g' mysql_dump.sql
sed -i 's/`//g' mysql_dump.sql
sed -i 's/DATETIME/TIMESTAMP/g' mysql_dump.sql

# 3. åˆ›å»ºPostgreSQLæ•°æ®åº“
createdb postgres_db

# 4. å¯¼å…¥æ•°æ®
psql -d postgres_db -f mysql_dump.sql

# 5. éªŒè¯æ•°æ®
psql -d postgres_db -c "SELECT count(*) FROM information_schema.tables;"
```

**ä½¿ç”¨pgloaderå·¥å…·**:

```bash
# å®‰è£…pgloader
apt-get install -y pgloader

# ä½¿ç”¨pgloaderè¿ç§»
pgloader mysql://mysql_user:password@mysql_host:3306/mysql_db \
         postgresql://postgres_user:password@postgres_host:5432/postgres_db
```

#### 3.2.3 æ€§èƒ½è®ºè¯

**è¿ç§»æ•ˆæœ**:

| æŒ‡æ ‡ | MySQL | PostgreSQL | å˜åŒ– |
| --- | --- | --- | --- |
| **æŸ¥è¯¢æ€§èƒ½** | åŸºå‡† | +15% | æå‡ |
| **äº‹åŠ¡æ€§èƒ½** | åŸºå‡† | +30% | æå‡ |
| **åŠŸèƒ½æ”¯æŒ** | åŸºç¡€ | ä¸°å¯Œ | æå‡ |

---

### 3.3 SQL Serveråˆ°PostgreSQLè¿ç§»åœºæ™¯

#### 3.3.1 åœºæ™¯æè¿°

**ä¸šåŠ¡éœ€æ±‚**:

```text
åœºæ™¯ï¼šSQL Serveråˆ°PostgreSQLè¿ç§»
éœ€æ±‚ï¼š
1. æ•°æ®è¿ç§»
2. T-SQLè½¬æ¢
3. å­˜å‚¨è¿‡ç¨‹è¿ç§»
4. æ€§èƒ½éªŒè¯

ç³»ç»Ÿç‰¹å¾ï¼š
- SQL Server 2019æ•°æ®åº“
- 200GBæ•°æ®
- å¤æ‚T-SQLå­˜å‚¨è¿‡ç¨‹
- éœ€è¦è¿ç§»åˆ°PostgreSQL 18
```

#### 3.3.2 è¿ç§»å®ç°

**ä½¿ç”¨bcpå¯¼å‡º + è½¬æ¢**:

```bash
#!/bin/bash
# sqlserver_to_postgresql_migration.sh

# 1. ä½¿ç”¨bcpå¯¼å‡ºæ•°æ®
bcp "SELECT * FROM mydb.dbo.users" queryout users.csv -c -t, -S sqlserver_host -U sqlserver_user -P password

# 2. è½¬æ¢æ•°æ®ç±»å‹
# SQL Server          PostgreSQL
# INT                 INTEGER
# VARCHAR             VARCHAR
# DATETIME            TIMESTAMP
# MONEY               NUMERIC(19,4)
# UNIQUEIDENTIFIER    UUID

# 3. å¯¼å…¥åˆ°PostgreSQL
psql -d postgres_db -c "
CREATE TABLE users (
    id INTEGER,
    name VARCHAR(100),
    created_at TIMESTAMP
);
"

psql -d postgres_db -c "\COPY users FROM 'users.csv' WITH CSV HEADER;"
```

#### 3.3.3 æ€§èƒ½è®ºè¯

**è¿ç§»æ•ˆæœ**:

| æŒ‡æ ‡ | SQL Server | PostgreSQL | å˜åŒ– |
| --- | --- | --- | --- |
| **æŸ¥è¯¢æ€§èƒ½** | åŸºå‡† | +10% | æå‡ |
| **è®¸å¯æˆæœ¬** | é«˜ | å…è´¹ | -100% |
| **åŠŸèƒ½æ”¯æŒ** | ä¸°å¯Œ | ä¸°å¯Œ | ç›¸å½“ |

---

## 4. è¿ç§»å·¥å…·å¯¹æ¯”ä¸é€‰å‹

### 4.1 pg_dumpåœºæ™¯

#### 4.1.1 åœºæ™¯æè¿°

**ä¸šåŠ¡éœ€æ±‚**:

```text
åœºæ™¯ï¼šä½¿ç”¨pg_dumpè¿ç§»
éœ€æ±‚ï¼š
1. è·¨ç‰ˆæœ¬è¿ç§»
2. é€‰æ‹©æ€§è¿ç§»
3. å¯è¯»æ ¼å¼
4. çµæ´»æ¢å¤

ç³»ç»Ÿç‰¹å¾ï¼š
- è·¨ç‰ˆæœ¬è¿ç§»
- éœ€è¦é€‰æ‹©æ€§è¿ç§»
- éœ€è¦å¯è¯»å¤‡ä»½
```

#### 4.1.2 å·¥å…·ä½¿ç”¨

**pg_dumpä½¿ç”¨**:

```bash
# 1. å®Œæ•´æ•°æ®åº“å¤‡ä»½
pg_dump -Fc -Z 9 -d mydb -f mydb_backup.dump

# 2. é€‰æ‹©æ€§å¤‡ä»½
pg_dump -t table1 -t table2 -d mydb -f selective_backup.dump

# 3. è·¨ç‰ˆæœ¬è¿ç§»
pg_dump -Fc -d old_db -f migration.dump
pg_restore -d new_db migration.dump
```

#### 4.1.3 æ€§èƒ½è®ºè¯

**å·¥å…·æ€§èƒ½**:

| ç‰¹æ€§ | pg_dump | é€‚ç”¨åœºæ™¯ |
| --- | --- | --- |
| **è·¨ç‰ˆæœ¬** | æ”¯æŒ | è·¨ç‰ˆæœ¬è¿ç§» |
| **é€‰æ‹©æ€§** | æ”¯æŒ | éƒ¨åˆ†è¿ç§» |
| **å¯è¯»æ€§** | é«˜ | éœ€è¦ç¼–è¾‘ |

---

### 4.2 pg_upgradeåœºæ™¯

#### 4.2.1 åœºæ™¯æè¿°

**ä¸šåŠ¡éœ€æ±‚**:

```text
åœºæ™¯ï¼šä½¿ç”¨pg_upgradeå‡çº§
éœ€æ±‚ï¼š
1. å¿«é€Ÿå‡çº§
2. æœ€å°åœæœº
3. æ•°æ®å®Œæ•´æ€§
4. åŸåœ°å‡çº§

ç³»ç»Ÿç‰¹å¾ï¼š
- å¤§ç‰ˆæœ¬å‡çº§
- åœæœºçª—å£å°
- æ•°æ®é‡å¤§
```

#### 4.2.2 å·¥å…·ä½¿ç”¨

**pg_upgradeä½¿ç”¨**:

```bash
# 1. æ£€æŸ¥å…¼å®¹æ€§
pg_upgrade --check \
    --old-bindir=/usr/lib/postgresql/16/bin \
    --new-bindir=/usr/lib/postgresql/18/bin \
    --old-datadir=/var/lib/postgresql/16/main \
    --new-datadir=/var/lib/postgresql/18/main

# 2. æ‰§è¡Œå‡çº§ï¼ˆé“¾æ¥æ¨¡å¼ï¼‰
pg_upgrade --link \
    --old-bindir=/usr/lib/postgresql/16/bin \
    --new-bindir=/usr/lib/postgresql/18/bin \
    --old-datadir=/var/lib/postgresql/16/main \
    --new-datadir=/var/lib/postgresql/18/main
```

#### 4.2.3 æ€§èƒ½è®ºè¯

**å·¥å…·æ€§èƒ½**:

| ç‰¹æ€§ | pg_upgrade | é€‚ç”¨åœºæ™¯ |
| --- | --- | --- |
| **å‡çº§é€Ÿåº¦** | å¿« | å¤§ç‰ˆæœ¬å‡çº§ |
| **åœæœºæ—¶é—´** | çŸ­ | æœ€å°åœæœº |
| **æ•°æ®å®Œæ•´æ€§** | é«˜ | æ•°æ®ä¿æŠ¤ |

---

### 4.3 ç¬¬ä¸‰æ–¹å·¥å…·åœºæ™¯

#### 4.3.1 åœºæ™¯æè¿°

**ä¸šåŠ¡éœ€æ±‚**:

```text
åœºæ™¯ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹è¿ç§»å·¥å…·
éœ€æ±‚ï¼š
1. è‡ªåŠ¨åŒ–è¿ç§»
2. è¯­æ³•è½¬æ¢
3. å‡½æ•°è½¬æ¢
4. æ‰¹é‡è¿ç§»

ç³»ç»Ÿç‰¹å¾ï¼š
- è·¨æ•°æ®åº“è¿ç§»
- å¤æ‚è¯­æ³•
- éœ€è¦è‡ªåŠ¨åŒ–
```

#### 4.3.2 å·¥å…·ä½¿ç”¨

**ora2pgä½¿ç”¨**:

```bash
# è¯„ä¼°è¿ç§»æˆæœ¬
ora2pg -c ora2pg.conf -t ESTIMATE_COST

# å¯¼å‡ºè¡¨ç»“æ„
ora2pg -c ora2pg.conf -t TABLE

# å¯¼å‡ºæ•°æ®
ora2pg -c ora2pg.conf -t COPY
```

**pgloaderä½¿ç”¨**:

```bash
# MySQLè¿ç§»
pgloader mysql://user:pass@host/db postgresql://user:pass@host/db

# SQL Serverè¿ç§»
pgloader mssql://user:pass@host/db postgresql://user:pass@host/db
```

#### 4.3.3 æ€§èƒ½è®ºè¯

**å·¥å…·å¯¹æ¯”**:

| å·¥å…· | åŠŸèƒ½ | æ€§èƒ½ | é€‚ç”¨åœºæ™¯ |
| --- | --- | --- | --- |
| **ora2pg** | é«˜ | ä¸­ | Oracleè¿ç§» |
| **pgloader** | é«˜ | é«˜ | å¤šæ•°æ®åº“è¿ç§» |
| **pg_dump** | ä¸­ | ä¸­ | PostgreSQLè¿ç§» |

---

### 4.4 è¿ç§»å·¥å…·é€‰å‹å†³ç­–çŸ©é˜µ

**é€‰å‹å†³ç­–æµç¨‹**:

```mermaid
flowchart TD
    A[è¿ç§»éœ€æ±‚] --> B{è¿ç§»ç±»å‹?}
    B -->|PostgreSQLå‡çº§| C{ç‰ˆæœ¬è·¨åº¦?}
    B -->|è·¨æ•°æ®åº“| D{æºæ•°æ®åº“?}
    C -->|å°ç‰ˆæœ¬| E[pg_upgrade]
    C -->|å¤§ç‰ˆæœ¬| F[pg_dump]
    D -->|Oracle| G[ora2pg]
    D -->|MySQL| H[pgloader]
    D -->|SQL Server| I[pgloader]
    E --> J[å®Œæˆé€‰å‹]
    F --> J
    G --> J
    H --> J
    I --> J
```

**å·¥å…·é€‰å‹çŸ©é˜µ**:

| åœºæ™¯ | æ¨èå·¥å…· | ç†ç”± | æ€§èƒ½ |
| --- | --- | --- | --- |
| **PostgreSQLå‡çº§** | pg_upgrade | å¿«é€Ÿã€åŸåœ° | é«˜ |
| **è·¨ç‰ˆæœ¬è¿ç§»** | pg_dump | å…¼å®¹æ€§å¥½ | ä¸­ |
| **Oracleè¿ç§»** | ora2pg | ä¸“ä¸šå·¥å…· | ä¸­ |
| **MySQLè¿ç§»** | pgloader | è‡ªåŠ¨åŒ– | é«˜ |
| **SQL Serverè¿ç§»** | pgloader | è‡ªåŠ¨åŒ– | é«˜ |

---

## 5. è¿ç§»é£é™©è¯„ä¼°åœºæ™¯

### 5.1 æ•°æ®ä¸€è‡´æ€§é£é™©åœºæ™¯

#### 5.1.1 åœºæ™¯æè¿°

**ä¸šåŠ¡éœ€æ±‚**:

```text
åœºæ™¯ï¼šæ•°æ®ä¸€è‡´æ€§ä¿è¯
éœ€æ±‚ï¼š
1. æ•°æ®å®Œæ•´æ€§
2. æ•°æ®ä¸€è‡´æ€§éªŒè¯
3. æ•°æ®å¯¹æ¯”
4. é£é™©æ§åˆ¶

ç³»ç»Ÿç‰¹å¾ï¼š
- å…³é”®ä¸šåŠ¡æ•°æ®
- æ•°æ®é‡å¤§
- ä¸€è‡´æ€§è¦æ±‚é«˜
```

#### 5.1.2 é£é™©æ§åˆ¶å®ç°

**æ•°æ®ä¸€è‡´æ€§éªŒè¯**:

```sql
-- 1. è¡Œæ•°å¯¹æ¯”
SELECT
    'source' AS source,
    count(*) AS row_count
FROM source_table
UNION ALL
SELECT
    'target' AS source,
    count(*) AS row_count
FROM target_table;

-- 2. æ•°æ®æ ¡éªŒå’Œ
SELECT
    md5(string_agg(id::text || name || created_at::text, '' ORDER BY id)) AS checksum
FROM source_table;

-- 3. æŠ½æ ·å¯¹æ¯”
SELECT
    s.id,
    s.name,
    t.name AS target_name,
    CASE WHEN s.name = t.name THEN 'MATCH' ELSE 'MISMATCH' END AS status
FROM source_table s
JOIN target_table t ON s.id = t.id
WHERE s.id % 100 = 0  -- æŠ½æ ·1%
ORDER BY s.id;
```

#### 5.1.3 é£é™©è®ºè¯

**é£é™©æ§åˆ¶æ•ˆæœ**:

| éªŒè¯æ–¹æ³• | å‡†ç¡®åº¦ | æ—¶é—´ | é€‚ç”¨åœºæ™¯ |
| --- | --- | --- | --- |
| **è¡Œæ•°å¯¹æ¯”** | ä¸­ | å¿« | å¿«é€ŸéªŒè¯ |
| **æ ¡éªŒå’Œ** | é«˜ | ä¸­ | å®Œæ•´æ€§éªŒè¯ |
| **æŠ½æ ·å¯¹æ¯”** | ä¸­ | å¿« | å¿«é€ŸéªŒè¯ |
| **å…¨é‡å¯¹æ¯”** | å¾ˆé«˜ | æ…¢ | æœ€ç»ˆéªŒè¯ |

---

### 5.2 æ€§èƒ½å½±å“é£é™©åœºæ™¯

#### 5.2.1 åœºæ™¯æè¿°

**ä¸šåŠ¡éœ€æ±‚**:

```text
åœºæ™¯ï¼šè¿ç§»åæ€§èƒ½å½±å“è¯„ä¼°
éœ€æ±‚ï¼š
1. æ€§èƒ½åŸºå‡†æµ‹è¯•
2. æ€§èƒ½å¯¹æ¯”
3. æ€§èƒ½ä¼˜åŒ–
4. é£é™©æ§åˆ¶

ç³»ç»Ÿç‰¹å¾ï¼š
- æ€§èƒ½æ•æ„Ÿç³»ç»Ÿ
- éœ€è¦æ€§èƒ½éªŒè¯
- æ€§èƒ½è¦æ±‚é«˜
```

#### 5.2.2 é£é™©æ§åˆ¶å®ç°

**æ€§èƒ½åŸºå‡†æµ‹è¯•**:

```sql
-- 1. è¿ç§»å‰æ€§èƒ½åŸºå‡†
CREATE TABLE performance_baseline AS
SELECT
    query,
    calls,
    mean_exec_time,
    max_exec_time,
    total_exec_time
FROM pg_stat_statements
WHERE query_start > NOW() - INTERVAL '7 days';

-- 2. è¿ç§»åæ€§èƒ½æµ‹è¯•
SELECT
    b.query,
    b.mean_exec_time AS baseline_time,
    s.mean_exec_time AS current_time,
    (s.mean_exec_time - b.mean_exec_time) / b.mean_exec_time * 100 AS performance_change_percent
FROM performance_baseline b
JOIN pg_stat_statements s ON b.query = s.query
WHERE s.query_start > NOW() - INTERVAL '1 day'
ORDER BY abs(performance_change_percent) DESC;
```

#### 5.2.3 é£é™©è®ºè¯

**æ€§èƒ½å½±å“**:

| è¿ç§»ç±»å‹ | æ€§èƒ½å½±å“ | é£é™©ç­‰çº§ | åº”å¯¹ç­–ç•¥ |
| --- | --- | --- | --- |
| **ç‰ˆæœ¬å‡çº§** | Â±10% | ä½ | ç›‘æ§ä¼˜åŒ– |
| **è·¨æ•°æ®åº“è¿ç§»** | Â±30% | ä¸­ | æŸ¥è¯¢ä¼˜åŒ– |
| **æ¶æ„è¿ç§»** | Â±50% | é«˜ | æ·±åº¦ä¼˜åŒ– |

---

### 5.3 ä¸šåŠ¡å½±å“é£é™©åœºæ™¯

#### 5.3.1 åœºæ™¯æè¿°

**ä¸šåŠ¡éœ€æ±‚**:

```text
åœºæ™¯ï¼šè¿ç§»ä¸šåŠ¡å½±å“è¯„ä¼°
éœ€æ±‚ï¼š
1. ä¸šåŠ¡å½±å“åˆ†æ
2. åœæœºæ—¶é—´è¯„ä¼°
3. å›æ»šç­–ç•¥
4. é£é™©æ§åˆ¶

ç³»ç»Ÿç‰¹å¾ï¼š
- å…³é”®ä¸šåŠ¡ç³»ç»Ÿ
- 7x24å°æ—¶æœåŠ¡
- åœæœºå½±å“å¤§
```

#### 5.3.2 é£é™©æ§åˆ¶å®ç°

**ä¸šåŠ¡å½±å“è¯„ä¼°**:

```sql
-- 1. ä¸šåŠ¡å½±å“åˆ†æ
CREATE TABLE migration_impact_analysis AS
SELECT
    table_name,
    CASE
        WHEN table_name IN ('orders', 'payments', 'users') THEN 'CRITICAL'
        WHEN table_name IN ('logs', 'audit') THEN 'LOW'
        ELSE 'MEDIUM'
    END AS business_impact,
    pg_size_pretty(pg_total_relation_size(table_name::regclass)) AS table_size,
    n_live_tup AS row_count
FROM pg_stat_user_tables
ORDER BY business_impact DESC, pg_total_relation_size(table_name::regclass) DESC;

-- 2. åœæœºæ—¶é—´ä¼°ç®—
SELECT
    table_name,
    pg_total_relation_size(table_name::regclass) / 1024 / 1024 / 1024 AS size_gb,
    CASE
        WHEN pg_total_relation_size(table_name::regclass) < 10 * 1024 * 1024 * 1024 THEN '5åˆ†é’Ÿ'
        WHEN pg_total_relation_size(table_name::regclass) < 100 * 1024 * 1024 * 1024 THEN '30åˆ†é’Ÿ'
        ELSE '2å°æ—¶'
    END AS estimated_downtime
FROM pg_stat_user_tables
ORDER BY pg_total_relation_size(table_name::regclass) DESC;
```

**å›æ»šç­–ç•¥**:

```bash
#!/bin/bash
# migration_rollback.sh

# 1. åœæ­¢æ–°ç‰ˆæœ¬
systemctl stop postgresql@18-main

# 2. æ¢å¤æ—§ç‰ˆæœ¬æ•°æ®
tar -xzf /backup/pre_migration_backup.tar.gz -C /var/lib/postgresql/16/main

# 3. å¯åŠ¨æ—§ç‰ˆæœ¬
systemctl start postgresql@16-main

# 4. éªŒè¯æ•°æ®
psql -c "SELECT count(*) FROM pg_database;"
```

#### 5.3.3 é£é™©è®ºè¯

**ä¸šåŠ¡å½±å“**:

| è¿ç§»ç±»å‹ | åœæœºæ—¶é—´ | ä¸šåŠ¡å½±å“ | é£é™©ç­‰çº§ |
| --- | --- | --- | --- |
| **pg_upgrade** | 30åˆ†é’Ÿ | ä¸­ | ä¸­ |
| **pg_dump** | 4å°æ—¶ | é«˜ | é«˜ |
| **é€»è¾‘å¤åˆ¶** | 5åˆ†é’Ÿ | ä½ | ä½ |

---

## 6. ç»¼åˆé€‰å‹æ¡ˆä¾‹

### 6.1 æ¡ˆä¾‹1ï¼šå¤§ç‰ˆæœ¬å‡çº§åœºæ™¯

**ä¸šåŠ¡èƒŒæ™¯**:

- PostgreSQL 16å‡çº§åˆ°18
- æ•°æ®åº“å¤§å° 2TB
- 7x24å°æ—¶æœåŠ¡
- åœæœºçª—å£ 1å°æ—¶

**å‡çº§å†³ç­–**:

```text
æ–¹æ¡ˆï¼špg_upgradeé“¾æ¥æ¨¡å¼å‡çº§

å‡çº§ç­–ç•¥ï¼š
1. ä½¿ç”¨pg_upgradeé“¾æ¥æ¨¡å¼
2. åœæœºæ—¶é—´ï¼š30åˆ†é’Ÿ
3. æ•°æ®å®Œæ•´æ€§ï¼š100%
4. æ€§èƒ½éªŒè¯ï¼šè¿ç§»åæµ‹è¯•

é£é™©æ§åˆ¶ï¼š
1. å®Œæ•´å¤‡ä»½
2. å…¼å®¹æ€§æ£€æŸ¥
3. æ€§èƒ½åŸºå‡†æµ‹è¯•
4. å›æ»šè®¡åˆ’

æ€§èƒ½æŒ‡æ ‡ï¼š
- å‡çº§æ—¶é—´ï¼š30åˆ†é’Ÿ
- æ•°æ®å®Œæ•´æ€§ï¼š100%
- æ€§èƒ½å½±å“ï¼š< 5%
```

### 6.2 æ¡ˆä¾‹2ï¼šOracleåˆ°PostgreSQLè¿ç§»åœºæ™¯

**ä¸šåŠ¡èƒŒæ™¯**:

- Oracle 12cè¿ç§»åˆ°PostgreSQL 18
- æ•°æ®åº“å¤§å° 500GB
- å¤æ‚å­˜å‚¨è¿‡ç¨‹
- éœ€è¦å®Œæ•´è¿ç§»

**è¿ç§»å†³ç­–**:

```text
æ–¹æ¡ˆï¼šora2pg + æ‰‹åŠ¨ä¼˜åŒ–

è¿ç§»ç­–ç•¥ï¼š
1. ä½¿ç”¨ora2pgå·¥å…·è‡ªåŠ¨åŒ–è¿ç§»
2. æ‰‹åŠ¨ä¼˜åŒ–å­˜å‚¨è¿‡ç¨‹
3. æ•°æ®éªŒè¯
4. æ€§èƒ½ä¼˜åŒ–

è¿ç§»æ­¥éª¤ï¼š
1. è¯„ä¼°è¿ç§»æˆæœ¬
2. å¯¼å‡ºè¡¨ç»“æ„å’Œæ•°æ®
3. è½¬æ¢å­˜å‚¨è¿‡ç¨‹
4. å¯¼å…¥åˆ°PostgreSQL
5. æ•°æ®éªŒè¯
6. æ€§èƒ½ä¼˜åŒ–

æ€§èƒ½æŒ‡æ ‡ï¼š
- è¿ç§»æ—¶é—´ï¼š8å°æ—¶
- æ•°æ®å®Œæ•´æ€§ï¼š100%
- æ€§èƒ½æå‡ï¼š+20%
```

---

## ğŸ“š å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£

- [PostgreSQLå‡çº§æ–‡æ¡£](https://www.postgresql.org/docs/current/upgrading.html)
- [pg_upgradeæ–‡æ¡£](https://www.postgresql.org/docs/current/pgupgrade.html)
- [pg_dumpæ–‡æ¡£](https://www.postgresql.org/docs/current/app-pgdump.html)

### ç›¸å…³æ–‡æ¡£

- [ä»MySQLè¿ç§»](./ä»MySQLè¿ç§».md)
- [ä»MongoDBè¿ç§»](./ä»MongoDBè¿ç§».md)
- [ä»ä¸“ç”¨å‘é‡æ•°æ®åº“è¿ç§»](./ä»ä¸“ç”¨å‘é‡æ•°æ®åº“è¿ç§».md)

---

## ğŸ“ æ›´æ–°æ—¥å¿—

- **2025-01**: åˆå§‹ç‰ˆæœ¬åˆ›å»º
  - å®Œæˆç‰ˆæœ¬å‡çº§åœºæ™¯åˆ†æ
  - å®Œæˆæ•°æ®åº“è¿ç§»åœºæ™¯
  - å®Œæˆè¿ç§»å·¥å…·å¯¹æ¯”ä¸é€‰å‹
  - å®Œæˆè¿ç§»é£é™©è¯„ä¼°åœºæ™¯

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**çŠ¶æ€**: âœ… å®Œæˆ
