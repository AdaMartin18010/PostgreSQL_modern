# 调试工具使用指南

> **创建日期**: 2025年1月
> **技术版本**: PostgreSQL 17+/18+
> **难度等级**: ⭐⭐⭐ 中级

---

## 📋 目录

- [调试工具使用指南](#调试工具使用指南)
  - [📋 目录](#-目录)
  - [1. 概述](#1-概述)
  - [2. pgAdmin调试](#2-pgadmin调试)
    - [2.1 调试PL/pgSQL](#21-调试plpgsql)
    - [2.2 设置断点](#22-设置断点)
  - [3. 查询分析器](#3-查询分析器)
    - [3.1 EXPLAIN ANALYZE](#31-explain-analyze)
    - [3.2 分析结果](#32-分析结果)
  - [4. 执行计划分析](#4-执行计划分析)
    - [4.1 查看执行计划](#41-查看执行计划)
    - [4.2 优化建议](#42-优化建议)
  - [5. 性能分析](#5-性能分析)
    - [5.1 pg\_stat\_statements](#51-pg_stat_statements)
    - [5.2 性能监控](#52-性能监控)
  - [📚 相关文档](#-相关文档)

---

## 1. 概述

调试工具帮助开发者诊断和解决PostgreSQL开发中的问题。

**调试工具**:

- pgAdmin调试器
- 查询分析器
- 执行计划分析
- 性能分析工具

---

## 2. pgAdmin调试

### 2.1 调试PL/pgSQL

```sql
-- 创建测试函数
CREATE OR REPLACE FUNCTION test_function()
RETURNS VOID AS $$
DECLARE
    v_count INT;
BEGIN
    SELECT COUNT(*) INTO v_count FROM users;
    RAISE NOTICE 'Count: %', v_count;
END;
$$ LANGUAGE plpgsql;
```

### 2.2 设置断点

```
1. 打开函数编辑器
2. 设置断点
3. 启动调试
4. 单步执行
```

---

## 3. 查询分析器

### 3.1 EXPLAIN ANALYZE

```sql
EXPLAIN (ANALYZE, BUFFERS, VERBOSE)
SELECT * FROM users WHERE email = 'test@example.com';
```

### 3.2 分析结果

```text
- 执行时间
- 扫描行数
- 缓冲区使用
- 索引使用情况
```

---

## 4. 执行计划分析

### 4.1 查看执行计划

```sql
-- 详细执行计划
EXPLAIN (ANALYZE, BUFFERS, VERBOSE, FORMAT JSON)
SELECT * FROM orders o
JOIN users u ON o.user_id = u.id
WHERE u.email = 'test@example.com';
```

### 4.2 优化建议

```text
1. 检查索引使用
2. 检查连接顺序
3. 检查过滤条件
4. 检查统计信息
```

---

## 5. 性能分析

### 5.1 pg_stat_statements

```sql
-- 查看慢查询
SELECT
    query,
    calls,
    total_exec_time,
    mean_exec_time
FROM pg_stat_statements
ORDER BY mean_exec_time DESC
LIMIT 10;
```

### 5.2 性能监控

```sql
-- 查看当前活动
SELECT
    pid,
    usename,
    application_name,
    state,
    query
FROM pg_stat_activity
WHERE state = 'active';
```

---

## 📚 相关文档

- [IDE配置指南.md](./IDE配置指南.md) - IDE配置完整指南
- [开发工具链.md](./开发工具链.md) - 开发工具链
- [代码生成工具.md](./代码生成工具.md) - 代码生成工具
- [22-工具与资源/README.md](../README.md) - 工具与资源主题

---

**最后更新**: 2025年1月
