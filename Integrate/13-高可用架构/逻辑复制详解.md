---

> **ğŸ“‹ æ–‡æ¡£æ¥æº**: `PostgreSQLåŸ¹è®­\09-é«˜å¯ç”¨\é€»è¾‘å¤åˆ¶è¯¦è§£.md`
> **ğŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŸæ–‡ä»¶ä¿æŒä¸å˜

---

# PostgreSQL é€»è¾‘å¤åˆ¶è¯¦è§£

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 17+/18+
> **æ–‡æ¡£ç¼–å·**: 03-03-27

## ğŸ“‘ ç›®å½•

- [1.1 æŠ€æœ¯èƒŒæ™¯](#11-æŠ€æœ¯èƒŒæ™¯)
- [1.2 æ ¸å¿ƒä»·å€¼](#12-æ ¸å¿ƒä»·å€¼)
- [1.3 å­¦ä¹ ç›®æ ‡](#13-å­¦ä¹ ç›®æ ‡)
- [1.4 é€»è¾‘å¤åˆ¶ä½“ç³»æ€ç»´å¯¼å›¾](#14-é€»è¾‘å¤åˆ¶ä½“ç³»æ€ç»´å¯¼å›¾)
- [2.0 é€»è¾‘å¤åˆ¶å½¢å¼åŒ–å®šä¹‰](#20-é€»è¾‘å¤åˆ¶å½¢å¼åŒ–å®šä¹‰)
- [2.1 é€»è¾‘å¤åˆ¶ vs æµå¤åˆ¶å¯¹æ¯”çŸ©é˜µ](#21-é€»è¾‘å¤åˆ¶-vs-æµå¤åˆ¶å¯¹æ¯”çŸ©é˜µ)
- [2.2 é€»è¾‘å¤åˆ¶é…ç½®](#22-é€»è¾‘å¤åˆ¶é…ç½®)
- [2.2.1 é€»è¾‘å¤åˆ¶å·¥ä½œåŸç†æ¦‚è¿°](#221-é€»è¾‘å¤åˆ¶å·¥ä½œåŸç†æ¦‚è¿°)
- [2.2.2 å‘å¸ƒç«¯é…ç½®](#222-å‘å¸ƒç«¯é…ç½®)
- [2.2.3 è®¢é˜…ç«¯é…ç½®](#223-è®¢é˜…ç«¯é…ç½®)
- [3.1 å‘å¸ƒç®¡ç†](#31-å‘å¸ƒç®¡ç†)
- [3.2 è®¢é˜…ç®¡ç†](#32-è®¢é˜…ç®¡ç†)
- [4.1 æ¡ˆä¾‹: æ•°æ®åˆ†å‘ç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰](#41-æ¡ˆä¾‹-æ•°æ®åˆ†å‘ç³»ç»ŸçœŸå®æ¡ˆä¾‹)
- [5.1 é…ç½®ä¼˜åŒ–](#51-é…ç½®ä¼˜åŒ–)
- [5.2 æ€§èƒ½ä¼˜åŒ–](#52-æ€§èƒ½ä¼˜åŒ–)
- [6.1 é€»è¾‘å¤åˆ¶åŸºç¡€å¸¸è§é—®é¢˜](#61-é€»è¾‘å¤åˆ¶åŸºç¡€å¸¸è§é—®é¢˜)
- [6.2 é€»è¾‘å¤åˆ¶æ€§èƒ½å¸¸è§é—®é¢˜](#62-é€»è¾‘å¤åˆ¶æ€§èƒ½å¸¸è§é—®é¢˜)
- [7.1 å®˜æ–¹æ–‡æ¡£](#71-å®˜æ–¹æ–‡æ¡£)
- [7.2 æŠ€æœ¯è®ºæ–‡](#72-æŠ€æœ¯è®ºæ–‡)
- [7.3 æŠ€æœ¯åšå®¢](#73-æŠ€æœ¯åšå®¢)
- [7.4 ç¤¾åŒºèµ„æº](#74-ç¤¾åŒºèµ„æº)
---

## 1. æ¦‚è¿°

### 1.1 æŠ€æœ¯èƒŒæ™¯

**é€»è¾‘å¤åˆ¶çš„ä»·å€¼**:

PostgreSQL é€»è¾‘å¤åˆ¶æä¾›äº†çµæ´»çš„æ•°æ®å¤åˆ¶æœºåˆ¶ï¼š

1. **è¡¨çº§å¤åˆ¶**: å¯ä»¥é€‰æ‹©æ€§åœ°å¤åˆ¶ç‰¹å®šè¡¨
2. **è·¨ç‰ˆæœ¬å¤åˆ¶**: æ”¯æŒä¸åŒç‰ˆæœ¬ä¹‹é—´çš„å¤åˆ¶
3. **æ•°æ®è½¬æ¢**: å¯ä»¥åœ¨å¤åˆ¶è¿‡ç¨‹ä¸­è½¬æ¢æ•°æ®
4. **å¤šä¸»å¤åˆ¶**: æ”¯æŒå¤šä¸»å¤åˆ¶åœºæ™¯

**åº”ç”¨åœºæ™¯**:

- **æ•°æ®åˆ†å‘**: å°†æ•°æ®åˆ†å‘åˆ°å¤šä¸ªæ•°æ®åº“
- **ç‰ˆæœ¬å‡çº§**: è·¨ç‰ˆæœ¬æ•°æ®è¿ç§»
- **æ•°æ®é›†æˆ**: é›†æˆå¤šä¸ªæ•°æ®æº
- **æŠ¥è¡¨æ•°æ®åº“**: æ„å»ºæŠ¥è¡¨æ•°æ®åº“

### 1.2 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯** (åŸºäºå®é™…åº”ç”¨æ•°æ®):

| ä»·å€¼é¡¹ | è¯´æ˜ | å½±å“ |
| --- | --- | --- |
| **çµæ´»æ€§** | è¡¨çº§é€‰æ‹©æ€§å¤åˆ¶ | **é«˜** |
| **è·¨ç‰ˆæœ¬** | æ”¯æŒè·¨ç‰ˆæœ¬å¤åˆ¶ | **é«˜** |
| **æ€§èƒ½** | é€»è¾‘å¤åˆ¶æ€§èƒ½ | **è‰¯å¥½** |
| **å¯æ‰©å±•æ€§** | æ”¯æŒå¤šè®¢é˜…è€… | **é«˜** |

**æ ¸å¿ƒä¼˜åŠ¿**:

- **çµæ´»æ€§**: è¡¨çº§é€‰æ‹©æ€§å¤åˆ¶ï¼Œçµæ´»é…ç½®
- **è·¨ç‰ˆæœ¬**: æ”¯æŒä¸åŒç‰ˆæœ¬ä¹‹é—´çš„å¤åˆ¶
- **æ€§èƒ½**: é€»è¾‘å¤åˆ¶æ€§èƒ½è‰¯å¥½ï¼Œæ»¡è¶³å¤§å¤šæ•°åœºæ™¯
- **å¯æ‰©å±•æ€§**: æ”¯æŒå¤šä¸ªè®¢é˜…è€…ï¼Œå¯æ‰©å±•æ€§å¼º

### 1.3 å­¦ä¹ ç›®æ ‡

- æŒæ¡é€»è¾‘å¤åˆ¶çš„é…ç½®
- ç†è§£å‘å¸ƒå’Œè®¢é˜…æœºåˆ¶
- å­¦ä¼šç›‘æ§å’Œç®¡ç†é€»è¾‘å¤åˆ¶
- æŒæ¡å®é™…åº”ç”¨åœºæ™¯

### 1.4 é€»è¾‘å¤åˆ¶ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((é€»è¾‘å¤åˆ¶ä½“ç³»))
    å‘å¸ƒç«¯
      å‘å¸ƒåˆ›å»º
        è¡¨çº§å‘å¸ƒ
        åˆ—çº§å‘å¸ƒ
        è¿‡æ»¤å‘å¸ƒ
      å‘å¸ƒç®¡ç†
        æ·»åŠ è¡¨
        åˆ é™¤è¡¨
        æ›´æ–°é…ç½®
      å‘å¸ƒç›‘æ§
        å‘å¸ƒçŠ¶æ€
        å¤åˆ¶å»¶è¿Ÿ
        é”™è¯¯å¤„ç†
    è®¢é˜…ç«¯
      è®¢é˜…åˆ›å»º
        è®¢é˜…é…ç½®
        è¿æ¥é…ç½®
        åŒæ­¥é…ç½®
      è®¢é˜…ç®¡ç†
        è®¢é˜…çŠ¶æ€
        åŒæ­¥çŠ¶æ€
        é”™è¯¯å¤„ç†
      è®¢é˜…ç›‘æ§
        å¤åˆ¶å»¶è¿Ÿ
        åŒæ­¥è¿›åº¦
        é”™è¯¯æ—¥å¿—
    å¤åˆ¶ç‰¹æ€§
      è¡¨çº§å¤åˆ¶
        é€‰æ‹©æ€§å¤åˆ¶
        çµæ´»é…ç½®
      è·¨ç‰ˆæœ¬å¤åˆ¶
        ç‰ˆæœ¬å…¼å®¹
        è¿ç§»æ”¯æŒ
      æ•°æ®è½¬æ¢
        æ•°æ®è¿‡æ»¤
        æ•°æ®è½¬æ¢
        æ•°æ®æ˜ å°„
    åº”ç”¨åœºæ™¯
      æ•°æ®åˆ†å‘
        å¤šæ•°æ®ä¸­å¿ƒ
        æ•°æ®åŒæ­¥
        è´Ÿè½½å‡è¡¡
      ç‰ˆæœ¬å‡çº§
        é›¶åœæœºå‡çº§
        æ•°æ®è¿ç§»
        å›æ»šæ”¯æŒ
      æŠ¥è¡¨æ•°æ®åº“
        åªè¯»å‰¯æœ¬
        æ•°æ®åˆ†æ
        æŠ¥è¡¨ç”Ÿæˆ
```

## 2. é€»è¾‘å¤åˆ¶å½¢å¼åŒ–å®šä¹‰

### 2.0 é€»è¾‘å¤åˆ¶å½¢å¼åŒ–å®šä¹‰

**é€»è¾‘å¤åˆ¶çš„æœ¬è´¨**ï¼šé€»è¾‘å¤åˆ¶æ˜¯é€šè¿‡è§£æWALæ—¥å¿—ï¼Œæå–é€»è¾‘å˜æ›´ï¼Œå¹¶åœ¨è®¢é˜…ç«¯é‡æ”¾è¿™äº›å˜æ›´ï¼Œå®ç°è¡¨çº§æ•°æ®å¤åˆ¶ã€‚

**å®šä¹‰ 1ï¼ˆé€»è¾‘å¤åˆ¶ï¼‰**ï¼š
è®¾ LogicalReplication = {publication, subscription, replication_slot}ï¼Œå…¶ä¸­ï¼š

- publicationï¼šå‘å¸ƒï¼ˆè¡¨é›†åˆï¼‰
- subscriptionï¼šè®¢é˜…ï¼ˆè¿æ¥å’Œå‘å¸ƒï¼‰
- replication_slotï¼šå¤åˆ¶æ§½ï¼ˆWALä½ç½®è·Ÿè¸ªï¼‰

**å®šä¹‰ 2ï¼ˆå‘å¸ƒï¼‰**ï¼š
è®¾ Publication = {tables, operations, filter}ï¼Œå…¶ä¸­ï¼š

- tablesï¼šè¡¨é›†åˆ
- operations âˆˆ {INSERT, UPDATE, DELETE, TRUNCATE}ï¼šæ“ä½œç±»å‹
- filterï¼šè¿‡æ»¤æ¡ä»¶ï¼ˆå¯é€‰ï¼‰

**å®šä¹‰ 3ï¼ˆè®¢é˜…ï¼‰**ï¼š
è®¾ Subscription = {connection, publications, slot}ï¼Œå…¶ä¸­ï¼š

- connectionï¼šè¿æ¥ä¿¡æ¯ï¼ˆä¸»åº“åœ°å€ã€ç”¨æˆ·ç­‰ï¼‰
- publicationsï¼šå‘å¸ƒé›†åˆ
- slotï¼šå¤åˆ¶æ§½åç§°

**å®šä¹‰ 4ï¼ˆå¤åˆ¶å»¶è¿Ÿï¼‰**ï¼š
è®¾ ReplicationLag = {lsn_diff, time_diff}ï¼Œå…¶ä¸­ï¼š

- lsn_diffï¼šLSNå·®å€¼ï¼ˆå­—èŠ‚ï¼‰
- time_diffï¼šæ—¶é—´å·®å€¼ï¼ˆç§’ï¼‰

**å½¢å¼åŒ–è¯æ˜**ï¼š

**å®šç† 1ï¼ˆé€»è¾‘å¤åˆ¶æ­£ç¡®æ€§ï¼‰**ï¼š
å¦‚æœå¤åˆ¶æ§½æ­£ç¡®ç®¡ç†ï¼Œåˆ™é€»è¾‘å¤åˆ¶ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚

**è¯æ˜**ï¼š

1. æ ¹æ®å®šä¹‰1ï¼Œé€»è¾‘å¤åˆ¶ä½¿ç”¨å¤åˆ¶æ§½è·Ÿè¸ªWALä½ç½®
2. å¤åˆ¶æ§½æ­£ç¡®ç®¡ç†ï¼Œç¡®ä¿ä¸ä¸¢å¤±WAL
3. è®¢é˜…ç«¯æŒ‰é¡ºåºé‡æ”¾å˜æ›´
4. å› æ­¤ï¼Œé€»è¾‘å¤åˆ¶ä¿è¯æ•°æ®ä¸€è‡´æ€§

**å®šç† 2ï¼ˆé€»è¾‘å¤åˆ¶æ€§èƒ½ï¼‰**ï¼š
é€»è¾‘å¤åˆ¶çš„æ€§èƒ½ä¸WALè§£æé€Ÿåº¦å’Œç½‘ç»œå»¶è¿Ÿæˆæ­£æ¯”ã€‚

**è¯æ˜**ï¼š

1. é€»è¾‘å¤åˆ¶éœ€è¦è§£æWALæ—¥å¿—
2. WALè§£æé€Ÿåº¦è¶Šå¿«ï¼Œå¤åˆ¶æ€§èƒ½è¶Šå¥½
3. ç½‘ç»œå»¶è¿Ÿè¶Šå°ï¼Œå¤åˆ¶å»¶è¿Ÿè¶Šå°
4. å› æ­¤ï¼Œé€»è¾‘å¤åˆ¶æ€§èƒ½ä¸WALè§£æé€Ÿåº¦å’Œç½‘ç»œå»¶è¿Ÿæˆæ­£æ¯”

**å®é™…åº”ç”¨**ï¼š

- é€»è¾‘å¤åˆ¶åˆ©ç”¨å½¢å¼åŒ–å®šä¹‰è¿›è¡Œé…ç½®è®¾è®¡
- å‘å¸ƒè®¢é˜…ç³»ç»Ÿåˆ©ç”¨å½¢å¼åŒ–å®šä¹‰è¿›è¡Œæ•°æ®åˆ†å‘
- å¤åˆ¶ç›‘æ§åˆ©ç”¨å½¢å¼åŒ–å®šä¹‰è¿›è¡Œå»¶è¿Ÿè®¡ç®—

### 2.1 é€»è¾‘å¤åˆ¶ vs æµå¤åˆ¶å¯¹æ¯”çŸ©é˜µ

**é€»è¾‘å¤åˆ¶å’Œæµå¤åˆ¶çš„é€‰æ‹©æ˜¯æ•°æ®å¤åˆ¶æ–¹æ¡ˆçš„å…³é”®å†³ç­–**ï¼Œé€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆå¯ä»¥æ»¡è¶³ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚ã€‚

**é€»è¾‘å¤åˆ¶ vs æµå¤åˆ¶å¯¹æ¯”çŸ©é˜µ**ï¼š

| ç‰¹æ€§ | é€»è¾‘å¤åˆ¶ | æµå¤åˆ¶ | æ¨èåœºæ™¯ | ç»¼åˆè¯„åˆ† |
|------|---------|--------|---------|---------|
| **å¤åˆ¶ç²’åº¦** | â­â­â­â­â­ | â­â­â­ | è¡¨çº§å¤åˆ¶ | é€»è¾‘å¤åˆ¶ |
| **è·¨ç‰ˆæœ¬æ”¯æŒ** | â­â­â­â­â­ | â­â­ | è·¨ç‰ˆæœ¬å¤åˆ¶ | é€»è¾‘å¤åˆ¶ |
| **æ€§èƒ½** | â­â­â­â­ | â­â­â­â­â­ | é«˜æ€§èƒ½å¤åˆ¶ | æµå¤åˆ¶ |
| **æ•°æ®ä¸€è‡´æ€§** | â­â­â­â­ | â­â­â­â­â­ | å¼ºä¸€è‡´æ€§ | æµå¤åˆ¶ |
| **çµæ´»æ€§** | â­â­â­â­â­ | â­â­â­ | çµæ´»é…ç½® | é€»è¾‘å¤åˆ¶ |
| **é€‚ç”¨åœºæ™¯** | â­â­â­â­â­ | â­â­â­â­â­ | ä¸åŒåœºæ™¯ | ç›¸åŒ |

**é€»è¾‘å¤åˆ¶ vs æµå¤åˆ¶é€‰æ‹©å†³ç­–æµç¨‹**ï¼š

```mermaid
flowchart TD
    A[éœ€è¦æ•°æ®å¤åˆ¶] --> B{å¤åˆ¶éœ€æ±‚}
    B -->|è¡¨çº§å¤åˆ¶| C[ä½¿ç”¨é€»è¾‘å¤åˆ¶]
    B -->|å…¨åº“å¤åˆ¶| D{ä¸€è‡´æ€§è¦æ±‚}
    B -->|è·¨ç‰ˆæœ¬å¤åˆ¶| C
    D -->|å¼ºä¸€è‡´æ€§| E[ä½¿ç”¨æµå¤åˆ¶]
    D -->|æ€§èƒ½ä¼˜å…ˆ| F{å¤åˆ¶ç²’åº¦}
    F -->|è¡¨çº§| C
    F -->|å…¨åº“| E
    C --> G[å®æ–½å¤åˆ¶]
    E --> G
    G --> H[éªŒè¯å¤åˆ¶æ•ˆæœ]
    H --> I{å¤åˆ¶æ»¡è¶³è¦æ±‚?}
    I -->|æ˜¯| J[å¤åˆ¶é…ç½®å®Œæˆ]
    I -->|å¦| K{é—®é¢˜åˆ†æ}
    K -->|æ€§èƒ½é—®é¢˜| L{æ˜¯å¦éœ€è¦ä¼˜åŒ–?}
    K -->|åŠŸèƒ½é—®é¢˜| M[é€‰æ‹©å…¶ä»–æ–¹æ¡ˆ]
    L -->|æ˜¯| N[ä¼˜åŒ–å¤åˆ¶é…ç½®]
    L -->|å¦| O[é€‰æ‹©å…¶ä»–æ–¹æ¡ˆ]
    N --> H
    O --> B
    M --> B

    style B fill:#FFD700
    style I fill:#90EE90
    style J fill:#90EE90
```

### 2.2 é€»è¾‘å¤åˆ¶é…ç½®

### 2.2.1 é€»è¾‘å¤åˆ¶å·¥ä½œåŸç†æ¦‚è¿°

**é€»è¾‘å¤åˆ¶çš„æœ¬è´¨**ï¼š

é€»è¾‘å¤åˆ¶ï¼ˆLogical Replicationï¼‰æ˜¯ PostgreSQL 10+ å¼•å…¥çš„è¡¨çº§å¤åˆ¶æŠ€æœ¯ï¼Œ
é€šè¿‡è§£æ WAL ä¸­çš„é€»è¾‘å˜æ›´è®°å½•ï¼ˆINSERTã€UPDATEã€DELETEï¼‰ï¼Œ
å°†å˜æ›´ä»¥ SQL è¯­å¥çš„å½¢å¼ä¼ è¾“åˆ°è®¢é˜…ç«¯å¹¶æ‰§è¡Œï¼Œå®ç°è¡¨çº§æ•°æ®åŒæ­¥ã€‚

**é€»è¾‘å¤åˆ¶æ¶æ„å›¾**ï¼š

```mermaid
flowchart TD
    A[å‘å¸ƒç«¯ Publisher] -->|WAL é€»è¾‘è§£ç | B[é€»è¾‘è§£ç è¿›ç¨‹]
    B -->|å˜æ›´è®°å½•| C[å¤åˆ¶æ§½ Replication Slot]
    C -->|å˜æ›´æµ| D[è®¢é˜…ç«¯ Subscriber]
    D -->|åº”ç”¨å˜æ›´| E[è®¢é˜…ç«¯è¡¨]

    F[åº”ç”¨å†™å…¥] --> A
    A --> G[WAL æ–‡ä»¶]
    G --> B

    H[å‘å¸ƒ Publication] --> A
    I[è®¢é˜… Subscription] --> D

    style A fill:#87CEEB
    style D fill:#90EE90
    style C fill:#FFD700
```

**é€»è¾‘å¤åˆ¶å·¥ä½œæµç¨‹**ï¼š

```mermaid
flowchart TD
    A[ä¸»åº“äº‹åŠ¡æäº¤] --> B[å†™å…¥ WAL]
    B --> C[é€»è¾‘è§£ç è¿›ç¨‹è¯»å– WAL]
    C --> D[è§£æé€»è¾‘å˜æ›´]
    D --> E{å˜æ›´ç±»å‹}
    E -->|INSERT| F[ç”Ÿæˆ INSERT è¯­å¥]
    E -->|UPDATE| G[ç”Ÿæˆ UPDATE è¯­å¥]
    E -->|DELETE| H[ç”Ÿæˆ DELETE è¯­å¥]
    F --> I[ä¼ è¾“åˆ°è®¢é˜…ç«¯]
    G --> I
    H --> I
    I --> J[è®¢é˜…ç«¯åº”ç”¨å˜æ›´]
    J --> K[è®¢é˜…ç«¯æ•°æ®æ›´æ–°]

    style C fill:#FFD700
    style I fill:#90EE90
```

**é€»è¾‘å¤åˆ¶ vs æµå¤åˆ¶**ï¼š

| ç‰¹æ€§ | é€»è¾‘å¤åˆ¶ | æµå¤åˆ¶ |
|------|---------|--------|
| **å¤åˆ¶ç²’åº¦** | è¡¨çº§ | æ•°æ®åº“çº§ |
| **é€‰æ‹©æ€§** | å¯é€‰æ‹©è¡¨ | å…¨éƒ¨å¤åˆ¶ |
| **è·¨ç‰ˆæœ¬** | æ”¯æŒ | ä¸æ”¯æŒ |
| **æ€§èƒ½** | ä¸­ç­‰ | é«˜ |
| **æ•°æ®ä¸€è‡´æ€§** | æœ€ç»ˆä¸€è‡´ | å¼ºä¸€è‡´ |

### 2.2.2 å‘å¸ƒç«¯é…ç½®

**å‘å¸ƒç«¯é…ç½®** (postgresql.conf):

```conf
# å¯ç”¨é€»è¾‘å¤åˆ¶
wal_level = logical  # å¿…é¡»è®¾ç½®ä¸º logical
max_replication_slots = 10  # æœ€å¤§å¤åˆ¶æ§½æ•°ï¼ˆæ¯ä¸ªè®¢é˜…éœ€è¦ä¸€ä¸ªæ§½ï¼‰
max_wal_senders = 10  # æœ€å¤§ WAL sender è¿›ç¨‹æ•°
max_logical_replication_workers = 4  # æœ€å¤§é€»è¾‘å¤åˆ¶å·¥ä½œè¿›ç¨‹æ•°
max_sync_workers_per_subscription = 2  # æ¯ä¸ªè®¢é˜…çš„æœ€å¤§åŒæ­¥å·¥ä½œè¿›ç¨‹æ•°
```

**åˆ›å»ºå‘å¸ƒ**:

```sql
-- 1. åˆ›å»ºåŸºæœ¬å‘å¸ƒï¼ˆå‘å¸ƒå¤šä¸ªè¡¨ï¼Œå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    IF EXISTS (
        SELECT 1 FROM pg_publication WHERE pubname = 'my_publication'
    ) THEN
        RAISE WARNING 'å‘å¸ƒmy_publicationå·²å­˜åœ¨';
        RETURN;
    END IF;

    IF NOT EXISTS (
        SELECT 1 FROM information_schema.tables
        WHERE table_schema = 'public' AND table_name = 'users'
    ) THEN
        RAISE EXCEPTION 'è¡¨usersä¸å­˜åœ¨ï¼Œè¯·å…ˆåˆ›å»º';
    END IF;

    CREATE PUBLICATION my_publication
    FOR TABLE users, orders, products;
    RAISE NOTICE 'å‘å¸ƒmy_publicationåˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN duplicate_object THEN
        RAISE WARNING 'å‘å¸ƒmy_publicationå·²å­˜åœ¨';
    WHEN undefined_table THEN
        RAISE EXCEPTION 'ç›¸å…³è¡¨ä¸å­˜åœ¨';
    WHEN insufficient_privilege THEN
        RAISE EXCEPTION 'æƒé™ä¸è¶³ï¼Œæ— æ³•åˆ›å»ºå‘å¸ƒ';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºå‘å¸ƒå¤±è´¥: %', SQLERRM;
END $$;

-- 2. å‘å¸ƒæ‰€æœ‰è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    IF EXISTS (
        SELECT 1 FROM pg_publication WHERE pubname = 'all_tables'
    ) THEN
        RAISE WARNING 'å‘å¸ƒall_tableså·²å­˜åœ¨';
        RETURN;
    END IF;

    CREATE PUBLICATION all_tables FOR ALL TABLES;
    RAISE NOTICE 'å‘å¸ƒall_tablesåˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN duplicate_object THEN
        RAISE WARNING 'å‘å¸ƒall_tableså·²å­˜åœ¨';
    WHEN insufficient_privilege THEN
        RAISE EXCEPTION 'æƒé™ä¸è¶³ï¼Œæ— æ³•åˆ›å»ºå‘å¸ƒ';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºå‘å¸ƒå¤±è´¥: %', SQLERRM;
END $$;

-- 3. å‘å¸ƒç‰¹å®šåˆ—ï¼ˆPostgreSQL 15+ï¼Œå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    IF EXISTS (
        SELECT 1 FROM pg_publication WHERE pubname = 'users_publication'
    ) THEN
        RAISE WARNING 'å‘å¸ƒusers_publicationå·²å­˜åœ¨';
        RETURN;
    END IF;

    IF NOT EXISTS (
        SELECT 1 FROM information_schema.tables
        WHERE table_schema = 'public' AND table_name = 'users'
    ) THEN
        RAISE EXCEPTION 'è¡¨usersä¸å­˜åœ¨ï¼Œè¯·å…ˆåˆ›å»º';
    END IF;

    CREATE PUBLICATION users_publication
    FOR TABLE users (id, name, email);
    RAISE NOTICE 'å‘å¸ƒusers_publicationåˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN duplicate_object THEN
        RAISE WARNING 'å‘å¸ƒusers_publicationå·²å­˜åœ¨';
    WHEN undefined_table THEN
        RAISE EXCEPTION 'è¡¨usersä¸å­˜åœ¨';
    WHEN insufficient_privilege THEN
        RAISE EXCEPTION 'æƒé™ä¸è¶³ï¼Œæ— æ³•åˆ›å»ºå‘å¸ƒ';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºå‘å¸ƒå¤±è´¥: %', SQLERRM;
END $$;

-- 4. åˆ›å»ºå¸¦è¿‡æ»¤æ¡ä»¶çš„å‘å¸ƒï¼ˆPostgreSQL 15+ï¼Œå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    IF EXISTS (
        SELECT 1 FROM pg_publication WHERE pubname = 'active_users_publication'
    ) THEN
        RAISE WARNING 'å‘å¸ƒactive_users_publicationå·²å­˜åœ¨';
        RETURN;
    END IF;

    IF NOT EXISTS (
        SELECT 1 FROM information_schema.tables
        WHERE table_schema = 'public' AND table_name = 'users'
    ) THEN
        RAISE EXCEPTION 'è¡¨usersä¸å­˜åœ¨ï¼Œè¯·å…ˆåˆ›å»º';
    END IF;

    CREATE PUBLICATION active_users_publication
    FOR TABLE users
    WHERE (status = 'active');
    RAISE NOTICE 'å‘å¸ƒactive_users_publicationåˆ›å»ºæˆåŠŸ';
EXCEPTION
    WHEN duplicate_object THEN
        RAISE WARNING 'å‘å¸ƒactive_users_publicationå·²å­˜åœ¨';
    WHEN undefined_table THEN
        RAISE EXCEPTION 'è¡¨usersä¸å­˜åœ¨';
    WHEN insufficient_privilege THEN
        RAISE EXCEPTION 'æƒé™ä¸è¶³ï¼Œæ— æ³•åˆ›å»ºå‘å¸ƒ';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºå‘å¸ƒå¤±è´¥: %', SQLERRM;
END $$;

-- 5. æŸ¥çœ‹å‘å¸ƒä¿¡æ¯ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
DECLARE
    publication_count INT;
BEGIN
    IF NOT EXISTS (
        SELECT 1 FROM information_schema.tables
        WHERE table_schema = 'pg_catalog' AND table_name = 'pg_publication'
    ) THEN
        RAISE WARNING 'pg_publicationè¡¨ä¸å­˜åœ¨';
        RETURN;
    END IF;

    SELECT COUNT(*) INTO publication_count
    FROM pg_publication;

    IF publication_count > 0 THEN
        RAISE NOTICE 'å‘ç° % ä¸ªå‘å¸ƒ', publication_count;
    ELSE
        RAISE NOTICE 'æœªå‘ç°å‘å¸ƒ';
    END IF;
EXCEPTION
    WHEN undefined_table THEN
        RAISE WARNING 'pg_publicationè¡¨ä¸å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'æŸ¥çœ‹å‘å¸ƒä¿¡æ¯å¤±è´¥: %', SQLERRM;
END $$;

EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT
    pubname AS publication_name,
    puballtables AS all_tables,
    pubinsert AS insert_enabled,
    pubupdate AS update_enabled,
    pubdelete AS delete_enabled,
    pubtruncate AS truncate_enabled
FROM pg_publication;
-- æ‰§è¡Œæ—¶é—´: <10ms
-- è®¡åˆ’: Seq Scan

-- 6. æŸ¥çœ‹å‘å¸ƒåŒ…å«çš„è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
DECLARE
    table_count INT;
BEGIN
    IF NOT EXISTS (
        SELECT 1 FROM information_schema.views
        WHERE table_schema = 'pg_catalog' AND table_name = 'pg_publication_tables'
    ) THEN
        RAISE WARNING 'pg_publication_tablesè§†å›¾ä¸å­˜åœ¨';
        RETURN;
    END IF;

    SELECT COUNT(*) INTO table_count
    FROM pg_publication_tables
    WHERE pubname = 'my_publication';

    IF table_count > 0 THEN
        RAISE NOTICE 'å‘å¸ƒmy_publicationåŒ…å« % ä¸ªè¡¨', table_count;
    ELSE
        RAISE NOTICE 'å‘å¸ƒmy_publicationæœªåŒ…å«è¡¨';
    END IF;
EXCEPTION
    WHEN undefined_table THEN
        RAISE WARNING 'pg_publication_tablesè§†å›¾ä¸å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'æŸ¥çœ‹å‘å¸ƒåŒ…å«çš„è¡¨å¤±è´¥: %', SQLERRM;
END $$;

EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT
    pubname AS publication_name,
    schemaname,
    tablename
FROM pg_publication_tables
WHERE pubname = 'my_publication';
-- æ‰§è¡Œæ—¶é—´: <50ms
-- è®¡åˆ’: Seq Scan

-- 7. æ·»åŠ è¡¨åˆ°å‘å¸ƒï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    IF NOT EXISTS (
        SELECT 1 FROM pg_publication WHERE pubname = 'my_publication'
    ) THEN
        RAISE EXCEPTION 'å‘å¸ƒmy_publicationä¸å­˜åœ¨';
    END IF;

    IF NOT EXISTS (
        SELECT 1 FROM information_schema.tables
        WHERE table_schema = 'public' AND table_name = 'new_table'
    ) THEN
        RAISE EXCEPTION 'è¡¨new_tableä¸å­˜åœ¨';
    END IF;

    ALTER PUBLICATION my_publication ADD TABLE new_table;
    RAISE NOTICE 'è¡¨new_tableå·²æ·»åŠ åˆ°å‘å¸ƒmy_publication';
EXCEPTION
    WHEN undefined_object THEN
        RAISE EXCEPTION 'å‘å¸ƒmy_publicationæˆ–è¡¨new_tableä¸å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'æ·»åŠ è¡¨åˆ°å‘å¸ƒå¤±è´¥: %', SQLERRM;
END $$;

-- 8. ä»å‘å¸ƒä¸­ç§»é™¤è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    IF NOT EXISTS (
        SELECT 1 FROM pg_publication WHERE pubname = 'my_publication'
    ) THEN
        RAISE EXCEPTION 'å‘å¸ƒmy_publicationä¸å­˜åœ¨';
    END IF;

    ALTER PUBLICATION my_publication DROP TABLE old_table;
    RAISE NOTICE 'è¡¨old_tableå·²ä»å‘å¸ƒmy_publicationä¸­ç§»é™¤';
EXCEPTION
    WHEN undefined_object THEN
        RAISE EXCEPTION 'å‘å¸ƒmy_publicationä¸å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'ä»å‘å¸ƒä¸­ç§»é™¤è¡¨å¤±è´¥: %', SQLERRM;
END $$;

-- 9. è®¾ç½®å‘å¸ƒæ“ä½œç±»å‹ï¼ˆåªå‘å¸ƒ INSERT å’Œ UPDATEï¼Œå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    IF NOT EXISTS (
        SELECT 1 FROM pg_publication WHERE pubname = 'my_publication'
    ) THEN
        RAISE EXCEPTION 'å‘å¸ƒmy_publicationä¸å­˜åœ¨';
    END IF;

    ALTER PUBLICATION my_publication SET (publish = 'insert,update');
    RAISE NOTICE 'å‘å¸ƒmy_publicationæ“ä½œç±»å‹å·²è®¾ç½®ä¸ºinsert,update';
EXCEPTION
    WHEN undefined_object THEN
        RAISE EXCEPTION 'å‘å¸ƒmy_publicationä¸å­˜åœ¨';
    WHEN invalid_parameter_value THEN
        RAISE EXCEPTION 'æ— æ•ˆçš„å‘å¸ƒæ“ä½œç±»å‹';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'è®¾ç½®å‘å¸ƒæ“ä½œç±»å‹å¤±è´¥: %', SQLERRM;
END $$;

-- 10. åˆ›å»ºå‘å¸ƒç”¨æˆ·ï¼ˆéœ€è¦ REPLICATION æƒé™ï¼Œå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    IF EXISTS (
        SELECT 1 FROM pg_roles WHERE rolname = 'replicator'
    ) THEN
        RAISE WARNING 'ç”¨æˆ·replicatorå·²å­˜åœ¨';
        RETURN;
    END IF;

    CREATE USER replicator WITH REPLICATION PASSWORD 'password';
    GRANT SELECT ON ALL TABLES IN SCHEMA public TO replicator;
    RAISE NOTICE 'ç”¨æˆ·replicatoråˆ›å»ºæˆåŠŸï¼Œå·²æˆäºˆSELECTæƒé™';
EXCEPTION
    WHEN duplicate_object THEN
        RAISE WARNING 'ç”¨æˆ·replicatorå·²å­˜åœ¨';
    WHEN insufficient_privilege THEN
        RAISE EXCEPTION 'æƒé™ä¸è¶³ï¼Œæ— æ³•åˆ›å»ºç”¨æˆ·æˆ–æˆäºˆæƒé™';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºå‘å¸ƒç”¨æˆ·å¤±è´¥: %', SQLERRM;
END $$;
```

### 2.2.3 è®¢é˜…ç«¯é…ç½®

**åˆ›å»ºè®¢é˜…**:

```sql
-- 1. åˆ›å»ºåŸºæœ¬è®¢é˜…
CREATE SUBSCRIPTION my_subscription
CONNECTION 'host=primary_host port=5432 user=replicator password=password dbname=mydb'
PUBLICATION my_publication;

-- 2. åˆ›å»ºè®¢é˜…ï¼ˆæŒ‡å®šå¤åˆ¶æ§½åç§°ï¼‰
CREATE SUBSCRIPTION my_subscription
CONNECTION 'host=primary_host port=5432 user=replicator password=password dbname=mydb'
PUBLICATION my_publication
WITH (slot_name = 'my_subscription_slot');

-- 3. åˆ›å»ºè®¢é˜…ï¼ˆç¦ç”¨å¤åˆ¶æ§½ï¼Œæ‰‹åŠ¨ç®¡ç†ï¼‰
CREATE SUBSCRIPTION my_subscription
CONNECTION 'host=primary_host port=5432 user=replicator password=password dbname=mydb'
PUBLICATION my_publication
WITH (create_slot = false);

-- 4. åˆ›å»ºè®¢é˜…ï¼ˆæŒ‡å®šåŒæ­¥è¡¨ï¼‰
CREATE SUBSCRIPTION my_subscription
CONNECTION 'host=primary_host port=5432 user=replicator password=password dbname=mydb'
PUBLICATION my_publication
WITH (synchronous_commit = 'local');

-- 5. æŸ¥çœ‹è®¢é˜…ä¿¡æ¯ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
DECLARE
    subscription_count INT;
BEGIN
    SELECT COUNT(*) INTO subscription_count
    FROM pg_subscription;

    RAISE NOTICE 'æ‰¾åˆ° % ä¸ªè®¢é˜…', subscription_count;
EXCEPTION
    WHEN undefined_table THEN
        RAISE WARNING 'pg_subscriptionè§†å›¾ä¸å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'æŸ¥çœ‹è®¢é˜…ä¿¡æ¯å¤±è´¥: %', SQLERRM;
END $$;

EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT
    subname AS subscription_name,
    subenabled AS enabled,
    subslotname AS slot_name,
    subpublications AS publications
FROM pg_subscription;
-- æ‰§è¡Œæ—¶é—´: <50ms
-- è®¡åˆ’: Seq Scan

-- 6. æŸ¥çœ‹è®¢é˜…çŠ¶æ€ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
DECLARE
    subscription_count INT;
BEGIN
    SELECT COUNT(*) INTO subscription_count
    FROM pg_stat_subscription;

    RAISE NOTICE 'æ‰¾åˆ° % ä¸ªè®¢é˜…çŠ¶æ€è®°å½•', subscription_count;
EXCEPTION
    WHEN undefined_table THEN
        RAISE WARNING 'pg_stat_subscriptionè§†å›¾ä¸å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'æŸ¥çœ‹è®¢é˜…çŠ¶æ€å¤±è´¥: %', SQLERRM;
END $$;

EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT
    subname AS subscription_name,
    pid,
    received_lsn,
    latest_end_lsn,
    latest_end_time,
    slot_name,
    active,
    sync_state
FROM pg_stat_subscription;
-- æ‰§è¡Œæ—¶é—´: <50ms
-- è®¡åˆ’: Seq Scan

-- 7. æŸ¥çœ‹è®¢é˜…å»¶è¿Ÿï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
DECLARE
    subscription_count INT;
BEGIN
    SELECT COUNT(*) INTO subscription_count
    FROM pg_stat_subscription;

    IF subscription_count = 0 THEN
        RAISE WARNING 'æœªæ‰¾åˆ°è®¢é˜…çŠ¶æ€è®°å½•';
    ELSE
        RAISE NOTICE 'æ‰¾åˆ° % ä¸ªè®¢é˜…çŠ¶æ€è®°å½•', subscription_count;
    END IF;
EXCEPTION
    WHEN undefined_table THEN
        RAISE WARNING 'pg_stat_subscriptionè§†å›¾ä¸å­˜åœ¨';
    WHEN undefined_function THEN
        RAISE WARNING 'pg_current_wal_lsnæˆ–pg_wal_lsn_diffå‡½æ•°ä¸å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'æŸ¥çœ‹è®¢é˜…å»¶è¿Ÿå¤±è´¥: %', SQLERRM;
END $$;

EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT
    subname AS subscription_name,
    pg_wal_lsn_diff(
        pg_current_wal_lsn(),
        latest_end_lsn
    ) AS replication_lag_bytes,
    pg_size_pretty(
        pg_wal_lsn_diff(
            pg_current_wal_lsn(),
            latest_end_lsn
        )
    ) AS replication_lag_size,
    latest_end_time,
    NOW() - latest_end_time AS replication_lag_time
FROM pg_stat_subscription;
-- æ‰§è¡Œæ—¶é—´: <100ms
-- è®¡åˆ’: Seq Scan

-- 8. æš‚åœè®¢é˜…
ALTER SUBSCRIPTION my_subscription DISABLE;

-- 9. æ¢å¤è®¢é˜…
ALTER SUBSCRIPTION my_subscription ENABLE;

-- 10. åˆ·æ–°è®¢é˜…ï¼ˆé‡æ–°åŒæ­¥æ•°æ®ï¼‰
ALTER SUBSCRIPTION my_subscription REFRESH PUBLICATION;

-- 11. æ›´æ–°è®¢é˜…è¿æ¥ä¿¡æ¯
ALTER SUBSCRIPTION my_subscription
CONNECTION 'host=new_primary_host port=5432 user=replicator password=password dbname=mydb';

-- 12. æ·»åŠ å‘å¸ƒåˆ°è®¢é˜…
ALTER SUBSCRIPTION my_subscription ADD PUBLICATION new_publication;

-- 13. ä»è®¢é˜…ä¸­ç§»é™¤å‘å¸ƒ
ALTER SUBSCRIPTION my_subscription DROP PUBLICATION old_publication;

-- 14. åˆ é™¤è®¢é˜…
DROP SUBSCRIPTION my_subscription;

-- 15. åˆ é™¤è®¢é˜…ï¼ˆåŒæ—¶åˆ é™¤å¤åˆ¶æ§½ï¼‰
DROP SUBSCRIPTION my_subscription WITH (drop_slot = true);
```

## 3. å‘å¸ƒå’Œè®¢é˜…

### 3.1 å‘å¸ƒç®¡ç†

**å‘å¸ƒæ“ä½œ**:

```sql
-- æ·»åŠ è¡¨åˆ°å‘å¸ƒ
ALTER PUBLICATION my_publication ADD TABLE new_table;

-- ä»å‘å¸ƒä¸­ç§»é™¤è¡¨
ALTER PUBLICATION my_publication DROP TABLE old_table;

-- æŸ¥çœ‹å‘å¸ƒ
SELECT * FROM pg_publication;
SELECT * FROM pg_publication_tables;
```

### 3.2 è®¢é˜…ç®¡ç†

**è®¢é˜…æ“ä½œ**:

```sql
-- æš‚åœè®¢é˜…
ALTER SUBSCRIPTION my_subscription DISABLE;

-- æ¢å¤è®¢é˜…
ALTER SUBSCRIPTION my_subscription ENABLE;

-- åˆ é™¤è®¢é˜…
DROP SUBSCRIPTION my_subscription;

-- æŸ¥çœ‹è®¢é˜…å»¶è¿Ÿ
SELECT
    subname,
    pg_wal_lsn_diff(
        pg_current_wal_lsn(),
        latest_end_lsn
    ) AS replication_lag
FROM pg_stat_subscription;
```

## 4. å®é™…åº”ç”¨æ¡ˆä¾‹

### 4.1 æ¡ˆä¾‹: æ•°æ®åˆ†å‘ç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸä¼ä¸šéœ€è¦å°†è®¢å•æ•°æ®åˆ†å‘åˆ°å¤šä¸ªæŠ¥è¡¨æ•°æ®åº“ï¼Œéœ€è¦é€‰æ‹©åˆé€‚çš„æ•°æ®å¤åˆ¶æ–¹æ¡ˆã€‚

**é—®é¢˜åˆ†æ**:

1. **å¤åˆ¶éœ€æ±‚**: éœ€è¦å°†è®¢å•æ•°æ®åˆ†å‘åˆ°å¤šä¸ªæ•°æ®åº“
2. **å¤åˆ¶ç²’åº¦**: åªéœ€è¦å¤åˆ¶è®¢å•è¡¨ï¼Œä¸éœ€è¦å…¨åº“å¤åˆ¶
3. **è·¨ç‰ˆæœ¬**: ä¸»åº“PostgreSQL 16ï¼ŒæŠ¥è¡¨åº“PostgreSQL 17
4. **æ€§èƒ½è¦æ±‚**: éœ€è¦å®æ—¶æˆ–å‡†å®æ—¶å¤åˆ¶

**é€»è¾‘å¤åˆ¶ vs æµå¤åˆ¶é€‰æ‹©å†³ç­–è®ºè¯**:

**é—®é¢˜**: å¦‚ä½•ä¸ºæ•°æ®åˆ†å‘ç³»ç»Ÿé€‰æ‹©åˆé€‚çš„æ•°æ®å¤åˆ¶æ–¹æ¡ˆï¼Ÿ

**æ–¹æ¡ˆåˆ†æ**:

**æ–¹æ¡ˆ1ï¼šé€»è¾‘å¤åˆ¶**:

- **æè¿°**: ä½¿ç”¨é€»è¾‘å¤åˆ¶å®ç°è¡¨çº§å¤åˆ¶
- **ä¼˜ç‚¹**:
  - è¡¨çº§å¤åˆ¶ï¼Œçµæ´»é…ç½®
  - æ”¯æŒè·¨ç‰ˆæœ¬å¤åˆ¶
  - å¯ä»¥é€‰æ‹©æ€§å¤åˆ¶è¡¨
  - æ”¯æŒè¿‡æ»¤æ¡ä»¶
- **ç¼ºç‚¹**:
  - æ€§èƒ½ç›¸å¯¹è¾ƒä½ï¼ˆéœ€è¦è§£æWALï¼‰
  - é…ç½®ç›¸å¯¹å¤æ‚
- **é€‚ç”¨åœºæ™¯**: è¡¨çº§å¤åˆ¶ã€è·¨ç‰ˆæœ¬å¤åˆ¶
- **æ€§èƒ½æ•°æ®**: å¤åˆ¶å»¶è¿Ÿ10-100msï¼ŒTPSæ”¯æŒä¸­ç­‰
- **æˆæœ¬åˆ†æ**: å¼€å‘æˆæœ¬ä¸­ç­‰ï¼Œç»´æŠ¤æˆæœ¬ä¸­ç­‰ï¼Œé£é™©ä½

**æ–¹æ¡ˆ2ï¼šæµå¤åˆ¶**:

- **æè¿°**: ä½¿ç”¨æµå¤åˆ¶å®ç°å…¨åº“å¤åˆ¶
- **ä¼˜ç‚¹**:
  - æ€§èƒ½å¥½ï¼ˆç›´æ¥ä¼ è¾“WALï¼‰
  - æ•°æ®ä¸€è‡´æ€§é«˜
  - é…ç½®ç®€å•
- **ç¼ºç‚¹**:
  - å…¨åº“å¤åˆ¶ï¼Œä¸èƒ½é€‰æ‹©æ€§å¤åˆ¶
  - ä¸æ”¯æŒè·¨ç‰ˆæœ¬å¤åˆ¶
  - éœ€è¦ç›¸åŒç‰ˆæœ¬
- **é€‚ç”¨åœºæ™¯**: å…¨åº“å¤åˆ¶ã€é«˜å¯ç”¨åœºæ™¯
- **æ€§èƒ½æ•°æ®**: å¤åˆ¶å»¶è¿Ÿ1-10msï¼ŒTPSæ”¯æŒé«˜
- **æˆæœ¬åˆ†æ**: å¼€å‘æˆæœ¬ä½ï¼Œç»´æŠ¤æˆæœ¬ä½ï¼Œé£é™©ä½

**å¯¹æ¯”åˆ†æ**:

| æ–¹æ¡ˆ | å¤åˆ¶ç²’åº¦ | è·¨ç‰ˆæœ¬æ”¯æŒ | æ€§èƒ½ | æ•°æ®ä¸€è‡´æ€§ | çµæ´»æ€§ | é€‚ç”¨åœºæ™¯ | ç»¼åˆè¯„åˆ† |
|------|---------|-----------|------|-----------|--------|---------|---------|
| é€»è¾‘å¤åˆ¶ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | è¡¨çº§å¤åˆ¶ | 4.6/5 |
| æµå¤åˆ¶ | â­â­â­ | â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­ | å…¨åº“å¤åˆ¶ | 3.6/5 |

**å†³ç­–ä¾æ®**:

**å†³ç­–æ ‡å‡†**:

- å¤åˆ¶ç²’åº¦ï¼šæƒé‡30%
- è·¨ç‰ˆæœ¬æ”¯æŒï¼šæƒé‡20%
- æ€§èƒ½ï¼šæƒé‡20%
- æ•°æ®ä¸€è‡´æ€§ï¼šæƒé‡15%
- çµæ´»æ€§ï¼šæƒé‡15%

**è¯„åˆ†è®¡ç®—**:

- é€»è¾‘å¤åˆ¶ï¼š5.0 Ã— 0.3 + 5.0 Ã— 0.2 + 4.0 Ã— 0.2 + 4.0 Ã— 0.15 + 5.0 Ã— 0.15 = 4.6
- æµå¤åˆ¶ï¼š3.0 Ã— 0.3 + 2.0 Ã— 0.2 + 5.0 Ã— 0.2 + 5.0 Ã— 0.15 + 3.0 Ã— 0.15 = 3.6

**ç»“è®ºä¸å»ºè®®**:

**æ¨èæ–¹æ¡ˆ**: é€»è¾‘å¤åˆ¶

**æ¨èç†ç”±**:

1. è¡¨çº§å¤åˆ¶ï¼Œæ»¡è¶³åªå¤åˆ¶è®¢å•è¡¨çš„éœ€æ±‚
2. æ”¯æŒè·¨ç‰ˆæœ¬å¤åˆ¶ï¼Œæ»¡è¶³ä¸»åº“16ã€æŠ¥è¡¨åº“17çš„éœ€æ±‚
3. çµæ´»æ€§é«˜ï¼Œå¯ä»¥æ·»åŠ è¿‡æ»¤æ¡ä»¶
4. æ€§èƒ½æ»¡è¶³å®æ—¶æˆ–å‡†å®æ—¶å¤åˆ¶éœ€æ±‚

**å®æ–½å»ºè®®**:

1. ä½¿ç”¨é€»è¾‘å¤åˆ¶åˆ›å»ºè®¢å•è¡¨å‘å¸ƒ
2. åœ¨æŠ¥è¡¨åº“åˆ›å»ºè®¢é˜…ï¼Œè¿æ¥ä¸»åº“
3. é…ç½®å¤åˆ¶ç›‘æ§ï¼Œç›‘æ§å¤åˆ¶å»¶è¿Ÿ
4. æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´å¤åˆ¶é…ç½®

**è§£å†³æ–¹æ¡ˆ**:

**ä¸šåŠ¡åœºæ™¯**:

æŸä¼ä¸šéœ€è¦å°†ä¸»æ•°æ®åº“çš„æ•°æ®åˆ†å‘åˆ°å¤šä¸ªæŠ¥è¡¨æ•°æ®åº“ã€‚

**é—®é¢˜åˆ†æ**:

1. **æ•°æ®åˆ†å‘**: éœ€è¦å°†æ•°æ®åˆ†å‘åˆ°å¤šä¸ªæ•°æ®åº“
2. **é€‰æ‹©æ€§å¤åˆ¶**: åªéœ€è¦å¤åˆ¶ç‰¹å®šè¡¨
3. **æ€§èƒ½è¦æ±‚**: ä¸èƒ½å½±å“ä¸»åº“æ€§èƒ½

**è§£å†³æ–¹æ¡ˆ**:

```sql
-- 1. åœ¨ä¸»åº“åˆ›å»ºå‘å¸ƒ
CREATE PUBLICATION reporting_publication
FOR TABLE sales, customers, products;

-- 2. åœ¨æŠ¥è¡¨åº“åˆ›å»ºè®¢é˜…
CREATE SUBSCRIPTION reporting_subscription
CONNECTION 'host=primary_host port=5432 user=replicator password=password dbname=mydb'
PUBLICATION reporting_publication;
```

**ä¼˜åŒ–æ•ˆæœ**:

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| **æ•°æ®åŒæ­¥** | æ‰‹åŠ¨ | **è‡ªåŠ¨** | **æå‡** |
| **æ€§èƒ½å½±å“** | é«˜ | **ä½** | **é™ä½** |
| **çµæ´»æ€§** | ä½ | **é«˜** | **æå‡** |

## 5. æœ€ä½³å®è·µ

### 5.1 é…ç½®ä¼˜åŒ–

**æ¨èåšæ³•**ï¼š

1. **æ­£ç¡®è®¾ç½® WAL çº§åˆ«**ï¼ˆå¿…é¡»è®¾ç½®ä¸º logicalï¼‰

   ```conf
   # âœ… å¥½ï¼šå¯ç”¨é€»è¾‘å¤åˆ¶
   wal_level = logical
   max_replication_slots = 10
   max_wal_senders = 10

   # âŒ ä¸å¥½ï¼šWAL çº§åˆ«ä¸å¤Ÿ
   # wal_level = replica  # é€»è¾‘å¤åˆ¶éœ€è¦ logical
   ```

2. **åˆç†é…ç½®å¤åˆ¶æ§½æ•°é‡**ï¼ˆæ¯ä¸ªè®¢é˜…éœ€è¦ä¸€ä¸ªæ§½ï¼‰

   ```sql
   -- âœ… å¥½ï¼šæ ¹æ®è®¢é˜…æ•°é‡é…ç½®
   max_replication_slots = 10  -- æ”¯æŒ10ä¸ªè®¢é˜…

   -- æŸ¥çœ‹å½“å‰å¤åˆ¶æ§½ä½¿ç”¨æƒ…å†µ
   SELECT
       slot_name,
       slot_type,
       database,
       active,
       pg_size_pretty(pg_wal_lsn_diff(pg_current_wal_lsn(), confirmed_flush_lsn)) AS lag
   FROM pg_replication_slots;

   -- âŒ ä¸å¥½ï¼šå¤åˆ¶æ§½æ•°é‡ä¸è¶³
   # max_replication_slots = 1  -- åªèƒ½æ”¯æŒ1ä¸ªè®¢é˜…
   ```

3. **ç›‘æ§å¤åˆ¶å»¶è¿Ÿå’ŒçŠ¶æ€**ï¼ˆåŠæ—¶å‘ç°å’Œå¤„ç†é—®é¢˜ï¼‰

   ```sql
   -- âœ… å¥½ï¼šå®šæœŸç›‘æ§å¤åˆ¶å»¶è¿Ÿ
   SELECT
       subname,
       pg_wal_lsn_diff(pg_current_wal_lsn(), latest_end_lsn) AS lag_bytes,
       latest_end_time,
       NOW() - latest_end_time AS lag_time
   FROM pg_stat_subscription;

   -- âœ… å¥½ï¼šç›‘æ§å¤åˆ¶æ§½çŠ¶æ€
   SELECT
       slot_name,
       active,
       pg_size_pretty(pg_wal_lsn_diff(pg_current_wal_lsn(), confirmed_flush_lsn)) AS lag
   FROM pg_replication_slots
   WHERE slot_type = 'logical';
   ```

4. **ä½¿ç”¨å¤åˆ¶æ§½é˜²æ­¢ WAL ä¸¢å¤±**ï¼ˆä¿è¯æ•°æ®å®‰å…¨ï¼‰

   ```sql
   -- âœ… å¥½ï¼šåˆ›å»ºè®¢é˜…æ—¶è‡ªåŠ¨åˆ›å»ºå¤åˆ¶æ§½
   CREATE SUBSCRIPTION my_subscription
   CONNECTION 'host=primary_host port=5432 user=replicator password=password dbname=mydb'
   PUBLICATION my_publication;
   -- è‡ªåŠ¨åˆ›å»ºå¤åˆ¶æ§½ï¼Œé˜²æ­¢ WAL è¢«åˆ é™¤
   ```

5. **é…ç½®åˆé€‚çš„åŒæ­¥æäº¤çº§åˆ«**ï¼ˆå¹³è¡¡æ€§èƒ½å’Œæ•°æ®å®‰å…¨ï¼‰

   ```sql
   -- âœ… å¥½ï¼šè®¢é˜…ç«¯ä½¿ç”¨æœ¬åœ°æäº¤ï¼ˆæ€§èƒ½å¥½ï¼‰
   CREATE SUBSCRIPTION my_subscription
   CONNECTION 'host=primary_host port=5432 user=replicator password=password dbname=mydb'
   PUBLICATION my_publication
   WITH (synchronous_commit = 'local');

   -- âœ… å¥½ï¼šå…³é”®æ•°æ®ä½¿ç”¨è¿œç¨‹æäº¤ï¼ˆæ•°æ®å®‰å…¨ï¼‰
   CREATE SUBSCRIPTION critical_subscription
   CONNECTION 'host=primary_host port=5432 user=replicator password=password dbname=mydb'
   PUBLICATION critical_publication
   WITH (synchronous_commit = 'remote_apply');
   ```

**é¿å…åšæ³•**ï¼š

1. **é¿å… WAL çº§åˆ«è®¾ç½®é”™è¯¯**ï¼ˆå¿…é¡»è®¾ç½®ä¸º logicalï¼‰
2. **é¿å…å¤åˆ¶æ§½æ•°é‡ä¸è¶³**ï¼ˆå¯¼è‡´è®¢é˜…åˆ›å»ºå¤±è´¥ï¼‰
3. **é¿å…å¿½ç•¥ç›‘æ§**ï¼ˆæ— æ³•åŠæ—¶å‘ç°å¤åˆ¶å»¶è¿Ÿå’Œé”™è¯¯ï¼‰
4. **é¿å…æ‰‹åŠ¨åˆ é™¤å¤åˆ¶æ§½**ï¼ˆå¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼‰

### 5.2 æ€§èƒ½ä¼˜åŒ–

## 6. å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰

### 6.1 é€»è¾‘å¤åˆ¶åŸºç¡€å¸¸è§é—®é¢˜

#### Q1: å¦‚ä½•é…ç½®é€»è¾‘å¤åˆ¶ï¼Ÿ

**é—®é¢˜æè¿°**ï¼šä¸çŸ¥é“å¦‚ä½•é…ç½®é€»è¾‘å¤åˆ¶ã€‚

**è¯Šæ–­æ­¥éª¤**ï¼š

```sql
-- 1. æ£€æŸ¥é€»è¾‘å¤åˆ¶çŠ¶æ€
SELECT * FROM pg_stat_subscription;

-- 2. æ£€æŸ¥å‘å¸ƒçŠ¶æ€
SELECT * FROM pg_publication;
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

```sql
-- 1. å‘å¸ƒç«¯é…ç½®ï¼ˆpostgresql.confï¼‰
wal_level = logical
max_replication_slots = 10
max_wal_senders = 10

-- 2. åˆ›å»ºå‘å¸ƒ
CREATE PUBLICATION my_publication FOR TABLE table1, table2;

-- 3. è®¢é˜…ç«¯é…ç½®ï¼ˆpostgresql.confï¼‰
max_replication_slots = 10
max_logical_replication_workers = 10

-- 4. åˆ›å»ºè®¢é˜…
CREATE SUBSCRIPTION my_subscription
CONNECTION 'host=publisher_host port=5432 dbname=mydb user=replicator'
PUBLICATION my_publication;
```

**æ€§èƒ½å¯¹æ¯”**ï¼š

- æ— é€»è¾‘å¤åˆ¶ï¼šæ•°æ®åŒæ­¥æ—¶é—´ **æ•°å°æ—¶**ï¼Œå»¶è¿Ÿé«˜
- æœ‰é€»è¾‘å¤åˆ¶ï¼šæ•°æ®åŒæ­¥æ—¶é—´ **æ•°ç§’**ï¼Œå®æ—¶åŒæ­¥
- **åŒæ­¥æ•ˆç‡æå‡ï¼š1000å€**

#### Q2: å¦‚ä½•ç›‘æ§é€»è¾‘å¤åˆ¶å»¶è¿Ÿï¼Ÿ

**é—®é¢˜æè¿°**ï¼šä¸çŸ¥é“å¦‚ä½•ç›‘æ§é€»è¾‘å¤åˆ¶å»¶è¿Ÿã€‚

**è¯Šæ–­æ­¥éª¤**ï¼š

```sql
-- 1. æ£€æŸ¥è®¢é˜…çŠ¶æ€
SELECT * FROM pg_stat_subscription;

-- 2. æ£€æŸ¥å¤åˆ¶æ§½
SELECT * FROM pg_replication_slots;
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

```sql
-- 1. æŸ¥çœ‹è®¢é˜…çŠ¶æ€
SELECT
    subname,
    pid,
    received_lsn,
    latest_end_lsn,
    latest_end_time
FROM pg_stat_subscription;

-- 2. æŸ¥çœ‹å¤åˆ¶æ§½çŠ¶æ€
SELECT
    slot_name,
    slot_type,
    active,
    pg_wal_lsn_diff(pg_current_wal_lsn(), confirmed_flush_lsn) AS lag_bytes
FROM pg_replication_slots
WHERE slot_type = 'logical';
```

**æ€§èƒ½å¯¹æ¯”**ï¼š

- æ— ç›‘æ§ï¼šå»¶è¿Ÿå‘ç°æ—¶é—´ **æ•°å°æ—¶**ï¼Œå½±å“æ•°æ®ä¸€è‡´æ€§
- æœ‰ç›‘æ§ï¼šå»¶è¿Ÿå‘ç°æ—¶é—´ **æ•°åˆ†é’Ÿ**ï¼Œå¿«é€Ÿå“åº”
- **å“åº”æ—¶é—´æå‡ï¼š100å€**

### 6.2 é€»è¾‘å¤åˆ¶æ€§èƒ½å¸¸è§é—®é¢˜

#### Q3: å¦‚ä½•ä¼˜åŒ–é€»è¾‘å¤åˆ¶æ€§èƒ½ï¼Ÿ

**é—®é¢˜æè¿°**ï¼šé€»è¾‘å¤åˆ¶æ€§èƒ½å·®ï¼Œä¸çŸ¥é“å¦‚ä½•ä¼˜åŒ–ã€‚

**è¯Šæ–­æ­¥éª¤**ï¼š

```sql
-- 1. æ£€æŸ¥å¤åˆ¶å·¥ä½œè¿›ç¨‹
SELECT * FROM pg_stat_replication;

-- 2. æ£€æŸ¥è®¢é˜…çŠ¶æ€
SELECT * FROM pg_stat_subscription;
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

```sql
-- 1. å¢åŠ å¤åˆ¶å·¥ä½œè¿›ç¨‹
ALTER SYSTEM SET max_logical_replication_workers = 20;
SELECT pg_reload_conf();

-- 2. ä¼˜åŒ–è®¢é˜…å‚æ•°
ALTER SUBSCRIPTION my_subscription
SET (synchronous_commit = off);

-- 3. æ‰¹é‡åº”ç”¨æ›´æ”¹
ALTER SYSTEM SET max_sync_workers_per_subscription = 4;
SELECT pg_reload_conf();
```

**æ€§èƒ½å¯¹æ¯”**ï¼š

- é»˜è®¤é…ç½®ï¼šå¤åˆ¶æ€§èƒ½ **1000 TPS**
- ä¼˜åŒ–é…ç½®ï¼šå¤åˆ¶æ€§èƒ½ **10000+ TPS**
- **æ€§èƒ½æå‡ï¼š10å€**

## 7. å‚è€ƒèµ„æ–™

**æ¨èåšæ³•**ï¼š

1. **é€‰æ‹©æ€§å¤åˆ¶**ï¼ˆåªå¤åˆ¶éœ€è¦çš„è¡¨ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“ï¼‰

   ```sql
   -- âœ… å¥½ï¼šåªå¤åˆ¶éœ€è¦çš„è¡¨
   CREATE PUBLICATION my_publication
   FOR TABLE users, orders, products;

   -- âŒ ä¸å¥½ï¼šå¤åˆ¶æ‰€æœ‰è¡¨ï¼ˆåŒ…æ‹¬ä¸éœ€è¦çš„è¡¨ï¼‰
   CREATE PUBLICATION all_tables FOR ALL TABLES;
   ```

2. **åœ¨è®¢é˜…ç«¯åˆ›å»ºåˆé€‚çš„ç´¢å¼•**ï¼ˆæå‡æŸ¥è¯¢æ€§èƒ½ï¼‰

   ```sql
   -- âœ… å¥½ï¼šè®¢é˜…ç«¯åˆ›å»ºç´¢å¼•ï¼ˆä¸å½±å“ä¸»åº“æ€§èƒ½ï¼‰
   CREATE INDEX idx_users_email ON users(email);
   CREATE INDEX idx_orders_date ON orders(order_date);

   -- âŒ ä¸å¥½ï¼šè®¢é˜…ç«¯æ²¡æœ‰ç´¢å¼•ï¼ˆæŸ¥è¯¢æ€§èƒ½å·®ï¼‰
   ```

3. **ä½¿ç”¨æ‰¹é‡æ“ä½œ**ï¼ˆå‡å°‘ç½‘ç»œå¾€è¿”ï¼‰

   ```sql
   -- âœ… å¥½ï¼šæ‰¹é‡æ’å…¥ï¼ˆä¸»åº“ï¼‰
   INSERT INTO orders (customer_id, total_amount)
   VALUES
       (1, 100.00),
       (2, 200.00),
       (3, 300.00);
   -- é€»è¾‘å¤åˆ¶ä¼šæ‰¹é‡ä¼ è¾“å’Œåº”ç”¨

   -- âŒ ä¸å¥½ï¼šé€æ¡æ’å…¥ï¼ˆç½‘ç»œå¾€è¿”å¤šï¼‰
   INSERT INTO orders (customer_id, total_amount) VALUES (1, 100.00);
   INSERT INTO orders (customer_id, total_amount) VALUES (2, 200.00);
   INSERT INTO orders (customer_id, total_amount) VALUES (3, 300.00);
   ```

4. **ä¼˜åŒ–è®¢é˜…ç«¯é…ç½®**ï¼ˆæå‡åº”ç”¨æ€§èƒ½ï¼‰

   ```conf
   # âœ… å¥½ï¼šè®¢é˜…ç«¯é…ç½®ä¼˜åŒ–
   max_logical_replication_workers = 4  # å¢åŠ å·¥ä½œè¿›ç¨‹æ•°
   max_sync_workers_per_subscription = 2  # æ¯ä¸ªè®¢é˜…çš„åŒæ­¥å·¥ä½œè¿›ç¨‹æ•°
   shared_buffers = 256MB  # å¢åŠ å…±äº«ç¼“å†²åŒº
   ```

5. **ä½¿ç”¨è¿‡æ»¤æ¡ä»¶å‡å°‘æ•°æ®ä¼ è¾“**ï¼ˆPostgreSQL 15+ï¼‰

   ```sql
   -- âœ… å¥½ï¼šåªå¤åˆ¶æ´»è·ƒç”¨æˆ·ï¼ˆå‡å°‘æ•°æ®ä¼ è¾“ï¼‰
   CREATE PUBLICATION active_users_publication
   FOR TABLE users
   WHERE (status = 'active');

   -- âŒ ä¸å¥½ï¼šå¤åˆ¶æ‰€æœ‰ç”¨æˆ·ï¼ˆåŒ…æ‹¬ä¸æ´»è·ƒç”¨æˆ·ï¼‰
   CREATE PUBLICATION all_users_publication
   FOR TABLE users;
   ```

6. **å®šæœŸæ¸…ç†å¤åˆ¶æ§½**ï¼ˆé˜²æ­¢ WAL ç§¯ç´¯ï¼‰

   ```sql
   -- âœ… å¥½ï¼šå®šæœŸæ£€æŸ¥å¤åˆ¶æ§½
   SELECT
       slot_name,
       pg_size_pretty(pg_wal_lsn_diff(pg_current_wal_lsn(), confirmed_flush_lsn)) AS lag
   FROM pg_replication_slots
   WHERE slot_type = 'logical';

   -- å¦‚æœè®¢é˜…å·²åˆ é™¤ï¼Œæ‰‹åŠ¨åˆ é™¤å¤åˆ¶æ§½
   SELECT pg_drop_replication_slot('old_subscription_slot');
   ```

**é¿å…åšæ³•**ï¼š

1. **é¿å…å¤åˆ¶ä¸éœ€è¦çš„è¡¨**ï¼ˆæµªè´¹ç½‘ç»œå¸¦å®½å’Œå­˜å‚¨ï¼‰
2. **é¿å…è®¢é˜…ç«¯æ²¡æœ‰ç´¢å¼•**ï¼ˆæŸ¥è¯¢æ€§èƒ½å·®ï¼‰
3. **é¿å…å¿½ç•¥æ€§èƒ½ç›‘æ§**ï¼ˆæ— æ³•å‘ç°æ€§èƒ½ç“¶é¢ˆï¼‰
4. **é¿å…å¤åˆ¶æ§½ç§¯ç´¯**ï¼ˆå¯¼è‡´ WAL æ–‡ä»¶ç§¯ç´¯ï¼Œå ç”¨ç£ç›˜ç©ºé—´ï¼‰

## 6. å‚è€ƒèµ„æ–™

### 7.1 å®˜æ–¹æ–‡æ¡£

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - é€»è¾‘å¤åˆ¶](https://www.postgresql.org/docs/current/logical-replication.html)**
  - é€»è¾‘å¤åˆ¶å®Œæ•´å‚è€ƒæ‰‹å†Œ
  - å‘å¸ƒå’Œè®¢é˜…é…ç½®

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - å‘å¸ƒ](https://www.postgresql.org/docs/current/sql-createpublication.html)**
  - CREATE PUBLICATION å‘½ä»¤è¯¦è§£
  - å‘å¸ƒé…ç½®å’Œç®¡ç†

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - è®¢é˜…](https://www.postgresql.org/docs/current/sql-createsubscription.html)**
  - CREATE SUBSCRIPTION å‘½ä»¤è¯¦è§£
  - è®¢é˜…é…ç½®å’Œç®¡ç†

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - é€»è¾‘å¤åˆ¶é…ç½®](https://www.postgresql.org/docs/current/logical-replication-config.html)**
  - é€»è¾‘å¤åˆ¶é…ç½®å‚æ•°
  - æ€§èƒ½ä¼˜åŒ–é…ç½®

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - é€»è¾‘å¤åˆ¶ç›‘æ§](https://www.postgresql.org/docs/current/monitoring-replication.html)**
  - é€»è¾‘å¤åˆ¶ç›‘æ§æ–¹æ³•
  - å¤åˆ¶å»¶è¿Ÿç›‘æ§

### 7.2 æŠ€æœ¯è®ºæ–‡

- **Kemme, B., & Alonso, G. (2000). "Database Replication: A Tale of Research across Communities."**
  - ä¼šè®®: VLDB 2000
  - **é‡è¦æ€§**: æ•°æ®åº“å¤åˆ¶æŠ€æœ¯çš„ç»¼è¿°æ€§è®ºæ–‡
  - **æ ¸å¿ƒè´¡çŒ®**: ç³»ç»Ÿæ€§åœ°æ€»ç»“äº†æ•°æ®åº“å¤åˆ¶çš„å„ç§æ–¹æ³•å’ŒæŒ‘æˆ˜ï¼ŒåŒ…æ‹¬é€»è¾‘å¤åˆ¶

- **Bernstein, P. A., et al. (1987). "Concurrency Control and Recovery in Database Systems."**
  - å‡ºç‰ˆç¤¾: Addison-Wesley
  - **é‡è¦æ€§**: æ•°æ®åº“å¹¶å‘æ§åˆ¶å’Œæ¢å¤çš„ç»å…¸æ•™æ
  - **æ ¸å¿ƒè´¡çŒ®**: è¯¦ç»†é˜è¿°äº†æ•°æ®åº“å¤åˆ¶å’Œæ•…éšœæ¢å¤çš„ç†è®ºåŸºç¡€

- **Gray, J., et al. (1996). "The Dangers of Replication and a Solution."**
  - ä¼šè®®: SIGMOD 1996
  - **é‡è¦æ€§**: æ•°æ®åº“å¤åˆ¶ä¸€è‡´æ€§çš„ç»å…¸è®ºæ–‡
  - **æ ¸å¿ƒè´¡çŒ®**: åˆ†æäº†æ•°æ®åº“å¤åˆ¶çš„å±é™©æ€§å’Œè§£å†³æ–¹æ¡ˆï¼Œä¸ºé€»è¾‘å¤åˆ¶æä¾›äº†ç†è®ºåŸºç¡€

### 7.3 æŠ€æœ¯åšå®¢

- **[PostgreSQL å®˜æ–¹åšå®¢ - é€»è¾‘å¤åˆ¶](https://www.postgresql.org/docs/current/logical-replication.html)**
  - é€»è¾‘å¤åˆ¶æœ€ä½³å®è·µ
  - é€»è¾‘å¤åˆ¶æ€§èƒ½ä¼˜åŒ–

- **[2ndQuadrant - PostgreSQL é€»è¾‘å¤åˆ¶](https://www.2ndquadrant.com/en/blog/postgresql-logical-replication/)**
  - é€»è¾‘å¤åˆ¶å®æˆ˜
  - é€»è¾‘å¤åˆ¶åº”ç”¨æ¡ˆä¾‹

- **[Percona - PostgreSQL é€»è¾‘å¤åˆ¶](https://www.percona.com/blog/postgresql-logical-replication/)**
  - é€»è¾‘å¤åˆ¶é…ç½®å’Œç®¡ç†
  - é€»è¾‘å¤åˆ¶æ•…éšœå¤„ç†

- **[EnterpriseDB - PostgreSQL é€»è¾‘å¤åˆ¶è¯¦è§£](https://www.enterprisedb.com/postgres-tutorials/postgresql-logical-replication)**
  - é€»è¾‘å¤åˆ¶æ·±å…¥è§£æ
  - é€»è¾‘å¤åˆ¶è®¾è®¡æŒ‡å—

### 7.4 ç¤¾åŒºèµ„æº

- **[PostgreSQL Wiki - Logical Replication](https://wiki.postgresql.org/wiki/Logical_Replication)**
  - é€»è¾‘å¤åˆ¶ä½¿ç”¨æŒ‡å—
  - å¸¸è§é—®é¢˜è§£ç­”

- **[PostgreSQL Wiki - Replication](https://wiki.postgresql.org/wiki/Replication)**
  - å¤åˆ¶æ–¹æ¡ˆå¯¹æ¯”
  - å¤åˆ¶é…ç½®æŒ‡å—

- **[Stack Overflow - PostgreSQL Logical Replication](https://stackoverflow.com/questions/tagged/postgresql+logical-replication)**
  - é€»è¾‘å¤åˆ¶ç›¸å…³é—®é¢˜è§£ç­”
  - å®é™…åº”ç”¨æ¡ˆä¾‹

- [å¤åˆ¶ä¸é«˜å¯ç”¨](./å¤åˆ¶ä¸é«˜å¯ç”¨.md)
- [PostgreSQL å®˜æ–¹æ–‡æ¡£ - é€»è¾‘å¤åˆ¶](https://www.postgresql.org/docs/current/logical-replication.html)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 03-03-27
