---

> **ğŸ“‹ æ–‡æ¡£æ¥æº**: `PostgreSQL\02-ç‰ˆæœ¬ç‰¹æ€§\02.03-ç‰ˆæœ¬å¯¹æ¯”ä¸è¿ç§»æŒ‡å—.md`
> **ğŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŸæ–‡ä»¶ä¿æŒä¸å˜

---

# PostgreSQL ç‰ˆæœ¬å¯¹æ¯”ä¸è¿ç§»æŒ‡å—

> **ç‰ˆæœ¬**: v3.0
> **æœ€åæ›´æ–°**: 2025-01-15
> **ç‰ˆæœ¬è¦†ç›–**: PostgreSQL 16.x | 17.x | 18.x (æ¨è) â­
> **æ–‡æ¡£çŠ¶æ€**: âœ… å·²åˆ›å»º

---

## ğŸ“‘ ç›®å½•

- [PostgreSQL ç‰ˆæœ¬å¯¹æ¯”ä¸è¿ç§»æŒ‡å—](#postgresql-ç‰ˆæœ¬å¯¹æ¯”ä¸è¿ç§»æŒ‡å—)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [ğŸ“Š æ€ç»´å¯¼å›¾](#-æ€ç»´å¯¼å›¾)
  - [ä¸€ã€ç‰ˆæœ¬æ¦‚è§ˆ](#ä¸€ç‰ˆæœ¬æ¦‚è§ˆ)
    - [1.1 ç‰ˆæœ¬å‘å¸ƒæ—¶é—´çº¿](#11-ç‰ˆæœ¬å‘å¸ƒæ—¶é—´çº¿)
    - [1.2 ç‰ˆæœ¬é€‰æ‹©å»ºè®®](#12-ç‰ˆæœ¬é€‰æ‹©å»ºè®®)
  - [äºŒã€çŸ¥è¯†çŸ©é˜µå¯¹æ¯”](#äºŒçŸ¥è¯†çŸ©é˜µå¯¹æ¯”)
    - [2.1 ç‰ˆæœ¬ç‰¹æ€§å¯¹æ¯”çŸ©é˜µ](#21-ç‰ˆæœ¬ç‰¹æ€§å¯¹æ¯”çŸ©é˜µ)
    - [2.2 è¿ç§»ç­–ç•¥å¯¹æ¯”](#22-è¿ç§»ç­–ç•¥å¯¹æ¯”)
  - [ä¸‰ã€ç‰ˆæœ¬ç‰¹æ€§å¯¹æ¯”](#ä¸‰ç‰ˆæœ¬ç‰¹æ€§å¯¹æ¯”)
    - [3.1 æ ¸å¿ƒç‰¹æ€§å¯¹æ¯”](#31-æ ¸å¿ƒç‰¹æ€§å¯¹æ¯”)
    - [3.2 æ€§èƒ½å¯¹æ¯”](#32-æ€§èƒ½å¯¹æ¯”)
  - [å››ã€ä» PostgreSQL 16 è¿ç§»åˆ° 17](#å››ä»-postgresql-16-è¿ç§»åˆ°-17)
    - [4.1 ä¸»è¦å˜åŒ–](#41-ä¸»è¦å˜åŒ–)
      - [4.1.1 æ–°å¢ç‰¹æ€§](#411-æ–°å¢ç‰¹æ€§)
      - [ç ´åæ€§å˜åŒ–](#ç ´åæ€§å˜åŒ–)
    - [4.2 è¿ç§»æ­¥éª¤](#42-è¿ç§»æ­¥éª¤)
      - [æ­¥éª¤ 1: å…¼å®¹æ€§æ£€æŸ¥](#æ­¥éª¤-1-å…¼å®¹æ€§æ£€æŸ¥)
      - [æ­¥éª¤ 2: å¤‡ä»½æ•°æ®](#æ­¥éª¤-2-å¤‡ä»½æ•°æ®)
      - [æ­¥éª¤ 3: å®‰è£… PostgreSQL 17](#æ­¥éª¤-3-å®‰è£…-postgresql-17)
      - [æ­¥éª¤ 4: æ‰§è¡Œè¿ç§»](#æ­¥éª¤-4-æ‰§è¡Œè¿ç§»)
      - [æ­¥éª¤ 5: æ›´æ–°é…ç½®](#æ­¥éª¤-5-æ›´æ–°é…ç½®)
      - [æ­¥éª¤ 6: éªŒè¯è¿ç§»](#æ­¥éª¤-6-éªŒè¯è¿ç§»)
  - [äº”ã€ä» PostgreSQL 17 è¿ç§»åˆ° 18](#äº”ä»-postgresql-17-è¿ç§»åˆ°-18)
    - [5.1 ä¸»è¦å˜åŒ–](#51-ä¸»è¦å˜åŒ–)
      - [5.1.1 æ–°å¢ç‰¹æ€§](#511-æ–°å¢ç‰¹æ€§)
      - [5.1.2 ç ´åæ€§å˜åŒ–](#512-ç ´åæ€§å˜åŒ–)
    - [5.2 è¿ç§»æ­¥éª¤](#52-è¿ç§»æ­¥éª¤)
  - [å…­ã€ä» PostgreSQL 16 ç›´æ¥è¿ç§»åˆ° 18](#å…­ä»-postgresql-16-ç›´æ¥è¿ç§»åˆ°-18)
    - [6.1 è¿ç§»ç­–ç•¥](#61-è¿ç§»ç­–ç•¥)
      - [6.1.1 ç­–ç•¥ 1: ç›´æ¥å‡çº§ï¼ˆæ¨èï¼‰](#611-ç­–ç•¥-1-ç›´æ¥å‡çº§æ¨è)
      - [6.1.2 ç­–ç•¥ 2: åˆ†æ­¥å‡çº§ï¼ˆå¤æ‚ç³»ç»Ÿï¼‰](#612-ç­–ç•¥-2-åˆ†æ­¥å‡çº§å¤æ‚ç³»ç»Ÿ)
  - [ä¸ƒã€å…¼å®¹æ€§æ£€æŸ¥](#ä¸ƒå…¼å®¹æ€§æ£€æŸ¥)
    - [7.1 æ‰©å±•å…¼å®¹æ€§](#71-æ‰©å±•å…¼å®¹æ€§)
    - [7.2 åº”ç”¨å…¼å®¹æ€§](#72-åº”ç”¨å…¼å®¹æ€§)
    - [7.3 SQL å…¼å®¹æ€§](#73-sql-å…¼å®¹æ€§)
  - [å…«ã€è¿ç§»æ­¥éª¤](#å…«è¿ç§»æ­¥éª¤)
    - [8.1 å‡†å¤‡é˜¶æ®µ](#81-å‡†å¤‡é˜¶æ®µ)
    - [8.2 æ‰§è¡Œé˜¶æ®µ](#82-æ‰§è¡Œé˜¶æ®µ)
    - [8.3 éªŒè¯é˜¶æ®µ](#83-éªŒè¯é˜¶æ®µ)
  - [ä¹ã€å›æ»šç­–ç•¥](#ä¹å›æ»šç­–ç•¥)
    - [9.1 å›æ»šå‡†å¤‡](#91-å›æ»šå‡†å¤‡)
    - [9.2 å›æ»šæ­¥éª¤](#92-å›æ»šæ­¥éª¤)
  - [åã€æ·±å…¥é˜…è¯»](#åæ·±å…¥é˜…è¯»)
    - [10.1 ç›¸å…³æ–‡æ¡£](#101-ç›¸å…³æ–‡æ¡£)
    - [10.2 å¤–éƒ¨èµ„æº](#102-å¤–éƒ¨èµ„æº)

---

## ğŸ“Š æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((ç‰ˆæœ¬å¯¹æ¯”ä¸è¿ç§»))
    ç‰ˆæœ¬æ¦‚è§ˆ
      å‘å¸ƒæ—¶é—´çº¿
      ç‰ˆæœ¬é€‰æ‹©å»ºè®®
    çŸ¥è¯†çŸ©é˜µ
      ç‰¹æ€§å¯¹æ¯”çŸ©é˜µ
      è¿ç§»ç­–ç•¥å¯¹æ¯”
    ç‰ˆæœ¬ç‰¹æ€§å¯¹æ¯”
      æ ¸å¿ƒç‰¹æ€§
      æ€§èƒ½å¯¹æ¯”
    è¿ç§»è·¯å¾„
      16åˆ°17
      17åˆ°18
      16åˆ°18
    å…¼å®¹æ€§æ£€æŸ¥
      æ‰©å±•å…¼å®¹æ€§
      åº”ç”¨å…¼å®¹æ€§
      SQLå…¼å®¹æ€§
    è¿ç§»æ­¥éª¤
      å‡†å¤‡é˜¶æ®µ
      æ‰§è¡Œé˜¶æ®µ
      éªŒè¯é˜¶æ®µ
    å›æ»šç­–ç•¥
      å›æ»šå‡†å¤‡
      å›æ»šæ­¥éª¤
    æ·±å…¥é˜…è¯»
      ç›¸å…³æ–‡æ¡£
      å¤–éƒ¨èµ„æº
```

---

## ä¸€ã€ç‰ˆæœ¬æ¦‚è§ˆ

### 1.1 ç‰ˆæœ¬å‘å¸ƒæ—¶é—´çº¿

| ç‰ˆæœ¬ | å‘å¸ƒæ—¥æœŸ | æ”¯æŒçŠ¶æ€ | æ¨èåº¦ |
| --- | --- | --- | --- |
| PostgreSQL 18 | 2025-09-25 | å½“å‰ç¨³å®šç‰ˆ | â­â­â­ æ¨è |
| PostgreSQL 17 | 2024-09-26 | ç¨³å®šç‰ˆ | â­â­ æ¨è |
| PostgreSQL 16 | 2023-09-14 | ç¨³å®šç‰ˆ | â­ å…¼å®¹ |

### 1.2 ç‰ˆæœ¬é€‰æ‹©å»ºè®®

- **æ–°é¡¹ç›®**: æ¨èä½¿ç”¨ PostgreSQL 18
- **ç°æœ‰é¡¹ç›®ï¼ˆ16ï¼‰**: å¯å‡çº§åˆ° 17 æˆ– 18
- **ç°æœ‰é¡¹ç›®ï¼ˆ17ï¼‰**: å»ºè®®å‡çº§åˆ° 18
- **ç”Ÿäº§ç¯å¢ƒ**: å»ºè®®ä½¿ç”¨ç¨³å®šç‰ˆï¼ˆ17 æˆ– 18ï¼‰

---

## äºŒã€çŸ¥è¯†çŸ©é˜µå¯¹æ¯”

### 2.1 ç‰ˆæœ¬ç‰¹æ€§å¯¹æ¯”çŸ©é˜µ

| ç‰¹æ€§ç±»åˆ« | PostgreSQL 16 | PostgreSQL 17 | PostgreSQL 18 | é‡è¦æ€§ | å‡çº§ä¼˜å…ˆçº§ |
| --- | --- | --- | --- | --- | --- |
| å¢é‡å¤‡ä»½ | âŒ | âœ… | âœ… | â­â­â­ | é«˜ |
| åŠ¨æ€å…±äº«å†…å­˜ | âŒ | âœ… | âœ… | â­â­â­ | é«˜ |
| å¼‚æ­¥ I/O | âŒ | âŒ | âœ… | â­â­â­ | é«˜ |
| è™šæ‹Ÿç”Ÿæˆåˆ— | âŒ | âŒ | âœ… | â­â­â­ | ä¸­ |
| UUID v7 æ”¯æŒ | âŒ | âŒ | âœ… | â­â­ | ä¸­ |
| OAuth 2.0 è®¤è¯ | âŒ | âŒ | âœ… | â­â­â­ | é«˜ |
| å‘é‡æ£€ç´¢ä¼˜åŒ– | âš ï¸ | âš ï¸ | âœ… (pgvector 2.0) | â­â­â­ | é«˜ |
| å¹¶è¡ŒæŸ¥è¯¢æ”¹è¿› | âš ï¸ | âœ… | âœ… | â­â­ | ä¸­ |
| JSONBå†™å…¥ä¼˜åŒ– | âš ï¸ | âœ… | âœ… | â­â­ | ä¸­ |

### 2.2 è¿ç§»ç­–ç•¥å¯¹æ¯”

| è¿ç§»ç­–ç•¥ | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‚ç”¨åœºæ™¯ | é£é™©ç­‰çº§ |
| --- | --- | --- | --- | --- |
| ç›´æ¥å‡çº§ (pg_upgrade) | å¿«é€Ÿã€æ•°æ®å®Œæ•´ | éœ€è¦åœæœºã€å…¼å®¹æ€§è¦æ±‚é«˜ | ç®€å•ç³»ç»Ÿã€å…¼å®¹æ€§è‰¯å¥½ | â­â­ |
| é€»è¾‘å¤åˆ¶è¿ç§» | é›¶åœæœºã€å¯å›æ»š | å¤æ‚ã€éœ€è¦é¢å¤–èµ„æº | é«˜å¯ç”¨ç³»ç»Ÿã€å¤§ç‰ˆæœ¬è·¨è¶Š | â­â­â­ |
| å¯¼å‡ºå¯¼å…¥ (pg_dump) | ç®€å•ã€å¯é  | åœæœºæ—¶é—´é•¿ã€æ•°æ®é‡å¤§æ—¶æ…¢ | å°è§„æ¨¡ç³»ç»Ÿã€è·¨å¹³å°è¿ç§» | â­ |
| åˆ†æ­¥å‡çº§ | é£é™©ä½ã€æ˜“éªŒè¯ | æ—¶é—´é•¿ã€éœ€è¦å¤šæ¬¡æ“ä½œ | å¤æ‚ç³»ç»Ÿã€å…³é”®ä¸šåŠ¡ | â­ |

---

## ä¸‰ã€ç‰ˆæœ¬ç‰¹æ€§å¯¹æ¯”

### 3.1 æ ¸å¿ƒç‰¹æ€§å¯¹æ¯”

| ç‰¹æ€§ | PostgreSQL 16 | PostgreSQL 17 | PostgreSQL 18 |
| --- | --- | --- | --- |
| å¢é‡å¤‡ä»½ | âŒ | âœ… | âœ… |
| åŠ¨æ€å…±äº«å†…å­˜ | âŒ | âœ… | âœ… |
| IN å­å¥ä¼˜åŒ– | âŒ | âŒ | âœ… |
| BRIN å¹¶è¡Œæ„å»º | âŒ | âŒ | âœ… |
| VACUUM ä¼˜åŒ– | âš ï¸ | âš ï¸ | âœ… |
| å¼‚æ­¥ I/O | âŒ | âŒ | âœ… |
| è™šæ‹Ÿç”Ÿæˆåˆ— | âŒ | âŒ | âœ… |
| UUID v7 æ”¯æŒ | âŒ | âŒ | âœ… |
| OAuth 2.0 è®¤è¯ | âŒ | âŒ | âœ… |
| å‘é‡æ£€ç´¢ | âœ… (pgvector) | âœ… (pgvector) | âœ… (pgvector 2.0) |
| é€»è¾‘å¤åˆ¶ | âœ… | âœ… | âœ… |
| å¹¶è¡ŒæŸ¥è¯¢ | âœ… | âœ… | âœ… |

### 3.2 æ€§èƒ½å¯¹æ¯”

| åœºæ™¯ | PostgreSQL 16 | PostgreSQL 17 | PostgreSQL 18 | æå‡ |
| --- | --- | --- | --- | --- |
| å¢é‡å¤‡ä»½é€Ÿåº¦ | N/A | åŸºå‡† | +20% | 20% |
| JSONB å†™å…¥ | åŸºå‡† | +15% | +40% | 40% |
| å‘é‡æ£€ç´¢ | åŸºå‡† | +10% | +35% | 35% |
| VACUUM åå | åŸºå‡† | +10% | +30% | 30% |

---

## å››ã€ä» PostgreSQL 16 è¿ç§»åˆ° 17

### 4.1 ä¸»è¦å˜åŒ–

#### 4.1.1 æ–°å¢ç‰¹æ€§

- âœ… **å¢é‡å¤‡ä»½**: æ˜¾è‘—å‡å°‘å¤‡ä»½æ—¶é—´å’Œå­˜å‚¨
- âœ… **åŠ¨æ€å…±äº«å†…å­˜**: æ›´çµæ´»çš„å†…å­˜ç®¡ç†
- âœ… **COPY å‘½ä»¤å¢å¼º**: ON_ERROR é€‰é¡¹
- âœ… **å¹¶è¡ŒæŸ¥è¯¢æ”¹è¿›**: æ›´å¥½çš„å¹¶è¡Œæ‰§è¡Œè®¡åˆ’

#### ç ´åæ€§å˜åŒ–

- âš ï¸ **pg_hba.conf æ ¼å¼**: éƒ¨åˆ†é…ç½®æ ¼å¼å˜åŒ–
- âš ï¸ **ç³»ç»Ÿè§†å›¾å˜åŒ–**: éƒ¨åˆ†ç³»ç»Ÿè§†å›¾ç»“æ„å˜åŒ–
- âš ï¸ **æ‰©å±•å…¼å®¹æ€§**: éƒ¨åˆ†æ‰©å±•éœ€è¦æ›´æ–°

### 4.2 è¿ç§»æ­¥éª¤

#### æ­¥éª¤ 1: å…¼å®¹æ€§æ£€æŸ¥

```bash
# ä½¿ç”¨ pg_upgrade æ£€æŸ¥å…¼å®¹æ€§
pg_upgrade --check \
  --old-datadir=/var/lib/postgresql/16/data \
  --new-datadir=/var/lib/postgresql/17/data \
  --old-bindir=/usr/lib/postgresql/16/bin \
  --new-bindir=/usr/lib/postgresql/17/bin
```

#### æ­¥éª¤ 2: å¤‡ä»½æ•°æ®

```bash
# å®Œæ•´å¤‡ä»½
pg_dumpall -U postgres > backup_16.sql

# æˆ–ä½¿ç”¨ pg_basebackup
pg_basebackup -D /backup/pg16 -F tar -z -P
```

#### æ­¥éª¤ 3: å®‰è£… PostgreSQL 17

```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install postgresql-17

# æˆ–ä»æºç ç¼–è¯‘
wget https://ftp.postgresql.org/pub/source/v17.0/postgresql-17.0.tar.gz
tar xzf postgresql-17.0.tar.gz
cd postgresql-17.0
./configure --prefix=/usr/local/pgsql
make && make install
```

#### æ­¥éª¤ 4: æ‰§è¡Œè¿ç§»

```bash
# ä½¿ç”¨ pg_upgradeï¼ˆæ¨èï¼‰
pg_upgrade \
  --old-datadir=/var/lib/postgresql/16/data \
  --new-datadir=/var/lib/postgresql/17/data \
  --old-bindir=/usr/lib/postgresql/16/bin \
  --new-bindir=/usr/lib/postgresql/17/bin \
  --check

# å¦‚æœæ£€æŸ¥é€šè¿‡ï¼Œæ‰§è¡Œå®é™…è¿ç§»
pg_upgrade \
  --old-datadir=/var/lib/postgresql/16/data \
  --new-datadir=/var/lib/postgresql/17/data \
  --old-bindir=/usr/lib/postgresql/16/bin \
  --new-bindir=/usr/lib/postgresql/17/bin
```

#### æ­¥éª¤ 5: æ›´æ–°é…ç½®

```bash
# æ£€æŸ¥æ–°é…ç½®æ–‡ä»¶
diff /var/lib/postgresql/16/data/postgresql.conf \
     /var/lib/postgresql/17/data/postgresql.conf

# æ›´æ–° pg_hba.confï¼ˆå¦‚æœ‰éœ€è¦ï¼‰
# æ£€æŸ¥æ‰©å±•å…¼å®¹æ€§
psql -U postgres -c "SELECT * FROM pg_available_extensions WHERE installed_version IS NOT NULL;"
```

#### æ­¥éª¤ 6: éªŒè¯è¿ç§»

```bash
# å¯åŠ¨æ–°ç‰ˆæœ¬
sudo systemctl start postgresql@17-main

# éªŒè¯æ•°æ®
psql -U postgres -c "SELECT version();"
psql -U postgres -c "SELECT count(*) FROM pg_database;"

# è¿è¡Œ ANALYZE
psql -U postgres -c "ANALYZE;"
```

---

## äº”ã€ä» PostgreSQL 17 è¿ç§»åˆ° 18

### 5.1 ä¸»è¦å˜åŒ–

#### 5.1.1 æ–°å¢ç‰¹æ€§

- âœ… **IN å­å¥ä¼˜åŒ–**: B-Tree ç´¢å¼•ä¼˜åŒ–
- âœ… **BRIN å¹¶è¡Œæ„å»º**: å¹¶è¡Œæ„å»º BRIN ç´¢å¼•
- âœ… **VACUUM ä¼˜åŒ–**: å†…å­˜å’Œååä¼˜åŒ–
- âœ… **å¼‚æ­¥ I/O**: JSONB å†™å…¥æ€§èƒ½æå‡ 2.7 å€
- âœ… **è™šæ‹Ÿç”Ÿæˆåˆ—**: åŠ¨æ€è®¡ç®—ä¼˜åŒ–
- âœ… **UUID v7 æ”¯æŒ**: æ—¶é—´æ’åºçš„ UUID
- âœ… **OAuth 2.0 è®¤è¯**: ä¼ä¸šçº§è®¤è¯æ”¯æŒ

#### 5.1.2 ç ´åæ€§å˜åŒ–

- âš ï¸ **éƒ¨åˆ†ç³»ç»Ÿå‡½æ•°å˜åŒ–**: éƒ¨åˆ†å‡½æ•°ç­¾åå˜åŒ–
- âš ï¸ **æ‰©å±•å…¼å®¹æ€§**: éƒ¨åˆ†æ‰©å±•éœ€è¦æ›´æ–°åˆ°å…¼å®¹ç‰ˆæœ¬

### 5.2 è¿ç§»æ­¥éª¤

è¿ç§»æ­¥éª¤ä¸ä» 16 åˆ° 17 ç±»ä¼¼ï¼Œä½¿ç”¨ pg_upgrade å·¥å…·ï¼š

```bash
# å…¼å®¹æ€§æ£€æŸ¥
pg_upgrade --check \
  --old-datadir=/var/lib/postgresql/17/data \
  --new-datadir=/var/lib/postgresql/18/data \
  --old-bindir=/usr/lib/postgresql/17/bin \
  --new-bindir=/usr/lib/postgresql/18/bin

# æ‰§è¡Œè¿ç§»
pg_upgrade \
  --old-datadir=/var/lib/postgresql/17/data \
  --new-datadir=/var/lib/postgresql/18/data \
  --old-bindir=/usr/lib/postgresql/17/bin \
  --new-bindir=/usr/lib/postgresql/18/bin
```

---

## å…­ã€ä» PostgreSQL 16 ç›´æ¥è¿ç§»åˆ° 18

### 6.1 è¿ç§»ç­–ç•¥

#### 6.1.1 ç­–ç•¥ 1: ç›´æ¥å‡çº§ï¼ˆæ¨èï¼‰

å¦‚æœç³»ç»Ÿç›¸å¯¹ç®€å•ï¼Œå¯ä»¥ç›´æ¥ä» 16 å‡çº§åˆ° 18ï¼š

```bash
# ä½¿ç”¨ pg_upgrade ç›´æ¥å‡çº§
pg_upgrade \
  --old-datadir=/var/lib/postgresql/16/data \
  --new-datadir=/var/lib/postgresql/18/data \
  --old-bindir=/usr/lib/postgresql/16/bin \
  --new-bindir=/usr/lib/postgresql/18/bin
```

#### 6.1.2 ç­–ç•¥ 2: åˆ†æ­¥å‡çº§ï¼ˆå¤æ‚ç³»ç»Ÿï¼‰

å¯¹äºå¤æ‚ç³»ç»Ÿï¼Œå»ºè®®åˆ†æ­¥å‡çº§ï¼š

1. 16 â†’ 17ï¼ˆæµ‹è¯•å’ŒéªŒè¯ï¼‰
2. 17 â†’ 18ï¼ˆæœ€ç»ˆå‡çº§ï¼‰

è¿™æ ·å¯ä»¥ï¼š

- é€æ­¥éªŒè¯å…¼å®¹æ€§
- é™ä½é£é™©
- æ›´å¥½åœ°å¤„ç†é—®é¢˜

---

## ä¸ƒã€å…¼å®¹æ€§æ£€æŸ¥

### 7.1 æ‰©å±•å…¼å®¹æ€§

```sql
-- æ£€æŸ¥å·²å®‰è£…çš„æ‰©å±•ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        EXPLAIN (ANALYZE, BUFFERS, TIMING)
        SELECT
          extname,
          extversion,
          pg_catalog.pg_get_extension_ddl(extname) AS ddl
        FROM pg_extension
        ORDER BY extname
        LIMIT 100;
        RAISE NOTICE 'æ‰©å±•æ£€æŸ¥æŸ¥è¯¢æˆåŠŸ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'æ£€æŸ¥æ‰©å±•å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- æ£€æŸ¥æ‰©å±•å…¼å®¹æ€§
-- å¸¸è§æ‰©å±•å…¼å®¹æ€§ï¼š
-- - pgvector: éœ€è¦ 0.5.0+ (PostgreSQL 18)
-- - PostGIS: éœ€è¦ 3.4.0+ (PostgreSQL 18)
-- - TimescaleDB: éœ€è¦ 2.15.0+ (PostgreSQL 18)
```

### 7.2 åº”ç”¨å…¼å®¹æ€§

```sql
-- æ£€æŸ¥ä½¿ç”¨çš„ç‰¹æ€§ï¼ˆå¸¦æ€§èƒ½æµ‹è¯•ï¼‰
EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT
  schemaname,
  tablename,
  indexname,
  indexdef
FROM pg_indexes
WHERE indexdef LIKE '%USING%'
LIMIT 100;

-- æ£€æŸ¥è‡ªå®šä¹‰å‡½æ•°ï¼ˆå¸¦æ€§èƒ½æµ‹è¯•ï¼‰
EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT
  proname,
  LEFT(prosrc, 200) as prosrc_preview
FROM pg_proc
WHERE pronamespace = 'public'::regnamespace
LIMIT 100;
```

### 7.3 SQL å…¼å®¹æ€§

```sql
-- æ£€æŸ¥ä½¿ç”¨çš„ SQL ç‰¹æ€§ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        -- PostgreSQL 18 æ–°å¢ç‰¹æ€§æ£€æŸ¥ï¼š
        -- - è™šæ‹Ÿç”Ÿæˆåˆ—
        -- - UUID v7
        -- - OAuth 2.0 è®¤è¯
        -- - å¼‚æ­¥ I/O é…ç½®

        -- æ£€æŸ¥æ˜¯å¦æœ‰è™šæ‹Ÿç”Ÿæˆåˆ—
        SELECT COUNT(*) INTO STRICT v_count
        FROM information_schema.columns
        WHERE is_generated = 'ALWAYS' AND generation_expression IS NOT NULL;

        IF v_count > 0 THEN
            RAISE NOTICE 'å‘ç° % ä¸ªè™šæ‹Ÿç”Ÿæˆåˆ—', v_count;
        ELSE
            RAISE NOTICE 'æœªå‘ç°è™šæ‹Ÿç”Ÿæˆåˆ—';
        END IF;
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'æ£€æŸ¥SQLç‰¹æ€§å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

---

## å…«ã€è¿ç§»æ­¥éª¤

### 8.1 å‡†å¤‡é˜¶æ®µ

1. **å¤‡ä»½æ•°æ®**

   ```bash
   pg_dumpall -U postgres > backup_before_migration.sql
   ```

2. **æ£€æŸ¥ç£ç›˜ç©ºé—´**

   ```bash
   df -h /var/lib/postgresql
   # éœ€è¦è‡³å°‘ 2 å€æ•°æ®å¤§å°çš„ç©ºé—´
   ```

3. **æ£€æŸ¥æ‰©å±•å…¼å®¹æ€§**

   ```sql
   -- æ£€æŸ¥æ‰©å±•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
   DO $$
   BEGIN
       BEGIN
           SELECT * FROM pg_extension LIMIT 100;
           RAISE NOTICE 'æ‰©å±•æ£€æŸ¥æˆåŠŸ';
       EXCEPTION
           WHEN OTHERS THEN
               RAISE WARNING 'æ£€æŸ¥æ‰©å±•å¤±è´¥: %', SQLERRM;
               RAISE;
       END;
   END $$;
   ```

### 8.2 æ‰§è¡Œé˜¶æ®µ

1. **åœæ­¢æœåŠ¡**

   ```bash
   sudo systemctl stop postgresql
   ```

2. **æ‰§è¡Œè¿ç§»**

   ```bash
   pg_upgrade [é€‰é¡¹]
   ```

3. **å¯åŠ¨æ–°ç‰ˆæœ¬**

   ```bash
   sudo systemctl start postgresql@18-main
   ```

### 8.3 éªŒè¯é˜¶æ®µ

1. **éªŒè¯æ•°æ®å®Œæ•´æ€§**

   ```sql
   -- éªŒè¯æ•°æ®å®Œæ•´æ€§ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
   DO $$
   BEGIN
       BEGIN
           EXPLAIN (ANALYZE, BUFFERS, TIMING)
           SELECT count(*) FROM pg_database;

           EXPLAIN (ANALYZE, BUFFERS, TIMING)
           SELECT count(*) FROM information_schema.tables;

           RAISE NOTICE 'æ•°æ®å®Œæ•´æ€§éªŒè¯æˆåŠŸ';
       EXCEPTION
           WHEN OTHERS THEN
               RAISE WARNING 'éªŒè¯æ•°æ®å®Œæ•´æ€§å¤±è´¥: %', SQLERRM;
               RAISE;
       END;
   END $$;
   ```

2. **éªŒè¯åº”ç”¨åŠŸèƒ½**
   - è¿è¡Œåº”ç”¨æµ‹è¯•å¥—ä»¶
   - æ£€æŸ¥å…³é”®ä¸šåŠ¡æµç¨‹

3. **æ€§èƒ½æµ‹è¯•**

   ```sql
   -- æ€§èƒ½æµ‹è¯•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
   DO $$
   BEGIN
       BEGIN
           -- ç¤ºä¾‹ï¼šæµ‹è¯•å…³é”®æŸ¥è¯¢
           EXPLAIN (ANALYZE, BUFFERS, TIMING)
           SELECT COUNT(*) FROM pg_database;

           RAISE NOTICE 'æ€§èƒ½æµ‹è¯•å®Œæˆ';
       EXCEPTION
           WHEN OTHERS THEN
               RAISE WARNING 'æ€§èƒ½æµ‹è¯•å¤±è´¥: %', SQLERRM;
               RAISE;
       END;
   END $$;
   ```

---

## ä¹ã€å›æ»šç­–ç•¥

### 9.1 å›æ»šå‡†å¤‡

åœ¨è¿ç§»å‰ï¼Œç¡®ä¿å¯ä»¥å›æ»šï¼š

```bash
# ä¿ç•™æ—§ç‰ˆæœ¬æ•°æ®ç›®å½•
cp -r /var/lib/postgresql/16/data /var/lib/postgresql/16/data.backup

# ä¿ç•™æ—§ç‰ˆæœ¬äºŒè¿›åˆ¶æ–‡ä»¶
cp -r /usr/lib/postgresql/16 /usr/lib/postgresql/16.backup
```

### 9.2 å›æ»šæ­¥éª¤

å¦‚æœè¿ç§»å¤±è´¥ï¼Œå¯ä»¥å›æ»šï¼š

```bash
# åœæ­¢æ–°ç‰ˆæœ¬
sudo systemctl stop postgresql@18-main

# æ¢å¤æ—§ç‰ˆæœ¬æ•°æ®
rm -rf /var/lib/postgresql/18/data
cp -r /var/lib/postgresql/16/data.backup /var/lib/postgresql/16/data

# å¯åŠ¨æ—§ç‰ˆæœ¬
sudo systemctl start postgresql@16-main

# éªŒè¯
psql -U postgres -c "SELECT version();"
```

---

## åã€æ·±å…¥é˜…è¯»

### 10.1 ç›¸å…³æ–‡æ¡£

- [PostgreSQL 18 æ–°ç‰¹æ€§](./02.01-PostgreSQL-18-æ–°ç‰¹æ€§.md)
- [PostgreSQL 17 æ–°ç‰¹æ€§é€ŸæŸ¥](./02.02-PostgreSQL-17-æ–°ç‰¹æ€§é€ŸæŸ¥.md)
- [å•æœºéƒ¨ç½²ä¸é…ç½®](../11-éƒ¨ç½²æ¶æ„/å•æœºéƒ¨ç½²/05.01-å•æœºéƒ¨ç½²ä¸é…ç½®.md)
- [å¤‡ä»½ä¸æ¢å¤](../04-å­˜å‚¨ä¸æ¢å¤/å¤‡ä»½ä¸æ¢å¤.md)

### 10.2 å¤–éƒ¨èµ„æº

- [PostgreSQL å®˜æ–¹å‡çº§æ–‡æ¡£](https://www.postgresql.org/docs/current/upgrading.html)
- [PostgreSQL 18 å‘å¸ƒè¯´æ˜](https://www.postgresql.org/docs/18/release-18.html)
- [PostgreSQL 17 å‘å¸ƒè¯´æ˜](https://www.postgresql.org/docs/17/release-17.html)
- [pg_upgrade æ–‡æ¡£](https://www.postgresql.org/docs/current/pgupgrade.html)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v3.0
**æœ€åæ›´æ–°**: 2025-01-15
**ç»´æŠ¤è€…**: PostgreSQL Documentation Team
