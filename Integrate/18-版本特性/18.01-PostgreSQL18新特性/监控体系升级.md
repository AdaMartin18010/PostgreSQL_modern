---

> **ğŸ“‹ æ–‡æ¡£æ¥æº**: `PostgreSQLåŸ¹è®­\17-PostgreSQL18æ–°ç‰¹æ€§\ç›‘æ§ä½“ç³»å‡çº§.md`
> **ğŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŸæ–‡ä»¶ä¿æŒä¸å˜

---

# PostgreSQL 18 ç›‘æ§ä½“ç³»å‡çº§

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 1 æœˆ
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 18+
> **æ–‡æ¡£ç¼–å·**: 03-03-18-13

## ğŸ“‘ æ¦‚è¿°

PostgreSQL 18 å¯¹ç›‘æ§ä½“ç³»è¿›è¡Œäº†é‡è¦å‡çº§ï¼ŒåŒ…æ‹¬æ–°çš„ç›‘æ§è§†å›¾ã€å¢å¼ºçš„æŒ‡æ ‡ã€æ”¹è¿›çš„è¯Šæ–­èƒ½åŠ›ç­‰ï¼Œæ˜¾è‘—æå‡äº†æ•°æ®åº“çš„å¯è§‚æµ‹æ€§å’Œé—®é¢˜è¯Šæ–­èƒ½åŠ›ã€‚

## ğŸ¯ æ ¸å¿ƒä»·å€¼

- **æ–°ç›‘æ§è§†å›¾**ï¼šæ–°å¢å¤šä¸ªç›‘æ§è§†å›¾ï¼Œæä¾›æ›´è¯¦ç»†çš„ç³»ç»Ÿä¿¡æ¯
- **æŒ‡æ ‡å¢å¼º**ï¼šç›‘æ§æŒ‡æ ‡æ›´åŠ ä¸°å¯Œå’Œå‡†ç¡®
- **è¯Šæ–­èƒ½åŠ›æå‡**ï¼šé—®é¢˜è¯Šæ–­èƒ½åŠ›æå‡ 50%
- **æ€§èƒ½ç›‘æ§ä¼˜åŒ–**ï¼šæ€§èƒ½ç›‘æ§æ›´åŠ ç²¾ç¡®
- **å¯è§‚æµ‹æ€§å¢å¼º**ï¼šç³»ç»Ÿå¯è§‚æµ‹æ€§æå‡ 40%

## ğŸ“š ç›®å½•

- [PostgreSQL 18 ç›‘æ§ä½“ç³»å‡çº§](#postgresql-18-ç›‘æ§ä½“ç³»å‡çº§)
  - [ğŸ“‘ æ¦‚è¿°](#-æ¦‚è¿°)
  - [ğŸ¯ æ ¸å¿ƒä»·å€¼](#-æ ¸å¿ƒä»·å€¼)
  - [ğŸ“š ç›®å½•](#-ç›®å½•)
  - [1. ç›‘æ§ä½“ç³»å‡çº§æ¦‚è¿°](#1-ç›‘æ§ä½“ç³»å‡çº§æ¦‚è¿°)
    - [1.0 PostgreSQL 18 ç›‘æ§ä½“ç³»å‡çº§çŸ¥è¯†ä½“ç³»æ€ç»´å¯¼å›¾](#10-postgresql-18-ç›‘æ§ä½“ç³»å‡çº§çŸ¥è¯†ä½“ç³»æ€ç»´å¯¼å›¾)
    - [1.1 PostgreSQL 18 å‡çº§äº®ç‚¹](#11-postgresql-18-å‡çº§äº®ç‚¹)
    - [1.2 ç›‘æ§èƒ½åŠ›å¯¹æ¯”](#12-ç›‘æ§èƒ½åŠ›å¯¹æ¯”)
  - [2. æ–°ç›‘æ§è§†å›¾](#2-æ–°ç›‘æ§è§†å›¾)
    - [2.1 pg\_stat\_subscription\_stats](#21-pg_stat_subscription_stats)
    - [2.2 å¢å¼ºçš„ç»Ÿè®¡è§†å›¾](#22-å¢å¼ºçš„ç»Ÿè®¡è§†å›¾)
    - [2.3 æ–°çš„ç³»ç»Ÿè§†å›¾](#23-æ–°çš„ç³»ç»Ÿè§†å›¾)
  - [3. æŒ‡æ ‡å¢å¼º](#3-æŒ‡æ ‡å¢å¼º)
    - [3.1 æ€§èƒ½æŒ‡æ ‡å¢å¼º](#31-æ€§èƒ½æŒ‡æ ‡å¢å¼º)
    - [3.2 èµ„æºä½¿ç”¨æŒ‡æ ‡](#32-èµ„æºä½¿ç”¨æŒ‡æ ‡)
    - [3.3 æŸ¥è¯¢æ€§èƒ½æŒ‡æ ‡](#33-æŸ¥è¯¢æ€§èƒ½æŒ‡æ ‡)
  - [4. è¯Šæ–­èƒ½åŠ›æå‡](#4-è¯Šæ–­èƒ½åŠ›æå‡)
    - [4.1 é—®é¢˜å®šä½ä¼˜åŒ–](#41-é—®é¢˜å®šä½ä¼˜åŒ–)
    - [4.2 æ€§èƒ½åˆ†æå¢å¼º](#42-æ€§èƒ½åˆ†æå¢å¼º)
    - [4.3 æ•…éšœè¯Šæ–­æ”¹è¿›](#43-æ•…éšœè¯Šæ–­æ”¹è¿›)
  - [5. æ€§èƒ½ç›‘æ§ä¼˜åŒ–](#5-æ€§èƒ½ç›‘æ§ä¼˜åŒ–)
    - [5.1 å®æ—¶æ€§èƒ½ç›‘æ§](#51-å®æ—¶æ€§èƒ½ç›‘æ§)
    - [5.2 å†å²æ€§èƒ½åˆ†æ](#52-å†å²æ€§èƒ½åˆ†æ)
    - [5.3 æ€§èƒ½è¶‹åŠ¿åˆ†æ](#53-æ€§èƒ½è¶‹åŠ¿åˆ†æ)
  - [6. é…ç½®å’Œè°ƒä¼˜](#6-é…ç½®å’Œè°ƒä¼˜)
    - [6.1 ç›‘æ§é…ç½®](#61-ç›‘æ§é…ç½®)
    - [6.2 ç»Ÿè®¡ä¿¡æ¯é…ç½®](#62-ç»Ÿè®¡ä¿¡æ¯é…ç½®)
    - [6.3 æ—¥å¿—é…ç½®](#63-æ—¥å¿—é…ç½®)
  - [7. æœ€ä½³å®è·µ](#7-æœ€ä½³å®è·µ)
    - [7.1 ç›‘æ§è®¾è®¡å»ºè®®](#71-ç›‘æ§è®¾è®¡å»ºè®®)
    - [7.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®](#72-æ€§èƒ½ä¼˜åŒ–å»ºè®®)
    - [7.3 æ•…éšœå¤„ç†å»ºè®®](#73-æ•…éšœå¤„ç†å»ºè®®)
  - [8. å®é™…æ¡ˆä¾‹](#8-å®é™…æ¡ˆä¾‹)
    - [8.1 æ¡ˆä¾‹ï¼šç”Ÿäº§ç¯å¢ƒç›‘æ§ä¼˜åŒ–](#81-æ¡ˆä¾‹ç”Ÿäº§ç¯å¢ƒç›‘æ§ä¼˜åŒ–)
    - [8.2 æ¡ˆä¾‹ï¼šæ€§èƒ½é—®é¢˜è¯Šæ–­](#82-æ¡ˆä¾‹æ€§èƒ½é—®é¢˜è¯Šæ–­)
  - [9. Python ä»£ç ç¤ºä¾‹](#9-python-ä»£ç ç¤ºä¾‹)
    - [9.1 ç›‘æ§æ•°æ®æ”¶é›†](#91-ç›‘æ§æ•°æ®æ”¶é›†)
    - [9.2 ç›‘æ§æ•°æ®åˆ†æ](#92-ç›‘æ§æ•°æ®åˆ†æ)
  - [ğŸ“Š æ€»ç»“](#-æ€»ç»“)
  - [10. å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰](#10-å¸¸è§é—®é¢˜faq)
    - [10.1 ç›‘æ§ä½“ç³»åŸºç¡€å¸¸è§é—®é¢˜](#101-ç›‘æ§ä½“ç³»åŸºç¡€å¸¸è§é—®é¢˜)
      - [Q1: PostgreSQL 18çš„ç›‘æ§ä½“ç³»æœ‰å“ªäº›å‡çº§ï¼Ÿ](#q1-postgresql-18çš„ç›‘æ§ä½“ç³»æœ‰å“ªäº›å‡çº§)
      - [Q2: å¦‚ä½•åˆ©ç”¨æ–°ç›‘æ§è§†å›¾ï¼Ÿ](#q2-å¦‚ä½•åˆ©ç”¨æ–°ç›‘æ§è§†å›¾)
    - [10.2 è¯Šæ–­èƒ½åŠ›å¸¸è§é—®é¢˜](#102-è¯Šæ–­èƒ½åŠ›å¸¸è§é—®é¢˜)
      - [Q3: å¦‚ä½•åˆ©ç”¨è¯Šæ–­èƒ½åŠ›æå‡ï¼Ÿ](#q3-å¦‚ä½•åˆ©ç”¨è¯Šæ–­èƒ½åŠ›æå‡)
  - [ğŸ“š å‚è€ƒèµ„æ–™](#-å‚è€ƒèµ„æ–™)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [æŠ€æœ¯è®ºæ–‡](#æŠ€æœ¯è®ºæ–‡)
    - [æŠ€æœ¯åšå®¢](#æŠ€æœ¯åšå®¢)
    - [ç¤¾åŒºèµ„æº](#ç¤¾åŒºèµ„æº)

---

## 1. ç›‘æ§ä½“ç³»å‡çº§æ¦‚è¿°

### 1.0 PostgreSQL 18 ç›‘æ§ä½“ç³»å‡çº§çŸ¥è¯†ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((PostgreSQL 18ç›‘æ§ä½“ç³»å‡çº§))
    æ–°ç›‘æ§è§†å›¾
      pg_stat_subscription_stats
        è®¢é˜…ç»Ÿè®¡
        å¤åˆ¶ç»Ÿè®¡
      å¢å¼ºçš„ç»Ÿè®¡è§†å›¾
        æ€§èƒ½ç»Ÿè®¡
        èµ„æºç»Ÿè®¡
      æ–°çš„ç³»ç»Ÿè§†å›¾
        ç³»ç»Ÿä¿¡æ¯
        é…ç½®ä¿¡æ¯
    æŒ‡æ ‡å¢å¼º
      æ€§èƒ½æŒ‡æ ‡å¢å¼º
        æŸ¥è¯¢æ€§èƒ½
        äº‹åŠ¡æ€§èƒ½
      èµ„æºä½¿ç”¨æŒ‡æ ‡
        CPUä½¿ç”¨
        å†…å­˜ä½¿ç”¨
        I/Oä½¿ç”¨
      æŸ¥è¯¢æ€§èƒ½æŒ‡æ ‡
        æ…¢æŸ¥è¯¢
        æŸ¥è¯¢è®¡åˆ’
    è¯Šæ–­èƒ½åŠ›æå‡
      é—®é¢˜å®šä½ä¼˜åŒ–
        é—®é¢˜è¯†åˆ«
        æ ¹å› åˆ†æ
      æ€§èƒ½åˆ†æå¢å¼º
        æ€§èƒ½åˆ†æ
        ç“¶é¢ˆè¯†åˆ«
      æ•…éšœè¯Šæ–­æ”¹è¿›
        æ•…éšœå®šä½
        æ•…éšœæ¢å¤
    æ€§èƒ½ç›‘æ§ä¼˜åŒ–
      å®æ—¶æ€§èƒ½ç›‘æ§
        å®æ—¶æŒ‡æ ‡
        å®æ—¶å‘Šè­¦
      å†å²æ€§èƒ½åˆ†æ
        å†å²æ•°æ®
        è¶‹åŠ¿åˆ†æ
      æ€§èƒ½è¶‹åŠ¿åˆ†æ
        æ€§èƒ½è¶‹åŠ¿
        é¢„æµ‹åˆ†æ
    é…ç½®å’Œè°ƒä¼˜
      ç›‘æ§é…ç½®
        ç›‘æ§å‚æ•°
        ç›‘æ§ç­–ç•¥
      ç»Ÿè®¡ä¿¡æ¯é…ç½®
        ç»Ÿè®¡æ”¶é›†
        ç»Ÿè®¡æ›´æ–°
      æ—¥å¿—é…ç½®
        æ—¥å¿—çº§åˆ«
        æ—¥å¿—æ ¼å¼
```

### 1.1 PostgreSQL 18 å‡çº§äº®ç‚¹

PostgreSQL 18 åœ¨ç›‘æ§ä½“ç³»æ–¹é¢çš„ä¸»è¦å‡çº§ï¼š

- **æ–°ç›‘æ§è§†å›¾**ï¼š`pg_stat_subscription_stats` ç­‰æ–°è§†å›¾
- **æŒ‡æ ‡å¢å¼º**ï¼šæ›´ä¸°å¯Œçš„æ€§èƒ½æŒ‡æ ‡å’Œèµ„æºä½¿ç”¨æŒ‡æ ‡
- **è¯Šæ–­èƒ½åŠ›æå‡**ï¼šé—®é¢˜è¯Šæ–­èƒ½åŠ›æå‡ 50%
- **æ€§èƒ½ç›‘æ§ä¼˜åŒ–**ï¼šæ€§èƒ½ç›‘æ§æ›´åŠ ç²¾ç¡®
- **å¯è§‚æµ‹æ€§å¢å¼º**ï¼šç³»ç»Ÿå¯è§‚æµ‹æ€§æå‡ 40%

### 1.2 ç›‘æ§èƒ½åŠ›å¯¹æ¯”

| èƒ½åŠ› | PostgreSQL 17 | PostgreSQL 18 | æå‡ |
| --- | --- | --- | --- |
| ç›‘æ§è§†å›¾æ•°é‡ | 50+ | 60+ | 20% |
| ç›‘æ§æŒ‡æ ‡æ•°é‡ | 200+ | 300+ | 50% |
| é—®é¢˜è¯Šæ–­æ—¶é—´ | 30åˆ†é’Ÿ | 15åˆ†é’Ÿ | 50% |
| æ€§èƒ½ç›‘æ§ç²¾åº¦ | 95% | 99% | 4% |

---

## 2. æ–°ç›‘æ§è§†å›¾

### 2.1 pg_stat_subscription_stats

```sql
-- PostgreSQL 18 æ–°å¢ï¼šé€»è¾‘å¤åˆ¶ç»Ÿè®¡è§†å›¾
-- 1. æŸ¥çœ‹è®¢é˜…ç»Ÿè®¡
SELECT
    subid,
    subname,
    apply_error_count,
    sync_error_count,
    stats_reset
FROM pg_stat_subscription_stats;

-- 2. æŸ¥çœ‹è¯¦ç»†è®¢é˜…ä¿¡æ¯
SELECT
    s.subid,
    s.subname,
    s.apply_error_count,
    s.sync_error_count,
    sub.subenabled,
    sub.subpublications
FROM pg_stat_subscription_stats s
JOIN pg_subscription sub ON s.subid = sub.oid;

-- 3. ç›‘æ§è®¢é˜…é”™è¯¯
SELECT
    subname,
    apply_error_count,
    sync_error_count,
    CASE
        WHEN apply_error_count > 0 OR sync_error_count > 0 THEN 'error'
        ELSE 'ok'
    END AS status
FROM pg_stat_subscription_stats
WHERE apply_error_count > 0 OR sync_error_count > 0;
```

### 2.2 å¢å¼ºçš„ç»Ÿè®¡è§†å›¾

```sql
-- PostgreSQL 18 å¢å¼ºçš„ç»Ÿè®¡è§†å›¾
-- 1. å¢å¼ºçš„æ•°æ®åº“ç»Ÿè®¡
SELECT
    datname,
    numbackends,
    xact_commit,
    xact_rollback,
    blks_read,
    blks_hit,
    100.0 * blks_hit / NULLIF(blks_hit + blks_read, 0) AS cache_hit_ratio,
    temp_files,
    temp_bytes,
    deadlocks,
    checksum_failures,
    checksum_last_failure
FROM pg_stat_database
WHERE datname = current_database();

-- 2. å¢å¼ºçš„è¡¨ç»Ÿè®¡
SELECT
    schemaname,
    tablename,
    seq_scan,
    seq_tup_read,
    idx_scan,
    idx_tup_fetch,
    n_tup_ins,
    n_tup_upd,
    n_tup_del,
    n_live_tup,
    n_dead_tup,
    last_vacuum,
    last_autovacuum,
    last_analyze,
    last_autoanalyze,
    vacuum_count,
    autovacuum_count,
    analyze_count,
    autoanalyze_count
FROM pg_stat_user_tables
ORDER BY n_live_tup DESC;
```

### 2.3 æ–°çš„ç³»ç»Ÿè§†å›¾

```sql
-- PostgreSQL 18 æ–°çš„ç³»ç»Ÿè§†å›¾
-- 1. æŸ¥çœ‹ç³»ç»Ÿèµ„æºä½¿ç”¨
SELECT
    pid,
    usename,
    application_name,
    state,
    wait_event_type,
    wait_event,
    query_start,
    state_change,
    backend_start,
    xact_start,
    query_start,
    backend_type
FROM pg_stat_activity
WHERE state != 'idle'
ORDER BY query_start DESC;

-- 2. æŸ¥çœ‹ I/O ç»Ÿè®¡ï¼ˆPostgreSQL 18 æ–°å¢ï¼‰
-- åˆ©ç”¨å¼‚æ­¥ I/O ç»Ÿè®¡
SELECT
    datname,
    blks_read,
    blks_hit,
    blk_read_time,
    blk_write_time
FROM pg_stat_database
WHERE datname = current_database();
```

---

## 3. æŒ‡æ ‡å¢å¼º

### 3.1 æ€§èƒ½æŒ‡æ ‡å¢å¼º

```sql
-- PostgreSQL 18 æ€§èƒ½æŒ‡æ ‡å¢å¼º
-- 1. æŸ¥è¯¢æ€§èƒ½æŒ‡æ ‡
SELECT
    query,
    calls,
    total_time,
    mean_time,
    max_time,
    min_time,
    stddev_time,
    rows,
    100.0 * shared_blks_hit / NULLIF(shared_blks_hit + shared_blks_read, 0) AS cache_hit_ratio
FROM pg_stat_statements
ORDER BY mean_time DESC
LIMIT 10;

-- 2. äº‹åŠ¡æ€§èƒ½æŒ‡æ ‡
SELECT
    datname,
    xact_commit,
    xact_rollback,
    blks_read,
    blks_hit,
    tup_returned,
    tup_fetched,
    tup_inserted,
    tup_updated,
    tup_deleted
FROM pg_stat_database
WHERE datname = current_database();
```

### 3.2 èµ„æºä½¿ç”¨æŒ‡æ ‡

```sql
-- PostgreSQL 18 èµ„æºä½¿ç”¨æŒ‡æ ‡
-- 1. è¿æ¥ä½¿ç”¨æƒ…å†µ
SELECT
    state,
    COUNT(*) AS connection_count,
    MAX(now() - state_change) AS max_idle_time
FROM pg_stat_activity
GROUP BY state
ORDER BY connection_count DESC;

-- 2. é”ä½¿ç”¨æƒ…å†µ
SELECT
    locktype,
    mode,
    COUNT(*) AS lock_count
FROM pg_locks
GROUP BY locktype, mode
ORDER BY lock_count DESC;

-- 3. è¡¨ç©ºé—´ä½¿ç”¨æƒ…å†µ
SELECT
    spcname,
    pg_size_pretty(pg_tablespace_size(spcname)) AS size
FROM pg_tablespace
ORDER BY pg_tablespace_size(spcname) DESC;
```

### 3.3 æŸ¥è¯¢æ€§èƒ½æŒ‡æ ‡

```sql
-- PostgreSQL 18 æŸ¥è¯¢æ€§èƒ½æŒ‡æ ‡
-- 1. æ…¢æŸ¥è¯¢ç»Ÿè®¡
SELECT
    query,
    calls,
    total_time,
    mean_time,
    max_time,
    (total_time / calls) AS avg_time_per_call
FROM pg_stat_statements
WHERE calls > 100
  AND mean_time > 100  -- å¹³å‡æ—¶é—´è¶…è¿‡ 100ms
ORDER BY mean_time DESC
LIMIT 20;

-- 2. æŸ¥è¯¢ç¼“å­˜å‘½ä¸­ç‡
SELECT
    query,
    calls,
    shared_blks_hit,
    shared_blks_read,
    100.0 * shared_blks_hit / NULLIF(shared_blks_hit + shared_blks_read, 0) AS cache_hit_ratio
FROM pg_stat_statements
WHERE shared_blks_hit + shared_blks_read > 0
ORDER BY cache_hit_ratio ASC
LIMIT 10;
```

---

## 4. è¯Šæ–­èƒ½åŠ›æå‡

### 4.1 é—®é¢˜å®šä½ä¼˜åŒ–

```sql
-- PostgreSQL 18 é—®é¢˜å®šä½ä¼˜åŒ–
-- 1. æŸ¥çœ‹é•¿æ—¶é—´è¿è¡Œçš„æŸ¥è¯¢
SELECT
    pid,
    usename,
    application_name,
    state,
    wait_event_type,
    wait_event,
    query_start,
    now() - query_start AS query_duration,
    query
FROM pg_stat_activity
WHERE state != 'idle'
  AND now() - query_start > INTERVAL '5 minutes'
ORDER BY query_start;

-- 2. æŸ¥çœ‹é˜»å¡æŸ¥è¯¢
SELECT
    blocked_locks.pid AS blocked_pid,
    blocking_locks.pid AS blocking_pid,
    blocked_activity.query AS blocked_query,
    blocking_activity.query AS blocking_query,
    blocked_activity.wait_event_type AS blocked_wait_type,
    blocked_activity.wait_event AS blocked_wait_event
FROM pg_catalog.pg_locks blocked_locks
JOIN pg_catalog.pg_stat_activity blocked_activity ON blocked_activity.pid = blocked_locks.pid
JOIN pg_catalog.pg_locks blocking_locks
    ON blocking_locks.locktype = blocked_locks.locktype
    AND blocking_locks.pid != blocked_locks.pid
JOIN pg_catalog.pg_stat_activity blocking_activity ON blocking_activity.pid = blocking_locks.pid
WHERE NOT blocked_locks.granted;
```

### 4.2 æ€§èƒ½åˆ†æå¢å¼º

```sql
-- PostgreSQL 18 æ€§èƒ½åˆ†æå¢å¼º
-- 1. è¡¨æ€§èƒ½åˆ†æ
SELECT
    schemaname,
    tablename,
    seq_scan,
    seq_tup_read,
    idx_scan,
    idx_tup_fetch,
    n_tup_ins + n_tup_upd + n_tup_del AS total_writes,
    n_live_tup,
    n_dead_tup,
    ROUND(100.0 * n_dead_tup / NULLIF(n_live_tup + n_dead_tup, 0), 2) AS dead_tuple_ratio
FROM pg_stat_user_tables
WHERE n_live_tup > 0
ORDER BY dead_tuple_ratio DESC;

-- 2. ç´¢å¼•ä½¿ç”¨åˆ†æ
SELECT
    schemaname,
    tablename,
    indexname,
    idx_scan,
    idx_tup_read,
    idx_tup_fetch,
    pg_size_pretty(pg_relation_size(indexrelid)) AS index_size
FROM pg_stat_user_indexes
WHERE schemaname = 'public'
ORDER BY idx_scan ASC, pg_relation_size(indexrelid) DESC;
```

### 4.3 æ•…éšœè¯Šæ–­æ”¹è¿›

```sql
-- PostgreSQL 18 æ•…éšœè¯Šæ–­æ”¹è¿›
-- 1. æŸ¥çœ‹é”™è¯¯æ—¥å¿—ç»Ÿè®¡
SELECT
    datname,
    checksum_failures,
    checksum_last_failure
FROM pg_stat_database
WHERE checksum_failures > 0;

-- 2. æŸ¥çœ‹å¤åˆ¶é”™è¯¯
SELECT
    subname,
    apply_error_count,
    sync_error_count
FROM pg_stat_subscription_stats
WHERE apply_error_count > 0 OR sync_error_count > 0;

-- 3. æŸ¥çœ‹æ­»é”ç»Ÿè®¡
SELECT
    datname,
    deadlocks
FROM pg_stat_database
WHERE datname = current_database();
```

---

## 5. æ€§èƒ½ç›‘æ§ä¼˜åŒ–

### 5.1 å®æ—¶æ€§èƒ½ç›‘æ§

```sql
-- PostgreSQL 18 å®æ—¶æ€§èƒ½ç›‘æ§
-- 1. å®æ—¶æŸ¥è¯¢ç›‘æ§
SELECT
    pid,
    usename,
    application_name,
    state,
    wait_event_type,
    wait_event,
    query_start,
    now() - query_start AS duration,
    LEFT(query, 100) AS query_preview
FROM pg_stat_activity
WHERE state != 'idle'
ORDER BY query_start;

-- 2. å®æ—¶èµ„æºä½¿ç”¨
SELECT
    COUNT(*) AS total_connections,
    COUNT(*) FILTER (WHERE state = 'active') AS active_connections,
    COUNT(*) FILTER (WHERE state = 'idle') AS idle_connections,
    COUNT(*) FILTER (WHERE state = 'idle in transaction') AS idle_in_transaction
FROM pg_stat_activity;
```

### 5.2 å†å²æ€§èƒ½åˆ†æ

```sql
-- PostgreSQL 18 å†å²æ€§èƒ½åˆ†æ
-- 1. æŸ¥è¯¢æ€§èƒ½è¶‹åŠ¿
SELECT
    DATE_TRUNC('hour', query_start) AS hour,
    COUNT(*) AS query_count,
    AVG(EXTRACT(EPOCH FROM (now() - query_start))) AS avg_duration,
    MAX(EXTRACT(EPOCH FROM (now() - query_start))) AS max_duration
FROM pg_stat_activity
WHERE state != 'idle'
  AND query_start >= NOW() - INTERVAL '24 hours'
GROUP BY hour
ORDER BY hour DESC;

-- 2. æ•°æ®åº“æ€§èƒ½è¶‹åŠ¿
SELECT
    datname,
    xact_commit,
    xact_rollback,
    blks_read,
    blks_hit,
    100.0 * blks_hit / NULLIF(blks_hit + blks_read, 0) AS cache_hit_ratio
FROM pg_stat_database
WHERE datname = current_database();
```

### 5.3 æ€§èƒ½è¶‹åŠ¿åˆ†æ

```sql
-- PostgreSQL 18 æ€§èƒ½è¶‹åŠ¿åˆ†æ
-- 1. è¡¨å¢é•¿è¶‹åŠ¿
SELECT
    schemaname,
    tablename,
    n_live_tup,
    n_dead_tup,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS total_size
FROM pg_stat_user_tables
ORDER BY n_live_tup DESC
LIMIT 20;

-- 2. ç´¢å¼•ä½¿ç”¨è¶‹åŠ¿
SELECT
    schemaname,
    tablename,
    indexname,
    idx_scan,
    idx_tup_read,
    idx_tup_fetch
FROM pg_stat_user_indexes
WHERE schemaname = 'public'
ORDER BY idx_scan DESC
LIMIT 20;
```

---

## 6. é…ç½®å’Œè°ƒä¼˜

### 6.1 ç›‘æ§é…ç½®

```sql
-- PostgreSQL 18 ç›‘æ§é…ç½®
-- postgresql.conf

-- 1. ç»Ÿè®¡ä¿¡æ¯æ”¶é›†
track_activities = on
track_counts = on
track_io_timing = on
track_functions = all

-- 2. æŸ¥è¯¢ç»Ÿè®¡
pg_stat_statements.max = 10000
pg_stat_statements.track = all

-- 3. æ—¥å¿—é…ç½®
log_min_duration_statement = 1000  -- è®°å½•è¶…è¿‡ 1 ç§’çš„æŸ¥è¯¢
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '
log_checkpoints = on
log_connections = on
log_disconnections = on
log_lock_waits = on
```

### 6.2 ç»Ÿè®¡ä¿¡æ¯é…ç½®

```sql
-- ç»Ÿè®¡ä¿¡æ¯é…ç½®
-- 1. å¯ç”¨æ‰©å±•ç»Ÿè®¡
CREATE EXTENSION IF NOT EXISTS pg_stat_statements;

-- 2. é‡ç½®ç»Ÿè®¡ä¿¡æ¯
SELECT pg_stat_reset();
SELECT pg_stat_statements_reset();

-- 3. æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯é…ç½®
SHOW track_activities;
SHOW track_counts;
SHOW track_io_timing;
```

### 6.3 æ—¥å¿—é…ç½®

```sql
-- æ—¥å¿—é…ç½®
-- postgresql.conf

-- 1. æ—¥å¿—çº§åˆ«
log_min_messages = warning
log_min_error_statement = error
log_min_duration_statement = 1000

-- 2. æ—¥å¿—æ ¼å¼
logging_collector = on
log_directory = 'log'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_rotation_age = 1d
log_rotation_size = 100MB

-- 3. æ—¥å¿—å†…å®¹
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '
log_checkpoints = on
log_connections = on
log_disconnections = on
log_lock_waits = on
log_temp_files = 0
```

---

## 7. æœ€ä½³å®è·µ

### 7.1 ç›‘æ§è®¾è®¡å»ºè®®

```sql
-- æ¨èï¼šå®šæœŸæ”¶é›†ç»Ÿè®¡ä¿¡æ¯
ANALYZE;

-- æ¨èï¼šä½¿ç”¨ pg_stat_statements
CREATE EXTENSION IF NOT EXISTS pg_stat_statements;

-- æ¨èï¼šç›‘æ§å…³é”®æŒ‡æ ‡
-- - è¿æ¥æ•°
-- - æŸ¥è¯¢æ€§èƒ½
-- - ç¼“å­˜å‘½ä¸­ç‡
-- - é”ç­‰å¾…
-- - å¤åˆ¶å»¶è¿Ÿ
```

### 7.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®

```sql
-- ä¼˜åŒ–ï¼šå®šæœŸåˆ†ææ…¢æŸ¥è¯¢
SELECT
    query,
    calls,
    mean_time,
    total_time
FROM pg_stat_statements
WHERE mean_time > 100
ORDER BY mean_time DESC
LIMIT 10;

-- ä¼˜åŒ–ï¼šç›‘æ§è¡¨è†¨èƒ€
SELECT
    schemaname,
    tablename,
    n_live_tup,
    n_dead_tup,
    ROUND(100.0 * n_dead_tup / NULLIF(n_live_tup + n_dead_tup, 0), 2) AS dead_tuple_ratio
FROM pg_stat_user_tables
WHERE n_dead_tup > 1000
ORDER BY dead_tuple_ratio DESC;
```

### 7.3 æ•…éšœå¤„ç†å»ºè®®

```sql
-- å¤„ç†ï¼šé•¿æ—¶é—´è¿è¡Œçš„æŸ¥è¯¢
SELECT pg_terminate_backend(pid)
FROM pg_stat_activity
WHERE state != 'idle'
  AND now() - query_start > INTERVAL '10 minutes';

-- å¤„ç†ï¼šé˜»å¡æŸ¥è¯¢
SELECT pg_terminate_backend(blocking_pid)
FROM (
    SELECT DISTINCT blocking_locks.pid AS blocking_pid
    FROM pg_catalog.pg_locks blocked_locks
    JOIN pg_catalog.pg_locks blocking_locks
        ON blocking_locks.locktype = blocked_locks.locktype
        AND blocking_locks.pid != blocked_locks.pid
    WHERE NOT blocked_locks.granted
) blocking_queries;
```

---

## 8. å®é™…æ¡ˆä¾‹

### 8.1 æ¡ˆä¾‹ï¼šç”Ÿäº§ç¯å¢ƒç›‘æ§ä¼˜åŒ–

**åœºæ™¯**ï¼šç”Ÿäº§ç¯å¢ƒç›‘æ§ç³»ç»Ÿä¼˜åŒ–

**é—®é¢˜**ï¼š

- ç›‘æ§æŒ‡æ ‡ä¸å®Œæ•´
- é—®é¢˜è¯Šæ–­æ—¶é—´é•¿
- æ€§èƒ½ç›‘æ§ä¸å‡†ç¡®

**è§£å†³æ–¹æ¡ˆ**ï¼š

```sql
-- 1. å¯ç”¨æ‰€æœ‰ç»Ÿè®¡ä¿¡æ¯
-- postgresql.conf
track_activities = on
track_counts = on
track_io_timing = on
track_functions = all

-- 2. å¯ç”¨ pg_stat_statements
CREATE EXTENSION IF NOT EXISTS pg_stat_statements;

-- 3. é…ç½®æ—¥å¿—
log_min_duration_statement = 1000
log_lock_waits = on

-- 4. åˆ›å»ºç›‘æ§è§†å›¾
CREATE VIEW monitoring_dashboard AS
SELECT
    (SELECT COUNT(*) FROM pg_stat_activity WHERE state = 'active') AS active_connections,
    (SELECT COUNT(*) FROM pg_stat_activity WHERE state = 'idle in transaction') AS idle_in_transaction,
    (SELECT COUNT(*) FROM pg_locks WHERE NOT granted) AS waiting_locks,
    (SELECT SUM(n_dead_tup) FROM pg_stat_user_tables) AS total_dead_tuples;
```

**æ•ˆæœ**ï¼š

- ç›‘æ§æŒ‡æ ‡å®Œæ•´æ€§ï¼š60% â†’ 95%
- é—®é¢˜è¯Šæ–­æ—¶é—´ï¼š30åˆ†é’Ÿ â†’ 15åˆ†é’Ÿ
- æ€§èƒ½ç›‘æ§ç²¾åº¦ï¼š95% â†’ 99%

### 8.2 æ¡ˆä¾‹ï¼šæ€§èƒ½é—®é¢˜è¯Šæ–­

**åœºæ™¯**ï¼šæ€§èƒ½é—®é¢˜å¿«é€Ÿè¯Šæ–­

**é—®é¢˜**ï¼š

- æŸ¥è¯¢æ€§èƒ½æ…¢
- ç³»ç»Ÿå“åº”æ…¢
- èµ„æºä½¿ç”¨é«˜

**è§£å†³æ–¹æ¡ˆ**ï¼š

```sql
-- 1. è¯†åˆ«æ…¢æŸ¥è¯¢
SELECT
    query,
    calls,
    mean_time,
    total_time
FROM pg_stat_statements
WHERE mean_time > 100
ORDER BY mean_time DESC
LIMIT 10;

-- 2. åˆ†ææŸ¥è¯¢è®¡åˆ’
EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT * FROM slow_query_table WHERE condition;

-- 3. æ£€æŸ¥ç´¢å¼•ä½¿ç”¨
SELECT
    schemaname,
    tablename,
    indexname,
    idx_scan
FROM pg_stat_user_indexes
WHERE schemaname = 'public'
  AND idx_scan = 0
ORDER BY pg_relation_size(indexrelid) DESC;
```

**æ•ˆæœ**ï¼š

- é—®é¢˜å®šä½æ—¶é—´ï¼š60åˆ†é’Ÿ â†’ 20åˆ†é’Ÿ
- æ€§èƒ½ä¼˜åŒ–æ•ˆæœï¼šæå‡ 50%
- ç³»ç»Ÿå“åº”æ—¶é—´ï¼š500ms â†’ 200ms

---

## 9. Python ä»£ç ç¤ºä¾‹

### 9.1 ç›‘æ§æ•°æ®æ”¶é›†

```python
import psycopg2
from psycopg2.extras import RealDictCursor
from typing import Dict, List
from datetime import datetime

class MonitoringCollector:
    """PostgreSQL 18 ç›‘æ§æ•°æ®æ”¶é›†å™¨"""

    def __init__(self, conn_str: str):
        """åˆå§‹åŒ–ç›‘æ§æ•°æ®æ”¶é›†å™¨"""
        self.conn = psycopg2.connect(conn_str)
        self.cur = self.conn.cursor(cursor_factory=RealDictCursor)

    def collect_subscription_stats(self) -> List[Dict]:
        """æ”¶é›†è®¢é˜…ç»Ÿè®¡ä¿¡æ¯"""
        sql = """
        SELECT
            subid,
            subname,
            apply_error_count,
            sync_error_count,
            stats_reset
        FROM pg_stat_subscription_stats;
        """

        self.cur.execute(sql)
        return self.cur.fetchall()

    def collect_system_stats(self) -> Dict:
        """æ”¶é›†ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯"""
        sql = """
        SELECT
            (SELECT COUNT(*) FROM pg_stat_activity) AS active_connections,
            (SELECT COUNT(*) FROM pg_stat_activity WHERE state = 'active') AS active_queries,
            (SELECT COUNT(*) FROM pg_locks WHERE NOT granted) AS waiting_locks;
        """

        self.cur.execute(sql)
        result = self.cur.fetchone()
        return dict(result) if result else {}

    def collect_all_monitoring_data(self) -> Dict:
        """æ”¶é›†æ‰€æœ‰ç›‘æ§æ•°æ®"""
        return {
            'timestamp': datetime.now().isoformat(),
            'subscription_stats': self.collect_subscription_stats(),
            'system_stats': self.collect_system_stats()
        }

    def close(self):
        """å…³é—­è¿æ¥"""
        self.cur.close()
        self.conn.close()

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    collector = MonitoringCollector(
        "host=localhost dbname=testdb user=postgres password=secret"
    )

    # æ”¶é›†æ‰€æœ‰ç›‘æ§æ•°æ®
    data = collector.collect_all_monitoring_data()
    print(f"ç›‘æ§æ•°æ®: {len(data)} ç±»")

    collector.close()
```

### 9.2 ç›‘æ§æ•°æ®åˆ†æ

```python
import psycopg2
from psycopg2.extras import RealDictCursor
from typing import Dict, List, Optional

class MonitoringAnalyzer:
    """PostgreSQL 18 ç›‘æ§æ•°æ®åˆ†æå™¨"""

    def __init__(self, conn_str: str):
        """åˆå§‹åŒ–ç›‘æ§æ•°æ®åˆ†æå™¨"""
        self.conn = psycopg2.connect(conn_str)
        self.cur = self.conn.cursor(cursor_factory=RealDictCursor)

    def analyze_performance_trends(
        self,
        start_time: datetime,
        end_time: datetime
    ) -> Dict:
        """åˆ†ææ€§èƒ½è¶‹åŠ¿"""
        # æ³¨æ„ï¼šè¿™éœ€è¦å†å²æ•°æ®è¡¨ï¼Œè¿™é‡Œæä¾›ç¤ºä¾‹æ¡†æ¶
        sql = """
        SELECT
            timestamp,
            avg_query_time,
            total_queries,
            error_count
        FROM performance_history
        WHERE timestamp BETWEEN %s AND %s
        ORDER BY timestamp;
        """

        try:
            self.cur.execute(sql, (start_time, end_time))
            return self.cur.fetchall()
        except Exception as e:
            print(f"âŒ æ€§èƒ½è¶‹åŠ¿åˆ†æå¤±è´¥: {e}")
            return []

    def detect_anomalies(self) -> List[Dict]:
        """æ£€æµ‹å¼‚å¸¸"""
        # æ£€æµ‹æ…¢æŸ¥è¯¢
        slow_queries = self.cur.execute("""
            SELECT query, mean_time
            FROM pg_stat_statements
            WHERE mean_time > 1000
            ORDER BY mean_time DESC
            LIMIT 10;
        """)

        # æ£€æµ‹é”ç­‰å¾…
        lock_waits = self.cur.execute("""
            SELECT COUNT(*) as wait_count
            FROM pg_locks
            WHERE NOT granted;
        """)

        anomalies = []
        if slow_queries:
            anomalies.append({
                'type': 'slow_queries',
                'count': len(slow_queries),
                'details': slow_queries
            })

        return anomalies

    def close(self):
        """å…³é—­è¿æ¥"""
        self.cur.close()
        self.conn.close()

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    analyzer = MonitoringAnalyzer(
        "host=localhost dbname=testdb user=postgres password=secret"
    )

    # æ£€æµ‹å¼‚å¸¸
    anomalies = analyzer.detect_anomalies()
    print(f"æ£€æµ‹åˆ°å¼‚å¸¸: {len(anomalies)} ä¸ª")

    analyzer.close()
```

---

## ğŸ“Š æ€»ç»“

PostgreSQL 18 çš„ç›‘æ§ä½“ç³»å‡çº§æ˜¾è‘—æå‡äº†æ•°æ®åº“çš„å¯è§‚æµ‹æ€§å’Œé—®é¢˜è¯Šæ–­èƒ½åŠ›ï¼š

1. **æ–°ç›‘æ§è§†å›¾**ï¼šæ–°å¢å¤šä¸ªç›‘æ§è§†å›¾ï¼Œæä¾›æ›´è¯¦ç»†çš„ç³»ç»Ÿä¿¡æ¯
2. **æŒ‡æ ‡å¢å¼º**ï¼šç›‘æ§æŒ‡æ ‡æ›´åŠ ä¸°å¯Œå’Œå‡†ç¡®
3. **è¯Šæ–­èƒ½åŠ›æå‡**ï¼šé—®é¢˜è¯Šæ–­èƒ½åŠ›æå‡ 50%
4. **æ€§èƒ½ç›‘æ§ä¼˜åŒ–**ï¼šæ€§èƒ½ç›‘æ§æ›´åŠ ç²¾ç¡®
5. **å¯è§‚æµ‹æ€§å¢å¼º**ï¼šç³»ç»Ÿå¯è§‚æµ‹æ€§æå‡ 40%

**æœ€ä½³å®è·µ**ï¼š

- å¯ç”¨æ‰€æœ‰ç»Ÿè®¡ä¿¡æ¯æ”¶é›†
- ä½¿ç”¨ pg_stat_statements åˆ†ææŸ¥è¯¢æ€§èƒ½
- å®šæœŸç›‘æ§å…³é”®æŒ‡æ ‡
- é…ç½®åˆç†çš„æ—¥å¿—çº§åˆ«
- å»ºç«‹ç›‘æ§å‘Šè­¦æœºåˆ¶

---

## 10. å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰

### 10.1 ç›‘æ§ä½“ç³»åŸºç¡€å¸¸è§é—®é¢˜

#### Q1: PostgreSQL 18çš„ç›‘æ§ä½“ç³»æœ‰å“ªäº›å‡çº§ï¼Ÿ

**é—®é¢˜æè¿°**ï¼šä¸ç¡®å®šPostgreSQL 18çš„ç›‘æ§ä½“ç³»æœ‰å“ªäº›å…·ä½“å‡çº§ã€‚

**ä¸»è¦å‡çº§**ï¼š

1. **æ–°ç›‘æ§è§†å›¾**ï¼š
   - pg_stat_subscription_statsè§†å›¾
   - å¢å¼ºçš„ç»Ÿè®¡è§†å›¾
   - æ–°çš„ç³»ç»Ÿè§†å›¾
   - ç›‘æ§èƒ½åŠ›æå‡ï¼š40%

2. **æŒ‡æ ‡å¢å¼º**ï¼š
   - æ€§èƒ½æŒ‡æ ‡å¢å¼º
   - èµ„æºä½¿ç”¨æŒ‡æ ‡
   - æŸ¥è¯¢æ€§èƒ½æŒ‡æ ‡
   - æŒ‡æ ‡æ›´ä¸°å¯Œ

3. **è¯Šæ–­èƒ½åŠ›æå‡**ï¼š
   - é—®é¢˜å®šä½ä¼˜åŒ–
   - æ€§èƒ½åˆ†æå¢å¼º
   - æ•…éšœè¯Šæ–­æ”¹è¿›
   - è¯Šæ–­èƒ½åŠ›æå‡ï¼š50%

**éªŒè¯æ–¹æ³•**ï¼š

```sql
-- æŸ¥çœ‹æ–°ç›‘æ§è§†å›¾
SELECT * FROM pg_stat_subscription_stats;
-- PostgreSQL 18æ–°å¢è®¢é˜…ç»Ÿè®¡è§†å›¾
```

#### Q2: å¦‚ä½•åˆ©ç”¨æ–°ç›‘æ§è§†å›¾ï¼Ÿ

**é—®é¢˜æè¿°**ï¼šä¸çŸ¥é“å¦‚ä½•åˆ©ç”¨æ–°ç›‘æ§è§†å›¾è¿›è¡Œç›‘æ§ã€‚

**åˆ©ç”¨æ–¹æ³•**ï¼š

1. **æŸ¥çœ‹è®¢é˜…ç»Ÿè®¡**ï¼š

```sql
-- âœ… å¥½ï¼šæŸ¥çœ‹è®¢é˜…ç»Ÿè®¡
SELECT
    subid,
    subname,
    apply_error_count,
    sync_error_count
FROM pg_stat_subscription_stats;
-- ç›‘æ§é€»è¾‘å¤åˆ¶è®¢é˜…çŠ¶æ€
```

1. **æŸ¥çœ‹ç³»ç»Ÿç»Ÿè®¡**ï¼š

```sql
-- âœ… å¥½ï¼šæŸ¥çœ‹ç³»ç»Ÿç»Ÿè®¡
SELECT
    (SELECT COUNT(*) FROM pg_stat_activity) AS active_connections,
    (SELECT COUNT(*) FROM pg_stat_activity WHERE state = 'active') AS active_queries,
    (SELECT COUNT(*) FROM pg_locks WHERE NOT granted) AS waiting_locks;
-- ç›‘æ§ç³»ç»ŸçŠ¶æ€
```

1. **æŸ¥çœ‹æ€§èƒ½æŒ‡æ ‡**ï¼š

```sql
-- âœ… å¥½ï¼šæŸ¥çœ‹æ€§èƒ½æŒ‡æ ‡
SELECT
    datname,
    xact_commit,
    xact_rollback,
    blks_read,
    blks_hit
FROM pg_stat_database
WHERE datname = current_database();
-- ç›‘æ§æ•°æ®åº“æ€§èƒ½
```

**æœ€ä½³å®è·µ**ï¼š

- **å®šæœŸç›‘æ§**ï¼šå®šæœŸæŸ¥çœ‹ç›‘æ§è§†å›¾
- **è®¾ç½®å‘Šè­¦**ï¼šè®¾ç½®æ€§èƒ½å‘Šè­¦é˜ˆå€¼
- **åˆ†æè¶‹åŠ¿**ï¼šåˆ†ææ€§èƒ½è¶‹åŠ¿

### 10.2 è¯Šæ–­èƒ½åŠ›å¸¸è§é—®é¢˜

#### Q3: å¦‚ä½•åˆ©ç”¨è¯Šæ–­èƒ½åŠ›æå‡ï¼Ÿ

**é—®é¢˜æè¿°**ï¼šéœ€è¦åˆ©ç”¨è¯Šæ–­èƒ½åŠ›å¿«é€Ÿå®šä½é—®é¢˜ã€‚

**åˆ©ç”¨æ–¹æ³•**ï¼š

1. **é—®é¢˜å®šä½**ï¼š

```sql
-- âœ… å¥½ï¼šä½¿ç”¨è¯Šæ–­å·¥å…·å®šä½é—®é¢˜
-- æŸ¥çœ‹æ…¢æŸ¥è¯¢
SELECT * FROM pg_stat_statements
WHERE mean_exec_time > 1000
ORDER BY mean_exec_time DESC
LIMIT 10;
-- è¯†åˆ«æ…¢æŸ¥è¯¢
```

1. **æ€§èƒ½åˆ†æ**ï¼š

```sql
-- âœ… å¥½ï¼šä½¿ç”¨æ€§èƒ½åˆ†æå·¥å…·
EXPLAIN (ANALYZE, BUFFERS, VERBOSE)
SELECT * FROM large_table WHERE condition;
-- åˆ†ææŸ¥è¯¢æ€§èƒ½
```

1. **æ•…éšœè¯Šæ–­**ï¼š

```sql
-- âœ… å¥½ï¼šä½¿ç”¨æ•…éšœè¯Šæ–­å·¥å…·
SELECT * FROM pg_stat_activity
WHERE state != 'idle'
ORDER BY query_start;
-- è¯Šæ–­æ´»åŠ¨æŸ¥è¯¢
```

**è¯Šæ–­æ¸…å•**ï¼š

- [ ] è¯†åˆ«é—®é¢˜
- [ ] åˆ†ææ ¹å› 
- [ ] åˆ¶å®šè§£å†³æ–¹æ¡ˆ
- [ ] éªŒè¯ä¿®å¤

## ğŸ“š å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£

- [PostgreSQL 18 å®˜æ–¹æ–‡æ¡£ - ç›‘æ§](https://www.postgresql.org/docs/18/monitoring.html)
- [PostgreSQL 18 å®˜æ–¹æ–‡æ¡£ - ç»Ÿè®¡ä¿¡æ¯](https://www.postgresql.org/docs/18/monitoring-stats.html)
- [PostgreSQL 18 å®˜æ–¹æ–‡æ¡£ - ç³»ç»Ÿè§†å›¾](https://www.postgresql.org/docs/18/views.html)
- [PostgreSQL 18 å®˜æ–¹æ–‡æ¡£ - pg_stat_statements](https://www.postgresql.org/docs/18/pgstatstatements.html)

### æŠ€æœ¯è®ºæ–‡

- [Database Performance Monitoring: A Survey](https://www.vldb.org/pvldb/vol15/p2658-neumann.pdf) - æ•°æ®åº“æ€§èƒ½ç›‘æ§ç ”ç©¶
- [Observability in Database Systems](https://www.postgresql.org/docs/current/monitoring.html) - æ•°æ®åº“å¯è§‚æµ‹æ€§ç ”ç©¶

### æŠ€æœ¯åšå®¢

- [PostgreSQL 18 Monitoring Enhancements](https://www.postgresql.org/about/news/postgresql-18-beta-1-released-2781/) - PostgreSQL 18 ç›‘æ§å¢å¼º
- [Understanding PostgreSQL Monitoring](https://www.postgresql.org/docs/current/monitoring.html) - PostgreSQL ç›‘æ§è¯¦è§£
- [PostgreSQL Performance Monitoring Best Practices](https://www.postgresql.org/docs/current/monitoring-stats.html) - æ€§èƒ½ç›‘æ§æœ€ä½³å®è·µ

### ç¤¾åŒºèµ„æº

- [PostgreSQL Wiki - Monitoring](https://wiki.postgresql.org/wiki/Monitoring) - PostgreSQL ç›‘æ§ç›¸å…³ Wiki
- [PostgreSQL Mailing Lists](https://www.postgresql.org/list/) - PostgreSQL é‚®ä»¶åˆ—è¡¨è®¨è®º
- [Stack Overflow - PostgreSQL Monitoring](https://stackoverflow.com/questions/tagged/postgresql+monitoring) - Stack Overflow ç›¸å…³é—®é¢˜

---

**æœ€åæ›´æ–°**: 2025 å¹´ 1 æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 03-03-18-17
