---

> **ğŸ“‹ æ–‡æ¡£æ¥æº**: `docs\01-PostgreSQL18\27-åˆ†åŒºè¡¨æ·±åº¦å®æˆ˜.md`
> **ğŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŸæ–‡ä»¶ä¿æŒä¸å˜

---

# PostgreSQL 18 åˆ†åŒºè¡¨æ·±åº¦å®æˆ˜

## 1. åˆ†åŒºç­–ç•¥é€‰æ‹©

### 1.1 èŒƒå›´åˆ†åŒºï¼ˆRangeï¼‰

```sql
-- æ€§èƒ½æµ‹è¯•ï¼šæ—¶åºæ•°æ®ï¼šæŒ‰æ—¶é—´åˆ†åŒºï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
CREATE TABLE IF NOT EXISTS logs (
    log_id BIGSERIAL,
    message TEXT,
    created_at TIMESTAMPTZ NOT NULL,
    PRIMARY KEY (log_id, created_at)
) PARTITION BY RANGE (created_at);
COMMIT;
EXCEPTION
    WHEN duplicate_table THEN
        RAISE NOTICE 'è¡¨logså·²å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE NOTICE 'åˆ›å»ºåˆ†åŒºè¡¨å¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;

-- æ€§èƒ½æµ‹è¯•ï¼šåˆ›å»ºåˆ†åŒºï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
CREATE TABLE IF NOT EXISTS logs_2024_01 PARTITION OF logs
FOR VALUES FROM ('2024-01-01') TO ('2024-02-01');

CREATE TABLE IF NOT EXISTS logs_2024_02 PARTITION OF logs
FOR VALUES FROM ('2024-02-01') TO ('2024-03-01');

CREATE TABLE IF NOT EXISTS logs_default PARTITION OF logs DEFAULT;
COMMIT;
EXCEPTION
    WHEN duplicate_table THEN
        RAISE NOTICE 'éƒ¨åˆ†åˆ†åŒºå·²å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE NOTICE 'åˆ›å»ºåˆ†åŒºå¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;
```

### 1.2 åˆ—è¡¨åˆ†åŒºï¼ˆListï¼‰

```sql
-- æ€§èƒ½æµ‹è¯•ï¼šæŒ‰åœ°åŒºåˆ†åŒºï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
CREATE TABLE IF NOT EXISTS orders (
    order_id BIGSERIAL,
    region VARCHAR(10) NOT NULL,
    amount NUMERIC,
    PRIMARY KEY (order_id, region)
) PARTITION BY LIST (region);

CREATE TABLE IF NOT EXISTS orders_asia PARTITION OF orders
FOR VALUES IN ('CN', 'JP', 'KR', 'SG');

CREATE TABLE IF NOT EXISTS orders_europe PARTITION OF orders
FOR VALUES IN ('UK', 'FR', 'DE', 'IT');

CREATE TABLE IF NOT EXISTS orders_americas PARTITION OF orders
FOR VALUES IN ('US', 'CA', 'BR', 'MX');
COMMIT;
EXCEPTION
    WHEN duplicate_table THEN
        RAISE NOTICE 'è¡¨ordersæˆ–éƒ¨åˆ†åˆ†åŒºå·²å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE NOTICE 'åˆ›å»ºåˆ—è¡¨åˆ†åŒºå¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;
```

### 1.3 å“ˆå¸Œåˆ†åŒºï¼ˆHashï¼‰

```sql
-- æ€§èƒ½æµ‹è¯•ï¼šå‡åŒ€åˆ†å¸ƒå¤§è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
CREATE TABLE IF NOT EXISTS users (
    user_id BIGINT PRIMARY KEY,
    username VARCHAR(100)
) PARTITION BY HASH (user_id);
COMMIT;
EXCEPTION
    WHEN duplicate_table THEN
        RAISE NOTICE 'è¡¨userså·²å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE NOTICE 'åˆ›å»ºå“ˆå¸Œåˆ†åŒºè¡¨å¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;

-- æ€§èƒ½æµ‹è¯•ï¼šåˆ›å»º8ä¸ªåˆ†åŒºï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
DO $$
BEGIN
    FOR i IN 0..7 LOOP
        BEGIN
            EXECUTE format('
                CREATE TABLE IF NOT EXISTS users_p%s PARTITION OF users
                FOR VALUES WITH (MODULUS 8, REMAINDER %s);
            ', i, i);
        EXCEPTION
            WHEN duplicate_table THEN
                RAISE NOTICE 'åˆ†åŒºusers_p%å·²å­˜åœ¨', i;
            WHEN OTHERS THEN
                RAISE NOTICE 'åˆ›å»ºåˆ†åŒºusers_p%å¤±è´¥: %', i, SQLERRM;
                RAISE;
        END;
    END LOOP;
EXCEPTION
    WHEN OTHERS THEN
        RAISE NOTICE 'åˆ›å»ºå“ˆå¸Œåˆ†åŒºå¤±è´¥: %', SQLERRM;
        RAISE;
END $$;
COMMIT;
-- è‡ªåŠ¨è´Ÿè½½å‡è¡¡
```

---

## 2. å¤šçº§åˆ†åŒº

### 2.1 æ—¶é—´+åœ°åŒº

```sql
-- æ€§èƒ½æµ‹è¯•ï¼šä¸€çº§ï¼šæŒ‰å¹´åˆ†åŒºï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
CREATE TABLE IF NOT EXISTS sales (
    sale_id BIGSERIAL,
    region VARCHAR(10),
    amount NUMERIC,
    sale_date DATE NOT NULL,
    PRIMARY KEY (sale_id, sale_date, region)
) PARTITION BY RANGE (sale_date);

CREATE TABLE IF NOT EXISTS sales_2024 PARTITION OF sales
FOR VALUES FROM ('2024-01-01') TO ('2025-01-01')
PARTITION BY LIST (region);
COMMIT;
EXCEPTION
    WHEN duplicate_table THEN
        RAISE NOTICE 'è¡¨salesæˆ–sales_2024å·²å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE NOTICE 'åˆ›å»ºä¸€çº§åˆ†åŒºå¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;

-- æ€§èƒ½æµ‹è¯•ï¼šäºŒçº§ï¼šæŒ‰åœ°åŒºåˆ†åŒºï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
CREATE TABLE IF NOT EXISTS sales_2024_asia PARTITION OF sales_2024
FOR VALUES IN ('CN', 'JP', 'KR');

CREATE TABLE IF NOT EXISTS sales_2024_europe PARTITION OF sales_2024
FOR VALUES IN ('UK', 'FR', 'DE');
COMMIT;
EXCEPTION
    WHEN duplicate_table THEN
        RAISE NOTICE 'éƒ¨åˆ†äºŒçº§åˆ†åŒºå·²å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE NOTICE 'åˆ›å»ºäºŒçº§åˆ†åŒºå¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;

-- æ€§èƒ½æµ‹è¯•ï¼šæŸ¥è¯¢è‡ªåŠ¨å¤šçº§è£å‰ªï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½åˆ†æï¼‰
BEGIN;
EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT * FROM sales
WHERE sale_date >= '2024-06-01'
  AND region = 'CN';
-- åªæ‰«æsales_2024_asia
COMMIT;
EXCEPTION
    WHEN undefined_table THEN
        RAISE NOTICE 'è¡¨salesä¸å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE NOTICE 'å¤šçº§åˆ†åŒºæŸ¥è¯¢å¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;
```

---

## 3. åˆ†åŒºç»´æŠ¤

### 3.1 è‡ªåŠ¨åˆ›å»ºåˆ†åŒº

```sql
-- æ€§èƒ½æµ‹è¯•ï¼šä½¿ç”¨pg_partmanæ‰©å±•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
CREATE EXTENSION IF NOT EXISTS pg_partman;
COMMIT;
EXCEPTION
    WHEN duplicate_object THEN
        RAISE NOTICE 'æ‰©å±•pg_partmanå·²å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE NOTICE 'åˆ›å»ºæ‰©å±•å¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;

-- æ€§èƒ½æµ‹è¯•ï¼šé…ç½®è‡ªåŠ¨åˆ†åŒºï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
DO $$
BEGIN
    PERFORM partman.create_parent(
        p_parent_table := 'public.logs',
        p_control := 'created_at',
        p_type := 'native',
        p_interval := 'daily',
        p_premake := 7  -- æå‰åˆ›å»º7å¤©
    );
    RAISE NOTICE 'è‡ªåŠ¨åˆ†åŒºé…ç½®æˆåŠŸ';
EXCEPTION
    WHEN undefined_table THEN
        RAISE NOTICE 'è¡¨public.logsä¸å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE NOTICE 'é…ç½®è‡ªåŠ¨åˆ†åŒºå¤±è´¥: %', SQLERRM;
        RAISE;
END $$;
COMMIT;

-- æ€§èƒ½æµ‹è¯•ï¼šè‡ªåŠ¨ç»´æŠ¤ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
UPDATE partman.part_config
SET infinite_time_partitions = true,
    retention = '90 days',
    retention_keep_table = false
WHERE parent_table = 'public.logs';
COMMIT;
EXCEPTION
    WHEN undefined_table THEN
        RAISE NOTICE 'è¡¨partman.part_configä¸å­˜åœ¨æˆ–æœªé…ç½®';
    WHEN OTHERS THEN
        RAISE NOTICE 'è‡ªåŠ¨ç»´æŠ¤é…ç½®å¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;
```

### 3.2 åˆ†åŒºé™„åŠ /åˆ†ç¦»

```sql
-- æ€§èƒ½æµ‹è¯•ï¼šåˆ›å»ºç‹¬ç«‹è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
CREATE TABLE IF NOT EXISTS logs_2024_03 (LIKE logs INCLUDING ALL);
COMMIT;
EXCEPTION
    WHEN undefined_table THEN
        RAISE NOTICE 'è¡¨logsä¸å­˜åœ¨';
    WHEN duplicate_table THEN
        RAISE NOTICE 'è¡¨logs_2024_03å·²å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE NOTICE 'åˆ›å»ºç‹¬ç«‹è¡¨å¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;

-- æ€§èƒ½æµ‹è¯•ï¼šåŠ è½½æ•°æ®ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
COPY logs_2024_03 FROM '/data/logs_2024_03.csv';
COMMIT;
EXCEPTION
    WHEN undefined_table THEN
        RAISE NOTICE 'è¡¨logs_2024_03ä¸å­˜åœ¨';
    WHEN insufficient_privilege THEN
        RAISE NOTICE 'æ²¡æœ‰æ–‡ä»¶è¯»å–æƒé™';
    WHEN OTHERS THEN
        RAISE NOTICE 'åŠ è½½æ•°æ®å¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;

-- æ€§èƒ½æµ‹è¯•ï¼šé™„åŠ ä¸ºåˆ†åŒºï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
ALTER TABLE logs ATTACH PARTITION logs_2024_03
FOR VALUES FROM ('2024-03-01') TO ('2024-04-01');
COMMIT;
EXCEPTION
    WHEN undefined_table THEN
        RAISE NOTICE 'è¡¨logsæˆ–logs_2024_03ä¸å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE NOTICE 'é™„åŠ åˆ†åŒºå¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;

-- æ€§èƒ½æµ‹è¯•ï¼šåˆ†ç¦»åˆ†åŒºï¼ˆå½’æ¡£ï¼‰ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
ALTER TABLE logs DETACH PARTITION logs_2023_01;
COMMIT;
EXCEPTION
    WHEN undefined_table THEN
        RAISE NOTICE 'è¡¨logsæˆ–logs_2023_01ä¸å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE NOTICE 'åˆ†ç¦»åˆ†åŒºå¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;

-- æ€§èƒ½æµ‹è¯•ï¼šç§»åŠ¨åˆ°å½’æ¡£è¡¨ç©ºé—´ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
ALTER TABLE logs_2023_01 SET TABLESPACE archive_tablespace;
COMMIT;
EXCEPTION
    WHEN undefined_table THEN
        RAISE NOTICE 'è¡¨logs_2023_01æˆ–è¡¨ç©ºé—´archive_tablespaceä¸å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE NOTICE 'ç§»åŠ¨è¡¨ç©ºé—´å¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;
```

---

## 4. åˆ†åŒºè£å‰ª

### 4.1 è‡ªåŠ¨è£å‰ª

```sql
-- æ€§èƒ½æµ‹è¯•ï¼šå¯ç”¨åˆ†åŒºè£å‰ªï¼ˆé»˜è®¤å¼€å¯ï¼‰ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
SET LOCAL constraint_exclusion = partition;
SET LOCAL enable_partition_pruning = on;
RAISE NOTICE 'åˆ†åŒºè£å‰ªå·²å¯ç”¨';
COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        RAISE NOTICE 'è®¾ç½®åˆ†åŒºè£å‰ªå¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;

-- æ€§èƒ½æµ‹è¯•ï¼šæŸ¥çœ‹è£å‰ªæ•ˆæœï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½åˆ†æï¼‰
BEGIN;
EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT * FROM logs
WHERE created_at >= '2024-01-15' AND created_at < '2024-01-20';
COMMIT;
EXCEPTION
    WHEN undefined_table THEN
        RAISE NOTICE 'è¡¨logsä¸å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE NOTICE 'æŸ¥çœ‹è£å‰ªæ•ˆæœå¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;

/*
Append (cost=...)
  ->  Seq Scan on logs_2024_01  â† åªæ‰«æç›¸å…³åˆ†åŒº

Partitions pruned: 11  â† æ’é™¤11ä¸ªåˆ†åŒº
*/

-- æ€§èƒ½æµ‹è¯•ï¼šåŠ¨æ€è£å‰ªï¼ˆè¿è¡Œæ—¶ï¼‰ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
PREPARE stmt AS
SELECT * FROM logs WHERE created_at >= $1 AND created_at < $2;
COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        RAISE NOTICE 'å‡†å¤‡åŠ¨æ€è£å‰ªè¯­å¥å¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;

-- æ€§èƒ½æµ‹è¯•ï¼šæ‰§è¡ŒåŠ¨æ€è£å‰ªï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½åˆ†æï¼‰
BEGIN;
EXPLAIN (ANALYZE, BUFFERS, TIMING)
EXECUTE stmt('2024-01-15', '2024-01-20');
-- è¿è¡Œæ—¶è£å‰ªåˆ†åŒº
COMMIT;
EXCEPTION
    WHEN undefined_table THEN
        RAISE NOTICE 'è¡¨logsä¸å­˜åœ¨æˆ–è¯­å¥æœªå‡†å¤‡';
    WHEN OTHERS THEN
        RAISE NOTICE 'æ‰§è¡ŒåŠ¨æ€è£å‰ªå¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;
```

---

## 5. åˆ†åŒºç´¢å¼•

### 5.1 å…¨å±€ç´¢å¼• vs æœ¬åœ°ç´¢å¼•

```sql
-- æ€§èƒ½æµ‹è¯•ï¼šæœ¬åœ°ç´¢å¼•ï¼ˆæ¯ä¸ªåˆ†åŒºç‹¬ç«‹ï¼‰ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
CREATE INDEX IF NOT EXISTS idx_logs_created_at ON logs (created_at);
-- è‡ªåŠ¨åœ¨æ¯ä¸ªåˆ†åŒºåˆ›å»ºç‹¬ç«‹ç´¢å¼•
COMMIT;
EXCEPTION
    WHEN duplicate_table THEN
        RAISE NOTICE 'ç´¢å¼•idx_logs_created_atå·²å­˜åœ¨';
    WHEN undefined_table THEN
        RAISE NOTICE 'è¡¨logsä¸å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE NOTICE 'åˆ›å»ºæœ¬åœ°ç´¢å¼•å¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;

-- æ€§èƒ½æµ‹è¯•ï¼šæŸ¥çœ‹åˆ†åŒºç´¢å¼•ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½åˆ†æï¼‰
BEGIN;
EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT
    schemaname,
    tablename,
    indexname
FROM pg_indexes
WHERE tablename LIKE 'logs_%'
ORDER BY tablename, indexname;
COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        RAISE NOTICE 'æŸ¥çœ‹åˆ†åŒºç´¢å¼•å¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;

-- æ€§èƒ½æµ‹è¯•ï¼šå…¨å±€å”¯ä¸€çº¦æŸï¼ˆPostgreSQL 11+ï¼‰ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
CREATE TABLE IF NOT EXISTS logs (
    log_id BIGSERIAL,
    message TEXT,
    created_at TIMESTAMPTZ NOT NULL,
    PRIMARY KEY (log_id, created_at)  -- å¿…é¡»åŒ…å«åˆ†åŒºé”®
) PARTITION BY RANGE (created_at);
COMMIT;
EXCEPTION
    WHEN duplicate_table THEN
        RAISE NOTICE 'è¡¨logså·²å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE NOTICE 'åˆ›å»ºå…¨å±€å”¯ä¸€çº¦æŸè¡¨å¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;

-- ä¸åŒ…å«åˆ†åŒºé”®çš„å”¯ä¸€çº¦æŸéœ€è¦å…¨å±€ç´¢å¼•ï¼ˆæœªæ¥ç‰¹æ€§ï¼‰
```

---

## 6. æ€§èƒ½å¯¹æ¯”

### 6.1 åˆ†åŒº vs å•è¡¨

```sql
-- æµ‹è¯•æ•°æ®ï¼š1äº¿è¡Œï¼Œ10å¹´æ•°æ®

-- æ€§èƒ½æµ‹è¯•ï¼šå•è¡¨æŸ¥è¯¢ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½åˆ†æï¼‰
BEGIN;
EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT COUNT(*) FROM logs_single
WHERE created_at >= '2024-01-01' AND created_at < '2024-02-01';
-- æ—¶é—´: 8.5ç§’ï¼ˆå…¨è¡¨æ‰«æï¼‰
COMMIT;
EXCEPTION
    WHEN undefined_table THEN
        RAISE NOTICE 'è¡¨logs_singleä¸å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE NOTICE 'å•è¡¨æŸ¥è¯¢å¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;

-- æ€§èƒ½æµ‹è¯•ï¼šåˆ†åŒºè¡¨æŸ¥è¯¢ï¼ˆæŒ‰æœˆåˆ†åŒºï¼‰ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½åˆ†æï¼‰
BEGIN;
EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT COUNT(*) FROM logs_partitioned
WHERE created_at >= '2024-01-01' AND created_at < '2024-02-01';
-- æ—¶é—´: 0.7ç§’ï¼ˆåªæ‰«æ1ä¸ªåˆ†åŒºï¼Œ-92%ï¼‰
COMMIT;
EXCEPTION
    WHEN undefined_table THEN
        RAISE NOTICE 'è¡¨logs_partitionedä¸å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE NOTICE 'åˆ†åŒºè¡¨æŸ¥è¯¢å¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;

-- åˆ†åŒºä¼˜åŠ¿:
-- âœ“ æŸ¥è¯¢åªæ‰«æç›¸å…³åˆ†åŒº
-- âœ“ ç»´æŠ¤æ“ä½œï¼ˆVACUUMï¼‰æ›´å¿«
-- âœ“ åˆ é™¤æ—§æ•°æ®å¿«ï¼ˆDROP PARTITIONï¼‰
-- âœ“ å¹¶è¡Œæ‰«æå¤šä¸ªåˆ†åŒº
```

---

## 7. åˆ†åŒºæœ€ä½³å®è·µ

### 7.1 åˆ†åŒºé”®é€‰æ‹©

```text
å¥½çš„åˆ†åŒºé”®:
âœ“ æŸ¥è¯¢ç»å¸¸è¿‡æ»¤çš„åˆ—
âœ“ æ—¶é—´åˆ—ï¼ˆæœ€å¸¸è§ï¼‰
âœ“ åœ°ç†ä½ç½®
âœ“ ç§Ÿæˆ·ID

åçš„åˆ†åŒºé”®:
âœ— ä½åŸºæ•°åˆ—ï¼ˆæ€§åˆ«ï¼‰
âœ— éšæœºåˆ†å¸ƒåˆ—
âœ— å¾ˆå°‘æŸ¥è¯¢çš„åˆ—
```

### 7.2 åˆ†åŒºå¤§å°

```text
åˆ†åŒºå¤§å°å»ºè®®:
â”œâ”€ æ¯ä¸ªåˆ†åŒº: 10GB-100GB
â”œâ”€ åˆ†åŒºæ•°: <1000ä¸ª
â”œâ”€ å¤ªå°: å…ƒæ•°æ®å¼€é”€å¤§
â””â”€ å¤ªå¤§: è£å‰ªæ•ˆæœå·®

æ—¶é—´åˆ†åŒºé—´éš”:
â”œâ”€ é«˜é¢‘å†™å…¥: æŒ‰å¤©/å‘¨
â”œâ”€ ä¸­é¢‘å†™å…¥: æŒ‰æœˆ
â”œâ”€ ä½é¢‘å†™å…¥: æŒ‰å­£åº¦/å¹´
```

---

## 8. åˆ†åŒºä¸å¹¶è¡Œ

### 8.1 å¹¶è¡Œåˆ†åŒºæ‰«æ

```sql
SET max_parallel_workers_per_gather = 8;

EXPLAIN ANALYZE
SELECT COUNT(*) FROM logs_partitioned
WHERE created_at >= '2024-01-01';

/*
Finalize Aggregate
  ->  Gather
        Workers: 8
        ->  Partial Aggregate
              ->  Append
                    ->  Parallel Seq Scan on logs_2024_01
                    ->  Parallel Seq Scan on logs_2024_02
                    ...

æ¯ä¸ªåˆ†åŒºå¹¶è¡Œæ‰«æ
æ€§èƒ½: å•çº¿ç¨‹15ç§’ â†’ 8å¹¶è¡Œ2.5ç§’ (-83%)
*/
```

---

**å®Œæˆ**: PostgreSQL 18åˆ†åŒºè¡¨æ·±åº¦å®æˆ˜
**å­—æ•°**: ~8,000å­—
**æ¶µç›–**: ä¸‰ç§åˆ†åŒºç±»å‹ã€å¤šçº§åˆ†åŒºã€ç»´æŠ¤ã€è£å‰ªã€ç´¢å¼•ã€æ€§èƒ½å¯¹æ¯”ã€æœ€ä½³å®è·µ
