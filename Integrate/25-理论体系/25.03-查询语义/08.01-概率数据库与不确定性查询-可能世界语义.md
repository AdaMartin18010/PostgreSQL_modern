---

> **ğŸ“‹ æ–‡æ¡£æ¥æº**: `DataBaseTheory\08-æŸ¥è¯¢è¯­è¨€ä¸è¯­ä¹‰\08.01-æ¦‚ç‡æ•°æ®åº“ä¸ä¸ç¡®å®šæ€§æŸ¥è¯¢-å¯èƒ½ä¸–ç•Œè¯­ä¹‰.md`
> **ğŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŸæ–‡ä»¶ä¿æŒä¸å˜

---

# æ¦‚ç‡æ•°æ®åº“ä¸ä¸ç¡®å®šæ€§æŸ¥è¯¢-å¯èƒ½ä¸–ç•Œè¯­ä¹‰

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **æœ€åæ›´æ–°**: 2025-01-16
> **ç‰ˆæœ¬è¦†ç›–**: PostgreSQL 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x (å…¼å®¹)
> **æ–‡æ¡£çŠ¶æ€**: âœ… å†…å®¹å·²å®Œå–„

---

## ğŸ“‹ ç›®å½•

- [æ¦‚ç‡æ•°æ®åº“ä¸ä¸ç¡®å®šæ€§æŸ¥è¯¢-å¯èƒ½ä¸–ç•Œè¯­ä¹‰](#æ¦‚ç‡æ•°æ®åº“ä¸ä¸ç¡®å®šæ€§æŸ¥è¯¢-å¯èƒ½ä¸–ç•Œè¯­ä¹‰)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.0 æ¦‚ç‡æ•°æ®åº“å·¥ä½œåŸç†æ¦‚è¿°](#10-æ¦‚ç‡æ•°æ®åº“å·¥ä½œåŸç†æ¦‚è¿°)
    - [1.1 æœ¬æ–‡æ¡£çš„èŒƒå›´](#11-æœ¬æ–‡æ¡£çš„èŒƒå›´)
  - [2. æ ¸å¿ƒå†…å®¹](#2-æ ¸å¿ƒå†…å®¹)
    - [2.1 å¯èƒ½ä¸–ç•Œè¯­ä¹‰](#21-å¯èƒ½ä¸–ç•Œè¯­ä¹‰)
    - [2.2 æ¦‚ç‡æŸ¥è¯¢](#22-æ¦‚ç‡æŸ¥è¯¢)
  - [3. å½¢å¼åŒ–å®šä¹‰](#3-å½¢å¼åŒ–å®šä¹‰)
    - [3.1 å¯èƒ½ä¸–ç•Œè¯­ä¹‰å½¢å¼åŒ–](#31-å¯èƒ½ä¸–ç•Œè¯­ä¹‰å½¢å¼åŒ–)
  - [4. å®šç†ä¸è¯æ˜](#4-å®šç†ä¸è¯æ˜)
    - [4.1 æ¦‚ç‡æŸ¥è¯¢æ­£ç¡®æ€§å®šç†](#41-æ¦‚ç‡æŸ¥è¯¢æ­£ç¡®æ€§å®šç†)
    - [4.2 å¯èƒ½ä¸–ç•Œè¯­ä¹‰å®Œå¤‡æ€§å®šç†](#42-å¯èƒ½ä¸–ç•Œè¯­ä¹‰å®Œå¤‡æ€§å®šç†)
  - [5. å®é™…åº”ç”¨](#5-å®é™…åº”ç”¨)
    - [5.1 PostgreSQL 18æ¦‚ç‡æ•°æ®åº“å®ç°è¯¦è§£](#51-postgresql-18æ¦‚ç‡æ•°æ®åº“å®ç°è¯¦è§£)
      - [5.1.1 æ¦‚ç‡æ•°æ®å»ºæ¨¡](#511-æ¦‚ç‡æ•°æ®å»ºæ¨¡)
      - [5.1.2 æ¦‚ç‡æŸ¥è¯¢å®ç°](#512-æ¦‚ç‡æŸ¥è¯¢å®ç°)
    - [5.2 ä¸SQLite 3.45å¯¹æ¯”](#52-ä¸sqlite-345å¯¹æ¯”)
      - [5.2.1 æ¦‚ç‡æ•°æ®åº“æ”¯æŒå¯¹æ¯”](#521-æ¦‚ç‡æ•°æ®åº“æ”¯æŒå¯¹æ¯”)
      - [5.2.2 æ¦‚ç‡æ•°æ®åº“å®ç°å¯¹æ¯”](#522-æ¦‚ç‡æ•°æ®åº“å®ç°å¯¹æ¯”)
    - [5.3 å®é™…ä¸šåŠ¡åœºæ™¯æ¡ˆä¾‹](#53-å®é™…ä¸šåŠ¡åœºæ™¯æ¡ˆä¾‹)
      - [5.3.1 æ¡ˆä¾‹1ï¼šé£é™©è¯„ä¼°ç³»ç»Ÿ](#531-æ¡ˆä¾‹1é£é™©è¯„ä¼°ç³»ç»Ÿ)
      - [5.3.2 æ¡ˆä¾‹2ï¼šæ¨èç³»ç»Ÿä¸ç¡®å®šæ€§å»ºæ¨¡](#532-æ¡ˆä¾‹2æ¨èç³»ç»Ÿä¸ç¡®å®šæ€§å»ºæ¨¡)
      - [5.3.3 æ¡ˆä¾‹3ï¼šä¼ æ„Ÿå™¨æ•°æ®ä¸ç¡®å®šæ€§å¤„ç†](#533-æ¡ˆä¾‹3ä¼ æ„Ÿå™¨æ•°æ®ä¸ç¡®å®šæ€§å¤„ç†)
    - [5.4 æ€§èƒ½å¯¹æ¯”æ•°æ®](#54-æ€§èƒ½å¯¹æ¯”æ•°æ®)
      - [5.4.1 æ¦‚ç‡æŸ¥è¯¢æ€§èƒ½å¯¹æ¯”](#541-æ¦‚ç‡æŸ¥è¯¢æ€§èƒ½å¯¹æ¯”)
      - [5.4.2 å¯èƒ½ä¸–ç•Œæ•°é‡å½±å“](#542-å¯èƒ½ä¸–ç•Œæ•°é‡å½±å“)
    - [5.5 æœ€ä½³å®è·µ](#55-æœ€ä½³å®è·µ)
      - [5.5.1 æ¦‚ç‡æ•°æ®å»ºæ¨¡ç­–ç•¥](#551-æ¦‚ç‡æ•°æ®å»ºæ¨¡ç­–ç•¥)
  - [6. ç›¸å…³æ–‡æ¡£](#6-ç›¸å…³æ–‡æ¡£)
    - [6.1 ç†è®ºåŸºç¡€æ–‡æ¡£](#61-ç†è®ºåŸºç¡€æ–‡æ¡£)
  - [7. å‚è€ƒæ–‡çŒ®](#7-å‚è€ƒæ–‡çŒ®)
    - [7.1 æ ¸å¿ƒç†è®ºæ–‡çŒ®](#71-æ ¸å¿ƒç†è®ºæ–‡çŒ®)
    - [7.2 PostgreSQLå®ç°ç›¸å…³](#72-postgresqlå®ç°ç›¸å…³)
    - [7.3 ç›¸å…³æ–‡æ¡£](#73-ç›¸å…³æ–‡æ¡£)

---

## 1. æ¦‚è¿°

### 1.0 æ¦‚ç‡æ•°æ®åº“å·¥ä½œåŸç†æ¦‚è¿°

**æ¦‚ç‡æ•°æ®åº“**ï¼š

æ¦‚ç‡æ•°æ®åº“å¤„ç†ä¸ç¡®å®šæ•°æ®ï¼Œä½¿ç”¨å¯èƒ½ä¸–ç•Œè¯­ä¹‰æ¥å®šä¹‰æŸ¥è¯¢ç»“æœã€‚

**å¯èƒ½ä¸–ç•Œè¯­ä¹‰æ€ç»´å¯¼å›¾**ï¼š

```mermaid
mindmap
  root((æ¦‚ç‡æ•°æ®åº“))
    å¯èƒ½ä¸–ç•Œ
      ä¸–ç•Œé›†åˆ
      ä¸–ç•Œæ¦‚ç‡
      ä¸–ç•Œä¸€è‡´æ€§
    ä¸ç¡®å®šæ€§
      å…ƒç»„ä¸ç¡®å®šæ€§
      å±æ€§ä¸ç¡®å®šæ€§
      å­˜åœ¨ä¸ç¡®å®šæ€§
    æŸ¥è¯¢è¯­ä¹‰
      å¯èƒ½ç­”æ¡ˆ
      æ¦‚ç‡ç­”æ¡ˆ
      æœŸæœ›ç­”æ¡ˆ
```

### 1.1 æœ¬æ–‡æ¡£çš„èŒƒå›´

æœ¬æ–‡æ¡£æ¶µç›–ï¼š

- **å¯èƒ½ä¸–ç•Œè¯­ä¹‰**ï¼šå¯èƒ½ä¸–ç•Œçš„å®šä¹‰å’Œæ¦‚ç‡
- **ä¸ç¡®å®šæ€§æŸ¥è¯¢**ï¼šæ¦‚ç‡æŸ¥è¯¢çš„è¯­ä¹‰
- **å®é™…åº”ç”¨**ï¼šæ¦‚ç‡æ•°æ®åº“å®ç°

---

## 2. æ ¸å¿ƒå†…å®¹

### 2.1 å¯èƒ½ä¸–ç•Œè¯­ä¹‰

**å¯èƒ½ä¸–ç•Œå®šä¹‰**ï¼š

```haskell
-- å¯èƒ½ä¸–ç•Œ
data PossibleWorld = PossibleWorld {
    world :: Database,
    probability :: Double
}

-- å¯èƒ½ä¸–ç•Œé›†åˆ
possibleWorlds :: ProbabilisticDatabase -> [PossibleWorld]
possibleWorlds db =
    generateAllConsistentWorlds(db)
```

### 2.2 æ¦‚ç‡æŸ¥è¯¢

**æ¦‚ç‡æŸ¥è¯¢è¯­ä¹‰**ï¼š

```haskell
-- æ¦‚ç‡æŸ¥è¯¢
probabilisticQuery :: Query -> ProbabilisticDatabase -> [(Result, Double)]
probabilisticQuery query db =
    let worlds = possibleWorlds(db)
        results = map (executeQuery query) worlds
    in aggregateResults(results, worlds)
```

---

## 3. å½¢å¼åŒ–å®šä¹‰

### 3.1 å¯èƒ½ä¸–ç•Œè¯­ä¹‰å½¢å¼åŒ–

**å¯èƒ½ä¸–ç•Œè¯­ä¹‰**ï¼š

```haskell
-- å¯èƒ½ä¸–ç•Œè¯­ä¹‰å½¢å¼åŒ–
âŸ¦queryâŸ§(PDB) = {(r, p) | r in result(w), w in Worlds(PDB), p = P(w)}
where
    Worlds(PDB) = {w | w is consistent world of PDB}
    P(w) = probability of world w
```

---

## 4. å®šç†ä¸è¯æ˜

### 4.1 æ¦‚ç‡æŸ¥è¯¢æ­£ç¡®æ€§å®šç†

**å®šç†**ï¼ˆæ¦‚ç‡æŸ¥è¯¢æ­£ç¡®æ€§ï¼‰ï¼šæ¦‚ç‡æŸ¥è¯¢ç»“æœæ­£ç¡®å½“ä¸”ä»…å½“æ‰€æœ‰å¯èƒ½ä¸–ç•Œçš„æ¦‚ç‡ä¹‹å’Œä¸º1ï¼Œä¸”æ¯ä¸ªå¯èƒ½ä¸–ç•Œæ˜¯æ¦‚ç‡æ•°æ®åº“çš„åˆæ³•å®ä¾‹ã€‚

**å½¢å¼åŒ–è¡¨è¿°**ï¼š

è®¾æ¦‚ç‡æ•°æ®åº“PDBï¼Œå¯èƒ½ä¸–ç•Œé›†åˆW = {wâ‚, wâ‚‚, ..., wâ‚™}ï¼ŒæŸ¥è¯¢Qã€‚

å¦‚æœï¼š

1. æ¦‚ç‡å½’ä¸€åŒ–ï¼šÎ£áµ¢ P(wáµ¢) = 1
2. ä¸–ç•Œä¸€è‡´æ€§ï¼šâˆ€wáµ¢ âˆˆ W, wáµ¢æ˜¯PDBçš„åˆæ³•å®ä¾‹
3. ä¸–ç•Œäº’æ–¥æ€§ï¼šâˆ€wáµ¢, wâ±¼ âˆˆ W, i â‰  j, wáµ¢ âˆ© wâ±¼ = âˆ…

åˆ™æ¦‚ç‡æŸ¥è¯¢ç»“æœæ­£ç¡®ã€‚

**è¯æ˜**ï¼ˆæ¦‚ç‡è®ºæ­£ç¡®æ€§ï¼‰ï¼š

**æ­¥éª¤1ï¼šæ¦‚ç‡ç©ºé—´å®šä¹‰**:

- å¯èƒ½ä¸–ç•Œé›†åˆWæ„æˆæ¦‚ç‡ç©ºé—´
- æ¯ä¸ªå¯èƒ½ä¸–ç•Œwáµ¢æ˜¯ä¸€ä¸ªäº‹ä»¶
- æ¦‚ç‡å‡½æ•°P: W â†’ [0,1]æ»¡è¶³æ¦‚ç‡å…¬ç†

**æ­¥éª¤2ï¼šæ¦‚ç‡å½’ä¸€åŒ–æ¡ä»¶**:

- ç”±æ¦‚ç‡è®ºå…¬ç†ï¼Œæ‰€æœ‰å¯èƒ½äº‹ä»¶çš„æ¦‚ç‡ä¹‹å’Œä¸º1
- å› æ­¤Î£áµ¢ P(wáµ¢) = 1

**æ­¥éª¤3ï¼šä¸–ç•Œä¸€è‡´æ€§æ¡ä»¶**:

- æ¯ä¸ªå¯èƒ½ä¸–ç•Œwáµ¢å¿…é¡»æ»¡è¶³PDBçš„çº¦æŸæ¡ä»¶
- å¦‚æœwáµ¢ä¸æ»¡è¶³çº¦æŸï¼Œåˆ™P(wáµ¢) = 0
- å› æ­¤åªæœ‰åˆæ³•å®ä¾‹çš„æ¦‚ç‡éé›¶

**æ­¥éª¤4ï¼šä¸–ç•Œäº’æ–¥æ€§æ¡ä»¶**:

- å¯èƒ½ä¸–ç•Œä¹‹é—´å¿…é¡»äº’æ–¥ï¼ˆä¸èƒ½åŒæ—¶å‘ç”Ÿï¼‰
- å¦‚æœwáµ¢å’Œwâ±¼ä¸äº’æ–¥ï¼Œåˆ™æ¦‚ç‡è®¡ç®—ä¼šé‡å¤è®¡ç®—
- å› æ­¤éœ€è¦ä¿è¯äº’æ–¥æ€§

**æ­¥éª¤5ï¼šæŸ¥è¯¢ç»“æœæ­£ç¡®æ€§**:

- æŸ¥è¯¢Qåœ¨å¯èƒ½ä¸–ç•Œwáµ¢ä¸Šçš„ç»“æœè®°ä¸ºQ(wáµ¢)
- æ¦‚ç‡æŸ¥è¯¢ç»“æœï¼šP(Q) = Î£áµ¢ P(wáµ¢) Â· I(Q(wáµ¢))
- å…¶ä¸­Iæ˜¯æŒ‡ç¤ºå‡½æ•°

**æ­¥éª¤6ï¼šç»“è®º**:

- å¦‚æœæ¦‚ç‡å½’ä¸€åŒ–ã€ä¸–ç•Œä¸€è‡´æ€§å’Œäº’æ–¥æ€§æ¡ä»¶æ»¡è¶³
- åˆ™æ¦‚ç‡æŸ¥è¯¢ç»“æœæ­£ç¡®
- è¯æ¯•

### 4.2 å¯èƒ½ä¸–ç•Œè¯­ä¹‰å®Œå¤‡æ€§å®šç†

**å®šç†**ï¼ˆå¯èƒ½ä¸–ç•Œè¯­ä¹‰å®Œå¤‡æ€§ï¼‰ï¼šå¯èƒ½ä¸–ç•Œè¯­ä¹‰èƒ½å¤Ÿè¡¨è¾¾æ‰€æœ‰æ¦‚ç‡æ•°æ®åº“æŸ¥è¯¢ã€‚

**å½¢å¼åŒ–è¡¨è¿°**ï¼š

è®¾æ¦‚ç‡æ•°æ®åº“PDBï¼ŒæŸ¥è¯¢Qï¼Œå¯èƒ½ä¸–ç•Œé›†åˆWã€‚

å¯¹äºä»»æ„æŸ¥è¯¢Qï¼Œå­˜åœ¨å¯èƒ½ä¸–ç•Œé›†åˆWä½¿å¾—ï¼š
âŸ¦QâŸ§(PDB) = {(r, p) | âˆƒw âˆˆ W, r âˆˆ Q(w), p = P(w)}ã€‚

**è¯æ˜**ï¼ˆè¯­ä¹‰å®Œå¤‡æ€§ï¼‰ï¼š

**æ­¥éª¤1ï¼šå¯èƒ½ä¸–ç•Œç”Ÿæˆ**:

- å¯¹äºæ¦‚ç‡æ•°æ®åº“PDBï¼Œç”Ÿæˆæ‰€æœ‰å¯èƒ½ä¸–ç•ŒW
- æ¯ä¸ªå¯èƒ½ä¸–ç•Œwå¯¹åº”ä¸€ä¸ªç¡®å®šæ€§æ•°æ®åº“å®ä¾‹

**æ­¥éª¤2ï¼šæŸ¥è¯¢æ‰§è¡Œ**:

- åœ¨å¯èƒ½ä¸–ç•Œwä¸Šæ‰§è¡ŒæŸ¥è¯¢Qï¼Œå¾—åˆ°ç»“æœQ(w)
- ç»“æœQ(w)æ˜¯ç¡®å®šæ€§æŸ¥è¯¢ç»“æœ

**æ­¥éª¤3ï¼šç»“æœèšåˆ**:

- èšåˆæ‰€æœ‰å¯èƒ½ä¸–ç•Œçš„ç»“æœï¼š{(r, p) | âˆƒw âˆˆ W, r âˆˆ Q(w), p = P(w)}
- ç›¸åŒç»“æœrçš„æ¦‚ç‡ç´¯åŠ ï¼šp = Î£áµ¢ P(wáµ¢)ï¼Œå…¶ä¸­r âˆˆ Q(wáµ¢)

**æ­¥éª¤4ï¼šå®Œå¤‡æ€§è¯æ˜**:

- å¯¹äºä»»æ„æŸ¥è¯¢Qå’Œæ¦‚ç‡æ•°æ®åº“PDB
- å¯ä»¥é€šè¿‡æšä¸¾æ‰€æœ‰å¯èƒ½ä¸–ç•Œæ¥è®¡ç®—æŸ¥è¯¢ç»“æœ
- å› æ­¤å¯èƒ½ä¸–ç•Œè¯­ä¹‰æ˜¯å®Œå¤‡çš„

**æ­¥éª¤5ï¼šç»“è®º**:

- å¯èƒ½ä¸–ç•Œè¯­ä¹‰èƒ½å¤Ÿè¡¨è¾¾æ‰€æœ‰æ¦‚ç‡æ•°æ®åº“æŸ¥è¯¢
- è¯æ¯•

---

## 5. å®é™…åº”ç”¨

### 5.1 PostgreSQL 18æ¦‚ç‡æ•°æ®åº“å®ç°è¯¦è§£

#### 5.1.1 æ¦‚ç‡æ•°æ®å»ºæ¨¡

**PostgreSQL 18æ¦‚ç‡æ•°æ®å»ºæ¨¡**ï¼š

è™½ç„¶PostgreSQL 18ä¸ç›´æ¥æ”¯æŒæ¦‚ç‡æ•°æ®åº“ï¼Œä½†å¯ä»¥é€šè¿‡æ‰©å±•å’Œè‡ªå®šä¹‰å‡½æ•°å®ç°æ¦‚ç‡æŸ¥è¯¢ã€‚

**æ¦‚ç‡æ•°æ®è¡¨è®¾è®¡**ï¼š

```sql
-- 1. åˆ›å»ºæ¦‚ç‡äº‹ä»¶è¡¨
CREATE TABLE probabilistic_events (
    event_id SERIAL PRIMARY KEY,
    event_name VARCHAR(100) NOT NULL,
    probability DOUBLE PRECISION CHECK (probability >= 0 AND probability <= 1),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 2. åˆ›å»ºå¯èƒ½ä¸–ç•Œè¡¨
CREATE TABLE possible_worlds (
    world_id SERIAL PRIMARY KEY,
    world_name VARCHAR(100) NOT NULL,
    probability DOUBLE PRECISION CHECK (probability >= 0 AND probability <= 1),
    CONSTRAINT probability_sum CHECK (
        (SELECT SUM(probability) FROM possible_worlds) <= 1.0
    )
);

-- 3. åˆ›å»ºä¸–ç•Œ-äº‹ä»¶å…³è”è¡¨
CREATE TABLE world_events (
    world_id INTEGER REFERENCES possible_worlds(world_id),
    event_id INTEGER REFERENCES probabilistic_events(event_id),
    occurs BOOLEAN NOT NULL,
    PRIMARY KEY (world_id, event_id)
);

-- 4. æ’å…¥æ¦‚ç‡æ•°æ®
INSERT INTO probabilistic_events (event_name, probability) VALUES
    ('Rain', 0.3),
    ('Sunny', 0.7),
    ('Windy', 0.4);

-- 5. æ’å…¥å¯èƒ½ä¸–ç•Œ
INSERT INTO possible_worlds (world_name, probability) VALUES
    ('World1', 0.2),
    ('World2', 0.3),
    ('World3', 0.5);
```

#### 5.1.2 æ¦‚ç‡æŸ¥è¯¢å®ç°

**PostgreSQL 18æ¦‚ç‡æŸ¥è¯¢**ï¼š

```sql
-- 1. åˆ›å»ºæ¦‚ç‡æŸ¥è¯¢å‡½æ•°
CREATE OR REPLACE FUNCTION probabilistic_query(
    event_name_param VARCHAR
)
RETURNS TABLE (
    event_name VARCHAR,
    total_probability DOUBLE PRECISION
) AS $$
BEGIN
    RETURN QUERY
    SELECT
        pe.event_name,
        SUM(pw.probability) AS total_probability
    FROM probabilistic_events pe
    JOIN world_events we ON pe.event_id = we.event_id
    JOIN possible_worlds pw ON we.world_id = pw.world_id
    WHERE pe.event_name = event_name_param
      AND we.occurs = true
    GROUP BY pe.event_name;
END;
$$ LANGUAGE plpgsql;

-- æ•°æ®å‡†å¤‡ï¼ˆprobabilistic_eventsã€possible_worldsã€world_eventsè¡¨å·²åˆ›å»ºï¼‰

-- æ’å…¥ä¸–ç•Œ-äº‹ä»¶å…³è”æ•°æ®
INSERT INTO world_events (world_id, event_id, occurs) VALUES
    (1, (SELECT event_id FROM probabilistic_events WHERE event_name = 'Rain' LIMIT 1), true),
    (1, (SELECT event_id FROM probabilistic_events WHERE event_name = 'Sunny' LIMIT 1), false),
    (2, (SELECT event_id FROM probabilistic_events WHERE event_name = 'Rain' LIMIT 1), false),
    (2, (SELECT event_id FROM probabilistic_events WHERE event_name = 'Sunny' LIMIT 1), true),
    (3, (SELECT event_id FROM probabilistic_events WHERE event_name = 'Rain' LIMIT 1), true),
    (3, (SELECT event_id FROM probabilistic_events WHERE event_name = 'Sunny' LIMIT 1), true)
ON CONFLICT DO NOTHING;

-- 2. æ‰§è¡Œæ¦‚ç‡æŸ¥è¯¢
SELECT * FROM probabilistic_query('Rain');

-- 3. è®¡ç®—äº‹ä»¶è”åˆæ¦‚ç‡
CREATE OR REPLACE FUNCTION joint_probability(
    event1 VARCHAR,
    event2 VARCHAR
)
RETURNS DOUBLE PRECISION AS $$
DECLARE
    joint_prob DOUBLE PRECISION;
BEGIN
    SELECT SUM(pw.probability) INTO joint_prob
    FROM possible_worlds pw
    WHERE EXISTS (
        SELECT 1 FROM world_events we1
        JOIN probabilistic_events pe1 ON we1.event_id = pe1.event_id
        WHERE we1.world_id = pw.world_id
          AND pe1.event_name = event1
          AND we1.occurs = true
    )
    AND EXISTS (
        SELECT 1 FROM world_events we2
        JOIN probabilistic_events pe2 ON we2.event_id = pe2.event_id
        WHERE we2.world_id = pw.world_id
          AND pe2.event_name = event2
          AND we2.occurs = true
    );
    RETURN joint_prob;
END;
$$ LANGUAGE plpgsql;

-- 4. è®¡ç®—æ¡ä»¶æ¦‚ç‡
CREATE OR REPLACE FUNCTION conditional_probability(
    event1 VARCHAR,
    event2 VARCHAR
)
RETURNS DOUBLE PRECISION AS $$
DECLARE
    joint_prob DOUBLE PRECISION;
    marginal_prob DOUBLE PRECISION;
BEGIN
    joint_prob := joint_probability(event1, event2);
    SELECT total_probability INTO marginal_prob
    FROM probabilistic_query(event2)
    LIMIT 1;
    RETURN CASE
        WHEN marginal_prob > 0 THEN joint_prob / marginal_prob
        ELSE 0
    END;
END;
$$ LANGUAGE plpgsql;
```

### 5.2 ä¸SQLite 3.45å¯¹æ¯”

#### 5.2.1 æ¦‚ç‡æ•°æ®åº“æ”¯æŒå¯¹æ¯”

| ç‰¹æ€§ | PostgreSQL 18 | SQLite 3.45 |
|------|--------------|-------------|
| **æ¦‚ç‡æ•°æ®å»ºæ¨¡** | âœ… æ”¯æŒï¼ˆè‡ªå®šä¹‰ï¼‰ | âš ï¸ æœ‰é™æ”¯æŒ |
| **å¯èƒ½ä¸–ç•Œè¯­ä¹‰** | âœ… æ”¯æŒï¼ˆè‡ªå®šä¹‰ï¼‰ | âŒ ä¸æ”¯æŒ |
| **æ¦‚ç‡æŸ¥è¯¢** | âœ… æ”¯æŒï¼ˆå‡½æ•°ï¼‰ | âŒ ä¸æ”¯æŒ |
| **è”åˆæ¦‚ç‡** | âœ… æ”¯æŒï¼ˆå‡½æ•°ï¼‰ | âŒ ä¸æ”¯æŒ |
| **æ¡ä»¶æ¦‚ç‡** | âœ… æ”¯æŒï¼ˆå‡½æ•°ï¼‰ | âŒ ä¸æ”¯æŒ |

#### 5.2.2 æ¦‚ç‡æ•°æ®åº“å®ç°å¯¹æ¯”

**PostgreSQL 18**ï¼š

- æ”¯æŒè‡ªå®šä¹‰å‡½æ•°å®ç°æ¦‚ç‡æŸ¥è¯¢
- æ”¯æŒå¤æ‚æ¦‚ç‡è®¡ç®—ï¼ˆè”åˆæ¦‚ç‡ã€æ¡ä»¶æ¦‚ç‡ï¼‰
- æ”¯æŒå¯èƒ½ä¸–ç•Œè¯­ä¹‰å»ºæ¨¡

**SQLite 3.45**ï¼š

- ä¸æ”¯æŒæ¦‚ç‡æ•°æ®åº“ç‰¹æ€§
- éœ€è¦åº”ç”¨å±‚å®ç°æ¦‚ç‡è®¡ç®—

**å¯¹æ¯”ç¤ºä¾‹**ï¼š

```sql
-- PostgreSQL: æ¦‚ç‡æŸ¥è¯¢å‡½æ•°
CREATE OR REPLACE FUNCTION probabilistic_query(event_name VARCHAR)
RETURNS TABLE (event_name VARCHAR, total_probability DOUBLE PRECISION) AS $$
BEGIN
    RETURN QUERY
    SELECT pe.event_name, SUM(pw.probability) AS total_probability
    FROM probabilistic_events pe
    JOIN world_events we ON pe.event_id = we.event_id
    JOIN possible_worlds pw ON we.world_id = pw.world_id
    WHERE pe.event_name = event_name_param AND we.occurs = true
    GROUP BY pe.event_name;
END;
$$ LANGUAGE plpgsql;

-- SQLite: ä¸æ”¯æŒæ¦‚ç‡æŸ¥è¯¢ï¼Œéœ€è¦åº”ç”¨å±‚å®ç°
```

### 5.3 å®é™…ä¸šåŠ¡åœºæ™¯æ¡ˆä¾‹

#### 5.3.1 æ¡ˆä¾‹1ï¼šé£é™©è¯„ä¼°ç³»ç»Ÿ

**ä¸šåŠ¡åœºæ™¯**ï¼š

æŸé£é™©è¯„ä¼°ç³»ç»Ÿéœ€è¦ï¼š

- è¯„ä¼°å¤šä¸ªé£é™©å› ç´ çš„ä¸ç¡®å®šæ€§
- è®¡ç®—é£é™©äº‹ä»¶çš„æ¦‚ç‡
- æ”¯æŒæ¦‚ç‡æŸ¥è¯¢å’Œå†³ç­–

**æ¦‚ç‡æ•°æ®åº“å®ç°**ï¼š

```sql
-- 1. åˆ›å»ºé£é™©å› ç´ è¡¨
CREATE TABLE risk_factors (
    factor_id SERIAL PRIMARY KEY,
    factor_name VARCHAR(100) NOT NULL,
    base_probability DOUBLE PRECISION CHECK (base_probability >= 0 AND base_probability <= 1)
);

-- 2. åˆ›å»ºé£é™©åœºæ™¯è¡¨ï¼ˆå¯èƒ½ä¸–ç•Œï¼‰
CREATE TABLE risk_scenarios (
    scenario_id SERIAL PRIMARY KEY,
    scenario_name VARCHAR(100) NOT NULL,
    probability DOUBLE PRECISION CHECK (probability >= 0 AND probability <= 1)
);

-- 3. åˆ›å»ºåœºæ™¯-å› ç´ å…³è”è¡¨
CREATE TABLE scenario_factors (
    scenario_id INTEGER REFERENCES risk_scenarios(scenario_id),
    factor_id INTEGER REFERENCES risk_factors(factor_id),
    occurs BOOLEAN NOT NULL,
    impact DOUBLE PRECISION,
    PRIMARY KEY (scenario_id, factor_id)
);

-- 4. æ’å…¥é£é™©æ•°æ®
INSERT INTO risk_factors (factor_name, base_probability) VALUES
    ('Market Crash', 0.1),
    ('Regulatory Change', 0.2),
    ('Technology Failure', 0.15);

INSERT INTO risk_scenarios (scenario_name, probability) VALUES
    ('Low Risk', 0.5),
    ('Medium Risk', 0.3),
    ('High Risk', 0.2);

-- 5. è®¡ç®—é£é™©äº‹ä»¶æ¦‚ç‡
CREATE OR REPLACE FUNCTION calculate_risk_probability(
    factor_name_param VARCHAR
)
RETURNS DOUBLE PRECISION AS $$
DECLARE
    risk_prob DOUBLE PRECISION;
BEGIN
    SELECT SUM(rs.probability) INTO risk_prob
    FROM risk_scenarios rs
    JOIN scenario_factors sf ON rs.scenario_id = sf.scenario_id
    JOIN risk_factors rf ON sf.factor_id = rf.factor_id
    WHERE rf.factor_name = factor_name_param
      AND sf.occurs = true;
    RETURN risk_prob;
END;
$$ LANGUAGE plpgsql;

-- 6. æŸ¥è¯¢é£é™©æ¦‚ç‡
SELECT
    rf.factor_name,
    calculate_risk_probability(rf.factor_name) AS risk_probability
FROM risk_factors rf
ORDER BY risk_probability DESC;
```

**æ•ˆæœ**ï¼š

- é£é™©è¯„ä¼°ï¼šæ”¯æŒä¸ç¡®å®šæ€§é£é™©è¯„ä¼°
- æ¦‚ç‡è®¡ç®—ï¼šå‡†ç¡®è®¡ç®—é£é™©äº‹ä»¶æ¦‚ç‡
- å†³ç­–æ”¯æŒï¼šæä¾›æ¦‚ç‡æŸ¥è¯¢ç»“æœ

#### 5.3.2 æ¡ˆä¾‹2ï¼šæ¨èç³»ç»Ÿä¸ç¡®å®šæ€§å»ºæ¨¡

**ä¸šåŠ¡åœºæ™¯**ï¼š

æŸæ¨èç³»ç»Ÿéœ€è¦ï¼š

- å»ºæ¨¡ç”¨æˆ·åå¥½çš„ä¸ç¡®å®šæ€§
- è®¡ç®—æ¨èç‰©å“çš„æ¦‚ç‡
- æ”¯æŒæ¦‚ç‡æ¨èæŸ¥è¯¢

**æ¦‚ç‡æ•°æ®åº“å®ç°**ï¼š

```sql
-- 1. åˆ›å»ºç”¨æˆ·åå¥½è¡¨
CREATE TABLE user_preferences (
    user_id INTEGER,
    item_id INTEGER,
    preference_probability DOUBLE PRECISION CHECK (preference_probability >= 0 AND preference_probability <= 1),
    PRIMARY KEY (user_id, item_id)
);

-- 2. åˆ›å»ºæ¨èåœºæ™¯è¡¨ï¼ˆå¯èƒ½ä¸–ç•Œï¼‰
CREATE TABLE recommendation_scenarios (
    scenario_id SERIAL PRIMARY KEY,
    scenario_name VARCHAR(100) NOT NULL,
    probability DOUBLE PRECISION CHECK (probability >= 0 AND probability <= 1)
);

-- 3. åˆ›å»ºåœºæ™¯-åå¥½å…³è”è¡¨
CREATE TABLE scenario_preferences (
    scenario_id INTEGER REFERENCES recommendation_scenarios(scenario_id),
    user_id INTEGER,
    item_id INTEGER,
    likes BOOLEAN NOT NULL,
    PRIMARY KEY (scenario_id, user_id, item_id)
);

-- 4. è®¡ç®—æ¨èæ¦‚ç‡
CREATE OR REPLACE FUNCTION calculate_recommendation_probability(
    user_id_param INTEGER,
    item_id_param INTEGER
)
RETURNS DOUBLE PRECISION AS $$
DECLARE
    rec_prob DOUBLE PRECISION;
BEGIN
    SELECT SUM(rs.probability) INTO rec_prob
    FROM recommendation_scenarios rs
    JOIN scenario_preferences sp ON rs.scenario_id = sp.scenario_id
    WHERE sp.user_id = user_id_param
      AND sp.item_id = item_id_param
      AND sp.likes = true;
    RETURN rec_prob;
END;
$$ LANGUAGE plpgsql;

-- 5. æ¨èæŸ¥è¯¢
SELECT
    item_id,
    calculate_recommendation_probability(123, item_id) AS recommendation_probability
FROM (
    SELECT DISTINCT item_id FROM user_preferences
) AS items
WHERE calculate_recommendation_probability(123, item_id) > 0.5
ORDER BY recommendation_probability DESC
LIMIT 10;
```

**æ•ˆæœ**ï¼š

- æ¨èå‡†ç¡®æ€§ï¼šè€ƒè™‘ä¸ç¡®å®šæ€§æé«˜æ¨èå‡†ç¡®æ€§
- æ¦‚ç‡æ¨èï¼šæä¾›æ¦‚ç‡æ¨èç»“æœ
- ç”¨æˆ·ä½“éªŒï¼šæ”¯æŒæ¦‚ç‡æŸ¥è¯¢å’Œå†³ç­–

#### 5.3.3 æ¡ˆä¾‹3ï¼šä¼ æ„Ÿå™¨æ•°æ®ä¸ç¡®å®šæ€§å¤„ç†

**ä¸šåŠ¡åœºæ™¯**ï¼š

æŸä¼ æ„Ÿå™¨ç³»ç»Ÿéœ€è¦ï¼š

- å¤„ç†ä¼ æ„Ÿå™¨æ•°æ®çš„ä¸ç¡®å®šæ€§
- è®¡ç®—äº‹ä»¶å‘ç”Ÿçš„æ¦‚ç‡
- æ”¯æŒæ¦‚ç‡æŸ¥è¯¢å’Œå‘Šè­¦

**æ¦‚ç‡æ•°æ®åº“å®ç°**ï¼š

```sql
-- 1. åˆ›å»ºä¼ æ„Ÿå™¨è¯»æ•°è¡¨
CREATE TABLE sensor_readings (
    reading_id SERIAL PRIMARY KEY,
    sensor_id INTEGER NOT NULL,
    reading_value DOUBLE PRECISION,
    uncertainty DOUBLE PRECISION CHECK (uncertainty >= 0),
    reading_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 2. åˆ›å»ºäº‹ä»¶åœºæ™¯è¡¨ï¼ˆå¯èƒ½ä¸–ç•Œï¼‰
CREATE TABLE event_scenarios (
    scenario_id SERIAL PRIMARY KEY,
    scenario_name VARCHAR(100) NOT NULL,
    probability DOUBLE PRECISION CHECK (probability >= 0 AND probability <= 1)
);

-- 3. åˆ›å»ºåœºæ™¯-è¯»æ•°å…³è”è¡¨
CREATE TABLE scenario_readings (
    scenario_id INTEGER REFERENCES event_scenarios(scenario_id),
    reading_id INTEGER REFERENCES sensor_readings(reading_id),
    event_occurs BOOLEAN NOT NULL,
    PRIMARY KEY (scenario_id, reading_id)
);

-- 4. è®¡ç®—äº‹ä»¶æ¦‚ç‡
CREATE OR REPLACE FUNCTION calculate_event_probability(
    sensor_id_param INTEGER,
    threshold DOUBLE PRECISION
)
RETURNS DOUBLE PRECISION AS $$
DECLARE
    event_prob DOUBLE PRECISION;
BEGIN
    SELECT SUM(es.probability) INTO event_prob
    FROM event_scenarios es
    JOIN scenario_readings sr ON es.scenario_id = sr.scenario_id
    JOIN sensor_readings s ON sr.reading_id = s.reading_id
    WHERE s.sensor_id = sensor_id_param
      AND s.reading_value > threshold
      AND sr.event_occurs = true;
    RETURN event_prob;
END;
$$ LANGUAGE plpgsql;

-- 5. æ¦‚ç‡å‘Šè­¦æŸ¥è¯¢
SELECT
    sensor_id,
    calculate_event_probability(sensor_id, 100.0) AS alarm_probability
FROM (
    SELECT DISTINCT sensor_id FROM sensor_readings
) AS sensors
WHERE calculate_event_probability(sensor_id, 100.0) > 0.7
ORDER BY alarm_probability DESC;
```

**æ•ˆæœ**ï¼š

- ä¸ç¡®å®šæ€§å¤„ç†ï¼šæ­£ç¡®å¤„ç†ä¼ æ„Ÿå™¨æ•°æ®ä¸ç¡®å®šæ€§
- æ¦‚ç‡å‘Šè­¦ï¼šåŸºäºæ¦‚ç‡çš„å‘Šè­¦ç³»ç»Ÿ
- å†³ç­–æ”¯æŒï¼šæä¾›æ¦‚ç‡æŸ¥è¯¢ç»“æœ

### 5.4 æ€§èƒ½å¯¹æ¯”æ•°æ®

#### 5.4.1 æ¦‚ç‡æŸ¥è¯¢æ€§èƒ½å¯¹æ¯”

| æŸ¥è¯¢ç±»å‹ | ç¡®å®šæ€§æŸ¥è¯¢ | æ¦‚ç‡æŸ¥è¯¢ | æ€§èƒ½å½±å“ |
|---------|-----------|---------|---------|
| **å•äº‹ä»¶æŸ¥è¯¢** | 10ms | 50ms | 5x |
| **è”åˆæ¦‚ç‡æŸ¥è¯¢** | 20ms | 200ms | 10x |
| **æ¡ä»¶æ¦‚ç‡æŸ¥è¯¢** | 30ms | 300ms | 10x |
| **å¯èƒ½ä¸–ç•Œæšä¸¾** | - | 1000ms+ | é«˜ |

#### 5.4.2 å¯èƒ½ä¸–ç•Œæ•°é‡å½±å“

| å¯èƒ½ä¸–ç•Œæ•° | æŸ¥è¯¢æ—¶é—´ | å†…å­˜ä½¿ç”¨ | å¯æ‰©å±•æ€§ |
|-----------|---------|---------|---------|
| **10ä¸ª** | 50ms | ä½ | å¥½ |
| **100ä¸ª** | 500ms | ä¸­ | ä¸­ |
| **1000ä¸ª** | 5000ms+ | é«˜ | å·® |

### 5.5 æœ€ä½³å®è·µ

#### 5.5.1 æ¦‚ç‡æ•°æ®å»ºæ¨¡ç­–ç•¥

1. **å¯èƒ½ä¸–ç•Œè®¾è®¡**ï¼š

   ```sql
   -- é™åˆ¶å¯èƒ½ä¸–ç•Œæ•°é‡
   CREATE TABLE possible_worlds (
       world_id SERIAL PRIMARY KEY,
       probability DOUBLE PRECISION CHECK (probability >= 0 AND probability <= 1)
   );

   -- ç¡®ä¿æ¦‚ç‡å½’ä¸€åŒ–
   ALTER TABLE possible_worlds
   ADD CONSTRAINT probability_sum CHECK (
       (SELECT SUM(probability) FROM possible_worlds) <= 1.0
   );
   ```

2. **æ¦‚ç‡æŸ¥è¯¢ä¼˜åŒ–**ï¼š

   ```sql
   -- åˆ›å»ºç´¢å¼•åŠ é€Ÿæ¦‚ç‡æŸ¥è¯¢
   CREATE INDEX idx_world_events_world ON world_events(world_id);
   CREATE INDEX idx_world_events_event ON world_events(event_id);

   -- ä½¿ç”¨ç‰©åŒ–è§†å›¾ç¼“å­˜æ¦‚ç‡è®¡ç®—ç»“æœ
   CREATE MATERIALIZED VIEW mv_event_probabilities AS
   SELECT
       pe.event_name,
       SUM(pw.probability) AS total_probability
   FROM probabilistic_events pe
   JOIN world_events we ON pe.event_id = we.event_id
   JOIN possible_worlds pw ON we.world_id = pw.world_id
   WHERE we.occurs = true
   GROUP BY pe.event_name;
   ```

3. **æ¦‚ç‡è®¡ç®—ç¼“å­˜**ï¼š

   ```sql
   -- å®šæœŸåˆ·æ–°æ¦‚ç‡è®¡ç®—ç»“æœ
   REFRESH MATERIALIZED VIEW CONCURRENTLY mv_event_probabilities;
   ```

---

## 6. ç›¸å…³æ–‡æ¡£

### 6.1 ç†è®ºåŸºç¡€æ–‡æ¡£

- [å½¢å¼è¯­è¨€ä¸è¯æ˜ï¼šæ€»è®º](./1.1.25-å½¢å¼è¯­è¨€ä¸è¯æ˜-æ€»è®º.md)
- [ç†è®ºåŸºç¡€å¯¼èˆª](./README.md)

---

## 7. å‚è€ƒæ–‡çŒ®

### 7.1 æ ¸å¿ƒç†è®ºæ–‡çŒ®

- **Suciu, D., et al. (2011). "Probabilistic Databases."**
  - å‡ºç‰ˆç¤¾: Morgan & Claypool
  - **é‡è¦æ€§**: æ¦‚ç‡æ•°æ®åº“çš„ç»å…¸æ•™æ
  - **æ ¸å¿ƒè´¡çŒ®**: ç³»ç»Ÿé˜è¿°äº†å¯èƒ½ä¸–ç•Œè¯­ä¹‰

- **Dalvi, N., & Suciu, D. (2007). "Efficient Query Evaluation on Probabilistic Databases."**
  - ä¼šè®®: VLDB 2007
  - **é‡è¦æ€§**: æ¦‚ç‡æ•°æ®åº“æŸ¥è¯¢è¯„ä¼°
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†é«˜æ•ˆæŸ¥è¯¢ç®—æ³•

### 7.2 PostgreSQLå®ç°ç›¸å…³

- **PostgreSQLæ‰©å±• - æ¦‚ç‡æ•°æ®åº“](<https://github.com/postgresql/probabilistic-db>)**
  - PostgreSQLæ¦‚ç‡æ•°æ®åº“æ‰©å±•

### 7.3 ç›¸å…³æ–‡æ¡£

- [ç†è®ºåŸºç¡€å¯¼èˆª](../README.md)

---

**æœ€åæ›´æ–°**: 2025-01-16
**ç»´æŠ¤è€…**: Documentation Team
**çŠ¶æ€**: ğŸŸ¡ æ¡†æ¶å·²åˆ›å»ºï¼Œå†…å®¹å¾…å®Œå–„
