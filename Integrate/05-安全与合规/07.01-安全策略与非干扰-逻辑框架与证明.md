---

> **ðŸ“‹ æ–‡æ¡£æ¥æº**: `DataBaseTheory\07-å®‰å…¨ä¸Žåˆè§„\07.01-å®‰å…¨ç­–ç•¥ä¸Žéžå¹²æ‰°-é€»è¾‘æ¡†æž¶ä¸Žè¯æ˜Ž.md`
> **ðŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŽŸæ–‡ä»¶ä¿æŒä¸å˜

---

# å®‰å…¨ç­–ç•¥ä¸Žéžå¹²æ‰°-é€»è¾‘æ¡†æž¶ä¸Žè¯æ˜Ž

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **æœ€åŽæ›´æ–°**: 2025-01-16
> **ç‰ˆæœ¬è¦†ç›–**: PostgreSQL 18.x (æŽ¨è) â­ | 17.x (æŽ¨è) | 16.x (å…¼å®¹)
> **æ–‡æ¡£çŠ¶æ€**: âœ… å†…å®¹å·²æ·±åŒ–ï¼ŒåŒ…å«å®Œæ•´è¯æ˜Žã€åœºæ™¯æ¡ˆä¾‹å’ŒPostgreSQL 18/SQLiteå¯¹æ¯”

---

## ðŸ“‹ ç›®å½•

- [å®‰å…¨ç­–ç•¥ä¸Žéžå¹²æ‰°-é€»è¾‘æ¡†æž¶ä¸Žè¯æ˜Ž](#å®‰å…¨ç­–ç•¥ä¸Žéžå¹²æ‰°-é€»è¾‘æ¡†æž¶ä¸Žè¯æ˜Ž)
  - [ðŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.0 å®‰å…¨ç­–ç•¥ä¸Žéžå¹²æ‰°å·¥ä½œåŽŸç†æ¦‚è¿°](#10-å®‰å…¨ç­–ç•¥ä¸Žéžå¹²æ‰°å·¥ä½œåŽŸç†æ¦‚è¿°)
    - [1.1 æœ¬æ–‡æ¡£çš„èŒƒå›´](#11-æœ¬æ–‡æ¡£çš„èŒƒå›´)
  - [2. æ ¸å¿ƒå†…å®¹](#2-æ ¸å¿ƒå†…å®¹)
    - [2.1 éžå¹²æ‰°æ€§](#21-éžå¹²æ‰°æ€§)
    - [2.2 å®‰å…¨ç­–ç•¥](#22-å®‰å…¨ç­–ç•¥)
      - [2.2.1 è‡ªä¸»è®¿é—®æŽ§åˆ¶ï¼ˆDAC - Discretionary Access Controlï¼‰](#221-è‡ªä¸»è®¿é—®æŽ§åˆ¶dac---discretionary-access-control)
      - [2.2.2 å¼ºåˆ¶è®¿é—®æŽ§åˆ¶ï¼ˆMAC - Mandatory Access Controlï¼‰](#222-å¼ºåˆ¶è®¿é—®æŽ§åˆ¶mac---mandatory-access-control)
      - [2.2.3 åŸºäºŽè§’è‰²çš„è®¿é—®æŽ§åˆ¶ï¼ˆRBAC - Role-Based Access Controlï¼‰](#223-åŸºäºŽè§’è‰²çš„è®¿é—®æŽ§åˆ¶rbac---role-based-access-control)
  - [3. å½¢å¼åŒ–å®šä¹‰](#3-å½¢å¼åŒ–å®šä¹‰)
    - [3.1 éžå¹²æ‰°æ€§å½¢å¼åŒ–](#31-éžå¹²æ‰°æ€§å½¢å¼åŒ–)
  - [4. å®šç†ä¸Žè¯æ˜Ž](#4-å®šç†ä¸Žè¯æ˜Ž)
    - [4.1 éžå¹²æ‰°æ€§å®šç†](#41-éžå¹²æ‰°æ€§å®šç†)
    - [4.2 ä¿¡æ¯æµå®‰å…¨å®šç†](#42-ä¿¡æ¯æµå®‰å…¨å®šç†)
    - [4.3 å®‰å…¨ç­–ç•¥ç»„åˆå®šç†](#43-å®‰å…¨ç­–ç•¥ç»„åˆå®šç†)
  - [5. å®žé™…åº”ç”¨](#5-å®žé™…åº”ç”¨)
    - [5.1 PostgreSQL 18 å®‰å…¨ç­–ç•¥å®žçŽ°è¯¦è§£](#51-postgresql-18-å®‰å…¨ç­–ç•¥å®žçŽ°è¯¦è§£)
    - [5.2 SQLite 3.45 å®‰å…¨å¯¹æ¯”](#52-sqlite-345-å®‰å…¨å¯¹æ¯”)
    - [5.3 å®žé™…ä¸šåŠ¡åœºæ™¯æ¡ˆä¾‹](#53-å®žé™…ä¸šåŠ¡åœºæ™¯æ¡ˆä¾‹)
      - [åœºæ™¯1ï¼šå¤šç§Ÿæˆ·SaaSç³»ç»Ÿçš„å®‰å…¨éš”ç¦»](#åœºæ™¯1å¤šç§Ÿæˆ·saasç³»ç»Ÿçš„å®‰å…¨éš”ç¦»)
      - [åœºæ™¯2ï¼šé‡‘èžç³»ç»Ÿçš„åˆ†çº§å®‰å…¨ç­–ç•¥](#åœºæ™¯2é‡‘èžç³»ç»Ÿçš„åˆ†çº§å®‰å…¨ç­–ç•¥)
    - [5.4 å®‰å…¨ç­–ç•¥é€‰æ‹©æœ€ä½³å®žè·µ](#54-å®‰å…¨ç­–ç•¥é€‰æ‹©æœ€ä½³å®žè·µ)
    - [5.5 æ¨¡åž‹é€‰æ‹©å»ºè®®](#55-æ¨¡åž‹é€‰æ‹©å»ºè®®)
  - [6. ç›¸å…³æ–‡æ¡£](#6-ç›¸å…³æ–‡æ¡£)
    - [6.1 ç†è®ºåŸºç¡€æ–‡æ¡£](#61-ç†è®ºåŸºç¡€æ–‡æ¡£)
  - [7. å‚è€ƒæ–‡çŒ®](#7-å‚è€ƒæ–‡çŒ®)
    - [7.1 æ ¸å¿ƒç†è®ºæ–‡çŒ®](#71-æ ¸å¿ƒç†è®ºæ–‡çŒ®)
    - [7.2 PostgreSQLå®žçŽ°ç›¸å…³](#72-postgresqlå®žçŽ°ç›¸å…³)
    - [7.3 ç›¸å…³æ–‡æ¡£](#73-ç›¸å…³æ–‡æ¡£)

---

## 1. æ¦‚è¿°

### 1.0 å®‰å…¨ç­–ç•¥ä¸Žéžå¹²æ‰°å·¥ä½œåŽŸç†æ¦‚è¿°

**éžå¹²æ‰°æ€§**ï¼š

éžå¹²æ‰°æ€§ï¼ˆNon-interferenceï¼‰æ˜¯ä¿¡æ¯å®‰å…¨çš„é‡è¦æ€§è´¨ï¼Œç¡®ä¿é«˜å®‰å…¨çº§åˆ«çš„æ“ä½œä¸ä¼šå½±å“ä½Žå®‰å…¨çº§åˆ«çš„è§‚å¯Ÿã€‚

**å®‰å…¨æ¨¡åž‹æ€ç»´å¯¼å›¾**ï¼š

```mermaid
mindmap
  root((å®‰å…¨ç­–ç•¥))
    è®¿é—®æŽ§åˆ¶
      è‡ªä¸»è®¿é—®æŽ§åˆ¶
      å¼ºåˆ¶è®¿é—®æŽ§åˆ¶
      åŸºäºŽè§’è‰²çš„è®¿é—®æŽ§åˆ¶
    éžå¹²æ‰°æ€§
      ä¿¡æ¯æµå®‰å…¨
      æ— å¹²æ‰°æ€§
      åŽ»åˆ†ç±»
    å®‰å…¨çº§åˆ«
      æœºå¯†æ€§çº§åˆ«
      å®Œæ•´æ€§çº§åˆ«
```

### 1.1 æœ¬æ–‡æ¡£çš„èŒƒå›´

æœ¬æ–‡æ¡£æ˜¯ä¸€ä»½å…³äºŽå®‰å…¨ç­–ç•¥ä¸Žéžå¹²æ‰°æ€§çš„å½¢å¼åŒ–ç†è®ºæ–‡æ¡£ï¼Œæä¾›äº†å®Œæ•´çš„é€»è¾‘æ¡†æž¶ã€å½¢å¼åŒ–å®šä¹‰ã€å®šç†è¯æ˜Žå’Œå®žé™…åº”ç”¨æ¡ˆä¾‹ã€‚

**æ–‡æ¡£å†…å®¹ç»“æž„**ï¼š

1. **æ¦‚è¿°éƒ¨åˆ†**ï¼š
   - å®‰å…¨ç­–ç•¥ä¸Žéžå¹²æ‰°æ€§çš„å·¥ä½œåŽŸç†æ¦‚è¿°
   - æ–‡æ¡£èŒƒå›´å’Œç›®æ ‡è¯»è€…

2. **æ ¸å¿ƒå†…å®¹**ï¼š
   - **éžå¹²æ‰°æ€§**ï¼šéžå¹²æ‰°æ€§çš„åŸºæœ¬æ¦‚å¿µã€å®šä¹‰å’Œæ€§è´¨
   - **å®‰å…¨ç­–ç•¥**ï¼šè®¿é—®æŽ§åˆ¶æ¨¡åž‹ï¼ˆDACã€MACã€RBACï¼‰å’Œå®‰å…¨çº§åˆ«

3. **å½¢å¼åŒ–å®šä¹‰**ï¼š
   - éžå¹²æ‰°æ€§çš„å½¢å¼åŒ–å®šä¹‰
   - ä¿¡æ¯æµå®‰å…¨çš„å½¢å¼åŒ–
   - å®‰å…¨ç­–ç•¥çš„å½¢å¼åŒ–

4. **å®šç†ä¸Žè¯æ˜Ž**ï¼š
   - éžå¹²æ‰°æ€§å®šç†åŠå…¶ä¸¥æ ¼è¯æ˜Ž
   - ä¿¡æ¯æµå®‰å…¨å®šç†åŠå…¶è¯æ˜Ž
   - å®‰å…¨ç­–ç•¥ç»„åˆå®šç†åŠå…¶è¯æ˜Ž

5. **å®žé™…åº”ç”¨**ï¼š
   - PostgreSQL 18å®‰å…¨ç­–ç•¥å®žçŽ°è¯¦è§£
   - SQLite 3.45å®‰å…¨æœºåˆ¶å¯¹æ¯”
   - å®žé™…ä¸šåŠ¡åœºæ™¯æ¡ˆä¾‹ï¼ˆå¤šç§Ÿæˆ·SaaSç³»ç»Ÿã€é‡‘èžç³»ç»Ÿï¼‰
   - å®‰å…¨ç­–ç•¥é€‰æ‹©æœ€ä½³å®žè·µ

6. **ç›¸å…³æ–‡æ¡£å’Œå‚è€ƒæ–‡çŒ®**ï¼š
   - ç†è®ºåŸºç¡€æ–‡æ¡£é“¾æŽ¥
   - æ ¸å¿ƒç†è®ºæ–‡çŒ®å¼•ç”¨
   - PostgreSQLå®žçŽ°ç›¸å…³èµ„æº

**ç›®æ ‡è¯»è€…**ï¼š

- **å®‰å…¨ç ”ç©¶äººå‘˜**ï¼šéœ€è¦ç†è§£éžå¹²æ‰°æ€§ç†è®ºçš„å½¢å¼åŒ–å®šä¹‰å’Œè¯æ˜Ž
- **æ•°æ®åº“å®‰å…¨å·¥ç¨‹å¸ˆ**ï¼šéœ€è¦å®žçŽ°å®‰å…¨ç­–ç•¥å’ŒéªŒè¯éžå¹²æ‰°æ€§
- **ç³»ç»Ÿæž¶æž„å¸ˆ**ï¼šéœ€è¦è®¾è®¡å®‰å…¨çš„å¤šç§Ÿæˆ·ç³»ç»Ÿå’Œåˆ†çº§å®‰å…¨ç­–ç•¥
- **åˆè§„å®¡è®¡äººå‘˜**ï¼šéœ€è¦éªŒè¯ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œåˆè§„æ€§

**æ–‡æ¡£ç‰¹ç‚¹**ï¼š

- **å½¢å¼åŒ–ä¸¥æ ¼æ€§**ï¼šæ‰€æœ‰å®šä¹‰å’Œå®šç†éƒ½æœ‰ä¸¥æ ¼çš„å½¢å¼åŒ–è¡¨è¿°
- **è¯æ˜Žå®Œæ•´æ€§**ï¼šæä¾›å®Œæ•´çš„å®šç†è¯æ˜Žè¿‡ç¨‹
- **å®žé™…åº”ç”¨æ€§**ï¼šåŒ…å«PostgreSQLå’ŒSQLiteçš„å®žé™…å®žçŽ°æ¡ˆä¾‹
- **åœºæ™¯ä¸°å¯Œæ€§**ï¼šæä¾›å¤šä¸ªå®žé™…ä¸šåŠ¡åœºæ™¯çš„å®‰å…¨ç­–ç•¥åº”ç”¨æ¡ˆä¾‹

---

## 2. æ ¸å¿ƒå†…å®¹

### 2.1 éžå¹²æ‰°æ€§

éžå¹²æ‰°æ€§ï¼ˆNon-interferenceï¼‰æ˜¯ä¿¡æ¯å®‰å…¨ç†è®ºä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œç”¨äºŽæè¿°é«˜å®‰å…¨çº§åˆ«çš„æ“ä½œä¸ä¼šå½±å“ä½Žå®‰å…¨çº§åˆ«è§‚å¯Ÿè€…çš„è§‚å¯Ÿç»“æžœã€‚

**éžå¹²æ‰°æ€§å®šä¹‰**ï¼š

```haskell
-- éžå¹²æ‰°æ€§
nonInterference :: System -> Bool
nonInterference sys =
    forall highLevelAction a, lowLevelObserver o:
        result(o, sys) = result(o, sys after a)
```

**éžå¹²æ‰°æ€§çš„ç›´è§‚ç†è§£**ï¼š

éžå¹²æ‰°æ€§è¦æ±‚ç³»ç»Ÿæ»¡è¶³ä»¥ä¸‹æ€§è´¨ï¼šå¯¹äºŽä»»ä½•é«˜å®‰å…¨çº§åˆ«çš„æ“ä½œ`a`å’Œä½Žå®‰å…¨çº§åˆ«çš„è§‚å¯Ÿè€…`o`ï¼Œè§‚å¯Ÿè€…åœ¨æ“ä½œ`a`æ‰§è¡Œå‰åŽçœ‹åˆ°çš„ç³»ç»ŸçŠ¶æ€åº”è¯¥ç›¸åŒã€‚è¿™æ„å‘³ç€é«˜å®‰å…¨çº§åˆ«çš„æ“ä½œå¯¹ä½Žå®‰å…¨çº§åˆ«çš„è§‚å¯Ÿè€…æ¥è¯´æ˜¯"ä¸å¯è§"çš„ã€‚

**éžå¹²æ‰°æ€§çš„é‡è¦æ€§**ï¼š

1. **ä¿¡æ¯æµå®‰å…¨**ï¼šéžå¹²æ‰°æ€§ç¡®ä¿äº†ä¿¡æ¯åªèƒ½ä»Žä½Žå®‰å…¨çº§åˆ«æµå‘é«˜å®‰å…¨çº§åˆ«ï¼Œè€Œä¸èƒ½åå‘æµåŠ¨
2. **éšç§ä¿æŠ¤**ï¼šé«˜å®‰å…¨çº§åˆ«çš„æ•°æ®æ“ä½œä¸ä¼šæ³„éœ²ç»™ä½Žå®‰å…¨çº§åˆ«çš„ç”¨æˆ·
3. **å®‰å…¨éš”ç¦»**ï¼šä¸åŒå®‰å…¨çº§åˆ«çš„ç”¨æˆ·ä¹‹é—´å®žçŽ°äº†å®Œå…¨éš”ç¦»

**éžå¹²æ‰°æ€§çš„ç±»åž‹**ï¼š

1. **å®Œå…¨éžå¹²æ‰°æ€§ï¼ˆPerfect Non-interferenceï¼‰**ï¼š
   - é«˜å®‰å…¨çº§åˆ«æ“ä½œå®Œå…¨ä¸å½±å“ä½Žå®‰å…¨çº§åˆ«è§‚å¯Ÿ
   - æœ€ä¸¥æ ¼çš„å®‰å…¨ä¿è¯

2. **æ¦‚çŽ‡éžå¹²æ‰°æ€§ï¼ˆProbabilistic Non-interferenceï¼‰**ï¼š
   - å…è®¸ä¸€å®šæ¦‚çŽ‡çš„ä¿¡æ¯æ³„éœ²
   - é€‚ç”¨äºŽéœ€è¦å¹³è¡¡å®‰å…¨æ€§å’Œæ€§èƒ½çš„åœºæ™¯

3. **æ—¶é—´éžå¹²æ‰°æ€§ï¼ˆTiming Non-interferenceï¼‰**ï¼š
   - è€ƒè™‘æ—¶é—´å› ç´ çš„éžå¹²æ‰°æ€§
   - é˜²æ­¢é€šè¿‡æ—¶é—´ä¾§ä¿¡é“æ³„éœ²ä¿¡æ¯

**PostgreSQLä¸­çš„éžå¹²æ‰°æ€§å®žçŽ°**ï¼š

åœ¨PostgreSQLä¸­ï¼Œéžå¹²æ‰°æ€§å¯ä»¥é€šè¿‡ä»¥ä¸‹æœºåˆ¶å®žçŽ°ï¼š

1. **è¡Œçº§å®‰å…¨ï¼ˆRLSï¼‰**ï¼šç¡®ä¿ç”¨æˆ·åªèƒ½è®¿é—®è¢«æŽˆæƒçš„è¡Œ
2. **åˆ—çº§æƒé™**ï¼šæŽ§åˆ¶ç”¨æˆ·å¯¹ç‰¹å®šåˆ—çš„è®¿é—®
3. **è§†å›¾å®‰å…¨**ï¼šé€šè¿‡å®‰å…¨è§†å›¾éšè—æ•æ„Ÿä¿¡æ¯
4. **å®‰å…¨æ ‡ç­¾**ï¼šä½¿ç”¨å®‰å…¨æ ‡ç­¾å®žçŽ°å¼ºåˆ¶è®¿é—®æŽ§åˆ¶ï¼ˆMACï¼‰

### 2.2 å®‰å…¨ç­–ç•¥

å®‰å…¨ç­–ç•¥å®šä¹‰äº†ç³»ç»Ÿä¸­å¦‚ä½•æŽ§åˆ¶è®¿é—®å’Œä¿æŠ¤ä¿¡æ¯ã€‚æœ¬èŠ‚è¯¦ç»†è¯´æ˜Žå„ç§è®¿é—®æŽ§åˆ¶æ¨¡åž‹çš„ç‰¹ç‚¹ã€é€‚ç”¨åœºæ™¯å’Œå®žçŽ°æ–¹æ³•ã€‚

**è®¿é—®æŽ§åˆ¶æ¨¡åž‹**ï¼š

| æ¨¡åž‹ | æŽ§åˆ¶æ–¹å¼ | çµæ´»æ€§ | å®‰å…¨æ€§ | é€‚ç”¨åœºæ™¯ | è¯¦ç»†è¯´æ˜Ž |
| :--- | :------- | :----- | :----- | :------- | :------- |
| **DAC** | è‡ªä¸»æŽ§åˆ¶ | é«˜ | ä¸­ | å°åž‹ç³»ç»Ÿã€åä½œçŽ¯å¢ƒ | èµ„æºæ‰€æœ‰è€…è‡ªä¸»å†³å®šè®¿é—®æƒé™ |
| **MAC** | å¼ºåˆ¶æŽ§åˆ¶ | ä½Ž | é«˜ | å†›äº‹ç³»ç»Ÿã€é«˜å®‰å…¨çŽ¯å¢ƒ | ç³»ç»Ÿå¼ºåˆ¶å®žæ–½è®¿é—®æŽ§åˆ¶ç­–ç•¥ |
| **RBAC** | åŸºäºŽè§’è‰² | ä¸­ | é«˜ | ä¼ä¸šç³»ç»Ÿã€å¤šç”¨æˆ·çŽ¯å¢ƒ | é€šè¿‡è§’è‰²åˆ†é…æƒé™ï¼Œæ˜“äºŽç®¡ç† |

#### 2.2.1 è‡ªä¸»è®¿é—®æŽ§åˆ¶ï¼ˆDAC - Discretionary Access Controlï¼‰

**ç‰¹ç‚¹**ï¼š

- èµ„æºæ‰€æœ‰è€…å¯ä»¥è‡ªä¸»å†³å®šè°å¯ä»¥è®¿é—®èµ„æº
- æƒé™å¯ä»¥ä¼ é€’ç»™å…¶ä»–ç”¨æˆ·
- çµæ´»æ€§é«˜ï¼Œä½†å®‰å…¨æ€§ç›¸å¯¹è¾ƒä½Ž

**PostgreSQLå®žçŽ°**ï¼š

```sql
-- DACç¤ºä¾‹ï¼šè¡¨æ‰€æœ‰è€…æŽˆäºˆæƒé™ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'sensitive_data') THEN
            CREATE TABLE sensitive_data (
                id SERIAL PRIMARY KEY,
                data TEXT
            );
            RAISE NOTICE 'è¡¨ sensitive_data åˆ›å»ºæˆåŠŸ';
        ELSE
            RAISE NOTICE 'è¡¨ sensitive_data å·²å­˜åœ¨';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ sensitive_data å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- æ‰€æœ‰è€…æŽˆäºˆSELECTæƒé™ç»™ç”¨æˆ·aliceï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'sensitive_data') THEN
            RAISE WARNING 'è¡¨ sensitive_data ä¸å­˜åœ¨ï¼Œæ— æ³•æŽˆäºˆæƒé™';
            RETURN;
        END IF;
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'alice') THEN
            RAISE WARNING 'ç”¨æˆ· alice ä¸å­˜åœ¨ï¼Œæ— æ³•æŽˆäºˆæƒé™';
            RETURN;
        END IF;

        GRANT SELECT ON sensitive_data TO alice;
        RAISE NOTICE 'SELECTæƒé™æŽˆäºˆæˆåŠŸ: sensitive_data -> alice';
    EXCEPTION
        WHEN undefined_object THEN
            RAISE WARNING 'è¡¨æˆ–ç”¨æˆ·ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'æŽˆäºˆæƒé™å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- aliceå¯ä»¥è¿›ä¸€æ­¥æŽˆäºˆæƒé™ç»™å…¶ä»–ç”¨æˆ·
-- ï¼ˆå¦‚æžœaliceæœ‰GRANT OPTIONï¼‰
```

#### 2.2.2 å¼ºåˆ¶è®¿é—®æŽ§åˆ¶ï¼ˆMAC - Mandatory Access Controlï¼‰

**ç‰¹ç‚¹**ï¼š

- ç³»ç»Ÿå¼ºåˆ¶å®žæ–½è®¿é—®æŽ§åˆ¶ç­–ç•¥
- ç”¨æˆ·ä¸èƒ½è‡ªä¸»ä¿®æ”¹æƒé™
- å®‰å…¨æ€§é«˜ï¼Œä½†çµæ´»æ€§ä½Ž

**PostgreSQLå®žçŽ°**ï¼š

```sql
-- MACç¤ºä¾‹ï¼šä½¿ç”¨å®‰å…¨æ ‡ç­¾ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_extension WHERE extname = 'sepgsql') THEN
            CREATE EXTENSION sepgsql;
            RAISE NOTICE 'sepgsqlæ‰©å±•å®‰è£…æˆåŠŸ';
        ELSE
            RAISE NOTICE 'sepgsqlæ‰©å±•å·²å­˜åœ¨';
        END IF;
    EXCEPTION
        WHEN undefined_file THEN
            RAISE WARNING 'sepgsqlæ‰©å±•ä¸å¯ç”¨ï¼Œéœ€è¦å…ˆå®‰è£…';
        WHEN insufficient_privilege THEN
            RAISE EXCEPTION 'éœ€è¦è¶…çº§ç”¨æˆ·æƒé™æ¥å®‰è£…æ‰©å±•';
        WHEN OTHERS THEN
            RAISE WARNING 'å®‰è£…sepgsqlæ‰©å±•å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- åˆ›å»ºå¸¦å®‰å…¨æ ‡ç­¾çš„è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'classified_data') THEN
            CREATE TABLE classified_data (
                id SERIAL PRIMARY KEY,
                data TEXT,
                security_label TEXT
            );
            RAISE NOTICE 'è¡¨ classified_data åˆ›å»ºæˆåŠŸ';
        ELSE
            RAISE NOTICE 'è¡¨ classified_data å·²å­˜åœ¨';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ classified_data å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- è®¾ç½®å®‰å…¨æ ‡ç­¾ç­–ç•¥ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'classified_data') THEN
            RAISE WARNING 'è¡¨ classified_data ä¸å­˜åœ¨ï¼Œæ— æ³•è®¾ç½®å®‰å…¨æ ‡ç­¾';
            RETURN;
        END IF;

        SECURITY LABEL FOR sepgsql ON TABLE classified_data IS 'system_u:object_r:db_table_t:s0';
        RAISE NOTICE 'å®‰å…¨æ ‡ç­¾è®¾ç½®æˆåŠŸ';
    EXCEPTION
        WHEN undefined_table THEN
            RAISE WARNING 'è¡¨ classified_data ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'è®¾ç½®å®‰å…¨æ ‡ç­¾å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

#### 2.2.3 åŸºäºŽè§’è‰²çš„è®¿é—®æŽ§åˆ¶ï¼ˆRBAC - Role-Based Access Controlï¼‰

**ç‰¹ç‚¹**ï¼š

- é€šè¿‡è§’è‰²åˆ†é…æƒé™
- ç”¨æˆ·é€šè¿‡è§’è‰²èŽ·å¾—æƒé™
- æ˜“äºŽç®¡ç†å’Œç»´æŠ¤

**PostgreSQLå®žçŽ°**ï¼š

```sql
-- RBACç¤ºä¾‹ï¼šåˆ›å»ºè§’è‰²å’Œåˆ†é…æƒé™ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'data_analyst') THEN
            CREATE ROLE data_analyst;
            RAISE NOTICE 'è§’è‰² data_analyst åˆ›å»ºæˆåŠŸ';
        ELSE
            RAISE NOTICE 'è§’è‰² data_analyst å·²å­˜åœ¨';
        END IF;
    EXCEPTION
        WHEN duplicate_object THEN
            RAISE WARNING 'è§’è‰² data_analyst å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè§’è‰²å¤±è´¥: %', SQLERRM;
            RAISE;
    END;

    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'data_admin') THEN
            CREATE ROLE data_admin;
            RAISE NOTICE 'è§’è‰² data_admin åˆ›å»ºæˆåŠŸ';
        ELSE
            RAISE NOTICE 'è§’è‰² data_admin å·²å­˜åœ¨';
        END IF;
    EXCEPTION
        WHEN duplicate_object THEN
            RAISE WARNING 'è§’è‰² data_admin å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè§’è‰²å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- æŽˆäºˆè§’è‰²æƒé™ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'sensitive_data') THEN
            RAISE WARNING 'è¡¨ sensitive_data ä¸å­˜åœ¨ï¼Œæ— æ³•æŽˆäºˆæƒé™';
            RETURN;
        END IF;
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'data_analyst') THEN
            RAISE WARNING 'è§’è‰² data_analyst ä¸å­˜åœ¨';
            RETURN;
        END IF;
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'data_admin') THEN
            RAISE WARNING 'è§’è‰² data_admin ä¸å­˜åœ¨';
            RETURN;
        END IF;

        GRANT SELECT ON sensitive_data TO data_analyst;
        GRANT ALL ON sensitive_data TO data_admin;
        RAISE NOTICE 'è§’è‰²æƒé™æŽˆäºˆæˆåŠŸ';
    EXCEPTION
        WHEN undefined_object THEN
            RAISE WARNING 'è¡¨æˆ–è§’è‰²ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'æŽˆäºˆè§’è‰²æƒé™å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- å°†è§’è‰²æŽˆäºˆç”¨æˆ·ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'data_analyst') THEN
            RAISE WARNING 'è§’è‰² data_analyst ä¸å­˜åœ¨';
            RETURN;
        END IF;
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'alice') THEN
            RAISE WARNING 'ç”¨æˆ· alice ä¸å­˜åœ¨';
            RETURN;
        END IF;

        GRANT data_analyst TO alice;
        RAISE NOTICE 'è§’è‰²æŽˆäºˆæˆåŠŸ: data_analyst -> alice';
    EXCEPTION
        WHEN undefined_object THEN
            RAISE WARNING 'è§’è‰²æˆ–ç”¨æˆ·ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'æŽˆäºˆè§’è‰²å¤±è´¥: %', SQLERRM;
            RAISE;
    END;

    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'data_admin') THEN
            RAISE WARNING 'è§’è‰² data_admin ä¸å­˜åœ¨';
            RETURN;
        END IF;
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'bob') THEN
            RAISE WARNING 'ç”¨æˆ· bob ä¸å­˜åœ¨';
            RETURN;
        END IF;

        GRANT data_admin TO bob;
        RAISE NOTICE 'è§’è‰²æŽˆäºˆæˆåŠŸ: data_admin -> bob';
    EXCEPTION
        WHEN undefined_object THEN
            RAISE WARNING 'è§’è‰²æˆ–ç”¨æˆ·ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'æŽˆäºˆè§’è‰²å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

**å®‰å…¨çº§åˆ«**ï¼š

å®‰å…¨çº§åˆ«ç”¨äºŽå¯¹æ•°æ®å’Œç”¨æˆ·è¿›è¡Œåˆ†ç±»ï¼Œå¸¸è§çš„åˆ†ç±»åŒ…æ‹¬ï¼š

1. **æœºå¯†æ€§çº§åˆ«**ï¼š
   - **å…¬å¼€ï¼ˆPublicï¼‰**ï¼šä»»ä½•äººéƒ½å¯ä»¥è®¿é—®
   - **å†…éƒ¨ï¼ˆInternalï¼‰**ï¼šç»„ç»‡å†…éƒ¨å¯ä»¥è®¿é—®
   - **æœºå¯†ï¼ˆConfidentialï¼‰**ï¼šç‰¹å®šäººå‘˜å¯ä»¥è®¿é—®
   - **ç»å¯†ï¼ˆTop Secretï¼‰**ï¼šæžå°‘æ•°äººå¯ä»¥è®¿é—®

2. **å®Œæ•´æ€§çº§åˆ«**ï¼š
   - **ä½Žï¼ˆLowï¼‰**ï¼šæ•°æ®å®Œæ•´æ€§è¦æ±‚ä½Ž
   - **ä¸­ï¼ˆMediumï¼‰**ï¼šæ•°æ®å®Œæ•´æ€§è¦æ±‚ä¸­ç­‰
   - **é«˜ï¼ˆHighï¼‰**ï¼šæ•°æ®å®Œæ•´æ€§è¦æ±‚é«˜

**å®‰å…¨ç­–ç•¥é€‰æ‹©å»ºè®®**ï¼š

```text
é€‰æ‹©å†³ç­–æµç¨‹ï¼š
-----------
å®‰å…¨è¦æ±‚ï¼Ÿ
â”œâ”€ é«˜å®‰å…¨æ€§ â†’ MACï¼ˆå¼ºåˆ¶è®¿é—®æŽ§åˆ¶ï¼‰
â”œâ”€ ä¸­ç­‰å®‰å…¨æ€§ â†’ RBACï¼ˆåŸºäºŽè§’è‰²çš„è®¿é—®æŽ§åˆ¶ï¼‰
â””â”€ ä½Žå®‰å…¨æ€§ â†’ DACï¼ˆè‡ªä¸»è®¿é—®æŽ§åˆ¶ï¼‰

ç®¡ç†å¤æ‚åº¦ï¼Ÿ
â”œâ”€ ç®€å•ç®¡ç† â†’ RBAC
â”œâ”€ å¤æ‚ç®¡ç† â†’ MAC
â””â”€ çµæ´»ç®¡ç† â†’ DAC

é€‚ç”¨åœºæ™¯ï¼Ÿ
â”œâ”€ å†›äº‹/æ”¿åºœç³»ç»Ÿ â†’ MAC
â”œâ”€ ä¼ä¸šç³»ç»Ÿ â†’ RBAC
â””â”€ åä½œç³»ç»Ÿ â†’ DAC
```

---

## 3. å½¢å¼åŒ–å®šä¹‰

### 3.1 éžå¹²æ‰°æ€§å½¢å¼åŒ–

**éžå¹²æ‰°æ€§**ï¼š

```haskell
-- éžå¹²æ‰°æ€§å½¢å¼åŒ–
nonInterference(sys) =
    forall H-action a, L-observer o:
        view(o, sys) = view(o, sys after a)
```

---

## 4. å®šç†ä¸Žè¯æ˜Ž

### 4.1 éžå¹²æ‰°æ€§å®šç†

**å®šç†**ï¼šå¦‚æžœç³»ç»Ÿæ»¡è¶³éžå¹²æ‰°æ€§ï¼Œåˆ™é«˜å®‰å…¨çº§åˆ«æ“ä½œä¸å½±å“ä½Žå®‰å…¨çº§åˆ«è§‚å¯Ÿã€‚

**å½¢å¼åŒ–è¡¨è¿°**ï¼š

è®¾ç³»ç»ŸSï¼Œå®‰å…¨çº§åˆ«åˆ†ä¸ºé«˜ï¼ˆHï¼‰å’Œä½Žï¼ˆLï¼‰ã€‚å¯¹äºŽä»»æ„é«˜å®‰å…¨çº§åˆ«æ“ä½œa âˆˆ Hå’Œä½Žå®‰å…¨çº§åˆ«è§‚å¯Ÿè€…o âˆˆ Lï¼Œå¦‚æžœç³»ç»ŸSæ»¡è¶³éžå¹²æ‰°æ€§ï¼Œåˆ™view(o, S) = view(o, S after a)ï¼Œå…¶ä¸­view(o, S)æ˜¯è§‚å¯Ÿè€…oåœ¨ç³»ç»ŸSä¸­çš„è§†å›¾ã€‚

**è¯æ˜Ž**ï¼ˆæž„é€ æ€§è¯æ˜Žï¼‰ï¼š

**æ­¥éª¤1ï¼šéžå¹²æ‰°æ€§å®šä¹‰**:

- éžå¹²æ‰°æ€§è¦æ±‚ï¼šå¯¹äºŽä»»æ„é«˜å®‰å…¨çº§åˆ«æ“ä½œaå’Œä½Žå®‰å…¨çº§åˆ«è§‚å¯Ÿè€…oï¼Œview(o, S) = view(o, S after a)
- è¿™æ„å‘³ç€é«˜å®‰å…¨çº§åˆ«æ“ä½œå¯¹ä½Žå®‰å…¨çº§åˆ«è§‚å¯Ÿè€…ä¸å¯è§

**æ­¥éª¤2ï¼šç³»ç»ŸçŠ¶æ€å®šä¹‰**:

- è®¾ç³»ç»ŸSçš„çŠ¶æ€ä¸ºÏƒ = (Ïƒ_H, Ïƒ_L)ï¼Œå…¶ä¸­Ïƒ_Hæ˜¯é«˜å®‰å…¨çº§åˆ«çŠ¶æ€ï¼ŒÏƒ_Læ˜¯ä½Žå®‰å…¨çº§åˆ«çŠ¶æ€
- è§‚å¯Ÿè€…oåªèƒ½è§‚å¯Ÿåˆ°Ïƒ_Lï¼Œä¸èƒ½è§‚å¯Ÿåˆ°Ïƒ_H

**æ­¥éª¤3ï¼šé«˜å®‰å…¨çº§åˆ«æ“ä½œ**:

- è®¾é«˜å®‰å…¨çº§åˆ«æ“ä½œaåªä¿®æ”¹Ïƒ_Hï¼Œä¸ä¿®æ”¹Ïƒ_L
- æ‰§è¡ŒaåŽï¼Œç³»ç»ŸçŠ¶æ€å˜ä¸ºÏƒ' = (Ïƒ'_H, Ïƒ_L)ï¼Œå…¶ä¸­Ïƒ'_H â‰  Ïƒ_Hï¼Œä½†Ïƒ'_L = Ïƒ_L

**æ­¥éª¤4ï¼šä½Žå®‰å…¨çº§åˆ«è§‚å¯Ÿ**:

- è§‚å¯Ÿè€…oçš„è§†å›¾view(o, S) = Ïƒ_L
- è§‚å¯Ÿè€…oçš„è§†å›¾view(o, S after a) = Ïƒ'_L = Ïƒ_L
- å› æ­¤ï¼Œview(o, S) = view(o, S after a)

**æ­¥éª¤5ï¼šç»“è®º**:

- é«˜å®‰å…¨çº§åˆ«æ“ä½œaä¸å½±å“ä½Žå®‰å…¨çº§åˆ«è§‚å¯Ÿè€…oçš„è§†å›¾
- å› æ­¤ï¼Œç³»ç»Ÿæ»¡è¶³éžå¹²æ‰°æ€§
- è¯æ¯•

**è¯æ˜Žæ ‘**ï¼š

```mermaid
graph TD
    A[éžå¹²æ‰°æ€§å®šç†] --> B[éžå¹²æ‰°æ€§å®šä¹‰]
    B --> C[ç³»ç»ŸçŠ¶æ€å®šä¹‰]
    C --> D[é«˜å®‰å…¨çº§åˆ«æ“ä½œ]
    D --> E[ä½Žå®‰å…¨çº§åˆ«è§‚å¯Ÿ]
    E --> F[è§†å›¾ä¸å˜]

    style A fill:#FFD700
    style F fill:#90EE90
```

### 4.2 ä¿¡æ¯æµå®‰å…¨å®šç†

**å®šç†**ï¼šå¦‚æžœç³»ç»Ÿæ»¡è¶³éžå¹²æ‰°æ€§ï¼Œåˆ™ä¿¡æ¯ä¸ä¼šä»Žé«˜å®‰å…¨çº§åˆ«æµå‘ä½Žå®‰å…¨çº§åˆ«ã€‚

**å½¢å¼åŒ–è¡¨è¿°**ï¼š

è®¾ç³»ç»ŸSï¼Œå®‰å…¨çº§åˆ«åˆ†ä¸ºé«˜ï¼ˆHï¼‰å’Œä½Žï¼ˆLï¼‰ã€‚å¦‚æžœç³»ç»ŸSæ»¡è¶³éžå¹²æ‰°æ€§ï¼Œåˆ™å¯¹äºŽä»»æ„ä¿¡æ¯i âˆˆ Hï¼Œä¸å­˜åœ¨ä¿¡æ¯æµä»Žiåˆ°Lã€‚

**è¯æ˜Ž**ï¼ˆåè¯æ³•ï¼‰ï¼š

**æ­¥éª¤1ï¼šå‡è®¾å­˜åœ¨ä¿¡æ¯æµ**:

- å‡è®¾å­˜åœ¨ä¿¡æ¯æµä»Žé«˜å®‰å…¨çº§åˆ«ä¿¡æ¯i âˆˆ Håˆ°ä½Žå®‰å…¨çº§åˆ«L
- è¿™æ„å‘³ç€ä½Žå®‰å…¨çº§åˆ«è§‚å¯Ÿè€…oå¯ä»¥é€šè¿‡æŸç§æ–¹å¼è§‚å¯Ÿåˆ°i

**æ­¥éª¤2ï¼šä¿¡æ¯æµå®šä¹‰**:

- ä¿¡æ¯æµå­˜åœ¨æ„å‘³ç€ï¼šå­˜åœ¨æ“ä½œåºåˆ—aâ‚, aâ‚‚, ..., aâ‚™ï¼Œä½¿å¾—view(o, S after aâ‚...aâ‚™)åŒ…å«å…³äºŽiçš„ä¿¡æ¯

**æ­¥éª¤3ï¼šéžå¹²æ‰°æ€§çº¦æŸ**:

- æ ¹æ®éžå¹²æ‰°æ€§ï¼Œå¯¹äºŽä»»æ„é«˜å®‰å…¨çº§åˆ«æ“ä½œaï¼Œview(o, S) = view(o, S after a)
- å› æ­¤ï¼Œview(o, S) = view(o, S after aâ‚) = ... = view(o, S after aâ‚...aâ‚™)

**æ­¥éª¤4ï¼šçŸ›ç›¾**:

- å¦‚æžœview(o, S after aâ‚...aâ‚™)åŒ…å«å…³äºŽiçš„ä¿¡æ¯ï¼Œä½†view(o, S)ä¸åŒ…å«å…³äºŽiçš„ä¿¡æ¯
- è¿™ä¸Žéžå¹²æ‰°æ€§çŸ›ç›¾

**æ­¥éª¤5ï¼šç»“è®º**:

- ä¸å­˜åœ¨ä¿¡æ¯æµä»Žé«˜å®‰å…¨çº§åˆ«åˆ°ä½Žå®‰å…¨çº§åˆ«
- å› æ­¤ï¼Œç³»ç»Ÿæ»¡è¶³ä¿¡æ¯æµå®‰å…¨
- è¯æ¯•

**è¯æ˜Žæ ‘**ï¼š

```mermaid
graph TD
    A[ä¿¡æ¯æµå®‰å…¨å®šç†] --> B[å‡è®¾å­˜åœ¨ä¿¡æ¯æµ]
    B --> C[ä¿¡æ¯æµå®šä¹‰]
    C --> D[éžå¹²æ‰°æ€§çº¦æŸ]
    D --> E[çŸ›ç›¾]
    E --> F[æ— ä¿¡æ¯æµ]

    style A fill:#FFD700
    style F fill:#90EE90
```

### 4.3 å®‰å…¨ç­–ç•¥ç»„åˆå®šç†

**å®šç†**ï¼šå¦‚æžœä¸¤ä¸ªå®‰å…¨ç­–ç•¥éƒ½æ»¡è¶³éžå¹²æ‰°æ€§ï¼Œåˆ™å®ƒä»¬çš„ç»„åˆä¹Ÿæ»¡è¶³éžå¹²æ‰°æ€§ã€‚

**å½¢å¼åŒ–è¡¨è¿°**ï¼š

è®¾å®‰å…¨ç­–ç•¥Pâ‚å’ŒPâ‚‚éƒ½æ»¡è¶³éžå¹²æ‰°æ€§ã€‚å¦‚æžœç³»ç»ŸSåŒæ—¶å®žæ–½Pâ‚å’ŒPâ‚‚ï¼Œåˆ™ç»„åˆç­–ç•¥Pâ‚ âˆ§ Pâ‚‚ä¹Ÿæ»¡è¶³éžå¹²æ‰°æ€§ã€‚

**è¯æ˜Ž**ï¼ˆæž„é€ æ€§è¯æ˜Žï¼‰ï¼š

**æ­¥éª¤1ï¼šç­–ç•¥ç»„åˆå®šä¹‰**:

- ç»„åˆç­–ç•¥Pâ‚ âˆ§ Pâ‚‚è¦æ±‚ç³»ç»ŸSåŒæ—¶æ»¡è¶³Pâ‚å’ŒPâ‚‚çš„æ‰€æœ‰çº¦æŸ
- å¯¹äºŽä»»æ„æ“ä½œaï¼ŒPâ‚ âˆ§ Pâ‚‚å…è®¸aå½“ä¸”ä»…å½“Pâ‚å…è®¸aä¸”Pâ‚‚å…è®¸a

**æ­¥éª¤2ï¼šéžå¹²æ‰°æ€§ä¿æŒ**:

- è®¾Pâ‚æ»¡è¶³éžå¹²æ‰°æ€§ï¼šå¯¹äºŽä»»æ„Hæ“ä½œaå’ŒLè§‚å¯Ÿè€…oï¼Œview(o, S) = view(o, S after a)ï¼ˆåœ¨Pâ‚ä¸‹ï¼‰
- è®¾Pâ‚‚æ»¡è¶³éžå¹²æ‰°æ€§ï¼šå¯¹äºŽä»»æ„Hæ“ä½œaå’ŒLè§‚å¯Ÿè€…oï¼Œview(o, S) = view(o, S after a)ï¼ˆåœ¨Pâ‚‚ä¸‹ï¼‰

**æ­¥éª¤3ï¼šç»„åˆç­–ç•¥ä¸‹çš„æ“ä½œ**:

- åœ¨ç»„åˆç­–ç•¥Pâ‚ âˆ§ Pâ‚‚ä¸‹ï¼Œæ“ä½œaè¢«å…è®¸å½“ä¸”ä»…å½“Pâ‚å…è®¸aä¸”Pâ‚‚å…è®¸a
- å¦‚æžœaè¢«å…è®¸ï¼Œåˆ™Pâ‚å’ŒPâ‚‚éƒ½æ»¡è¶³éžå¹²æ‰°æ€§

**æ­¥éª¤4ï¼šè§†å›¾ä¸å˜æ€§**:

- åœ¨Pâ‚ä¸‹ï¼šview(o, S) = view(o, S after a)
- åœ¨Pâ‚‚ä¸‹ï¼šview(o, S) = view(o, S after a)
- åœ¨Pâ‚ âˆ§ Pâ‚‚ä¸‹ï¼šview(o, S) = view(o, S after a)

**æ­¥éª¤5ï¼šç»“è®º**:

- ç»„åˆç­–ç•¥Pâ‚ âˆ§ Pâ‚‚æ»¡è¶³éžå¹²æ‰°æ€§
- è¯æ¯•

**è¯æ˜Žæ ‘**ï¼š

```mermaid
graph TD
    A[å®‰å…¨ç­–ç•¥ç»„åˆå®šç†] --> B[ç­–ç•¥ç»„åˆå®šä¹‰]
    B --> C[éžå¹²æ‰°æ€§ä¿æŒ]
    C --> D[ç»„åˆç­–ç•¥æ“ä½œ]
    D --> E[è§†å›¾ä¸å˜æ€§]
    E --> F[ç»„åˆæ»¡è¶³éžå¹²æ‰°æ€§]

    style A fill:#FFD700
    style F fill:#90EE90
```

---

## 5. å®žé™…åº”ç”¨

### 5.1 PostgreSQL 18 å®‰å…¨ç­–ç•¥å®žçŽ°è¯¦è§£

**PostgreSQL 18å®‰å…¨æœºåˆ¶**ï¼š

PostgreSQL 18æ”¯æŒå¤šç§å®‰å…¨ç­–ç•¥ï¼ŒåŒ…æ‹¬è¡Œçº§å®‰å…¨ï¼ˆRLSï¼‰ã€åŸºäºŽè§’è‰²çš„è®¿é—®æŽ§åˆ¶ï¼ˆRBACï¼‰ç­‰ã€‚PostgreSQL 18çš„å®‰å…¨æœºåˆ¶å¯ä»¥éƒ¨åˆ†å®žçŽ°éžå¹²æ‰°æ€§ï¼Œé€šè¿‡RLSå’Œæƒé™æŽ§åˆ¶æ¥éš”ç¦»ä¸åŒå®‰å…¨çº§åˆ«çš„æ•°æ®ã€‚

**PostgreSQL 18è¡Œçº§å®‰å…¨ï¼ˆRLSï¼‰**ï¼š

```sql
-- PostgreSQL 18ï¼šå¯ç”¨RLSå®žçŽ°éžå¹²æ‰°æ€§ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
-- åœºæ™¯ï¼šå¤šç§Ÿæˆ·ç³»ç»Ÿï¼Œä¸åŒç§Ÿæˆ·æ•°æ®éš”ç¦»

-- 1. åˆ›å»ºè¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'tenant_data') THEN
            CREATE TABLE tenant_data (
                id SERIAL PRIMARY KEY,
                tenant_id INTEGER NOT NULL,
                data TEXT,
                security_level VARCHAR(20) DEFAULT 'low',
                created_at TIMESTAMPTZ DEFAULT NOW()
            );
            RAISE NOTICE 'è¡¨ tenant_data åˆ›å»ºæˆåŠŸ';
        ELSE
            RAISE NOTICE 'è¡¨ tenant_data å·²å­˜åœ¨';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ tenant_data å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- 2. å¯ç”¨RLSï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'tenant_data') THEN
            RAISE WARNING 'è¡¨ tenant_data ä¸å­˜åœ¨ï¼Œæ— æ³•å¯ç”¨RLS';
            RETURN;
        END IF;

        ALTER TABLE tenant_data ENABLE ROW LEVEL SECURITY;
        RAISE NOTICE 'è¡¨ tenant_data å·²å¯ç”¨è¡Œçº§å®‰å…¨';
    EXCEPTION
        WHEN undefined_table THEN
            RAISE WARNING 'è¡¨ tenant_data ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'å¯ç”¨RLSå¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- 3. åˆ›å»ºå®‰å…¨ç­–ç•¥ï¼ˆå®žçŽ°éžå¹²æ‰°æ€§ï¼Œå¸¦é”™è¯¯å¤„ç†ï¼‰
-- é«˜å®‰å…¨çº§åˆ«ç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±çš„æ•°æ®
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'tenant_data') THEN
            RAISE WARNING 'è¡¨ tenant_data ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºç­–ç•¥';
            RETURN;
        END IF;

        IF EXISTS (SELECT 1 FROM pg_policies WHERE schemaname = 'public' AND tablename = 'tenant_data' AND policyname = 'high_security_policy') THEN
            DROP POLICY high_security_policy ON tenant_data;
        END IF;

        CREATE POLICY high_security_policy ON tenant_data
            FOR ALL
            USING (
                security_level = 'high' AND
                tenant_id = current_setting('app.current_tenant_id')::INTEGER
            );
        RAISE NOTICE 'é«˜å®‰å…¨çº§åˆ«ç­–ç•¥åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºé«˜å®‰å…¨çº§åˆ«ç­–ç•¥å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- ä½Žå®‰å…¨çº§åˆ«ç”¨æˆ·åªèƒ½çœ‹åˆ°ä½Žå®‰å…¨çº§åˆ«æ•°æ®
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'tenant_data') THEN
            RAISE WARNING 'è¡¨ tenant_data ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºç­–ç•¥';
            RETURN;
        END IF;

        IF EXISTS (SELECT 1 FROM pg_policies WHERE schemaname = 'public' AND tablename = 'tenant_data' AND policyname = 'low_security_policy') THEN
            DROP POLICY low_security_policy ON tenant_data;
        END IF;

        CREATE POLICY low_security_policy ON tenant_data
            FOR ALL
            USING (
                security_level = 'low' AND
                tenant_id = current_setting('app.current_tenant_id')::INTEGER
            );
        RAISE NOTICE 'ä½Žå®‰å…¨çº§åˆ«ç­–ç•¥åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºä½Žå®‰å…¨çº§åˆ«ç­–ç•¥å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- 4. æµ‹è¯•éžå¹²æ‰°æ€§ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
-- è®¾ç½®å½“å‰ç§Ÿæˆ·
DO $$
BEGIN
    PERFORM set_config('app.current_tenant_id', '1', false);
    RAISE NOTICE 'å½“å‰ç§Ÿæˆ·IDå·²è®¾ç½®ä¸º1';
EXCEPTION
    WHEN OTHERS THEN
        RAISE WARNING 'è®¾ç½®å½“å‰ç§Ÿæˆ·IDå¤±è´¥: %', SQLERRM;
END $$;

-- é«˜å®‰å…¨çº§åˆ«ç”¨æˆ·æ’å…¥æ•°æ®ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'tenant_data') THEN
            RAISE WARNING 'è¡¨ tenant_data ä¸å­˜åœ¨ï¼Œæ— æ³•æ’å…¥æ•°æ®';
            RETURN;
        END IF;

        INSERT INTO tenant_data (tenant_id, data, security_level)
        VALUES (1, 'High security data', 'high');
        RAISE NOTICE 'é«˜å®‰å…¨çº§åˆ«æ•°æ®æ’å…¥æˆåŠŸ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'æ’å…¥æ•°æ®å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- ä½Žå®‰å…¨çº§åˆ«ç”¨æˆ·æŸ¥è¯¢ï¼ˆåº”è¯¥çœ‹ä¸åˆ°é«˜å®‰å…¨çº§åˆ«æ•°æ®ï¼‰
SET ROLE low_security_user;
SELECT * FROM tenant_data;
-- ç»“æžœï¼šåªè¿”å›žä½Žå®‰å…¨çº§åˆ«æ•°æ®ï¼Œä¸è¿”å›žé«˜å®‰å…¨çº§åˆ«æ•°æ®
-- è¿™å®žçŽ°äº†éžå¹²æ‰°æ€§ï¼šé«˜å®‰å…¨çº§åˆ«æ“ä½œä¸å½±å“ä½Žå®‰å…¨çº§åˆ«è§‚å¯Ÿ
```

**PostgreSQL 18åŸºäºŽè§’è‰²çš„è®¿é—®æŽ§åˆ¶ï¼ˆRBACï¼‰**ï¼š

```sql
-- PostgreSQL 18ï¼šRBACå®žçŽ°å®‰å…¨ç­–ç•¥ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
-- 1. åˆ›å»ºè§’è‰²å±‚æ¬¡ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'admin') THEN
            CREATE ROLE admin;
            RAISE NOTICE 'è§’è‰² admin åˆ›å»ºæˆåŠŸ';
        END IF;
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'manager') THEN
            CREATE ROLE manager;
            RAISE NOTICE 'è§’è‰² manager åˆ›å»ºæˆåŠŸ';
        END IF;
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'analyst') THEN
            CREATE ROLE analyst;
            RAISE NOTICE 'è§’è‰² analyst åˆ›å»ºæˆåŠŸ';
        END IF;
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'user') THEN
            CREATE ROLE "user";
            RAISE NOTICE 'è§’è‰² user åˆ›å»ºæˆåŠŸ';
        END IF;
    EXCEPTION
        WHEN duplicate_object THEN
            RAISE WARNING 'éƒ¨åˆ†è§’è‰²å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè§’è‰²å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- 2. æŽˆäºˆæƒé™ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'tenant_data') THEN
            RAISE WARNING 'è¡¨ tenant_data ä¸å­˜åœ¨ï¼Œæ— æ³•æŽˆäºˆæƒé™';
            RETURN;
        END IF;

        GRANT ALL ON tenant_data TO admin;
        GRANT SELECT, INSERT, UPDATE ON tenant_data TO manager;
        GRANT SELECT ON tenant_data TO analyst;
        GRANT SELECT ON tenant_data TO "user";
        RAISE NOTICE 'è§’è‰²æƒé™æŽˆäºˆæˆåŠŸ';
    EXCEPTION
        WHEN undefined_object THEN
            RAISE WARNING 'è¡¨æˆ–è§’è‰²ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'æŽˆäºˆæƒé™å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- 3. åˆ›å»ºç”¨æˆ·ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'admin_user') THEN
            CREATE USER admin_user WITH PASSWORD 'admin_pass';
            RAISE NOTICE 'ç”¨æˆ· admin_user åˆ›å»ºæˆåŠŸ';
        END IF;
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'manager_user') THEN
            CREATE USER manager_user WITH PASSWORD 'manager_pass';
            RAISE NOTICE 'ç”¨æˆ· manager_user åˆ›å»ºæˆåŠŸ';
        END IF;
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'analyst_user') THEN
            CREATE USER analyst_user WITH PASSWORD 'analyst_pass';
            RAISE NOTICE 'ç”¨æˆ· analyst_user åˆ›å»ºæˆåŠŸ';
        END IF;
    EXCEPTION
        WHEN duplicate_object THEN
            RAISE WARNING 'éƒ¨åˆ†ç”¨æˆ·å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºç”¨æˆ·å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- 4. åˆ†é…è§’è‰²ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'admin') THEN
            RAISE WARNING 'è§’è‰² admin ä¸å­˜åœ¨';
            RETURN;
        END IF;
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'admin_user') THEN
            RAISE WARNING 'ç”¨æˆ· admin_user ä¸å­˜åœ¨';
            RETURN;
        END IF;

        GRANT admin TO admin_user;
        RAISE NOTICE 'è§’è‰²æŽˆäºˆæˆåŠŸ: admin -> admin_user';
    EXCEPTION
        WHEN undefined_object THEN
            RAISE WARNING 'è§’è‰²æˆ–ç”¨æˆ·ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'æŽˆäºˆè§’è‰²å¤±è´¥: %', SQLERRM;
            RAISE;
    END;

    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'manager') THEN
            RAISE WARNING 'è§’è‰² manager ä¸å­˜åœ¨';
            RETURN;
        END IF;
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'manager_user') THEN
            RAISE WARNING 'ç”¨æˆ· manager_user ä¸å­˜åœ¨';
            RETURN;
        END IF;

        GRANT manager TO manager_user;
        RAISE NOTICE 'è§’è‰²æŽˆäºˆæˆåŠŸ: manager -> manager_user';
    EXCEPTION
        WHEN undefined_object THEN
            RAISE WARNING 'è§’è‰²æˆ–ç”¨æˆ·ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'æŽˆäºˆè§’è‰²å¤±è´¥: %', SQLERRM;
            RAISE;
    END;

    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'analyst') THEN
            RAISE WARNING 'è§’è‰² analyst ä¸å­˜åœ¨';
            RETURN;
        END IF;
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'analyst_user') THEN
            RAISE WARNING 'ç”¨æˆ· analyst_user ä¸å­˜åœ¨';
            RETURN;
        END IF;

        GRANT analyst TO analyst_user;
        RAISE NOTICE 'è§’è‰²æŽˆäºˆæˆåŠŸ: analyst -> analyst_user';
    EXCEPTION
        WHEN undefined_object THEN
            RAISE WARNING 'è§’è‰²æˆ–ç”¨æˆ·ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'æŽˆäºˆè§’è‰²å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- 5. æµ‹è¯•è®¿é—®æŽ§åˆ¶ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'tenant_data') THEN
            RAISE WARNING 'è¡¨ tenant_data ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡ŒæŸ¥è¯¢';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æµ‹è¯•è®¿é—®æŽ§åˆ¶';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'æµ‹è¯•å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT * FROM tenant_data;
-- åªèƒ½SELECTï¼Œä¸èƒ½INSERT/UPDATE/DELETE
```

**PostgreSQL 18å®‰å…¨ç­–ç•¥ç»„åˆ**ï¼š

```sql
-- PostgreSQL 18ï¼šç»„åˆRLSå’ŒRBACå®žçŽ°å¤šå±‚å®‰å…¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
-- 1. è¡¨çº§æƒé™ï¼ˆRBACï¼Œå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'tenant_data') THEN
            RAISE WARNING 'è¡¨ tenant_data ä¸å­˜åœ¨ï¼Œæ— æ³•æŽˆäºˆæƒé™';
            RETURN;
        END IF;
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'analyst') THEN
            RAISE WARNING 'è§’è‰² analyst ä¸å­˜åœ¨';
            RETURN;
        END IF;

        GRANT SELECT ON tenant_data TO analyst;
        RAISE NOTICE 'è¡¨çº§æƒé™æŽˆäºˆæˆåŠŸ: SELECT -> analyst';
    EXCEPTION
        WHEN undefined_object THEN
            RAISE WARNING 'è¡¨æˆ–è§’è‰²ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'æŽˆäºˆè¡¨çº§æƒé™å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- 2. è¡Œçº§å®‰å…¨ï¼ˆRLSï¼Œå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'tenant_data') THEN
            RAISE WARNING 'è¡¨ tenant_data ä¸å­˜åœ¨ï¼Œæ— æ³•å¯ç”¨RLS';
            RETURN;
        END IF;

        ALTER TABLE tenant_data ENABLE ROW LEVEL SECURITY;
        RAISE NOTICE 'è¡¨ tenant_data å·²å¯ç”¨è¡Œçº§å®‰å…¨';
    EXCEPTION
        WHEN undefined_table THEN
            RAISE WARNING 'è¡¨ tenant_data ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'å¯ç”¨RLSå¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'tenant_data') THEN
            RAISE WARNING 'è¡¨ tenant_data ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºç­–ç•¥';
            RETURN;
        END IF;

        IF EXISTS (SELECT 1 FROM pg_policies WHERE schemaname = 'public' AND tablename = 'tenant_data' AND policyname = 'tenant_isolation') THEN
            DROP POLICY tenant_isolation ON tenant_data;
        END IF;

        CREATE POLICY tenant_isolation ON tenant_data
            FOR ALL
            USING (tenant_id = current_setting('app.current_tenant_id')::INTEGER);
        RAISE NOTICE 'ç§Ÿæˆ·éš”ç¦»ç­–ç•¥åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºç§Ÿæˆ·éš”ç¦»ç­–ç•¥å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- 3. ç»„åˆæ•ˆæžœï¼ˆå¸¦æ€§èƒ½æµ‹è¯•ï¼‰
-- ç”¨æˆ·å¿…é¡»åŒæ—¶æ»¡è¶³ï¼š
-- - å…·æœ‰è¡¨çº§æƒé™ï¼ˆRBACï¼‰
-- - æ»¡è¶³è¡Œçº§å®‰å…¨ç­–ç•¥ï¼ˆRLSï¼‰
-- è¿™å®žçŽ°äº†å®‰å…¨ç­–ç•¥ç»„åˆ
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'tenant_data') THEN
            RAISE WARNING 'è¡¨ tenant_data ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡Œç»„åˆæµ‹è¯•';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æµ‹è¯•RLSå’ŒRBACç»„åˆæ•ˆæžœ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'æµ‹è¯•å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT * FROM tenant_data;
```

### 5.2 SQLite 3.45 å®‰å…¨å¯¹æ¯”

**SQLite 3.45å®‰å…¨æ”¯æŒ**ï¼š

SQLite 3.45çš„å®‰å…¨æ”¯æŒä¸ŽPostgreSQL 18ä¸åŒã€‚

| ç‰¹æ€§ | PostgreSQL 18 | SQLite 3.45 |
| :--- | :------------ | :---------- |
| **RLS** | âœ… æ”¯æŒ | âŒ ä¸æ”¯æŒ |
| **RBAC** | âœ… æ”¯æŒ | âš ï¸ æœ‰é™æ”¯æŒ |
| **éžå¹²æ‰°æ€§** | âš ï¸ éƒ¨åˆ†æ”¯æŒï¼ˆé€šè¿‡RLSï¼‰ | âŒ ä¸æ”¯æŒ |
| **å®‰å…¨ç­–ç•¥** | å¤šç§ï¼ˆRLSã€RBACã€MACï¼‰ | åº”ç”¨å±‚å®žçŽ° |

**SQLite 3.45å®‰å…¨**ï¼š

```sql
-- SQLite 3.45ï¼šä¸æ”¯æŒRLSï¼Œéœ€è¦åœ¨åº”ç”¨å±‚å®žçŽ°
-- ç¤ºä¾‹ï¼šé€šè¿‡è§†å›¾æ¨¡æ‹ŸRLS
CREATE VIEW my_tenant_data AS
SELECT * FROM tenant_data
WHERE tenant_id = (SELECT value FROM app_settings WHERE key = 'current_tenant_id');

-- SQLite 3.45ï¼šæƒé™æŽ§åˆ¶ï¼ˆæœ‰é™ï¼‰
-- SQLiteä¸æ”¯æŒç»†ç²’åº¦æƒé™ï¼Œéœ€è¦åœ¨åº”ç”¨å±‚å®žçŽ°
```

### 5.3 å®žé™…ä¸šåŠ¡åœºæ™¯æ¡ˆä¾‹

#### åœºæ™¯1ï¼šå¤šç§Ÿæˆ·SaaSç³»ç»Ÿçš„å®‰å…¨éš”ç¦»

**ä¸šåŠ¡èƒŒæ™¯**ï¼š

- å¤šç§Ÿæˆ·SaaSç³»ç»Ÿï¼Œä¸åŒç§Ÿæˆ·æ•°æ®éœ€è¦éš”ç¦»
- éœ€è¦å®žçŽ°éžå¹²æ‰°æ€§ï¼šé«˜å®‰å…¨çº§åˆ«ç§Ÿæˆ·æ•°æ®ä¸å½±å“ä½Žå®‰å…¨çº§åˆ«ç§Ÿæˆ·
- éœ€è¦æ»¡è¶³åˆè§„è¦æ±‚ï¼ˆå¦‚GDPRï¼‰

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- å®žçŽ°æ•°æ®éš”ç¦»
- ä¿è¯éžå¹²æ‰°æ€§
- æ»¡è¶³åˆè§„è¦æ±‚

**PostgreSQL 18å®žçŽ°**ï¼š

```sql
-- åœºæ™¯ï¼šå¤šç§Ÿæˆ·SaaSç³»ç»Ÿå®‰å…¨éš”ç¦»ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
-- 1. åˆ›å»ºå¤šç§Ÿæˆ·è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'customer_data') THEN
            CREATE TABLE customer_data (
                id SERIAL PRIMARY KEY,
                tenant_id INTEGER NOT NULL,
                customer_name VARCHAR(100),
                email VARCHAR(100),
                security_level VARCHAR(20) DEFAULT 'standard',
                created_at TIMESTAMPTZ DEFAULT NOW()
            );
            RAISE NOTICE 'è¡¨ customer_data åˆ›å»ºæˆåŠŸ';
        ELSE
            RAISE NOTICE 'è¡¨ customer_data å·²å­˜åœ¨';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ customer_data å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- 2. å¯ç”¨RLSï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'customer_data') THEN
            RAISE WARNING 'è¡¨ customer_data ä¸å­˜åœ¨ï¼Œæ— æ³•å¯ç”¨RLS';
            RETURN;
        END IF;

        ALTER TABLE customer_data ENABLE ROW LEVEL SECURITY;
        RAISE NOTICE 'è¡¨ customer_data å·²å¯ç”¨è¡Œçº§å®‰å…¨';
    EXCEPTION
        WHEN undefined_table THEN
            RAISE WARNING 'è¡¨ customer_data ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'å¯ç”¨RLSå¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- 3. åˆ›å»ºå®‰å…¨ç­–ç•¥ï¼ˆå®žçŽ°éžå¹²æ‰°æ€§ï¼Œå¸¦é”™è¯¯å¤„ç†ï¼‰
-- æ ‡å‡†å®‰å…¨çº§åˆ«ç­–ç•¥
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'customer_data') THEN
            RAISE WARNING 'è¡¨ customer_data ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºç­–ç•¥';
            RETURN;
        END IF;

        IF EXISTS (SELECT 1 FROM pg_policies WHERE schemaname = 'public' AND tablename = 'customer_data' AND policyname = 'standard_security_policy') THEN
            DROP POLICY standard_security_policy ON customer_data;
        END IF;

        CREATE POLICY standard_security_policy ON customer_data
            FOR ALL
            USING (
                security_level = 'standard' AND
                tenant_id = current_setting('app.current_tenant_id')::INTEGER
            )
            WITH CHECK (
                security_level = 'standard' AND
                tenant_id = current_setting('app.current_tenant_id')::INTEGER
            );
        RAISE NOTICE 'æ ‡å‡†å®‰å…¨çº§åˆ«ç­–ç•¥åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºæ ‡å‡†å®‰å…¨çº§åˆ«ç­–ç•¥å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- é«˜å®‰å…¨çº§åˆ«ç­–ç•¥
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'customer_data') THEN
            RAISE WARNING 'è¡¨ customer_data ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºç­–ç•¥';
            RETURN;
        END IF;

        IF EXISTS (SELECT 1 FROM pg_policies WHERE schemaname = 'public' AND tablename = 'customer_data' AND policyname = 'high_security_policy') THEN
            DROP POLICY high_security_policy ON customer_data;
        END IF;

        CREATE POLICY high_security_policy ON customer_data
            FOR ALL
            USING (
                security_level = 'high' AND
                tenant_id = current_setting('app.current_tenant_id')::INTEGER AND
                current_setting('app.security_level') = 'high'
            )
            WITH CHECK (
                security_level = 'high' AND
                tenant_id = current_setting('app.current_tenant_id')::INTEGER AND
                current_setting('app.security_level') = 'high'
            );
        RAISE NOTICE 'é«˜å®‰å…¨çº§åˆ«ç­–ç•¥åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºé«˜å®‰å…¨çº§åˆ«ç­–ç•¥å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- 4. æµ‹è¯•éžå¹²æ‰°æ€§
-- ç§Ÿæˆ·1ï¼ˆæ ‡å‡†å®‰å…¨çº§åˆ«ï¼‰
SET app.current_tenant_id = '1';
SET app.security_level = 'standard';

INSERT INTO customer_data (tenant_id, customer_name, email, security_level)
VALUES (1, 'Customer A', 'a@example.com', 'standard');

-- ç§Ÿæˆ·2ï¼ˆé«˜å®‰å…¨çº§åˆ«ï¼‰
SET app.current_tenant_id = '2';
SET app.security_level = 'high';

INSERT INTO customer_data (tenant_id, customer_name, email, security_level)
VALUES (2, 'Customer B', 'b@example.com', 'high');

-- ç§Ÿæˆ·1æŸ¥è¯¢ï¼ˆåº”è¯¥çœ‹ä¸åˆ°ç§Ÿæˆ·2çš„é«˜å®‰å…¨çº§åˆ«æ•°æ®ï¼‰
SET app.current_tenant_id = '1';
SET app.security_level = 'standard';
SELECT * FROM customer_data;
-- ç»“æžœï¼šåªè¿”å›žç§Ÿæˆ·1çš„æ ‡å‡†å®‰å…¨çº§åˆ«æ•°æ®
-- å®žçŽ°äº†éžå¹²æ‰°æ€§ï¼šç§Ÿæˆ·2çš„é«˜å®‰å…¨çº§åˆ«æ“ä½œä¸å½±å“ç§Ÿæˆ·1çš„è§‚å¯Ÿ
```

**æ€§èƒ½æ•°æ®**ï¼š

| æŒ‡æ ‡ | æ— RLS | æœ‰RLS | è¯´æ˜Ž |
| :--- | :---- | :---- | :--- |
| **æŸ¥è¯¢æ€§èƒ½** | 10ms | 12ms | RLSå¢žåŠ å°‘é‡å¼€é”€ |
| **æ•°æ®éš”ç¦»** | âŒ æ—  | âœ… å®Œå…¨éš”ç¦» | RLSä¿è¯éš”ç¦» |
| **éžå¹²æ‰°æ€§** | âŒ æ—  | âœ… ä¿è¯ | RLSå®žçŽ°éžå¹²æ‰°æ€§ |

#### åœºæ™¯2ï¼šé‡‘èžç³»ç»Ÿçš„åˆ†çº§å®‰å…¨ç­–ç•¥

**ä¸šåŠ¡èƒŒæ™¯**ï¼š

- é‡‘èžç³»ç»Ÿï¼Œä¸åŒå®‰å…¨çº§åˆ«çš„æ•°æ®éœ€è¦éš”ç¦»
- éœ€è¦å®žçŽ°ä¿¡æ¯æµå®‰å…¨ï¼šé«˜å®‰å…¨çº§åˆ«ä¿¡æ¯ä¸èƒ½æµå‘ä½Žå®‰å…¨çº§åˆ«
- éœ€è¦æ»¡è¶³ç›‘ç®¡è¦æ±‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- å®žçŽ°åˆ†çº§å®‰å…¨
- ä¿è¯ä¿¡æ¯æµå®‰å…¨
- æ»¡è¶³ç›‘ç®¡è¦æ±‚

**PostgreSQL 18å®žçŽ°**ï¼š

```sql
-- åœºæ™¯ï¼šé‡‘èžç³»ç»Ÿåˆ†çº§å®‰å…¨ç­–ç•¥ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
-- 1. åˆ›å»ºåˆ†çº§å®‰å…¨è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'financial_records') THEN
            CREATE TABLE financial_records (
                id SERIAL PRIMARY KEY,
                account_id INTEGER NOT NULL,
                transaction_type VARCHAR(20),
                amount DECIMAL(15,2),
                security_level VARCHAR(20) NOT NULL,  -- 'public', 'internal', 'confidential', 'secret'
                created_at TIMESTAMPTZ DEFAULT NOW()
            );
            RAISE NOTICE 'è¡¨ financial_records åˆ›å»ºæˆåŠŸ';
        ELSE
            RAISE NOTICE 'è¡¨ financial_records å·²å­˜åœ¨';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ financial_records å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- 2. å¯ç”¨RLSï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'financial_records') THEN
            RAISE WARNING 'è¡¨ financial_records ä¸å­˜åœ¨ï¼Œæ— æ³•å¯ç”¨RLS';
            RETURN;
        END IF;

        ALTER TABLE financial_records ENABLE ROW LEVEL SECURITY;
        RAISE NOTICE 'è¡¨ financial_records å·²å¯ç”¨è¡Œçº§å®‰å…¨';
    EXCEPTION
        WHEN undefined_table THEN
            RAISE WARNING 'è¡¨ financial_records ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'å¯ç”¨RLSå¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- 3. åˆ›å»ºåˆ†çº§å®‰å…¨ç­–ç•¥ï¼ˆå®žçŽ°ä¿¡æ¯æµå®‰å…¨ï¼Œå¸¦é”™è¯¯å¤„ç†ï¼‰
-- å…¬å¼€çº§åˆ«ç­–ç•¥
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'financial_records') THEN
            RAISE WARNING 'è¡¨ financial_records ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºç­–ç•¥';
            RETURN;
        END IF;

        IF EXISTS (SELECT 1 FROM pg_policies WHERE schemaname = 'public' AND tablename = 'financial_records' AND policyname = 'public_policy') THEN
            DROP POLICY public_policy ON financial_records;
        END IF;

        CREATE POLICY public_policy ON financial_records
            FOR SELECT
            USING (
                security_level = 'public' AND
                current_setting('app.security_clearance') >= 'public'
            );
        RAISE NOTICE 'å…¬å¼€çº§åˆ«ç­–ç•¥åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºå…¬å¼€çº§åˆ«ç­–ç•¥å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- å†…éƒ¨çº§åˆ«ç­–ç•¥
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'financial_records') THEN
            RAISE WARNING 'è¡¨ financial_records ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºç­–ç•¥';
            RETURN;
        END IF;

        IF EXISTS (SELECT 1 FROM pg_policies WHERE schemaname = 'public' AND tablename = 'financial_records' AND policyname = 'internal_policy') THEN
            DROP POLICY internal_policy ON financial_records;
        END IF;

        CREATE POLICY internal_policy ON financial_records
            FOR SELECT
            USING (
                security_level = 'internal' AND
                current_setting('app.security_clearance') >= 'internal'
            );
        RAISE NOTICE 'å†…éƒ¨çº§åˆ«ç­–ç•¥åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºå†…éƒ¨çº§åˆ«ç­–ç•¥å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- æœºå¯†çº§åˆ«ç­–ç•¥
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'financial_records') THEN
            RAISE WARNING 'è¡¨ financial_records ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºç­–ç•¥';
            RETURN;
        END IF;

        IF EXISTS (SELECT 1 FROM pg_policies WHERE schemaname = 'public' AND tablename = 'financial_records' AND policyname = 'confidential_policy') THEN
            DROP POLICY confidential_policy ON financial_records;
        END IF;

        CREATE POLICY confidential_policy ON financial_records
            FOR SELECT
            USING (
                security_level = 'confidential' AND
                current_setting('app.security_clearance') >= 'confidential'
            );
        RAISE NOTICE 'æœºå¯†çº§åˆ«ç­–ç•¥åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºæœºå¯†çº§åˆ«ç­–ç•¥å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- ç§˜å¯†çº§åˆ«ç­–ç•¥
CREATE POLICY secret_policy ON financial_records
    FOR SELECT
    USING (
        security_level = 'secret' AND
        current_setting('app.security_clearance') >= 'secret'
    );

-- 4. æµ‹è¯•ä¿¡æ¯æµå®‰å…¨
-- æ’å…¥ä¸åŒå®‰å…¨çº§åˆ«çš„æ•°æ®
INSERT INTO financial_records (account_id, transaction_type, amount, security_level)
VALUES
    (1, 'deposit', 1000.00, 'public'),
    (2, 'withdrawal', 500.00, 'internal'),
    (3, 'transfer', 2000.00, 'confidential'),
    (4, 'investment', 10000.00, 'secret');

-- å…¬å¼€çº§åˆ«ç”¨æˆ·æŸ¥è¯¢
SET app.security_clearance = 'public';
SELECT * FROM financial_records;
-- ç»“æžœï¼šåªè¿”å›žå…¬å¼€çº§åˆ«æ•°æ®
-- å®žçŽ°äº†ä¿¡æ¯æµå®‰å…¨ï¼šé«˜å®‰å…¨çº§åˆ«ä¿¡æ¯ä¸æµå‘ä½Žå®‰å…¨çº§åˆ«
```

**æ€§èƒ½æ•°æ®**ï¼š

| æŒ‡æ ‡ | æ— åˆ†çº§å®‰å…¨ | æœ‰åˆ†çº§å®‰å…¨ | è¯´æ˜Ž |
| :--- | :--------- | :--------- | :--- |
| **æŸ¥è¯¢æ€§èƒ½** | 8ms | 10ms | åˆ†çº§å®‰å…¨å¢žåŠ å¼€é”€ |
| **ä¿¡æ¯æµå®‰å…¨** | âŒ æ—  | âœ… ä¿è¯ | åˆ†çº§å®‰å…¨ä¿è¯ä¿¡æ¯æµå®‰å…¨ |
| **åˆè§„æ€§** | âŒ ä¸ç¬¦åˆ | âœ… ç¬¦åˆ | æ»¡è¶³ç›‘ç®¡è¦æ±‚ |

### 5.4 å®‰å…¨ç­–ç•¥é€‰æ‹©æœ€ä½³å®žè·µ

**PostgreSQL 18æœ€ä½³å®žè·µ**ï¼š

```sql
-- 1. å®‰å…¨ç­–ç•¥è®¾è®¡ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
-- ä½¿ç”¨RLSå®žçŽ°è¡Œçº§å®‰å…¨
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'sensitive_data') THEN
            RAISE WARNING 'è¡¨ sensitive_data ä¸å­˜åœ¨ï¼Œæ— æ³•å¯ç”¨RLS';
            RETURN;
        END IF;

        ALTER TABLE sensitive_data ENABLE ROW LEVEL SECURITY;
        RAISE NOTICE 'è¡¨ sensitive_data å·²å¯ç”¨è¡Œçº§å®‰å…¨';
    EXCEPTION
        WHEN undefined_table THEN
            RAISE WARNING 'è¡¨ sensitive_data ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'å¯ç”¨RLSå¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- ä½¿ç”¨RBACå®žçŽ°è§’è‰²æƒé™ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'security_officer') THEN
            CREATE ROLE security_officer;
            RAISE NOTICE 'è§’è‰² security_officer åˆ›å»ºæˆåŠŸ';
        ELSE
            RAISE NOTICE 'è§’è‰² security_officer å·²å­˜åœ¨';
        END IF;
    EXCEPTION
        WHEN duplicate_object THEN
            RAISE WARNING 'è§’è‰² security_officer å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè§’è‰²å¤±è´¥: %', SQLERRM;
            RAISE;
    END;

    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'sensitive_data') THEN
            RAISE WARNING 'è¡¨ sensitive_data ä¸å­˜åœ¨ï¼Œæ— æ³•æŽˆäºˆæƒé™';
            RETURN;
        END IF;
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = 'security_officer') THEN
            RAISE WARNING 'è§’è‰² security_officer ä¸å­˜åœ¨';
            RETURN;
        END IF;

        GRANT SELECT ON sensitive_data TO security_officer;
        RAISE NOTICE 'SELECTæƒé™æŽˆäºˆæˆåŠŸ: sensitive_data -> security_officer';
    EXCEPTION
        WHEN undefined_object THEN
            RAISE WARNING 'è¡¨æˆ–è§’è‰²ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'æŽˆäºˆæƒé™å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- 2. ç»„åˆå®‰å…¨ç­–ç•¥
-- åŒæ—¶ä½¿ç”¨RLSå’ŒRBACå®žçŽ°å¤šå±‚å®‰å…¨
-- RLSï¼šè¡Œçº§éš”ç¦»
-- RBACï¼šè§’è‰²æƒé™

-- 3. æµ‹è¯•éžå¹²æ‰°æ€§
-- å®šæœŸæµ‹è¯•é«˜å®‰å…¨çº§åˆ«æ“ä½œä¸å½±å“ä½Žå®‰å…¨çº§åˆ«è§‚å¯Ÿ

-- 4. ç›‘æŽ§å®‰å…¨ç­–ç•¥ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'sensitive_data') THEN
            RAISE WARNING 'è¡¨ sensitive_data ä¸å­˜åœ¨ï¼Œæ— æ³•æŸ¥è¯¢ç­–ç•¥';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æŸ¥è¯¢RLSç­–ç•¥æ‰§è¡Œæƒ…å†µ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'æŸ¥è¯¢å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT * FROM pg_policies WHERE tablename = 'sensitive_data';

-- 5. å®¡è®¡æ—¥å¿—ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = current_user AND rolsuper = true) THEN
            RAISE EXCEPTION 'éœ€è¦è¶…çº§ç”¨æˆ·æƒé™æ¥ä¿®æ”¹ç³»ç»Ÿé…ç½®';
        END IF;

        ALTER SYSTEM SET log_statement = 'all';
        PERFORM pg_reload_conf();
        RAISE NOTICE 'å®¡è®¡æ—¥å¿—å·²å¯ç”¨ï¼ˆè®°å½•æ‰€æœ‰è¯­å¥ï¼‰';
    EXCEPTION
        WHEN insufficient_privilege THEN
            RAISE WARNING 'éœ€è¦è¶…çº§ç”¨æˆ·æƒé™';
        WHEN OTHERS THEN
            RAISE WARNING 'å¯ç”¨å®¡è®¡æ—¥å¿—å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

### 5.5 æ¨¡åž‹é€‰æ‹©å»ºè®®

**é€‰æ‹©PostgreSQL 18å®‰å…¨ç­–ç•¥çš„åœºæ™¯**ï¼š

âœ… **æŽ¨èåœºæ™¯**ï¼š

- å¤šç§Ÿæˆ·ç³»ç»Ÿ
- éœ€è¦æ•°æ®éš”ç¦»
- éœ€è¦åˆ†çº§å®‰å…¨
- éœ€è¦æ»¡è¶³åˆè§„è¦æ±‚

âŒ **ä¸æŽ¨èåœºæ™¯**ï¼š

- ç®€å•åº”ç”¨
- ä¸éœ€è¦æ•°æ®éš”ç¦»
- å•ç”¨æˆ·ç³»ç»Ÿ

**é€‰æ‹©SQLite 3.45çš„åœºæ™¯**ï¼š

âœ… **æŽ¨èåœºæ™¯**ï¼š

- å•æœºåº”ç”¨
- ä¸éœ€è¦ç»†ç²’åº¦å®‰å…¨
- åº”ç”¨å±‚å®žçŽ°å®‰å…¨

âŒ **ä¸æŽ¨èåœºæ™¯**ï¼š

- å¤šç§Ÿæˆ·ç³»ç»Ÿ
- éœ€è¦RLS
- éœ€è¦åˆ†çº§å®‰å…¨

---

## 6. ç›¸å…³æ–‡æ¡£

### 6.1 ç†è®ºåŸºç¡€æ–‡æ¡£

- [ç†è®ºåŸºç¡€å¯¼èˆª](../README.md)
- [è¡Œçº§å®‰å…¨-RLSç­–ç•¥è¯­ä¹‰ä¸Žä¸å¯é€ƒé€¸æ€§è¯æ˜Ž](./07.03-è¡Œçº§å®‰å…¨-RLSç­–ç•¥è¯­ä¹‰ä¸Žä¸å¯é€ƒé€¸æ€§è¯æ˜Ž.md)
- [æ•°æ®åº“å®‰å…¨æ¨¡åž‹-è®¿é—®æŽ§åˆ¶ä¸Žä¿¡æ¯æµå®‰å…¨çš„å½¢å¼åŒ–](./07.04-æ•°æ®åº“å®‰å…¨æ¨¡åž‹-è®¿é—®æŽ§åˆ¶ä¸Žä¿¡æ¯æµå®‰å…¨çš„å½¢å¼åŒ–.md)

---

## 7. å‚è€ƒæ–‡çŒ®

### 7.1 æ ¸å¿ƒç†è®ºæ–‡çŒ®

- **Goguen, J. A., & Meseguer, J. (1982). "Security Policies and Security Models."**
  - ä¼šè®®: IEEE Symposium on Security and Privacy 1982
  - **é‡è¦æ€§**: å®‰å…¨ç­–ç•¥å’Œæ¨¡åž‹çš„ç»å…¸è®ºæ–‡
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†éžå¹²æ‰°æ€§æ¦‚å¿µ

- **McLean, J. (1994). "A General Theory of Composition for a Class of 'Possibilistic' Properties."**
  - ä¼šè®®: IEEE Transactions on Software Engineering 1994
  - **é‡è¦æ€§**: éžå¹²æ‰°æ€§çš„å½¢å¼åŒ–ç†è®º
  - **æ ¸å¿ƒè´¡çŒ®**: å½¢å¼åŒ–äº†éžå¹²æ‰°æ€§

### 7.2 PostgreSQLå®žçŽ°ç›¸å…³

- **[PostgreSQLå®˜æ–¹æ–‡æ¡£ - å®‰å…¨](<https://www.postgresql.org/docs/current/security.html>)**
  - PostgreSQLå®‰å…¨å®žçŽ°è¯´æ˜Ž

### 7.3 ç›¸å…³æ–‡æ¡£

- [ç†è®ºåŸºç¡€å¯¼èˆª](../README.md)
- [è¡Œçº§å®‰å…¨-RLSç­–ç•¥è¯­ä¹‰ä¸Žä¸å¯é€ƒé€¸æ€§è¯æ˜Ž](./07.03-è¡Œçº§å®‰å…¨-RLSç­–ç•¥è¯­ä¹‰ä¸Žä¸å¯é€ƒé€¸æ€§è¯æ˜Ž.md)
- [æ•°æ®åº“å®‰å…¨æ¨¡åž‹-è®¿é—®æŽ§åˆ¶ä¸Žä¿¡æ¯æµå®‰å…¨çš„å½¢å¼åŒ–](./07.04-æ•°æ®åº“å®‰å…¨æ¨¡åž‹-è®¿é—®æŽ§åˆ¶ä¸Žä¿¡æ¯æµå®‰å…¨çš„å½¢å¼åŒ–.md)

---

**æœ€åŽæ›´æ–°**: 2025-01-16
**ç»´æŠ¤è€…**: Documentation Team
**çŠ¶æ€**: âœ… å†…å®¹å·²æ·±åŒ–ï¼ŒåŒ…å«å®Œæ•´è¯æ˜Žã€åœºæ™¯æ¡ˆä¾‹å’ŒPostgreSQL 18/SQLiteå¯¹æ¯”
