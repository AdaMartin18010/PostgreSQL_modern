# 安全事件响应

> **创建日期**: 2025年1月
> **技术版本**: PostgreSQL 17+/18+
> **难度等级**: ⭐⭐⭐ 中级

---

## 📋 目录

- [安全事件响应](#安全事件响应)
  - [📋 目录](#-目录)
  - [1. 概述](#1-概述)
  - [2. 事件分类](#2-事件分类)
    - [2.1 事件类型](#21-事件类型)
    - [2.2 事件严重程度](#22-事件严重程度)
  - [3. 响应流程](#3-响应流程)
    - [3.1 响应步骤](#31-响应步骤)
    - [3.2 响应团队](#32-响应团队)
  - [4. 事件处理](#4-事件处理)
    - [4.1 立即响应](#41-立即响应)
    - [4.2 数据保护](#42-数据保护)
    - [4.3 日志分析](#43-日志分析)
  - [5. 事件恢复](#5-事件恢复)
    - [5.1 系统恢复](#51-系统恢复)
    - [5.2 预防措施](#52-预防措施)
  - [6. 最佳实践](#6-最佳实践)
    - [✅ 推荐做法](#-推荐做法)
    - [❌ 避免做法](#-避免做法)
  - [📚 相关文档](#-相关文档)

---

## 1. 概述

安全事件响应是PostgreSQL安全的重要组成部分。包括：

- **事件检测** - 发现安全事件
- **事件分析** - 分析事件原因和影响
- **事件处理** - 处理安全事件
- **事件恢复** - 恢复系统正常状态

---

## 2. 事件分类

### 2.1 事件类型

| 类型 | 说明 | 严重程度 |
|------|------|---------|
| **数据泄露** | 未授权数据访问 | 严重 |
| **权限提升** | 未授权权限获取 | 严重 |
| **拒绝服务** | 系统不可用 | 高 |
| **恶意代码** | SQL注入、恶意脚本 | 严重 |
| **配置错误** | 安全配置错误 | 中 |

### 2.2 事件严重程度

| 级别 | 说明 | 响应时间 |
|------|------|---------|
| **P0** | 数据泄露、系统被攻破 | 立即 |
| **P1** | 严重安全威胁 | 1小时内 |
| **P2** | 中等安全威胁 | 4小时内 |
| **P3** | 低风险事件 | 24小时内 |

---

## 3. 响应流程

### 3.1 响应步骤

```
1. 事件检测
   ↓
2. 事件确认
   ↓
3. 事件分析
   ↓
4. 事件处理
   ↓
5. 事件恢复
   ↓
6. 事件总结
```

### 3.2 响应团队

- **安全团队** - 负责事件分析和处理
- **DBA团队** - 负责数据库操作
- **开发团队** - 负责应用修复
- **管理层** - 负责决策和沟通

---

## 4. 事件处理

### 4.1 立即响应

```sql
-- 1. 断开可疑连接
SELECT pg_terminate_backend(pid)
FROM pg_stat_activity
WHERE usename = 'suspicious_user';

-- 2. 禁用可疑用户
ALTER USER suspicious_user WITH NOLOGIN;

-- 3. 撤销可疑权限
REVOKE ALL PRIVILEGES ON DATABASE mydb FROM suspicious_user;

-- 4. 检查异常活动
SELECT * FROM pg_stat_activity
WHERE state = 'active'
ORDER BY query_start;
```

### 4.2 数据保护

```sql
-- 1. 备份当前状态
pg_dump -Fc mydb > incident_backup.dump

-- 2. 检查数据完整性
SELECT COUNT(*) FROM sensitive_table;

-- 3. 检查最近的数据变更
SELECT * FROM audit_log
WHERE timestamp >= NOW() - INTERVAL '24 hours'
ORDER BY timestamp DESC;
```

### 4.3 日志分析

```sql
-- 分析审计日志
SELECT
    user_name,
    table_name,
    operation,
    COUNT(*) AS count
FROM audit_log
WHERE timestamp >= NOW() - INTERVAL '24 hours'
GROUP BY user_name, table_name, operation
ORDER BY count DESC;

-- 查找异常IP
SELECT DISTINCT ip_address
FROM audit_log
WHERE timestamp >= NOW() - INTERVAL '24 hours';
```

---

## 5. 事件恢复

### 5.1 系统恢复

```sql
-- 1. 修复安全漏洞
-- 2. 恢复数据（如需要）
-- 3. 重新启用服务
-- 4. 验证系统正常
```

### 5.2 预防措施

```sql
-- 1. 加强安全配置
-- 2. 更新补丁
-- 3. 加强监控
-- 4. 培训团队
```

---

## 6. 最佳实践

### ✅ 推荐做法

1. **建立响应流程** - 制定标准响应流程
2. **定期演练** - 定期进行安全演练
3. **快速响应** - 根据严重程度快速响应
4. **详细记录** - 记录所有事件和处理过程
5. **持续改进** - 从事件中学习改进

### ❌ 避免做法

1. **忽视事件** - 安全事件必须处理
2. **不记录** - 无法分析和改进
3. **不沟通** - 需要及时沟通
4. **不恢复** - 事件后必须恢复系统

---

## 📚 相关文档

- [PostgreSQL安全加固完整指南.md](./PostgreSQL安全加固完整指南.md) - 完整加固指南
- [安全加固清单.md](./安全加固清单.md) - 安全检查清单
- [安全审计指南.md](./安全审计指南.md) - 审计指南
- [05-安全与合规/README.md](../README.md) - 安全与合规主题

---

**最后更新**: 2025年1月
