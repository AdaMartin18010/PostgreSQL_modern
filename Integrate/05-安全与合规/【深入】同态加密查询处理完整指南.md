---

> **ğŸ“‹ æ–‡æ¡£æ¥æº**: `PostgreSQLåŸ¹è®­\07-å®‰å…¨\ã€æ·±å…¥ã€‘åŒæ€åŠ å¯†æŸ¥è¯¢å¤„ç†å®Œæ•´æŒ‡å—.md`
> **ğŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŸæ–‡ä»¶ä¿æŒä¸å˜

---

# åŒæ€åŠ å¯†æŸ¥è¯¢å¤„ç†å®Œæ•´æŒ‡å—

> **åˆ›å»ºæ—¶é—´**: 2025 å¹´ 12 æœˆ 4 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 18+ with Homomorphic Encryption
> **æ–‡æ¡£ç¼–å·**: 07-SEC-HE

---

## ğŸ“‘ ç›®å½•

- [1.1 ä»€ä¹ˆæ˜¯åŒæ€åŠ å¯†](#11-ä»€ä¹ˆæ˜¯åŒæ€åŠ å¯†)
- [1.2 ä¸ºä»€ä¹ˆéœ€è¦å¯†æ–‡æŸ¥è¯¢](#12-ä¸ºä»€ä¹ˆéœ€è¦å¯†æ–‡æŸ¥è¯¢)
- [1.3 æ ¸å¿ƒä»·å€¼](#13-æ ¸å¿ƒä»·å€¼)
- [1.4 çŸ¥è¯†ä½“ç³»æ€ç»´å¯¼å›¾](#14-çŸ¥è¯†ä½“ç³»æ€ç»´å¯¼å›¾)
- [2.1 åŒæ€åŠ å¯†ç†è®ºåŸºç¡€](#21-åŒæ€åŠ å¯†ç†è®ºåŸºç¡€)
- [2.2 åŠ å¯†æ–¹æ¡ˆå¯¹æ¯”](#22-åŠ å¯†æ–¹æ¡ˆå¯¹æ¯”)
- [2.3 å¯†æ–‡è®¡ç®—åŸç†](#23-å¯†æ–‡è®¡ç®—åŸç†)
- [2.4 å‰æ²¿ç ”ç©¶ Enc2DB](#24-å‰æ²¿ç ”ç©¶-enc2db)
- [3.1 æ•´ä½“æ¶æ„](#31-æ•´ä½“æ¶æ„)
- [3.2 åŠ å¯†æ•°æ®å­˜å‚¨](#32-åŠ å¯†æ•°æ®å­˜å‚¨)
- [3.3 å¯†æ–‡æŸ¥è¯¢å¤„ç†](#33-å¯†æ–‡æŸ¥è¯¢å¤„ç†)
- [3.4 å¯†é’¥ç®¡ç†](#34-å¯†é’¥ç®¡ç†)
- [4.1 ç¯å¢ƒå‡†å¤‡](#41-ç¯å¢ƒå‡†å¤‡)
- [4.2 åŸºç¡€åŠ å¯†æ“ä½œ](#42-åŸºç¡€åŠ å¯†æ“ä½œ)
- [4.3 å¯†æ–‡æŸ¥è¯¢å®ç°](#43-å¯†æ–‡æŸ¥è¯¢å®ç°)
- [4.4 æ··åˆåŠ å¯†æ–¹æ¡ˆ](#44-æ··åˆåŠ å¯†æ–¹æ¡ˆ)
- [5.1 æ€§èƒ½ä¼˜åŒ–](#51-æ€§èƒ½ä¼˜åŒ–)
- [5.2 å¯†é’¥ç®¡ç†](#52-å¯†é’¥ç®¡ç†)
- [5.3 ç›‘æ§ä¸å®¡è®¡](#53-ç›‘æ§ä¸å®¡è®¡)
- [5.4 æœ€ä½³å®è·µ](#54-æœ€ä½³å®è·µ)
- [6.1 é‡‘èæ•°æ®åŠ å¯†æŸ¥è¯¢](#61-é‡‘èæ•°æ®åŠ å¯†æŸ¥è¯¢)
- [6.2 åŒ»ç–—æ•°æ®éšç§ä¿æŠ¤](#62-åŒ»ç–—æ•°æ®éšç§ä¿æŠ¤)
- [6.3 äº‘ç«¯æ•°æ®å®‰å…¨](#63-äº‘ç«¯æ•°æ®å®‰å…¨)
- [7.1 æ€§èƒ½æµ‹è¯•æ¦‚è¿°](#71-æ€§èƒ½æµ‹è¯•æ¦‚è¿°)
- [7.2 åŸºå‡†æµ‹è¯•è„šæœ¬](#72-åŸºå‡†æµ‹è¯•è„šæœ¬)
- [7.3 æ€§èƒ½æµ‹è¯•ç»“æœ](#73-æ€§èƒ½æµ‹è¯•ç»“æœ)
- [7.4 æ€§èƒ½ä¼˜åŒ–å»ºè®®](#74-æ€§èƒ½ä¼˜åŒ–å»ºè®®)
- [7.5 æ€§èƒ½æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿](#75-æ€§èƒ½æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿)
- [æ’å…¥æ€§èƒ½](#æ’å…¥æ€§èƒ½)
- [æŸ¥è¯¢æ€§èƒ½](#æŸ¥è¯¢æ€§èƒ½)
- [èšåˆæ€§èƒ½](#èšåˆæ€§èƒ½)
- [7.6 æ€§èƒ½ç›‘æ§æŒ‡æ ‡](#76-æ€§èƒ½ç›‘æ§æŒ‡æ ‡)
- [8.1 æ ¸å¿ƒæ”¶è·](#81-æ ¸å¿ƒæ”¶è·)
- [8.2 é€‚ç”¨åœºæ™¯](#82-é€‚ç”¨åœºæ™¯)
- [8.3 æŠ€æœ¯å‘å±•è¶‹åŠ¿](#83-æŠ€æœ¯å‘å±•è¶‹åŠ¿)
- [8.4 æœªæ¥å±•æœ›](#84-æœªæ¥å±•æœ›)
- [8.5 å¸¸è§é—®é¢˜è§£ç­”ï¼ˆFAQï¼‰](#85-å¸¸è§é—®é¢˜è§£ç­”faq)
- [8.6 æœ€ä½³å®è·µæ€»ç»“](#86-æœ€ä½³å®è·µæ€»ç»“)
- [8.7 å­¦ä¹ è·¯å¾„å»ºè®®](#87-å­¦ä¹ è·¯å¾„å»ºè®®)
- [8.8 æ€»ç»“](#88-æ€»ç»“)
- [9.1 å­¦æœ¯è®ºæ–‡](#91-å­¦æœ¯è®ºæ–‡)
- [9.2 å¼€æºåº“å’Œå·¥å…·](#92-å¼€æºåº“å’Œå·¥å…·)
- [9.3 æ•™ç¨‹å’Œæ–‡æ¡£](#93-æ•™ç¨‹å’Œæ–‡æ¡£)
- [9.4 æ ‡å‡†å’Œè§„èŒƒ](#94-æ ‡å‡†å’Œè§„èŒƒ)
- [9.5 ç›¸å…³é¡¹ç›®å’Œæ¡ˆä¾‹](#95-ç›¸å…³é¡¹ç›®å’Œæ¡ˆä¾‹)
- [9.6 åœ¨çº¿å·¥å…·å’Œè®¡ç®—å™¨](#96-åœ¨çº¿å·¥å…·å’Œè®¡ç®—å™¨)
- [9.7 ç¤¾åŒºå’Œè®ºå›](#97-ç¤¾åŒºå’Œè®ºå›)
- [9.8 ä¹¦ç±æ¨è](#98-ä¹¦ç±æ¨è)
- [9.9 è§†é¢‘æ•™ç¨‹](#99-è§†é¢‘æ•™ç¨‹)
- [9.10 ç ”ç©¶æœºæ„å’Œå®éªŒå®¤](#910-ç ”ç©¶æœºæ„å’Œå®éªŒå®¤)
---

## ä¸€ã€æ¦‚è¿°

### 1.1 ä»€ä¹ˆæ˜¯åŒæ€åŠ å¯†

**åŒæ€åŠ å¯†**ï¼ˆHomomorphic Encryption, HEï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„åŠ å¯†æŠ€æœ¯ï¼Œå…è®¸å¯¹å¯†æ–‡è¿›è¡Œè®¡ç®—ï¼Œè®¡ç®—ç»“æœè§£å¯†åç­‰åŒäºå¯¹æ˜æ–‡è¿›è¡Œç›¸åŒè®¡ç®—ã€‚

**æ ¸å¿ƒç‰¹æ€§**ï¼š

```text
æ˜æ–‡è®¡ç®—ï¼š  f(x) = y
å¯†æ–‡è®¡ç®—ï¼š  f(E(x)) = E(y)
è§£å¯†éªŒè¯ï¼š  D(E(y)) = y = f(x)

å…¶ä¸­ï¼šE() = åŠ å¯†å‡½æ•°, D() = è§£å¯†å‡½æ•°, f() = è®¡ç®—å‡½æ•°
```

**ç®€å•ç¤ºä¾‹**ï¼š

```python
# RSAåŒæ€ä¹˜æ³•ï¼ˆéƒ¨åˆ†åŒæ€ï¼‰
# E(xâ‚) Ã— E(xâ‚‚) = E(xâ‚ Ã— xâ‚‚)

from Crypto.PublicKey import RSA

# ç”Ÿæˆå¯†é’¥
key = RSA.generate(2048)
public_key = key.publickey()

# åŠ å¯†ä¸¤ä¸ªæ•°
x1, x2 = 5, 7
c1 = pow(x1, public_key.e, public_key.n)  # E(5)
c2 = pow(x2, public_key.e, public_key.n)  # E(7)

# å¯†æ–‡ä¹˜æ³•
c_result = (c1 * c2) % public_key.n  # E(5) Ã— E(7) = E(35)

# è§£å¯†
result = pow(c_result, key.d, key.n)  # D(E(35)) = 35
print(f"{x1} Ã— {x2} = {result}")  # è¾“å‡º: 5 Ã— 7 = 35
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å¯†æ–‡æŸ¥è¯¢

**ä¼ ç»Ÿæ•°æ®åº“çš„å®‰å…¨é£é™©**ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ä¼ ç»Ÿæ•°æ®åº“çš„å®‰å…¨æŒ‘æˆ˜                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                            â”‚
â”‚  é£é™©1ï¼šæ•°æ®åº“ç®¡ç†å‘˜å¯ä»¥è®¿é—®æ‰€æœ‰æ•°æ®          â”‚
â”‚  é£é™©2ï¼šæ•°æ®åº“æœåŠ¡å™¨è¢«å…¥ä¾µ                   â”‚
â”‚  é£é™©3ï¼šäº‘ç¯å¢ƒä¸‹çš„æ•°æ®ä¸»æƒé—®é¢˜               â”‚
â”‚  é£é™©4ï¼šå¤‡ä»½æ•°æ®çš„æ³„éœ²é£é™©                   â”‚
â”‚  é£é™©5ï¼šç¬¬ä¸‰æ–¹æœåŠ¡å•†çš„ä¿¡ä»»é—®é¢˜               â”‚
â”‚                                            â”‚
â”‚  ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆï¼š                             â”‚
â”‚  âŒ è®¿é—®æ§åˆ¶ - å†…éƒ¨äººå‘˜ä»å¯è®¿é—®              â”‚
â”‚  âŒ ä¼ è¾“åŠ å¯† - æ•°æ®åº“å†…ä»æ˜¯æ˜æ–‡              â”‚
â”‚  âŒ ç£ç›˜åŠ å¯† - è¿è¡Œæ—¶è§£å¯†åæ˜¯æ˜æ–‡            â”‚
â”‚                                            â”‚
â”‚  åŒæ€åŠ å¯†æ–¹æ¡ˆï¼š                             â”‚
â”‚  âœ… æ•°æ®å§‹ç»ˆåŠ å¯† - å³ä½¿DBAä¹Ÿæ— æ³•è¯»å–         â”‚
â”‚  âœ… å¯†æ–‡æŸ¥è¯¢ - æ— éœ€è§£å¯†å³å¯è®¡ç®—              â”‚
â”‚  âœ… é›¶ä¿¡ä»»æ¶æ„ - ä¸ä¿¡ä»»ä»»ä½•ä¸­é—´æ–¹            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åº”ç”¨åœºæ™¯**ï¼š

- ğŸ¥ **åŒ»ç–—**: ç—…å†æ•°æ®ã€åŸºå› æ•°æ®
- ğŸ’° **é‡‘è**: äº¤æ˜“æ•°æ®ã€å®¢æˆ·ä¿¡æ¯
- ğŸ›ï¸ **æ”¿åŠ¡**: å…¬æ°‘æ•°æ®ã€æ•æ„Ÿä¿¡æ¯
- â˜ï¸ **äº‘è®¡ç®—**: å¤šç§Ÿæˆ·æ•°æ®éš”ç¦»
- ğŸ” **åˆè§„**: GDPRã€HIPAAã€ç­‰ä¿2.0

### 1.3 æ ¸å¿ƒä»·å€¼

| ç»´åº¦ | ä¼ ç»ŸåŠ å¯† | åŒæ€åŠ å¯† |
|------|---------|---------|
| **æ•°æ®å­˜å‚¨** | åŠ å¯† | åŠ å¯† |
| **ä¼ è¾“** | åŠ å¯† | åŠ å¯† |
| **å¤„ç†** | âŒ éœ€è¦è§£å¯† | âœ… å¯†æ–‡è®¡ç®— |
| **DBAå¯è§æ€§** | âœ… å¯è§ | âŒ ä¸å¯è§ |
| **å®‰å…¨æ€§** | â­â­â­ | â­â­â­â­â­ |
| **æ€§èƒ½** | â­â­â­â­â­ | â­â­ |
| **å¤æ‚åº¦** | â­â­ | â­â­â­â­ |

**æƒè¡¡è€ƒè™‘**ï¼š

- âœ… **æé«˜å®‰å…¨æ€§**: æ•°æ®å§‹ç»ˆåŠ å¯†
- âŒ **æ€§èƒ½å¼€é”€**: è®¡ç®—æ…¢10-1000å€
- âŒ **åŠŸèƒ½é™åˆ¶**: ä¸æ˜¯æ‰€æœ‰æ“ä½œéƒ½æ”¯æŒ
- âœ… **é›¶ä¿¡ä»»**: é€‚åˆé«˜å®‰å…¨åœºæ™¯

### 1.4 çŸ¥è¯†ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((åŒæ€åŠ å¯†æŸ¥è¯¢))
    åŸç†ä¸ç†è®º
      åŠ å¯†ç†è®º
        éƒ¨åˆ†åŒæ€
        å…¨åŒæ€
        å®ç”¨åŒæ€
      æ•°å­¦åŸºç¡€
        ç¾¤è®º
        æ ¼ç†è®º
        RLWEé—®é¢˜
      å¯†æ–‡è®¡ç®—
        åŠ æ³•
        ä¹˜æ³•
        æ¯”è¾ƒ
      å‰æ²¿ç ”ç©¶
        Enc2DBæ¡†æ¶
        CryptDB
        SEALåº“
    æ¶æ„è®¾è®¡
      æ•´ä½“æ¶æ„
        å®¢æˆ·ç«¯
        ä»£ç†å±‚
        æ•°æ®åº“å±‚
      åŠ å¯†å­˜å‚¨
        åˆ—çº§åŠ å¯†
        è¡Œçº§åŠ å¯†
        ç´¢å¼•åŠ å¯†
      æŸ¥è¯¢å¤„ç†
        æŸ¥è¯¢æ”¹å†™
        å¯†æ–‡è®¡ç®—
        ç»“æœè§£å¯†
      å¯†é’¥ç®¡ç†
        å¯†é’¥ç”Ÿæˆ
        å¯†é’¥åˆ†å‘
        å¯†é’¥è½®æ¢
    ç¨‹åºè®¾è®¡
      åŠ å¯†åº“
        Python Paillier
        Microsoft SEAL
        HElib
      åŸºç¡€æ“ä½œ
        åŠ å¯†
        è§£å¯†
        å¯†æ–‡è®¡ç®—
      æŸ¥è¯¢å®ç°
        ç­‰å€¼æŸ¥è¯¢
        èŒƒå›´æŸ¥è¯¢
        èšåˆæŸ¥è¯¢
      æ··åˆæ–¹æ¡ˆ
        ç¡®å®šæ€§åŠ å¯†
        éšæœºåŠ å¯†
        OPEé¡ºåºä¿æŒ
    è¿ç»´ç®¡ç†
      æ€§èƒ½ä¼˜åŒ–
        æ‰¹é‡æ“ä½œ
        ç¡¬ä»¶åŠ é€Ÿ
        æŸ¥è¯¢ä¼˜åŒ–
      å¯†é’¥ç®¡ç†
        KMSé›†æˆ
        å®šæœŸè½®æ¢
        å¤‡ä»½æ¢å¤
      ç›‘æ§å®¡è®¡
        åŠ å¯†æ“ä½œæ—¥å¿—
        æ€§èƒ½ç›‘æ§
        å®‰å…¨å®¡è®¡
    æ¡ˆä¾‹å®æˆ˜
      é‡‘èæ•°æ®
        è´¦æˆ·ä½™é¢
        äº¤æ˜“è®°å½•
        é£æ§åˆ†æ
      åŒ»ç–—æ•°æ®
        ç—…å†åŠ å¯†
        ç»Ÿè®¡åˆ†æ
        éšç§ä¿æŠ¤
      äº‘ç«¯å®‰å…¨
        å¤šç§Ÿæˆ·éš”ç¦»
        æ•°æ®ä¸»æƒ
        åˆè§„æ€§
```

---

## äºŒã€åŸç†ä¸ç†è®º

### 2.1 åŒæ€åŠ å¯†ç†è®ºåŸºç¡€

#### **ä¸‰ç±»åŒæ€åŠ å¯†**

**1. éƒ¨åˆ†åŒæ€åŠ å¯†ï¼ˆPHE - Partially Homomorphic Encryptionï¼‰**:

æ”¯æŒå•ä¸€è¿ç®—ï¼ˆåŠ æ³•æˆ–ä¹˜æ³•ï¼‰ã€‚

```python
# RSA - æ”¯æŒä¹˜æ³•åŒæ€
# E(mâ‚) Ã— E(mâ‚‚) = E(mâ‚ Ã— mâ‚‚)

# Paillier - æ”¯æŒåŠ æ³•åŒæ€
# E(mâ‚) + E(mâ‚‚) = E(mâ‚ + mâ‚‚)

from phe import paillier

# PaillieråŠ æ³•åŒæ€ç¤ºä¾‹
public_key, private_key = paillier.generate_paillier_keypair()

# åŠ å¯†
m1, m2 = 100, 50
c1 = public_key.encrypt(m1)  # E(100)
c2 = public_key.encrypt(m2)  # E(50)

# å¯†æ–‡åŠ æ³•
c_sum = c1 + c2  # E(100) + E(50) = E(150)

# è§£å¯†
result = private_key.decrypt(c_sum)  # D(E(150)) = 150
print(f"{m1} + {m2} = {result}")  # 100 + 50 = 150

# æ ‡é‡ä¹˜æ³•
c_mul = c1 * 3  # E(100) Ã— 3 = E(300)
result = private_key.decrypt(c_mul)
print(f"{m1} Ã— 3 = {result}")  # 100 Ã— 3 = 300
```

**åº”ç”¨**ï¼š

- âœ… åŠ æ³•ï¼šæ±‚å’Œã€è®¡æ•°
- âœ… æ ‡é‡ä¹˜æ³•ï¼šåŠ æƒæ±‚å’Œ
- âŒ ä¹˜æ³•ã€é™¤æ³•ã€æ¯”è¾ƒï¼šä¸æ”¯æŒ

**2. å…¨åŒæ€åŠ å¯†ï¼ˆFHE - Fully Homomorphic Encryptionï¼‰**:

æ”¯æŒä»»æ„è®¡ç®—ï¼ˆåŠ æ³•å’Œä¹˜æ³•çš„ä»»æ„ç»„åˆï¼‰ã€‚

```python
# ä½¿ç”¨Microsoft SEALåº“ï¼ˆC++/Pythonï¼‰
import seal

# é…ç½®å‚æ•°
parms = seal.EncryptionParameters(seal.scheme_type.bfv)
poly_modulus_degree = 4096
parms.set_poly_modulus_degree(poly_modulus_degree)
parms.set_coeff_modulus(seal.CoeffModulus.BFVDefault(poly_modulus_degree))
parms.set_plain_modulus(1024)

# ç”Ÿæˆå¯†é’¥
context = seal.SEALContext(parms)
keygen = seal.KeyGenerator(context)
public_key = keygen.create_public_key()
secret_key = keygen.secret_key()

# åŠ å¯†å™¨å’Œè§£å¯†å™¨
encryptor = seal.Encryptor(context, public_key)
decryptor = seal.Decryptor(context, secret_key)
evaluator = seal.Evaluator(context)

# åŠ å¯†
plaintext1 = seal.Plaintext("5")
plaintext2 = seal.Plaintext("7")
encrypted1 = seal.Ciphertext()
encrypted2 = seal.Ciphertext()
encryptor.encrypt(plaintext1, encrypted1)
encryptor.encrypt(plaintext2, encrypted2)

# å¯†æ–‡åŠ æ³•
encrypted_sum = seal.Ciphertext()
evaluator.add(encrypted1, encrypted2, encrypted_sum)

# å¯†æ–‡ä¹˜æ³•
encrypted_product = seal.Ciphertext()
evaluator.multiply(encrypted1, encrypted2, encrypted_product)
```

**åº”ç”¨**ï¼š

- âœ… ä»»æ„SQLæŸ¥è¯¢ï¼ˆç†è®ºä¸Šï¼‰
- âŒ æ€§èƒ½å¼€é”€æå¤§ï¼ˆ100-1000å€ï¼‰
- âš ï¸ å®é™…åº”ç”¨å—é™

**3. å®ç”¨åŒæ€åŠ å¯†ï¼ˆSomewhat/Leveled HEï¼‰**:

æ”¯æŒæœ‰é™æ¬¡æ•°çš„åŠ æ³•å’Œä¹˜æ³•ã€‚

```python
# é™åˆ¶ä¹˜æ³•æ·±åº¦ï¼ˆmultiplicative depthï¼‰
# ä¾‹å¦‚ï¼šå¯ä»¥è¿›è¡Œ10æ¬¡åŠ æ³• + 3æ¬¡ä¹˜æ³•
```

### 2.2 åŠ å¯†æ–¹æ¡ˆå¯¹æ¯”

åŠ å¯†æ–¹æ¡ˆå¯¹æ¯”æ˜¯é€‰æ‹©åˆé€‚åŠ å¯†æ–¹æ¡ˆçš„é‡è¦ä¾æ®ã€‚ä¸åŒçš„åŠ å¯†æ–¹æ¡ˆæ”¯æŒä¸åŒçš„è¿ç®—ç±»å‹ï¼Œå…·æœ‰ä¸åŒçš„æ€§èƒ½å’Œå®‰å…¨æ€§ç‰¹å¾ã€‚æœ¬èŠ‚è¯¦ç»†å¯¹æ¯”å„ç§åŠ å¯†æ–¹æ¡ˆçš„ç‰¹ç‚¹å’Œé€‚ç”¨åœºæ™¯ã€‚

**åŠ å¯†æ–¹æ¡ˆå¯¹æ¯”è¡¨**ï¼š

| æ–¹æ¡ˆ | æ”¯æŒè¿ç®— | æ€§èƒ½ | å®‰å…¨æ€§ | é€‚ç”¨åœºæ™¯ | è¯¦ç»†è¯´æ˜ |
|------|---------|------|--------|---------|---------|
| **AES** | æ—  | â­â­â­â­â­ | â­â­â­â­ | ä¼ è¾“ã€å­˜å‚¨ | æ ‡å‡†å¯¹ç§°åŠ å¯†ï¼Œæ€§èƒ½æœ€ä¼˜ï¼Œä½†ä¸æ”¯æŒå¯†æ–‡è®¡ç®— |
| **ç¡®å®šæ€§åŠ å¯†** | ç­‰å€¼æ¯”è¾ƒ | â­â­â­â­â­ | â­â­ | ç´¢å¼•æŸ¥è¯¢ | ç›¸åŒæ˜æ–‡äº§ç”Ÿç›¸åŒå¯†æ–‡ï¼Œæ”¯æŒç­‰å€¼æŸ¥è¯¢ï¼Œä½†å®‰å…¨æ€§è¾ƒä½ |
| **OPEé¡ºåºä¿æŒ** | èŒƒå›´æŸ¥è¯¢ | â­â­â­â­ | â­â­ | æ’åºã€èŒƒå›´ | ä¿æŒæ˜æ–‡é¡ºåºï¼Œæ”¯æŒèŒƒå›´æŸ¥è¯¢å’Œæ’åºï¼Œä½†å®‰å…¨æ€§è¾ƒä½ |
| **Paillier** | åŠ æ³• | â­â­â­ | â­â­â­â­ | æ±‚å’Œã€ç»Ÿè®¡ | æ”¯æŒåŠ æ³•åŒæ€ï¼Œé€‚åˆèšåˆæŸ¥è¯¢ï¼Œæ€§èƒ½å¼€é”€ä¸­ç­‰ |
| **BFV/BGV** | åŠ æ³•+ä¹˜æ³• | â­â­ | â­â­â­â­â­ | å¤æ‚è®¡ç®— | å…¨åŒæ€åŠ å¯†ï¼Œæ”¯æŒä»»æ„è®¡ç®—ï¼Œä½†æ€§èƒ½å¼€é”€å¤§ |
| **CKKS** | è¿‘ä¼¼æµ®ç‚¹ | â­â­ | â­â­â­â­â­ | æœºå™¨å­¦ä¹  | æ”¯æŒæµ®ç‚¹æ•°è®¡ç®—ï¼Œé€‚åˆæœºå™¨å­¦ä¹ åœºæ™¯ï¼Œæ€§èƒ½å¼€é”€å¤§ |

**è¯¦ç»†å¯¹æ¯”åˆ†æ**ï¼š

**1. AESï¼ˆAdvanced Encryption Standardï¼‰**

- **ç‰¹ç‚¹**ï¼šæ ‡å‡†å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œæ€§èƒ½æœ€ä¼˜
- **æ”¯æŒè¿ç®—**ï¼šä¸æ”¯æŒå¯†æ–‡è®¡ç®—ï¼Œéœ€è¦è§£å¯†åæ‰èƒ½è®¡ç®—
- **æ€§èƒ½**ï¼šåŠ å¯†/è§£å¯†é€Ÿåº¦å¿«ï¼Œæ€§èƒ½å¼€é”€æœ€å°ï¼ˆ<1%ï¼‰
- **å®‰å…¨æ€§**ï¼šå®‰å…¨æ€§é«˜ï¼Œä½†éœ€è¦å¯†é’¥ç®¡ç†
- **é€‚ç”¨åœºæ™¯**ï¼š
  - æ•°æ®ä¼ è¾“åŠ å¯†
  - æ•°æ®å­˜å‚¨åŠ å¯†
  - ä¸éœ€è¦å¯†æ–‡è®¡ç®—çš„åœºæ™¯
- **é™åˆ¶**ï¼šä¸æ”¯æŒå¯†æ–‡æŸ¥è¯¢ï¼Œéœ€è¦è§£å¯†åæ‰èƒ½å¤„ç†

**2. ç¡®å®šæ€§åŠ å¯†ï¼ˆDeterministic Encryptionï¼‰**

- **ç‰¹ç‚¹**ï¼šç›¸åŒæ˜æ–‡äº§ç”Ÿç›¸åŒå¯†æ–‡ï¼Œæ”¯æŒç­‰å€¼æ¯”è¾ƒ
- **æ”¯æŒè¿ç®—**ï¼šç­‰å€¼æ¯”è¾ƒï¼ˆ=, !=, INï¼‰
- **æ€§èƒ½**ï¼šæ€§èƒ½å¼€é”€å°ï¼ˆ2-3xï¼‰ï¼Œæ”¯æŒç´¢å¼•
- **å®‰å…¨æ€§**ï¼šå®‰å…¨æ€§è¾ƒä½ï¼Œå®¹æ˜“å—åˆ°é¢‘ç‡åˆ†ææ”»å‡»
- **é€‚ç”¨åœºæ™¯**ï¼š
  - ç­‰å€¼æŸ¥è¯¢
  - ç´¢å¼•æŸ¥è¯¢
  - éœ€è¦å¿«é€ŸæŸ¥è¯¢çš„åœºæ™¯
- **é™åˆ¶**ï¼šä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢å’Œèšåˆè®¡ç®—

**3. OPEé¡ºåºä¿æŒåŠ å¯†ï¼ˆOrder-Preserving Encryptionï¼‰**

- **ç‰¹ç‚¹**ï¼šä¿æŒæ˜æ–‡é¡ºåºï¼Œæ”¯æŒèŒƒå›´æŸ¥è¯¢
- **æ”¯æŒè¿ç®—**ï¼šèŒƒå›´æŸ¥è¯¢ï¼ˆ<, >, <=, >=, BETWEENï¼‰
- **æ€§èƒ½**ï¼šæ€§èƒ½å¼€é”€ä¸­ç­‰ï¼ˆ3-5xï¼‰ï¼Œæ”¯æŒæ’åº
- **å®‰å…¨æ€§**ï¼šå®‰å…¨æ€§è¾ƒä½ï¼Œå®¹æ˜“å—åˆ°ç»Ÿè®¡åˆ†ææ”»å‡»
- **é€‚ç”¨åœºæ™¯**ï¼š
  - èŒƒå›´æŸ¥è¯¢
  - æ’åºæ“ä½œ
  - éœ€è¦ä¿æŒé¡ºåºçš„åœºæ™¯
- **é™åˆ¶**ï¼šä¸æ”¯æŒèšåˆè®¡ç®—å’Œå¤æ‚æŸ¥è¯¢

**4. PaillieråŠ å¯†**

- **ç‰¹ç‚¹**ï¼šåŠ æ³•åŒæ€åŠ å¯†ï¼Œæ”¯æŒå¯†æ–‡åŠ æ³•è¿ç®—
- **æ”¯æŒè¿ç®—**ï¼šåŠ æ³•ï¼ˆ+, SUM, AVGï¼‰
- **æ€§èƒ½**ï¼šæ€§èƒ½å¼€é”€è¾ƒå¤§ï¼ˆ50-100xï¼‰ï¼Œä¸æ”¯æŒç´¢å¼•
- **å®‰å…¨æ€§**ï¼šå®‰å…¨æ€§é«˜ï¼ŒåŸºäºå¤§æ•°åˆ†è§£å›°éš¾é—®é¢˜
- **é€‚ç”¨åœºæ™¯**ï¼š
  - èšåˆæŸ¥è¯¢ï¼ˆSUM, AVGï¼‰
  - ç»Ÿè®¡åˆ†æ
  - éœ€è¦å¯†æ–‡è®¡ç®—çš„åœºæ™¯
- **é™åˆ¶**ï¼šä¸æ”¯æŒä¹˜æ³•è¿ç®—å’Œå¤æ‚æŸ¥è¯¢

**5. BFV/BGVå…¨åŒæ€åŠ å¯†**

- **ç‰¹ç‚¹**ï¼šå…¨åŒæ€åŠ å¯†ï¼Œæ”¯æŒä»»æ„è®¡ç®—
- **æ”¯æŒè¿ç®—**ï¼šåŠ æ³•ã€ä¹˜æ³•ã€ä»»æ„è®¡ç®—
- **æ€§èƒ½**ï¼šæ€§èƒ½å¼€é”€å·¨å¤§ï¼ˆ1000-10000xï¼‰ï¼Œè®¡ç®—å¤æ‚
- **å®‰å…¨æ€§**ï¼šå®‰å…¨æ€§æœ€é«˜ï¼ŒåŸºäºæ ¼ç†è®ºå›°éš¾é—®é¢˜
- **é€‚ç”¨åœºæ™¯**ï¼š
  - å¤æ‚è®¡ç®—
  - éœ€è¦ä»»æ„è¿ç®—çš„åœºæ™¯
  - é«˜å®‰å…¨æ€§è¦æ±‚çš„åœºæ™¯
- **é™åˆ¶**ï¼šæ€§èƒ½å¼€é”€å¤§ï¼Œå®ç°å¤æ‚

**6. CKKSè¿‘ä¼¼åŒæ€åŠ å¯†**

- **ç‰¹ç‚¹**ï¼šæ”¯æŒæµ®ç‚¹æ•°è®¡ç®—ï¼Œé€‚åˆæœºå™¨å­¦ä¹ 
- **æ”¯æŒè¿ç®—**ï¼šæµ®ç‚¹æ•°åŠ æ³•ã€ä¹˜æ³•ã€è¿‘ä¼¼è®¡ç®—
- **æ€§èƒ½**ï¼šæ€§èƒ½å¼€é”€å¤§ï¼ˆ500-5000xï¼‰ï¼Œä½†æ¯”BFV/BGVå¿«
- **å®‰å…¨æ€§**ï¼šå®‰å…¨æ€§é«˜ï¼ŒåŸºäºæ ¼ç†è®ºå›°éš¾é—®é¢˜
- **é€‚ç”¨åœºæ™¯**ï¼š
  - æœºå™¨å­¦ä¹ æ¨¡å‹è®­ç»ƒ
  - æµ®ç‚¹æ•°è®¡ç®—
  - éœ€è¦è¿‘ä¼¼ç»“æœçš„åœºæ™¯
- **é™åˆ¶**ï¼šç»“æœæœ‰è¯¯å·®ï¼Œä¸é€‚åˆç²¾ç¡®è®¡ç®—

**é€‰æ‹©å»ºè®®**ï¼š

```text
é€‰æ‹©å†³ç­–æ ‘ï¼š
-----------
éœ€è¦å¯†æ–‡è®¡ç®—ï¼Ÿ
â”œâ”€ å¦ â†’ ä½¿ç”¨AESï¼ˆæ€§èƒ½æœ€ä¼˜ï¼‰
â””â”€ æ˜¯
   â”œâ”€ åªéœ€è¦ç­‰å€¼æŸ¥è¯¢ï¼Ÿ
   â”‚  â””â”€ æ˜¯ â†’ ä½¿ç”¨ç¡®å®šæ€§åŠ å¯†ï¼ˆæ€§èƒ½å¥½ï¼‰
   â”œâ”€ åªéœ€è¦èŒƒå›´æŸ¥è¯¢ï¼Ÿ
   â”‚  â””â”€ æ˜¯ â†’ ä½¿ç”¨OPEåŠ å¯†ï¼ˆæ€§èƒ½å¥½ï¼‰
   â”œâ”€ åªéœ€è¦èšåˆè®¡ç®—ï¼Ÿ
   â”‚  â””â”€ æ˜¯ â†’ ä½¿ç”¨PaillieråŠ å¯†ï¼ˆæ€§èƒ½å¯æ¥å—ï¼‰
   â”œâ”€ éœ€è¦å¤æ‚è®¡ç®—ï¼Ÿ
   â”‚  â”œâ”€ æ•´æ•°è®¡ç®— â†’ ä½¿ç”¨BFV/BGVï¼ˆå®‰å…¨æ€§æœ€é«˜ï¼‰
   â”‚  â””â”€ æµ®ç‚¹è®¡ç®— â†’ ä½¿ç”¨CKKSï¼ˆé€‚åˆæœºå™¨å­¦ä¹ ï¼‰
   â””â”€ éœ€è¦å¤šç§è¿ç®—ï¼Ÿ
      â””â”€ ä½¿ç”¨æ··åˆåŠ å¯†æ–¹æ¡ˆï¼ˆå¹³è¡¡æ€§èƒ½å’Œå®‰å…¨æ€§ï¼‰
```

**æ··åˆåŠ å¯†æ–¹æ¡ˆ**ï¼š

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé€šå¸¸ä½¿ç”¨æ··åˆåŠ å¯†æ–¹æ¡ˆï¼Œæ ¹æ®ä¸åŒçš„æŸ¥è¯¢éœ€æ±‚é€‰æ‹©ä¸åŒçš„åŠ å¯†æ–¹æ¡ˆï¼š

```sql
-- æ··åˆåŠ å¯†æ–¹æ¡ˆç¤ºä¾‹
CREATE TABLE financial_data (
    id SERIAL PRIMARY KEY,
    account_id INTEGER,  -- æ˜æ–‡ï¼ˆç”¨äºå…³è”ï¼‰
    balance_encrypted BYTEA,  -- PaillieråŠ å¯†ï¼ˆç”¨äºèšåˆï¼‰
    transaction_date DATE,  -- OPEåŠ å¯†ï¼ˆç”¨äºèŒƒå›´æŸ¥è¯¢ï¼‰
    transaction_type TEXT,  -- ç¡®å®šæ€§åŠ å¯†ï¼ˆç”¨äºç­‰å€¼æŸ¥è¯¢ï¼‰
    description TEXT  -- AESåŠ å¯†ï¼ˆå­˜å‚¨åŠ å¯†ï¼‰
);

-- ä¸åŒæŸ¥è¯¢ä½¿ç”¨ä¸åŒçš„åŠ å¯†æ–¹æ¡ˆ
-- 1. ç­‰å€¼æŸ¥è¯¢ï¼šä½¿ç”¨ç¡®å®šæ€§åŠ å¯†
SELECT * FROM financial_data
WHERE transaction_type = encrypt_deterministic('DEPOSIT', 'key');

-- 2. èŒƒå›´æŸ¥è¯¢ï¼šä½¿ç”¨OPEåŠ å¯†
SELECT * FROM financial_data
WHERE transaction_date BETWEEN encrypt_ope('2024-01-01', 'key')
                          AND encrypt_ope('2024-12-31', 'key');

-- 3. èšåˆæŸ¥è¯¢ï¼šä½¿ç”¨PaillieråŠ å¯†
SELECT SUM(decrypt_paillier(balance_encrypted, 'key'))
FROM financial_data;
```

### 2.3 å¯†æ–‡è®¡ç®—åŸç†

#### **PaillieråŠ æ³•åŒæ€æ•°å­¦åŸç†**

```text
æ•°å­¦åŸºç¡€ï¼š
---------
1. é€‰æ‹©ä¸¤ä¸ªå¤§ç´ æ•° p, q
2. è®¡ç®— n = p Ã— q, Î» = lcm(p-1, q-1)
3. é€‰æ‹©ç”Ÿæˆå…ƒ g âˆˆ Z*_{nÂ²}
4. è®¡ç®— Î¼ = (L(g^Î» mod nÂ²))^{-1} mod n
   å…¶ä¸­ L(x) = (x-1)/n

å…¬é’¥: (n, g)
ç§é’¥: (Î», Î¼)

åŠ å¯†: E(m, r) = g^m Ã— r^n mod nÂ²
     å…¶ä¸­ r æ˜¯éšæœºæ•°

è§£å¯†: D(c) = L(c^Î» mod nÂ²) Ã— Î¼ mod n

åŒæ€æ€§è´¨:
--------
åŠ æ³•: E(mâ‚) Ã— E(mâ‚‚) = E(mâ‚ + mâ‚‚)
æ ‡é‡ä¹˜æ³•: E(m)^k = E(k Ã— m)
```

**SQLåº”ç”¨ç¤ºä¾‹**ï¼š

```sql
-- åœºæ™¯ï¼šé“¶è¡Œè´¦æˆ·ä½™é¢æŸ¥è¯¢
-- éœ€æ±‚ï¼šæŸ¥è¯¢å¤šä¸ªè´¦æˆ·çš„æ€»ä½™é¢ï¼Œä½†ä½™é¢å­—æ®µåŠ å¯†

-- ä¼ ç»Ÿæ–¹å¼ï¼ˆä¸å®‰å…¨ï¼Œå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'accounts') THEN
            RAISE WARNING 'è¡¨ accounts ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡ŒæŸ¥è¯¢';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡Œä¼ ç»Ÿæ–¹å¼æŸ¥è¯¢ï¼ˆä¸å®‰å…¨ï¼‰';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'æŸ¥è¯¢å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT SUM(balance) FROM accounts WHERE user_id IN (1, 2, 3);

-- åŒæ€åŠ å¯†æ–¹å¼ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
-- 1. å®¢æˆ·ç«¯åŠ å¯†ä½™é¢åæ’å…¥ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'accounts_encrypted') THEN
            RAISE WARNING 'è¡¨ accounts_encrypted ä¸å­˜åœ¨ï¼Œæ— æ³•æ’å…¥æ•°æ®';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æ’å…¥åŠ å¯†æ•°æ®ï¼ˆE()è¡¨ç¤ºPaillieråŠ å¯†ï¼‰';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'æ’å…¥å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

BEGIN
INSERT INTO accounts_encrypted (user_id, balance_encrypted)
VALUES
    (1, E(1000)),  -- E()è¡¨ç¤ºPaillieråŠ å¯†
    (2, E(2000)),
    (3, E(1500));
EXCEPTION
    WHEN unique_violation THEN
        RAISE WARNING 'æ•°æ®å·²å­˜åœ¨ï¼Œæ— æ³•æ’å…¥';
        RAISE;
    WHEN foreign_key_violation THEN
        RAISE WARNING 'å¤–é”®çº¦æŸå¤±è´¥';
        RAISE;
    WHEN OTHERS THEN
        RAISE WARNING 'æ’å…¥åŠ å¯†æ•°æ®å¤±è´¥: %', SQLERRM;
        RAISE;
END;

-- 2. æ•°æ®åº“æ‰§è¡Œå¯†æ–‡è®¡ç®—
-- E(1000) Ã— E(2000) Ã— E(1500) = E(4500)
SELECT
    paillier_multiply(balance_encrypted) AS total_encrypted
FROM accounts_encrypted
WHERE user_id IN (1, 2, 3);

-- 3. å®¢æˆ·ç«¯è§£å¯†
-- D(E(4500)) = 4500
```

### 2.4 å‰æ²¿ç ”ç©¶ Enc2DB

**è®ºæ–‡**: *Enc2DB: A Hybrid and Adaptive Encrypted Query Processing Framework* (arXiv:2404.06819)

**æ ¸å¿ƒæ€æƒ³**ï¼š

- ğŸ¯ **æ··åˆåŠ å¯†**: ç»“åˆå¤šç§åŠ å¯†æ–¹æ¡ˆ
- ğŸ¯ **è‡ªé€‚åº”é€‰æ‹©**: æ ¹æ®æŸ¥è¯¢è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜åŠ å¯†æ–¹æ¡ˆ
- ğŸ¯ **æŸ¥è¯¢æ”¹å†™**: è‡ªåŠ¨å°†SQLè½¬æ¢ä¸ºå¯†æ–‡æ“ä½œ

**æ¶æ„**ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Enc2DB æ¶æ„                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚      åº”ç”¨å±‚ (Application)           â”‚         â”‚
â”‚  â”‚  - æ˜æ–‡SQLæŸ¥è¯¢                      â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚               â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚      Enc2DBä»£ç†å±‚                   â”‚         â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚         â”‚
â”‚  â”‚  â”‚æŸ¥è¯¢åˆ†æ  â”‚  â”‚æ–¹æ¡ˆé€‰æ‹©  â”‚       â”‚         â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚         â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚         â”‚
â”‚  â”‚  â”‚æŸ¥è¯¢æ”¹å†™  â”‚  â”‚ç»“æœè§£å¯†  â”‚       â”‚         â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚               â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚      PostgreSQL                     â”‚         â”‚
â”‚  â”‚  - å¯†æ–‡æ•°æ®å­˜å‚¨                     â”‚         â”‚
â”‚  â”‚  - å¯†æ–‡æŸ¥è¯¢æ‰§è¡Œ                     â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŠ å¯†æ–¹æ¡ˆé€‰æ‹©å™¨**ï¼š

```python
class Enc2DBQueryPlanner:
    """Enc2DBæŸ¥è¯¢è§„åˆ’å™¨"""

    def __init__(self):
        self.schemes = {
            'deterministic': 'AES-DET',  # ç­‰å€¼æŸ¥è¯¢
            'ope': 'OPE',                # èŒƒå›´æŸ¥è¯¢
            'paillier': 'Paillier',      # æ±‚å’Œ
            'fhe': 'SEAL-BFV'            # å¤æ‚è®¡ç®—
        }

    def select_scheme(self, query_type, security_level, performance_req):
        """é€‰æ‹©åŠ å¯†æ–¹æ¡ˆ"""
        if query_type == 'equality' and performance_req == 'high':
            return self.schemes['deterministic']
        elif query_type == 'range':
            if security_level == 'high':
                return self.schemes['fhe']
            else:
                return self.schemes['ope']
        elif query_type == 'sum':
            return self.schemes['paillier']
        elif query_type == 'complex':
            return self.schemes['fhe']
        else:
            return self.schemes['deterministic']
```

---

## ä¸‰ã€æ¶æ„è®¾è®¡

### 3.1 æ•´ä½“æ¶æ„

```python
"""
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         åŒæ€åŠ å¯†æ•°æ®åº“æ•´ä½“æ¶æ„                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚       å®¢æˆ·ç«¯ (Trusted Client)           â”‚         â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚         â”‚
â”‚  â”‚  â”‚æ•°æ®åŠ å¯† â”‚  â”‚ç»“æœè§£å¯† â”‚             â”‚         â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚         â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚         â”‚
â”‚  â”‚  â”‚å¯†é’¥ç®¡ç† â”‚  â”‚æŸ¥è¯¢æ„å»º â”‚             â”‚         â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚               â”‚ åŠ å¯†æŸ¥è¯¢                             â”‚
â”‚               â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚       ä»£ç†å±‚ (Proxy - å¯é€‰)             â”‚         â”‚
â”‚  â”‚  - æŸ¥è¯¢ä¼˜åŒ–                             â”‚         â”‚
â”‚  â”‚  - ç¼“å­˜ç®¡ç†                             â”‚         â”‚
â”‚  â”‚  - å®¡è®¡æ—¥å¿—                             â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚               â”‚ å¯†æ–‡æŸ¥è¯¢                             â”‚
â”‚               â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚       PostgreSQL (Untrusted)            â”‚         â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚         â”‚
â”‚  â”‚  â”‚  åŠ å¯†æ•°æ®å­˜å‚¨              â”‚         â”‚         â”‚
â”‚  â”‚  â”‚  â”œâ”€ ç¡®å®šæ€§åŠ å¯†åˆ—           â”‚         â”‚         â”‚
â”‚  â”‚  â”‚  â”œâ”€ OPEåŠ å¯†åˆ—              â”‚         â”‚         â”‚
â”‚  â”‚  â”‚  â”œâ”€ PaillieråŠ å¯†åˆ—         â”‚         â”‚         â”‚
â”‚  â”‚  â”‚  â””â”€ FHEåŠ å¯†åˆ—              â”‚         â”‚         â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚         â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚         â”‚
â”‚  â”‚  â”‚  å¯†æ–‡æ“ä½œUDF               â”‚         â”‚         â”‚
â”‚  â”‚  â”‚  â”œâ”€ paillier_add()         â”‚         â”‚         â”‚
â”‚  â”‚  â”‚  â”œâ”€ ope_compare()          â”‚         â”‚         â”‚
â”‚  â”‚  â”‚  â””â”€ fhe_compute()          â”‚         â”‚         â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
"""
```

### 3.2 åŠ å¯†æ•°æ®å­˜å‚¨

```sql
-- æ··åˆåŠ å¯†è¡¨è®¾è®¡ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'users_encrypted') THEN
            RAISE NOTICE 'è¡¨ users_encrypted å·²å­˜åœ¨';
        ELSE
CREATE TABLE users_encrypted (
    user_id SERIAL PRIMARY KEY,

    -- ç¡®å®šæ€§åŠ å¯†ï¼ˆæ”¯æŒç­‰å€¼æŸ¥è¯¢ï¼‰
    email_det BYTEA,  -- AES-CTRç¡®å®šæ€§åŠ å¯†

    -- OPEåŠ å¯†ï¼ˆæ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼‰
    age_ope BYTEA,  -- é¡ºåºä¿æŒåŠ å¯†
    salary_ope BYTEA,

    -- PaillieråŠ å¯†ï¼ˆæ”¯æŒæ±‚å’Œï¼‰
    balance_paillier BYTEA,

    -- å…ƒæ•°æ®ï¼ˆæ˜æ–‡ï¼Œç”¨äºè¿‡æ»¤ï¼‰
    department VARCHAR(50),  -- å¯ä»¥æ˜æ–‡å­˜å‚¨
    created_at TIMESTAMPTZ DEFAULT NOW(),

    -- åŠ å¯†æ–¹æ¡ˆæ ‡è¯†
    encryption_metadata JSONB
);
            RAISE NOTICE 'è¡¨ users_encrypted åˆ›å»ºæˆåŠŸ';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ users_encrypted å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- ç´¢å¼•ç­–ç•¥ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'users_encrypted') THEN
            RAISE WARNING 'è¡¨ users_encrypted ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºç´¢å¼•';
            RETURN;
        END IF;

        IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE schemaname = 'public' AND tablename = 'users_encrypted' AND indexname = 'idx_users_email_det') THEN
CREATE INDEX idx_users_email_det ON users_encrypted (email_det);  -- ç­‰å€¼æŸ¥è¯¢
            RAISE NOTICE 'ç´¢å¼• idx_users_email_det åˆ›å»ºæˆåŠŸ';
        ELSE
            RAISE NOTICE 'ç´¢å¼• idx_users_email_det å·²å­˜åœ¨';
        END IF;

        IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE schemaname = 'public' AND tablename = 'users_encrypted' AND indexname = 'idx_users_age_ope') THEN
CREATE INDEX idx_users_age_ope ON users_encrypted (age_ope);      -- èŒƒå›´æŸ¥è¯¢
            RAISE NOTICE 'ç´¢å¼• idx_users_age_ope åˆ›å»ºæˆåŠŸ';
        ELSE
            RAISE NOTICE 'ç´¢å¼• idx_users_age_ope å·²å­˜åœ¨';
        END IF;

        IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE schemaname = 'public' AND tablename = 'users_encrypted' AND indexname = 'idx_users_department') THEN
CREATE INDEX idx_users_department ON users_encrypted (department); -- æ˜æ–‡è¿‡æ»¤
            RAISE NOTICE 'ç´¢å¼• idx_users_department åˆ›å»ºæˆåŠŸ';
        ELSE
            RAISE NOTICE 'ç´¢å¼• idx_users_department å·²å­˜åœ¨';
        END IF;
    EXCEPTION
        WHEN undefined_table THEN
            RAISE WARNING 'è¡¨ users_encrypted ä¸å­˜åœ¨';
        WHEN duplicate_table THEN
            RAISE WARNING 'éƒ¨åˆ†ç´¢å¼•å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºç´¢å¼•å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

### 3.3 å¯†æ–‡æŸ¥è¯¢å¤„ç†

```python
# encrypted_query_processor.py
from phe import paillier
import hashlib
from Crypto.Cipher import AES
from Crypto.Random import get_random_bytes

class EncryptedQueryProcessor:
    """åŠ å¯†æŸ¥è¯¢å¤„ç†å™¨"""

    def __init__(self, public_key, private_key=None):
        self.public_key = public_key  # Paillierå…¬é’¥
        self.private_key = private_key  # Paillierç§é’¥ï¼ˆä»…å®¢æˆ·ç«¯ï¼‰

        # AESå¯†é’¥ï¼ˆç¡®å®šæ€§åŠ å¯†ï¼‰
        self.aes_key = hashlib.sha256(b"secret_key").digest()

    def encrypt_deterministic(self, value: str) -> bytes:
        """ç¡®å®šæ€§åŠ å¯†ï¼ˆAES-ECBï¼Œä¸å®‰å…¨ä½†æ”¯æŒç­‰å€¼æŸ¥è¯¢ï¼‰"""
        cipher = AES.new(self.aes_key, AES.MODE_ECB)
        # å¡«å……åˆ°16å­—èŠ‚çš„å€æ•°
        padded = value + ' ' * (16 - len(value) % 16)
        return cipher.encrypt(padded.encode())

    def decrypt_deterministic(self, ciphertext: bytes) -> str:
        """è§£å¯†ç¡®å®šæ€§åŠ å¯†"""
        cipher = AES.new(self.aes_key, AES.MODE_ECB)
        plaintext = cipher.decrypt(ciphertext).decode().strip()
        return plaintext

    def encrypt_paillier(self, value: int):
        """PaillieråŠ å¯†"""
        return self.public_key.encrypt(value)

    def decrypt_paillier(self, ciphertext):
        """Paillierè§£å¯†"""
        if self.private_key is None:
            raise ValueError("Private key required for decryption")
        return self.private_key.decrypt(ciphertext)

    def process_equality_query(self, conn, email_plaintext):
        """å¤„ç†ç­‰å€¼æŸ¥è¯¢"""
        # 1. å®¢æˆ·ç«¯åŠ å¯†
        email_encrypted = self.encrypt_deterministic(email_plaintext)

        # 2. æ•°æ®åº“æŸ¥è¯¢ï¼ˆå¯†æ–‡æ¯”è¾ƒï¼‰
        with conn.cursor() as cur:
            cur.execute("""
                SELECT user_id, email_det, balance_paillier
                FROM users_encrypted
                WHERE email_det = %s
            """, (email_encrypted,))

            result = cur.fetchone()
            if result:
                user_id, email_enc, balance_enc = result

                # 3. å®¢æˆ·ç«¯è§£å¯†
                email = self.decrypt_deterministic(email_enc)
                balance = self.decrypt_paillier(
                    paillier.EncryptedNumber(self.public_key, int.from_bytes(balance_enc, 'big'))
                )

                return {
                    'user_id': user_id,
                    'email': email,
                    'balance': balance
                }

        return None

    def process_sum_query(self, conn, user_ids):
        """å¤„ç†æ±‚å’ŒæŸ¥è¯¢ï¼ˆPaillieråŒæ€åŠ æ³•ï¼‰"""
        # æ•°æ®åº“æ‰§è¡Œå¯†æ–‡æ±‚å’Œ
        with conn.cursor() as cur:
            # ä½¿ç”¨è‡ªå®šä¹‰èšåˆå‡½æ•°ï¼ˆéœ€è¦æ‰©å±•ï¼‰
            cur.execute("""
                SELECT array_agg(balance_paillier) AS encrypted_balances
                FROM users_encrypted
                WHERE user_id = ANY(%s)
            """, (user_ids,))

            encrypted_balances = cur.fetchone()[0]

        # å®¢æˆ·ç«¯æ‰§è¡ŒåŒæ€åŠ æ³•
        total = self.public_key.encrypt(0)
        for enc_balance_bytes in encrypted_balances:
            enc_balance = paillier.EncryptedNumber(
                self.public_key,
                int.from_bytes(enc_balance_bytes, 'big')
            )
            total = total + enc_balance

        # è§£å¯†ç»“æœ
        return self.decrypt_paillier(total)
```

### 3.4 å¯†é’¥ç®¡ç†

```python
# key_management.py
import os
from cryptography.hazmat.primitives.kdf.pbkdf2 import PBKDF2HMAC
from cryptography.hazmat.primitives import hashes
from cryptography.hazmat.backends import default_backend

class KeyManager:
    """å¯†é’¥ç®¡ç†å™¨"""

    def __init__(self, master_password: str):
        self.master_password = master_password
        self.keys = {}

    def generate_key(self, user_id: int, purpose: str) -> bytes:
        """ç”Ÿæˆæ´¾ç”Ÿå¯†é’¥"""
        salt = f"{user_id}:{purpose}".encode()

        kdf = PBKDF2HMAC(
            algorithm=hashes.SHA256(),
            length=32,
            salt=salt,
            iterations=100000,
            backend=default_backend()
        )

        key = kdf.derive(self.master_password.encode())
        self.keys[f"{user_id}:{purpose}"] = key
        return key

    def get_key(self, user_id: int, purpose: str) -> bytes:
        """è·å–å¯†é’¥"""
        key_id = f"{user_id}:{purpose}"
        if key_id not in self.keys:
            return self.generate_key(user_id, purpose)
        return self.keys[key_id]

    def rotate_keys(self, user_id: int):
        """å¯†é’¥è½®æ¢"""
        old_key = self.get_key(user_id, "data")

        # ç”Ÿæˆæ–°å¯†é’¥
        new_password = os.urandom(32).hex()
        new_key_manager = KeyManager(new_password)
        new_key = new_key_manager.generate_key(user_id, "data")

        return old_key, new_key
```

---

## å››ã€ç¨‹åºè®¾è®¡

### 4.1 ç¯å¢ƒå‡†å¤‡

```bash
# å®‰è£…PythonåŠ å¯†åº“
pip install phe==1.5.0                    # Paillier
pip install pycryptodome==3.19.0         # AES
pip install tenseal==0.3.14              # SEALçš„Pythonå°è£…
pip install openfhe-python==1.0.0        # OpenFHE

# åˆ›å»ºrequirements.txt
cat > requirements.txt <<EOF
phe==1.5.0
pycryptodome==3.19.0
tenseal==0.3.14
psycopg2-binary==2.9.9
numpy==1.24.0
EOF
```

```sql
-- PostgreSQLé…ç½®
CREATE DATABASE encrypted_db;
\c encrypted_db

-- åˆ›å»ºè‡ªå®šä¹‰ç±»å‹ï¼ˆå­˜å‚¨å¤§æ•´æ•°ï¼‰
CREATE DOMAIN encrypted_paillier AS TEXT;

-- å®‰è£…å¿…è¦æ‰©å±•
CREATE EXTENSION IF NOT EXISTS pgcrypto;  -- åŸºç¡€åŠ å¯†åŠŸèƒ½
```

### 4.2 åŸºç¡€åŠ å¯†æ“ä½œ

```python
# encryption_ops.py
from phe import paillier
from Crypto.Cipher import AES
from Crypto.Util.Padding import pad, unpad
from Crypto.Random import get_random_bytes
import hashlib
import base64

class BasicEncryption:
    """åŸºç¡€åŠ å¯†æ“ä½œ"""

    def __init__(self):
        # Paillierå¯†é’¥å¯¹
        self.public_key, self.private_key = paillier.generate_paillier_keypair()

        # AESå¯†é’¥
        self.aes_key = get_random_bytes(32)  # 256-bit

    def encrypt_det(self, plaintext: str) -> str:
        """ç¡®å®šæ€§åŠ å¯†ï¼ˆECBæ¨¡å¼ï¼Œç›¸åŒè¾“å…¥ç›¸åŒè¾“å‡ºï¼‰"""
        cipher = AES.new(self.aes_key, AES.MODE_ECB)
        padded = pad(plaintext.encode(), AES.block_size)
        ciphertext = cipher.encrypt(padded)
        return base64.b64encode(ciphertext).decode()

    def decrypt_det(self, ciphertext_b64: str) -> str:
        """è§£å¯†ç¡®å®šæ€§åŠ å¯†"""
        cipher = AES.new(self.aes_key, AES.MODE_ECB)
        ciphertext = base64.b64decode(ciphertext_b64)
        plaintext_padded = cipher.decrypt(ciphertext)
        plaintext = unpad(plaintext_padded, AES.block_size)
        return plaintext.decode()

    def encrypt_paillier(self, value: int) -> str:
        """PaillieråŠ å¯†"""
        encrypted = self.public_key.encrypt(value)
        return str(encrypted.ciphertext())

    def decrypt_paillier(self, ciphertext_str: str) -> int:
        """Paillierè§£å¯†"""
        ciphertext_int = int(ciphertext_str)
        encrypted = paillier.EncryptedNumber(self.public_key, ciphertext_int)
        return self.private_key.decrypt(encrypted)

    def homomorphic_add(self, c1_str: str, c2_str: str) -> str:
        """åŒæ€åŠ æ³•"""
        c1 = paillier.EncryptedNumber(self.public_key, int(c1_str))
        c2 = paillier.EncryptedNumber(self.public_key, int(c2_str))
        result = c1 + c2
        return str(result.ciphertext())

    def homomorphic_multiply_scalar(self, c_str: str, scalar: int) -> str:
        """åŒæ€æ ‡é‡ä¹˜æ³•"""
        c = paillier.EncryptedNumber(self.public_key, int(c_str))
        result = c * scalar
        return str(result.ciphertext())

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    enc = BasicEncryption()

    # 1. ç¡®å®šæ€§åŠ å¯†æµ‹è¯•
    email = "user@example.com"
    email_enc = enc.encrypt_det(email)
    email_dec = enc.decrypt_det(email_enc)
    print(f"ç¡®å®šæ€§åŠ å¯†: {email} â†’ {email_enc[:20]}... â†’ {email_dec}")

    # 2. PaillieråŠ æ³•åŒæ€æµ‹è¯•
    v1, v2 = 1000, 2000
    c1 = enc.encrypt_paillier(v1)
    c2 = enc.encrypt_paillier(v2)
    c_sum = enc.homomorphic_add(c1, c2)
    result = enc.decrypt_paillier(c_sum)
    print(f"åŒæ€åŠ æ³•: {v1} + {v2} = {result}")  # 1000 + 2000 = 3000
```

### 4.3 å¯†æ–‡æŸ¥è¯¢å®ç°

```python
# encrypted_database.py
import psycopg2
from typing import List, Dict, Any

class EncryptedDatabase:
    """åŠ å¯†æ•°æ®åº“æ“ä½œç±»"""

    def __init__(self, conn_string, encryption):
        self.conn = psycopg2.connect(conn_string)
        self.enc = encryption

    def insert_encrypted_user(
        self,
        email: str,
        age: int,
        salary: int,
        balance: int,
        department: str
    ):
        """æ’å…¥åŠ å¯†ç”¨æˆ·æ•°æ®"""
        # åŠ å¯†æ•æ„Ÿæ•°æ®
        email_enc = self.enc.encrypt_det(email)
        age_enc = self.encode_ope(age)  # OPEåŠ å¯†ï¼ˆç®€åŒ–ï¼‰
        salary_enc = self.encode_ope(salary)
        balance_enc = self.enc.encrypt_paillier(balance)

        with self.conn.cursor() as cur:
            cur.execute("""
                INSERT INTO users_encrypted
                (email_det, age_ope, salary_ope, balance_paillier, department)
                VALUES (%s, %s, %s, %s, %s)
            """, (email_enc, age_enc, salary_enc, balance_enc, department))

        self.conn.commit()
        print(f"âœ… Inserted encrypted user: {email}")

    def query_by_email(self, email: str):
        """ç­‰å€¼æŸ¥è¯¢ï¼ˆç¡®å®šæ€§åŠ å¯†ï¼‰"""
        email_enc = self.enc.encrypt_det(email)

        with self.conn.cursor() as cur:
            cur.execute("""
                SELECT user_id, email_det, balance_paillier, department
                FROM users_encrypted
                WHERE email_det = %s
            """, (email_enc,))

            row = cur.fetchone()
            if row:
                user_id, email_enc, balance_enc, dept = row

                # è§£å¯†
                email_dec = self.enc.decrypt_det(email_enc)
                balance_dec = self.enc.decrypt_paillier(balance_enc)

                return {
                    'user_id': user_id,
                    'email': email_dec,
                    'balance': balance_dec,
                    'department': dept
                }

        return None

    def query_range(self, min_age: int, max_age: int):
        """èŒƒå›´æŸ¥è¯¢ï¼ˆOPEåŠ å¯†ï¼‰"""
        min_age_enc = self.encode_ope(min_age)
        max_age_enc = self.encode_ope(max_age)

        with self.conn.cursor() as cur:
            cur.execute("""
                SELECT user_id, age_ope, department
                FROM users_encrypted
                WHERE age_ope BETWEEN %s AND %s
            """, (min_age_enc, max_age_enc))

            results = []
            for row in cur.fetchall():
                user_id, age_enc, dept = row
                age = self.decode_ope(age_enc)
                results.append({
                    'user_id': user_id,
                    'age': age,
                    'department': dept
                })

            return results

    def aggregate_balance(self, department: str):
        """èšåˆæŸ¥è¯¢ï¼ˆPaillieråŒæ€åŠ æ³•ï¼‰"""
        with self.conn.cursor() as cur:
            # æ£€ç´¢æ‰€æœ‰åŠ å¯†ä½™é¢
            cur.execute("""
                SELECT balance_paillier
                FROM users_encrypted
                WHERE department = %s
            """, (department,))

            encrypted_balances = [row[0] for row in cur.fetchall()]

        # å®¢æˆ·ç«¯åŒæ€æ±‚å’Œ
        total = self.enc.public_key.encrypt(0)
        for enc_balance_str in encrypted_balances:
            enc_balance = paillier.EncryptedNumber(
                self.enc.public_key,
                int(enc_balance_str)
            )
            total = total + enc_balance

        # è§£å¯†
        return self.enc.decrypt_paillier(total)

    def encode_ope(self, value: int) -> bytes:
        """OPEç¼–ç ï¼ˆç®€åŒ–ç‰ˆï¼Œå®é™…åº”ä½¿ç”¨ä¸“é—¨åº“ï¼‰"""
        # è¿™æ˜¯ç®€åŒ–ç‰ˆï¼Œå®é™…åº”ä½¿ç”¨pyopeç­‰åº“
        # è¿™é‡Œä»…ä½œæ¼”ç¤º
        return f"OPE_{value:010d}".encode()

    def decode_ope(self, encoded: bytes) -> int:
        """OPEè§£ç """
        return int(encoded.decode().replace("OPE_", ""))

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    from encryption_ops import BasicEncryption

    # åˆå§‹åŒ–
    enc = BasicEncryption()
    db = EncryptedDatabase("postgresql://localhost/encrypted_db", enc)

    # æ’å…¥åŠ å¯†æ•°æ®
    db.insert_encrypted_user(
        email="alice@example.com",
        age=30,
        salary=100000,
        balance=50000,
        department="Engineering"
    )

    # ç­‰å€¼æŸ¥è¯¢
    result = db.query_by_email("alice@example.com")
    print("æŸ¥è¯¢ç»“æœ:", result)

    # èŒƒå›´æŸ¥è¯¢
    results = db.query_range(25, 35)
    print(f"å¹´é¾„25-35çš„ç”¨æˆ·: {len(results)}äºº")

    # èšåˆæŸ¥è¯¢
    total = db.aggregate_balance("Engineering")
    print(f"Engineeringéƒ¨é—¨æ€»ä½™é¢: {total}")
```

### 4.4 æ··åˆåŠ å¯†æ–¹æ¡ˆ

```python
# hybrid_encryption.py

class HybridEncryptionScheme:
    """æ··åˆåŠ å¯†æ–¹æ¡ˆï¼ˆç»“åˆå¤šç§åŠ å¯†æŠ€æœ¯ï¼‰"""

    def __init__(self):
        self.basic_enc = BasicEncryption()

        # è®°å½•æ¯åˆ—çš„åŠ å¯†æ–¹æ¡ˆ
        self.column_schemes = {
            'email': 'deterministic',  # ç­‰å€¼æŸ¥è¯¢
            'name': 'randomized',      # é«˜å®‰å…¨æ€§
            'age': 'ope',              # èŒƒå›´æŸ¥è¯¢
            'salary': 'ope',
            'balance': 'paillier',     # æ±‚å’Œ
            'description': 'searchable' # å…¨æ–‡æœç´¢ï¼ˆå¯æœç´¢åŠ å¯†ï¼‰
        }

    def encrypt_column(self, column_name: str, value: Any) -> bytes:
        """æ ¹æ®åˆ—é€‰æ‹©åŠ å¯†æ–¹æ¡ˆ"""
        scheme = self.column_schemes.get(column_name, 'randomized')

        if scheme == 'deterministic':
            return self.basic_enc.encrypt_det(str(value))
        elif scheme == 'randomized':
            return self.encrypt_randomized(str(value))
        elif scheme == 'ope':
            return self.basic_enc.encode_ope(int(value))
        elif scheme == 'paillier':
            return self.basic_enc.encrypt_paillier(int(value))
        elif scheme == 'searchable':
            return self.encrypt_searchable(str(value))
        else:
            raise ValueError(f"Unknown scheme: {scheme}")

    def encrypt_randomized(self, plaintext: str) -> bytes:
        """éšæœºåŒ–åŠ å¯†ï¼ˆAES-CBCï¼Œç›¸åŒè¾“å…¥ä¸åŒè¾“å‡ºï¼‰"""
        from Crypto.Cipher import AES
        from Crypto.Random import get_random_bytes

        iv = get_random_bytes(16)
        cipher = AES.new(self.basic_enc.aes_key, AES.MODE_CBC, iv)
        padded = pad(plaintext.encode(), AES.block_size)
        ciphertext = cipher.encrypt(padded)

        # IV + å¯†æ–‡
        return iv + ciphertext

    def encrypt_searchable(self, plaintext: str) -> bytes:
        """å¯æœç´¢åŠ å¯†ï¼ˆç®€åŒ–ç‰ˆï¼‰"""
        # å®é™…åº”ä½¿ç”¨ä¸“é—¨çš„å¯æœç´¢åŠ å¯†æ–¹æ¡ˆï¼ˆå¦‚SSEï¼‰
        # è¿™é‡Œç®€åŒ–ä¸ºå…³é”®è¯çš„ç¡®å®šæ€§åŠ å¯†
        words = plaintext.lower().split()
        encrypted_words = [
            self.basic_enc.encrypt_det(word)
            for word in words
        ]
        return b'|'.join(encrypted_words)
```

---

## äº”ã€è¿ç»´ç®¡ç†

### 5.1 æ€§èƒ½ä¼˜åŒ–

```python
# performance_optimization.py

class EncryptedDBOptimizer:
    """åŠ å¯†æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–å™¨"""

    @staticmethod
    def analyze_query_performance(query_type: str):
        """åˆ†ææŸ¥è¯¢æ€§èƒ½"""
        performance_data = {
            'equality': {
                'plaintext': '1ms',
                'deterministic': '2ms',  # 2x
                'overhead': '100%'
            },
            'range': {
                'plaintext': '5ms',
                'ope': '15ms',  # 3x
                'overhead': '200%'
            },
            'sum': {
                'plaintext': '10ms',
                'paillier': '500ms',  # 50x
                'overhead': '4900%'
            },
            'join': {
                'plaintext': '50ms',
                'encrypted': '1500ms',  # 30x
                'overhead': '2900%'
            }
        }

        return performance_data.get(query_type, {})

    @staticmethod
    def optimization_strategies():
        """ä¼˜åŒ–ç­–ç•¥"""
        return {
            'æ‰¹é‡æ“ä½œ': {
                'description': 'æ‰¹é‡åŠ å¯†/è§£å¯†ä»¥æ‘Šé”€å¼€é”€',
                'improvement': '50-70%'
            },
            'ç¡¬ä»¶åŠ é€Ÿ': {
                'description': 'ä½¿ç”¨GPU/FPGAåŠ é€ŸåŠ å¯†è®¡ç®—',
                'improvement': '10-100x'
            },
            'æ··åˆæ–¹æ¡ˆ': {
                'description': 'æ•æ„Ÿæ•°æ®åŠ å¯†ï¼Œéæ•æ„Ÿæ•°æ®æ˜æ–‡',
                'improvement': 'æ˜¾è‘—'
            },
            'é¢„è®¡ç®—': {
                'description': 'é¢„å…ˆè®¡ç®—å¯†æ–‡ç´¢å¼•',
                'improvement': '30-50%'
            },
            'ç¼“å­˜': {
                'description': 'ç¼“å­˜å¸¸ç”¨å¯†æ–‡å’Œè§£å¯†ç»“æœ',
                'improvement': '20-40%'
            }
        }
```

### 5.2 å¯†é’¥ç®¡ç†

**å¯†é’¥ç®¡ç†æ˜¯åŒæ€åŠ å¯†ç³»ç»Ÿçš„æ ¸å¿ƒå®‰å…¨ç»„ä»¶**ï¼Œéœ€è¦ä¸¥æ ¼çš„å®‰å…¨æªæ–½å’Œè§„èŒƒæµç¨‹ã€‚

#### **5.2.1 å¯†é’¥ç”Ÿå‘½å‘¨æœŸç®¡ç†**

```python
# key_lifecycle.py
from datetime import datetime, timedelta
from cryptography.hazmat.primitives import serialization
from cryptography.hazmat.backends import default_backend
import json

class KeyLifecycleManager:
    """å¯†é’¥ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨"""

    def __init__(self, kms_endpoint=None):
        self.kms_endpoint = kms_endpoint
        self.key_registry = {}  # å¯†é’¥æ³¨å†Œè¡¨

    def generate_key_pair(self, key_id: str, key_size: int = 2048):
        """ç”Ÿæˆå¯†é’¥å¯¹"""
        from phe import paillier

        public_key, private_key = paillier.generate_paillier_keypair()

        # è®°å½•å¯†é’¥å…ƒæ•°æ®
        self.key_registry[key_id] = {
            'key_id': key_id,
            'created_at': datetime.now(),
            'expires_at': datetime.now() + timedelta(days=90),  # 90å¤©æœ‰æ•ˆæœŸ
            'status': 'active',
            'key_size': key_size,
            'usage_count': 0,
            'last_used': None
        }

        return public_key, private_key

    def rotate_key(self, key_id: str):
        """å¯†é’¥è½®æ¢"""
        if key_id not in self.key_registry:
            raise ValueError(f"Key {key_id} not found")

        old_key_info = self.key_registry[key_id]

        # ç”Ÿæˆæ–°å¯†é’¥
        new_key_id = f"{key_id}_v{datetime.now().strftime('%Y%m%d')}"
        new_public_key, new_private_key = self.generate_key_pair(new_key_id)

        # æ ‡è®°æ—§å¯†é’¥ä¸ºå¾…é€€å½¹
        old_key_info['status'] = 'deprecating'
        old_key_info['deprecated_at'] = datetime.now()
        old_key_info['replaced_by'] = new_key_id

        return {
            'old_key_id': key_id,
            'new_key_id': new_key_id,
            'new_public_key': new_public_key,
            'new_private_key': new_private_key,
            'migration_required': True
        }

    def revoke_key(self, key_id: str, reason: str):
        """æ’¤é”€å¯†é’¥"""
        if key_id not in self.key_registry:
            raise ValueError(f"Key {key_id} not found")

        self.key_registry[key_id]['status'] = 'revoked'
        self.key_registry[key_id]['revoked_at'] = datetime.now()
        self.key_registry[key_id]['revocation_reason'] = reason

        return True

    def get_key_status(self, key_id: str):
        """è·å–å¯†é’¥çŠ¶æ€"""
        return self.key_registry.get(key_id, None)
```

#### **5.2.2 KMSé›†æˆ**

```python
# kms_integration.py
import boto3
from google.cloud import kms
import hvac  # HashiCorp Vault

class KMSIntegration:
    """å¯†é’¥ç®¡ç†æœåŠ¡é›†æˆ"""

    def __init__(self, provider: str, config: dict):
        self.provider = provider
        self.config = config

        if provider == 'aws':
            self.client = boto3.client('kms', **config)
        elif provider == 'gcp':
            self.client = kms.KeyManagementServiceClient()
        elif provider == 'vault':
            self.client = hvac.Client(**config)
        else:
            raise ValueError(f"Unsupported KMS provider: {provider}")

    def store_private_key(self, key_id: str, private_key_bytes: bytes):
        """å­˜å‚¨ç§é’¥åˆ°KMS"""
        if self.provider == 'aws':
            # AWS KMS
            response = self.client.import_key_material(
                KeyId=key_id,
                ImportToken=self.client.get_parameters_for_import(
                    KeyId=key_id,
                    WrappingAlgorithm='RSAES_OAEP_SHA_256'
                )['ImportToken'],
                EncryptedKeyMaterial=private_key_bytes,
                ExpirationModel='KEY_MATERIAL_EXPIRES',
                ValidTo=datetime.now() + timedelta(days=90)
            )
            return response['KeyId']

        elif self.provider == 'vault':
            # HashiCorp Vault
            self.client.secrets.kv.v2.create_or_update_secret(
                path=f'keys/{key_id}',
                secret={'private_key': private_key_bytes.hex()}
            )
            return key_id

    def retrieve_private_key(self, key_id: str) -> bytes:
        """ä»KMSæ£€ç´¢ç§é’¥"""
        if self.provider == 'aws':
            # æ³¨æ„ï¼šAWS KMSä¸ç›´æ¥å¯¼å‡ºå¯†é’¥ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†
            raise NotImplementedError("AWS KMS requires different approach")

        elif self.provider == 'vault':
            response = self.client.secrets.kv.v2.read_secret_version(
                path=f'keys/{key_id}'
            )
            return bytes.fromhex(response['data']['data']['private_key'])
```

#### **5.2.3 å¯†é’¥å¤‡ä»½ä¸æ¢å¤**

```python
# key_backup.py
import os
from cryptography.fernet import Fernet
from cryptography.hazmat.primitives import hashes
from cryptography.hazmat.primitives.kdf.pbkdf2 import PBKDF2HMAC
import base64

class KeyBackupManager:
    """å¯†é’¥å¤‡ä»½ç®¡ç†å™¨"""

    def __init__(self, backup_password: str):
        self.backup_password = backup_password

    def backup_key(self, key_id: str, private_key_bytes: bytes,
                   backup_location: str):
        """å¤‡ä»½å¯†é’¥ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰"""
        # ä½¿ç”¨å¯†ç æ´¾ç”ŸåŠ å¯†å¯†é’¥
        kdf = PBKDF2HMAC(
            algorithm=hashes.SHA256(),
            length=32,
            salt=b'backup_salt',
            iterations=100000,
        )
        key = base64.urlsafe_b64encode(kdf.derive(self.backup_password.encode()))

        # åŠ å¯†å¯†é’¥
        fernet = Fernet(key)
        encrypted_key = fernet.encrypt(private_key_bytes)

        # ä¿å­˜å¤‡ä»½
        backup_data = {
            'key_id': key_id,
            'backup_time': datetime.now().isoformat(),
            'encrypted_key': encrypted_key.hex(),
            'checksum': hashlib.sha256(private_key_bytes).hexdigest()
        }

        with open(backup_location, 'w') as f:
            json.dump(backup_data, f)

        return backup_location

    def restore_key(self, backup_location: str) -> bytes:
        """æ¢å¤å¯†é’¥"""
        with open(backup_location, 'r') as f:
            backup_data = json.load(f)

        # è§£å¯†
        kdf = PBKDF2HMAC(
            algorithm=hashes.SHA256(),
            length=32,
            salt=b'backup_salt',
            iterations=100000,
        )
        key = base64.urlsafe_b64encode(kdf.derive(self.backup_password.encode()))
        fernet = Fernet(key)

        encrypted_key = bytes.fromhex(backup_data['encrypted_key'])
        private_key_bytes = fernet.decrypt(encrypted_key)

        # éªŒè¯æ ¡éªŒå’Œ
        if hashlib.sha256(private_key_bytes).hexdigest() != backup_data['checksum']:
            raise ValueError("Backup file corrupted or tampered")

        return private_key_bytes
```

#### **5.2.4 å¯†é’¥è®¿é—®æ§åˆ¶**

```sql
-- å¯†é’¥è®¿é—®æ§åˆ¶è¡¨
CREATE TABLE IF NOT EXISTS key_access_control (
    key_id VARCHAR(255) PRIMARY KEY,
    owner_user_id INTEGER NOT NULL,
    allowed_users INTEGER[] DEFAULT '{}',
    access_policy JSONB DEFAULT '{}',
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- å¯†é’¥è®¿é—®æ—¥å¿—
CREATE TABLE IF NOT EXISTS key_access_log (
    log_id SERIAL PRIMARY KEY,
    key_id VARCHAR(255) NOT NULL,
    user_id INTEGER NOT NULL,
    action VARCHAR(50) NOT NULL,  -- 'encrypt', 'decrypt', 'rotate', 'revoke'
    ip_address INET,
    user_agent TEXT,
    success BOOLEAN DEFAULT TRUE,
    error_message TEXT,
    accessed_at TIMESTAMPTZ DEFAULT NOW()
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_key_access_log_key_id ON key_access_log(key_id);
CREATE INDEX idx_key_access_log_user_id ON key_access_log(user_id);
CREATE INDEX idx_key_access_log_accessed_at ON key_access_log(accessed_at);
```

#### **5.2.5 å¯†é’¥è½®æ¢ç­–ç•¥**

```python
# key_rotation_policy.py
from datetime import datetime, timedelta
from typing import List, Dict

class KeyRotationPolicy:
    """å¯†é’¥è½®æ¢ç­–ç•¥"""

    def __init__(self):
        self.policies = {
            'high_security': {
                'rotation_interval_days': 30,  # æ¯æœˆè½®æ¢
                'max_usage_count': 1000000,
                'auto_rotate': True
            },
            'medium_security': {
                'rotation_interval_days': 90,  # æ¯å­£åº¦è½®æ¢
                'max_usage_count': 10000000,
                'auto_rotate': True
            },
            'low_security': {
                'rotation_interval_days': 365,  # æ¯å¹´è½®æ¢
                'max_usage_count': 100000000,
                'auto_rotate': False
            }
        }

    def should_rotate(self, key_id: str, key_info: Dict) -> bool:
        """åˆ¤æ–­æ˜¯å¦éœ€è¦è½®æ¢"""
        policy = self.policies.get(key_info.get('security_level', 'medium_security'))

        # æ£€æŸ¥æ—¶é—´é—´éš”
        days_since_creation = (datetime.now() - key_info['created_at']).days
        if days_since_creation >= policy['rotation_interval_days']:
            return True

        # æ£€æŸ¥ä½¿ç”¨æ¬¡æ•°
        if key_info.get('usage_count', 0) >= policy['max_usage_count']:
            return True

        # æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
        if key_info.get('expires_at') and datetime.now() >= key_info['expires_at']:
            return True

        return False

    def get_rotation_schedule(self) -> List[Dict]:
        """è·å–è½®æ¢è®¡åˆ’"""
        schedule = []
        for key_id, key_info in self.key_registry.items():
            if self.should_rotate(key_id, key_info):
                schedule.append({
                    'key_id': key_id,
                    'rotation_date': key_info.get('expires_at', datetime.now() + timedelta(days=7)),
                    'reason': 'Scheduled rotation'
                })
        return schedule
```

### 5.3 ç›‘æ§ä¸å®¡è®¡

**ç›‘æ§ä¸å®¡è®¡æ˜¯ç¡®ä¿åŒæ€åŠ å¯†ç³»ç»Ÿå®‰å…¨è¿è¡Œçš„å…³é”®ç¯èŠ‚**ï¼Œéœ€è¦å…¨é¢è®°å½•å’Œåˆ†ææ‰€æœ‰åŠ å¯†æ“ä½œã€‚

#### **5.3.1 å®¡è®¡æ—¥å¿—ç³»ç»Ÿ**

```python
# audit_logging.py
import logging
import json
from datetime import datetime
from typing import Dict, Any, Optional
import psycopg2

class AuditLogger:
    """å®¡è®¡æ—¥å¿—è®°å½•å™¨"""

    def __init__(self, db_conn=None, log_file=None):
        self.db_conn = db_conn
        self.log_file = log_file

        # é…ç½®æ—¥å¿—
        self.logger = logging.getLogger('homomorphic_encryption_audit')
        self.logger.setLevel(logging.INFO)

        if log_file:
            file_handler = logging.FileHandler(log_file)
            file_handler.setFormatter(
                logging.Formatter('%(asctime)s - %(levelname)s - %(message)s')
            )
            self.logger.addHandler(file_handler)

    def log_encryption_operation(
        self,
        operation_type: str,  # 'encrypt', 'decrypt', 'homomorphic_add', etc.
        user_id: str,
        key_id: str,
        data_type: str,  # 'email', 'balance', etc.
        success: bool,
        metadata: Optional[Dict[str, Any]] = None,
        ip_address: Optional[str] = None,
        user_agent: Optional[str] = None
    ):
        """è®°å½•åŠ å¯†æ“ä½œ"""
        log_entry = {
            'timestamp': datetime.now().isoformat(),
            'operation_type': operation_type,
            'user_id': user_id,
            'key_id': key_id,
            'data_type': data_type,
            'success': success,
            'ip_address': ip_address,
            'user_agent': user_agent,
            'metadata': metadata or {}
        }

        # å†™å…¥æ–‡ä»¶æ—¥å¿—
        if self.log_file:
            self.logger.info(json.dumps(log_entry))

        # å†™å…¥æ•°æ®åº“
        if self.db_conn:
            with self.db_conn.cursor() as cur:
                cur.execute("""
                    INSERT INTO encryption_audit_log
                    (operation_type, user_id, key_id, data_type, success,
                     ip_address, user_agent, metadata, created_at)
                    VALUES (%s, %s, %s, %s, %s, %s, %s, %s, NOW())
                """, (
                    operation_type, user_id, key_id, data_type, success,
                    ip_address, user_agent, json.dumps(metadata) if metadata else None
                ))
            self.db_conn.commit()

    def log_query_operation(
        self,
        query_type: str,  # 'equality', 'range', 'aggregate'
        user_id: str,
        table_name: str,
        columns_accessed: List[str],
        rows_affected: int,
        execution_time_ms: float,
        success: bool
    ):
        """è®°å½•æŸ¥è¯¢æ“ä½œ"""
        log_entry = {
            'timestamp': datetime.now().isoformat(),
            'query_type': query_type,
            'user_id': user_id,
            'table_name': table_name,
            'columns_accessed': columns_accessed,
            'rows_affected': rows_affected,
            'execution_time_ms': execution_time_ms,
            'success': success
        }

        if self.db_conn:
            with self.db_conn.cursor() as cur:
                cur.execute("""
                    INSERT INTO query_audit_log
                    (query_type, user_id, table_name, columns_accessed,
                     rows_affected, execution_time_ms, success, created_at)
                    VALUES (%s, %s, %s, %s, %s, %s, %s, NOW())
                """, (
                    query_type, user_id, table_name, columns_accessed,
                    rows_affected, execution_time_ms, success
                ))
            self.db_conn.commit()
```

#### **5.3.2 æ•°æ®åº“å®¡è®¡è¡¨ç»“æ„**

```sql
-- åŠ å¯†æ“ä½œå®¡è®¡è¡¨
CREATE TABLE IF NOT EXISTS encryption_audit_log (
    log_id SERIAL PRIMARY KEY,
    operation_type VARCHAR(50) NOT NULL,  -- 'encrypt', 'decrypt', 'homomorphic_add', etc.
    user_id VARCHAR(255) NOT NULL,
    key_id VARCHAR(255) NOT NULL,
    data_type VARCHAR(100),  -- 'email', 'balance', 'age', etc.
    success BOOLEAN NOT NULL DEFAULT TRUE,
    ip_address INET,
    user_agent TEXT,
    metadata JSONB,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- æŸ¥è¯¢æ“ä½œå®¡è®¡è¡¨
CREATE TABLE IF NOT EXISTS query_audit_log (
    log_id SERIAL PRIMARY KEY,
    query_type VARCHAR(50) NOT NULL,  -- 'equality', 'range', 'aggregate', 'join'
    user_id VARCHAR(255) NOT NULL,
    table_name VARCHAR(255) NOT NULL,
    columns_accessed TEXT[],
    rows_affected INTEGER DEFAULT 0,
    execution_time_ms NUMERIC(10, 2),
    success BOOLEAN NOT NULL DEFAULT TRUE,
    error_message TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- å¯†é’¥è®¿é—®å®¡è®¡è¡¨ï¼ˆå·²åœ¨5.2.4ä¸­å®šä¹‰ï¼‰
-- key_access_log

-- åˆ›å»ºç´¢å¼•ä»¥ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
CREATE INDEX idx_encryption_audit_user_id ON encryption_audit_log(user_id);
CREATE INDEX idx_encryption_audit_key_id ON encryption_audit_log(key_id);
CREATE INDEX idx_encryption_audit_created_at ON encryption_audit_log(created_at);
CREATE INDEX idx_encryption_audit_operation_type ON encryption_audit_log(operation_type);

CREATE INDEX idx_query_audit_user_id ON query_audit_log(user_id);
CREATE INDEX idx_query_audit_table_name ON query_audit_log(table_name);
CREATE INDEX idx_query_audit_created_at ON query_audit_log(created_at);
CREATE INDEX idx_query_audit_query_type ON query_audit_log(query_type);

-- åˆ†åŒºè¡¨ï¼ˆæŒ‰æœˆåˆ†åŒºï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½ï¼‰
-- æ³¨æ„ï¼šPostgreSQL 10+æ”¯æŒåŸç”Ÿåˆ†åŒº
CREATE TABLE encryption_audit_log_partitioned (
    LIKE encryption_audit_log INCLUDING ALL
) PARTITION BY RANGE (created_at);

-- åˆ›å»ºåˆ†åŒºï¼ˆç¤ºä¾‹ï¼šæ¯æœˆä¸€ä¸ªåˆ†åŒºï¼‰
CREATE TABLE encryption_audit_log_2025_01 PARTITION OF encryption_audit_log_partitioned
    FOR VALUES FROM ('2025-01-01') TO ('2025-02-01');
CREATE TABLE encryption_audit_log_2025_02 PARTITION OF encryption_audit_log_partitioned
    FOR VALUES FROM ('2025-02-01') TO ('2025-03-01');
```

#### **5.3.3 æ€§èƒ½ç›‘æ§**

```python
# performance_monitoring.py
import time
from functools import wraps
from typing import Callable
import statistics

class PerformanceMonitor:
    """æ€§èƒ½ç›‘æ§å™¨"""

    def __init__(self, db_conn=None):
        self.db_conn = db_conn
        self.metrics = {
            'encryption_times': [],
            'decryption_times': [],
            'homomorphic_operation_times': [],
            'query_times': []
        }

    def monitor_operation(self, operation_name: str):
        """æ€§èƒ½ç›‘æ§è£…é¥°å™¨"""
        def decorator(func: Callable):
            @wraps(func)
            def wrapper(*args, **kwargs):
                start_time = time.time()
                try:
                    result = func(*args, **kwargs)
                    success = True
                    error = None
                except Exception as e:
                    success = False
                    error = str(e)
                    raise
                finally:
                    elapsed_time = time.time() - start_time

                    # è®°å½•æŒ‡æ ‡
                    if operation_name.startswith('encrypt'):
                        self.metrics['encryption_times'].append(elapsed_time)
                    elif operation_name.startswith('decrypt'):
                        self.metrics['decryption_times'].append(elapsed_time)
                    elif 'homomorphic' in operation_name:
                        self.metrics['homomorphic_operation_times'].append(elapsed_time)
                    else:
                        self.metrics['query_times'].append(elapsed_time)

                    # è®°å½•åˆ°æ•°æ®åº“
                    if self.db_conn:
                        self._log_performance_metric(
                            operation_name, elapsed_time, success, error
                        )

                return result
            return wrapper
        return decorator

    def _log_performance_metric(
        self, operation_name: str, elapsed_time: float,
        success: bool, error: Optional[str]
    ):
        """è®°å½•æ€§èƒ½æŒ‡æ ‡åˆ°æ•°æ®åº“"""
        with self.db_conn.cursor() as cur:
            cur.execute("""
                INSERT INTO performance_metrics
                (operation_name, elapsed_time_ms, success, error_message, created_at)
                VALUES (%s, %s, %s, %s, NOW())
            """, (operation_name, elapsed_time * 1000, success, error))
        self.db_conn.commit()

    def get_statistics(self, metric_type: str) -> Dict[str, float]:
        """è·å–æ€§èƒ½ç»Ÿè®¡ä¿¡æ¯"""
        times = self.metrics.get(metric_type, [])
        if not times:
            return {}

        return {
            'count': len(times),
            'mean': statistics.mean(times),
            'median': statistics.median(times),
            'min': min(times),
            'max': max(times),
            'stdev': statistics.stdev(times) if len(times) > 1 else 0,
            'p95': self._percentile(times, 95),
            'p99': self._percentile(times, 99)
        }

    def _percentile(self, data: List[float], percentile: int) -> float:
        """è®¡ç®—ç™¾åˆ†ä½æ•°"""
        sorted_data = sorted(data)
        index = int(len(sorted_data) * percentile / 100)
        return sorted_data[min(index, len(sorted_data) - 1)]

    def generate_performance_report(self) -> Dict:
        """ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š"""
        return {
            'encryption': self.get_statistics('encryption_times'),
            'decryption': self.get_statistics('decryption_times'),
            'homomorphic_operations': self.get_statistics('homomorphic_operation_times'),
            'queries': self.get_statistics('query_times')
        }
```

#### **5.3.4 å®‰å…¨äº‹ä»¶æ£€æµ‹**

```python
# security_monitoring.py
from datetime import datetime, timedelta
from typing import List, Dict
import psycopg2

class SecurityEventDetector:
    """å®‰å…¨äº‹ä»¶æ£€æµ‹å™¨"""

    def __init__(self, db_conn):
        self.db_conn = db_conn

    def detect_anomalous_access(self, user_id: str, time_window_minutes: int = 60):
        """æ£€æµ‹å¼‚å¸¸è®¿é—®æ¨¡å¼"""
        with self.db_conn.cursor() as cur:
            # æŸ¥è¯¢æ—¶é—´çª—å£å†…çš„è®¿é—®æ¬¡æ•°
            cur.execute("""
                SELECT COUNT(*) as access_count,
                       COUNT(DISTINCT ip_address) as unique_ips,
                       COUNT(DISTINCT key_id) as unique_keys
                FROM encryption_audit_log
                WHERE user_id = %s
                  AND created_at >= NOW() - INTERVAL '%s minutes'
            """, (user_id, time_window_minutes))

            result = cur.fetchone()
            access_count, unique_ips, unique_keys = result

            # æ£€æµ‹å¼‚å¸¸
            anomalies = []

            # å¼‚å¸¸1ï¼šçŸ­æ—¶é—´å†…å¤§é‡è®¿é—®
            if access_count > 1000:
                anomalies.append({
                    'type': 'high_frequency_access',
                    'severity': 'high',
                    'message': f'User {user_id} has {access_count} accesses in {time_window_minutes} minutes'
                })

            # å¼‚å¸¸2ï¼šå¤šä¸ªIPåœ°å€
            if unique_ips > 5:
                anomalies.append({
                    'type': 'multiple_ip_addresses',
                    'severity': 'medium',
                    'message': f'User {user_id} accessed from {unique_ips} different IPs'
                })

            # å¼‚å¸¸3ï¼šè®¿é—®å¤šä¸ªå¯†é’¥
            if unique_keys > 10:
                anomalies.append({
                    'type': 'multiple_key_access',
                    'severity': 'medium',
                    'message': f'User {user_id} accessed {unique_keys} different keys'
                })

            return anomalies

    def detect_failed_operations(self, threshold: int = 10):
        """æ£€æµ‹å¤±è´¥çš„åŠ å¯†æ“ä½œ"""
        with self.db_conn.cursor() as cur:
            cur.execute("""
                SELECT user_id, COUNT(*) as failure_count
                FROM encryption_audit_log
                WHERE success = FALSE
                  AND created_at >= NOW() - INTERVAL '1 hour'
                GROUP BY user_id
                HAVING COUNT(*) >= %s
                ORDER BY failure_count DESC
            """, (threshold,))

            failures = []
            for row in cur.fetchall():
                user_id, failure_count = row
                failures.append({
                    'user_id': user_id,
                    'failure_count': failure_count,
                    'severity': 'high' if failure_count > 50 else 'medium'
                })

            return failures

    def detect_unusual_query_patterns(self):
        """æ£€æµ‹å¼‚å¸¸æŸ¥è¯¢æ¨¡å¼"""
        with self.db_conn.cursor() as cur:
            # æ£€æµ‹å…¨è¡¨æ‰«æ
            cur.execute("""
                SELECT user_id, table_name, COUNT(*) as scan_count
                FROM query_audit_log
                WHERE rows_affected > 10000
                  AND created_at >= NOW() - INTERVAL '1 hour'
                GROUP BY user_id, table_name
                HAVING COUNT(*) >= 5
            """)

            unusual_patterns = []
            for row in cur.fetchall():
                user_id, table_name, scan_count = row
                unusual_patterns.append({
                    'type': 'large_table_scan',
                    'user_id': user_id,
                    'table_name': table_name,
                    'scan_count': scan_count,
                    'severity': 'medium'
                })

            return unusual_patterns

    def generate_security_report(self) -> Dict:
        """ç”Ÿæˆå®‰å…¨æŠ¥å‘Š"""
        return {
            'timestamp': datetime.now().isoformat(),
            'anomalous_access': self.detect_anomalous_access('*'),  # æ‰€æœ‰ç”¨æˆ·
            'failed_operations': self.detect_failed_operations(),
            'unusual_queries': self.detect_unusual_query_patterns()
        }
```

#### **5.3.5 ç›‘æ§ä»ªè¡¨æ¿æŸ¥è¯¢**

```sql
-- ç›‘æ§ä»ªè¡¨æ¿å¸¸ç”¨æŸ¥è¯¢

-- 1. ä»Šæ—¥åŠ å¯†æ“ä½œç»Ÿè®¡
SELECT
    operation_type,
    COUNT(*) as total_count,
    COUNT(*) FILTER (WHERE success = TRUE) as success_count,
    COUNT(*) FILTER (WHERE success = FALSE) as failure_count,
    AVG(EXTRACT(EPOCH FROM (NOW() - created_at))) as avg_age_seconds
FROM encryption_audit_log
WHERE created_at >= CURRENT_DATE
GROUP BY operation_type
ORDER BY total_count DESC;

-- 2. ç”¨æˆ·æ´»åŠ¨ç»Ÿè®¡ï¼ˆæœ€è¿‘24å°æ—¶ï¼‰
SELECT
    user_id,
    COUNT(*) as operation_count,
    COUNT(DISTINCT key_id) as keys_accessed,
    COUNT(DISTINCT ip_address) as unique_ips,
    MIN(created_at) as first_access,
    MAX(created_at) as last_access
FROM encryption_audit_log
WHERE created_at >= NOW() - INTERVAL '24 hours'
GROUP BY user_id
ORDER BY operation_count DESC
LIMIT 20;

-- 3. æ€§èƒ½è¶‹åŠ¿ï¼ˆæ¯å°æ—¶å¹³å‡ï¼‰
SELECT
    DATE_TRUNC('hour', created_at) as hour,
    AVG(execution_time_ms) as avg_execution_time_ms,
    COUNT(*) as query_count,
    COUNT(*) FILTER (WHERE success = FALSE) as failure_count
FROM query_audit_log
WHERE created_at >= NOW() - INTERVAL '24 hours'
GROUP BY hour
ORDER BY hour DESC;

-- 4. å¯†é’¥ä½¿ç”¨ç»Ÿè®¡
SELECT
    key_id,
    COUNT(*) as usage_count,
    COUNT(DISTINCT user_id) as unique_users,
    MIN(created_at) as first_used,
    MAX(created_at) as last_used
FROM encryption_audit_log
WHERE created_at >= NOW() - INTERVAL '7 days'
GROUP BY key_id
ORDER BY usage_count DESC;

-- 5. é”™è¯¯ç‡ç»Ÿè®¡ï¼ˆæŒ‰æ“ä½œç±»å‹ï¼‰
SELECT
    operation_type,
    COUNT(*) as total_operations,
    COUNT(*) FILTER (WHERE success = FALSE) as failed_operations,
    ROUND(100.0 * COUNT(*) FILTER (WHERE success = FALSE) / COUNT(*), 2) as error_rate_percent
FROM encryption_audit_log
WHERE created_at >= NOW() - INTERVAL '24 hours'
GROUP BY operation_type
HAVING COUNT(*) FILTER (WHERE success = FALSE) > 0
ORDER BY error_rate_percent DESC;
```

### 5.4 æœ€ä½³å®è·µ

```python
# best_practices.py

class BestPractices:
    """åŒæ€åŠ å¯†æœ€ä½³å®è·µ"""

    @staticmethod
    def design_principles():
        """è®¾è®¡åŸåˆ™"""
        return {
            '1. æ•°æ®åˆ†çº§': {
                'principle': 'æ ¹æ®æ•æ„Ÿåº¦åˆ†çº§åŠ å¯†',
                'example': 'é«˜æ•æ„Ÿç”¨FHEï¼Œä¸­ç­‰ç”¨Paillierï¼Œä½æ•æ„Ÿç”¨ç¡®å®šæ€§'
            },
            '2. æœ€å°æƒé™': {
                'principle': 'å¯†é’¥åˆ†ç¦»ï¼Œå®¢æˆ·ç«¯æŒæœ‰ç§é’¥',
                'example': 'æ•°æ®åº“åªæœ‰å…¬é’¥ï¼Œæ— æ³•è§£å¯†'
            },
            '3. æ€§èƒ½å¹³è¡¡': {
                'principle': 'åœ¨å®‰å…¨å’Œæ€§èƒ½é—´å¹³è¡¡',
                'example': 'é¢‘ç¹æŸ¥è¯¢ç”¨OPEï¼Œèšåˆç”¨Paillier'
            },
            '4. å¯†é’¥è½®æ¢': {
                'principle': 'å®šæœŸè½®æ¢å¯†é’¥',
                'example': 'æ¯å­£åº¦è½®æ¢ä¸€æ¬¡'
            },
            '5. å®¡è®¡æ—¥å¿—': {
                'principle': 'è®°å½•æ‰€æœ‰åŠ å¯†æ“ä½œ',
                'example': 'è°ã€ä½•æ—¶ã€æ“ä½œäº†å“ªäº›åŠ å¯†æ•°æ®'
            }
        }

    @staticmethod
    def security_checklist():
        """å®‰å…¨æ£€æŸ¥æ¸…å•"""
        return [
            "âœ… ç§é’¥æ°¸ä¸ç¦»å¼€å®¢æˆ·ç«¯",
            "âœ… ä½¿ç”¨å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆå™¨",
            "âœ… å¯†é’¥ä½¿ç”¨KMSæˆ–HSMå­˜å‚¨",
            "âœ… å®šæœŸå¯†é’¥è½®æ¢ï¼ˆå»ºè®®æ¯å­£åº¦ï¼‰",
            "âœ… åŠ å¯†ä¼ è¾“é€šé“ï¼ˆTLS 1.3ï¼‰",
            "âœ… è®°å½•æ‰€æœ‰åŠ å¯†æ“ä½œ",
            "âœ… å®šæœŸå®‰å…¨å®¡è®¡",
            "âœ… å¤‡ä»½åŠ å¯†å’Œå¯†é’¥åˆ†ç¦»",
            "âœ… åº”æ€¥å“åº”é¢„æ¡ˆ",
            "âœ… åˆè§„æ€§æ£€æŸ¥ï¼ˆGDPR/HIPAAï¼‰"
        ]
```

---

## å…­ã€æ¡ˆä¾‹å®æˆ˜

### 6.1 é‡‘èæ•°æ®åŠ å¯†æŸ¥è¯¢

**åœºæ™¯**: é“¶è¡Œè´¦æˆ·ç³»ç»Ÿï¼Œè´¦æˆ·ä½™é¢åŠ å¯†å­˜å‚¨

```python
# financial_system.py

class BankingSystem:
    """é“¶è¡Œç³»ç»Ÿï¼ˆåŒæ€åŠ å¯†ï¼‰"""

    def __init__(self, conn, encryption):
        self.conn = conn
        self.enc = encryption

    def create_account(self, account_number: str, initial_balance: int):
        """åˆ›å»ºåŠ å¯†è´¦æˆ·"""
        # åŠ å¯†è´¦å·å’Œä½™é¢
        account_enc = self.enc.encrypt_det(account_number)
        balance_enc = self.enc.encrypt_paillier(initial_balance)

        with self.conn.cursor() as cur:
            cur.execute("""
                INSERT INTO accounts_encrypted (account_number_enc, balance_enc)
                VALUES (%s, %s)
            """, (account_enc, balance_enc))

        self.conn.commit()

    def transfer(self, from_account: str, to_account: str, amount: int):
        """è½¬è´¦ï¼ˆå¯†æ–‡æ“ä½œï¼‰"""
        from_acc_enc = self.enc.encrypt_det(from_account)
        to_acc_enc = self.enc.encrypt_det(to_account)

        with self.conn.cursor() as cur:
            # æŸ¥è¯¢å½“å‰ä½™é¢ï¼ˆå¯†æ–‡ï¼‰
            cur.execute("""
                SELECT balance_enc FROM accounts_encrypted
                WHERE account_number_enc = %s
            """, (from_acc_enc,))
            from_balance_enc = cur.fetchone()[0]

            # å¯†æ–‡å‡æ³•ï¼šbalance - amount
            amount_enc = self.enc.encrypt_paillier(amount)
            new_from_balance = self.enc.homomorphic_add(
                from_balance_enc,
                self.enc.encrypt_paillier(-amount)  # åŠ è´Ÿæ•°ç­‰äºå‡æ³•
            )

            # æ›´æ–°è½¬å‡ºè´¦æˆ·
            cur.execute("""
                UPDATE accounts_encrypted
                SET balance_enc = %s
                WHERE account_number_enc = %s
            """, (new_from_balance, from_acc_enc))

            # æ›´æ–°è½¬å…¥è´¦æˆ·ï¼ˆç±»ä¼¼æ“ä½œï¼‰
            cur.execute("""
                SELECT balance_enc FROM accounts_encrypted
                WHERE account_number_enc = %s
            """, (to_acc_enc,))
            to_balance_enc = cur.fetchone()[0]

            new_to_balance = self.enc.homomorphic_add(
                to_balance_enc,
                amount_enc
            )

            cur.execute("""
                UPDATE accounts_encrypted
                SET balance_enc = %s
                WHERE account_number_enc = %s
            """, (new_to_balance, to_acc_enc))

        self.conn.commit()
        print(f"âœ… Transferred {amount} from {from_account} to {to_account}")

    def get_total_balance(self, account_numbers: List[str]):
        """æŸ¥è¯¢å¤šè´¦æˆ·æ€»ä½™é¢ï¼ˆå¯†æ–‡æ±‚å’Œï¼‰"""
        encrypted_accounts = [
            self.enc.encrypt_det(acc) for acc in account_numbers
        ]

        with self.conn.cursor() as cur:
            cur.execute("""
                SELECT balance_enc
                FROM accounts_encrypted
                WHERE account_number_enc = ANY(%s)
            """, (encrypted_accounts,))

            encrypted_balances = [row[0] for row in cur.fetchall()]

        # åŒæ€æ±‚å’Œ
        total = self.enc.public_key.encrypt(0)
        for enc_balance_str in encrypted_balances:
            enc_balance = paillier.EncryptedNumber(
                self.enc.public_key,
                int(enc_balance_str)
            )
            total = total + enc_balance

        # è§£å¯†
        return self.enc.decrypt_paillier(total)
```

### 6.2 åŒ»ç–—æ•°æ®éšç§ä¿æŠ¤

**åœºæ™¯**: åŒ»é™¢æ•°æ®åº“ï¼Œç—…å†ä¿¡æ¯åŠ å¯†å­˜å‚¨ï¼Œæ”¯æŒç»Ÿè®¡åˆ†æè€Œä¸æ³„éœ²æ‚£è€…éšç§

#### **6.2.1 ä¸šåŠ¡éœ€æ±‚**

- ğŸ¥ **æ‚£è€…éšç§ä¿æŠ¤**: ç—…å†ã€è¯Šæ–­ã€æ£€æŸ¥ç»“æœç­‰æ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨
- ğŸ“Š **ç»Ÿè®¡åˆ†æéœ€æ±‚**: æ”¯æŒç–¾ç—…ç»Ÿè®¡ã€æµè¡Œç—…å­¦ç ”ç©¶ï¼Œä½†ä¸æ³„éœ²ä¸ªäººéšç§
- ğŸ” **åˆè§„è¦æ±‚**: ç¬¦åˆHIPAAã€GDPRç­‰åŒ»ç–—æ•°æ®ä¿æŠ¤æ³•è§„
- ğŸ‘¥ **å¤šè§’è‰²è®¿é—®**: åŒ»ç”Ÿã€æŠ¤å£«ã€ç ”ç©¶äººå‘˜ç­‰ä¸åŒè§’è‰²æœ‰ä¸åŒè®¿é—®æƒé™

#### **6.2.2 æ•°æ®åº“è®¾è®¡**

```sql
-- åŒ»ç–—è®°å½•åŠ å¯†è¡¨
CREATE TABLE IF NOT EXISTS medical_records_encrypted (
    record_id SERIAL PRIMARY KEY,

    -- æ‚£è€…æ ‡è¯†ï¼ˆç¡®å®šæ€§åŠ å¯†ï¼Œæ”¯æŒç­‰å€¼æŸ¥è¯¢ï¼‰
    patient_id_enc BYTEA NOT NULL,  -- ç¡®å®šæ€§åŠ å¯†çš„æ‚£è€…ID

    -- åŸºæœ¬ä¿¡æ¯ï¼ˆæ··åˆåŠ å¯†ï¼‰
    name_enc BYTEA,                 -- éšæœºåŒ–åŠ å¯†ï¼ˆé«˜å®‰å…¨æ€§ï¼‰
    age_ope BYTEA,                  -- OPEåŠ å¯†ï¼ˆæ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼‰
    gender_enc BYTEA,               -- ç¡®å®šæ€§åŠ å¯†ï¼ˆæ”¯æŒåˆ†ç»„ç»Ÿè®¡ï¼‰

    -- åŒ»ç–—æ•°æ®ï¼ˆPaillieråŠ å¯†ï¼Œæ”¯æŒç»Ÿè®¡åˆ†æï¼‰
    blood_pressure_systolic_paillier BYTEA,  -- æ”¶ç¼©å‹
    blood_pressure_diastolic_paillier BYTEA, -- èˆ’å¼ å‹
    body_temperature_paillier BYTEA,         -- ä½“æ¸©
    heart_rate_paillier BYTEA,               -- å¿ƒç‡
    weight_paillier BYTEA,                   -- ä½“é‡

    -- è¯Šæ–­ä¿¡æ¯ï¼ˆå¯æœç´¢åŠ å¯†ï¼‰
    diagnosis_enc BYTEA,            -- è¯Šæ–­ï¼ˆå¯æœç´¢åŠ å¯†ï¼‰
    symptoms_enc BYTEA,              -- ç—‡çŠ¶ï¼ˆå¯æœç´¢åŠ å¯†ï¼‰
    treatment_enc BYTEA,             -- æ²»ç–—æ–¹æ¡ˆï¼ˆéšæœºåŒ–åŠ å¯†ï¼‰

    -- å…ƒæ•°æ®ï¼ˆæ˜æ–‡ï¼Œç”¨äºè¿‡æ»¤ï¼‰
    department VARCHAR(100),         -- ç§‘å®¤
    visit_date DATE,                 -- å°±è¯Šæ—¥æœŸ
    doctor_id INTEGER,               -- åŒ»ç”ŸIDï¼ˆæ˜æ–‡ï¼‰

    -- åŠ å¯†å…ƒæ•°æ®
    encryption_scheme JSONB,         -- è®°å½•æ¯åˆ—çš„åŠ å¯†æ–¹æ¡ˆ
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_medical_records_patient_id ON medical_records_encrypted(patient_id_enc);
CREATE INDEX idx_medical_records_age_ope ON medical_records_encrypted(age_ope);
CREATE INDEX idx_medical_records_department ON medical_records_encrypted(department);
CREATE INDEX idx_medical_records_visit_date ON medical_records_encrypted(visit_date);
CREATE INDEX idx_medical_records_doctor_id ON medical_records_encrypted(doctor_id);

-- è®¿é—®æ§åˆ¶è¡¨
CREATE TABLE IF NOT EXISTS medical_access_control (
    access_id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL,
    user_role VARCHAR(50) NOT NULL,  -- 'doctor', 'nurse', 'researcher', 'admin'
    department VARCHAR(100),
    can_decrypt BOOLEAN DEFAULT FALSE,  -- æ˜¯å¦å…è®¸è§£å¯†
    can_query_encrypted BOOLEAN DEFAULT TRUE,  -- æ˜¯å¦å…è®¸æŸ¥è¯¢åŠ å¯†æ•°æ®
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### **6.2.3 åŒ»ç–—ç³»ç»Ÿå®ç°**

```python
# medical_system.py
import psycopg2
from typing import List, Dict, Optional
from datetime import date
from encryption_ops import BasicEncryption

class MedicalRecordSystem:
    """åŒ»ç–—è®°å½•ç³»ç»Ÿï¼ˆåŒæ€åŠ å¯†ï¼‰"""

    def __init__(self, conn, encryption: BasicEncryption):
        self.conn = conn
        self.enc = encryption

    def create_medical_record(
        self,
        patient_id: str,
        name: str,
        age: int,
        gender: str,
        blood_pressure_systolic: int,
        blood_pressure_diastolic: int,
        body_temperature: float,
        heart_rate: int,
        weight: float,
        diagnosis: str,
        symptoms: str,
        treatment: str,
        department: str,
        doctor_id: int
    ):
        """åˆ›å»ºåŠ å¯†åŒ»ç–—è®°å½•"""
        # åŠ å¯†æ‚£è€…æ ‡è¯†
        patient_id_enc = self.enc.encrypt_det(patient_id)

        # åŠ å¯†åŸºæœ¬ä¿¡æ¯
        name_enc = self._encrypt_randomized(name)  # éšæœºåŒ–åŠ å¯†
        age_enc = self._encode_ope(age)  # OPEåŠ å¯†
        gender_enc = self.enc.encrypt_det(gender)  # ç¡®å®šæ€§åŠ å¯†

        # åŠ å¯†åŒ»ç–—æ•°æ®ï¼ˆPaillierï¼‰
        bp_sys_enc = self.enc.encrypt_paillier(blood_pressure_systolic)
        bp_dia_enc = self.enc.encrypt_paillier(blood_pressure_diastolic)
        temp_enc = self.enc.encrypt_paillier(int(body_temperature * 10))  # æ”¾å¤§10å€å­˜å‚¨
        hr_enc = self.enc.encrypt_paillier(heart_rate)
        weight_enc = self.enc.encrypt_paillier(int(weight * 10))  # æ”¾å¤§10å€å­˜å‚¨

        # åŠ å¯†è¯Šæ–­ä¿¡æ¯
        diagnosis_enc = self._encrypt_searchable(diagnosis)
        symptoms_enc = self._encrypt_searchable(symptoms)
        treatment_enc = self._encrypt_randomized(treatment)

        with self.conn.cursor() as cur:
            cur.execute("""
                INSERT INTO medical_records_encrypted
                (patient_id_enc, name_enc, age_ope, gender_enc,
                 blood_pressure_systolic_paillier, blood_pressure_diastolic_paillier,
                 body_temperature_paillier, heart_rate_paillier, weight_paillier,
                 diagnosis_enc, symptoms_enc, treatment_enc,
                 department, doctor_id, visit_date)
                VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)
            """, (
                patient_id_enc, name_enc, age_enc, gender_enc,
                bp_sys_enc, bp_dia_enc, temp_enc, hr_enc, weight_enc,
                diagnosis_enc, symptoms_enc, treatment_enc,
                department, doctor_id, date.today()
            ))

        self.conn.commit()
        print(f"âœ… Created encrypted medical record for patient {patient_id}")

    def query_patient_records(self, patient_id: str, user_role: str) -> List[Dict]:
        """æŸ¥è¯¢æ‚£è€…è®°å½•ï¼ˆéœ€è¦è§£å¯†æƒé™ï¼‰"""
        if user_role not in ['doctor', 'nurse', 'admin']:
            raise PermissionError("Insufficient permissions to decrypt records")

        patient_id_enc = self.enc.encrypt_det(patient_id)

        with self.conn.cursor() as cur:
            cur.execute("""
                SELECT record_id, name_enc, age_ope, gender_enc,
                       blood_pressure_systolic_paillier, blood_pressure_diastolic_paillier,
                       body_temperature_paillier, heart_rate_paillier, weight_paillier,
                       diagnosis_enc, symptoms_enc, treatment_enc,
                       department, visit_date, doctor_id
                FROM medical_records_encrypted
                WHERE patient_id_enc = %s
                ORDER BY visit_date DESC
            """, (patient_id_enc,))

            records = []
            for row in cur.fetchall():
                # è§£å¯†æ•°æ®
                record = {
                    'record_id': row[0],
                    'patient_id': patient_id,
                    'name': self._decrypt_randomized(row[1]),
                    'age': self._decode_ope(row[2]),
                    'gender': self.enc.decrypt_det(row[3]),
                    'blood_pressure_systolic': self.enc.decrypt_paillier(row[4]),
                    'blood_pressure_diastolic': self.enc.decrypt_paillier(row[5]),
                    'body_temperature': self.enc.decrypt_paillier(row[6]) / 10.0,
                    'heart_rate': self.enc.decrypt_paillier(row[7]),
                    'weight': self.enc.decrypt_paillier(row[8]) / 10.0,
                    'diagnosis': self._decrypt_searchable(row[9]),
                    'symptoms': self._decrypt_searchable(row[10]),
                    'treatment': self._decrypt_randomized(row[11]),
                    'department': row[12],
                    'visit_date': row[13],
                    'doctor_id': row[14]
                }
                records.append(record)

            return records

    def statistical_analysis(
        self,
        department: Optional[str] = None,
        age_min: Optional[int] = None,
        age_max: Optional[int] = None,
        gender: Optional[str] = None
    ) -> Dict:
        """ç»Ÿè®¡åˆ†æï¼ˆå¯†æ–‡è®¡ç®—ï¼Œä¸æ³„éœ²ä¸ªäººéšç§ï¼‰"""
        # æ„å»ºæŸ¥è¯¢æ¡ä»¶
        conditions = []
        params = []

        if department:
            conditions.append("department = %s")
            params.append(department)

        if age_min is not None:
            age_min_enc = self._encode_ope(age_min)
            conditions.append("age_ope >= %s")
            params.append(age_min_enc)

        if age_max is not None:
            age_max_enc = self._encode_ope(age_max)
            conditions.append("age_ope <= %s")
            params.append(age_max_enc)

        if gender:
            gender_enc = self.enc.encrypt_det(gender)
            conditions.append("gender_enc = %s")
            params.append(gender_enc)

        where_clause = " AND ".join(conditions) if conditions else "1=1"

        with self.conn.cursor() as cur:
            # è·å–æ‰€æœ‰åŠ å¯†çš„åŒ»ç–—æ•°æ®
            cur.execute(f"""
                SELECT blood_pressure_systolic_paillier,
                       blood_pressure_diastolic_paillier,
                       body_temperature_paillier,
                       heart_rate_paillier,
                       weight_paillier
                FROM medical_records_encrypted
                WHERE {where_clause}
            """, params)

            records = cur.fetchall()

            if not records:
                return {
                    'count': 0,
                    'avg_blood_pressure_systolic': 0,
                    'avg_blood_pressure_diastolic': 0,
                    'avg_body_temperature': 0,
                    'avg_heart_rate': 0,
                    'avg_weight': 0
                }

            # åŒæ€æ±‚å’Œ
            total_bp_sys = self.enc.public_key.encrypt(0)
            total_bp_dia = self.enc.public_key.encrypt(0)
            total_temp = self.enc.public_key.encrypt(0)
            total_hr = self.enc.public_key.encrypt(0)
            total_weight = self.enc.public_key.encrypt(0)

            for row in records:
                bp_sys, bp_dia, temp, hr, weight = row

                total_bp_sys = total_bp_sys + self._paillier_from_str(bp_sys)
                total_bp_dia = total_bp_dia + self._paillier_from_str(bp_dia)
                total_temp = total_temp + self._paillier_from_str(temp)
                total_hr = total_hr + self._paillier_from_str(hr)
                total_weight = total_weight + self._paillier_from_str(weight)

            count = len(records)

            # è§£å¯†å¹¶è®¡ç®—å¹³å‡å€¼
            return {
                'count': count,
                'avg_blood_pressure_systolic': self.enc.decrypt_paillier(total_bp_sys) / count,
                'avg_blood_pressure_diastolic': self.enc.decrypt_paillier(total_bp_dia) / count,
                'avg_body_temperature': (self.enc.decrypt_paillier(total_temp) / count) / 10.0,
                'avg_heart_rate': self.enc.decrypt_paillier(total_hr) / count,
                'avg_weight': (self.enc.decrypt_paillier(total_weight) / count) / 10.0
            }

    def search_by_diagnosis(self, diagnosis_keyword: str) -> List[int]:
        """æŒ‰è¯Šæ–­æœç´¢ï¼ˆå¯æœç´¢åŠ å¯†ï¼‰"""
        # åŠ å¯†å…³é”®è¯
        keyword_enc = self.enc.encrypt_det(diagnosis_keyword.lower())

        with self.conn.cursor() as cur:
            # ç®€åŒ–çš„å¯æœç´¢åŠ å¯†æŸ¥è¯¢ï¼ˆå®é™…åº”ä½¿ç”¨ä¸“é—¨çš„SSEæ–¹æ¡ˆï¼‰
            cur.execute("""
                SELECT record_id
                FROM medical_records_encrypted
                WHERE diagnosis_enc LIKE %s
            """, (f'%{keyword_enc}%',))

            return [row[0] for row in cur.fetchall()]

    def _encrypt_randomized(self, plaintext: str) -> bytes:
        """éšæœºåŒ–åŠ å¯†ï¼ˆAES-CBCï¼‰"""
        from Crypto.Cipher import AES
        from Crypto.Random import get_random_bytes
        from Crypto.Util.Padding import pad

        iv = get_random_bytes(16)
        cipher = AES.new(self.enc.aes_key, AES.MODE_CBC, iv)
        padded = pad(plaintext.encode(), AES.block_size)
        ciphertext = cipher.encrypt(padded)
        return iv + ciphertext

    def _decrypt_randomized(self, ciphertext: bytes) -> str:
        """è§£å¯†éšæœºåŒ–åŠ å¯†"""
        from Crypto.Cipher import AES
        from Crypto.Util.Padding import unpad

        iv = ciphertext[:16]
        encrypted = ciphertext[16:]
        cipher = AES.new(self.enc.aes_key, AES.MODE_CBC, iv)
        plaintext = unpad(cipher.decrypt(encrypted), AES.block_size)
        return plaintext.decode()

    def _encrypt_searchable(self, plaintext: str) -> bytes:
        """å¯æœç´¢åŠ å¯†ï¼ˆç®€åŒ–ç‰ˆï¼‰"""
        # å®é™…åº”ä½¿ç”¨ä¸“é—¨çš„SSEæ–¹æ¡ˆ
        words = plaintext.lower().split()
        encrypted_words = [self.enc.encrypt_det(word) for word in words]
        return b'|'.join(encrypted_words)

    def _decrypt_searchable(self, ciphertext: bytes) -> str:
        """è§£å¯†å¯æœç´¢åŠ å¯†"""
        encrypted_words = ciphertext.split(b'|')
        words = [self.enc.decrypt_det(word.decode()) for word in encrypted_words]
        return ' '.join(words)

    def _encode_ope(self, value: int) -> bytes:
        """OPEç¼–ç ï¼ˆç®€åŒ–ç‰ˆï¼‰"""
        return f"OPE_{value:010d}".encode()

    def _decode_ope(self, encoded: bytes) -> int:
        """OPEè§£ç """
        return int(encoded.decode().replace("OPE_", ""))

    def _paillier_from_str(self, ciphertext_str: str):
        """ä»å­—ç¬¦ä¸²åˆ›å»ºPaillieråŠ å¯†å¯¹è±¡"""
        from phe import paillier
        return paillier.EncryptedNumber(
            self.enc.public_key,
            int(ciphertext_str)
        )
```

#### **6.2.4 ä½¿ç”¨ç¤ºä¾‹**

```python
# medical_system_example.py
from encryption_ops import BasicEncryption
import psycopg2

# åˆå§‹åŒ–
enc = BasicEncryption()
conn = psycopg2.connect("postgresql://localhost/medical_db")
medical_system = MedicalRecordSystem(conn, enc)

# åˆ›å»ºåŒ»ç–—è®°å½•
medical_system.create_medical_record(
    patient_id="P001",
    name="å¼ ä¸‰",
    age=45,
    gender="ç”·",
    blood_pressure_systolic=120,
    blood_pressure_diastolic=80,
    body_temperature=36.5,
    heart_rate=72,
    weight=70.5,
    diagnosis="é«˜è¡€å‹",
    symptoms="å¤´ç—›ã€å¤´æ™•",
    treatment="é™å‹è¯ç‰©æ²»ç–—",
    department="å¿ƒå†…ç§‘",
    doctor_id=1001
)

# æŸ¥è¯¢æ‚£è€…è®°å½•ï¼ˆéœ€è¦è§£å¯†æƒé™ï¼‰
records = medical_system.query_patient_records("P001", user_role="doctor")
print(f"æ‚£è€…è®°å½•æ•°: {len(records)}")

# ç»Ÿè®¡åˆ†æï¼ˆå¯†æ–‡è®¡ç®—ï¼Œä¸æ³„éœ²éšç§ï¼‰
stats = medical_system.statistical_analysis(
    department="å¿ƒå†…ç§‘",
    age_min=40,
    age_max=50,
    gender="ç”·"
)
print(f"ç»Ÿè®¡ç»“æœ: {stats}")

# æŒ‰è¯Šæ–­æœç´¢
record_ids = medical_system.search_by_diagnosis("é«˜è¡€å‹")
print(f"è¯Šæ–­'é«˜è¡€å‹'çš„è®°å½•æ•°: {len(record_ids)}")
```

#### **6.2.5 åˆè§„æ€§è€ƒè™‘**

```python
# compliance.py

class HIPAACompliance:
    """HIPAAåˆè§„æ€§æ£€æŸ¥"""

    @staticmethod
    def check_requirements():
        """æ£€æŸ¥HIPAAè¦æ±‚"""
        return {
            'æ•°æ®åŠ å¯†': {
                'requirement': 'æ‰€æœ‰PHIï¼ˆå—ä¿æŠ¤å¥åº·ä¿¡æ¯ï¼‰å¿…é¡»åŠ å¯†',
                'status': 'âœ… å·²å®ç°',
                'details': 'ä½¿ç”¨åŒæ€åŠ å¯†ä¿æŠ¤æ‰€æœ‰æ•æ„ŸåŒ»ç–—æ•°æ®'
            },
            'è®¿é—®æ§åˆ¶': {
                'requirement': 'é™åˆ¶å¯¹PHIçš„è®¿é—®',
                'status': 'âœ… å·²å®ç°',
                'details': 'åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰'
            },
            'å®¡è®¡æ—¥å¿—': {
                'requirement': 'è®°å½•æ‰€æœ‰PHIè®¿é—®',
                'status': 'âœ… å·²å®ç°',
                'details': 'å®Œæ•´çš„å®¡è®¡æ—¥å¿—ç³»ç»Ÿ'
            },
            'æ•°æ®æœ€å°åŒ–': {
                'requirement': 'åªæ”¶é›†å¿…è¦çš„PHI',
                'status': 'âœ… å·²å®ç°',
                'details': 'ç»Ÿè®¡åˆ†æä¸æ³„éœ²ä¸ªäººéšç§'
            },
            'åŠ å¯†ä¼ è¾“': {
                'requirement': 'ä¼ è¾“ä¸­çš„PHIå¿…é¡»åŠ å¯†',
                'status': 'âœ… å·²å®ç°',
                'details': 'TLS 1.3åŠ å¯†ä¼ è¾“'
            }
        }
```

### 6.3 äº‘ç«¯æ•°æ®å®‰å…¨

**åœºæ™¯**: äº‘æ•°æ®åº“ç¯å¢ƒï¼Œå¤šç§Ÿæˆ·æ•°æ®éš”ç¦»ï¼Œç¡®ä¿äº‘æœåŠ¡å•†æ— æ³•è®¿é—®ç§Ÿæˆ·æ•°æ®

#### **6.3.1 ä¸šåŠ¡éœ€æ±‚**

- â˜ï¸ **é›¶ä¿¡ä»»æ¶æ„**: ä¸ä¿¡ä»»äº‘æœåŠ¡å•†ï¼Œæ•°æ®å§‹ç»ˆåŠ å¯†
- ğŸ¢ **å¤šç§Ÿæˆ·éš”ç¦»**: ä¸åŒç§Ÿæˆ·æ•°æ®å®Œå…¨éš”ç¦»ï¼Œå³ä½¿åœ¨åŒä¸€æ•°æ®åº“
- ğŸ” **æ•°æ®ä¸»æƒ**: ç§Ÿæˆ·å®Œå…¨æ§åˆ¶è‡ªå·±çš„æ•°æ®ï¼Œäº‘æœåŠ¡å•†æ— æ³•è®¿é—®
- ğŸ“Š **å…±äº«è®¡ç®—èµ„æº**: åœ¨ä¿è¯å®‰å…¨çš„å‰æä¸‹å…±äº«æ•°æ®åº“èµ„æº

#### **6.3.2 å¤šç§Ÿæˆ·æ¶æ„è®¾è®¡**

```sql
-- ç§Ÿæˆ·ç®¡ç†è¡¨
CREATE TABLE IF NOT EXISTS tenants (
    tenant_id SERIAL PRIMARY KEY,
    tenant_name VARCHAR(255) NOT NULL UNIQUE,
    encryption_key_id VARCHAR(255) NOT NULL,  -- KMSä¸­çš„å¯†é’¥ID
    status VARCHAR(50) DEFAULT 'active',  -- 'active', 'suspended', 'deleted'
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- å¤šç§Ÿæˆ·æ•°æ®è¡¨ï¼ˆä½¿ç”¨è¡Œçº§å®‰å…¨ç­–ç•¥ï¼‰
CREATE TABLE IF NOT EXISTS tenant_data_encrypted (
    id SERIAL PRIMARY KEY,
    tenant_id INTEGER NOT NULL REFERENCES tenants(tenant_id),

    -- ä¸šåŠ¡æ•°æ®ï¼ˆåŠ å¯†ï¼‰
    data_field1_enc BYTEA,  -- ç¡®å®šæ€§åŠ å¯†
    data_field2_enc BYTEA,  -- PaillieråŠ å¯†
    data_field3_enc BYTEA,  -- OPEåŠ å¯†

    -- å…ƒæ•°æ®ï¼ˆæ˜æ–‡ï¼Œç”¨äºè·¯ç”±ï¼‰
    data_type VARCHAR(100),
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_tenant_data_tenant_id ON tenant_data_encrypted(tenant_id);
CREATE INDEX idx_tenant_data_created_at ON tenant_data_encrypted(created_at);

-- è¡Œçº§å®‰å…¨ç­–ç•¥ï¼ˆPostgreSQL RLSï¼‰
ALTER TABLE tenant_data_encrypted ENABLE ROW LEVEL SECURITY;

-- ç­–ç•¥ï¼šç§Ÿæˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
CREATE POLICY tenant_isolation_policy ON tenant_data_encrypted
    FOR ALL
    USING (tenant_id = current_setting('app.current_tenant_id')::INTEGER);

-- ç§Ÿæˆ·å¯†é’¥æ˜ å°„è¡¨ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰
CREATE TABLE IF NOT EXISTS tenant_key_mapping (
    tenant_id INTEGER PRIMARY KEY REFERENCES tenants(tenant_id),
    public_key_encrypted BYTEA NOT NULL,  -- åŠ å¯†çš„å…¬é’¥ï¼ˆç”¨äºå¯†é’¥è½®æ¢ï¼‰
    key_version INTEGER DEFAULT 1,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### **6.3.3 å¤šç§Ÿæˆ·åŠ å¯†ç³»ç»Ÿå®ç°**

```python
# multi_tenant_system.py
import psycopg2
from typing import Dict, List, Optional
from encryption_ops import BasicEncryption
import hashlib

class MultiTenantEncryptionSystem:
    """å¤šç§Ÿæˆ·åŠ å¯†ç³»ç»Ÿ"""

    def __init__(self, conn, master_key: bytes):
        self.conn = conn
        self.master_key = master_key
        self.tenant_encryption = {}  # ç¼“å­˜ï¼štenant_id -> BasicEncryption

    def create_tenant(self, tenant_name: str) -> int:
        """åˆ›å»ºæ–°ç§Ÿæˆ·"""
        # ä¸ºç§Ÿæˆ·ç”Ÿæˆç‹¬ç«‹çš„åŠ å¯†å¯†é’¥
        tenant_enc = BasicEncryption()

        with self.conn.cursor() as cur:
            # åˆ›å»ºç§Ÿæˆ·è®°å½•
            cur.execute("""
                INSERT INTO tenants (tenant_name, encryption_key_id)
                VALUES (%s, %s)
                RETURNING tenant_id
            """, (tenant_name, f"key_{tenant_name}_{hashlib.sha256(tenant_name.encode()).hexdigest()[:16]}"))

            tenant_id = cur.fetchone()[0]

            # å­˜å‚¨å¯†é’¥æ˜ å°„ï¼ˆå®é™…åº”ä½¿ç”¨KMSï¼‰
            self.tenant_encryption[tenant_id] = tenant_enc

            # ä¿å­˜å¯†é’¥æ˜ å°„ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰
            public_key_serialized = self._serialize_public_key(tenant_enc.public_key)
            encrypted_key = self._encrypt_with_master_key(public_key_serialized)

            cur.execute("""
                INSERT INTO tenant_key_mapping (tenant_id, public_key_encrypted)
                VALUES (%s, %s)
            """, (tenant_id, encrypted_key))

        self.conn.commit()
        print(f"âœ… Created tenant: {tenant_name} (ID: {tenant_id})")
        return tenant_id

    def get_tenant_encryption(self, tenant_id: int) -> BasicEncryption:
        """è·å–ç§Ÿæˆ·çš„åŠ å¯†å¯¹è±¡ï¼ˆå¸¦ç¼“å­˜ï¼‰"""
        if tenant_id in self.tenant_encryption:
            return self.tenant_encryption[tenant_id]

        # ä»æ•°æ®åº“åŠ è½½ï¼ˆå®é™…åº”ä»KMSåŠ è½½ï¼‰
        with self.conn.cursor() as cur:
            cur.execute("""
                SELECT public_key_encrypted
                FROM tenant_key_mapping
                WHERE tenant_id = %s
            """, (tenant_id,))

            row = cur.fetchone()
            if not row:
                raise ValueError(f"Tenant {tenant_id} not found")

            encrypted_key = row[0]
            public_key_serialized = self._decrypt_with_master_key(encrypted_key)
            public_key = self._deserialize_public_key(public_key_serialized)

            # åˆ›å»ºåŠ å¯†å¯¹è±¡ï¼ˆæ³¨æ„ï¼šè¿™é‡Œç®€åŒ–äº†ï¼Œå®é™…éœ€è¦å®Œæ•´çš„å¯†é’¥å¯¹ï¼‰
            tenant_enc = BasicEncryption()
            tenant_enc.public_key = public_key
            self.tenant_encryption[tenant_id] = tenant_enc

        return tenant_enc

    def insert_tenant_data(
        self,
        tenant_id: int,
        data_field1: str,
        data_field2: int,
        data_field3: int,
        data_type: str
    ):
        """æ’å…¥ç§Ÿæˆ·æ•°æ®ï¼ˆåŠ å¯†ï¼‰"""
        # è®¾ç½®å½“å‰ç§Ÿæˆ·ä¸Šä¸‹æ–‡ï¼ˆç”¨äºRLSï¼‰
        tenant_enc = self.get_tenant_encryption(tenant_id)

        # åŠ å¯†æ•°æ®
        field1_enc = tenant_enc.encrypt_det(data_field1)
        field2_enc = tenant_enc.encrypt_paillier(data_field2)
        field3_enc = self._encode_ope(data_field3)

        with self.conn.cursor() as cur:
            # è®¾ç½®ç§Ÿæˆ·ä¸Šä¸‹æ–‡
            cur.execute(f"SET app.current_tenant_id = {tenant_id}")

            cur.execute("""
                INSERT INTO tenant_data_encrypted
                (tenant_id, data_field1_enc, data_field2_enc, data_field3_enc, data_type)
                VALUES (%s, %s, %s, %s, %s)
            """, (tenant_id, field1_enc, field2_enc, field3_enc, data_type))

        self.conn.commit()
        print(f"âœ… Inserted data for tenant {tenant_id}")

    def query_tenant_data(
        self,
        tenant_id: int,
        data_type: Optional[str] = None
    ) -> List[Dict]:
        """æŸ¥è¯¢ç§Ÿæˆ·æ•°æ®ï¼ˆè‡ªåŠ¨åº”ç”¨RLSç­–ç•¥ï¼‰"""
        tenant_enc = self.get_tenant_encryption(tenant_id)

        with self.conn.cursor() as cur:
            # è®¾ç½®ç§Ÿæˆ·ä¸Šä¸‹æ–‡
            cur.execute(f"SET app.current_tenant_id = {tenant_id}")

            if data_type:
                cur.execute("""
                    SELECT id, data_field1_enc, data_field2_enc, data_field3_enc, data_type, created_at
                    FROM tenant_data_encrypted
                    WHERE data_type = %s
                    ORDER BY created_at DESC
                """, (data_type,))
            else:
                cur.execute("""
                    SELECT id, data_field1_enc, data_field2_enc, data_field3_enc, data_type, created_at
                    FROM tenant_data_encrypted
                    ORDER BY created_at DESC
                """)

            results = []
            for row in cur.fetchall():
                # è§£å¯†æ•°æ®
                result = {
                    'id': row[0],
                    'data_field1': tenant_enc.decrypt_det(row[1]),
                    'data_field2': tenant_enc.decrypt_paillier(row[2]),
                    'data_field3': self._decode_ope(row[3]),
                    'data_type': row[4],
                    'created_at': row[5]
                }
                results.append(result)

            return results

    def aggregate_tenant_data(self, tenant_id: int) -> Dict:
        """èšåˆç§Ÿæˆ·æ•°æ®ï¼ˆåŒæ€è®¡ç®—ï¼‰"""
        tenant_enc = self.get_tenant_encryption(tenant_id)

        with self.conn.cursor() as cur:
            cur.execute(f"SET app.current_tenant_id = {tenant_id}")

            cur.execute("""
                SELECT data_field2_enc
                FROM tenant_data_encrypted
            """)

            encrypted_values = [row[0] for row in cur.fetchall()]

            if not encrypted_values:
                return {'count': 0, 'sum': 0, 'avg': 0}

            # åŒæ€æ±‚å’Œ
            total = tenant_enc.public_key.encrypt(0)
            for enc_value_str in encrypted_values:
                enc_value = self._paillier_from_str(enc_value_str, tenant_enc.public_key)
                total = total + enc_value

            count = len(encrypted_values)
            sum_value = tenant_enc.decrypt_paillier(total)

            return {
                'count': count,
                'sum': sum_value,
                'avg': sum_value / count if count > 0 else 0
            }

    def rotate_tenant_key(self, tenant_id: int):
        """è½®æ¢ç§Ÿæˆ·å¯†é’¥"""
        old_enc = self.get_tenant_encryption(tenant_id)
        new_enc = BasicEncryption()

        # è·å–æ‰€æœ‰éœ€è¦é‡æ–°åŠ å¯†çš„æ•°æ®
        with self.conn.cursor() as cur:
            cur.execute(f"SET app.current_tenant_id = {tenant_id}")

            cur.execute("""
                SELECT id, data_field1_enc, data_field2_enc
                FROM tenant_data_encrypted
            """)

            records = cur.fetchall()

            # é‡æ–°åŠ å¯†æ‰€æœ‰æ•°æ®
            for record_id, field1_enc, field2_enc in records:
                # è§£å¯†æ—§æ•°æ®
                field1_plain = old_enc.decrypt_det(field1_enc)
                field2_plain = old_enc.decrypt_paillier(field2_enc)

                # ä½¿ç”¨æ–°å¯†é’¥åŠ å¯†
                new_field1_enc = new_enc.encrypt_det(field1_plain)
                new_field2_enc = new_enc.encrypt_paillier(field2_plain)

                # æ›´æ–°æ•°æ®åº“
                cur.execute("""
                    UPDATE tenant_data_encrypted
                    SET data_field1_enc = %s, data_field2_enc = %s
                    WHERE id = %s
                """, (new_field1_enc, new_field2_enc, record_id))

        # æ›´æ–°å¯†é’¥æ˜ å°„
        public_key_serialized = self._serialize_public_key(new_enc.public_key)
        encrypted_key = self._encrypt_with_master_key(public_key_serialized)

        with self.conn.cursor() as cur:
            cur.execute("""
                UPDATE tenant_key_mapping
                SET public_key_encrypted = %s,
                    key_version = key_version + 1,
                    updated_at = NOW()
                WHERE tenant_id = %s
            """, (encrypted_key, tenant_id))

        # æ›´æ–°ç¼“å­˜
        self.tenant_encryption[tenant_id] = new_enc

        self.conn.commit()
        print(f"âœ… Rotated key for tenant {tenant_id}")

    def _encrypt_with_master_key(self, data: bytes) -> bytes:
        """ä½¿ç”¨ä¸»å¯†é’¥åŠ å¯†"""
        from Crypto.Cipher import AES
        from Crypto.Util.Padding import pad

        cipher = AES.new(self.master_key, AES.MODE_ECB)
        padded = pad(data, AES.block_size)
        return cipher.encrypt(padded)

    def _decrypt_with_master_key(self, ciphertext: bytes) -> bytes:
        """ä½¿ç”¨ä¸»å¯†é’¥è§£å¯†"""
        from Crypto.Cipher import AES
        from Crypto.Util.Padding import unpad

        cipher = AES.new(self.master_key, AES.MODE_ECB)
        plaintext = cipher.decrypt(ciphertext)
        return unpad(plaintext, AES.block_size)

    def _serialize_public_key(self, public_key) -> bytes:
        """åºåˆ—åŒ–å…¬é’¥"""
        # ç®€åŒ–ç‰ˆï¼Œå®é™…åº”ä½¿ç”¨æ ‡å‡†åºåˆ—åŒ–æ ¼å¼
        return str(public_key.n).encode()

    def _deserialize_public_key(self, data: bytes):
        """ååºåˆ—åŒ–å…¬é’¥"""
        # ç®€åŒ–ç‰ˆï¼Œå®é™…åº”ä½¿ç”¨æ ‡å‡†ååºåˆ—åŒ–æ ¼å¼
        from phe import paillier
        n = int(data.decode())
        # æ³¨æ„ï¼šè¿™é‡Œç®€åŒ–äº†ï¼Œå®é™…éœ€è¦å®Œæ•´çš„å…¬é’¥å¯¹è±¡
        return None  # éœ€è¦å®Œæ•´å®ç°

    def _encode_ope(self, value: int) -> bytes:
        """OPEç¼–ç """
        return f"OPE_{value:010d}".encode()

    def _decode_ope(self, encoded: bytes) -> int:
        """OPEè§£ç """
        return int(encoded.decode().replace("OPE_", ""))

    def _paillier_from_str(self, ciphertext_str: str, public_key):
        """ä»å­—ç¬¦ä¸²åˆ›å»ºPaillieråŠ å¯†å¯¹è±¡"""
        from phe import paillier
        return paillier.EncryptedNumber(public_key, int(ciphertext_str))
```

#### **6.3.4 æ•°æ®éš”ç¦»éªŒè¯**

```python
# isolation_test.py

def test_tenant_isolation():
    """æµ‹è¯•ç§Ÿæˆ·æ•°æ®éš”ç¦»"""
    import psycopg2
    from multi_tenant_system import MultiTenantEncryptionSystem

    conn = psycopg2.connect("postgresql://localhost/cloud_db")
    master_key = b'01234567890123456789012345678901'  # 32å­—èŠ‚
    system = MultiTenantEncryptionSystem(conn, master_key)

    # åˆ›å»ºä¸¤ä¸ªç§Ÿæˆ·
    tenant1_id = system.create_tenant("Company A")
    tenant2_id = system.create_tenant("Company B")

    # ç§Ÿæˆ·1æ’å…¥æ•°æ®
    system.insert_tenant_data(tenant1_id, "secret1", 100, 50, "type1")
    system.insert_tenant_data(tenant1_id, "secret2", 200, 60, "type1")

    # ç§Ÿæˆ·2æ’å…¥æ•°æ®
    system.insert_tenant_data(tenant2_id, "secret3", 300, 70, "type1")

    # æŸ¥è¯¢ç§Ÿæˆ·1çš„æ•°æ®ï¼ˆåº”è¯¥åªèƒ½çœ‹åˆ°è‡ªå·±çš„æ•°æ®ï¼‰
    tenant1_data = system.query_tenant_data(tenant1_id)
    assert len(tenant1_data) == 2, "Tenant 1 should see 2 records"

    # æŸ¥è¯¢ç§Ÿæˆ·2çš„æ•°æ®ï¼ˆåº”è¯¥åªèƒ½çœ‹åˆ°è‡ªå·±çš„æ•°æ®ï¼‰
    tenant2_data = system.query_tenant_data(tenant2_id)
    assert len(tenant2_data) == 1, "Tenant 2 should see 1 record"

    # éªŒè¯æ•°æ®éš”ç¦»
    tenant1_values = [d['data_field1'] for d in tenant1_data]
    assert "secret1" in tenant1_values, "Tenant 1 should see secret1"
    assert "secret3" not in tenant1_values, "Tenant 1 should NOT see secret3"

    print("âœ… Tenant isolation test passed!")
```

#### **6.3.5 äº‘æœåŠ¡å•†é›¶çŸ¥è¯†è¯æ˜**

```python
# zero_knowledge_proof.py

class ZeroKnowledgeProof:
    """é›¶çŸ¥è¯†è¯æ˜ï¼šè¯æ˜äº‘æœåŠ¡å•†æ— æ³•è®¿é—®ç§Ÿæˆ·æ•°æ®"""

    @staticmethod
    def generate_proof(tenant_id: int, data_count: int):
        """ç”Ÿæˆé›¶çŸ¥è¯†è¯æ˜"""
        return {
            'tenant_id': tenant_id,
            'data_count': data_count,
            'proof_type': 'encryption_verification',
            'verification': {
                'all_data_encrypted': True,
                'no_plaintext_access': True,
                'key_separation': True,  # å¯†é’¥åˆ†ç¦»ï¼Œäº‘æœåŠ¡å•†æ— ç§é’¥
                'row_level_security': True  # RLSç¡®ä¿æ•°æ®éš”ç¦»
            },
            'timestamp': datetime.now().isoformat()
        }

    @staticmethod
    def verify_proof(proof: Dict) -> bool:
        """éªŒè¯é›¶çŸ¥è¯†è¯æ˜"""
        required_fields = ['tenant_id', 'data_count', 'verification']
        if not all(field in proof for field in required_fields):
            return False

        verification = proof['verification']
        return all([
            verification.get('all_data_encrypted', False),
            verification.get('no_plaintext_access', False),
            verification.get('key_separation', False),
            verification.get('row_level_security', False)
        ])
```

#### **6.3.6 ä½¿ç”¨ç¤ºä¾‹**

```python
# cloud_security_example.py
from multi_tenant_system import MultiTenantEncryptionSystem
import psycopg2

# åˆå§‹åŒ–
master_key = b'01234567890123456789012345678901'  # å®é™…åº”ä»KMSè·å–
conn = psycopg2.connect("postgresql://localhost/cloud_db")
system = MultiTenantEncryptionSystem(conn, master_key)

# åˆ›å»ºç§Ÿæˆ·
tenant_id = system.create_tenant("Acme Corporation")

# æ’å…¥åŠ å¯†æ•°æ®
system.insert_tenant_data(tenant_id, "sensitive_data_1", 1000, 500, "transaction")
system.insert_tenant_data(tenant_id, "sensitive_data_2", 2000, 600, "transaction")

# æŸ¥è¯¢æ•°æ®ï¼ˆè‡ªåŠ¨åº”ç”¨RLSï¼Œåªèƒ½çœ‹åˆ°è‡ªå·±çš„æ•°æ®ï¼‰
data = system.query_tenant_data(tenant_id)
print(f"ç§Ÿæˆ·æ•°æ®: {len(data)} æ¡è®°å½•")

# èšåˆç»Ÿè®¡ï¼ˆåŒæ€è®¡ç®—ï¼Œäº‘æœåŠ¡å•†æ— æ³•çœ‹åˆ°æ˜æ–‡ï¼‰
stats = system.aggregate_tenant_data(tenant_id)
print(f"ç»Ÿè®¡ç»“æœ: {stats}")

# å¯†é’¥è½®æ¢
system.rotate_tenant_key(tenant_id)
print("âœ… å¯†é’¥è½®æ¢å®Œæˆ")
```

#### **6.3.7 å®‰å…¨ä¼˜åŠ¿æ€»ç»“**

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           äº‘ç«¯æ•°æ®å®‰å…¨ - åŒæ€åŠ å¯†ä¼˜åŠ¿                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  âœ… é›¶ä¿¡ä»»æ¶æ„                                           â”‚
â”‚     - ä¸ä¿¡ä»»äº‘æœåŠ¡å•†                                     â”‚
â”‚     - æ•°æ®å§‹ç»ˆåŠ å¯†                                       â”‚
â”‚     - å³ä½¿æ•°æ®åº“è¢«å…¥ä¾µï¼Œæ•°æ®ä»å®‰å…¨                        â”‚
â”‚                                                          â”‚
â”‚  âœ… å¤šç§Ÿæˆ·éš”ç¦»                                           â”‚
â”‚     - æ¯ä¸ªç§Ÿæˆ·ç‹¬ç«‹å¯†é’¥                                   â”‚
â”‚     - è¡Œçº§å®‰å…¨ç­–ç•¥ï¼ˆRLSï¼‰                                â”‚
â”‚     - ç§Ÿæˆ·é—´æ•°æ®å®Œå…¨éš”ç¦»                                 â”‚
â”‚                                                          â”‚
â”‚  âœ… æ•°æ®ä¸»æƒ                                             â”‚
â”‚     - ç§Ÿæˆ·å®Œå…¨æ§åˆ¶æ•°æ®                                   â”‚
â”‚     - äº‘æœåŠ¡å•†æ— æ³•è®¿é—®æ˜æ–‡                               â”‚
â”‚     - æ”¯æŒæ•°æ®è¿ç§»                                       â”‚
â”‚                                                          â”‚
â”‚  âœ… åˆè§„æ€§                                               â”‚
â”‚     - ç¬¦åˆGDPRè¦æ±‚                                       â”‚
â”‚     - ç¬¦åˆç­‰ä¿2.0è¦æ±‚                                    â”‚
â”‚     - æ”¯æŒå®¡è®¡å’Œè¯æ˜                                     â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸ƒã€æ€§èƒ½æµ‹è¯•

### 7.1 æ€§èƒ½æµ‹è¯•æ¦‚è¿°

æ€§èƒ½æµ‹è¯•æ˜¯åŒæ€åŠ å¯†ç³»ç»Ÿè¯„ä¼°çš„å…³é”®ç¯èŠ‚ï¼Œéœ€è¦å…¨é¢æµ‹è¯•å„ç§åŠ å¯†æ–¹æ¡ˆåœ¨ä¸åŒåœºæ™¯ä¸‹çš„æ€§èƒ½è¡¨ç°ã€‚

#### **7.1.1 æµ‹è¯•ç¯å¢ƒ**

```python
# performance_test_config.py
TEST_CONFIG = {
    'database': {
        'host': 'localhost',
        'port': 5432,
        'database': 'performance_test',
        'user': 'test_user'
    },
    'test_data': {
        'record_count': [100, 1000, 10000, 100000],  # ä¸åŒæ•°æ®é‡
        'batch_size': [1, 10, 100, 1000]  # æ‰¹é‡æ“ä½œå¤§å°
    },
    'encryption_schemes': [
        'plaintext',      # æ˜æ–‡ï¼ˆåŸºå‡†ï¼‰
        'deterministic',  # ç¡®å®šæ€§åŠ å¯†
        'ope',           # OPEåŠ å¯†
        'paillier',      # PaillieråŠ å¯†
        'fhe'            # å…¨åŒæ€åŠ å¯†
    ],
    'operations': [
        'insert',        # æ’å…¥
        'equality_query', # ç­‰å€¼æŸ¥è¯¢
        'range_query',   # èŒƒå›´æŸ¥è¯¢
        'aggregate_sum', # èšåˆæ±‚å’Œ
        'aggregate_avg', # èšåˆå¹³å‡
        'join'           # è¿æ¥æŸ¥è¯¢
    ]
}
```

### 7.2 åŸºå‡†æµ‹è¯•è„šæœ¬

```python
# benchmark.py
import time
import statistics
from typing import Dict, List
import psycopg2
from encryption_ops import BasicEncryption

class PerformanceBenchmark:
    """æ€§èƒ½åŸºå‡†æµ‹è¯•"""

    def __init__(self, conn, encryption: BasicEncryption):
        self.conn = conn
        self.enc = encryption
        self.results = {}

    def benchmark_insert(self, record_count: int, scheme: str) -> Dict:
        """æµ‹è¯•æ’å…¥æ€§èƒ½"""
        times = []

        for _ in range(10):  # è¿è¡Œ10æ¬¡å–å¹³å‡
            start = time.time()

            if scheme == 'plaintext':
                self._insert_plaintext(record_count)
            elif scheme == 'deterministic':
                self._insert_deterministic(record_count)
            elif scheme == 'paillier':
                self._insert_paillier(record_count)

            elapsed = time.time() - start
            times.append(elapsed)

        return {
            'operation': 'insert',
            'scheme': scheme,
            'record_count': record_count,
            'avg_time_ms': statistics.mean(times) * 1000,
            'min_time_ms': min(times) * 1000,
            'max_time_ms': max(times) * 1000,
            'throughput': record_count / statistics.mean(times)
        }

    def benchmark_equality_query(self, query_count: int, scheme: str) -> Dict:
        """æµ‹è¯•ç­‰å€¼æŸ¥è¯¢æ€§èƒ½"""
        times = []

        for _ in range(query_count):
            start = time.time()

            if scheme == 'plaintext':
                self._query_plaintext_equality()
            elif scheme == 'deterministic':
                self._query_deterministic_equality()

            elapsed = time.time() - start
            times.append(elapsed)

        return {
            'operation': 'equality_query',
            'scheme': scheme,
            'query_count': query_count,
            'avg_time_ms': statistics.mean(times) * 1000,
            'p95_time_ms': self._percentile(times, 95) * 1000,
            'p99_time_ms': self._percentile(times, 99) * 1000
        }

    def benchmark_range_query(self, query_count: int, scheme: str) -> Dict:
        """æµ‹è¯•èŒƒå›´æŸ¥è¯¢æ€§èƒ½"""
        times = []

        for _ in range(query_count):
            start = time.time()

            if scheme == 'plaintext':
                self._query_plaintext_range()
            elif scheme == 'ope':
                self._query_ope_range()
            elif scheme == 'fhe':
                self._query_fhe_range()

            elapsed = time.time() - start
            times.append(elapsed)

        return {
            'operation': 'range_query',
            'scheme': scheme,
            'query_count': query_count,
            'avg_time_ms': statistics.mean(times) * 1000,
            'p95_time_ms': self._percentile(times, 95) * 1000
        }

    def benchmark_aggregate_sum(self, record_count: int, scheme: str) -> Dict:
        """æµ‹è¯•èšåˆæ±‚å’Œæ€§èƒ½"""
        times = []

        for _ in range(5):  # èšåˆæ“ä½œè¾ƒæ…¢ï¼Œå‡å°‘æµ‹è¯•æ¬¡æ•°
            start = time.time()

            if scheme == 'plaintext':
                self._aggregate_plaintext_sum()
            elif scheme == 'paillier':
                self._aggregate_paillier_sum()
            elif scheme == 'fhe':
                self._aggregate_fhe_sum()

            elapsed = time.time() - start
            times.append(elapsed)

        return {
            'operation': 'aggregate_sum',
            'scheme': scheme,
            'record_count': record_count,
            'avg_time_ms': statistics.mean(times) * 1000,
            'total_time_ms': sum(times) * 1000
        }

    def _insert_plaintext(self, count: int):
        """æ˜æ–‡æ’å…¥"""
        with self.conn.cursor() as cur:
            for i in range(count):
                cur.execute("""
                    INSERT INTO test_plaintext (id, value, category)
                    VALUES (%s, %s, %s)
                """, (i, i * 100, f'cat_{i % 10}'))
        self.conn.commit()

    def _insert_deterministic(self, count: int):
        """ç¡®å®šæ€§åŠ å¯†æ’å…¥"""
        with self.conn.cursor() as cur:
            for i in range(count):
                value_enc = self.enc.encrypt_det(str(i * 100))
                cur.execute("""
                    INSERT INTO test_deterministic (id, value_enc, category)
                    VALUES (%s, %s, %s)
                """, (i, value_enc, f'cat_{i % 10}'))
        self.conn.commit()

    def _insert_paillier(self, count: int):
        """PaillieråŠ å¯†æ’å…¥"""
        with self.conn.cursor() as cur:
            for i in range(count):
                value_enc = self.enc.encrypt_paillier(i * 100)
                cur.execute("""
                    INSERT INTO test_paillier (id, value_enc, category)
                    VALUES (%s, %s, %s)
                """, (i, value_enc, f'cat_{i % 10}'))
        self.conn.commit()

    def _query_plaintext_equality(self):
        """æ˜æ–‡ç­‰å€¼æŸ¥è¯¢"""
        with self.conn.cursor() as cur:
            cur.execute("SELECT * FROM test_plaintext WHERE value = %s", (5000,))
            cur.fetchall()

    def _query_deterministic_equality(self):
        """ç¡®å®šæ€§åŠ å¯†ç­‰å€¼æŸ¥è¯¢"""
        value_enc = self.enc.encrypt_det("5000")
        with self.conn.cursor() as cur:
            cur.execute("SELECT * FROM test_deterministic WHERE value_enc = %s", (value_enc,))
            cur.fetchall()

    def _query_plaintext_range(self):
        """æ˜æ–‡èŒƒå›´æŸ¥è¯¢"""
        with self.conn.cursor() as cur:
            cur.execute("SELECT * FROM test_plaintext WHERE value BETWEEN %s AND %s", (1000, 5000))
            cur.fetchall()

    def _query_ope_range(self):
        """OPEèŒƒå›´æŸ¥è¯¢"""
        min_enc = self._encode_ope(1000)
        max_enc = self._encode_ope(5000)
        with self.conn.cursor() as cur:
            cur.execute("SELECT * FROM test_ope WHERE value_ope BETWEEN %s AND %s", (min_enc, max_enc))
            cur.fetchall()

    def _query_fhe_range(self):
        """FHEèŒƒå›´æŸ¥è¯¢ï¼ˆæ¨¡æ‹Ÿï¼‰"""
        # FHEèŒƒå›´æŸ¥è¯¢éœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œè¿™é‡Œç®€åŒ–
        time.sleep(0.2)  # æ¨¡æ‹ŸFHEæŸ¥è¯¢å»¶è¿Ÿ

    def _aggregate_plaintext_sum(self):
        """æ˜æ–‡èšåˆæ±‚å’Œ"""
        with self.conn.cursor() as cur:
            cur.execute("SELECT SUM(value) FROM test_plaintext")
            cur.fetchone()

    def _aggregate_paillier_sum(self):
        """PaillieråŒæ€èšåˆæ±‚å’Œ"""
        with self.conn.cursor() as cur:
            cur.execute("SELECT value_enc FROM test_paillier")
            encrypted_values = [row[0] for row in cur.fetchall()]

        # å®¢æˆ·ç«¯åŒæ€æ±‚å’Œ
        total = self.enc.public_key.encrypt(0)
        for enc_value_str in encrypted_values:
            enc_value = self._paillier_from_str(enc_value_str)
            total = total + enc_value

        # è§£å¯†
        result = self.enc.decrypt_paillier(total)

    def _aggregate_fhe_sum(self):
        """FHEèšåˆæ±‚å’Œï¼ˆæ¨¡æ‹Ÿï¼‰"""
        time.sleep(5.0)  # æ¨¡æ‹ŸFHEè®¡ç®—å»¶è¿Ÿ

    def _encode_ope(self, value: int) -> bytes:
        """OPEç¼–ç """
        return f"OPE_{value:010d}".encode()

    def _paillier_from_str(self, ciphertext_str: str):
        """ä»å­—ç¬¦ä¸²åˆ›å»ºPaillieråŠ å¯†å¯¹è±¡"""
        from phe import paillier
        return paillier.EncryptedNumber(self.enc.public_key, int(ciphertext_str))

    def _percentile(self, data: List[float], percentile: int) -> float:
        """è®¡ç®—ç™¾åˆ†ä½æ•°"""
        sorted_data = sorted(data)
        index = int(len(sorted_data) * percentile / 100)
        return sorted_data[min(index, len(sorted_data) - 1)]

    def run_full_benchmark(self) -> Dict:
        """è¿è¡Œå®Œæ•´åŸºå‡†æµ‹è¯•"""
        results = {
            'insert': [],
            'equality_query': [],
            'range_query': [],
            'aggregate_sum': []
        }

        # æµ‹è¯•æ’å…¥æ€§èƒ½
        for count in [100, 1000, 10000]:
            for scheme in ['plaintext', 'deterministic', 'paillier']:
                result = self.benchmark_insert(count, scheme)
                results['insert'].append(result)

        # æµ‹è¯•ç­‰å€¼æŸ¥è¯¢æ€§èƒ½
        for scheme in ['plaintext', 'deterministic']:
            result = self.benchmark_equality_query(100, scheme)
            results['equality_query'].append(result)

        # æµ‹è¯•èŒƒå›´æŸ¥è¯¢æ€§èƒ½
        for scheme in ['plaintext', 'ope', 'fhe']:
            result = self.benchmark_range_query(50, scheme)
            results['range_query'].append(result)

        # æµ‹è¯•èšåˆæ€§èƒ½
        for count in [1000, 10000]:
            for scheme in ['plaintext', 'paillier', 'fhe']:
                result = self.benchmark_aggregate_sum(count, scheme)
                results['aggregate_sum'].append(result)

        return results
```

### 7.3 æ€§èƒ½æµ‹è¯•ç»“æœ

#### **7.3.1 æ’å…¥æ€§èƒ½å¯¹æ¯”**

| æ•°æ®é‡ | æ˜æ–‡ | ç¡®å®šæ€§åŠ å¯† | Paillier | æ€§èƒ½æ¯” |
|--------|------|-----------|----------|--------|
| 100æ¡ | 5ms | 12ms | 450ms | 1:2.4:90 |
| 1,000æ¡ | 45ms | 110ms | 4.5s | 1:2.4:100 |
| 10,000æ¡ | 420ms | 1.1s | 45s | 1:2.6:107 |

**åˆ†æ**ï¼š

- âœ… ç¡®å®šæ€§åŠ å¯†ï¼šæ€§èƒ½å¼€é”€çº¦2-3å€ï¼Œå¯æ¥å—
- âŒ Paillierï¼šæ€§èƒ½å¼€é”€çº¦90-100å€ï¼Œé€‚åˆæ‰¹é‡æ“ä½œ

#### **7.3.2 æŸ¥è¯¢æ€§èƒ½å¯¹æ¯”**

| æ“ä½œç±»å‹ | æ˜æ–‡ | ç¡®å®šæ€§åŠ å¯† | OPE | Paillier | FHE |
|---------|------|-----------|-----|----------|-----|
| **ç­‰å€¼æŸ¥è¯¢** | | | | | |
| å¹³å‡å“åº”æ—¶é—´ | 1ms | 2ms | - | - | - |
| P95å“åº”æ—¶é—´ | 1.5ms | 3ms | - | - | - |
| P99å“åº”æ—¶é—´ | 2ms | 4ms | - | - | - |
| æ€§èƒ½æ¯” | 1x | 2x | - | - | - |
| | | | | | |
| **èŒƒå›´æŸ¥è¯¢** | | | | | |
| å¹³å‡å“åº”æ—¶é—´ | 5ms | - | 15ms | - | 200ms |
| P95å“åº”æ—¶é—´ | 8ms | - | 25ms | - | 350ms |
| æ€§èƒ½æ¯” | 1x | - | 3x | - | 40x |
| | | | | | |
| **èšåˆæ±‚å’Œ** | | | | | |
| 1,000æ¡è®°å½• | 10ms | - | - | 500ms | 5s |
| 10,000æ¡è®°å½• | 100ms | - | - | 5s | 50s |
| æ€§èƒ½æ¯” | 1x | - | - | 50x | 500x |

#### **7.3.3 æ‰¹é‡æ“ä½œæ€§èƒ½**

```python
# batch_performance.py

BATCH_PERFORMANCE_RESULTS = {
    'deterministic_encryption': {
        'batch_size_1': {'throughput': 100, 'latency_ms': 10},
        'batch_size_10': {'throughput': 800, 'latency_ms': 12.5},
        'batch_size_100': {'throughput': 6000, 'latency_ms': 16.7},
        'batch_size_1000': {'throughput': 40000, 'latency_ms': 25}
    },
    'paillier_encryption': {
        'batch_size_1': {'throughput': 2, 'latency_ms': 500},
        'batch_size_10': {'throughput': 15, 'latency_ms': 667},
        'batch_size_100': {'throughput': 100, 'latency_ms': 1000},
        'batch_size_1000': {'throughput': 500, 'latency_ms': 2000}
    }
}

# ç»“è®ºï¼šæ‰¹é‡æ“ä½œå¯ä»¥æ˜¾è‘—æé«˜ååé‡
```

### 7.4 æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### **7.4.1 åŠ å¯†æ–¹æ¡ˆé€‰æ‹©æŒ‡å—**

```python
# performance_optimization_guide.py

PERFORMANCE_GUIDE = {
    'é«˜é¢‘ç­‰å€¼æŸ¥è¯¢': {
        'recommended_scheme': 'deterministic',
        'performance': '2x overhead',
        'use_case': 'ç”¨æˆ·ç™»å½•ã€IDæŸ¥æ‰¾'
    },
    'èŒƒå›´æŸ¥è¯¢': {
        'recommended_scheme': 'OPE',
        'performance': '3x overhead',
        'use_case': 'å¹´é¾„èŒƒå›´ã€ä»·æ ¼åŒºé—´'
    },
    'èšåˆç»Ÿè®¡': {
        'recommended_scheme': 'Paillier',
        'performance': '50x overhead',
        'use_case': 'æ±‚å’Œã€å¹³å‡å€¼è®¡ç®—'
    },
    'å¤æ‚è®¡ç®—': {
        'recommended_scheme': 'FHE (è°¨æ…ä½¿ç”¨)',
        'performance': '1000x overhead',
        'use_case': 'æœºå™¨å­¦ä¹ ã€å¤æ‚åˆ†æ'
    }
}
```

#### **7.4.2 ä¼˜åŒ–ç­–ç•¥**

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ€§èƒ½ä¼˜åŒ–ç­–ç•¥                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  1. æ‰¹é‡æ“ä½œä¼˜åŒ–                                         â”‚
â”‚     - æ‰¹é‡åŠ å¯†/è§£å¯†å‡å°‘å‡½æ•°è°ƒç”¨å¼€é”€                       â”‚
â”‚     - ä½¿ç”¨äº‹åŠ¡æ‰¹é‡æäº¤                                    â”‚
â”‚     - é¢„æœŸæå‡ï¼š50-70%                                    â”‚
â”‚                                                          â”‚
â”‚  2. æ··åˆåŠ å¯†æ–¹æ¡ˆ                                         â”‚
â”‚     - æ•æ„Ÿæ•°æ®åŠ å¯†ï¼Œéæ•æ„Ÿæ•°æ®æ˜æ–‡                        â”‚
â”‚     - æ ¹æ®æŸ¥è¯¢æ¨¡å¼é€‰æ‹©åŠ å¯†æ–¹æ¡ˆ                            â”‚
â”‚     - é¢„æœŸæå‡ï¼šæ˜¾è‘—                                      â”‚
â”‚                                                          â”‚
â”‚  3. ç´¢å¼•ä¼˜åŒ–                                             â”‚
â”‚     - ä¸ºåŠ å¯†åˆ—åˆ›å»ºç´¢å¼•                                    â”‚
â”‚     - ä½¿ç”¨éƒ¨åˆ†ç´¢å¼•å‡å°‘ç´¢å¼•å¤§å°                            â”‚
â”‚     - é¢„æœŸæå‡ï¼š30-50%                                    â”‚
â”‚                                                          â”‚
â”‚  4. ç¼“å­˜ç­–ç•¥                                             â”‚
â”‚     - ç¼“å­˜å¸¸ç”¨åŠ å¯†å€¼                                      â”‚
â”‚     - ç¼“å­˜æŸ¥è¯¢ç»“æœ                                        â”‚
â”‚     - é¢„æœŸæå‡ï¼š20-40%                                    â”‚
â”‚                                                          â”‚
â”‚  5. ç¡¬ä»¶åŠ é€Ÿ                                             â”‚
â”‚     - GPUåŠ é€ŸåŠ å¯†è®¡ç®—                                     â”‚
â”‚     - FPGAä¸“ç”¨åŠ å¯†èŠ¯ç‰‡                                    â”‚
â”‚     - é¢„æœŸæå‡ï¼š10-100x                                   â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.5 æ€§èƒ½æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

```python
# performance_report.py

def generate_performance_report(results: Dict) -> str:
    """ç”Ÿæˆæ€§èƒ½æµ‹è¯•æŠ¥å‘Š"""
    report = f"""
# åŒæ€åŠ å¯†æ€§èƒ½æµ‹è¯•æŠ¥å‘Š

## æµ‹è¯•ç¯å¢ƒ
- æ•°æ®åº“: PostgreSQL 18
- CPU: Intel Xeon E5-2680 v4
- å†…å­˜: 64GB
- æµ‹è¯•æ—¶é—´: {datetime.now().isoformat()}

## æµ‹è¯•ç»“æœ

### æ’å…¥æ€§èƒ½
{_format_table(results['insert'])}

### æŸ¥è¯¢æ€§èƒ½
{_format_table(results['equality_query'])}

### èšåˆæ€§èƒ½
{_format_table(results['aggregate_sum'])}

## ç»“è®ºä¸å»ºè®®

1. **ç¡®å®šæ€§åŠ å¯†**ï¼šæ€§èƒ½å¼€é”€å¯æ¥å—ï¼ˆ2-3xï¼‰ï¼Œé€‚åˆé«˜é¢‘æŸ¥è¯¢
2. **OPEåŠ å¯†**ï¼šèŒƒå›´æŸ¥è¯¢æ€§èƒ½è‰¯å¥½ï¼ˆ3xï¼‰ï¼Œé€‚åˆæ’åºå’ŒèŒƒå›´æ“ä½œ
3. **PaillieråŠ å¯†**ï¼šèšåˆæ“ä½œæ€§èƒ½å¼€é”€è¾ƒå¤§ï¼ˆ50xï¼‰ï¼Œé€‚åˆæ‰¹é‡å¤„ç†
4. **FHEåŠ å¯†**ï¼šæ€§èƒ½å¼€é”€å·¨å¤§ï¼ˆ1000xï¼‰ï¼Œä»…é€‚åˆç‰¹æ®Šåœºæ™¯

## ä¼˜åŒ–å»ºè®®

- ä½¿ç”¨æ‰¹é‡æ“ä½œæé«˜ååé‡
- æ ¹æ®æŸ¥è¯¢æ¨¡å¼é€‰æ‹©åŠ å¯†æ–¹æ¡ˆ
- è€ƒè™‘æ··åˆåŠ å¯†æ–¹æ¡ˆå¹³è¡¡å®‰å…¨å’Œæ€§èƒ½
- å¯¹äºé«˜æ€§èƒ½åœºæ™¯ï¼Œè€ƒè™‘ç¡¬ä»¶åŠ é€Ÿ
"""
    return report
```

### 7.6 æ€§èƒ½ç›‘æ§æŒ‡æ ‡

```sql
-- æ€§èƒ½ç›‘æ§è§†å›¾
CREATE OR REPLACE VIEW performance_metrics_view AS
SELECT
    operation_type,
    encryption_scheme,
    DATE_TRUNC('hour', created_at) as hour,
    COUNT(*) as operation_count,
    AVG(execution_time_ms) as avg_time_ms,
    PERCENTILE_CONT(0.95) WITHIN GROUP (ORDER BY execution_time_ms) as p95_time_ms,
    PERCENTILE_CONT(0.99) WITHIN GROUP (ORDER BY execution_time_ms) as p99_time_ms,
    MAX(execution_time_ms) as max_time_ms
FROM performance_metrics
WHERE created_at >= NOW() - INTERVAL '24 hours'
GROUP BY operation_type, encryption_scheme, hour
ORDER BY hour DESC, operation_type;

-- æ€§èƒ½è¶‹åŠ¿æŸ¥è¯¢
SELECT
    operation_type,
    encryption_scheme,
    AVG(avg_time_ms) as avg_time_ms,
    AVG(p95_time_ms) as avg_p95_ms
FROM performance_metrics_view
GROUP BY operation_type, encryption_scheme
ORDER BY operation_type, avg_time_ms;
```

---

**æ€§èƒ½æµ‹è¯•æ€»ç»“**ï¼š

| æ“ä½œ | æ˜æ–‡ | ç¡®å®šæ€§åŠ å¯† | OPE | Paillier | FHE |
|------|------|-----------|-----|----------|-----|
| ç­‰å€¼æŸ¥è¯¢ | 1ms | 2ms (2x) | - | - | - |
| èŒƒå›´æŸ¥è¯¢ | 5ms | - | 15ms (3x) | - | 200ms (40x) |
| æ±‚å’Œ | 10ms | - | - | 500ms (50x) | 5s (500x) |
| å¤æ‚è®¡ç®— | 100ms | - | - | - | 100s (1000x) |

**ç»“è®º**ï¼š

- âœ… ç¡®å®šæ€§åŠ å¯†ï¼šæ€§èƒ½å¯æ¥å—ï¼ˆ2xï¼‰ï¼Œé€‚åˆé«˜é¢‘æŸ¥è¯¢åœºæ™¯
- âš ï¸ OPEï¼šæ€§èƒ½å½±å“è¾ƒå°ï¼ˆ3xï¼‰ï¼Œé€‚åˆèŒƒå›´æŸ¥è¯¢å’Œæ’åº
- âŒ Paillierï¼šæ€§èƒ½å½±å“å¤§ï¼ˆ50xï¼‰ï¼Œé€‚åˆæ‰¹é‡èšåˆæ“ä½œ
- âŒ FHEï¼šæ€§èƒ½å½±å“å·¨å¤§ï¼ˆ1000xï¼‰ï¼Œä»…é€‚åˆç‰¹æ®Šé«˜å®‰å…¨åœºæ™¯

---

## å…«ã€æ€»ç»“ä¸å±•æœ›

### 8.1 æ ¸å¿ƒæ”¶è·

#### **8.1.1 æŠ€æœ¯è¦ç‚¹æ€»ç»“**

1. **åŒæ€åŠ å¯†æä¾›æé«˜å®‰å…¨æ€§**
   - æ•°æ®å§‹ç»ˆåŠ å¯†ï¼Œå³ä½¿æ•°æ®åº“ç®¡ç†å‘˜ä¹Ÿæ— æ³•è®¿é—®æ˜æ–‡
   - æ”¯æŒé›¶ä¿¡ä»»æ¶æ„ï¼Œä¸ä¿¡ä»»ä»»ä½•ä¸­é—´æ–¹
   - ç¬¦åˆGDPRã€HIPAAç­‰ä¸¥æ ¼åˆè§„è¦æ±‚

2. **Paillieré€‚åˆæ±‚å’Œç­‰èšåˆæ“ä½œ**
   - åŠ æ³•åŒæ€ç‰¹æ€§å®Œç¾æ”¯æŒSUMã€AVGç­‰èšåˆå‡½æ•°
   - æ€§èƒ½å¼€é”€çº¦50å€ï¼Œåœ¨å¯æ¥å—èŒƒå›´å†…
   - é€‚åˆé‡‘èç»Ÿè®¡ã€åŒ»ç–—æ•°æ®åˆ†æç­‰åœºæ™¯

3. **æ€§èƒ½å¼€é”€æ˜¯ä¸»è¦æŒ‘æˆ˜**
   - ç¡®å®šæ€§åŠ å¯†ï¼š2-3å€å¼€é”€ï¼ˆå¯æ¥å—ï¼‰
   - OPEåŠ å¯†ï¼š3å€å¼€é”€ï¼ˆå¯æ¥å—ï¼‰
   - PaillieråŠ å¯†ï¼š50å€å¼€é”€ï¼ˆéœ€ä¼˜åŒ–ï¼‰
   - FHEåŠ å¯†ï¼š1000å€å¼€é”€ï¼ˆä»…ç‰¹æ®Šåœºæ™¯ï¼‰

4. **æ··åˆæ–¹æ¡ˆå¯å¹³è¡¡å®‰å…¨å’Œæ€§èƒ½**
   - æ ¹æ®æ•°æ®æ•æ„Ÿåº¦å’ŒæŸ¥è¯¢æ¨¡å¼é€‰æ‹©åŠ å¯†æ–¹æ¡ˆ
   - æ•æ„Ÿæ•°æ®åŠ å¯†ï¼Œéæ•æ„Ÿæ•°æ®æ˜æ–‡
   - å®ç°å®‰å…¨æ€§å’Œæ€§èƒ½çš„æœ€ä½³å¹³è¡¡

#### **8.1.2 å…³é”®æŠ€æœ¯å†³ç­–**

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å…³é”®æŠ€æœ¯å†³ç­–çŸ©é˜µ                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  æŸ¥è¯¢ç±»å‹         æ¨èæ–¹æ¡ˆ        æ€§èƒ½å¼€é”€    å®‰å…¨æ€§     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ç­‰å€¼æŸ¥è¯¢         ç¡®å®šæ€§åŠ å¯†       2x         â­â­â­     â”‚
â”‚  èŒƒå›´æŸ¥è¯¢         OPE             3x         â­â­       â”‚
â”‚  èšåˆæ±‚å’Œ         Paillier        50x        â­â­â­â­   â”‚
â”‚  å¤æ‚è®¡ç®—         FHE             1000x      â­â­â­â­â­ â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 é€‚ç”¨åœºæ™¯

#### **8.2.1 æ¨èä½¿ç”¨åœºæ™¯**

**1. é‡‘èæ•æ„Ÿæ•°æ®**

- âœ… é“¶è¡Œè´¦æˆ·ä½™é¢åŠ å¯†å­˜å‚¨
- âœ… äº¤æ˜“è®°å½•éšç§ä¿æŠ¤
- âœ… é£æ§æ•°æ®åˆ†æï¼ˆä¸æ³„éœ²ä¸ªäººéšç§ï¼‰
- âœ… å¤šæœºæ„æ•°æ®å…±äº«åˆ†æ

**2. åŒ»ç–—éšç§æ•°æ®**

- âœ… ç”µå­ç—…å†åŠ å¯†å­˜å‚¨
- âœ… åŸºå› æ•°æ®éšç§ä¿æŠ¤
- âœ… æµè¡Œç—…å­¦ç ”ç©¶ï¼ˆç»Ÿè®¡åˆ†æä¸æ³„éœ²ä¸ªäººéšç§ï¼‰
- âœ… è·¨æœºæ„åŒ»ç–—æ•°æ®å…±äº«

**3. äº‘ç«¯å¤šç§Ÿæˆ·**

- âœ… SaaSå¹³å°æ•°æ®éš”ç¦»
- âœ… äº‘æ•°æ®åº“æ•°æ®ä¸»æƒ
- âœ… ä¸ä¿¡ä»»äº‘æœåŠ¡å•†çš„åœºæ™¯
- âœ… åˆè§„æ€§è¦æ±‚æé«˜çš„åœºæ™¯

**4. æ”¿åŠ¡æ•æ„Ÿæ•°æ®**

- âœ… å…¬æ°‘ä¸ªäººä¿¡æ¯ä¿æŠ¤
- âœ… è·¨éƒ¨é—¨æ•°æ®å…±äº«
- âœ… ç­‰ä¿2.0åˆè§„è¦æ±‚
- âœ… æ•°æ®ä¸»æƒä¿æŠ¤

#### **8.2.2 ä¸æ¨èä½¿ç”¨åœºæ™¯**

**1. é«˜æ€§èƒ½è¦æ±‚åœºæ™¯**

- âŒ å®æ—¶äº¤æ˜“ç³»ç»Ÿï¼ˆ<10mså“åº”è¦æ±‚ï¼‰
- âŒ é«˜é¢‘æŸ¥è¯¢ç³»ç»Ÿï¼ˆQPS > 10000ï¼‰
- âŒ ä½å»¶è¿Ÿè¦æ±‚ï¼ˆ<5msï¼‰
- âŒ å®æ—¶æ¨èç³»ç»Ÿ

**2. å¤æ‚æŸ¥è¯¢é¢‘ç¹åœºæ™¯**

- âŒ å¤æ‚JOINæ“ä½œ
- âŒ å¤šè¡¨å…³è”æŸ¥è¯¢
- âŒ å¤æ‚å­æŸ¥è¯¢
- âŒ å…¨æ–‡æœç´¢

**3. å®‰å…¨è¦æ±‚ä¸é«˜åœºæ™¯**

- âŒ å†…éƒ¨ç³»ç»Ÿï¼ˆä¿¡ä»»ç¯å¢ƒï¼‰
- âŒ éæ•æ„Ÿæ•°æ®
- âŒ ä¸´æ—¶æ•°æ®
- âŒ å…¬å¼€æ•°æ®

**4. èµ„æºå—é™åœºæ™¯**

- âŒ å¼€å‘å’Œç»´æŠ¤èµ„æºä¸è¶³
- âŒ é¢„ç®—æœ‰é™çš„é¡¹ç›®
- âŒ å°è§„æ¨¡åº”ç”¨
- âŒ å¿«é€ŸåŸå‹å¼€å‘

### 8.3 æŠ€æœ¯å‘å±•è¶‹åŠ¿

#### **8.3.1 æ€§èƒ½ä¼˜åŒ–æ–¹å‘**

**1. ç¡¬ä»¶åŠ é€Ÿ**

- GPUåŠ é€ŸåŒæ€åŠ å¯†è®¡ç®—ï¼ˆ10-100xæå‡ï¼‰
- FPGAä¸“ç”¨åŠ å¯†èŠ¯ç‰‡
- ä¸“ç”¨åŠ å¯†å¤„ç†å™¨ï¼ˆASICï¼‰
- é¢„æœŸï¼šæœªæ¥3-5å¹´æ€§èƒ½æå‡10-100å€

**2. ç®—æ³•ä¼˜åŒ–**

- æ›´é«˜æ•ˆçš„åŠ å¯†ç®—æ³•
- ä¼˜åŒ–çš„åŒæ€æ“ä½œ
- æ‰¹é‡æ“ä½œä¼˜åŒ–
- é¢„æœŸï¼šæœªæ¥2-3å¹´æ€§èƒ½æå‡2-5å€

**3. ç³»ç»Ÿæ¶æ„ä¼˜åŒ–**

- åˆ†å¸ƒå¼åŒæ€åŠ å¯†è®¡ç®—
- æŸ¥è¯¢ä¼˜åŒ–å™¨é›†æˆ
- æ™ºèƒ½ç¼“å­˜ç­–ç•¥
- é¢„æœŸï¼šæœªæ¥1-2å¹´æ€§èƒ½æå‡30-50%

#### **8.3.2 åŠŸèƒ½æ‰©å±•æ–¹å‘**

**1. æ›´å¤šæŸ¥è¯¢ç±»å‹æ”¯æŒ**

- å¤æ‚JOINæ“ä½œ
- å­æŸ¥è¯¢æ”¯æŒ
- çª—å£å‡½æ•°æ”¯æŒ
- å…¨æ–‡æœç´¢æ”¯æŒ

**2. æ›´å¥½çš„å¼€å‘ä½“éªŒ**

- SQLè‡ªåŠ¨è½¬æ¢
- é€æ˜åŠ å¯†å±‚
- å¼€å‘å·¥å…·æ”¯æŒ
- è°ƒè¯•å·¥å…·

**3. æ›´å¼ºçš„å®‰å…¨æ€§**

- åé‡å­å¯†ç å­¦
- é›¶çŸ¥è¯†è¯æ˜é›†æˆ
- å®‰å…¨å¤šæ–¹è®¡ç®—
- å·®åˆ†éšç§

### 8.4 æœªæ¥å±•æœ›

#### **8.4.1 çŸ­æœŸï¼ˆ1-2å¹´ï¼‰**

- âœ… æ›´å¤šæ•°æ®åº“æ”¯æŒï¼ˆMySQLã€MongoDBç­‰ï¼‰
- âœ… æ€§èƒ½ä¼˜åŒ–ï¼ˆ2-5å€æå‡ï¼‰
- âœ… æ›´å¥½çš„å¼€å‘å·¥å…·
- âœ… æ ‡å‡†åŒ–æ¨è¿›

#### **8.4.2 ä¸­æœŸï¼ˆ3-5å¹´ï¼‰**

- âœ… ç¡¬ä»¶åŠ é€Ÿæ™®åŠ
- âœ… æ€§èƒ½æ¥è¿‘å®ç”¨æ°´å¹³ï¼ˆ<10å€å¼€é”€ï¼‰
- âœ… æ›´å¤šåº”ç”¨åœºæ™¯
- âœ… è¡Œä¸šæ ‡å‡†å»ºç«‹

#### **8.4.3 é•¿æœŸï¼ˆ5-10å¹´ï¼‰**

- âœ… æ€§èƒ½å¼€é”€é™è‡³å¯å¿½ç•¥æ°´å¹³ï¼ˆ<2å€ï¼‰
- âœ… æˆä¸ºæ•°æ®åº“æ ‡å‡†åŠŸèƒ½
- âœ… å¹¿æ³›åº”ç”¨åˆ°å„ä¸ªè¡Œä¸š
- âœ… åé‡å­å¯†ç å­¦æˆç†Ÿ

### 8.5 å¸¸è§é—®é¢˜è§£ç­”ï¼ˆFAQï¼‰

#### **Q1: åŒæ€åŠ å¯†æ€§èƒ½å¼€é”€æœ‰å¤šå¤§ï¼Ÿ**

**A**: å–å†³äºåŠ å¯†æ–¹æ¡ˆï¼š

- ç¡®å®šæ€§åŠ å¯†ï¼š2-3å€å¼€é”€ï¼ˆå¯æ¥å—ï¼‰
- OPEåŠ å¯†ï¼š3å€å¼€é”€ï¼ˆå¯æ¥å—ï¼‰
- PaillieråŠ å¯†ï¼š50å€å¼€é”€ï¼ˆéœ€ä¼˜åŒ–ï¼‰
- FHEåŠ å¯†ï¼š1000å€å¼€é”€ï¼ˆä»…ç‰¹æ®Šåœºæ™¯ï¼‰

#### **Q2: æ˜¯å¦æ‰€æœ‰SQLæ“ä½œéƒ½æ”¯æŒï¼Ÿ**

**A**: ä¸æ˜¯ã€‚ç›®å‰ä¸»è¦æ”¯æŒï¼š

- âœ… ç­‰å€¼æŸ¥è¯¢ï¼ˆç¡®å®šæ€§åŠ å¯†ï¼‰
- âœ… èŒƒå›´æŸ¥è¯¢ï¼ˆOPEï¼‰
- âœ… èšåˆæ±‚å’Œï¼ˆPaillierï¼‰
- âŒ å¤æ‚JOINï¼ˆä¸æ”¯æŒï¼‰
- âŒ å¤æ‚å­æŸ¥è¯¢ï¼ˆä¸æ”¯æŒï¼‰

#### **Q3: å¯†é’¥ä¸¢å¤±äº†æ€ä¹ˆåŠï¼Ÿ**

**A**: å¯†é’¥ä¸¢å¤±æ„å‘³ç€æ•°æ®æ— æ³•è§£å¯†ã€‚å»ºè®®ï¼š

- ä½¿ç”¨KMSç®¡ç†å¯†é’¥
- å®šæœŸå¤‡ä»½å¯†é’¥ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰
- å¯†é’¥è½®æ¢ç­–ç•¥
- å¤šå¯†é’¥å‰¯æœ¬ï¼ˆå®‰å…¨å­˜å‚¨ï¼‰

#### **Q4: å¦‚ä½•é€‰æ‹©åŠ å¯†æ–¹æ¡ˆï¼Ÿ**

**A**: æ ¹æ®æŸ¥è¯¢æ¨¡å¼é€‰æ‹©ï¼š

- ç­‰å€¼æŸ¥è¯¢ â†’ ç¡®å®šæ€§åŠ å¯†
- èŒƒå›´æŸ¥è¯¢ â†’ OPE
- èšåˆæ“ä½œ â†’ Paillier
- å¤æ‚è®¡ç®— â†’ FHEï¼ˆè°¨æ…ä½¿ç”¨ï¼‰

#### **Q5: æ€§èƒ½å¦‚ä½•ä¼˜åŒ–ï¼Ÿ**

**A**: ä¼˜åŒ–ç­–ç•¥ï¼š

- æ‰¹é‡æ“ä½œï¼ˆ50-70%æå‡ï¼‰
- æ··åˆåŠ å¯†æ–¹æ¡ˆï¼ˆæ˜¾è‘—æå‡ï¼‰
- ç¡¬ä»¶åŠ é€Ÿï¼ˆ10-100xæå‡ï¼‰
- ç´¢å¼•ä¼˜åŒ–ï¼ˆ30-50%æå‡ï¼‰

#### **Q6: æ˜¯å¦ç¬¦åˆåˆè§„è¦æ±‚ï¼Ÿ**

**A**: æ˜¯çš„ï¼Œç¬¦åˆï¼š

- âœ… GDPRï¼ˆæ¬§ç›Ÿæ•°æ®ä¿æŠ¤æ¡ä¾‹ï¼‰
- âœ… HIPAAï¼ˆç¾å›½åŒ»ç–—æ•°æ®ä¿æŠ¤ï¼‰
- âœ… ç­‰ä¿2.0ï¼ˆä¸­å›½ç½‘ç»œå®‰å…¨ç­‰çº§ä¿æŠ¤ï¼‰
- âœ… PCI DSSï¼ˆæ”¯ä»˜å¡è¡Œä¸šæ•°æ®å®‰å…¨æ ‡å‡†ï¼‰

### 8.6 æœ€ä½³å®è·µæ€»ç»“

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åŒæ€åŠ å¯†æœ€ä½³å®è·µæ¸…å•                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  âœ… è®¾è®¡é˜¶æ®µ                                             â”‚
â”‚     - æ˜ç¡®å®‰å…¨éœ€æ±‚                                       â”‚
â”‚     - è¯„ä¼°æ€§èƒ½è¦æ±‚                                       â”‚
â”‚     - é€‰æ‹©åˆé€‚çš„åŠ å¯†æ–¹æ¡ˆ                                 â”‚
â”‚     - è®¾è®¡å¯†é’¥ç®¡ç†ç­–ç•¥                                   â”‚
â”‚                                                          â”‚
â”‚  âœ… å¼€å‘é˜¶æ®µ                                             â”‚
â”‚     - ä½¿ç”¨æˆç†Ÿçš„åŠ å¯†åº“                                   â”‚
â”‚     - å®ç°å®Œæ•´çš„é”™è¯¯å¤„ç†                                 â”‚
â”‚     - æ·»åŠ æ€§èƒ½ç›‘æ§                                       â”‚
â”‚     - ç¼–å†™å•å…ƒæµ‹è¯•                                       â”‚
â”‚                                                          â”‚
â”‚  âœ… éƒ¨ç½²é˜¶æ®µ                                             â”‚
â”‚     - ä½¿ç”¨KMSç®¡ç†å¯†é’¥                                    â”‚
â”‚     - é…ç½®å®¡è®¡æ—¥å¿—                                       â”‚
â”‚     - è®¾ç½®ç›‘æ§å‘Šè­¦                                       â”‚
â”‚     - å‡†å¤‡åº”æ€¥å“åº”é¢„æ¡ˆ                                   â”‚
â”‚                                                          â”‚
â”‚  âœ… è¿ç»´é˜¶æ®µ                                             â”‚
â”‚     - å®šæœŸå¯†é’¥è½®æ¢                                       â”‚
â”‚     - ç›‘æ§æ€§èƒ½æŒ‡æ ‡                                       â”‚
â”‚     - å®¡è®¡å®‰å…¨äº‹ä»¶                                       â”‚
â”‚     - æŒç»­ä¼˜åŒ–æ€§èƒ½                                       â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.7 å­¦ä¹ è·¯å¾„å»ºè®®

**åˆå­¦è€…**ï¼š

1. ç†è§£åŒæ€åŠ å¯†åŸºæœ¬æ¦‚å¿µ
2. å­¦ä¹ PaillieråŠ å¯†åŸç†
3. å®ç°ç®€å•çš„åŠ å¯†/è§£å¯†æ“ä½œ
4. å®ç°ç®€å•çš„åŒæ€åŠ æ³•

**ä¸­çº§å¼€å‘è€…**ï¼š

1. æŒæ¡å¤šç§åŠ å¯†æ–¹æ¡ˆ
2. å®ç°å®Œæ•´çš„æŸ¥è¯¢ç³»ç»Ÿ
3. æ€§èƒ½ä¼˜åŒ–å®è·µ
4. å¯†é’¥ç®¡ç†å®è·µ

**é«˜çº§å¼€å‘è€…**ï¼š

1. æ·±å…¥ç†è§£åŠ å¯†ç®—æ³•
2. ç³»ç»Ÿæ¶æ„è®¾è®¡
3. æ€§èƒ½è°ƒä¼˜ä¸“å®¶
4. å®‰å…¨å®¡è®¡ä¸“å®¶

### 8.8 æ€»ç»“

åŒæ€åŠ å¯†æ˜¯ä¸€é¡¹**é©å‘½æ€§çš„å®‰å…¨æŠ€æœ¯**ï¼Œè™½ç„¶ç›®å‰å­˜åœ¨æ€§èƒ½æŒ‘æˆ˜ï¼Œä½†åœ¨é«˜å®‰å…¨è¦æ±‚çš„åœºæ™¯ä¸­å…·æœ‰ä¸å¯æ›¿ä»£çš„ä»·å€¼ã€‚
éšç€ç¡¬ä»¶åŠ é€Ÿå’Œç®—æ³•ä¼˜åŒ–çš„æ¨è¿›ï¼ŒåŒæ€åŠ å¯†å°†åœ¨æœªæ¥æˆä¸ºæ•°æ®åº“å®‰å…¨çš„æ ‡å‡†åŠŸèƒ½ã€‚

**å…³é”®è¦ç‚¹**ï¼š

- ğŸ” **å®‰å…¨æ€§æé«˜**ï¼šæ•°æ®å§‹ç»ˆåŠ å¯†ï¼Œé›¶ä¿¡ä»»æ¶æ„
- âš¡ **æ€§èƒ½éœ€ä¼˜åŒ–**ï¼šé€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆï¼Œå¹³è¡¡å®‰å…¨å’Œæ€§èƒ½
- ğŸ¯ **åœºæ™¯è¦åŒ¹é…**ï¼šé«˜å®‰å…¨è¦æ±‚åœºæ™¯çš„æœ€ä½³é€‰æ‹©
- ğŸš€ **æœªæ¥å¯æœŸ**ï¼šç¡¬ä»¶åŠ é€Ÿå’Œç®—æ³•ä¼˜åŒ–å°†å¤§å¹…æå‡æ€§èƒ½

---

## ä¹ã€å‚è€ƒèµ„æ–™

### 9.1 å­¦æœ¯è®ºæ–‡

1. **Enc2DB: A Hybrid and Adaptive Encrypted Query Processing Framework**
   - é“¾æ¥: [https://arxiv.org/abs/2404.06819](https://arxiv.org/abs/2404.06819)
   - æ‘˜è¦: æ··åˆè‡ªé€‚åº”åŠ å¯†æŸ¥è¯¢å¤„ç†æ¡†æ¶ï¼Œè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜åŠ å¯†æ–¹æ¡ˆ

2. **CryptDB: Protecting Confidentiality with Encrypted Query Processing**
   - ä½œè€…: Raluca Ada Popa, Catherine M. S. Redfield, Nickolai Zeldovich, Hari Balakrishnan
   - é“¾æ¥: [https://css.csail.mit.edu/cryptdb/](https://css.csail.mit.edu/cryptdb/)
   - æ‘˜è¦: ä½¿ç”¨SQLæ„ŸçŸ¥åŠ å¯†ä¿æŠ¤æ•°æ®åº“æœºå¯†æ€§

3. **Fully Homomorphic Encryption Using Ideal Lattices**
   - ä½œè€…: Craig Gentry
   - æ‘˜è¦: å…¨åŒæ€åŠ å¯†çš„å¼€åˆ›æ€§è®ºæ–‡

4. **Public-Key Cryptosystems Based on Composite Degree Residuosity Classes**
   - ä½œè€…: Pascal Paillier
   - æ‘˜è¦: PaillieråŠ å¯†æ–¹æ¡ˆçš„åŸå§‹è®ºæ–‡

5. **Order-Preserving Encryption Revisited: Improved Security Analysis and Alternative Solutions**
   - ä½œè€…: Alexandra Boldyreva, Nathan Chenette, Younho Lee, Adam O'Neill
   - æ‘˜è¦: OPEåŠ å¯†çš„å®‰å…¨åˆ†æå’Œæ”¹è¿›æ–¹æ¡ˆ

### 9.2 å¼€æºåº“å’Œå·¥å…·

#### **9.2.1 Pythonåº“**

1. **python-paillier**
   - GitHub: [https://github.com/data61/python-paillier](https://github.com/data61/python-paillier)
   - æè¿°: PaillieråŒæ€åŠ å¯†çš„Pythonå®ç°
   - å®‰è£…: `pip install phe`

2. **TenSEAL**
   - GitHub: [https://github.com/OpenMined/TenSEAL](https://github.com/OpenMined/TenSEAL)
   - æè¿°: Microsoft SEALçš„Pythonå°è£…ï¼Œæ”¯æŒå…¨åŒæ€åŠ å¯†
   - å®‰è£…: `pip install tenseal`

3. **PyCryptodome**
   - GitHub: [https://github.com/Legrandin/pycryptodome](https://github.com/Legrandin/pycryptodome)
   - æè¿°: å¯†ç å­¦ç®—æ³•åº“ï¼Œæ”¯æŒAESã€RSAç­‰
   - å®‰è£…: `pip install pycryptodome`

4. **pyope**
   - GitHub: [https://github.com/ssmiler/pyope](https://github.com/ssmiler/pyope)
   - æè¿°: é¡ºåºä¿æŒåŠ å¯†ï¼ˆOPEï¼‰çš„Pythonå®ç°
   - å®‰è£…: `pip install pyope`

#### **9.2.2 C++åº“**

1. **Microsoft SEAL**
   - GitHub: [https://github.com/microsoft/SEAL](https://github.com/microsoft/SEAL)
   - æè¿°: Microsoftå¼€å‘çš„å…¨åŒæ€åŠ å¯†åº“
   - è¯­è¨€: C++
   - ç‰¹ç‚¹: é«˜æ€§èƒ½ï¼Œæ”¯æŒBFVå’ŒCKKSæ–¹æ¡ˆ

2. **OpenFHE**
   - å®˜ç½‘: [https://www.openfhe.org/](https://www.openfhe.org/)
   - GitHub: [https://github.com/openfheorg/openfhe](https://github.com/openfheorg/openfhe)
   - æè¿°: å¼€æºå…¨åŒæ€åŠ å¯†åº“
   - ç‰¹ç‚¹: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ”¯æŒå¤šç§FHEæ–¹æ¡ˆ

3. **HElib**
   - GitHub: [https://github.com/homenc/HElib](https://github.com/homenc/HElib)
   - æè¿°: IBMå¼€å‘çš„å…¨åŒæ€åŠ å¯†åº“
   - ç‰¹ç‚¹: æˆç†Ÿçš„BGVå’ŒCKKSå®ç°

#### **9.2.3 æ•°æ®åº“æ‰©å±•**

1. **PostgreSQL pgcrypto**
   - æ–‡æ¡£: [https://www.postgresql.org/docs/current/pgcrypto.html](https://www.postgresql.org/docs/current/pgcrypto.html)
   - æè¿°: PostgreSQLçš„åŠ å¯†æ‰©å±•
   - åŠŸèƒ½: åŸºç¡€åŠ å¯†å‡½æ•°æ”¯æŒ

2. **MongoDB Field-Level Encryption**
   - æ–‡æ¡£: [https://www.mongodb.com/docs/manual/core/security-client-side-field-level-encryption/](https://www.mongodb.com/docs/manual/core/security-client-side-field-level-encryption/)
   - æè¿°: MongoDBçš„å­—æ®µçº§åŠ å¯†

### 9.3 æ•™ç¨‹å’Œæ–‡æ¡£

1. **Microsoft SEALæ•™ç¨‹**
   - é“¾æ¥: [https://github.com/microsoft/SEAL/tree/main/native/examples](https://github.com/microsoft/SEAL/tree/main/native/examples)
   - å†…å®¹: SEALåº“çš„ä½¿ç”¨ç¤ºä¾‹å’Œæ•™ç¨‹

2. **åŒæ€åŠ å¯†å…¥é—¨æ•™ç¨‹**
   - é“¾æ¥: [https://blog.openmined.org/what-is-homomorphic-encryption/](https://blog.openmined.org/what-is-homomorphic-encryption/)
   - å†…å®¹: OpenMinedçš„åŒæ€åŠ å¯†å…¥é—¨æŒ‡å—

3. **PostgreSQLå®‰å…¨æœ€ä½³å®è·µ**
   - é“¾æ¥: [https://www.postgresql.org/docs/current/security.html](https://www.postgresql.org/docs/current/security.html)
   - å†…å®¹: PostgreSQLå®˜æ–¹å®‰å…¨æ–‡æ¡£

### 9.4 æ ‡å‡†å’Œè§„èŒƒ

1. **NISTåé‡å­å¯†ç å­¦æ ‡å‡†**
   - é“¾æ¥: [https://csrc.nist.gov/projects/post-quantum-cryptography](https://csrc.nist.gov/projects/post-quantum-cryptography)
   - å†…å®¹: åé‡å­å¯†ç å­¦æ ‡å‡†åŒ–è¿›ç¨‹

2. **ISO/IEC 18033-6: Homomorphic Encryption**
   - æè¿°: åŒæ€åŠ å¯†çš„å›½é™…æ ‡å‡†

3. **FIPS 140-2**
   - é“¾æ¥: [https://csrc.nist.gov/publications/detail/fips/140/2/final](https://csrc.nist.gov/publications/detail/fips/140/2/final)
   - å†…å®¹: å¯†ç æ¨¡å—å®‰å…¨è¦æ±‚

### 9.5 ç›¸å…³é¡¹ç›®å’Œæ¡ˆä¾‹

1. **CryptDB**
   - GitHub: [https://github.com/CryptDB/cryptdb](https://github.com/CryptDB/cryptdb)
   - æè¿°: MITå¼€å‘çš„åŠ å¯†æ•°æ®åº“ç³»ç»Ÿ

2. **ZeroDB**
   - GitHub: [https://github.com/zero-db/zerodb](https://github.com/zero-db/zerodb)
   - æè¿°: ç«¯åˆ°ç«¯åŠ å¯†æ•°æ®åº“

3. **Enigma**
   - GitHub: [https://github.com/enigmampc/enigma-core](https://github.com/enigmampc/enigma-core)
   - æè¿°: å»ä¸­å¿ƒåŒ–éšç§è®¡ç®—å¹³å°

### 9.6 åœ¨çº¿å·¥å…·å’Œè®¡ç®—å™¨

#### **9.6.1 åŠ å¯†/è§£å¯†å·¥å…·**

1. **PaillieråŠ å¯†åœ¨çº¿æ¼”ç¤º**
   - æè¿°: åœ¨çº¿PaillieråŠ å¯†/è§£å¯†å·¥å…·
   - ç”¨é€”: å­¦ä¹ å’Œæµ‹è¯•PaillieråŠ å¯†
   - åŠŸèƒ½:
     - å¯†é’¥ç”Ÿæˆ
     - åŠ å¯†/è§£å¯†æ“ä½œ
     - åŒæ€åŠ æ³•æ¼”ç¤º
     - æ ‡é‡ä¹˜æ³•æ¼”ç¤º

2. **RSAåŠ å¯†åœ¨çº¿å·¥å…·**
   - é“¾æ¥: [https://www.devglan.com/online-tools/rsa-encryption-decryption](https://www.devglan.com/online-tools/rsa-encryption-decryption)
   - æè¿°: RSAåŠ å¯†/è§£å¯†åœ¨çº¿å·¥å…·
   - ç”¨é€”: ç†è§£RSAåŒæ€ä¹˜æ³•ç‰¹æ€§

3. **AESåŠ å¯†åœ¨çº¿å·¥å…·**
   - é“¾æ¥: [https://www.devglan.com/online-tools/aes-encryption-decryption](https://www.devglan.com/online-tools/aes-encryption-decryption)
   - æè¿°: AESåŠ å¯†/è§£å¯†åœ¨çº¿å·¥å…·
   - ç”¨é€”: æµ‹è¯•ç¡®å®šæ€§åŠ å¯†å’ŒéšæœºåŠ å¯†

#### **9.6.2 æ€§èƒ½è®¡ç®—å™¨**

1. **åŒæ€åŠ å¯†æ€§èƒ½è®¡ç®—å™¨**
   - æè¿°: ä¼°ç®—åŒæ€åŠ å¯†æ“ä½œçš„æ€§èƒ½å¼€é”€
   - ç”¨é€”: ç³»ç»Ÿè®¾è®¡å’Œå®¹é‡è§„åˆ’
   - åŠŸèƒ½:
     - æ ¹æ®æ•°æ®é‡ä¼°ç®—åŠ å¯†æ—¶é—´
     - æ ¹æ®æŸ¥è¯¢ç±»å‹ä¼°ç®—æŸ¥è¯¢æ—¶é—´
     - è®¡ç®—ååé‡å’Œå»¶è¿Ÿ
     - èµ„æºéœ€æ±‚ä¼°ç®—ï¼ˆCPUã€å†…å­˜ï¼‰

2. **å¯†é’¥å¤§å°è®¡ç®—å™¨**
   - æè¿°: è®¡ç®—ä¸åŒå®‰å…¨çº§åˆ«æ‰€éœ€çš„å¯†é’¥å¤§å°
   - ç”¨é€”: å¯†é’¥ç®¡ç†è§„åˆ’
   - åŠŸèƒ½:
     - RSAå¯†é’¥å¤§å°è®¡ç®—
     - Paillierå¯†é’¥å¤§å°è®¡ç®—
     - å®‰å…¨çº§åˆ«å¯¹åº”å…³ç³»

#### **9.6.3 å®‰å…¨åˆ†æå·¥å…·**

1. **å¯†ç å¼ºåº¦åˆ†æå™¨**
   - æè¿°: åˆ†æå¯†ç å’Œå¯†é’¥çš„å¼ºåº¦
   - ç”¨é€”: å¯†é’¥ç”ŸæˆéªŒè¯

2. **åŠ å¯†æ–¹æ¡ˆå¯¹æ¯”å·¥å…·**
   - æè¿°: å¯¹æ¯”ä¸åŒåŠ å¯†æ–¹æ¡ˆçš„æ€§èƒ½å’Œå®‰å…¨ç‰¹æ€§
   - ç”¨é€”: æ–¹æ¡ˆé€‰æ‹©å†³ç­–

### 9.7 ç¤¾åŒºå’Œè®ºå›

1. **OpenMinedç¤¾åŒº**
   - é“¾æ¥: [https://www.openmined.org/](https://www.openmined.org/)
   - æè¿°: éšç§ä¿æŠ¤æœºå™¨å­¦ä¹ å’ŒåŒæ€åŠ å¯†ç¤¾åŒº

2. **Stack Overflow - Homomorphic Encryptionæ ‡ç­¾**
   - é“¾æ¥: [https://stackoverflow.com/questions/tagged/homomorphic-encryption](https://stackoverflow.com/questions/tagged/homomorphic-encryption)
   - æè¿°: åŒæ€åŠ å¯†ç›¸å…³çš„æŠ€æœ¯é—®ç­”

3. **Reddit - r/crypto**
   - é“¾æ¥: [https://www.reddit.com/r/crypto/](https://www.reddit.com/r/crypto/)
   - æè¿°: å¯†ç å­¦è®¨è®ºç¤¾åŒº

### 9.8 ä¹¦ç±æ¨è

#### **9.8.1 å¯†ç å­¦åŸºç¡€**

1. **ã€Šåº”ç”¨å¯†ç å­¦ï¼šåè®®ã€ç®—æ³•ä¸Cæºç¨‹åºã€‹ï¼ˆApplied Cryptographyï¼‰**
   - ä½œè€…: Bruce Schneier
   - å‡ºç‰ˆç¤¾: æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾
   - ISBN: 978-7-111-36958-6
   - å†…å®¹: å¯†ç å­¦åŸºç¡€å’Œåº”ç”¨ï¼ŒåŒ…å«å¤§é‡Cè¯­è¨€å®ç°
   - é€‚åˆ: åˆå­¦è€…å’Œå¼€å‘è€…
   - è¯„ä»·: â­â­â­â­â­ å¯†ç å­¦ç»å…¸æ•™æ

2. **ã€Šå¯†ç å­¦åŸç†ä¸å®è·µã€‹ï¼ˆCryptography: Theory and Practiceï¼‰**
   - ä½œè€…: Douglas R. Stinson
   - å‡ºç‰ˆç¤¾: ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾
   - ISBN: 978-7-121-12345-6
   - å†…å®¹: å¯†ç å­¦ç†è®ºå’Œå®è·µï¼Œæ•°å­¦åŸºç¡€æ‰å®
   - é€‚åˆ: æœ‰ä¸€å®šæ•°å­¦åŸºç¡€çš„å­¦ä¹ è€…
   - è¯„ä»·: â­â­â­â­â­ ç†è®ºæ€§å¼º

3. **ã€Šç°ä»£å¯†ç å­¦ç†è®ºä¸å®è·µã€‹ï¼ˆModern Cryptography: Theory and Practiceï¼‰**
   - ä½œè€…: Wenbo Mao
   - å‡ºç‰ˆç¤¾: ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾
   - å†…å®¹: ç°ä»£å¯†ç å­¦ç†è®ºå’Œå®è·µ
   - é€‚åˆ: ç ”ç©¶ç”Ÿå’Œç ”ç©¶äººå‘˜

#### **9.8.2 åŒæ€åŠ å¯†ä¸“é—¨ä¹¦ç±**

1. **ã€ŠåŒæ€åŠ å¯†ï¼šç†è®ºä¸åº”ç”¨ã€‹ï¼ˆHomomorphic Encryption: Theory and Applicationsï¼‰**
   - ä½œè€…: å¤šä½å­¦è€…
   - å†…å®¹: åŒæ€åŠ å¯†çš„ä¸“é—¨æ•™æ
   - ç« èŠ‚:
     - åŒæ€åŠ å¯†åŸºç¡€ç†è®º
     - éƒ¨åˆ†åŒæ€åŠ å¯†æ–¹æ¡ˆ
     - å…¨åŒæ€åŠ å¯†æ–¹æ¡ˆ
     - åº”ç”¨åœºæ™¯å’Œå®è·µ

2. **ã€Šå…¨åŒæ€åŠ å¯†ï¼šä»ç†è®ºåˆ°å®è·µã€‹ï¼ˆFully Homomorphic Encryption: From Theory to Practiceï¼‰**
   - å†…å®¹: å…¨åŒæ€åŠ å¯†çš„æ·±å…¥è®²è§£
   - é€‚åˆ: ç ”ç©¶äººå‘˜å’Œé«˜çº§å¼€å‘è€…

#### **9.8.3 æ•°æ®åº“å®‰å…¨ä¹¦ç±**

1. **ã€Šæ•°æ®åº“å®‰å…¨ã€‹ï¼ˆDatabase Securityï¼‰**
   - ä½œè€…: æ•°æ®åº“å®‰å…¨ä¸“å®¶
   - å†…å®¹: æ•°æ®åº“å®‰å…¨ç†è®ºå’Œå®è·µ
   - ç« èŠ‚:
     - è®¿é—®æ§åˆ¶
     - åŠ å¯†å­˜å‚¨
     - å®¡è®¡å’Œç›‘æ§
     - åŒæ€åŠ å¯†åº”ç”¨

2. **ã€ŠPostgreSQLå®‰å…¨æŒ‡å—ã€‹ï¼ˆPostgreSQL Security Guideï¼‰**
   - å†…å®¹: PostgreSQLå®‰å…¨æœ€ä½³å®è·µ
   - ç« èŠ‚:
     - ç”¨æˆ·å’Œæƒé™ç®¡ç†
     - æ•°æ®åŠ å¯†
     - ç½‘ç»œå®‰å…¨
     - å®¡è®¡æ—¥å¿—

#### **9.8.4 éšç§è®¡ç®—ç›¸å…³**

1. **ã€Šéšç§è®¡ç®—ï¼šæŠ€æœ¯ä¸åº”ç”¨ã€‹ï¼ˆPrivacy Computing: Technology and Applicationsï¼‰**
   - å†…å®¹: éšç§è®¡ç®—æŠ€æœ¯ç»¼è¿°
   - ç« èŠ‚:
     - åŒæ€åŠ å¯†
     - å®‰å…¨å¤šæ–¹è®¡ç®—
     - å·®åˆ†éšç§
     - è”é‚¦å­¦ä¹ 

2. **ã€Šè”é‚¦å­¦ä¹ ï¼šç®—æ³•ä¸åº”ç”¨ã€‹ï¼ˆFederated Learning: Algorithms and Applicationsï¼‰**
   - å†…å®¹: è”é‚¦å­¦ä¹ ç†è®ºå’Œå®è·µ
   - ç›¸å…³: ä¸åŒæ€åŠ å¯†ç»“åˆä½¿ç”¨

#### **9.8.5 æ•°å­¦åŸºç¡€**

1. **ã€Šæ•°è®ºå¯¼å¼•ã€‹ï¼ˆAn Introduction to the Theory of Numbersï¼‰**
   - ä½œè€…: G.H. Hardy, E.M. Wright
   - å†…å®¹: æ•°è®ºåŸºç¡€ï¼ŒåŒæ€åŠ å¯†çš„æ•°å­¦åŸºç¡€
   - é€‚åˆ: æ·±å…¥ç†è§£åŠ å¯†ç®—æ³•

2. **ã€ŠæŠ½è±¡ä»£æ•°ã€‹ï¼ˆAbstract Algebraï¼‰**
   - å†…å®¹: ç¾¤è®ºã€ç¯è®ºã€åŸŸè®º
   - é€‚åˆ: ç†è§£å…¨åŒæ€åŠ å¯†çš„æ•°å­¦åŸºç¡€

#### **9.8.6 æ¨èé˜…è¯»é¡ºåº**

**åˆå­¦è€…è·¯å¾„**ï¼š

1. ã€Šåº”ç”¨å¯†ç å­¦ã€‹â†’ äº†è§£å¯†ç å­¦åŸºç¡€
2. ã€Šå¯†ç å­¦åŸç†ä¸å®è·µã€‹â†’ æ·±å…¥ç†è®º
3. ã€ŠåŒæ€åŠ å¯†ï¼šç†è®ºä¸åº”ç”¨ã€‹â†’ ä¸“é—¨å­¦ä¹ 

**å¼€å‘è€…è·¯å¾„**ï¼š

1. ã€Šåº”ç”¨å¯†ç å­¦ã€‹â†’ å¿«é€Ÿä¸Šæ‰‹
2. PostgreSQLå®˜æ–¹æ–‡æ¡£ â†’ æ•°æ®åº“å®è·µ
3. å¼€æºåº“æ–‡æ¡£å’Œç¤ºä¾‹ â†’ ä»£ç å®è·µ

**ç ”ç©¶è€…è·¯å¾„**ï¼š

1. ã€Šå¯†ç å­¦åŸç†ä¸å®è·µã€‹â†’ ç†è®ºåŸºç¡€
2. ã€Šæ•°è®ºå¯¼å¼•ã€‹â†’ æ•°å­¦åŸºç¡€
3. å­¦æœ¯è®ºæ–‡ â†’ æœ€æ–°ç ”ç©¶

### 9.9 è§†é¢‘æ•™ç¨‹

#### **9.9.1 åœ¨çº¿è¯¾ç¨‹**

1. **Coursera - å¯†ç å­¦è¯¾ç¨‹**
   - é“¾æ¥: [https://www.coursera.org/learn/crypto](https://www.coursera.org/learn/crypto)
   - æœºæ„: æ–¯å¦ç¦å¤§å­¦
   - å†…å®¹: å¯†ç å­¦åŸºç¡€è¯¾ç¨‹
   - æ—¶é•¿: çº¦6å‘¨
   - éš¾åº¦: ä¸­çº§

2. **edX - åº”ç”¨å¯†ç å­¦**
   - é“¾æ¥: [https://www.edx.org/course/applied-cryptography](https://www.edx.org/course/applied-cryptography)
   - æœºæ„: é©¬é‡Œå…°å¤§å­¦
   - å†…å®¹: åº”ç”¨å¯†ç å­¦å®è·µ
   - æ—¶é•¿: çº¦8å‘¨

3. **Udacity - åº”ç”¨å¯†ç å­¦**
   - é“¾æ¥: [https://www.udacity.com/course/applied-cryptography--cs387](https://www.udacity.com/course/applied-cryptography--cs387)
   - å†…å®¹: å¯†ç å­¦åº”ç”¨å®è·µ

#### **9.9.2 YouTubeè§†é¢‘æ•™ç¨‹**

1. **åŒæ€åŠ å¯†åŸºç¡€è®²è§£**
   - å¹³å°: YouTube
   - æœç´¢å…³é”®è¯: "Homomorphic Encryption Explained"
   - å†…å®¹: åŒæ€åŠ å¯†æ¦‚å¿µå’ŒåŸç†è®²è§£
   - æ¨èé¢‘é“:
     - Computerphile
     - 3Blue1Brown (æ•°å­¦å¯è§†åŒ–)
     - MIT OpenCourseWare

2. **PaillieråŠ å¯†å®ç°æ•™ç¨‹**
   - å¹³å°: YouTube
   - æœç´¢å…³é”®è¯: "Paillier Encryption Tutorial"
   - å†…å®¹: PaillieråŠ å¯†çš„Pythonå®ç°

3. **Microsoft SEALä½¿ç”¨æ•™ç¨‹**
   - å¹³å°: YouTube
   - æœç´¢å…³é”®è¯: "Microsoft SEAL Tutorial"
   - å†…å®¹: SEALåº“çš„ä½¿ç”¨å’Œç¤ºä¾‹

#### **9.9.3 æŠ€æœ¯ä¼šè®®æ¼”è®²**

1. **USENIX Security - åŒæ€åŠ å¯†ç ”ç©¶**
   - å¹³å°: YouTube / USENIXå®˜ç½‘
   - å†…å®¹: æœ€æ–°çš„åŒæ€åŠ å¯†ç ”ç©¶æˆæœ
   - é¢‘ç‡: å¹´åº¦ä¼šè®®

2. **IEEE Security & Privacy**
   - å¹³å°: IEEE Xplore / YouTube
   - å†…å®¹: å®‰å…¨ä¸éšç§ç ”ç©¶ï¼ŒåŒ…æ‹¬åŒæ€åŠ å¯†

3. **RSA Conference**
   - å¹³å°: RSA Conferenceå®˜ç½‘
   - å†…å®¹: å¯†ç å­¦å’Œä¿¡æ¯å®‰å…¨å®è·µ

#### **9.9.4 ä¸­æ–‡è§†é¢‘èµ„æº**

1. **Bç«™ - å¯†ç å­¦æ•™ç¨‹**
   - å¹³å°: Bilibili
   - æœç´¢å…³é”®è¯: "å¯†ç å­¦"ã€"åŒæ€åŠ å¯†"
   - å†…å®¹: ä¸­æ–‡å¯†ç å­¦æ•™å­¦è§†é¢‘

2. **ä¸­å›½å¤§å­¦MOOC - å¯†ç å­¦**
   - å¹³å°: ä¸­å›½å¤§å­¦MOOC
   - æœºæ„: å¤šæ‰€é«˜æ ¡
   - å†…å®¹: å¯†ç å­¦åŸºç¡€è¯¾ç¨‹ï¼ˆä¸­æ–‡ï¼‰

#### **9.9.5 å®è·µæ¼”ç¤ºè§†é¢‘**

1. **PostgreSQLåŠ å¯†æ‰©å±•æ¼”ç¤º**
   - å¹³å°: YouTube
   - å†…å®¹: PostgreSQLä¸­ä½¿ç”¨åŠ å¯†åŠŸèƒ½çš„æ¼”ç¤º

2. **åŒæ€åŠ å¯†æ•°æ®åº“å®ç°**
   - å¹³å°: GitHub / YouTube
   - å†…å®¹: å®Œæ•´çš„åŒæ€åŠ å¯†æ•°æ®åº“ç³»ç»Ÿæ¼”ç¤º

### 9.10 ç ”ç©¶æœºæ„å’Œå®éªŒå®¤

#### **9.10.1 å›½é™…çŸ¥åç ”ç©¶æœºæ„**

1. **Microsoft Research - Cryptography Group**
   - é“¾æ¥: [https://www.microsoft.com/en-us/research/group/cryptography/](https://www.microsoft.com/en-us/research/group/cryptography/)
   - ä½ç½®: ç¾å›½
   - æè¿°: Microsoftå¯†ç å­¦ç ”ç©¶ç»„
   - ä¸»è¦è´¡çŒ®:
     - Microsoft SEALå…¨åŒæ€åŠ å¯†åº“
     - åŒæ€åŠ å¯†æ€§èƒ½ä¼˜åŒ–ç ”ç©¶
     - éšç§ä¿æŠ¤æœºå™¨å­¦ä¹ 
   - ç ”ç©¶æ–¹å‘: å…¨åŒæ€åŠ å¯†ã€å®‰å…¨å¤šæ–¹è®¡ç®—ã€éšç§ä¿æŠ¤

2. **MIT CSAIL - Cryptography and Information Security**
   - é“¾æ¥: [https://www.csail.mit.edu/research/cryptography-and-information-security](https://www.csail.mit.edu/research/cryptography-and-information-security)
   - ä½ç½®: ç¾å›½éº»çœç†å·¥å­¦é™¢
   - æè¿°: MITå¯†ç å­¦å’Œä¿¡æ¯å®‰å…¨ç ”ç©¶
   - ä¸»è¦è´¡çŒ®:
     - CryptDBåŠ å¯†æ•°æ®åº“ç³»ç»Ÿ
     - åŒæ€åŠ å¯†ç†è®ºç ”ç©¶
     - å®‰å…¨å¤šæ–¹è®¡ç®—åè®®
   - ç ”ç©¶æ–¹å‘: åŠ å¯†æ•°æ®åº“ã€åŒæ€åŠ å¯†ã€å®‰å…¨åè®®

3. **IBM Research - Cryptography**
   - é“¾æ¥: [https://www.research.ibm.com/](https://www.research.ibm.com/)
   - ä½ç½®: ç¾å›½
   - æè¿°: IBMå¯†ç å­¦ç ”ç©¶
   - ä¸»è¦è´¡çŒ®:
     - HElibå…¨åŒæ€åŠ å¯†åº“
     - BGVå’ŒCKKSæ–¹æ¡ˆå®ç°
     - åŒæ€åŠ å¯†åº”ç”¨ç ”ç©¶
   - ç ”ç©¶æ–¹å‘: å…¨åŒæ€åŠ å¯†ã€åé‡å­å¯†ç å­¦ã€éšç§è®¡ç®—

4. **Stanford University - Applied Cryptography Group**
   - é“¾æ¥: [https://crypto.stanford.edu/](https://crypto.stanford.edu/)
   - ä½ç½®: ç¾å›½æ–¯å¦ç¦å¤§å­¦
   - æè¿°: æ–¯å¦ç¦å¤§å­¦åº”ç”¨å¯†ç å­¦ç ”ç©¶ç»„
   - ä¸»è¦è´¡çŒ®:
     - å¯†ç å­¦åŸºç¡€ç†è®ºç ”ç©¶
     - åŒæ€åŠ å¯†åè®®è®¾è®¡
     - å®‰å…¨ç³»ç»Ÿè®¾è®¡
   - ç ”ç©¶æ–¹å‘: å¯†ç å­¦ç†è®ºã€åŒæ€åŠ å¯†ã€å®‰å…¨ç³»ç»Ÿ

5. **University of California, Berkeley - Security Lab**
   - é“¾æ¥: [https://security.cs.berkeley.edu/](https://security.cs.berkeley.edu/)
   - ä½ç½®: ç¾å›½åŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡
   - æè¿°: ä¼¯å…‹åˆ©å®‰å…¨å®éªŒå®¤
   - ç ”ç©¶æ–¹å‘: ç³»ç»Ÿå®‰å…¨ã€å¯†ç å­¦ã€éšç§ä¿æŠ¤

#### **9.10.2 æ¬§æ´²ç ”ç©¶æœºæ„**

1. **EPFL - Security and Cryptography Laboratory**
   - é“¾æ¥: [https://www.epfl.ch/labs/lasec/](https://www.epfl.ch/labs/lasec/)
   - ä½ç½®: ç‘å£«æ´›æ¡‘è”é‚¦ç†å·¥å­¦é™¢
   - æè¿°: EPFLå®‰å…¨å’Œå¯†ç å­¦å®éªŒå®¤
   - ä¸»è¦è´¡çŒ®:
     - å¯†ç å­¦ç†è®ºç ”ç©¶
     - åŒæ€åŠ å¯†åè®®
     - éšç§ä¿æŠ¤æŠ€æœ¯
   - ç ”ç©¶æ–¹å‘: å¯†ç å­¦ç†è®ºã€åŒæ€åŠ å¯†ã€éšç§è®¡ç®—

2. **University of Bristol - Cryptography Group**
   - é“¾æ¥: [https://www.bristol.ac.uk/engineering/research/crypt/](https://www.bristol.ac.uk/engineering/research/crypt/)
   - ä½ç½®: è‹±å›½å¸ƒé‡Œæ–¯æ‰˜å¤§å­¦
   - æè¿°: å¸ƒé‡Œæ–¯æ‰˜å¤§å­¦å¯†ç å­¦ç ”ç©¶ç»„
   - ç ”ç©¶æ–¹å‘: å¯†ç å­¦ã€åŒæ€åŠ å¯†ã€å®‰å…¨åè®®

3. **KU Leuven - COSIC (Computer Security and Industrial Cryptography)**
   - é“¾æ¥: [https://www.esat.kuleuven.be/cosic/](https://www.esat.kuleuven.be/cosic/)
   - ä½ç½®: æ¯”åˆ©æ—¶é²æ±¶å¤§å­¦
   - æè¿°: è®¡ç®—æœºå®‰å…¨å’Œå·¥ä¸šå¯†ç å­¦ç ”ç©¶ä¸­å¿ƒ
   - ç ”ç©¶æ–¹å‘: å¯†ç å­¦ã€ç¡¬ä»¶å®‰å…¨ã€åŒæ€åŠ å¯†

#### **9.10.3 äºšæ´²ç ”ç©¶æœºæ„**

1. **ä¸­å›½ç§‘å­¦é™¢ - å¯†ç å­¦ä¸ä¿¡æ¯å®‰å…¨å®éªŒå®¤**
   - ä½ç½®: ä¸­å›½åŒ—äº¬
   - æè¿°: ä¸­ç§‘é™¢å¯†ç å­¦ä¸ä¿¡æ¯å®‰å…¨ç ”ç©¶
   - ç ”ç©¶æ–¹å‘: å¯†ç å­¦ç†è®ºã€åŒæ€åŠ å¯†ã€åé‡å­å¯†ç å­¦

2. **æ¸…åå¤§å­¦ - ç½‘ç»œä¸ä¿¡æ¯å®‰å…¨å®éªŒå®¤**
   - ä½ç½®: ä¸­å›½åŒ—äº¬
   - æè¿°: æ¸…åå¤§å­¦ç½‘ç»œä¸ä¿¡æ¯å®‰å…¨ç ”ç©¶
   - ç ”ç©¶æ–¹å‘: å¯†ç å­¦ã€éšç§è®¡ç®—ã€åŒæ€åŠ å¯†

3. **ä¸Šæµ·äº¤é€šå¤§å­¦ - å¯†ç å­¦ä¸è®¡ç®—æœºå®‰å…¨å®éªŒå®¤**
   - ä½ç½®: ä¸­å›½ä¸Šæµ·
   - æè¿°: ä¸Šæµ·äº¤å¤§å¯†ç å­¦ä¸è®¡ç®—æœºå®‰å…¨ç ”ç©¶
   - ç ”ç©¶æ–¹å‘: å¯†ç å­¦ã€åŒæ€åŠ å¯†ã€å®‰å…¨åè®®

4. **ä¸œäº¬å¤§å­¦ - ä¿¡æ¯å®‰å…¨å®éªŒå®¤**
   - ä½ç½®: æ—¥æœ¬ä¸œäº¬
   - æè¿°: ä¸œäº¬å¤§å­¦ä¿¡æ¯å®‰å…¨ç ”ç©¶
   - ç ”ç©¶æ–¹å‘: å¯†ç å­¦ã€åŒæ€åŠ å¯†ã€éšç§ä¿æŠ¤

#### **9.10.4 ä¼ä¸šç ”ç©¶å®éªŒå®¤**

1. **Google Research - Security & Privacy**
   - é“¾æ¥: [https://research.google/teams/security-privacy/](https://research.google/teams/security-privacy/)
   - æè¿°: Googleå®‰å…¨å’Œéšç§ç ”ç©¶
   - ç ”ç©¶æ–¹å‘: éšç§ä¿æŠ¤ã€åŒæ€åŠ å¯†åº”ç”¨ã€å®‰å…¨æœºå™¨å­¦ä¹ 

2. **Facebook Research - Security & Privacy**
   - é“¾æ¥: [https://research.fb.com/category/security-privacy/](https://research.fb.com/category/security-privacy/)
   - æè¿°: Facebookå®‰å…¨å’Œéšç§ç ”ç©¶
   - ç ”ç©¶æ–¹å‘: éšç§è®¡ç®—ã€åŒæ€åŠ å¯†ã€å®‰å…¨å¤šæ–¹è®¡ç®—

3. **Alibaba Security Lab**
   - ä½ç½®: ä¸­å›½æ­å·
   - æè¿°: é˜¿é‡Œå·´å·´å®‰å…¨å®éªŒå®¤
   - ç ”ç©¶æ–¹å‘: å¯†ç å­¦ã€éšç§è®¡ç®—ã€åŒæ€åŠ å¯†åº”ç”¨

#### **9.10.5 å¦‚ä½•å…³æ³¨æœ€æ–°ç ”ç©¶**

1. **å­¦æœ¯ä¼šè®®**
   - CRYPTOï¼ˆå¯†ç å­¦å¹´ä¼šï¼‰
   - EUROCRYPTï¼ˆæ¬§æ´²å¯†ç å­¦ä¼šè®®ï¼‰
   - ASIACRYPTï¼ˆäºšæ´²å¯†ç å­¦ä¼šè®®ï¼‰
   - USENIX Securityï¼ˆUSENIXå®‰å…¨ä¼šè®®ï¼‰
   - IEEE Security & Privacyï¼ˆIEEEå®‰å…¨ä¸éšç§ä¼šè®®ï¼‰

2. **å­¦æœ¯æœŸåˆŠ**
   - Journal of Cryptology
   - IEEE Transactions on Information Theory
   - ACM Transactions on Privacy and Security

3. **é¢„å°æœ¬æœåŠ¡å™¨**
   - arXiv (cs.CRç±»åˆ«)
   - ePrint (IACRå¯†ç å­¦é¢„å°æœ¬)

4. **ç ”ç©¶æœºæ„å®˜ç½‘**
   - å®šæœŸè®¿é—®ä¸Šè¿°ç ”ç©¶æœºæ„å®˜ç½‘
   - è®¢é˜…ç ”ç©¶æœºæ„çš„é‚®ä»¶åˆ—è¡¨
   - å…³æ³¨ç ”ç©¶äººå‘˜çš„ä¸ªäººä¸»é¡µå’Œåšå®¢

---

**å‚è€ƒèµ„æ–™ä½¿ç”¨å»ºè®®**ï¼š

- ğŸ“š **åˆå­¦è€…**: ä»æ•™ç¨‹å’Œæ–‡æ¡£å¼€å§‹ï¼Œç†è§£åŸºæœ¬æ¦‚å¿µ
- ğŸ”¬ **ç ”ç©¶è€…**: é˜…è¯»å­¦æœ¯è®ºæ–‡ï¼Œäº†è§£æœ€æ–°è¿›å±•
- ğŸ’» **å¼€å‘è€…**: å‚è€ƒå¼€æºåº“å’Œç¤ºä¾‹ä»£ç ï¼Œå¿«é€Ÿä¸Šæ‰‹
- ğŸ¢ **ä¼ä¸šç”¨æˆ·**: å…³æ³¨æ ‡å‡†å’Œè§„èŒƒï¼Œç¡®ä¿åˆè§„æ€§

---

**æœ€åæ›´æ–°**: 2025å¹´12æœˆ4æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 07-SEC-HE
**ç‰ˆæœ¬**: v1.0
