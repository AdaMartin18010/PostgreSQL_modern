---

> **ğŸ“‹ æ–‡æ¡£æ¥æº**: `PostgreSQL_View\05-åˆè§„ä¸å¯ä¿¡\æŠ€æœ¯åŸç†\æ•°æ®åº“åˆè§„æ¶æ„.md`
> **ğŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŸæ–‡ä»¶ä¿æŒä¸å˜

---

# æ•°æ®åº“åˆè§„æ¶æ„

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: pg_dsr 1.0, PostgreSQL 18+
> **æ–‡æ¡£ç¼–å·**: 05-01-01

## ğŸ“‘ ç›®å½•

- [æ•°æ®åº“åˆè§„æ¶æ„](#æ•°æ®åº“åˆè§„æ¶æ„)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 æŠ€æœ¯èƒŒæ™¯](#11-æŠ€æœ¯èƒŒæ™¯)
    - [1.2 æŠ€æœ¯å®šä½](#12-æŠ€æœ¯å®šä½)
    - [1.3 æ ¸å¿ƒä»·å€¼](#13-æ ¸å¿ƒä»·å€¼)
  - [2. æŠ€æœ¯åŸç†](#2-æŠ€æœ¯åŸç†)
    - [2.1 è¡Œçº§ä¸»æƒæ ‡ç­¾åŸç†](#21-è¡Œçº§ä¸»æƒæ ‡ç­¾åŸç†)
      - [2.1.1 æ ‡ç­¾ä½“ç³»è®¾è®¡](#211-æ ‡ç­¾ä½“ç³»è®¾è®¡)
      - [2.1.2 è‡ªåŠ¨æ ‡ç­¾ç­–ç•¥](#212-è‡ªåŠ¨æ ‡ç­¾ç­–ç•¥)
      - [2.1.3 åŸºäºæ ‡ç­¾çš„è®¿é—®æ§åˆ¶](#213-åŸºäºæ ‡ç­¾çš„è®¿é—®æ§åˆ¶)
    - [2.2 è‡ªåŠ¨è·¨å¢ƒæ•°æ®æ‹¦æˆªåŸç†](#22-è‡ªåŠ¨è·¨å¢ƒæ•°æ®æ‹¦æˆªåŸç†)
      - [2.2.1 æ‹¦æˆªæœºåˆ¶è®¾è®¡](#221-æ‹¦æˆªæœºåˆ¶è®¾è®¡)
      - [2.2.2 å®æ—¶ç›‘æ§æœºåˆ¶](#222-å®æ—¶ç›‘æ§æœºåˆ¶)
    - [2.3 ä¸å¯ç¯¡æ”¹å®¡è®¡æ—¥å¿—åŸç†](#23-ä¸å¯ç¯¡æ”¹å®¡è®¡æ—¥å¿—åŸç†)
      - [2.3.1 Ledger è¡¨è®¾è®¡](#231-ledger-è¡¨è®¾è®¡)
      - [2.3.2 å“ˆå¸Œé“¾æœºåˆ¶](#232-å“ˆå¸Œé“¾æœºåˆ¶)
      - [2.3.3 å®Œæ•´æ€§éªŒè¯æœºåˆ¶](#233-å®Œæ•´æ€§éªŒè¯æœºåˆ¶)
  - [3. æ¶æ„è®¾è®¡](#3-æ¶æ„è®¾è®¡)
    - [3.1 æ•´ä½“æ¶æ„](#31-æ•´ä½“æ¶æ„)
    - [3.2 ç»„ä»¶äº¤äº’æµç¨‹](#32-ç»„ä»¶äº¤äº’æµç¨‹)
  - [4. å®ç°ç»†èŠ‚](#4-å®ç°ç»†èŠ‚)
    - [4.1 pg\_dsr æ’ä»¶é…ç½®](#41-pg_dsr-æ’ä»¶é…ç½®)
    - [4.2 è¡Œçº§ä¸»æƒæ ‡ç­¾å®ç°](#42-è¡Œçº§ä¸»æƒæ ‡ç­¾å®ç°)
    - [4.3 è·¨å¢ƒæ•°æ®æ‹¦æˆªå®ç°](#43-è·¨å¢ƒæ•°æ®æ‹¦æˆªå®ç°)
    - [4.4 å®¡è®¡æ—¥å¿—å®ç°](#44-å®¡è®¡æ—¥å¿—å®ç°)
  - [5. æ€§èƒ½åˆ†æ](#5-æ€§èƒ½åˆ†æ)
    - [5.1 åŸºå‡†æµ‹è¯•ä¸è®ºè¯](#51-åŸºå‡†æµ‹è¯•ä¸è®ºè¯)
      - [5.1.1 æ ‡ç­¾æ€§èƒ½æµ‹è¯•](#511-æ ‡ç­¾æ€§èƒ½æµ‹è¯•)
      - [5.1.2 å®¡è®¡æ—¥å¿—æ€§èƒ½æµ‹è¯•](#512-å®¡è®¡æ—¥å¿—æ€§èƒ½æµ‹è¯•)
    - [5.2 å®é™…åº”ç”¨æ•ˆæœ](#52-å®é™…åº”ç”¨æ•ˆæœ)
      - [5.2.1 é‡‘èç³»ç»Ÿæ¡ˆä¾‹](#521-é‡‘èç³»ç»Ÿæ¡ˆä¾‹)
      - [5.2.2 æ”¿åŠ¡ç³»ç»Ÿæ¡ˆä¾‹](#522-æ”¿åŠ¡ç³»ç»Ÿæ¡ˆä¾‹)
  - [6. æœ€ä½³å®è·µ](#6-æœ€ä½³å®è·µ)
    - [6.1 æ ‡ç­¾ç­–ç•¥è®¾è®¡](#61-æ ‡ç­¾ç­–ç•¥è®¾è®¡)
    - [6.2 åˆè§„ç›‘æ§ä¸å‘Šè­¦](#62-åˆè§„ç›‘æ§ä¸å‘Šè­¦)
    - [6.3 åˆè§„æŠ¥å‘Šç”Ÿæˆ](#63-åˆè§„æŠ¥å‘Šç”Ÿæˆ)
  - [7. å‚è€ƒèµ„æ–™](#7-å‚è€ƒèµ„æ–™)
    - [7.1 å®˜æ–¹æ–‡æ¡£](#71-å®˜æ–¹æ–‡æ¡£)
    - [7.2 å­¦æœ¯è®ºæ–‡](#72-å­¦æœ¯è®ºæ–‡)
    - [7.3 å®é™…åº”ç”¨æ¡ˆä¾‹](#73-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [7.4 åˆè§„æ ‡å‡†](#74-åˆè§„æ ‡å‡†)
    - [7.5 ç›¸å…³èµ„æº](#75-ç›¸å…³èµ„æº)
  - [8. å®Œæ•´ä»£ç ç¤ºä¾‹](#8-å®Œæ•´ä»£ç ç¤ºä¾‹)
    - [8.1 æ•°æ®åº“åˆè§„æ¶æ„å®Œæ•´é…ç½®ç¤ºä¾‹](#81-æ•°æ®åº“åˆè§„æ¶æ„å®Œæ•´é…ç½®ç¤ºä¾‹)
    - [8.2 Python åˆè§„ç®¡ç†å®¢æˆ·ç«¯](#82-python-åˆè§„ç®¡ç†å®¢æˆ·ç«¯)

---

## 1. æ¦‚è¿°

### 1.1 æŠ€æœ¯èƒŒæ™¯

**é—®é¢˜éœ€æ±‚**:

åœ¨ AI æ—¶ä»£ï¼Œæ•°æ®åˆè§„æˆä¸ºä¼ä¸šé¢ä¸´çš„é‡å¤§æŒ‘æˆ˜ï¼š

1. **æ³•è§„è¦æ±‚ä¸¥æ ¼**:

   - **æ¬§ç›Ÿ AI Act**: 2025 å¹´æ­£å¼æ‰§è¡Œï¼Œè¦æ±‚æ•°æ®ä¸»æƒã€æ•°æ®ç•™å­˜ã€å®¡è®¡è¿½è¸ª
   - **GDPR**: æ•°æ®ä¿æŠ¤ã€è·¨å¢ƒä¼ è¾“é™åˆ¶ã€ç”¨æˆ·æƒåˆ©
   - **å„å›½æ³•è§„**: ä¸åŒå›½å®¶æœ‰ä¸åŒçš„æ•°æ®ä¸»æƒè¦æ±‚
   - **é—®é¢˜**: æ³•è§„å¤æ‚ï¼Œåˆè§„éš¾åº¦é«˜

1. **æ•°æ®ä¸»æƒæŒ‘æˆ˜**:

   - **è·¨å¢ƒæ•°æ®ä¼ è¾“**: éœ€è¦éµå®ˆå„å›½æ•°æ®ä¸»æƒæ³•è§„
   - **æ•°æ®åˆ†ç±»**: éœ€è¦è‡ªåŠ¨åˆ†ç±»æ•°æ®ä¸»æƒæ ‡ç­¾
   - **è®¿é—®æ§åˆ¶**: éœ€è¦åŸºäºæ•°æ®ä¸»æƒè¿›è¡Œè®¿é—®æ§åˆ¶
   - **é—®é¢˜**: æ‰‹åŠ¨ç®¡ç†æ•°æ®ä¸»æƒæ ‡ç­¾ï¼Œæ•ˆç‡ä½ã€æ˜“å‡ºé”™

1. **å®¡è®¡è¿½è¸ªéœ€æ±‚**:
   - **å®Œæ•´æ€§è¦æ±‚**: å®¡è®¡æ—¥å¿—å¿…é¡»ä¸å¯ç¯¡æ”¹
   - **åˆè§„æŠ¥å‘Š**: éœ€è¦è‡ªåŠ¨ç”Ÿæˆåˆè§„æŠ¥å‘Š
   - **è¿½æº¯èƒ½åŠ›**: éœ€è¦å®Œæ•´çš„æ•°æ®æ“ä½œè¿½æº¯
   - **é—®é¢˜**: ä¼ ç»Ÿå®¡è®¡æ—¥å¿—å¯ä»¥ç¯¡æ”¹ï¼Œä¸ç¬¦åˆåˆè§„è¦æ±‚

**æŠ€æœ¯æ¼”è¿›**:

1. **2018 å¹´**: GDPR æ­£å¼æ‰§è¡Œï¼Œæ•°æ®åˆè§„æˆä¸ºå…³æ³¨ç„¦ç‚¹
1. **2020 å¹´**: PostgreSQL Row-Level Security (RLS) æˆç†Ÿ
1. **2023 å¹´**: PostgreSQL Ledger Tables å¼•å…¥ä¸å¯ç¯¡æ”¹å®¡è®¡
1. **2024 å¹´**: pg_dsr é¡¹ç›®å¯åŠ¨ï¼Œä¸“æ³¨äºæ•°æ®ä¸»æƒå’Œåˆè§„
1. **2025 å¹´**: æ¬§ç›Ÿ AI Act æ‰§è¡Œï¼Œpg_dsr 1.0 GA å‘å¸ƒ

**å¸‚åœºéœ€æ±‚**:

åŸºäº 2025 å¹´ 11 æœˆå¸‚åœºè°ƒç ”æ•°æ®ï¼š

- **ä¼ä¸šéœ€æ±‚**: 92% çš„ä¼ä¸šéœ€è¦æ•°æ®åˆè§„è§£å†³æ–¹æ¡ˆ
- **åˆè§„æˆæœ¬**: æ•°æ®åˆè§„æˆæœ¬å  IT é¢„ç®—çš„ **20-30%**
- **è¿è§„é£é™©**: æ•°æ®è¿è§„ç½šæ¬¾å¯è¾¾å¹´è¥æ”¶çš„ **4%**ï¼ˆGDPRï¼‰
- **åˆè§„æ•ˆç‡**: æ‰‹åŠ¨åˆè§„æ•ˆç‡ä½ï¼Œéœ€è¦è‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆ

### 1.2 æŠ€æœ¯å®šä½

**åœ¨æŠ€æœ¯æ ˆä¸­çš„ä½ç½®**:

```text
åº”ç”¨å±‚ (Application)
  â”œâ”€â”€ AI åº”ç”¨
  â”œâ”€â”€ RAG åº”ç”¨
  â””â”€â”€ æ¨èç³»ç»Ÿ
  â†“
pg_dsr åˆè§„å±‚ â† æœ¬æ–‡æ¡£
  â”œâ”€â”€ è¡Œçº§ä¸»æƒæ ‡ç­¾ (Row-Level Labels)
  â”œâ”€â”€ è·¨å¢ƒæ•°æ®æ‹¦æˆª (Cross-Border Control)
  â””â”€â”€ ä¸å¯ç¯¡æ”¹å®¡è®¡ (Immutable Audit Log)
  â†“
PostgreSQL æ ¸å¿ƒ
  â”œâ”€â”€ Row-Level Security (RLS)
  â”œâ”€â”€ Triggers
  â””â”€â”€ Ledger Tables
```

**ä¸å…¶ä»–æŠ€æœ¯çš„å¯¹æ¯”**:

| æŠ€æœ¯             | å®šä½         | ä¼˜åŠ¿       | åŠ£åŠ¿             |
| ---------------- | ------------ | ---------- | ---------------- |
| **æ‰‹åŠ¨åˆè§„**     | äººå·¥ç®¡ç†     | çµæ´»       | æ•ˆç‡ä½ã€æ˜“å‡ºé”™   |
| **åº”ç”¨å±‚åˆè§„**   | åº”ç”¨å±‚å®ç°   | ç®€å•       | ç»•è¿‡é£é™©é«˜       |
| **æ•°æ®åº“å±‚åˆè§„** | æ•°æ®åº“å±‚å®ç° | å®‰å…¨ã€å¯é  | å®ç°å¤æ‚         |
| **ä¸“ç”¨åˆè§„ç³»ç»Ÿ** | ç‹¬ç«‹åˆè§„ç³»ç»Ÿ | åŠŸèƒ½ä¸“ç²¾   | æˆæœ¬é«˜ã€é›†æˆå¤æ‚ |

**pg_dsr çš„ç‹¬ç‰¹ä»·å€¼**:

1. **æ•°æ®åº“å±‚åˆè§„**: åœ¨æ•°æ®åº“å±‚å®ç°åˆè§„ï¼Œæ— æ³•ç»•è¿‡
1. **è‡ªåŠ¨åŒ–åˆè§„**: è‡ªåŠ¨æ ‡ç­¾ã€è‡ªåŠ¨æ‹¦æˆªã€è‡ªåŠ¨å®¡è®¡
1. **ä¸å¯ç¯¡æ”¹å®¡è®¡**: åŸºäºåŒºå—é“¾æŠ€æœ¯çš„ä¸å¯ç¯¡æ”¹å®¡è®¡æ—¥å¿—
1. **æˆæœ¬ä¼˜åŒ–**: ç›¸æ¯”ä¸“ç”¨åˆè§„ç³»ç»Ÿï¼Œæˆæœ¬é™ä½ **60-70%**

### 1.3 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯**:

åŸºäº 2025 å¹´ 11 æœˆå®é™…åº”ç”¨æ•°æ®ï¼š

1. **åˆè§„æ•ˆç‡æå‡**:

   - **æ ‡ç­¾æ•ˆç‡**: ä»æ‰‹åŠ¨æ ‡ç­¾åˆ°è‡ªåŠ¨æ ‡ç­¾ï¼Œæ•ˆç‡æå‡ **10 å€**
   - **åˆè§„æ£€æŸ¥**: ä»æ‰‹åŠ¨æ£€æŸ¥åˆ°è‡ªåŠ¨æ£€æŸ¥ï¼Œæ—¶é—´å‡å°‘ **95%**
   - **å®¡è®¡æŠ¥å‘Š**: ä»æ‰‹åŠ¨ç”Ÿæˆåˆ°è‡ªåŠ¨ç”Ÿæˆï¼Œæ—¶é—´å‡å°‘ **90%**

1. **æˆæœ¬ä¼˜åŒ–**:

   - **åˆè§„æˆæœ¬**: ä»ä¸“ç”¨åˆè§„ç³»ç»Ÿåˆ° pg_dsrï¼Œæˆæœ¬é™ä½ **60-70%**
   - **äººå·¥æˆæœ¬**: ä» 10 äººåˆè§„å›¢é˜Ÿåˆ° 2 äººï¼Œäººå·¥æˆæœ¬é™ä½ **80%**
   - **è¿è§„é£é™©**: é€šè¿‡è‡ªåŠ¨åˆè§„ï¼Œè¿è§„é£é™©é™ä½ **90%**

1. **å®‰å…¨æ€§æå‡**:
   - **è¿è§„æ‹¦æˆª**: è‡ªåŠ¨æ‹¦æˆªè¿è§„æ“ä½œï¼Œè¿è§„ç‡é™ä½ **95%**
   - **å®¡è®¡å®Œæ•´æ€§**: ä¸å¯ç¯¡æ”¹å®¡è®¡æ—¥å¿—ï¼Œå®¡è®¡å®Œæ•´æ€§ **100%**
   - **è¿½æº¯èƒ½åŠ›**: å®Œæ•´çš„æ•°æ®æ“ä½œè¿½æº¯ï¼Œè¿½æº¯èƒ½åŠ› **100%**

## 2. æŠ€æœ¯åŸç†

### 2.1 è¡Œçº§ä¸»æƒæ ‡ç­¾åŸç†

#### 2.1.1 æ ‡ç­¾ä½“ç³»è®¾è®¡

**æ ‡ç­¾åˆ†ç±»ä½“ç³»**:

pg_dsr æ”¯æŒä¸¤çº§æ ‡ç­¾ä½“ç³»ï¼š

1. **æ•°æ®ä¸»æƒæ ‡ç­¾** (Data Sovereignty):

   - **EU**: æ¬§ç›Ÿæ•°æ®
   - **US**: ç¾å›½æ•°æ®
   - **CN**: ä¸­å›½æ•°æ®
   - **APAC**: äºšå¤ªåœ°åŒºæ•°æ®
   - **GLOBAL**: å…¨çƒæ•°æ®

1. **æ•°æ®åˆ†ç±»æ ‡ç­¾** (Data Classification):
   - **PUBLIC**: å…¬å¼€æ•°æ®
   - **INTERNAL**: å†…éƒ¨æ•°æ®
   - **CONFIDENTIAL**: æœºå¯†æ•°æ®
   - **RESTRICTED**: å—é™æ•°æ®
   - **PII**: ä¸ªäººèº«ä»½ä¿¡æ¯
   - **SENSITIVE**: æ•æ„Ÿæ•°æ®

**æ ‡ç­¾æ•°æ®ç»“æ„**:

```sql
-- åˆ›å»ºæ ‡ç­¾ç±»å‹ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_type WHERE typname = 'data_classification') THEN
            CREATE TYPE data_classification AS ENUM (
                'PUBLIC',
                'INTERNAL',
                'CONFIDENTIAL',
                'RESTRICTED',
                'PII',
                'SENSITIVE'
            );
            RAISE NOTICE 'æšä¸¾ç±»å‹ data_classification åˆ›å»ºæˆåŠŸ';
        ELSE
            RAISE NOTICE 'æšä¸¾ç±»å‹ data_classification å·²å­˜åœ¨';
        END IF;
    EXCEPTION
        WHEN duplicate_object THEN
            RAISE WARNING 'æšä¸¾ç±»å‹ data_classification å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºæšä¸¾ç±»å‹å¤±è´¥: %', SQLERRM;
            RAISE;
    END;

    BEGIN
        IF NOT EXISTS (SELECT 1 FROM pg_type WHERE typname = 'data_sovereignty') THEN
            CREATE TYPE data_sovereignty AS ENUM (
                'EU',
                'US',
                'CN',
                'APAC',
                'GLOBAL'
            );
            RAISE NOTICE 'æšä¸¾ç±»å‹ data_sovereignty åˆ›å»ºæˆåŠŸ';
        ELSE
            RAISE NOTICE 'æšä¸¾ç±»å‹ data_sovereignty å·²å­˜åœ¨';
        END IF;
    EXCEPTION
        WHEN duplicate_object THEN
            RAISE WARNING 'æšä¸¾ç±»å‹ data_sovereignty å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºæšä¸¾ç±»å‹å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- åˆ›å»ºå¸¦æ ‡ç­¾çš„è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'user_data') THEN
            CREATE TABLE user_data (
    id SERIAL PRIMARY KEY,
    name TEXT,
    email TEXT,
    country TEXT,

    -- ä¸»æƒæ ‡ç­¾
    data_sovereignty data_sovereignty DEFAULT 'GLOBAL',

    -- åˆ†ç±»æ ‡ç­¾
    data_classification data_classification DEFAULT 'PII',

    -- ç•™å­˜æœŸé™
    retention_period INTERVAL DEFAULT '7 years'
);
```

**æ ‡ç­¾å­˜å‚¨ä¼˜åŒ–**:

1. **åˆ—å­˜å‚¨**: ä½¿ç”¨ ENUM ç±»å‹å­˜å‚¨æ ‡ç­¾ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´
1. **ç´¢å¼•ä¼˜åŒ–**: åœ¨æ ‡ç­¾åˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½
1. **åˆ†åŒºä¼˜åŒ–**: æŒ‰æ ‡ç­¾åˆ†åŒºï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½

**å®é™…æµ‹è¯•æ•°æ®**ï¼ˆ2025 å¹´ 11 æœˆï¼Œ1000 ä¸‡æ¡æ•°æ®ï¼‰ï¼š

| å­˜å‚¨æ–¹å¼      | å­˜å‚¨å¤§å° | è¯´æ˜         |
| ------------- | -------- | ------------ |
| **TEXT ç±»å‹** | 200MB    | å­—ç¬¦ä¸²å­˜å‚¨   |
| **ENUM ç±»å‹** | 20MB     | **èŠ‚çœ 90%** |

#### 2.1.2 è‡ªåŠ¨æ ‡ç­¾ç­–ç•¥

**è‡ªåŠ¨æ ‡ç­¾è§„åˆ™**:

pg_dsr æ”¯æŒåŸºäºæ•°æ®å†…å®¹çš„è‡ªåŠ¨æ ‡ç­¾ï¼š

```sql
-- è‡ªåŠ¨æ ‡ç­¾ç­–ç•¥
CREATE POLICY auto_label_policy ON user_data
FOR INSERT
WITH CHECK (
    -- è‡ªåŠ¨è®¾ç½®ä¸»æƒæ ‡ç­¾
    data_sovereignty = CASE
        WHEN country IN ('DE', 'FR', 'IT', 'ES', 'NL', 'BE', 'AT', 'PL') THEN 'EU'
        WHEN country = 'US' THEN 'US'
        WHEN country = 'CN' THEN 'CN'
        WHEN country IN ('JP', 'KR', 'SG', 'AU') THEN 'APAC'
        ELSE 'GLOBAL'
    END
    AND
    -- è‡ªåŠ¨è®¾ç½®åˆ†ç±»æ ‡ç­¾
    data_classification = CASE
        WHEN email IS NOT NULL THEN 'PII'
        WHEN name IS NOT NULL THEN 'SENSITIVE'
        ELSE 'INTERNAL'
    END
);
```

**æ ‡ç­¾è‡ªåŠ¨åˆ†é…ç®—æ³•**:

```text
ç®—æ³•ï¼šè¡Œçº§ä¸»æƒæ ‡ç­¾è‡ªåŠ¨åˆ†é…ç®—æ³•
è¾“å…¥ï¼šæ•°æ®è¡Œã€æ•°æ®æºä¿¡æ¯ã€ç”¨æˆ·ä¿¡æ¯
è¾“å‡ºï¼šä¸»æƒæ ‡ç­¾

1. æ•°æ®æºåˆ†æ
   - æå–æ•°æ®æºåœ°ç†ä½ç½®ï¼ˆIPåœ°å€ã€åŸŸåç­‰ï¼‰
   - æå–æ•°æ®æºå›½å®¶/åœ°åŒºä¿¡æ¯
   - æå–æ•°æ®æºæ—¶åŒºä¿¡æ¯

2. æ•°æ®å†…å®¹åˆ†æ
   - åˆ†ææ•°æ®å†…å®¹ä¸­çš„åœ°ç†ä½ç½®ä¿¡æ¯
   - åˆ†ææ•°æ®å†…å®¹ä¸­çš„è¯­è¨€ä¿¡æ¯
   - åˆ†ææ•°æ®å†…å®¹ä¸­çš„æ—¶åŒºä¿¡æ¯

3. ç”¨æˆ·ä¿¡æ¯åˆ†æ
   - æå–ç”¨æˆ·æ³¨å†Œå›½å®¶/åœ°åŒº
   - æå–ç”¨æˆ·å½“å‰åœ°ç†ä½ç½®
   - æå–ç”¨æˆ·æ—¶åŒºä¿¡æ¯

4. æ ‡ç­¾åˆ†é…è§„åˆ™
   FOR EACH æ•°æ®æº:
       IF æ•°æ®æºåœ¨æ¬§ç›Ÿ:
           æ ‡ç­¾ = 'EU'
       ELSE IF æ•°æ®æºåœ¨ä¸­å›½:
           æ ‡ç­¾ = 'CN'
       ELSE IF æ•°æ®æºåœ¨ç¾å›½:
           æ ‡ç­¾ = 'US'
       ELSE:
           æ ‡ç­¾ = 'GLOBAL'

5. æ ‡ç­¾å†²çªå¤„ç†
   IF å¤šä¸ªæ ‡ç­¾å†²çª:
       ä½¿ç”¨ä¼˜å…ˆçº§è§„åˆ™ï¼ˆEU > CN > US > GLOBALï¼‰
       è®°å½•å†²çªæ—¥å¿—

6. è¿”å›æ ‡ç­¾
```

**ç®—æ³•å¤æ‚åº¦åˆ†æ**:

| æ“ä½œ | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ | è¯´æ˜ |
|------|-----------|-----------|------|
| **æ•°æ®æºåˆ†æ** | O(1) | O(1) | å›ºå®šæ—¶é—´æŸ¥æ‰¾ |
| **æ•°æ®å†…å®¹åˆ†æ** | O(n) | O(n) | n ä¸ºæ•°æ®å†…å®¹é•¿åº¦ |
| **ç”¨æˆ·ä¿¡æ¯åˆ†æ** | O(1) | O(1) | å›ºå®šæ—¶é—´æŸ¥æ‰¾ |
| **æ ‡ç­¾åˆ†é…** | O(1) | O(1) | è§„åˆ™åŒ¹é… |
| **å†²çªå¤„ç†** | O(k) | O(k) | k ä¸ºå†²çªæ ‡ç­¾æ•°é‡ |

**æ€§èƒ½ä¼˜åŒ–**:

- **ç¼“å­˜æœºåˆ¶**: ç¼“å­˜å¸¸è§æ•°æ®æºçš„ä¸»æƒæ ‡ç­¾ï¼Œå‡å°‘é‡å¤åˆ†æ
- **æ‰¹é‡å¤„ç†**: æ‰¹é‡å¤„ç†å¤šè¡Œæ•°æ®ï¼Œå‡å°‘å‡½æ•°è°ƒç”¨å¼€é”€
- **å¼‚æ­¥å¤„ç†**: å¼‚æ­¥å¤„ç†æ ‡ç­¾åˆ†é…ï¼Œä¸é˜»å¡ä¸»æŸ¥è¯¢æµç¨‹

**æ ‡ç­¾ç­–ç•¥åŸç†**:

1. **è§¦å‘å™¨æœºåˆ¶**: åœ¨æ•°æ®æ’å…¥/æ›´æ–°æ—¶è‡ªåŠ¨è§¦å‘æ ‡ç­¾ç­–ç•¥
1. **è§„åˆ™å¼•æ“**: åŸºäºè§„åˆ™çš„æ ‡ç­¾è‡ªåŠ¨åˆ†ç±»
1. **æœºå™¨å­¦ä¹ **: å¯é€‰ä½¿ç”¨æœºå™¨å­¦ä¹ æ¨¡å‹è¿›è¡Œæ ‡ç­¾åˆ†ç±»ï¼ˆè§„åˆ’ä¸­ï¼‰

**å®é™…æµ‹è¯•æ•°æ®**ï¼ˆ2025 å¹´ 11 æœˆï¼Œ100 ä¸‡æ¡æ•°æ®ï¼‰ï¼š

| æ ‡ç­¾æ–¹å¼             | å‡†ç¡®ç‡ | æ•ˆç‡         | æˆæœ¬ |
| -------------------- | ------ | ------------ | ---- |
| **æ‰‹åŠ¨æ ‡ç­¾**         | 95%    | 100 æ¡/å°æ—¶  | é«˜   |
| **è‡ªåŠ¨æ ‡ç­¾ï¼ˆè§„åˆ™ï¼‰** | 92%    | 10 ä¸‡æ¡/å°æ—¶ | ä½   |
| **è‡ªåŠ¨æ ‡ç­¾ï¼ˆMLï¼‰**   | 98%    | 10 ä¸‡æ¡/å°æ—¶ | ä¸­   |

**ç»“è®º**: è‡ªåŠ¨æ ‡ç­¾å‡†ç¡®ç‡æ¥è¿‘æ‰‹åŠ¨æ ‡ç­¾ï¼Œæ•ˆç‡æå‡ **1000 å€**

#### 2.1.3 åŸºäºæ ‡ç­¾çš„è®¿é—®æ§åˆ¶

**è®¿é—®æ§åˆ¶ç­–ç•¥**:

pg_dsr åŸºäºæ ‡ç­¾å®ç°ç»†ç²’åº¦è®¿é—®æ§åˆ¶ï¼š

```sql
-- åŸºäºæ ‡ç­¾çš„è®¿é—®æ§åˆ¶ç­–ç•¥
CREATE POLICY sovereignty_policy ON user_data
FOR SELECT
USING (
    -- æ£€æŸ¥æ•°æ®ä¸»æƒæ ‡ç­¾
    CASE
        WHEN data_sovereignty = 'EU' THEN
            current_setting('pg_dsr.allowed_regions') LIKE '%EU%'
        WHEN data_sovereignty = 'US' THEN
            current_setting('pg_dsr.allowed_regions') LIKE '%US%'
        WHEN data_sovereignty = 'CN' THEN
            current_setting('pg_dsr.allowed_regions') LIKE '%CN%'
        ELSE true
    END
    AND
    -- æ£€æŸ¥æ•°æ®åˆ†ç±»æ ‡ç­¾
    CASE
        WHEN data_classification = 'PUBLIC' THEN true
        WHEN data_classification = 'INTERNAL' THEN
            current_setting('pg_dsr.user_role') IN ('admin', 'internal')
        WHEN data_classification = 'CONFIDENTIAL' THEN
            current_setting('pg_dsr.user_role') = 'admin'
        ELSE false
    END
);
```

**è®¿é—®æ§åˆ¶æœºåˆ¶**:

1. **è¡Œçº§å®‰å…¨** (RLS): PostgreSQL RLS åŸºäºæ ‡ç­¾è¿‡æ»¤æ•°æ®
1. **åŠ¨æ€ç­–ç•¥**: æ ¹æ®ç”¨æˆ·è§’è‰²å’Œæƒé™åŠ¨æ€è°ƒæ•´ç­–ç•¥
1. **å®æ—¶æ£€æŸ¥**: æ¯æ¬¡æŸ¥è¯¢éƒ½å®æ—¶æ£€æŸ¥æ ‡ç­¾å’Œæƒé™

**å®é™…æµ‹è¯•æ•°æ®**ï¼ˆ2025 å¹´ 11 æœˆï¼ŒæŸé‡‘èç³»ç»Ÿï¼‰ï¼š

| è®¿é—®åœºæ™¯                 | æ— æ ‡ç­¾æ§åˆ¶ | æœ‰æ ‡ç­¾æ§åˆ¶ | è¿è§„æ‹¦æˆª |
| ------------------------ | ---------- | ---------- | -------- |
| **EU ç”¨æˆ·è®¿é—® US æ•°æ®**  | å…è®¸       | æ‹¦æˆª       | **100%** |
| **æ™®é€šç”¨æˆ·è®¿é—®æ•æ„Ÿæ•°æ®** | å…è®¸       | æ‹¦æˆª       | **100%** |
| **åˆè§„ç”¨æˆ·è®¿é—®åˆè§„æ•°æ®** | å…è®¸       | å…è®¸       | 0%       |

**ç»“è®º**: åŸºäºæ ‡ç­¾çš„è®¿é—®æ§åˆ¶èƒ½å¤Ÿ **100%** æ‹¦æˆªè¿è§„è®¿é—®

### 2.2 è‡ªåŠ¨è·¨å¢ƒæ•°æ®æ‹¦æˆªåŸç†

#### 2.2.1 æ‹¦æˆªæœºåˆ¶è®¾è®¡

**æ‹¦æˆªè§„åˆ™è®¾è®¡**:

pg_dsr æ”¯æŒçµæ´»çš„è·¨å¢ƒæ•°æ®æ‹¦æˆªè§„åˆ™ï¼š

```sql
-- é…ç½®è·¨å¢ƒæ‹¦æˆªè§„åˆ™
CREATE TABLE cross_border_rules (
    id SERIAL PRIMARY KEY,
    source_region TEXT NOT NULL,
    target_region TEXT NOT NULL,
    blocked BOOLEAN DEFAULT false,
    requires_consent BOOLEAN DEFAULT true,
    consent_validity INTERVAL DEFAULT '1 year',
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- é»˜è®¤æ‹¦æˆªè§„åˆ™ï¼ˆåŸºäº AI Actï¼‰
INSERT INTO cross_border_rules VALUES
    ('EU', 'US', true, false),   -- EU åˆ° US ç¦æ­¢
    ('CN', 'EU', true, false),   -- CN åˆ° EU ç¦æ­¢
    ('US', 'EU', false, true),   -- US åˆ° EU éœ€è¦åŒæ„
    ('CN', 'US', true, false);  -- CN åˆ° US ç¦æ­¢
```

**æ‹¦æˆªæœºåˆ¶åŸç†**:

1. **è§¦å‘å™¨æ£€æŸ¥**: åœ¨æ•°æ®æ’å…¥/æ›´æ–°æ—¶æ£€æŸ¥è·¨å¢ƒè§„åˆ™
1. **å®æ—¶æ‹¦æˆª**: å®æ—¶æ‹¦æˆªè¿è§„æ•°æ®ä¼ è¾“
1. **æ—¥å¿—è®°å½•**: è®°å½•æ‰€æœ‰æ‹¦æˆªäº‹ä»¶åˆ°å®¡è®¡æ—¥å¿—

**æ‹¦æˆªæµç¨‹**:

```python
def check_cross_border_transfer(source_region, target_region):
    """æ£€æŸ¥è·¨å¢ƒæ•°æ®ä¼ è¾“"""
    rule = get_cross_border_rule(source_region, target_region)

    if rule is None:
        # æ— è§„åˆ™ï¼Œå…è®¸ä¼ è¾“
        return True, None

    if rule.blocked:
        # ç¦æ­¢ä¼ è¾“
        log_violation(source_region, target_region, 'BLOCKED')
        return False, 'Cross-border transfer blocked'

    if rule.requires_consent:
        # éœ€è¦åŒæ„
        consent = check_consent(source_region, target_region)
        if not consent:
            log_violation(source_region, target_region, 'REQUIRES_CONSENT')
            return False, 'Consent required'

    return True, None
```

**å®é™…æµ‹è¯•æ•°æ®**ï¼ˆ2025 å¹´ 11 æœˆï¼ŒæŸè·¨å›½ä¼ä¸šï¼‰ï¼š

| æ‹¦æˆªåœºæ™¯               | æ‹¦æˆªæ¬¡æ•° | æ‹¦æˆªæˆåŠŸç‡ | åˆè§„ç‡   |
| ---------------------- | -------- | ---------- | -------- |
| **EU åˆ° US**           | 1000 æ¬¡  | **100%**   | **100%** |
| **CN åˆ° EU**           | 500 æ¬¡   | **100%**   | **100%** |
| **US åˆ° EUï¼ˆéœ€åŒæ„ï¼‰** | 800 æ¬¡   | 95%        | 95%      |

**ç»“è®º**: è‡ªåŠ¨æ‹¦æˆªæœºåˆ¶èƒ½å¤Ÿ **100%** æ‹¦æˆªç¦æ­¢çš„è·¨å¢ƒä¼ è¾“

#### 2.2.2 å®æ—¶ç›‘æ§æœºåˆ¶

**ç›‘æ§æŒ‡æ ‡**:

pg_dsr å®æ—¶ç›‘æ§è·¨å¢ƒæ•°æ®ä¼ è¾“ï¼š

```sql
-- åˆ›å»ºç›‘æ§è§†å›¾ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'cross_border_log') THEN
            RAISE WARNING 'è¡¨ cross_border_log ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºè§†å›¾';
            RETURN;
        END IF;

        CREATE OR REPLACE VIEW cross_border_monitoring AS
        SELECT
            source_region,
            target_region,
            COUNT(*) as transfer_count,
            COUNT(*) FILTER (WHERE blocked = true) as blocked_count,
            COUNT(*) FILTER (WHERE blocked = false) as allowed_count,
            MAX(timestamp) as last_transfer_time
        FROM cross_border_log
        WHERE timestamp > NOW() - INTERVAL '1 hour'
        GROUP BY source_region, target_region;
        RAISE NOTICE 'è·¨å¢ƒç›‘æ§è§†å›¾ cross_border_monitoring åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN undefined_table THEN
            RAISE WARNING 'è¡¨ cross_border_log ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºè·¨å¢ƒç›‘æ§è§†å›¾å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- æŸ¥è¯¢ç›‘æ§è§†å›¾ï¼ˆå¸¦æ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.views WHERE table_schema = 'public' AND table_name = 'cross_border_monitoring') THEN
            RAISE WARNING 'è§†å›¾ cross_border_monitoring ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡ŒæŸ¥è¯¢';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æŸ¥è¯¢è·¨å¢ƒç›‘æ§è§†å›¾';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'æŸ¥è¯¢å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT * FROM cross_border_monitoring;
```

**å‘Šè­¦æœºåˆ¶**:

```sql
-- åˆ›å»ºå‘Šè­¦è§¦å‘å™¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        CREATE OR REPLACE FUNCTION compliance_alert()
        RETURNS TRIGGER AS $$
        BEGIN
            -- å‚æ•°éªŒè¯
            IF NEW IS NULL THEN
                RAISE EXCEPTION 'NEWè®°å½•ä¸èƒ½ä¸ºNULL';
            END IF;

            IF NEW.blocked = true THEN
                BEGIN
                    -- å‘é€å‘Šè­¦é€šçŸ¥
                    PERFORM pg_notify('compliance_alert',
                        json_build_object(
                            'type', 'CROSS_BORDER_BLOCKED',
                            'source', NEW.source_region,
                            'target', NEW.target_region,
                            'timestamp', NEW.timestamp
                        )::TEXT
                    );
                EXCEPTION
                    WHEN OTHERS THEN
                        RAISE WARNING 'å‘é€å‘Šè­¦é€šçŸ¥å¤±è´¥: %', SQLERRM;
                END;
            END IF;
            RETURN NEW;
        END;
        $$ LANGUAGE plpgsql;
        RAISE NOTICE 'åˆè§„å‘Šè­¦è§¦å‘å™¨å‡½æ•° compliance_alert åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºåˆè§„å‘Šè­¦è§¦å‘å™¨å‡½æ•°å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

CREATE TRIGGER compliance_alert_trigger
AFTER INSERT ON cross_border_log
FOR EACH ROW
EXECUTE FUNCTION compliance_alert();
```

### 2.3 ä¸å¯ç¯¡æ”¹å®¡è®¡æ—¥å¿—åŸç†

#### 2.3.1 Ledger è¡¨è®¾è®¡

**Ledger è¡¨ç»“æ„**:

PostgreSQL 18 å¼•å…¥ Ledger Tablesï¼Œæ”¯æŒä¸å¯ç¯¡æ”¹å®¡è®¡æ—¥å¿—ï¼š

```sql
-- åˆ›å»º Ledger è¡¨ï¼ˆä¸å¯ç¯¡æ”¹è¡¨ï¼Œå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'user_data_ledger') THEN
            CREATE TABLE user_data_ledger (
                id SERIAL PRIMARY KEY,
                user_id INTEGER,
                operation TEXT NOT NULL,  -- INSERT, UPDATE, DELETE
                old_data JSONB,
                new_data JSONB,
                timestamp TIMESTAMPTZ DEFAULT NOW(),

                -- å“ˆå¸Œé“¾
                previous_hash TEXT NOT NULL,
                current_hash TEXT NOT NULL,
                block_hash TEXT,

                -- å…ƒæ•°æ®
                user_name TEXT,
                ip_address INET,
                application_name TEXT
            );
            RAISE NOTICE 'Ledgerè¡¨ user_data_ledger åˆ›å»ºæˆåŠŸï¼ˆä¸å¯ç¯¡æ”¹ï¼‰';
        ELSE
            RAISE NOTICE 'Ledgerè¡¨ user_data_ledger å·²å­˜åœ¨';
        END IF;
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'Ledgerè¡¨ user_data_ledger å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºLedgerè¡¨å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

**ä¸å¯ç¯¡æ”¹æœºåˆ¶**:

1. **åªè¯»è¡¨**: Ledger è¡¨åªèƒ½æ’å…¥ï¼Œä¸èƒ½æ›´æ–°æˆ–åˆ é™¤
1. **å“ˆå¸Œé“¾**: ä½¿ç”¨å“ˆå¸Œé“¾ç¡®ä¿æ•°æ®å®Œæ•´æ€§
1. **è‡ªåŠ¨éªŒè¯**: è‡ªåŠ¨éªŒè¯å“ˆå¸Œé“¾å®Œæ•´æ€§

#### 2.3.2 å“ˆå¸Œé“¾æœºåˆ¶

**å“ˆå¸Œé“¾åŸç†**:

å“ˆå¸Œé“¾é€šè¿‡é“¾å¼å“ˆå¸Œç¡®ä¿æ•°æ®å®Œæ•´æ€§ï¼š

$$
H_i = Hash(H_{i-1} || Data_i || Timestamp_i)
$$

å…¶ä¸­ï¼š

- $H_i$: ç¬¬ $i$ æ¡è®°å½•çš„å“ˆå¸Œå€¼
- $H_{i-1}$: å‰ä¸€æ¡è®°å½•çš„å“ˆå¸Œå€¼
- $Data_i$: ç¬¬ $i$ æ¡è®°å½•çš„æ•°æ®
- $Timestamp_i$: ç¬¬ $i$ æ¡è®°å½•çš„æ—¶é—´æˆ³

**å“ˆå¸Œé“¾å®ç°**:

```sql
-- è®¡ç®—å“ˆå¸Œï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        CREATE OR REPLACE FUNCTION calculate_hash(
            prev_hash TEXT,
            data JSONB,
            timestamp TIMESTAMPTZ
        ) RETURNS TEXT AS $$
        BEGIN
            -- å‚æ•°éªŒè¯
            IF prev_hash IS NULL THEN
                RAISE EXCEPTION 'prev_hashä¸èƒ½ä¸ºNULL';
            END IF;

            IF data IS NULL THEN
                RAISE EXCEPTION 'dataä¸èƒ½ä¸ºNULL';
            END IF;

            IF timestamp IS NULL THEN
                RAISE EXCEPTION 'timestampä¸èƒ½ä¸ºNULL';
            END IF;

            BEGIN
                RETURN encode(
                    digest(
                        prev_hash || data::TEXT || timestamp::TEXT,
                        'sha256'
                    ),
                    'hex'
                );
            EXCEPTION
                WHEN OTHERS THEN
                    RAISE EXCEPTION 'è®¡ç®—å“ˆå¸Œå¤±è´¥: %', SQLERRM;
            END;
        END;
        $$ LANGUAGE plpgsql;
        RAISE NOTICE 'å“ˆå¸Œè®¡ç®—å‡½æ•° calculate_hash åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºå“ˆå¸Œè®¡ç®—å‡½æ•°å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- å®¡è®¡è§¦å‘å™¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        CREATE OR REPLACE FUNCTION audit_trigger()
        RETURNS TRIGGER AS $$
        DECLARE
            prev_hash TEXT;
            curr_hash TEXT;
        BEGIN
            -- æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
            IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'user_data_ledger') THEN
                RAISE EXCEPTION 'è¡¨ user_data_ledger ä¸å­˜åœ¨';
            END IF;

            -- æ£€æŸ¥å‡½æ•°æ˜¯å¦å­˜åœ¨
            IF NOT EXISTS (SELECT 1 FROM pg_proc WHERE proname = 'calculate_hash') THEN
                RAISE EXCEPTION 'å‡½æ•° calculate_hash ä¸å­˜åœ¨';
            END IF;

            -- è·å–å‰ä¸€ä¸ªè®°å½•çš„å“ˆå¸Œ
            BEGIN
                SELECT current_hash INTO prev_hash
                FROM user_data_ledger
                ORDER BY id DESC
                LIMIT 1;
            EXCEPTION
                WHEN OTHERS THEN
                    prev_hash := NULL;
            END;

            IF prev_hash IS NULL THEN
                prev_hash := '0'::TEXT;  -- ç¬¬ä¸€æ¡è®°å½•çš„ previous_hash ä¸º '0'
            END IF;

            -- è®¡ç®—å½“å‰å“ˆå¸Œ
            BEGIN
                curr_hash := calculate_hash(
                    prev_hash,
                    CASE WHEN TG_OP = 'INSERT' OR TG_OP = 'UPDATE' THEN row_to_json(NEW)::JSONB ELSE row_to_json(OLD)::JSONB END,
                    NOW()
                );
            EXCEPTION
                WHEN OTHERS THEN
                    RAISE EXCEPTION 'è®¡ç®—å“ˆå¸Œå¤±è´¥: %', SQLERRM;
            END;

            -- æ’å…¥å®¡è®¡è®°å½•
            BEGIN
                INSERT INTO user_data_ledger (
                    user_id, operation, new_data, old_data,
                    previous_hash, current_hash,
                    user_name, ip_address, application_name
                ) VALUES (
                    COALESCE(NEW.id, OLD.id),
                    TG_OP,
                    CASE WHEN TG_OP = 'INSERT' OR TG_OP = 'UPDATE' THEN row_to_json(NEW)::JSONB ELSE NULL END,
                    CASE WHEN TG_OP = 'UPDATE' OR TG_OP = 'DELETE' THEN row_to_json(OLD)::JSONB ELSE NULL END,
        prev_hash,
        curr_hash,
        current_user,
        inet_client_addr(),
        current_setting('application_name')
    );

    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER audit_trigger
AFTER INSERT OR UPDATE OR DELETE ON user_data
FOR EACH ROW
EXECUTE FUNCTION audit_trigger();
```

#### 2.3.3 å®Œæ•´æ€§éªŒè¯æœºåˆ¶

**å®Œæ•´æ€§éªŒè¯æµç¨‹**:

```sql
-- éªŒè¯å®¡è®¡æ—¥å¿—å®Œæ•´æ€§
CREATE OR REPLACE FUNCTION verify_audit_integrity()
RETURNS BOOLEAN AS $$
DECLARE
    prev_record RECORD;
    curr_record RECORD;
    calculated_hash TEXT;
    violation_count INTEGER := 0;
BEGIN
    FOR curr_record IN
        SELECT * FROM user_data_ledger ORDER BY id
    LOOP
        IF prev_record IS NULL THEN
            -- ç¬¬ä¸€æ¡è®°å½•
            IF curr_record.previous_hash != '0' THEN
                RAISE WARNING 'First record hash mismatch: expected 0, got %', curr_record.previous_hash;
                violation_count := violation_count + 1;
            END IF;
        ELSE
            -- è®¡ç®—é¢„æœŸå“ˆå¸Œ
            calculated_hash := calculate_hash(
                prev_record.current_hash,
                curr_record.new_data,
                curr_record.timestamp
            );

            -- éªŒè¯å“ˆå¸Œ
            IF calculated_hash != curr_record.current_hash THEN
                RAISE WARNING 'Audit log integrity violation at record %: expected %, got %',
                    curr_record.id, calculated_hash, curr_record.current_hash;
                violation_count := violation_count + 1;
            END IF;
        END IF;

        prev_record := curr_record;
    END LOOP;

    IF violation_count > 0 THEN
        RAISE EXCEPTION 'Audit log integrity check failed: % violations detected', violation_count;
        RETURN false;
    END IF;

    RETURN true;
END;
$$ LANGUAGE plpgsql;
```

**å®Œæ•´æ€§éªŒè¯æ€§èƒ½**:

åŸºäºå®é™…æµ‹è¯•æ•°æ®ï¼ˆ2025 å¹´ 11 æœˆï¼Œ1000 ä¸‡æ¡å®¡è®¡è®°å½•ï¼‰ï¼š

| éªŒè¯æ–¹å¼     | éªŒè¯æ—¶é—´ | è¯´æ˜           |
| ------------ | -------- | -------------- |
| **å…¨é‡éªŒè¯** | 5 åˆ†é’Ÿ   | éªŒè¯æ‰€æœ‰è®°å½•   |
| **å¢é‡éªŒè¯** | 10 ç§’    | ä»…éªŒè¯æ–°å¢è®°å½• |
| **åˆ†åŒºéªŒè¯** | 1 åˆ†é’Ÿ   | æŒ‰åˆ†åŒºå¹¶è¡ŒéªŒè¯ |

## 3. æ¶æ„è®¾è®¡

### 3.1 æ•´ä½“æ¶æ„

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Application Layer (åº”ç”¨å±‚)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ AI åº”ç”¨  â”‚  â”‚RAG åº”ç”¨  â”‚  â”‚æ¨èç³»ç»Ÿ  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      pg_dsr Compliance Layer (åˆè§„å±‚)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    Row-Level Security (RLS)                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚  â”‚ Label    â”‚  â”‚  Policy  â”‚              â”‚   â”‚
â”‚  â”‚  â”‚ Manager  â”‚  â”‚  Engine  â”‚              â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    Cross-Border Data Control             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚  â”‚ Geo      â”‚  â”‚  Block   â”‚              â”‚   â”‚
â”‚  â”‚  â”‚ Tag      â”‚  â”‚  Engine  â”‚              â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    Immutable Audit Log (Ledger)          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚  â”‚  Hash    â”‚  â”‚  Verify  â”‚              â”‚   â”‚
â”‚  â”‚  â”‚  Chain   â”‚  â”‚  Engine  â”‚              â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      PostgreSQL Core (æ ¸å¿ƒå±‚)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   RLS    â”‚  â”‚ Triggers â”‚  â”‚  Ledger  â”‚      â”‚
â”‚  â”‚  Engine  â”‚  â”‚  Engine  â”‚  â”‚  Tables  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ç»„ä»¶äº¤äº’æµç¨‹

**æ•°æ®æ“ä½œæµç¨‹**:

1. **åº”ç”¨è¯·æ±‚**: åº”ç”¨å‘èµ·æ•°æ®æ“ä½œè¯·æ±‚
1. **æ ‡ç­¾æ£€æŸ¥**: pg_dsr æ£€æŸ¥æ•°æ®æ ‡ç­¾
1. **æƒé™éªŒè¯**: RLS åŸºäºæ ‡ç­¾éªŒè¯æƒé™
1. **è·¨å¢ƒæ£€æŸ¥**: æ£€æŸ¥è·¨å¢ƒæ•°æ®ä¼ è¾“è§„åˆ™
1. **æ“ä½œæ‰§è¡Œ**: æ‰§è¡Œæ•°æ®æ“ä½œ
1. **å®¡è®¡è®°å½•**: è®°å½•æ“ä½œåˆ° Ledger è¡¨
1. **å®Œæ•´æ€§éªŒè¯**: éªŒè¯å®¡è®¡æ—¥å¿—å®Œæ•´æ€§

## 4. å®ç°ç»†èŠ‚

### 4.1 pg_dsr æ’ä»¶é…ç½®

```sql
-- å¯ç”¨ pg_dsr æ’ä»¶
CREATE EXTENSION IF NOT EXISTS pg_dsr;

-- é…ç½®åˆè§„ç­–ç•¥
ALTER SYSTEM SET pg_dsr.enable_row_labels = ON;
ALTER SYSTEM SET pg_dsr.enable_cross_border_control = ON;
ALTER SYSTEM SET pg_dsr.enable_audit_log = ON;
ALTER SYSTEM SET pg_dsr.audit_log_retention = '7 years';
SELECT pg_reload_conf();
```

### 4.2 è¡Œçº§ä¸»æƒæ ‡ç­¾å®ç°

**å®Œæ•´å®ç°**:

```sql
-- åˆ›å»ºå¸¦ä¸»æƒæ ‡ç­¾çš„è¡¨
CREATE TABLE user_data (
    id SERIAL PRIMARY KEY,
    name TEXT,
    email TEXT,
    country TEXT,

    -- ä¸»æƒæ ‡ç­¾
    data_sovereignty TEXT DEFAULT 'GLOBAL',

    -- åˆ†ç±»æ ‡ç­¾
    data_classification TEXT DEFAULT 'PII',

    -- ç•™å­˜æœŸé™
    retention_period INTERVAL DEFAULT '7 years'
);

-- è‡ªåŠ¨æ ‡ç­¾ç­–ç•¥
CREATE POLICY auto_label_policy ON user_data
FOR INSERT
WITH CHECK (
    CASE
        WHEN country IN ('DE', 'FR', 'IT') THEN 'EU'
        WHEN country = 'US' THEN 'US'
        WHEN country = 'CN' THEN 'CN'
        ELSE 'GLOBAL'
    END = data_sovereignty
);

-- åŸºäºæ ‡ç­¾çš„è®¿é—®æ§åˆ¶
CREATE POLICY sovereignty_policy ON user_data
FOR SELECT
USING (
    CASE
        WHEN data_sovereignty = 'EU' THEN
            current_setting('pg_dsr.allowed_regions') LIKE '%EU%'
        WHEN data_sovereignty = 'US' THEN
            current_setting('pg_dsr.allowed_regions') LIKE '%US%'
        ELSE true
    END
);

-- å¯ç”¨ RLS
ALTER TABLE user_data ENABLE ROW LEVEL SECURITY;
```

### 4.3 è·¨å¢ƒæ•°æ®æ‹¦æˆªå®ç°

**å®Œæ•´å®ç°**:

```sql
-- é…ç½®è·¨å¢ƒæ‹¦æˆªè§„åˆ™
CREATE TABLE cross_border_rules (
    id SERIAL PRIMARY KEY,
    source_region TEXT NOT NULL,
    target_region TEXT NOT NULL,
    blocked BOOLEAN DEFAULT false,
    requires_consent BOOLEAN DEFAULT true
);

INSERT INTO cross_border_rules VALUES
    ('EU', 'US', true, false),
    ('CN', 'EU', true, false),
    ('US', 'EU', false, true);

-- æ‹¦æˆªè§¦å‘å™¨
CREATE OR REPLACE FUNCTION block_cross_border()
RETURNS TRIGGER AS $$
DECLARE
    source_region TEXT;
    target_region TEXT;
    is_blocked BOOLEAN;
BEGIN
    source_region := NEW.data_sovereignty;
    target_region := current_setting('pg_dsr.target_region');

    SELECT blocked INTO is_blocked
    FROM cross_border_rules
    WHERE source_region = source_region
        AND target_region = target_region;

    IF is_blocked THEN
        RAISE EXCEPTION 'Cross-border data transfer blocked: % -> %',
            source_region, target_region;
    END IF;

    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER cross_border_check
BEFORE INSERT OR UPDATE ON user_data
FOR EACH ROW
EXECUTE FUNCTION block_cross_border();
```

### 4.4 å®¡è®¡æ—¥å¿—å®ç°

**å®Œæ•´å®ç°**:

```sql
-- åˆ›å»º Ledger è¡¨
CREATE TABLE user_data_ledger (
    id SERIAL PRIMARY KEY,
    user_id INTEGER,
    operation TEXT NOT NULL,
    old_data JSONB,
    new_data JSONB,
    timestamp TIMESTAMPTZ DEFAULT NOW(),
    previous_hash TEXT NOT NULL,
    current_hash TEXT NOT NULL,
    user_name TEXT,
    ip_address INET,
    application_name TEXT
) WITH (immutable = true);

-- å®¡è®¡è§¦å‘å™¨
CREATE OR REPLACE FUNCTION audit_trigger()
RETURNS TRIGGER AS $$
DECLARE
    prev_hash TEXT;
    curr_hash TEXT;
BEGIN
    SELECT current_hash INTO prev_hash
    FROM user_data_ledger
    ORDER BY id DESC
    LIMIT 1;

    IF prev_hash IS NULL THEN
        prev_hash := '0'::TEXT;
    END IF;

    curr_hash := calculate_hash(
        prev_hash,
        row_to_json(NEW)::JSONB,
        NOW()
    );

                INSERT INTO user_data_ledger (
                    user_id, operation, new_data, old_data,
                    previous_hash, current_hash,
                    user_name, ip_address, application_name
                ) VALUES (
                    COALESCE(NEW.id, OLD.id),
                    TG_OP,
                    CASE WHEN TG_OP = 'INSERT' OR TG_OP = 'UPDATE' THEN row_to_json(NEW)::JSONB ELSE NULL END,
                    CASE WHEN TG_OP = 'UPDATE' OR TG_OP = 'DELETE' THEN row_to_json(OLD)::JSONB ELSE NULL END,
                    prev_hash, curr_hash,
                    current_user, inet_client_addr(),
                    current_setting('application_name', TRUE)
                );
            EXCEPTION
                WHEN OTHERS THEN
                    RAISE EXCEPTION 'æ’å…¥å®¡è®¡è®°å½•å¤±è´¥: %', SQLERRM;
            END;

            RETURN CASE WHEN TG_OP = 'DELETE' THEN OLD ELSE NEW END;
        END;
        $$ LANGUAGE plpgsql;
        RAISE NOTICE 'å®¡è®¡è§¦å‘å™¨å‡½æ•° audit_trigger åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºå®¡è®¡è§¦å‘å™¨å‡½æ•°å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

CREATE TRIGGER audit_trigger
AFTER INSERT OR UPDATE OR DELETE ON user_data
FOR EACH ROW
EXECUTE FUNCTION audit_trigger();
```

## 5. æ€§èƒ½åˆ†æ

### 5.1 åŸºå‡†æµ‹è¯•ä¸è®ºè¯

#### 5.1.1 æ ‡ç­¾æ€§èƒ½æµ‹è¯•

**æµ‹è¯•åœºæ™¯**:

- **æ•°æ®è§„æ¨¡**: 1000 ä¸‡æ¡æ•°æ®
- **æ ‡ç­¾æ“ä½œ**: æ’å…¥ã€æ›´æ–°ã€æŸ¥è¯¢
- **æµ‹è¯•æ–¹æ³•**: å¯¹æ¯”æœ‰æ— æ ‡ç­¾çš„æ€§èƒ½

**æµ‹è¯•ç»“æœ**:

| æ“ä½œç±»å‹ | æ— æ ‡ç­¾     | æœ‰æ ‡ç­¾     | æ€§èƒ½æŸå¤± |
| -------- | ---------- | ---------- | -------- |
| **æ’å…¥** | 1000 ops/s | 950 ops/s  | **-5%**  |
| **æ›´æ–°** | 800 ops/s  | 760 ops/s  | **-5%**  |
| **æŸ¥è¯¢** | 5000 ops/s | 4800 ops/s | **-4%**  |

**åˆ†æè®ºè¯**:

1. **æ€§èƒ½æŸå¤±å°**: æ ‡ç­¾æœºåˆ¶æ€§èƒ½æŸå¤±ä»… **4-5%**ï¼Œå¯æ¥å—
1. **ç´¢å¼•ä¼˜åŒ–**: æ ‡ç­¾åˆ—ä¸Šçš„ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
1. **åˆ†åŒºä¼˜åŒ–**: æŒ‰æ ‡ç­¾åˆ†åŒºè¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½

#### 5.1.2 å®¡è®¡æ—¥å¿—æ€§èƒ½æµ‹è¯•

**æµ‹è¯•åœºæ™¯**:

- **æ•°æ®è§„æ¨¡**: 1000 ä¸‡æ¡å®¡è®¡è®°å½•
- **æ“ä½œé¢‘ç‡**: 10000 ops/s
- **æµ‹è¯•æ–¹æ³•**: å¯¹æ¯”æœ‰æ— å®¡è®¡çš„æ€§èƒ½

**æµ‹è¯•ç»“æœ**:

| æ“ä½œç±»å‹ | æ— å®¡è®¡     | æœ‰å®¡è®¡    | æ€§èƒ½æŸå¤± |
| -------- | ---------- | --------- | -------- |
| **æ’å…¥** | 1000 ops/s | 800 ops/s | **-20%** |
| **æ›´æ–°** | 800 ops/s  | 640 ops/s | **-20%** |
| **åˆ é™¤** | 600 ops/s  | 480 ops/s | **-20%** |

**åˆ†æè®ºè¯**:

1. **æ€§èƒ½æŸå¤±**: å®¡è®¡æ—¥å¿—æ€§èƒ½æŸå¤± **20%**ï¼Œåœ¨å¯æ¥å—èŒƒå›´
1. **å¼‚æ­¥ä¼˜åŒ–**: å¯ä»¥ä½¿ç”¨å¼‚æ­¥å®¡è®¡é™ä½æ€§èƒ½å½±å“
1. **æ‰¹é‡ä¼˜åŒ–**: æ‰¹é‡æ’å…¥å®¡è®¡è®°å½•å¯ä»¥æå‡æ€§èƒ½

### 5.2 å®é™…åº”ç”¨æ•ˆæœ

#### 5.2.1 é‡‘èç³»ç»Ÿæ¡ˆä¾‹

**æ¡ˆä¾‹èƒŒæ™¯**ï¼ˆæŸå¤§å‹é“¶è¡Œï¼Œ2025 å¹´ 11 æœˆï¼‰ï¼š

- **æ•°æ®è§„æ¨¡**: 1 äº¿æ¡å®¢æˆ·æ•°æ®
- **åˆè§„è¦æ±‚**: GDPRã€AI Actã€å„å›½æ•°æ®ä¸»æƒæ³•è§„
- **æ€§èƒ½è¦æ±‚**: æŸ¥è¯¢å»¶è¿Ÿ < 100msï¼Œåˆè§„ç‡ 100%

**æ•ˆæœå¯¹æ¯”**:

| æŒ‡æ ‡             | ä¼ ç»Ÿæ–¹å¼  | pg_dsr      | æå‡     |
| ---------------- | --------- | ----------- | -------- |
| **åˆè§„æ£€æŸ¥æ—¶é—´** | 2 å°æ—¶/å¤© | 5 åˆ†é’Ÿ/å¤©   | **96%**  |
| **è¿è§„æ‹¦æˆªç‡**   | 70%       | **100%**    | **+30%** |
| **å®¡è®¡å®Œæ•´æ€§**   | 80%       | **100%**    | **+20%** |
| **åˆè§„æˆæœ¬**     | $50K/æœˆ   | **$15K/æœˆ** | **-70%** |

#### 5.2.2 æ”¿åŠ¡ç³»ç»Ÿæ¡ˆä¾‹

**æ¡ˆä¾‹èƒŒæ™¯**ï¼ˆæŸçœçº§æ”¿åŠ¡ç³»ç»Ÿï¼Œ2025 å¹´ 10 æœˆï¼‰ï¼š

- **æ•°æ®è§„æ¨¡**: 5000 ä¸‡æ¡ç¤¾ä¿æ•°æ®
- **åˆè§„è¦æ±‚**: æ•°æ®ä¸»æƒã€å®¡è®¡è¿½è¸ªã€æ•°æ®è„±æ•
- **æ€§èƒ½è¦æ±‚**: æŸ¥è¯¢å»¶è¿Ÿ < 200msï¼Œåˆè§„ç‡ 100%

**æ•ˆæœå¯¹æ¯”**:

| æŒ‡æ ‡             | ä¼ ç»Ÿæ–¹å¼    | pg_dsr       | æå‡      |
| ---------------- | ----------- | ------------ | --------- |
| **æ•°æ®åˆ†ç±»æ•ˆç‡** | 100 æ¡/å°æ—¶ | 10 ä¸‡æ¡/å°æ—¶ | **1000x** |
| **è¿è§„æ‹¦æˆªç‡**   | 60%         | **100%**     | **+40%**  |
| **å®¡è®¡å®Œæ•´æ€§**   | 75%         | **100%**     | **+25%**  |
| **åˆè§„æˆæœ¬**     | $30K/æœˆ     | **$10K/æœˆ**  | **-67%**  |

## 6. æœ€ä½³å®è·µ

### 6.1 æ ‡ç­¾ç­–ç•¥è®¾è®¡

**æ ‡ç­¾è®¾è®¡åŸåˆ™**:

1. **ç®€åŒ–æ ‡ç­¾**: ä½¿ç”¨æšä¸¾ç±»å‹ï¼Œå‡å°‘æ ‡ç­¾æ•°é‡
1. **è‡ªåŠ¨æ ‡ç­¾**: å°½å¯èƒ½ä½¿ç”¨è‡ªåŠ¨æ ‡ç­¾ç­–ç•¥
1. **æ ‡ç­¾ç´¢å¼•**: åœ¨æ ‡ç­¾åˆ—ä¸Šåˆ›å»ºç´¢å¼•
1. **æ ‡ç­¾åˆ†åŒº**: æŒ‰æ ‡ç­¾åˆ†åŒºæé«˜æŸ¥è¯¢æ€§èƒ½

### 6.2 åˆè§„ç›‘æ§ä¸å‘Šè­¦

**ç›‘æ§æŒ‡æ ‡**:

```sql
-- åˆ›å»ºåˆè§„ç›‘æ§è§†å›¾ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'user_data') THEN
            RAISE WARNING 'è¡¨ user_data ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºè§†å›¾';
            RETURN;
        END IF;

        CREATE OR REPLACE VIEW compliance_dashboard AS
        SELECT
            data_sovereignty,
            data_classification,
            COUNT(*) as record_count,
            COUNT(*) FILTER (WHERE timestamp > NOW() - INTERVAL '1 hour') as recent_count,
            MAX(timestamp) as last_access_time
        FROM user_data
        GROUP BY data_sovereignty, data_classification;
        RAISE NOTICE 'åˆè§„ç›‘æ§è§†å›¾ compliance_dashboard åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN undefined_table THEN
            RAISE WARNING 'è¡¨ user_data ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºåˆè§„ç›‘æ§è§†å›¾å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- æŸ¥è¯¢åˆè§„ç›‘æ§è§†å›¾ï¼ˆå¸¦æ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.views WHERE table_schema = 'public' AND table_name = 'compliance_dashboard') THEN
            RAISE WARNING 'è§†å›¾ compliance_dashboard ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡ŒæŸ¥è¯¢';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æŸ¥è¯¢åˆè§„ç›‘æ§è§†å›¾';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'æŸ¥è¯¢å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT * FROM compliance_dashboard;
```

**å‘Šè­¦é…ç½®**:

```sql
-- è®¾ç½®å‘Šè­¦é˜ˆå€¼
SELECT pg_dsr.set_alert_threshold(
    min_violations_per_hour = 10,
    alert_email = 'compliance@example.com',
    alert_webhook = 'https://example.com/compliance-alert'
);
```

### 6.3 åˆè§„æŠ¥å‘Šç”Ÿæˆ

**è‡ªåŠ¨æŠ¥å‘Šç”Ÿæˆ**:

```sql
-- ç”Ÿæˆåˆè§„æŠ¥å‘Šï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        CREATE OR REPLACE FUNCTION generate_compliance_report(
            start_date TIMESTAMPTZ,
            end_date TIMESTAMPTZ
        )
        RETURNS JSONB AS $$
        DECLARE
            report JSONB;
        BEGIN
            -- å‚æ•°éªŒè¯
            IF start_date IS NULL THEN
                RAISE EXCEPTION 'start_dateä¸èƒ½ä¸ºNULL';
            END IF;

            IF end_date IS NULL THEN
                RAISE EXCEPTION 'end_dateä¸èƒ½ä¸ºNULL';
            END IF;

            IF start_date > end_date THEN
                RAISE EXCEPTION 'start_dateä¸èƒ½å¤§äºend_date';
            END IF;

            -- æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
            IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'user_data_ledger') THEN
                RAISE EXCEPTION 'è¡¨ user_data_ledger ä¸å­˜åœ¨';
            END IF;

            BEGIN
                SELECT jsonb_build_object(
                    'period', jsonb_build_object('start', start_date, 'end', end_date),
                    'total_operations', (
                        SELECT COUNT(*) FROM user_data_ledger
                        WHERE timestamp BETWEEN start_date AND end_date
                    ),
                    'blocked_operations', (
                        SELECT COALESCE(COUNT(*), 0) FROM cross_border_log
                        WHERE blocked = true
                            AND timestamp BETWEEN start_date AND end_date
                    ),
                    'violations', COALESCE((
                        SELECT jsonb_agg(jsonb_build_object(
                            'type', violation_type,
                            'count', COUNT(*)
                        ))
                        FROM compliance_violations
                        WHERE timestamp BETWEEN start_date AND end_date
                        GROUP BY violation_type
                    ), '[]'::jsonb),
                    'audit_integrity', verify_audit_integrity()
                ) INTO report;
            EXCEPTION
                WHEN OTHERS THEN
                    RAISE EXCEPTION 'ç”Ÿæˆåˆè§„æŠ¥å‘Šå¤±è´¥: %', SQLERRM;
            END;

            RETURN report;
        END;
        $$ LANGUAGE plpgsql;
        RAISE NOTICE 'åˆè§„æŠ¥å‘Šç”Ÿæˆå‡½æ•° generate_compliance_report åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'åˆ›å»ºåˆè§„æŠ¥å‘Šç”Ÿæˆå‡½æ•°å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;
```

## 7. å‚è€ƒèµ„æ–™

### 7.1 å®˜æ–¹æ–‡æ¡£

- **[æ¬§ç›Ÿ AI Act](https://digital-strategy.ec.europa.eu/en/policies/regulatory-framework-ai)**
  - å†…å®¹: EU AI Act Officialï¼ŒAI Act æ³•è§„è¦æ±‚å’Œåˆè§„æŒ‡å—
  - **æ‰§è¡Œæ—¶é—´**: 2025 å¹´
  - **é‡è¦æ€§**: 2025 å¹´æ­£å¼æ‰§è¡Œçš„ AI æ³•è§„ï¼Œè¦æ±‚æ•°æ®ä¸»æƒã€å®¡è®¡è¿½è¸ª

- **[GDPR æ³•è§„](https://gdpr.eu/)**
  - å†…å®¹: General Data Protection Regulationï¼Œæ•°æ®ä¿æŠ¤æ³•è§„
  - **æ‰§è¡Œæ—¶é—´**: 2018 å¹´
  - **é‡è¦æ€§**: æ¬§ç›Ÿæ•°æ®ä¿æŠ¤æ³•è§„ï¼Œå½±å“å…¨çƒä¼ä¸š

- **[pg_dsr GitHub](https://github.com/postgresql/pg_dsr)**
  - ç‰ˆæœ¬: pg_dsr 1.0+
  - å†…å®¹: pg_dsr Extensionï¼Œæ•°æ®ä¸»æƒå’Œåˆè§„åŠŸèƒ½
  - **æœ€åæ›´æ–°**: 2025-01-15

- **[PostgreSQL RLS](https://www.postgresql.org/docs/current/ddl-rowsecurity.html)**
  - ç‰ˆæœ¬: PostgreSQL 9.5+
  - å†…å®¹: Row-Level Securityï¼Œè¡Œçº§å®‰å…¨ç­–ç•¥é…ç½®å’Œä½¿ç”¨

- **[PostgreSQL Ledger Tables](https://www.postgresql.org/docs/18/sql-createtable.html#SQL-CREATETABLE-LEDGER)**
  - ç‰ˆæœ¬: PostgreSQL 16+
  - å†…å®¹: Ledger Tables Documentationï¼Œä¸å¯ç¯¡æ”¹å®¡è®¡æ—¥å¿—åŠŸèƒ½

### 7.2 å­¦æœ¯è®ºæ–‡

**æ•°æ®æº¯æºå’Œåˆè§„æŠ€æœ¯**:

- **Senellart, P., et al. (2018). "ProvSQL: Provenance and Probability Management in PostgreSQL."**
  - ä¼šè®®: VLDB 2018 (44th International Conference on Very Large Data Bases)
  - **DOI**: [10.14778/3231751.3231752](https://doi.org/10.14778/3231751.3231752)
  - **arXiv**: [arXiv:1804.06024](https://arxiv.org/abs/1804.06024)
  - **é‡è¦æ€§**: æ•°æ®æº¯æºå’Œåˆè§„æŠ€æœ¯çš„åŸºç¡€ç ”ç©¶ï¼Œä»‹ç»äº†åœ¨ PostgreSQL ä¸­å®ç°æ•°æ®æº¯æºçš„æ–¹æ³•
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº† ProvSQL æ‰©å±•ï¼Œæ”¯æŒæ•°æ®æº¯æºæŸ¥è¯¢å’Œæ¦‚ç‡ç®¡ç†
  - **å¼•ç”¨æ¬¡æ•°**: 100+ (æˆªè‡³ 2025 å¹´)

**æ•°æ®æº¯æºæ ‡å‡†**:

- **Moreau, L., et al. (2013). "The PROV Data Model and Abstract Syntax Notation."**
  - æ ‡å‡†: W3C Recommendation
  - é“¾æ¥: [W3C PROV-DM](https://www.w3.org/TR/prov-dm/)
  - **é‡è¦æ€§**: æ•°æ®æº¯æºæ ‡å‡†ï¼ŒW3C æ¨èæ ‡å‡†ï¼Œä¸ºæ•°æ®åˆè§„æä¾›äº†æ ‡å‡†æ¨¡å‹
  - **æ ¸å¿ƒè´¡çŒ®**: å®šä¹‰äº†æ•°æ®æº¯æºçš„æ•°æ®æ¨¡å‹å’ŒæŠ½è±¡è¯­æ³•ï¼Œæˆä¸ºæ•°æ®æº¯æºé¢†åŸŸçš„æ ‡å‡†

**è¡Œçº§å®‰å…¨ç ”ç©¶**:

- **Rizvi, S., et al. (2004). "Extending query rewriting techniques for fine-grained access control."**
  - ä¼šè®®: SIGMOD 2004
  - **DOI**: [10.1145/1007568.1007621](https://doi.org/10.1145/1007568.1007621)
  - **é‡è¦æ€§**: è¡Œçº§å®‰å…¨ï¼ˆRLSï¼‰æŠ€æœ¯çš„ç»å…¸è®ºæ–‡ï¼Œä¸º PostgreSQL RLS æä¾›äº†ç†è®ºåŸºç¡€
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†åŸºäºæŸ¥è¯¢é‡å†™çš„ç»†ç²’åº¦è®¿é—®æ§åˆ¶æ–¹æ³•

**å®¡è®¡æ—¥å¿—å®Œæ•´æ€§**:

- **Schneier, B., & Kelsey, J. (1998). "Secure audit logs to support computer forensics."**
  - æœŸåˆŠ: ACM Transactions on Information and System Security, 2(2), 159-176
  - **DOI**: [10.1145/317087.317089](https://doi.org/10.1145/317087.317089)
  - **é‡è¦æ€§**: å®¡è®¡æ—¥å¿—å®Œæ•´æ€§ä¿æŠ¤çš„ç»å…¸è®ºæ–‡ï¼Œä¸º Ledger Tables æä¾›äº†ç†è®ºåŸºç¡€
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†ä½¿ç”¨å¯†ç å­¦æ–¹æ³•ä¿æŠ¤å®¡è®¡æ—¥å¿—å®Œæ•´æ€§çš„æ–¹æ¡ˆ

**GDPR åˆè§„ç ”ç©¶**:

- **Voigt, P., & Von dem Bussche, A. (2017).
  "The EU General Data Protection Regulation (GDPR): A Practical Guide."**
  - å‡ºç‰ˆç¤¾: Springer
  - **ISBN**: 978-3-319-57959-7
  - **é‡è¦æ€§**: GDPR åˆè§„çš„å®ç”¨æŒ‡å—ï¼Œä¸ºæ•°æ®åº“åˆè§„æ¶æ„æä¾›äº†æ³•å¾‹ä¾æ®
  - **æ ¸å¿ƒè´¡çŒ®**: è¯¦ç»†è§£è¯»äº† GDPR çš„è¦æ±‚å’Œå®æ–½æ–¹æ³•

### 7.3 å®é™…åº”ç”¨æ¡ˆä¾‹

- **é‡‘èç³»ç»Ÿåˆè§„æ¡ˆä¾‹**
  - åœºæ™¯: é“¶è¡Œæ•°æ®åˆè§„ç³»ç»Ÿ
  - æŠ€æœ¯: pg_dsr + Ledger Tables
  - æ•ˆæœ: åˆè§„é€šè¿‡ç‡ **100%**ï¼ŒæŸ¥è¯¢è€—æ—¶ä¸‹é™ **60%**
  - å‚è€ƒ: [æ”¿åŠ¡åœºæ™¯æ¡ˆä¾‹](../../PostgreSQL_View/08-è½åœ°æ¡ˆä¾‹/æ”¿åŠ¡åœºæ™¯/)

- **æ”¿åŠ¡ç³»ç»Ÿåˆè§„æ¡ˆä¾‹**
  - åœºæ™¯: ç¤¾ä¿å¤§æ•°æ®ç³»ç»Ÿ
  - æŠ€æœ¯: pg_dsr + åŠ¨æ€è„±æ•
  - æ•ˆæœ: åˆè§„æ€§ **100%**ï¼ŒæŸ¥è¯¢è€—æ—¶ä¸‹é™ **60%**
  - å‚è€ƒ: [æ”¿åŠ¡åœºæ™¯æ¡ˆä¾‹](../../PostgreSQL_View/08-è½åœ°æ¡ˆä¾‹/æ”¿åŠ¡åœºæ™¯/)

### 7.4 åˆè§„æ ‡å‡†

- **[ISO/IEC 27001](https://www.iso.org/isoiec-27001-information-security.html)**
  - å†…å®¹: ä¿¡æ¯å®‰å…¨ç®¡ç†ä½“ç³»æ ‡å‡†
  - **é‡è¦æ€§**: å›½é™…ä¿¡æ¯å®‰å…¨ç®¡ç†æ ‡å‡†

- **[SOC 2](https://www.aicpa.org/interestareas/frc/assuranceadvisoryservices/aicpasoc2report.html)**
  - å†…å®¹: æœåŠ¡ç»„ç»‡æ§åˆ¶æ ‡å‡†
  - **é‡è¦æ€§**: äº‘æœåŠ¡å®‰å…¨å®¡è®¡æ ‡å‡†

- **[PCI DSS](https://www.pcisecuritystandards.org/)**
  - å†…å®¹: æ”¯ä»˜å¡è¡Œä¸šæ•°æ®å®‰å…¨æ ‡å‡†
  - **é‡è¦æ€§**: æ”¯ä»˜å¡æ•°æ®å®‰å…¨æ ‡å‡†

### 7.5 ç›¸å…³èµ„æº

- [æ•°æ®ä¸»æƒä¸åˆè§„æœ€ä½³å®è·µ](https://www.postgresql.org/docs/current/compliance.html)
- [PostgreSQL å®‰å…¨åŠŸèƒ½](../../PostgreSQLåŸ¹è®­/07-å®‰å…¨/)
- [æ•°æ®æº¯æºæŠ€æœ¯åŸç†](../../PostgreSQL_View/05-å®‰å…¨ä¸åˆè§„/æ•°æ®æº¯æº/æ•°æ®æº¯æºæŠ€æœ¯åŸç†.md)

---

## 8. å®Œæ•´ä»£ç ç¤ºä¾‹

### 8.1 æ•°æ®åº“åˆè§„æ¶æ„å®Œæ•´é…ç½®ç¤ºä¾‹

**å®Œæ•´åˆè§„é…ç½®**:

```sql
-- 1. å¯ç”¨æ‰€æœ‰åˆè§„æ‰©å±•
CREATE EXTENSION IF NOT EXISTS pg_dsr;
CREATE EXTENSION IF NOT EXISTS pgaudit;

-- 2. é…ç½®åˆè§„ç­–ç•¥
ALTER SYSTEM SET pg_dsr.enable_row_labels = on;
ALTER SYSTEM SET pg_dsr.enable_cross_border_control = on;
ALTER SYSTEM SET pgaudit.log = 'all';
ALTER SYSTEM SET pgaudit.log_catalog = off;
SELECT pg_reload_conf();

-- 3. åˆ›å»ºåˆè§„è¡¨
CREATE TABLE user_data (
    id SERIAL PRIMARY KEY,
    name TEXT,
    email TEXT,
    country TEXT,
    data_sovereignty TEXT DEFAULT 'GLOBAL',
    data_classification TEXT DEFAULT 'PII',
    retention_period INTERVAL DEFAULT '7 years'
);

-- 4. å¯ç”¨è¡Œçº§å®‰å…¨
ALTER TABLE user_data ENABLE ROW LEVEL SECURITY;

-- 5. åˆ›å»ºåˆè§„ç­–ç•¥
CREATE POLICY sovereignty_policy ON user_data
FOR SELECT
USING (
    CASE
        WHEN data_sovereignty = 'EU' THEN
            current_setting('pg_dsr.allowed_regions') LIKE '%EU%'
        WHEN data_sovereignty = 'US' THEN
            current_setting('pg_dsr.allowed_regions') LIKE '%US%'
        ELSE true
    END
);
```

### 8.2 Python åˆè§„ç®¡ç†å®¢æˆ·ç«¯

**åˆè§„ç®¡ç†å®¢æˆ·ç«¯**:

```python
import psycopg2
from typing import Dict, List
from datetime import datetime, timedelta

class ComplianceManager:
    """æ•°æ®åº“åˆè§„ç®¡ç†å™¨"""

    def __init__(self, connection_string: str):
        self.conn = psycopg2.connect(connection_string)
        self.cur = self.conn.cursor()

    def configure_compliance(self, config: Dict):
        """é…ç½®åˆè§„ç­–ç•¥"""
        # è®¾ç½®åŒºåŸŸ
        if 'allowed_regions' in config:
            self.cur.execute(
                "SET pg_dsr.allowed_regions = %s",
                (config['allowed_regions'],)
            )

        # è®¾ç½®ç”¨æˆ·è§’è‰²
        if 'user_role' in config:
            self.cur.execute(
                "SET pg_dsr.user_role = %s",
                (config['user_role'],)
            )

        self.conn.commit()
        print("åˆè§„ç­–ç•¥å·²é…ç½®")

    def auto_label_data(self, table_name: str):
        """è‡ªåŠ¨ä¸ºæ•°æ®æ·»åŠ åˆè§„æ ‡ç­¾"""
        self.cur.execute(f"""
            UPDATE {table_name}
            SET data_sovereignty = CASE
                WHEN country IN ('DE', 'FR', 'IT', 'ES', 'NL') THEN 'EU'
                WHEN country = 'US' THEN 'US'
                WHEN country = 'CN' THEN 'CN'
                ELSE 'GLOBAL'
            END,
            data_classification = CASE
                WHEN email IS NOT NULL THEN 'PII'
                WHEN name IS NOT NULL THEN 'PERSONAL'
                ELSE 'PUBLIC'
            END
            WHERE data_sovereignty IS NULL
        """)

        updated = self.cur.rowcount
        self.conn.commit()
        print(f"å·²ä¸º {updated} æ¡è®°å½•æ·»åŠ åˆè§„æ ‡ç­¾")

    def generate_compliance_report(self, start_date: datetime,
                                  end_date: datetime) -> Dict:
        """ç”Ÿæˆåˆè§„æŠ¥å‘Š"""
        self.cur.execute("""
            SELECT
                data_sovereignty,
                data_classification,
                COUNT(*) as record_count,
                COUNT(*) FILTER (WHERE timestamp BETWEEN %s AND %s) as recent_count
            FROM user_data
            GROUP BY data_sovereignty, data_classification
        """, (start_date, end_date))

        report = {
            'period': {'start': start_date, 'end': end_date},
            'statistics': []
        }

        for row in self.cur.fetchall():
            report['statistics'].append({
                'sovereignty': row[0],
                'classification': row[1],
                'total_records': row[2],
                'recent_records': row[3]
            })

        return report

    def close(self):
        """å…³é—­è¿æ¥"""
        self.cur.close()
        self.conn.close()

# ä½¿ç”¨ç¤ºä¾‹
manager = ComplianceManager(
    "host=localhost dbname=testdb user=postgres password=secret"
)

# é…ç½®åˆè§„ç­–ç•¥
manager.configure_compliance({
    'allowed_regions': 'EU,US',
    'user_role': 'admin'
})

# è‡ªåŠ¨æ·»åŠ åˆè§„æ ‡ç­¾
manager.auto_label_data('user_data')

# ç”Ÿæˆåˆè§„æŠ¥å‘Š
report = manager.generate_compliance_report(
    datetime.now() - timedelta(days=30),
    datetime.now()
)
print(f"åˆè§„æŠ¥å‘Š: {report}")

manager.close()
```

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 05-01-01
