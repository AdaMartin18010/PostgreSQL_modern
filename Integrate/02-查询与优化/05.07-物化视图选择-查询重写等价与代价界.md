---

> **ğŸ“‹ æ–‡æ¡£æ¥æº**: `DataBaseTheory\05-ç´¢å¼•ä¸æŸ¥è¯¢ä¼˜åŒ–\05.07-ç‰©åŒ–è§†å›¾é€‰æ‹©-æŸ¥è¯¢é‡å†™ç­‰ä»·ä¸ä»£ä»·ç•Œ.md`
> **ğŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŸæ–‡ä»¶ä¿æŒä¸å˜

---

# ç‰©åŒ–è§†å›¾é€‰æ‹©-æŸ¥è¯¢é‡å†™ç­‰ä»·ä¸ä»£ä»·ç•Œ

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **æœ€åæ›´æ–°**: 2025-01-16
> **ç‰ˆæœ¬è¦†ç›–**: PostgreSQL 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x (å…¼å®¹)
> **æ–‡æ¡£çŠ¶æ€**: âœ… å†…å®¹å·²å®Œå–„

---

## ğŸ“‹ ç›®å½•

- [ç‰©åŒ–è§†å›¾é€‰æ‹©-æŸ¥è¯¢é‡å†™ç­‰ä»·ä¸ä»£ä»·ç•Œ](#ç‰©åŒ–è§†å›¾é€‰æ‹©-æŸ¥è¯¢é‡å†™ç­‰ä»·ä¸ä»£ä»·ç•Œ)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.0 ç‰©åŒ–è§†å›¾é€‰æ‹©å·¥ä½œåŸç†æ¦‚è¿°](#10-ç‰©åŒ–è§†å›¾é€‰æ‹©å·¥ä½œåŸç†æ¦‚è¿°)
    - [1.1 æœ¬æ–‡æ¡£çš„èŒƒå›´](#11-æœ¬æ–‡æ¡£çš„èŒƒå›´)
  - [2. æ ¸å¿ƒå†…å®¹](#2-æ ¸å¿ƒå†…å®¹)
    - [2.1 æŸ¥è¯¢é‡å†™ç­‰ä»·](#21-æŸ¥è¯¢é‡å†™ç­‰ä»·)
    - [2.2 ä»£ä»·ç•Œ](#22-ä»£ä»·ç•Œ)
    - [2.3 é€‰æ‹©ç®—æ³•](#23-é€‰æ‹©ç®—æ³•)
  - [3. å½¢å¼åŒ–å®šä¹‰](#3-å½¢å¼åŒ–å®šä¹‰)
    - [3.1 æŸ¥è¯¢é‡å†™å½¢å¼åŒ–](#31-æŸ¥è¯¢é‡å†™å½¢å¼åŒ–)
    - [3.2 ä»£ä»·ç•Œå½¢å¼åŒ–](#32-ä»£ä»·ç•Œå½¢å¼åŒ–)
    - [3.3 é€‰æ‹©é—®é¢˜å½¢å¼åŒ–](#33-é€‰æ‹©é—®é¢˜å½¢å¼åŒ–)
  - [4. å®šç†ä¸è¯æ˜](#4-å®šç†ä¸è¯æ˜)
    - [4.1 æŸ¥è¯¢é‡å†™ç­‰ä»·æ€§å®šç†](#41-æŸ¥è¯¢é‡å†™ç­‰ä»·æ€§å®šç†)
    - [4.2 ä»£ä»·ç•Œå®šç†](#42-ä»£ä»·ç•Œå®šç†)
  - [5. å®é™…åº”ç”¨](#5-å®é™…åº”ç”¨)
    - [5.1 PostgreSQLç‰©åŒ–è§†å›¾é€‰æ‹©](#51-postgresqlç‰©åŒ–è§†å›¾é€‰æ‹©)
    - [5.2 ä»£ä»·åˆ†æ](#52-ä»£ä»·åˆ†æ)
    - [5.3 PostgreSQL 18ç‰©åŒ–è§†å›¾é€‰æ‹©å®ç°è¯¦è§£](#53-postgresql-18ç‰©åŒ–è§†å›¾é€‰æ‹©å®ç°è¯¦è§£)
      - [5.3.1 æŸ¥è¯¢æ¨¡å¼åˆ†æ](#531-æŸ¥è¯¢æ¨¡å¼åˆ†æ)
      - [5.3.2 ç‰©åŒ–è§†å›¾å€™é€‰ç”Ÿæˆ](#532-ç‰©åŒ–è§†å›¾å€™é€‰ç”Ÿæˆ)
      - [5.3.3 ä»£ä»·è¯„ä¼°](#533-ä»£ä»·è¯„ä¼°)
      - [5.3.4 ç‰©åŒ–è§†å›¾é€‰æ‹©ç®—æ³•](#534-ç‰©åŒ–è§†å›¾é€‰æ‹©ç®—æ³•)
    - [5.4 ä¸SQLite 3.45å¯¹æ¯”](#54-ä¸sqlite-345å¯¹æ¯”)
      - [5.4.1 ç‰©åŒ–è§†å›¾æ”¯æŒå¯¹æ¯”](#541-ç‰©åŒ–è§†å›¾æ”¯æŒå¯¹æ¯”)
      - [5.4.2 ç‰©åŒ–è§†å›¾å®ç°å¯¹æ¯”](#542-ç‰©åŒ–è§†å›¾å®ç°å¯¹æ¯”)
    - [5.5 å®é™…ä¸šåŠ¡åœºæ™¯æ¡ˆä¾‹](#55-å®é™…ä¸šåŠ¡åœºæ™¯æ¡ˆä¾‹)
      - [5.5.1 æ¡ˆä¾‹1ï¼šç”µå•†æ•°æ®åˆ†æç³»ç»Ÿç‰©åŒ–è§†å›¾é€‰æ‹©](#551-æ¡ˆä¾‹1ç”µå•†æ•°æ®åˆ†æç³»ç»Ÿç‰©åŒ–è§†å›¾é€‰æ‹©)
      - [5.5.2 æ¡ˆä¾‹2ï¼šæ—¥å¿—åˆ†æç³»ç»Ÿç‰©åŒ–è§†å›¾é€‰æ‹©](#552-æ¡ˆä¾‹2æ—¥å¿—åˆ†æç³»ç»Ÿç‰©åŒ–è§†å›¾é€‰æ‹©)
      - [5.5.3 æ¡ˆä¾‹3ï¼šç”¨æˆ·è¡Œä¸ºåˆ†æç³»ç»Ÿç‰©åŒ–è§†å›¾é€‰æ‹©](#553-æ¡ˆä¾‹3ç”¨æˆ·è¡Œä¸ºåˆ†æç³»ç»Ÿç‰©åŒ–è§†å›¾é€‰æ‹©)
    - [5.6 æ€§èƒ½å¯¹æ¯”æ•°æ®](#56-æ€§èƒ½å¯¹æ¯”æ•°æ®)
      - [5.6.1 ç‰©åŒ–è§†å›¾æŸ¥è¯¢æ€§èƒ½](#561-ç‰©åŒ–è§†å›¾æŸ¥è¯¢æ€§èƒ½)
      - [5.6.2 ç‰©åŒ–è§†å›¾å­˜å‚¨ä»£ä»·](#562-ç‰©åŒ–è§†å›¾å­˜å‚¨ä»£ä»·)
    - [5.7 æœ€ä½³å®è·µ](#57-æœ€ä½³å®è·µ)
      - [5.7.1 ç‰©åŒ–è§†å›¾é€‰æ‹©åŸåˆ™](#571-ç‰©åŒ–è§†å›¾é€‰æ‹©åŸåˆ™)
      - [5.7.2 ç‰©åŒ–è§†å›¾ä¼˜åŒ–ç­–ç•¥](#572-ç‰©åŒ–è§†å›¾ä¼˜åŒ–ç­–ç•¥)
  - [6. ç›¸å…³æ–‡æ¡£](#6-ç›¸å…³æ–‡æ¡£)
    - [6.1 ç†è®ºåŸºç¡€æ–‡æ¡£](#61-ç†è®ºåŸºç¡€æ–‡æ¡£)
  - [7. å‚è€ƒæ–‡çŒ®](#7-å‚è€ƒæ–‡çŒ®)
    - [7.1 æ ¸å¿ƒç†è®ºæ–‡çŒ®](#71-æ ¸å¿ƒç†è®ºæ–‡çŒ®)
    - [7.2 æŸ¥è¯¢é‡å†™ç›¸å…³](#72-æŸ¥è¯¢é‡å†™ç›¸å…³)
    - [7.3 PostgreSQLå®ç°ç›¸å…³](#73-postgresqlå®ç°ç›¸å…³)
    - [7.4 ç›¸å…³æ–‡æ¡£](#74-ç›¸å…³æ–‡æ¡£)

---

## 1. æ¦‚è¿°

### 1.0 ç‰©åŒ–è§†å›¾é€‰æ‹©å·¥ä½œåŸç†æ¦‚è¿°

**ç‰©åŒ–è§†å›¾é€‰æ‹©**ï¼š

ç‰©åŒ–è§†å›¾é€‰æ‹©æ˜¯åœ¨å¤šä¸ªå€™é€‰ç‰©åŒ–è§†å›¾ä¸­é€‰æ‹©æœ€ä¼˜é›†åˆï¼Œä»¥æœ€å¤§åŒ–æŸ¥è¯¢æ€§èƒ½æå‡ï¼ŒåŒæ—¶æœ€å°åŒ–å­˜å‚¨å’Œç»´æŠ¤ä»£ä»·ã€‚æœ¬æ–‡æ¡£æä¾›æŸ¥è¯¢é‡å†™ç­‰ä»·æ€§å’Œä»£ä»·ç•Œçš„ç†è®ºã€‚

**ç‰©åŒ–è§†å›¾é€‰æ‹©æ€ç»´å¯¼å›¾**ï¼š

```mermaid
mindmap
  root((ç‰©åŒ–è§†å›¾é€‰æ‹©))
    é€‰æ‹©ç›®æ ‡
      æŸ¥è¯¢æ€§èƒ½
      å­˜å‚¨ç©ºé—´
      ç»´æŠ¤ä»£ä»·
    é€‰æ‹©ç­–ç•¥
      è´ªå¿ƒç®—æ³•
      åŠ¨æ€è§„åˆ’
      å¯å‘å¼æ–¹æ³•
    ç­‰ä»·æ€§
      æŸ¥è¯¢é‡å†™ç­‰ä»·
      ç»“æœä¸€è‡´æ€§
      è¯­ä¹‰æ­£ç¡®æ€§
    ä»£ä»·åˆ†æ
      æŸ¥è¯¢ä»£ä»·ç•Œ
      å­˜å‚¨ä»£ä»·ç•Œ
      ç»´æŠ¤ä»£ä»·ç•Œ
```

**ç‰©åŒ–è§†å›¾é€‰æ‹©å†³ç­–æ ‘**ï¼š

```mermaid
flowchart TD
    A[æŸ¥è¯¢è´Ÿè½½Q] --> B[å€™é€‰ç‰©åŒ–è§†å›¾é›†M]
    B --> C[è¯„ä¼°æ¯ä¸ªMV]
    C --> D{æŸ¥è¯¢å¯é‡å†™?}
    D -->|æ˜¯| E[è®¡ç®—ä»£ä»·èŠ‚çœ]
    D -->|å¦| F[è·³è¿‡MV]
    E --> G[è®¡ç®—å­˜å‚¨ä»£ä»·]
    G --> H[è®¡ç®—ç»´æŠ¤ä»£ä»·]
    H --> I[è¯„ä¼°å‡€æ”¶ç›Š]
    F --> J[é€‰æ‹©MVé›†åˆ]
    I --> J
    J --> K{é¢„ç®—çº¦æŸ?}
    K -->|æ»¡è¶³| L[é‡‡ç”¨MVé›†åˆ]
    K -->|ä¸æ»¡è¶³| M[è°ƒæ•´é€‰æ‹©]
    M --> J

    style A fill:#FFD700
    style E fill:#90EE90
    style L fill:#87CEEB
```

**ç‰©åŒ–è§†å›¾é€‰æ‹©ç­–ç•¥å¯¹æ¯”çŸ©é˜µ**ï¼š

| ç­–ç•¥ | å¤æ‚åº¦ | æœ€ä¼˜æ€§ | é€‚ç”¨åœºæ™¯ |
|------|--------|--------|---------|
| **è´ªå¿ƒç®—æ³•** | O(nÂ²) | è¿‘ä¼¼æœ€ä¼˜ | å¤§è§„æ¨¡é—®é¢˜ |
| **åŠ¨æ€è§„åˆ’** | O(2^n) | æœ€ä¼˜ | å°è§„æ¨¡é—®é¢˜ |
| **å¯å‘å¼æ–¹æ³•** | O(n log n) | è¿‘ä¼¼æœ€ä¼˜ | å®æ—¶é€‰æ‹© |

### 1.1 æœ¬æ–‡æ¡£çš„èŒƒå›´

æœ¬æ–‡æ¡£æ¶µç›–ï¼š

- **æŸ¥è¯¢é‡å†™ç­‰ä»·**ï¼šç‰©åŒ–è§†å›¾æŸ¥è¯¢é‡å†™çš„ç­‰ä»·æ€§åˆ¤å®š
- **ä»£ä»·ç•Œ**ï¼šæŸ¥è¯¢ä»£ä»·ã€å­˜å‚¨ä»£ä»·ã€ç»´æŠ¤ä»£ä»·çš„ä¸Šç•Œ
- **é€‰æ‹©ç®—æ³•**ï¼šç‰©åŒ–è§†å›¾é€‰æ‹©çš„ç®—æ³•å’Œä¼˜åŒ–
- **å®é™…åº”ç”¨**ï¼šPostgreSQLç‰©åŒ–è§†å›¾çš„é€‰æ‹©å’Œä¼˜åŒ–

---

## 2. æ ¸å¿ƒå†…å®¹

### 2.1 æŸ¥è¯¢é‡å†™ç­‰ä»·

**æŸ¥è¯¢é‡å†™å®šä¹‰**ï¼š

```haskell
-- æŸ¥è¯¢é‡å†™
rewrite :: Query -> MaterializedView -> Maybe Query
rewrite Q MV =
    if canRewrite Q MV then
        Just (rewriteQuery Q MV)
    else
        Nothing

-- é‡å†™ç­‰ä»·æ€§
rewriteEquivalent :: Query -> MaterializedView -> Bool
rewriteEquivalent Q MV =
    forall DB: âŸ¦QâŸ§(DB) = âŸ¦rewrite Q MVâŸ§(DB)
```

**æŸ¥è¯¢é‡å†™æµç¨‹**ï¼š

```mermaid
graph TD
    A[æŸ¥è¯¢Q] --> B[ç‰©åŒ–è§†å›¾MV]
    B --> C{æŸ¥è¯¢åŒ…å«MV?}
    C -->|æ˜¯| D[æ„å»ºé‡å†™æŸ¥è¯¢]
    C -->|å¦| E[æ— æ³•é‡å†™]
    D --> F[éªŒè¯ç­‰ä»·æ€§]
    F --> G{ç­‰ä»·?}
    G -->|æ˜¯| H[ä½¿ç”¨é‡å†™æŸ¥è¯¢]
    G -->|å¦| E

    style A fill:#FFD700
    style H fill:#90EE90
    style E fill:#FF6B6B
```

### 2.2 ä»£ä»·ç•Œ

**ä»£ä»·å‡½æ•°**ï¼š

```haskell
-- æŸ¥è¯¢ä»£ä»·
queryCost :: Query -> MaterializedView -> Cost
queryCost Q MV =
    if canUse MV then
        cost(rewrite Q MV)  -- ä½¿ç”¨MVçš„ä»£ä»·
    else
        cost(Q)  -- åŸå§‹æŸ¥è¯¢ä»£ä»·

-- ä»£ä»·èŠ‚çœ
costSaving :: Query -> MaterializedView -> Cost
costSaving Q MV =
    cost(Q) - queryCost(Q, MV)
```

**ä»£ä»·ç•Œåˆ†æ**ï¼š

```haskell
-- æŸ¥è¯¢ä»£ä»·ä¸Šç•Œ
queryCostBound :: Query -> MaterializedView -> Cost
queryCostBound Q MV =
    -- ä½¿ç”¨MVçš„ä»£ä»·ä¸Šç•Œ
    scanCost(MV) + filterCost(Q.condition) + projectCost(Q.attributes)

-- å­˜å‚¨ä»£ä»·ä¸Šç•Œ
storageCostBound :: MaterializedView -> Cost
storageCostBound MV =
    size(MV) * storageUnitCost

-- ç»´æŠ¤ä»£ä»·ä¸Šç•Œ
maintenanceCostBound :: MaterializedView -> UpdateRate -> Cost
maintenanceCostBound MV rate =
    rate * incrementalMaintenanceCost(MV)
```

### 2.3 é€‰æ‹©ç®—æ³•

**è´ªå¿ƒé€‰æ‹©ç®—æ³•**ï¼š

```haskell
-- è´ªå¿ƒç‰©åŒ–è§†å›¾é€‰æ‹©
greedyMVSelection :: [Query] -> [MaterializedView] -> Budget -> [MaterializedView]
greedyMVSelection queries candidates budget =
    let sorted = sortBy benefitPerCost candidates
        selected = []
        remaining = budget
    in foldl select [] sorted
    where
        select acc mv =
            if cost(mv) â‰¤ remaining && benefit(mv) > 0 then
                acc ++ [mv]
            else
                acc
```

---

## 3. å½¢å¼åŒ–å®šä¹‰

### 3.1 æŸ¥è¯¢é‡å†™å½¢å¼åŒ–

**é‡å†™è¯­ä¹‰**ï¼š

```haskell
-- æŸ¥è¯¢é‡å†™
Q' = rewrite(Q, MV) iff
    Q' uses MV and
    forall DB: âŸ¦QâŸ§(DB) = âŸ¦Q'âŸ§(DB)
```

### 3.2 ä»£ä»·ç•Œå½¢å¼åŒ–

**ä»£ä»·ä¸Šç•Œ**ï¼š

```haskell
-- æŸ¥è¯¢ä»£ä»·ä¸Šç•Œ
cost(Q, MV) â‰¤ cost_bound(Q, MV)

å…¶ä¸­:
  cost_bound(Q, MV) =
    scan_cost(MV) +
    filter_cost(Q.condition) +
    project_cost(Q.attributes)
```

### 3.3 é€‰æ‹©é—®é¢˜å½¢å¼åŒ–

**ç‰©åŒ–è§†å›¾é€‰æ‹©é—®é¢˜**ï¼š

```haskell
-- æœ€å¤§åŒ–æ”¶ç›Š
maximize Î£ benefit(Q, MV) for Q in queries, MV in selected
subject to:
    Î£ cost(MV) â‰¤ budget
    forall Q: exists MV such that canRewrite(Q, MV)
```

---

## 4. å®šç†ä¸è¯æ˜

### 4.1 æŸ¥è¯¢é‡å†™ç­‰ä»·æ€§å®šç†

**å®šç†**ï¼šå¦‚æœæŸ¥è¯¢Qå¯ä»¥ä½¿ç”¨ç‰©åŒ–è§†å›¾MVé‡å†™ï¼Œåˆ™é‡å†™åçš„æŸ¥è¯¢ä¸åŸå§‹æŸ¥è¯¢ç­‰ä»·ã€‚

**å½¢å¼åŒ–è¡¨è¿°**ï¼š

è®¾æŸ¥è¯¢Qï¼Œç‰©åŒ–è§†å›¾MV = Q_MV(R)ï¼Œå…¶ä¸­Q_MVæ˜¯å®šä¹‰MVçš„æŸ¥è¯¢ã€‚å¦‚æœæŸ¥è¯¢Qå¯ä»¥ä½¿ç”¨MVé‡å†™ä¸ºQ'ï¼Œåˆ™å¯¹äºä»»æ„æ•°æ®åº“Rï¼ŒâŸ¦QâŸ§(R) = âŸ¦Q'âŸ§(R)ã€‚

**è¯æ˜**ï¼ˆæ„é€ æ€§è¯æ˜ï¼‰ï¼š

**æ­¥éª¤1ï¼šç‰©åŒ–è§†å›¾å®šä¹‰**:

- è®¾ç‰©åŒ–è§†å›¾MV = Q_MV(R)ï¼Œå…¶ä¸­Q_MVæ˜¯å®šä¹‰MVçš„æŸ¥è¯¢
- MVå­˜å‚¨äº†Q_MV(R)çš„ç»“æœï¼Œå³MV = âŸ¦Q_MVâŸ§(R)

**æ­¥éª¤2ï¼šæŸ¥è¯¢é‡å†™æ¡ä»¶**:

- æŸ¥è¯¢Qå¯ä»¥ä½¿ç”¨MVé‡å†™ï¼Œå½“ä¸”ä»…å½“QåŒ…å«Q_MV
- å³ï¼šQå¯ä»¥è¡¨ç¤ºä¸ºQ = Q_filter(Q_MV)ï¼Œå…¶ä¸­Q_filteræ˜¯è¿‡æ»¤å’ŒæŠ•å½±æ“ä½œ

**æ­¥éª¤3ï¼šé‡å†™æŸ¥è¯¢æ„é€ **:

- é‡å†™æŸ¥è¯¢Q' = Q_filter(MV)
- å³ï¼šQ'å¯¹ç‰©åŒ–è§†å›¾MVåº”ç”¨ä¸Qç›¸åŒçš„è¿‡æ»¤å’ŒæŠ•å½±æ“ä½œ

**æ­¥éª¤4ï¼šè¯­ä¹‰ç­‰ä»·æ€§**:

- åŸå§‹æŸ¥è¯¢Q(R) = Q_filter(Q_MV(R)) = Q_filter(âŸ¦Q_MVâŸ§(R))
- é‡å†™æŸ¥è¯¢Q'(R) = Q_filter(MV) = Q_filter(âŸ¦Q_MVâŸ§(R))
- ç”±äºMV = âŸ¦Q_MVâŸ§(R)ï¼Œå› æ­¤Q(R) = Q'(R)

**æ­¥éª¤5ï¼šæŸ¥è¯¢é‡å†™æ­£ç¡®æ€§**:

- æŸ¥è¯¢é‡å†™ä¿æŒæŸ¥è¯¢è¯­ä¹‰ï¼ˆç”±æ­¥éª¤4ä¿è¯ï¼‰
- é‡å†™æŸ¥è¯¢ä½¿ç”¨ç‰©åŒ–è§†å›¾MVï¼Œç­‰ä»·äºä½¿ç”¨Q_MVçš„ç»“æœ
- å› æ­¤ï¼Œé‡å†™åçš„æŸ¥è¯¢ä¸åŸå§‹æŸ¥è¯¢ç­‰ä»·

**æ­¥éª¤6ï¼šç»“è®º**:

- å¦‚æœæŸ¥è¯¢Qå¯ä»¥ä½¿ç”¨ç‰©åŒ–è§†å›¾MVé‡å†™ï¼Œåˆ™é‡å†™åçš„æŸ¥è¯¢Q'ä¸åŸå§‹æŸ¥è¯¢Qç­‰ä»·
- æŸ¥è¯¢é‡å†™çš„æ­£ç¡®æ€§ç”±ç‰©åŒ–è§†å›¾çš„å®šä¹‰å’ŒæŸ¥è¯¢è¯­ä¹‰ä¿è¯
- è¯æ¯•

### 4.2 ä»£ä»·ç•Œå®šç†

**å®šç†**ï¼šå¯¹äºæŸ¥è¯¢Qå’Œç‰©åŒ–è§†å›¾MVï¼Œå¦‚æœQå¯ä»¥ä½¿ç”¨MVé‡å†™ä¸ºQ'ï¼Œåˆ™æŸ¥è¯¢ä»£ä»·cost(Q', MV)çš„ä¸Šç•Œæ˜¯cost_bound(Q', MV) = scan_cost(MV) + filter_cost(Q.condition) + project_cost(Q.attributes)ã€‚

**å½¢å¼åŒ–è¡¨è¿°**ï¼š

è®¾æŸ¥è¯¢Qï¼Œç‰©åŒ–è§†å›¾MVï¼Œé‡å†™æŸ¥è¯¢Q' = rewrite(Q, MV)ã€‚åˆ™cost(Q', MV) â‰¤ cost_bound(Q', MV)ï¼Œå…¶ä¸­cost_bound(Q', MV) = scan_cost(MV) + filter_cost(Q.condition) + project_cost(Q.attributes)ã€‚

**è¯æ˜**ï¼ˆæ„é€ æ€§è¯æ˜ï¼‰ï¼š

**æ­¥éª¤1ï¼šæŸ¥è¯¢æ‰§è¡Œæ­¥éª¤**:

- ä½¿ç”¨ç‰©åŒ–è§†å›¾MVæ‰§è¡ŒæŸ¥è¯¢Q'çš„æ­¥éª¤ï¼š
  1. æ‰«æç‰©åŒ–è§†å›¾MVï¼šscan_cost(MV)
  2. åº”ç”¨æŸ¥è¯¢æ¡ä»¶è¿‡æ»¤ï¼šfilter_cost(Q.condition)
  3. åº”ç”¨æŸ¥è¯¢æŠ•å½±ï¼šproject_cost(Q.attributes)

**æ­¥éª¤2ï¼šä»£ä»·åˆ†è§£**:

- æŸ¥è¯¢ä»£ä»·cost(Q', MV) = scan_cost(MV) + filter_cost(Q.condition) + project_cost(Q.attributes) + å…¶ä»–ä»£ä»·
- å…¶ä»–ä»£ä»·åŒ…æ‹¬ï¼šæ’åºã€åˆ†ç»„ã€è¿æ¥ç­‰ï¼ˆå¦‚æœæŸ¥è¯¢åŒ…å«è¿™äº›æ“ä½œï¼‰

**æ­¥éª¤3ï¼šä»£ä»·ä¸Šç•Œ**:

- ç”±äºå…¶ä»–ä»£ä»· â‰¥ 0ï¼Œå› æ­¤ï¼š
  - cost(Q', MV) â‰¤ scan_cost(MV) + filter_cost(Q.condition) + project_cost(Q.attributes) + å…¶ä»–ä»£ä»·
  - cost(Q', MV) â‰¤ scan_cost(MV) + filter_cost(Q.condition) + project_cost(Q.attributes)

**æ­¥éª¤4ï¼šä»£ä»·ç•Œå®šä¹‰**:

- å®šä¹‰ä»£ä»·ä¸Šç•Œï¼šcost_bound(Q', MV) = scan_cost(MV) + filter_cost(Q.condition) + project_cost(Q.attributes)
- å› æ­¤ï¼Œcost(Q', MV) â‰¤ cost_bound(Q', MV)

**æ­¥éª¤5ï¼šä»£ä»·ç•Œç´§æ€§**:

- ä»£ä»·ç•Œæ˜¯ç´§çš„ï¼Œå½“ä¸”ä»…å½“æŸ¥è¯¢Q'åªåŒ…å«æ‰«æã€è¿‡æ»¤å’ŒæŠ•å½±æ“ä½œ
- å¦‚æœæŸ¥è¯¢åŒ…å«å…¶ä»–æ“ä½œï¼ˆå¦‚æ’åºã€åˆ†ç»„ï¼‰ï¼Œä»£ä»·ç•Œå¯èƒ½ä¸æ˜¯ç´§çš„

**æ­¥éª¤6ï¼šç»“è®º**:

- ä½¿ç”¨ç‰©åŒ–è§†å›¾çš„æŸ¥è¯¢ä»£ä»·ä¸Šç•Œæ˜¯ç‰©åŒ–è§†å›¾æ‰«æä»£ä»·åŠ ä¸Šè¿‡æ»¤å’ŒæŠ•å½±ä»£ä»·
- ä»£ä»·ç•Œæä¾›äº†æŸ¥è¯¢ä»£ä»·çš„ä¸Šé™ä¼°è®¡
- è¯æ¯•

---

## 5. å®é™…åº”ç”¨

### 5.1 PostgreSQLç‰©åŒ–è§†å›¾é€‰æ‹©

**åˆ›å»ºç‰©åŒ–è§†å›¾**ï¼š

```sql
-- åˆ†ææŸ¥è¯¢æ¨¡å¼
SELECT
    query,
    calls,
    total_exec_time
FROM pg_stat_statements
ORDER BY total_exec_time DESC
LIMIT 10;

-- åŸºäºé«˜é¢‘æŸ¥è¯¢åˆ›å»ºç‰©åŒ–è§†å›¾
CREATE MATERIALIZED VIEW mv_customer_orders AS
SELECT
    c.customer_id,
    c.customer_name,
    COUNT(o.order_id) as order_count,
    SUM(o.total) as total_amount
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id, c.customer_name;

-- æŸ¥è¯¢è‡ªåŠ¨é‡å†™ä½¿ç”¨ç‰©åŒ–è§†å›¾
SELECT
    customer_id,
    order_count,
    total_amount
FROM mv_customer_orders
WHERE customer_id = 123;
```

### 5.2 ä»£ä»·åˆ†æ

**ç‰©åŒ–è§†å›¾ä»£ä»·è¯„ä¼°**ï¼š

```sql
-- è¯„ä¼°ç‰©åŒ–è§†å›¾å¤§å°
SELECT
    pg_size_pretty(pg_total_relation_size('mv_customer_orders')) as size;

-- è¯„ä¼°æŸ¥è¯¢æ€§èƒ½æå‡
EXPLAIN (ANALYZE, BUFFERS)
-- åŸå§‹æŸ¥è¯¢
SELECT
    c.customer_id,
    COUNT(o.order_id) as order_count,
    SUM(o.total) as total_amount
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id;

-- ä½¿ç”¨ç‰©åŒ–è§†å›¾
SELECT * FROM mv_customer_orders;

-- å¯¹æ¯”æ‰§è¡Œæ—¶é—´å’ŒI/O
```

### 5.3 PostgreSQL 18ç‰©åŒ–è§†å›¾é€‰æ‹©å®ç°è¯¦è§£

#### 5.3.1 æŸ¥è¯¢æ¨¡å¼åˆ†æ

**PostgreSQL 18æŸ¥è¯¢ç»Ÿè®¡**ï¼š

```sql
-- å¯ç”¨æŸ¥è¯¢ç»Ÿè®¡
CREATE EXTENSION IF NOT EXISTS pg_stat_statements;

-- åˆ†ææŸ¥è¯¢æ¨¡å¼
SELECT
    query,
    calls,
    total_exec_time,
    mean_exec_time,
    (total_exec_time / SUM(total_exec_time) OVER ()) * 100 AS pct_time
FROM pg_stat_statements
WHERE query NOT LIKE '%pg_stat_statements%'
ORDER BY total_exec_time DESC
LIMIT 20;

-- è¯†åˆ«é«˜é¢‘æŸ¥è¯¢
SELECT
    LEFT(query, 100) AS query_preview,
    calls,
    total_exec_time,
    mean_exec_time
FROM pg_stat_statements
WHERE calls > 100
ORDER BY calls DESC
LIMIT 10;
```

#### 5.3.2 ç‰©åŒ–è§†å›¾å€™é€‰ç”Ÿæˆ

**ç”Ÿæˆå€™é€‰ç‰©åŒ–è§†å›¾**ï¼š

```sql
-- åŸºäºé«˜é¢‘æŸ¥è¯¢åˆ›å»ºå€™é€‰ç‰©åŒ–è§†å›¾
-- å€™é€‰1ï¼šå®¢æˆ·è®¢å•æ±‡æ€»
CREATE MATERIALIZED VIEW mv_customer_order_summary AS
SELECT
    c.customer_id,
    c.customer_name,
    COUNT(o.order_id) as order_count,
    SUM(o.total_amount) as total_amount,
    AVG(o.total_amount) as avg_order_amount,
    MAX(o.order_date) as last_order_date
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id, c.customer_name;

-- å€™é€‰2ï¼šäº§å“é”€å”®æ±‡æ€»
CREATE MATERIALIZED VIEW mv_product_sales_summary AS
SELECT
    p.product_id,
    p.product_name,
    COUNT(oi.order_id) as sale_count,
    SUM(oi.quantity) as total_quantity,
    SUM(oi.amount) as total_revenue
FROM products p
JOIN order_items oi ON p.product_id = oi.product_id
GROUP BY p.product_id, p.product_name;

-- å€™é€‰3ï¼šè®¢å•æ—¥æœŸæ±‡æ€»
CREATE MATERIALIZED VIEW mv_order_date_summary AS
SELECT
    DATE(order_date) as order_day,
    COUNT(*) as order_count,
    SUM(total_amount) as total_revenue,
    COUNT(DISTINCT customer_id) as customer_count
FROM orders
GROUP BY DATE(order_date);
```

#### 5.3.3 ä»£ä»·è¯„ä¼°

**è¯„ä¼°ç‰©åŒ–è§†å›¾ä»£ä»·**ï¼š

```sql
-- è¯„ä¼°å­˜å‚¨ä»£ä»·
SELECT
    schemaname,
    matviewname,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||matviewname)) AS size,
    pg_total_relation_size(schemaname||'.'||matviewname) AS size_bytes
FROM pg_matviews
WHERE matviewname LIKE 'mv_%';

-- è¯„ä¼°æŸ¥è¯¢æ€§èƒ½æå‡
EXPLAIN (ANALYZE, BUFFERS)
-- åŸå§‹æŸ¥è¯¢
SELECT
    c.customer_id,
    COUNT(o.order_id) as order_count,
    SUM(o.total_amount) as total_amount
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id;

-- ä½¿ç”¨ç‰©åŒ–è§†å›¾
SELECT
    customer_id,
    order_count,
    total_amount
FROM mv_customer_order_summary;

-- å¯¹æ¯”æ‰§è¡Œæ—¶é—´å’ŒI/O
```

#### 5.3.4 ç‰©åŒ–è§†å›¾é€‰æ‹©ç®—æ³•

**è´ªå¿ƒé€‰æ‹©ç®—æ³•å®ç°**ï¼š

```sql
-- ç‰©åŒ–è§†å›¾é€‰æ‹©å‡½æ•°ï¼ˆä¼ªä»£ç ï¼‰
CREATE OR REPLACE FUNCTION select_materialized_views(
    budget_bytes BIGINT
)
RETURNS TABLE (
    matviewname TEXT,
    benefit_per_cost NUMERIC
) AS $$
DECLARE
    mv RECORD;
    total_cost BIGINT := 0;
    benefit NUMERIC;
    cost_bytes BIGINT;
BEGIN
    -- è®¡ç®—æ¯ä¸ªç‰©åŒ–è§†å›¾çš„æ”¶ç›Š/ä»£ä»·æ¯”
    FOR mv IN
        SELECT
            matviewname,
            pg_total_relation_size(schemaname||'.'||matviewname) AS size_bytes,
            -- è®¡ç®—æ”¶ç›Šï¼ˆæŸ¥è¯¢é¢‘ç‡ * æ€§èƒ½æå‡ï¼‰
            (SELECT SUM(calls * mean_exec_time)
             FROM pg_stat_statements
             WHERE query LIKE '%' || matviewname || '%') AS benefit
        FROM pg_matviews
        WHERE matviewname LIKE 'mv_%'
        ORDER BY benefit / pg_total_relation_size(schemaname||'.'||matviewname) DESC
    LOOP
        IF total_cost + mv.size_bytes <= budget_bytes THEN
            total_cost := total_cost + mv.size_bytes;
            RETURN QUERY SELECT mv.matviewname,
                mv.benefit / mv.size_bytes::NUMERIC;
        END IF;
    END LOOP;
END;
$$ LANGUAGE plpgsql;
```

### 5.4 ä¸SQLite 3.45å¯¹æ¯”

#### 5.4.1 ç‰©åŒ–è§†å›¾æ”¯æŒå¯¹æ¯”

| ç‰¹æ€§ | PostgreSQL 18 | SQLite 3.45 |
| --- | --- | --- |
| **ç‰©åŒ–è§†å›¾** | âœ… åŸç”Ÿæ”¯æŒ | âŒ ä¸æ”¯æŒ |
| **æŸ¥è¯¢é‡å†™** | âœ… è‡ªåŠ¨é‡å†™ | âŒ ä¸æ”¯æŒ |
| **ä»£ä»·åˆ†æ** | âœ… æŸ¥è¯¢ç»Ÿè®¡ | âš ï¸ æ‰‹åŠ¨åˆ†æ |
| **è‡ªåŠ¨é€‰æ‹©** | âš ï¸ æ‰‹åŠ¨é€‰æ‹© | âŒ ä¸æ”¯æŒ |

#### 5.4.2 ç‰©åŒ–è§†å›¾å®ç°å¯¹æ¯”

**PostgreSQL 18**ï¼š

- æ”¯æŒç‰©åŒ–è§†å›¾åˆ›å»ºå’Œç®¡ç†
- æ”¯æŒæŸ¥è¯¢è‡ªåŠ¨é‡å†™ï¼ˆéƒ¨åˆ†ï¼‰
- æ”¯æŒæŸ¥è¯¢ç»Ÿè®¡å’Œä»£ä»·åˆ†æ

**SQLite 3.45**ï¼š

- ä¸æ”¯æŒç‰©åŒ–è§†å›¾
- éœ€è¦æ‰‹åŠ¨å®ç°è§†å›¾ç¼“å­˜
- ä½¿ç”¨ä¸´æ—¶è¡¨æˆ–åº”ç”¨ç¨‹åºé€»è¾‘

**å¯¹æ¯”ç¤ºä¾‹**ï¼š

```sql
-- PostgreSQL: ç‰©åŒ–è§†å›¾
CREATE MATERIALIZED VIEW mv_customer_orders AS
SELECT customer_id, COUNT(*) as order_count
FROM orders
GROUP BY customer_id;

-- SQLite: æ‰‹åŠ¨å®ç°ï¼ˆä½¿ç”¨ä¸´æ—¶è¡¨ï¼‰
CREATE TABLE temp_customer_orders AS
SELECT customer_id, COUNT(*) as order_count
FROM orders
GROUP BY customer_id;
```

### 5.5 å®é™…ä¸šåŠ¡åœºæ™¯æ¡ˆä¾‹

#### 5.5.1 æ¡ˆä¾‹1ï¼šç”µå•†æ•°æ®åˆ†æç³»ç»Ÿç‰©åŒ–è§†å›¾é€‰æ‹©

**ä¸šåŠ¡åœºæ™¯**ï¼š

æŸç”µå•†å¹³å°æ•°æ®åˆ†æç³»ç»Ÿéœ€è¦æ”¯æŒï¼š

- å¤šä¸ªé«˜é¢‘åˆ†ææŸ¥è¯¢
- æŸ¥è¯¢æ€§èƒ½è¦æ±‚é«˜ï¼ˆ<100msï¼‰
- å­˜å‚¨é¢„ç®—æœ‰é™ï¼ˆ100GBï¼‰
- æ”¯æŒå®æ—¶æ•°æ®æ›´æ–°

**æŸ¥è¯¢è´Ÿè½½åˆ†æ**ï¼š

```sql
-- åˆ†ææŸ¥è¯¢è´Ÿè½½
SELECT
    LEFT(query, 200) AS query_preview,
    calls,
    total_exec_time,
    mean_exec_time
FROM pg_stat_statements
WHERE query LIKE '%customers%' OR query LIKE '%orders%'
ORDER BY total_exec_time DESC
LIMIT 10;
```

**å€™é€‰ç‰©åŒ–è§†å›¾**ï¼š

```sql
-- å€™é€‰1ï¼šå®¢æˆ·è®¢å•æ±‡æ€»ï¼ˆé«˜é¢‘æŸ¥è¯¢ï¼‰
CREATE MATERIALIZED VIEW mv_customer_orders AS
SELECT
    customer_id,
    COUNT(*) as order_count,
    SUM(total_amount) as total_spent,
    AVG(total_amount) as avg_order_amount
FROM orders
GROUP BY customer_id;
-- å­˜å‚¨ä»£ä»·ï¼š5GB
-- æŸ¥è¯¢æ€§èƒ½æå‡ï¼š50x

-- å€™é€‰2ï¼šäº§å“é”€å”®æ±‡æ€»ï¼ˆä¸­é¢‘æŸ¥è¯¢ï¼‰
CREATE MATERIALIZED VIEW mv_product_sales AS
SELECT
    product_id,
    COUNT(*) as sale_count,
    SUM(quantity) as total_quantity,
    SUM(amount) as total_revenue
FROM order_items
GROUP BY product_id;
-- å­˜å‚¨ä»£ä»·ï¼š3GB
-- æŸ¥è¯¢æ€§èƒ½æå‡ï¼š30x

-- å€™é€‰3ï¼šè®¢å•æ—¥æœŸæ±‡æ€»ï¼ˆä½é¢‘æŸ¥è¯¢ï¼‰
CREATE MATERIALIZED VIEW mv_order_daily AS
SELECT
    DATE(order_date) as order_day,
    COUNT(*) as order_count,
    SUM(total_amount) as total_revenue
FROM orders
GROUP BY DATE(order_date);
-- å­˜å‚¨ä»£ä»·ï¼š500MB
-- æŸ¥è¯¢æ€§èƒ½æå‡ï¼š20x
```

**ç‰©åŒ–è§†å›¾é€‰æ‹©**ï¼š

```sql
-- ä½¿ç”¨è´ªå¿ƒç®—æ³•é€‰æ‹©ï¼ˆé¢„ç®—ï¼š100GBï¼‰
-- 1. é€‰æ‹©mv_customer_ordersï¼ˆæ”¶ç›Š/ä»£ä»·æ¯”æœ€é«˜ï¼‰
-- 2. é€‰æ‹©mv_product_salesï¼ˆæ”¶ç›Š/ä»£ä»·æ¯”æ¬¡é«˜ï¼‰
-- 3. é€‰æ‹©mv_order_dailyï¼ˆæ”¶ç›Š/ä»£ä»·æ¯”ç¬¬ä¸‰ï¼‰
-- æ€»å­˜å‚¨ï¼š8.5GB < 100GBï¼Œæ»¡è¶³é¢„ç®—

-- åˆ›å»ºå”¯ä¸€ç´¢å¼•æ”¯æŒå¢é‡åˆ·æ–°
CREATE UNIQUE INDEX idx_mv_customer_orders_customer_id
ON mv_customer_orders(customer_id);

CREATE UNIQUE INDEX idx_mv_product_sales_product_id
ON mv_product_sales(product_id);
```

**æ•ˆæœ**ï¼š

- æŸ¥è¯¢æ€§èƒ½æå‡ï¼šä»å¹³å‡500msé™è‡³10msï¼ˆ50xï¼‰
- å­˜å‚¨ä½¿ç”¨ï¼š8.5GBï¼ˆè¿œä½äº100GBé¢„ç®—ï¼‰
- æ”¯æŒå¢é‡åˆ·æ–°ï¼šç»´æŠ¤æˆæœ¬ä½

#### 5.5.2 æ¡ˆä¾‹2ï¼šæ—¥å¿—åˆ†æç³»ç»Ÿç‰©åŒ–è§†å›¾é€‰æ‹©

**ä¸šåŠ¡åœºæ™¯**ï¼š

æŸæ—¥å¿—åˆ†æç³»ç»Ÿéœ€è¦æ”¯æŒï¼š

- å¤§é‡æ—¥å¿—æ•°æ®æŸ¥è¯¢ï¼ˆ1äº¿+æ¡ï¼‰
- æŒ‰åº”ç”¨ã€çº§åˆ«ã€æ—¶é—´ç»´åº¦èšåˆ
- æŸ¥è¯¢æ€§èƒ½è¦æ±‚é«˜ï¼ˆ<200msï¼‰
- å­˜å‚¨é¢„ç®—æœ‰é™ï¼ˆ50GBï¼‰

**å€™é€‰ç‰©åŒ–è§†å›¾**ï¼š

```sql
-- å€™é€‰1ï¼šåº”ç”¨æ—¥å¿—æ±‡æ€»ï¼ˆæœ€é«˜é¢‘ï¼‰
CREATE MATERIALIZED VIEW mv_app_log_summary AS
SELECT
    app_id,
    log_level,
    DATE(created_at) as log_date,
    COUNT(*) as log_count
FROM logs
GROUP BY app_id, log_level, DATE(created_at);
-- å­˜å‚¨ä»£ä»·ï¼š10GB
-- æŸ¥è¯¢æ€§èƒ½æå‡ï¼š100x

-- å€™é€‰2ï¼šé”™è¯¯æ—¥å¿—æ±‡æ€»ï¼ˆä¸­é¢‘ï¼‰
CREATE MATERIALIZED VIEW mv_error_logs AS
SELECT
    app_id,
    DATE(created_at) as error_date,
    COUNT(*) as error_count
FROM logs
WHERE log_level = 'ERROR'
GROUP BY app_id, DATE(created_at);
-- å­˜å‚¨ä»£ä»·ï¼š2GB
-- æŸ¥è¯¢æ€§èƒ½æå‡ï¼š80x
```

**ç‰©åŒ–è§†å›¾é€‰æ‹©**ï¼š

```sql
-- ä½¿ç”¨è´ªå¿ƒç®—æ³•é€‰æ‹©ï¼ˆé¢„ç®—ï¼š50GBï¼‰
-- 1. é€‰æ‹©mv_app_log_summaryï¼ˆæ”¶ç›Š/ä»£ä»·æ¯”æœ€é«˜ï¼‰
-- 2. é€‰æ‹©mv_error_logsï¼ˆæ”¶ç›Š/ä»£ä»·æ¯”æ¬¡é«˜ï¼‰
-- æ€»å­˜å‚¨ï¼š12GB < 50GBï¼Œæ»¡è¶³é¢„ç®—
```

**æ•ˆæœ**ï¼š

- æŸ¥è¯¢æ€§èƒ½æå‡ï¼šä»å¹³å‡2000msé™è‡³20msï¼ˆ100xï¼‰
- å­˜å‚¨ä½¿ç”¨ï¼š12GBï¼ˆè¿œä½äº50GBé¢„ç®—ï¼‰
- æ”¯æŒå¿«é€Ÿæ—¥å¿—åˆ†æ

#### 5.5.3 æ¡ˆä¾‹3ï¼šç”¨æˆ·è¡Œä¸ºåˆ†æç³»ç»Ÿç‰©åŒ–è§†å›¾é€‰æ‹©

**ä¸šåŠ¡åœºæ™¯**ï¼š

æŸç”¨æˆ·è¡Œä¸ºåˆ†æç³»ç»Ÿéœ€è¦æ”¯æŒï¼š

- å¤§é‡ç”¨æˆ·è¡Œä¸ºæ•°æ®æŸ¥è¯¢ï¼ˆ5000ä¸‡+æ¡ï¼‰
- æŒ‰ç”¨æˆ·ã€äº‹ä»¶ç±»å‹ã€æ—¶é—´ç»´åº¦èšåˆ
- æŸ¥è¯¢æ€§èƒ½è¦æ±‚é«˜ï¼ˆ<100msï¼‰
- å­˜å‚¨é¢„ç®—æœ‰é™ï¼ˆ20GBï¼‰

**å€™é€‰ç‰©åŒ–è§†å›¾**ï¼š

```sql
-- å€™é€‰1ï¼šç”¨æˆ·äº‹ä»¶æ±‡æ€»ï¼ˆæœ€é«˜é¢‘ï¼‰
CREATE MATERIALIZED VIEW mv_user_events_summary AS
SELECT
    user_id,
    event_type,
    DATE(created_at) as event_date,
    COUNT(*) as event_count
FROM user_events
GROUP BY user_id, event_type, DATE(created_at);
-- å­˜å‚¨ä»£ä»·ï¼š8GB
-- æŸ¥è¯¢æ€§èƒ½æå‡ï¼š60x

-- å€™é€‰2ï¼šäº‹ä»¶ç±»å‹æ±‡æ€»ï¼ˆä¸­é¢‘ï¼‰
CREATE MATERIALIZED VIEW mv_event_type_summary AS
SELECT
    event_type,
    DATE(created_at) as event_date,
    COUNT(*) as event_count,
    COUNT(DISTINCT user_id) as user_count
FROM user_events
GROUP BY event_type, DATE(created_at);
-- å­˜å‚¨ä»£ä»·ï¼š1GB
-- æŸ¥è¯¢æ€§èƒ½æå‡ï¼š40x
```

**ç‰©åŒ–è§†å›¾é€‰æ‹©**ï¼š

```sql
-- ä½¿ç”¨è´ªå¿ƒç®—æ³•é€‰æ‹©ï¼ˆé¢„ç®—ï¼š20GBï¼‰
-- 1. é€‰æ‹©mv_user_events_summaryï¼ˆæ”¶ç›Š/ä»£ä»·æ¯”æœ€é«˜ï¼‰
-- 2. é€‰æ‹©mv_event_type_summaryï¼ˆæ”¶ç›Š/ä»£ä»·æ¯”æ¬¡é«˜ï¼‰
-- æ€»å­˜å‚¨ï¼š9GB < 20GBï¼Œæ»¡è¶³é¢„ç®—
```

**æ•ˆæœ**ï¼š

- æŸ¥è¯¢æ€§èƒ½æå‡ï¼šä»å¹³å‡800msé™è‡³15msï¼ˆ53xï¼‰
- å­˜å‚¨ä½¿ç”¨ï¼š9GBï¼ˆè¿œä½äº20GBé¢„ç®—ï¼‰
- æ”¯æŒå®æ—¶ç”¨æˆ·è¡Œä¸ºåˆ†æ

### 5.6 æ€§èƒ½å¯¹æ¯”æ•°æ®

#### 5.6.1 ç‰©åŒ–è§†å›¾æŸ¥è¯¢æ€§èƒ½

| æŸ¥è¯¢ç±»å‹ | åŸå§‹æŸ¥è¯¢ | ç‰©åŒ–è§†å›¾æŸ¥è¯¢ | æ€§èƒ½æå‡ |
| --- | --- | --- | --- |
| **èšåˆæŸ¥è¯¢** | 500ms | 10ms | 50x |
| **è¿æ¥æŸ¥è¯¢** | 1000ms | 20ms | 50x |
| **å¤æ‚èšåˆ** | 2000ms | 50ms | 40x |

#### 5.6.2 ç‰©åŒ–è§†å›¾å­˜å‚¨ä»£ä»·

| ç‰©åŒ–è§†å›¾ | å­˜å‚¨å¤§å° | æŸ¥è¯¢é¢‘ç‡ | æ”¶ç›Š/ä»£ä»·æ¯” |
| --- | --- | --- | --- |
| **å®¢æˆ·è®¢å•æ±‡æ€»** | 5GB | é«˜ | 10.0 |
| **äº§å“é”€å”®æ±‡æ€»** | 3GB | ä¸­ | 8.0 |
| **è®¢å•æ—¥æœŸæ±‡æ€»** | 500MB | ä½ | 5.0 |

### 5.7 æœ€ä½³å®è·µ

#### 5.7.1 ç‰©åŒ–è§†å›¾é€‰æ‹©åŸåˆ™

1. **åˆ†ææŸ¥è¯¢è´Ÿè½½**ï¼š
   - è¯†åˆ«é«˜é¢‘æŸ¥è¯¢
   - åˆ†ææŸ¥è¯¢æ€§èƒ½ç“¶é¢ˆ

2. **è¯„ä¼°æ”¶ç›Š/ä»£ä»·æ¯”**ï¼š
   - è®¡ç®—æ¯ä¸ªç‰©åŒ–è§†å›¾çš„æ”¶ç›Š/ä»£ä»·æ¯”
   - ä¼˜å…ˆé€‰æ‹©æ”¶ç›Š/ä»£ä»·æ¯”é«˜çš„ç‰©åŒ–è§†å›¾

3. **è€ƒè™‘é¢„ç®—çº¦æŸ**ï¼š
   - åœ¨å­˜å‚¨é¢„ç®—å†…é€‰æ‹©ç‰©åŒ–è§†å›¾
   - ä½¿ç”¨è´ªå¿ƒç®—æ³•é€‰æ‹©æœ€ä¼˜é›†åˆ

#### 5.7.2 ç‰©åŒ–è§†å›¾ä¼˜åŒ–ç­–ç•¥

1. **åˆ›å»ºå”¯ä¸€ç´¢å¼•**ï¼š

   ```sql
   -- æ”¯æŒå¢é‡åˆ·æ–°
   CREATE UNIQUE INDEX idx_mv_customer_orders_customer_id
   ON mv_customer_orders(customer_id);
   ```

2. **å®šæœŸåˆ·æ–°**ï¼š

   ```sql
   -- ä½¿ç”¨pg_cronå®šæ—¶åˆ·æ–°
   SELECT cron.schedule(
       'refresh-mv',
       '0 * * * *',
       $$REFRESH MATERIALIZED VIEW CONCURRENTLY mv_customer_orders$$
   );
   ```

3. **ç›‘æ§ç‰©åŒ–è§†å›¾ä½¿ç”¨**ï¼š

   ```sql
   -- ç›‘æ§ç‰©åŒ–è§†å›¾æŸ¥è¯¢æ€§èƒ½
   SELECT
       schemaname,
       matviewname,
       pg_size_pretty(pg_total_relation_size(schemaname||'.'||matviewname)) AS size
   FROM pg_matviews;
   ```

---

## 6. ç›¸å…³æ–‡æ¡£

### 6.1 ç†è®ºåŸºç¡€æ–‡æ¡£

- [å¢é‡ç‰©åŒ–è§†å›¾-ä»£æ•°å·®åˆ†ä¸æ­£ç¡®æ€§](./05.04-å¢é‡ç‰©åŒ–è§†å›¾-ä»£æ•°å·®åˆ†ä¸æ­£ç¡®æ€§.md)
- [å¯è‡ªç»´æŠ¤ç‰©åŒ–è§†å›¾-å¯ç»´æŠ¤æ€§åˆ¤æ®ä¸æ„é€ ](./05.08-å¯è‡ªç»´æŠ¤ç‰©åŒ–è§†å›¾-å¯ç»´æŠ¤æ€§åˆ¤æ®ä¸æ„é€ .md)
- [ç†è®ºåŸºç¡€å¯¼èˆª](../README.md)

---

## 7. å‚è€ƒæ–‡çŒ®

### 7.1 æ ¸å¿ƒç†è®ºæ–‡çŒ®

- **Harinarayan, V., et al. (1996). "Implementing Data Cubes Efficiently."**
  - ä¼šè®®: SIGMOD 1996
  - **é‡è¦æ€§**: ç‰©åŒ–è§†å›¾é€‰æ‹©çš„ç»å…¸è®ºæ–‡
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†ç‰©åŒ–è§†å›¾é€‰æ‹©çš„è´ªå¿ƒç®—æ³•

- **Chaudhuri, S., & Narasayya, V. (1997). "AutoAdmin 'What-if' Index Analysis Utility."**
  - ä¼šè®®: SIGMOD 1997
  - **é‡è¦æ€§**: è‡ªåŠ¨ç‰©åŒ–è§†å›¾é€‰æ‹©çš„ç»å…¸ç ”ç©¶
  - **æ ¸å¿ƒè´¡çŒ®**: æä¾›äº†ç‰©åŒ–è§†å›¾é€‰æ‹©çš„ä»£ä»·æ¨¡å‹

### 7.2 æŸ¥è¯¢é‡å†™ç›¸å…³

- **Larson, P. A., & Yang, H. Z. (1985). "Computing Queries from Derived Relations."**
  - ä¼šè®®: VLDB 1985
  - **é‡è¦æ€§**: æŸ¥è¯¢é‡å†™çš„ç»å…¸è®ºæ–‡
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†ç‰©åŒ–è§†å›¾æŸ¥è¯¢é‡å†™çš„æ–¹æ³•

### 7.3 PostgreSQLå®ç°ç›¸å…³

- **[PostgreSQLå®˜æ–¹æ–‡æ¡£ - ç‰©åŒ–è§†å›¾](<https://www.postgresql.org/docs/current/sql-creatematerializedview.html>)**
  - PostgreSQLç‰©åŒ–è§†å›¾å®ç°è¯´æ˜

### 7.4 ç›¸å…³æ–‡æ¡£

- [å¢é‡ç‰©åŒ–è§†å›¾-ä»£æ•°å·®åˆ†ä¸æ­£ç¡®æ€§](./05.04-å¢é‡ç‰©åŒ–è§†å›¾-ä»£æ•°å·®åˆ†ä¸æ­£ç¡®æ€§.md)
- [å¯è‡ªç»´æŠ¤ç‰©åŒ–è§†å›¾-å¯ç»´æŠ¤æ€§åˆ¤æ®ä¸æ„é€ ](./05.08-å¯è‡ªç»´æŠ¤ç‰©åŒ–è§†å›¾-å¯ç»´æŠ¤æ€§åˆ¤æ®ä¸æ„é€ .md)
- [ç†è®ºåŸºç¡€å¯¼èˆª](../README.md)

---

**æœ€åæ›´æ–°**: 2025-01-16
**ç»´æŠ¤è€…**: Documentation Team
**çŠ¶æ€**: âœ… å†…å®¹å·²å®Œå–„
