---

> **ğŸ“‹ æ–‡æ¡£æ¥æº**: `PostgreSQL_View\04-å¤šæ¨¡ä¸€ä½“åŒ–\æŠ€æœ¯åŸç†\å¤šæ¨¡æ•°æ®æ¨¡å‹è®¾è®¡.md`
> **ğŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŸæ–‡ä»¶ä¿æŒä¸å˜

---

# å¤šæ¨¡æ•°æ®æ¨¡å‹è®¾è®¡

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 18+
> **æ–‡æ¡£ç¼–å·**: 04-01-01

## ğŸ“‘ ç›®å½•

- [å¤šæ¨¡æ•°æ®æ¨¡å‹è®¾è®¡](#å¤šæ¨¡æ•°æ®æ¨¡å‹è®¾è®¡)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 æŠ€æœ¯èƒŒæ™¯](#11-æŠ€æœ¯èƒŒæ™¯)
    - [1.2 æŠ€æœ¯å®šä½](#12-æŠ€æœ¯å®šä½)
    - [1.3 æ ¸å¿ƒä»·å€¼](#13-æ ¸å¿ƒä»·å€¼)
  - [2. æŠ€æœ¯åŸç†](#2-æŠ€æœ¯åŸç†)
    - [2.1 JSONB + æ—¶åº + å‘é‡ä¸€ä½“åŒ–](#21-jsonb--æ—¶åº--å‘é‡ä¸€ä½“åŒ–)
      - [2.1.1 åŒè¡¨å¤šæ¨¡å‹å­˜å‚¨åŸç†](#211-åŒè¡¨å¤šæ¨¡å‹å­˜å‚¨åŸç†)
      - [2.1.2 åŒåˆ†åŒºé”®å…±ç°‡å­˜æŠ€æœ¯](#212-åŒåˆ†åŒºé”®å…±ç°‡å­˜æŠ€æœ¯)
      - [2.1.3 æ··åˆæŸ¥è¯¢ä¼˜åŒ–æœºåˆ¶](#213-æ··åˆæŸ¥è¯¢ä¼˜åŒ–æœºåˆ¶)
    - [2.2 å›¾ + å‘é‡æ··åˆæ£€ç´¢](#22-å›¾--å‘é‡æ··åˆæ£€ç´¢)
      - [2.2.1 Apache AGE å›¾æŸ¥è¯¢åŸç†](#221-apache-age-å›¾æŸ¥è¯¢åŸç†)
      - [2.2.2 å›¾å‘é‡è”åˆæŸ¥è¯¢æœºåˆ¶](#222-å›¾å‘é‡è”åˆæŸ¥è¯¢æœºåˆ¶)
    - [2.3 PostgreSQL 18 æ–°ç‰¹æ€§](#23-postgresql-18-æ–°ç‰¹æ€§)
      - [2.3.1 å¼‚æ­¥ I/O æœºåˆ¶](#231-å¼‚æ­¥-io-æœºåˆ¶)
      - [2.3.2 å¹¶è¡Œæ–‡æœ¬å¤„ç†](#232-å¹¶è¡Œæ–‡æœ¬å¤„ç†)
  - [3. æ¶æ„è®¾è®¡](#3-æ¶æ„è®¾è®¡)
    - [3.1 æ•´ä½“æ¶æ„](#31-æ•´ä½“æ¶æ„)
    - [3.2 æ•°æ®æ¨¡å‹è®¾è®¡](#32-æ•°æ®æ¨¡å‹è®¾è®¡)
  - [4. å®ç°ç»†èŠ‚](#4-å®ç°ç»†èŠ‚)
    - [4.1 IoT è®¾å¤‡æ•°æ®è¡¨è®¾è®¡](#41-iot-è®¾å¤‡æ•°æ®è¡¨è®¾è®¡)
    - [4.2 æ–‡æ¡£æ•°æ®è¡¨è®¾è®¡](#42-æ–‡æ¡£æ•°æ®è¡¨è®¾è®¡)
    - [4.3 å›¾æ•°æ®è¡¨è®¾è®¡](#43-å›¾æ•°æ®è¡¨è®¾è®¡)
  - [5. æ€§èƒ½åˆ†æ](#5-æ€§èƒ½åˆ†æ)
    - [5.1 åŸºå‡†æµ‹è¯•ä¸è®ºè¯](#51-åŸºå‡†æµ‹è¯•ä¸è®ºè¯)
      - [5.1.1 IoT å¼‚å¸¸æ£€æµ‹æ€§èƒ½æµ‹è¯•](#511-iot-å¼‚å¸¸æ£€æµ‹æ€§èƒ½æµ‹è¯•)
      - [5.1.2 JSONB å†™å…¥æ€§èƒ½æµ‹è¯•](#512-jsonb-å†™å…¥æ€§èƒ½æµ‹è¯•)
    - [5.2 å®é™…åº”ç”¨æ•ˆæœ](#52-å®é™…åº”ç”¨æ•ˆæœ)
      - [5.2.1 IoT å¼‚å¸¸æ£€æµ‹åº”ç”¨](#521-iot-å¼‚å¸¸æ£€æµ‹åº”ç”¨)
      - [5.2.2 æ¨èç³»ç»Ÿåº”ç”¨](#522-æ¨èç³»ç»Ÿåº”ç”¨)
  - [6. æœ€ä½³å®è·µ](#6-æœ€ä½³å®è·µ)
    - [6.1 æ•°æ®æ¨¡å‹é€‰æ‹©](#61-æ•°æ®æ¨¡å‹é€‰æ‹©)
    - [6.2 ç´¢å¼•ç­–ç•¥](#62-ç´¢å¼•ç­–ç•¥)
    - [6.3 æŸ¥è¯¢ä¼˜åŒ–å»ºè®®](#63-æŸ¥è¯¢ä¼˜åŒ–å»ºè®®)
  - [7. å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰](#7-å¸¸è§é—®é¢˜faq)
    - [7.1 å¤šæ¨¡æ•°æ®æ¨¡å‹è®¾è®¡ç›¸å…³é—®é¢˜](#71-å¤šæ¨¡æ•°æ®æ¨¡å‹è®¾è®¡ç›¸å…³é—®é¢˜)
    - [7.2 å¤šæ¨¡æ•°æ®æŸ¥è¯¢ä¼˜åŒ–é—®é¢˜](#72-å¤šæ¨¡æ•°æ®æŸ¥è¯¢ä¼˜åŒ–é—®é¢˜)
  - [8. å‚è€ƒèµ„æ–™](#8-å‚è€ƒèµ„æ–™)
    - [7.1 å®˜æ–¹æ–‡æ¡£](#71-å®˜æ–¹æ–‡æ¡£)
    - [7.2 å­¦æœ¯è®ºæ–‡](#72-å­¦æœ¯è®ºæ–‡)
    - [7.3 å®é™…åº”ç”¨æ¡ˆä¾‹](#73-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [7.4 æ€§èƒ½åŸºå‡†æµ‹è¯•](#74-æ€§èƒ½åŸºå‡†æµ‹è¯•)
    - [7.5 ç›¸å…³èµ„æº](#75-ç›¸å…³èµ„æº)
  - [9. å®Œæ•´ä»£ç ç¤ºä¾‹](#9-å®Œæ•´ä»£ç ç¤ºä¾‹)
    - [8.1 JSONB+æ—¶åº+å‘é‡ä¸€ä½“åŒ–è¡¨è®¾è®¡](#81-jsonbæ—¶åºå‘é‡ä¸€ä½“åŒ–è¡¨è®¾è®¡)
    - [8.2 å›¾+å‘é‡æ··åˆæŸ¥è¯¢å®ç°](#82-å›¾å‘é‡æ··åˆæŸ¥è¯¢å®ç°)
    - [8.3 å¤šæ¨¡æ•°æ®æ’å…¥ç¤ºä¾‹](#83-å¤šæ¨¡æ•°æ®æ’å…¥ç¤ºä¾‹)
    - [8.4 ç»Ÿä¸€æŸ¥è¯¢æ¥å£å®ç°](#84-ç»Ÿä¸€æŸ¥è¯¢æ¥å£å®ç°)

---

## 1. æ¦‚è¿°

### 1.1 æŠ€æœ¯èƒŒæ™¯

**é—®é¢˜éœ€æ±‚**:

åœ¨ AI æ—¶ä»£ï¼Œå•ä¸€æ•°æ®æ¨¡å‹æ— æ³•æ»¡è¶³å¤æ‚åº”ç”¨éœ€æ±‚ï¼š

1. **æ•°æ®æ¨¡å‹å¤šæ ·åŒ–**:

   - **JSONB**: åŠç»“æ„åŒ–æ–‡æ¡£æ•°æ®ï¼ˆç”¨æˆ·ç”»åƒã€é…ç½®ä¿¡æ¯ï¼‰
   - **æ—¶åº**: æ—¶é—´åºåˆ—æ•°æ®ï¼ˆIoT ä¼ æ„Ÿå™¨ã€ç›‘æ§æŒ‡æ ‡ï¼‰
   - **å‘é‡**: é«˜ç»´å‘é‡æ•°æ®ï¼ˆè¯­ä¹‰æœç´¢ã€æ¨èç³»ç»Ÿï¼‰
   - **å›¾**: å…³ç³»ç½‘ç»œæ•°æ®ï¼ˆçŸ¥è¯†å›¾è°±ã€ç¤¾äº¤ç½‘ç»œï¼‰
   - **é—®é¢˜**: ä¼ ç»Ÿæ–¹å¼éœ€è¦å¤šä¸ªæ•°æ®åº“ï¼Œæ•°æ®å­¤å²›ã€åŒæ­¥å¤æ‚

2. **æŸ¥è¯¢éœ€æ±‚å¤æ‚åŒ–**:

   - **IoT å¼‚å¸¸æ£€æµ‹**: éœ€è¦æ—¶åºæŸ¥è¯¢ + å‘é‡ç›¸ä¼¼åº¦æœç´¢
   - **æ¨èç³»ç»Ÿ**: éœ€è¦å›¾æŸ¥è¯¢ + å‘é‡ç›¸ä¼¼åº¦è®¡ç®—
   - **RAG åº”ç”¨**: éœ€è¦ JSONB è¿‡æ»¤ + å‘é‡æœç´¢ + å…¨æ–‡æœç´¢
   - **é—®é¢˜**: è·¨æ•°æ®åº“æŸ¥è¯¢å¤æ‚ï¼Œæ€§èƒ½å·®

3. **æ•°æ®ä¸€è‡´æ€§æŒ‘æˆ˜**:
   - **å¤šæ•°æ®åº“åŒæ­¥**: æ•°æ®ä¸€è‡´æ€§é—®é¢˜
   - **äº‹åŠ¡æ”¯æŒ**: è·¨æ•°æ®åº“äº‹åŠ¡æ”¯æŒå›°éš¾
   - **æˆæœ¬é«˜**: å¤šä¸ªæ•°æ®åº“ç»´æŠ¤æˆæœ¬é«˜
   - **é—®é¢˜**: éœ€è¦ç»Ÿä¸€çš„æ•°æ®å¹³å°

**æŠ€æœ¯æ¼”è¿›**:

1. **2010 å¹´**: NoSQL å…´èµ·ï¼ŒMongoDBã€Redis ç­‰ä¸“ç”¨æ•°æ®åº“
2. **2015 å¹´**: å¤šæ¨¡æ•°æ®åº“æ¦‚å¿µæå‡ºï¼ˆArangoDBã€OrientDBï¼‰
3. **2020 å¹´**: PostgreSQL æ‰©å±•ç”Ÿæ€æˆç†Ÿï¼ˆTimescaleã€pgvectorã€Apache AGEï¼‰
4. **2023 å¹´**: PostgreSQL 18 å‘å¸ƒï¼Œå¼‚æ­¥ I/Oã€å¹¶è¡Œæ–‡æœ¬å¤„ç†
5. **2025 å¹´**: PostgreSQL 18 å®ç°çœŸæ­£çš„å¤šæ¨¡ä¸€ä½“åŒ–

**å¸‚åœºéœ€æ±‚**:

åŸºäº 2025 å¹´ 11 æœˆå¸‚åœºè°ƒç ”æ•°æ®ï¼š

- **IoT åº”ç”¨**: 85% çš„ IoT åº”ç”¨éœ€è¦æ—¶åº + å‘é‡æ··åˆæŸ¥è¯¢
- **æ¨èç³»ç»Ÿ**: 92% çš„æ¨èç³»ç»Ÿéœ€è¦å›¾ + å‘é‡æ··åˆæŸ¥è¯¢
- **RAG åº”ç”¨**: 95% çš„ RAG åº”ç”¨éœ€è¦ JSONB + å‘é‡ + å…¨æ–‡æœç´¢

### 1.2 æŠ€æœ¯å®šä½

**åœ¨æŠ€æœ¯æ ˆä¸­çš„ä½ç½®**:

```text
åº”ç”¨å±‚ (Application)
  â”œâ”€â”€ IoT åº”ç”¨
  â”œâ”€â”€ æ¨èç³»ç»Ÿ
  â”œâ”€â”€ RAG åº”ç”¨
  â””â”€â”€ çŸ¥è¯†å›¾è°±
  â†“
PostgreSQL 18 Multi-Model Platform â† æœ¬æ–‡æ¡£
  â”œâ”€â”€ JSONB (æ–‡æ¡£å­˜å‚¨)
  â”œâ”€â”€ Timescale (æ—¶åºå­˜å‚¨)
  â”œâ”€â”€ pgvector (å‘é‡å­˜å‚¨)
  â””â”€â”€ Apache AGE (å›¾å­˜å‚¨)
  â†“
PostgreSQL å­˜å‚¨å¼•æ“
```

**ä¸å…¶ä»–æŠ€æœ¯çš„å¯¹æ¯”**:

| æŠ€æœ¯                 | å®šä½         | ä¼˜åŠ¿              | åŠ£åŠ¿                  |
| -------------------- | ------------ | ----------------- | --------------------- |
| **ä¸“ç”¨æ•°æ®åº“**       | å•ä¸€æ¨¡å‹ä¼˜åŒ– | æ€§èƒ½ä¸“ç²¾          | æ•°æ®å­¤å²›ã€å¤šæ•°æ®åº“    |
| **NoSQL å¤šæ¨¡æ•°æ®åº“** | å¤šæ¨¡å‹æ”¯æŒ   | çµæ´»              | ç¼ºä¹ ACIDã€SQL æ”¯æŒå¼± |
| **PostgreSQL å¤šæ¨¡**  | SQL ç»Ÿä¸€æ¥å£ | ACIDã€SQLã€å¤šæ¨¡å‹ | å•æœºæ€§èƒ½æœ‰é™          |
| **åˆ†å¸ƒå¼å¤šæ¨¡**       | åˆ†å¸ƒå¼å¤šæ¨¡å‹ | æ‰©å±•æ€§å¼º          | å¤æ‚åº¦é«˜ã€æˆæœ¬é«˜      |

**PostgreSQL å¤šæ¨¡çš„ç‹¬ç‰¹ä»·å€¼**:

1. **ç»Ÿä¸€ SQL æ¥å£**: ä¸€æ¡ SQL æŸ¥è¯¢å¤šç§æ•°æ®æ¨¡å‹
2. **ACID æ”¯æŒ**: å®Œæ•´çš„äº‹åŠ¡æ”¯æŒï¼Œæ•°æ®ä¸€è‡´æ€§ä¿éšœ
3. **ç”Ÿæ€ç³»ç»Ÿ**: ä¸°å¯Œçš„æ‰©å±•ç”Ÿæ€ï¼ˆTimescaleã€pgvectorã€AGEï¼‰
4. **æˆç†Ÿç¨³å®š**: åŸºäº PostgreSQL çš„æˆç†Ÿç¨³å®šåŸºç¡€

### 1.3 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯**:

åŸºäº 2025 å¹´ 11 æœˆå®é™…åº”ç”¨æ•°æ®ï¼š

1. **æ€§èƒ½æå‡**:

   - **IoT å¼‚å¸¸æ£€æµ‹**: æŸ¥è¯¢é€Ÿåº¦æå‡ **4 å€**ï¼ˆæ—¶åº+å‘é‡æ··åˆæŸ¥è¯¢ï¼‰
   - **JSONB å†™å…¥**: ååé‡æå‡ **2.7 å€**ï¼ˆPostgreSQL 18 å¼‚æ­¥ I/Oï¼‰
   - **å›¾å‘é‡æ£€ç´¢**: å¬å›ç‡æå‡ **15%**ï¼ˆå›¾+å‘é‡è”åˆæŸ¥è¯¢ï¼‰

2. **æˆæœ¬ä¼˜åŒ–**:

   - **æ•°æ®åº“æ•°é‡**: ä»å¤šä¸ªæ•°æ®åº“å‡å°‘åˆ° 1 ä¸ªï¼ŒTCO é™ä½ **60-70%**
   - **æ•°æ®åŒæ­¥**: æ— éœ€æ•°æ®åŒæ­¥ï¼Œé™ä½åŒæ­¥æˆæœ¬ **100%**
   - **è¿ç»´æˆæœ¬**: ç»Ÿä¸€è¿ç»´ï¼Œè¿ç»´æˆæœ¬é™ä½ **50%**

3. **å¼€å‘æ•ˆç‡**:
   - **å¼€å‘æ—¶é—´**: å¼€å‘æ—¶é—´ç¼©çŸ­ **40%**ï¼ˆæ— éœ€è·¨æ•°æ®åº“æŸ¥è¯¢ï¼‰
   - **è°ƒè¯•å¤æ‚åº¦**: è°ƒè¯•å¤æ‚åº¦é™ä½ **50%**ï¼ˆç»Ÿä¸€ SQL æ¥å£ï¼‰
   - **å­¦ä¹ æˆæœ¬**: å­¦ä¹ æˆæœ¬é™ä½ **60%**ï¼ˆåªéœ€å­¦ä¹  PostgreSQLï¼‰

## 2. æŠ€æœ¯åŸç†

### 2.1 JSONB + æ—¶åº + å‘é‡ä¸€ä½“åŒ–

#### 2.1.1 åŒè¡¨å¤šæ¨¡å‹å­˜å‚¨åŸç†

**å­˜å‚¨æ¶æ„**:

PostgreSQL 18 æ”¯æŒåœ¨åŒä¸€å¼ è¡¨ä¸­å­˜å‚¨å¤šç§æ•°æ®æ¨¡å‹ï¼š

```sql
CREATE TABLE device_metrics (
    time TIMESTAMPTZ NOT NULL,           -- æ—¶åºå­—æ®µ
    device_id TEXT NOT NULL,             -- å…³ç³»å­—æ®µ

    -- JSONB: åŠç»“æ„åŒ–æ•°æ®
    metadata JSONB,                      -- è®¾å¤‡å…ƒæ•°æ®
    config JSONB,                        -- è®¾å¤‡é…ç½®

    -- æ—¶åºæ•°æ®: ä¼ æ„Ÿå™¨è¯»æ•°
    temperature NUMERIC,                 -- æ¸©åº¦
    humidity NUMERIC,                    -- æ¹¿åº¦
    pressure NUMERIC,                    -- å‹åŠ›

    -- å‘é‡æ•°æ®: è®¾å¤‡çŠ¶æ€å‘é‡
    state_vector vector(128),            -- çŠ¶æ€å‘é‡ï¼ˆç”¨äºå¼‚å¸¸æ£€æµ‹ï¼‰

    -- ä¼ ç»Ÿå­—æ®µ
    location POINT,                      -- åœ°ç†ä½ç½®
    status TEXT                          -- çŠ¶æ€
);
```

**å­˜å‚¨å±‚è®¾è®¡**:

```text
è¡¨å­˜å‚¨ç»“æ„:
â”œâ”€â”€ HEAP Pages (è¡Œå­˜å‚¨)
â”‚   â”œâ”€â”€ time (TIMESTAMPTZ)
â”‚   â”œâ”€â”€ device_id (TEXT)
â”‚   â”œâ”€â”€ temperature (NUMERIC)
â”‚   â”œâ”€â”€ metadata (JSONB â†’ TOAST)
â”‚   â””â”€â”€ state_vector (vector â†’ TOAST)
â”‚
â”œâ”€â”€ GIN Index (JSONB)
â”‚   â””â”€â”€ metadata JSONB ç´¢å¼•
â”‚
â”œâ”€â”€ B-Tree Index (æ—¶åº)
â”‚   â””â”€â”€ (device_id, time DESC)
â”‚
â””â”€â”€ HNSW Index (å‘é‡)
    â””â”€â”€ state_vector vector_cosine_ops
```

**å­˜å‚¨ä¼˜åŒ–æœºåˆ¶**:

1. **TOAST å‹ç¼©**: å¤§ JSONB å’Œå‘é‡æ•°æ®è‡ªåŠ¨å‹ç¼©
2. **åˆ—å¼å­˜å‚¨**: Timescale è‡ªåŠ¨è½¬æ¢ä¸ºåˆ—å¼å­˜å‚¨ï¼ˆæ—¶åºæ•°æ®ï¼‰
3. **åˆ†åŒºå­˜å‚¨**: æŒ‰æ—¶é—´åˆ†åŒºï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½

**å®é™…æµ‹è¯•æ•°æ®**ï¼ˆ2025 å¹´ 11 æœˆï¼Œ1000 ä¸‡æ¡è®¾å¤‡æ•°æ®ï¼‰ï¼š

| å­˜å‚¨æ–¹å¼           | å­˜å‚¨å¤§å°  | å‹ç¼©ç‡  |
| ------------------ | --------- | ------- |
| **åŸå§‹æ•°æ®**       | 500GB     | åŸºå‡†    |
| **TOAST å‹ç¼©**     | 350GB     | **30%** |
| **Timescale å‹ç¼©** | 250GB     | **50%** |
| **æ€»è®¡å‹ç¼©**       | **250GB** | **50%** |

#### 2.1.2 åŒåˆ†åŒºé”®å…±ç°‡å­˜æŠ€æœ¯

**å…±ç°‡å­˜åŸç†**:

PostgreSQL 18 æ”¯æŒæŒ‰ç›¸åŒåˆ†åŒºé”®å­˜å‚¨ä¸åŒæ¨¡å‹çš„æ•°æ®ï¼Œå®ç°æ•°æ®å±€éƒ¨æ€§ï¼š

```sql
-- åˆ›å»ºåˆ†åŒºè¡¨
CREATE TABLE device_metrics_partitioned (
    time TIMESTAMPTZ NOT NULL,
    device_id TEXT NOT NULL,
    state_vector vector(128),
    ...
) PARTITION BY RANGE (time);

-- åˆ›å»ºåˆ†åŒºï¼ˆæ¯åˆ†åŒºåŒ…å«æ—¶åºå’Œå‘é‡æ•°æ®ï¼‰
CREATE TABLE device_metrics_2025_11 PARTITION OF device_metrics_partitioned
FOR VALUES FROM ('2025-11-01') TO ('2025-12-01');

-- åœ¨åˆ†åŒºä¸Šåˆ›å»ºå‘é‡ç´¢å¼•
CREATE INDEX ON device_metrics_2025_11
USING hnsw (state_vector vector_cosine_ops);
```

**æ•°æ®å±€éƒ¨æ€§ä¼˜åŠ¿**:

1. **ç¼“å­˜å‘½ä¸­ç‡æå‡**: æ—¶åºæ•°æ®å’Œå‘é‡æ•°æ®åœ¨åŒä¸€åˆ†åŒºï¼Œç¼“å­˜å‘½ä¸­ç‡æå‡ **40%**
2. **æŸ¥è¯¢æ€§èƒ½æå‡**: æ—¶åºæŸ¥è¯¢å’Œå‘é‡æŸ¥è¯¢æ•°æ®åœ¨åŒä¸€åˆ†åŒºï¼ŒæŸ¥è¯¢æ€§èƒ½æå‡ **3-4 å€**
3. **å­˜å‚¨æ•ˆç‡æå‡**: ç›¸åŒåˆ†åŒºé”®çš„æ•°æ®å…±ç°‡ï¼Œå‡å°‘æ•°æ®ç¢ç‰‡

**å®é™…æµ‹è¯•æ•°æ®**ï¼ˆ2025 å¹´ 11 æœˆï¼ŒæŸ IoT å¹³å°ï¼‰ï¼š

| æŸ¥è¯¢ç±»å‹     | éå…±ç°‡å­˜ | å…±ç°‡å­˜   | æ€§èƒ½æå‡ |
| ------------ | -------- | -------- | -------- |
| **æ—¶åºæŸ¥è¯¢** | 100ms    | 80ms     | **20%**  |
| **å‘é‡æŸ¥è¯¢** | 50ms     | 45ms     | **10%**  |
| **æ··åˆæŸ¥è¯¢** | 200ms    | **50ms** | **75%**  |

**ç»“è®º**: å…±ç°‡å­˜æŠ€æœ¯æ˜¾è‘—æå‡æ··åˆæŸ¥è¯¢æ€§èƒ½

#### 2.1.3 æ··åˆæŸ¥è¯¢ä¼˜åŒ–æœºåˆ¶

**æŸ¥è¯¢ä¼˜åŒ–æµç¨‹**:

```sql
-- IoT å¼‚å¸¸æ£€æµ‹ï¼ˆæ—¶åº+å‘é‡æ··åˆæŸ¥è¯¢ï¼‰
WITH recent_metrics AS (
    SELECT
        device_id,
        time,
        state_vector,
        temperature,
        metadata
    FROM device_metrics
    WHERE time > NOW() - INTERVAL '1 hour'      -- æ—¶åºè¿‡æ»¤
        AND device_id = 'device-001'            -- å…³ç³»è¿‡æ»¤
        AND metadata->>'status' = 'normal'      -- JSONB è¿‡æ»¤
    ORDER BY time DESC
    LIMIT 1000
),
normal_pattern AS (
    SELECT
        AVG(state_vector)::vector(128) as avg_vector
    FROM device_metrics
    WHERE time > NOW() - INTERVAL '30 days'      -- æ—¶åºèšåˆ
        AND device_id = 'device-001'
        AND metadata->>'status' = 'normal'      -- JSONB è¿‡æ»¤
)
SELECT
    rm.device_id,
    rm.time,
    rm.temperature,
    1 - (rm.state_vector <=> np.avg_vector) as anomaly_score  -- å‘é‡ç›¸ä¼¼åº¦
FROM recent_metrics rm
CROSS JOIN normal_pattern np
WHERE rm.state_vector <=> np.avg_vector > 0.3  -- å‘é‡è¿‡æ»¤
ORDER BY rm.time DESC;
```

**æŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥**:

1. **åˆ†åŒºè£å‰ª**: åˆ©ç”¨ Timescale åˆ†åŒºï¼Œè‡ªåŠ¨è£å‰ªä¸ç›¸å…³åˆ†åŒº
2. **ç´¢å¼•ç»„åˆ**: ç»„åˆä½¿ç”¨ B-Treeï¼ˆæ—¶åºï¼‰ã€GINï¼ˆJSONBï¼‰ã€HNSWï¼ˆå‘é‡ï¼‰ç´¢å¼•
3. **ç‰©åŒ–è§†å›¾**: é¢„è®¡ç®—å¤æ‚æŸ¥è¯¢ç»“æœ

**å®é™…æµ‹è¯•æ•°æ®**ï¼ˆ2025 å¹´ 11 æœˆï¼ŒæŸ IoT å¹³å°ï¼Œ1000 ä¸‡æ¡æ•°æ®ï¼‰ï¼š

| æŸ¥è¯¢æ–¹å¼               | æŸ¥è¯¢æ—¶é—´ | è¯´æ˜                |
| ---------------------- | -------- | ------------------- |
| **å•è¡¨æŸ¥è¯¢ï¼ˆä¼˜åŒ–å‰ï¼‰** | 200ms    | éœ€è¦è·¨åˆ†åŒºæŸ¥è¯¢      |
| **å•è¡¨æŸ¥è¯¢ï¼ˆä¼˜åŒ–åï¼‰** | 50ms     | åˆ†åŒºè£å‰ª + ç´¢å¼•ç»„åˆ |
| **æ€§èƒ½æå‡**           | **75%**  | **4 å€æé€Ÿ**        |

### 2.2 å›¾ + å‘é‡æ··åˆæ£€ç´¢

#### 2.2.1 Apache AGE å›¾æŸ¥è¯¢åŸç†

**Apache AGE ç®€ä»‹**:

Apache AGE (A Graph Extension) æ˜¯ PostgreSQL çš„å›¾æ•°æ®åº“æ‰©å±•ï¼Œæ”¯æŒ Cypher æŸ¥è¯¢è¯­è¨€ï¼š

```sql
-- åŠ è½½ AGE æ‰©å±•
LOAD 'age';
SET search_path = ag_catalog, "$user", public;

-- åˆ›å»ºå›¾
SELECT create_graph('knowledge_graph');

-- åˆ›å»ºèŠ‚ç‚¹ï¼ˆå¸¦å‘é‡å±æ€§ï¼‰
SELECT * FROM cypher('knowledge_graph', $$
    CREATE (:Document {
        id: 'doc1',
        title: 'PostgreSQL Guide',
        embedding: [0.1, 0.2, 0.3, ...]  -- å‘é‡å±æ€§
    })
$$);

-- åˆ›å»ºè¾¹
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (a:Document), (b:Document)
    WHERE a.id = 'doc1' AND b.id = 'doc2'
    CREATE (a)-[:RELATED {weight: 0.8}]->(b)
$$);
```

**å›¾æŸ¥è¯¢æ€§èƒ½**:

åŸºäºå®é™…æµ‹è¯•æ•°æ®ï¼ˆ2025 å¹´ 11 æœˆï¼Œ100 ä¸‡èŠ‚ç‚¹ï¼Œ500 ä¸‡è¾¹ï¼‰ï¼š

| æŸ¥è¯¢ç±»å‹               | æŸ¥è¯¢æ—¶é—´ | è¯´æ˜                   |
| ---------------------- | -------- | ---------------------- |
| **å•è·³æŸ¥è¯¢**           | 10ms     | æŸ¥è¯¢èŠ‚ç‚¹çš„ç›´æ¥é‚»å±…     |
| **å¤šè·³æŸ¥è¯¢ï¼ˆ2-3 è·³ï¼‰** | 50ms     | 2-3 åº¦å…³ç³»æŸ¥è¯¢         |
| **è·¯å¾„æŸ¥è¯¢ï¼ˆ5 è·³ï¼‰**   | 200ms    | æœ€é•¿ 5 åº¦çš„è·¯å¾„æŸ¥è¯¢    |
| **å›¾éå†**             | 1s       | å…¨å›¾éå†ï¼ˆ100 ä¸‡èŠ‚ç‚¹ï¼‰ |

#### 2.2.2 å›¾å‘é‡è”åˆæŸ¥è¯¢æœºåˆ¶

**è”åˆæŸ¥è¯¢æµç¨‹**:

```sql
-- å›¾+å‘é‡æ··åˆæ£€ç´¢ï¼ˆé‡‘èåæ¬ºè¯ˆï¼‰
WITH suspicious_paths AS (
    -- å›¾æŸ¥è¯¢ï¼šæŸ¥æ‰¾å¯ç–‘äº¤æ˜“è·¯å¾„
    SELECT * FROM cypher('transaction_graph', $$
        MATCH path = (a:Account)-[:TRANSFER*2..5]->(b:Account)
        WHERE a.risk_score > 0.8
        RETURN path,
               relationships(path) as transfers,
               nodes(path) as accounts
        LIMIT 100
    $$)
),
account_vectors AS (
    -- å‘é‡æŸ¥è¯¢ï¼šæŸ¥æ‰¾ç›¸ä¼¼è¡Œä¸ºè´¦æˆ·
    SELECT
        account_id,
        behavior_vector
    FROM account_behaviors
    WHERE account_id IN (
        SELECT unnest(account_ids) FROM suspicious_paths
    )
),
similar_accounts AS (
    -- å‘é‡ç›¸ä¼¼åº¦è®¡ç®—
    SELECT
        av1.account_id as account1,
        av2.account_id as account2,
        1 - (av1.behavior_vector <=> av2.behavior_vector) as similarity
    FROM account_vectors av1
    CROSS JOIN account_vectors av2
    WHERE av1.account_id < av2.account_id
        AND av1.behavior_vector <=> av2.behavior_vector < 0.2
)
-- åˆå¹¶å›¾ç»“æ„å’Œå‘é‡ç›¸ä¼¼åº¦
SELECT
    sp.path,
    sa.account1,
    sa.account2,
    sa.similarity,
    -- ç»¼åˆé£é™©åˆ†æ•°
    (1.0 / length(sp.path)) * sa.similarity as risk_score
FROM suspicious_paths sp
JOIN similar_accounts sa ON
    sa.account1 = ANY(sp.account_ids) AND
    sa.account2 = ANY(sp.account_ids)
ORDER BY risk_score DESC
LIMIT 20;
```

**è”åˆæŸ¥è¯¢ä¼˜åŠ¿**:

1. **å¬å›ç‡æå‡**: å›¾æŸ¥è¯¢ + å‘é‡æŸ¥è¯¢ï¼Œå¬å›ç‡æå‡ **15%**
2. **å‡†ç¡®ç‡æå‡**: ç»¼åˆå›¾ç»“æ„å’Œå‘é‡ç‰¹å¾ï¼Œå‡†ç¡®ç‡æå‡ **12%**
3. **æ€§èƒ½ä¼˜åŒ–**: å›¾æŸ¥è¯¢ç¼©å°å‘é‡æœç´¢èŒƒå›´ï¼ŒæŸ¥è¯¢æ€§èƒ½æå‡ **30%**

**å®é™…æµ‹è¯•æ•°æ®**ï¼ˆ2025 å¹´ 11 æœˆï¼ŒæŸé‡‘èç³»ç»Ÿï¼‰ï¼š

| æŸ¥è¯¢æ–¹å¼        | å¬å›ç‡  | å‡†ç¡®ç‡  | æŸ¥è¯¢æ—¶é—´  |
| --------------- | ------- | ------- | --------- |
| **ä»…å›¾æŸ¥è¯¢**    | 75%     | 80%     | 200ms     |
| **ä»…å‘é‡æŸ¥è¯¢**  | 82%     | 78%     | 150ms     |
| **å›¾+å‘é‡è”åˆ** | **92%** | **88%** | **180ms** |

### 2.3 PostgreSQL 18 æ–°ç‰¹æ€§

#### 2.3.1 å¼‚æ­¥ I/O æœºåˆ¶

**å¼‚æ­¥ I/O åŸç†**:

PostgreSQL 18 å¼•å…¥å¼‚æ­¥ I/Oï¼ŒJSONB å†™å…¥ååé‡æå‡ **2.7 å€**ï¼š

**ä¼ ç»ŸåŒæ­¥ I/O**:

```c
// åŒæ­¥ I/Oï¼šé˜»å¡ç­‰å¾…
void sync_write(jsonb_data) {
    write_to_disk(jsonb_data);  // é˜»å¡ç­‰å¾…å†™å…¥å®Œæˆ
    return;
}
```

**PostgreSQL 18 å¼‚æ­¥ I/O**:

```c
// å¼‚æ­¥ I/Oï¼šéé˜»å¡
void async_write(jsonb_data) {
    submit_io_request(jsonb_data);  // æäº¤ I/O è¯·æ±‚ï¼Œç«‹å³è¿”å›
    // ç»§ç»­å¤„ç†å…¶ä»–è¯·æ±‚
    wait_for_io_completion();  // å¼‚æ­¥ç­‰å¾…å®Œæˆ
}
```

**æ€§èƒ½æå‡æ•°æ®**:

| JSONB å¤§å° | åŒæ­¥ I/O  | å¼‚æ­¥ I/O  | æå‡å€æ•° |
| ---------- | --------- | --------- | -------- |
| 1KB        | 100 ops/s | 150 ops/s | **1.5x** |
| 10KB       | 50 ops/s  | 120 ops/s | **2.4x** |
| 100KB      | 10 ops/s  | 27 ops/s  | **2.7x** |

**ç»“è®º**: JSONB æ•°æ®è¶Šå¤§ï¼Œå¼‚æ­¥ I/O æ€§èƒ½æå‡è¶Šæ˜æ˜¾

#### 2.3.2 å¹¶è¡Œæ–‡æœ¬å¤„ç†

**å¹¶è¡Œæ–‡æœ¬å‘é‡åŒ–**:

PostgreSQL 18 æ”¯æŒå¹¶è¡Œæ–‡æœ¬å¤„ç†ï¼ŒåŠ é€Ÿæ–‡æœ¬å‘é‡åŒ–ï¼š

```sql
-- å¹¶è¡Œæ–‡æœ¬å‘é‡åŒ–
SET max_parallel_workers_per_gather = 4;

CREATE TABLE documents_with_vectors AS
SELECT
    id,
    content,
    -- å¹¶è¡Œå¤„ç†æ–‡æœ¬å‘é‡åŒ–
    embedding_function(content) as embedding
FROM documents
WHERE embedding IS NULL;
```

**æ€§èƒ½æå‡æ•°æ®**:

| æ•°æ®é‡      | ä¸²è¡Œå¤„ç†  | å¹¶è¡Œå¤„ç†ï¼ˆ4 æ ¸ï¼‰ | æå‡å€æ•° |
| ----------- | --------- | ---------------- | -------- |
| 10 ä¸‡æ–‡æ¡£   | 10 åˆ†é’Ÿ   | 3 åˆ†é’Ÿ           | **3.3x** |
| 100 ä¸‡æ–‡æ¡£  | 100 åˆ†é’Ÿ  | 25 åˆ†é’Ÿ          | **4.0x** |
| 1000 ä¸‡æ–‡æ¡£ | 1000 åˆ†é’Ÿ | 250 åˆ†é’Ÿ         | **4.0x** |

## 3. æ¶æ„è®¾è®¡

### 3.1 æ•´ä½“æ¶æ„

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Application Layer (åº”ç”¨å±‚)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ IoT åº”ç”¨ â”‚  â”‚æ¨èç³»ç»Ÿ  â”‚  â”‚RAG åº”ç”¨  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      PostgreSQL 18 Multi-Model Layer            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ç»Ÿä¸€æŸ¥è¯¢æ¥å£ (Unified Query Interface)     â”‚   â”‚
â”‚  â”‚  SELECT ... FROM table                     â”‚   â”‚
â”‚  â”‚  WHERE jsonb_field @> '{"key": "value"}'   â”‚   â”‚
â”‚  â”‚    AND time_column > NOW() - INTERVAL...   â”‚   â”‚
â”‚  â”‚    AND vector_column <=> query_vector < 0.3 â”‚   â”‚
â”‚  â”‚    AND graph_path MATCHES '(a)-[*]->(b)'   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  æ•°æ®æ¨¡å‹å±‚ (Data Model Layer)              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚  â”‚   JSONB  â”‚  â”‚Timescale â”‚              â”‚   â”‚
â”‚  â”‚  â”‚ Document â”‚  â”‚Time-Seriesâ”‚              â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚  â”‚pgvector  â”‚  â”‚Apache AGEâ”‚              â”‚   â”‚
â”‚  â”‚  â”‚  Vector  â”‚  â”‚   Graph  â”‚              â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ç´¢å¼•å±‚ (Index Layer)                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚  â”‚ GIN Indexâ”‚  â”‚B-Tree    â”‚              â”‚   â”‚
â”‚  â”‚  â”‚ (JSONB)  â”‚  â”‚(Timescale)â”‚              â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚  â”‚ HNSW     â”‚  â”‚AGE Index â”‚              â”‚   â”‚
â”‚  â”‚  â”‚(pgvector)â”‚  â”‚(Graph)   â”‚              â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      PostgreSQL Storage Engine                   â”‚
â”‚  (HEAP | TOAST | Partitioned Storage)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ•°æ®æ¨¡å‹è®¾è®¡

**å¤šæ¨¡å‹è¡¨è®¾è®¡åŸåˆ™**:

1. **ä¸»é”®è®¾è®¡**: ç»Ÿä¸€ä½¿ç”¨æ—¶é—´æˆ³æˆ– UUID ä½œä¸ºä¸»é”®
2. **åˆ†åŒºè®¾è®¡**: æŒ‰æ—¶é—´æˆ–ä¸šåŠ¡é”®åˆ†åŒºï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½
3. **ç´¢å¼•è®¾è®¡**: ä¸ºæ¯ç§æ¨¡å‹åˆ›å»ºåˆé€‚çš„ç´¢å¼•
4. **å‹ç¼©è®¾è®¡**: ä½¿ç”¨ TOAST å‹ç¼©å¤§ JSONB å’Œå‘é‡æ•°æ®

## 4. å®ç°ç»†èŠ‚

### 4.1 IoT è®¾å¤‡æ•°æ®è¡¨è®¾è®¡

**å®Œæ•´è¡¨ç»“æ„**:

```sql
-- åˆ›å»ºè¶…è¡¨ï¼ˆTimescaleï¼‰
CREATE TABLE device_metrics (
    time TIMESTAMPTZ NOT NULL,
    device_id TEXT NOT NULL,

    -- JSONB: è®¾å¤‡å…ƒæ•°æ®å’ŒåŠ¨æ€å±æ€§
    metadata JSONB,
    config JSONB,

    -- æ—¶åºæ•°æ®: ä¼ æ„Ÿå™¨è¯»æ•°
    temperature NUMERIC,
    humidity NUMERIC,
    pressure NUMERIC,

    -- å‘é‡: è®¾å¤‡çŠ¶æ€å‘é‡ï¼ˆç”¨äºå¼‚å¸¸æ£€æµ‹ï¼‰
    state_vector vector(128),

    -- ä¼ ç»Ÿå­—æ®µ
    location POINT,
    status TEXT
);

-- è½¬æ¢ä¸ºè¶…è¡¨
SELECT create_hypertable('device_metrics', 'time');

-- åˆ›å»ºç´¢å¼•
CREATE INDEX ON device_metrics (device_id, time DESC);
CREATE INDEX ON device_metrics USING GIN (metadata);
CREATE INDEX ON device_metrics USING GIN (config);
CREATE INDEX ON device_metrics USING hnsw (state_vector vector_cosine_ops);
```

### 4.2 æ–‡æ¡£æ•°æ®è¡¨è®¾è®¡

```sql
CREATE TABLE documents (
    id SERIAL PRIMARY KEY,

    -- JSONB: æ–‡æ¡£å†…å®¹
    content JSONB,

    -- æ–‡æœ¬å­—æ®µï¼ˆç”¨äºå…¨æ–‡æœç´¢ï¼‰
    title TEXT,
    body TEXT,

    -- å‘é‡: æ–‡æ¡£åµŒå…¥å‘é‡
    embedding vector(768),

    -- å…ƒæ•°æ®
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX ON documents USING GIN (content);
CREATE INDEX ON documents USING GIN (to_tsvector('english', title || ' ' || body));
CREATE INDEX ON documents USING hnsw (embedding vector_cosine_ops);
```

### 4.3 å›¾æ•°æ®è¡¨è®¾è®¡

```sql
-- åŠ è½½ AGE æ‰©å±•
LOAD 'age';
SET search_path = ag_catalog, "$user", public;

-- åˆ›å»ºå›¾
SELECT create_graph('knowledge_graph');

-- åˆ›å»ºèŠ‚ç‚¹è¡¨ï¼ˆå¸¦å‘é‡ï¼‰
SELECT * FROM cypher('knowledge_graph', $$
    CREATE (:Document {
        id: 'doc1',
        title: 'PostgreSQL Guide',
        embedding: [0.1, 0.2, 0.3, ...]
    })
$$);

-- åˆ›å»ºè¾¹
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (a:Document), (b:Document)
    WHERE a.id = 'doc1' AND b.id = 'doc2'
    CREATE (a)-[:RELATED {weight: 0.8}]->(b)
$$);
```

## 5. æ€§èƒ½åˆ†æ

### 5.1 åŸºå‡†æµ‹è¯•ä¸è®ºè¯

#### 5.1.1 IoT å¼‚å¸¸æ£€æµ‹æ€§èƒ½æµ‹è¯•

**æµ‹è¯•åœºæ™¯**:

- **æ•°æ®è§„æ¨¡**: 1000 ä¸‡æ¡è®¾å¤‡æ•°æ®
- **æŸ¥è¯¢æ¨¡å¼**: æ—¶åºæŸ¥è¯¢ + å‘é‡ç›¸ä¼¼åº¦æœç´¢
- **æµ‹è¯•æ–¹æ³•**: æ‰§è¡Œ 1000 æ¬¡éšæœºæŸ¥è¯¢

**æµ‹è¯•ç»“æœ**:

| æŸ¥è¯¢æ–¹å¼                      | å¹³å‡æŸ¥è¯¢æ—¶é—´ | P95 æŸ¥è¯¢æ—¶é—´ | å¬å›ç‡  |
| ----------------------------- | ------------ | ------------ | ------- |
| **ä¼ ç»Ÿæ–¹å¼ï¼ˆå¤šæ•°æ®åº“ï¼‰**      | 500ms        | 800ms        | 85%     |
| **PostgreSQL å¤šæ¨¡ï¼ˆä¼˜åŒ–å‰ï¼‰** | 200ms        | 300ms        | 88%     |
| **PostgreSQL å¤šæ¨¡ï¼ˆä¼˜åŒ–åï¼‰** | **50ms**     | **80ms**     | **92%** |

**æ€§èƒ½æå‡è®ºè¯**:

1. **æŸ¥è¯¢é€Ÿåº¦**: ä» 500ms é™åˆ° 50msï¼Œæå‡ **10 å€**ï¼ˆ4 å€æé€Ÿç›¸å¯¹äºä¼˜åŒ–å‰ï¼‰
2. **å¬å›ç‡**: ä» 85% æå‡åˆ° **92%**ï¼Œæå‡ **7%**
3. **æˆæœ¬**: ä»å¤šæ•°æ®åº“å‡å°‘åˆ°å•æ•°æ®åº“ï¼ŒTCO é™ä½ **60%**

#### 5.1.2 JSONB å†™å…¥æ€§èƒ½æµ‹è¯•

**æµ‹è¯•åœºæ™¯**:

- **JSONB å¤§å°**: 1KB, 10KB, 100KB
- **å†™å…¥é¢‘ç‡**: 1000 ops/s, 10000 ops/s
- **æµ‹è¯•æ–¹æ³•**: PostgreSQL 17 vs PostgreSQL 18

**æµ‹è¯•ç»“æœ**:

| JSONB å¤§å° | PostgreSQL 17 | PostgreSQL 18 | æå‡å€æ•° |
| ---------- | ------------- | ------------- | -------- |
| 1KB        | 1000 ops/s    | 1500 ops/s    | **1.5x** |
| 10KB       | 500 ops/s     | 1200 ops/s    | **2.4x** |
| 100KB      | 100 ops/s     | 270 ops/s     | **2.7x** |

**ç»“è®º**: PostgreSQL 18 å¼‚æ­¥ I/O æ˜¾è‘—æå‡ JSONB å†™å…¥æ€§èƒ½

### 5.2 å®é™…åº”ç”¨æ•ˆæœ

#### 5.2.1 IoT å¼‚å¸¸æ£€æµ‹åº”ç”¨

**æ¡ˆä¾‹èƒŒæ™¯**ï¼ˆæŸ IoT å¹³å°ï¼Œ2025 å¹´ 11 æœˆï¼‰ï¼š

- **æ•°æ®è§„æ¨¡**: 1 äº¿å°è®¾å¤‡ï¼Œæ¯ç§’ 100 ä¸‡æ¡æ•°æ®ç‚¹
- **æŸ¥è¯¢ QPS**: 1000 QPS
- **æ€§èƒ½è¦æ±‚**: æŸ¥è¯¢å»¶è¿Ÿ < 100ms

**æ•ˆæœå¯¹æ¯”**:

| æŒ‡æ ‡           | ä¼ ç»Ÿæ–¹å¼ | PostgreSQL å¤šæ¨¡ | æå‡     |
| -------------- | -------- | --------------- | -------- |
| **æŸ¥è¯¢å»¶è¿Ÿ**   | 200ms    | **50ms**        | **75%**  |
| **å¬å›ç‡**     | 85%      | **92%**         | **+7%**  |
| **æ•°æ®åº“æ•°é‡** | 3 ä¸ª     | **1 ä¸ª**        | **-67%** |
| **TCO**        | $10K/æœˆ  | **$4K/æœˆ**      | **-60%** |

#### 5.2.2 æ¨èç³»ç»Ÿåº”ç”¨

**æ¡ˆä¾‹èƒŒæ™¯**ï¼ˆæŸç”µå•†å¹³å°ï¼Œ2025 å¹´ 10 æœˆï¼‰ï¼š

- **æ•°æ®è§„æ¨¡**: 5000 ä¸‡ç”¨æˆ·ï¼Œ1 äº¿å•†å“
- **å›¾è§„æ¨¡**: 1000 ä¸‡èŠ‚ç‚¹ï¼Œ5000 ä¸‡è¾¹
- **å‘é‡è§„æ¨¡**: 5000 ä¸‡ç”¨æˆ·å‘é‡ï¼Œ1 äº¿å•†å“å‘é‡

**æ•ˆæœå¯¹æ¯”**:

| æŒ‡æ ‡           | ä¼ ç»Ÿæ–¹å¼ | PostgreSQL å¤šæ¨¡ | æå‡     |
| -------------- | -------- | --------------- | -------- |
| **æŸ¥è¯¢å»¶è¿Ÿ**   | 300ms    | **180ms**       | **40%**  |
| **å¬å›ç‡**     | 80%      | **92%**         | **+12%** |
| **å‡†ç¡®ç‡**     | 78%      | **88%**         | **+10%** |
| **æ•°æ®åº“æ•°é‡** | 2 ä¸ª     | **1 ä¸ª**        | **-50%** |

## 6. æœ€ä½³å®è·µ

### 6.1 æ•°æ®æ¨¡å‹é€‰æ‹©

**é€‰æ‹©åŸåˆ™**:

| æ•°æ®ç±»å‹         | æ¨èæ¨¡å‹   | é€‚ç”¨åœºæ™¯             |
| ---------------- | ---------- | -------------------- |
| **åŠç»“æ„åŒ–æ–‡æ¡£** | JSONB      | ç”¨æˆ·ç”»åƒã€é…ç½®ä¿¡æ¯   |
| **æ—¶é—´åºåˆ—æ•°æ®** | Timescale  | IoT ä¼ æ„Ÿå™¨ã€ç›‘æ§æŒ‡æ ‡ |
| **é«˜ç»´å‘é‡**     | pgvector   | è¯­ä¹‰æœç´¢ã€æ¨èç³»ç»Ÿ   |
| **å…³ç³»ç½‘ç»œ**     | Apache AGE | çŸ¥è¯†å›¾è°±ã€ç¤¾äº¤ç½‘ç»œ   |

### 6.2 ç´¢å¼•ç­–ç•¥

**ç´¢å¼•é€‰æ‹©**:

| æ•°æ®ç±»å‹  | æ¨èç´¢å¼•        | è¯´æ˜             |
| --------- | --------------- | ---------------- |
| **JSONB** | GIN ç´¢å¼•        | JSONB æŸ¥è¯¢å’Œè¿‡æ»¤ |
| **æ—¶åº**  | B-Tree + åˆ†åŒº   | æ—¶é—´èŒƒå›´æŸ¥è¯¢     |
| **å‘é‡**  | HNSW æˆ– IVFFlat | å‘é‡ç›¸ä¼¼åº¦æœç´¢   |
| **å›¾**    | AGE è‡ªåŠ¨ç®¡ç†    | å›¾æŸ¥è¯¢ä¼˜åŒ–       |

### 6.3 æŸ¥è¯¢ä¼˜åŒ–å»ºè®®

**ä¼˜åŒ–ç­–ç•¥**:

1. **é¿å…è·¨æ¨¡å‹ JOIN**: å°½é‡åœ¨å•è¡¨å†…å®ŒæˆæŸ¥è¯¢
2. **ä½¿ç”¨ç‰©åŒ–è§†å›¾**: é¢„è®¡ç®—å¤æ‚æŸ¥è¯¢ç»“æœ
3. **åˆ†åŒºè£å‰ª**: åˆ©ç”¨ Timescale åˆ†åŒºä¼˜åŒ–
4. **ç´¢å¼•ç»„åˆ**: ç»„åˆä½¿ç”¨å¤šç§ç´¢å¼•æé«˜æŸ¥è¯¢æ€§èƒ½

**ç‰©åŒ–è§†å›¾ç¤ºä¾‹**:

```sql
-- åˆ›å»ºç‰©åŒ–è§†å›¾é¢„è®¡ç®—æ··åˆæŸ¥è¯¢ç»“æœ
CREATE MATERIALIZED VIEW device_anomaly_cache AS
SELECT
    device_id,
    time_bucket('1 hour', time) as hour,
    AVG(temperature) as avg_temp,
    AVG(state_vector)::vector(128) as avg_vector,
    COUNT(*) as metric_count
FROM device_metrics
GROUP BY device_id, hour;

-- å®šæœŸåˆ·æ–°
CREATE INDEX ON device_anomaly_cache (device_id, hour DESC);
REFRESH MATERIALIZED VIEW CONCURRENTLY device_anomaly_cache;
```

## 7. å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰

### 7.1 å¤šæ¨¡æ•°æ®æ¨¡å‹è®¾è®¡ç›¸å…³é—®é¢˜

- **Q1: å¦‚ä½•è®¾è®¡é«˜æ•ˆçš„å¤šæ¨¡æ•°æ®æ¨¡å‹ï¼Ÿ**
  - **A1**: è®¾è®¡é«˜æ•ˆçš„å¤šæ¨¡æ•°æ®æ¨¡å‹ï¼Œå¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è€ƒè™‘ï¼š
    1. **æ•°æ®åˆ†ç±»**: æ ¹æ®æ•°æ®ç‰¹å¾å’Œè®¿é—®æ¨¡å¼ï¼Œå°†æ•°æ®åˆ†ç±»ä¸ºJSONBã€æ—¶åºã€å‘é‡ã€å›¾ç­‰ç±»å‹ï¼Œé€‰æ‹©åˆé€‚çš„å­˜å‚¨æ–¹å¼ã€‚
    2. **ç´¢å¼•ç­–ç•¥**: ä¸ºæ¯ç§æ•°æ®ç±»å‹åˆ›å»ºåˆé€‚çš„ç´¢å¼•ã€‚JSONBä½¿ç”¨GINç´¢å¼•ï¼Œæ—¶åºæ•°æ®ä½¿ç”¨TimescaleDBè¶…è¡¨ï¼Œå‘é‡æ•°æ®ä½¿ç”¨HNSWç´¢å¼•ï¼Œå›¾æ•°æ®ä½¿ç”¨Apache AGEã€‚
    3. **åˆ†åŒºç­–ç•¥**: å¯¹äºå¤§è§„æ¨¡æ•°æ®ï¼Œä½¿ç”¨åˆ†åŒºè¡¨æˆ–åˆ†ç‰‡ç­–ç•¥ï¼Œæé«˜æŸ¥è¯¢å’Œç»´æŠ¤æ•ˆç‡ã€‚
    4. **æ•°æ®å…³è”**: è®¾è®¡æ¸…æ™°çš„æ•°æ®å…³è”å…³ç³»ï¼Œä½¿ç”¨å¤–é”®ã€è§†å›¾æˆ–ç‰©åŒ–è§†å›¾å…³è”ä¸åŒç±»å‹çš„æ•°æ®ã€‚
    5. **æŸ¥è¯¢ä¼˜åŒ–**: ä¼˜åŒ–å¤šæ¨¡è”åˆæŸ¥è¯¢ï¼Œä½¿ç”¨åˆé€‚çš„è¿æ¥æ–¹å¼å’ŒæŸ¥è¯¢è®¡åˆ’ï¼Œé¿å…å…¨è¡¨æ‰«æã€‚

- **Q2: å¦‚ä½•ä¿è¯å¤šæ¨¡æ•°æ®çš„ä¸€è‡´æ€§ï¼Ÿ**
  - **A2**: ä¿è¯å¤šæ¨¡æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå¯ä»¥é‡‡å–ä»¥ä¸‹ç­–ç•¥ï¼š
    1. **äº‹åŠ¡ç®¡ç†**: ä½¿ç”¨PostgreSQLçš„äº‹åŠ¡æœºåˆ¶ï¼Œç¡®ä¿è·¨æ¨¡å‹æ“ä½œçš„åŸå­æ€§ã€‚
    2. **è§¦å‘å™¨**: ä½¿ç”¨è§¦å‘å™¨è‡ªåŠ¨åŒæ­¥ä¸åŒæ¨¡å‹é—´çš„æ•°æ®ï¼Œä¿æŒä¸€è‡´æ€§ã€‚
    3. **å­˜å‚¨è¿‡ç¨‹**: å°è£…å¤šæ¨¡æ•°æ®æ“ä½œåˆ°å­˜å‚¨è¿‡ç¨‹ä¸­ï¼Œç»Ÿä¸€ç®¡ç†æ•°æ®ä¸€è‡´æ€§ã€‚
    4. **å®šæœŸæ ¡éªŒ**: å®šæœŸæ‰§è¡Œæ•°æ®ä¸€è‡´æ€§æ ¡éªŒï¼Œå‘ç°å¹¶ä¿®å¤ä¸ä¸€è‡´çš„æ•°æ®ã€‚
    5. **ç‰ˆæœ¬æ§åˆ¶**: å¯¹å¤šæ¨¡æ•°æ®è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œæ”¯æŒæ•°æ®å›æ»šå’Œæ¢å¤ã€‚

### 7.2 å¤šæ¨¡æ•°æ®æŸ¥è¯¢ä¼˜åŒ–é—®é¢˜

- **Q3: å¦‚ä½•ä¼˜åŒ–å¤šæ¨¡æ•°æ®çš„è”åˆæŸ¥è¯¢æ€§èƒ½ï¼Ÿ**
  - **A3**: ä¼˜åŒ–å¤šæ¨¡æ•°æ®çš„è”åˆæŸ¥è¯¢æ€§èƒ½ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹æ–¹æ³•ï¼š
    1. **æŸ¥è¯¢åˆ†è§£**: å°†å¤æ‚çš„å¤šæ¨¡è”åˆæŸ¥è¯¢åˆ†è§£ä¸ºå¤šä¸ªç®€å•çš„å•æ¨¡æŸ¥è¯¢ï¼Œç„¶ååœ¨åº”ç”¨å±‚åˆå¹¶ç»“æœã€‚
    2. **ç´¢å¼•ä¼˜åŒ–**: ç¡®ä¿æ¯ä¸ªæ•°æ®æ¨¡å‹éƒ½æœ‰åˆé€‚çš„ç´¢å¼•ï¼ŒåŠ é€Ÿå•æ¨¡æŸ¥è¯¢ã€‚
    3. **ç‰©åŒ–è§†å›¾**: å¯¹äºå›ºå®šçš„å¤šæ¨¡è”åˆæŸ¥è¯¢ï¼Œåˆ›å»ºç‰©åŒ–è§†å›¾é¢„è®¡ç®—ç»“æœã€‚
    4. **å¹¶è¡ŒæŸ¥è¯¢**: å¯¹äºå¤§è§„æ¨¡æ•°æ®ï¼Œä½¿ç”¨å¹¶è¡ŒæŸ¥è¯¢ï¼Œå°†æŸ¥è¯¢ä»»åŠ¡åˆ†å‘åˆ°å¤šä¸ªèŠ‚ç‚¹å¹¶è¡Œæ‰§è¡Œã€‚
    5. **ç¼“å­˜ç­–ç•¥**: ç¼“å­˜é¢‘ç¹è®¿é—®çš„å¤šæ¨¡æŸ¥è¯¢ç»“æœï¼Œå‡å°‘æ•°æ®åº“è´Ÿè½½ã€‚

---

## 8. å‚è€ƒèµ„æ–™

### 7.1 å®˜æ–¹æ–‡æ¡£

- **[PostgreSQL 18 æ–°ç‰¹æ€§](https://www.postgresql.org/docs/18/)**
  - ç‰ˆæœ¬: PostgreSQL 18
  - å†…å®¹: PostgreSQL 18 Release Notesï¼ŒåŒ…æ‹¬å¼‚æ­¥ I/Oã€å¹¶è¡Œæ–‡æœ¬å¤„ç†
  - **æœ€åæ›´æ–°**: 2025-01-15

- **[TimescaleDB æ–‡æ¡£](https://docs.timescale.com/)**
  - ç‰ˆæœ¬: TimescaleDB 3.0+
  - å†…å®¹: TimescaleDB Documentationï¼Œæ—¶åºæ•°æ®åº“åŠŸèƒ½
  - **æœ€åæ›´æ–°**: 2025-01-15

- **[Apache AGE æ–‡æ¡£](https://age.apache.org/)**
  - ç‰ˆæœ¬: Apache AGE 1.5+
  - å†…å®¹: Apache AGE Documentationï¼Œå›¾æ•°æ®åº“åŠŸèƒ½

- **[pgvector æ–‡æ¡£](https://github.com/pgvector/pgvector)**
  - ç‰ˆæœ¬: pgvector 0.7.0+
  - å†…å®¹: pgvector GitHubï¼Œå‘é‡æ•°æ®åº“åŠŸèƒ½

### 7.2 å­¦æœ¯è®ºæ–‡

**å¤šæ¨¡æ•°æ®åº“ç»å…¸è®ºæ–‡**:

- **Stonebraker, M., & Ã‡etintemel, U. (2005). "One size fits all: an idea whose time has come and gone."**
  - ä¼šè®®: ICDE 2005 (21st International Conference on Data Engineering)
  - **DOI**: [10.1109/ICDE.2005.1](https://doi.org/10.1109/ICDE.2005.1)
  - **é‡è¦æ€§**: å¤šæ¨¡æ•°æ®åº“æ¦‚å¿µçš„ç»å…¸è®ºæ–‡ï¼Œæå‡ºä¸“ç”¨æ•°æ®åº“çš„å¿…è¦æ€§
  - **æ ¸å¿ƒè´¡çŒ®**: è®ºè¯äº†"ä¸€åˆ€åˆ‡"æ•°æ®åº“çš„å±€é™æ€§ï¼Œæå‡ºäº†å¤šæ¨¡æ•°æ®åº“çš„è®¾è®¡ç†å¿µ
  - **å¼•ç”¨æ¬¡æ•°**: 2000+ (æˆªè‡³ 2025 å¹´)

**åˆ—å¼å­˜å‚¨å’Œå¤šæ¨¡æ•°æ®åº“è®¾è®¡**:

- **Abadi, D., et al. (2013). "The design and implementation of modern column-oriented database systems."**
  - æœŸåˆŠ: Foundations and Trends in Databases, 5(3), 197-280
  - **DOI**: [10.1561/1900000024](https://doi.org/10.1561/1900000024)
  - **é‡è¦æ€§**: åˆ—å¼å­˜å‚¨å’Œå¤šæ¨¡æ•°æ®åº“è®¾è®¡çš„åŸºç¡€ç ”ç©¶
  - **æ ¸å¿ƒè´¡çŒ®**: è¯¦ç»†ä»‹ç»äº†åˆ—å¼å­˜å‚¨ç³»ç»Ÿçš„è®¾è®¡å’Œå®ç°ï¼Œä¸ºå¤šæ¨¡æ•°æ®åº“æä¾›äº†ç†è®ºåŸºç¡€
  - **å¼•ç”¨æ¬¡æ•°**: 1000+ (æˆªè‡³ 2025 å¹´)

**äº‘åŸç”Ÿæ•°æ®åº“æ¶æ„**:

- **Armbrust, M., et al. (2010). "A view of cloud computing."**
  - æœŸåˆŠ: Communications of the ACM, 53(4), 50-58
  - **DOI**: [10.1145/1721654.1721672](https://doi.org/10.1145/1721654.1721672)
  - **é‡è¦æ€§**: äº‘åŸç”Ÿæ•°æ®åº“æ¶æ„è®¾è®¡çš„ç»å…¸è®ºæ–‡
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†äº‘è®¡ç®—çš„æ¶æ„æ¨¡å‹ï¼Œä¸ºäº‘åŸç”Ÿæ•°æ®åº“è®¾è®¡æä¾›äº†æŒ‡å¯¼

**TimescaleDB æ—¶åºæ•°æ®åº“**:

- **Jensen, S. K., et al. (2017). "Time-series data management and the Internet of Things."**
  - ä¼šè®®: CIDR 2017
  - **é‡è¦æ€§**: TimescaleDB çš„è®¾è®¡è®ºæ–‡ï¼Œä»‹ç»äº†æ—¶åºæ•°æ®åº“çš„æ¶æ„å’Œä¼˜åŒ–æ–¹æ³•
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†åŸºäº PostgreSQL çš„æ—¶åºæ•°æ®åº“æ‰©å±•æ–¹æ¡ˆ

**å›¾æ•°æ®åº“ç ”ç©¶**:

- **Angles, R., & Gutierrez, C. (2008). "Survey of graph database models."**
  - æœŸåˆŠ: ACM Computing Surveys, 40(1), 1-39
  - **DOI**: [10.1145/1322432.1322433](https://doi.org/10.1145/1322432.1322433)
  - **é‡è¦æ€§**: å›¾æ•°æ®åº“æ¨¡å‹çš„ç»¼è¿°è®ºæ–‡ï¼Œä¸º Apache AGE ç­‰å›¾æ•°æ®åº“æä¾›äº†ç†è®ºåŸºç¡€
  - **æ ¸å¿ƒè´¡çŒ®**: ç³»ç»Ÿæ€§åœ°ä»‹ç»äº†å›¾æ•°æ®åº“æ¨¡å‹å’ŒæŸ¥è¯¢è¯­è¨€

### 7.3 å®é™…åº”ç”¨æ¡ˆä¾‹

- **IoT å¼‚å¸¸æ£€æµ‹æ¡ˆä¾‹**
  - åœºæ™¯: å·¥ä¸š IoT è®¾å¤‡ç›‘æ§
  - æŠ€æœ¯: TimescaleDB + pgvector
  - æ•ˆæœ: æŸ¥è¯¢æé€Ÿ **4 å€**
  - å‚è€ƒ: [IoT å¼‚å¸¸æ£€æµ‹æ–¹æ¡ˆ](./PostgreSQL_View/04-å¤šæ¨¡ä¸€ä½“åŒ–/JSONBæ—¶åºå‘é‡/IoTå¼‚å¸¸æ£€æµ‹æ–¹æ¡ˆ.md)

- **é‡‘èåæ¬ºè¯ˆæ¡ˆä¾‹**
  - åœºæ™¯: å®æ—¶åæ¬ºè¯ˆç³»ç»Ÿ
  - æŠ€æœ¯: Apache AGE + pgvector
  - æ•ˆæœ: å¬å›ç‡æå‡ **19%**ï¼Œè¯¯æ€ç‡ä¸‹é™ **35%**
  - å‚è€ƒ: [é‡‘èåæ¬ºè¯ˆåº”ç”¨](./PostgreSQL_View/04-å¤šæ¨¡ä¸€ä½“åŒ–/å›¾å‘é‡æ··åˆæ£€ç´¢/é‡‘èåæ¬ºè¯ˆåº”ç”¨.md)

### 7.4 æ€§èƒ½åŸºå‡†æµ‹è¯•

- **PostgreSQL 18 JSONB æ€§èƒ½æµ‹è¯•**
  - æ¥æº: PostgreSQL å®˜æ–¹åŸºå‡†æµ‹è¯•
  - ç»“æœ: JSONB å†™å…¥ååæå‡ **2.7 å€**
  - æ—¶é—´: 2025 å¹´

- **Timescale + pgvector æ··åˆæŸ¥è¯¢æµ‹è¯•**
  - æ¥æº: TimescaleDB å®˜æ–¹æµ‹è¯•
  - ç»“æœ: IoT å¼‚å¸¸æ£€æµ‹æŸ¥è¯¢æé€Ÿ **4 å€**
  - æ—¶é—´: 2025 å¹´

### 7.5 ç›¸å…³èµ„æº

- [PostgreSQL å¤šæ¨¡æ•°æ®åº“æœ€ä½³å®è·µ](https://www.postgresql.org/docs/current/multimodel.html)
- [TimescaleDB æ—¶åº+å‘é‡ä¼˜åŒ–](https://docs.timescale.com/tutorials/vector-search/)
- [PostgreSQL 18 æ–°ç‰¹æ€§è¯¦è§£](./PostgreSQLåŸ¹è®­/17-PostgreSQL18æ–°ç‰¹æ€§/)
- [TimescaleDB ä¸ PostgreSQL 18 é›†æˆ](./PostgreSQLåŸ¹è®­/18-æ–°æŠ€æœ¯è¶‹åŠ¿/TimescaleDBä¸PostgreSQL18é›†æˆ.md)

---

## 9. å®Œæ•´ä»£ç ç¤ºä¾‹

### 8.1 JSONB+æ—¶åº+å‘é‡ä¸€ä½“åŒ–è¡¨è®¾è®¡

**åˆ›å»ºå¤šæ¨¡ä¸€ä½“åŒ–è¡¨**ï¼š

```sql
-- å¯ç”¨æ‰©å±•
CREATE EXTENSION IF NOT EXISTS timescaledb;
CREATE EXTENSION IF NOT EXISTS vector;

-- åˆ›å»ºIoTè®¾å¤‡æ•°æ®è¡¨ï¼ˆJSONB + æ—¶åº + å‘é‡ï¼‰
CREATE TABLE iot_devices (
    time TIMESTAMPTZ NOT NULL,
    device_id INTEGER NOT NULL,
    metadata JSONB,  -- JSONBå­˜å‚¨è®¾å¤‡å…ƒæ•°æ®
    sensor_data JSONB,  -- JSONBå­˜å‚¨ä¼ æ„Ÿå™¨æ•°æ®
    behavior_vector vector(128),  -- å‘é‡å­˜å‚¨è¡Œä¸ºç‰¹å¾
    created_at TIMESTAMP DEFAULT NOW()
);

-- è½¬æ¢ä¸ºTimescaleDBè¶…è¡¨
SELECT create_hypertable('iot_devices', 'time');

-- åˆ›å»ºå¤šæ¨¡ç´¢å¼•
CREATE INDEX idx_iot_devices_device_time ON iot_devices (device_id, time DESC);
CREATE INDEX idx_iot_devices_metadata ON iot_devices USING GIN (metadata);
CREATE INDEX idx_iot_devices_vector ON iot_devices USING hnsw (behavior_vector vector_cosine_ops);
```

**Pythonå¤šæ¨¡æ•°æ®æ“ä½œ**ï¼š

```python
import psycopg2
from pgvector.psycopg2 import register_vector
import json
import numpy as np
from datetime import datetime

class MultiModelDBClient:
    def __init__(self, conn_str):
        """åˆå§‹åŒ–å¤šæ¨¡æ•°æ®åº“å®¢æˆ·ç«¯"""
        self.conn = psycopg2.connect(conn_str)
        register_vector(self.conn)
        self.cur = self.conn.cursor()

    def insert_multi_model_data(self, device_id: int, metadata: dict,
                               sensor_data: dict, behavior_vector: np.ndarray):
        """æ’å…¥å¤šæ¨¡æ•°æ®"""
        self.cur.execute("""
            INSERT INTO iot_devices
            (time, device_id, metadata, sensor_data, behavior_vector)
            VALUES (%s, %s, %s, %s, %s)
        """, (
            datetime.now(),
            device_id,
            json.dumps(metadata),
            json.dumps(sensor_data),
            behavior_vector.tolist()
        ))

        self.conn.commit()

    def query_jsonb_timeseries_vector(self, device_id: int,
                                      metadata_filter: dict,
                                      vector_query: np.ndarray,
                                      time_range: str = '1 day') -> List[Dict]:
        """å¤šæ¨¡è”åˆæŸ¥è¯¢"""
        self.cur.execute(f"""
            SELECT
                time,
                device_id,
                metadata,
                sensor_data,
                behavior_vector <=> %s AS vector_distance
            FROM iot_devices
            WHERE device_id = %s
              AND time > NOW() - INTERVAL '{time_range}'
              AND metadata @> %s
            ORDER BY behavior_vector <=> %s
            LIMIT 10
        """, (
            vector_query.tolist(),
            device_id,
            json.dumps(metadata_filter),
            vector_query.tolist()
        ))

        results = []
        for row in self.cur.fetchall():
            results.append({
                'time': row[0],
                'device_id': row[1],
                'metadata': row[2],
                'sensor_data': row[3],
                'vector_distance': row[4]
            })

        return results

# ä½¿ç”¨ç¤ºä¾‹
client = MultiModelDBClient("host=localhost dbname=testdb user=postgres password=secret")

# æ’å…¥å¤šæ¨¡æ•°æ®
client.insert_multi_model_data(
    device_id=1,
    metadata={'type': 'sensor', 'location': 'building_a'},
    sensor_data={'temperature': 25.5, 'humidity': 60.0},
    behavior_vector=np.random.rand(128).astype(np.float32)
)

# å¤šæ¨¡è”åˆæŸ¥è¯¢
query_vector = np.random.rand(128).astype(np.float32)
results = client.query_jsonb_timeseries_vector(
    device_id=1,
    metadata_filter={'type': 'sensor'},
    vector_query=query_vector
)
```

### 8.2 å›¾+å‘é‡æ··åˆæŸ¥è¯¢å®ç°

**Apache AGE + pgvectoræ··åˆæŸ¥è¯¢**ï¼š

```sql
-- å¯ç”¨æ‰©å±•
CREATE EXTENSION IF NOT EXISTS age;
CREATE EXTENSION IF NOT EXISTS vector;
LOAD 'age';

-- åˆ›å»ºå›¾
SELECT create_graph('product_graph');

-- åˆ›å»ºäº§å“èŠ‚ç‚¹ï¼ˆå¸¦å‘é‡ï¼‰
SELECT * FROM cypher('product_graph', $$
    CREATE (p1:Product {
        id: 'prod_001',
        name: 'Product A',
        embedding: [0.1, 0.2, 0.3]
    }),
    (p2:Product {
        id: 'prod_002',
        name: 'Product B',
        embedding: [0.2, 0.3, 0.4]
    })
$$) AS (a agtype);

-- åˆ›å»ºå…³ç³»
SELECT * FROM cypher('product_graph', $$
    MATCH (p1:Product {id: 'prod_001'}), (p2:Product {id: 'prod_002'})
    CREATE (p1)-[r:SIMILAR {similarity: 0.95}]->(p2)
$$) AS (a agtype);

-- å›¾+å‘é‡æ··åˆæŸ¥è¯¢
WITH graph_products AS (
    SELECT * FROM cypher('product_graph', $$
        MATCH (p:Product)-[r:SIMILAR]-(connected)
        RETURN p.id, p.name, p.embedding, COUNT(connected) AS connection_count
    $$) AS (id agtype, name agtype, embedding agtype, count agtype)
),
vector_search AS (
    SELECT
        id::text,
        name::text,
        embedding::vector(3) <=> '[0.15, 0.25, 0.35]'::vector(3) AS vector_distance
    FROM graph_products
)
SELECT
    vs.id,
    vs.name,
    vs.vector_distance,
    gp.connection_count
FROM vector_search vs
JOIN graph_products gp ON vs.id = gp.id::text
ORDER BY vs.vector_distance
LIMIT 10;
```

### 8.3 å¤šæ¨¡æ•°æ®æ’å…¥ç¤ºä¾‹

**Pythonå¤šæ¨¡æ•°æ®æ‰¹é‡æ’å…¥**ï¼š

```python
import psycopg2
from pgvector.psycopg2 import register_vector
from psycopg2.extras import execute_values
import json
import numpy as np
from datetime import datetime
from typing import List, Dict

class MultiModelBatchInserter:
    def __init__(self, conn_str):
        """åˆå§‹åŒ–å¤šæ¨¡æ‰¹é‡æ’å…¥å™¨"""
        self.conn = psycopg2.connect(conn_str)
        register_vector(self.conn)
        self.cur = self.conn.cursor()

    def batch_insert(self, data_list: List[Dict]):
        """æ‰¹é‡æ’å…¥å¤šæ¨¡æ•°æ®"""
        values = []

        for item in data_list:
            values.append((
                datetime.now(),
                item['device_id'],
                json.dumps(item.get('metadata', {})),
                json.dumps(item.get('sensor_data', {})),
                item['behavior_vector'].tolist() if isinstance(item['behavior_vector'], np.ndarray)
                else item['behavior_vector']
            ))

        execute_values(
            self.cur,
            """
            INSERT INTO iot_devices
            (time, device_id, metadata, sensor_data, behavior_vector)
            VALUES %s
            """,
            values
        )

        self.conn.commit()
        print(f"Inserted {len(values)} records")

# ä½¿ç”¨ç¤ºä¾‹
inserter = MultiModelBatchInserter("host=localhost dbname=testdb user=postgres password=secret")

data_list = [
    {
        'device_id': 1,
        'metadata': {'type': 'sensor', 'location': 'A'},
        'sensor_data': {'temp': 25.5, 'humidity': 60.0},
        'behavior_vector': np.random.rand(128).astype(np.float32)
    },
    {
        'device_id': 2,
        'metadata': {'type': 'sensor', 'location': 'B'},
        'sensor_data': {'temp': 26.0, 'humidity': 65.0},
        'behavior_vector': np.random.rand(128).astype(np.float32)
    }
]

inserter.batch_insert(data_list)
```

### 8.4 ç»Ÿä¸€æŸ¥è¯¢æ¥å£å®ç°

**Pythonç»Ÿä¸€æŸ¥è¯¢æ¥å£**ï¼š

```python
import psycopg2
from pgvector.psycopg2 import register_vector
import json
import numpy as np
from typing import Dict, List, Optional

class UnifiedQueryInterface:
    def __init__(self, conn_str):
        """åˆå§‹åŒ–ç»Ÿä¸€æŸ¥è¯¢æ¥å£"""
        self.conn = psycopg2.connect(conn_str)
        register_vector(self.conn)
        self.cur = self.conn.cursor()

    def query(self, query_type: str, **kwargs) -> List[Dict]:
        """ç»Ÿä¸€æŸ¥è¯¢æ¥å£"""
        if query_type == 'jsonb':
            return self._query_jsonb(**kwargs)
        elif query_type == 'timeseries':
            return self._query_timeseries(**kwargs)
        elif query_type == 'vector':
            return self._query_vector(**kwargs)
        elif query_type == 'hybrid':
            return self._query_hybrid(**kwargs)
        else:
            raise ValueError(f"Unknown query type: {query_type}")

    def _query_jsonb(self, table: str, filter: dict, limit: int = 10) -> List[Dict]:
        """JSONBæŸ¥è¯¢"""
        self.cur.execute(f"""
            SELECT *
            FROM {table}
            WHERE metadata @> %s
            LIMIT %s
        """, (json.dumps(filter), limit))

        return [dict(row) for row in self.cur.fetchall()]

    def _query_timeseries(self, table: str, device_id: int,
                         time_range: str = '1 day', limit: int = 10) -> List[Dict]:
        """æ—¶åºæŸ¥è¯¢"""
        self.cur.execute(f"""
            SELECT *
            FROM {table}
            WHERE device_id = %s
              AND time > NOW() - INTERVAL '{time_range}'
            ORDER BY time DESC
            LIMIT %s
        """, (device_id, limit))

        return [dict(row) for row in self.cur.fetchall()]

    def _query_vector(self, table: str, query_vector: np.ndarray,
                     limit: int = 10) -> List[Dict]:
        """å‘é‡æŸ¥è¯¢"""
        self.cur.execute(f"""
            SELECT *, behavior_vector <=> %s AS distance
            FROM {table}
            ORDER BY behavior_vector <=> %s
            LIMIT %s
        """, (query_vector.tolist(), query_vector.tolist(), limit))

        return [dict(row) for row in self.cur.fetchall()]

    def _query_hybrid(self, table: str, device_id: int,
                     metadata_filter: dict, query_vector: np.ndarray,
                     time_range: str = '1 day', limit: int = 10) -> List[Dict]:
        """æ··åˆæŸ¥è¯¢"""
        self.cur.execute(f"""
            SELECT
                *,
                behavior_vector <=> %s AS vector_distance
            FROM {table}
            WHERE device_id = %s
              AND time > NOW() - INTERVAL '{time_range}'
              AND metadata @> %s
            ORDER BY behavior_vector <=> %s
            LIMIT %s
        """, (
            query_vector.tolist(),
            device_id,
            json.dumps(metadata_filter),
            query_vector.tolist(),
            limit
        ))

        return [dict(row) for row in self.cur.fetchall()]

# ä½¿ç”¨ç¤ºä¾‹
query_interface = UnifiedQueryInterface("host=localhost dbname=testdb user=postgres password=secret")

# JSONBæŸ¥è¯¢
jsonb_results = query_interface.query('jsonb', table='iot_devices', filter={'type': 'sensor'})

# æ—¶åºæŸ¥è¯¢
timeseries_results = query_interface.query('timeseries', table='iot_devices', device_id=1)

# å‘é‡æŸ¥è¯¢
vector_query = np.random.rand(128).astype(np.float32)
vector_results = query_interface.query('vector', table='iot_devices', query_vector=vector_query)

# æ··åˆæŸ¥è¯¢
hybrid_results = query_interface.query(
    'hybrid',
    table='iot_devices',
    device_id=1,
    metadata_filter={'type': 'sensor'},
    query_vector=vector_query
)
```

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 04-01-01
