# PostgreSQLæ•°æ®æ¨¡å‹è®¾è®¡æ­£åç¤ºä¾‹ä¸å¤šç»´åˆ†æ

> **PostgreSQLç‰ˆæœ¬**: 17+/18+
> **é€‚ç”¨åœºæ™¯**: æ•°æ®æ¨¡å‹è®¾è®¡ã€æ•°æ®åº“è®¾è®¡ã€ç³»ç»Ÿæ¶æ„
> **éš¾åº¦ç­‰çº§**: â­â­â­â­ é«˜çº§
> **æœ€åæ›´æ–°**: 2025å¹´1æœˆ

---

## ğŸ“‘ ç›®å½•

- [ç¤ºä¾‹1ï¼šå…³ç³»æ¨¡å‹è®¾è®¡ï¼ˆç”µå•†ç³»ç»Ÿï¼‰](#ç¤ºä¾‹1å…³ç³»æ¨¡å‹è®¾è®¡ç”µå•†ç³»ç»Ÿ)
- [ç¤ºä¾‹2ï¼šæ–‡æ¡£æ¨¡å‹è®¾è®¡ï¼ˆå†…å®¹ç®¡ç†ç³»ç»Ÿï¼‰](#ç¤ºä¾‹2æ–‡æ¡£æ¨¡å‹è®¾è®¡å†…å®¹ç®¡ç†ç³»ç»Ÿ)
- [ç¤ºä¾‹3ï¼šæ—¶åºæ¨¡å‹è®¾è®¡ï¼ˆç›‘æ§ç³»ç»Ÿï¼‰](#ç¤ºä¾‹3æ—¶åºæ¨¡å‹è®¾è®¡ç›‘æ§ç³»ç»Ÿ)
- [ç¤ºä¾‹4ï¼šæ··åˆæ¨¡å‹è®¾è®¡ï¼ˆå¤šç§Ÿæˆ·ç³»ç»Ÿï¼‰](#ç¤ºä¾‹4æ··åˆæ¨¡å‹è®¾è®¡å¤šç§Ÿæˆ·ç³»ç»Ÿ)
- [åä¾‹1ï¼šè¿‡åº¦èŒƒå¼åŒ–è®¾è®¡](#åä¾‹1è¿‡åº¦èŒƒå¼åŒ–è®¾è®¡)
- [åä¾‹2ï¼šè¿‡åº¦åèŒƒå¼åŒ–è®¾è®¡](#åä¾‹2è¿‡åº¦åèŒƒå¼åŒ–è®¾è®¡)
- [åä¾‹3ï¼šç¼ºå°‘çº¦æŸè®¾è®¡](#åä¾‹3ç¼ºå°‘çº¦æŸè®¾è®¡)
- [åä¾‹4ï¼šæ•°æ®ç±»å‹é€‰æ‹©ä¸å½“](#åä¾‹4æ•°æ®ç±»å‹é€‰æ‹©ä¸å½“)
- [åä¾‹5ï¼šç´¢å¼•è®¾è®¡ç¼ºå¤±](#åä¾‹5ç´¢å¼•è®¾è®¡ç¼ºå¤±)
- [ç»´åº¦1ï¼šæ•°æ®ä¸€è‡´æ€§ç»´åº¦](#ç»´åº¦1æ•°æ®ä¸€è‡´æ€§ç»´åº¦)
- [ç»´åº¦2ï¼šæŸ¥è¯¢æ€§èƒ½ç»´åº¦](#ç»´åº¦2æŸ¥è¯¢æ€§èƒ½ç»´åº¦)
- [ç»´åº¦3ï¼šå­˜å‚¨æ•ˆç‡ç»´åº¦](#ç»´åº¦3å­˜å‚¨æ•ˆç‡ç»´åº¦)
- [ç»´åº¦4ï¼šç»´æŠ¤å¤æ‚åº¦ç»´åº¦](#ç»´åº¦4ç»´æŠ¤å¤æ‚åº¦ç»´åº¦)
- [è¯æ˜1ï¼šç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰çš„æ­£ç¡®æ€§è¯æ˜](#è¯æ˜1ç¬¬ä¸‰èŒƒå¼3nfçš„æ­£ç¡®æ€§è¯æ˜)
- [è¯æ˜2ï¼šBCNFçš„æ­£ç¡®æ€§è¯æ˜](#è¯æ˜2bcnfçš„æ­£ç¡®æ€§è¯æ˜)
- [è¯æ˜3ï¼šåèŒƒå¼åŒ–è®¾è®¡çš„æ€§èƒ½ä¼˜åŠ¿è¯æ˜](#è¯æ˜3åèŒƒå¼åŒ–è®¾è®¡çš„æ€§èƒ½ä¼˜åŠ¿è¯æ˜)
---

## ğŸ“Š çŸ¥è¯†ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((æ•°æ®æ¨¡å‹è®¾è®¡))
    æ•°æ®æ¨¡å‹ç±»å‹
      å…³ç³»æ¨¡å‹
        è¡¨ç»“æ„
        ä¸»é”®å¤–é”®
        èŒƒå¼åŒ–
        å…³ç³»å®Œæ•´æ€§
      æ–‡æ¡£æ¨¡å‹
        JSONB
        åµŒå¥—ç»“æ„
        çµæ´»Schema
        æŸ¥è¯¢ä¼˜åŒ–
      æ—¶åºæ¨¡å‹
        æ—¶é—´åºåˆ—
        åˆ†åŒºç­–ç•¥
        BRINç´¢å¼•
        å‹ç¼©ä¼˜åŒ–
      å›¾æ¨¡å‹
        èŠ‚ç‚¹è¾¹
        å›¾éå†
        è·¯å¾„æŸ¥è¯¢
        å›¾ç®—æ³•
      åˆ—å­˜å‚¨æ¨¡å‹
        åˆ—å¼å­˜å‚¨
        å‹ç¼©ä¼˜åŒ–
        åˆ†ææŸ¥è¯¢
        æ··åˆå­˜å‚¨
    è®¾è®¡åŸåˆ™
      èŒƒå¼åŒ–è®¾è®¡
        ç¬¬ä¸€èŒƒå¼1NF
        ç¬¬äºŒèŒƒå¼2NF
        ç¬¬ä¸‰èŒƒå¼3NF
        BCNF
        ç¬¬å››èŒƒå¼4NF
      åèŒƒå¼åŒ–è®¾è®¡
        æ€§èƒ½ä¼˜åŒ–
        æŸ¥è¯¢ç®€åŒ–
        å†—ä½™è®¾è®¡
        ç‰©åŒ–è§†å›¾
      æ•°æ®å®Œæ•´æ€§
        å®ä½“å®Œæ•´æ€§
        å‚ç…§å®Œæ•´æ€§
        ç”¨æˆ·å®šä¹‰å®Œæ•´æ€§
        çº¦æŸè®¾è®¡
    è®¾è®¡å±‚æ¬¡
      æ¦‚å¿µè®¾è®¡
        ERæ¨¡å‹
        å®ä½“è¯†åˆ«
        å…³ç³»è¯†åˆ«
        å±æ€§å®šä¹‰
      é€»è¾‘è®¾è®¡
        å…³ç³»æ¨¡å¼
        èŒƒå¼åŒ–
        å®Œæ•´æ€§çº¦æŸ
        ç´¢å¼•è®¾è®¡
      ç‰©ç†è®¾è®¡
        å­˜å‚¨ç»“æ„
        ç´¢å¼•é€‰æ‹©
        åˆ†åŒºç­–ç•¥
        å‹ç¼©é…ç½®
    è®¾è®¡æ¨¡å¼
      å•è¡¨è®¾è®¡
        ç®€å•åº”ç”¨
        å¿«é€Ÿå¼€å‘
        æ€§èƒ½ä¼˜å…ˆ
      å¤šè¡¨å…³è”
        è§„èŒƒåŒ–
        å…³ç³»å®Œæ•´
        çµæ´»æŸ¥è¯¢
      åˆ†åŒºè®¾è®¡
        èŒƒå›´åˆ†åŒº
        åˆ—è¡¨åˆ†åŒº
        å“ˆå¸Œåˆ†åŒº
        å¤åˆåˆ†åŒº
      åˆ†ç‰‡è®¾è®¡
        æ°´å¹³åˆ†ç‰‡
        å‚ç›´åˆ†ç‰‡
        æ··åˆåˆ†ç‰‡
        åˆ†ç‰‡ç­–ç•¥
    æ•°æ®ç±»å‹é€‰æ‹©
      æ•°å€¼ç±»å‹
        INTEGER
        BIGINT
        NUMERIC
        DECIMAL
      å­—ç¬¦ä¸²ç±»å‹
        VARCHAR
        TEXT
        CHAR
        å­—ç¬¦é›†
      æ—¥æœŸæ—¶é—´
        TIMESTAMP
        TIMESTAMPTZ
        DATE
        TIME
      JSONBç±»å‹
        JSONBå­˜å‚¨
        JSONBç´¢å¼•
        JSONBæŸ¥è¯¢
        JSONBæ€§èƒ½
      æ•°ç»„ç±»å‹
        æ•°ç»„å­˜å‚¨
        æ•°ç»„ç´¢å¼•
        æ•°ç»„æŸ¥è¯¢
        æ•°ç»„æ“ä½œ
    ç´¢å¼•è®¾è®¡
      BTreeç´¢å¼•
        ç­‰å€¼æŸ¥è¯¢
        èŒƒå›´æŸ¥è¯¢
        æ’åºæŸ¥è¯¢
        å”¯ä¸€çº¦æŸ
      GiSTç´¢å¼•
        ç©ºé—´æ•°æ®
        å…¨æ–‡æœç´¢
        èŒƒå›´ç±»å‹
        è‡ªå®šä¹‰ç±»å‹
      GINç´¢å¼•
        JSONB
        æ•°ç»„
        å…¨æ–‡æœç´¢
        å¤šå€¼å±æ€§
      BRINç´¢å¼•
        æ—¶åºæ•°æ®
        å¤§è¡¨æ‰«æ
        èŒƒå›´æŸ¥è¯¢
        å‹ç¼©å­˜å‚¨
    çº¦æŸè®¾è®¡
      ä¸»é”®çº¦æŸ
        å”¯ä¸€æ ‡è¯†
        éç©ºçº¦æŸ
        ç´¢å¼•è‡ªåŠ¨åˆ›å»º
      å¤–é”®çº¦æŸ
        å‚ç…§å®Œæ•´æ€§
        çº§è”æ“ä½œ
        æ€§èƒ½å½±å“
      å”¯ä¸€çº¦æŸ
        å”¯ä¸€æ€§ä¿è¯
        NULLå¤„ç†
        ç´¢å¼•åˆ›å»º
      æ£€æŸ¥çº¦æŸ
        æ•°æ®éªŒè¯
        ä¸šåŠ¡è§„åˆ™
        æ€§èƒ½å½±å“
    æ€§èƒ½ä¼˜åŒ–
      æŸ¥è¯¢ä¼˜åŒ–
        ç´¢å¼•ä½¿ç”¨
        æŸ¥è¯¢é‡å†™
        ç»Ÿè®¡ä¿¡æ¯
      å†™å…¥ä¼˜åŒ–
        æ‰¹é‡æ’å…¥
        å¹¶å‘æ§åˆ¶
        é”ä¼˜åŒ–
      å­˜å‚¨ä¼˜åŒ–
        å‹ç¼©é…ç½®
        TOASTå­˜å‚¨
        åˆ†åŒºç­–ç•¥
      å¹¶å‘ä¼˜åŒ–
        é”ç²’åº¦
        éš”ç¦»çº§åˆ«
        MVCCä¼˜åŒ–
```

---

## ğŸ“Š æ•°æ®æ¨¡å‹é€‰å‹å†³ç­–æ ‘

```mermaid
flowchart TD
    A[éœ€è¦è®¾è®¡æ•°æ®æ¨¡å‹?] --> B{æ•°æ®ç±»å‹ç‰¹å¾?}
    B -->|å…³ç³»æ•°æ®| C[å…³ç³»æ¨¡å‹]
    B -->|æ–‡æ¡£æ•°æ®| D[æ–‡æ¡£æ¨¡å‹JSONB]
    B -->|æ—¶åºæ•°æ®| E[æ—¶åºæ¨¡å‹]
    B -->|å›¾æ•°æ®| F[å›¾æ¨¡å‹]
    B -->|åˆ†ææ•°æ®| G[åˆ—å­˜å‚¨æ¨¡å‹]

    C --> H{æ•°æ®è§„æ¨¡?}
    H -->|å°è§„æ¨¡| I[å•è¡¨è®¾è®¡]
    H -->|ä¸­è§„æ¨¡| J[å¤šè¡¨å…³è”è®¾è®¡]
    H -->|å¤§è§„æ¨¡| K[åˆ†åŒº/åˆ†ç‰‡è®¾è®¡]

    C --> L{ä¸€è‡´æ€§è¦æ±‚?}
    L -->|å¼ºä¸€è‡´| M[èŒƒå¼åŒ–è®¾è®¡]
    L -->|æ€§èƒ½ä¼˜å…ˆ| N[åèŒƒå¼åŒ–è®¾è®¡]

    D --> O{Schemaå˜åŒ–?}
    O -->|é¢‘ç¹å˜åŒ–| P[JSONBçµæ´»è®¾è®¡]
    O -->|ç¨³å®šSchema| Q[å…³ç³»æ¨¡å‹+JSONB]

    E --> R{æŸ¥è¯¢æ¨¡å¼?}
    R -->|æ—¶é—´èŒƒå›´æŸ¥è¯¢| S[æ—¶åºåˆ†åŒºè®¾è®¡]
    R -->|å®æ—¶æŸ¥è¯¢| T[ç‰©åŒ–è§†å›¾è®¾è®¡]

    I --> U[ä¼˜åŠ¿: ç®€å•<br/>é€‚ç”¨: å°åº”ç”¨]
    J --> V[ä¼˜åŠ¿: çµæ´»<br/>é€‚ç”¨: ä¸­åº”ç”¨]
    K --> W[ä¼˜åŠ¿: æ‰©å±•<br/>é€‚ç”¨: å¤§åº”ç”¨]
    M --> X[ä¼˜åŠ¿: ä¸€è‡´<br/>é€‚ç”¨: ä¸šåŠ¡ç³»ç»Ÿ]
    N --> Y[ä¼˜åŠ¿: æ€§èƒ½<br/>é€‚ç”¨: åˆ†æç³»ç»Ÿ]
```

---

## ğŸ“Š æ•°æ®æ¨¡å‹ç±»å‹å¯¹æ¯”çŸ©é˜µ

| æ¨¡å‹ç±»å‹ | å¤æ‚åº¦ | æ€§èƒ½ | çµæ´»æ€§ | ä¸€è‡´æ€§ | é€‚ç”¨åœºæ™¯ | PostgreSQLæ”¯æŒ |
| --- | --- | --- | --- | --- | --- | --- |
| **å…³ç³»æ¨¡å‹** | â­â­ | â­â­â­â­ | â­â­â­ | â­â­â­â­â­ | OLTPã€ä¸šåŠ¡æ•°æ® | âœ… åŸç”Ÿ |
| **æ–‡æ¡£æ¨¡å‹ï¼ˆJSONBï¼‰** | â­â­ | â­â­â­â­ | â­â­â­â­â­ | â­â­â­ | æ–‡æ¡£å­˜å‚¨ã€é…ç½® | âœ… åŸç”Ÿ |
| **æ—¶åºæ¨¡å‹** | â­â­â­ | â­â­â­â­â­ | â­â­â­ | â­â­â­â­ | IoTã€ç›‘æ§ | âœ… TimescaleDB |
| **å›¾æ¨¡å‹** | â­â­â­â­ | â­â­â­ | â­â­â­â­â­ | â­â­â­ | ç¤¾äº¤ç½‘ç»œã€æ¨è | âš ï¸ æ‰©å±•æ”¯æŒ |
| **åˆ—å­˜å‚¨æ¨¡å‹** | â­â­â­â­ | â­â­â­â­â­ | â­â­ | â­â­â­ | OLAPã€åˆ†æ | âš ï¸ æ‰©å±•æ”¯æŒ |

---

## ğŸ“Š èŒƒå¼åŒ–è®¾è®¡å†³ç­–æ ‘

```mermaid
flowchart TD
    A[éœ€è¦èŒƒå¼åŒ–è®¾è®¡?] --> B{æ•°æ®å†—ä½™å®¹å¿åº¦?}
    B -->|ä¸å®¹å¿| C[èŒƒå¼åŒ–è®¾è®¡]
    B -->|å¯å®¹å¿| D{æ€§èƒ½è¦æ±‚?}

    C --> E{èŒƒå¼çº§åˆ«?}
    E -->|åŸºç¡€| F[ç¬¬ä¸‰èŒƒå¼3NF]
    E -->|é«˜çº§| G[BCNF]
    E -->|æè‡´| H[ç¬¬å››èŒƒå¼4NF]

    D -->|é«˜æ€§èƒ½| I[åèŒƒå¼åŒ–è®¾è®¡]
    D -->|æ ‡å‡†æ€§èƒ½| J[éƒ¨åˆ†èŒƒå¼åŒ–]

    F --> K[ä¼˜åŠ¿: å‡å°‘å†—ä½™<br/>é€‚ç”¨: ä¸šåŠ¡ç³»ç»Ÿ]
    G --> L[ä¼˜åŠ¿: æ¶ˆé™¤ä¾èµ–<br/>é€‚ç”¨: å¤æ‚ç³»ç»Ÿ]
    I --> M[ä¼˜åŠ¿: æŸ¥è¯¢æ€§èƒ½<br/>é€‚ç”¨: åˆ†æç³»ç»Ÿ]
```

---

## ğŸ“Š èŒƒå¼åŒ–è®¾è®¡å¯¹æ¯”çŸ©é˜µ

| èŒƒå¼çº§åˆ« | å†—ä½™åº¦ | ä¸€è‡´æ€§ | æŸ¥è¯¢æ€§èƒ½ | ç»´æŠ¤å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ |
| --- | --- | --- | --- | --- | --- |
| **1NF** | â­â­â­â­ | â­â­ | â­â­â­â­ | â­â­â­â­ | åŸºç¡€è®¾è®¡ |
| **2NF** | â­â­â­ | â­â­â­ | â­â­â­â­ | â­â­â­ | ç®€å•ç³»ç»Ÿ |
| **3NF** | â­â­ | â­â­â­â­ | â­â­â­ | â­â­ | å¤§å¤šæ•°ç³»ç»Ÿ |
| **BCNF** | â­ | â­â­â­â­â­ | â­â­â­ | â­â­ | å¤æ‚ç³»ç»Ÿ |
| **åèŒƒå¼åŒ–** | â­â­â­â­â­ | â­â­ | â­â­â­â­â­ | â­â­â­ | åˆ†æç³»ç»Ÿ |

---

## âœ… æ­£é¢ç¤ºä¾‹ï¼šä¼˜ç§€æ•°æ®æ¨¡å‹è®¾è®¡

### ç¤ºä¾‹1ï¼šå…³ç³»æ¨¡å‹è®¾è®¡ï¼ˆç”µå•†ç³»ç»Ÿï¼‰

**è®¾è®¡ç›®æ ‡**ï¼š

- å¼ºä¸€è‡´æ€§ä¿è¯
- å‡å°‘æ•°æ®å†—ä½™
- æ”¯æŒå¤æ‚æŸ¥è¯¢
- æ˜“äºç»´æŠ¤

**å®ç°ä»£ç **ï¼š

```sql
-- âœ… æ­£ç¡®ï¼šèŒƒå¼åŒ–è®¾è®¡ï¼ˆç¬¬ä¸‰èŒƒå¼3NFï¼‰

-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    user_id BIGSERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW(),
    CONSTRAINT email_format CHECK (email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}$')
);

-- å•†å“è¡¨
CREATE TABLE products (
    product_id BIGSERIAL PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    description TEXT,
    price NUMERIC(10, 2) NOT NULL CHECK (price > 0),
    stock_quantity INTEGER NOT NULL CHECK (stock_quantity >= 0),
    category_id BIGINT REFERENCES categories(category_id),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- åˆ†ç±»è¡¨ï¼ˆæ¶ˆé™¤å†—ä½™ï¼‰
CREATE TABLE categories (
    category_id BIGSERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL UNIQUE,
    parent_id BIGINT REFERENCES categories(category_id),
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- è®¢å•è¡¨
CREATE TABLE orders (
    order_id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES users(user_id),
    status VARCHAR(20) NOT NULL DEFAULT 'pending',
    total_amount NUMERIC(10, 2) NOT NULL CHECK (total_amount >= 0),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW(),
    CONSTRAINT valid_status CHECK (status IN ('pending', 'paid', 'shipped', 'delivered', 'cancelled'))
);

-- è®¢å•é¡¹è¡¨ï¼ˆæ¶ˆé™¤å†—ä½™ï¼‰
CREATE TABLE order_items (
    order_item_id BIGSERIAL PRIMARY KEY,
    order_id BIGINT NOT NULL REFERENCES orders(order_id) ON DELETE CASCADE,
    product_id BIGINT NOT NULL REFERENCES products(product_id),
    quantity INTEGER NOT NULL CHECK (quantity > 0),
    unit_price NUMERIC(10, 2) NOT NULL CHECK (unit_price > 0),
    subtotal NUMERIC(10, 2) NOT NULL CHECK (subtotal >= 0),
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- âœ… æ­£ç¡®ï¼šç´¢å¼•è®¾è®¡
CREATE INDEX idx_orders_user_id ON orders(user_id);
CREATE INDEX idx_orders_status ON orders(status);
CREATE INDEX idx_orders_created_at ON orders(created_at);
CREATE INDEX idx_order_items_order_id ON order_items(order_id);
CREATE INDEX idx_order_items_product_id ON order_items(product_id);
CREATE INDEX idx_products_category_id ON products(category_id);

-- âœ… æ­£ç¡®ï¼šè§¦å‘å™¨è‡ªåŠ¨æ›´æ–°updated_at
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_users_updated_at BEFORE UPDATE ON users
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_products_updated_at BEFORE UPDATE ON products
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_orders_updated_at BEFORE UPDATE ON orders
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
```

**è®¾è®¡ä¼˜ç‚¹**ï¼š

1. âœ… **èŒƒå¼åŒ–è®¾è®¡**ï¼šç¬¬ä¸‰èŒƒå¼ï¼Œå‡å°‘æ•°æ®å†—ä½™
2. âœ… **å®Œæ•´æ€§çº¦æŸ**ï¼šå¤–é”®ã€æ£€æŸ¥çº¦æŸä¿è¯æ•°æ®ä¸€è‡´æ€§
3. âœ… **ç´¢å¼•ä¼˜åŒ–**ï¼šåˆç†çš„ç´¢å¼•è®¾è®¡æå‡æŸ¥è¯¢æ€§èƒ½
4. âœ… **è‡ªåŠ¨ç»´æŠ¤**ï¼šè§¦å‘å™¨è‡ªåŠ¨æ›´æ–°æ—¶é—´æˆ³

---

### ç¤ºä¾‹2ï¼šæ–‡æ¡£æ¨¡å‹è®¾è®¡ï¼ˆå†…å®¹ç®¡ç†ç³»ç»Ÿï¼‰

**è®¾è®¡ç›®æ ‡**ï¼š

- çµæ´»çš„Schema
- åµŒå¥—æ•°æ®ç»“æ„
- å¿«é€Ÿå¼€å‘
- JSONBæŸ¥è¯¢ä¼˜åŒ–

**å®ç°ä»£ç **ï¼š

```sql
-- âœ… æ­£ç¡®ï¼šJSONBæ–‡æ¡£æ¨¡å‹è®¾è®¡

-- æ–‡ç« è¡¨ï¼ˆä½¿ç”¨JSONBå­˜å‚¨çµæ´»å†…å®¹ï¼‰
CREATE TABLE articles (
    article_id BIGSERIAL PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    slug VARCHAR(200) UNIQUE NOT NULL,
    author_id BIGINT NOT NULL REFERENCES users(user_id),
    content JSONB NOT NULL,
    metadata JSONB DEFAULT '{}',
    tags TEXT[],
    status VARCHAR(20) DEFAULT 'draft',
    published_at TIMESTAMPTZ,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW(),
    CONSTRAINT valid_status CHECK (status IN ('draft', 'published', 'archived'))
);

-- âœ… æ­£ç¡®ï¼šJSONBç´¢å¼•è®¾è®¡
-- GINç´¢å¼•æ”¯æŒJSONBæŸ¥è¯¢
CREATE INDEX idx_articles_content_gin ON articles USING GIN (content);
CREATE INDEX idx_articles_metadata_gin ON articles USING GIN (metadata);
CREATE INDEX idx_articles_tags_gin ON articles USING GIN (tags);
CREATE INDEX idx_articles_author_id ON articles(author_id);
CREATE INDEX idx_articles_status ON articles(status);

-- âœ… æ­£ç¡®ï¼šJSONBæŸ¥è¯¢ç¤ºä¾‹
-- æŸ¥è¯¢åŒ…å«ç‰¹å®šå­—æ®µçš„æ–‡ç« 
SELECT article_id, title, content->>'body' as body
FROM articles
WHERE content ? 'body'
  AND content->>'body' LIKE '%PostgreSQL%';

-- æŸ¥è¯¢metadataä¸­çš„ç‰¹å®šå€¼
SELECT article_id, title, metadata->>'category' as category
FROM articles
WHERE metadata->>'category' = 'technology';

-- æŸ¥è¯¢æ•°ç»„åŒ…å«ç‰¹å®šæ ‡ç­¾
SELECT article_id, title, tags
FROM articles
WHERE 'database' = ANY(tags);

-- âœ… æ­£ç¡®ï¼šJSONBæ›´æ–°ç¤ºä¾‹
UPDATE articles
SET content = jsonb_set(content, '{views}', '100'),
    metadata = jsonb_set(metadata, '{last_updated}', to_jsonb(NOW()))
WHERE article_id = 1;
```

**è®¾è®¡ä¼˜ç‚¹**ï¼š

1. âœ… **çµæ´»Schema**ï¼šJSONBæ”¯æŒåŠ¨æ€ç»“æ„
2. âœ… **åµŒå¥—æ•°æ®**ï¼šæ”¯æŒå¤æ‚åµŒå¥—ç»“æ„
3. âœ… **æŸ¥è¯¢ä¼˜åŒ–**ï¼šGINç´¢å¼•æ”¯æŒé«˜æ•ˆJSONBæŸ¥è¯¢
4. âœ… **ç±»å‹å®‰å…¨**ï¼šPostgreSQL 18æ”¯æŒJSONBç±»å‹æ£€æŸ¥

---

### ç¤ºä¾‹3ï¼šæ—¶åºæ¨¡å‹è®¾è®¡ï¼ˆç›‘æ§ç³»ç»Ÿï¼‰

**è®¾è®¡ç›®æ ‡**ï¼š

- é«˜æ•ˆçš„æ—¶é—´åºåˆ—å­˜å‚¨
- å¿«é€Ÿæ—¶é—´èŒƒå›´æŸ¥è¯¢
- æ•°æ®å‹ç¼©
- è‡ªåŠ¨åˆ†åŒº

**å®ç°ä»£ç **ï¼š

```sql
-- âœ… æ­£ç¡®ï¼šæ—¶åºæ¨¡å‹è®¾è®¡ï¼ˆä½¿ç”¨TimescaleDBï¼‰

-- å¯ç”¨TimescaleDBæ‰©å±•
CREATE EXTENSION IF NOT EXISTS timescaledb;

-- æŒ‡æ ‡è¡¨ï¼ˆæ—¶åºè¡¨ï¼‰
CREATE TABLE metrics (
    time TIMESTAMPTZ NOT NULL,
    device_id VARCHAR(50) NOT NULL,
    metric_name VARCHAR(100) NOT NULL,
    value DOUBLE PRECISION NOT NULL,
    tags JSONB DEFAULT '{}'
);

-- âœ… æ­£ç¡®ï¼šè½¬æ¢ä¸ºæ—¶åºè¡¨
SELECT create_hypertable('metrics', 'time');

-- âœ… æ­£ç¡®ï¼šBRINç´¢å¼•ï¼ˆæ—¶åºæ•°æ®ä¼˜åŒ–ï¼‰
CREATE INDEX idx_metrics_time_brin ON metrics USING BRIN (time);
CREATE INDEX idx_metrics_device_time ON metrics (device_id, time DESC);
CREATE INDEX idx_metrics_name_time ON metrics (metric_name, time DESC);

-- âœ… æ­£ç¡®ï¼šåˆ†åŒºç­–ç•¥ï¼ˆæŒ‰æ—¶é—´åˆ†åŒºï¼‰
-- TimescaleDBè‡ªåŠ¨ç®¡ç†åˆ†åŒº

-- âœ… æ­£ç¡®ï¼šæ—¶åºæŸ¥è¯¢ä¼˜åŒ–
-- æ—¶é—´èŒƒå›´æŸ¥è¯¢ï¼ˆåˆ©ç”¨BRINç´¢å¼•ï¼‰
SELECT
    time_bucket('1 hour', time) AS hour,
    device_id,
    AVG(value) as avg_value,
    MAX(value) as max_value,
    MIN(value) as min_value
FROM metrics
WHERE time >= NOW() - INTERVAL '24 hours'
  AND device_id = 'device-001'
GROUP BY hour, device_id
ORDER BY hour;

-- âœ… æ­£ç¡®ï¼šæ•°æ®ä¿ç•™ç­–ç•¥
SELECT add_retention_policy('metrics', INTERVAL '90 days');
```

**è®¾è®¡ä¼˜ç‚¹**ï¼š

1. âœ… **æ—¶åºä¼˜åŒ–**ï¼šTimescaleDBé’ˆå¯¹æ—¶åºæ•°æ®ä¼˜åŒ–
2. âœ… **è‡ªåŠ¨åˆ†åŒº**ï¼šæŒ‰æ—¶é—´è‡ªåŠ¨åˆ†åŒº
3. âœ… **å‹ç¼©å­˜å‚¨**ï¼šè‡ªåŠ¨å‹ç¼©å†å²æ•°æ®
4. âœ… **å¿«é€ŸæŸ¥è¯¢**ï¼šBRINç´¢å¼•ä¼˜åŒ–æ—¶é—´èŒƒå›´æŸ¥è¯¢

---

### ç¤ºä¾‹4ï¼šæ··åˆæ¨¡å‹è®¾è®¡ï¼ˆå¤šç§Ÿæˆ·ç³»ç»Ÿï¼‰

**è®¾è®¡ç›®æ ‡**ï¼š

- å¤šç§Ÿæˆ·æ•°æ®éš”ç¦»
- å…±äº«Schemaè®¾è®¡
- æ€§èƒ½ä¼˜åŒ–
- çµæ´»æ‰©å±•

**å®ç°ä»£ç **ï¼š

```sql
-- âœ… æ­£ç¡®ï¼šå¤šç§Ÿæˆ·æ··åˆæ¨¡å‹è®¾è®¡

-- ç§Ÿæˆ·è¡¨
CREATE TABLE tenants (
    tenant_id BIGSERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    subdomain VARCHAR(50) UNIQUE NOT NULL,
    settings JSONB DEFAULT '{}',
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- ç”¨æˆ·è¡¨ï¼ˆå¤šç§Ÿæˆ·ï¼‰
CREATE TABLE users (
    user_id BIGSERIAL PRIMARY KEY,
    tenant_id BIGINT NOT NULL REFERENCES tenants(tenant_id) ON DELETE CASCADE,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL,
    profile JSONB DEFAULT '{}',
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW(),
    CONSTRAINT unique_tenant_username UNIQUE (tenant_id, username),
    CONSTRAINT unique_tenant_email UNIQUE (tenant_id, email)
);

-- è®¢å•è¡¨ï¼ˆå¤šç§Ÿæˆ·ï¼‰
CREATE TABLE orders (
    order_id BIGSERIAL PRIMARY KEY,
    tenant_id BIGINT NOT NULL REFERENCES tenants(tenant_id) ON DELETE CASCADE,
    user_id BIGINT NOT NULL REFERENCES users(user_id) ON DELETE CASCADE,
    order_number VARCHAR(50) NOT NULL,
    total_amount NUMERIC(10, 2) NOT NULL,
    status VARCHAR(20) NOT NULL,
    metadata JSONB DEFAULT '{}',
    created_at TIMESTAMPTZ DEFAULT NOW(),
    CONSTRAINT unique_tenant_order_number UNIQUE (tenant_id, order_number)
);

-- âœ… æ­£ç¡®ï¼šå¤šç§Ÿæˆ·ç´¢å¼•è®¾è®¡
CREATE INDEX idx_users_tenant_id ON users(tenant_id);
CREATE INDEX idx_orders_tenant_id ON orders(tenant_id);
CREATE INDEX idx_orders_tenant_user ON orders(tenant_id, user_id);
CREATE INDEX idx_orders_tenant_status ON orders(tenant_id, status);

-- âœ… æ­£ç¡®ï¼šRLSè¡Œçº§å®‰å…¨ï¼ˆPostgreSQL 18ä¼˜åŒ–ï¼‰
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE orders ENABLE ROW LEVEL SECURITY;

-- ç§Ÿæˆ·éš”ç¦»ç­–ç•¥ï¼ˆPostgreSQL 18æ€§èƒ½ä¼˜åŒ–ï¼‰
CREATE POLICY tenant_isolation_users ON users
    FOR ALL
    USING (tenant_id = current_setting('app.tenant_id')::BIGINT);

CREATE POLICY tenant_isolation_orders ON orders
    FOR ALL
    USING (tenant_id = current_setting('app.tenant_id')::BIGINT);

-- âœ… æ­£ç¡®ï¼šå¤šç§Ÿæˆ·æŸ¥è¯¢ç¤ºä¾‹
-- è®¾ç½®å½“å‰ç§Ÿæˆ·
SET app.tenant_id = '1';

-- æŸ¥è¯¢è‡ªåŠ¨è¿‡æ»¤ç§Ÿæˆ·æ•°æ®
SELECT * FROM users;  -- åªè¿”å›å½“å‰ç§Ÿæˆ·çš„ç”¨æˆ·
SELECT * FROM orders; -- åªè¿”å›å½“å‰ç§Ÿæˆ·çš„è®¢å•
```

**è®¾è®¡ä¼˜ç‚¹**ï¼š

1. âœ… **æ•°æ®éš”ç¦»**ï¼šRLSä¿è¯ç§Ÿæˆ·æ•°æ®éš”ç¦»
2. âœ… **å…±äº«Schema**ï¼šæ‰€æœ‰ç§Ÿæˆ·å…±äº«åŒä¸€Schema
3. âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šPostgreSQL 18 RLSæ€§èƒ½ä¼˜åŒ–
4. âœ… **çµæ´»æ‰©å±•**ï¼šJSONBæ”¯æŒç§Ÿæˆ·ç‰¹å®šé…ç½®

---

## âŒ åé¢ç¤ºä¾‹ï¼šå¸¸è§è®¾è®¡é”™è¯¯

### åä¾‹1ï¼šè¿‡åº¦èŒƒå¼åŒ–è®¾è®¡

**é”™è¯¯è®¾è®¡**ï¼š

```sql
-- âŒ é”™è¯¯ï¼šè¿‡åº¦èŒƒå¼åŒ–ï¼Œå¯¼è‡´æŸ¥è¯¢å¤æ‚

-- ç”¨æˆ·åŸºæœ¬ä¿¡æ¯è¡¨
CREATE TABLE users (
    user_id BIGSERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL
);

-- ç”¨æˆ·è”ç³»ä¿¡æ¯è¡¨ï¼ˆè¿‡åº¦æ‹†åˆ†ï¼‰
CREATE TABLE user_contacts (
    user_id BIGINT PRIMARY KEY REFERENCES users(user_id),
    email VARCHAR(100),
    phone VARCHAR(20),
    address_line1 VARCHAR(200),
    address_line2 VARCHAR(200),
    city VARCHAR(100),
    state VARCHAR(100),
    zip_code VARCHAR(20),
    country VARCHAR(100)
);

-- ç”¨æˆ·åå¥½è¡¨ï¼ˆè¿‡åº¦æ‹†åˆ†ï¼‰
CREATE TABLE user_preferences (
    user_id BIGINT PRIMARY KEY REFERENCES users(user_id),
    theme VARCHAR(20),
    language VARCHAR(10),
    timezone VARCHAR(50)
);

-- âŒ æŸ¥è¯¢éœ€è¦å¤šæ¬¡JOIN
SELECT u.user_id, u.username, uc.email, uc.phone, up.theme
FROM users u
LEFT JOIN user_contacts uc ON u.user_id = uc.user_id
LEFT JOIN user_preferences up ON u.user_id = up.user_id
WHERE u.user_id = 1;
```

**é—®é¢˜åˆ†æ**ï¼š

1. âŒ **æŸ¥è¯¢å¤æ‚**ï¼šéœ€è¦å¤šæ¬¡JOIN
2. âŒ **æ€§èƒ½ä¸‹é™**ï¼šJOINå¼€é”€å¤§
3. âŒ **ç»´æŠ¤å›°éš¾**ï¼šè¡¨ç»“æ„å¤æ‚
4. âŒ **è¿‡åº¦è®¾è®¡**ï¼šä¸å¿…è¦çš„æ‹†åˆ†

**æ”¹è¿›æ–¹æ¡ˆ**ï¼š

```sql
-- âœ… æ­£ç¡®ï¼šé€‚åº¦èŒƒå¼åŒ–
CREATE TABLE users (
    user_id BIGSERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    phone VARCHAR(20),
    address JSONB,  -- åœ°å€ä¿¡æ¯ä½¿ç”¨JSONB
    preferences JSONB DEFAULT '{}',  -- åå¥½ä½¿ç”¨JSONB
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- âœ… æŸ¥è¯¢ç®€å•é«˜æ•ˆ
SELECT user_id, username, email, phone, address, preferences
FROM users
WHERE user_id = 1;
```

---

### åä¾‹2ï¼šè¿‡åº¦åèŒƒå¼åŒ–è®¾è®¡

**é”™è¯¯è®¾è®¡**ï¼š

```sql
-- âŒ é”™è¯¯ï¼šè¿‡åº¦åèŒƒå¼åŒ–ï¼Œæ•°æ®å†—ä½™ä¸¥é‡

CREATE TABLE orders (
    order_id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL,
    -- âŒ å†—ä½™ï¼šç”¨æˆ·ä¿¡æ¯ç›´æ¥å­˜å‚¨åœ¨è®¢å•è¡¨
    username VARCHAR(50) NOT NULL,
    user_email VARCHAR(100) NOT NULL,
    user_phone VARCHAR(20),
    -- âŒ å†—ä½™ï¼šå•†å“ä¿¡æ¯ç›´æ¥å­˜å‚¨
    product_name VARCHAR(200) NOT NULL,
    product_price NUMERIC(10, 2) NOT NULL,
    product_category VARCHAR(100),
    -- âŒ å†—ä½™ï¼šè®¢å•é¡¹ä¿¡æ¯
    quantity INTEGER NOT NULL,
    subtotal NUMERIC(10, 2) NOT NULL,
    -- è®¢å•ä¿¡æ¯
    order_date TIMESTAMPTZ DEFAULT NOW(),
    total_amount NUMERIC(10, 2) NOT NULL
);

-- âŒ é—®é¢˜ï¼šç”¨æˆ·ä¿¡æ¯æ›´æ–°éœ€è¦æ›´æ–°æ‰€æœ‰è®¢å•
UPDATE users SET email = 'new@example.com' WHERE user_id = 1;
-- éœ€è¦æ‰‹åŠ¨æ›´æ–°æ‰€æœ‰ç›¸å…³è®¢å•
UPDATE orders SET user_email = 'new@example.com' WHERE user_id = 1;
```

**é—®é¢˜åˆ†æ**ï¼š

1. âŒ **æ•°æ®å†—ä½™**ï¼šå¤§é‡é‡å¤æ•°æ®
2. âŒ **æ›´æ–°å›°éš¾**ï¼šéœ€è¦æ›´æ–°å¤šå¤„
3. âŒ **æ•°æ®ä¸ä¸€è‡´**ï¼šå®¹æ˜“äº§ç”Ÿä¸ä¸€è‡´
4. âŒ **å­˜å‚¨æµªè´¹**ï¼šå ç”¨å¤§é‡å­˜å‚¨ç©ºé—´

**æ”¹è¿›æ–¹æ¡ˆ**ï¼š

```sql
-- âœ… æ­£ç¡®ï¼šèŒƒå¼åŒ–è®¾è®¡
CREATE TABLE orders (
    order_id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES users(user_id),
    order_date TIMESTAMPTZ DEFAULT NOW(),
    total_amount NUMERIC(10, 2) NOT NULL
);

CREATE TABLE order_items (
    order_item_id BIGSERIAL PRIMARY KEY,
    order_id BIGINT NOT NULL REFERENCES orders(order_id),
    product_id BIGINT NOT NULL REFERENCES products(product_id),
    quantity INTEGER NOT NULL,
    unit_price NUMERIC(10, 2) NOT NULL,
    subtotal NUMERIC(10, 2) NOT NULL
);

-- âœ… æŸ¥è¯¢ä½¿ç”¨JOINï¼ˆæ€§èƒ½å¯é€šè¿‡ç´¢å¼•ä¼˜åŒ–ï¼‰
SELECT o.order_id, u.username, u.email, oi.product_name, oi.quantity
FROM orders o
JOIN users u ON o.user_id = u.user_id
JOIN order_items oi ON o.order_id = oi.order_id
WHERE o.order_id = 1;
```

---

### åä¾‹3ï¼šç¼ºå°‘çº¦æŸè®¾è®¡

**é”™è¯¯è®¾è®¡**ï¼š

```sql
-- âŒ é”™è¯¯ï¼šç¼ºå°‘çº¦æŸï¼Œæ•°æ®è´¨é‡æ— æ³•ä¿è¯

CREATE TABLE users (
    user_id BIGSERIAL PRIMARY KEY,
    username VARCHAR(50),  -- âŒ ç¼ºå°‘NOT NULLå’ŒUNIQUE
    email VARCHAR(100),     -- âŒ ç¼ºå°‘NOT NULLã€UNIQUEå’Œæ ¼å¼æ£€æŸ¥
    age INTEGER,            -- âŒ ç¼ºå°‘CHECKçº¦æŸ
    balance NUMERIC(10, 2)  -- âŒ ç¼ºå°‘CHECKçº¦æŸ
);

-- âŒ å¯ä»¥æ’å…¥æ— æ•ˆæ•°æ®
INSERT INTO users (username, email, age, balance) VALUES
    (NULL, 'invalid-email', -5, -100);  -- æ‰€æœ‰æ•°æ®éƒ½æ— æ•ˆ
```

**é—®é¢˜åˆ†æ**ï¼š

1. âŒ **æ•°æ®è´¨é‡å·®**ï¼šå¯ä»¥æ’å…¥æ— æ•ˆæ•°æ®
2. âŒ **ä¸šåŠ¡é€»è¾‘é”™è¯¯**ï¼šç¼ºå°‘ä¸šåŠ¡è§„åˆ™çº¦æŸ
3. âŒ **éš¾ä»¥ç»´æŠ¤**ï¼šéœ€è¦åœ¨åº”ç”¨å±‚æ£€æŸ¥
4. âŒ **æ•°æ®ä¸ä¸€è‡´**ï¼šå®¹æ˜“äº§ç”Ÿè„æ•°æ®

**æ”¹è¿›æ–¹æ¡ˆ**ï¼š

```sql
-- âœ… æ­£ç¡®ï¼šå®Œæ•´çš„çº¦æŸè®¾è®¡
CREATE TABLE users (
    user_id BIGSERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    age INTEGER CHECK (age >= 0 AND age <= 150),
    balance NUMERIC(10, 2) DEFAULT 0 CHECK (balance >= 0),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    CONSTRAINT email_format CHECK (email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}$')
);

-- âœ… çº¦æŸè‡ªåŠ¨æ£€æŸ¥ï¼Œé˜²æ­¢æ— æ•ˆæ•°æ®
INSERT INTO users (username, email, age, balance) VALUES
    ('user1', 'user1@example.com', 25, 100);  -- âœ… æœ‰æ•ˆæ•°æ®

-- âŒ çº¦æŸè‡ªåŠ¨æ‹’ç»æ— æ•ˆæ•°æ®
INSERT INTO users (username, email, age, balance) VALUES
    (NULL, 'invalid', -5, -100);  -- âŒ çº¦æŸé”™è¯¯ï¼Œæ’å…¥å¤±è´¥
```

---

### åä¾‹4ï¼šæ•°æ®ç±»å‹é€‰æ‹©ä¸å½“

**é”™è¯¯è®¾è®¡**ï¼š

```sql
-- âŒ é”™è¯¯ï¼šæ•°æ®ç±»å‹é€‰æ‹©ä¸å½“

CREATE TABLE products (
    product_id VARCHAR(50) PRIMARY KEY,  -- âŒ åº”è¯¥ä½¿ç”¨BIGSERIAL
    name TEXT,                            -- âŒ åº”è¯¥ä½¿ç”¨VARCHAR
    price VARCHAR(20),                   -- âŒ åº”è¯¥ä½¿ç”¨NUMERIC
    stock VARCHAR(10),                    -- âŒ åº”è¯¥ä½¿ç”¨INTEGER
    created_at VARCHAR(50)               -- âŒ åº”è¯¥ä½¿ç”¨TIMESTAMPTZ
);

-- âŒ é—®é¢˜ï¼šæ— æ³•è¿›è¡Œæ•°å€¼è®¡ç®—å’Œæ¯”è¾ƒ
SELECT * FROM products WHERE price > 100;  -- âŒ å­—ç¬¦ä¸²æ¯”è¾ƒï¼Œç»“æœé”™è¯¯
SELECT SUM(price) FROM products;           -- âŒ æ— æ³•å¯¹å­—ç¬¦ä¸²æ±‚å’Œ
```

**é—®é¢˜åˆ†æ**ï¼š

1. âŒ **ç±»å‹é”™è¯¯**ï¼šæ•°æ®ç±»å‹ä¸åŒ¹é…ä¸šåŠ¡éœ€æ±‚
2. âŒ **æŸ¥è¯¢é”™è¯¯**ï¼šæ— æ³•è¿›è¡Œæ­£ç¡®çš„æ•°å€¼æ“ä½œ
3. âŒ **æ€§èƒ½é—®é¢˜**ï¼šå­—ç¬¦ä¸²æ¯”è¾ƒå’Œè®¡ç®—æ€§èƒ½å·®
4. âŒ **å­˜å‚¨æµªè´¹**ï¼šå­—ç¬¦ä¸²å ç”¨æ›´å¤šç©ºé—´

**æ”¹è¿›æ–¹æ¡ˆ**ï¼š

```sql
-- âœ… æ­£ç¡®ï¼šåˆé€‚çš„æ•°æ®ç±»å‹
CREATE TABLE products (
    product_id BIGSERIAL PRIMARY KEY,      -- âœ… è‡ªå¢æ•´æ•°
    name VARCHAR(200) NOT NULL,           -- âœ… å˜é•¿å­—ç¬¦ä¸²
    price NUMERIC(10, 2) NOT NULL,        -- âœ… ç²¾ç¡®æ•°å€¼
    stock INTEGER NOT NULL,                -- âœ… æ•´æ•°
    created_at TIMESTAMPTZ DEFAULT NOW()  -- âœ… æ—¶é—´æˆ³
);

-- âœ… å¯ä»¥è¿›è¡Œæ­£ç¡®çš„æ•°å€¼æ“ä½œ
SELECT * FROM products WHERE price > 100;  -- âœ… æ•°å€¼æ¯”è¾ƒ
SELECT SUM(price) FROM products;           -- âœ… æ•°å€¼æ±‚å’Œ
SELECT AVG(price) FROM products;           -- âœ… æ•°å€¼å¹³å‡
```

---

### åä¾‹5ï¼šç´¢å¼•è®¾è®¡ç¼ºå¤±

**é”™è¯¯è®¾è®¡**ï¼š

```sql
-- âŒ é”™è¯¯ï¼šç¼ºå°‘ç´¢å¼•è®¾è®¡

CREATE TABLE orders (
    order_id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL,              -- âŒ ç¼ºå°‘ç´¢å¼•
    status VARCHAR(20) NOT NULL,          -- âŒ ç¼ºå°‘ç´¢å¼•
    created_at TIMESTAMPTZ DEFAULT NOW(), -- âŒ ç¼ºå°‘ç´¢å¼•
    total_amount NUMERIC(10, 2) NOT NULL
);

-- âŒ æŸ¥è¯¢æ€§èƒ½å·®ï¼ˆå…¨è¡¨æ‰«æï¼‰
SELECT * FROM orders WHERE user_id = 1;        -- âŒ å…¨è¡¨æ‰«æ
SELECT * FROM orders WHERE status = 'pending'; -- âŒ å…¨è¡¨æ‰«æ
SELECT * FROM orders WHERE created_at > NOW() - INTERVAL '7 days'; -- âŒ å…¨è¡¨æ‰«æ
```

**é—®é¢˜åˆ†æ**ï¼š

1. âŒ **æŸ¥è¯¢æ€§èƒ½å·®**ï¼šå…¨è¡¨æ‰«æï¼Œæ€§èƒ½æå·®
2. âŒ **æ— æ³•æ‰©å±•**ï¼šæ•°æ®é‡å¤§æ—¶æŸ¥è¯¢ææ…¢
3. âŒ **èµ„æºæµªè´¹**ï¼šCPUå’ŒIOèµ„æºæµªè´¹
4. âŒ **ç”¨æˆ·ä½“éªŒå·®**ï¼šæŸ¥è¯¢å“åº”æ—¶é—´é•¿

**æ”¹è¿›æ–¹æ¡ˆ**ï¼š

```sql
-- âœ… æ­£ç¡®ï¼šåˆç†çš„ç´¢å¼•è®¾è®¡
CREATE TABLE orders (
    order_id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL,
    status VARCHAR(20) NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    total_amount NUMERIC(10, 2) NOT NULL
);

-- âœ… ä¸ºå¸¸ç”¨æŸ¥è¯¢åˆ›å»ºç´¢å¼•
CREATE INDEX idx_orders_user_id ON orders(user_id);
CREATE INDEX idx_orders_status ON orders(status);
CREATE INDEX idx_orders_created_at ON orders(created_at);
CREATE INDEX idx_orders_user_status ON orders(user_id, status);  -- å¤åˆç´¢å¼•

-- âœ… æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–ï¼ˆä½¿ç”¨ç´¢å¼•ï¼‰
SELECT * FROM orders WHERE user_id = 1;        -- âœ… ä½¿ç”¨ç´¢å¼•
SELECT * FROM orders WHERE status = 'pending'; -- âœ… ä½¿ç”¨ç´¢å¼•
SELECT * FROM orders
WHERE user_id = 1 AND status = 'pending';      -- âœ… ä½¿ç”¨å¤åˆç´¢å¼•
```

---

## ğŸ“Š å¤šç»´åˆ†æè®ºè¯

### ç»´åº¦1ï¼šæ•°æ®ä¸€è‡´æ€§ç»´åº¦

**ä¸€è‡´æ€§ä¿è¯å¯¹æ¯”åˆ†æ**ï¼š

| è®¾è®¡æ¨¡å¼ | èŒƒå¼åŒ–ç¨‹åº¦ | å†—ä½™åº¦ | ä¸€è‡´æ€§ä¿è¯ | æ›´æ–°å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ |
| --- | --- | --- | --- | --- | --- |
| **å®Œå…¨èŒƒå¼åŒ–ï¼ˆ3NF+ï¼‰** | â­â­â­â­â­ | â­ | â­â­â­â­â­ | â­â­ | ä¸šåŠ¡ç³»ç»Ÿ |
| **éƒ¨åˆ†èŒƒå¼åŒ–ï¼ˆ2NFï¼‰** | â­â­â­ | â­â­â­ | â­â­â­â­ | â­â­â­ | ä¸­ç­‰ç³»ç»Ÿ |
| **åèŒƒå¼åŒ–** | â­ | â­â­â­â­â­ | â­â­ | â­â­â­â­ | åˆ†æç³»ç»Ÿ |
| **æ··åˆè®¾è®¡** | â­â­â­ | â­â­â­ | â­â­â­â­ | â­â­â­ | å¤æ‚ç³»ç»Ÿ |

**ä¸€è‡´æ€§ä¿è¯æœºåˆ¶**ï¼š

1. âœ… **å¤–é”®çº¦æŸ**ï¼šä¿è¯å‚ç…§å®Œæ•´æ€§
2. âœ… **æ£€æŸ¥çº¦æŸ**ï¼šä¿è¯æ•°æ®æœ‰æ•ˆæ€§
3. âœ… **å”¯ä¸€çº¦æŸ**ï¼šä¿è¯æ•°æ®å”¯ä¸€æ€§
4. âœ… **è§¦å‘å™¨**ï¼šä¿è¯ä¸šåŠ¡è§„åˆ™ä¸€è‡´æ€§

---

### ç»´åº¦2ï¼šæŸ¥è¯¢æ€§èƒ½ç»´åº¦

**æŸ¥è¯¢æ€§èƒ½å¯¹æ¯”åˆ†æ**ï¼š

| è®¾è®¡æ¨¡å¼ | ç®€å•æŸ¥è¯¢ | å¤æ‚æŸ¥è¯¢ | JOINæ€§èƒ½ | èšåˆæ€§èƒ½ | é€‚ç”¨åœºæ™¯ |
| --- | --- | --- | --- | --- | --- |
| **å•è¡¨è®¾è®¡** | â­â­â­â­â­ | â­â­â­â­â­ | N/A | â­â­â­â­â­ | ç®€å•åº”ç”¨ |
| **èŒƒå¼åŒ–è®¾è®¡** | â­â­â­ | â­â­ | â­â­â­ | â­â­â­ | ä¸šåŠ¡ç³»ç»Ÿ |
| **åèŒƒå¼åŒ–è®¾è®¡** | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | åˆ†æç³»ç»Ÿ |
| **æ··åˆè®¾è®¡** | â­â­â­â­ | â­â­â­ | â­â­â­â­ | â­â­â­â­ | å¤æ‚ç³»ç»Ÿ |

**æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**ï¼š

1. âœ… **ç´¢å¼•ä¼˜åŒ–**ï¼šä¸ºå¸¸ç”¨æŸ¥è¯¢åˆ›å»ºç´¢å¼•
2. âœ… **ç‰©åŒ–è§†å›¾**ï¼šé¢„è®¡ç®—å¤æ‚æŸ¥è¯¢
3. âœ… **åˆ†åŒºç­–ç•¥**ï¼šå¤§è¡¨åˆ†åŒºæå‡æ€§èƒ½
4. âœ… **åèŒƒå¼åŒ–**ï¼šé€‚åº¦åèŒƒå¼åŒ–å‡å°‘JOIN

---

### ç»´åº¦3ï¼šå­˜å‚¨æ•ˆç‡ç»´åº¦

**å­˜å‚¨æ•ˆç‡å¯¹æ¯”åˆ†æ**ï¼š

| è®¾è®¡æ¨¡å¼ | å­˜å‚¨ç©ºé—´ | å†—ä½™åº¦ | å‹ç¼©æ•ˆæœ | æ‰©å±•æ€§ | é€‚ç”¨åœºæ™¯ |
| --- | --- | --- | --- | --- | --- |
| **å®Œå…¨èŒƒå¼åŒ–** | â­â­â­â­â­ | â­ | â­â­â­â­ | â­â­â­â­ | ä¸šåŠ¡ç³»ç»Ÿ |
| **éƒ¨åˆ†èŒƒå¼åŒ–** | â­â­â­â­ | â­â­â­ | â­â­â­ | â­â­â­ | ä¸­ç­‰ç³»ç»Ÿ |
| **åèŒƒå¼åŒ–** | â­â­ | â­â­â­â­â­ | â­â­ | â­â­ | åˆ†æç³»ç»Ÿ |
| **æ··åˆè®¾è®¡** | â­â­â­ | â­â­â­ | â­â­â­ | â­â­â­â­ | å¤æ‚ç³»ç»Ÿ |

**å­˜å‚¨ä¼˜åŒ–ç­–ç•¥**ï¼š

1. âœ… **æ•°æ®ç±»å‹ä¼˜åŒ–**ï¼šé€‰æ‹©åˆé€‚çš„æ•°æ®ç±»å‹
2. âœ… **å‹ç¼©é…ç½®**ï¼šä½¿ç”¨TOASTå’Œå‹ç¼©
3. âœ… **åˆ†åŒºç­–ç•¥**ï¼šå†å²æ•°æ®å½’æ¡£
4. âœ… **JSONBä¼˜åŒ–**ï¼šåˆç†ä½¿ç”¨JSONBå‡å°‘è¡¨æ•°é‡

---

### ç»´åº¦4ï¼šç»´æŠ¤å¤æ‚åº¦ç»´åº¦

**ç»´æŠ¤å¤æ‚åº¦å¯¹æ¯”åˆ†æ**ï¼š

| è®¾è®¡æ¨¡å¼ | è¡¨æ•°é‡ | å…³ç³»å¤æ‚åº¦ | æ›´æ–°å¤æ‚åº¦ | è¿ç§»å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ |
| --- | --- | --- | --- | --- | --- |
| **å•è¡¨è®¾è®¡** | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | ç®€å•åº”ç”¨ |
| **èŒƒå¼åŒ–è®¾è®¡** | â­â­ | â­â­ | â­â­ | â­â­ | ä¸šåŠ¡ç³»ç»Ÿ |
| **åèŒƒå¼åŒ–è®¾è®¡** | â­â­â­â­ | â­â­â­â­ | â­â­â­ | â­â­â­ | åˆ†æç³»ç»Ÿ |
| **æ··åˆè®¾è®¡** | â­â­â­ | â­â­â­ | â­â­â­ | â­â­â­ | å¤æ‚ç³»ç»Ÿ |

**ç»´æŠ¤ä¼˜åŒ–ç­–ç•¥**ï¼š

1. âœ… **æ–‡æ¡£å®Œå–„**ï¼šè¯¦ç»†çš„è®¾è®¡æ–‡æ¡£
2. âœ… **å‘½åè§„èŒƒ**ï¼šç»Ÿä¸€çš„å‘½åè§„èŒƒ
3. âœ… **ç‰ˆæœ¬æ§åˆ¶**ï¼šæ•°æ®åº“è¿ç§»ç‰ˆæœ¬æ§åˆ¶
4. âœ… **è‡ªåŠ¨åŒ–æµ‹è¯•**ï¼šæ•°æ®æ¨¡å‹æµ‹è¯•

---

## ğŸ“Š è¯æ˜æ ‘ç½‘ï¼šèŒƒå¼åŒ–è®¾è®¡çš„æ­£ç¡®æ€§è¯æ˜

### è¯æ˜1ï¼šç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰çš„æ­£ç¡®æ€§è¯æ˜

**è¯æ˜ç›®æ ‡**ï¼šè¯æ˜ç¬¬ä¸‰èŒƒå¼è®¾è®¡èƒ½å¤Ÿæ¶ˆé™¤ä¼ é€’ä¾èµ–ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§

**è¯æ˜ç»“æ„**ï¼š

```mermaid
graph TD
    A[3NFæ­£ç¡®æ€§è¯æ˜] --> B[å‰ææ¡ä»¶]
    A --> C[è¯æ˜æ­¥éª¤]
    A --> D[ç»“è®º]

    B --> B1[å…³ç³»Ræ»¡è¶³2NF]
    B --> B2[éä¸»å±æ€§ä¹‹é—´æ— ä¼ é€’ä¾èµ–]
    B --> B3[æ¯ä¸ªéä¸»å±æ€§å®Œå…¨ä¾èµ–äºä¸»é”®]

    C --> C1[æ­¥éª¤1: è¯æ˜æ¶ˆé™¤ä¼ é€’ä¾èµ–]
    C --> C2[æ­¥éª¤2: è¯æ˜æ•°æ®ä¸€è‡´æ€§]
    C --> C3[æ­¥éª¤3: è¯æ˜æ›´æ–°ä¸€è‡´æ€§]

    C1 --> C1A[è¯†åˆ«ä¼ é€’ä¾èµ–]
    C1 --> C1B[åˆ†è§£å…³ç³»æ¶ˆé™¤ä¾èµ–]
    C1 --> C1C[éªŒè¯åˆ†è§£æ— æŸ]

    C2 --> C2A[å¤–é”®çº¦æŸä¿è¯ä¸€è‡´æ€§]
    C2 --> C2B[æ›´æ–°æ“ä½œåŸå­æ€§]
    C2 --> C2C[æ•°æ®çŠ¶æ€ä¸€è‡´]

    C3 --> C3A[å•ç‚¹æ›´æ–°]
    C3 --> C3B[æ— å†—ä½™æ›´æ–°]
    C3 --> C3C[æ›´æ–°æ“ä½œç®€å•]

    D --> D1[3NFè®¾è®¡æ­£ç¡®]
    D --> D2[æ•°æ®ä¸€è‡´æ€§å¾—åˆ°ä¿è¯]
```

**å½¢å¼åŒ–è¯æ˜**ï¼š

```text
å®šç†ï¼šç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰çš„æ­£ç¡®æ€§

å‰æï¼š
  P1: å…³ç³»Ræ»¡è¶³ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰
  P2: Rçš„æ‰€æœ‰éä¸»å±æ€§éƒ½ä¸ä¼ é€’ä¾èµ–äºä¸»é”®
  P3: æ¯ä¸ªéä¸»å±æ€§å®Œå…¨ä¾èµ–äºä¸»é”®

å®šä¹‰ï¼š
  R(A, B, C): å…³ç³»Rï¼Œå±æ€§Aä¸ºä¸»é”®
  ä¼ é€’ä¾èµ–ï¼šA â†’ B, B â†’ C, åˆ™A â†’ Cï¼ˆä¼ é€’ï¼‰

è¯æ˜ï¼š
  æ­¥éª¤1ï¼šæ¶ˆé™¤ä¼ é€’ä¾èµ–
    å‡è®¾ï¼šRä¸­å­˜åœ¨ä¼ é€’ä¾èµ– A â†’ B â†’ C
    åˆ†è§£ï¼š
      R1(A, B): A â†’ Bï¼ˆç›´æ¥ä¾èµ–ï¼‰
      R2(B, C): B â†’ Cï¼ˆç›´æ¥ä¾èµ–ï¼‰
    éªŒè¯ï¼š
      R1 â¨ R2 = Rï¼ˆæ— æŸåˆ†è§£ï¼‰
    ç»“è®ºï¼šä¼ é€’ä¾èµ–è¢«æ¶ˆé™¤

  æ­¥éª¤2ï¼šæ•°æ®ä¸€è‡´æ€§ä¿è¯
    æ›´æ–°æ“ä½œï¼š
      - æ›´æ–°R1ä¸­çš„Bï¼šå•ç‚¹æ›´æ–°ï¼Œæ— å†—ä½™
      - æ›´æ–°R2ä¸­çš„Cï¼šå•ç‚¹æ›´æ–°ï¼Œæ— å†—ä½™
    å¤–é”®çº¦æŸï¼š
      - R2.B REFERENCES R1.B
      - ä¿è¯å‚ç…§å®Œæ•´æ€§
    ç»“è®ºï¼šæ•°æ®æ›´æ–°ä¸€è‡´

  æ­¥éª¤3ï¼šæŸ¥è¯¢ä¸€è‡´æ€§
    æŸ¥è¯¢æ“ä½œï¼š
      - JOIN R1å’ŒR2æ¢å¤å®Œæ•´ä¿¡æ¯
      - å¤–é”®ä¿è¯æ•°æ®å…³è”æ­£ç¡®
    ç»“è®ºï¼šæŸ¥è¯¢ç»“æœä¸€è‡´

ç»“è®ºï¼š
  C1: 3NFè®¾è®¡æ­£ç¡®
  C2: æ•°æ®ä¸€è‡´æ€§å¾—åˆ°ä¿è¯
  C3: æ›´æ–°æ“ä½œç®€å•é«˜æ•ˆ
```

---

### è¯æ˜2ï¼šBCNFçš„æ­£ç¡®æ€§è¯æ˜

**è¯æ˜ç›®æ ‡**ï¼šè¯æ˜BCNFè®¾è®¡èƒ½å¤Ÿæ¶ˆé™¤æ‰€æœ‰å‡½æ•°ä¾èµ–ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§

**è¯æ˜ç»“æ„**ï¼š

```mermaid
graph TD
    A[BCNFæ­£ç¡®æ€§è¯æ˜] --> B[å‰ææ¡ä»¶]
    A --> C[è¯æ˜æ­¥éª¤]
    A --> D[ç»“è®º]

    B --> B1[å…³ç³»Ræ»¡è¶³3NF]
    B --> B2[æ‰€æœ‰å†³å®šå› ç´ éƒ½æ˜¯å€™é€‰é”®]
    B --> B3[æ— éƒ¨åˆ†ä¾èµ–å’Œä¼ é€’ä¾èµ–]

    C --> C1[æ­¥éª¤1: è¯æ˜æ¶ˆé™¤æ‰€æœ‰ä¾èµ–]
    C --> C2[æ­¥éª¤2: è¯æ˜æ•°æ®ä¸€è‡´æ€§]
    C --> C3[æ­¥éª¤3: è¯æ˜æ›´æ–°ä¸€è‡´æ€§]

    C1 --> C1A[è¯†åˆ«æ‰€æœ‰å‡½æ•°ä¾èµ–]
    C1 --> C1B[åˆ†è§£å…³ç³»æ¶ˆé™¤ä¾èµ–]
    C1 --> C1C[éªŒè¯BCNFæ€§è´¨]

    C2 --> C2A[æ¯ä¸ªå…³ç³»åªæœ‰ä¸€ä¸ªå†³å®šå› ç´ ]
    C2 --> C2B[æ›´æ–°æ“ä½œåŸå­æ€§]
    C2 --> C2C[æ•°æ®çŠ¶æ€ä¸€è‡´]

    C3 --> C3A[å•ç‚¹æ›´æ–°]
    C3 --> C3B[æ— å†—ä½™æ›´æ–°]
    C3 --> C3C[æ›´æ–°æ“ä½œç®€å•]

    D --> D1[BCNFè®¾è®¡æ­£ç¡®]
    D --> D2[æ•°æ®ä¸€è‡´æ€§å¾—åˆ°æœ€å¼ºä¿è¯]
```

**å½¢å¼åŒ–è¯æ˜**ï¼š

```text
å®šç†ï¼šBCNFçš„æ­£ç¡®æ€§

å‰æï¼š
  P1: å…³ç³»Ræ»¡è¶³ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰
  P2: Rçš„æ‰€æœ‰å†³å®šå› ç´ éƒ½æ˜¯å€™é€‰é”®
  P3: ä¸å­˜åœ¨éå¹³å‡¡å‡½æ•°ä¾èµ– X â†’ Yï¼Œå…¶ä¸­Xä¸æ˜¯è¶…é”®

å®šä¹‰ï¼š
  BCNF: å¯¹äºRä¸­çš„æ¯ä¸ªéå¹³å‡¡å‡½æ•°ä¾èµ– X â†’ Yï¼ŒXå¿…é¡»æ˜¯è¶…é”®

è¯æ˜ï¼š
  æ­¥éª¤1ï¼šBCNFæ€§è´¨
    å¯¹äºæ¯ä¸ªå‡½æ•°ä¾èµ– X â†’ Yï¼š
      - å¦‚æœXæ˜¯è¶…é”®ï¼šæ»¡è¶³BCNF
      - å¦‚æœXä¸æ˜¯è¶…é”®ï¼šè¿åBCNFï¼Œéœ€è¦åˆ†è§£
    åˆ†è§£ç­–ç•¥ï¼š
      - R1(X, Y): X â†’ Yï¼ˆXæ˜¯ä¸»é”®ï¼‰
      - R2(R - Y): ç§»é™¤Y
    ç»“è®ºï¼šæ‰€æœ‰å†³å®šå› ç´ éƒ½æ˜¯å€™é€‰é”®

  æ­¥éª¤2ï¼šæ•°æ®ä¸€è‡´æ€§
    æ›´æ–°æ“ä½œï¼š
      - æ¯ä¸ªå…³ç³»åªæœ‰ä¸€ä¸ªå†³å®šå› ç´ ï¼ˆä¸»é”®ï¼‰
      - æ›´æ–°æ“ä½œå•ç‚¹æ›´æ–°
      - æ— å†—ä½™æ›´æ–°
    å¤–é”®çº¦æŸï¼š
      - ä¿è¯å‚ç…§å®Œæ•´æ€§
    ç»“è®ºï¼šæ•°æ®æ›´æ–°ä¸€è‡´

  æ­¥éª¤3ï¼šæŸ¥è¯¢ä¸€è‡´æ€§
    æŸ¥è¯¢æ“ä½œï¼š
      - JOINæ“ä½œæ¢å¤å®Œæ•´ä¿¡æ¯
      - å¤–é”®ä¿è¯æ•°æ®å…³è”
    ç»“è®ºï¼šæŸ¥è¯¢ç»“æœä¸€è‡´

ç»“è®ºï¼š
  C1: BCNFè®¾è®¡æ­£ç¡®
  C2: æ•°æ®ä¸€è‡´æ€§å¾—åˆ°æœ€å¼ºä¿è¯
  C3: æ›´æ–°æ“ä½œæœ€ç®€å•
```

---

### è¯æ˜3ï¼šåèŒƒå¼åŒ–è®¾è®¡çš„æ€§èƒ½ä¼˜åŠ¿è¯æ˜

**è¯æ˜ç›®æ ‡**ï¼šè¯æ˜é€‚åº¦åèŒƒå¼åŒ–èƒ½å¤Ÿæå‡æŸ¥è¯¢æ€§èƒ½

**è¯æ˜ç»“æ„**ï¼š

```mermaid
graph TD
    A[åèŒƒå¼åŒ–æ€§èƒ½ä¼˜åŠ¿è¯æ˜] --> B[å‰ææ¡ä»¶]
    A --> C[è¯æ˜æ­¥éª¤]
    A --> D[ç»“è®º]

    B --> B1[æŸ¥è¯¢æ¨¡å¼å·²çŸ¥]
    B --> B2[JOINæ“ä½œé¢‘ç¹]
    B --> B3[è¯»å¤šå†™å°‘åœºæ™¯]

    C --> C1[æ­¥éª¤1: æ€§èƒ½å¯¹æ¯”]
    C --> C2[æ­¥éª¤2: å­˜å‚¨å¼€é”€]
    C --> C3[æ­¥éª¤3: æ›´æ–°å¼€é”€]

    C1 --> C1A[èŒƒå¼åŒ–: éœ€è¦JOIN]
    C1 --> C1B[åèŒƒå¼åŒ–: å•è¡¨æŸ¥è¯¢]
    C1 --> C1C[æ€§èƒ½æå‡: 2-10å€]

    C2 --> C2A[å†—ä½™æ•°æ®å­˜å‚¨]
    C2 --> C2B[å­˜å‚¨ç©ºé—´å¢åŠ ]
    C2 --> C2C[å¯æ¥å—èŒƒå›´å†…]

    C3 --> C3A[æ›´æ–°éœ€è¦æ›´æ–°å¤šå¤„]
    C3 --> C3B[ä½†è¯»æ“ä½œå ä¸»å¯¼]
    C3 --> C3C[æ€»ä½“æ€§èƒ½æå‡]

    D --> D1[åèŒƒå¼åŒ–æ€§èƒ½ä¼˜åŠ¿]
    D --> D2[é€‚ç”¨äºè¯»å¤šå†™å°‘åœºæ™¯]
```

**å½¢å¼åŒ–è¯æ˜**ï¼š

```text
å®šç†ï¼šåèŒƒå¼åŒ–è®¾è®¡çš„æ€§èƒ½ä¼˜åŠ¿

å‰æï¼š
  P1: æŸ¥è¯¢æ¨¡å¼å·²çŸ¥ä¸”ç¨³å®š
  P2: è¯»æ“ä½œé¢‘ç‡ >> å†™æ“ä½œé¢‘ç‡
  P3: JOINæ“ä½œæ˜¯æ€§èƒ½ç“¶é¢ˆ

å®šä¹‰ï¼š
  Q_read: è¯»æ“ä½œé¢‘ç‡
  Q_write: å†™æ“ä½œé¢‘ç‡
  T_join: JOINæ“ä½œæ—¶é—´
  T_single: å•è¡¨æŸ¥è¯¢æ—¶é—´
  S_redundant: å†—ä½™å­˜å‚¨ç©ºé—´

è¯æ˜ï¼š
  æ­¥éª¤1ï¼šæŸ¥è¯¢æ€§èƒ½æå‡
    èŒƒå¼åŒ–è®¾è®¡ï¼š
      T_query = T_single + T_join
      T_join >> T_single
    åèŒƒå¼åŒ–è®¾è®¡ï¼š
      T_query = T_single
    æ€§èƒ½æå‡ï¼š
      Speedup = T_join / T_single
      é€šå¸¸ï¼šSpeedup = 2-10å€

  æ­¥éª¤2ï¼šå­˜å‚¨å¼€é”€
    å†—ä½™æ•°æ®ï¼š
      S_redundant = Î£(redundant_data_size)
    å­˜å‚¨å¢åŠ ï¼š
      Storage_increase = S_redundant / S_total
    é€šå¸¸ï¼šStorage_increase < 20%ï¼ˆå¯æ¥å—ï¼‰

  æ­¥éª¤3ï¼šæ›´æ–°å¼€é”€
    èŒƒå¼åŒ–è®¾è®¡ï¼š
      T_update = T_singleï¼ˆå•ç‚¹æ›´æ–°ï¼‰
    åèŒƒå¼åŒ–è®¾è®¡ï¼š
      T_update = T_single Ã— Nï¼ˆNä¸ªå†—ä½™ç‚¹ï¼‰
    ä½†ï¼šQ_write << Q_read
    æ€»ä½“æ€§èƒ½ï¼š
      T_total = Q_read Ã— T_query + Q_write Ã— T_update
      åèŒƒå¼åŒ–ï¼šT_total < èŒƒå¼åŒ–ï¼ˆè¯»å¤šå†™å°‘ï¼‰

ç»“è®ºï¼š
  C1: åèŒƒå¼åŒ–åœ¨è¯»å¤šå†™å°‘åœºæ™¯ä¸‹æ€§èƒ½ä¼˜åŠ¿æ˜æ˜¾
  C2: å­˜å‚¨å¼€é”€åœ¨å¯æ¥å—èŒƒå›´å†…
  C3: é€‚ç”¨äºåˆ†æç³»ç»Ÿã€æŠ¥è¡¨ç³»ç»Ÿ
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ•°æ®åº“è®¾è®¡å®Œæ•´æŒ‡å—-æ­£åç¤ºä¾‹ä¸å¤šç»´åˆ†æ.md](../16-åº”ç”¨è®¾è®¡ä¸å¼€å‘/æ•°æ®åº“è®¾è®¡å®Œæ•´æŒ‡å—-æ­£åç¤ºä¾‹ä¸å¤šç»´åˆ†æ.md) - æ•°æ®åº“è®¾è®¡æŒ‡å—
- [æ•°æ®å»ºæ¨¡å®Œæ•´æŒ‡å—](./09.02-æ•°æ®å»ºæ¨¡å®Œæ•´æŒ‡å—.md) - æ•°æ®å»ºæ¨¡å®Œæ•´æŒ‡å—
- [æ•°æ®åˆ†æå®Œæ•´æŒ‡å—](./09.01-æ•°æ®åˆ†æå®Œæ•´æŒ‡å—.md) - æ•°æ®åˆ†ææŒ‡å—
- [æ•°æ®ä»“åº“è®¾è®¡æŒ‡å—](./09.03-æ•°æ®ä»“åº“è®¾è®¡æŒ‡å—.md) - æ•°æ®ä»“åº“è®¾è®¡
- [01-æ ¸å¿ƒåŸºç¡€](../01-æ ¸å¿ƒåŸºç¡€/README.md) - æ ¸å¿ƒåŸºç¡€ç†è®º

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**çŠ¶æ€**: âœ… å®Œæˆ
