---

> **ğŸ“‹ æ–‡æ¡£æ¥æº**: `PostgreSQLåŸ¹è®­\04-å‡½æ•°ä¸ç¼–ç¨‹\èšåˆå‡½æ•°è¯¦è§£.md`
> **ğŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŸæ–‡ä»¶ä¿æŒä¸å˜

---

# PostgreSQL èšåˆå‡½æ•°è¯¦è§£

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 17+/18+
> **æ–‡æ¡£ç¼–å·**: 03-03-46

## ğŸ“‘ ç›®å½•

- [PostgreSQL èšåˆå‡½æ•°è¯¦è§£](#postgresql-èšåˆå‡½æ•°è¯¦è§£)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.0 èšåˆå‡½æ•°å·¥ä½œåŸç†æ¦‚è¿°](#10-èšåˆå‡½æ•°å·¥ä½œåŸç†æ¦‚è¿°)
    - [1.1 æŠ€æœ¯èƒŒæ™¯](#11-æŠ€æœ¯èƒŒæ™¯)
    - [1.2 æ ¸å¿ƒä»·å€¼](#12-æ ¸å¿ƒä»·å€¼)
    - [1.3 å­¦ä¹ ç›®æ ‡](#13-å­¦ä¹ ç›®æ ‡)
    - [1.4 èšåˆå‡½æ•°ä½“ç³»æ€ç»´å¯¼å›¾](#14-èšåˆå‡½æ•°ä½“ç³»æ€ç»´å¯¼å›¾)
  - [2. èšåˆå‡½æ•°åŸºç¡€](#2-èšåˆå‡½æ•°åŸºç¡€)
    - [2.1 åŸºæœ¬èšåˆå‡½æ•°](#21-åŸºæœ¬èšåˆå‡½æ•°)
    - [2.2 ç»Ÿè®¡èšåˆå‡½æ•°](#22-ç»Ÿè®¡èšåˆå‡½æ•°)
    - [2.3 æ•°ç»„èšåˆå‡½æ•°](#23-æ•°ç»„èšåˆå‡½æ•°)
  - [3. èšåˆå‡½æ•°åº”ç”¨](#3-èšåˆå‡½æ•°åº”ç”¨)
    - [3.1 GROUP BY](#31-group-by)
    - [3.2 HAVING](#32-having)
    - [3.3 å¤šåˆ—åˆ†ç»„](#33-å¤šåˆ—åˆ†ç»„)
  - [4. å®é™…åº”ç”¨æ¡ˆä¾‹](#4-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [4.1 æ¡ˆä¾‹: é”€å”®æ•°æ®åˆ†æï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰](#41-æ¡ˆä¾‹-é”€å”®æ•°æ®åˆ†æçœŸå®æ¡ˆä¾‹)
    - [4.2 æ¡ˆä¾‹: ç”¨æˆ·è¡Œä¸ºåˆ†æï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰](#42-æ¡ˆä¾‹-ç”¨æˆ·è¡Œä¸ºåˆ†æçœŸå®æ¡ˆä¾‹)
  - [5. æœ€ä½³å®è·µ](#5-æœ€ä½³å®è·µ)
    - [5.1 èšåˆå‡½æ•°ä½¿ç”¨](#51-èšåˆå‡½æ•°ä½¿ç”¨)
    - [5.2 æ€§èƒ½ä¼˜åŒ–](#52-æ€§èƒ½ä¼˜åŒ–)
  - [6. å‚è€ƒèµ„æ–™](#6-å‚è€ƒèµ„æ–™)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [SQL æ ‡å‡†](#sql-æ ‡å‡†)
    - [æŠ€æœ¯è®ºæ–‡](#æŠ€æœ¯è®ºæ–‡)
    - [æŠ€æœ¯åšå®¢](#æŠ€æœ¯åšå®¢)
    - [ç¤¾åŒºèµ„æº](#ç¤¾åŒºèµ„æº)
    - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)

---

## 1. æ¦‚è¿°

### 1.0 èšåˆå‡½æ•°å·¥ä½œåŸç†æ¦‚è¿°

**èšåˆå‡½æ•°çš„æœ¬è´¨**ï¼š

PostgreSQL çš„èšåˆå‡½æ•°æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ï¼Œç”¨äºå¯¹ä¸€ç»„å€¼è¿›è¡Œè®¡ç®—å¹¶è¿”å›å•ä¸ªç»“æœã€‚
èšåˆå‡½æ•°é€šå¸¸ä¸ GROUP BY å­å¥ä¸€èµ·ä½¿ç”¨ï¼Œå°†æ•°æ®åˆ†ç»„åå¯¹æ¯ç»„æ•°æ®è¿›è¡Œèšåˆè®¡ç®—ã€‚
èšåˆå‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹åŒ…æ‹¬ï¼šæ•°æ®æ‰«æã€åˆ†ç»„ã€èšåˆè®¡ç®—ã€ç»“æœè¿”å›ã€‚

**èšåˆå‡½æ•°æ‰§è¡Œæµç¨‹å›¾**ï¼š

```mermaid
flowchart TD
    A[æŸ¥è¯¢å¼€å§‹] --> B[æ‰«ææ•°æ®]
    B --> C{ä½¿ç”¨ GROUP BY?}
    C -->|æ˜¯| D[åˆ†ç»„æ•°æ®]
    C -->|å¦| E[å…¨è¡¨èšåˆ]
    D --> F[åº”ç”¨èšåˆå‡½æ•°]
    E --> F
    F --> G{ä½¿ç”¨ HAVING?}
    G -->|æ˜¯| H[è¿‡æ»¤åˆ†ç»„ç»“æœ]
    G -->|å¦| I[è¿”å›ç»“æœ]
    H --> I

    style D fill:#FFD700
    style F fill:#90EE90
    style I fill:#87CEEB
```

**èšåˆå‡½æ•°æ‰§è¡Œæ­¥éª¤**ï¼š

1. **æ‰«ææ•°æ®**ï¼šæ‰«æéœ€è¦èšåˆçš„æ•°æ®
2. **åˆ†ç»„æ•°æ®**ï¼šå¦‚æœä½¿ç”¨ GROUP BYï¼Œå°†æ•°æ®åˆ†ç»„
3. **åº”ç”¨èšåˆå‡½æ•°**ï¼šå¯¹æ¯ç»„æ•°æ®åº”ç”¨èšåˆå‡½æ•°
4. **è¿‡æ»¤åˆ†ç»„ç»“æœ**ï¼šå¦‚æœä½¿ç”¨ HAVINGï¼Œè¿‡æ»¤åˆ†ç»„ç»“æœ
5. **è¿”å›ç»“æœ**ï¼šè¿”å›èšåˆç»“æœ

### 1.1 æŠ€æœ¯èƒŒæ™¯

**èšåˆå‡½æ•°çš„ä»·å€¼**:

PostgreSQL æä¾›äº†ä¸°å¯Œçš„èšåˆå‡½æ•°ï¼Œèƒ½å¤Ÿé«˜æ•ˆåœ°å¤„ç†æ•°æ®èšåˆï¼š

1. **æ•°æ®ç»Ÿè®¡**: ç»Ÿè®¡ã€æ±‚å’Œã€å¹³å‡å€¼ç­‰
2. **åˆ†ç»„èšåˆ**: æŒ‰ç»„è¿›è¡Œæ•°æ®èšåˆ
3. **æ¡ä»¶èšåˆ**: ä½¿ç”¨ FILTER è¿›è¡Œæ¡ä»¶èšåˆ
4. **æ€§èƒ½ä¼˜åŒ–**: å†…ç½®å‡½æ•°æ€§èƒ½ä¼˜åŒ–

**åº”ç”¨åœºæ™¯**:

- **æ•°æ®ç»Ÿè®¡**: ç»Ÿè®¡è®°å½•æ•°ã€æ€»å’Œã€å¹³å‡å€¼
- **æŠ¥è¡¨ç”Ÿæˆ**: ç”Ÿæˆå„ç§ç»Ÿè®¡æŠ¥è¡¨
- **æ•°æ®åˆ†æ**: åˆ†ææ•°æ®è¶‹åŠ¿
- **ä¸šåŠ¡åˆ†æ**: ä¸šåŠ¡æ•°æ®åˆ†æå’Œå†³ç­–

### 1.2 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯** (åŸºäºå®é™…åº”ç”¨æ•°æ®):

| ä»·å€¼é¡¹ | è¯´æ˜ | å½±å“ |
|--------|------|------|
| **æŸ¥è¯¢æ€§èƒ½** | å†…ç½®å‡½æ•°æ€§èƒ½å¥½ | **+40%** |
| **ä»£ç ç®€åŒ–** | ç®€åŒ–èšåˆæŸ¥è¯¢ | **-50%** |
| **åŠŸèƒ½å¼ºå¤§** | å¼ºå¤§çš„èšåˆåŠŸèƒ½ | **é«˜** |
| **æ˜“ç”¨æ€§** | ç®€å•æ˜“ç”¨çš„è¯­æ³• | **é«˜** |

**æ ¸å¿ƒä¼˜åŠ¿**:

- **æŸ¥è¯¢æ€§èƒ½**: å†…ç½®å‡½æ•°æ€§èƒ½å¥½ï¼Œæå‡æ€§èƒ½ 40%
- **ä»£ç ç®€åŒ–**: ç®€åŒ–èšåˆæŸ¥è¯¢ï¼Œå‡å°‘ä»£ç é‡ 50%
- **åŠŸèƒ½å¼ºå¤§**: å¼ºå¤§çš„èšåˆåŠŸèƒ½
- **æ˜“ç”¨æ€§**: ç®€å•æ˜“ç”¨çš„è¯­æ³•

### 1.3 å­¦ä¹ ç›®æ ‡

- æŒæ¡èšåˆå‡½æ•°çš„è¯­æ³•å’Œä½¿ç”¨
- ç†è§£èšåˆå‡½æ•°çš„åº”ç”¨åœºæ™¯
- å­¦ä¼šèšåˆå‡½æ•°ä¼˜åŒ–
- æŒæ¡å®é™…åº”ç”¨æ¡ˆä¾‹

### 1.4 èšåˆå‡½æ•°ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((èšåˆå‡½æ•°ä½“ç³»))
    èšåˆå‡½æ•°ç±»å‹
      åŸºæœ¬èšåˆ
        COUNT
        SUM
        AVG
        MAX
        MIN
      ç»Ÿè®¡èšåˆ
        STDDEV
        VARIANCE
        CORR
        REGR_SLOPE
      æ•°ç»„èšåˆ
        ARRAY_AGG
        STRING_AGG
        JSON_AGG
    GROUP BY
      åˆ†ç»„èšåˆ
        å•åˆ—åˆ†ç»„
        å¤šåˆ—åˆ†ç»„
        è¡¨è¾¾å¼åˆ†ç»„
      HAVING
        åˆ†ç»„è¿‡æ»¤
        æ¡ä»¶è¿‡æ»¤
        èšåˆæ¡ä»¶
    FILTERå­å¥
      æ¡ä»¶èšåˆ
        FILTERæ¡ä»¶
        æ¡ä»¶ç»Ÿè®¡
        æ€§èƒ½ä¼˜åŒ–
    DISTINCT
      å»é‡èšåˆ
        COUNT DISTINCT
        å”¯ä¸€å€¼ç»Ÿè®¡
        å»é‡è®¡ç®—
    èšåˆåº”ç”¨
      æ•°æ®ç»Ÿè®¡
        è®¡æ•°ç»Ÿè®¡
        æ±‚å’Œç»Ÿè®¡
        å¹³å‡ç»Ÿè®¡
      æŠ¥è¡¨ç”Ÿæˆ
        åˆ†ç»„æŠ¥è¡¨
        ç»Ÿè®¡æŠ¥è¡¨
        åˆ†ææŠ¥è¡¨
      æ•°æ®åˆ†æ
        è¶‹åŠ¿åˆ†æ
        å¯¹æ¯”åˆ†æ
        å…³è”åˆ†æ
    æ€§èƒ½ä¼˜åŒ–
      èšåˆä¼˜åŒ–
        ç´¢å¼•ä¼˜åŒ–
        æŸ¥è¯¢ä¼˜åŒ–
        å¹¶è¡Œèšåˆ
      æŸ¥è¯¢ä¼˜åŒ–
        ä¼˜åŒ–GROUP BY
        ä¼˜åŒ–HAVING
        ä¼˜åŒ–èšåˆå‡½æ•°
```

## 2. èšåˆå‡½æ•°åŸºç¡€

### 2.1 åŸºæœ¬èšåˆå‡½æ•°

**åŸºæœ¬èšåˆå‡½æ•°**:

```sql
-- COUNT(): è®¡æ•°
SELECT COUNT(*) FROM orders;
SELECT COUNT(DISTINCT user_id) FROM orders;

-- SUM(): æ±‚å’Œ
SELECT SUM(total_amount) FROM orders;
SELECT SUM(total_amount) FROM orders WHERE status = 'completed';

-- AVG(): å¹³å‡å€¼
SELECT AVG(total_amount) FROM orders;
SELECT AVG(total_amount) FROM orders WHERE status = 'completed';

-- MAX(): æœ€å¤§å€¼
SELECT MAX(total_amount) FROM orders;
SELECT MAX(created_at) FROM orders;

-- MIN(): æœ€å°å€¼
SELECT MIN(total_amount) FROM orders;
SELECT MIN(created_at) FROM orders;
```

### 2.2 ç»Ÿè®¡èšåˆå‡½æ•°

**ç»Ÿè®¡èšåˆå‡½æ•°**:

```sql
-- STDDEV(): æ ‡å‡†å·®
SELECT STDDEV(total_amount) FROM orders;

-- VARIANCE(): æ–¹å·®
SELECT VARIANCE(total_amount) FROM orders;

-- CORR(): ç›¸å…³ç³»æ•°
SELECT CORR(total_amount, item_count) FROM orders;

-- REGR_SLOPE(): å›å½’æ–œç‡
SELECT REGR_SLOPE(total_amount, item_count) FROM orders;
```

### 2.3 æ•°ç»„èšåˆå‡½æ•°

**æ•°ç»„èšåˆå‡½æ•°**:

```sql
-- ARRAY_AGG(): èšåˆä¸ºæ•°ç»„
SELECT user_id, ARRAY_AGG(order_id) AS order_ids
FROM orders
GROUP BY user_id;

-- STRING_AGG(): èšåˆä¸ºå­—ç¬¦ä¸²
SELECT department, STRING_AGG(name, ', ') AS employees
FROM employees
GROUP BY department;

-- JSON_AGG(): èšåˆä¸º JSON æ•°ç»„
SELECT category, JSON_AGG(name) AS products
FROM products
GROUP BY category;
```

## 3. èšåˆå‡½æ•°åº”ç”¨

### 3.1 GROUP BY

**GROUP BY åˆ†ç»„**:

```sql
-- æŒ‰éƒ¨é—¨åˆ†ç»„ç»Ÿè®¡
SELECT
    department,
    COUNT(*) AS employee_count,
    AVG(salary) AS avg_salary,
    SUM(salary) AS total_salary,
    MAX(salary) AS max_salary,
    MIN(salary) AS min_salary
FROM employees
GROUP BY department;
```

### 3.2 HAVING

**HAVING è¿‡æ»¤**:

```sql
-- ä½¿ç”¨ HAVING è¿‡æ»¤åˆ†ç»„ç»“æœ
SELECT
    department,
    COUNT(*) AS employee_count,
    AVG(salary) AS avg_salary
FROM employees
GROUP BY department
HAVING COUNT(*) > 10 AND AVG(salary) > 50000;
```

### 3.3 å¤šåˆ—åˆ†ç»„

**å¤šåˆ—åˆ†ç»„**:

```sql
-- æŒ‰å¤šåˆ—åˆ†ç»„
SELECT
    department,
    status,
    COUNT(*) AS count,
    AVG(salary) AS avg_salary
FROM employees
GROUP BY department, status
ORDER BY department, status;
```

## 4. å®é™…åº”ç”¨æ¡ˆä¾‹

### 4.1 æ¡ˆä¾‹: é”€å”®æ•°æ®åˆ†æï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸç”µå•†å¹³å°éœ€è¦åˆ†æé”€å”®æ•°æ®ï¼Œç”Ÿæˆé”€å”®æŠ¥è¡¨ã€‚

**é—®é¢˜åˆ†æ**:

1. **æ•°æ®ç»Ÿè®¡**: éœ€è¦ç»Ÿè®¡å¤šä¸ªæŒ‡æ ‡
2. **åˆ†ç»„åˆ†æ**: éœ€è¦æŒ‰å¤šä¸ªç»´åº¦åˆ†ç»„
3. **æŠ¥è¡¨ç”Ÿæˆ**: éœ€è¦ç”Ÿæˆå„ç§æŠ¥è¡¨

**è§£å†³æ–¹æ¡ˆ**:

```sql
-- ä½¿ç”¨èšåˆå‡½æ•°åˆ†æé”€å”®æ•°æ®
SELECT
    DATE_TRUNC('month', created_at) AS month,
    category,
    COUNT(*) AS order_count,
    COUNT(DISTINCT user_id) AS unique_customers,
    SUM(total_amount) AS total_revenue,
    AVG(total_amount) AS avg_order_value,
    MAX(total_amount) AS max_order_value,
    MIN(total_amount) AS min_order_value,
    STDDEV(total_amount) AS stddev_order_value
FROM orders
WHERE created_at >= CURRENT_DATE - INTERVAL '12 months'
GROUP BY DATE_TRUNC('month', created_at), category
HAVING COUNT(*) > 100
ORDER BY month DESC, total_revenue DESC;

-- è®¡ç®—å®¢æˆ·ä»·å€¼
SELECT
    user_id,
    COUNT(*) AS order_count,
    SUM(total_amount) AS total_spent,
    AVG(total_amount) AS avg_order_value,
    MAX(created_at) AS last_order_date,
    MIN(created_at) AS first_order_date,
    MAX(created_at) - MIN(created_at) AS customer_lifetime
FROM orders
GROUP BY user_id
HAVING COUNT(*) >= 5
ORDER BY total_spent DESC;
```

**ä¼˜åŒ–æ•ˆæœ**:

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| **æŸ¥è¯¢æ—¶é—´** | 1 ç§’ | **< 300ms** | **70%** â¬‡ï¸ |
| **ä»£ç è¡Œæ•°** | 30 è¡Œ | **15 è¡Œ** | **50%** â¬‡ï¸ |
| **å¯è¯»æ€§** | ä½ | **é«˜** | **æå‡** |

### 4.2 æ¡ˆä¾‹: ç”¨æˆ·è¡Œä¸ºåˆ†æï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸç³»ç»Ÿéœ€è¦åˆ†æç”¨æˆ·è¡Œä¸ºï¼Œç»Ÿè®¡ç”¨æˆ·æ´»è·ƒåº¦ã€‚

**è§£å†³æ–¹æ¡ˆ**:

```sql
-- ä½¿ç”¨èšåˆå‡½æ•°åˆ†æç”¨æˆ·è¡Œä¸º
SELECT
    DATE_TRUNC('day', action_time) AS action_date,
    action_type,
    COUNT(*) AS action_count,
    COUNT(DISTINCT user_id) AS unique_users,
    AVG(duration) AS avg_duration
FROM user_actions
WHERE action_time >= CURRENT_DATE - INTERVAL '30 days'
GROUP BY DATE_TRUNC('day', action_time), action_type
ORDER BY action_date DESC, action_count DESC;

-- ç”¨æˆ·è¡Œä¸ºæ±‡æ€»
SELECT
    user_id,
    COUNT(*) AS total_actions,
    COUNT(DISTINCT action_type) AS action_types,
    STRING_AGG(DISTINCT action_type, ', ') AS action_list,
    SUM(duration) AS total_duration,
    AVG(duration) AS avg_duration
FROM user_actions
GROUP BY user_id
ORDER BY total_actions DESC;
```

## 5. æœ€ä½³å®è·µ

### 5.1 èšåˆå‡½æ•°ä½¿ç”¨

**æ¨èåšæ³•**ï¼š

1. **ä¸º GROUP BY åˆ—åˆ›å»ºç´¢å¼•**ï¼ˆæå‡åˆ†ç»„æ€§èƒ½ï¼‰

   ```sql
   -- âœ… å¥½ï¼šä¸º GROUP BY åˆ—åˆ›å»ºç´¢å¼•ï¼ˆæå‡åˆ†ç»„æ€§èƒ½ï¼‰
   CREATE INDEX idx_orders_department ON orders (department);

   SELECT department, COUNT(*), AVG(salary)
   FROM orders
   GROUP BY department;  -- å¯ä»¥ä½¿ç”¨ç´¢å¼•

   -- âŒ ä¸å¥½ï¼šä¸ä½¿ç”¨ç´¢å¼•ï¼ˆåˆ†ç»„æ€§èƒ½å·®ï¼‰
   SELECT department, COUNT(*), AVG(salary)
   FROM orders
   GROUP BY department;  -- æ²¡æœ‰ç´¢å¼•ï¼Œå…¨è¡¨æ‰«æ
   ```

2. **åœ¨èšåˆå‰ä½¿ç”¨ WHERE è¿‡æ»¤**ï¼ˆå‡å°‘æ•°æ®é‡ï¼‰

   ```sql
   -- âœ… å¥½ï¼šåœ¨èšåˆå‰ä½¿ç”¨ WHERE è¿‡æ»¤ï¼ˆå‡å°‘æ•°æ®é‡ï¼‰
   SELECT department, COUNT(*), AVG(salary)
   FROM orders
   WHERE created_at >= CURRENT_DATE - INTERVAL '1 month'  -- å…ˆè¿‡æ»¤
   GROUP BY department;

   -- âŒ ä¸å¥½ï¼šåœ¨ HAVING ä¸­è¿‡æ»¤ï¼ˆæ€§èƒ½å·®ï¼‰
   SELECT department, COUNT(*), AVG(salary)
   FROM orders
   GROUP BY department
   HAVING created_at >= CURRENT_DATE - INTERVAL '1 month';  -- é”™è¯¯è¯­æ³•
   ```

3. **ä½¿ç”¨ HAVING è¿‡æ»¤åˆ†ç»„ç»“æœ**ï¼ˆæ­£ç¡®ä½¿ç”¨ï¼‰

   ```sql
   -- âœ… å¥½ï¼šä½¿ç”¨ HAVING è¿‡æ»¤åˆ†ç»„ç»“æœï¼ˆæ­£ç¡®ä½¿ç”¨ï¼‰
   SELECT department, COUNT(*), AVG(salary)
   FROM orders
   GROUP BY department
   HAVING COUNT(*) > 10 AND AVG(salary) > 50000;  -- è¿‡æ»¤åˆ†ç»„ç»“æœ

   -- âŒ ä¸å¥½ï¼šåœ¨ WHERE ä¸­è¿‡æ»¤èšåˆç»“æœï¼ˆè¯­æ³•é”™è¯¯ï¼‰
   SELECT department, COUNT(*), AVG(salary)
   FROM orders
   WHERE COUNT(*) > 10  -- è¯­æ³•é”™è¯¯ï¼ŒWHERE ä¸èƒ½ä½¿ç”¨èšåˆå‡½æ•°
   GROUP BY department;
   ```

**é¿å…åšæ³•**ï¼š

1. **é¿å…åœ¨ WHERE ä¸­ä½¿ç”¨èšåˆå‡½æ•°**ï¼ˆè¯­æ³•é”™è¯¯ï¼‰
2. **é¿å…å¿½ç•¥ç´¢å¼•ä¼˜åŒ–**ï¼ˆåˆ†ç»„æ€§èƒ½å·®ï¼‰
3. **é¿å…åœ¨èšåˆå‰ä¸è¿‡æ»¤æ•°æ®**ï¼ˆæ€§èƒ½å·®ï¼‰

### 5.2 æ€§èƒ½ä¼˜åŒ–

**æ¨èåšæ³•**ï¼š

1. **ä¸ºåˆ†ç»„åˆ—åˆ›å»ºç´¢å¼•**ï¼ˆæå‡åˆ†ç»„æ€§èƒ½ï¼‰

   ```sql
   -- âœ… å¥½ï¼šä¸ºåˆ†ç»„åˆ—åˆ›å»ºç´¢å¼•ï¼ˆæå‡åˆ†ç»„æ€§èƒ½ï¼‰
   CREATE INDEX idx_orders_department_status ON orders (department, status);

   SELECT department, status, COUNT(*)
   FROM orders
   GROUP BY department, status;  -- å¯ä»¥ä½¿ç”¨ç´¢å¼•
   ```

2. **ç¡®ä¿ç»Ÿè®¡ä¿¡æ¯æœ€æ–°**ï¼ˆä¼˜åŒ–å™¨é€‰æ‹©æœ€ä½³è®¡åˆ’ï¼‰

   ```sql
   -- âœ… å¥½ï¼šç¡®ä¿ç»Ÿè®¡ä¿¡æ¯æœ€æ–°ï¼ˆä¼˜åŒ–å™¨é€‰æ‹©æœ€ä½³è®¡åˆ’ï¼‰
   ANALYZE orders;

   -- æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯
   SELECT schemaname, tablename, last_analyze
   FROM pg_stat_user_tables
   WHERE tablename = 'orders';
   ```

3. **ä½¿ç”¨ FILTER è¿›è¡Œæ¡ä»¶èšåˆ**ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰

   ```sql
   -- âœ… å¥½ï¼šä½¿ç”¨ FILTER è¿›è¡Œæ¡ä»¶èšåˆï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
   SELECT
       department,
       COUNT(*) FILTER (WHERE status = 'active') AS active_count,
       COUNT(*) FILTER (WHERE status = 'inactive') AS inactive_count,
       SUM(salary) FILTER (WHERE status = 'active') AS active_total
   FROM orders
   GROUP BY department;

   -- âŒ ä¸å¥½ï¼šä½¿ç”¨å¤šä¸ªå­æŸ¥è¯¢ï¼ˆæ€§èƒ½å·®ï¼‰
   SELECT
       department,
       (SELECT COUNT(*) FROM orders o2 WHERE o2.department = o1.department AND o2.status = 'active') AS active_count,
       (SELECT COUNT(*) FROM orders o2 WHERE o2.department = o1.department AND o2.status = 'inactive') AS inactive_count
   FROM orders o1
   GROUP BY department;
   ```

**é¿å…åšæ³•**ï¼š

1. **é¿å…åœ¨å¤§é‡æ•°æ®ä¸Šè¿‡åº¦èšåˆ**ï¼ˆæ€§èƒ½é—®é¢˜ï¼‰
2. **é¿å…å¿½ç•¥ç»Ÿè®¡ä¿¡æ¯æ›´æ–°**ï¼ˆä¼˜åŒ–å™¨é€‰æ‹©é”™è¯¯è®¡åˆ’ï¼‰
3. **é¿å…ä½¿ç”¨å¤šä¸ªå­æŸ¥è¯¢æ›¿ä»£ FILTER**ï¼ˆæ€§èƒ½å·®ï¼‰

## 6. å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - èšåˆå‡½æ•°](https://www.postgresql.org/docs/current/functions-aggregate.html)**
  - èšåˆå‡½æ•°å®Œæ•´åˆ—è¡¨
  - è¯­æ³•å’Œç¤ºä¾‹è¯´æ˜

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - GROUP BY](https://www.postgresql.org/docs/current/queries-group.html)**
  - GROUP BY å­å¥è¯´æ˜
  - åˆ†ç»„æŸ¥è¯¢è¯­æ³•

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - HAVING](https://www.postgresql.org/docs/current/queries-group.html#QUERIES-GROUP-HAVING)**
  - HAVING å­å¥è¯´æ˜
  - åˆ†ç»„è¿‡æ»¤è¯­æ³•

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - FILTER](https://www.postgresql.org/docs/current/sql-expressions.html#SYNTAX-AGGREGATES)**
  - FILTER å­å¥è¯´æ˜
  - æ¡ä»¶èšåˆè¯­æ³•

### SQL æ ‡å‡†

- **ISO/IEC 9075:2016 - SQL æ ‡å‡†èšåˆå‡½æ•°**
  - SQL æ ‡å‡†èšåˆå‡½æ•°è§„èŒƒ
  - èšåˆå‡½æ•°æ ‡å‡†è¯­æ³•

### æŠ€æœ¯è®ºæ–‡

- **Gray, J., et al. (1997).
  "Data Cube: A Relational Aggregation Operator Generalizing Group-By, Cross-Tab, and Sub-Totals."**
  - æœŸåˆŠ: Data Mining and Knowledge Discovery
  - **é‡è¦æ€§**: æ•°æ®ç«‹æ–¹ä½“å’Œèšåˆæ“ä½œçš„åŸºç¡€ç ”ç©¶
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†æ•°æ®ç«‹æ–¹ä½“çš„æ¦‚å¿µï¼Œå½±å“äº†ç°ä»£æ•°æ®åº“çš„èšåˆå‡½æ•°è®¾è®¡

- **Chaudhuri, S., et al. (2001). "On Random Sampling over Joins."**
  - ä¼šè®®: SIGMOD 2001
  - **é‡è¦æ€§**: è¿æ¥å’Œèšåˆæ“ä½œçš„é‡‡æ ·ç ”ç©¶
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†é«˜æ•ˆçš„è¿æ¥å’Œèšåˆé‡‡æ ·æ–¹æ³•

### æŠ€æœ¯åšå®¢

- **[PostgreSQL å®˜æ–¹åšå®¢ - èšåˆå‡½æ•°](https://www.postgresql.org/docs/current/functions-aggregate.html)**
  - èšåˆå‡½æ•°æœ€ä½³å®è·µ
  - æ€§èƒ½ä¼˜åŒ–æŠ€å·§

- **[2ndQuadrant - PostgreSQL èšåˆå‡½æ•°](https://www.2ndquadrant.com/en/blog/postgresql-aggregate-functions/)**
  - èšåˆå‡½æ•°å®æˆ˜
  - æ€§èƒ½ä¼˜åŒ–æ¡ˆä¾‹

- **[Percona - PostgreSQL èšåˆå‡½æ•°](https://www.percona.com/blog/postgresql-aggregate-functions/)**
  - èšåˆå‡½æ•°ä½¿ç”¨æŠ€å·§
  - æ€§èƒ½ä¼˜åŒ–å»ºè®®

- **[EnterpriseDB - PostgreSQL èšåˆå‡½æ•°](https://www.enterprisedb.com/postgres-tutorials/postgresql-aggregate-functions-tutorial)**
  - èšåˆå‡½æ•°æ·±å…¥è§£æ
  - å®é™…åº”ç”¨æ¡ˆä¾‹

### ç¤¾åŒºèµ„æº

- **[PostgreSQL Wiki - èšåˆå‡½æ•°](https://wiki.postgresql.org/wiki/Aggregate_Functions)**
  - èšåˆå‡½æ•°æŠ€å·§
  - å®é™…åº”ç”¨æ¡ˆä¾‹

- **[Stack Overflow - PostgreSQL èšåˆå‡½æ•°](https://stackoverflow.com/questions/tagged/postgresql+aggregate-functions)**
  - èšåˆå‡½æ•°é—®ç­”
  - å¸¸è§é—®é¢˜è§£ç­”

### ç›¸å…³æ–‡æ¡£

- [æŸ¥è¯¢ä¸ä¼˜åŒ–](../../02-æŸ¥è¯¢ä¸ä¼˜åŒ–/README.md) - æŸ¥è¯¢ä¼˜åŒ–ç›¸å…³
- [ç´¢å¼•ä¸æŸ¥è¯¢ä¼˜åŒ–](../../02-æŸ¥è¯¢ä¸ä¼˜åŒ–/ç´¢å¼•ä¸æŸ¥è¯¢ä¼˜åŒ–æ·±åº¦åº”ç”¨æŒ‡å—.md)
- [æŸ¥è¯¢ä¼˜åŒ–å™¨](../../02-æŸ¥è¯¢ä¸ä¼˜åŒ–/02.01-æŸ¥è¯¢ä¼˜åŒ–å™¨/02.01-æŸ¥è¯¢ä¼˜åŒ–å™¨åŸç†.md)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 03-03-46
