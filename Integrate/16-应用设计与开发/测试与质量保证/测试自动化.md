# PostgreSQLæµ‹è¯•è‡ªåŠ¨åŒ–æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 17+/18+
> **éš¾åº¦ç­‰çº§**: â­â­â­â­ é«˜çº§

---

## ğŸ“‹ ç›®å½•

- [PostgreSQLæµ‹è¯•è‡ªåŠ¨åŒ–æŒ‡å—](#postgresqlæµ‹è¯•è‡ªåŠ¨åŒ–æŒ‡å—)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
  - [2. CI/CDé›†æˆ](#2-cicdé›†æˆ)
  - [3. è‡ªåŠ¨åŒ–è„šæœ¬](#3-è‡ªåŠ¨åŒ–è„šæœ¬)
  - [4. æµ‹è¯•æŠ¥å‘Š](#4-æµ‹è¯•æŠ¥å‘Š)
  - [5. æœ€ä½³å®è·µ](#5-æœ€ä½³å®è·µ)

---

## 1. æ¦‚è¿°

æµ‹è¯•è‡ªåŠ¨åŒ–æé«˜æµ‹è¯•æ•ˆç‡ï¼Œç¡®ä¿ä»£ç è´¨é‡ã€‚

**è‡ªåŠ¨åŒ–ä¼˜åŠ¿**:
- æé«˜æ•ˆç‡
- å‡å°‘äººä¸ºé”™è¯¯
- æŒç»­éªŒè¯
- å¿«é€Ÿåé¦ˆ

---

## 2. CI/CDé›†æˆ

### 2.1 GitHub Actions

```yaml
name: PostgreSQL Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    services:
      postgres:
        image: postgres:18
        env:
          POSTGRES_PASSWORD: postgres
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

    steps:
      - uses: actions/checkout@v2
      - name: Install pgTAP
        run: |
          sudo apt-get update
          sudo apt-get install -y pgtap
      - name: Run tests
        run: |
          pg_prove -d postgres tests/
```

### 2.2 GitLab CI

```yaml
test:
  image: postgres:18
  services:
    - postgres:18
  variables:
    POSTGRES_DB: testdb
    POSTGRES_USER: postgres
    POSTGRES_PASSWORD: postgres
  script:
    - apt-get update && apt-get install -y pgtap
    - pg_prove -d testdb tests/
```

---

## 3. è‡ªåŠ¨åŒ–è„šæœ¬

### 3.1 æµ‹è¯•è„šæœ¬

```bash
#!/bin/bash
# run_tests.sh

set -e

DB_NAME="testdb"
TEST_DIR="tests"

echo "Running PostgreSQL tests..."

# è¿è¡Œå•å…ƒæµ‹è¯•
pg_prove -d $DB_NAME $TEST_DIR/unit/

# è¿è¡Œé›†æˆæµ‹è¯•
pg_prove -d $DB_NAME $TEST_DIR/integration/

# è¿è¡Œæ€§èƒ½æµ‹è¯•
pgbench -i -s 10 $DB_NAME
pgbench -c 10 -j 2 -T 60 $DB_NAME

echo "All tests passed!"
```

### 3.2 æµ‹è¯•æ•°æ®å‡†å¤‡

```bash
#!/bin/bash
# setup_test_data.sh

psql -d testdb <<EOF
-- åˆ›å»ºæµ‹è¯•æ•°æ®
INSERT INTO users (name, email) VALUES
    ('User1', 'user1@example.com'),
    ('User2', 'user2@example.com');

-- åˆ›å»ºæµ‹è¯•è®¢å•
INSERT INTO orders (user_id, amount)
SELECT id, 100 FROM users;
EOF
```

---

## 4. æµ‹è¯•æŠ¥å‘Š

### 4.1 ç”ŸæˆæŠ¥å‘Š

```bash
# ç”ŸæˆHTMLæŠ¥å‘Š
pg_prove -d testdb --formatter TAP::Formatter::HTML tests/ > report.html

# ç”ŸæˆJUnitæŠ¥å‘Š
pg_prove -d testdb --formatter TAP::Formatter::JUnit tests/ > report.xml
```

### 4.2 æŠ¥å‘Šå†…å®¹

```text
- æµ‹è¯•ç”¨ä¾‹æ•°
- é€šè¿‡/å¤±è´¥æ•°
- æ‰§è¡Œæ—¶é—´
- é”™è¯¯è¯¦æƒ…
```

---

## 5. æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•

1. **è‡ªåŠ¨åŒ–æ‰€æœ‰æµ‹è¯•** - å•å…ƒã€é›†æˆã€æ€§èƒ½
2. **é›†æˆåˆ°CI/CD** - æ¯æ¬¡æäº¤è‡ªåŠ¨æµ‹è¯•
3. **æµ‹è¯•æ•°æ®ç®¡ç†** - ä½¿ç”¨ç‹¬ç«‹çš„æµ‹è¯•æ•°æ®
4. **æµ‹è¯•æŠ¥å‘Š** - ç”Ÿæˆè¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Š

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æµ‹è¯•å®Œæ•´æŒ‡å—.md](./æµ‹è¯•å®Œæ•´æŒ‡å—.md) - æµ‹è¯•å®Œæ•´æŒ‡å—
- [å•å…ƒæµ‹è¯•.md](./å•å…ƒæµ‹è¯•.md) - å•å…ƒæµ‹è¯•è¯¦è§£
- [é›†æˆæµ‹è¯•.md](./é›†æˆæµ‹è¯•.md) - é›†æˆæµ‹è¯•è¯¦è§£
- [16-åº”ç”¨è®¾è®¡ä¸å¼€å‘/README.md](../README.md) - åº”ç”¨è®¾è®¡ä¸å¼€å‘ä¸»é¢˜

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
