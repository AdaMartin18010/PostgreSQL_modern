# PostgreSQLæµ‹è¯•è‡ªåŠ¨åŒ–å®Œæ•´æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 17+/18+
> **éš¾åº¦ç­‰çº§**: â­â­â­â­ é«˜çº§
> **é€‚ç”¨åœºæ™¯**: CI/CDé›†æˆã€è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹ã€æµ‹è¯•æŠ¥å‘Šç”Ÿæˆã€æŒç»­é›†æˆ

---

## ğŸ“‹ ç›®å½•

- [PostgreSQLæµ‹è¯•è‡ªåŠ¨åŒ–å®Œæ•´æŒ‡å—](#postgresqlæµ‹è¯•è‡ªåŠ¨åŒ–å®Œæ•´æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 æµ‹è¯•è‡ªåŠ¨åŒ–çš„é‡è¦æ€§](#11-æµ‹è¯•è‡ªåŠ¨åŒ–çš„é‡è¦æ€§)
    - [1.2 è‡ªåŠ¨åŒ–ä¼˜åŠ¿](#12-è‡ªåŠ¨åŒ–ä¼˜åŠ¿)
    - [1.3 è‡ªåŠ¨åŒ–èŒƒå›´](#13-è‡ªåŠ¨åŒ–èŒƒå›´)
  - [2. CI/CDé›†æˆ](#2-cicdé›†æˆ)
    - [2.1 GitHub Actions](#21-github-actions)
    - [2.2 GitLab CI](#22-gitlab-ci)
    - [2.3 Jenkins](#23-jenkins)
    - [2.4 Azure DevOps](#24-azure-devops)
    - [2.5 CircleCI](#25-circleci)
  - [3. è‡ªåŠ¨åŒ–è„šæœ¬](#3-è‡ªåŠ¨åŒ–è„šæœ¬)
    - [3.1 æµ‹è¯•æ‰§è¡Œè„šæœ¬](#31-æµ‹è¯•æ‰§è¡Œè„šæœ¬)
    - [3.2 æµ‹è¯•æ•°æ®å‡†å¤‡](#32-æµ‹è¯•æ•°æ®å‡†å¤‡)
    - [3.3 æµ‹è¯•ç¯å¢ƒè®¾ç½®](#33-æµ‹è¯•ç¯å¢ƒè®¾ç½®)
    - [3.4 æµ‹è¯•æ¸…ç†è„šæœ¬](#34-æµ‹è¯•æ¸…ç†è„šæœ¬)
  - [4. æµ‹è¯•æŠ¥å‘Š](#4-æµ‹è¯•æŠ¥å‘Š)
    - [4.1 æŠ¥å‘Šç”Ÿæˆ](#41-æŠ¥å‘Šç”Ÿæˆ)
    - [4.2 æŠ¥å‘Šæ ¼å¼](#42-æŠ¥å‘Šæ ¼å¼)
    - [4.3 æŠ¥å‘Šåˆ†æ](#43-æŠ¥å‘Šåˆ†æ)
    - [4.4 æŠ¥å‘Šé€šçŸ¥](#44-æŠ¥å‘Šé€šçŸ¥)
  - [5. æµ‹è¯•è°ƒåº¦](#5-æµ‹è¯•è°ƒåº¦)
    - [5.1 å®šæ—¶æµ‹è¯•](#51-å®šæ—¶æµ‹è¯•)
    - [5.2 äº‹ä»¶è§¦å‘æµ‹è¯•](#52-äº‹ä»¶è§¦å‘æµ‹è¯•)
    - [5.3 å¹¶è¡Œæµ‹è¯•æ‰§è¡Œ](#53-å¹¶è¡Œæµ‹è¯•æ‰§è¡Œ)
  - [6. æµ‹è¯•ç›‘æ§](#6-æµ‹è¯•ç›‘æ§)
    - [6.1 æµ‹è¯•æ‰§è¡Œç›‘æ§](#61-æµ‹è¯•æ‰§è¡Œç›‘æ§)
    - [6.2 æµ‹è¯•ç»“æœç›‘æ§](#62-æµ‹è¯•ç»“æœç›‘æ§)
    - [6.3 æµ‹è¯•è¶‹åŠ¿åˆ†æ](#63-æµ‹è¯•è¶‹åŠ¿åˆ†æ)
  - [7. æœ€ä½³å®è·µ](#7-æœ€ä½³å®è·µ)
    - [7.1 æ¨èåšæ³•](#71-æ¨èåšæ³•)
    - [7.2 å¸¸è§é”™è¯¯](#72-å¸¸è§é”™è¯¯)
    - [7.3 è‡ªåŠ¨åŒ–ç­–ç•¥](#73-è‡ªåŠ¨åŒ–ç­–ç•¥)
  - [ğŸ“š ç›¸å…³æ–‡æ¡£](#-ç›¸å…³æ–‡æ¡£)

---

## 1. æ¦‚è¿°

### 1.1 æµ‹è¯•è‡ªåŠ¨åŒ–çš„é‡è¦æ€§

æµ‹è¯•è‡ªåŠ¨åŒ–æé«˜æµ‹è¯•æ•ˆç‡ï¼Œç¡®ä¿ä»£ç è´¨é‡ï¼Œæ˜¯ç°ä»£è½¯ä»¶å¼€å‘æµç¨‹ä¸­ä¸å¯æˆ–ç¼ºçš„ç¯èŠ‚ã€‚

**è‡ªåŠ¨åŒ–çš„ä»·å€¼**ï¼š

- **æé«˜æ•ˆç‡**ï¼šè‡ªåŠ¨åŒ–æ‰§è¡Œæµ‹è¯•ï¼ŒèŠ‚çœäººåŠ›
- **å‡å°‘é”™è¯¯**ï¼šé¿å…äººä¸ºé”™è¯¯ï¼Œæé«˜å‡†ç¡®æ€§
- **æŒç»­éªŒè¯**ï¼šæ¯æ¬¡ä»£ç å˜æ›´è‡ªåŠ¨éªŒè¯
- **å¿«é€Ÿåé¦ˆ**ï¼šå¿«é€Ÿå‘ç°é—®é¢˜ï¼ŒåŠæ—¶ä¿®å¤
- **æé«˜è¦†ç›–ç‡**ï¼šå¯ä»¥æ‰§è¡Œæ›´å¤šæµ‹è¯•ç”¨ä¾‹

**è‡ªåŠ¨åŒ–ROI**ï¼š

| é˜¶æ®µ | æ‰‹åŠ¨æµ‹è¯•æˆæœ¬ | è‡ªåŠ¨åŒ–æµ‹è¯•æˆæœ¬ | ROI |
|------|------------|--------------|-----|
| **åˆæœŸ** | ä½ | é«˜ | è´Ÿ |
| **ä¸­æœŸ** | ä¸­ | ä¸­ | å¹³è¡¡ |
| **é•¿æœŸ** | é«˜ | ä½ | æ­£ |

### 1.2 è‡ªåŠ¨åŒ–ä¼˜åŠ¿

**è‡ªåŠ¨åŒ–ä¼˜åŠ¿**:

- **æé«˜æ•ˆç‡**ï¼š24/7è‡ªåŠ¨æ‰§è¡Œï¼Œæ— éœ€äººå·¥å¹²é¢„
- **å‡å°‘äººä¸ºé”™è¯¯**ï¼šé¿å…äººä¸ºæ“ä½œé”™è¯¯
- **æŒç»­éªŒè¯**ï¼šæ¯æ¬¡ä»£ç æäº¤è‡ªåŠ¨éªŒè¯
- **å¿«é€Ÿåé¦ˆ**ï¼šå¿«é€Ÿå‘ç°é—®é¢˜ï¼ŒåŠæ—¶ä¿®å¤
- **å¯é‡å¤æ€§**ï¼šæµ‹è¯•ç»“æœå¯é‡å¤ï¼Œä¾¿äºè°ƒè¯•
- **å¹¶è¡Œæ‰§è¡Œ**ï¼šå¯ä»¥å¹¶è¡Œæ‰§è¡Œå¤šä¸ªæµ‹è¯•

### 1.3 è‡ªåŠ¨åŒ–èŒƒå›´

**é€‚åˆè‡ªåŠ¨åŒ–çš„æµ‹è¯•**ï¼š

- âœ… å•å…ƒæµ‹è¯•
- âœ… é›†æˆæµ‹è¯•
- âœ… å›å½’æµ‹è¯•
- âœ… æ€§èƒ½æµ‹è¯•
- âœ… å‹åŠ›æµ‹è¯•
- âš ï¸ UIæµ‹è¯•ï¼ˆéœ€è¦ç‰¹æ®Šå·¥å…·ï¼‰
- âŒ æ¢ç´¢æ€§æµ‹è¯•ï¼ˆä¸é€‚åˆè‡ªåŠ¨åŒ–ï¼‰

---

## 2. CI/CDé›†æˆ

### 2.1 GitHub Actions

**åŸºç¡€GitHub Actionsé…ç½®**ï¼š

```yaml
name: PostgreSQL Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    services:
      postgres:
        image: postgres:18
        env:
          POSTGRES_PASSWORD: postgres
          POSTGRES_DB: testdb
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
        ports:
          - 5432:5432

    steps:
      - uses: actions/checkout@v3

      - name: Install pgTAP
        run: |
          sudo apt-get update
          sudo apt-get install -y postgresql-18-pgtap

      - name: Setup test database
        env:
          PGHOST: localhost
          PGPORT: 5432
          PGUSER: postgres
          PGPASSWORD: postgres
          PGDATABASE: testdb
        run: |
          psql -c "CREATE EXTENSION IF NOT EXISTS pgtap;"
          psql -f schema.sql

      - name: Run unit tests
        env:
          PGHOST: localhost
          PGPORT: 5432
          PGUSER: postgres
          PGPASSWORD: postgres
          PGDATABASE: testdb
        run: |
          pg_prove -d testdb tests/unit/

      - name: Run integration tests
        env:
          PGHOST: localhost
          PGPORT: 5432
          PGUSER: postgres
          PGPASSWORD: postgres
          PGDATABASE: testdb
        run: |
          pg_prove -d testdb tests/integration/

      - name: Upload test results
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: test-results
          path: test-results/
```

**å¤šç‰ˆæœ¬PostgreSQLæµ‹è¯•**ï¼š

```yaml
name: PostgreSQL Multi-Version Tests

on: [push, pull_request]

strategy:
  matrix:
    postgres-version: [15, 16, 17, 18]

jobs:
  test:
    runs-on: ubuntu-latest
    services:
      postgres:
        image: postgres:${{ matrix.postgres-version }}
        env:
          POSTGRES_PASSWORD: postgres
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

    steps:
      - uses: actions/checkout@v3
      - name: Install pgTAP
        run: |
          sudo apt-get update
          sudo apt-get install -y postgresql-${{ matrix.postgres-version }}-pgtap
      - name: Run tests
        run: |
          pg_prove -d postgres tests/
```

### 2.2 GitLab CI

**åŸºç¡€GitLab CIé…ç½®**ï¼š

```yaml
stages:
  - test

variables:
  POSTGRES_DB: testdb
  POSTGRES_USER: postgres
  POSTGRES_PASSWORD: postgres

test:
  image: postgres:18
  services:
    - postgres:18
  before_script:
    - apt-get update && apt-get install -y postgresql-18-pgtap
    - psql -c "CREATE EXTENSION IF NOT EXISTS pgtap;"
    - psql -f schema.sql
  script:
    - pg_prove -d testdb tests/unit/
    - pg_prove -d testdb tests/integration/
  artifacts:
    when: always
    paths:
      - test-results/
    reports:
      junit: test-results/junit.xml
```

**GitLab CIå¤šé˜¶æ®µæµ‹è¯•**ï¼š

```yaml
stages:
  - unit-test
  - integration-test
  - performance-test

variables:
  POSTGRES_DB: testdb
  POSTGRES_USER: postgres
  POSTGRES_PASSWORD: postgres

unit-test:
  stage: unit-test
  image: postgres:18
  services:
    - postgres:18
  script:
    - apt-get update && apt-get install -y postgresql-18-pgtap
    - pg_prove -d testdb tests/unit/

integration-test:
  stage: integration-test
  image: postgres:18
  services:
    - postgres:18
  script:
    - apt-get update && apt-get install -y postgresql-18-pgtap
    - pg_prove -d testdb tests/integration/

performance-test:
  stage: performance-test
  image: postgres:18
  services:
    - postgres:18
  script:
    - pgbench -i -s 10 testdb
    - pgbench -c 10 -j 2 -T 60 testdb
```

### 2.3 Jenkins

**Jenkins Pipelineé…ç½®**ï¼š

```groovy
pipeline {
    agent any

    environment {
        POSTGRES_DB = 'testdb'
        POSTGRES_USER = 'postgres'
        POSTGRES_PASSWORD = 'postgres'
    }

    stages {
        stage('Setup') {
            steps {
                sh '''
                    docker run -d --name postgres-test \
                        -e POSTGRES_PASSWORD=postgres \
                        -e POSTGRES_DB=testdb \
                        -p 5432:5432 \
                        postgres:18
                    sleep 10
                '''
            }
        }

        stage('Install pgTAP') {
            steps {
                sh '''
                    docker exec postgres-test \
                        apt-get update && \
                        apt-get install -y postgresql-18-pgtap
                '''
            }
        }

        stage('Run Tests') {
            steps {
                sh '''
                    docker exec postgres-test \
                        pg_prove -d testdb tests/
                '''
            }
        }

        stage('Cleanup') {
            always {
                sh 'docker stop postgres-test && docker rm postgres-test'
            }
        }
    }
}
```

### 2.4 Azure DevOps

**Azure DevOps Pipelineé…ç½®**ï¼š

```yaml
trigger:
  branches:
    include:
      - main
      - develop

pool:
  vmImage: 'ubuntu-latest'

services:
  postgres:
    image: postgres:18
    env:
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: testdb
    ports:
      - 5432:5432

steps:
  - task: UsePythonVersion@0
    inputs:
      versionSpec: '3.x'

  - script: |
      sudo apt-get update
      sudo apt-get install -y postgresql-18-pgtap
    displayName: 'Install pgTAP'

  - script: |
      psql -h localhost -U postgres -d testdb -c "CREATE EXTENSION IF NOT EXISTS pgtap;"
      psql -h localhost -U postgres -d testdb -f schema.sql
    displayName: 'Setup database'
    env:
      PGPASSWORD: postgres

  - script: |
      pg_prove -h localhost -U postgres -d testdb tests/
    displayName: 'Run tests'
    env:
      PGPASSWORD: postgres
```

### 2.5 CircleCI

**CircleCIé…ç½®**ï¼š

```yaml
version: 2.1

jobs:
  test:
    docker:
      - image: postgres:18
        environment:
          POSTGRES_PASSWORD: postgres
          POSTGRES_DB: testdb
      - image: circleci/postgres:18
    steps:
      - checkout
      - run:
          name: Install pgTAP
          command: |
            sudo apt-get update
            sudo apt-get install -y postgresql-18-pgtap
      - run:
          name: Setup database
          command: |
            psql -U postgres -d testdb -c "CREATE EXTENSION IF NOT EXISTS pgtap;"
            psql -U postgres -d testdb -f schema.sql
      - run:
          name: Run tests
          command: |
            pg_prove -U postgres -d testdb tests/

workflows:
  version: 2
  test:
    jobs:
      - test
```

---

## 3. è‡ªåŠ¨åŒ–è„šæœ¬

### 3.1 æµ‹è¯•æ‰§è¡Œè„šæœ¬

**å®Œæ•´æµ‹è¯•æ‰§è¡Œè„šæœ¬**ï¼š

```bash
#!/bin/bash
# run_tests.sh

set -e

DB_NAME="${DB_NAME:-testdb}"
TEST_DIR="${TEST_DIR:-tests}"
REPORT_DIR="${REPORT_DIR:-test-results}"

# åˆ›å»ºæŠ¥å‘Šç›®å½•
mkdir -p $REPORT_DIR

echo "=========================================="
echo "Running PostgreSQL Tests"
echo "=========================================="
echo "Database: $DB_NAME"
echo "Test Directory: $TEST_DIR"
echo "Report Directory: $REPORT_DIR"
echo ""

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
if ! psql -d $DB_NAME -c "SELECT 1" > /dev/null 2>&1; then
    echo "Error: Cannot connect to database $DB_NAME"
    exit 1
fi

# è¿è¡Œå•å…ƒæµ‹è¯•
echo "Running unit tests..."
if pg_prove -d $DB_NAME $TEST_DIR/unit/ > $REPORT_DIR/unit-test.log 2>&1; then
    echo "âœ“ Unit tests passed"
else
    echo "âœ— Unit tests failed"
    cat $REPORT_DIR/unit-test.log
    exit 1
fi

# è¿è¡Œé›†æˆæµ‹è¯•
echo "Running integration tests..."
if pg_prove -d $DB_NAME $TEST_DIR/integration/ > $REPORT_DIR/integration-test.log 2>&1; then
    echo "âœ“ Integration tests passed"
else
    echo "âœ— Integration tests failed"
    cat $REPORT_DIR/integration-test.log
    exit 1
fi

# è¿è¡Œæ€§èƒ½æµ‹è¯•ï¼ˆå¯é€‰ï¼‰
if [ "$RUN_PERFORMANCE_TESTS" = "true" ]; then
    echo "Running performance tests..."
    pgbench -i -s 10 $DB_NAME
    pgbench -c 10 -j 2 -T 60 $DB_NAME > $REPORT_DIR/performance-test.log 2>&1
    echo "âœ“ Performance tests completed"
fi

echo ""
echo "=========================================="
echo "All tests passed!"
echo "=========================================="
```

**å¹¶è¡Œæµ‹è¯•æ‰§è¡Œè„šæœ¬**ï¼š

```bash
#!/bin/bash
# run_tests_parallel.sh

set -e

DB_NAME="${DB_NAME:-testdb}"
TEST_DIR="${TEST_DIR:-tests}"
PARALLEL_JOBS="${PARALLEL_JOBS:-4}"

echo "Running tests in parallel ($PARALLEL_JOBS jobs)..."

pg_prove -d $DB_NAME -j $PARALLEL_JOBS $TEST_DIR/
```

### 3.2 æµ‹è¯•æ•°æ®å‡†å¤‡

**æµ‹è¯•æ•°æ®å‡†å¤‡è„šæœ¬**ï¼š

```bash
#!/bin/bash
# setup_test_data.sh

set -e

DB_NAME="${DB_NAME:-testdb}"

echo "Setting up test data..."

psql -d $DB_NAME <<EOF
-- æ¸…ç†ç°æœ‰æµ‹è¯•æ•°æ®
TRUNCATE TABLE orders CASCADE;
TRUNCATE TABLE users CASCADE;

-- åˆ›å»ºæµ‹è¯•ç”¨æˆ·
INSERT INTO users (name, email) VALUES
    ('User1', 'user1@example.com'),
    ('User2', 'user2@example.com'),
    ('User3', 'user3@example.com');

-- åˆ›å»ºæµ‹è¯•è®¢å•
INSERT INTO orders (user_id, amount, status)
SELECT id, 100, 'pending' FROM users WHERE email = 'user1@example.com'
UNION ALL
SELECT id, 200, 'paid' FROM users WHERE email = 'user2@example.com';

-- æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
ANALYZE;
EOF

echo "Test data setup completed"
```

**ä½¿ç”¨Fixtureså‡†å¤‡æ•°æ®**ï¼š

```bash
#!/bin/bash
# load_fixtures.sh

set -e

DB_NAME="${DB_NAME:-testdb}"
FIXTURES_DIR="${FIXTURES_DIR:-fixtures}"

echo "Loading fixtures from $FIXTURES_DIR..."

for fixture_file in $FIXTURES_DIR/*.sql; do
    if [ -f "$fixture_file" ]; then
        echo "Loading $(basename $fixture_file)..."
        psql -d $DB_NAME -f "$fixture_file"
    fi
done

echo "Fixtures loaded"
```

### 3.3 æµ‹è¯•ç¯å¢ƒè®¾ç½®

**æµ‹è¯•ç¯å¢ƒè®¾ç½®è„šæœ¬**ï¼š

```bash
#!/bin/bash
# setup_test_env.sh

set -e

DB_NAME="${DB_NAME:-testdb}"

echo "Setting up test environment..."

# åˆ›å»ºæµ‹è¯•æ•°æ®åº“
if psql -lqt | cut -d \| -f 1 | grep -qw $DB_NAME; then
    echo "Database $DB_NAME already exists"
else
    createdb $DB_NAME
    echo "Created database $DB_NAME"
fi

# åˆ›å»ºschema
psql -d $DB_NAME -f schema.sql

# å¯ç”¨æ‰©å±•
psql -d $DB_NAME <<EOF
CREATE EXTENSION IF NOT EXISTS pgtap;
CREATE EXTENSION IF NOT EXISTS pg_stat_statements;
EOF

# è®¾ç½®æµ‹è¯•é…ç½®
psql -d $DB_NAME <<EOF
ALTER DATABASE $DB_NAME SET log_statement = 'all';
ALTER DATABASE $DB_NAME SET log_min_duration_statement = 0;
EOF

echo "Test environment setup completed"
```

### 3.4 æµ‹è¯•æ¸…ç†è„šæœ¬

**æµ‹è¯•æ¸…ç†è„šæœ¬**ï¼š

```bash
#!/bin/bash
# cleanup_tests.sh

set -e

DB_NAME="${DB_NAME:-testdb}"

echo "Cleaning up test data..."

psql -d $DB_NAME <<EOF
-- æ¸…ç†æµ‹è¯•æ•°æ®
TRUNCATE TABLE orders CASCADE;
TRUNCATE TABLE users CASCADE;

-- é‡ç½®åºåˆ—
ALTER SEQUENCE users_id_seq RESTART WITH 1;
ALTER SEQUENCE orders_id_seq RESTART WITH 1;

-- æ¸…ç†ç»Ÿè®¡ä¿¡æ¯
SELECT pg_stat_statements_reset();
EOF

echo "Test cleanup completed"
```

## 4. æµ‹è¯•æŠ¥å‘Š

### 4.1 æŠ¥å‘Šç”Ÿæˆ

**ç”ŸæˆHTMLæŠ¥å‘Š**ï¼š

```bash
# ç”ŸæˆHTMLæŠ¥å‘Š
pg_prove -d testdb --formatter TAP::Formatter::HTML tests/ > report.html

# ä½¿ç”¨è‡ªå®šä¹‰æ¨¡æ¿
pg_prove -d testdb --formatter TAP::Formatter::HTML \
  --formatter-options template=template.html tests/ > report.html
```

**ç”ŸæˆJUnitæŠ¥å‘Š**ï¼š

```bash
# ç”ŸæˆJUnit XMLæŠ¥å‘Šï¼ˆç”¨äºCI/CDé›†æˆï¼‰
pg_prove -d testdb --formatter TAP::Formatter::JUnit tests/ > junit.xml
```

**ç”ŸæˆJSONæŠ¥å‘Š**ï¼š

```bash
# ç”ŸæˆJSONæŠ¥å‘Š
pg_prove -d testdb --formatter TAP::Formatter::JSON tests/ > report.json
```

**ç”Ÿæˆå¤šç§æ ¼å¼æŠ¥å‘Š**ï¼š

```bash
#!/bin/bash
# generate_reports.sh

DB_NAME="${DB_NAME:-testdb}"
REPORT_DIR="${REPORT_DIR:-test-results}"

mkdir -p $REPORT_DIR

# HTMLæŠ¥å‘Š
pg_prove -d $DB_NAME --formatter TAP::Formatter::HTML tests/ > $REPORT_DIR/report.html

# JUnitæŠ¥å‘Š
pg_prove -d $DB_NAME --formatter TAP::Formatter::JUnit tests/ > $REPORT_DIR/junit.xml

# JSONæŠ¥å‘Š
pg_prove -d $DB_NAME --formatter TAP::Formatter::JSON tests/ > $REPORT_DIR/report.json

# æ–‡æœ¬æŠ¥å‘Š
pg_prove -d $DB_NAME tests/ > $REPORT_DIR/report.txt
```

### 4.2 æŠ¥å‘Šæ ¼å¼

**æŠ¥å‘Šå†…å®¹**ï¼š

- **æµ‹è¯•æ¦‚è¿°**ï¼šæµ‹è¯•æ€»æ•°ã€é€šè¿‡æ•°ã€å¤±è´¥æ•°
- **æ‰§è¡Œæ—¶é—´**ï¼šæ€»æ‰§è¡Œæ—¶é—´ã€æ¯ä¸ªæµ‹è¯•çš„æ‰§è¡Œæ—¶é—´
- **æµ‹è¯•è¯¦æƒ…**ï¼šæ¯ä¸ªæµ‹è¯•çš„è¯¦ç»†ç»“æœ
- **é”™è¯¯ä¿¡æ¯**ï¼šå¤±è´¥æµ‹è¯•çš„é”™è¯¯ä¿¡æ¯
- **è¦†ç›–ç‡ä¿¡æ¯**ï¼šä»£ç è¦†ç›–ç‡ç»Ÿè®¡

**æŠ¥å‘Šç¤ºä¾‹**ï¼š

```text
# Test Results Summary
Total Tests: 150
Passed: 145
Failed: 5
Skipped: 0
Duration: 45.2s

# Failed Tests
1. test_user_creation.sql - Line 10: User creation failed
2. test_order_processing.sql - Line 25: Order validation failed
...
```

### 4.3 æŠ¥å‘Šåˆ†æ

**æŠ¥å‘Šåˆ†æè„šæœ¬**ï¼š

```bash
#!/bin/bash
# analyze_reports.sh

REPORT_DIR="${REPORT_DIR:-test-results}"

if [ -f "$REPORT_DIR/report.json" ]; then
    # ä½¿ç”¨jqåˆ†æJSONæŠ¥å‘Š
    total=$(jq '.total' $REPORT_DIR/report.json)
    passed=$(jq '.passed' $REPORT_DIR/report.json)
    failed=$(jq '.failed' $REPORT_DIR/report.json)

    echo "Test Results:"
    echo "  Total: $total"
    echo "  Passed: $passed"
    echo "  Failed: $failed"
    echo "  Pass Rate: $(echo "scale=2; $passed * 100 / $total" | bc)%"
fi
```

### 4.4 æŠ¥å‘Šé€šçŸ¥

**é‚®ä»¶é€šçŸ¥**ï¼š

```bash
#!/bin/bash
# send_test_report.sh

REPORT_DIR="${REPORT_DIR:-test-results}"
EMAIL="${EMAIL:-team@example.com}"

if [ -f "$REPORT_DIR/report.html" ]; then
    mail -s "Test Results" -a "$REPORT_DIR/report.html" $EMAIL < /dev/null
fi
```

**Slacké€šçŸ¥**ï¼š

```bash
#!/bin/bash
# notify_slack.sh

WEBHOOK_URL="${SLACK_WEBHOOK_URL}"
REPORT_DIR="${REPORT_DIR:-test-results}"

if [ -f "$REPORT_DIR/report.json" ]; then
    total=$(jq '.total' $REPORT_DIR/report.json)
    passed=$(jq '.passed' $REPORT_DIR/report.json)
    failed=$(jq '.failed' $REPORT_DIR/report.json)

    curl -X POST -H 'Content-type: application/json' \
        --data "{\"text\":\"Test Results: $passed/$total passed, $failed failed\"}" \
        $WEBHOOK_URL
fi
```

## 5. æµ‹è¯•è°ƒåº¦

### 5.1 å®šæ—¶æµ‹è¯•

**ä½¿ç”¨cronå®šæ—¶æ‰§è¡Œæµ‹è¯•**ï¼š

```bash
# æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œæµ‹è¯•
0 2 * * * /path/to/run_tests.sh

# æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡æµ‹è¯•
0 * * * * /path/to/run_tests.sh

# æ¯å‘¨ä¸€æ‰§è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
0 3 * * 1 /path/to/run_full_tests.sh
```

**ä½¿ç”¨pg_cronå®šæ—¶æ‰§è¡Œ**ï¼š

```sql
-- æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œæµ‹è¯•
SELECT cron.schedule(
    'daily-tests',
    '0 2 * * *',
    $$SELECT run_tests()$$
);
```

### 5.2 äº‹ä»¶è§¦å‘æµ‹è¯•

**Gité’©å­è§¦å‘æµ‹è¯•**ï¼š

```bash
#!/bin/bash
# .git/hooks/pre-commit

echo "Running pre-commit tests..."

if ! /path/to/run_tests.sh; then
    echo "Tests failed. Commit aborted."
    exit 1
fi
```

**æ–‡ä»¶å˜æ›´è§¦å‘æµ‹è¯•**ï¼š

```bash
#!/bin/bash
# watch_tests.sh

# ä½¿ç”¨inotifyç›‘æ§æ–‡ä»¶å˜æ›´
inotifywait -m -r -e modify,create,delete tests/ sql/ |
while read path action file; do
    echo "File changed: $file"
    /path/to/run_tests.sh
done
```

### 5.3 å¹¶è¡Œæµ‹è¯•æ‰§è¡Œ

**å¹¶è¡Œæ‰§è¡Œæµ‹è¯•**ï¼š

```bash
# ä½¿ç”¨pg_proveå¹¶è¡Œæ‰§è¡Œ
pg_prove -d testdb -j 4 tests/

# ä½¿ç”¨GNU parallel
find tests/ -name "*.sql" | parallel -j 4 "pg_prove -d testdb {}"
```

## 6. æµ‹è¯•ç›‘æ§

### 6.1 æµ‹è¯•æ‰§è¡Œç›‘æ§

**ç›‘æ§æµ‹è¯•æ‰§è¡ŒçŠ¶æ€**ï¼š

```bash
#!/bin/bash
# monitor_tests.sh

while true; do
    if pgrep -f "pg_prove\|pgbench" > /dev/null; then
        echo "$(date): Tests running..."
    else
        echo "$(date): No tests running"
    fi
    sleep 60
done
```

### 6.2 æµ‹è¯•ç»“æœç›‘æ§

**ç›‘æ§æµ‹è¯•ç»“æœè¶‹åŠ¿**ï¼š

```sql
-- åˆ›å»ºæµ‹è¯•ç»“æœè¡¨
CREATE TABLE test_results (
    id SERIAL PRIMARY KEY,
    test_name TEXT,
    status TEXT,
    execution_time INTERVAL,
    timestamp TIMESTAMP DEFAULT NOW()
);

-- è®°å½•æµ‹è¯•ç»“æœ
INSERT INTO test_results (test_name, status, execution_time)
VALUES ('unit_tests', 'passed', '45s');
```

### 6.3 æµ‹è¯•è¶‹åŠ¿åˆ†æ

**æµ‹è¯•è¶‹åŠ¿åˆ†ææŸ¥è¯¢**ï¼š

```sql
-- æŸ¥çœ‹æµ‹è¯•é€šè¿‡ç‡è¶‹åŠ¿
SELECT
    date_trunc('day', timestamp) as day,
    COUNT(*) FILTER (WHERE status = 'passed') as passed,
    COUNT(*) FILTER (WHERE status = 'failed') as failed,
    round(100.0 * COUNT(*) FILTER (WHERE status = 'passed') / COUNT(*), 2) as pass_rate
FROM test_results
GROUP BY day
ORDER BY day DESC;
```

## 7. æœ€ä½³å®è·µ

### 7.1 æ¨èåšæ³•

**âœ… æ¨èåšæ³•**ï¼š

1. **è‡ªåŠ¨åŒ–æ‰€æœ‰æµ‹è¯•**
   - å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æ€§èƒ½æµ‹è¯•
   - æ¯æ¬¡ä»£ç æäº¤è‡ªåŠ¨æ‰§è¡Œ
   - å®šæœŸæ‰§è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶

2. **é›†æˆåˆ°CI/CD**
   - é›†æˆåˆ°æŒç»­é›†æˆæµç¨‹
   - æµ‹è¯•å¤±è´¥é˜»æ­¢éƒ¨ç½²
   - å¿«é€Ÿåé¦ˆé—®é¢˜

3. **æµ‹è¯•æ•°æ®ç®¡ç†**
   - ä½¿ç”¨ç‹¬ç«‹çš„æµ‹è¯•æ•°æ®
   - æµ‹è¯•åè‡ªåŠ¨æ¸…ç†
   - ä½¿ç”¨fixtureså‡†å¤‡æ•°æ®

4. **æµ‹è¯•æŠ¥å‘Š**
   - ç”Ÿæˆè¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Š
   - å¤šç§æ ¼å¼æŠ¥å‘Šï¼ˆHTMLã€JSONã€XMLï¼‰
   - è‡ªåŠ¨å‘é€æŠ¥å‘Šé€šçŸ¥

5. **æµ‹è¯•ç›‘æ§**
   - ç›‘æ§æµ‹è¯•æ‰§è¡ŒçŠ¶æ€
   - è·Ÿè¸ªæµ‹è¯•ç»“æœè¶‹åŠ¿
   - åˆ†ææµ‹è¯•è¦†ç›–ç‡

### 7.2 å¸¸è§é”™è¯¯

**âŒ é¿å…åšæ³•**ï¼š

1. **æµ‹è¯•ä¸ç¨³å®š**
   - é¿å…æµ‹è¯•ç»“æœä¸ç¨³å®š
   - é¿å…æµ‹è¯•ä¹‹é—´ç›¸äº’ä¾èµ–
   - ç¡®ä¿æµ‹è¯•å¯é‡å¤æ‰§è¡Œ

2. **æµ‹è¯•æ‰§è¡Œè¿‡æ…¢**
   - é¿å…æµ‹è¯•æ‰§è¡Œæ—¶é—´è¿‡é•¿
   - ä¼˜åŒ–æµ‹è¯•è„šæœ¬
   - ä½¿ç”¨å¹¶è¡Œæ‰§è¡Œ

3. **æµ‹è¯•æ•°æ®æ±¡æŸ“**
   - é¿å…ä½¿ç”¨ç”Ÿäº§æ•°æ®
   - é¿å…æµ‹è¯•æ•°æ®æ®‹ç•™
   - æµ‹è¯•ååŠæ—¶æ¸…ç†

4. **ç¼ºå°‘ç›‘æ§**
   - é¿å…ç¼ºå°‘æµ‹è¯•ç›‘æ§
   - é¿å…å¿½ç•¥æµ‹è¯•è¶‹åŠ¿
   - åŠæ—¶å‘ç°é—®é¢˜

### 7.3 è‡ªåŠ¨åŒ–ç­–ç•¥

**è‡ªåŠ¨åŒ–ç­–ç•¥å»ºè®®**ï¼š

1. **æ¸è¿›å¼è‡ªåŠ¨åŒ–**
   - ä»å…³é”®æµ‹è¯•å¼€å§‹
   - é€æ­¥æ‰©å¤§è‡ªåŠ¨åŒ–èŒƒå›´
   - æŒç»­æ”¹è¿›

2. **æµ‹è¯•ä¼˜å…ˆçº§**
   - ä¼˜å…ˆè‡ªåŠ¨åŒ–å…³é”®è·¯å¾„æµ‹è¯•
   - ä¼˜å…ˆè‡ªåŠ¨åŒ–å›å½’æµ‹è¯•
   - é€æ­¥è‡ªåŠ¨åŒ–å…¶ä»–æµ‹è¯•

3. **ç»´æŠ¤ç­–ç•¥**
   - å®šæœŸå®¡æŸ¥æµ‹è¯•
   - æ›´æ–°è¿‡æ—¶æµ‹è¯•
   - ä¼˜åŒ–æµ‹è¯•æ€§èƒ½

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æµ‹è¯•å®Œæ•´æŒ‡å—.md](./æµ‹è¯•å®Œæ•´æŒ‡å—.md) - æµ‹è¯•å®Œæ•´æŒ‡å—
- [å•å…ƒæµ‹è¯•.md](./å•å…ƒæµ‹è¯•.md) - å•å…ƒæµ‹è¯•è¯¦è§£
- [é›†æˆæµ‹è¯•.md](./é›†æˆæµ‹è¯•.md) - é›†æˆæµ‹è¯•è¯¦è§£
- [æ€§èƒ½æµ‹è¯•.md](./æ€§èƒ½æµ‹è¯•.md) - æ€§èƒ½æµ‹è¯•è¯¦è§£
- [å‹åŠ›æµ‹è¯•.md](./å‹åŠ›æµ‹è¯•.md) - å‹åŠ›æµ‹è¯•è¯¦è§£
- [ä»£ç è´¨é‡æ£€æŸ¥.md](./ä»£ç è´¨é‡æ£€æŸ¥.md) - ä»£ç è´¨é‡æ£€æŸ¥
- [16-åº”ç”¨è®¾è®¡ä¸å¼€å‘/README.md](../README.md) - åº”ç”¨è®¾è®¡ä¸å¼€å‘ä¸»é¢˜

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**ç»´æŠ¤è€…**: PostgreSQLå¼€å‘å›¢é˜Ÿ
