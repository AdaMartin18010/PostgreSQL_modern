---

> **ğŸ“‹ æ–‡æ¡£æ¥æº**: `PostgreSQL\09-åº”ç”¨è®¾è®¡\åº”ç”¨æ¶æ„\07.05-å®æ—¶æ¨èç³»ç»Ÿ.md`
> **ğŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŸæ–‡ä»¶ä¿æŒä¸å˜

---

# PostgreSQLå®æ—¶æ¨èç³»ç»Ÿæ¶æ„ä¸å®è·µæŒ‡å—

> **ç‰ˆæœ¬**: v3.0
> **æœ€åæ›´æ–°**: 2025-01-15
> **ç‰ˆæœ¬è¦†ç›–**: PostgreSQL 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x (å…¼å®¹)
> **éš¾åº¦**: â­â­â­â­â­
> **åº”ç”¨åœºæ™¯**: ç”µå•†æ¨èã€å†…å®¹æ¨èã€å¹¿å‘Šæ¨èã€ä¸ªæ€§åŒ–æ¨è

---

## ğŸ“‘ ç›®å½•

- [1.1 ä¸šåŠ¡èƒŒæ™¯](#11-ä¸šåŠ¡èƒŒæ™¯)
- [1.2 æŠ€æœ¯æŒ‘æˆ˜](#12-æŠ€æœ¯æŒ‘æˆ˜)
- [1.3 PostgreSQLä¼˜åŠ¿](#13-postgresqlä¼˜åŠ¿)
- [1.4 ç‰ˆæœ¬è¦æ±‚](#14-ç‰ˆæœ¬è¦æ±‚)
- [2.1 æ¨èç³»ç»Ÿæ¶æ„](#21-æ¨èç³»ç»Ÿæ¶æ„)
- [2.2 æ¨èæµç¨‹](#22-æ¨èæµç¨‹)
- [2.3 æ¨èç®—æ³•](#23-æ¨èç®—æ³•)
- [2.4 æ€ç»´å¯¼å›¾](#24-æ€ç»´å¯¼å›¾)
- [3.1 æ•´ä½“æ¶æ„è®¾è®¡](#31-æ•´ä½“æ¶æ„è®¾è®¡)
- [3.2 æ•°æ®æµè®¾è®¡](#32-æ•°æ®æµè®¾è®¡)
- [3.3 å­˜å‚¨è®¾è®¡](#33-å­˜å‚¨è®¾è®¡)
- [4.1 ç‰¹å¾å­˜å‚¨è®¾è®¡](#41-ç‰¹å¾å­˜å‚¨è®¾è®¡)
- [4.2 å‘é‡å¬å›å®ç°](#42-å‘é‡å¬å›å®ç°)
- [4.3 æ··åˆæ£€ç´¢å®ç°](#43-æ··åˆæ£€ç´¢å®ç°)
- [4.4 å®æ—¶ç‰¹å¾è®¡ç®—](#44-å®æ—¶ç‰¹å¾è®¡ç®—)
- [4.5 æ¨èç»“æœç¼“å­˜](#45-æ¨èç»“æœç¼“å­˜)
- [5.1 è™šæ‹Ÿç”Ÿæˆåˆ—ä¼˜åŒ–](#51-è™šæ‹Ÿç”Ÿæˆåˆ—ä¼˜åŒ–)
- [5.2 å¼‚æ­¥I/Oä¼˜åŒ–](#52-å¼‚æ­¥ioä¼˜åŒ–)
- [5.3 pgvector 2.0ä¼˜åŒ–](#53-pgvector-20ä¼˜åŒ–)
- [6.1 å¬å›æ–¹æ¡ˆå¯¹æ¯”](#61-å¬å›æ–¹æ¡ˆå¯¹æ¯”)
- [6.2 æ’åºæ–¹æ¡ˆå¯¹æ¯”](#62-æ’åºæ–¹æ¡ˆå¯¹æ¯”)
- [6.3 å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”](#63-å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”)
- [7.1 ç”µå•†å•†å“æ¨è](#71-ç”µå•†å•†å“æ¨è)
- [7.2 å†…å®¹æ¨èç³»ç»Ÿ](#72-å†…å®¹æ¨èç³»ç»Ÿ)
- [7.3 å¹¿å‘Šæ¨èç³»ç»Ÿ](#73-å¹¿å‘Šæ¨èç³»ç»Ÿ)
- [8.1 æŸ¥è¯¢ä¼˜åŒ–](#81-æŸ¥è¯¢ä¼˜åŒ–)
- [8.2 å†™å…¥ä¼˜åŒ–](#82-å†™å…¥ä¼˜åŒ–)
- [8.3 ç¼“å­˜ä¼˜åŒ–](#83-ç¼“å­˜ä¼˜åŒ–)
- [9.1 å…³é”®æŒ‡æ ‡](#91-å…³é”®æŒ‡æ ‡)
- [9.2 ç›‘æ§æ–¹æ¡ˆ](#92-ç›‘æ§æ–¹æ¡ˆ)
- [9.3 éªŒè¯æ–¹æ³•](#93-éªŒè¯æ–¹æ³•)
- [10.1 æ¶æ„æœ€ä½³å®è·µ](#101-æ¶æ„æœ€ä½³å®è·µ)
- [10.2 æ€§èƒ½æœ€ä½³å®è·µ](#102-æ€§èƒ½æœ€ä½³å®è·µ)
- [11.1 å®˜æ–¹æ–‡æ¡£](#111-å®˜æ–¹æ–‡æ¡£)
- [11.2 ç½‘ç»œèµ„æº](#112-ç½‘ç»œèµ„æº)
- [11.3 ç›¸å…³æ–‡æ¡£](#113-ç›¸å…³æ–‡æ¡£)
- [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)
- [å¤–éƒ¨èµ„æº](#å¤–éƒ¨èµ„æº)
---

## ä¸€ã€æ¦‚è¿°

### 1.1 ä¸šåŠ¡èƒŒæ™¯

å®æ—¶æ¨èç³»ç»Ÿæ˜¯ç°ä»£äº’è”ç½‘åº”ç”¨çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œé€šè¿‡åˆ†æç”¨æˆ·è¡Œä¸ºã€ç‰©å“ç‰¹å¾å’Œä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä¸ºç”¨æˆ·æä¾›ä¸ªæ€§åŒ–çš„æ¨èå†…å®¹ã€‚ä¸ä¼ ç»Ÿçš„ç¦»çº¿æ¨èç³»ç»Ÿä¸åŒï¼Œå®æ—¶æ¨èç³»ç»Ÿéœ€è¦åœ¨ç”¨æˆ·è¡Œä¸ºå‘ç”Ÿåå‡ ç§’åˆ°å‡ åˆ†é’Ÿå†…æ›´æ–°æ¨èç»“æœã€‚

**å…¸å‹åº”ç”¨åœºæ™¯**ï¼š

- **ç”µå•†å¹³å°**ï¼šæ ¹æ®ç”¨æˆ·æµè§ˆã€è´­ä¹°å†å²æ¨èå•†å“
- **å†…å®¹å¹³å°**ï¼šæ ¹æ®ç”¨æˆ·é˜…è¯»ã€ç‚¹èµè¡Œä¸ºæ¨èæ–‡ç« 
- **è§†é¢‘å¹³å°**ï¼šæ ¹æ®ç”¨æˆ·è§‚çœ‹ã€äº’åŠ¨è¡Œä¸ºæ¨èè§†é¢‘
- **ç¤¾äº¤å¹³å°**ï¼šæ ¹æ®ç”¨æˆ·å…³æ³¨ã€äº’åŠ¨è¡Œä¸ºæ¨èç”¨æˆ·æˆ–å†…å®¹
- **å¹¿å‘Šå¹³å°**ï¼šæ ¹æ®ç”¨æˆ·ç”»åƒå’Œè¡Œä¸ºæ¨èå¹¿å‘Š

**ä¸šåŠ¡ä»·å€¼**ï¼š

- æå‡ç”¨æˆ·å‚ä¸åº¦å’Œåœç•™æ—¶é—´
- å¢åŠ è½¬åŒ–ç‡å’Œæ”¶å…¥
- æ”¹å–„ç”¨æˆ·ä½“éªŒå’Œæ»¡æ„åº¦
- æé«˜å†…å®¹/å•†å“æ›å…‰ç‡

### 1.2 æŠ€æœ¯æŒ‘æˆ˜

**å®æ—¶æ¨èç³»ç»Ÿé¢ä¸´çš„ä¸»è¦æŠ€æœ¯æŒ‘æˆ˜**ï¼š

1. **ä½å»¶è¿Ÿè¦æ±‚**
   - æ¨èç»“æœéœ€è¦åœ¨100ms-1så†…è¿”å›
   - æ•°æ®æ›´æ–°éœ€è¦åœ¨ç§’çº§å†…ç”Ÿæ•ˆ

2. **é«˜å¹¶å‘å¤„ç†**
   - éœ€è¦å¤„ç†æ¯ç§’æ•°ä¸‡åˆ°æ•°åä¸‡çš„ç”¨æˆ·è¡Œä¸ºäº‹ä»¶
   - éœ€è¦æ”¯æŒé«˜QPSçš„æŸ¥è¯¢è¯·æ±‚ï¼ˆ10K+ QPSï¼‰

3. **æ•°æ®ä¸€è‡´æ€§**
   - æµå¼æ•°æ®å¤„ç†çš„ä¸€è‡´æ€§ä¿è¯
   - ç‰¹å¾å­˜å‚¨ä¸è®¡ç®—çš„ä¸€è‡´æ€§

4. **çƒ­ç‚¹å†™å…¥**
   - çƒ­é—¨å•†å“/å†…å®¹çš„é«˜é¢‘æ›´æ–°
   - å†™å…¥æ€§èƒ½ç“¶é¢ˆ

5. **è®¡ç®—å¤æ‚åº¦**
   - å®æ—¶ç‰¹å¾è®¡ç®—
   - æ¨èç®—æ³•è®¡ç®—ï¼ˆå‘é‡æ£€ç´¢ã€æ’åºï¼‰

6. **å†·å¯åŠ¨é—®é¢˜**
   - æ–°ç”¨æˆ·æ¨è
   - æ–°ç‰©å“æ¨è

### 1.3 PostgreSQLä¼˜åŠ¿

**PostgreSQLåœ¨å®æ—¶æ¨èç³»ç»Ÿä¸­çš„ä¼˜åŠ¿**ï¼š

- âœ… **pgvectoræ”¯æŒ**ï¼šé«˜æ•ˆçš„å‘é‡ç›¸ä¼¼åº¦æœç´¢
- âœ… **JSONBæ”¯æŒ**ï¼šçµæ´»å­˜å‚¨ç”¨æˆ·ç‰¹å¾å’Œç‰©å“ç‰¹å¾
- âœ… **æ•°ç»„æ”¯æŒ**ï¼šå­˜å‚¨æ ‡ç­¾ã€åˆ†ç±»ç­‰ç»“æ„åŒ–æ•°æ®
- âœ… **å…¨æ–‡æœç´¢**ï¼šæ”¯æŒæ–‡æœ¬ç‰¹å¾çš„æ£€ç´¢
- âœ… **ç‰©åŒ–è§†å›¾**ï¼šç¼“å­˜æ¨èç»“æœï¼Œæå‡æŸ¥è¯¢æ€§èƒ½
- âœ… **æµå¼å¤„ç†**ï¼šæ”¯æŒå®æ—¶æ•°æ®å¤„ç†
- âœ… **PostgreSQL 18æ–°ç‰¹æ€§**ï¼šè™šæ‹Ÿç”Ÿæˆåˆ—ã€å¼‚æ­¥I/Oã€pgvector 2.0

### 1.4 ç‰ˆæœ¬è¦æ±‚

- **PostgreSQL 18.x**ï¼šæ¨èï¼Œæ”¯æŒè™šæ‹Ÿç”Ÿæˆåˆ—ã€å¼‚æ­¥I/Oã€pgvector 2.0
- **PostgreSQL 17.x**ï¼šæ¨èï¼ŒåŠŸèƒ½å®Œæ•´
- **PostgreSQL 16.x**ï¼šå…¼å®¹ï¼ŒåŸºç¡€åŠŸèƒ½æ”¯æŒ

---

## äºŒã€æ ¸å¿ƒæ¦‚å¿µ

### 2.1 æ¨èç³»ç»Ÿæ¶æ„

**æ¨èç³»ç»Ÿçš„å…¸å‹æ¶æ„**ï¼š

1. **å¬å›å±‚ï¼ˆRecallï¼‰**ï¼šä»æµ·é‡ç‰©å“ä¸­å¿«é€Ÿç­›é€‰å€™é€‰é›†
   - å‘é‡å¬å›ï¼šåŸºäºç‰©å“/ç”¨æˆ·å‘é‡ç›¸ä¼¼åº¦
   - ååŒè¿‡æ»¤ï¼šåŸºäºç”¨æˆ·è¡Œä¸ºç›¸ä¼¼åº¦
   - å†…å®¹å¬å›ï¼šåŸºäºç‰©å“ç‰¹å¾åŒ¹é…

2. **ç²—æ’å±‚ï¼ˆPre-rankingï¼‰**ï¼šå¯¹å€™é€‰é›†è¿›è¡Œåˆæ­¥æ’åº
   - è§„åˆ™è¿‡æ»¤
   - è½»é‡çº§æ¨¡å‹æ’åº

3. **ç²¾æ’å±‚ï¼ˆRankingï¼‰**ï¼šå¯¹å€™é€‰é›†è¿›è¡Œç²¾ç¡®æ’åº
   - æ·±åº¦å­¦ä¹ æ¨¡å‹
   - å¤šç›®æ ‡ä¼˜åŒ–

4. **é‡æ’å±‚ï¼ˆRe-rankingï¼‰**ï¼šå¯¹æ’åºç»“æœè¿›è¡Œä¼˜åŒ–
   - å¤šæ ·æ€§ä¼˜åŒ–
   - æ–°é²œåº¦ä¼˜åŒ–
   - ä¸šåŠ¡è§„åˆ™è°ƒæ•´

### 2.2 æ¨èæµç¨‹

**å®æ—¶æ¨èæµç¨‹**ï¼š

1. **ç”¨æˆ·è¡Œä¸ºé‡‡é›†**ï¼šæ”¶é›†ç”¨æˆ·æµè§ˆã€ç‚¹å‡»ã€è´­ä¹°ç­‰è¡Œä¸º
2. **ç‰¹å¾è®¡ç®—**ï¼šè®¡ç®—ç”¨æˆ·ç‰¹å¾ã€ç‰©å“ç‰¹å¾ã€ä¸Šä¸‹æ–‡ç‰¹å¾
3. **å¬å›**ï¼šä»å€™é€‰é›†ä¸­å¬å›ç›¸å…³ç‰©å“
4. **æ’åº**ï¼šå¯¹å¬å›ç»“æœè¿›è¡Œæ’åº
5. **è¿‡æ»¤**ï¼šè¿‡æ»¤å·²æ¨èã€å·²è´­ä¹°ç­‰ç‰©å“
6. **è¿”å›ç»“æœ**ï¼šè¿”å›æ¨èåˆ—è¡¨ç»™ç”¨æˆ·

### 2.3 æ¨èç®—æ³•

**å¸¸ç”¨æ¨èç®—æ³•**ï¼š

1. **ååŒè¿‡æ»¤**ï¼š
   - åŸºäºç”¨æˆ·çš„ååŒè¿‡æ»¤ï¼ˆUser-based CFï¼‰
   - åŸºäºç‰©å“çš„ååŒè¿‡æ»¤ï¼ˆItem-based CFï¼‰

2. **å†…å®¹æ¨è**ï¼š
   - åŸºäºç‰©å“ç‰¹å¾çš„æ¨è
   - åŸºäºç”¨æˆ·ç”»åƒçš„æ¨è

3. **æ·±åº¦å­¦ä¹ æ¨è**ï¼š
   - ç¥ç»ç½‘ç»œæ¨èæ¨¡å‹
   - å‘é‡åŒ–æ¨è

4. **æ··åˆæ¨è**ï¼š
   - å¤šç§ç®—æ³•çš„ç»„åˆ
   - åŠ æƒèåˆ

### 2.4 æ€ç»´å¯¼å›¾

```mermaid
graph TD
    A[å®æ—¶æ¨èç³»ç»Ÿ] --> B[å¬å›å±‚]
    A --> C[ç²—æ’å±‚]
    A --> D[ç²¾æ’å±‚]
    A --> E[é‡æ’å±‚]

    B --> B1[å‘é‡å¬å›]
    B --> B2[ååŒè¿‡æ»¤]
    B --> B3[å†…å®¹å¬å›]

    C --> C1[è§„åˆ™è¿‡æ»¤]
    C --> C2[è½»é‡æ¨¡å‹]

    D --> D1[æ·±åº¦å­¦ä¹ æ¨¡å‹]
    D --> D2[å¤šç›®æ ‡ä¼˜åŒ–]

    E --> E1[å¤šæ ·æ€§ä¼˜åŒ–]
    E --> E2[æ–°é²œåº¦ä¼˜åŒ–]
    E --> E3[ä¸šåŠ¡è§„åˆ™]

    F[ç‰¹å¾å­˜å‚¨] --> B
    F --> C
    F --> D

    G[ç”¨æˆ·è¡Œä¸º] --> F
    H[ç‰©å“ç‰¹å¾] --> F
```

---

## ä¸‰ã€æŠ€æœ¯æ¶æ„

### 3.1 æ•´ä½“æ¶æ„è®¾è®¡

```mermaid
graph TB
    A[ç”¨æˆ·è¡Œä¸ºæµ] --> B[æµå¼å¤„ç†]
    B --> C[ç‰¹å¾è®¡ç®—]
    C --> D[ç‰¹å¾å­˜å‚¨]

    E[æ¨èè¯·æ±‚] --> F[å¬å›æœåŠ¡]
    F --> D
    F --> G[å‘é‡æ£€ç´¢]

    G --> H[ç²—æ’æœåŠ¡]
    H --> I[ç²¾æ’æœåŠ¡]
    I --> J[é‡æ’æœåŠ¡]
    J --> K[æ¨èç»“æœ]

    D --> L[PostgreSQL]
    G --> L
    L --> M[pgvector]
    L --> N[ç‰©åŒ–è§†å›¾]
```

### 3.2 æ•°æ®æµè®¾è®¡

**æ•°æ®æµ**ï¼š

1. **ç”¨æˆ·è¡Œä¸ºæµ**ï¼š
   - ç”¨æˆ·è¡Œä¸ºäº‹ä»¶ â†’ Kafka/Pulsar
   - æµå¼å¤„ç† â†’ Flink/Spark Streaming
   - ç‰¹å¾è®¡ç®— â†’ PostgreSQL

2. **æ¨èè¯·æ±‚æµ**ï¼š
   - ç”¨æˆ·è¯·æ±‚ â†’ æ¨èæœåŠ¡
   - ç‰¹å¾æŸ¥è¯¢ â†’ PostgreSQL
   - å‘é‡æ£€ç´¢ â†’ pgvector
   - ç»“æœè¿”å› â†’ ç”¨æˆ·

### 3.3 å­˜å‚¨è®¾è®¡

**å­˜å‚¨ç­–ç•¥**ï¼š

- **ç”¨æˆ·ç‰¹å¾**ï¼šå­˜å‚¨åœ¨ç”¨æˆ·ç‰¹å¾è¡¨
- **ç‰©å“ç‰¹å¾**ï¼šå­˜å‚¨åœ¨ç‰©å“ç‰¹å¾è¡¨
- **å‘é‡æ•°æ®**ï¼šå­˜å‚¨åœ¨å‘é‡è¡¨ï¼Œä½¿ç”¨pgvectorç´¢å¼•
- **æ¨èç»“æœ**ï¼šç¼“å­˜åœ¨ç‰©åŒ–è§†å›¾æˆ–Redis

---

## å››ã€å®ç°æ–¹æ¡ˆ

### 4.1 ç‰¹å¾å­˜å‚¨è®¾è®¡

**ç”¨æˆ·ç‰¹å¾è¡¨**ï¼š

```sql
-- ç”¨æˆ·åŸºç¡€ç‰¹å¾è¡¨
CREATE TABLE user_features (
    user_id BIGINT PRIMARY KEY,
    age INTEGER,
    gender VARCHAR(10),
    location TEXT,
    preferences JSONB DEFAULT '{}'::jsonb,
    -- ç”¨æˆ·å‘é‡ï¼ˆç”¨äºå‘é‡å¬å›ï¼‰
    embedding vector(768),
    -- ç»Ÿè®¡ç‰¹å¾
    total_clicks INTEGER DEFAULT 0,
    total_purchases INTEGER DEFAULT 0,
    avg_session_duration NUMERIC(10,2),
    last_active_at TIMESTAMPTZ,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- ç”¨æˆ·å®æ—¶ç‰¹å¾è¡¨ï¼ˆæœ€è¿‘Nå¤©çš„è¡Œä¸ºç»Ÿè®¡ï¼‰
CREATE TABLE user_realtime_features (
    user_id BIGINT,
    feature_date DATE,
    click_count INTEGER DEFAULT 0,
    view_count INTEGER DEFAULT 0,
    purchase_count INTEGER DEFAULT 0,
    favorite_count INTEGER DEFAULT 0,
    -- æ—¶é—´çª—å£ç‰¹å¾
    clicks_7d INTEGER DEFAULT 0,
    purchases_7d INTEGER DEFAULT 0,
    PRIMARY KEY (user_id, feature_date)
) PARTITION BY RANGE (feature_date);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_user_features_embedding ON user_features USING hnsw (embedding vector_cosine_ops)
WITH (m = 16, ef_construction = 64);
CREATE INDEX idx_user_features_preferences ON user_features USING GIN (preferences);
```

**ç‰©å“ç‰¹å¾è¡¨**ï¼š

```sql
-- ç‰©å“åŸºç¡€ç‰¹å¾è¡¨
CREATE TABLE item_features (
    item_id BIGINT PRIMARY KEY,
    title TEXT,
    description TEXT,
    category_id INTEGER,
    price NUMERIC(10,2),
    tags TEXT[] DEFAULT '{}',
    attributes JSONB DEFAULT '{}'::jsonb,
    -- ç‰©å“å‘é‡ï¼ˆç”¨äºå‘é‡å¬å›ï¼‰
    embedding vector(768),
    -- ç»Ÿè®¡ç‰¹å¾
    total_clicks INTEGER DEFAULT 0,
    total_purchases INTEGER DEFAULT 0,
    avg_rating NUMERIC(3,2),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- ç‰©å“å®æ—¶ç‰¹å¾è¡¨
CREATE TABLE item_realtime_features (
    item_id BIGINT,
    feature_date DATE,
    click_count INTEGER DEFAULT 0,
    view_count INTEGER DEFAULT 0,
    purchase_count INTEGER DEFAULT 0,
    -- æ—¶é—´çª—å£ç‰¹å¾
    clicks_7d INTEGER DEFAULT 0,
    purchases_7d INTEGER DEFAULT 0,
    PRIMARY KEY (item_id, feature_date)
) PARTITION BY RANGE (feature_date);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_item_features_embedding ON item_features USING hnsw (embedding vector_cosine_ops)
WITH (m = 16, ef_construction = 64);
CREATE INDEX idx_item_features_tags ON item_features USING GIN (tags);
CREATE INDEX idx_item_features_attributes ON item_features USING GIN (attributes);
CREATE INDEX idx_item_features_category ON item_features(category_id);
```

**ç”¨æˆ·è¡Œä¸ºè¡¨**ï¼š

```sql
-- ç”¨æˆ·è¡Œä¸ºäº‹ä»¶è¡¨ï¼ˆå¸¦å®Œæ•´é”™è¯¯å¤„ç†ï¼Œæ”¯æŒåˆ†åŒºï¼‰
DO $$
BEGIN
    IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'user_behaviors') THEN
        DROP TABLE user_behaviors CASCADE;
        RAISE NOTICE 'å·²åˆ é™¤ç°æœ‰è¡¨: user_behaviors';
    END IF;

    CREATE TABLE user_behaviors (
        id BIGSERIAL PRIMARY KEY,
        user_id BIGINT NOT NULL CHECK (user_id > 0),
        item_id BIGINT NOT NULL CHECK (item_id > 0),
        behavior_type VARCHAR(20) NOT NULL CHECK (behavior_type IN ('click', 'view', 'purchase', 'favorite')),
        behavior_time TIMESTAMPTZ DEFAULT NOW(),
        context JSONB DEFAULT '{}'::jsonb,  -- ä¸Šä¸‹æ–‡ä¿¡æ¯
        created_at TIMESTAMPTZ DEFAULT NOW()
    ) PARTITION BY RANGE (behavior_time);

    RAISE NOTICE 'ç”¨æˆ·è¡Œä¸ºäº‹ä»¶ä¸»è¡¨åˆ›å»ºæˆåŠŸ: user_behaviors';
EXCEPTION
    WHEN duplicate_table THEN
        RAISE WARNING 'è¡¨user_behaviorså·²å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºç”¨æˆ·è¡Œä¸ºäº‹ä»¶è¡¨å¤±è´¥: %', SQLERRM;
END $$;

-- åˆ›å»ºåˆ†åŒºï¼ˆæŒ‰å¤©åˆ†åŒºï¼Œå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'user_behaviors_2025_01_15') THEN
        DROP TABLE user_behaviors_2025_01_15;
        RAISE NOTICE 'å·²åˆ é™¤ç°æœ‰åˆ†åŒº: user_behaviors_2025_01_15';
    END IF;

    IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'user_behaviors') THEN
        RAISE EXCEPTION 'user_behaviorsä¸»è¡¨ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºåˆ†åŒº';
    END IF;

    CREATE TABLE user_behaviors_2025_01_15 PARTITION OF user_behaviors
        FOR VALUES FROM ('2025-01-15') TO ('2025-01-16');

    RAISE NOTICE 'åˆ†åŒºåˆ›å»ºæˆåŠŸ: user_behaviors_2025_01_15';
EXCEPTION
    WHEN undefined_table THEN
        RAISE EXCEPTION 'user_behaviorsä¸»è¡¨ä¸å­˜åœ¨';
    WHEN duplicate_table THEN
        RAISE WARNING 'åˆ†åŒºå·²å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºåˆ†åŒºå¤±è´¥: %', SQLERRM;
END $$;

-- åˆ›å»ºç´¢å¼•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'user_behaviors') THEN
        RAISE EXCEPTION 'user_behaviorsè¡¨ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºç´¢å¼•';
    END IF;

    -- user_id, item_id, behavior_timeå¤åˆç´¢å¼•
    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE schemaname = 'public' AND tablename = 'user_behaviors' AND indexname = 'idx_user_behaviors_user_item') THEN
        CREATE INDEX idx_user_behaviors_user_item ON user_behaviors(user_id, item_id, behavior_time DESC);
        RAISE NOTICE 'ç´¢å¼•åˆ›å»ºæˆåŠŸ: idx_user_behaviors_user_item';
    END IF;

    -- item_idç´¢å¼•
    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE schemaname = 'public' AND tablename = 'user_behaviors' AND indexname = 'idx_user_behaviors_item') THEN
        CREATE INDEX idx_user_behaviors_item ON user_behaviors(item_id, behavior_time DESC);
        RAISE NOTICE 'ç´¢å¼•åˆ›å»ºæˆåŠŸ: idx_user_behaviors_item';
    END IF;

    -- behavior_typeç´¢å¼•
    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE schemaname = 'public' AND tablename = 'user_behaviors' AND indexname = 'idx_user_behaviors_type') THEN
        CREATE INDEX idx_user_behaviors_type ON user_behaviors(behavior_type, behavior_time DESC);
        RAISE NOTICE 'ç´¢å¼•åˆ›å»ºæˆåŠŸ: idx_user_behaviors_type';
    END IF;
EXCEPTION
    WHEN undefined_table THEN
        RAISE EXCEPTION 'user_behaviorsè¡¨ä¸å­˜åœ¨';
    WHEN duplicate_object THEN
        RAISE WARNING 'éƒ¨åˆ†ç´¢å¼•å·²å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE EXCEPTION 'åˆ›å»ºç´¢å¼•å¤±è´¥: %', SQLERRM;
END $$;
```

### 4.2 å‘é‡å¬å›å®ç°

**åŸºäºç‰©å“å‘é‡çš„å¬å›**ï¼š

```sql
-- ç‰©å“å‘é‡å¬å›ï¼ˆåŸºäºå½“å‰ç‰©å“çš„ç›¸ä¼¼ç‰©å“ï¼Œå¸¦å®Œæ•´é”™è¯¯å¤„ç†ï¼‰
CREATE OR REPLACE FUNCTION recall_similar_items(
    p_item_id BIGINT,
    p_limit INTEGER DEFAULT 100
)
RETURNS TABLE (
    item_id BIGINT,
    title TEXT,
    similarity NUMERIC
) AS $$
DECLARE
    v_item_embedding vector(768);
BEGIN
    -- å‚æ•°éªŒè¯
    IF p_item_id IS NULL OR p_item_id <= 0 THEN
        RAISE EXCEPTION 'ç‰©å“IDæ— æ•ˆ: %', p_item_id;
    END IF;

    IF p_limit IS NULL OR p_limit <= 0 OR p_limit > 10000 THEN
        RAISE EXCEPTION 'limitå‚æ•°æ— æ•ˆ: % (å¿…é¡»åœ¨1-10000ä¹‹é—´)', p_limit;
    END IF;

    -- æ£€æŸ¥pgvectoræ‰©å±•æ˜¯å¦å­˜åœ¨
    IF NOT EXISTS (SELECT 1 FROM pg_extension WHERE extname = 'vector') THEN
        RAISE EXCEPTION 'pgvectoræ‰©å±•æœªå®‰è£…ï¼Œæ— æ³•ä½¿ç”¨å‘é‡æ“ä½œ';
    END IF;

    -- æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
    IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'item_features') THEN
        RAISE EXCEPTION 'item_featuresè¡¨ä¸å­˜åœ¨';
    END IF;

    -- è·å–ç‰©å“å‘é‡
    BEGIN
        SELECT embedding INTO v_item_embedding
        FROM item_features
        WHERE item_id = p_item_id;

        IF NOT FOUND THEN
            RAISE EXCEPTION 'ç‰©å“ä¸å­˜åœ¨: %', p_item_id;
        END IF;

        IF v_item_embedding IS NULL THEN
            RAISE EXCEPTION 'ç‰©å“å‘é‡ä¸ºç©º: %', p_item_id;
        END IF;
    EXCEPTION
        WHEN undefined_table THEN
            RAISE EXCEPTION 'item_featuresè¡¨ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE EXCEPTION 'æŸ¥è¯¢ç‰©å“å‘é‡å¤±è´¥: %', SQLERRM;
    END;

    -- å‘é‡ç›¸ä¼¼åº¦å¬å›
    BEGIN
        RETURN QUERY
        SELECT
            if.item_id,
            if.title,
            GREATEST(0, 1 - (if.embedding <=> v_item_embedding)) AS similarity
        FROM item_features if
        WHERE if.item_id != p_item_id
          AND if.embedding IS NOT NULL
        ORDER BY if.embedding <=> v_item_embedding
        LIMIT p_limit;
    EXCEPTION
        WHEN undefined_function THEN
            RAISE EXCEPTION 'å‘é‡æ“ä½œç¬¦ä¸å¯ç”¨ï¼Œè¯·æ£€æŸ¥pgvectoræ‰©å±•';
        WHEN OTHERS THEN
            RAISE EXCEPTION 'å‘é‡ç›¸ä¼¼åº¦è®¡ç®—å¤±è´¥: %', SQLERRM;
    END;
EXCEPTION
    WHEN OTHERS THEN
        RAISE EXCEPTION 'recall_similar_itemså¤±è´¥: %', SQLERRM;
END;
$$ LANGUAGE plpgsql;
```

**åŸºäºç”¨æˆ·å‘é‡çš„å¬å›**ï¼š

```sql
-- ç”¨æˆ·å‘é‡å¬å›ï¼ˆåŸºäºç”¨æˆ·å…´è¶£çš„ç›¸ä¼¼ç‰©å“ï¼Œå¸¦å®Œæ•´é”™è¯¯å¤„ç†ï¼‰
CREATE OR REPLACE FUNCTION recall_items_for_user(
    p_user_id BIGINT,
    p_limit INTEGER DEFAULT 100
)
RETURNS TABLE (
    item_id BIGINT,
    title TEXT,
    similarity NUMERIC
) AS $$
DECLARE
    v_user_embedding vector(768);
BEGIN
    -- å‚æ•°éªŒè¯
    IF p_user_id IS NULL OR p_user_id <= 0 THEN
        RAISE EXCEPTION 'ç”¨æˆ·IDæ— æ•ˆ: %', p_user_id;
    END IF;

    IF p_limit IS NULL OR p_limit <= 0 OR p_limit > 10000 THEN
        RAISE EXCEPTION 'limitå‚æ•°æ— æ•ˆ: % (å¿…é¡»åœ¨1-10000ä¹‹é—´)', p_limit;
    END IF;

    -- æ£€æŸ¥pgvectoræ‰©å±•æ˜¯å¦å­˜åœ¨
    IF NOT EXISTS (SELECT 1 FROM pg_extension WHERE extname = 'vector') THEN
        RAISE EXCEPTION 'pgvectoræ‰©å±•æœªå®‰è£…ï¼Œæ— æ³•ä½¿ç”¨å‘é‡æ“ä½œ';
    END IF;

    -- æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
    IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'user_features') THEN
        RAISE EXCEPTION 'user_featuresè¡¨ä¸å­˜åœ¨';
    END IF;

    IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'item_features') THEN
        RAISE EXCEPTION 'item_featuresè¡¨ä¸å­˜åœ¨';
    END IF;

    -- è·å–ç”¨æˆ·å‘é‡
    BEGIN
        SELECT embedding INTO v_user_embedding
        FROM user_features
        WHERE user_id = p_user_id;

        IF NOT FOUND THEN
            RAISE EXCEPTION 'ç”¨æˆ·ä¸å­˜åœ¨: %', p_user_id;
        END IF;

        IF v_user_embedding IS NULL THEN
            RAISE EXCEPTION 'ç”¨æˆ·å‘é‡ä¸ºç©º: %', p_user_id;
        END IF;
    EXCEPTION
        WHEN undefined_table THEN
            RAISE EXCEPTION 'user_featuresè¡¨ä¸å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE EXCEPTION 'æŸ¥è¯¢ç”¨æˆ·å‘é‡å¤±è´¥: %', SQLERRM;
    END;

    -- å‘é‡ç›¸ä¼¼åº¦å¬å›
    BEGIN
        RETURN QUERY
        SELECT
            if.item_id,
            if.title,
            GREATEST(0, 1 - (if.embedding <=> v_user_embedding)) AS similarity
        FROM item_features if
        WHERE if.embedding IS NOT NULL
        ORDER BY if.embedding <=> v_user_embedding
        LIMIT p_limit;
    EXCEPTION
        WHEN undefined_function THEN
            RAISE EXCEPTION 'å‘é‡æ“ä½œç¬¦ä¸å¯ç”¨ï¼Œè¯·æ£€æŸ¥pgvectoræ‰©å±•';
        WHEN OTHERS THEN
            RAISE EXCEPTION 'å‘é‡ç›¸ä¼¼åº¦è®¡ç®—å¤±è´¥: %', SQLERRM;
    END;
EXCEPTION
    WHEN OTHERS THEN
        RAISE EXCEPTION 'recall_items_for_userå¤±è´¥: %', SQLERRM;
END;
$$ LANGUAGE plpgsql;
```

### 4.3 æ··åˆæ£€ç´¢å®ç°

**å‘é‡ + ç»“æ„åŒ–æ··åˆæ£€ç´¢**ï¼š

```sql
-- æ··åˆæ£€ç´¢ï¼šå‘é‡ç›¸ä¼¼åº¦ + æ ‡ç­¾è¿‡æ»¤ + åˆ†ç±»è¿‡æ»¤
CREATE OR REPLACE FUNCTION hybrid_recall(
    p_user_id BIGINT,
    p_query_vector vector(768) DEFAULT NULL,
    p_tags TEXT[] DEFAULT NULL,
    p_category_id INTEGER DEFAULT NULL,
    p_limit INTEGER DEFAULT 100
)
RETURNS TABLE (
    item_id BIGINT,
    title TEXT,
    score NUMERIC
) AS $$
DECLARE
    v_user_embedding vector(768);
    v_query_vector vector(768);
BEGIN
    -- è·å–ç”¨æˆ·å‘é‡æˆ–ä½¿ç”¨æŸ¥è¯¢å‘é‡
    IF p_query_vector IS NULL THEN
        SELECT embedding INTO v_user_embedding
        FROM user_features
        WHERE user_id = p_user_id;
        v_query_vector := v_user_embedding;
    ELSE
        v_query_vector := p_query_vector;
    END IF;

    -- æ··åˆæ£€ç´¢
    RETURN QUERY
    SELECT
        if.item_id,
        if.title,
        CASE
            WHEN v_query_vector IS NOT NULL AND if.embedding IS NOT NULL THEN
                1 - (if.embedding <=> v_query_vector) * 0.7  -- å‘é‡ç›¸ä¼¼åº¦æƒé‡70%
            ELSE 0
        END +
        CASE
            WHEN p_tags IS NOT NULL AND if.tags && p_tags THEN
                0.2 * (array_length(array(SELECT unnest(if.tags) INTERSECT SELECT unnest(p_tags)), 1)::NUMERIC / GREATEST(array_length(if.tags, 1), 1))
            ELSE 0
        END +
        CASE
            WHEN p_category_id IS NOT NULL AND if.category_id = p_category_id THEN 0.1
            ELSE 0
        END AS score
    FROM item_features if
    WHERE (v_query_vector IS NULL OR if.embedding IS NOT NULL)
      AND (p_tags IS NULL OR if.tags && p_tags)
      AND (p_category_id IS NULL OR if.category_id = p_category_id)
    ORDER BY score DESC
    LIMIT p_limit;
END;
$$ LANGUAGE plpgsql;
```

### 4.4 å®æ—¶ç‰¹å¾è®¡ç®—

**å®æ—¶ç‰¹å¾æ›´æ–°**ï¼š

```sql
-- ç”¨æˆ·è¡Œä¸ºè§¦å‘å®æ—¶ç‰¹å¾æ›´æ–°
CREATE OR REPLACE FUNCTION update_realtime_features()
RETURNS TRIGGER AS $$
BEGIN
    -- æ›´æ–°ç”¨æˆ·å®æ—¶ç‰¹å¾
    INSERT INTO user_realtime_features (
        user_id, feature_date, click_count, view_count, purchase_count
    ) VALUES (
        NEW.user_id,
        DATE(NEW.behavior_time),
        CASE WHEN NEW.behavior_type = 'click' THEN 1 ELSE 0 END,
        CASE WHEN NEW.behavior_type = 'view' THEN 1 ELSE 0 END,
        CASE WHEN NEW.behavior_type = 'purchase' THEN 1 ELSE 0 END
    )
    ON CONFLICT (user_id, feature_date)
    DO UPDATE SET
        click_count = user_realtime_features.click_count + EXCLUDED.click_count,
        view_count = user_realtime_features.view_count + EXCLUDED.view_count,
        purchase_count = user_realtime_features.purchase_count + EXCLUDED.purchase_count;

    -- æ›´æ–°ç‰©å“å®æ—¶ç‰¹å¾
    INSERT INTO item_realtime_features (
        item_id, feature_date, click_count, view_count, purchase_count
    ) VALUES (
        NEW.item_id,
        DATE(NEW.behavior_time),
        CASE WHEN NEW.behavior_type = 'click' THEN 1 ELSE 0 END,
        CASE WHEN NEW.behavior_type = 'view' THEN 1 ELSE 0 END,
        CASE WHEN NEW.behavior_type = 'purchase' THEN 1 ELSE 0 END
    )
    ON CONFLICT (item_id, feature_date)
    DO UPDATE SET
        click_count = item_realtime_features.click_count + EXCLUDED.click_count,
        view_count = item_realtime_features.view_count + EXCLUDED.view_count,
        purchase_count = item_realtime_features.purchase_count + EXCLUDED.purchase_count;

    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_update_realtime_features
AFTER INSERT ON user_behaviors
FOR EACH ROW
EXECUTE FUNCTION update_realtime_features();
```

**æ—¶é—´çª—å£ç‰¹å¾è®¡ç®—**ï¼š

```sql
-- è®¡ç®—7å¤©æ—¶é—´çª—å£ç‰¹å¾
CREATE OR REPLACE FUNCTION calculate_window_features()
RETURNS VOID AS $$
BEGIN
    -- æ›´æ–°ç”¨æˆ·7å¤©çª—å£ç‰¹å¾
    UPDATE user_realtime_features urf
    SET clicks_7d = (
        SELECT COALESCE(SUM(click_count), 0)
        FROM user_realtime_features
        WHERE user_id = urf.user_id
          AND feature_date BETWEEN urf.feature_date - INTERVAL '6 days' AND urf.feature_date
    ),
    purchases_7d = (
        SELECT COALESCE(SUM(purchase_count), 0)
        FROM user_realtime_features
        WHERE user_id = urf.user_id
          AND feature_date BETWEEN urf.feature_date - INTERVAL '6 days' AND urf.feature_date
    )
    WHERE feature_date >= CURRENT_DATE - INTERVAL '7 days';

    -- æ›´æ–°ç‰©å“7å¤©çª—å£ç‰¹å¾
    UPDATE item_realtime_features irf
    SET clicks_7d = (
        SELECT COALESCE(SUM(click_count), 0)
        FROM item_realtime_features
        WHERE item_id = irf.item_id
          AND feature_date BETWEEN irf.feature_date - INTERVAL '6 days' AND irf.feature_date
    ),
    purchases_7d = (
        SELECT COALESCE(SUM(purchase_count), 0)
        FROM item_realtime_features
        WHERE item_id = irf.item_id
          AND feature_date BETWEEN irf.feature_date - INTERVAL '6 days' AND irf.feature_date
    )
    WHERE feature_date >= CURRENT_DATE - INTERVAL '7 days';
END;
$$ LANGUAGE plpgsql;

-- å®šæ—¶æ‰§è¡Œï¼ˆä½¿ç”¨pg_cronæ‰©å±•ï¼‰
-- SELECT cron.schedule('calculate-window-features', '*/5 * * * *', 'SELECT calculate_window_features();');
```

### 4.5 æ¨èç»“æœç¼“å­˜

**ç‰©åŒ–è§†å›¾ç¼“å­˜æ¨èç»“æœ**ï¼š

```sql
-- çƒ­é—¨ç‰©å“æ¨èï¼ˆç‰©åŒ–è§†å›¾ï¼‰
CREATE MATERIALIZED VIEW mv_popular_items AS
SELECT
    if.item_id,
    if.title,
    if.category_id,
    if.avg_rating,
    COALESCE(irf.clicks_7d, 0) AS clicks_7d,
    COALESCE(irf.purchases_7d, 0) AS purchases_7d,
    -- çƒ­åº¦åˆ†æ•°
    (COALESCE(irf.clicks_7d, 0) * 0.3 + COALESCE(irf.purchases_7d, 0) * 0.7) AS popularity_score
FROM item_features if
LEFT JOIN item_realtime_features irf ON irf.item_id = if.item_id
    AND irf.feature_date = CURRENT_DATE
ORDER BY popularity_score DESC
LIMIT 1000;

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_mv_popular_items_score ON mv_popular_items(popularity_score DESC);
CREATE INDEX idx_mv_popular_items_category ON mv_popular_items(category_id);

-- å®šæœŸåˆ·æ–°ç‰©åŒ–è§†å›¾
-- REFRESH MATERIALIZED VIEW CONCURRENTLY mv_popular_items;
```

**ç”¨æˆ·ä¸ªæ€§åŒ–æ¨èç¼“å­˜**ï¼š

```sql
-- ç”¨æˆ·æ¨èç»“æœè¡¨ï¼ˆç¼“å­˜ï¼‰
CREATE TABLE user_recommendations (
    user_id BIGINT,
    item_id BIGINT,
    score NUMERIC,
    recommendation_type VARCHAR(50),  -- similar, popular, trending
    created_at TIMESTAMPTZ DEFAULT NOW(),
    expires_at TIMESTAMPTZ,
    PRIMARY KEY (user_id, item_id, recommendation_type)
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_user_recommendations_user ON user_recommendations(user_id, score DESC);
CREATE INDEX idx_user_recommendations_expires ON user_recommendations(expires_at)
WHERE expires_at IS NOT NULL;

-- æ¸…ç†è¿‡æœŸæ¨èç»“æœ
CREATE OR REPLACE FUNCTION cleanup_expired_recommendations()
RETURNS INTEGER AS $$
DECLARE
    v_deleted_count INTEGER;
BEGIN
    DELETE FROM user_recommendations
    WHERE expires_at IS NOT NULL AND expires_at < NOW();

    GET DIAGNOSTICS v_deleted_count = ROW_COUNT;
    RETURN v_deleted_count;
END;
$$ LANGUAGE plpgsql;
```

---

## äº”ã€PostgreSQL 18ä¼˜åŒ–

### 5.1 è™šæ‹Ÿç”Ÿæˆåˆ—ä¼˜åŒ–

**ä½¿ç”¨è™šæ‹Ÿç”Ÿæˆåˆ—ä¼˜åŒ–ç›¸ä¼¼åº¦è®¡ç®—**ï¼š

```sql
-- PostgreSQL 18: ä½¿ç”¨è™šæ‹Ÿç”Ÿæˆåˆ—é¢„è®¡ç®—ç›¸ä¼¼åº¦åˆ†æ•°
CREATE TABLE item_similarity_cache (
    item_id BIGINT,
    similar_item_id BIGINT,
    -- è™šæ‹Ÿç”Ÿæˆåˆ—ï¼šè‡ªåŠ¨è®¡ç®—ç›¸ä¼¼åº¦
    similarity_score NUMERIC GENERATED ALWAYS AS (
        1 - (
            (SELECT embedding FROM item_features WHERE item_id = item_similarity_cache.item_id) <=>
            (SELECT embedding FROM item_features WHERE item_id = item_similarity_cache.similar_item_id)
        )
    ) STORED,
    PRIMARY KEY (item_id, similar_item_id)
);

-- ä½¿ç”¨è™šæ‹Ÿç”Ÿæˆåˆ—è¿›è¡Œå¿«é€Ÿæ’åº
SELECT similar_item_id, similarity_score
FROM item_similarity_cache
WHERE item_id = $1
ORDER BY similarity_score DESC
LIMIT 100;
```

### 5.2 å¼‚æ­¥I/Oä¼˜åŒ–

**å¯ç”¨å¼‚æ­¥I/Oæå‡å‘é‡æ£€ç´¢æ€§èƒ½**ï¼š

```sql
-- PostgreSQL 18: åœ¨postgresql.confä¸­é…ç½®
-- io_uring = on  -- å¦‚æœç³»ç»Ÿæ”¯æŒio_uring
-- max_io_concurrency = 10  -- å¼‚æ­¥I/Oå¹¶å‘æ•°

-- å‘é‡æ£€ç´¢æŸ¥è¯¢è‡ªåŠ¨åˆ©ç”¨å¼‚æ­¥I/O
SELECT
    item_id,
    title,
    embedding <=> $1::vector AS distance
FROM item_features
WHERE embedding IS NOT NULL
ORDER BY embedding <=> $1::vector
LIMIT 100;
-- è‡ªåŠ¨ä½¿ç”¨å¼‚æ­¥I/Oï¼Œæ€§èƒ½æå‡2-3å€
```

### 5.3 pgvector 2.0ä¼˜åŒ–

**pgvector 2.0æ–°ç‰¹æ€§**ï¼š

```sql
-- pgvector 2.0: æ”¯æŒsparsevecç±»å‹ï¼ˆç¨€ç–å‘é‡ï¼‰
CREATE EXTENSION IF NOT EXISTS vector;

-- åˆ›å»ºç¨€ç–å‘é‡ç´¢å¼•
CREATE TABLE item_sparse_vectors (
    item_id BIGINT PRIMARY KEY,
    sparse_embedding sparsevec(10000)  -- 10000ç»´ç¨€ç–å‘é‡
);

CREATE INDEX idx_item_sparse_vectors ON item_sparse_vectors
USING hnsw (sparse_embedding sparsevec_l2_ops)
WITH (m = 16, ef_construction = 64);

-- pgvector 2.0: SIMDä¼˜åŒ–ï¼Œå‘é‡æ“ä½œæ€§èƒ½æå‡35-45%
-- è‡ªåŠ¨ä½¿ç”¨SIMDæŒ‡ä»¤åŠ é€Ÿå‘é‡è®¡ç®—
```

---

## å…­ã€çŸ¥è¯†çŸ©é˜µå¯¹æ¯”

### 6.1 å¬å›æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | å¬å›é€Ÿåº¦ | å¬å›ç²¾åº¦ | å®ç°å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ | æ¨èåº¦ |
|------|---------|---------|-----------|---------|--------|
| **å‘é‡å¬å›** | â­â­â­â­â­ | â­â­â­â­ | â­â­â­ | å†…å®¹æ¨èã€ç›¸ä¼¼æ¨è | â­â­â­â­â­ |
| **ååŒè¿‡æ»¤** | â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | ç”¨æˆ·è¡Œä¸ºä¸°å¯Œåœºæ™¯ | â­â­â­â­ |
| **å†…å®¹å¬å›** | â­â­â­â­ | â­â­â­ | â­â­ | æ–°ç‰©å“æ¨è | â­â­â­ |
| **æ··åˆå¬å›** | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | ç»¼åˆåœºæ™¯ | â­â­â­â­â­ |

### 6.2 æ’åºæ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | æ’åºç²¾åº¦ | è®¡ç®—é€Ÿåº¦ | å®ç°å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ | æ¨èåº¦ |
|------|---------|---------|-----------|---------|--------|
| **è§„åˆ™æ’åº** | â­â­ | â­â­â­â­â­ | â­ | ç®€å•åœºæ™¯ | â­â­ |
| **æœºå™¨å­¦ä¹ æ’åº** | â­â­â­â­ | â­â­â­ | â­â­â­â­ | ä¸€èˆ¬åœºæ™¯ | â­â­â­â­ |
| **æ·±åº¦å­¦ä¹ æ’åº** | â­â­â­â­â­ | â­â­ | â­â­â­â­â­ | å¤æ‚åœºæ™¯ | â­â­â­â­â­ |

### 6.3 å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | æŸ¥è¯¢æ€§èƒ½ | å†™å…¥æ€§èƒ½ | å­˜å‚¨æˆæœ¬ | é€‚ç”¨åœºæ™¯ | æ¨èåº¦ |
|------|---------|---------|---------|---------|--------|
| **PostgreSQL + pgvector** | â­â­â­â­â­ | â­â­â­â­ | â­â­â­ | ä¸­å°è§„æ¨¡ | â­â­â­â­â­ |
| **ä¸“ç”¨å‘é‡æ•°æ®åº“** | â­â­â­â­â­ | â­â­â­â­â­ | â­â­ | å¤§è§„æ¨¡ | â­â­â­â­ |
| **æ··åˆå­˜å‚¨** | â­â­â­â­ | â­â­â­ | â­â­â­ | å¤æ‚åœºæ™¯ | â­â­â­â­ |

---

## ä¸ƒã€å®è·µæ¡ˆä¾‹

### 7.1 ç”µå•†å•†å“æ¨è

**åœºæ™¯**ï¼šç”µå•†å¹³å°å•†å“æ¨è

**å®ç°è¦ç‚¹**ï¼š

```sql
-- å•†å“æ¨èå‡½æ•°
CREATE OR REPLACE FUNCTION recommend_products(
    p_user_id BIGINT,
    p_limit INTEGER DEFAULT 20
)
RETURNS TABLE (
    item_id BIGINT,
    title TEXT,
    price NUMERIC,
    score NUMERIC
) AS $$
BEGIN
    RETURN QUERY
    WITH user_vector AS (
        SELECT embedding FROM user_features WHERE user_id = p_user_id
    ),
    candidate_items AS (
        -- å‘é‡å¬å›
        SELECT
            if.item_id,
            if.title,
            if.price,
            1 - (if.embedding <=> uv.embedding) AS similarity_score
        FROM item_features if, user_vector uv
        WHERE if.embedding IS NOT NULL
          AND if.item_id NOT IN (
              SELECT item_id FROM user_behaviors
              WHERE user_id = p_user_id AND behavior_type = 'purchase'
          )
        ORDER BY if.embedding <=> uv.embedding
        LIMIT 200
    ),
    scored_items AS (
        SELECT
            ci.*,
            -- ç»¼åˆåˆ†æ•°ï¼šç›¸ä¼¼åº¦ + çƒ­åº¦ + ä»·æ ¼
            ci.similarity_score * 0.5 +
            COALESCE(irf.clicks_7d, 0) / 1000.0 * 0.3 +
            CASE WHEN ci.price < 100 THEN 0.2 ELSE 0 END AS final_score
        FROM candidate_items ci
        LEFT JOIN item_realtime_features irf ON irf.item_id = ci.item_id
            AND irf.feature_date = CURRENT_DATE
    )
    SELECT
        item_id,
        title,
        price,
        final_score AS score
    FROM scored_items
    ORDER BY final_score DESC
    LIMIT p_limit;
END;
$$ LANGUAGE plpgsql;
```

### 7.2 å†…å®¹æ¨èç³»ç»Ÿ

**åœºæ™¯**ï¼šå†…å®¹å¹³å°æ–‡ç« æ¨è

**å®ç°è¦ç‚¹**ï¼š

```sql
-- æ–‡ç« æ¨èå‡½æ•°
CREATE OR REPLACE FUNCTION recommend_articles(
    p_user_id BIGINT,
    p_limit INTEGER DEFAULT 20
)
RETURNS TABLE (
    article_id BIGINT,
    title TEXT,
    category_id INTEGER,
    score NUMERIC
) AS $$
BEGIN
    RETURN QUERY
    WITH user_preferences AS (
        SELECT preferences FROM user_features WHERE user_id = p_user_id
    ),
    candidate_articles AS (
        -- åŸºäºç”¨æˆ·é˜…è¯»å†å²çš„ç›¸ä¼¼æ–‡ç« 
        SELECT DISTINCT
            a2.article_id,
            a2.title,
            a2.category_id,
            1 - (a2.embedding <=> a1.embedding) AS similarity_score
        FROM user_behaviors ub
        JOIN article_features a1 ON a1.article_id = ub.article_id
        JOIN article_features a2 ON a2.article_id != ub.article_id
        WHERE ub.user_id = p_user_id
          AND ub.behavior_type = 'read'
          AND ub.behavior_time >= NOW() - INTERVAL '30 days'
        ORDER BY a2.embedding <=> a1.embedding
        LIMIT 100
    )
    SELECT
        article_id,
        title,
        category_id,
        similarity_score AS score
    FROM candidate_articles
    ORDER BY similarity_score DESC
    LIMIT p_limit;
END;
$$ LANGUAGE plpgsql;
```

### 7.3 å¹¿å‘Šæ¨èç³»ç»Ÿ

**åœºæ™¯**ï¼šå¹¿å‘Šå¹³å°å¹¿å‘Šæ¨è

**å®ç°è¦ç‚¹**ï¼š

```sql
-- å¹¿å‘Šæ¨èå‡½æ•°ï¼ˆè€ƒè™‘CTRå’Œå‡ºä»·ï¼‰
CREATE OR REPLACE FUNCTION recommend_ads(
    p_user_id BIGINT,
    p_limit INTEGER DEFAULT 10
)
RETURNS TABLE (
    ad_id BIGINT,
    title TEXT,
    bid_price NUMERIC,
    score NUMERIC
) AS $$
BEGIN
    RETURN QUERY
    WITH user_profile AS (
        SELECT embedding, preferences FROM user_features WHERE user_id = p_user_id
    ),
    candidate_ads AS (
        SELECT
            af.ad_id,
            af.title,
            af.bid_price,
            -- ç›¸ä¼¼åº¦åˆ†æ•°
            1 - (af.embedding <=> up.embedding) AS similarity_score,
            -- CTRé¢„ä¼°
            COALESCE(arf.ctr_7d, 0.01) AS estimated_ctr
        FROM ad_features af, user_profile up
        LEFT JOIN ad_realtime_features arf ON arf.ad_id = af.ad_id
            AND arf.feature_date = CURRENT_DATE
        WHERE af.status = 'active'
          AND af.embedding IS NOT NULL
    )
    SELECT
        ad_id,
        title,
        bid_price,
        -- eCPMæ’åºï¼šbid_price * estimated_ctr * 1000
        (similarity_score * 0.4 + estimated_ctr * 0.6) * bid_price AS score
    FROM candidate_ads
    ORDER BY score DESC
    LIMIT p_limit;
END;
$$ LANGUAGE plpgsql;
```

---

## å…«ã€æ€§èƒ½ä¼˜åŒ–

### 8.1 æŸ¥è¯¢ä¼˜åŒ–

**å‘é‡æ£€ç´¢ä¼˜åŒ–**ï¼š

```sql
-- ä½¿ç”¨HNSWç´¢å¼•å‚æ•°ä¼˜åŒ–
CREATE INDEX idx_item_features_embedding_optimized ON item_features
USING hnsw (embedding vector_cosine_ops)
WITH (
    m = 32,              -- æ¯ä¸ªèŠ‚ç‚¹çš„è¿æ¥æ•°ï¼ˆè¶Šå¤§è¶Šç²¾ç¡®ï¼Œä½†ç´¢å¼•è¶Šå¤§ï¼‰
    ef_construction = 200  -- æ„å»ºæ—¶çš„æœç´¢å®½åº¦ï¼ˆè¶Šå¤§è¶Šç²¾ç¡®ï¼Œä½†æ„å»ºè¶Šæ…¢ï¼‰
);

-- æŸ¥è¯¢æ—¶è°ƒæ•´ef_searchå‚æ•°
SET hnsw.ef_search = 100;  -- æŸ¥è¯¢æ—¶çš„æœç´¢å®½åº¦ï¼ˆè¶Šå¤§è¶Šç²¾ç¡®ï¼Œä½†æŸ¥è¯¢è¶Šæ…¢ï¼‰

SELECT item_id, title
FROM item_features
WHERE embedding IS NOT NULL
ORDER BY embedding <=> $1::vector
LIMIT 20;
```

**æ‰¹é‡æŸ¥è¯¢ä¼˜åŒ–**ï¼š

```sql
-- æ‰¹é‡å‘é‡å¬å›
CREATE OR REPLACE FUNCTION batch_recall(
    p_item_ids BIGINT[],
    p_limit_per_item INTEGER DEFAULT 10
)
RETURNS TABLE (
    source_item_id BIGINT,
    recommended_item_id BIGINT,
    similarity NUMERIC
) AS $$
BEGIN
    RETURN QUERY
    WITH item_vectors AS (
        SELECT item_id, embedding
        FROM item_features
        WHERE item_id = ANY(p_item_ids)
          AND embedding IS NOT NULL
    )
    SELECT
        iv.item_id AS source_item_id,
        if.item_id AS recommended_item_id,
        1 - (if.embedding <=> iv.embedding) AS similarity
    FROM item_vectors iv
    CROSS JOIN LATERAL (
        SELECT item_id, embedding
        FROM item_features
        WHERE embedding IS NOT NULL
          AND item_id != iv.item_id
        ORDER BY embedding <=> iv.embedding
        LIMIT p_limit_per_item
    ) if;
END;
$$ LANGUAGE plpgsql;
```

### 8.2 å†™å…¥ä¼˜åŒ–

**æ‰¹é‡å†™å…¥ä¼˜åŒ–**ï¼š

```sql
-- ä½¿ç”¨COPYè¿›è¡Œæ‰¹é‡å†™å…¥
COPY user_behaviors (user_id, item_id, behavior_type, behavior_time)
FROM STDIN WITH (FORMAT csv);

-- ä½¿ç”¨äº‹åŠ¡æ‰¹é‡å†™å…¥
BEGIN;
INSERT INTO user_behaviors (...) VALUES (...);
INSERT INTO user_behaviors (...) VALUES (...);
COMMIT;
```

**å¼‚æ­¥å†™å…¥**ï¼š

```sql
-- ä½¿ç”¨NOTIFY/NOTIFYå®ç°å¼‚æ­¥å†™å…¥
CREATE OR REPLACE FUNCTION async_insert_behavior(
    p_user_id BIGINT,
    p_item_id BIGINT,
    p_behavior_type VARCHAR(20)
)
RETURNS VOID AS $$
BEGIN
    -- æ’å…¥åˆ°ä¸´æ—¶è¡¨
    INSERT INTO user_behaviors_queue (user_id, item_id, behavior_type)
    VALUES (p_user_id, p_item_id, p_behavior_type);

    -- é€šçŸ¥åå°å¤„ç†
    PERFORM pg_notify('behavior_insert', '');
END;
$$ LANGUAGE plpgsql;
```

### 8.3 ç¼“å­˜ä¼˜åŒ–

**å¤šçº§ç¼“å­˜ç­–ç•¥**ï¼š

1. **L1ç¼“å­˜**ï¼šåº”ç”¨å†…å­˜ç¼“å­˜ï¼ˆçƒ­ç‚¹æ•°æ®ï¼‰
2. **L2ç¼“å­˜**ï¼šRedisç¼“å­˜ï¼ˆæ¨èç»“æœï¼‰
3. **L3ç¼“å­˜**ï¼šPostgreSQLç‰©åŒ–è§†å›¾ï¼ˆé¢„è®¡ç®—æ•°æ®ï¼‰

```sql
-- ä½¿ç”¨ç‰©åŒ–è§†å›¾ç¼“å­˜çƒ­é—¨æ¨è
CREATE MATERIALIZED VIEW mv_hot_recommendations AS
SELECT
    category_id,
    item_id,
    title,
    popularity_score
FROM (
    SELECT
        if.category_id,
        if.item_id,
        if.title,
        (COALESCE(irf.clicks_7d, 0) * 0.3 + COALESCE(irf.purchases_7d, 0) * 0.7) AS popularity_score,
        ROW_NUMBER() OVER (PARTITION BY if.category_id ORDER BY
            (COALESCE(irf.clicks_7d, 0) * 0.3 + COALESCE(irf.purchases_7d, 0) * 0.7) DESC
        ) AS rn
    FROM item_features if
    LEFT JOIN item_realtime_features irf ON irf.item_id = if.item_id
        AND irf.feature_date = CURRENT_DATE
) ranked
WHERE rn <= 100;

-- å®šæœŸåˆ·æ–°
REFRESH MATERIALIZED VIEW CONCURRENTLY mv_hot_recommendations;
```

---

## ä¹ã€ç›‘æ§ä¸éªŒè¯

### 9.1 å…³é”®æŒ‡æ ‡

**æ€§èƒ½æŒ‡æ ‡**ï¼š

- æ¨èè¯·æ±‚å»¶è¿Ÿï¼ˆP50, P95, P99ï¼‰
- å‘é‡æ£€ç´¢QPS
- ç‰¹å¾è®¡ç®—å»¶è¿Ÿ
- ç¼“å­˜å‘½ä¸­ç‡

**ä¸šåŠ¡æŒ‡æ ‡**ï¼š

- æ¨èç‚¹å‡»ç‡ï¼ˆCTRï¼‰
- æ¨èè½¬åŒ–ç‡ï¼ˆCVRï¼‰
- æ¨èè¦†ç›–ç‡
- æ¨èå¤šæ ·æ€§

### 9.2 ç›‘æ§æ–¹æ¡ˆ

**æŸ¥è¯¢æ€§èƒ½ç›‘æ§**ï¼š

```sql
-- å¯ç”¨pg_stat_statements
CREATE EXTENSION IF NOT EXISTS pg_stat_statements;

-- æŸ¥çœ‹æ¨èæŸ¥è¯¢æ€§èƒ½
SELECT
    query,
    calls,
    mean_exec_time,
    max_exec_time
FROM pg_stat_statements
WHERE query LIKE '%recommend%' OR query LIKE '%recall%'
ORDER BY mean_exec_time DESC
LIMIT 20;
```

**æ¨èæ•ˆæœç›‘æ§**ï¼š

```sql
-- æ¨èæ•ˆæœç»Ÿè®¡è¡¨
CREATE TABLE recommendation_metrics (
    metric_date DATE,
    user_id BIGINT,
    recommendation_type VARCHAR(50),
    item_id BIGINT,
    position INTEGER,
    clicked BOOLEAN DEFAULT FALSE,
    converted BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- è®¡ç®—CTR
SELECT
    recommendation_type,
    COUNT(*) AS total_impressions,
    COUNT(*) FILTER (WHERE clicked) AS clicks,
    COUNT(*) FILTER (WHERE clicked)::NUMERIC / COUNT(*) AS ctr
FROM recommendation_metrics
WHERE metric_date >= CURRENT_DATE - INTERVAL '7 days'
GROUP BY recommendation_type;
```

### 9.3 éªŒè¯æ–¹æ³•

**A/Bæµ‹è¯•**ï¼š

```sql
-- A/Bæµ‹è¯•åˆ†ç»„
CREATE TABLE ab_test_groups (
    user_id BIGINT PRIMARY KEY,
    group_name VARCHAR(20),  -- 'control', 'treatment'
    assigned_at TIMESTAMPTZ DEFAULT NOW()
);

-- æ ¹æ®ç”¨æˆ·IDåˆ†é…æµ‹è¯•ç»„
CREATE OR REPLACE FUNCTION assign_ab_group(p_user_id BIGINT)
RETURNS VARCHAR(20) AS $$
DECLARE
    v_group VARCHAR(20);
BEGIN
    -- ä½¿ç”¨ç”¨æˆ·IDçš„å“ˆå¸Œå€¼åˆ†é…ç»„
    IF (p_user_id % 2) = 0 THEN
        v_group := 'control';
    ELSE
        v_group := 'treatment';
    END IF;

    INSERT INTO ab_test_groups (user_id, group_name)
    VALUES (p_user_id, v_group)
    ON CONFLICT (user_id) DO NOTHING;

    RETURN v_group;
END;
$$ LANGUAGE plpgsql;
```

---

## åã€æœ€ä½³å®è·µ

### 10.1 æ¶æ„æœ€ä½³å®è·µ

1. **åˆ†å±‚æ¶æ„**ï¼š
   - å¬å›å±‚ï¼šå¿«é€Ÿç­›é€‰å€™é€‰é›†
   - æ’åºå±‚ï¼šç²¾ç¡®æ’åº
   - é‡æ’å±‚ï¼šä¸šåŠ¡è§„åˆ™è°ƒæ•´

2. **ç‰¹å¾ç®¡ç†**ï¼š
   - ç‰¹å¾ç‰ˆæœ¬åŒ–
   - ç‰¹å¾ç›‘æ§
   - ç‰¹å¾ä¸€è‡´æ€§ä¿è¯

3. **ç¼“å­˜ç­–ç•¥**ï¼š
   - å¤šçº§ç¼“å­˜
   - ç¼“å­˜é¢„çƒ­
   - ç¼“å­˜å¤±æ•ˆç­–ç•¥

### 10.2 æ€§èƒ½æœ€ä½³å®è·µ

1. **å‘é‡ç´¢å¼•ä¼˜åŒ–**ï¼š
   - åˆç†è®¾ç½®HNSWå‚æ•°
   - å®šæœŸé‡å»ºç´¢å¼•
   - ç›‘æ§ç´¢å¼•æ€§èƒ½

2. **æŸ¥è¯¢ä¼˜åŒ–**ï¼š
   - ä½¿ç”¨ç‰©åŒ–è§†å›¾
   - æ‰¹é‡æŸ¥è¯¢ä¼˜åŒ–
   - è¿æ¥æ± ç®¡ç†

3. **å†™å…¥ä¼˜åŒ–**ï¼š
   - æ‰¹é‡å†™å…¥
   - å¼‚æ­¥å†™å…¥
   - åˆ†åŒºè¡¨ç®¡ç†

---

## åä¸€ã€å‚è€ƒèµ„æº

### 11.1 å®˜æ–¹æ–‡æ¡£

- [PostgreSQL pgvectoræ‰©å±•](https://github.com/pgvector/pgvector)
- [PostgreSQLç‰©åŒ–è§†å›¾](https://www.postgresql.org/docs/current/sql-creatematerializedview.html)
- [PostgreSQL JSONB](https://www.postgresql.org/docs/current/datatype-json.html)

### 11.2 ç½‘ç»œèµ„æº

- [æ¨èç³»ç»Ÿå®è·µ](https://www.postgresql.org/docs/current/)
- [å‘é‡æ•°æ®åº“æœ€ä½³å®è·µ](https://github.com/pgvector/pgvector)
- [å®æ—¶æ¨èç³»ç»Ÿæ¶æ„](https://www.postgresql.org/docs/current/)

### 11.3 ç›¸å…³æ–‡æ¡£

- â­â­â­ [æ•°æ®ç§‘å­¦å®è·µ](./07.06-æ•°æ®ç§‘å­¦å®è·µ.md) - æ•°æ®ç§‘å­¦å®Œæ•´æŒ‡å—
- â­â­ [å¤šæ¨¡å‹æ•°æ®åº“](../../../07-å¤šæ¨¡å‹æ•°æ®åº“/README.md) - pgvectorè¯¦ç»†è¯´æ˜
- â­â­ [ETLæµç¨‹å®Œæ•´æŒ‡å—](../æ•°æ®æ¨¡å‹è®¾è®¡/09.04-ETLæµç¨‹å®Œæ•´æŒ‡å—.md) - æµå¼ETLå¤„ç†
- â­ [PostgreSQL 18æ–°ç‰¹æ€§](../../../18-ç‰ˆæœ¬ç‰¹æ€§/02.01-PostgreSQL-18-æ–°ç‰¹æ€§.md) - è™šæ‹Ÿç”Ÿæˆåˆ—å’Œå¼‚æ­¥I/O
- â­ [å®æ—¶æ¨è](../è¡Œä¸šæ¡ˆä¾‹/å®æ—¶æ¨è.md) - å®Œæ•´ç«¯åˆ°ç«¯æ¡ˆä¾‹

---

## åäºŒã€äº¤å‰å¼•ç”¨

### ç›¸å…³æ–‡æ¡£

#### åº”ç”¨æ¶æ„

- â­â­â­ [æ•°æ®ç§‘å­¦å®è·µ](./07.06-æ•°æ®ç§‘å­¦å®è·µ.md) - æ•°æ®ç§‘å­¦å®Œæ•´æŒ‡å—

#### æ•°æ®æ¨¡å‹è®¾è®¡

- â­â­â­ [æ•°æ®åˆ†æå®Œæ•´æŒ‡å—](../æ•°æ®æ¨¡å‹è®¾è®¡/09.01-æ•°æ®åˆ†æå®Œæ•´æŒ‡å—.md) - æ¨èæ•°æ®åˆ†æ
- â­â­ [æ•°æ®å»ºæ¨¡å®Œæ•´æŒ‡å—](../æ•°æ®æ¨¡å‹è®¾è®¡/09.02-æ•°æ®å»ºæ¨¡å®Œæ•´æŒ‡å—.md) - æ¨èç³»ç»Ÿæ•°æ®å»ºæ¨¡
- â­â­ [ETLæµç¨‹å®Œæ•´æŒ‡å—](../æ•°æ®æ¨¡å‹è®¾è®¡/09.04-ETLæµç¨‹å®Œæ•´æŒ‡å—.md) - æµå¼ETLå¤„ç†

#### é«˜çº§ç‰¹æ€§

- â­â­â­ [å¤šæ¨¡å‹æ•°æ®åº“](../../../07-å¤šæ¨¡å‹æ•°æ®åº“/README.md) - pgvectorè¯¦ç»†è¯´æ˜

#### å‰æ²¿æŠ€æœ¯

- â­â­ [å¤šæ¨¡å‹æ•°æ®åº“](../../../07-å¤šæ¨¡å‹æ•°æ®åº“/README.md) - å‘é‡æ£€ç´¢ä¼˜åŒ–
- â­ [AIä¸æœºå™¨å­¦ä¹ ](../../../10-AIä¸æœºå™¨å­¦ä¹ /README.md) - RAGæ¶æ„å®è·µ

#### ç‰ˆæœ¬ç‰¹æ€§

- â­â­ [PostgreSQL 18æ–°ç‰¹æ€§](../../../18-ç‰ˆæœ¬ç‰¹æ€§/02.01-PostgreSQL-18-æ–°ç‰¹æ€§.md) - è™šæ‹Ÿç”Ÿæˆåˆ—å’Œå¼‚æ­¥I/O

#### è¡Œä¸šæ¡ˆä¾‹

- â­â­â­ [å®æ—¶æ¨è](../è¡Œä¸šæ¡ˆä¾‹/å®æ—¶æ¨è.md) - å®Œæ•´ç«¯åˆ°ç«¯æ¡ˆä¾‹

### å¤–éƒ¨èµ„æº

- [PostgreSQLç‰©åŒ–è§†å›¾æ–‡æ¡£](https://www.postgresql.org/docs/current/sql-creatematerializedview.html)
- [PostgreSQL JSONBæ–‡æ¡£](https://www.postgresql.org/docs/current/datatype-json.html)
- [pgvectorå®˜æ–¹æ–‡æ¡£](https://github.com/pgvector/pgvector)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v3.0
**æœ€åæ›´æ–°**: 2025-11-22
**PostgreSQLç‰ˆæœ¬**: 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x (å…¼å®¹)
**ç»´æŠ¤è€…**: Data-Science Team
