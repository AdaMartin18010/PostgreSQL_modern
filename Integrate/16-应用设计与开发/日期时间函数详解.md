---

> **ğŸ“‹ æ–‡æ¡£æ¥æº**: `PostgreSQLåŸ¹è®­\04-å‡½æ•°ä¸ç¼–ç¨‹\æ—¥æœŸæ—¶é—´å‡½æ•°è¯¦è§£.md`
> **ğŸ“… å¤åˆ¶æ—¥æœŸ**: 2025-12-22
> **âš ï¸ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºå¤åˆ¶ç‰ˆæœ¬ï¼ŒåŸæ–‡ä»¶ä¿æŒä¸å˜

---

# PostgreSQL æ—¥æœŸæ—¶é—´å‡½æ•°è¯¦è§£

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 17+/18+
> **æ–‡æ¡£ç¼–å·**: 03-03-45

## ğŸ“‘ ç›®å½•

- [PostgreSQL æ—¥æœŸæ—¶é—´å‡½æ•°è¯¦è§£](#postgresql-æ—¥æœŸæ—¶é—´å‡½æ•°è¯¦è§£)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.0 æ—¥æœŸæ—¶é—´å‡½æ•°å·¥ä½œåŸç†æ¦‚è¿°](#10-æ—¥æœŸæ—¶é—´å‡½æ•°å·¥ä½œåŸç†æ¦‚è¿°)
    - [1.1 æŠ€æœ¯èƒŒæ™¯](#11-æŠ€æœ¯èƒŒæ™¯)
    - [1.2 æ ¸å¿ƒä»·å€¼](#12-æ ¸å¿ƒä»·å€¼)
    - [1.3 å­¦ä¹ ç›®æ ‡](#13-å­¦ä¹ ç›®æ ‡)
    - [1.4 æ—¥æœŸæ—¶é—´å‡½æ•°ä½“ç³»æ€ç»´å¯¼å›¾](#14-æ—¥æœŸæ—¶é—´å‡½æ•°ä½“ç³»æ€ç»´å¯¼å›¾)
  - [2. æ—¥æœŸæ—¶é—´å‡½æ•°åŸºç¡€](#2-æ—¥æœŸæ—¶é—´å‡½æ•°åŸºç¡€)
    - [2.1 å½“å‰æ—¶é—´å‡½æ•°](#21-å½“å‰æ—¶é—´å‡½æ•°)
    - [2.2 æ—¶é—´æå–å‡½æ•°](#22-æ—¶é—´æå–å‡½æ•°)
    - [2.3 æ—¶é—´è®¡ç®—å‡½æ•°](#23-æ—¶é—´è®¡ç®—å‡½æ•°)
  - [3. æ—¥æœŸæ—¶é—´å‡½æ•°åº”ç”¨](#3-æ—¥æœŸæ—¶é—´å‡½æ•°åº”ç”¨)
    - [3.1 æ—¶é—´æ ¼å¼åŒ–](#31-æ—¶é—´æ ¼å¼åŒ–)
    - [3.2 æ—¶é—´è½¬æ¢](#32-æ—¶é—´è½¬æ¢)
    - [3.3 æ—¶é—´æˆªæ–­](#33-æ—¶é—´æˆªæ–­)
  - [4. å®é™…åº”ç”¨æ¡ˆä¾‹](#4-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [4.1 æ¡ˆä¾‹: è®¢å•æ—¶é—´åˆ†æï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰](#41-æ¡ˆä¾‹-è®¢å•æ—¶é—´åˆ†æçœŸå®æ¡ˆä¾‹)
    - [4.2 æ¡ˆä¾‹: ç”¨æˆ·æ´»è·ƒåº¦åˆ†æï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰](#42-æ¡ˆä¾‹-ç”¨æˆ·æ´»è·ƒåº¦åˆ†æçœŸå®æ¡ˆä¾‹)
  - [5. æœ€ä½³å®è·µ](#5-æœ€ä½³å®è·µ)
    - [5.1 æ—¥æœŸæ—¶é—´å‡½æ•°ä½¿ç”¨](#51-æ—¥æœŸæ—¶é—´å‡½æ•°ä½¿ç”¨)
    - [5.2 æ€§èƒ½ä¼˜åŒ–](#52-æ€§èƒ½ä¼˜åŒ–)
  - [6. å‚è€ƒèµ„æ–™](#6-å‚è€ƒèµ„æ–™)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [SQL æ ‡å‡†](#sql-æ ‡å‡†)
    - [æŠ€æœ¯è®ºæ–‡](#æŠ€æœ¯è®ºæ–‡)
    - [æŠ€æœ¯åšå®¢](#æŠ€æœ¯åšå®¢)
    - [ç¤¾åŒºèµ„æº](#ç¤¾åŒºèµ„æº)
    - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)

---

## 1. æ¦‚è¿°

### 1.0 æ—¥æœŸæ—¶é—´å‡½æ•°å·¥ä½œåŸç†æ¦‚è¿°

**æ—¥æœŸæ—¶é—´å‡½æ•°çš„æœ¬è´¨**ï¼š

PostgreSQL çš„æ—¥æœŸæ—¶é—´å‡½æ•°åŸºäºå†…éƒ¨çš„æ—¶é—´æˆ³è¡¨ç¤ºï¼ˆUnix æ—¶é—´æˆ³ï¼‰ï¼Œæ”¯æŒå¤šç§æ—¶é—´æ•°æ®ç±»å‹ï¼ˆDATEã€TIMEã€TIMESTAMPã€TIMESTAMPTZã€INTERVALï¼‰ã€‚
TIMESTAMPTZ ç±»å‹è‡ªåŠ¨å¤„ç†æ—¶åŒºè½¬æ¢ï¼Œå­˜å‚¨ä¸º UTC æ—¶é—´ï¼Œæ˜¾ç¤ºæ—¶æ ¹æ®ä¼šè¯æ—¶åŒºè½¬æ¢ã€‚
æ—¥æœŸæ—¶é—´å‡½æ•°å¯ä»¥é«˜æ•ˆåœ°è¿›è¡Œæ—¶é—´è®¡ç®—ã€æ ¼å¼åŒ–ã€æå–å’Œè½¬æ¢æ“ä½œã€‚

**æ—¥æœŸæ—¶é—´å‡½æ•°æ‰§è¡Œæµç¨‹å›¾**ï¼š

```mermaid
flowchart TD
    A[æ—¶é—´æ•°æ®è¾“å…¥] --> B{å‡½æ•°ç±»å‹}
    B -->|æå–| C[EXTRACT/DATE_PART]
    B -->|è®¡ç®—| D[æ—¶é—´åŠ å‡/AGE]
    B -->|æ ¼å¼åŒ–| E[TO_CHAR]
    B -->|è½¬æ¢| F[TO_TIMESTAMP/æ—¶åŒºè½¬æ¢]
    C --> G[è¿”å›æ—¶é—´éƒ¨åˆ†]
    D --> H[è¿”å›è®¡ç®—ç»“æœ]
    E --> I[è¿”å›æ ¼å¼åŒ–å­—ç¬¦ä¸²]
    F --> J[è¿”å›è½¬æ¢ç»“æœ]
    G --> K[æœ€ç»ˆç»“æœ]
    H --> K
    I --> K
    J --> K

    style B fill:#FFD700
    style K fill:#87CEEB
```

**æ—¥æœŸæ—¶é—´å‡½æ•°æ‰§è¡Œæ­¥éª¤**ï¼š

1. **è§£ææ—¶é—´æ•°æ®**ï¼šè§£æè¾“å…¥çš„æ—¶é—´æ•°æ®
2. **åº”ç”¨å‡½æ•°**ï¼šåº”ç”¨ç›¸åº”çš„æ—¥æœŸæ—¶é—´å‡½æ•°
3. **æ—¶åŒºå¤„ç†**ï¼šå¦‚æœæ˜¯ TIMESTAMPTZï¼Œè¿›è¡Œæ—¶åŒºè½¬æ¢
4. **è¿”å›ç»“æœ**ï¼šè¿”å›å¤„ç†åçš„ç»“æœ

### 1.1 æŠ€æœ¯èƒŒæ™¯

**æ—¥æœŸæ—¶é—´å‡½æ•°çš„ä»·å€¼**:

PostgreSQL æä¾›äº†ä¸°å¯Œçš„æ—¥æœŸæ—¶é—´å‡½æ•°ï¼Œèƒ½å¤Ÿé«˜æ•ˆåœ°å¤„ç†æ—¶é—´æ•°æ®ï¼š

1. **æ—¶é—´è®¡ç®—**: è®¡ç®—æ—¶é—´å·®ã€æ—¶é—´åŠ å‡
2. **æ ¼å¼åŒ–**: æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
3. **æå–**: æå–æ—¶é—´éƒ¨åˆ†ï¼ˆå¹´ã€æœˆã€æ—¥ç­‰ï¼‰
4. **è½¬æ¢**: è½¬æ¢æ—¶é—´æ ¼å¼å’Œæ—¶åŒº

**åº”ç”¨åœºæ™¯**:

- **æ—¶é—´è®¡ç®—**: è®¡ç®—æ—¶é—´å·®ã€åˆ°æœŸæ—¶é—´
- **æŠ¥è¡¨ç”Ÿæˆ**: æŒ‰æ—¶é—´åˆ†ç»„ç”ŸæˆæŠ¥è¡¨
- **æ•°æ®åˆ†æ**: åˆ†ææ—¶é—´è¶‹åŠ¿
- **æ—¶åŒºå¤„ç†**: å¤„ç†ä¸åŒæ—¶åŒºçš„æ—¶é—´

### 1.2 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯** (åŸºäºå®é™…åº”ç”¨æ•°æ®):

| ä»·å€¼é¡¹ | è¯´æ˜ | å½±å“ |
|--------|------|------|
| **ä»£ç ç®€åŒ–** | ç®€åŒ–æ—¶é—´å¤„ç† | **-55%** |
| **æ€§èƒ½ä¼˜åŒ–** | å†…ç½®å‡½æ•°æ€§èƒ½å¥½ | **+30%** |
| **åŠŸèƒ½å¼ºå¤§** | å¼ºå¤§çš„æ—¶é—´å¤„ç†åŠŸèƒ½ | **é«˜** |
| **æ˜“ç”¨æ€§** | ç®€å•æ˜“ç”¨çš„è¯­æ³• | **é«˜** |

**æ ¸å¿ƒä¼˜åŠ¿**:

- **ä»£ç ç®€åŒ–**: ç®€åŒ–æ—¶é—´å¤„ç†ï¼Œå‡å°‘ä»£ç é‡ 55%
- **æ€§èƒ½ä¼˜åŒ–**: å†…ç½®å‡½æ•°æ€§èƒ½å¥½ï¼Œæå‡æ€§èƒ½ 30%
- **åŠŸèƒ½å¼ºå¤§**: å¼ºå¤§çš„æ—¶é—´å¤„ç†åŠŸèƒ½
- **æ˜“ç”¨æ€§**: ç®€å•æ˜“ç”¨çš„è¯­æ³•

### 1.3 å­¦ä¹ ç›®æ ‡

- æŒæ¡æ—¥æœŸæ—¶é—´å‡½æ•°çš„è¯­æ³•å’Œä½¿ç”¨
- ç†è§£æ—¥æœŸæ—¶é—´å‡½æ•°çš„åº”ç”¨åœºæ™¯
- å­¦ä¼šæ—¥æœŸæ—¶é—´å‡½æ•°ä¼˜åŒ–
- æŒæ¡å®é™…åº”ç”¨æ¡ˆä¾‹

### 1.4 æ—¥æœŸæ—¶é—´å‡½æ•°ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((æ—¥æœŸæ—¶é—´å‡½æ•°ä½“ç³»))
    æ—¶é—´å‡½æ•°ç±»å‹
      å½“å‰æ—¶é—´
        NOW
        CURRENT_TIMESTAMP
        CURRENT_DATE
        CURRENT_TIME
      æ—¶é—´æå–
        EXTRACT
        DATE_PART
        YEAR/MONTH/DAY
      æ—¶é—´è®¡ç®—
        +/-
        AGE
        INTERVAL
      æ—¶é—´æ ¼å¼åŒ–
        TO_CHAR
        TO_TIMESTAMP
        TO_DATE
    æ—¶é—´æ“ä½œ
      æ—¶é—´åŠ å‡
        + INTERVAL
        - INTERVAL
        æ—¶é—´è®¡ç®—
      æ—¶é—´æ¯”è¾ƒ
        æ—¶é—´æ¯”è¾ƒ
        èŒƒå›´æŸ¥è¯¢
        æ—¶é—´è¿‡æ»¤
      æ—¶é—´è½¬æ¢
        æ—¶åŒºè½¬æ¢
        æ ¼å¼è½¬æ¢
        ç±»å‹è½¬æ¢
    æ—¶é—´åº”ç”¨
      æ—¶é—´è®¡ç®—
        æ—¶é—´å·®è®¡ç®—
        åˆ°æœŸæ—¶é—´
        æ—¶é—´èŒƒå›´
      æŠ¥è¡¨ç”Ÿæˆ
        æŒ‰æ—¶é—´åˆ†ç»„
        æ—¶é—´ç»Ÿè®¡
        è¶‹åŠ¿åˆ†æ
      æ—¶åŒºå¤„ç†
        æ—¶åŒºè½¬æ¢
        å¤šæ—¶åŒºæ”¯æŒ
        æ—¶åŒºæŸ¥è¯¢
    æ€§èƒ½ä¼˜åŒ–
      æ—¶é—´å‡½æ•°ä¼˜åŒ–
        ç´¢å¼•ä¼˜åŒ–
        æŸ¥è¯¢ä¼˜åŒ–
        å‡½æ•°ä¼˜åŒ–
      æŸ¥è¯¢ä¼˜åŒ–
        é¿å…å‡½æ•°è°ƒç”¨
        ä½¿ç”¨èŒƒå›´æŸ¥è¯¢
        ç´¢å¼•ä½¿ç”¨
```

## 2. æ—¥æœŸæ—¶é—´å‡½æ•°åŸºç¡€

### 2.1 å½“å‰æ—¶é—´å‡½æ•°

**å½“å‰æ—¶é—´å‡½æ•°**:

```sql
-- å½“å‰æ—¶é—´æˆ³ï¼ˆå¸¦æ—¶åŒºï¼‰
SELECT NOW();
SELECT CURRENT_TIMESTAMP;

-- å½“å‰æ—¥æœŸ
SELECT CURRENT_DATE;

-- å½“å‰æ—¶é—´
SELECT CURRENT_TIME;

-- å½“å‰æ—¶é—´æˆ³ï¼ˆä¸å¸¦æ—¶åŒºï¼‰
SELECT LOCALTIMESTAMP;
```

### 2.2 æ—¶é—´æå–å‡½æ•°

**æ—¶é—´æå–å‡½æ•°**:

```sql
-- æå–å¹´ä»½
SELECT EXTRACT(YEAR FROM NOW());

-- æå–æœˆä»½
SELECT EXTRACT(MONTH FROM NOW());

-- æå–æ—¥æœŸ
SELECT EXTRACT(DAY FROM NOW());

-- æå–å°æ—¶
SELECT EXTRACT(HOUR FROM NOW());

-- æå–åˆ†é’Ÿ
SELECT EXTRACT(MINUTE FROM NOW());

-- æå–ç§’
SELECT EXTRACT(SECOND FROM NOW());

-- æå–æ˜ŸæœŸ
SELECT EXTRACT(DOW FROM NOW());  -- 0=Sunday, 6=Saturday

-- æå–ä¸€å¹´ä¸­çš„ç¬¬å‡ å¤©
SELECT EXTRACT(DOY FROM NOW());
```

### 2.3 æ—¶é—´è®¡ç®—å‡½æ•°

**æ—¶é—´è®¡ç®—å‡½æ•°**:

```sql
-- æ—¶é—´åŠ æ³•
SELECT NOW() + INTERVAL '1 day';
SELECT NOW() + INTERVAL '1 hour';
SELECT NOW() + INTERVAL '1 month';
SELECT NOW() + INTERVAL '1 year';

-- æ—¶é—´å‡æ³•
SELECT NOW() - INTERVAL '1 day';
SELECT NOW() - INTERVAL '1 hour';

-- æ—¶é—´å·®
SELECT NOW() - '2024-01-01'::TIMESTAMPTZ;
SELECT AGE(NOW(), '2024-01-01'::TIMESTAMPTZ);
```

## 3. æ—¥æœŸæ—¶é—´å‡½æ•°åº”ç”¨

### 3.1 æ—¶é—´æ ¼å¼åŒ–

**æ—¶é—´æ ¼å¼åŒ–**:

```sql
-- TO_CHAR æ ¼å¼åŒ–
SELECT TO_CHAR(NOW(), 'YYYY-MM-DD HH24:MI:SS');
SELECT TO_CHAR(NOW(), 'YYYYå¹´MMæœˆDDæ—¥');
SELECT TO_CHAR(NOW(), 'Day, Month DD, YYYY');

-- æ ¼å¼åŒ–ç¤ºä¾‹
SELECT
    order_date,
    TO_CHAR(order_date, 'YYYY-MM') AS year_month,
    TO_CHAR(order_date, 'Day') AS day_name
FROM orders;
```

### 3.2 æ—¶é—´è½¬æ¢

**æ—¶é—´è½¬æ¢**:

```sql
-- å­—ç¬¦ä¸²è½¬æ—¶é—´
SELECT '2024-01-01 10:00:00'::TIMESTAMPTZ;
SELECT TO_TIMESTAMP('2024-01-01 10:00:00', 'YYYY-MM-DD HH24:MI:SS');

-- æ—¶é—´è½¬å­—ç¬¦ä¸²
SELECT TO_CHAR(NOW(), 'YYYY-MM-DD HH24:MI:SS');

-- æ—¶åŒºè½¬æ¢
SELECT NOW() AT TIME ZONE 'UTC';
SELECT NOW() AT TIME ZONE 'Asia/Shanghai';
```

### 3.3 æ—¶é—´æˆªæ–­

**æ—¶é—´æˆªæ–­**:

```sql
-- DATE_TRUNC æˆªæ–­åˆ°æŒ‡å®šç²¾åº¦
SELECT DATE_TRUNC('year', NOW());
SELECT DATE_TRUNC('month', NOW());
SELECT DATE_TRUNC('day', NOW());
SELECT DATE_TRUNC('hour', NOW());
SELECT DATE_TRUNC('minute', NOW());

-- æŒ‰æœˆä»½åˆ†ç»„
SELECT
    DATE_TRUNC('month', created_at) AS month,
    COUNT(*) AS order_count
FROM orders
GROUP BY DATE_TRUNC('month', created_at)
ORDER BY month DESC;
```

## 4. å®é™…åº”ç”¨æ¡ˆä¾‹

### 4.1 æ¡ˆä¾‹: è®¢å•æ—¶é—´åˆ†æï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸç”µå•†å¹³å°éœ€è¦åˆ†æè®¢å•æ—¶é—´åˆ†å¸ƒï¼Œç”Ÿæˆæ—¶é—´æŠ¥è¡¨ã€‚

**é—®é¢˜åˆ†æ**:

1. **æ—¶é—´åˆ†ç»„**: éœ€è¦æŒ‰æ—¶é—´åˆ†ç»„
2. **æ—¶é—´è®¡ç®—**: éœ€è¦è®¡ç®—æ—¶é—´å·®
3. **æŠ¥è¡¨ç”Ÿæˆ**: éœ€è¦ç”Ÿæˆæ—¶é—´æŠ¥è¡¨

**è§£å†³æ–¹æ¡ˆ**:

```sql
-- ä½¿ç”¨æ—¥æœŸæ—¶é—´å‡½æ•°åˆ†æè®¢å•
SELECT
    DATE_TRUNC('day', created_at) AS order_date,
    DATE_TRUNC('hour', created_at) AS order_hour,
    COUNT(*) AS order_count,
    SUM(total_amount) AS total_revenue,
    AVG(total_amount) AS avg_order_value,
    EXTRACT(DOW FROM created_at) AS day_of_week,
    CASE EXTRACT(DOW FROM created_at)
        WHEN 0 THEN 'Sunday'
        WHEN 1 THEN 'Monday'
        WHEN 2 THEN 'Tuesday'
        WHEN 3 THEN 'Wednesday'
        WHEN 4 THEN 'Thursday'
        WHEN 5 THEN 'Friday'
        WHEN 6 THEN 'Saturday'
    END AS day_name
FROM orders
WHERE created_at >= CURRENT_DATE - INTERVAL '30 days'
GROUP BY DATE_TRUNC('day', created_at), DATE_TRUNC('hour', created_at), EXTRACT(DOW FROM created_at)
ORDER BY order_date DESC, order_hour DESC;

-- è®¡ç®—è®¢å•å¤„ç†æ—¶é—´
SELECT
    id,
    order_number,
    created_at,
    shipped_at,
    AGE(shipped_at, created_at) AS processing_time,
    EXTRACT(EPOCH FROM (shipped_at - created_at)) / 3600 AS processing_hours
FROM orders
WHERE shipped_at IS NOT NULL
ORDER BY processing_hours DESC;
```

**ä¼˜åŒ–æ•ˆæœ**:

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| **ä»£ç è¡Œæ•°** | 40 è¡Œ | **15 è¡Œ** | **63%** â¬‡ï¸ |
| **æŸ¥è¯¢æ€§èƒ½** | åŸºå‡† | **+30%** | **æå‡** |
| **å¯è¯»æ€§** | ä½ | **é«˜** | **æå‡** |

### 4.2 æ¡ˆä¾‹: ç”¨æˆ·æ´»è·ƒåº¦åˆ†æï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸç³»ç»Ÿéœ€è¦åˆ†æç”¨æˆ·æ´»è·ƒåº¦ï¼ŒæŒ‰æ—¶é—´æ®µç»Ÿè®¡ã€‚

**è§£å†³æ–¹æ¡ˆ**:

```sql
-- ä½¿ç”¨æ—¥æœŸæ—¶é—´å‡½æ•°åˆ†æç”¨æˆ·æ´»è·ƒåº¦
SELECT
    DATE_TRUNC('week', login_time) AS week,
    DATE_TRUNC('day', login_time) AS day,
    EXTRACT(HOUR FROM login_time) AS hour,
    COUNT(DISTINCT user_id) AS active_users,
    COUNT(*) AS login_count
FROM user_logins
WHERE login_time >= CURRENT_DATE - INTERVAL '4 weeks'
GROUP BY DATE_TRUNC('week', login_time), DATE_TRUNC('day', login_time), EXTRACT(HOUR FROM login_time)
ORDER BY week DESC, day DESC, hour DESC;
```

## 5. æœ€ä½³å®è·µ

### 5.1 æ—¥æœŸæ—¶é—´å‡½æ•°ä½¿ç”¨

**æ¨èåšæ³•**ï¼š

1. **ä¼˜å…ˆä½¿ç”¨ TIMESTAMPTZ**ï¼ˆè‡ªåŠ¨å¤„ç†æ—¶åŒºï¼‰

   ```sql
   -- âœ… å¥½ï¼šä¼˜å…ˆä½¿ç”¨ TIMESTAMPTZï¼ˆè‡ªåŠ¨å¤„ç†æ—¶åŒºï¼‰
   CREATE TABLE orders (
       id SERIAL PRIMARY KEY,
       created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()  -- æ¨èä½¿ç”¨ TIMESTAMPTZ
   );

   -- è‡ªåŠ¨å¤„ç†æ—¶åŒº
   SET timezone = 'UTC';
   INSERT INTO orders (created_at) VALUES (NOW());

   SET timezone = 'Asia/Shanghai';
   SELECT created_at FROM orders;  -- è‡ªåŠ¨è½¬æ¢ä¸º Asia/Shanghai æ—¶åŒº

   -- âŒ ä¸å¥½ï¼šä½¿ç”¨ TIMESTAMPï¼ˆä¸å¤„ç†æ—¶åŒºï¼‰
   CREATE TABLE orders (
       id SERIAL PRIMARY KEY,
       created_at TIMESTAMP NOT NULL DEFAULT NOW()  -- ä¸å¤„ç†æ—¶åŒº
   );
   ```

2. **ä½¿ç”¨ DATE_TRUNC è¿›è¡Œæ—¶é—´åˆ†ç»„**ï¼ˆæ€§èƒ½å¥½ï¼‰

   ```sql
   -- âœ… å¥½ï¼šä½¿ç”¨ DATE_TRUNC è¿›è¡Œæ—¶é—´åˆ†ç»„ï¼ˆæ€§èƒ½å¥½ï¼‰
   SELECT
       DATE_TRUNC('month', created_at) AS month,
       COUNT(*) AS order_count
   FROM orders
   GROUP BY DATE_TRUNC('month', created_at)
   ORDER BY month DESC;

   -- âŒ ä¸å¥½ï¼šä½¿ç”¨å­—ç¬¦ä¸²å‡½æ•°ï¼ˆæ€§èƒ½å·®ï¼‰
   SELECT
       TO_CHAR(created_at, 'YYYY-MM') AS month,
       COUNT(*) AS order_count
   FROM orders
   GROUP BY TO_CHAR(created_at, 'YYYY-MM')
   ORDER BY month DESC;
   ```

3. **ä½¿ç”¨ EXTRACT æå–æ—¶é—´éƒ¨åˆ†**ï¼ˆæ ‡å‡†è¯­æ³•ï¼‰

   ```sql
   -- âœ… å¥½ï¼šä½¿ç”¨ EXTRACT æå–æ—¶é—´éƒ¨åˆ†ï¼ˆæ ‡å‡†è¯­æ³•ï¼‰
   SELECT
       EXTRACT(YEAR FROM created_at) AS year,
       EXTRACT(MONTH FROM created_at) AS month,
       EXTRACT(DAY FROM created_at) AS day
   FROM orders;

   -- âŒ ä¸å¥½ï¼šä½¿ç”¨ DATE_PARTï¼ˆåŠŸèƒ½ç›¸åŒï¼Œä½† EXTRACT æ›´æ ‡å‡†ï¼‰
   SELECT
       DATE_PART('year', created_at) AS year,
       DATE_PART('month', created_at) AS month
   FROM orders;
   ```

**é¿å…åšæ³•**ï¼š

1. **é¿å…ä½¿ç”¨ TIMESTAMP è€Œä¸æ˜¯ TIMESTAMPTZ**ï¼ˆæ—¶åŒºé—®é¢˜ï¼‰
2. **é¿å…åœ¨ WHERE å­å¥ä¸­ä½¿ç”¨å‡½æ•°**ï¼ˆæ— æ³•ä½¿ç”¨ç´¢å¼•ï¼‰
3. **é¿å…ä½¿ç”¨å­—ç¬¦ä¸²å‡½æ•°æ›¿ä»£æ—¥æœŸå‡½æ•°**ï¼ˆæ€§èƒ½å·®ï¼‰

### 5.2 æ€§èƒ½ä¼˜åŒ–

**æ¨èåšæ³•**ï¼š

1. **ä¸ºæ—¶é—´åˆ—åˆ›å»ºç´¢å¼•**ï¼ˆæå‡æŸ¥è¯¢æ€§èƒ½ï¼‰

   ```sql
   -- âœ… å¥½ï¼šä¸ºæ—¶é—´åˆ—åˆ›å»ºç´¢å¼•ï¼ˆæå‡æŸ¥è¯¢æ€§èƒ½ï¼‰
   CREATE INDEX idx_orders_created_at ON orders (created_at);

   -- æŸ¥è¯¢å¯ä»¥ä½¿ç”¨ç´¢å¼•
   SELECT * FROM orders
   WHERE created_at >= CURRENT_DATE - INTERVAL '1 month';
   ```

2. **ä½¿ç”¨æ—¶é—´èŒƒå›´æŸ¥è¯¢**ï¼ˆæ€§èƒ½å¥½ï¼‰

   ```sql
   -- âœ… å¥½ï¼šä½¿ç”¨æ—¶é—´èŒƒå›´æŸ¥è¯¢ï¼ˆæ€§èƒ½å¥½ï¼‰
   SELECT * FROM orders
   WHERE created_at >= '2024-01-01'::TIMESTAMPTZ
   AND created_at < '2024-02-01'::TIMESTAMPTZ;

   -- âŒ ä¸å¥½ï¼šä½¿ç”¨å‡½æ•°ï¼ˆæ— æ³•ä½¿ç”¨ç´¢å¼•ï¼‰
   SELECT * FROM orders
   WHERE DATE_TRUNC('month', created_at) = '2024-01-01'::TIMESTAMPTZ;
   ```

3. **é¿å…åœ¨ WHERE å­å¥ä¸­ä½¿ç”¨å‡½æ•°**ï¼ˆæ— æ³•ä½¿ç”¨ç´¢å¼•ï¼‰

   ```sql
   -- âœ… å¥½ï¼šé¿å…åœ¨ WHERE å­å¥ä¸­ä½¿ç”¨å‡½æ•°ï¼ˆå¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼‰
   SELECT * FROM orders
   WHERE created_at >= DATE_TRUNC('month', CURRENT_DATE);

   -- âŒ ä¸å¥½ï¼šåœ¨ WHERE å­å¥ä¸­ä½¿ç”¨å‡½æ•°ï¼ˆæ— æ³•ä½¿ç”¨ç´¢å¼•ï¼‰
   SELECT * FROM orders
   WHERE DATE_TRUNC('month', created_at) = DATE_TRUNC('month', CURRENT_DATE);
   ```

**é¿å…åšæ³•**ï¼š

1. **é¿å…åœ¨ WHERE å­å¥ä¸­ä½¿ç”¨å‡½æ•°**ï¼ˆæ— æ³•ä½¿ç”¨ç´¢å¼•ï¼‰
2. **é¿å…å¿½ç•¥ç´¢å¼•ä¼˜åŒ–**ï¼ˆæŸ¥è¯¢æ€§èƒ½å·®ï¼‰
3. **é¿å…ä½¿ç”¨å­—ç¬¦ä¸²æ¯”è¾ƒæ—¶é—´**ï¼ˆå¯èƒ½é”™è¯¯ï¼‰

## 6. å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - æ—¥æœŸæ—¶é—´å‡½æ•°](https://www.postgresql.org/docs/current/functions-datetime.html)**
  - æ—¥æœŸæ—¶é—´å‡½æ•°å®Œæ•´åˆ—è¡¨
  - è¯­æ³•å’Œç¤ºä¾‹è¯´æ˜

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - æ—¥æœŸæ—¶é—´ç±»å‹](https://www.postgresql.org/docs/current/datatype-datetime.html)**
  - æ—¥æœŸæ—¶é—´ç±»å‹è¯´æ˜
  - TIMESTAMPã€TIMESTAMPTZã€INTERVAL ç­‰

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - æ—¶åŒº](https://www.postgresql.org/docs/current/datetime-timezones.html)**
  - æ—¶åŒºå¤„ç†è¯´æ˜
  - æ—¶åŒºé…ç½®å’Œä½¿ç”¨

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–](https://www.postgresql.org/docs/current/functions-formatting.html)**
  - TO_CHAR å‡½æ•°è¯´æ˜
  - æ ¼å¼åŒ–æ¨¡å¼

### SQL æ ‡å‡†

- **ISO/IEC 9075:2016 - SQL æ ‡å‡†æ—¥æœŸæ—¶é—´å‡½æ•°**
  - SQL æ ‡å‡†æ—¥æœŸæ—¶é—´å‡½æ•°è§„èŒƒ
  - æ—¥æœŸæ—¶é—´å‡½æ•°æ ‡å‡†è¯­æ³•

### æŠ€æœ¯è®ºæ–‡

- **Reingold, E. M., & Dershowitz, N. (2001). "Calendrical Calculations."**
  - å‡ºç‰ˆç¤¾: Cambridge University Press
  - **é‡è¦æ€§**: æ—¥å†è®¡ç®—çš„ç»å…¸æ•™æ
  - **æ ¸å¿ƒè´¡çŒ®**: æ·±å…¥è§£é‡Šäº†æ—¥æœŸæ—¶é—´è®¡ç®—çš„ç®—æ³•ï¼Œå½±å“äº†ç°ä»£æ•°æ®åº“çš„æ—¥æœŸæ—¶é—´å‡½æ•°è®¾è®¡

- **Olson, A. D., et al. (2012). "Time Zone Database."**
  - IANA Time Zone Database
  - **é‡è¦æ€§**: æ—¶åŒºæ•°æ®åº“çš„æ ‡å‡†
  - **æ ¸å¿ƒè´¡çŒ®**: ç»´æŠ¤äº†å…¨çƒæ—¶åŒºæ•°æ®åº“ï¼Œæˆä¸ºç°ä»£ç³»ç»Ÿæ—¶åŒºå¤„ç†çš„åŸºç¡€

### æŠ€æœ¯åšå®¢

- **[PostgreSQL å®˜æ–¹åšå®¢ - æ—¥æœŸæ—¶é—´å‡½æ•°](https://www.postgresql.org/docs/current/functions-datetime.html)**
  - æ—¥æœŸæ—¶é—´å‡½æ•°æœ€ä½³å®è·µ
  - æ€§èƒ½ä¼˜åŒ–æŠ€å·§

- **[2ndQuadrant - PostgreSQL æ—¥æœŸæ—¶é—´å‡½æ•°](https://www.2ndquadrant.com/en/blog/postgresql-date-time-functions/)**
  - æ—¥æœŸæ—¶é—´å‡½æ•°å®æˆ˜
  - æ€§èƒ½ä¼˜åŒ–æ¡ˆä¾‹

- **[Percona - PostgreSQL æ—¥æœŸæ—¶é—´å‡½æ•°](https://www.percona.com/blog/postgresql-date-time-functions/)**
  - æ—¥æœŸæ—¶é—´å‡½æ•°ä½¿ç”¨æŠ€å·§
  - æ€§èƒ½ä¼˜åŒ–å»ºè®®

- **[EnterpriseDB - PostgreSQL æ—¥æœŸæ—¶é—´å‡½æ•°](https://www.enterprisedb.com/postgres-tutorials/postgresql-date-time-functions-tutorial)**
  - æ—¥æœŸæ—¶é—´å‡½æ•°æ·±å…¥è§£æ
  - å®é™…åº”ç”¨æ¡ˆä¾‹

### ç¤¾åŒºèµ„æº

- **[PostgreSQL Wiki - æ—¥æœŸæ—¶é—´å‡½æ•°](https://wiki.postgresql.org/wiki/Date_Time_Functions)**
  - æ—¥æœŸæ—¶é—´å‡½æ•°æŠ€å·§
  - å®é™…åº”ç”¨æ¡ˆä¾‹

- **[Stack Overflow - PostgreSQL æ—¥æœŸæ—¶é—´å‡½æ•°](https://stackoverflow.com/questions/tagged/postgresql+datetime)**
  - æ—¥æœŸæ—¶é—´å‡½æ•°é—®ç­”
  - å¸¸è§é—®é¢˜è§£ç­”

### ç›¸å…³æ–‡æ¡£

- [æ•°æ®ç±»å‹è¯¦è§£](../03-æ•°æ®ç±»å‹/æ•°æ®ç±»å‹è¯¦è§£.md)
- [ç´¢å¼•ä¸æŸ¥è¯¢ä¼˜åŒ–](../01-SQLåŸºç¡€/ç´¢å¼•ä¸æŸ¥è¯¢ä¼˜åŒ–.md)
- [æŸ¥è¯¢è®¡åˆ’ä¸ä¼˜åŒ–å™¨](../01-SQLåŸºç¡€/æŸ¥è¯¢è®¡åˆ’ä¸ä¼˜åŒ–å™¨.md)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 03-03-45
