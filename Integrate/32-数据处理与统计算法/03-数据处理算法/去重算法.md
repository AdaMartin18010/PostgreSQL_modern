# PostgreSQL å»é‡ç®—æ³•å®Œæ•´æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æŠ€æœ¯æ ˆ**: PostgreSQL 17+/18+ | å»é‡ç®—æ³• | æ•°æ®æ¸…æ´—
> **éš¾åº¦çº§åˆ«**: â­â­â­ (ä¸­çº§)

---

## ğŸ“‹ ç›®å½•

- [PostgreSQL å»é‡ç®—æ³•å®Œæ•´æŒ‡å—](#postgresql-å»é‡ç®—æ³•å®Œæ•´æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [å»é‡ç®—æ³•æ¦‚è¿°](#å»é‡ç®—æ³•æ¦‚è¿°)
    - [æ ¸å¿ƒå»é‡åŠŸèƒ½](#æ ¸å¿ƒå»é‡åŠŸèƒ½)
  - [1. DISTINCTå»é‡](#1-distinctå»é‡)
    - [1.1 å•åˆ—å»é‡](#11-å•åˆ—å»é‡)
    - [1.2 å¤šåˆ—å»é‡](#12-å¤šåˆ—å»é‡)
  - [2. GROUP BYå»é‡](#2-group-byå»é‡)
    - [2.1 åˆ†ç»„å»é‡](#21-åˆ†ç»„å»é‡)
  - [3. çª—å£å‡½æ•°å»é‡](#3-çª—å£å‡½æ•°å»é‡)
    - [3.1 ä¿ç•™ç¬¬ä¸€æ¡è®°å½•](#31-ä¿ç•™ç¬¬ä¸€æ¡è®°å½•)
  - [4. å®é™…åº”ç”¨æ¡ˆä¾‹](#4-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [4.1 é‡å¤è®¢å•æ£€æµ‹](#41-é‡å¤è®¢å•æ£€æµ‹)

---

## å»é‡ç®—æ³•æ¦‚è¿°

**å»é‡ç®—æ³•**ç”¨äºå»é™¤é‡å¤è®°å½•ï¼ŒPostgreSQLæ”¯æŒå¤šç§å»é‡æ–¹å¼ã€‚

### æ ¸å¿ƒå»é‡åŠŸèƒ½

| åŠŸèƒ½ | ç”¨é€” | å¤æ‚åº¦ |
|------|------|--------|
| **DISTINCT** | ç®€å•å»é‡ | O(n log n) |
| **GROUP BY** | åˆ†ç»„å»é‡ | O(n log n) |
| **çª—å£å‡½æ•°** | ä¿ç•™ç¬¬ä¸€æ¡ | O(n log n) |

---

## 1. DISTINCTå»é‡

### 1.1 å•åˆ—å»é‡

**DISTINCTå»é‡**å»é™¤å•åˆ—é‡å¤å€¼ã€‚

```sql
-- DISTINCTå•åˆ—å»é‡ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'orders') THEN
            RAISE WARNING 'è¡¨ orders ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡ŒDISTINCTå»é‡';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡ŒDISTINCTå•åˆ—å»é‡';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'DISTINCTå»é‡å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT DISTINCT customer_id
FROM orders
ORDER BY customer_id;
```

### 1.2 å¤šåˆ—å»é‡

**å¤šåˆ—å»é‡**å»é™¤å¤šåˆ—ç»„åˆçš„é‡å¤å€¼ã€‚

```sql
-- DISTINCTå¤šåˆ—å»é‡ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'sales') THEN
            RAISE WARNING 'è¡¨ sales ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡Œå¤šåˆ—å»é‡';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡ŒDISTINCTå¤šåˆ—å»é‡';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¤šåˆ—å»é‡å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT DISTINCT customer_id, product_id
FROM sales
ORDER BY customer_id, product_id;
```

---

## 2. GROUP BYå»é‡

### 2.1 åˆ†ç»„å»é‡

**GROUP BYå»é‡**ä½¿ç”¨åˆ†ç»„å»é™¤é‡å¤ï¼ŒåŒæ—¶ä¿ç•™å…¶ä»–åˆ—ã€‚

```sql
-- GROUP BYå»é‡ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'orders') THEN
            RAISE WARNING 'è¡¨ orders ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡ŒGROUP BYå»é‡';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡ŒGROUP BYå»é‡';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'GROUP BYå»é‡å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT
    customer_id,
    product_id,
    MAX(order_date) AS latest_order_date,
    SUM(amount) AS total_amount
FROM orders
GROUP BY customer_id, product_id;
```

---

## 3. çª—å£å‡½æ•°å»é‡

### 3.1 ä¿ç•™ç¬¬ä¸€æ¡è®°å½•

**çª—å£å‡½æ•°å»é‡**ä½¿ç”¨ROW_NUMBERä¿ç•™æ¯ç»„çš„ç¬¬ä¸€æ¡è®°å½•ã€‚

```sql
-- çª—å£å‡½æ•°å»é‡ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'orders') THEN
            RAISE WARNING 'è¡¨ orders ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡Œçª—å£å‡½æ•°å»é‡';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡Œçª—å£å‡½æ•°å»é‡';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'çª—å£å‡½æ•°å»é‡å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT *
FROM (
    SELECT
        *,
        ROW_NUMBER() OVER (PARTITION BY customer_id, product_id ORDER BY order_date DESC) AS rn
    FROM orders
) AS ranked
WHERE rn = 1;
```

---

## 4. å®é™…åº”ç”¨æ¡ˆä¾‹

### 4.1 é‡å¤è®¢å•æ£€æµ‹

**é‡å¤è®¢å•æ£€æµ‹**è¯†åˆ«å¹¶å¤„ç†é‡å¤è®¢å•ã€‚

```sql
-- é‡å¤è®¢å•æ£€æµ‹ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'orders') THEN
            RAISE WARNING 'è¡¨ orders ä¸å­˜åœ¨ï¼Œæ— æ³•æ‰§è¡Œé‡å¤è®¢å•æ£€æµ‹';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹æ‰§è¡Œé‡å¤è®¢å•æ£€æµ‹';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'é‡å¤è®¢å•æ£€æµ‹å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT
    customer_id,
    product_id,
    order_date,
    COUNT(*) AS duplicate_count
FROM orders
GROUP BY customer_id, product_id, order_date
HAVING COUNT(*) > 1
ORDER BY duplicate_count DESC;
```

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
