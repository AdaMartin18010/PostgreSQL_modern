# PostgreSQL æ•°æ®æ ‡å‡†åŒ–ç®—æ³•å®Œæ•´æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
> **æŠ€æœ¯æ ˆ**: PostgreSQL 17+/18+ | æ•°æ®æ ‡å‡†åŒ– | æ•°æ®è§„èŒƒåŒ–
> **éš¾åº¦çº§åˆ«**: â­â­â­ (ä¸­çº§)

---

## ğŸ“‹ ç›®å½•

- [PostgreSQL æ•°æ®æ ‡å‡†åŒ–ç®—æ³•å®Œæ•´æŒ‡å—](#postgresql-æ•°æ®æ ‡å‡†åŒ–ç®—æ³•å®Œæ•´æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [æ•°æ®æ ‡å‡†åŒ–æ¦‚è¿°](#æ•°æ®æ ‡å‡†åŒ–æ¦‚è¿°)
    - [æ ¸å¿ƒç®—æ³•](#æ ¸å¿ƒç®—æ³•)
  - [1. æ–‡æœ¬æ ‡å‡†åŒ–](#1-æ–‡æœ¬æ ‡å‡†åŒ–)
    - [1.1 å¤§å°å†™æ ‡å‡†åŒ–](#11-å¤§å°å†™æ ‡å‡†åŒ–)
    - [1.2 å»é™¤ç©ºæ ¼](#12-å»é™¤ç©ºæ ¼)
  - [2. æ•°å€¼æ ‡å‡†åŒ–](#2-æ•°å€¼æ ‡å‡†åŒ–)
    - [2.1 Z-scoreæ ‡å‡†åŒ–](#21-z-scoreæ ‡å‡†åŒ–)
    - [2.2 Min-Maxæ ‡å‡†åŒ–](#22-min-maxæ ‡å‡†åŒ–)
  - [3. æ—¥æœŸæ—¶é—´æ ‡å‡†åŒ–](#3-æ—¥æœŸæ—¶é—´æ ‡å‡†åŒ–)
    - [3.1 æ—¥æœŸæ ¼å¼æ ‡å‡†åŒ–](#31-æ—¥æœŸæ ¼å¼æ ‡å‡†åŒ–)
  - [4. å®é™…åº”ç”¨æ¡ˆä¾‹](#4-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [4.1 ç»¼åˆæ•°æ®æ ‡å‡†åŒ–](#41-ç»¼åˆæ•°æ®æ ‡å‡†åŒ–)
  - [ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®](#-æ€§èƒ½ä¼˜åŒ–å»ºè®®)
  - [ğŸ¯ æœ€ä½³å®è·µ](#-æœ€ä½³å®è·µ)

---

## æ•°æ®æ ‡å‡†åŒ–æ¦‚è¿°

**æ•°æ®æ ‡å‡†åŒ–**å°†æ•°æ®è½¬æ¢ä¸ºç»Ÿä¸€çš„æ ¼å¼å’ŒèŒƒå›´ï¼Œä¾¿äºåˆ†æå’Œæ¯”è¾ƒã€‚

### æ ¸å¿ƒç®—æ³•

| ç®—æ³• | ç”¨é€” | å¤æ‚åº¦ |
|------|------|--------|
| **Z-score** | æ ‡å‡†åŒ–åˆ°å‡å€¼0æ–¹å·®1 | O(n) |
| **Min-Max** | æ ‡å‡†åŒ–åˆ°0-1èŒƒå›´ | O(n) |
| **æ–‡æœ¬æ¸…ç†** | ç»Ÿä¸€æ–‡æœ¬æ ¼å¼ | O(n) |

---

## 1. æ–‡æœ¬æ ‡å‡†åŒ–

### 1.1 å¤§å°å†™æ ‡å‡†åŒ–

**å¤§å°å†™æ ‡å‡†åŒ–**ç»Ÿä¸€æ–‡æœ¬çš„å¤§å°å†™æ ¼å¼ã€‚

```sql
-- åˆ›å»ºæµ‹è¯•æ•°æ®è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
DO $$
BEGIN
    BEGIN
        IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'standardization_test') THEN
            RAISE WARNING 'è¡¨ standardization_test å·²å­˜åœ¨ï¼Œå…ˆåˆ é™¤';
            DROP TABLE standardization_test CASCADE;
        END IF;

        CREATE TABLE standardization_test (
            id SERIAL PRIMARY KEY,
            name VARCHAR(100),
            description TEXT,
            value NUMERIC(10, 2),
            created_date VARCHAR(50)
        );

        INSERT INTO standardization_test (name, description, value, created_date) VALUES
            ('John DOE', '  Some Description  ', 100.5, '2024-01-01'),
            ('jane smith', 'Another Description', 200.3, '01/15/2024'),
            ('BOB WILSON', '  Yet Another  ', 150.7, '2024-1-5');

        RAISE NOTICE 'è¡¨ standardization_test åˆ›å»ºæˆåŠŸ';
    EXCEPTION
        WHEN duplicate_table THEN
            RAISE WARNING 'è¡¨ standardization_test å·²å­˜åœ¨';
        WHEN OTHERS THEN
            RAISE EXCEPTION 'åˆ›å»ºè¡¨å¤±è´¥: %', SQLERRM;
    END;
END $$;

-- å¤§å°å†™æ ‡å‡†åŒ–ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'standardization_test') THEN
            RAISE WARNING 'è¡¨ standardization_test ä¸å­˜åœ¨ï¼Œæ— æ³•è¿›è¡Œå¤§å°å†™æ ‡å‡†åŒ–';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹è¿›è¡Œå¤§å°å†™æ ‡å‡†åŒ–';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å¤§å°å†™æ ‡å‡†åŒ–å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- è½¬æ¢ä¸ºå°å†™
SELECT
    id,
    name,
    LOWER(name) AS name_lowercase,
    INITCAP(name) AS name_title_case,
    UPPER(name) AS name_uppercase
FROM standardization_test
ORDER BY id;

-- æ€§èƒ½æµ‹è¯•
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT
    LOWER(name) AS name_lowercase
FROM standardization_test;
```

### 1.2 å»é™¤ç©ºæ ¼

**å»é™¤ç©ºæ ¼**æ¸…ç†æ–‡æœ¬ä¸­çš„å¤šä½™ç©ºæ ¼ã€‚

```sql
-- å»é™¤ç©ºæ ¼ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'standardization_test') THEN
            RAISE WARNING 'è¡¨ standardization_test ä¸å­˜åœ¨ï¼Œæ— æ³•å»é™¤ç©ºæ ¼';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹å»é™¤ç©ºæ ¼';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'å»é™¤ç©ºæ ¼å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- å»é™¤é¦–å°¾ç©ºæ ¼å’Œå¤šä½™ç©ºæ ¼
SELECT
    id,
    description,
    TRIM(description) AS trimmed_description,
    REGEXP_REPLACE(TRIM(description), '\s+', ' ', 'g') AS normalized_description
FROM standardization_test
ORDER BY id;

-- æ€§èƒ½æµ‹è¯•
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT
    TRIM(description) AS trimmed
FROM standardization_test;
```

---

## 2. æ•°å€¼æ ‡å‡†åŒ–

### 2.1 Z-scoreæ ‡å‡†åŒ–

**Z-scoreæ ‡å‡†åŒ–**å°†æ•°æ®æ ‡å‡†åŒ–ä¸ºå‡å€¼0ã€æ ‡å‡†å·®1çš„åˆ†å¸ƒã€‚

```sql
-- Z-scoreæ ‡å‡†åŒ–ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'standardization_test') THEN
            RAISE WARNING 'è¡¨ standardization_test ä¸å­˜åœ¨ï¼Œæ— æ³•è¿›è¡ŒZ-scoreæ ‡å‡†åŒ–';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹è¿›è¡ŒZ-scoreæ ‡å‡†åŒ–';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'Z-scoreæ ‡å‡†åŒ–å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- Z-scoreæ ‡å‡†åŒ–
WITH value_stats AS (
    SELECT
        AVG(value) AS mean_value,
        STDDEV(value) AS stddev_value
    FROM standardization_test
    WHERE value IS NOT NULL
)
SELECT
    st.id,
    st.value AS original_value,
    ROUND((st.value - vs.mean_value) / NULLIF(vs.stddev_value, 0)::numeric, 4) AS z_score
FROM standardization_test st
CROSS JOIN value_stats vs
WHERE st.value IS NOT NULL
ORDER BY st.id;

-- æ€§èƒ½æµ‹è¯•
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT
    AVG(value) AS mean_value,
    STDDEV(value) AS stddev_value
FROM standardization_test
WHERE value IS NOT NULL;
```

### 2.2 Min-Maxæ ‡å‡†åŒ–

**Min-Maxæ ‡å‡†åŒ–**å°†æ•°æ®æ ‡å‡†åŒ–åˆ°0-1èŒƒå›´ã€‚

```sql
-- Min-Maxæ ‡å‡†åŒ–ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'standardization_test') THEN
            RAISE WARNING 'è¡¨ standardization_test ä¸å­˜åœ¨ï¼Œæ— æ³•è¿›è¡ŒMin-Maxæ ‡å‡†åŒ–';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹è¿›è¡ŒMin-Maxæ ‡å‡†åŒ–';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'Min-Maxæ ‡å‡†åŒ–å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- Min-Maxæ ‡å‡†åŒ–åˆ°0-1èŒƒå›´
WITH value_stats AS (
    SELECT
        MIN(value) AS min_value,
        MAX(value) AS max_value,
        MAX(value) - MIN(value) AS value_range
    FROM standardization_test
    WHERE value IS NOT NULL
)
SELECT
    st.id,
    st.value AS original_value,
    ROUND(((st.value - vs.min_value) / NULLIF(vs.value_range, 0))::numeric, 4) AS min_max_normalized
FROM standardization_test st
CROSS JOIN value_stats vs
WHERE st.value IS NOT NULL
ORDER BY st.id;

-- æ€§èƒ½æµ‹è¯•
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT
    MIN(value) AS min_value,
    MAX(value) AS max_value
FROM standardization_test
WHERE value IS NOT NULL;
```

---

## 3. æ—¥æœŸæ—¶é—´æ ‡å‡†åŒ–

### 3.1 æ—¥æœŸæ ¼å¼æ ‡å‡†åŒ–

**æ—¥æœŸæ ¼å¼æ ‡å‡†åŒ–**ç»Ÿä¸€æ—¥æœŸæ ¼å¼ã€‚

```sql
-- æ—¥æœŸæ ¼å¼æ ‡å‡†åŒ–ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'standardization_test') THEN
            RAISE WARNING 'è¡¨ standardization_test ä¸å­˜åœ¨ï¼Œæ— æ³•è¿›è¡Œæ—¥æœŸæ ¼å¼æ ‡å‡†åŒ–';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹è¿›è¡Œæ—¥æœŸæ ¼å¼æ ‡å‡†åŒ–';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'æ—¥æœŸæ ¼å¼æ ‡å‡†åŒ–å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- æ ‡å‡†åŒ–æ—¥æœŸæ ¼å¼ä¸ºYYYY-MM-DD
SELECT
    id,
    created_date AS original_date,
    CASE
        WHEN created_date ~ '^\d{4}-\d{2}-\d{2}$' THEN created_date::DATE
        WHEN created_date ~ '^\d{2}/\d{2}/\d{4}$' THEN TO_DATE(created_date, 'MM/DD/YYYY')
        WHEN created_date ~ '^\d{4}-\d{1,2}-\d{1,2}$' THEN created_date::DATE
        ELSE NULL
    END AS standardized_date,
    TO_CHAR(
        CASE
            WHEN created_date ~ '^\d{4}-\d{2}-\d{2}$' THEN created_date::DATE
            WHEN created_date ~ '^\d{2}/\d{2}/\d{4}$' THEN TO_DATE(created_date, 'MM/DD/YYYY')
            WHEN created_date ~ '^\d{4}-\d{1,2}-\d{1,2}$' THEN created_date::DATE
            ELSE NULL
        END,
        'YYYY-MM-DD'
    ) AS formatted_date
FROM standardization_test
ORDER BY id;

-- æ€§èƒ½æµ‹è¯•
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT
    created_date::DATE AS standardized_date
FROM standardization_test
WHERE created_date ~ '^\d{4}-\d{2}-\d{2}$';
```

---

## 4. å®é™…åº”ç”¨æ¡ˆä¾‹

### 4.1 ç»¼åˆæ•°æ®æ ‡å‡†åŒ–

**ç»¼åˆæ•°æ®æ ‡å‡†åŒ–**æ•´åˆå¤šç§æ ‡å‡†åŒ–æ–¹æ³•ã€‚

```sql
-- ç»¼åˆæ•°æ®æ ‡å‡†åŒ–ç¤ºä¾‹ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½æµ‹è¯•ï¼‰
DO $$
BEGIN
    BEGIN
        IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'standardization_test') THEN
            RAISE WARNING 'è¡¨ standardization_test ä¸å­˜åœ¨ï¼Œæ— æ³•è¿›è¡Œç»¼åˆæ•°æ®æ ‡å‡†åŒ–';
            RETURN;
        END IF;
        RAISE NOTICE 'å¼€å§‹è¿›è¡Œç»¼åˆæ•°æ®æ ‡å‡†åŒ–';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE WARNING 'ç»¼åˆæ•°æ®æ ‡å‡†åŒ–å‡†å¤‡å¤±è´¥: %', SQLERRM;
            RAISE;
    END;
END $$;

-- ç»¼åˆæ ‡å‡†åŒ–å¤„ç†
WITH value_stats AS (
    SELECT
        AVG(value) AS mean_value,
        STDDEV(value) AS stddev_value,
        MIN(value) AS min_value,
        MAX(value) AS max_value,
        MAX(value) - MIN(value) AS value_range
    FROM standardization_test
    WHERE value IS NOT NULL
)
SELECT
    st.id,
    INITCAP(TRIM(st.name)) AS standardized_name,
    REGEXP_REPLACE(TRIM(st.description), '\s+', ' ', 'g') AS standardized_description,
    st.value AS original_value,
    ROUND((st.value - vs.mean_value) / NULLIF(vs.stddev_value, 0)::numeric, 4) AS z_score,
    ROUND(((st.value - vs.min_value) / NULLIF(vs.value_range, 0))::numeric, 4) AS min_max_normalized,
    TO_CHAR(
        CASE
            WHEN st.created_date ~ '^\d{4}-\d{2}-\d{2}$' THEN st.created_date::DATE
            WHEN st.created_date ~ '^\d{2}/\d{2}/\d{4}$' THEN TO_DATE(st.created_date, 'MM/DD/YYYY')
            WHEN st.created_date ~ '^\d{4}-\d{1,2}-\d{1,2}$' THEN st.created_date::DATE
            ELSE NULL
        END,
        'YYYY-MM-DD'
    ) AS standardized_date
FROM standardization_test st
CROSS JOIN value_stats vs
ORDER BY st.id;

-- æ€§èƒ½æµ‹è¯•
EXPLAIN (ANALYZE, BUFFERS, TIMING, VERBOSE)
SELECT
    INITCAP(TRIM(name)) AS standardized_name,
    AVG(value) AS mean_value
FROM standardization_test
GROUP BY name;
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æ‰¹é‡å¤„ç†**: æ‰¹é‡å¤„ç†æ•°æ®æé«˜æ•ˆç‡
2. **å‡½æ•°**: åˆ›å»ºæ ‡å‡†åŒ–å‡½æ•°æé«˜å¤ç”¨æ€§
3. **ç´¢å¼•**: åœ¨æ ‡å‡†åŒ–åçš„å­—æ®µä¸Šåˆ›å»ºç´¢å¼•

## ğŸ¯ æœ€ä½³å®è·µ

1. **ä¸€è‡´æ€§**: ä¿æŒæ ‡å‡†åŒ–è§„åˆ™ä¸€è‡´
2. **æ–‡æ¡£**: è®°å½•æ ‡å‡†åŒ–è§„åˆ™
3. **éªŒè¯**: éªŒè¯æ ‡å‡†åŒ–ç»“æœ
4. **æ€§èƒ½**: ä¼˜åŒ–æ ‡å‡†åŒ–æ€§èƒ½

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ
