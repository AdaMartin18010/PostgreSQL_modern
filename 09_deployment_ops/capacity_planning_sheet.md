# 容量规划计算表（示例）

> 目的：按峰值 TPS 与 P95 目标，估算 CPU/IO 带宽与扩容阈值（示意）。

## 输入（示例）

- 峰值 TPS：20k（读写混合）
- 读写比：读 70% / 写 30%
- 目标 P95：读取 < 30ms，写入 < 80ms
- 当前硬件：16 vCPU，NVMe 带宽 1GB/s，随机 IOPS 100k

## 测量（基线）

- pgbench/业务压测稳态：
  - CPU 利用率：70%
  - P95：读 28ms / 写 75ms
  - WAL 写入：120 MB/s；检查点平均 25s/次

## 粗略推算（示意方法）

- CPU 余量：目标 70%（留 30% 冗余），若>80% 持续 5min 则触发扩容评审
- IO 余量：WAL+随机读写总带宽 < 70% 物理上限
- 连接池：并发连接稳定在核数~2× 核数区间，避免过度上下文切换

## 扩容阈值（策略）

- 连续 15 分钟：CPU > 80% 且 P95 超目标 20% → 优先纵向扩容
- 连续 15 分钟：IO 带宽 > 75% 或 IOWAIT > 15% → 升级磁盘或拆分热表
- 热点分布极端：读写倾斜且锁等待增加 → 模式/索引重构或读写分离

## 记录与验证

- 变更前记录输入/测量，变更后复测并归档到 CHANGELOG/Issue
