# åŠ¨æ€æ•°æ®è„±æ•

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥  
> **æŠ€æœ¯ç‰ˆæœ¬**: pg_dsr 1.0  
> **æ–‡æ¡£ç¼–å·**: 05-04-02

## ğŸ“‘ ç›®å½•

- [åŠ¨æ€æ•°æ®è„±æ•](#åŠ¨æ€æ•°æ®è„±æ•)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
  - [2. è„±æ•ç­–ç•¥](#2-è„±æ•ç­–ç•¥)
    - [2.1 ç­–ç•¥é…ç½®](#21-ç­–ç•¥é…ç½®)
  - [3. å®ç°æ–¹æ³•](#3-å®ç°æ–¹æ³•)
    - [3.1 è„±æ•å‡½æ•°](#31-è„±æ•å‡½æ•°)
    - [3.2 è§†å›¾è„±æ•](#32-è§†å›¾è„±æ•)
  - [4. æœ€ä½³å®è·µ](#4-æœ€ä½³å®è·µ)
  - [5. å‚è€ƒèµ„æ–™](#5-å‚è€ƒèµ„æ–™)

---

## 1. æ¦‚è¿°

åŠ¨æ€æ•°æ®è„±æ•æ ¹æ®ç”¨æˆ·æƒé™åŠ¨æ€è„±æ•æ•æ„Ÿæ•°æ®ã€‚

---

## 2. è„±æ•ç­–ç•¥

### 2.1 ç­–ç•¥é…ç½®

```sql
-- åˆ›å»ºè„±æ•ç­–ç•¥è¡¨
CREATE TABLE masking_policies (
    id SERIAL PRIMARY KEY,
    table_name TEXT,
    column_name TEXT,
    mask_type TEXT,  -- 'full', 'partial', 'hash', 'null'
    mask_function TEXT
);

-- ç¤ºä¾‹ç­–ç•¥
INSERT INTO masking_policies (table_name, column_name, mask_type, mask_function)
VALUES
    ('user_data', 'email', 'partial', 'mask_email'),
    ('user_data', 'phone', 'partial', 'mask_phone'),
    ('user_data', 'ssn', 'full', 'mask_ssn');
```

---

## 3. å®ç°æ–¹æ³•

### 3.1 è„±æ•å‡½æ•°

```sql
-- é‚®ç®±è„±æ•
CREATE OR REPLACE FUNCTION mask_email(email TEXT)
RETURNS TEXT AS $$
BEGIN
    RETURN regexp_replace(email, '(.)(.*)(@.*)', '\1***\3', 'g');
END;
$$ LANGUAGE plpgsql;

-- ç”µè¯è„±æ•
CREATE OR REPLACE FUNCTION mask_phone(phone TEXT)
RETURNS TEXT AS $$
BEGIN
    RETURN regexp_replace(phone, '(\d{3})\d{4}(\d{4})', '\1****\2', 'g');
END;
$$ LANGUAGE plpgsql;
```

### 3.2 è§†å›¾è„±æ•

```sql
-- åˆ›å»ºè„±æ•è§†å›¾
CREATE VIEW user_data_masked AS
SELECT
    id,
    CASE
        WHEN has_permission('view_email') THEN email
        ELSE mask_email(email)
    END as email,
    CASE
        WHEN has_permission('view_phone') THEN phone
        ELSE mask_phone(phone)
    END as phone
FROM user_data;
```

---

## 4. æœ€ä½³å®è·µ

1. **æƒé™æ§åˆ¶**: åŸºäºç”¨æˆ·æƒé™åŠ¨æ€è„±æ•
2. **ç­–ç•¥ç®¡ç†**: ç»Ÿä¸€ç®¡ç†è„±æ•ç­–ç•¥
3. **æ€§èƒ½ä¼˜åŒ–**: ä¼˜åŒ–è„±æ•å‡½æ•°æ€§èƒ½

---

## 5. å‚è€ƒèµ„æ–™

- [ä¸å¯ç¯¡æ”¹å®¡è®¡æ—¥å¿—](./ä¸å¯ç¯¡æ”¹å®¡è®¡æ—¥å¿—.md)
- [ç»†ç²’åº¦æƒé™æ§åˆ¶](./ç»†ç²’åº¦æƒé™æ§åˆ¶.md)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥  
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
