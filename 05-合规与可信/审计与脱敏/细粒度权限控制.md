# ç»†ç²’åº¦æƒé™æ§åˆ¶

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥  
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 18+  
> **æ–‡æ¡£ç¼–å·**: 05-04-03

## ğŸ“‘ ç›®å½•

- [ç»†ç²’åº¦æƒé™æ§åˆ¶](#ç»†ç²’åº¦æƒé™æ§åˆ¶)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
  - [2. æƒé™æ¨¡å‹](#2-æƒé™æ¨¡å‹)
    - [2.1 æƒé™å®šä¹‰](#21-æƒé™å®šä¹‰)
  - [3. å®ç°æ–¹æ³•](#3-å®ç°æ–¹æ³•)
    - [3.1 Row Level Security](#31-row-level-security)
    - [3.2 åˆ—çº§åˆ«æƒé™](#32-åˆ—çº§åˆ«æƒé™)
  - [4. æœ€ä½³å®è·µ](#4-æœ€ä½³å®è·µ)
  - [5. å‚è€ƒèµ„æ–™](#5-å‚è€ƒèµ„æ–™)

---

## 1. æ¦‚è¿°

ç»†ç²’åº¦æƒé™æ§åˆ¶å®ç°åˆ—çº§åˆ«å’Œè¡Œçº§åˆ«çš„æƒé™æ§åˆ¶ã€‚

---

## 2. æƒé™æ¨¡å‹

### 2.1 æƒé™å®šä¹‰

```sql
-- åˆ›å»ºæƒé™è¡¨
CREATE TABLE permissions (
    id SERIAL PRIMARY KEY,
    user_id TEXT,
    table_name TEXT,
    column_name TEXT,
    permission_type TEXT,  -- 'SELECT', 'INSERT', 'UPDATE', 'DELETE'
    condition TEXT  -- WHERE æ¡ä»¶
);
```

---

## 3. å®ç°æ–¹æ³•

### 3.1 Row Level Security

```sql
-- å¯ç”¨ RLS
ALTER TABLE user_data ENABLE ROW LEVEL SECURITY;

-- åˆ›å»ºç­–ç•¥
CREATE POLICY "user_data_access"
ON user_data FOR SELECT
USING (
    user_id = current_setting('app.user_id')::BIGINT
    OR has_permission('admin')
);
```

### 3.2 åˆ—çº§åˆ«æƒé™

```sql
-- åˆ›å»ºåˆ—æƒé™è§†å›¾
CREATE VIEW user_data_restricted AS
SELECT
    id,
    CASE WHEN has_column_permission('email') THEN email ELSE NULL END as email,
    CASE WHEN has_column_permission('phone') THEN phone ELSE NULL END as phone,
    name  -- å…¬å¼€åˆ—
FROM user_data;
```

---

## 4. æœ€ä½³å®è·µ

1. **æœ€å°æƒé™**: å®æ–½æœ€å°æƒé™åŸåˆ™
2. **æƒé™å®¡æŸ¥**: å®šæœŸå®¡æŸ¥ç”¨æˆ·æƒé™
3. **å®¡è®¡è¿½è¸ª**: è®°å½•æ‰€æœ‰æƒé™å˜æ›´

---

## 5. å‚è€ƒèµ„æ–™

- [åŠ¨æ€æ•°æ®è„±æ•](./åŠ¨æ€æ•°æ®è„±æ•.md)
- [ä¸å¯ç¯¡æ”¹å®¡è®¡æ—¥å¿—](./ä¸å¯ç¯¡æ”¹å®¡è®¡æ—¥å¿—.md)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥  
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
