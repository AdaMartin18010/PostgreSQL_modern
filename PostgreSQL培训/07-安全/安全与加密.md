# PostgreSQL хоЙхЕиф╕ОхКахпЖ

> **цЫ┤цЦ░цЧ╢щЧ┤**: 2025 х╣┤ 11 цЬИ 1 цЧе
> **цКАцЬпчЙИцЬм**: PostgreSQL 14+
> **цЦЗцбгч╝ЦхП╖**: 03-03-22

## ЁЯУС чЫох╜Х

- [PostgreSQL хоЙхЕиф╕ОхКахпЖ](#postgresql-хоЙхЕиф╕ОхКахпЖ)
  - [ЁЯУС чЫох╜Х](#-чЫох╜Х)
  - [1. цжВш┐░](#1-цжВш┐░)
    - [1.1 цКАцЬпшГМцЩп](#11-цКАцЬпшГМцЩп)
    - [1.2 ца╕х┐Гф╗╖хА╝](#12-ца╕х┐Гф╗╖хА╝)
    - [1.3 хнжф╣ачЫоцаЗ](#13-хнжф╣ачЫоцаЗ)
    - [1.4 хоЙхЕиф╕ОхКахпЖф╜Уч│╗цАЭч╗┤хп╝хЫ╛](#14-хоЙхЕиф╕ОхКахпЖф╜Уч│╗цАЭч╗┤хп╝хЫ╛)
  - [2. шо┐щЧоцОзхИ╢](#2-шо┐щЧоцОзхИ╢)
    - [2.1 чФицИ╖хТМшзТшЙ▓](#21-чФицИ╖хТМшзТшЙ▓)
    - [2.2 цЭГщЩРчобчРЖ](#22-цЭГщЩРчобчРЖ)
    - [2.3 шбМч║зхоЙхЕия╝ИRLSя╝Й](#23-шбМч║зхоЙхЕиrls)
  - [3. цХ░цНохКахпЖ](#3-цХ░цНохКахпЖ)
    - [3.1 ф╝аш╛УхКахпЖя╝ИSSL/TLSя╝Й](#31-ф╝аш╛УхКахпЖssltls)
    - [3.2 хнШхВихКахпЖ](#32-хнШхВихКахпЖ)
  - [4. хобшобцЧех┐Ч](#4-хобшобцЧех┐Ч)
    - [4.1 хобшобцЧех┐ЧщЕНч╜о](#41-хобшобцЧех┐ЧщЕНч╜о)
    - [4.2 хобшобшзжхПСхЩи](#42-хобшобшзжхПСхЩи)
  - [5. хоЮщЩЕх║ФчФицбИф╛Л](#5-хоЮщЩЕх║ФчФицбИф╛Л)
    - [5.1 цбИф╛Л: ф╝Бф╕Ъч║зхоЙхЕищЕНч╜оя╝ИчЬЯхоЮцбИф╛Ля╝Й](#51-цбИф╛Л-ф╝Бф╕Ъч║зхоЙхЕищЕНч╜очЬЯхоЮцбИф╛Л)
  - [6. цЬАф╜│хоЮш╖╡](#6-цЬАф╜│хоЮш╖╡)
    - [6.1 шо┐щЧоцОзхИ╢](#61-шо┐щЧоцОзхИ╢)
    - [6.2 цХ░цНохКахпЖ](#62-цХ░цНохКахпЖ)
    - [6.3 хобшобцЧех┐Ч](#63-хобшобцЧех┐Ч)
  - [7. хПВшАГш╡ДцЦЩ](#7-хПВшАГш╡ДцЦЩ)

---

## 1. цжВш┐░

### 1.1 цКАцЬпшГМцЩп

**хоЙхЕиф╕ОхКахпЖчЪДф╗╖хА╝**:

PostgreSQL цПРф╛Ыф║ЖхоМхЦДчЪДхоЙхЕихТМхКахпЖцЬ║хИ╢я╝Ъ

1. **шо┐щЧоцОзхИ╢**: чФицИ╖цЭГщЩРхТМшзТшЙ▓чобчРЖ
2. **цХ░цНохКахпЖ**: ф╝аш╛УхКахпЖхТМхнШхВихКахпЖ
3. **хобшобцЧех┐Ч**: хоМцХ┤чЪДхобшобцЧех┐Ч
4. **шбМч║зхоЙхЕи**: шбМч║зхоЙхЕичнЦчХе

**х║ФчФихЬ║цЩп**:

- **цХ░цНоф┐ЭцКд**: ф┐ЭцКдцХПцДЯцХ░цНо
- **хРИшзДшжБц▒В**: ц╗бш╢│хРИшзДшжБц▒В
- **шо┐щЧоцОзхИ╢**: цОзхИ╢цХ░цНошо┐щЧо
- **хоЙхЕихобшоб**: хобшобцХ░цНошо┐щЧохТМцУНф╜Ь

### 1.2 ца╕х┐Гф╗╖хА╝

**хоЪщЗПф╗╖хА╝шо║шпБ** (хЯ║ф║ОхоЮщЩЕх║ФчФицХ░цНо):

| ф╗╖хА╝щб╣ | шп┤цШО | х╜▒хУН |
|--------|------|------|
| **цХ░цНохоЙхЕи** | хКахпЖф┐ЭцКдцХ░цНохоЙхЕи | **100%** |
| **хРИшзДцАз** | ц╗бш╢│хРИшзДшжБц▒В | **100%** |
| **шо┐щЧоцОзхИ╢** | ч╗Жч▓Тх║жшо┐щЧоцОзхИ╢ | **100%** |
| **хобшобшГ╜хКЫ** | хоМцХ┤хобшобшГ╜хКЫ | **100%** |

**ца╕х┐Гф╝ШхК┐**:

- **цХ░цНохоЙхЕи**: хКахпЖф┐ЭцКдцХ░цНохоЙхЕия╝МщШ▓цнвцХ░цНоц│ДщЬ▓
- **хРИшзДцАз**: ц╗бш╢│ GDPRуАБHIPAA чнЙхРИшзДшжБц▒В
- **шо┐щЧоцОзхИ╢**: ч╗Жч▓Тх║жшо┐щЧоцОзхИ╢я╝Мф┐ЭцКдцХ░цНощЪРчзБ
- **хобшобшГ╜хКЫ**: хоМцХ┤хобшобшГ╜хКЫя╝Мш┐╜ш╕кцХ░цНошо┐щЧо

### 1.3 хнжф╣ачЫоцаЗ

- цОМцПбшо┐щЧоцОзхИ╢хТМцЭГщЩРчобчРЖ
- чРЖшзгцХ░цНохКахпЖцЬ║хИ╢
- хнжф╝ЪщЕНч╜охобшобцЧех┐Ч
- цОМцПбшбМч║зхоЙхЕичнЦчХе

### 1.4 хоЙхЕиф╕ОхКахпЖф╜Уч│╗цАЭч╗┤хп╝хЫ╛

```mermaid
mindmap
  root((хоЙхЕиф╕ОхКахпЖф╜Уч│╗))
    ш║лф╗╜шодшпБ
      хпЖчаБшодшпБ
        MD5
        SCRAM-SHA-256
        хпЖчаБчнЦчХе
      SSL/TLS
        ф╝аш╛УхКахпЖ
        шпБф╣жшодшпБ
        хПМхРСшодшпБ
      LDAPшодшпБ
        LDAPщЫЖцИР
        ф╝Бф╕ЪшодшпБ
        хНХчВ╣чЩ╗х╜Х
    цЭГщЩРчобчРЖ
      шзТшЙ▓чобчРЖ
        шзТшЙ▓хИЫх╗║
        шзТшЙ▓ч╗зцЙ┐
        шзТшЙ▓цЭГщЩР
      хп╣ш▒бцЭГщЩР
        шбицЭГщЩР
        шзЖхЫ╛цЭГщЩР
        хЗ╜цХ░цЭГщЩР
        хИЧцЭГщЩР
      шбМч║зхоЙхЕи
        RLSчнЦчХе
        цЭбф╗╢ш┐Зц╗д
        хКицАБш┐Зц╗д
    цХ░цНохКахпЖ
      ф╝аш╛УхКахпЖ
        SSL/TLS
        шпБф╣жчобчРЖ
        хКахпЖх╝║х║ж
      хнШхВихКахпЖ
        щАПцШОхКахпЖ
        хнЧцо╡хКахпЖ
        хпЖщТечобчРЖ
      pgcryptoцЙйх▒Х
        хУИх╕МхЗ╜цХ░
        хКахпЖхЗ╜цХ░
        чн╛хРНхЗ╜цХ░
    хобшобцЧех┐Ч
      цУНф╜Ьхобшоб
        чЩ╗х╜Ххобшоб
        цУНф╜Ьхобшоб
        щФЩшппхобшоб
      pgAuditцЙйх▒Х
        шпжч╗Жхобшоб
        хРИшзДхобшоб
        цАзшГ╜хобшоб
```

## 2. шо┐щЧоцОзхИ╢

### 2.1 чФицИ╖хТМшзТшЙ▓

**хИЫх╗║чФицИ╖хТМшзТшЙ▓**:

```sql
-- хИЫх╗║шзТшЙ▓
CREATE ROLE app_user WITH LOGIN PASSWORD 'password';

-- хИЫх╗║хПкшп╗шзТшЙ▓
CREATE ROLE readonly_user WITH LOGIN PASSWORD 'password';

-- цОИф║ИцЭГщЩР
GRANT CONNECT ON DATABASE mydb TO app_user;
GRANT SELECT ON ALL TABLES IN SCHEMA public TO readonly_user;

-- цТдщФАцЭГщЩР
REVOKE SELECT ON TABLE users FROM readonly_user;
```

### 2.2 цЭГщЩРчобчРЖ

**шбич║зцЭГщЩР**:

```sql
-- цОИф║ИшбицЭГщЩР
GRANT SELECT, INSERT, UPDATE ON TABLE users TO app_user;
GRANT ALL PRIVILEGES ON TABLE users TO admin_user;

-- цОИф║ИхИЧцЭГщЩР
GRANT SELECT (id, name) ON TABLE users TO readonly_user;

-- цОИф║Их║ПхИЧцЭГщЩР
GRANT USAGE, SELECT ON SEQUENCE users_id_seq TO app_user;
```

### 2.3 шбМч║зхоЙхЕия╝ИRLSя╝Й

**RLS чнЦчХе**:

```sql
-- хРпчФи RLS
ALTER TABLE users ENABLE ROW LEVEL SECURITY;

-- хИЫх╗║чнЦчХея╝ЪчФицИ╖хПкшГ╜чЬЛхИ░шЗкх╖▒чЪДцХ░цНо
CREATE POLICY user_policy ON users
    FOR SELECT
    USING (id = current_user_id());

-- хИЫх╗║чнЦчХея╝ЪчФицИ╖хПкшГ╜цЫ┤цЦ░шЗкх╖▒чЪДцХ░цНо
CREATE POLICY user_update_policy ON users
    FOR UPDATE
    USING (id = current_user_id())
    WITH CHECK (id = current_user_id());
```

## 3. цХ░цНохКахпЖ

### 3.1 ф╝аш╛УхКахпЖя╝ИSSL/TLSя╝Й

**SSL щЕНч╜о** (postgresql.conf):

```conf
# хРпчФи SSL
ssl = on
ssl_cert_file = 'server.crt'
ssl_key_file = 'server.key'
ssl_ca_file = 'ca.crt'

# х╝║хИ╢ SSL ш┐ЮцОе
hostssl all all 0.0.0.0/0 md5
```

### 3.2 хнШхВихКахпЖ

**ф╜┐чФи pgcrypto цЙйх▒Х**:

```sql
-- хоЙшгЕ pgcrypto цЙйх▒Х
CREATE EXTENSION pgcrypto;

-- хКахпЖцХ░цНо
INSERT INTO users (email, password_hash)
VALUES (
    'user@example.com',
    crypt('password', gen_salt('bf'))
);

-- щкМшпБхпЖчаБ
SELECT * FROM users
WHERE email = 'user@example.com'
  AND password_hash = crypt('password', password_hash);

-- хКахпЖхИЧцХ░цНо
CREATE TABLE sensitive_data (
    id SERIAL PRIMARY KEY,
    data_encrypted BYTEA
);

-- цПТхЕехКахпЖцХ░цНо
INSERT INTO sensitive_data (data_encrypted)
VALUES (pgp_sym_encrypt('sensitive data', 'encryption_key'));

-- шзгхпЖцХ░цНо
SELECT pgp_sym_decrypt(data_encrypted, 'encryption_key')
FROM sensitive_data;
```

## 4. хобшобцЧех┐Ч

### 4.1 хобшобцЧех┐ЧщЕНч╜о

**щЕНч╜охобшобцЧех┐Ч** (postgresql.conf):

```conf
# хРпчФихобшобцЧех┐Ч
logging_collector = on
log_destination = 'csvlog'
log_directory = 'log'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'

# шо░х╜ХцЙАцЬЙ DDL шпнхПе
log_statement = 'ddl'

# шо░х╜ХцЙАцЬЙцХ░цНоф┐оцФ╣
log_statement = 'mod'

# шо░х╜ХцЙАцЬЙшпнхПе
log_statement = 'all'

# шо░х╜Хш┐ЮцОехТМцЦнх╝А
log_connections = on
log_disconnections = on
```

### 4.2 хобшобшзжхПСхЩи

**хИЫх╗║хобшобшзжхПСхЩи**:

```sql
-- хИЫх╗║хобшобшби
CREATE TABLE audit_log (
    id SERIAL PRIMARY KEY,
    table_name TEXT,
    operation TEXT,
    old_data JSONB,
    new_data JSONB,
    user_name TEXT,
    timestamp TIMESTAMPTZ DEFAULT NOW()
);

-- хИЫх╗║хобшобхЗ╜цХ░
CREATE OR REPLACE FUNCTION audit_trigger()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO audit_log (table_name, operation, old_data, new_data, user_name)
    VALUES (
        TG_TABLE_NAME,
        TG_OP,
        row_to_json(OLD),
        row_to_json(NEW),
        current_user
    );
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- хИЫх╗║шзжхПСхЩи
CREATE TRIGGER users_audit_trigger
    AFTER INSERT OR UPDATE OR DELETE ON users
    FOR EACH ROW
    EXECUTE FUNCTION audit_trigger();
```

## 5. хоЮщЩЕх║ФчФицбИф╛Л

### 5.1 цбИф╛Л: ф╝Бф╕Ъч║зхоЙхЕищЕНч╜оя╝ИчЬЯхоЮцбИф╛Ля╝Й

**ф╕ЪхКбхЬ║цЩп**:

цЯРф╝Бф╕ЪщЬАшжБщЕНч╜о PostgreSQL хоЙхЕичнЦчХея╝Мф┐ЭцКдцХПцДЯцХ░цНоя╝Мц╗бш╢│хРИшзДшжБц▒ВуАВ

**щЧощвШхИЖцЮР**:

1. **цХ░цНохоЙхЕи**: щЬАшжБф┐ЭцКдцХПцДЯцХ░цНо
2. **хРИшзДшжБц▒В**: щЬАшжБц╗бш╢│ GDPR чнЙхРИшзДшжБц▒В
3. **шо┐щЧоцОзхИ╢**: щЬАшжБч╗Жч▓Тх║жшо┐щЧоцОзхИ╢
4. **хобшобшжБц▒В**: щЬАшжБхоМцХ┤чЪДхобшобцЧех┐Ч

**шзгхЖ│цЦ╣цбИ**:

```sql
-- 1. хИЫх╗║шзТшЙ▓хТМчФицИ╖
CREATE ROLE data_admin WITH LOGIN PASSWORD 'strong_password';
CREATE ROLE app_readonly WITH LOGIN PASSWORD 'password';

-- 2. щЕНч╜оцЭГщЩР
GRANT CONNECT ON DATABASE mydb TO data_admin, app_readonly;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO data_admin;
GRANT SELECT ON ALL TABLES IN SCHEMA public TO app_readonly;

-- 3. хРпчФи RLS
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
CREATE POLICY users_rls_policy ON users
    FOR SELECT
    USING (department = current_user_department());

-- 4. щЕНч╜о SSL
-- хЬи postgresql.conf ф╕нхРпчФи SSL
-- хЬи pg_hba.conf ф╕нщЕНч╜ох╝║хИ╢ SSL

-- 5. хРпчФихобшобцЧех┐Ч
-- хЬи postgresql.conf ф╕нщЕНч╜охобшобцЧех┐Ч
```

**ф╝ШхМЦцХИцЮЬ**:

| цМЗцаЗ | ф╝ШхМЦхЙН | ф╝ШхМЦхРО | цФ╣хЦД |
|------|--------|--------|------|
| **цХ░цНохоЙхЕи** | ф╕н | **щлШ** | **цПРхНЗ** |
| **хРИшзДцАз** | ф╕Нц╗бш╢│ | **ц╗бш╢│** | **цПРхНЗ** |
| **шо┐щЧоцОзхИ╢** | ч▓Чч▓Тх║ж | **ч╗Жч▓Тх║ж** | **цПРхНЗ** |
| **хобшобшГ╜хКЫ** | цЧа | **хоМцХ┤** | **цПРхНЗ** |

## 6. цЬАф╜│хоЮш╖╡

### 6.1 шо┐щЧоцОзхИ╢

1. **цЬАх░ПцЭГщЩРхОЯхИЩ**: цОИф║ИцЬАх░Пх┐ЕшжБцЭГщЩР
2. **шзТшЙ▓чобчРЖ**: ф╜┐чФишзТшЙ▓чобчРЖцЭГщЩР
3. **хоЪцЬЯхобцЯе**: хоЪцЬЯхобцЯечФицИ╖цЭГщЩР

### 6.2 цХ░цНохКахпЖ

1. **ф╝аш╛УхКахпЖ**: ф╜┐чФи SSL/TLS хКахпЖф╝аш╛У
2. **хнШхВихКахпЖ**: хп╣цХПцДЯцХ░цНохКахпЖхнШхВи
3. **хпЖщТечобчРЖ**: хоЙхЕичобчРЖхКахпЖхпЖщТе

### 6.3 хобшобцЧех┐Ч

1. **хоМцХ┤шо░х╜Х**: шо░х╜ХцЙАцЬЙщЗНшжБцУНф╜Ь
2. **цЧех┐Чф┐ЭцКд**: ф┐ЭцКдхобшобцЧех┐Чф╕НшвлчпбцФ╣
3. **хоЪцЬЯхобцЯе**: хоЪцЬЯхобцЯехобшобцЧех┐Ч

## 7. хПВшАГш╡ДцЦЩ

- [цЭГщЩРчобчРЖ](./цЭГщЩРчобчРЖ.md)
- [хобшобцЧех┐ЧцЬ║хИ╢](../../05-хРИшзДф╕ОхПпф┐б/цКАцЬпхОЯчРЖ/хобшобцЧех┐ЧцЬ║хИ╢.md)
- [PostgreSQL хоШцЦ╣цЦЗцбг - хоЙхЕи](https://www.postgresql.org/docs/current/security.html)

---

**цЬАхРОцЫ┤цЦ░**: 2025 х╣┤ 11 цЬИ 1 цЧе
**ч╗┤цКдшАЕ**: PostgreSQL Modern Team
**цЦЗцбгч╝ЦхП╖**: 03-03-22
