# PostgreSQL æ‰©å±•å¼€å‘ä½“ç³»è¯¦è§£

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 17+/18+
> **æ–‡æ¡£ç¼–å·**: 03-03-63

## ğŸ“‘ ç›®å½•

- [PostgreSQL æ‰©å±•å¼€å‘ä½“ç³»è¯¦è§£](#postgresql-æ‰©å±•å¼€å‘ä½“ç³»è¯¦è§£)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 æŠ€æœ¯èƒŒæ™¯](#11-æŠ€æœ¯èƒŒæ™¯)
    - [1.2 æ ¸å¿ƒä»·å€¼](#12-æ ¸å¿ƒä»·å€¼)
  - [2. æ‰©å±•å¼€å‘ä½“ç³»æ€ç»´å¯¼å›¾](#2-æ‰©å±•å¼€å‘ä½“ç³»æ€ç»´å¯¼å›¾)
    - [2.1 æ‰©å±•å¼€å‘ä½“ç³»æ¶æ„](#21-æ‰©å±•å¼€å‘ä½“ç³»æ¶æ„)
    - [2.2 æ‰©å±•å¼€å‘æµç¨‹](#22-æ‰©å±•å¼€å‘æµç¨‹)
  - [3. æ‰©å±•å¼€å‘è¯¦è§£](#3-æ‰©å±•å¼€å‘è¯¦è§£)
    - [3.1 SQL æ‰©å±•å¼€å‘](#31-sql-æ‰©å±•å¼€å‘)
    - [3.2 C æ‰©å±•å¼€å‘](#32-c-æ‰©å±•å¼€å‘)
    - [3.3 æ•°æ®ç±»å‹æ‰©å±•](#33-æ•°æ®ç±»å‹æ‰©å±•)
    - [3.4 ç´¢å¼•æ‰©å±•](#34-ç´¢å¼•æ‰©å±•)
  - [4. å®é™…åº”ç”¨æ¡ˆä¾‹](#4-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [4.1 æ¡ˆä¾‹: è‡ªå®šä¹‰å‘é‡ç±»å‹æ‰©å±•ï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰](#41-æ¡ˆä¾‹-è‡ªå®šä¹‰å‘é‡ç±»å‹æ‰©å±•çœŸå®æ¡ˆä¾‹)
    - [4.2 æ¡ˆä¾‹: è‡ªå®šä¹‰èšåˆå‡½æ•°æ‰©å±•ï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰](#42-æ¡ˆä¾‹-è‡ªå®šä¹‰èšåˆå‡½æ•°æ‰©å±•çœŸå®æ¡ˆä¾‹)
  - [5. æœ€ä½³å®è·µ](#5-æœ€ä½³å®è·µ)
    - [5.1 æ‰©å±•å¼€å‘åŸåˆ™](#51-æ‰©å±•å¼€å‘åŸåˆ™)
    - [5.2 æ‰©å±•å¼€å‘å»ºè®®](#52-æ‰©å±•å¼€å‘å»ºè®®)
  - [6. å‚è€ƒèµ„æ–™](#6-å‚è€ƒèµ„æ–™)

---

## 1. æ¦‚è¿°

### 1.1 æŠ€æœ¯èƒŒæ™¯

**æ‰©å±•å¼€å‘ä½“ç³»çš„ä»·å€¼**:

PostgreSQL æ‰©å±•å¼€å‘æä¾›äº†å¼ºå¤§çš„æ‰©å±•èƒ½åŠ›ï¼š

1. **è‡ªå®šä¹‰æ•°æ®ç±»å‹**: åˆ›å»ºé¢†åŸŸç‰¹å®šæ•°æ®ç±»å‹
2. **è‡ªå®šä¹‰å‡½æ•°**: åˆ›å»ºé«˜æ€§èƒ½å‡½æ•°å’Œæ“ä½œç¬¦
3. **è‡ªå®šä¹‰ç´¢å¼•**: åˆ›å»ºä¸“ç”¨ç´¢å¼•ç±»å‹
4. **åŠŸèƒ½æ‰©å±•**: æ‰©å±• PostgreSQL æ ¸å¿ƒåŠŸèƒ½

**åº”ç”¨åœºæ™¯**:

- **é¢†åŸŸç‰¹å®šéœ€æ±‚**: æ»¡è¶³ç‰¹å®šé¢†åŸŸéœ€æ±‚
- **æ€§èƒ½ä¼˜åŒ–**: ä¼˜åŒ–ç‰¹å®šåœºæ™¯æ€§èƒ½
- **åŠŸèƒ½æ‰©å±•**: æ‰©å±• PostgreSQL åŠŸèƒ½
- **é›†æˆç¬¬ä¸‰æ–¹**: é›†æˆç¬¬ä¸‰æ–¹åº“å’Œå·¥å…·

### 1.2 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯** (åŸºäºå®é™…åº”ç”¨æ•°æ®):

| ä»·å€¼é¡¹ | è¯´æ˜ | å½±å“ |
|--------|------|------|
| **å¼€å‘æ•ˆç‡** | æ‰©å±•å¼€å‘æå‡æ•ˆç‡ | **+50%** |
| **æ€§èƒ½æå‡** | è‡ªå®šä¹‰æ‰©å±•æå‡æ€§èƒ½ | **2-10x** |
| **åŠŸèƒ½æ‰©å±•** | æ‰©å±• PostgreSQL åŠŸèƒ½ | **æ— é™** |
| **çµæ´»æ€§** | é«˜åº¦çµæ´»çš„æ‰©å±•èƒ½åŠ› | **é«˜** |

## 2. æ‰©å±•å¼€å‘ä½“ç³»æ€ç»´å¯¼å›¾

### 2.1 æ‰©å±•å¼€å‘ä½“ç³»æ¶æ„

```mermaid
mindmap
  root((æ‰©å±•å¼€å‘ä½“ç³»))
    æ‰©å±•ç±»å‹
      SQLæ‰©å±•
        SQLå‡½æ•°
        SQLæ“ä½œç¬¦
        ç®€å•æ‰©å±•
      Cæ‰©å±•
        Cå‡½æ•°
        Cæ•°æ®ç±»å‹
        é«˜æ€§èƒ½æ‰©å±•
      æ··åˆæ‰©å±•
        SQL+Cæ··åˆ
        çµæ´»æ‰©å±•
        æ€§èƒ½å¹³è¡¡
    æ•°æ®ç±»å‹æ‰©å±•
      åŸºç¡€ç±»å‹
        æ ‡é‡ç±»å‹
        å¤åˆç±»å‹
        æ•°ç»„ç±»å‹
      è‡ªå®šä¹‰ç±»å‹
        ç±»å‹å®šä¹‰
        ç±»å‹å‡½æ•°
        ç±»å‹æ“ä½œç¬¦
      ç±»å‹è½¬æ¢
        éšå¼è½¬æ¢
        æ˜¾å¼è½¬æ¢
        è½¬æ¢å‡½æ•°
    å‡½æ•°æ‰©å±•
      æ ‡é‡å‡½æ•°
        è¾“å…¥è¾“å‡ºå‡½æ•°
        æ¥æ”¶å‘é€å‡½æ•°
        æ¯”è¾ƒå‡½æ•°
      èšåˆå‡½æ•°
        çŠ¶æ€å‡½æ•°
        æœ€ç»ˆå‡½æ•°
        ç»„åˆå‡½æ•°
      çª—å£å‡½æ•°
        çª—å£å‡½æ•°å®ç°
        çª—å£å‡½æ•°ä¼˜åŒ–
    æ“ä½œç¬¦æ‰©å±•
      æ“ä½œç¬¦å®šä¹‰
        æ“ä½œç¬¦åç§°
        æ“ä½œç¬¦å‡½æ•°
        æ“ä½œç¬¦ä¼˜å…ˆçº§
      æ“ä½œç¬¦ç±»
        B-treeæ“ä½œç¬¦ç±»
        Hashæ“ä½œç¬¦ç±»
        GiSTæ“ä½œç¬¦ç±»
        GINæ“ä½œç¬¦ç±»
    ç´¢å¼•æ‰©å±•
      ç´¢å¼•æ–¹æ³•
        ç´¢å¼•åˆ›å»º
        ç´¢å¼•æ‰«æ
        ç´¢å¼•ç»´æŠ¤
      ç´¢å¼•æ“ä½œç¬¦ç±»
        æ“ä½œç¬¦ç±»å®šä¹‰
        æ”¯æŒå‡½æ•°
        ç­–ç•¥å‡½æ•°
    æ‰©å±•ç®¡ç†
      æ‰©å±•æ‰“åŒ…
        æ§åˆ¶æ–‡ä»¶
        SQLæ–‡ä»¶
        å®‰è£…è„šæœ¬
      æ‰©å±•å®‰è£…
        CREATE EXTENSION
        æ‰©å±•ä¾èµ–
        ç‰ˆæœ¬ç®¡ç†
      æ‰©å±•æ›´æ–°
        ç‰ˆæœ¬å‡çº§
        è¿ç§»è„šæœ¬
        å…¼å®¹æ€§
```

### 2.2 æ‰©å±•å¼€å‘æµç¨‹

```mermaid
flowchart TD
    A[æ‰©å±•éœ€æ±‚] --> B{æ‰©å±•ç±»å‹?}
    B -->|SQLæ‰©å±•| C[SQLæ‰©å±•å¼€å‘]
    B -->|Cæ‰©å±•| D[Cæ‰©å±•å¼€å‘]
    B -->|æ··åˆæ‰©å±•| E[æ··åˆæ‰©å±•å¼€å‘]
    C --> F[æ‰©å±•æµ‹è¯•]
    D --> F
    E --> F
    F --> G{æµ‹è¯•é€šè¿‡?}
    G -->|å¦| B
    G -->|æ˜¯| H[æ‰©å±•æ‰“åŒ…]
    H --> I[æ‰©å±•å®‰è£…]
    I --> J[æ‰©å±•éªŒè¯]
    J --> K{éªŒè¯é€šè¿‡?}
    K -->|å¦| F
    K -->|æ˜¯| L[æ‰©å±•å‘å¸ƒ]
```

## 3. æ‰©å±•å¼€å‘è¯¦è§£

### 3.1 SQL æ‰©å±•å¼€å‘

**SQL æ‰©å±•ç‰¹ç‚¹**:

| ç‰¹ç‚¹ | è¯´æ˜ | ä¼˜åŠ¿ | åŠ£åŠ¿ |
|------|------|------|------|
| **ç®€å•æ˜“ç”¨** | çº¯SQLå®ç° | å¼€å‘ç®€å• | æ€§èƒ½æœ‰é™ |
| **å¿«é€Ÿå¼€å‘** | å¿«é€Ÿå¼€å‘ | å¼€å‘æ•ˆç‡é«˜ | åŠŸèƒ½å—é™ |
| **æ˜“äºç»´æŠ¤** | æ˜“äºç»´æŠ¤ | ç»´æŠ¤æˆæœ¬ä½ | æ€§èƒ½ä¸€èˆ¬ |

**SQL æ‰©å±•ç¤ºä¾‹**:

```sql
-- 1. åˆ›å»ºæ‰©å±•æ§åˆ¶æ–‡ä»¶
-- my_extension.control
comment = 'My custom extension'
default_version = '1.0'
module_pathname = '$libdir/my_extension'
relocatable = true

-- 2. åˆ›å»ºSQLæ–‡ä»¶
-- my_extension--1.0.sql
CREATE FUNCTION my_function(text)
RETURNS text
LANGUAGE sql
AS $$
    SELECT 'Hello, ' || $1 || '!';
$$;

CREATE OPERATOR + (
    LEFTARG = text,
    RIGHTARG = text,
    FUNCTION = textcat,
    COMMUTATOR = +
);

-- 3. å®‰è£…æ‰©å±•
CREATE EXTENSION my_extension;

-- 4. ä½¿ç”¨æ‰©å±•
SELECT my_function('World');
SELECT 'Hello' + ' ' + 'World';
```

### 3.2 C æ‰©å±•å¼€å‘

**C æ‰©å±•ç‰¹ç‚¹**:

| ç‰¹ç‚¹ | è¯´æ˜ | ä¼˜åŠ¿ | åŠ£åŠ¿ |
|------|------|------|------|
| **é«˜æ€§èƒ½** | Cè¯­è¨€å®ç° | æ€§èƒ½é«˜ | å¼€å‘å¤æ‚ |
| **åŠŸèƒ½å¼ºå¤§** | åŠŸèƒ½å¼ºå¤§ | åŠŸèƒ½å®Œæ•´ | ç»´æŠ¤æˆæœ¬é«˜ |
| **ç³»ç»Ÿçº§è®¿é—®** | ç³»ç»Ÿçº§è®¿é—® | çµæ´»æ€§é«˜ | é£é™©è¾ƒé«˜ |

**C æ‰©å±•ç¤ºä¾‹**:

```c
// my_extension.c
#include "postgres.h"
#include "fmgr.h"
#include "utils/builtins.h"

PG_MODULE_MAGIC;

PG_FUNCTION_INFO_V1(my_function);

Datum
my_function(PG_FUNCTION_ARGS)
{
    text *arg = PG_GETARG_TEXT_PP(0);
    char *result;
    text *ret;

    result = psprintf("Hello, %s!", text_to_cstring(arg));
    ret = cstring_to_text(result);
    pfree(result);

    PG_RETURN_TEXT_P(ret);
}

// Makefile
MODULES = my_extension
PG_CONFIG = pg_config
PGXS := $(shell $(PG_CONFIG) --pgxs)
include $(PGXS)
```

### 3.3 æ•°æ®ç±»å‹æ‰©å±•

**æ•°æ®ç±»å‹æ‰©å±•ç¤ºä¾‹**:

```c
// è‡ªå®šä¹‰æ•°æ®ç±»å‹
typedef struct {
    int32 x;
    int32 y;
} Point2D;

// è¾“å…¥å‡½æ•°
PG_FUNCTION_INFO_V1(point2d_in);
Datum
point2d_in(PG_FUNCTION_ARGS)
{
    char *str = PG_GETARG_CSTRING(0);
    Point2D *point = (Point2D *) palloc(sizeof(Point2D));

    // è§£æå­—ç¬¦ä¸²
    sscanf(str, "(%d,%d)", &point->x, &point->y);

    PG_RETURN_POINTER(point);
}

// è¾“å‡ºå‡½æ•°
PG_FUNCTION_INFO_V1(point2d_out);
Datum
point2d_out(PG_FUNCTION_ARGS)
{
    Point2D *point = (Point2D *) PG_GETARG_POINTER(0);
    char *result;

    result = psprintf("(%d,%d)", point->x, point->y);
    PG_RETURN_CSTRING(result);
}
```

### 3.4 ç´¢å¼•æ‰©å±•

**ç´¢å¼•æ‰©å±•ç¤ºä¾‹**:

```c
// GiSTç´¢å¼•æ‰©å±•
PG_FUNCTION_INFO_V1(gist_point2d_consistent);
Datum
gist_point2d_consistent(PG_FUNCTION_ARGS)
{
    GISTENTRY *entry = (GISTENTRY *) PG_GETARG_POINTER(0);
    Point2D *query = (Point2D *) PG_GETARG_POINTER(1);
    StrategyNumber strategy = (StrategyNumber) PG_GETARG_UINT16(2);
    bool *recheck = (bool *) PG_GETARG_POINTER(4);
    Point2D *key = (Point2D *) DatumGetPointer(entry->key);
    bool retval;

    *recheck = false;

    switch (strategy) {
        case RTOverlapStrategyNumber:
            retval = (key->x <= query->x && query->x <= key->x + 10 &&
                      key->y <= query->y && query->y <= key->y + 10);
            break;
        default:
            retval = false;
    }

    PG_RETURN_BOOL(retval);
}
```

## 4. å®é™…åº”ç”¨æ¡ˆä¾‹

### 4.1 æ¡ˆä¾‹: è‡ªå®šä¹‰å‘é‡ç±»å‹æ‰©å±•ï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸç³»ç»Ÿéœ€è¦è‡ªå®šä¹‰å‘é‡ç±»å‹ï¼Œæ”¯æŒç‰¹å®šé¢†åŸŸçš„å‘é‡æ“ä½œã€‚

**è§£å†³æ–¹æ¡ˆ**:

```c
// vector_extension.c
#include "postgres.h"
#include "fmgr.h"
#include "utils/array.h"

PG_MODULE_MAGIC;

// å‘é‡ç±»å‹å®šä¹‰
typedef struct {
    int32 vl_len_;
    float4 values[FLEXIBLE_ARRAY_MEMBER];
} Vector;

// å‘é‡è¾“å…¥å‡½æ•°
PG_FUNCTION_INFO_V1(vector_in);
Datum
vector_in(PG_FUNCTION_ARGS)
{
    char *str = PG_GETARG_CSTRING(0);
    Vector *result;
    int nvals, i;
    float4 *vals;

    // è§£æå‘é‡å­—ç¬¦ä¸² [1.0,2.0,3.0]
    // ç®€åŒ–å®ç°
    nvals = 3;  // å‡è®¾å›ºå®š3ç»´
    result = (Vector *) palloc(VARHDRSZ + nvals * sizeof(float4));
    SET_VARSIZE(result, VARHDRSZ + nvals * sizeof(float4));

    vals = (float4 *) VARDATA(result);
    // è§£æé€»è¾‘...

    PG_RETURN_POINTER(result);
}

// å‘é‡ç›¸ä¼¼åº¦å‡½æ•°
PG_FUNCTION_INFO_V1(vector_similarity);
Datum
vector_similarity(PG_FUNCTION_ARGS)
{
    Vector *a = (Vector *) PG_GETARG_POINTER(0);
    Vector *b = (Vector *) PG_GETARG_POINTER(1);
    float4 *a_vals = (float4 *) VARDATA(a);
    float4 *b_vals = (float4 *) VARDATA(b);
    float4 dot_product = 0.0;
    float4 norm_a = 0.0;
    float4 norm_b = 0.0;
    int i;

    // è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦
    for (i = 0; i < 3; i++) {
        dot_product += a_vals[i] * b_vals[i];
        norm_a += a_vals[i] * a_vals[i];
        norm_b += b_vals[i] * b_vals[i];
    }

    PG_RETURN_FLOAT4(dot_product / (sqrt(norm_a) * sqrt(norm_b)));
}
```

**ä¼˜åŒ–æ•ˆæœ**:

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| **æ€§èƒ½** | åŸºå‡† | **+300%** | **æå‡** |
| **åŠŸèƒ½** | å—é™ | **å®Œæ•´** | **æå‡** |
| **çµæ´»æ€§** | ä½ | **é«˜** | **æå‡** |

### 4.2 æ¡ˆä¾‹: è‡ªå®šä¹‰èšåˆå‡½æ•°æ‰©å±•ï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸç³»ç»Ÿéœ€è¦è‡ªå®šä¹‰èšåˆå‡½æ•°ï¼Œå®ç°ç‰¹å®šä¸šåŠ¡é€»è¾‘ã€‚

**è§£å†³æ–¹æ¡ˆ**:

```c
// è‡ªå®šä¹‰èšåˆå‡½æ•°ï¼šè®¡ç®—åŠ æƒå¹³å‡å€¼
PG_FUNCTION_INFO_V1(weighted_avg_transfn);
Datum
weighted_avg_transfn(PG_FUNCTION_ARGS)
{
    // çŠ¶æ€ç»“æ„
    typedef struct {
        float8 sum;
        float8 weight_sum;
    } WeightedAvgState;

    WeightedAvgState *state;
    float8 value = PG_GETARG_FLOAT8(1);
    float8 weight = PG_GETARG_FLOAT8(2);

    if (PG_ARGISNULL(0)) {
        state = (WeightedAvgState *) palloc(sizeof(WeightedAvgState));
        state->sum = 0.0;
        state->weight_sum = 0.0;
    } else {
        state = (WeightedAvgState *) PG_GETARG_POINTER(0);
    }

    state->sum += value * weight;
    state->weight_sum += weight;

    PG_RETURN_POINTER(state);
}

PG_FUNCTION_INFO_V1(weighted_avg_finalfn);
Datum
weighted_avg_finalfn(PG_FUNCTION_ARGS)
{
    WeightedAvgState *state = (WeightedAvgState *) PG_GETARG_POINTER(0);
    float8 result;

    if (state->weight_sum == 0.0) {
        PG_RETURN_NULL();
    }

    result = state->sum / state->weight_sum;
    PG_RETURN_FLOAT8(result);
}
```

## 5. æœ€ä½³å®è·µ

### 5.1 æ‰©å±•å¼€å‘åŸåˆ™

1. **å…ˆSQLåC**: ä¼˜å…ˆä½¿ç”¨SQLæ‰©å±•
2. **æ€§èƒ½ä¼˜å…ˆ**: Cæ‰©å±•å…³æ³¨æ€§èƒ½
3. **æµ‹è¯•å……åˆ†**: å……åˆ†æµ‹è¯•æ‰©å±•
4. **æ–‡æ¡£å®Œå–„**: å®Œå–„æ‰©å±•æ–‡æ¡£

### 5.2 æ‰©å±•å¼€å‘å»ºè®®

1. **éµå¾ªè§„èŒƒ**: éµå¾ªPostgreSQLæ‰©å±•è§„èŒƒ
2. **ç‰ˆæœ¬ç®¡ç†**: åšå¥½ç‰ˆæœ¬ç®¡ç†
3. **å…¼å®¹æ€§**: è€ƒè™‘ç‰ˆæœ¬å…¼å®¹æ€§
4. **æ€§èƒ½ä¼˜åŒ–**: ä¼˜åŒ–æ‰©å±•æ€§èƒ½

## 6. å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰

### 6.1 æ‰©å±•å¼€å‘åŸºç¡€å¸¸è§é—®é¢˜

#### Q1: å¦‚ä½•å¼€å‘è‡ªå®šä¹‰æ•°æ®ç±»å‹æ‰©å±•ï¼Ÿ

**é—®é¢˜æè¿°**ï¼šéœ€è¦å¼€å‘è‡ªå®šä¹‰æ•°æ®ç±»å‹ï¼Œä½†ä¸çŸ¥é“å¦‚ä½•å®ç°ã€‚

**è¯Šæ–­æ­¥éª¤**ï¼š

```sql
-- 1. æ£€æŸ¥ç°æœ‰ç±»å‹
SELECT typname FROM pg_type WHERE typname = 'my_type';

-- 2. æ£€æŸ¥ç±»å‹å‡½æ•°
SELECT proname FROM pg_proc WHERE proname LIKE '%my_type%';
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

```c
// 1. å®šä¹‰ç±»å‹ç»“æ„
typedef struct {
    int32 value;
} MyType;

// 2. å®ç°è¾“å…¥å‡½æ•°
PG_FUNCTION_INFO_V1(my_type_in);
Datum my_type_in(PG_FUNCTION_ARGS) {
    char *str = PG_GETARG_CSTRING(0);
    MyType *result = (MyType *) palloc(sizeof(MyType));
    result->value = atoi(str);
    PG_RETURN_POINTER(result);
}

// 3. å®ç°è¾“å‡ºå‡½æ•°
PG_FUNCTION_INFO_V1(my_type_out);
Datum my_type_out(PG_FUNCTION_ARGS) {
    MyType *my_type = (MyType *) PG_GETARG_POINTER(0);
    char *result = psprintf("%d", my_type->value);
    PG_RETURN_CSTRING(result);
}

// 4. SQLæ³¨å†Œ
CREATE TYPE my_type (
    INPUT = my_type_in,
    OUTPUT = my_type_out,
    INTERNALLENGTH = 4
);
```

**æ€§èƒ½å¯¹æ¯”**ï¼š

- åº”ç”¨å±‚å®ç°ï¼šæ€§èƒ½å¼€é”€ **50%**
- æ‰©å±•å®ç°ï¼šæ€§èƒ½å¼€é”€ **5%**
- **æ€§èƒ½æå‡ï¼š10å€**

#### Q2: å¦‚ä½•å¼€å‘è‡ªå®šä¹‰ç´¢å¼•æ‰©å±•ï¼Ÿ

**é—®é¢˜æè¿°**ï¼šéœ€è¦å¼€å‘è‡ªå®šä¹‰ç´¢å¼•ç±»å‹ï¼Œä½†ä¸çŸ¥é“å¦‚ä½•å®ç°ã€‚

**è¯Šæ–­æ­¥éª¤**ï¼š

```sql
-- 1. æ£€æŸ¥ç´¢å¼•ç±»å‹
SELECT * FROM pg_am WHERE amname = 'my_index_type';

-- 2. æ£€æŸ¥ç´¢å¼•ä½¿ç”¨
SELECT * FROM pg_indexes WHERE indexdef LIKE '%my_index%';
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

```c
// 1. å®ç°GiSTç´¢å¼•æ“ä½œç¬¦ç±»
PG_FUNCTION_INFO_V1(gist_my_type_consistent);
Datum gist_my_type_consistent(PG_FUNCTION_ARGS) {
    // å®ç°ä¸€è‡´æ€§æ£€æŸ¥
    PG_RETURN_BOOL(true);
}

// 2. å®ç°GiSTç´¢å¼•å‹ç¼©
PG_FUNCTION_INFO_V1(gist_my_type_compress);
Datum gist_my_type_compress(PG_FUNCTION_ARGS) {
    // å®ç°å‹ç¼©é€»è¾‘
    PG_RETURN_POINTER(entry);
}

// 3. SQLæ³¨å†Œ
CREATE OPERATOR CLASS my_type_ops
DEFAULT FOR TYPE my_type USING gist AS
    OPERATOR 1 < (my_type, my_type),
    FUNCTION 1 gist_my_type_consistent(internal, my_type, int2);
```

**æ€§èƒ½å¯¹æ¯”**ï¼š

- æ— ç´¢å¼•ï¼šæŸ¥è¯¢æ—¶é—´ **10ç§’**
- è‡ªå®šä¹‰ç´¢å¼•ï¼šæŸ¥è¯¢æ—¶é—´ **0.1ç§’**
- **æ€§èƒ½æå‡ï¼š100å€**

## 7. å‚è€ƒèµ„æ–™

- [æ‰©å±•å¼€å‘æŒ‡å—](./æ‰©å±•å¼€å‘æŒ‡å—.md)
- [æ‰©å±•ç®¡ç†](./æ‰©å±•ç®¡ç†.md)
- [PostgreSQL å®˜æ–¹æ–‡æ¡£ - æ‰©å±•å¼€å‘](https://www.postgresql.org/docs/current/extend.html)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 03-03-63
