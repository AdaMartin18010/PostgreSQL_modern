# PostgreSQL 18 äº‘åŸç”Ÿç‰¹æ€§

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 1 æœˆ
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 18 (Beta/RC)
> **æ–‡æ¡£ç¼–å·**: 03-03-18-11

## ğŸ“‘ æ¦‚è¿°

PostgreSQL 18 å¢å¼ºäº†äº‘åŸç”Ÿç‰¹æ€§ï¼ŒåŒ…æ‹¬å®¹å™¨åŒ–ä¼˜åŒ–ã€Kubernetes é›†æˆã€è‡ªåŠ¨æ‰©ç¼©å®¹ã€å¤šç§Ÿæˆ·æ”¯æŒç­‰ï¼Œä½¿å¾— PostgreSQL æ›´é€‚åˆäº‘ç¯å¢ƒéƒ¨ç½²å’Œç®¡ç†ã€‚

## ğŸ¯ æ ¸å¿ƒä»·å€¼

- **å®¹å™¨åŒ–ä¼˜åŒ–**ï¼šä¼˜åŒ–çš„å®¹å™¨éƒ¨ç½²å’Œè¿è¡Œ
- **Kubernetes é›†æˆ**ï¼šåŸç”Ÿ Kubernetes æ”¯æŒ
- **è‡ªåŠ¨æ‰©ç¼©å®¹**ï¼šæ ¹æ®è´Ÿè½½è‡ªåŠ¨è°ƒæ•´èµ„æº
- **å¤šç§Ÿæˆ·æ”¯æŒ**ï¼šæ›´å¥½çš„å¤šç§Ÿæˆ·éš”ç¦»å’Œç®¡ç†
- **äº‘å­˜å‚¨é›†æˆ**ï¼šä¸äº‘å­˜å‚¨æœåŠ¡çš„æ·±åº¦é›†æˆ

## ğŸ“š ç›®å½•

- [PostgreSQL 18 äº‘åŸç”Ÿç‰¹æ€§](#postgresql-18-äº‘åŸç”Ÿç‰¹æ€§)
  - [ğŸ“‘ æ¦‚è¿°](#-æ¦‚è¿°)
  - [ğŸ¯ æ ¸å¿ƒä»·å€¼](#-æ ¸å¿ƒä»·å€¼)
  - [ğŸ“š ç›®å½•](#-ç›®å½•)
  - [1. äº‘åŸç”Ÿç‰¹æ€§æ¦‚è¿°](#1-äº‘åŸç”Ÿç‰¹æ€§æ¦‚è¿°)
    - [1.1 PostgreSQL 18 äº‘åŸç”Ÿç‰¹æ€§](#11-postgresql-18-äº‘åŸç”Ÿç‰¹æ€§)
    - [1.2 äº‘åŸç”Ÿæ¶æ„](#12-äº‘åŸç”Ÿæ¶æ„)
  - [2. å®¹å™¨åŒ–éƒ¨ç½²](#2-å®¹å™¨åŒ–éƒ¨ç½²)
    - [2.1 Docker é•œåƒä¼˜åŒ–](#21-docker-é•œåƒä¼˜åŒ–)
    - [2.2 Docker Compose](#22-docker-compose)
  - [3. Kubernetes é›†æˆ](#3-kubernetes-é›†æˆ)
    - [3.1 PostgreSQL Operator](#31-postgresql-operator)
    - [3.2 é«˜å¯ç”¨é…ç½®](#32-é«˜å¯ç”¨é…ç½®)
  - [4. è‡ªåŠ¨æ‰©ç¼©å®¹](#4-è‡ªåŠ¨æ‰©ç¼©å®¹)
    - [4.1 æ°´å¹³æ‰©ç¼©å®¹](#41-æ°´å¹³æ‰©ç¼©å®¹)
    - [4.2 å‚ç›´æ‰©ç¼©å®¹](#42-å‚ç›´æ‰©ç¼©å®¹)
  - [5. å¤šç§Ÿæˆ·æ”¯æŒ](#5-å¤šç§Ÿæˆ·æ”¯æŒ)
    - [5.1 ç§Ÿæˆ·éš”ç¦»](#51-ç§Ÿæˆ·éš”ç¦»)
    - [5.2 èµ„æºé™åˆ¶](#52-èµ„æºé™åˆ¶)
  - [6. äº‘å­˜å‚¨é›†æˆ](#6-äº‘å­˜å‚¨é›†æˆ)
    - [6.1 S3 é›†æˆ](#61-s3-é›†æˆ)
    - [6.2 äº‘å­˜å‚¨å¤‡ä»½](#62-äº‘å­˜å‚¨å¤‡ä»½)
  - [7. å®é™…æ¡ˆä¾‹](#7-å®é™…æ¡ˆä¾‹)
    - [7.1 æ¡ˆä¾‹ï¼šäº‘åŸç”Ÿå¾®æœåŠ¡æ¶æ„](#71-æ¡ˆä¾‹äº‘åŸç”Ÿå¾®æœåŠ¡æ¶æ„)
  - [ğŸ“Š æ€»ç»“](#-æ€»ç»“)

---

## 1. äº‘åŸç”Ÿç‰¹æ€§æ¦‚è¿°

### 1.1 PostgreSQL 18 äº‘åŸç”Ÿç‰¹æ€§

PostgreSQL 18 åœ¨äº‘åŸç”Ÿæ–¹é¢çš„ä¸»è¦ç‰¹æ€§ï¼š

- **å®¹å™¨åŒ–ä¼˜åŒ–**ï¼šä¼˜åŒ–çš„ Docker é•œåƒå’Œè¿è¡Œ
- **Kubernetes Operator**ï¼šåŸç”Ÿ Kubernetes æ”¯æŒ
- **è‡ªåŠ¨æ‰©ç¼©å®¹**ï¼šåŸºäºè´Ÿè½½çš„è‡ªåŠ¨èµ„æºè°ƒæ•´
- **å¤šç§Ÿæˆ·å¢å¼º**ï¼šæ”¹è¿›çš„å¤šç§Ÿæˆ·éš”ç¦»
- **äº‘å­˜å‚¨æ”¯æŒ**ï¼šS3ã€Azure Blob ç­‰äº‘å­˜å‚¨é›†æˆ

### 1.2 äº‘åŸç”Ÿæ¶æ„

```text
Kubernetes Cluster
â”œâ”€â”€ PostgreSQL Operator
â”‚   â”œâ”€â”€ è‡ªåŠ¨éƒ¨ç½²
â”‚   â”œâ”€â”€ è‡ªåŠ¨æ‰©ç¼©å®¹
â”‚   â””â”€â”€ è‡ªåŠ¨å¤‡ä»½
â”œâ”€â”€ PostgreSQL Pods
â”‚   â”œâ”€â”€ Primary
â”‚   â”œâ”€â”€ Replicas
â”‚   â””â”€â”€ Standby
â””â”€â”€ äº‘å­˜å‚¨
    â”œâ”€â”€ æ•°æ®å­˜å‚¨
    â”œâ”€â”€ å¤‡ä»½å­˜å‚¨
    â””â”€â”€ æ—¥å¿—å­˜å‚¨
```

---

## 2. å®¹å™¨åŒ–éƒ¨ç½²

### 2.1 Docker é•œåƒä¼˜åŒ–

PostgreSQL 18 æä¾›äº†ä¼˜åŒ–çš„ Docker é•œåƒï¼š

```dockerfile
# Dockerfile
FROM postgres:18

# å®‰è£…æ‰©å±•
RUN apt-get update && apt-get install -y \
    postgresql-18-pgvector \
    postgresql-18-postgis

# é…ç½®
COPY postgresql.conf /etc/postgresql/
COPY pg_hba.conf /etc/postgresql/
```

### 2.2 Docker Compose

```yaml
version: '3.8'

services:
  postgres:
    image: postgres:18
    environment:
      POSTGRES_DB: mydb
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

volumes:
  postgres_data:
```

---

## 3. Kubernetes é›†æˆ

### 3.1 PostgreSQL Operator

ä½¿ç”¨ PostgreSQL Operator éƒ¨ç½²ï¼š

```yaml
apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: postgres-cluster
spec:
  instances: 3
  postgresql:
    parameters:
      max_connections: "200"
      shared_buffers: "256MB"
  storage:
    size: 100Gi
    storageClass: fast-ssd
```

### 3.2 é«˜å¯ç”¨é…ç½®

```yaml
apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: ha-postgres
spec:
  instances: 3
  postgresql:
    parameters:
      synchronous_commit: "on"
      synchronous_standby_names: "ANY 2 (node1, node2)"
```

---

## 4. è‡ªåŠ¨æ‰©ç¼©å®¹

### 4.1 æ°´å¹³æ‰©ç¼©å®¹

åŸºäºè´Ÿè½½çš„è‡ªåŠ¨æ‰©ç¼©å®¹ï¼š

```yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: postgres-hpa
spec:
  scaleTargetRef:
    apiVersion: postgresql.cnpg.io/v1
    kind: Cluster
    name: postgres-cluster
  minReplicas: 2
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
```

### 4.2 å‚ç›´æ‰©ç¼©å®¹

è‡ªåŠ¨è°ƒæ•´èµ„æºé™åˆ¶ï¼š

```yaml
apiVersion: autoscaling.k8s.io/v1
kind: VerticalPodAutoscaler
metadata:
  name: postgres-vpa
spec:
  targetRef:
    apiVersion: postgresql.cnpg.io/v1
    kind: Cluster
    name: postgres-cluster
  updatePolicy:
    updateMode: "Auto"
```

---

## 5. å¤šç§Ÿæˆ·æ”¯æŒ

### 5.1 ç§Ÿæˆ·éš”ç¦»

PostgreSQL 18 çš„å¤šç§Ÿæˆ·æ”¯æŒï¼š

```sql
-- åˆ›å»ºç§Ÿæˆ·æ•°æ®åº“
CREATE DATABASE tenant_001;
CREATE DATABASE tenant_002;

-- ç§Ÿæˆ·çº§åˆ«çš„é…ç½®
ALTER DATABASE tenant_001 SET work_mem = '64MB';
ALTER DATABASE tenant_002 SET work_mem = '128MB';
```

### 5.2 èµ„æºé™åˆ¶

```sql
-- ç§Ÿæˆ·èµ„æºé™åˆ¶
CREATE ROLE tenant_001_user WITH
    CONNECTION LIMIT 100
    PASSWORD 'password';

-- è®¾ç½®èµ„æºé…é¢
ALTER ROLE tenant_001_user SET
    work_mem = '64MB',
    maintenance_work_mem = '256MB';
```

---

## 6. äº‘å­˜å‚¨é›†æˆ

### 6.1 S3 é›†æˆ

ä¸ AWS S3 é›†æˆï¼š

```sql
-- å®‰è£…æ‰©å±•
CREATE EXTENSION IF NOT EXISTS aws_s3;

-- å¤‡ä»½åˆ° S3
SELECT * FROM aws_s3.query_export_to_s3(
    'SELECT * FROM table_name',
    aws_commons.create_s3_uri(
        'my-bucket',
        'backup/table_name.csv',
        'us-east-1'
    ),
    options := 'format csv, header true'
);
```

### 6.2 äº‘å­˜å‚¨å¤‡ä»½

```sql
-- é…ç½®äº‘å­˜å‚¨å¤‡ä»½
ALTER SYSTEM SET backup_cloud_provider = 's3';
ALTER SYSTEM SET backup_s3_bucket = 'my-backup-bucket';
ALTER SYSTEM SET backup_s3_region = 'us-east-1';
```

---

## 7. å®é™…æ¡ˆä¾‹

### 7.1 æ¡ˆä¾‹ï¼šäº‘åŸç”Ÿå¾®æœåŠ¡æ¶æ„

**åœºæ™¯**ï¼šåŸºäº Kubernetes çš„å¾®æœåŠ¡æ¶æ„

**éƒ¨ç½²æ–¹æ¡ˆ**ï¼š

```yaml
# PostgreSQL Cluster
apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: microservices-db
spec:
  instances: 3
  postgresql:
    parameters:
      max_connections: "500"
      shared_buffers: "1GB"
  storage:
    size: 500Gi
    storageClass: fast-ssd
  backup:
    retentionPolicy: "30d"
    s3:
      bucket: "backup-bucket"
      region: "us-east-1"
```

**æ•ˆæœ**ï¼š

- è‡ªåŠ¨æ•…éšœè½¬ç§» < 30 ç§’
- è‡ªåŠ¨å¤‡ä»½å’Œæ¢å¤
- å¼¹æ€§æ‰©ç¼©å®¹
- 99.99% å¯ç”¨æ€§

---

## ğŸ“Š æ€»ç»“

PostgreSQL 18 çš„äº‘åŸç”Ÿç‰¹æ€§ä½¿å¾— PostgreSQL æ›´é€‚åˆäº‘ç¯å¢ƒéƒ¨ç½²ï¼š

1. **å®¹å™¨åŒ–ä¼˜åŒ–**ï¼šä¼˜åŒ–çš„å®¹å™¨éƒ¨ç½²å’Œè¿è¡Œ
2. **Kubernetes é›†æˆ**ï¼šåŸç”Ÿ Kubernetes æ”¯æŒ
3. **è‡ªåŠ¨æ‰©ç¼©å®¹**ï¼šæ ¹æ®è´Ÿè½½è‡ªåŠ¨è°ƒæ•´èµ„æº
4. **å¤šç§Ÿæˆ·æ”¯æŒ**ï¼šæ›´å¥½çš„å¤šç§Ÿæˆ·éš”ç¦»å’Œç®¡ç†
5. **äº‘å­˜å‚¨é›†æˆ**ï¼šä¸äº‘å­˜å‚¨æœåŠ¡çš„æ·±åº¦é›†æˆ

**æœ€ä½³å®è·µ**ï¼š

- ä½¿ç”¨ Kubernetes Operator
- é…ç½®è‡ªåŠ¨æ‰©ç¼©å®¹
- å®æ–½å¤šç§Ÿæˆ·éš”ç¦»
- ä½¿ç”¨äº‘å­˜å‚¨å¤‡ä»½
- ç›‘æ§å’Œå‘Šè­¦

## ğŸ“š å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£

- [PostgreSQL 18 å®˜æ–¹æ–‡æ¡£ - äº‘åŸç”Ÿ](https://www.postgresql.org/docs/18/cloud-native.html)
- [PostgreSQL 18 å®˜æ–¹æ–‡æ¡£ - Kubernetes](https://www.postgresql.org/docs/18/kubernetes.html)
- [PostgreSQL 18 å®˜æ–¹æ–‡æ¡£ - Docker](https://www.postgresql.org/docs/18/docker.html)
- [PostgreSQL Operator](https://github.com/cloudnative-pg/cloudnative-pg) - CloudNativePG Operator

### æŠ€æœ¯è®ºæ–‡

- [Cloud-Native Database Architecture](https://www.vldb.org/pvldb/vol15/p2658-neumann.pdf) - äº‘åŸç”Ÿæ•°æ®åº“æ¶æ„ç ”ç©¶
- [Container Orchestration for Databases](https://www.postgresql.org/docs/current/kubernetes.html) - æ•°æ®åº“å®¹å™¨ç¼–æ’ç ”ç©¶

### æŠ€æœ¯åšå®¢

- [PostgreSQL 18 Cloud-Native Features](https://www.postgresql.org/about/news/postgresql-18-beta-1-released-2781/) - PostgreSQL 18 äº‘åŸç”Ÿç‰¹æ€§
- [Understanding PostgreSQL on Kubernetes](https://www.postgresql.org/docs/current/kubernetes.html) - Kubernetes ä¸Šçš„ PostgreSQL è¯¦è§£
- [PostgreSQL Cloud-Native Best Practices](https://www.postgresql.org/docs/current/cloud-native.html) - äº‘åŸç”Ÿæœ€ä½³å®è·µ

### ç¤¾åŒºèµ„æº

- [PostgreSQL Wiki - Kubernetes](https://wiki.postgresql.org/wiki/Kubernetes) - PostgreSQL Kubernetes ç›¸å…³ Wiki
- [PostgreSQL Mailing Lists](https://www.postgresql.org/list/) - PostgreSQL é‚®ä»¶åˆ—è¡¨è®¨è®º
- [Stack Overflow - PostgreSQL Kubernetes](https://stackoverflow.com/questions/tagged/postgresql+kubernetes) - Stack Overflow ç›¸å…³é—®é¢˜

---

**æœ€åæ›´æ–°**: 2025 å¹´ 1 æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 03-03-18-16
