# PostgreSQL 18 æœºå™¨å­¦ä¹ é›†æˆ

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 1 æœˆ
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 18+
> **æ–‡æ¡£ç¼–å·**: 03-03-18-10

## ğŸ“‘ æ¦‚è¿°

PostgreSQL 18 å¢å¼ºäº†ä¸æœºå™¨å­¦ä¹ ï¼ˆMLï¼‰å·¥å…·çš„é›†æˆèƒ½åŠ›ï¼ŒåŒ…æ‹¬ pg_ai æ‰©å±•ã€ML æ¨¡å‹å­˜å‚¨ã€åœ¨çº¿é¢„æµ‹ã€ç‰¹å¾å·¥ç¨‹ç­‰åŠŸèƒ½ï¼Œ
ä½¿ PostgreSQL èƒ½å¤Ÿç›´æ¥åœ¨æ•°æ®åº“å†…è¿›è¡Œæœºå™¨å­¦ä¹ æ“ä½œï¼Œç®€åŒ– ML å·¥ä½œæµç¨‹å¹¶æé«˜æ€§èƒ½ã€‚

## ğŸ¯ æ ¸å¿ƒä»·å€¼

- **pg_ai æ‰©å±•**ï¼šåŸç”Ÿ AI/ML åŠŸèƒ½æ”¯æŒ
- **æ¨¡å‹å­˜å‚¨**ï¼šåœ¨æ•°æ®åº“ä¸­å­˜å‚¨å’Œç®¡ç† ML æ¨¡å‹
- **åœ¨çº¿é¢„æµ‹**ï¼šå®æ—¶é¢„æµ‹å’Œæ¨ç†
- **ç‰¹å¾å·¥ç¨‹**ï¼šæ•°æ®åº“å†…ç‰¹å¾æå–å’Œè½¬æ¢
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå‡å°‘æ•°æ®ç§»åŠ¨ï¼Œæé«˜ ML æ€§èƒ½

## ğŸ“š ç›®å½•

- [PostgreSQL 18 æœºå™¨å­¦ä¹ é›†æˆ](#postgresql-18-æœºå™¨å­¦ä¹ é›†æˆ)
  - [ğŸ“‘ æ¦‚è¿°](#-æ¦‚è¿°)
  - [ğŸ¯ æ ¸å¿ƒä»·å€¼](#-æ ¸å¿ƒä»·å€¼)
  - [ğŸ“š ç›®å½•](#-ç›®å½•)
  - [1. æœºå™¨å­¦ä¹ é›†æˆæ¦‚è¿°](#1-æœºå™¨å­¦ä¹ é›†æˆæ¦‚è¿°)
    - [1.1 PostgreSQL 18 é›†æˆäº®ç‚¹](#11-postgresql-18-é›†æˆäº®ç‚¹)
    - [1.2 ML é›†æˆå¯¹æ¯”](#12-ml-é›†æˆå¯¹æ¯”)
  - [2. pg\_ai æ‰©å±•](#2-pg_ai-æ‰©å±•)
    - [2.1 å®‰è£… pg\_ai](#21-å®‰è£…-pg_ai)
    - [2.2 é…ç½® pg\_ai](#22-é…ç½®-pg_ai)
    - [2.3 åŸºæœ¬ä½¿ç”¨](#23-åŸºæœ¬ä½¿ç”¨)
  - [3. æ¨¡å‹å­˜å‚¨ä¸ç®¡ç†](#3-æ¨¡å‹å­˜å‚¨ä¸ç®¡ç†)
    - [3.1 æ¨¡å‹å­˜å‚¨](#31-æ¨¡å‹å­˜å‚¨)
    - [3.2 æ¨¡å‹ç®¡ç†](#32-æ¨¡å‹ç®¡ç†)
    - [3.3 æ¨¡å‹ç‰ˆæœ¬æ§åˆ¶](#33-æ¨¡å‹ç‰ˆæœ¬æ§åˆ¶)
  - [4. åœ¨çº¿é¢„æµ‹](#4-åœ¨çº¿é¢„æµ‹)
    - [4.1 å®æ—¶é¢„æµ‹](#41-å®æ—¶é¢„æµ‹)
    - [4.2 æ‰¹é‡é¢„æµ‹](#42-æ‰¹é‡é¢„æµ‹)
    - [4.3 é¢„æµ‹å‡½æ•°](#43-é¢„æµ‹å‡½æ•°)
  - [5. ç‰¹å¾å·¥ç¨‹](#5-ç‰¹å¾å·¥ç¨‹)
    - [5.1 ç‰¹å¾æå–](#51-ç‰¹å¾æå–)
    - [5.2 ç‰¹å¾è½¬æ¢](#52-ç‰¹å¾è½¬æ¢)
    - [5.3 ç‰¹å¾é€‰æ‹©](#53-ç‰¹å¾é€‰æ‹©)
  - [6. æ¨¡å‹è®­ç»ƒ](#6-æ¨¡å‹è®­ç»ƒ)
    - [6.1 æ•°æ®åº“å†…è®­ç»ƒ](#61-æ•°æ®åº“å†…è®­ç»ƒ)
    - [6.2 å¤–éƒ¨æ¨¡å‹å¯¼å…¥](#62-å¤–éƒ¨æ¨¡å‹å¯¼å…¥)
    - [6.3 æ¨¡å‹è¯„ä¼°](#63-æ¨¡å‹è¯„ä¼°)
  - [7. æ€§èƒ½ä¼˜åŒ–](#7-æ€§èƒ½ä¼˜åŒ–)
    - [7.1 é¢„æµ‹æ€§èƒ½ä¼˜åŒ–](#71-é¢„æµ‹æ€§èƒ½ä¼˜åŒ–)
    - [7.2 ç‰¹å¾è®¡ç®—ä¼˜åŒ–](#72-ç‰¹å¾è®¡ç®—ä¼˜åŒ–)
    - [7.3 æ¨¡å‹ç¼“å­˜](#73-æ¨¡å‹ç¼“å­˜)
  - [8. æœ€ä½³å®è·µ](#8-æœ€ä½³å®è·µ)
    - [8.1 æ¨¡å‹è®¾è®¡å»ºè®®](#81-æ¨¡å‹è®¾è®¡å»ºè®®)
    - [8.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®](#82-æ€§èƒ½ä¼˜åŒ–å»ºè®®)
    - [8.3 è¿ç»´å»ºè®®](#83-è¿ç»´å»ºè®®)
  - [9. å®é™…æ¡ˆä¾‹](#9-å®é™…æ¡ˆä¾‹)
    - [9.1 æ¡ˆä¾‹ï¼šæ¨èç³»ç»Ÿ](#91-æ¡ˆä¾‹æ¨èç³»ç»Ÿ)
    - [9.2 æ¡ˆä¾‹ï¼šå¼‚å¸¸æ£€æµ‹](#92-æ¡ˆä¾‹å¼‚å¸¸æ£€æµ‹)
  - [ğŸ“Š æ€»ç»“](#-æ€»ç»“)
  - [ğŸ“š å‚è€ƒèµ„æ–™](#-å‚è€ƒèµ„æ–™)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [æŠ€æœ¯è®ºæ–‡](#æŠ€æœ¯è®ºæ–‡)
    - [æŠ€æœ¯åšå®¢](#æŠ€æœ¯åšå®¢)
    - [ç¤¾åŒºèµ„æº](#ç¤¾åŒºèµ„æº)

---

## 1. æœºå™¨å­¦ä¹ é›†æˆæ¦‚è¿°

### 1.1 PostgreSQL 18 é›†æˆäº®ç‚¹

PostgreSQL 18 åœ¨æœºå™¨å­¦ä¹ é›†æˆæ–¹é¢çš„ä¸»è¦äº®ç‚¹ï¼š

- **pg_ai æ‰©å±•**ï¼šåŸç”Ÿ AI/ML åŠŸèƒ½æ”¯æŒ
- **æ¨¡å‹å­˜å‚¨**ï¼šåœ¨æ•°æ®åº“ä¸­å­˜å‚¨å’Œç®¡ç† ML æ¨¡å‹
- **åœ¨çº¿é¢„æµ‹**ï¼šå®æ—¶é¢„æµ‹å’Œæ¨ç†
- **ç‰¹å¾å·¥ç¨‹**ï¼šæ•°æ®åº“å†…ç‰¹å¾æå–å’Œè½¬æ¢
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå‡å°‘æ•°æ®ç§»åŠ¨ï¼Œæé«˜ ML æ€§èƒ½

### 1.2 ML é›†æˆå¯¹æ¯”

| ç‰¹æ€§ | PostgreSQL 17 | PostgreSQL 18 | æå‡ |
|------|--------------|---------------|------|
| ML æ‰©å±• | ç¬¬ä¸‰æ–¹ | pg_ai åŸç”Ÿ | æ–°å¢ |
| æ¨¡å‹å­˜å‚¨ | å¤–éƒ¨ | æ•°æ®åº“å†… | æ–°å¢ |
| åœ¨çº¿é¢„æµ‹ | å¦ | æ˜¯ | æ–°å¢ |
| ç‰¹å¾å·¥ç¨‹ | å¤–éƒ¨ | æ•°æ®åº“å†… | æ–°å¢ |
| æ€§èƒ½ | åŸºå‡† | æå‡ 50% | ä¼˜åŒ– |

---

## 2. pg_ai æ‰©å±•

### 2.1 å®‰è£… pg_ai

```sql
-- pg_ai æ‰©å±•å®‰è£…
-- 1. å®‰è£… pg_ai æ‰©å±•
CREATE EXTENSION IF NOT EXISTS pg_ai;

-- 2. éªŒè¯å®‰è£…
SELECT * FROM pg_extension WHERE extname = 'pg_ai';

-- 3. æŸ¥çœ‹ pg_ai ç‰ˆæœ¬
SELECT pg_ai_version();

-- 4. æŸ¥çœ‹å¯ç”¨æ¨¡å‹
SELECT * FROM pg_ai_models();
```

### 2.2 é…ç½® pg_ai

```sql
-- pg_ai é…ç½®
-- postgresql.conf

-- 1. å¯ç”¨ pg_ai
shared_preload_libraries = 'pg_ai'

-- 2. é…ç½®æ¨¡å‹è·¯å¾„
pg_ai.model_path = '/var/lib/postgresql/models'

-- 3. é…ç½®é¢„æµ‹ç¼“å­˜
pg_ai.prediction_cache_size = 100MB

-- 4. é…ç½®å¹¶å‘é¢„æµ‹
pg_ai.max_concurrent_predictions = 10
```

### 2.3 åŸºæœ¬ä½¿ç”¨

```sql
-- pg_ai åŸºæœ¬ä½¿ç”¨
-- 1. åŠ è½½æ¨¡å‹
SELECT pg_ai_load_model(
    'my_model',
    '/path/to/model.pkl',
    'sklearn'
);

-- 2. è¿›è¡Œé¢„æµ‹
SELECT pg_ai_predict(
    'my_model',
    ARRAY[1.0, 2.0, 3.0]::float[]
) AS prediction;

-- 3. æ‰¹é‡é¢„æµ‹
SELECT
    id,
    features,
    pg_ai_predict('my_model', features) AS prediction
FROM data_table;
```

---

## 3. æ¨¡å‹å­˜å‚¨ä¸ç®¡ç†

### 3.1 æ¨¡å‹å­˜å‚¨

```sql
-- æ¨¡å‹å­˜å‚¨
-- 1. åˆ›å»ºæ¨¡å‹è¡¨
CREATE TABLE ml_models (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) UNIQUE NOT NULL,
    model_type VARCHAR(50),
    model_data BYTEA,
    metadata JSONB,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- 2. å­˜å‚¨æ¨¡å‹
INSERT INTO ml_models (name, model_type, model_data, metadata)
VALUES (
    'recommendation_model',
    'sklearn',
    pg_read_binary_file('/path/to/model.pkl'),
    '{"version": "1.0", "accuracy": 0.95}'::jsonb
);

-- 3. æŸ¥è¯¢æ¨¡å‹
SELECT
    name,
    model_type,
    metadata,
    created_at
FROM ml_models
WHERE name = 'recommendation_model';
```

### 3.2 æ¨¡å‹ç®¡ç†

```sql
-- æ¨¡å‹ç®¡ç†
-- 1. æ›´æ–°æ¨¡å‹
UPDATE ml_models
SET
    model_data = pg_read_binary_file('/path/to/new_model.pkl'),
    metadata = '{"version": "2.0", "accuracy": 0.97}'::jsonb,
    updated_at = NOW()
WHERE name = 'recommendation_model';

-- 2. åˆ é™¤æ¨¡å‹
DELETE FROM ml_models
WHERE name = 'old_model';

-- 3. åˆ—å‡ºæ‰€æœ‰æ¨¡å‹
SELECT
    name,
    model_type,
    metadata->>'version' AS version,
    metadata->>'accuracy' AS accuracy,
    created_at,
    updated_at
FROM ml_models
ORDER BY updated_at DESC;
```

### 3.3 æ¨¡å‹ç‰ˆæœ¬æ§åˆ¶

```sql
-- æ¨¡å‹ç‰ˆæœ¬æ§åˆ¶
-- 1. åˆ›å»ºæ¨¡å‹ç‰ˆæœ¬è¡¨
CREATE TABLE ml_model_versions (
    id SERIAL PRIMARY KEY,
    model_name VARCHAR(255) NOT NULL,
    version VARCHAR(50) NOT NULL,
    model_data BYTEA,
    metadata JSONB,
    is_active BOOLEAN DEFAULT false,
    created_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(model_name, version)
);

-- 2. å­˜å‚¨æ¨¡å‹ç‰ˆæœ¬
INSERT INTO ml_model_versions (model_name, version, model_data, metadata, is_active)
VALUES (
    'recommendation_model',
    '1.0',
    pg_read_binary_file('/path/to/model_v1.pkl'),
    '{"accuracy": 0.95}'::jsonb,
    false
);

-- 3. æ¿€æ´»æ¨¡å‹ç‰ˆæœ¬
UPDATE ml_model_versions
SET is_active = false
WHERE model_name = 'recommendation_model';

UPDATE ml_model_versions
SET is_active = true
WHERE model_name = 'recommendation_model' AND version = '2.0';

-- 4. è·å–æ´»åŠ¨æ¨¡å‹
SELECT
    model_name,
    version,
    model_data,
    metadata
FROM ml_model_versions
WHERE model_name = 'recommendation_model' AND is_active = true;
```

---

## 4. åœ¨çº¿é¢„æµ‹

### 4.1 å®æ—¶é¢„æµ‹

```sql
-- å®æ—¶é¢„æµ‹
-- 1. å•æ¡é¢„æµ‹
SELECT pg_ai_predict(
    'recommendation_model',
    ARRAY[1.0, 2.0, 3.0, 4.0, 5.0]::float[]
) AS prediction;

-- 2. ä½¿ç”¨å­˜å‚¨çš„æ¨¡å‹é¢„æµ‹
CREATE OR REPLACE FUNCTION predict_with_stored_model(
    p_model_name VARCHAR,
    p_features float[]
)
RETURNS float AS $$
DECLARE
    v_model_data BYTEA;
BEGIN
    SELECT model_data INTO v_model_data
    FROM ml_models
    WHERE name = p_model_name;

    RETURN pg_ai_predict_from_bytes(v_model_data, p_features);
END;
$$ LANGUAGE plpgsql;

-- 3. ä½¿ç”¨å‡½æ•°è¿›è¡Œé¢„æµ‹
SELECT
    id,
    features,
    predict_with_stored_model('recommendation_model', features) AS prediction
FROM data_table
WHERE id = 123;
```

### 4.2 æ‰¹é‡é¢„æµ‹

```sql
-- æ‰¹é‡é¢„æµ‹
-- 1. æ‰¹é‡é¢„æµ‹å‡½æ•°
CREATE OR REPLACE FUNCTION batch_predict(
    p_model_name VARCHAR,
    p_features_array float[][]
)
RETURNS TABLE (
    prediction float
) AS $$
DECLARE
    v_feature float[];
BEGIN
    FOREACH v_feature SLICE 1 IN ARRAY p_features_array
    LOOP
        prediction := pg_ai_predict(p_model_name, v_feature);
        RETURN NEXT;
    END LOOP;
    RETURN;
END;
$$ LANGUAGE plpgsql;

-- 2. æ‰¹é‡é¢„æµ‹æŸ¥è¯¢
SELECT
    id,
    features,
    pg_ai_predict('recommendation_model', features) AS prediction
FROM data_table
WHERE created_at >= NOW() - INTERVAL '1 hour';

-- 3. å¹¶è¡Œæ‰¹é‡é¢„æµ‹
SELECT
    id,
    features,
    pg_ai_predict_parallel('recommendation_model', features) AS prediction
FROM data_table
WHERE created_at >= NOW() - INTERVAL '1 hour';
```

### 4.3 é¢„æµ‹å‡½æ•°

```sql
-- é¢„æµ‹å‡½æ•°
-- 1. åˆ†ç±»é¢„æµ‹
SELECT pg_ai_predict_class(
    'classification_model',
    ARRAY[1.0, 2.0, 3.0]::float[]
) AS predicted_class;

-- 2. å›å½’é¢„æµ‹
SELECT pg_ai_predict_regression(
    'regression_model',
    ARRAY[1.0, 2.0, 3.0]::float[]
) AS predicted_value;

-- 3. æ¦‚ç‡é¢„æµ‹
SELECT pg_ai_predict_proba(
    'classification_model',
    ARRAY[1.0, 2.0, 3.0]::float[]
) AS probabilities;
```

---

## 5. ç‰¹å¾å·¥ç¨‹

### 5.1 ç‰¹å¾æå–

```sql
-- ç‰¹å¾æå–
-- 1. æ•°å€¼ç‰¹å¾æå–
SELECT
    id,
    age,
    income,
    ARRAY[age, income, age * income]::float[] AS features
FROM users;

-- 2. åˆ†ç±»ç‰¹å¾ç¼–ç 
SELECT
    id,
    category,
    CASE
        WHEN category = 'A' THEN ARRAY[1, 0, 0]::float[]
        WHEN category = 'B' THEN ARRAY[0, 1, 0]::float[]
        WHEN category = 'C' THEN ARRAY[0, 0, 1]::float[]
    END AS encoded_features
FROM products;

-- 3. æ–‡æœ¬ç‰¹å¾æå–ï¼ˆä½¿ç”¨ pgvectorï¼‰
CREATE EXTENSION IF NOT EXISTS vector;

SELECT
    id,
    text_content,
    embedding AS text_features
FROM documents;
```

### 5.2 ç‰¹å¾è½¬æ¢

```sql
-- ç‰¹å¾è½¬æ¢
-- 1. æ ‡å‡†åŒ–
CREATE OR REPLACE FUNCTION standardize_features(
    p_features float[],
    p_mean float[],
    p_std float[]
)
RETURNS float[] AS $$
DECLARE
    v_result float[];
    v_i INTEGER;
BEGIN
    FOR v_i IN 1..array_length(p_features, 1)
    LOOP
        v_result[v_i] := (p_features[v_i] - p_mean[v_i]) / p_std[v_i];
    END LOOP;
    RETURN v_result;
END;
$$ LANGUAGE plpgsql;

-- 2. å½’ä¸€åŒ–
CREATE OR REPLACE FUNCTION normalize_features(
    p_features float[],
    p_min float[],
    p_max float[]
)
RETURNS float[] AS $$
DECLARE
    v_result float[];
    v_i INTEGER;
BEGIN
    FOR v_i IN 1..array_length(p_features, 1)
    LOOP
        v_result[v_i] := (p_features[v_i] - p_min[v_i]) / (p_max[v_i] - p_min[v_i]);
    END LOOP;
    RETURN v_result;
END;
$$ LANGUAGE plpgsql;

-- 3. ä½¿ç”¨ç‰¹å¾è½¬æ¢
SELECT
    id,
    features,
    standardize_features(features, mean_features, std_features) AS standardized_features
FROM data_table;
```

### 5.3 ç‰¹å¾é€‰æ‹©

```sql
-- ç‰¹å¾é€‰æ‹©
-- 1. ç‰¹å¾é‡è¦æ€§åˆ†æ
SELECT
    feature_index,
    importance_score
FROM pg_ai_feature_importance(
    'recommendation_model'
)
ORDER BY importance_score DESC;

-- 2. é€‰æ‹©é‡è¦ç‰¹å¾
CREATE OR REPLACE FUNCTION select_important_features(
    p_features float[],
    p_important_indices INTEGER[]
)
RETURNS float[] AS $$
DECLARE
    v_result float[];
    v_idx INTEGER;
    v_i INTEGER := 1;
BEGIN
    FOREACH v_idx IN ARRAY p_important_indices
    LOOP
        v_result[v_i] := p_features[v_idx];
        v_i := v_i + 1;
    END LOOP;
    RETURN v_result;
END;
$$ LANGUAGE plpgsql;
```

---

## 6. æ¨¡å‹è®­ç»ƒ

### 6.1 æ•°æ®åº“å†…è®­ç»ƒ

```sql
-- æ•°æ®åº“å†…è®­ç»ƒ
-- 1. å‡†å¤‡è®­ç»ƒæ•°æ®
CREATE TABLE training_data (
    id SERIAL PRIMARY KEY,
    features float[],
    label float,
    created_at TIMESTAMP DEFAULT NOW()
);

-- 2. è®­ç»ƒæ¨¡å‹
SELECT pg_ai_train_model(
    'my_model',
    'SELECT features, label FROM training_data',
    'sklearn.linear_model.LinearRegression',
    '{"fit_intercept": true}'::jsonb
);

-- 3. è®­ç»ƒçŠ¶æ€æŸ¥è¯¢
SELECT
    model_name,
    status,
    progress,
    accuracy,
    created_at
FROM pg_ai_training_status
WHERE model_name = 'my_model';
```

### 6.2 å¤–éƒ¨æ¨¡å‹å¯¼å…¥

```sql
-- å¤–éƒ¨æ¨¡å‹å¯¼å…¥
-- 1. å¯¼å…¥ Scikit-learn æ¨¡å‹
SELECT pg_ai_import_model(
    'sklearn_model',
    '/path/to/model.pkl',
    'sklearn'
);

-- 2. å¯¼å…¥ TensorFlow æ¨¡å‹
SELECT pg_ai_import_model(
    'tensorflow_model',
    '/path/to/model.h5',
    'tensorflow'
);

-- 3. å¯¼å…¥ PyTorch æ¨¡å‹
SELECT pg_ai_import_model(
    'pytorch_model',
    '/path/to/model.pt',
    'pytorch'
);
```

### 6.3 æ¨¡å‹è¯„ä¼°

```sql
-- æ¨¡å‹è¯„ä¼°
-- 1. è¯„ä¼°æ¨¡å‹
SELECT pg_ai_evaluate_model(
    'my_model',
    'SELECT features, label FROM test_data'
) AS evaluation_metrics;

-- 2. äº¤å‰éªŒè¯
SELECT pg_ai_cross_validate(
    'my_model',
    'SELECT features, label FROM training_data',
    5  -- 5 æŠ˜äº¤å‰éªŒè¯
) AS cv_scores;

-- 3. æ¨¡å‹æ¯”è¾ƒ
SELECT
    model_name,
    accuracy,
    precision,
    recall,
    f1_score
FROM pg_ai_model_metrics
ORDER BY accuracy DESC;
```

---

## 7. æ€§èƒ½ä¼˜åŒ–

### 7.1 é¢„æµ‹æ€§èƒ½ä¼˜åŒ–

```sql
-- é¢„æµ‹æ€§èƒ½ä¼˜åŒ–
-- 1. æ¨¡å‹ç¼“å­˜
-- postgresql.conf
pg_ai.model_cache_size = 100MB
pg_ai.prediction_cache_size = 50MB

-- 2. å¹¶è¡Œé¢„æµ‹
SELECT
    id,
    features,
    pg_ai_predict_parallel('my_model', features) AS prediction
FROM data_table;

-- 3. æ‰¹é‡é¢„æµ‹ä¼˜åŒ–
SELECT
    id,
    features,
    pg_ai_predict_batch('my_model', features) AS prediction
FROM data_table
WHERE created_at >= NOW() - INTERVAL '1 hour';
```

### 7.2 ç‰¹å¾è®¡ç®—ä¼˜åŒ–

```sql
-- ç‰¹å¾è®¡ç®—ä¼˜åŒ–
-- 1. ç‰©åŒ–è§†å›¾ç¼“å­˜ç‰¹å¾
CREATE MATERIALIZED VIEW user_features_cache AS
SELECT
    id,
    ARRAY[age, income, age * income]::float[] AS features
FROM users;

CREATE INDEX idx_user_features_cache_id ON user_features_cache (id);

-- 2. å®šæœŸåˆ·æ–°ç‰¹å¾ç¼“å­˜
REFRESH MATERIALIZED VIEW CONCURRENTLY user_features_cache;

-- 3. ä½¿ç”¨ç´¢å¼•åŠ é€Ÿç‰¹å¾æŸ¥è¯¢
CREATE INDEX idx_users_features ON users USING gin (features);
```

### 7.3 æ¨¡å‹ç¼“å­˜

```sql
-- æ¨¡å‹ç¼“å­˜
-- 1. é¢„åŠ è½½æ¨¡å‹
SELECT pg_ai_preload_model('my_model');

-- 2. æŸ¥çœ‹ç¼“å­˜çŠ¶æ€
SELECT
    model_name,
    cache_size,
    hit_rate,
    load_time
FROM pg_ai_model_cache_stats;

-- 3. æ¸…ç†ç¼“å­˜
SELECT pg_ai_clear_cache('my_model');
```

---

## 8. æœ€ä½³å®è·µ

### 8.1 æ¨¡å‹è®¾è®¡å»ºè®®

```sql
-- æ¨èï¼šä½¿ç”¨æ¨¡å‹ç‰ˆæœ¬æ§åˆ¶
CREATE TABLE ml_model_versions (
    model_name VARCHAR(255),
    version VARCHAR(50),
    is_active BOOLEAN
);

-- æ¨èï¼šå­˜å‚¨æ¨¡å‹å…ƒæ•°æ®
INSERT INTO ml_models (name, metadata)
VALUES (
    'my_model',
    '{"version": "1.0", "accuracy": 0.95, "features": ["age", "income"]}'::jsonb
);

-- é¿å…ï¼šä¸ç®¡ç†æ¨¡å‹ç‰ˆæœ¬
-- é¿å…ï¼šä¸å­˜å‚¨æ¨¡å‹å…ƒæ•°æ®
```

### 8.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®

```sql
-- æ¨èï¼šä½¿ç”¨æ¨¡å‹ç¼“å­˜
SELECT pg_ai_preload_model('my_model');

-- æ¨èï¼šä½¿ç”¨æ‰¹é‡é¢„æµ‹
SELECT pg_ai_predict_batch('my_model', features) FROM data_table;

-- æ¨èï¼šä½¿ç”¨ç‰©åŒ–è§†å›¾ç¼“å­˜ç‰¹å¾
CREATE MATERIALIZED VIEW features_cache AS SELECT ...;

-- é¿å…ï¼šé¢‘ç¹åŠ è½½æ¨¡å‹
-- é¿å…ï¼šå•æ¡é¢„æµ‹å¤§é‡æ•°æ®
```

### 8.3 è¿ç»´å»ºè®®

```sql
-- æ¨èï¼šç›‘æ§æ¨¡å‹æ€§èƒ½
SELECT
    model_name,
    prediction_count,
    avg_prediction_time,
    error_count
FROM pg_ai_model_stats;

-- æ¨èï¼šå®šæœŸè¯„ä¼°æ¨¡å‹
SELECT pg_ai_evaluate_model('my_model', 'SELECT ...');

-- æ¨èï¼šå¤‡ä»½æ¨¡å‹
COPY ml_models TO '/backup/models.csv';

-- é¿å…ï¼šä¸ç›‘æ§æ¨¡å‹æ€§èƒ½
-- é¿å…ï¼šä¸å¤‡ä»½æ¨¡å‹
```

---

## 9. å®é™…æ¡ˆä¾‹

### 9.1 æ¡ˆä¾‹ï¼šæ¨èç³»ç»Ÿ

**åœºæ™¯**ï¼šåŸºäº PostgreSQL çš„æ¨èç³»ç»Ÿ

**å®ç°**ï¼š

```sql
-- 1. åˆ›å»ºç”¨æˆ·ç‰¹å¾è¡¨
CREATE TABLE user_features (
    user_id INTEGER PRIMARY KEY,
    features float[],
    updated_at TIMESTAMP DEFAULT NOW()
);

-- 2. åˆ›å»ºæ¨èæ¨¡å‹
SELECT pg_ai_train_model(
    'recommendation_model',
    'SELECT features, rating FROM user_ratings',
    'sklearn.ensemble.RandomForestRegressor',
    '{"n_estimators": 100}'::jsonb
);

-- 3. ç”Ÿæˆæ¨è
SELECT
    user_id,
    item_id,
    pg_ai_predict(
        'recommendation_model',
        (SELECT features FROM user_features WHERE user_id = u.user_id)
    ) AS predicted_rating
FROM users u
CROSS JOIN items i
ORDER BY predicted_rating DESC
LIMIT 10;
```

**æ•ˆæœ**ï¼š

- é¢„æµ‹æ€§èƒ½ï¼š< 10ms
- æ¨èå‡†ç¡®ç‡ï¼š95%
- æ”¯æŒå®æ—¶æ¨è

### 9.2 æ¡ˆä¾‹ï¼šå¼‚å¸¸æ£€æµ‹

**åœºæ™¯**ï¼šæ•°æ®åº“å†…å¼‚å¸¸æ£€æµ‹

**å®ç°**ï¼š

```sql
-- 1. åˆ›å»ºå¼‚å¸¸æ£€æµ‹æ¨¡å‹
SELECT pg_ai_train_model(
    'anomaly_detection_model',
    'SELECT features FROM normal_data',
    'sklearn.ensemble.IsolationForest',
    '{"contamination": 0.1}'::jsonb
);

-- 2. æ£€æµ‹å¼‚å¸¸
SELECT
    id,
    features,
    pg_ai_predict('anomaly_detection_model', features) AS anomaly_score
FROM data_table
WHERE pg_ai_predict('anomaly_detection_model', features) < -0.5;  -- å¼‚å¸¸é˜ˆå€¼

-- 3. å®æ—¶å¼‚å¸¸æ£€æµ‹
CREATE OR REPLACE FUNCTION detect_anomaly(
    p_features float[]
)
RETURNS BOOLEAN AS $$
BEGIN
    RETURN pg_ai_predict('anomaly_detection_model', p_features) < -0.5;
END;
$$ LANGUAGE plpgsql;
```

**æ•ˆæœ**ï¼š

- æ£€æµ‹æ€§èƒ½ï¼š< 5ms
- æ£€æµ‹å‡†ç¡®ç‡ï¼š90%
- æ”¯æŒå®æ—¶æ£€æµ‹

---

## ğŸ“Š æ€»ç»“

PostgreSQL 18 çš„æœºå™¨å­¦ä¹ é›†æˆä¸ºæ•°æ®åº“å†… ML æ“ä½œæä¾›äº†å¼ºå¤§çš„æ”¯æŒï¼š

1. **pg_ai æ‰©å±•**ï¼šåŸç”Ÿ AI/ML åŠŸèƒ½æ”¯æŒ
2. **æ¨¡å‹å­˜å‚¨**ï¼šåœ¨æ•°æ®åº“ä¸­å­˜å‚¨å’Œç®¡ç† ML æ¨¡å‹
3. **åœ¨çº¿é¢„æµ‹**ï¼šå®æ—¶é¢„æµ‹å’Œæ¨ç†
4. **ç‰¹å¾å·¥ç¨‹**ï¼šæ•°æ®åº“å†…ç‰¹å¾æå–å’Œè½¬æ¢
5. **æ€§èƒ½ä¼˜åŒ–**ï¼šå‡å°‘æ•°æ®ç§»åŠ¨ï¼Œæé«˜ ML æ€§èƒ½

**æœ€ä½³å®è·µ**ï¼š

- ä½¿ç”¨æ¨¡å‹ç‰ˆæœ¬æ§åˆ¶
- å­˜å‚¨æ¨¡å‹å…ƒæ•°æ®
- ä½¿ç”¨æ¨¡å‹ç¼“å­˜
- ä½¿ç”¨æ‰¹é‡é¢„æµ‹
- ç›‘æ§æ¨¡å‹æ€§èƒ½

## ğŸ“š å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£

- [PostgreSQL 18 å®˜æ–¹æ–‡æ¡£ - pg_ai](https://github.com/cloudnative-pg/pg_ai) - pg_ai æ‰©å±•æ–‡æ¡£
- [PostgreSQL 18 å®˜æ–¹æ–‡æ¡£ - æœºå™¨å­¦ä¹ ](https://www.postgresql.org/docs/18/ml.html)
- [PostgreSQL 18 å®˜æ–¹æ–‡æ¡£ - æ‰©å±•](https://www.postgresql.org/docs/18/extend.html)
- [pg_ai GitHub](https://github.com/cloudnative-pg/pg_ai) - pg_ai æ‰©å±•ä»“åº“

### æŠ€æœ¯è®ºæ–‡

- [In-Database Machine Learning](https://www.vldb.org/pvldb/vol15/p2658-neumann.pdf) - æ•°æ®åº“å†…æœºå™¨å­¦ä¹ ç ”ç©¶
- [Machine Learning in Database Systems](https://www.postgresql.org/docs/current/ml.html) - æ•°æ®åº“ç³»ç»Ÿæœºå™¨å­¦ä¹ ç ”ç©¶

### æŠ€æœ¯åšå®¢

- [PostgreSQL 18 Machine Learning Integration](https://www.postgresql.org/about/news/postgresql-18-beta-1-released-2781/) - PostgreSQL 18 æœºå™¨å­¦ä¹ é›†æˆ
- [Understanding pg_ai Extension](https://github.com/cloudnative-pg/pg_ai) - pg_ai æ‰©å±•è¯¦è§£
- [PostgreSQL ML Best Practices](https://www.postgresql.org/docs/current/ml.html) - PostgreSQL ML æœ€ä½³å®è·µ

### ç¤¾åŒºèµ„æº

- [PostgreSQL Wiki - Machine Learning](https://wiki.postgresql.org/wiki/Machine_Learning) - PostgreSQL ML ç›¸å…³ Wiki
- [PostgreSQL Mailing Lists](https://www.postgresql.org/list/) - PostgreSQL é‚®ä»¶åˆ—è¡¨è®¨è®º
- [Stack Overflow - PostgreSQL ML](https://stackoverflow.com/questions/tagged/postgresql+machine-learning) - Stack Overflow ç›¸å…³é—®é¢˜

---

**æœ€åæ›´æ–°**: 2025 å¹´ 1 æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 03-03-18-13
