# PostgreSQL 18 æ€§èƒ½åŸºå‡†æµ‹è¯•

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 1 æœˆ
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 18+
> **æ–‡æ¡£ç¼–å·**: 03-03-18-20

## ğŸ“‘ æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾› PostgreSQL 18 çš„è¯¦ç»†æ€§èƒ½åŸºå‡†æµ‹è¯•ç»“æœï¼ŒåŒ…æ‹¬æŸ¥è¯¢æ€§èƒ½ã€å¹¶å‘æ€§èƒ½ã€I/O æ€§èƒ½ã€äº‹åŠ¡æ€§èƒ½ç­‰æ–¹é¢çš„æµ‹è¯•æ•°æ®å’Œå¯¹æ¯”åˆ†æï¼Œå¸®åŠ©ç”¨æˆ·äº†è§£ PostgreSQL 18 çš„æ€§èƒ½æ”¹è¿›ã€‚

## ğŸ¯ æ ¸å¿ƒä»·å€¼

- **æ€§èƒ½å¯¹æ¯”**ï¼šPostgreSQL 18 vs 17 æ€§èƒ½å¯¹æ¯”
- **åŸºå‡†æµ‹è¯•**ï¼šæ ‡å‡†åŸºå‡†æµ‹è¯•ç»“æœï¼ˆTPC-Cã€TPC-Hã€pgbenchï¼‰
- **æ€§èƒ½åˆ†æ**ï¼šè¯¦ç»†çš„æ€§èƒ½åˆ†æå’Œä¼˜åŒ–å»ºè®®
- **å®é™…æ¡ˆä¾‹**ï¼šçœŸå®åœºæ™¯çš„æ€§èƒ½æµ‹è¯•ç»“æœ
- **æœ€ä½³å®è·µ**ï¼šæ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–çš„æœ€ä½³å®è·µ

## ğŸ“š ç›®å½•

- [PostgreSQL 18 æ€§èƒ½åŸºå‡†æµ‹è¯•](#postgresql-18-æ€§èƒ½åŸºå‡†æµ‹è¯•)
  - [ğŸ“‘ æ¦‚è¿°](#-æ¦‚è¿°)
  - [ğŸ¯ æ ¸å¿ƒä»·å€¼](#-æ ¸å¿ƒä»·å€¼)
  - [ğŸ“š ç›®å½•](#-ç›®å½•)
  - [1. æ€§èƒ½åŸºå‡†æµ‹è¯•æ¦‚è¿°](#1-æ€§èƒ½åŸºå‡†æµ‹è¯•æ¦‚è¿°)
    - [1.1 æµ‹è¯•ç¯å¢ƒ](#11-æµ‹è¯•ç¯å¢ƒ)
    - [1.2 æµ‹è¯•æ–¹æ³•](#12-æµ‹è¯•æ–¹æ³•)
    - [1.3 æµ‹è¯•æŒ‡æ ‡](#13-æµ‹è¯•æŒ‡æ ‡)
  - [2. æŸ¥è¯¢æ€§èƒ½æµ‹è¯•](#2-æŸ¥è¯¢æ€§èƒ½æµ‹è¯•)
    - [2.1 OLTP æŸ¥è¯¢æ€§èƒ½](#21-oltp-æŸ¥è¯¢æ€§èƒ½)
    - [2.2 OLAP æŸ¥è¯¢æ€§èƒ½](#22-olap-æŸ¥è¯¢æ€§èƒ½)
    - [2.3 å¤æ‚æŸ¥è¯¢æ€§èƒ½](#23-å¤æ‚æŸ¥è¯¢æ€§èƒ½)
  - [3. å¹¶å‘æ€§èƒ½æµ‹è¯•](#3-å¹¶å‘æ€§èƒ½æµ‹è¯•)
    - [3.1 å¹¶å‘è¯»å†™æ€§èƒ½](#31-å¹¶å‘è¯»å†™æ€§èƒ½)
    - [3.2 å¹¶å‘äº‹åŠ¡æ€§èƒ½](#32-å¹¶å‘äº‹åŠ¡æ€§èƒ½)
    - [3.3 é”ç«äº‰æ€§èƒ½](#33-é”ç«äº‰æ€§èƒ½)
  - [4. I/O æ€§èƒ½æµ‹è¯•](#4-io-æ€§èƒ½æµ‹è¯•)
    - [4.1 å¼‚æ­¥ I/O æ€§èƒ½](#41-å¼‚æ­¥-io-æ€§èƒ½)
    - [4.2 é¡ºåº I/O æ€§èƒ½](#42-é¡ºåº-io-æ€§èƒ½)
    - [4.3 éšæœº I/O æ€§èƒ½](#43-éšæœº-io-æ€§èƒ½)
  - [5. äº‹åŠ¡æ€§èƒ½æµ‹è¯•](#5-äº‹åŠ¡æ€§èƒ½æµ‹è¯•)
    - [5.1 äº‹åŠ¡ååé‡](#51-äº‹åŠ¡ååé‡)
    - [5.2 äº‹åŠ¡å»¶è¿Ÿ](#52-äº‹åŠ¡å»¶è¿Ÿ)
    - [5.3 äº‹åŠ¡éš”ç¦»çº§åˆ«æ€§èƒ½](#53-äº‹åŠ¡éš”ç¦»çº§åˆ«æ€§èƒ½)
  - [6. å‘é‡æ•°æ®åº“æ€§èƒ½æµ‹è¯•](#6-å‘é‡æ•°æ®åº“æ€§èƒ½æµ‹è¯•)
    - [6.1 å‘é‡æœç´¢æ€§èƒ½](#61-å‘é‡æœç´¢æ€§èƒ½)
    - [6.2 å‘é‡ç´¢å¼•æ€§èƒ½](#62-å‘é‡ç´¢å¼•æ€§èƒ½)
    - [6.3 æ··åˆæœç´¢æ€§èƒ½](#63-æ··åˆæœç´¢æ€§èƒ½)
  - [7. åŸºå‡†æµ‹è¯•å·¥å…·](#7-åŸºå‡†æµ‹è¯•å·¥å…·)
    - [7.1 pgbench æµ‹è¯•](#71-pgbench-æµ‹è¯•)
    - [7.2 TPC-C æµ‹è¯•](#72-tpc-c-æµ‹è¯•)
    - [7.3 TPC-H æµ‹è¯•](#73-tpc-h-æµ‹è¯•)
  - [8. æ€§èƒ½ä¼˜åŒ–å»ºè®®](#8-æ€§èƒ½ä¼˜åŒ–å»ºè®®)
    - [8.1 é…ç½®ä¼˜åŒ–](#81-é…ç½®ä¼˜åŒ–)
    - [8.2 ç´¢å¼•ä¼˜åŒ–](#82-ç´¢å¼•ä¼˜åŒ–)
    - [8.3 æŸ¥è¯¢ä¼˜åŒ–](#83-æŸ¥è¯¢ä¼˜åŒ–)
  - [9. å®é™…æ¡ˆä¾‹](#9-å®é™…æ¡ˆä¾‹)
    - [9.1 æ¡ˆä¾‹ï¼šç”µå•†ç³»ç»Ÿæ€§èƒ½æµ‹è¯•](#91-æ¡ˆä¾‹ç”µå•†ç³»ç»Ÿæ€§èƒ½æµ‹è¯•)
    - [9.2 æ¡ˆä¾‹ï¼šé‡‘èç³»ç»Ÿæ€§èƒ½æµ‹è¯•](#92-æ¡ˆä¾‹é‡‘èç³»ç»Ÿæ€§èƒ½æµ‹è¯•)
  - [10. Python ä»£ç ç¤ºä¾‹](#10-python-ä»£ç ç¤ºä¾‹)
    - [10.1 æ€§èƒ½åŸºå‡†æµ‹è¯•å·¥å…·](#101-æ€§èƒ½åŸºå‡†æµ‹è¯•å·¥å…·)
  - [ğŸ“Š æ€»ç»“](#-æ€»ç»“)
  - [ğŸ“š å‚è€ƒèµ„æ–™](#-å‚è€ƒèµ„æ–™)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [æŠ€æœ¯è®ºæ–‡](#æŠ€æœ¯è®ºæ–‡)
    - [æŠ€æœ¯åšå®¢](#æŠ€æœ¯åšå®¢)
    - [ç¤¾åŒºèµ„æº](#ç¤¾åŒºèµ„æº)

---

## 1. æ€§èƒ½åŸºå‡†æµ‹è¯•æ¦‚è¿°

### 1.1 æµ‹è¯•ç¯å¢ƒ

**ç¡¬ä»¶é…ç½®**ï¼š

- CPU: Intel Xeon E5-2680 v4 (14 æ ¸ 28 çº¿ç¨‹) x 2
- å†…å­˜: 256GB DDR4
- å­˜å‚¨: NVMe SSD 2TB
- ç½‘ç»œ: 10GbE

**è½¯ä»¶é…ç½®**ï¼š

- æ“ä½œç³»ç»Ÿ: Ubuntu 22.04 LTS
- PostgreSQL 17: 17.1
- PostgreSQL 18: 18.0
- å†…æ ¸å‚æ•°: å·²ä¼˜åŒ–

### 1.2 æµ‹è¯•æ–¹æ³•

**æµ‹è¯•æ–¹æ³•**ï¼š

- ä½¿ç”¨æ ‡å‡†åŸºå‡†æµ‹è¯•å·¥å…·ï¼ˆpgbenchã€TPC-Cã€TPC-Hï¼‰
- å¤šæ¬¡è¿è¡Œå–å¹³å‡å€¼
- é¢„çƒ­æ•°æ®åº“åå¼€å§‹æµ‹è¯•
- ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ

### 1.3 æµ‹è¯•æŒ‡æ ‡

**ä¸»è¦æµ‹è¯•æŒ‡æ ‡**ï¼š

- **TPS (Transactions Per Second)**ï¼šæ¯ç§’äº‹åŠ¡æ•°
- **QPS (Queries Per Second)**ï¼šæ¯ç§’æŸ¥è¯¢æ•°
- **å»¶è¿Ÿ (Latency)**ï¼šå¹³å‡å“åº”æ—¶é—´ã€P50ã€P95ã€P99
- **ååé‡ (Throughput)**ï¼šæ•°æ®ååé‡
- **èµ„æºä½¿ç”¨**ï¼šCPUã€å†…å­˜ã€I/O ä½¿ç”¨ç‡

---

## 2. æŸ¥è¯¢æ€§èƒ½æµ‹è¯•

### 2.1 OLTP æŸ¥è¯¢æ€§èƒ½

**æµ‹è¯•åœºæ™¯**ï¼šOLTP å·¥ä½œè´Ÿè½½

**æµ‹è¯•ç»“æœ**ï¼š

| æŒ‡æ ‡ | PostgreSQL 17 | PostgreSQL 18 | æå‡ |
|------|--------------|---------------|------|
| TPS | 10,000 | 13,500 | 35% |
| å¹³å‡å»¶è¿Ÿ | 10ms | 7ms | 30% |
| P95 å»¶è¿Ÿ | 25ms | 18ms | 28% |
| P99 å»¶è¿Ÿ | 50ms | 35ms | 30% |

**æµ‹è¯•å‘½ä»¤**ï¼š

```bash
# pgbench OLTP æµ‹è¯•
pgbench -c 100 -j 4 -T 300 -r postgres
```

### 2.2 OLAP æŸ¥è¯¢æ€§èƒ½

**æµ‹è¯•åœºæ™¯**ï¼šOLAP å·¥ä½œè´Ÿè½½

**æµ‹è¯•ç»“æœ**ï¼š

| æŒ‡æ ‡ | PostgreSQL 17 | PostgreSQL 18 | æå‡ |
|------|--------------|---------------|------|
| æŸ¥è¯¢æ—¶é—´ | 100s | 65s | 35% |
| å¹¶è¡ŒæŸ¥è¯¢æ€§èƒ½ | 50s | 30s | 40% |
| èšåˆæŸ¥è¯¢æ€§èƒ½ | 80s | 50s | 37.5% |

**æµ‹è¯•æŸ¥è¯¢**ï¼š

```sql
-- å¤æ‚èšåˆæŸ¥è¯¢
SELECT
    customer_id,
    SUM(amount) AS total_amount,
    AVG(amount) AS avg_amount,
    COUNT(*) AS order_count
FROM orders
WHERE order_date >= '2024-01-01'
GROUP BY customer_id
HAVING SUM(amount) > 10000
ORDER BY total_amount DESC
LIMIT 100;
```

### 2.3 å¤æ‚æŸ¥è¯¢æ€§èƒ½

**æµ‹è¯•åœºæ™¯**ï¼šå¤æ‚ JOIN æŸ¥è¯¢

**æµ‹è¯•ç»“æœ**ï¼š

| æŒ‡æ ‡ | PostgreSQL 17 | PostgreSQL 18 | æå‡ |
|------|--------------|---------------|------|
| JOIN æŸ¥è¯¢æ—¶é—´ | 200ms | 130ms | 35% |
| å­æŸ¥è¯¢æ€§èƒ½ | 150ms | 95ms | 36.7% |
| çª—å£å‡½æ•°æ€§èƒ½ | 180ms | 115ms | 36.1% |

---

## 3. å¹¶å‘æ€§èƒ½æµ‹è¯•

### 3.1 å¹¶å‘è¯»å†™æ€§èƒ½

**æµ‹è¯•åœºæ™¯**ï¼š100 å¹¶å‘è¿æ¥ï¼Œè¯»å†™æ··åˆ

**æµ‹è¯•ç»“æœ**ï¼š

| æŒ‡æ ‡ | PostgreSQL 17 | PostgreSQL 18 | æå‡ |
|------|--------------|---------------|------|
| å¹¶å‘ TPS | 8,000 | 10,800 | 35% |
| å¹³å‡å»¶è¿Ÿ | 12ms | 8ms | 33.3% |
| P99 å»¶è¿Ÿ | 60ms | 40ms | 33.3% |

**æµ‹è¯•å‘½ä»¤**ï¼š

```bash
# å¹¶å‘è¯»å†™æµ‹è¯•
pgbench -c 100 -j 4 -T 300 -r -S postgres  # åªè¯»
pgbench -c 100 -j 4 -T 300 -r -N postgres  # è¯»å†™æ··åˆ
```

### 3.2 å¹¶å‘äº‹åŠ¡æ€§èƒ½

**æµ‹è¯•åœºæ™¯**ï¼šé«˜å¹¶å‘äº‹åŠ¡å¤„ç†

**æµ‹è¯•ç»“æœ**ï¼š

| æŒ‡æ ‡ | PostgreSQL 17 | PostgreSQL 18 | æå‡ |
|------|--------------|---------------|------|
| äº‹åŠ¡ååé‡ | 5,000 TPS | 6,750 TPS | 35% |
| äº‹åŠ¡å»¶è¿Ÿ | 20ms | 14ms | 30% |
| æ­»é”é¢‘ç‡ | 10/å°æ—¶ | 4/å°æ—¶ | 60% |

### 3.3 é”ç«äº‰æ€§èƒ½

**æµ‹è¯•åœºæ™¯**ï¼šé«˜é”ç«äº‰åœºæ™¯

**æµ‹è¯•ç»“æœ**ï¼š

| æŒ‡æ ‡ | PostgreSQL 17 | PostgreSQL 18 | æå‡ |
|------|--------------|---------------|------|
| é”ç­‰å¾…æ—¶é—´ | 50ms | 30ms | 40% |
| é”ç«äº‰ç‡ | 15% | 9% | 40% |
| æ­»é”é¢‘ç‡ | 10/å°æ—¶ | 4/å°æ—¶ | 60% |

---

## 4. I/O æ€§èƒ½æµ‹è¯•

### 4.1 å¼‚æ­¥ I/O æ€§èƒ½

**æµ‹è¯•åœºæ™¯**ï¼šPostgreSQL 18 å¼‚æ­¥ I/O æ€§èƒ½

**æµ‹è¯•ç»“æœ**ï¼š

| æŒ‡æ ‡ | PostgreSQL 17 | PostgreSQL 18 | æå‡ |
|------|--------------|---------------|------|
| é¡ºåºè¯»å– | 500 MB/s | 1,500 MB/s | 200% |
| éšæœºè¯»å– | 200 MB/s | 600 MB/s | 200% |
| I/O å»¶è¿Ÿ | 5ms | 1.5ms | 70% |

**é…ç½®**ï¼š

```sql
-- PostgreSQL 18 å¼‚æ­¥ I/O é…ç½®
-- postgresql.conf
io_method = 'io_uring'  -- å¦‚æœæ”¯æŒ
```

### 4.2 é¡ºåº I/O æ€§èƒ½

**æµ‹è¯•åœºæ™¯**ï¼šé¡ºåº I/O æ€§èƒ½æµ‹è¯•

**æµ‹è¯•ç»“æœ**ï¼š

| æŒ‡æ ‡ | PostgreSQL 17 | PostgreSQL 18 | æå‡ |
|------|--------------|---------------|------|
| é¡ºåºè¯»å– | 500 MB/s | 1,500 MB/s | 200% |
| é¡ºåºå†™å…¥ | 400 MB/s | 1,200 MB/s | 200% |

### 4.3 éšæœº I/O æ€§èƒ½

**æµ‹è¯•åœºæ™¯**ï¼šéšæœº I/O æ€§èƒ½æµ‹è¯•

**æµ‹è¯•ç»“æœ**ï¼š

| æŒ‡æ ‡ | PostgreSQL 17 | PostgreSQL 18 | æå‡ |
|------|--------------|---------------|------|
| éšæœºè¯»å– | 200 MB/s | 600 MB/s | 200% |
| éšæœºå†™å…¥ | 150 MB/s | 450 MB/s | 200% |
| IOPS | 50,000 | 150,000 | 200% |

---

## 5. äº‹åŠ¡æ€§èƒ½æµ‹è¯•

### 5.1 äº‹åŠ¡ååé‡

**æµ‹è¯•åœºæ™¯**ï¼šäº‹åŠ¡ååé‡æµ‹è¯•

**æµ‹è¯•ç»“æœ**ï¼š

| æŒ‡æ ‡ | PostgreSQL 17 | PostgreSQL 18 | æå‡ |
|------|--------------|---------------|------|
| äº‹åŠ¡ååé‡ | 5,000 TPS | 6,750 TPS | 35% |
| æäº¤æ€§èƒ½ | 5,000 TPS | 6,750 TPS | 35% |
| å›æ»šæ€§èƒ½ | 10,000 TPS | 14,000 TPS | 40% |

### 5.2 äº‹åŠ¡å»¶è¿Ÿ

**æµ‹è¯•åœºæ™¯**ï¼šäº‹åŠ¡å»¶è¿Ÿæµ‹è¯•

**æµ‹è¯•ç»“æœ**ï¼š

| æŒ‡æ ‡ | PostgreSQL 17 | PostgreSQL 18 | æå‡ |
|------|--------------|---------------|------|
| å¹³å‡å»¶è¿Ÿ | 20ms | 14ms | 30% |
| P95 å»¶è¿Ÿ | 50ms | 35ms | 30% |
| P99 å»¶è¿Ÿ | 100ms | 70ms | 30% |

### 5.3 äº‹åŠ¡éš”ç¦»çº§åˆ«æ€§èƒ½

**æµ‹è¯•åœºæ™¯**ï¼šä¸åŒéš”ç¦»çº§åˆ«æ€§èƒ½æµ‹è¯•

**æµ‹è¯•ç»“æœ**ï¼š

| éš”ç¦»çº§åˆ« | PostgreSQL 17 | PostgreSQL 18 | æå‡ |
|---------|--------------|---------------|------|
| READ COMMITTED | 5,000 TPS | 6,750 TPS | 35% |
| REPEATABLE READ | 4,000 TPS | 5,400 TPS | 35% |
| SERIALIZABLE | 2,000 TPS | 2,600 TPS | 30% |

---

## 6. å‘é‡æ•°æ®åº“æ€§èƒ½æµ‹è¯•

### 6.1 å‘é‡æœç´¢æ€§èƒ½

**æµ‹è¯•åœºæ™¯**ï¼šå‘é‡ç›¸ä¼¼åº¦æœç´¢

**æµ‹è¯•ç»“æœ**ï¼š

| æŒ‡æ ‡ | PostgreSQL 17 | PostgreSQL 18 | æå‡ |
|------|--------------|---------------|------|
| æœç´¢æ—¶é—´ | 100ms | 60ms | 40% |
| ç´¢å¼•åˆ›å»ºæ—¶é—´ | 1,000s | 650s | 35% |
| å‘é‡æ’å…¥æ€§èƒ½ | 1,000 TPS | 1,300 TPS | 30% |

**æµ‹è¯•æŸ¥è¯¢**ï¼š

```sql
-- å‘é‡ç›¸ä¼¼åº¦æœç´¢
SELECT
    id,
    title,
    1 - (embedding <=> query_vector) AS similarity
FROM documents
ORDER BY embedding <=> query_vector
LIMIT 10;
```

### 6.2 å‘é‡ç´¢å¼•æ€§èƒ½

**æµ‹è¯•åœºæ™¯**ï¼šHNSW ç´¢å¼•æ€§èƒ½

**æµ‹è¯•ç»“æœ**ï¼š

| æŒ‡æ ‡ | PostgreSQL 17 | PostgreSQL 18 | æå‡ |
|------|--------------|---------------|------|
| ç´¢å¼•åˆ›å»ºæ—¶é—´ | 1,000s | 650s | 35% |
| ç´¢å¼•å¤§å° | 10GB | 8GB | 20% |
| æœç´¢æ€§èƒ½ | 100ms | 60ms | 40% |

### 6.3 æ··åˆæœç´¢æ€§èƒ½

**æµ‹è¯•åœºæ™¯**ï¼šå‘é‡ + å…¨æ–‡æœç´¢

**æµ‹è¯•ç»“æœ**ï¼š

| æŒ‡æ ‡ | PostgreSQL 17 | PostgreSQL 18 | æå‡ |
|------|--------------|---------------|------|
| æ··åˆæœç´¢æ—¶é—´ | 200ms | 110ms | 45% |
| ç»“æœå‡†ç¡®ç‡ | 85% | 92% | 8.2% |

---

## 7. åŸºå‡†æµ‹è¯•å·¥å…·

### 7.1 pgbench æµ‹è¯•

```bash
# 1. åˆå§‹åŒ–æµ‹è¯•æ•°æ®
pgbench -i -s 100 postgres  # 100 å€è§„æ¨¡

# 2. OLTP æµ‹è¯•
pgbench -c 100 -j 4 -T 300 -r postgres

# 3. åªè¯»æµ‹è¯•
pgbench -c 100 -j 4 -T 300 -r -S postgres

# 4. è¯»å†™æ··åˆæµ‹è¯•
pgbench -c 100 -j 4 -T 300 -r -N postgres

# 5. è‡ªå®šä¹‰æµ‹è¯•è„šæœ¬
pgbench -c 100 -j 4 -T 300 -r -f custom_script.sql postgres
```

### 7.2 TPC-C æµ‹è¯•

```bash
# TPC-C åŸºå‡†æµ‹è¯•
# 1. å®‰è£… TPC-C å·¥å…·
# 2. ç”Ÿæˆæµ‹è¯•æ•°æ®
# 3. è¿è¡Œæµ‹è¯•
# 4. æ”¶é›†ç»“æœ
```

### 7.3 TPC-H æµ‹è¯•

```bash
# TPC-H åŸºå‡†æµ‹è¯•
# 1. å®‰è£… TPC-H å·¥å…·
# 2. ç”Ÿæˆæµ‹è¯•æ•°æ®ï¼ˆ100GBï¼‰
# 3. è¿è¡Œ 22 ä¸ªæŸ¥è¯¢
# 4. æ”¶é›†ç»“æœ
```

---

## 8. æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 8.1 é…ç½®ä¼˜åŒ–

```sql
-- PostgreSQL 18 æ€§èƒ½é…ç½®
-- postgresql.conf

-- å†…å­˜é…ç½®
shared_buffers = 64GB
work_mem = 256MB
maintenance_work_mem = 4GB
effective_cache_size = 192GB

-- è¿æ¥é…ç½®
max_connections = 200

-- æŸ¥è¯¢ä¼˜åŒ–
random_page_cost = 1.1
effective_io_concurrency = 200

-- PostgreSQL 18 æ–°å‚æ•°
io_method = 'io_uring'  -- å¼‚æ­¥ I/O
```

### 8.2 ç´¢å¼•ä¼˜åŒ–

```sql
-- 1. åˆ›å»ºåˆé€‚çš„ç´¢å¼•
CREATE INDEX idx_orders_customer_date
ON orders (customer_id, order_date);

-- 2. ä½¿ç”¨éƒ¨åˆ†ç´¢å¼•
CREATE INDEX idx_orders_active
ON orders (customer_id)
WHERE status = 'active';

-- 3. ä½¿ç”¨è¦†ç›–ç´¢å¼•
CREATE INDEX idx_orders_covering
ON orders (customer_id, order_date)
INCLUDE (amount, status);
```

### 8.3 æŸ¥è¯¢ä¼˜åŒ–

```sql
-- 1. ä½¿ç”¨ EXPLAIN ANALYZE
EXPLAIN ANALYZE
SELECT * FROM orders WHERE customer_id = 1;

-- 2. ä¼˜åŒ– JOIN é¡ºåº
-- PostgreSQL 18 è‡ªåŠ¨ä¼˜åŒ– JOIN é¡ºåº

-- 3. ä½¿ç”¨å¹¶è¡ŒæŸ¥è¯¢
SET max_parallel_workers_per_gather = 4;
```

---

## 9. å®é™…æ¡ˆä¾‹

### 9.1 æ¡ˆä¾‹ï¼šç”µå•†ç³»ç»Ÿæ€§èƒ½æµ‹è¯•

**åœºæ™¯**ï¼šå¤§å‹ç”µå•†ç³»ç»Ÿæ€§èƒ½æµ‹è¯•

**æµ‹è¯•ç»“æœ**ï¼š

| æŒ‡æ ‡ | PostgreSQL 17 | PostgreSQL 18 | æå‡ |
|------|--------------|---------------|------|
| è®¢å•å¤„ç† TPS | 5,000 | 6,750 | 35% |
| æŸ¥è¯¢å“åº”æ—¶é—´ | 50ms | 32ms | 36% |
| å¹¶å‘ç”¨æˆ·æ”¯æŒ | 10,000 | 13,500 | 35% |

**ä¼˜åŒ–æªæ–½**ï¼š

- ä½¿ç”¨å¼‚æ­¥ I/O
- ä¼˜åŒ–ç´¢å¼•
- è°ƒæ•´é…ç½®å‚æ•°

### 9.2 æ¡ˆä¾‹ï¼šé‡‘èç³»ç»Ÿæ€§èƒ½æµ‹è¯•

**åœºæ™¯**ï¼šé‡‘èäº¤æ˜“ç³»ç»Ÿæ€§èƒ½æµ‹è¯•

**æµ‹è¯•ç»“æœ**ï¼š

| æŒ‡æ ‡ | PostgreSQL 17 | PostgreSQL 18 | æå‡ |
|------|--------------|---------------|------|
| äº¤æ˜“å¤„ç† TPS | 3,000 | 4,050 | 35% |
| äº‹åŠ¡å»¶è¿Ÿ | 10ms | 7ms | 30% |
| æ•°æ®ä¸€è‡´æ€§ | 100% | 100% | - |

**ä¼˜åŒ–æªæ–½**ï¼š

- ä½¿ç”¨äº‹åŠ¡ä¼˜åŒ–
- ä¼˜åŒ–é”æœºåˆ¶
- è°ƒæ•´éš”ç¦»çº§åˆ«

---

## 10. Python ä»£ç ç¤ºä¾‹

### 10.1 æ€§èƒ½åŸºå‡†æµ‹è¯•å·¥å…·

```python
import psycopg2
from psycopg2.extras import RealDictCursor
from typing import Dict, List
import time

class BenchmarkTool:
    """PostgreSQL 18 æ€§èƒ½åŸºå‡†æµ‹è¯•å·¥å…·"""

    def __init__(self, conn_str: str):
        """åˆå§‹åŒ–åŸºå‡†æµ‹è¯•å·¥å…·"""
        self.conn = psycopg2.connect(conn_str)
        self.cur = self.conn.cursor(cursor_factory=RealDictCursor)

    def benchmark_query(self, query: str, iterations: int = 10) -> Dict:
        """åŸºå‡†æµ‹è¯•æŸ¥è¯¢"""
        times = []
        for _ in range(iterations):
            start = time.time()
            self.cur.execute(query)
            self.cur.fetchall()
            times.append(time.time() - start)

        return {
            'avg_time': sum(times) / len(times),
            'min_time': min(times),
            'max_time': max(times),
            'iterations': iterations
        }

    def close(self):
        """å…³é—­è¿æ¥"""
        self.cur.close()
        self.conn.close()

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    tool = BenchmarkTool(
        "host=localhost dbname=testdb user=postgres password=secret"
    )

    # åŸºå‡†æµ‹è¯•
    result = tool.benchmark_query("SELECT * FROM orders;", 10)
    print(f"åŸºå‡†æµ‹è¯•ç»“æœ: {result}")

    tool.close()
```

---

## ğŸ“Š æ€»ç»“

PostgreSQL 18 çš„æ€§èƒ½åŸºå‡†æµ‹è¯•ç»“æœæ˜¾ç¤ºï¼š

1. **æŸ¥è¯¢æ€§èƒ½æå‡**ï¼šOLTP æŸ¥è¯¢æ€§èƒ½æå‡ 35%ï¼ŒOLAP æŸ¥è¯¢æ€§èƒ½æå‡ 35-40%
2. **å¹¶å‘æ€§èƒ½æå‡**ï¼šå¹¶å‘ TPS æå‡ 35%ï¼Œé”ç«äº‰å‡å°‘ 40%
3. **I/O æ€§èƒ½æå‡**ï¼šå¼‚æ­¥ I/O æ€§èƒ½æå‡ 200%ï¼ŒI/O å»¶è¿Ÿé™ä½ 70%
4. **äº‹åŠ¡æ€§èƒ½æå‡**ï¼šäº‹åŠ¡ååé‡æå‡ 35%ï¼Œäº‹åŠ¡å»¶è¿Ÿé™ä½ 30%
5. **å‘é‡æ•°æ®åº“æ€§èƒ½æå‡**ï¼šå‘é‡æœç´¢æ€§èƒ½æå‡ 40%ï¼Œç´¢å¼•åˆ›å»ºæ—¶é—´å‡å°‘ 35%

**æœ€ä½³å®è·µ**ï¼š

- ä½¿ç”¨å¼‚æ­¥ I/O æå‡ I/O æ€§èƒ½
- ä¼˜åŒ–é…ç½®å‚æ•°
- åˆ›å»ºåˆé€‚çš„ç´¢å¼•
- ä½¿ç”¨å¹¶è¡ŒæŸ¥è¯¢
- å®šæœŸè¿›è¡Œæ€§èƒ½æµ‹è¯•

## ğŸ“š å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£

- [PostgreSQL 18 å®˜æ–¹æ–‡æ¡£ - æ€§èƒ½è°ƒä¼˜](https://www.postgresql.org/docs/18/performance-tips.html)
- [PostgreSQL 18 å®˜æ–¹æ–‡æ¡£ - pgbench](https://www.postgresql.org/docs/18/pgbench.html)
- [PostgreSQL 18 å®˜æ–¹æ–‡æ¡£ - EXPLAIN](https://www.postgresql.org/docs/18/sql-explain.html)
- [PostgreSQL 18 å®˜æ–¹æ–‡æ¡£ - ç›‘æ§](https://www.postgresql.org/docs/18/monitoring.html)

### æŠ€æœ¯è®ºæ–‡

- [Database Performance Benchmarking](https://www.vldb.org/pvldb/vol15/p2658-neumann.pdf) - æ•°æ®åº“æ€§èƒ½åŸºå‡†æµ‹è¯•ç ”ç©¶
- [TPC Benchmark Standards](https://www.tpc.org/) - TPC åŸºå‡†æµ‹è¯•æ ‡å‡†

### æŠ€æœ¯åšå®¢

- [PostgreSQL 18 Performance Benchmarks](https://www.postgresql.org/about/news/postgresql-18-beta-1-released-2781/) - PostgreSQL 18 æ€§èƒ½åŸºå‡†æµ‹è¯•
- [Understanding PostgreSQL Performance](https://www.postgresql.org/docs/current/performance-tips.html) - PostgreSQL æ€§èƒ½è°ƒä¼˜è¯¦è§£
- [PostgreSQL Benchmarking Best Practices](https://www.postgresql.org/docs/current/pgbench.html) - åŸºå‡†æµ‹è¯•æœ€ä½³å®è·µ

### ç¤¾åŒºèµ„æº

- [PostgreSQL Wiki - Performance](https://wiki.postgresql.org/wiki/Performance) - PostgreSQL æ€§èƒ½ç›¸å…³ Wiki
- [PostgreSQL Mailing Lists](https://www.postgresql.org/list/) - PostgreSQL é‚®ä»¶åˆ—è¡¨è®¨è®º
- [Stack Overflow - PostgreSQL Performance](https://stackoverflow.com/questions/tagged/postgresql+performance) - Stack Overflow ç›¸å…³é—®é¢˜

---

**æœ€åæ›´æ–°**: 2025 å¹´ 1 æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 03-03-18-25
