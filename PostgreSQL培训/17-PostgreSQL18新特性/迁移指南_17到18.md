# PostgreSQL 17 åˆ° 18 è¿ç§»æŒ‡å—

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 1 æœˆ
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 17 â†’ 18
> **æ–‡æ¡£ç¼–å·**: 03-03-18-19

## ğŸ“‘ æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›ä» PostgreSQL 17 å‡çº§åˆ° PostgreSQL 18 çš„å®Œæ•´è¿ç§»æŒ‡å—ï¼ŒåŒ…æ‹¬è¿ç§»æ­¥éª¤ã€æ³¨æ„äº‹é¡¹ã€å…¼å®¹æ€§é—®é¢˜ã€æ€§èƒ½ä¼˜åŒ–å»ºè®®ç­‰ï¼Œå¸®åŠ©ç”¨æˆ·é¡ºåˆ©å®Œæˆç‰ˆæœ¬å‡çº§ã€‚

## ğŸ¯ æ ¸å¿ƒä»·å€¼

- **å¹³æ»‘è¿ç§»**ï¼šè¯¦ç»†çš„è¿ç§»æ­¥éª¤å’Œæ£€æŸ¥æ¸…å•
- **å…¼å®¹æ€§ä¿è¯**ï¼šå®Œæ•´çš„å…¼å®¹æ€§åˆ†æå’Œè§£å†³æ–¹æ¡ˆ
- **æ€§èƒ½ä¼˜åŒ–**ï¼šè¿ç§»åçš„æ€§èƒ½ä¼˜åŒ–å»ºè®®
- **é£é™©æ§åˆ¶**ï¼šè¿ç§»é£é™©è¯„ä¼°å’Œå›æ»šæ–¹æ¡ˆ
- **æœ€ä½³å®è·µ**ï¼šåŸºäºå®é™…æ¡ˆä¾‹çš„è¿ç§»ç»éªŒ

## ğŸ“š ç›®å½•

- [PostgreSQL 17 åˆ° 18 è¿ç§»æŒ‡å—](#postgresql-17-åˆ°-18-è¿ç§»æŒ‡å—)
  - [ğŸ“‘ æ¦‚è¿°](#-æ¦‚è¿°)
  - [ğŸ¯ æ ¸å¿ƒä»·å€¼](#-æ ¸å¿ƒä»·å€¼)
  - [ğŸ“š ç›®å½•](#-ç›®å½•)
  - [1. è¿ç§»æ¦‚è¿°](#1-è¿ç§»æ¦‚è¿°)
    - [1.1 PostgreSQL 18 æ–°ç‰¹æ€§](#11-postgresql-18-æ–°ç‰¹æ€§)
    - [1.2 è¿ç§»æ”¶ç›Š](#12-è¿ç§»æ”¶ç›Š)
    - [1.3 è¿ç§»é£é™©è¯„ä¼°](#13-è¿ç§»é£é™©è¯„ä¼°)
  - [2. è¿ç§»å‰å‡†å¤‡](#2-è¿ç§»å‰å‡†å¤‡)
    - [2.1 ç¯å¢ƒæ£€æŸ¥](#21-ç¯å¢ƒæ£€æŸ¥)
    - [2.2 æ•°æ®å¤‡ä»½](#22-æ•°æ®å¤‡ä»½)
    - [2.3 å…¼å®¹æ€§æ£€æŸ¥](#23-å…¼å®¹æ€§æ£€æŸ¥)
    - [2.4 æµ‹è¯•ç¯å¢ƒå‡†å¤‡](#24-æµ‹è¯•ç¯å¢ƒå‡†å¤‡)
  - [3. è¿ç§»æ­¥éª¤](#3-è¿ç§»æ­¥éª¤)
    - [3.1 å®‰è£… PostgreSQL 18](#31-å®‰è£…-postgresql-18)
    - [3.2 æ•°æ®è¿ç§»](#32-æ•°æ®è¿ç§»)
    - [3.3 é…ç½®è¿ç§»](#33-é…ç½®è¿ç§»)
    - [3.4 æ‰©å±•è¿ç§»](#34-æ‰©å±•è¿ç§»)
  - [4. å…¼å®¹æ€§é—®é¢˜](#4-å…¼å®¹æ€§é—®é¢˜)
    - [4.1 SQL å…¼å®¹æ€§](#41-sql-å…¼å®¹æ€§)
    - [4.2 å‡½æ•°å…¼å®¹æ€§](#42-å‡½æ•°å…¼å®¹æ€§)
    - [4.3 æ•°æ®ç±»å‹å…¼å®¹æ€§](#43-æ•°æ®ç±»å‹å…¼å®¹æ€§)
    - [4.4 é…ç½®å‚æ•°å…¼å®¹æ€§](#44-é…ç½®å‚æ•°å…¼å®¹æ€§)
  - [5. è¿ç§»åéªŒè¯](#5-è¿ç§»åéªŒè¯)
    - [5.1 åŠŸèƒ½éªŒè¯](#51-åŠŸèƒ½éªŒè¯)
    - [5.2 æ€§èƒ½éªŒè¯](#52-æ€§èƒ½éªŒè¯)
    - [5.3 æ•°æ®å®Œæ•´æ€§éªŒè¯](#53-æ•°æ®å®Œæ•´æ€§éªŒè¯)
  - [6. æ€§èƒ½ä¼˜åŒ–](#6-æ€§èƒ½ä¼˜åŒ–)
    - [6.1 é…ç½®ä¼˜åŒ–](#61-é…ç½®ä¼˜åŒ–)
    - [6.2 ç´¢å¼•ä¼˜åŒ–](#62-ç´¢å¼•ä¼˜åŒ–)
    - [6.3 æŸ¥è¯¢ä¼˜åŒ–](#63-æŸ¥è¯¢ä¼˜åŒ–)
  - [7. å›æ»šæ–¹æ¡ˆ](#7-å›æ»šæ–¹æ¡ˆ)
    - [7.1 å›æ»šå‡†å¤‡](#71-å›æ»šå‡†å¤‡)
    - [7.2 å›æ»šæ­¥éª¤](#72-å›æ»šæ­¥éª¤)
    - [7.3 å›æ»šéªŒè¯](#73-å›æ»šéªŒè¯)
  - [8. æœ€ä½³å®è·µ](#8-æœ€ä½³å®è·µ)
    - [8.1 è¿ç§»è®¡åˆ’](#81-è¿ç§»è®¡åˆ’)
    - [8.2 è¿ç§»æ‰§è¡Œ](#82-è¿ç§»æ‰§è¡Œ)
    - [8.3 è¿ç§»åç»´æŠ¤](#83-è¿ç§»åç»´æŠ¤)
  - [9. å®é™…æ¡ˆä¾‹](#9-å®é™…æ¡ˆä¾‹)
    - [9.1 æ¡ˆä¾‹ï¼šå¤§å‹ç”µå•†ç³»ç»Ÿè¿ç§»](#91-æ¡ˆä¾‹å¤§å‹ç”µå•†ç³»ç»Ÿè¿ç§»)
    - [9.2 æ¡ˆä¾‹ï¼šé‡‘èç³»ç»Ÿè¿ç§»](#92-æ¡ˆä¾‹é‡‘èç³»ç»Ÿè¿ç§»)
  - [ğŸ“Š æ€»ç»“](#-æ€»ç»“)

---

## 1. è¿ç§»æ¦‚è¿°

### 1.1 PostgreSQL 18 æ–°ç‰¹æ€§

PostgreSQL 18 çš„ä¸»è¦æ–°ç‰¹æ€§ï¼š

- **å¼‚æ­¥ I/O å­ç³»ç»Ÿ**ï¼šæ€§èƒ½æå‡é«˜è¾¾ 3 å€
- **æ–‡æœ¬å¤„ç†æ”¹è¿›**ï¼šPG_UNICODE_FAST æ’åºè§„åˆ™ã€casefold å‡½æ•°
- **èº«ä»½éªŒè¯å¢å¼º**ï¼šOAuth 2.0 æ”¯æŒã€FIPS æ¨¡å¼ã€TLS v1.3
- **å¤åˆ¶åŠŸèƒ½å¢å¼º**ï¼šé€»è¾‘å¤åˆ¶å†™å…¥å†²çªæŠ¥å‘Šã€å¹¶è¡Œæµå¼ä¼ è¾“
- **ç”Ÿæˆåˆ—**ï¼šè™šæ‹Ÿç”Ÿæˆåˆ—æ”¯æŒ
- **uuidv7() å‡½æ•°**ï¼šåŸºäºæ—¶é—´çš„ UUID ç”Ÿæˆ
- **æŸ¥è¯¢æ€§èƒ½æå‡**ï¼šæŸ¥è¯¢ä¼˜åŒ–å™¨å’Œæ‰§è¡Œå¼•æ“æ”¹è¿›
- **å‘é‡æ•°æ®åº“å¢å¼º**ï¼špgvector é›†æˆä¼˜åŒ–

### 1.2 è¿ç§»æ”¶ç›Š

è¿ç§»åˆ° PostgreSQL 18 çš„ä¸»è¦æ”¶ç›Šï¼š

- **æ€§èƒ½æå‡**ï¼šæŸ¥è¯¢æ€§èƒ½æå‡ 30-50%
- **æ–°åŠŸèƒ½**ï¼šæ”¯æŒæ›´å¤š SQL æ ‡å‡†å’Œåˆ›æ–°åŠŸèƒ½
- **å®‰å…¨æ€§å¢å¼º**ï¼šOAuth 2.0ã€FIPS æ¨¡å¼ã€TLS v1.3
- **å¯è§‚æµ‹æ€§å¢å¼º**ï¼šæ›´å¼ºå¤§çš„ç›‘æ§å’Œè¯Šæ–­èƒ½åŠ›
- **äº‘åŸç”Ÿç‰¹æ€§**ï¼šäº‘ç¯å¢ƒä¸‹çš„ä¼˜åŒ–å’Œç‰¹æ€§

### 1.3 è¿ç§»é£é™©è¯„ä¼°

è¿ç§»é£é™©è¯„ä¼°ï¼š

- **å…¼å®¹æ€§é£é™©**ï¼šä¸­ç­‰ï¼ˆå¤§éƒ¨åˆ†å…¼å®¹ï¼Œå°‘æ•°ä¸å…¼å®¹ï¼‰
- **æ€§èƒ½é£é™©**ï¼šä½ï¼ˆæ€§èƒ½é€šå¸¸æå‡ï¼‰
- **ç¨³å®šæ€§é£é™©**ï¼šä½ï¼ˆPostgreSQL 18 ç¨³å®šå¯é ï¼‰
- **å›æ»šé£é™©**ï¼šä½ï¼ˆå¯ä»¥å›æ»šåˆ° PostgreSQL 17ï¼‰

---

## 2. è¿ç§»å‰å‡†å¤‡

### 2.1 ç¯å¢ƒæ£€æŸ¥

```bash
# 1. æ£€æŸ¥å½“å‰ PostgreSQL ç‰ˆæœ¬
psql --version

# 2. æ£€æŸ¥ç³»ç»Ÿèµ„æº
free -h
df -h
lscpu

# 3. æ£€æŸ¥ PostgreSQL é…ç½®
psql -c "SHOW ALL;" > pg17_config.txt

# 4. æ£€æŸ¥æ•°æ®åº“å¤§å°
psql -c "
SELECT
    pg_database.datname,
    pg_size_pretty(pg_database_size(pg_database.datname)) AS size
FROM pg_database
ORDER BY pg_database_size(pg_database.datname) DESC;
"

# 5. æ£€æŸ¥æ‰©å±•
psql -c "
SELECT
    extname,
    extversion
FROM pg_extension
ORDER BY extname;
"
```

### 2.2 æ•°æ®å¤‡ä»½

```bash
# 1. å®Œæ•´å¤‡ä»½
pg_dumpall -U postgres -f pg17_backup.sql

# 2. å•ä¸ªæ•°æ®åº“å¤‡ä»½
pg_dump -U postgres -F c -f database_backup.dump database_name

# 3. éªŒè¯å¤‡ä»½
pg_restore --list database_backup.dump

# 4. å¤‡ä»½é…ç½®æ–‡ä»¶
cp $PGDATA/postgresql.conf postgresql.conf.backup
cp $PGDATA/pg_hba.conf pg_hba.conf.backup
```

### 2.3 å…¼å®¹æ€§æ£€æŸ¥

```sql
-- 1. æ£€æŸ¥ä¸å…¼å®¹çš„ SQL è¯­æ³•
-- PostgreSQL 18 ä¸­ md5 å¯†ç è®¤è¯å·²å¼ƒç”¨
SELECT
    usename,
    passwd
FROM pg_shadow
WHERE passwd LIKE 'md5%';

-- 2. æ£€æŸ¥ä½¿ç”¨çš„å‡½æ•°
SELECT
    routine_name,
    routine_type
FROM information_schema.routines
WHERE routine_schema = 'public';

-- 3. æ£€æŸ¥æ•°æ®ç±»å‹
SELECT
    typname,
    typtype
FROM pg_type
WHERE typnamespace = (SELECT oid FROM pg_namespace WHERE nspname = 'public');
```

### 2.4 æµ‹è¯•ç¯å¢ƒå‡†å¤‡

```bash
# 1. åˆ›å»ºæµ‹è¯•ç¯å¢ƒ
# åœ¨æµ‹è¯•æœåŠ¡å™¨ä¸Šå®‰è£… PostgreSQL 18

# 2. æ¢å¤æµ‹è¯•æ•°æ®
pg_restore -U postgres -d test_database database_backup.dump

# 3. è¿è¡Œæµ‹è¯•è„šæœ¬
psql -U postgres -d test_database -f test_queries.sql
```

---

## 3. è¿ç§»æ­¥éª¤

### 3.1 å®‰è£… PostgreSQL 18

```bash
# 1. ä¸‹è½½ PostgreSQL 18
# æ ¹æ®æ“ä½œç³»ç»Ÿé€‰æ‹©å®‰è£…æ–¹å¼

# Ubuntu/Debian
sudo apt-get update
sudo apt-get install postgresql-18

# CentOS/RHEL
sudo yum install postgresql18-server

# 2. åˆå§‹åŒ–æ•°æ®åº“
sudo /usr/pgsql-18/bin/postgresql-18-setup initdb

# 3. å¯åŠ¨ PostgreSQL 18
sudo systemctl start postgresql-18
sudo systemctl enable postgresql-18
```

### 3.2 æ•°æ®è¿ç§»

```bash
# æ–¹æ³• 1: ä½¿ç”¨ pg_dump/pg_restoreï¼ˆæ¨èï¼‰
# 1. ä» PostgreSQL 17 å¯¼å‡º
pg_dump -U postgres -F c -f database_backup.dump database_name

# 2. å¯¼å…¥åˆ° PostgreSQL 18
pg_restore -U postgres -d database_name database_backup.dump

# æ–¹æ³• 2: ä½¿ç”¨ pg_upgradeï¼ˆå¿«é€Ÿå‡çº§ï¼‰
# 1. åœæ­¢ PostgreSQL 17
sudo systemctl stop postgresql-17

# 2. è¿è¡Œ pg_upgrade
sudo -u postgres /usr/pgsql-18/bin/pg_upgrade \
    --old-datadir=/var/lib/pgsql/17/data \
    --new-datadir=/var/lib/pgsql/18/data \
    --old-bindir=/usr/pgsql-17/bin \
    --new-bindir=/usr/pgsql-18/bin \
    --check

# 3. æ‰§è¡Œå‡çº§
sudo -u postgres /usr/pgsql-18/bin/pg_upgrade \
    --old-datadir=/var/lib/pgsql/17/data \
    --new-datadir=/var/lib/pgsql/18/data \
    --old-bindir=/usr/pgsql-17/bin \
    --new-bindir=/usr/pgsql-18/bin
```

### 3.3 é…ç½®è¿ç§»

```bash
# 1. è¿ç§»é…ç½®æ–‡ä»¶
# ä» PostgreSQL 17 é…ç½®æ–‡ä»¶è¿ç§»åˆ° PostgreSQL 18

# 2. æ›´æ–°é…ç½®å‚æ•°
# postgresql.conf
# æ£€æŸ¥å¹¶æ›´æ–°ä»¥ä¸‹å‚æ•°ï¼š
# - shared_buffers
# - work_mem
# - maintenance_work_mem
# - max_connections
# - effective_cache_size

# 3. è¿ç§» pg_hba.conf
cp /var/lib/pgsql/17/data/pg_hba.conf /var/lib/pgsql/18/data/pg_hba.conf

# 4. é‡æ–°åŠ è½½é…ç½®
sudo systemctl reload postgresql-18
```

### 3.4 æ‰©å±•è¿ç§»

```sql
-- 1. æ£€æŸ¥æ‰©å±•å…¼å®¹æ€§
-- åœ¨ PostgreSQL 18 ä¸­æ£€æŸ¥æ‰©å±•æ˜¯å¦å¯ç”¨

-- 2. å®‰è£…æ‰©å±•
CREATE EXTENSION IF NOT EXISTS vector;
CREATE EXTENSION IF NOT EXISTS timescaledb;
CREATE EXTENSION IF NOT EXISTS postgis;

-- 3. æ›´æ–°æ‰©å±•ç‰ˆæœ¬
ALTER EXTENSION vector UPDATE;
ALTER EXTENSION timescaledb UPDATE;
ALTER EXTENSION postgis UPDATE;

-- 4. éªŒè¯æ‰©å±•
SELECT
    extname,
    extversion
FROM pg_extension
ORDER BY extname;
```

---

## 4. å…¼å®¹æ€§é—®é¢˜

### 4.1 SQL å…¼å®¹æ€§

```sql
-- PostgreSQL 18 å…¼å®¹æ€§é—®é¢˜
-- 1. md5 å¯†ç è®¤è¯å·²å¼ƒç”¨
-- éœ€è¦è¿ç§»åˆ° SCRAM-SHA-256
ALTER USER username WITH PASSWORD 'new_password';

-- 2. æ–° SQL è¯­æ³•æ”¯æŒ
-- PostgreSQL 18 æ”¯æŒæ›´å¤š SQL æ ‡å‡†è¯­æ³•
-- ä¾‹å¦‚ï¼šç”Ÿæˆåˆ—ã€uuidv7() å‡½æ•°ç­‰

-- 3. å‡½æ•°è¡Œä¸ºå˜åŒ–
-- æŸäº›å‡½æ•°çš„è¡Œä¸ºå¯èƒ½æœ‰ç»†å¾®å˜åŒ–
-- éœ€è¦æµ‹è¯•éªŒè¯
```

### 4.2 å‡½æ•°å…¼å®¹æ€§

```sql
-- æ£€æŸ¥å‡½æ•°å…¼å®¹æ€§
-- 1. æ£€æŸ¥è‡ªå®šä¹‰å‡½æ•°
SELECT
    routine_name,
    routine_definition
FROM information_schema.routines
WHERE routine_schema = 'public'
AND routine_type = 'FUNCTION';

-- 2. æµ‹è¯•å‡½æ•°
-- åœ¨ PostgreSQL 18 ä¸­æµ‹è¯•æ‰€æœ‰è‡ªå®šä¹‰å‡½æ•°

-- 3. æ›´æ–°å‡½æ•°
-- æ ¹æ® PostgreSQL 18 çš„æ–°ç‰¹æ€§æ›´æ–°å‡½æ•°
```

### 4.3 æ•°æ®ç±»å‹å…¼å®¹æ€§

```sql
-- æ•°æ®ç±»å‹å…¼å®¹æ€§
-- PostgreSQL 18 æ–°å¢æ•°æ®ç±»å‹ï¼š
-- - halfvec (åŠç²¾åº¦å‘é‡)
-- - sparsevec (ç¨€ç–å‘é‡)

-- æ£€æŸ¥æ•°æ®ç±»å‹ä½¿ç”¨
SELECT
    table_name,
    column_name,
    data_type
FROM information_schema.columns
WHERE table_schema = 'public';
```

### 4.4 é…ç½®å‚æ•°å…¼å®¹æ€§

```bash
# é…ç½®å‚æ•°å…¼å®¹æ€§
# 1. æ£€æŸ¥é…ç½®å‚æ•°
psql -c "SHOW ALL;" > pg18_config.txt

# 2. å¯¹æ¯”é…ç½®å‚æ•°
diff pg17_config.txt pg18_config.txt

# 3. æ›´æ–°é…ç½®å‚æ•°
# æ ¹æ® PostgreSQL 18 çš„æ–°å‚æ•°æ›´æ–°é…ç½®
```

---

## 5. è¿ç§»åéªŒè¯

### 5.1 åŠŸèƒ½éªŒè¯

```sql
-- 1. éªŒè¯æ•°æ®åº“è¿æ¥
SELECT version();

-- 2. éªŒè¯è¡¨ç»“æ„
SELECT
    table_name,
    column_name,
    data_type
FROM information_schema.columns
WHERE table_schema = 'public'
ORDER BY table_name, ordinal_position;

-- 3. éªŒè¯æ•°æ®å®Œæ•´æ€§
SELECT
    schemaname,
    tablename,
    n_tup_ins AS inserts,
    n_tup_upd AS updates,
    n_tup_del AS deletes
FROM pg_stat_user_tables
ORDER BY schemaname, tablename;

-- 4. éªŒè¯ç´¢å¼•
SELECT
    schemaname,
    tablename,
    indexname,
    indexdef
FROM pg_indexes
WHERE schemaname = 'public'
ORDER BY tablename, indexname;
```

### 5.2 æ€§èƒ½éªŒè¯

```sql
-- 1. æ€§èƒ½åŸºå‡†æµ‹è¯•
-- è¿è¡Œæ€§èƒ½æµ‹è¯•è„šæœ¬
EXPLAIN ANALYZE
SELECT * FROM large_table WHERE id = 1;

-- 2. æŸ¥è¯¢æ€§èƒ½å¯¹æ¯”
-- å¯¹æ¯” PostgreSQL 17 å’Œ 18 çš„æŸ¥è¯¢æ€§èƒ½

-- 3. å¹¶å‘æ€§èƒ½æµ‹è¯•
-- æµ‹è¯•å¹¶å‘æŸ¥è¯¢æ€§èƒ½
```

### 5.3 æ•°æ®å®Œæ•´æ€§éªŒè¯

```sql
-- 1. æ•°æ®è¡Œæ•°éªŒè¯
SELECT
    schemaname,
    tablename,
    n_live_tup AS row_count
FROM pg_stat_user_tables
WHERE schemaname = 'public'
ORDER BY tablename;

-- 2. æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥
-- è¿è¡Œæ•°æ®ä¸€è‡´æ€§æ£€æŸ¥è„šæœ¬

-- 3. å¤–é”®çº¦æŸéªŒè¯
SELECT
    tc.table_name,
    kcu.column_name,
    ccu.table_name AS foreign_table_name,
    ccu.column_name AS foreign_column_name
FROM information_schema.table_constraints AS tc
JOIN information_schema.key_column_usage AS kcu
    ON tc.constraint_name = kcu.constraint_name
JOIN information_schema.constraint_column_usage AS ccu
    ON ccu.constraint_name = tc.constraint_name
WHERE tc.constraint_type = 'FOREIGN KEY'
AND tc.table_schema = 'public';
```

---

## 6. æ€§èƒ½ä¼˜åŒ–

### 6.1 é…ç½®ä¼˜åŒ–

```sql
-- PostgreSQL 18 é…ç½®ä¼˜åŒ–
-- postgresql.conf

-- 1. å†…å­˜é…ç½®
shared_buffers = 4GB
work_mem = 64MB
maintenance_work_mem = 1GB
effective_cache_size = 12GB

-- 2. è¿æ¥é…ç½®
max_connections = 200

-- 3. æŸ¥è¯¢ä¼˜åŒ–
random_page_cost = 1.1
effective_io_concurrency = 200

-- 4. PostgreSQL 18 æ–°å‚æ•°
-- å¼‚æ­¥ I/O é…ç½®
io_method = 'io_uring'  -- å¦‚æœæ”¯æŒ
```

### 6.2 ç´¢å¼•ä¼˜åŒ–

```sql
-- 1. é‡å»ºç´¢å¼•
REINDEX DATABASE database_name;

-- 2. æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
ANALYZE;

-- 3. æ£€æŸ¥ç´¢å¼•ä½¿ç”¨æƒ…å†µ
SELECT
    schemaname,
    tablename,
    indexname,
    idx_scan,
    idx_tup_read,
    idx_tup_fetch
FROM pg_stat_user_indexes
WHERE schemaname = 'public'
ORDER BY idx_scan DESC;
```

### 6.3 æŸ¥è¯¢ä¼˜åŒ–

```sql
-- 1. åˆ†ææ…¢æŸ¥è¯¢
SELECT
    query,
    calls,
    total_time,
    mean_time,
    max_time
FROM pg_stat_statements
ORDER BY mean_time DESC
LIMIT 10;

-- 2. ä¼˜åŒ–æŸ¥è¯¢è®¡åˆ’
EXPLAIN ANALYZE
SELECT * FROM large_table WHERE condition;

-- 3. ä½¿ç”¨ PostgreSQL 18 æ–°ç‰¹æ€§
-- ä¾‹å¦‚ï¼šç”Ÿæˆåˆ—ã€æ–°ç´¢å¼•ç±»å‹ç­‰
```

---

## 7. å›æ»šæ–¹æ¡ˆ

### 7.1 å›æ»šå‡†å¤‡

```bash
# 1. ä¿ç•™ PostgreSQL 17 å®‰è£…
# ä¸è¦ç«‹å³å¸è½½ PostgreSQL 17

# 2. ä¿ç•™æ•°æ®å¤‡ä»½
# ç¡®ä¿æœ‰å®Œæ•´çš„æ•°æ®å¤‡ä»½

# 3. è®°å½•è¿ç§»æ­¥éª¤
# è®°å½•æ‰€æœ‰è¿ç§»æ­¥éª¤ï¼Œä¾¿äºå›æ»š
```

### 7.2 å›æ»šæ­¥éª¤

```bash
# 1. åœæ­¢ PostgreSQL 18
sudo systemctl stop postgresql-18

# 2. æ¢å¤ PostgreSQL 17 æ•°æ®
# å¦‚æœæœ‰ pg_upgrade å¤‡ä»½
sudo -u postgres /usr/pgsql-17/bin/pg_upgrade \
    --old-datadir=/var/lib/pgsql/18/data \
    --new-datadir=/var/lib/pgsql/17/data \
    --old-bindir=/usr/pgsql-18/bin \
    --new-bindir=/usr/pgsql-17/bin

# æˆ–è€…ä»å¤‡ä»½æ¢å¤
pg_restore -U postgres -d database_name database_backup.dump

# 3. å¯åŠ¨ PostgreSQL 17
sudo systemctl start postgresql-17

# 4. éªŒè¯å›æ»š
psql -U postgres -c "SELECT version();"
```

### 7.3 å›æ»šéªŒè¯

```sql
-- 1. éªŒè¯æ•°æ®åº“è¿æ¥
SELECT version();

-- 2. éªŒè¯æ•°æ®å®Œæ•´æ€§
SELECT
    schemaname,
    tablename,
    n_live_tup AS row_count
FROM pg_stat_user_tables
WHERE schemaname = 'public';

-- 3. éªŒè¯åŠŸèƒ½
-- è¿è¡ŒåŠŸèƒ½æµ‹è¯•è„šæœ¬
```

---

## 8. æœ€ä½³å®è·µ

### 8.1 è¿ç§»è®¡åˆ’

```bash
# è¿ç§»è®¡åˆ’æ¸…å•
# 1. è¯„ä¼°è¿ç§»æ”¶ç›Šå’Œé£é™©
# 2. åˆ¶å®šè¯¦ç»†çš„è¿ç§»è®¡åˆ’
# 3. å‡†å¤‡æµ‹è¯•ç¯å¢ƒ
# 4. æ‰§è¡Œæµ‹è¯•è¿ç§»
# 5. åˆ¶å®šå›æ»šæ–¹æ¡ˆ
# 6. å®‰æ’è¿ç§»æ—¶é—´çª—å£
# 7. é€šçŸ¥ç›¸å…³å›¢é˜Ÿ
```

### 8.2 è¿ç§»æ‰§è¡Œ

```bash
# è¿ç§»æ‰§è¡Œæ­¥éª¤
# 1. æ‰§è¡Œæ•°æ®å¤‡ä»½
# 2. åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯è¿ç§»
# 3. æ‰§è¡Œç”Ÿäº§ç¯å¢ƒè¿ç§»
# 4. éªŒè¯è¿ç§»ç»“æœ
# 5. ç›‘æ§ç³»ç»Ÿæ€§èƒ½
# 6. å¤„ç†è¿ç§»é—®é¢˜
```

### 8.3 è¿ç§»åç»´æŠ¤

```sql
-- è¿ç§»åç»´æŠ¤
-- 1. ç›‘æ§ç³»ç»Ÿæ€§èƒ½
SELECT
    datname,
    numbackends,
    xact_commit,
    xact_rollback,
    blks_read,
    blks_hit
FROM pg_stat_database
WHERE datname = current_database();

-- 2. å®šæœŸæ›´æ–°ç»Ÿè®¡ä¿¡æ¯
ANALYZE;

-- 3. å®šæœŸç»´æŠ¤ç´¢å¼•
REINDEX DATABASE database_name;

-- 4. ç›‘æ§æ…¢æŸ¥è¯¢
SELECT
    query,
    calls,
    mean_time
FROM pg_stat_statements
ORDER BY mean_time DESC
LIMIT 10;
```

---

## 9. å®é™…æ¡ˆä¾‹

### 9.1 æ¡ˆä¾‹ï¼šå¤§å‹ç”µå•†ç³»ç»Ÿè¿ç§»

**åœºæ™¯**ï¼šå¤§å‹ç”µå•†ç³»ç»Ÿä» PostgreSQL 17 è¿ç§»åˆ° 18

**è¿ç§»è¿‡ç¨‹**ï¼š

```bash
# 1. å‡†å¤‡é˜¶æ®µï¼ˆ1å‘¨ï¼‰
# - ç¯å¢ƒæ£€æŸ¥
# - æ•°æ®å¤‡ä»½
# - å…¼å®¹æ€§æ£€æŸ¥
# - æµ‹è¯•ç¯å¢ƒå‡†å¤‡

# 2. æµ‹è¯•è¿ç§»ï¼ˆ1å‘¨ï¼‰
# - åœ¨æµ‹è¯•ç¯å¢ƒæ‰§è¡Œè¿ç§»
# - åŠŸèƒ½éªŒè¯
# - æ€§èƒ½æµ‹è¯•

# 3. ç”Ÿäº§è¿ç§»ï¼ˆ1å¤©ï¼‰
# - æ‰§è¡Œæ•°æ®å¤‡ä»½
# - ä½¿ç”¨ pg_upgrade å‡çº§
# - éªŒè¯è¿ç§»ç»“æœ
# - ç›‘æ§ç³»ç»Ÿæ€§èƒ½
```

**æ•ˆæœ**ï¼š

- è¿ç§»æ—¶é—´ï¼š1 å¤©
- æ€§èƒ½æå‡ï¼šæŸ¥è¯¢æ€§èƒ½æå‡ 40%
- ç¨³å®šæ€§ï¼šæ— æ•…éšœ
- å›æ»šå‡†å¤‡ï¼šå®Œæ•´å¤‡ä»½ä¿ç•™

### 9.2 æ¡ˆä¾‹ï¼šé‡‘èç³»ç»Ÿè¿ç§»

**åœºæ™¯**ï¼šé‡‘èç³»ç»Ÿä» PostgreSQL 17 è¿ç§»åˆ° 18

**è¿ç§»è¿‡ç¨‹**ï¼š

```bash
# 1. å‡†å¤‡é˜¶æ®µï¼ˆ2å‘¨ï¼‰
# - è¯¦ç»†çš„ç¯å¢ƒæ£€æŸ¥
# - å®Œæ•´çš„æ•°æ®å¤‡ä»½
# - å…¼å®¹æ€§å…¨é¢æ£€æŸ¥
# - æµ‹è¯•ç¯å¢ƒå‡†å¤‡

# 2. æµ‹è¯•è¿ç§»ï¼ˆ2å‘¨ï¼‰
# - åœ¨æµ‹è¯•ç¯å¢ƒæ‰§è¡Œè¿ç§»
# - å®Œæ•´åŠŸèƒ½éªŒè¯
# - æ€§èƒ½åŸºå‡†æµ‹è¯•
# - å®‰å…¨æ€§æµ‹è¯•

# 3. ç”Ÿäº§è¿ç§»ï¼ˆç»´æŠ¤çª—å£ï¼‰
# - æ‰§è¡Œå®Œæ•´å¤‡ä»½
# - ä½¿ç”¨ pg_dump/pg_restore è¿ç§»
# - éªŒè¯æ•°æ®å®Œæ•´æ€§
# - æ€§èƒ½éªŒè¯
```

**æ•ˆæœ**ï¼š

- è¿ç§»æ—¶é—´ï¼š4 å°æ—¶ç»´æŠ¤çª—å£
- æ€§èƒ½æå‡ï¼šæŸ¥è¯¢æ€§èƒ½æå‡ 35%
- ç¨³å®šæ€§ï¼šæ— æ•…éšœ
- å®‰å…¨æ€§ï¼šOAuth 2.0 æ”¯æŒå¢å¼ºå®‰å…¨æ€§

---

## ğŸ“Š æ€»ç»“

PostgreSQL 17 åˆ° 18 çš„è¿ç§»æ˜¯ä¸€ä¸ªç›¸å¯¹å¹³æ»‘çš„è¿‡ç¨‹ï¼š

1. **è¿ç§»å‡†å¤‡**ï¼šè¯¦ç»†çš„ç¯å¢ƒæ£€æŸ¥ã€æ•°æ®å¤‡ä»½ã€å…¼å®¹æ€§æ£€æŸ¥
2. **è¿ç§»æ‰§è¡Œ**ï¼šä½¿ç”¨ pg_upgrade æˆ– pg_dump/pg_restore
3. **è¿ç§»éªŒè¯**ï¼šåŠŸèƒ½éªŒè¯ã€æ€§èƒ½éªŒè¯ã€æ•°æ®å®Œæ•´æ€§éªŒè¯
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šé…ç½®ä¼˜åŒ–ã€ç´¢å¼•ä¼˜åŒ–ã€æŸ¥è¯¢ä¼˜åŒ–
5. **å›æ»šæ–¹æ¡ˆ**ï¼šå®Œæ•´çš„å›æ»šå‡†å¤‡å’Œæ­¥éª¤

**æœ€ä½³å®è·µ**ï¼š

- åˆ¶å®šè¯¦ç»†çš„è¿ç§»è®¡åˆ’
- åœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯
- ä¿ç•™å®Œæ•´çš„æ•°æ®å¤‡ä»½
- å‡†å¤‡å›æ»šæ–¹æ¡ˆ
- ç›‘æ§è¿ç§»åçš„ç³»ç»Ÿæ€§èƒ½

---

**æœ€åæ›´æ–°**: 2025 å¹´ 1 æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
