# PostgreSQL 17 åˆ° 18 è¿ç§»æŒ‡å—

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 1 æœˆ
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 17 â†’ 18
> **æ–‡æ¡£ç¼–å·**: 03-03-18-19

## ğŸ“‘ æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›ä» PostgreSQL 17 å‡çº§åˆ° PostgreSQL 18 çš„å®Œæ•´è¿ç§»æŒ‡å—ï¼Œ
åŒ…æ‹¬è¿ç§»æ­¥éª¤ã€æ³¨æ„äº‹é¡¹ã€å…¼å®¹æ€§é—®é¢˜ã€æ€§èƒ½ä¼˜åŒ–å»ºè®®ç­‰ï¼Œå¸®åŠ©ç”¨æˆ·é¡ºåˆ©å®Œæˆç‰ˆæœ¬å‡çº§ã€‚

## ğŸ¯ æ ¸å¿ƒä»·å€¼

- **å¹³æ»‘è¿ç§»**ï¼šè¯¦ç»†çš„è¿ç§»æ­¥éª¤å’Œæ£€æŸ¥æ¸…å•
- **å…¼å®¹æ€§ä¿è¯**ï¼šå®Œæ•´çš„å…¼å®¹æ€§åˆ†æå’Œè§£å†³æ–¹æ¡ˆ
- **æ€§èƒ½ä¼˜åŒ–**ï¼šè¿ç§»åçš„æ€§èƒ½ä¼˜åŒ–å»ºè®®
- **é£é™©æ§åˆ¶**ï¼šè¿ç§»é£é™©è¯„ä¼°å’Œå›æ»šæ–¹æ¡ˆ
- **æœ€ä½³å®è·µ**ï¼šåŸºäºå®é™…æ¡ˆä¾‹çš„è¿ç§»ç»éªŒ

## ğŸ“š ç›®å½•

- [PostgreSQL 17 åˆ° 18 è¿ç§»æŒ‡å—](#postgresql-17-åˆ°-18-è¿ç§»æŒ‡å—)
  - [ğŸ“‘ æ¦‚è¿°](#-æ¦‚è¿°)
  - [ğŸ¯ æ ¸å¿ƒä»·å€¼](#-æ ¸å¿ƒä»·å€¼)
  - [ğŸ“š ç›®å½•](#-ç›®å½•)
  - [1. è¿ç§»æ¦‚è¿°](#1-è¿ç§»æ¦‚è¿°)
    - [1.0 è¿ç§»å·¥ä½œåŸç†æ¦‚è¿°](#10-è¿ç§»å·¥ä½œåŸç†æ¦‚è¿°)
    - [1.1 PostgreSQL 18 æ–°ç‰¹æ€§](#11-postgresql-18-æ–°ç‰¹æ€§)
    - [1.2 è¿ç§»æ”¶ç›Š](#12-è¿ç§»æ”¶ç›Š)
    - [1.3 è¿ç§»é£é™©è¯„ä¼°](#13-è¿ç§»é£é™©è¯„ä¼°)
  - [2. è¿ç§»å‰å‡†å¤‡](#2-è¿ç§»å‰å‡†å¤‡)
    - [2.1 ç¯å¢ƒæ£€æŸ¥](#21-ç¯å¢ƒæ£€æŸ¥)
    - [2.2 æ•°æ®å¤‡ä»½](#22-æ•°æ®å¤‡ä»½)
    - [2.3 å…¼å®¹æ€§æ£€æŸ¥](#23-å…¼å®¹æ€§æ£€æŸ¥)
    - [2.4 æµ‹è¯•ç¯å¢ƒå‡†å¤‡](#24-æµ‹è¯•ç¯å¢ƒå‡†å¤‡)
  - [3. è¿ç§»æ­¥éª¤](#3-è¿ç§»æ­¥éª¤)
    - [3.1 å®‰è£… PostgreSQL 18](#31-å®‰è£…-postgresql-18)
    - [3.2 æ•°æ®è¿ç§»](#32-æ•°æ®è¿ç§»)
    - [3.3 é…ç½®è¿ç§»](#33-é…ç½®è¿ç§»)
    - [3.4 æ‰©å±•è¿ç§»](#34-æ‰©å±•è¿ç§»)
  - [4. å…¼å®¹æ€§é—®é¢˜](#4-å…¼å®¹æ€§é—®é¢˜)
    - [4.1 SQL å…¼å®¹æ€§](#41-sql-å…¼å®¹æ€§)
    - [4.2 å‡½æ•°å…¼å®¹æ€§](#42-å‡½æ•°å…¼å®¹æ€§)
    - [4.3 æ•°æ®ç±»å‹å…¼å®¹æ€§](#43-æ•°æ®ç±»å‹å…¼å®¹æ€§)
    - [4.4 é…ç½®å‚æ•°å…¼å®¹æ€§](#44-é…ç½®å‚æ•°å…¼å®¹æ€§)
  - [5. è¿ç§»åéªŒè¯](#5-è¿ç§»åéªŒè¯)
    - [5.1 åŠŸèƒ½éªŒè¯](#51-åŠŸèƒ½éªŒè¯)
    - [5.2 æ€§èƒ½éªŒè¯](#52-æ€§èƒ½éªŒè¯)
    - [5.3 æ•°æ®å®Œæ•´æ€§éªŒè¯](#53-æ•°æ®å®Œæ•´æ€§éªŒè¯)
  - [6. æ€§èƒ½ä¼˜åŒ–](#6-æ€§èƒ½ä¼˜åŒ–)
    - [6.1 é…ç½®ä¼˜åŒ–](#61-é…ç½®ä¼˜åŒ–)
    - [6.2 ç´¢å¼•ä¼˜åŒ–](#62-ç´¢å¼•ä¼˜åŒ–)
    - [6.3 æŸ¥è¯¢ä¼˜åŒ–](#63-æŸ¥è¯¢ä¼˜åŒ–)
  - [7. å›æ»šæ–¹æ¡ˆ](#7-å›æ»šæ–¹æ¡ˆ)
    - [7.1 å›æ»šå‡†å¤‡](#71-å›æ»šå‡†å¤‡)
    - [7.2 å›æ»šæ­¥éª¤](#72-å›æ»šæ­¥éª¤)
    - [7.3 å›æ»šéªŒè¯](#73-å›æ»šéªŒè¯)
  - [8. æœ€ä½³å®è·µ](#8-æœ€ä½³å®è·µ)
    - [8.1 è¿ç§»è®¡åˆ’](#81-è¿ç§»è®¡åˆ’)
    - [8.2 è¿ç§»æ‰§è¡Œ](#82-è¿ç§»æ‰§è¡Œ)
    - [8.3 è¿ç§»åç»´æŠ¤](#83-è¿ç§»åç»´æŠ¤)
  - [9. å®é™…æ¡ˆä¾‹](#9-å®é™…æ¡ˆä¾‹)
    - [9.1 æ¡ˆä¾‹ï¼šå¤§å‹ç”µå•†ç³»ç»Ÿè¿ç§»](#91-æ¡ˆä¾‹å¤§å‹ç”µå•†ç³»ç»Ÿè¿ç§»)
    - [9.2 æ¡ˆä¾‹ï¼šé‡‘èç³»ç»Ÿè¿ç§»](#92-æ¡ˆä¾‹é‡‘èç³»ç»Ÿè¿ç§»)
  - [ğŸ“š å‚è€ƒèµ„æ–™](#-å‚è€ƒèµ„æ–™)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [æŠ€æœ¯åšå®¢](#æŠ€æœ¯åšå®¢)
    - [ç¤¾åŒºèµ„æº](#ç¤¾åŒºèµ„æº)
  - [ğŸ“Š æ€»ç»“](#-æ€»ç»“)

---

## 1. è¿ç§»æ¦‚è¿°

### 1.0 è¿ç§»å·¥ä½œåŸç†æ¦‚è¿°

**è¿ç§»çš„æœ¬è´¨**ï¼š

PostgreSQL 17 åˆ° 18 çš„è¿ç§»æ˜¯ä¸€ä¸ªç³»ç»ŸåŒ–çš„è¿‡ç¨‹ï¼Œé€šè¿‡åˆç†é€‰æ‹©è¿ç§»ç­–ç•¥ã€æ‰§è¡Œè¿ç§»æ­¥éª¤ã€éªŒè¯è¿ç§»ç»“æœï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§å’Œç³»ç»Ÿç¨³å®šæ€§ã€‚PostgreSQL 18 å¼•å…¥äº†å¼‚æ­¥ I/Oã€æŸ¥è¯¢ä¼˜åŒ–å™¨æ”¹è¿›ç­‰é‡å¤§ç‰¹æ€§ï¼Œè¿ç§»åå¯ä»¥è·å¾—æ˜¾è‘—çš„æ€§èƒ½æå‡ã€‚

**è¿ç§»æµç¨‹å›¾**ï¼š

```mermaid
flowchart TD
    A[è¿ç§»å‰å‡†å¤‡] --> B[ç¯å¢ƒæ£€æŸ¥]
    B --> C[æ•°æ®å¤‡ä»½]
    C --> D[å…¼å®¹æ€§æ£€æŸ¥]
    D --> E{é€‰æ‹©è¿ç§»ç­–ç•¥}
    E -->|pg_upgrade| F[ç›´æ¥å‡çº§]
    E -->|é€»è¾‘å¤åˆ¶| G[é€»è¾‘å¤åˆ¶è¿ç§»]
    E -->|å¯¼å‡ºå¯¼å…¥| H[å¯¼å‡º/å¯¼å…¥è¿ç§»]
    F --> I[è¿ç§»åä¼˜åŒ–]
    G --> I
    H --> I
    I --> J[éªŒè¯æµ‹è¯•]
    J --> K{è¿ç§»æˆåŠŸ?}
    K -->|å¦| L[å›æ»š]
    K -->|æ˜¯| M[åˆ©ç”¨æ–°ç‰¹æ€§]
    M --> N[å®Œæˆè¿ç§»]

    style E fill:#FFD700
    style I fill:#90EE90
    style N fill:#87CEEB
```

**è¿ç§»å…³é”®æŒ‡æ ‡**ï¼š

- **æ•°æ®å®Œæ•´æ€§**ï¼šæ•°æ®è¿ç§»å®Œæ•´æ€§ï¼ˆ100%ï¼‰
- **æ€§èƒ½æå‡**ï¼šæŸ¥è¯¢æ€§èƒ½æå‡ï¼ˆ30-50%ï¼‰
- **åœæœºæ—¶é—´**ï¼šç³»ç»Ÿåœæœºæ—¶é—´ï¼ˆæœ€å°åŒ–ï¼‰
- **å›æ»šèƒ½åŠ›**ï¼šå›æ»šèƒ½åŠ›ï¼ˆæ”¯æŒå¿«é€Ÿå›æ»šï¼‰

### 1.1 PostgreSQL 18 æ–°ç‰¹æ€§

**PostgreSQL 18 çš„ä¸»è¦æ–°ç‰¹æ€§**ï¼š

- **å¼‚æ­¥ I/O å­ç³»ç»Ÿ**ï¼šæ€§èƒ½æå‡é«˜è¾¾ 3 å€ï¼ˆI/O å¯†é›†å‹å·¥ä½œè´Ÿè½½ï¼‰
- **æ–‡æœ¬å¤„ç†æ”¹è¿›**ï¼šPG_UNICODE_FAST æ’åºè§„åˆ™ã€casefold å‡½æ•°ï¼ˆå›½é™…åŒ–æ”¯æŒï¼‰
- **èº«ä»½éªŒè¯å¢å¼º**ï¼šOAuth 2.0 æ”¯æŒã€FIPS æ¨¡å¼ã€TLS v1.3ï¼ˆå®‰å…¨æ€§æå‡ï¼‰
- **å¤åˆ¶åŠŸèƒ½å¢å¼º**ï¼šé€»è¾‘å¤åˆ¶å†™å…¥å†²çªæŠ¥å‘Šã€å¹¶è¡Œæµå¼ä¼ è¾“ï¼ˆé«˜å¯ç”¨æ€§ï¼‰
- **ç”Ÿæˆåˆ—**ï¼šè™šæ‹Ÿç”Ÿæˆåˆ—æ”¯æŒï¼ˆæ•°æ®ä¸€è‡´æ€§ï¼‰
- **uuidv7() å‡½æ•°**ï¼šåŸºäºæ—¶é—´çš„ UUID ç”Ÿæˆï¼ˆåˆ†å¸ƒå¼ç³»ç»Ÿï¼‰
- **æŸ¥è¯¢æ€§èƒ½æå‡**ï¼šæŸ¥è¯¢ä¼˜åŒ–å™¨å’Œæ‰§è¡Œå¼•æ“æ”¹è¿›ï¼ˆè‡ªåŠ¨ä¼˜åŒ–ï¼‰
- **å‘é‡æ•°æ®åº“å¢å¼º**ï¼špgvector é›†æˆä¼˜åŒ–ï¼ˆAI åº”ç”¨ï¼‰

**ä¸»è¦å˜åŒ–å½±å“**ï¼š

```sql
-- 1. å¼‚æ­¥ I/Oï¼ˆæ–°ç‰¹æ€§ï¼Œè‡ªåŠ¨å¯ç”¨ï¼‰
-- è¿ç§»åè‡ªåŠ¨ç”Ÿæ•ˆï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
-- I/O å¯†é›†å‹æŸ¥è¯¢æ€§èƒ½æå‡ 3 å€

-- 2. ç”Ÿæˆåˆ—ï¼ˆæ–°ç‰¹æ€§ï¼‰
-- è¿ç§»å‰ï¼šéœ€è¦è§¦å‘å™¨ç»´æŠ¤è®¡ç®—åˆ—
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    price DECIMAL(10,2),
    quantity INTEGER,
    total DECIMAL(10,2)  -- éœ€è¦è§¦å‘å™¨æ›´æ–°
);

-- è¿ç§»åï¼šä½¿ç”¨ç”Ÿæˆåˆ—
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    price DECIMAL(10,2),
    quantity INTEGER,
    total DECIMAL(10,2) GENERATED ALWAYS AS (price * quantity) STORED
);

-- 3. uuidv7() å‡½æ•°ï¼ˆæ–°ç‰¹æ€§ï¼‰
-- è¿ç§»å‰ï¼šä½¿ç”¨ uuid_generate_v4()
SELECT uuid_generate_v4();

-- è¿ç§»åï¼šä½¿ç”¨ uuidv7()ï¼ˆåŸºäºæ—¶é—´ï¼Œæœ‰åºï¼‰
SELECT uuidv7();
```

### 1.2 è¿ç§»æ”¶ç›Š

**è¿ç§»åˆ° PostgreSQL 18 çš„ä¸»è¦æ”¶ç›Š**ï¼š

- **æ€§èƒ½æå‡**ï¼šæŸ¥è¯¢æ€§èƒ½æå‡ 30-50%ï¼ˆå¼‚æ­¥ I/Oã€æŸ¥è¯¢ä¼˜åŒ–å™¨æ”¹è¿›ï¼‰
- **æ–°åŠŸèƒ½**ï¼šæ”¯æŒæ›´å¤š SQL æ ‡å‡†å’Œåˆ›æ–°åŠŸèƒ½ï¼ˆç”Ÿæˆåˆ—ã€uuidv7ï¼‰
- **å®‰å…¨æ€§å¢å¼º**ï¼šOAuth 2.0ã€FIPS æ¨¡å¼ã€TLS v1.3ï¼ˆä¼ä¸šçº§å®‰å…¨ï¼‰
- **å¯è§‚æµ‹æ€§å¢å¼º**ï¼šæ›´å¼ºå¤§çš„ç›‘æ§å’Œè¯Šæ–­èƒ½åŠ›ï¼ˆæ€§èƒ½åˆ†æï¼‰
- **äº‘åŸç”Ÿç‰¹æ€§**ï¼šäº‘ç¯å¢ƒä¸‹çš„ä¼˜åŒ–å’Œç‰¹æ€§ï¼ˆServerlessã€åˆ†æ”¯ï¼‰

**æ€§èƒ½æå‡ç¤ºä¾‹**ï¼š

```sql
-- è¿ç§»å‰ï¼ˆPostgreSQL 17ï¼‰ï¼šæŸ¥è¯¢æ—¶é—´ 100ms
EXPLAIN ANALYZE SELECT * FROM large_table WHERE id = 123;

-- è¿ç§»åï¼ˆPostgreSQL 18ï¼‰ï¼šæŸ¥è¯¢æ—¶é—´ 50msï¼ˆæ€§èƒ½æå‡ 50%ï¼‰
-- å¼‚æ­¥ I/O å’ŒæŸ¥è¯¢ä¼˜åŒ–å™¨æ”¹è¿›è‡ªåŠ¨ç”Ÿæ•ˆ
EXPLAIN ANALYZE SELECT * FROM large_table WHERE id = 123;
```

### 1.3 è¿ç§»é£é™©è¯„ä¼°

**è¿ç§»é£é™©è¯„ä¼°**ï¼š

- **å…¼å®¹æ€§é£é™©**ï¼šä¸­ç­‰ï¼ˆå¤§éƒ¨åˆ†å…¼å®¹ï¼Œå°‘æ•°ä¸å…¼å®¹ï¼‰
  - å¤§éƒ¨åˆ†æ‰©å±•å…¼å®¹ PostgreSQL 18
  - å°‘æ•°æ‰©å±•éœ€è¦æ›´æ–°ç‰ˆæœ¬
- **æ€§èƒ½é£é™©**ï¼šä½ï¼ˆæ€§èƒ½é€šå¸¸æå‡ï¼‰
  - å¼‚æ­¥ I/O è‡ªåŠ¨å¯ç”¨ï¼Œæ€§èƒ½æå‡
  - æŸ¥è¯¢ä¼˜åŒ–å™¨æ”¹è¿›ï¼ŒæŸ¥è¯¢æ›´å¿«
- **ç¨³å®šæ€§é£é™©**ï¼šä½ï¼ˆPostgreSQL 18 ç¨³å®šå¯é ï¼‰
  - PostgreSQL 18 ç»è¿‡å……åˆ†æµ‹è¯•
  - ç”Ÿäº§ç¯å¢ƒéªŒè¯ç¨³å®š
- **å›æ»šé£é™©**ï¼šä½ï¼ˆå¯ä»¥å›æ»šåˆ° PostgreSQL 17ï¼‰
  - ä¿ç•™ PostgreSQL 17 æ•°æ®ç›®å½•
  - æ”¯æŒå¿«é€Ÿå›æ»š

---

## 2. è¿ç§»å‰å‡†å¤‡

### 2.1 ç¯å¢ƒæ£€æŸ¥

```bash
# 1. æ£€æŸ¥å½“å‰ PostgreSQL ç‰ˆæœ¬
psql --version

# 2. æ£€æŸ¥ç³»ç»Ÿèµ„æº
free -h
df -h
lscpu

# 3. æ£€æŸ¥ PostgreSQL é…ç½®
psql -c "SHOW ALL;" > pg17_config.txt

# 4. æ£€æŸ¥æ•°æ®åº“å¤§å°
psql -c "
SELECT
    pg_database.datname,
    pg_size_pretty(pg_database_size(pg_database.datname)) AS size
FROM pg_database
ORDER BY pg_database_size(pg_database.datname) DESC;
"

# 5. æ£€æŸ¥æ‰©å±•
psql -c "
SELECT
    extname,
    extversion
FROM pg_extension
ORDER BY extname;
"
```

### 2.2 æ•°æ®å¤‡ä»½

```bash
# 1. å®Œæ•´å¤‡ä»½
pg_dumpall -U postgres -f pg17_backup.sql

# 2. å•ä¸ªæ•°æ®åº“å¤‡ä»½
pg_dump -U postgres -F c -f database_backup.dump database_name

# 3. éªŒè¯å¤‡ä»½
pg_restore --list database_backup.dump

# 4. å¤‡ä»½é…ç½®æ–‡ä»¶
cp $PGDATA/postgresql.conf postgresql.conf.backup
cp $PGDATA/pg_hba.conf pg_hba.conf.backup
```

### 2.3 å…¼å®¹æ€§æ£€æŸ¥

```sql
-- 1. æ£€æŸ¥ä¸å…¼å®¹çš„ SQL è¯­æ³•
-- PostgreSQL 18 ä¸­ md5 å¯†ç è®¤è¯å·²å¼ƒç”¨
SELECT
    usename,
    passwd
FROM pg_shadow
WHERE passwd LIKE 'md5%';

-- 2. æ£€æŸ¥ä½¿ç”¨çš„å‡½æ•°
SELECT
    routine_name,
    routine_type
FROM information_schema.routines
WHERE routine_schema = 'public';

-- 3. æ£€æŸ¥æ•°æ®ç±»å‹
SELECT
    typname,
    typtype
FROM pg_type
WHERE typnamespace = (SELECT oid FROM pg_namespace WHERE nspname = 'public');
```

### 2.4 æµ‹è¯•ç¯å¢ƒå‡†å¤‡

```bash
# 1. åˆ›å»ºæµ‹è¯•ç¯å¢ƒ
# åœ¨æµ‹è¯•æœåŠ¡å™¨ä¸Šå®‰è£… PostgreSQL 18

# 2. æ¢å¤æµ‹è¯•æ•°æ®
pg_restore -U postgres -d test_database database_backup.dump

# 3. è¿è¡Œæµ‹è¯•è„šæœ¬
psql -U postgres -d test_database -f test_queries.sql
```

---

## 3. è¿ç§»æ­¥éª¤

### 3.1 å®‰è£… PostgreSQL 18

```bash
# 1. ä¸‹è½½ PostgreSQL 18
# æ ¹æ®æ“ä½œç³»ç»Ÿé€‰æ‹©å®‰è£…æ–¹å¼

# Ubuntu/Debian
sudo apt-get update
sudo apt-get install postgresql-18

# CentOS/RHEL
sudo yum install postgresql18-server

# 2. åˆå§‹åŒ–æ•°æ®åº“
sudo /usr/pgsql-18/bin/postgresql-18-setup initdb

# 3. å¯åŠ¨ PostgreSQL 18
sudo systemctl start postgresql-18
sudo systemctl enable postgresql-18
```

### 3.2 æ•°æ®è¿ç§»

**æ•°æ®è¿ç§»æ–¹æ³•å¯¹æ¯”**ï¼š

| æ–¹æ³• | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|
| **pg_upgrade** | å¿«é€Ÿã€æ•°æ®å®Œæ•´ | éœ€è¦åœæœº | ä¸­å°è§„æ¨¡ã€å¯åœæœº |
| **pg_dump/pg_restore** | ç®€å•ã€å¯æ§ | æ…¢ã€éœ€è¦åœæœº | å°è§„æ¨¡ã€æ•°æ®é‡å° |
| **é€»è¾‘å¤åˆ¶** | é›¶åœæœºã€å¯å›æ»š | é…ç½®å¤æ‚ | å¤§è§„æ¨¡ã€é«˜å¯ç”¨ |

**æ–¹æ³• 1ï¼šä½¿ç”¨ pg_upgradeï¼ˆæ¨èï¼Œå¿«é€Ÿå‡çº§ï¼‰**:

```bash
# 1. åœæ­¢ PostgreSQL 17
sudo systemctl stop postgresql-17

# 2. è¿è¡Œ pg_upgrade æ£€æŸ¥ï¼ˆå¿…é¡»æ­¥éª¤ï¼‰
sudo -u postgres /usr/pgsql-18/bin/pg_upgrade \
    --old-datadir=/var/lib/pgsql/17/data \
    --new-datadir=/var/lib/pgsql/18/data \
    --old-bindir=/usr/pgsql-17/bin \
    --new-bindir=/usr/pgsql-18/bin \
    --check

# æ£€æŸ¥è¾“å‡ºï¼Œç¡®ä¿æ²¡æœ‰é”™è¯¯

# 3. æ‰§è¡Œå‡çº§
sudo -u postgres /usr/pgsql-18/bin/pg_upgrade \
    --old-datadir=/var/lib/pgsql/17/data \
    --new-datadir=/var/lib/pgsql/18/data \
    --old-bindir=/usr/pgsql-17/bin \
    --new-bindir=/usr/pgsql-18/bin \
    --jobs=4  # å¹¶è¡Œä½œä¸šæ•°ï¼ˆæ ¹æ®CPUæ ¸å¿ƒæ•°è°ƒæ•´ï¼‰

# 4. å¯åŠ¨ PostgreSQL 18
sudo systemctl start postgresql-18

# 5. éªŒè¯å‡çº§
psql -c "SELECT version();"
psql -c "SELECT extname, extversion FROM pg_extension;"
```

**æ–¹æ³• 2ï¼šä½¿ç”¨ pg_dump/pg_restoreï¼ˆç®€å•å¯æ§ï¼‰**:

```bash
# 1. ä» PostgreSQL 17 å¯¼å‡ºï¼ˆè‡ªå®šä¹‰æ ¼å¼ï¼Œæ”¯æŒå¹¶è¡Œï¼‰
pg_dump -U postgres -F c -f database_backup.dump database_name

# 2. åˆ›å»º PostgreSQL 18 æ•°æ®åº“
createdb -U postgres database_name

# 3. å¯¼å…¥åˆ° PostgreSQL 18ï¼ˆå¹¶è¡Œæ¢å¤ï¼Œæå‡é€Ÿåº¦ï¼‰
pg_restore -U postgres -d database_name \
    -j 4 \  # å¹¶è¡Œä½œä¸šæ•°
    database_backup.dump

# 4. éªŒè¯æ•°æ®
psql -U postgres -d database_name -c "SELECT COUNT(*) FROM table_name;"
```

**æ–¹æ³• 3ï¼šä½¿ç”¨é€»è¾‘å¤åˆ¶ï¼ˆé›¶åœæœºè¿ç§»ï¼‰**:

```sql
-- 1. åœ¨ PostgreSQL 17 ä¸Šåˆ›å»ºå‘å¸ƒ
CREATE PUBLICATION pg17_pub FOR ALL TABLES;

-- 2. åœ¨ PostgreSQL 18 ä¸Šåˆ›å»ºè®¢é˜…
CREATE SUBSCRIPTION pg18_sub
CONNECTION 'host=pg17_host dbname=mydb user=replicator password=password'
PUBLICATION pg17_pub
WITH (
    copy_data = true,
    create_slot = true,
    enabled = true
);

-- 3. ç›‘æ§å¤åˆ¶è¿›åº¦
SELECT * FROM pg_stat_subscription;

-- 4. ç­‰å¾…æ•°æ®åŒæ­¥å®Œæˆ
SELECT
    application_name,
    state,
    sync_state,
    pg_wal_lsn_diff(pg_current_wal_lsn(), sent_lsn) AS lag_bytes
FROM pg_stat_subscription;

-- 5. åˆ‡æ¢åº”ç”¨è¿æ¥åˆ° PostgreSQL 18
-- 6. åœæ­¢è®¢é˜…
DROP SUBSCRIPTION pg18_sub;
```

**æ•°æ®è¿ç§»æœ€ä½³å®è·µ**ï¼š

```bash
# âœ… å¥½ï¼šä½¿ç”¨ --check å…ˆæ£€æŸ¥ï¼ˆé¿å…å‡çº§å¤±è´¥ï¼‰
pg_upgrade --check ...

# âœ… å¥½ï¼šä½¿ç”¨ --jobs å¹¶è¡Œå‡çº§ï¼ˆæå‡é€Ÿåº¦ï¼‰
pg_upgrade --jobs=4 ...

# âœ… å¥½ï¼šä¿ç•™æ—§ç‰ˆæœ¬æ•°æ®ç›®å½•ï¼ˆæ”¯æŒå›æ»šï¼‰
# ä¸è¦ç«‹å³åˆ é™¤æ—§ç‰ˆæœ¬æ•°æ®ç›®å½•

# âœ… å¥½ï¼šè¿ç§»åç«‹å³è¿è¡Œ ANALYZEï¼ˆæ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼‰
psql -c "ANALYZE;"

# âœ… å¥½ï¼šéªŒè¯æ•°æ®å®Œæ•´æ€§
psql -c "SELECT COUNT(*) FROM table_name;"
psql -c "SELECT SUM(amount) FROM orders;"

# âŒ ä¸å¥½ï¼šä¸æ£€æŸ¥å°±å‡çº§ï¼ˆå¯èƒ½å¯¼è‡´å‡çº§å¤±è´¥ï¼‰
# âŒ ä¸å¥½ï¼šç«‹å³åˆ é™¤æ—§ç‰ˆæœ¬ï¼ˆæ— æ³•å›æ»šï¼‰
```

### 3.3 é…ç½®è¿ç§»

**é…ç½®è¿ç§»æ¦‚è¿°**ï¼š

PostgreSQL 18 çš„é…ç½®å‚æ•°å¤§éƒ¨åˆ†ä¸ PostgreSQL 17 å…¼å®¹ï¼Œä½†éœ€è¦æ£€æŸ¥å¹¶æ›´æ–°éƒ¨åˆ†å‚æ•°ä»¥åˆ©ç”¨æ–°ç‰¹æ€§ã€‚

**é…ç½®è¿ç§»æ­¥éª¤**ï¼š

```bash
# 1. å¤‡ä»½ PostgreSQL 17 é…ç½®
cp /var/lib/pgsql/17/data/postgresql.conf /var/lib/pgsql/17/data/postgresql.conf.backup
cp /var/lib/pgsql/17/data/pg_hba.conf /var/lib/pgsql/17/data/pg_hba.conf.backup

# 2. è¿ç§» pg_hba.confï¼ˆè®¤è¯é…ç½®ï¼‰
cp /var/lib/pgsql/17/data/pg_hba.conf /var/lib/pgsql/18/data/pg_hba.conf

# 3. æ›´æ–° postgresql.confï¼ˆæ€§èƒ½å‚æ•°ï¼‰
# æ£€æŸ¥å¹¶æ›´æ–°ä»¥ä¸‹å‚æ•°ï¼š

# å†…å­˜é…ç½®ï¼ˆæ ¹æ®æœåŠ¡å™¨å†…å­˜è°ƒæ•´ï¼‰
shared_buffers = 4GB  # 25% RAM
work_mem = 64MB
maintenance_work_mem = 1GB
effective_cache_size = 12GB  # 50-75% RAM

# è¿æ¥é…ç½®
max_connections = 200

# å¼‚æ­¥ I/O é…ç½®ï¼ˆPostgreSQL 18 æ–°ç‰¹æ€§ï¼Œè‡ªåŠ¨å¯ç”¨ï¼‰
# æ— éœ€æ‰‹åŠ¨é…ç½®ï¼Œç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨å¼‚æ­¥ I/O

# æŸ¥è¯¢ä¼˜åŒ–å™¨é…ç½®
random_page_cost = 1.1  # SSD
effective_io_concurrency = 200  # SSD

# 4. éªŒè¯é…ç½®
psql -c "SHOW shared_buffers;"
psql -c "SHOW work_mem;"
psql -c "SHOW max_connections;"

# 5. é‡æ–°åŠ è½½é…ç½®
sudo systemctl reload postgresql-18

# 6. éªŒè¯é…ç½®ç”Ÿæ•ˆ
psql -c "SELECT name, setting FROM pg_settings WHERE name IN ('shared_buffers', 'work_mem', 'max_connections');"
```

**PostgreSQL 18 æ–°é…ç½®å‚æ•°**ï¼š

```sql
-- 1. å¼‚æ­¥ I/O ç›¸å…³å‚æ•°ï¼ˆè‡ªåŠ¨å¯ç”¨ï¼Œæ— éœ€é…ç½®ï¼‰
-- ç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨å¼‚æ­¥ I/Oï¼Œæ€§èƒ½æå‡ 3 å€

-- 2. æŸ¥è¯¢ä¼˜åŒ–å™¨å¢å¼ºï¼ˆè‡ªåŠ¨å¯ç”¨ï¼‰
-- æŸ¥è¯¢ä¼˜åŒ–å™¨è‡ªåŠ¨ä½¿ç”¨æ–°ç®—æ³•ï¼Œæ— éœ€é…ç½®

-- 3. ç”Ÿæˆåˆ—æ”¯æŒï¼ˆSQL è¯­æ³•ï¼Œæ— éœ€é…ç½®ï¼‰
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    price DECIMAL(10,2),
    quantity INTEGER,
    total DECIMAL(10,2) GENERATED ALWAYS AS (price * quantity) STORED
);
```

**é…ç½®è¿ç§»æœ€ä½³å®è·µ**ï¼š

```bash
# âœ… å¥½ï¼šå¤‡ä»½åŸé…ç½®ï¼ˆæ”¯æŒå›æ»šï¼‰
cp postgresql.conf postgresql.conf.backup

# âœ… å¥½ï¼šæ ¹æ®ç¡¬ä»¶è°ƒæ•´é…ç½®ï¼ˆæå‡æ€§èƒ½ï¼‰
# 16GB RAM æœåŠ¡å™¨
shared_buffers = 4GB
work_mem = 64MB
effective_cache_size = 12GB

# âœ… å¥½ï¼šéªŒè¯é…ç½®ç”Ÿæ•ˆï¼ˆç¡®ä¿é…ç½®æ­£ç¡®ï¼‰
psql -c "SHOW shared_buffers;"

# âœ… å¥½ï¼šé€æ­¥è°ƒæ•´é…ç½®ï¼ˆé¿å…ä¸€æ¬¡æ€§å¤§æ”¹ï¼‰
# å…ˆè¿ç§»åŸºæœ¬é…ç½®ï¼Œå†é€æ­¥ä¼˜åŒ–

# âŒ ä¸å¥½ï¼šç›´æ¥å¤åˆ¶é…ç½®ï¼ˆå¯èƒ½ä¸å…¼å®¹ï¼‰
# âŒ ä¸å¥½ï¼šå¿½ç•¥é…ç½®éªŒè¯ï¼ˆå¯èƒ½å¯¼è‡´é—®é¢˜ï¼‰
```

### 3.4 æ‰©å±•è¿ç§»

```sql
-- 1. æ£€æŸ¥æ‰©å±•å…¼å®¹æ€§
-- åœ¨ PostgreSQL 18 ä¸­æ£€æŸ¥æ‰©å±•æ˜¯å¦å¯ç”¨

-- 2. å®‰è£…æ‰©å±•
CREATE EXTENSION IF NOT EXISTS vector;
CREATE EXTENSION IF NOT EXISTS timescaledb;
CREATE EXTENSION IF NOT EXISTS postgis;

-- 3. æ›´æ–°æ‰©å±•ç‰ˆæœ¬
ALTER EXTENSION vector UPDATE;
ALTER EXTENSION timescaledb UPDATE;
ALTER EXTENSION postgis UPDATE;

-- 4. éªŒè¯æ‰©å±•
SELECT
    extname,
    extversion
FROM pg_extension
ORDER BY extname;
```

---

## 4. å…¼å®¹æ€§é—®é¢˜

### 4.1 SQL å…¼å®¹æ€§

```sql
-- PostgreSQL 18 å…¼å®¹æ€§é—®é¢˜
-- 1. md5 å¯†ç è®¤è¯å·²å¼ƒç”¨
-- éœ€è¦è¿ç§»åˆ° SCRAM-SHA-256
ALTER USER username WITH PASSWORD 'new_password';

-- 2. æ–° SQL è¯­æ³•æ”¯æŒ
-- PostgreSQL 18 æ”¯æŒæ›´å¤š SQL æ ‡å‡†è¯­æ³•
-- ä¾‹å¦‚ï¼šç”Ÿæˆåˆ—ã€uuidv7() å‡½æ•°ç­‰

-- 3. å‡½æ•°è¡Œä¸ºå˜åŒ–
-- æŸäº›å‡½æ•°çš„è¡Œä¸ºå¯èƒ½æœ‰ç»†å¾®å˜åŒ–
-- éœ€è¦æµ‹è¯•éªŒè¯
```

### 4.2 å‡½æ•°å…¼å®¹æ€§

```sql
-- æ£€æŸ¥å‡½æ•°å…¼å®¹æ€§
-- 1. æ£€æŸ¥è‡ªå®šä¹‰å‡½æ•°
SELECT
    routine_name,
    routine_definition
FROM information_schema.routines
WHERE routine_schema = 'public'
AND routine_type = 'FUNCTION';

-- 2. æµ‹è¯•å‡½æ•°
-- åœ¨ PostgreSQL 18 ä¸­æµ‹è¯•æ‰€æœ‰è‡ªå®šä¹‰å‡½æ•°

-- 3. æ›´æ–°å‡½æ•°
-- æ ¹æ® PostgreSQL 18 çš„æ–°ç‰¹æ€§æ›´æ–°å‡½æ•°
```

### 4.3 æ•°æ®ç±»å‹å…¼å®¹æ€§

```sql
-- æ•°æ®ç±»å‹å…¼å®¹æ€§
-- PostgreSQL 18 æ–°å¢æ•°æ®ç±»å‹ï¼š
-- - halfvec (åŠç²¾åº¦å‘é‡)
-- - sparsevec (ç¨€ç–å‘é‡)

-- æ£€æŸ¥æ•°æ®ç±»å‹ä½¿ç”¨
SELECT
    table_name,
    column_name,
    data_type
FROM information_schema.columns
WHERE table_schema = 'public';
```

### 4.4 é…ç½®å‚æ•°å…¼å®¹æ€§

```bash
# é…ç½®å‚æ•°å…¼å®¹æ€§
# 1. æ£€æŸ¥é…ç½®å‚æ•°
psql -c "SHOW ALL;" > pg18_config.txt

# 2. å¯¹æ¯”é…ç½®å‚æ•°
diff pg17_config.txt pg18_config.txt

# 3. æ›´æ–°é…ç½®å‚æ•°
# æ ¹æ® PostgreSQL 18 çš„æ–°å‚æ•°æ›´æ–°é…ç½®
```

---

## 5. è¿ç§»åéªŒè¯

### 5.1 åŠŸèƒ½éªŒè¯

```sql
-- 1. éªŒè¯æ•°æ®åº“è¿æ¥
SELECT version();

-- 2. éªŒè¯è¡¨ç»“æ„
SELECT
    table_name,
    column_name,
    data_type
FROM information_schema.columns
WHERE table_schema = 'public'
ORDER BY table_name, ordinal_position;

-- 3. éªŒè¯æ•°æ®å®Œæ•´æ€§
SELECT
    schemaname,
    tablename,
    n_tup_ins AS inserts,
    n_tup_upd AS updates,
    n_tup_del AS deletes
FROM pg_stat_user_tables
ORDER BY schemaname, tablename;

-- 4. éªŒè¯ç´¢å¼•
SELECT
    schemaname,
    tablename,
    indexname,
    indexdef
FROM pg_indexes
WHERE schemaname = 'public'
ORDER BY tablename, indexname;
```

### 5.2 æ€§èƒ½éªŒè¯

```sql
-- 1. æ€§èƒ½åŸºå‡†æµ‹è¯•
-- è¿è¡Œæ€§èƒ½æµ‹è¯•è„šæœ¬
EXPLAIN ANALYZE
SELECT * FROM large_table WHERE id = 1;

-- 2. æŸ¥è¯¢æ€§èƒ½å¯¹æ¯”
-- å¯¹æ¯” PostgreSQL 17 å’Œ 18 çš„æŸ¥è¯¢æ€§èƒ½

-- 3. å¹¶å‘æ€§èƒ½æµ‹è¯•
-- æµ‹è¯•å¹¶å‘æŸ¥è¯¢æ€§èƒ½
```

### 5.3 æ•°æ®å®Œæ•´æ€§éªŒè¯

```sql
-- 1. æ•°æ®è¡Œæ•°éªŒè¯
SELECT
    schemaname,
    tablename,
    n_live_tup AS row_count
FROM pg_stat_user_tables
WHERE schemaname = 'public'
ORDER BY tablename;

-- 2. æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥
-- è¿è¡Œæ•°æ®ä¸€è‡´æ€§æ£€æŸ¥è„šæœ¬

-- 3. å¤–é”®çº¦æŸéªŒè¯
SELECT
    tc.table_name,
    kcu.column_name,
    ccu.table_name AS foreign_table_name,
    ccu.column_name AS foreign_column_name
FROM information_schema.table_constraints AS tc
JOIN information_schema.key_column_usage AS kcu
    ON tc.constraint_name = kcu.constraint_name
JOIN information_schema.constraint_column_usage AS ccu
    ON ccu.constraint_name = tc.constraint_name
WHERE tc.constraint_type = 'FOREIGN KEY'
AND tc.table_schema = 'public';
```

---

## 6. æ€§èƒ½ä¼˜åŒ–

### 6.1 é…ç½®ä¼˜åŒ–

**PostgreSQL 18 é…ç½®ä¼˜åŒ–**ï¼š

PostgreSQL 18 å¼•å…¥äº†å¼‚æ­¥ I/O ç­‰æ–°ç‰¹æ€§ï¼Œé…ç½®ä¼˜åŒ–å¯ä»¥è¿›ä¸€æ­¥æå‡æ€§èƒ½ã€‚

**é…ç½®ä¼˜åŒ–ç¤ºä¾‹**ï¼š

```sql
-- 1. å†…å­˜é…ç½®ä¼˜åŒ–ï¼ˆæ ¹æ®æœåŠ¡å™¨å†…å­˜è°ƒæ•´ï¼‰
-- postgresql.conf

-- å…±äº«å†…å­˜ï¼ˆ25% RAMï¼‰
shared_buffers = 4GB

-- å·¥ä½œå†…å­˜ï¼ˆæ¯ä¸ªæŸ¥è¯¢æ“ä½œï¼‰
work_mem = 64MB

-- ç»´æŠ¤å·¥ä½œå†…å­˜ï¼ˆç»´æŠ¤æ“ä½œï¼‰
maintenance_work_mem = 1GB

-- æœ‰æ•ˆç¼“å­˜å¤§å°ï¼ˆ50-75% RAMï¼‰
effective_cache_size = 12GB

-- 2. å¼‚æ­¥ I/O é…ç½®ï¼ˆPostgreSQL 18 æ–°ç‰¹æ€§ï¼Œè‡ªåŠ¨å¯ç”¨ï¼‰
-- æ— éœ€æ‰‹åŠ¨é…ç½®ï¼Œç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨å¼‚æ­¥ I/O
-- I/O å¯†é›†å‹æŸ¥è¯¢æ€§èƒ½æå‡ 3 å€

-- 3. æŸ¥è¯¢ä¼˜åŒ–å™¨é…ç½®ï¼ˆåˆ©ç”¨æ–°ç‰¹æ€§ï¼‰
-- SSD é…ç½®
random_page_cost = 1.1
effective_io_concurrency = 200

-- 4. è¿æ¥é…ç½®
max_connections = 200

-- 5. åº”ç”¨é…ç½®
ALTER SYSTEM SET shared_buffers = '4GB';
ALTER SYSTEM SET work_mem = '64MB';
ALTER SYSTEM SET effective_cache_size = '12GB';
SELECT pg_reload_conf();
```

**é…ç½®ä¼˜åŒ–æœ€ä½³å®è·µ**ï¼š

```sql
-- âœ… å¥½ï¼šæ ¹æ®ç¡¬ä»¶è°ƒæ•´é…ç½®ï¼ˆæå‡æ€§èƒ½ï¼‰
-- 16GB RAM æœåŠ¡å™¨
shared_buffers = 4GB
work_mem = 64MB
effective_cache_size = 12GB

-- âœ… å¥½ï¼šåˆ©ç”¨å¼‚æ­¥ I/Oï¼ˆPostgreSQL 18 è‡ªåŠ¨å¯ç”¨ï¼‰
-- æ— éœ€æ‰‹åŠ¨é…ç½®ï¼Œç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨å¼‚æ­¥ I/O

-- âœ… å¥½ï¼šéªŒè¯é…ç½®ç”Ÿæ•ˆï¼ˆç¡®ä¿é…ç½®æ­£ç¡®ï¼‰
SELECT name, setting FROM pg_settings
WHERE name IN ('shared_buffers', 'work_mem', 'effective_cache_size');

-- âŒ ä¸å¥½ï¼šä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆå¯èƒ½ä¸æ˜¯æœ€ä¼˜ï¼‰
-- âŒ ä¸å¥½ï¼šå¿½ç•¥é…ç½®éªŒè¯ï¼ˆå¯èƒ½å¯¼è‡´é—®é¢˜ï¼‰
```

### 6.2 ç´¢å¼•ä¼˜åŒ–

```sql
-- 1. é‡å»ºç´¢å¼•
REINDEX DATABASE database_name;

-- 2. æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
ANALYZE;

-- 3. æ£€æŸ¥ç´¢å¼•ä½¿ç”¨æƒ…å†µ
SELECT
    schemaname,
    tablename,
    indexname,
    idx_scan,
    idx_tup_read,
    idx_tup_fetch
FROM pg_stat_user_indexes
WHERE schemaname = 'public'
ORDER BY idx_scan DESC;
```

### 6.3 æŸ¥è¯¢ä¼˜åŒ–

```sql
-- 1. åˆ†ææ…¢æŸ¥è¯¢
SELECT
    query,
    calls,
    total_time,
    mean_time,
    max_time
FROM pg_stat_statements
ORDER BY mean_time DESC
LIMIT 10;

-- 2. ä¼˜åŒ–æŸ¥è¯¢è®¡åˆ’
EXPLAIN ANALYZE
SELECT * FROM large_table WHERE condition;

-- 3. ä½¿ç”¨ PostgreSQL 18 æ–°ç‰¹æ€§
-- ä¾‹å¦‚ï¼šç”Ÿæˆåˆ—ã€æ–°ç´¢å¼•ç±»å‹ç­‰
```

---

## 7. å›æ»šæ–¹æ¡ˆ

### 7.1 å›æ»šå‡†å¤‡

```bash
# 1. ä¿ç•™ PostgreSQL 17 å®‰è£…
# ä¸è¦ç«‹å³å¸è½½ PostgreSQL 17

# 2. ä¿ç•™æ•°æ®å¤‡ä»½
# ç¡®ä¿æœ‰å®Œæ•´çš„æ•°æ®å¤‡ä»½

# 3. è®°å½•è¿ç§»æ­¥éª¤
# è®°å½•æ‰€æœ‰è¿ç§»æ­¥éª¤ï¼Œä¾¿äºå›æ»š
```

### 7.2 å›æ»šæ­¥éª¤

```bash
# 1. åœæ­¢ PostgreSQL 18
sudo systemctl stop postgresql-18

# 2. æ¢å¤ PostgreSQL 17 æ•°æ®
# å¦‚æœæœ‰ pg_upgrade å¤‡ä»½
sudo -u postgres /usr/pgsql-17/bin/pg_upgrade \
    --old-datadir=/var/lib/pgsql/18/data \
    --new-datadir=/var/lib/pgsql/17/data \
    --old-bindir=/usr/pgsql-18/bin \
    --new-bindir=/usr/pgsql-17/bin

# æˆ–è€…ä»å¤‡ä»½æ¢å¤
pg_restore -U postgres -d database_name database_backup.dump

# 3. å¯åŠ¨ PostgreSQL 17
sudo systemctl start postgresql-17

# 4. éªŒè¯å›æ»š
psql -U postgres -c "SELECT version();"
```

### 7.3 å›æ»šéªŒè¯

```sql
-- 1. éªŒè¯æ•°æ®åº“è¿æ¥
SELECT version();

-- 2. éªŒè¯æ•°æ®å®Œæ•´æ€§
SELECT
    schemaname,
    tablename,
    n_live_tup AS row_count
FROM pg_stat_user_tables
WHERE schemaname = 'public';

-- 3. éªŒè¯åŠŸèƒ½
-- è¿è¡ŒåŠŸèƒ½æµ‹è¯•è„šæœ¬
```

---

## 8. æœ€ä½³å®è·µ

### 8.1 è¿ç§»è®¡åˆ’

**æ¨èåšæ³•**ï¼š

1. **è¯„ä¼°è¿ç§»æ”¶ç›Šå’Œé£é™©**ï¼ˆå…¨é¢è¯„ä¼°ï¼‰

   ```bash
   # âœ… å¥½ï¼šè¯„ä¼°è¿ç§»æ”¶ç›Šï¼ˆæ€§èƒ½æå‡ã€æ–°åŠŸèƒ½ï¼‰
   # æ€§èƒ½æå‡ï¼š30-50%
   # æ–°åŠŸèƒ½ï¼šç”Ÿæˆåˆ—ã€uuidv7()ã€å¼‚æ­¥ I/O

   # âœ… å¥½ï¼šè¯„ä¼°è¿ç§»é£é™©ï¼ˆå…¼å®¹æ€§ã€ç¨³å®šæ€§ï¼‰
   # å…¼å®¹æ€§é£é™©ï¼šä¸­ç­‰
   # ç¨³å®šæ€§é£é™©ï¼šä½
   ```

2. **åˆ¶å®šè¯¦ç»†çš„è¿ç§»è®¡åˆ’**ï¼ˆè¯¦ç»†æ­¥éª¤ï¼‰

   ```bash
   # âœ… å¥½ï¼šåˆ¶å®šè¯¦ç»†çš„è¿ç§»è®¡åˆ’
   # 1. è¿ç§»å‰å‡†å¤‡ï¼ˆ1å‘¨ï¼‰
   #    - ç¯å¢ƒæ£€æŸ¥
   #    - æ•°æ®å¤‡ä»½
   #    - å…¼å®¹æ€§æ£€æŸ¥
   # 2. æµ‹è¯•ç¯å¢ƒè¿ç§»ï¼ˆ1å‘¨ï¼‰
   #    - æ‰§è¡Œè¿ç§»
   #    - åŠŸèƒ½éªŒè¯
   #    - æ€§èƒ½æµ‹è¯•
   # 3. ç”Ÿäº§ç¯å¢ƒè¿ç§»ï¼ˆ1å¤©ï¼‰
   #    - æ‰§è¡Œè¿ç§»
   #    - éªŒè¯ç»“æœ
   #    - ç›‘æ§æ€§èƒ½
   ```

3. **å‡†å¤‡æµ‹è¯•ç¯å¢ƒ**ï¼ˆé™ä½é£é™©ï¼‰

   ```bash
   # âœ… å¥½ï¼šæ­å»ºä¸ç”Ÿäº§ç¯å¢ƒç›¸åŒçš„æµ‹è¯•ç¯å¢ƒ
   # 1. ç›¸åŒç¡¬ä»¶é…ç½®
   # 2. ç›¸åŒæ•°æ®é‡
   # 3. ç›¸åŒåº”ç”¨è´Ÿè½½
   ```

**é¿å…åšæ³•**ï¼š

1. **é¿å…ä¸è¯„ä¼°å°±è¿ç§»**ï¼ˆé£é™©é«˜ï¼‰
2. **é¿å…è·³è¿‡æµ‹è¯•ç¯å¢ƒ**ï¼ˆå¯èƒ½å¯¼è‡´ç”Ÿäº§é—®é¢˜ï¼‰

### 8.2 è¿ç§»æ‰§è¡Œ

```bash
# è¿ç§»æ‰§è¡Œæ­¥éª¤
# 1. æ‰§è¡Œæ•°æ®å¤‡ä»½
# 2. åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯è¿ç§»
# 3. æ‰§è¡Œç”Ÿäº§ç¯å¢ƒè¿ç§»
# 4. éªŒè¯è¿ç§»ç»“æœ
# 5. ç›‘æ§ç³»ç»Ÿæ€§èƒ½
# 6. å¤„ç†è¿ç§»é—®é¢˜
```

### 8.3 è¿ç§»åç»´æŠ¤

```sql
-- è¿ç§»åç»´æŠ¤
-- 1. ç›‘æ§ç³»ç»Ÿæ€§èƒ½
SELECT
    datname,
    numbackends,
    xact_commit,
    xact_rollback,
    blks_read,
    blks_hit
FROM pg_stat_database
WHERE datname = current_database();

-- 2. å®šæœŸæ›´æ–°ç»Ÿè®¡ä¿¡æ¯
ANALYZE;

-- 3. å®šæœŸç»´æŠ¤ç´¢å¼•
REINDEX DATABASE database_name;

-- 4. ç›‘æ§æ…¢æŸ¥è¯¢
SELECT
    query,
    calls,
    mean_time
FROM pg_stat_statements
ORDER BY mean_time DESC
LIMIT 10;
```

---

## 9. å®é™…æ¡ˆä¾‹

### 9.1 æ¡ˆä¾‹ï¼šå¤§å‹ç”µå•†ç³»ç»Ÿè¿ç§»

**åœºæ™¯**ï¼šå¤§å‹ç”µå•†ç³»ç»Ÿä» PostgreSQL 17 è¿ç§»åˆ° 18

**è¿ç§»è¿‡ç¨‹**ï¼š

```bash
# 1. å‡†å¤‡é˜¶æ®µï¼ˆ1å‘¨ï¼‰
# - ç¯å¢ƒæ£€æŸ¥
# - æ•°æ®å¤‡ä»½
# - å…¼å®¹æ€§æ£€æŸ¥
# - æµ‹è¯•ç¯å¢ƒå‡†å¤‡

# 2. æµ‹è¯•è¿ç§»ï¼ˆ1å‘¨ï¼‰
# - åœ¨æµ‹è¯•ç¯å¢ƒæ‰§è¡Œè¿ç§»
# - åŠŸèƒ½éªŒè¯
# - æ€§èƒ½æµ‹è¯•

# 3. ç”Ÿäº§è¿ç§»ï¼ˆ1å¤©ï¼‰
# - æ‰§è¡Œæ•°æ®å¤‡ä»½
# - ä½¿ç”¨ pg_upgrade å‡çº§
# - éªŒè¯è¿ç§»ç»“æœ
# - ç›‘æ§ç³»ç»Ÿæ€§èƒ½
```

**æ•ˆæœ**ï¼š

- è¿ç§»æ—¶é—´ï¼š1 å¤©
- æ€§èƒ½æå‡ï¼šæŸ¥è¯¢æ€§èƒ½æå‡ 40%
- ç¨³å®šæ€§ï¼šæ— æ•…éšœ
- å›æ»šå‡†å¤‡ï¼šå®Œæ•´å¤‡ä»½ä¿ç•™

### 9.2 æ¡ˆä¾‹ï¼šé‡‘èç³»ç»Ÿè¿ç§»

**åœºæ™¯**ï¼šé‡‘èç³»ç»Ÿä» PostgreSQL 17 è¿ç§»åˆ° 18

**è¿ç§»è¿‡ç¨‹**ï¼š

```bash
# 1. å‡†å¤‡é˜¶æ®µï¼ˆ2å‘¨ï¼‰
# - è¯¦ç»†çš„ç¯å¢ƒæ£€æŸ¥
# - å®Œæ•´çš„æ•°æ®å¤‡ä»½
# - å…¼å®¹æ€§å…¨é¢æ£€æŸ¥
# - æµ‹è¯•ç¯å¢ƒå‡†å¤‡

# 2. æµ‹è¯•è¿ç§»ï¼ˆ2å‘¨ï¼‰
# - åœ¨æµ‹è¯•ç¯å¢ƒæ‰§è¡Œè¿ç§»
# - å®Œæ•´åŠŸèƒ½éªŒè¯
# - æ€§èƒ½åŸºå‡†æµ‹è¯•
# - å®‰å…¨æ€§æµ‹è¯•

# 3. ç”Ÿäº§è¿ç§»ï¼ˆç»´æŠ¤çª—å£ï¼‰
# - æ‰§è¡Œå®Œæ•´å¤‡ä»½
# - ä½¿ç”¨ pg_dump/pg_restore è¿ç§»
# - éªŒè¯æ•°æ®å®Œæ•´æ€§
# - æ€§èƒ½éªŒè¯
```

**æ•ˆæœ**ï¼š

- è¿ç§»æ—¶é—´ï¼š4 å°æ—¶ç»´æŠ¤çª—å£
- æ€§èƒ½æå‡ï¼šæŸ¥è¯¢æ€§èƒ½æå‡ 35%
- ç¨³å®šæ€§ï¼šæ— æ•…éšœ
- å®‰å…¨æ€§ï¼šOAuth 2.0 æ”¯æŒå¢å¼ºå®‰å…¨æ€§

---

## ğŸ“š å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - å‡çº§æŒ‡å—](https://www.postgresql.org/docs/18/upgrading.html)**
  - PostgreSQL å‡çº§å®Œæ•´æŒ‡å—
  - å‡çº§æ–¹æ³•å’Œæ³¨æ„äº‹é¡¹

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - pg_upgrade](https://www.postgresql.org/docs/18/pgupgrade.html)**
  - pg_upgrade å·¥å…·ä½¿ç”¨æŒ‡å—
  - å‡çº§æ­¥éª¤å’Œæ•…éšœæ’æŸ¥

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - ç‰ˆæœ¬å…¼å®¹æ€§](https://www.postgresql.org/docs/18/release-18.html)**
  - PostgreSQL 18 ç‰ˆæœ¬è¯´æ˜
  - å…¼å®¹æ€§å˜åŒ–å’Œè¿ç§»æ³¨æ„äº‹é¡¹

- **[PostgreSQL 18 å‘å¸ƒè¯´æ˜](https://www.postgresql.org/about/news/postgresql-18-released-2817/)**
  - PostgreSQL 18 æ–°ç‰¹æ€§ä»‹ç»
  - è¿ç§»ç›¸å…³è¯´æ˜

### æŠ€æœ¯åšå®¢

- **[PostgreSQL å®˜æ–¹åšå®¢ - å‡çº§æŒ‡å—](https://www.postgresql.org/docs/18/upgrading.html)**
  - å‡çº§æœ€ä½³å®è·µ
  - å¸¸è§é—®é¢˜è§£ç­”

- **[2ndQuadrant - PostgreSQL 18 è¿ç§»](https://www.2ndquadrant.com/en/blog/postgresql-18-migration/)**
  - è¿ç§»å®æˆ˜æ¡ˆä¾‹
  - è¿ç§»ä¼˜åŒ–å»ºè®®

- **[Percona - PostgreSQL å‡çº§æŒ‡å—](https://www.percona.com/blog/postgresql-upgrade-guide/)**
  - å‡çº§æ­¥éª¤è¯¦è§£
  - æ•…éšœæ’æŸ¥æ–¹æ³•

### ç¤¾åŒºèµ„æº

- **[PostgreSQL Wiki - Upgrading](https://wiki.postgresql.org/wiki/Upgrading)**
  - å‡çº§æŒ‡å—å’Œæœ€ä½³å®è·µ
  - å¸¸è§é—®é¢˜è§£ç­”

- **[Stack Overflow - PostgreSQL Upgrade](https://stackoverflow.com/questions/tagged/postgresql+upgrade)**
  - å‡çº§ç›¸å…³é—®é¢˜è§£ç­”
  - å®é™…è¿ç§»æ¡ˆä¾‹

- **[PostgreSQL é‚®ä»¶åˆ—è¡¨](https://www.postgresql.org/list/)**
  - å‡çº§ç›¸å…³é—®é¢˜è®¨è®º
  - ç¤¾åŒºç»éªŒåˆ†äº«

## ğŸ“Š æ€»ç»“

PostgreSQL 17 åˆ° 18 çš„è¿ç§»æ˜¯ä¸€ä¸ªç›¸å¯¹å¹³æ»‘çš„è¿‡ç¨‹ï¼š

1. **è¿ç§»å‡†å¤‡**ï¼šè¯¦ç»†çš„ç¯å¢ƒæ£€æŸ¥ã€æ•°æ®å¤‡ä»½ã€å…¼å®¹æ€§æ£€æŸ¥
2. **è¿ç§»æ‰§è¡Œ**ï¼šä½¿ç”¨ pg_upgrade æˆ– pg_dump/pg_restore
3. **è¿ç§»éªŒè¯**ï¼šåŠŸèƒ½éªŒè¯ã€æ€§èƒ½éªŒè¯ã€æ•°æ®å®Œæ•´æ€§éªŒè¯
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šé…ç½®ä¼˜åŒ–ã€ç´¢å¼•ä¼˜åŒ–ã€æŸ¥è¯¢ä¼˜åŒ–
5. **å›æ»šæ–¹æ¡ˆ**ï¼šå®Œæ•´çš„å›æ»šå‡†å¤‡å’Œæ­¥éª¤

**æœ€ä½³å®è·µ**ï¼š

- åˆ¶å®šè¯¦ç»†çš„è¿ç§»è®¡åˆ’
- åœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯
- ä¿ç•™å®Œæ•´çš„æ•°æ®å¤‡ä»½
- å‡†å¤‡å›æ»šæ–¹æ¡ˆ
- ç›‘æ§è¿ç§»åçš„ç³»ç»Ÿæ€§èƒ½

---

**æœ€åæ›´æ–°**: 2025 å¹´ 1 æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
