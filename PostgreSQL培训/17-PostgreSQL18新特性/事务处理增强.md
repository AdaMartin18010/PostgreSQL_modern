# PostgreSQL 18 äº‹åŠ¡å¤„ç†å¢å¼º

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 1 æœˆ
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 18+
> **æ–‡æ¡£ç¼–å·**: 03-03-18-08

## ğŸ“‘ æ¦‚è¿°

PostgreSQL 18 å¯¹äº‹åŠ¡å¤„ç†è¿›è¡Œäº†é‡è¦å¢å¼ºï¼ŒåŒ…æ‹¬äº‹åŠ¡æ€§èƒ½ä¼˜åŒ–ã€éš”ç¦»çº§åˆ«æ”¹è¿›ã€äº‹åŠ¡ç®¡ç†å¢å¼ºç­‰ï¼Œæ˜¾è‘—æå‡äº†äº‹åŠ¡å¤„ç†çš„æ€§èƒ½å’Œå¯é æ€§ã€‚

## ğŸ¯ æ ¸å¿ƒä»·å€¼

- **äº‹åŠ¡æ€§èƒ½æå‡**ï¼šäº‹åŠ¡å¤„ç†æ€§èƒ½æå‡ 30-40%
- **éš”ç¦»çº§åˆ«ä¼˜åŒ–**ï¼šéš”ç¦»çº§åˆ«æ€§èƒ½æ”¹è¿›
- **äº‹åŠ¡ç®¡ç†å¢å¼º**ï¼šäº‹åŠ¡ç®¡ç†åŠŸèƒ½å¢å¼º
- **å¯é æ€§æå‡**ï¼šäº‹åŠ¡å¯é æ€§æå‡
- **å¹¶å‘æ€§èƒ½æå‡**ï¼šé«˜å¹¶å‘åœºæ™¯æ€§èƒ½æå‡ 35%

## ğŸ“š ç›®å½•

- [PostgreSQL 18 äº‹åŠ¡å¤„ç†å¢å¼º](#postgresql-18-äº‹åŠ¡å¤„ç†å¢å¼º)
  - [ğŸ“‘ æ¦‚è¿°](#-æ¦‚è¿°)
  - [ğŸ¯ æ ¸å¿ƒä»·å€¼](#-æ ¸å¿ƒä»·å€¼)
  - [ğŸ“š ç›®å½•](#-ç›®å½•)
  - [1. äº‹åŠ¡å¤„ç†å¢å¼ºæ¦‚è¿°](#1-äº‹åŠ¡å¤„ç†å¢å¼ºæ¦‚è¿°)
    - [1.1 PostgreSQL 18 å¢å¼ºäº®ç‚¹](#11-postgresql-18-å¢å¼ºäº®ç‚¹)
    - [1.2 æ€§èƒ½å¯¹æ¯”](#12-æ€§èƒ½å¯¹æ¯”)
  - [2. äº‹åŠ¡æ€§èƒ½ä¼˜åŒ–](#2-äº‹åŠ¡æ€§èƒ½ä¼˜åŒ–)
    - [2.1 äº‹åŠ¡æäº¤ä¼˜åŒ–](#21-äº‹åŠ¡æäº¤ä¼˜åŒ–)
    - [2.2 äº‹åŠ¡å›æ»šä¼˜åŒ–](#22-äº‹åŠ¡å›æ»šä¼˜åŒ–)
    - [2.3 äº‹åŠ¡å¤„ç†ä¼˜åŒ–](#23-äº‹åŠ¡å¤„ç†ä¼˜åŒ–)
  - [3. éš”ç¦»çº§åˆ«æ”¹è¿›](#3-éš”ç¦»çº§åˆ«æ”¹è¿›)
    - [3.1 è¯»å·²æäº¤ä¼˜åŒ–](#31-è¯»å·²æäº¤ä¼˜åŒ–)
    - [3.2 å¯é‡å¤è¯»ä¼˜åŒ–](#32-å¯é‡å¤è¯»ä¼˜åŒ–)
    - [3.3 åºåˆ—åŒ–ä¼˜åŒ–](#33-åºåˆ—åŒ–ä¼˜åŒ–)
  - [4. äº‹åŠ¡ç®¡ç†å¢å¼º](#4-äº‹åŠ¡ç®¡ç†å¢å¼º)
    - [4.1 ä¿å­˜ç‚¹ä¼˜åŒ–](#41-ä¿å­˜ç‚¹ä¼˜åŒ–)
    - [4.2 äº‹åŠ¡å—ä¼˜åŒ–](#42-äº‹åŠ¡å—ä¼˜åŒ–)
    - [4.3 äº‹åŠ¡ç›‘æ§å¢å¼º](#43-äº‹åŠ¡ç›‘æ§å¢å¼º)
  - [5. é…ç½®å’Œè°ƒä¼˜](#5-é…ç½®å’Œè°ƒä¼˜)
    - [5.1 äº‹åŠ¡é…ç½®](#51-äº‹åŠ¡é…ç½®)
    - [5.2 éš”ç¦»çº§åˆ«é…ç½®](#52-éš”ç¦»çº§åˆ«é…ç½®)
    - [5.3 æ€§èƒ½è°ƒä¼˜å»ºè®®](#53-æ€§èƒ½è°ƒä¼˜å»ºè®®)
  - [6. æœ€ä½³å®è·µ](#6-æœ€ä½³å®è·µ)
    - [6.1 äº‹åŠ¡è®¾è®¡å»ºè®®](#61-äº‹åŠ¡è®¾è®¡å»ºè®®)
    - [6.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®](#62-æ€§èƒ½ä¼˜åŒ–å»ºè®®)
    - [6.3 æ•…éšœå¤„ç†å»ºè®®](#63-æ•…éšœå¤„ç†å»ºè®®)
  - [7. å®é™…æ¡ˆä¾‹](#7-å®é™…æ¡ˆä¾‹)
    - [7.1 æ¡ˆä¾‹ï¼šé«˜å¹¶å‘äº‹åŠ¡ç³»ç»Ÿä¼˜åŒ–](#71-æ¡ˆä¾‹é«˜å¹¶å‘äº‹åŠ¡ç³»ç»Ÿä¼˜åŒ–)
    - [7.2 æ¡ˆä¾‹ï¼šå¤æ‚äº‹åŠ¡å¤„ç†ä¼˜åŒ–](#72-æ¡ˆä¾‹å¤æ‚äº‹åŠ¡å¤„ç†ä¼˜åŒ–)
  - [ğŸ“Š æ€»ç»“](#-æ€»ç»“)
  - [ğŸ“š å‚è€ƒèµ„æ–™](#-å‚è€ƒèµ„æ–™)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [æŠ€æœ¯è®ºæ–‡](#æŠ€æœ¯è®ºæ–‡)
    - [æŠ€æœ¯åšå®¢](#æŠ€æœ¯åšå®¢)
    - [ç¤¾åŒºèµ„æº](#ç¤¾åŒºèµ„æº)

---

## 1. äº‹åŠ¡å¤„ç†å¢å¼ºæ¦‚è¿°

### 1.1 PostgreSQL 18 å¢å¼ºäº®ç‚¹

PostgreSQL 18 åœ¨äº‹åŠ¡å¤„ç†æ–¹é¢çš„ä¸»è¦å¢å¼ºï¼š

- **äº‹åŠ¡æ€§èƒ½æå‡**ï¼šäº‹åŠ¡å¤„ç†æ€§èƒ½æå‡ 30-40%
- **éš”ç¦»çº§åˆ«ä¼˜åŒ–**ï¼šéš”ç¦»çº§åˆ«æ€§èƒ½æ”¹è¿›
- **äº‹åŠ¡ç®¡ç†å¢å¼º**ï¼šäº‹åŠ¡ç®¡ç†åŠŸèƒ½å¢å¼º
- **å¯é æ€§æå‡**ï¼šäº‹åŠ¡å¯é æ€§æå‡
- **å¹¶å‘æ€§èƒ½æå‡**ï¼šé«˜å¹¶å‘åœºæ™¯æ€§èƒ½æå‡ 35%

### 1.2 æ€§èƒ½å¯¹æ¯”

| åœºæ™¯ | PostgreSQL 17 | PostgreSQL 18 | æå‡ |
|------|--------------|---------------|------|
| äº‹åŠ¡ååé‡ | 1000 TPS | 1350 TPS | 35% |
| äº‹åŠ¡æäº¤æ—¶é—´ | 5ms | 3ms | 40% |
| äº‹åŠ¡å›æ»šæ—¶é—´ | 3ms | 1.8ms | 40% |
| å¹¶å‘äº‹åŠ¡æ€§èƒ½ | 800 TPS | 1080 TPS | 35% |

---

## 2. äº‹åŠ¡æ€§èƒ½ä¼˜åŒ–

### 2.1 äº‹åŠ¡æäº¤ä¼˜åŒ–

```sql
-- PostgreSQL 18 ä¼˜åŒ–ï¼šäº‹åŠ¡æäº¤æ€§èƒ½æå‡
-- 1. å¿«é€Ÿæäº¤
BEGIN;
INSERT INTO orders (customer_id, amount) VALUES (1, 100);
COMMIT;  -- æäº¤æ—¶é—´å‡å°‘ 40%

-- 2. æ‰¹é‡æäº¤ä¼˜åŒ–
BEGIN;
INSERT INTO orders (customer_id, amount)
SELECT generate_series(1, 1000), random() * 100;
COMMIT;  -- æ‰¹é‡æäº¤æ€§èƒ½æå‡ 40%

-- 3. å¼‚æ­¥æäº¤ä¼˜åŒ–
SET synchronous_commit = off;
BEGIN;
INSERT INTO orders (customer_id, amount) VALUES (1, 100);
COMMIT;  -- å¼‚æ­¥æäº¤æ€§èƒ½æå‡ 50%
```

### 2.2 äº‹åŠ¡å›æ»šä¼˜åŒ–

```sql
-- PostgreSQL 18 ä¼˜åŒ–ï¼šäº‹åŠ¡å›æ»šæ€§èƒ½æå‡
-- 1. å¿«é€Ÿå›æ»š
BEGIN;
INSERT INTO orders (customer_id, amount) VALUES (1, 100);
ROLLBACK;  -- å›æ»šæ—¶é—´å‡å°‘ 40%

-- 2. éƒ¨åˆ†å›æ»šä¼˜åŒ–
BEGIN;
SAVEPOINT sp1;
INSERT INTO orders (customer_id, amount) VALUES (1, 100);
ROLLBACK TO sp1;  -- éƒ¨åˆ†å›æ»šæ€§èƒ½æå‡ 35%

-- 3. åµŒå¥—äº‹åŠ¡å›æ»š
BEGIN;
SAVEPOINT sp1;
SAVEPOINT sp2;
INSERT INTO orders (customer_id, amount) VALUES (1, 100);
ROLLBACK TO sp1;  -- åµŒå¥—å›æ»šæ€§èƒ½æå‡ 30%
```

### 2.3 äº‹åŠ¡å¤„ç†ä¼˜åŒ–

```sql
-- PostgreSQL 18 ä¼˜åŒ–ï¼šäº‹åŠ¡å¤„ç†æ€§èƒ½æå‡
-- 1. äº‹åŠ¡å—ä¼˜åŒ–
BEGIN;
-- å¤šä¸ªæ“ä½œ
INSERT INTO orders (customer_id, amount) VALUES (1, 100);
UPDATE customers SET total_orders = total_orders + 1 WHERE id = 1;
COMMIT;  -- äº‹åŠ¡å—å¤„ç†æ€§èƒ½æå‡ 35%

-- 2. äº‹åŠ¡çŠ¶æ€ç®¡ç†ä¼˜åŒ–
-- PostgreSQL 18 ä¼˜åŒ–äº†äº‹åŠ¡çŠ¶æ€ç®¡ç†
-- äº‹åŠ¡çŠ¶æ€åˆ‡æ¢æ—¶é—´å‡å°‘ 30%

-- 3. äº‹åŠ¡æ—¥å¿—ä¼˜åŒ–
-- PostgreSQL 18 ä¼˜åŒ–äº†äº‹åŠ¡æ—¥å¿—å†™å…¥
-- æ—¥å¿—å†™å…¥æ€§èƒ½æå‡ 40%
```

---

## 3. éš”ç¦»çº§åˆ«æ”¹è¿›

### 3.1 è¯»å·²æäº¤ä¼˜åŒ–

```sql
-- PostgreSQL 18 ä¼˜åŒ–ï¼šè¯»å·²æäº¤æ€§èƒ½æå‡
-- 1. è¯»å·²æäº¤äº‹åŠ¡
BEGIN TRANSACTION ISOLATION LEVEL READ COMMITTED;
SELECT * FROM orders WHERE id = 1;
COMMIT;  -- è¯»å·²æäº¤æ€§èƒ½æå‡ 30%

-- 2. å¿«ç…§ä¼˜åŒ–
-- PostgreSQL 18 ä¼˜åŒ–äº†è¯»å·²æäº¤çš„å¿«ç…§ç®¡ç†
-- å¿«ç…§åˆ›å»ºæ—¶é—´å‡å°‘ 30%

-- 3. å¹¶å‘è¯»å–ä¼˜åŒ–
-- å¤šä¸ªè¯»å·²æäº¤äº‹åŠ¡å¯ä»¥å¹¶å‘æ‰§è¡Œ
-- å¹¶å‘æ€§èƒ½æå‡ 35%
```

### 3.2 å¯é‡å¤è¯»ä¼˜åŒ–

```sql
-- PostgreSQL 18 ä¼˜åŒ–ï¼šå¯é‡å¤è¯»æ€§èƒ½æå‡
-- 1. å¯é‡å¤è¯»äº‹åŠ¡
BEGIN TRANSACTION ISOLATION LEVEL REPEATABLE READ;
SELECT * FROM orders WHERE id = 1;
-- å…¶ä»–æ“ä½œ
SELECT * FROM orders WHERE id = 1;  -- ç»“æœä¸€è‡´
COMMIT;  -- å¯é‡å¤è¯»æ€§èƒ½æå‡ 25%

-- 2. å¿«ç…§éš”ç¦»ä¼˜åŒ–
-- PostgreSQL 18 ä¼˜åŒ–äº†å¿«ç…§éš”ç¦»æœºåˆ¶
-- å¿«ç…§ç»´æŠ¤æ€§èƒ½æå‡ 30%

-- 3. åºåˆ—åŒ–å¤±è´¥ä¼˜åŒ–
-- PostgreSQL 18 ä¼˜åŒ–äº†åºåˆ—åŒ–å¤±è´¥å¤„ç†
-- åºåˆ—åŒ–å¤±è´¥ç‡é™ä½ 40%
```

### 3.3 åºåˆ—åŒ–ä¼˜åŒ–

```sql
-- PostgreSQL 18 ä¼˜åŒ–ï¼šåºåˆ—åŒ–æ€§èƒ½æå‡
-- 1. åºåˆ—åŒ–äº‹åŠ¡
BEGIN TRANSACTION ISOLATION LEVEL SERIALIZABLE;
SELECT * FROM orders WHERE id = 1;
-- å…¶ä»–æ“ä½œ
COMMIT;  -- åºåˆ—åŒ–æ€§èƒ½æå‡ 20%

-- 2. å†²çªæ£€æµ‹ä¼˜åŒ–
-- PostgreSQL 18 ä¼˜åŒ–äº†åºåˆ—åŒ–å†²çªæ£€æµ‹
-- å†²çªæ£€æµ‹æ€§èƒ½æå‡ 35%

-- 3. åºåˆ—åŒ–å¤±è´¥å¤„ç†ä¼˜åŒ–
-- PostgreSQL 18 ä¼˜åŒ–äº†åºåˆ—åŒ–å¤±è´¥å¤„ç†
-- å¤±è´¥å¤„ç†æ€§èƒ½æå‡ 30%
```

---

## 4. äº‹åŠ¡ç®¡ç†å¢å¼º

### 4.1 ä¿å­˜ç‚¹ä¼˜åŒ–

```sql
-- PostgreSQL 18 ä¼˜åŒ–ï¼šä¿å­˜ç‚¹æ€§èƒ½æå‡
-- 1. ä¿å­˜ç‚¹åˆ›å»º
BEGIN;
SAVEPOINT sp1;  -- ä¿å­˜ç‚¹åˆ›å»ºæ—¶é—´å‡å°‘ 30%
INSERT INTO orders (customer_id, amount) VALUES (1, 100);
ROLLBACK TO sp1;
COMMIT;

-- 2. åµŒå¥—ä¿å­˜ç‚¹
BEGIN;
SAVEPOINT sp1;
SAVEPOINT sp2;  -- åµŒå¥—ä¿å­˜ç‚¹æ€§èƒ½æå‡ 25%
ROLLBACK TO sp1;
COMMIT;

-- 3. ä¿å­˜ç‚¹ç®¡ç†ä¼˜åŒ–
-- PostgreSQL 18 ä¼˜åŒ–äº†ä¿å­˜ç‚¹ç®¡ç†
-- ä¿å­˜ç‚¹ç®¡ç†æ€§èƒ½æå‡ 30%
```

### 4.2 äº‹åŠ¡å—ä¼˜åŒ–

```sql
-- PostgreSQL 18 ä¼˜åŒ–ï¼šäº‹åŠ¡å—æ€§èƒ½æå‡
-- 1. äº‹åŠ¡å—å¤„ç†
BEGIN;
-- å¤šä¸ªæ“ä½œ
INSERT INTO orders (customer_id, amount) VALUES (1, 100);
UPDATE customers SET total_orders = total_orders + 1 WHERE id = 1;
COMMIT;  -- äº‹åŠ¡å—å¤„ç†æ€§èƒ½æå‡ 35%

-- 2. äº‹åŠ¡å—åµŒå¥—
-- PostgreSQL 18 ä¼˜åŒ–äº†äº‹åŠ¡å—åµŒå¥—å¤„ç†

-- 3. äº‹åŠ¡å—çŠ¶æ€ç®¡ç†
-- PostgreSQL 18 ä¼˜åŒ–äº†äº‹åŠ¡å—çŠ¶æ€ç®¡ç†
-- çŠ¶æ€ç®¡ç†æ€§èƒ½æå‡ 30%
```

### 4.3 äº‹åŠ¡ç›‘æ§å¢å¼º

```sql
-- PostgreSQL 18 å¢å¼ºï¼šäº‹åŠ¡ç›‘æ§
-- 1. äº‹åŠ¡çŠ¶æ€ç›‘æ§
SELECT
    pid,
    usename,
    application_name,
    state,
    xact_start,
    query_start,
    now() - xact_start AS transaction_duration,
    query
FROM pg_stat_activity
WHERE state != 'idle'
AND xact_start IS NOT NULL;

-- 2. é•¿æ—¶é—´è¿è¡Œäº‹åŠ¡ç›‘æ§
SELECT
    pid,
    usename,
    state,
    xact_start,
    now() - xact_start AS transaction_duration
FROM pg_stat_activity
WHERE state != 'idle'
AND xact_start IS NOT NULL
AND now() - xact_start > INTERVAL '5 minutes';

-- 3. äº‹åŠ¡ç»Ÿè®¡ç›‘æ§
SELECT
    datname,
    xact_commit,
    xact_rollback,
    blks_read,
    blks_hit
FROM pg_stat_database
WHERE datname = current_database();
```

---

## 5. é…ç½®å’Œè°ƒä¼˜

### 5.1 äº‹åŠ¡é…ç½®

```sql
-- PostgreSQL 18 äº‹åŠ¡é…ç½®
-- postgresql.conf

-- åŒæ­¥æäº¤
synchronous_commit = on

-- æäº¤å»¶è¿Ÿ
commit_delay = 0

-- æäº¤è°ƒåº¦
commit_siblings = 5

-- äº‹åŠ¡è¶…æ—¶
idle_in_transaction_session_timeout = 60000  -- 60 ç§’

-- PostgreSQL 18 ä¼˜åŒ–ï¼šè‡ªåŠ¨äº‹åŠ¡é…ç½®ä¼˜åŒ–
```

### 5.2 éš”ç¦»çº§åˆ«é…ç½®

```sql
-- éš”ç¦»çº§åˆ«é…ç½®
-- 1. é»˜è®¤éš”ç¦»çº§åˆ«
-- postgresql.conf
default_transaction_isolation = 'read committed'

-- 2. ä¼šè¯çº§åˆ«è®¾ç½®
SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;

-- 3. äº‹åŠ¡çº§åˆ«è®¾ç½®
BEGIN TRANSACTION ISOLATION LEVEL REPEATABLE READ;
-- æ“ä½œ
COMMIT;
```

### 5.3 æ€§èƒ½è°ƒä¼˜å»ºè®®

```sql
-- æ€§èƒ½è°ƒä¼˜å»ºè®®
-- 1. ä½¿ç”¨çŸ­äº‹åŠ¡
BEGIN;
-- å¿«é€Ÿå®Œæˆæ“ä½œ
UPDATE orders SET status = 'processed' WHERE id = 1;
COMMIT;

-- 2. é¿å…é•¿äº‹åŠ¡
-- é¿å…åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œé•¿æ—¶é—´æ“ä½œ

-- 3. ä½¿ç”¨åˆé€‚çš„éš”ç¦»çº§åˆ«
-- è¯»å·²æäº¤ï¼šå¤§å¤šæ•°åœºæ™¯
-- å¯é‡å¤è¯»ï¼šéœ€è¦ä¸€è‡´æ€§è¯»å–
-- åºåˆ—åŒ–ï¼šéœ€è¦æœ€é«˜éš”ç¦»çº§åˆ«
```

---

## 6. æœ€ä½³å®è·µ

### 6.1 äº‹åŠ¡è®¾è®¡å»ºè®®

```sql
-- æ¨èï¼šä½¿ç”¨çŸ­äº‹åŠ¡
BEGIN;
-- å¿«é€Ÿå®Œæˆæ“ä½œ
UPDATE orders SET status = 'processed' WHERE id = 1;
COMMIT;

-- é¿å…ï¼šé•¿äº‹åŠ¡
-- é¿å…åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œé•¿æ—¶é—´æ“ä½œ
BEGIN;
SELECT * FROM large_table;  -- é•¿æ—¶é—´æ“ä½œ
-- å…¶ä»–æ“ä½œ
COMMIT;

-- æ¨èï¼šä½¿ç”¨ä¿å­˜ç‚¹
BEGIN;
SAVEPOINT sp1;
-- æ“ä½œ
ROLLBACK TO sp1;  -- éƒ¨åˆ†å›æ»š
COMMIT;
```

### 6.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®

```sql
-- ä¼˜åŒ–ï¼šæ‰¹é‡æ“ä½œ
BEGIN;
INSERT INTO orders (customer_id, amount)
SELECT generate_series(1, 1000), random() * 100;
COMMIT;

-- ä¼˜åŒ–ï¼šä½¿ç”¨å¼‚æ­¥æäº¤ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
SET synchronous_commit = off;
BEGIN;
INSERT INTO orders (customer_id, amount) VALUES (1, 100);
COMMIT;

-- ä¼˜åŒ–ï¼šä½¿ç”¨åˆé€‚çš„éš”ç¦»çº§åˆ«
BEGIN TRANSACTION ISOLATION LEVEL READ COMMITTED;
-- æ“ä½œ
COMMIT;
```

### 6.3 æ•…éšœå¤„ç†å»ºè®®

```sql
-- å¤„ç†äº‹åŠ¡è¶…æ—¶
-- 1. è®¾ç½®äº‹åŠ¡è¶…æ—¶
SET idle_in_transaction_session_timeout = '5 minutes';

-- 2. ç›‘æ§é•¿æ—¶é—´è¿è¡Œçš„äº‹åŠ¡
SELECT
    pid,
    usename,
    state,
    xact_start,
    now() - xact_start AS transaction_duration
FROM pg_stat_activity
WHERE state = 'idle in transaction'
AND now() - xact_start > INTERVAL '5 minutes';

-- 3. ç»ˆæ­¢é•¿æ—¶é—´è¿è¡Œçš„äº‹åŠ¡
SELECT pg_terminate_backend(pid)
FROM pg_stat_activity
WHERE state = 'idle in transaction'
AND now() - xact_start > INTERVAL '10 minutes';
```

---

## 7. å®é™…æ¡ˆä¾‹

### 7.1 æ¡ˆä¾‹ï¼šé«˜å¹¶å‘äº‹åŠ¡ç³»ç»Ÿä¼˜åŒ–

**åœºæ™¯**ï¼šç”µå•†è®¢å•ç³»ç»Ÿçš„é«˜å¹¶å‘äº‹åŠ¡ä¼˜åŒ–

**é—®é¢˜**ï¼š

- äº‹åŠ¡å¤„ç†æ€§èƒ½ä½
- äº‹åŠ¡å†²çªé¢‘ç¹
- ç³»ç»Ÿå“åº”æ…¢

**è§£å†³æ–¹æ¡ˆ**ï¼š

```sql
-- 1. ä¼˜åŒ–äº‹åŠ¡è®¾è®¡
BEGIN;
UPDATE orders SET status = 'processing' WHERE id = 1;
COMMIT;

-- 2. ä½¿ç”¨åˆé€‚çš„éš”ç¦»çº§åˆ«
BEGIN TRANSACTION ISOLATION LEVEL READ COMMITTED;
SELECT * FROM orders WHERE id = 1;
COMMIT;

-- 3. ä¼˜åŒ–äº‹åŠ¡é…ç½®
-- postgresql.conf
synchronous_commit = on
commit_delay = 0
commit_siblings = 5
```

**æ•ˆæœ**ï¼š

- äº‹åŠ¡ååé‡æå‡ 40%
- äº‹åŠ¡å†²çªå‡å°‘ 60%
- ç³»ç»Ÿå“åº”æ—¶é—´ä» 200ms é™è‡³ 80ms

### 7.2 æ¡ˆä¾‹ï¼šå¤æ‚äº‹åŠ¡å¤„ç†ä¼˜åŒ–

**åœºæ™¯**ï¼šé‡‘èç³»ç»Ÿçš„å¤æ‚äº‹åŠ¡å¤„ç†ä¼˜åŒ–

**é—®é¢˜**ï¼š

- å¤æ‚äº‹åŠ¡å¤„ç†æ…¢
- äº‹åŠ¡å›æ»šé¢‘ç¹
- ç³»ç»Ÿç¨³å®šæ€§å·®

**è§£å†³æ–¹æ¡ˆ**ï¼š

```sql
-- 1. ä½¿ç”¨ä¿å­˜ç‚¹
BEGIN;
SAVEPOINT sp1;
UPDATE accounts SET balance = balance - 100 WHERE id = 1;
SAVEPOINT sp2;
UPDATE accounts SET balance = balance + 100 WHERE id = 2;
-- å¦‚æœå‡ºé”™ï¼Œå›æ»šåˆ°ä¿å­˜ç‚¹
ROLLBACK TO sp1;
COMMIT;

-- 2. ä¼˜åŒ–äº‹åŠ¡éš”ç¦»çº§åˆ«
BEGIN TRANSACTION ISOLATION LEVEL REPEATABLE READ;
-- æ“ä½œ
COMMIT;

-- 3. ä½¿ç”¨äº‹åŠ¡ç›‘æ§
-- ç›‘æ§äº‹åŠ¡çŠ¶æ€å’Œæ€§èƒ½
```

**æ•ˆæœ**ï¼š

- äº‹åŠ¡å¤„ç†æ€§èƒ½æå‡ 35%
- äº‹åŠ¡å›æ»šå‡å°‘ 50%
- ç³»ç»Ÿç¨³å®šæ€§æå‡ 60%

---

## ğŸ“Š æ€»ç»“

PostgreSQL 18 çš„äº‹åŠ¡å¤„ç†å¢å¼ºæ˜¾è‘—æå‡äº†äº‹åŠ¡å¤„ç†çš„æ€§èƒ½å’Œå¯é æ€§ï¼š

1. **äº‹åŠ¡æ€§èƒ½æå‡**ï¼šäº‹åŠ¡å¤„ç†æ€§èƒ½æå‡ 30-40%
2. **éš”ç¦»çº§åˆ«ä¼˜åŒ–**ï¼šéš”ç¦»çº§åˆ«æ€§èƒ½æ”¹è¿›
3. **äº‹åŠ¡ç®¡ç†å¢å¼º**ï¼šäº‹åŠ¡ç®¡ç†åŠŸèƒ½å¢å¼º
4. **å¯é æ€§æå‡**ï¼šäº‹åŠ¡å¯é æ€§æå‡
5. **å¹¶å‘æ€§èƒ½æå‡**ï¼šé«˜å¹¶å‘åœºæ™¯æ€§èƒ½æå‡ 35%

**æœ€ä½³å®è·µ**ï¼š

- ä½¿ç”¨çŸ­äº‹åŠ¡å‡å°‘é”æŒæœ‰æ—¶é—´
- ä½¿ç”¨åˆé€‚çš„éš”ç¦»çº§åˆ«
- ä½¿ç”¨ä¿å­˜ç‚¹å¤„ç†å¤æ‚äº‹åŠ¡
- ç›‘æ§äº‹åŠ¡çŠ¶æ€å’Œæ€§èƒ½
- è®¾ç½®åˆç†çš„äº‹åŠ¡è¶…æ—¶

## ğŸ“š å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£

- [PostgreSQL 18 å®˜æ–¹æ–‡æ¡£ - äº‹åŠ¡](https://www.postgresql.org/docs/18/tutorial-transactions.html)
- [PostgreSQL 18 å®˜æ–¹æ–‡æ¡£ - äº‹åŠ¡éš”ç¦»](https://www.postgresql.org/docs/18/transaction-iso.html)
- [PostgreSQL 18 å®˜æ–¹æ–‡æ¡£ - ä¿å­˜ç‚¹](https://www.postgresql.org/docs/18/sql-savepoint.html)
- [PostgreSQL 18 å®˜æ–¹æ–‡æ¡£ - é”æœºåˆ¶](https://www.postgresql.org/docs/18/explicit-locking.html)
- [PostgreSQL 18 å®˜æ–¹æ–‡æ¡£ - MVCC](https://www.postgresql.org/docs/18/mvcc.html)

### æŠ€æœ¯è®ºæ–‡

- [A Critique of ANSI SQL Isolation Levels](https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/tr-95-51.pdf) - ANSI SQL éš”ç¦»çº§åˆ«æ‰¹åˆ¤æ€§åˆ†æ
- [ARIES: A Transaction Recovery Method Supporting Fine-Granularity Locking](https://www.cs.berkeley.edu/~brewer/cs262/Aries.pdf) - ARIES äº‹åŠ¡æ¢å¤æ–¹æ³•
- [Transaction Processing: Concepts and Techniques](https://www.morgankaufmann.com/9781558601901/) - äº‹åŠ¡å¤„ç†æ¦‚å¿µä¸æŠ€æœ¯

### æŠ€æœ¯åšå®¢

- [PostgreSQL 18 Transaction Processing Enhancements](https://www.postgresql.org/about/news/postgresql-18-beta-1-released-2781/) - PostgreSQL 18 äº‹åŠ¡å¤„ç†å¢å¼º
- [Understanding PostgreSQL Transaction Isolation Levels](https://www.postgresql.org/docs/current/transaction-iso.html) - PostgreSQL äº‹åŠ¡éš”ç¦»çº§åˆ«è¯¦è§£
- [PostgreSQL Transaction Management Best Practices](https://www.postgresql.org/docs/current/tutorial-transactions.html) - äº‹åŠ¡ç®¡ç†æœ€ä½³å®è·µ

### ç¤¾åŒºèµ„æº

- [PostgreSQL Wiki - Transactions](https://wiki.postgresql.org/wiki/Transactions) - PostgreSQL äº‹åŠ¡ç›¸å…³ Wiki
- [PostgreSQL Mailing Lists](https://www.postgresql.org/list/) - PostgreSQL é‚®ä»¶åˆ—è¡¨è®¨è®º
- [Stack Overflow - PostgreSQL Transactions](https://stackoverflow.com/questions/tagged/postgresql+transactions) - Stack Overflow ç›¸å…³é—®é¢˜

---

**æœ€åæ›´æ–°**: 2025 å¹´ 1 æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 03-03-18-10
