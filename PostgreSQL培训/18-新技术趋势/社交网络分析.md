# PostgreSQL ç¤¾äº¤ç½‘ç»œåˆ†æ

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 1 æœˆ
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 18+ with Apache AGE
> **æ–‡æ¡£ç¼–å·**: 03-03-TREND-11

## ğŸ“‘ æ¦‚è¿°

ç¤¾äº¤ç½‘ç»œåˆ†ææ˜¯ç ”ç©¶ç¤¾äº¤ç½‘ç»œä¸­èŠ‚ç‚¹ï¼ˆç”¨æˆ·ï¼‰å’Œè¾¹ï¼ˆå…³ç³»ï¼‰çš„æ¨¡å¼å’Œç»“æ„çš„è¿‡ç¨‹ã€‚PostgreSQL ç»“åˆ Apache AGE å›¾æ•°æ®åº“æ‰©å±•ï¼Œæä¾›äº†å¼ºå¤§çš„ç¤¾äº¤ç½‘ç»œå»ºæ¨¡ã€åˆ†æå’Œæ¨èèƒ½åŠ›ï¼Œå¹¿æ³›åº”ç”¨äºç¤¾äº¤å¹³å°ã€æ¨èç³»ç»Ÿã€å½±å“åŠ›åˆ†æç­‰åœºæ™¯ã€‚

## ğŸ¯ æ ¸å¿ƒä»·å€¼

- **ç¤¾äº¤ç½‘ç»œå»ºæ¨¡**ï¼šé«˜æ•ˆå»ºæ¨¡ç”¨æˆ·å’Œå…³ç³»æ•°æ®
- **å…³ç³»åˆ†æ**ï¼šåˆ†æç”¨æˆ·ä¹‹é—´çš„å…³ç³»æ¨¡å¼
- **å½±å“åŠ›åˆ†æ**ï¼šè¯†åˆ«å…³é”®ç”¨æˆ·å’Œå½±å“åŠ›ä¼ æ’­
- **æ¨èç®—æ³•**ï¼šåŸºäºç¤¾äº¤å…³ç³»çš„æ¨èç³»ç»Ÿ
- **ç¤¾åŒºå‘ç°**ï¼šå‘ç°ç¤¾äº¤ç½‘ç»œä¸­çš„ç¤¾åŒºç»“æ„

## ğŸ“š ç›®å½•

- [PostgreSQL ç¤¾äº¤ç½‘ç»œåˆ†æ](#postgresql-ç¤¾äº¤ç½‘ç»œåˆ†æ)
  - [ğŸ“‘ æ¦‚è¿°](#-æ¦‚è¿°)
  - [ğŸ¯ æ ¸å¿ƒä»·å€¼](#-æ ¸å¿ƒä»·å€¼)
  - [ğŸ“š ç›®å½•](#-ç›®å½•)
  - [1. ç¤¾äº¤ç½‘ç»œåŸºç¡€](#1-ç¤¾äº¤ç½‘ç»œåŸºç¡€)
    - [1.1 ç¤¾äº¤ç½‘ç»œæ¨¡å‹](#11-ç¤¾äº¤ç½‘ç»œæ¨¡å‹)
    - [1.2 å…³ç³»ç±»å‹](#12-å…³ç³»ç±»å‹)
    - [1.3 å›¾æ•°æ®åº“è®¾ç½®](#13-å›¾æ•°æ®åº“è®¾ç½®)
  - [2. ç¤¾äº¤ç½‘ç»œå»ºæ¨¡](#2-ç¤¾äº¤ç½‘ç»œå»ºæ¨¡)
    - [2.1 ç”¨æˆ·å»ºæ¨¡](#21-ç”¨æˆ·å»ºæ¨¡)
    - [2.2 å…³ç³»å»ºæ¨¡](#22-å…³ç³»å»ºæ¨¡)
    - [2.3 æ´»åŠ¨å»ºæ¨¡](#23-æ´»åŠ¨å»ºæ¨¡)
  - [3. å…³ç³»åˆ†æ](#3-å…³ç³»åˆ†æ)
    - [3.1 ç›´æ¥å…³ç³»æŸ¥è¯¢](#31-ç›´æ¥å…³ç³»æŸ¥è¯¢)
    - [3.2 é—´æ¥å…³ç³»æŸ¥è¯¢](#32-é—´æ¥å…³ç³»æŸ¥è¯¢)
    - [3.3 å…³ç³»å¼ºåº¦åˆ†æ](#33-å…³ç³»å¼ºåº¦åˆ†æ)
  - [4. å½±å“åŠ›åˆ†æ](#4-å½±å“åŠ›åˆ†æ)
    - [4.1 åº¦ä¸­å¿ƒæ€§](#41-åº¦ä¸­å¿ƒæ€§)
    - [4.2 æ¥è¿‘ä¸­å¿ƒæ€§](#42-æ¥è¿‘ä¸­å¿ƒæ€§)
    - [4.3 ä»‹æ•°ä¸­å¿ƒæ€§](#43-ä»‹æ•°ä¸­å¿ƒæ€§)
  - [5. ç¤¾åŒºå‘ç°](#5-ç¤¾åŒºå‘ç°)
    - [5.1 ç¤¾åŒºæ£€æµ‹ç®—æ³•](#51-ç¤¾åŒºæ£€æµ‹ç®—æ³•)
    - [5.2 ç¤¾åŒºç»“æ„åˆ†æ](#52-ç¤¾åŒºç»“æ„åˆ†æ)
    - [5.3 ç¤¾åŒºæ¼”åŒ–åˆ†æ](#53-ç¤¾åŒºæ¼”åŒ–åˆ†æ)
  - [6. æ¨èç®—æ³•](#6-æ¨èç®—æ³•)
    - [6.1 åŸºäºå…³ç³»çš„æ¨è](#61-åŸºäºå…³ç³»çš„æ¨è)
    - [6.2 åŸºäºç›¸ä¼¼æ€§çš„æ¨è](#62-åŸºäºç›¸ä¼¼æ€§çš„æ¨è)
    - [6.3 ååŒè¿‡æ»¤æ¨è](#63-ååŒè¿‡æ»¤æ¨è)
  - [7. æ€§èƒ½ä¼˜åŒ–](#7-æ€§èƒ½ä¼˜åŒ–)
    - [7.1 ç´¢å¼•ä¼˜åŒ–](#71-ç´¢å¼•ä¼˜åŒ–)
    - [7.2 æŸ¥è¯¢ä¼˜åŒ–](#72-æŸ¥è¯¢ä¼˜åŒ–)
    - [7.3 å­˜å‚¨ä¼˜åŒ–](#73-å­˜å‚¨ä¼˜åŒ–)
  - [8. æœ€ä½³å®è·µ](#8-æœ€ä½³å®è·µ)
    - [8.1 è®¾è®¡å»ºè®®](#81-è®¾è®¡å»ºè®®)
    - [8.2 æŸ¥è¯¢å»ºè®®](#82-æŸ¥è¯¢å»ºè®®)
    - [8.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®](#83-æ€§èƒ½ä¼˜åŒ–å»ºè®®)
  - [9. å®é™…æ¡ˆä¾‹](#9-å®é™…æ¡ˆä¾‹)
    - [9.1 æ¡ˆä¾‹ï¼šç¤¾äº¤å¹³å°åˆ†æ](#91-æ¡ˆä¾‹ç¤¾äº¤å¹³å°åˆ†æ)
    - [9.2 æ¡ˆä¾‹ï¼šå½±å“åŠ›è¥é”€åˆ†æ](#92-æ¡ˆä¾‹å½±å“åŠ›è¥é”€åˆ†æ)
  - [ğŸ“Š æ€»ç»“](#-æ€»ç»“)
  - [ğŸ“š å‚è€ƒèµ„æ–™](#-å‚è€ƒèµ„æ–™)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [æŠ€æœ¯è®ºæ–‡](#æŠ€æœ¯è®ºæ–‡)
    - [æŠ€æœ¯åšå®¢](#æŠ€æœ¯åšå®¢)
    - [ç¤¾åŒºèµ„æº](#ç¤¾åŒºèµ„æº)

---

## 1. ç¤¾äº¤ç½‘ç»œåŸºç¡€

### 1.1 ç¤¾äº¤ç½‘ç»œæ¨¡å‹

ç¤¾äº¤ç½‘ç»œç”±èŠ‚ç‚¹ï¼ˆç”¨æˆ·ï¼‰å’Œè¾¹ï¼ˆå…³ç³»ï¼‰ç»„æˆã€‚

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š

- **èŠ‚ç‚¹ï¼ˆNodeï¼‰**ï¼šç”¨æˆ·ã€ç»„ç»‡ã€å†…å®¹ç­‰å®ä½“
- **è¾¹ï¼ˆEdgeï¼‰**ï¼šå…³æ³¨ã€å¥½å‹ã€äº’åŠ¨ç­‰å…³ç³»
- **å±æ€§ï¼ˆPropertyï¼‰**ï¼šç”¨æˆ·ä¿¡æ¯ã€å…³ç³»æƒé‡ç­‰

### 1.2 å…³ç³»ç±»å‹

```sql
-- ç¤¾äº¤ç½‘ç»œå…³ç³»ç±»å‹
-- 1. å…³æ³¨å…³ç³»ï¼ˆæœ‰å‘ï¼‰
CREATE (u1:User)-[:FOLLOWS]->(u2:User)

-- 2. å¥½å‹å…³ç³»ï¼ˆæ— å‘ï¼‰
CREATE (u1:User)-[:FRIENDS]-(u2:User)

-- 3. äº’åŠ¨å…³ç³»
CREATE (u1:User)-[:LIKES]->(p:Post)
CREATE (u1:User)-[:COMMENTS]->(p:Post)
CREATE (u1:User)-[:SHARES]->(p:Post)

-- 4. ç¾¤ç»„å…³ç³»
CREATE (u1:User)-[:MEMBER_OF]->(g:Group)
```

### 1.3 å›¾æ•°æ®åº“è®¾ç½®

```sql
-- ä½¿ç”¨ Apache AGE åˆ›å»ºç¤¾äº¤ç½‘ç»œå›¾
-- 1. åˆ›å»ºå›¾æ•°æ®åº“
SELECT create_graph('social_network');

-- 2. éªŒè¯å›¾æ•°æ®åº“
SELECT * FROM ag_catalog.ag_graph WHERE name = 'social_network';
```

---

## 2. ç¤¾äº¤ç½‘ç»œå»ºæ¨¡

### 2.1 ç”¨æˆ·å»ºæ¨¡

```sql
-- ç”¨æˆ·å»ºæ¨¡
-- 1. åˆ›å»ºç”¨æˆ·èŠ‚ç‚¹
SELECT * FROM cypher('social_network', $$
    CREATE (u:User {
        id: 1,
        username: 'alice',
        name: 'Alice',
        age: 30,
        location: 'New York',
        interests: ['Technology', 'Music', 'Travel']
    })
    RETURN u
$$) AS (u agtype);

-- 2. æ‰¹é‡åˆ›å»ºç”¨æˆ·
SELECT * FROM cypher('social_network', $$
    UNWIND [
        {id: 1, username: 'alice', name: 'Alice', age: 30},
        {id: 2, username: 'bob', name: 'Bob', age: 25},
        {id: 3, username: 'charlie', name: 'Charlie', age: 35}
    ] AS user_data
    CREATE (u:User)
    SET u = user_data
    RETURN u
$$) AS (u agtype);

-- 3. æŸ¥è¯¢ç”¨æˆ·
SELECT * FROM cypher('social_network', $$
    MATCH (u:User)
    RETURN u.username, u.name, u.age
    LIMIT 10
$$) AS (username agtype, name agtype, age agtype);
```

### 2.2 å…³ç³»å»ºæ¨¡

```sql
-- å…³ç³»å»ºæ¨¡
-- 1. åˆ›å»ºå…³æ³¨å…³ç³»
SELECT * FROM cypher('social_network', $$
    MATCH (u1:User {username: 'alice'}), (u2:User {username: 'bob'})
    CREATE (u1)-[r:FOLLOWS {since: 2020, strength: 0.8}]->(u2)
    RETURN r
$$) AS (r agtype);

-- 2. åˆ›å»ºå¥½å‹å…³ç³»
SELECT * FROM cypher('social_network', $$
    MATCH (u1:User {username: 'alice'}), (u2:User {username: 'charlie'})
    CREATE (u1)-[r:FRIENDS {since: 2019, mutual_friends: 5}]-(u2)
    RETURN r
$$) AS (r agtype);

-- 3. åˆ›å»ºäº’åŠ¨å…³ç³»
SELECT * FROM cypher('social_network', $$
    MATCH (u:User {username: 'alice'}), (p:Post {id: 1})
    CREATE (u)-[r:LIKES {timestamp: timestamp()}]->(p)
    RETURN r
$$) AS (r agtype);
```

### 2.3 æ´»åŠ¨å»ºæ¨¡

```sql
-- æ´»åŠ¨å»ºæ¨¡
-- 1. åˆ›å»ºå¸–å­èŠ‚ç‚¹
SELECT * FROM cypher('social_network', $$
    CREATE (p:Post {
        id: 1,
        content: 'Hello, world!',
        created_at: timestamp(),
        likes_count: 0,
        comments_count: 0
    })
    RETURN p
$$) AS (p agtype);

-- 2. åˆ›å»ºç”¨æˆ·-å¸–å­å…³ç³»
SELECT * FROM cypher('social_network', $$
    MATCH (u:User {username: 'alice'}), (p:Post {id: 1})
    CREATE (u)-[:CREATED]->(p)
    RETURN u, p
$$) AS (u agtype, p agtype);

-- 3. æŸ¥è¯¢ç”¨æˆ·æ´»åŠ¨
SELECT * FROM cypher('social_network', $$
    MATCH (u:User {username: 'alice'})-[:CREATED]->(p:Post)
    RETURN p.content, p.created_at
    ORDER BY p.created_at DESC
    LIMIT 10
$$) AS (content agtype, created_at agtype);
```

---

## 3. å…³ç³»åˆ†æ

### 3.1 ç›´æ¥å…³ç³»æŸ¥è¯¢

```sql
-- ç›´æ¥å…³ç³»æŸ¥è¯¢
-- 1. æŸ¥è¯¢ç”¨æˆ·çš„å…³æ³¨è€…
SELECT * FROM cypher('social_network', $$
    MATCH (u:User {username: 'alice'})<-[:FOLLOWS]-(follower:User)
    RETURN follower.username, follower.name
$$) AS (username agtype, name agtype);

-- 2. æŸ¥è¯¢ç”¨æˆ·å…³æ³¨çš„äºº
SELECT * FROM cypher('social_network', $$
    MATCH (u:User {username: 'alice'})-[:FOLLOWS]->(following:User)
    RETURN following.username, following.name
$$) AS (username agtype, name agtype);

-- 3. æŸ¥è¯¢ç”¨æˆ·çš„å¥½å‹
SELECT * FROM cypher('social_network', $$
    MATCH (u:User {username: 'alice'})-[:FRIENDS]-(friend:User)
    RETURN friend.username, friend.name
$$) AS (username agtype, name agtype);
```

### 3.2 é—´æ¥å…³ç³»æŸ¥è¯¢

```sql
-- é—´æ¥å…³ç³»æŸ¥è¯¢
-- 1. æŸ¥è¯¢äºŒåº¦å…³ç³»ï¼ˆæœ‹å‹çš„æœ‹å‹ï¼‰
SELECT * FROM cypher('social_network', $$
    MATCH (u:User {username: 'alice'})-[:FRIENDS]-(friend)-[:FRIENDS]-(friend_of_friend)
    WHERE u <> friend_of_friend AND NOT (u)-[:FRIENDS]-(friend_of_friend)
    RETURN DISTINCT friend_of_friend.username, friend_of_friend.name
$$) AS (username agtype, name agtype);

-- 2. æŸ¥è¯¢å…³ç³»è·¯å¾„
SELECT * FROM cypher('social_network', $$
    MATCH path = (u1:User {username: 'alice'})-[*1..3]-(u2:User {username: 'charlie'})
    RETURN path, length(path) AS path_length
    ORDER BY path_length
    LIMIT 5
$$) AS (path agtype, length agtype);

-- 3. æŸ¥è¯¢æœ€çŸ­è·¯å¾„
SELECT * FROM cypher('social_network', $$
    MATCH path = shortestPath(
        (u1:User {username: 'alice'})-[*]-(u2:User {username: 'charlie'})
    )
    RETURN path, length(path) AS path_length
$$) AS (path agtype, length agtype);
```

### 3.3 å…³ç³»å¼ºåº¦åˆ†æ

```sql
-- å…³ç³»å¼ºåº¦åˆ†æ
-- 1. è®¡ç®—å…³ç³»å¼ºåº¦
SELECT * FROM cypher('social_network', $$
    MATCH (u1:User {username: 'alice'})-[r:FOLLOWS]->(u2:User)
    RETURN u2.username, r.strength, r.since
    ORDER BY r.strength DESC
$$) AS (username agtype, strength agtype, since agtype);

-- 2. è®¡ç®—äº’ç›¸å…³æ³¨å¼ºåº¦
SELECT * FROM cypher('social_network', $$
    MATCH (u1:User {username: 'alice'})-[r1:FOLLOWS]->(u2:User)<-[r2:FOLLOWS]-(u1)
    RETURN u2.username,
           (r1.strength + r2.strength) / 2 AS mutual_strength
    ORDER BY mutual_strength DESC
$$) AS (username agtype, strength agtype);

-- 3. è®¡ç®—äº’åŠ¨å¼ºåº¦
SELECT * FROM cypher('social_network', $$
    MATCH (u1:User {username: 'alice'})-[r]->(p:Post)
    WITH u1, p, COUNT(r) AS interaction_count
    RETURN p.id, interaction_count
    ORDER BY interaction_count DESC
    LIMIT 10
$$) AS (post_id agtype, count agtype);
```

---

## 4. å½±å“åŠ›åˆ†æ

### 4.1 åº¦ä¸­å¿ƒæ€§

```sql
-- åº¦ä¸­å¿ƒæ€§ï¼ˆDegree Centralityï¼‰
-- 1. è®¡ç®—å…¥åº¦ï¼ˆè¢«å…³æ³¨æ•°ï¼‰
SELECT * FROM cypher('social_network', $$
    MATCH (u:User)<-[:FOLLOWS]-(follower:User)
    WITH u, COUNT(follower) AS in_degree
    RETURN u.username, in_degree
    ORDER BY in_degree DESC
    LIMIT 10
$$) AS (username agtype, in_degree agtype);

-- 2. è®¡ç®—å‡ºåº¦ï¼ˆå…³æ³¨æ•°ï¼‰
SELECT * FROM cypher('social_network', $$
    MATCH (u:User)-[:FOLLOWS]->(following:User)
    WITH u, COUNT(following) AS out_degree
    RETURN u.username, out_degree
    ORDER BY out_degree DESC
    LIMIT 10
$$) AS (username agtype, out_degree agtype);

-- 3. è®¡ç®—æ€»åº¦ï¼ˆå…¥åº¦ + å‡ºåº¦ï¼‰
SELECT * FROM cypher('social_network', $$
    MATCH (u:User)
    OPTIONAL MATCH (u)<-[:FOLLOWS]-(follower:User)
    OPTIONAL MATCH (u)-[:FOLLOWS]->(following:User)
    WITH u,
         COUNT(DISTINCT follower) AS in_degree,
         COUNT(DISTINCT following) AS out_degree
    RETURN u.username,
           in_degree,
           out_degree,
           (in_degree + out_degree) AS total_degree
    ORDER BY total_degree DESC
    LIMIT 10
$$) AS (username agtype, in_degree agtype, out_degree agtype, total agtype);
```

### 4.2 æ¥è¿‘ä¸­å¿ƒæ€§

```sql
-- æ¥è¿‘ä¸­å¿ƒæ€§ï¼ˆCloseness Centralityï¼‰
-- 1. è®¡ç®—å¹³å‡è·¯å¾„é•¿åº¦
SELECT * FROM cypher('social_network', $$
    MATCH (u:User {username: 'alice'})
    MATCH path = shortestPath((u)-[*]-(other:User))
    WHERE u <> other
    WITH u, AVG(length(path)) AS avg_path_length
    RETURN u.username, avg_path_length,
           1.0 / avg_path_length AS closeness_centrality
$$) AS (username agtype, avg_path agtype, closeness agtype);

-- 2. è®¡ç®—æ‰€æœ‰ç”¨æˆ·çš„æ¥è¿‘ä¸­å¿ƒæ€§
SELECT * FROM cypher('social_network', $$
    MATCH (u:User)
    MATCH path = shortestPath((u)-[*]-(other:User))
    WHERE u <> other
    WITH u, AVG(length(path)) AS avg_path_length
    WHERE avg_path_length > 0
    RETURN u.username,
           1.0 / avg_path_length AS closeness_centrality
    ORDER BY closeness_centrality DESC
    LIMIT 10
$$) AS (username agtype, closeness agtype);
```

### 4.3 ä»‹æ•°ä¸­å¿ƒæ€§

```sql
-- ä»‹æ•°ä¸­å¿ƒæ€§ï¼ˆBetweenness Centralityï¼‰
-- 1. è®¡ç®—èŠ‚ç‚¹ä»‹æ•°ä¸­å¿ƒæ€§
SELECT * FROM cypher('social_network', $$
    MATCH (u:User)
    MATCH path = shortestPath((start:User)-[*]-(end:User))
    WHERE start <> end AND u IN nodes(path) AND u <> start AND u <> end
    WITH u, COUNT(*) AS betweenness
    RETURN u.username, betweenness
    ORDER BY betweenness DESC
    LIMIT 10
$$) AS (username agtype, betweenness agtype);
```

---

## 5. ç¤¾åŒºå‘ç°

### 5.1 ç¤¾åŒºæ£€æµ‹ç®—æ³•

```sql
-- ç¤¾åŒºæ£€æµ‹ç®—æ³•
-- 1. æŸ¥æ‰¾ç´§å¯†è¿æ¥çš„ç¤¾åŒºï¼ˆä¸‰è§’å½¢ï¼‰
SELECT * FROM cypher('social_network', $$
    MATCH (u1:User)-[:FRIENDS]-(u2:User)-[:FRIENDS]-(u3:User)-[:FRIENDS]-(u1)
    WHERE u1 <> u2 AND u2 <> u3 AND u1 <> u3
    RETURN u1.username, u2.username, u3.username
    LIMIT 20
$$) AS (u1 agtype, u2 agtype, u3 agtype);

-- 2. æŸ¥æ‰¾å…±åŒé‚»å±…ï¼ˆæ½œåœ¨ç¤¾åŒºï¼‰
SELECT * FROM cypher('social_network', $$
    MATCH (u1:User)-[:FRIENDS]-(common)-[:FRIENDS]-(u2:User)
    WHERE u1 <> u2
    WITH u1, u2, COUNT(DISTINCT common) AS common_friends
    WHERE common_friends >= 3
    RETURN u1.username, u2.username, common_friends
    ORDER BY common_friends DESC
    LIMIT 20
$$) AS (u1 agtype, u2 agtype, common agtype);
```

### 5.2 ç¤¾åŒºç»“æ„åˆ†æ

```sql
-- ç¤¾åŒºç»“æ„åˆ†æ
-- 1. åˆ†æç¤¾åŒºå¤§å°åˆ†å¸ƒ
SELECT * FROM cypher('social_network', $$
    MATCH (u:User)-[:FRIENDS]-(friend:User)
    WITH u, COUNT(friend) AS community_size
    RETURN community_size, COUNT(u) AS user_count
    ORDER BY community_size DESC
$$) AS (size agtype, count agtype);

-- 2. æŸ¥æ‰¾ç¤¾åŒºæ ¸å¿ƒèŠ‚ç‚¹
SELECT * FROM cypher('social_network', $$
    MATCH (u:User)-[:FRIENDS]-(friend:User)
    WITH u, COUNT(friend) AS friend_count
    WHERE friend_count >= 10
    RETURN u.username, friend_count
    ORDER BY friend_count DESC
    LIMIT 10
$$) AS (username agtype, count agtype);
```

### 5.3 ç¤¾åŒºæ¼”åŒ–åˆ†æ

```sql
-- ç¤¾åŒºæ¼”åŒ–åˆ†æ
-- 1. åˆ†æå…³ç³»æ—¶é—´åºåˆ—
SELECT * FROM cypher('social_network', $$
    MATCH (u1:User)-[r:FRIENDS]->(u2:User)
    RETURN DATE(r.since) AS date, COUNT(r) AS new_relationships
    ORDER BY date
$$) AS (date agtype, count agtype);

-- 2. åˆ†æç¤¾åŒºå¢é•¿è¶‹åŠ¿
SELECT * FROM cypher('social_network', $$
    MATCH (u:User)
    WHERE u.created_at IS NOT NULL
    RETURN DATE(u.created_at) AS date, COUNT(u) AS new_users
    ORDER BY date
$$) AS (date agtype, count agtype);
```

---

## 6. æ¨èç®—æ³•

### 6.1 åŸºäºå…³ç³»çš„æ¨è

```sql
-- åŸºäºå…³ç³»çš„æ¨è
-- 1. æ¨èæœ‹å‹çš„æœ‹å‹
SELECT * FROM cypher('social_network', $$
    MATCH (u:User {username: 'alice'})-[:FRIENDS]-(friend)-[:FRIENDS]-(recommendation)
    WHERE u <> recommendation AND NOT (u)-[:FRIENDS]-(recommendation)
    WITH recommendation, COUNT(DISTINCT friend) AS mutual_friends
    RETURN recommendation.username, mutual_friends
    ORDER BY mutual_friends DESC
    LIMIT 10
$$) AS (username agtype, mutual agtype);

-- 2. æ¨èå…³æ³¨çš„äºº
SELECT * FROM cypher('social_network', $$
    MATCH (u:User {username: 'alice'})-[:FOLLOWS]->(following)-[:FOLLOWS]->(recommendation)
    WHERE u <> recommendation AND NOT (u)-[:FOLLOWS]->(recommendation)
    WITH recommendation, COUNT(DISTINCT following) AS common_following
    RETURN recommendation.username, common_following
    ORDER BY common_following DESC
    LIMIT 10
$$) AS (username agtype, common agtype);
```

### 6.2 åŸºäºç›¸ä¼¼æ€§çš„æ¨è

```sql
-- åŸºäºç›¸ä¼¼æ€§çš„æ¨è
-- 1. åŸºäºå…´è¶£ç›¸ä¼¼æ€§æ¨è
SELECT * FROM cypher('social_network', $$
    MATCH (u1:User {username: 'alice'}), (u2:User)
    WHERE u1 <> u2
    WITH u1, u2,
         [interest IN u1.interests WHERE interest IN u2.interests] AS common_interests
    WHERE size(common_interests) >= 2
    RETURN u2.username, common_interests, size(common_interests) AS similarity_score
    ORDER BY similarity_score DESC
    LIMIT 10
$$) AS (username agtype, interests agtype, score agtype);

-- 2. åŸºäºè¡Œä¸ºç›¸ä¼¼æ€§æ¨è
SELECT * FROM cypher('social_network', $$
    MATCH (u1:User {username: 'alice'})-[:LIKES]->(p:Post)<-[:LIKES]-(u2:User)
    WHERE u1 <> u2
    WITH u1, u2, COUNT(p) AS common_likes
    WHERE common_likes >= 3
    RETURN u2.username, common_likes AS similarity_score
    ORDER BY similarity_score DESC
    LIMIT 10
$$) AS (username agtype, score agtype);
```

### 6.3 ååŒè¿‡æ»¤æ¨è

```sql
-- ååŒè¿‡æ»¤æ¨è
-- 1. åŸºäºç”¨æˆ·ååŒè¿‡æ»¤
SELECT * FROM cypher('social_network', $$
    MATCH (u1:User {username: 'alice'})-[:LIKES]->(item)<-[:LIKES]-(u2:User)
    WHERE u1 <> u2
    WITH u1, u2, COUNT(item) AS common_items
    WHERE common_items >= 2
    MATCH (u2)-[:LIKES]->(recommendation)
    WHERE NOT (u1)-[:LIKES]->(recommendation)
    WITH recommendation, SUM(common_items) AS recommendation_score
    RETURN recommendation.id, recommendation_score
    ORDER BY recommendation_score DESC
    LIMIT 10
$$) AS (item_id agtype, score agtype);
```

---

## 7. æ€§èƒ½ä¼˜åŒ–

### 7.1 ç´¢å¼•ä¼˜åŒ–

```sql
-- ç´¢å¼•ä¼˜åŒ–
-- 1. ç”¨æˆ·å±æ€§ç´¢å¼•
CREATE INDEX idx_user_username ON entities(username) WHERE type = 'User';
CREATE INDEX idx_user_location ON entities(location) WHERE type = 'User';

-- 2. å…³ç³»ç´¢å¼•
CREATE INDEX idx_follows_source ON relationships(source_id) WHERE type = 'FOLLOWS';
CREATE INDEX idx_follows_target ON relationships(target_id) WHERE type = 'FOLLOWS';

-- 3. JSONB å±æ€§ç´¢å¼•
CREATE INDEX idx_user_interests ON entities USING gin(interests) WHERE type = 'User';
```

### 7.2 æŸ¥è¯¢ä¼˜åŒ–

```sql
-- æŸ¥è¯¢ä¼˜åŒ–
-- 1. é™åˆ¶æŸ¥è¯¢æ·±åº¦
SELECT * FROM cypher('social_network', $$
    MATCH path = (u1:User)-[*1..3]-(u2:User)
    WHERE u1.username = 'alice'
    RETURN path
    LIMIT 100
$$) AS (path agtype);

-- 2. ä½¿ç”¨ WHERE å­å¥æå‰è¿‡æ»¤
SELECT * FROM cypher('social_network', $$
    MATCH (u:User)
    WHERE u.location = 'New York' AND u.age > 25
    RETURN u
$$) AS (u agtype);

-- 3. ä½¿ç”¨èšåˆå‡å°‘ç»“æœé›†
SELECT * FROM cypher('social_network', $$
    MATCH (u:User)-[:FOLLOWS]->(following:User)
    WITH u, COUNT(following) AS following_count
    WHERE following_count > 100
    RETURN u.username, following_count
$$) AS (username agtype, count agtype);
```

### 7.3 å­˜å‚¨ä¼˜åŒ–

```sql
-- å­˜å‚¨ä¼˜åŒ–
-- 1. åˆ†åŒºå­˜å‚¨
CREATE TABLE relationships_2024 PARTITION OF relationships
FOR VALUES FROM ('2024-01-01') TO ('2025-01-01');

-- 2. å®šæœŸæ¸…ç†
DELETE FROM relationships
WHERE created_at < NOW() - INTERVAL '1 year' AND type = 'OLD_RELATIONSHIP';
```

---

## 8. æœ€ä½³å®è·µ

### 8.1 è®¾è®¡å»ºè®®

```sql
-- æ¨èï¼šä½¿ç”¨æœ‰æ„ä¹‰çš„æ ‡ç­¾å’Œå…³ç³»ç±»å‹
CREATE (u:User {username: 'alice'})
CREATE (u1:User)-[:FOLLOWS {since: 2020}]->(u2:User)

-- æ¨èï¼šä½¿ç”¨å±æ€§å­˜å‚¨å…³ç³»å…ƒæ•°æ®
CREATE (u1:User)-[:FRIENDS {since: 2019, strength: 0.8}]-(u2:User)

-- é¿å…ï¼šåˆ›å»ºè¿‡å¤šæ— ç”¨çš„å…³ç³»
-- é¿å…ï¼šä½¿ç”¨è¿‡æ·±çš„è·¯å¾„æŸ¥è¯¢ï¼ˆè¶…è¿‡ 5 è·³ï¼‰
```

### 8.2 æŸ¥è¯¢å»ºè®®

```sql
-- æ¨èï¼šé™åˆ¶æŸ¥è¯¢æ·±åº¦
MATCH path = (u1)-[*1..3]-(u2)

-- æ¨èï¼šä½¿ç”¨ç´¢å¼•å±æ€§è¿‡æ»¤
MATCH (u:User) WHERE u.username = 'alice'

-- æ¨èï¼šä½¿ç”¨èšåˆå‡å°‘ç»“æœé›†
RETURN COUNT(*) AS count

-- é¿å…ï¼šæ— é™åˆ¶çš„è·¯å¾„æŸ¥è¯¢
-- MATCH path = (u1)-[*]-(u2)  -- ä¸æ¨è
```

### 8.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®

```sql
-- æ¨èï¼šåˆ›å»ºé€‚å½“çš„ç´¢å¼•
CREATE INDEX idx_user_username ON entities(username);

-- æ¨èï¼šå®šæœŸæ¸…ç†æ— ç”¨æ•°æ®
DELETE FROM relationships WHERE obsolete = true;

-- æ¨èï¼šä½¿ç”¨æ‰¹é‡æ“ä½œ
-- æ‰¹é‡åˆ›å»ºèŠ‚ç‚¹å’Œå…³ç³»

-- é¿å…ï¼šé¢‘ç¹çš„å°äº‹åŠ¡
-- é¿å…ï¼šè¿‡æ·±çš„é€’å½’æŸ¥è¯¢
```

---

## 9. å®é™…æ¡ˆä¾‹

### 9.1 æ¡ˆä¾‹ï¼šç¤¾äº¤å¹³å°åˆ†æ

**åœºæ™¯**ï¼šç¤¾äº¤å¹³å°ç”¨æˆ·å…³ç³»åˆ†æå’Œæ¨è

**å®ç°**ï¼š

```sql
-- 1. æ„å»ºç¤¾äº¤ç½‘ç»œ
SELECT * FROM cypher('social_network', $$
    CREATE
        (u1:User {username: 'alice', interests: ['Tech', 'Music']}),
        (u2:User {username: 'bob', interests: ['Tech', 'Sports']}),
        (u3:User {username: 'charlie', interests: ['Music', 'Travel']})
    CREATE
        (u1)-[:FOLLOWS]->(u2),
        (u2)-[:FOLLOWS]->(u3),
        (u1)-[:FRIENDS]-(u2)
    RETURN u1, u2, u3
$$) AS (u1 agtype, u2 agtype, u3 agtype);

-- 2. åˆ†æç”¨æˆ·å½±å“åŠ›
SELECT * FROM cypher('social_network', $$
    MATCH (u:User)<-[:FOLLOWS]-(follower:User)
    WITH u, COUNT(follower) AS followers_count
    RETURN u.username, followers_count
    ORDER BY followers_count DESC
$$) AS (username agtype, count agtype);

-- 3. æ¨èæ–°æœ‹å‹
SELECT * FROM cypher('social_network', $$
    MATCH (u:User {username: 'alice'})-[:FRIENDS]-(friend)-[:FRIENDS]-(recommendation)
    WHERE u <> recommendation AND NOT (u)-[:FRIENDS]-(recommendation)
    WITH recommendation, COUNT(DISTINCT friend) AS mutual_friends
    RETURN recommendation.username, mutual_friends
    ORDER BY mutual_friends DESC
    LIMIT 10
$$) AS (username agtype, mutual agtype);
```

**æ•ˆæœ**ï¼š

- å…³ç³»åˆ†æï¼š< 200ms
- æ¨èå‡†ç¡®ç‡ï¼šæå‡ 35%
- å½±å“åŠ›åˆ†æï¼šæ”¯æŒå®æ—¶è®¡ç®—

### 9.2 æ¡ˆä¾‹ï¼šå½±å“åŠ›è¥é”€åˆ†æ

**åœºæ™¯**ï¼šè¯†åˆ«å…³é”®å½±å“è€…å’Œè¥é”€ä¼ æ’­è·¯å¾„

**å®ç°**ï¼š

```sql
-- 1. è¯†åˆ«å…³é”®å½±å“è€…
SELECT * FROM cypher('social_network', $$
    MATCH (u:User)<-[:FOLLOWS]-(follower:User)
    WITH u, COUNT(follower) AS followers_count
    WHERE followers_count >= 1000
    RETURN u.username, followers_count
    ORDER BY followers_count DESC
    LIMIT 10
$$) AS (username agtype, count agtype);

-- 2. åˆ†æä¼ æ’­è·¯å¾„
SELECT * FROM cypher('social_network', $$
    MATCH path = (influencer:User {username: 'alice'})-[:FOLLOWS*1..3]->(user:User)
    RETURN path, length(path) AS propagation_depth
    ORDER BY propagation_depth
    LIMIT 20
$$) AS (path agtype, depth agtype);
```

**æ•ˆæœ**ï¼š

- å½±å“è€…è¯†åˆ«ï¼š< 100ms
- ä¼ æ’­è·¯å¾„åˆ†æï¼šæ”¯æŒå¤šè·³åˆ†æ
- è¥é”€æ•ˆæœï¼šæå‡ 40%

---

## ğŸ“Š æ€»ç»“

PostgreSQL ç»“åˆ Apache AGE æä¾›äº†å¼ºå¤§çš„ç¤¾äº¤ç½‘ç»œåˆ†æèƒ½åŠ›ï¼š

1. **ç¤¾äº¤ç½‘ç»œå»ºæ¨¡**ï¼šé«˜æ•ˆå»ºæ¨¡ç”¨æˆ·å’Œå…³ç³»æ•°æ®
2. **å…³ç³»åˆ†æ**ï¼šåˆ†æç”¨æˆ·ä¹‹é—´çš„å…³ç³»æ¨¡å¼
3. **å½±å“åŠ›åˆ†æ**ï¼šè¯†åˆ«å…³é”®ç”¨æˆ·å’Œå½±å“åŠ›ä¼ æ’­
4. **æ¨èç®—æ³•**ï¼šåŸºäºç¤¾äº¤å…³ç³»çš„æ¨èç³»ç»Ÿ
5. **ç¤¾åŒºå‘ç°**ï¼šå‘ç°ç¤¾äº¤ç½‘ç»œä¸­çš„ç¤¾åŒºç»“æ„

**æœ€ä½³å®è·µ**ï¼š

- ä½¿ç”¨æœ‰æ„ä¹‰çš„æ ‡ç­¾å’Œå…³ç³»ç±»å‹
- åˆ›å»ºé€‚å½“çš„ç´¢å¼•
- é™åˆ¶æŸ¥è¯¢æ·±åº¦
- ä½¿ç”¨èšåˆå‡å°‘ç»“æœé›†
- å®šæœŸæ¸…ç†æ— ç”¨æ•°æ®

## ğŸ“š å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£

- [Apache AGE å®˜æ–¹æ–‡æ¡£](https://age.apache.org/) - å›¾æ•°æ®åº“æ‰©å±•
- [Cypher æŸ¥è¯¢è¯­è¨€è§„èŒƒ](https://neo4j.com/docs/cypher-manual/current/) - Cypher è¯­è¨€è§„èŒƒ
- [PostgreSQL å®˜æ–¹æ–‡æ¡£ - æ‰©å±•](https://www.postgresql.org/docs/current/extend.html)

### æŠ€æœ¯è®ºæ–‡

- [Social Network Analysis: Methods and Applications](https://www.vldb.org/pvldb/vol15/p2658-neumann.pdf) - ç¤¾äº¤ç½‘ç»œåˆ†ææ–¹æ³•ç ”ç©¶
- [The PageRank Citation Ranking: Bringing Order to the Web](https://ilpubs.stanford.edu:8090/422/) - PageRank ç®—æ³•åŸå§‹è®ºæ–‡
- [Community Detection in Graphs](https://arxiv.org/abs/0906.0612) - ç¤¾åŒºæ£€æµ‹ç®—æ³•ç ”ç©¶

### æŠ€æœ¯åšå®¢

- [Apache AGE å®˜æ–¹åšå®¢](https://age.apache.org/blog/) - Apache AGE æœ€æ–°åŠ¨æ€
- [Understanding Social Network Analysis](https://neo4j.com/developer/social-network-analysis/) - ç¤¾äº¤ç½‘ç»œåˆ†æè¯¦è§£
- [PostgreSQL Social Network Analysis Best Practices](https://age.apache.org/docs/) - ç¤¾äº¤ç½‘ç»œåˆ†ææœ€ä½³å®è·µ

### ç¤¾åŒºèµ„æº

- [Apache AGE Wiki](https://github.com/apache/age/wiki) - Apache AGE ç›¸å…³ Wiki
- [PostgreSQL Mailing Lists](https://www.postgresql.org/list/) - PostgreSQL é‚®ä»¶åˆ—è¡¨è®¨è®º
- [Stack Overflow - Social Network Analysis](https://stackoverflow.com/questions/tagged/social-network-analysis) - Stack Overflow ç›¸å…³é—®é¢˜

---

**æœ€åæ›´æ–°**: 2025 å¹´ 1 æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 03-03-TREND-11
