# PostgreSQL Kuberneteséƒ¨ç½²æœ€ä½³å®è·µ

> **æ›´æ–°æ—¶é—´**: 2025å¹´1æœˆ
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 17+/18+, Kubernetes 1.28+
> **æ–‡æ¡£ç¼–å·**: 19-02-01

---

## ğŸ“‘ ç›®å½•

- [PostgreSQL Kuberneteséƒ¨ç½²æœ€ä½³å®è·µ](#postgresql-kuberneteséƒ¨ç½²æœ€ä½³å®è·µ)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 æŠ€æœ¯èƒŒæ™¯](#11-æŠ€æœ¯èƒŒæ™¯)
    - [1.2 æ ¸å¿ƒä»·å€¼è®ºè¯](#12-æ ¸å¿ƒä»·å€¼è®ºè¯)
  - [2. Kuberneteséƒ¨ç½²æ¶æ„è®¾è®¡](#2-kuberneteséƒ¨ç½²æ¶æ„è®¾è®¡)
    - [2.1 éƒ¨ç½²æ–¹æ¡ˆå†³ç­–çŸ©é˜µ](#21-éƒ¨ç½²æ–¹æ¡ˆå†³ç­–çŸ©é˜µ)
    - [2.2 æ¶æ„è®¾è®¡æ€ç»´å¯¼å›¾](#22-æ¶æ„è®¾è®¡æ€ç»´å¯¼å›¾)
  - [3. éƒ¨ç½²æ–¹æ¡ˆå¯¹æ¯”çŸ©é˜µ](#3-éƒ¨ç½²æ–¹æ¡ˆå¯¹æ¯”çŸ©é˜µ)
    - [3.1 éƒ¨ç½²å·¥å…·å¯¹æ¯”](#31-éƒ¨ç½²å·¥å…·å¯¹æ¯”)
    - [3.2 å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”](#32-å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”)
  - [4. ç”Ÿäº§çº§éƒ¨ç½²å®è·µ](#4-ç”Ÿäº§çº§éƒ¨ç½²å®è·µ)
    - [4.1 StatefulSetéƒ¨ç½²ç¤ºä¾‹](#41-statefulsetéƒ¨ç½²ç¤ºä¾‹)
    - [4.2 é«˜å¯ç”¨é…ç½®](#42-é«˜å¯ç”¨é…ç½®)
  - [5. é«˜å¯ç”¨æ¶æ„è®¾è®¡](#5-é«˜å¯ç”¨æ¶æ„è®¾è®¡)
    - [5.1 é«˜å¯ç”¨æ¶æ„å†³ç­–æ ‘](#51-é«˜å¯ç”¨æ¶æ„å†³ç­–æ ‘)
    - [5.2 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#52-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)

---

## 1. æ¦‚è¿°

### 1.1 æŠ€æœ¯èƒŒæ™¯

**Kuberneteséƒ¨ç½²çš„ä»·å€¼**ï¼š

PostgreSQLåœ¨Kubernetesä¸Šçš„éƒ¨ç½²æä¾›äº†äº‘åŸç”Ÿçš„æ•°æ®åº“ç®¡ç†èƒ½åŠ›ï¼š

1. **è‡ªåŠ¨åŒ–è¿ç»´**ï¼šè‡ªåŠ¨æ‰©ç¼©å®¹ã€è‡ªåŠ¨æ•…éšœæ¢å¤
2. **èµ„æºç®¡ç†**ï¼šCPUã€å†…å­˜ã€å­˜å‚¨èµ„æºåŠ¨æ€åˆ†é…
3. **é«˜å¯ç”¨ä¿éšœ**ï¼šPodè‡ªåŠ¨é‡å¯ã€èŠ‚ç‚¹æ•…éšœè‡ªåŠ¨è¿ç§»
4. **ç»Ÿä¸€ç®¡ç†**ï¼šä¸åº”ç”¨ç¨‹åºç»Ÿä¸€ç®¡ç†å¹³å°

### 1.2 æ ¸å¿ƒä»·å€¼è®ºè¯

| ä»·å€¼ç»´åº¦ | è¯´æ˜ | é‡åŒ–æ•°æ® |
|---------|------|---------|
| **è¿ç»´æ•ˆç‡** | è‡ªåŠ¨åŒ–è¿ç»´ | **+200%** æ•ˆç‡æå‡ |
| **å¯ç”¨æ€§** | è‡ªåŠ¨æ•…éšœæ¢å¤ | **99.9%** å¯ç”¨æ€§ |
| **èµ„æºåˆ©ç”¨ç‡** | åŠ¨æ€èµ„æºåˆ†é… | **+50%** åˆ©ç”¨ç‡ |
| **éƒ¨ç½²é€Ÿåº¦** | å¿«é€Ÿéƒ¨ç½² | **-80%** éƒ¨ç½²æ—¶é—´ |

---

## 2. Kuberneteséƒ¨ç½²æ¶æ„è®¾è®¡

### 2.1 éƒ¨ç½²æ–¹æ¡ˆå†³ç­–çŸ©é˜µ

| éƒ¨ç½²æ–¹æ¡ˆ | é€‚ç”¨åœºæ™¯ | å¤æ‚åº¦ | å¯ç”¨æ€§ | æ€§èƒ½ | æˆæœ¬ | ç»¼åˆè¯„åˆ† |
|---------|---------|--------|--------|------|------|---------|
| **StatefulSet + æœ¬åœ°å­˜å‚¨** | ä¸­å°è§„æ¨¡ | â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | **3.8** |
| **StatefulSet + PVC** | ä¸­å¤§è§„æ¨¡ | â­â­â­â­ | â­â­â­â­ | â­â­â­â­ | â­â­â­ | **3.6** |
| **PostgreSQL Operator** | å¤§è§„æ¨¡ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­ | **4.0** |
| **Citus Operator** | è¶…å¤§è§„æ¨¡ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­ | **3.8** |

### 2.2 æ¶æ„è®¾è®¡æ€ç»´å¯¼å›¾

```mermaid
graph TD
    A[Kubernetesé›†ç¾¤] --> B[PostgreSQLéƒ¨ç½²]
    B --> C[StatefulSet]
    B --> D[Service]
    B --> E[ConfigMap]
    B --> F[Secret]
    B --> G[PVC]

    C --> C1[ä¸»èŠ‚ç‚¹Pod]
    C --> C2[ä»èŠ‚ç‚¹Pod]
    C --> C3[ç›‘æ§Pod]

    D --> D1[ä¸»èŠ‚ç‚¹Service]
    D --> D2[ä»èŠ‚ç‚¹Service]
    D --> D3[åªè¯»Service]

    G --> G1[ä¸»èŠ‚ç‚¹å­˜å‚¨]
    G --> G2[ä»èŠ‚ç‚¹å­˜å‚¨]
    G --> G3[å¤‡ä»½å­˜å‚¨]

    style C fill:#90EE90
    style D fill:#87CEEB
    style G fill:#FFD700
```

---

## 3. éƒ¨ç½²æ–¹æ¡ˆå¯¹æ¯”çŸ©é˜µ

### 3.1 éƒ¨ç½²å·¥å…·å¯¹æ¯”

| å·¥å…· | æ˜“ç”¨æ€§ | åŠŸèƒ½å®Œæ•´æ€§ | ç¤¾åŒºæ”¯æŒ | ç”Ÿäº§å°±ç»ª | ç»¼åˆè¯„åˆ† |
|------|--------|-----------|---------|---------|---------|
| **åŸç”ŸStatefulSet** | â­â­â­ | â­â­â­ | â­â­â­â­â­ | â­â­â­ | **3.5** |
| **PostgreSQL Operator** | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | **4.3** |
| **CloudNativePG** | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | **4.5** |
| **Citus Operator** | â­â­â­â­ | â­â­â­â­â­ | â­â­â­ | â­â­â­â­ | **3.8** |

### 3.2 å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”

| å­˜å‚¨æ–¹æ¡ˆ | æ€§èƒ½ | å¯é æ€§ | æˆæœ¬ | å¯æ‰©å±•æ€§ | ç»¼åˆè¯„åˆ† |
|---------|------|--------|------|---------|---------|
| **æœ¬åœ°SSD** | â­â­â­â­â­ | â­â­â­ | â­â­â­â­ | â­â­ | **3.5** |
| **äº‘å­˜å‚¨ï¼ˆEBS/GCE PDï¼‰** | â­â­â­â­ | â­â­â­â­â­ | â­â­â­ | â­â­â­â­ | **4.0** |
| **åˆ†å¸ƒå¼å­˜å‚¨ï¼ˆCephï¼‰** | â­â­â­ | â­â­â­â­â­ | â­â­â­ | â­â­â­â­â­ | **3.5** |
| **NVMe over Fabrics** | â­â­â­â­â­ | â­â­â­â­ | â­â­ | â­â­â­â­ | **3.5** |

---

## 4. ç”Ÿäº§çº§éƒ¨ç½²å®è·µ

### 4.1 StatefulSetéƒ¨ç½²ç¤ºä¾‹

```yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: postgresql
  namespace: database
spec:
  serviceName: postgresql
  replicas: 3
  selector:
    matchLabels:
      app: postgresql
  template:
    metadata:
      labels:
        app: postgresql
    spec:
      containers:
      - name: postgresql
        image: postgres:17
        env:
        - name: POSTGRES_DB
          value: mydb
        - name: POSTGRES_USER
          valueFrom:
            secretKeyRef:
              name: postgresql-secret
              key: username
        - name: POSTGRES_PASSWORD
          valueFrom:
            secretKeyRef:
              name: postgresql-secret
              key: password
        ports:
        - containerPort: 5432
          name: postgresql
        volumeMounts:
        - name: postgresql-data
          mountPath: /var/lib/postgresql/data
        resources:
          requests:
            memory: "4Gi"
            cpu: "2"
          limits:
            memory: "8Gi"
            cpu: "4"
  volumeClaimTemplates:
  - metadata:
      name: postgresql-data
    spec:
      accessModes: [ "ReadWriteOnce" ]
      storageClassName: fast-ssd
      resources:
        requests:
          storage: 100Gi
```

### 4.2 é«˜å¯ç”¨é…ç½®

```yaml
apiVersion: v1
kind: Service
metadata:
  name: postgresql-primary
  namespace: database
spec:
  type: ClusterIP
  selector:
    app: postgresql
    role: primary
  ports:
  - port: 5432
    targetPort: 5432
---
apiVersion: v1
kind: Service
metadata:
  name: postgresql-replica
  namespace: database
spec:
  type: ClusterIP
  selector:
    app: postgresql
    role: replica
  ports:
  - port: 5432
    targetPort: 5432
```

---

## 5. é«˜å¯ç”¨æ¶æ„è®¾è®¡

### 5.1 é«˜å¯ç”¨æ¶æ„å†³ç­–æ ‘

```text
éœ€è¦é«˜å¯ç”¨ï¼Ÿ
â”œâ”€ æ˜¯
â”‚  â”œâ”€ æ•°æ®è§„æ¨¡ï¼Ÿ
â”‚  â”‚  â”œâ”€ å°è§„æ¨¡ï¼ˆ< 100GBï¼‰ â†’ StatefulSet + æµå¤åˆ¶
â”‚  â”‚  â”œâ”€ ä¸­è§„æ¨¡ï¼ˆ100GB-1TBï¼‰ â†’ PostgreSQL Operator
â”‚  â”‚  â””â”€ å¤§è§„æ¨¡ï¼ˆ> 1TBï¼‰ â†’ Citus Operator
â”‚  â”œâ”€ æ•…éšœæ¢å¤æ—¶é—´è¦æ±‚ï¼Ÿ
â”‚  â”‚  â”œâ”€ < 30ç§’ â†’ PostgreSQL Operator + Patroni
â”‚  â”‚  â”œâ”€ < 1åˆ†é’Ÿ â†’ StatefulSet + è‡ªåŠ¨æ•…éšœè½¬ç§»
â”‚  â”‚  â””â”€ < 5åˆ†é’Ÿ â†’ æ‰‹åŠ¨æ•…éšœè½¬ç§»
â”‚  â””â”€ å­˜å‚¨æ–¹æ¡ˆï¼Ÿ
â”‚     â”œâ”€ é«˜æ€§èƒ½ â†’ æœ¬åœ°SSD + å¤‡ä»½
â”‚     â”œâ”€ é«˜å¯é  â†’ äº‘å­˜å‚¨ï¼ˆEBS/GCE PDï¼‰
â”‚     â””â”€ å¤§è§„æ¨¡ â†’ åˆ†å¸ƒå¼å­˜å‚¨ï¼ˆCephï¼‰
â””â”€ å¦ â†’ å•èŠ‚ç‚¹éƒ¨ç½²
```

### 5.2 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

| ä¼˜åŒ–ç­–ç•¥ | æ€§èƒ½æå‡ | å®æ–½éš¾åº¦ | é€‚ç”¨åœºæ™¯ | ä¼˜å…ˆçº§ |
|---------|---------|---------|---------|--------|
| **èµ„æºé™åˆ¶ä¼˜åŒ–** | 20-30% | ä½ | æ‰€æœ‰åœºæ™¯ | P0 |
| **å­˜å‚¨ç±»ä¼˜åŒ–** | 50-100% | ä¸­ | I/Oå¯†é›†å‹ | P1 |
| **ç½‘ç»œç­–ç•¥ä¼˜åŒ–** | 10-20% | ä½ | é«˜å¹¶å‘ | P1 |
| **Podäº²å’Œæ€§ä¼˜åŒ–** | 10-15% | ä¸­ | å¤šèŠ‚ç‚¹ | P2 |

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 19-02-01
