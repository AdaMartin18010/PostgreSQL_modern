# PostgreSQLæ•°æ®æ²»ç†æœ€ä½³å®è·µ

> **æ›´æ–°æ—¶é—´**: 2025å¹´1æœˆ
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 17+/18+
> **æ–‡æ¡£ç¼–å·**: 19-05-04

---

## ğŸ“‘ ç›®å½•

- [PostgreSQLæ•°æ®æ²»ç†æœ€ä½³å®è·µ](#postgresqlæ•°æ®æ²»ç†æœ€ä½³å®è·µ)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 æ•°æ®æ²»ç†ä»·å€¼](#11-æ•°æ®æ²»ç†ä»·å€¼)
  - [2. æ•°æ®æ²»ç†ç­–ç•¥çŸ©é˜µ](#2-æ•°æ®æ²»ç†ç­–ç•¥çŸ©é˜µ)
  - [3. æ•°æ®è´¨é‡å†³ç­–æ ‘](#3-æ•°æ®è´¨é‡å†³ç­–æ ‘)
  - [4. å®é™…åº”ç”¨æ¡ˆä¾‹](#4-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [4.1 æ¡ˆä¾‹ï¼šé‡‘èç³»ç»Ÿæ•°æ®æ²»ç†](#41-æ¡ˆä¾‹é‡‘èç³»ç»Ÿæ•°æ®æ²»ç†)

---

## 1. æ¦‚è¿°

### 1.1 æ•°æ®æ²»ç†ä»·å€¼

**æ•°æ®æ²»ç†çš„æ ¸å¿ƒä»·å€¼**ï¼š

| ä»·å€¼ç»´åº¦ | è¯´æ˜ | é‡åŒ–æ•°æ® |
|---------|------|---------|
| **æ•°æ®è´¨é‡** | æ•°æ®å‡†ç¡®æ€§ | **+50%** è´¨é‡ |
| **åˆè§„æ€§** | æ³•è§„éµå¾ª | **100%** åˆè§„ |
| **æ•°æ®å®‰å…¨** | æ•°æ®ä¿æŠ¤ | **+80%** å®‰å…¨æ€§ |

---

## 2. æ•°æ®æ²»ç†ç­–ç•¥çŸ©é˜µ

| ç­–ç•¥ | å®æ–½éš¾åº¦ | æ•ˆæœ | æˆæœ¬ | ä¼˜å…ˆçº§ |
|------|---------|------|------|--------|
| **æ•°æ®åˆ†ç±»** | â­â­ | â­â­â­â­ | ä½ | P0 |
| **è®¿é—®æ§åˆ¶** | â­â­â­ | â­â­â­â­â­ | ä¸­ | P0 |
| **æ•°æ®åŠ å¯†** | â­â­â­ | â­â­â­â­â­ | ä¸­ | P1 |
| **å®¡è®¡æ—¥å¿—** | â­â­ | â­â­â­â­ | ä½ | P1 |

---

## 3. æ•°æ®è´¨é‡å†³ç­–æ ‘

```text
æ•°æ®è´¨é‡é—®é¢˜ï¼Ÿ
â”œâ”€ æ•°æ®å‡†ç¡®æ€§
â”‚  â””â”€ æ•°æ®éªŒè¯è§„åˆ™
â”œâ”€ æ•°æ®å®Œæ•´æ€§
â”‚  â””â”€ çº¦æŸæ£€æŸ¥
â””â”€ æ•°æ®ä¸€è‡´æ€§
   â””â”€ äº‹åŠ¡ä¿è¯
```

---

## 4. å®é™…åº”ç”¨æ¡ˆä¾‹

### 4.1 æ¡ˆä¾‹ï¼šé‡‘èç³»ç»Ÿæ•°æ®æ²»ç†

**ä¸šåŠ¡åœºæ™¯**ï¼š

- é“¶è¡Œæ ¸å¿ƒç³»ç»Ÿ
- 1000ä¸‡+è´¦æˆ·æ•°æ®
- ä¸¥æ ¼çš„åˆè§„è¦æ±‚ï¼ˆGDPRã€PCI-DSSï¼‰

**å®æ–½æ–¹æ¡ˆ**ï¼š

```sql
-- 1. æ•°æ®åˆ†ç±»
CREATE TABLE account_data (
    id BIGSERIAL PRIMARY KEY,
    account_number TEXT,
    balance DECIMAL(15, 2),
    data_classification TEXT CHECK (data_classification IN ('public', 'internal', 'confidential', 'restricted')),
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 2. è®¿é—®æ§åˆ¶ï¼ˆè¡Œçº§å®‰å…¨ï¼‰
ALTER TABLE account_data ENABLE ROW LEVEL SECURITY;

CREATE POLICY account_access_policy ON account_data
    FOR SELECT
    USING (
        CASE data_classification
            WHEN 'public' THEN true
            WHEN 'internal' THEN current_user IN (SELECT username FROM authorized_users)
            WHEN 'confidential' THEN current_user IN (SELECT username FROM managers)
            WHEN 'restricted' THEN current_user = 'admin'
        END
    );

-- 3. æ•°æ®åŠ å¯†
CREATE EXTENSION IF NOT EXISTS pgcrypto;

ALTER TABLE account_data
ADD COLUMN encrypted_account_number BYTEA;

-- åŠ å¯†å‡½æ•°
CREATE OR REPLACE FUNCTION encrypt_account_number(account_num TEXT)
RETURNS BYTEA AS $$
BEGIN
    RETURN pgp_sym_encrypt(account_num, current_setting('app.encryption_key'));
END;
$$ LANGUAGE plpgsql;

-- 4. å®¡è®¡æ—¥å¿—
CREATE TABLE audit_log (
    id BIGSERIAL PRIMARY KEY,
    table_name TEXT,
    operation TEXT,
    old_data JSONB,
    new_data JSONB,
    user_name TEXT,
    timestamp TIMESTAMPTZ DEFAULT NOW()
);

CREATE OR REPLACE FUNCTION audit_trigger()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO audit_log (table_name, operation, old_data, new_data, user_name)
    VALUES (
        TG_TABLE_NAME,
        TG_OP,
        row_to_json(OLD)::JSONB,
        row_to_json(NEW)::JSONB,
        current_user
    );
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER account_data_audit
    AFTER INSERT OR UPDATE OR DELETE ON account_data
    FOR EACH ROW EXECUTE FUNCTION audit_trigger();
```

**å®æ–½æ•ˆæœ**ï¼š

| æŒ‡æ ‡ | å®æ–½å‰ | å®æ–½å | æå‡ |
|------|--------|--------|------|
| **æ•°æ®è´¨é‡** | 75% | 95% | **+27%** |
| **åˆè§„æ€§** | 60% | 100% | **+67%** |
| **å®‰å…¨äº‹ä»¶** | 10æ¬¡/å¹´ | 0æ¬¡/å¹´ | **-100%** |

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 19-05-04
