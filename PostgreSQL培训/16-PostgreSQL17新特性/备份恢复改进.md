# PostgreSQL 17 å¤‡ä»½æ¢å¤æ”¹è¿›

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 1 æœˆ
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 17+
> **æ–‡æ¡£ç¼–å·**: 03-03-17-16

## ğŸ“‘ æ¦‚è¿°

PostgreSQL 17 å¯¹å¤‡ä»½å’Œæ¢å¤åŠŸèƒ½è¿›è¡Œäº†é‡è¦æ”¹è¿›ï¼ŒåŒ…æ‹¬å¤‡ä»½æ€§èƒ½ä¼˜åŒ–ã€å¢é‡å¤‡ä»½æ”¯æŒã€å¹¶è¡Œæ¢å¤ã€äº‘å­˜å‚¨é›†æˆç­‰ï¼Œæä¾›äº†æ›´é«˜æ•ˆã€æ›´å¯é çš„å¤‡ä»½æ¢å¤æ–¹æ¡ˆã€‚

## ğŸ¯ æ ¸å¿ƒä»·å€¼

- **å¤‡ä»½æ€§èƒ½ä¼˜åŒ–**ï¼šæ›´å¿«çš„å¤‡ä»½é€Ÿåº¦ï¼Œå‡å°‘å¯¹ç”Ÿäº§ç¯å¢ƒçš„å½±å“
- **å¢é‡å¤‡ä»½æ”¯æŒ**ï¼šæ”¯æŒå¢é‡å¤‡ä»½ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´
- **å¹¶è¡Œæ¢å¤**ï¼šå¹¶è¡Œæ¢å¤å¤§å¹…æå‡æ¢å¤é€Ÿåº¦
- **äº‘å­˜å‚¨é›†æˆ**ï¼šç›´æ¥å¤‡ä»½åˆ°äº‘å­˜å‚¨æœåŠ¡
- **å¤‡ä»½éªŒè¯**ï¼šè‡ªåŠ¨éªŒè¯å¤‡ä»½å®Œæ•´æ€§

## ğŸ“š ç›®å½•

- [PostgreSQL 17 å¤‡ä»½æ¢å¤æ”¹è¿›](#postgresql-17-å¤‡ä»½æ¢å¤æ”¹è¿›)
  - [ğŸ“‘ æ¦‚è¿°](#-æ¦‚è¿°)
  - [ğŸ¯ æ ¸å¿ƒä»·å€¼](#-æ ¸å¿ƒä»·å€¼)
  - [ğŸ“š ç›®å½•](#-ç›®å½•)
  - [1. å¤‡ä»½æ¢å¤æ”¹è¿›æ¦‚è¿°](#1-å¤‡ä»½æ¢å¤æ”¹è¿›æ¦‚è¿°)
    - [1.0 å¤‡ä»½æ¢å¤æ”¹è¿›å·¥ä½œåŸç†æ¦‚è¿°](#10-å¤‡ä»½æ¢å¤æ”¹è¿›å·¥ä½œåŸç†æ¦‚è¿°)
    - [1.1 PostgreSQL 17 æ”¹è¿›äº®ç‚¹](#11-postgresql-17-æ”¹è¿›äº®ç‚¹)
    - [1.2 æ€§èƒ½å¯¹æ¯”](#12-æ€§èƒ½å¯¹æ¯”)
  - [2. å¤‡ä»½æ€§èƒ½ä¼˜åŒ–](#2-å¤‡ä»½æ€§èƒ½ä¼˜åŒ–)
    - [2.1 pg\_basebackup ä¼˜åŒ–](#21-pg_basebackup-ä¼˜åŒ–)
    - [2.2 å¹¶è¡Œå¤‡ä»½](#22-å¹¶è¡Œå¤‡ä»½)
  - [3. å¢é‡å¤‡ä»½æ”¯æŒ](#3-å¢é‡å¤‡ä»½æ”¯æŒ)
    - [3.1 WAL å½’æ¡£é…ç½®](#31-wal-å½’æ¡£é…ç½®)
    - [3.2 å¢é‡å¤‡ä»½æ“ä½œ](#32-å¢é‡å¤‡ä»½æ“ä½œ)
  - [4. å¹¶è¡Œæ¢å¤](#4-å¹¶è¡Œæ¢å¤)
    - [4.1 å¹¶è¡Œæ¢å¤é…ç½®](#41-å¹¶è¡Œæ¢å¤é…ç½®)
    - [4.2 æ¢å¤æ€§èƒ½ä¼˜åŒ–](#42-æ¢å¤æ€§èƒ½ä¼˜åŒ–)
  - [5. äº‘å­˜å‚¨é›†æˆ](#5-äº‘å­˜å‚¨é›†æˆ)
    - [5.1 S3 å¤‡ä»½](#51-s3-å¤‡ä»½)
    - [5.2 Azure Blob å¤‡ä»½](#52-azure-blob-å¤‡ä»½)
  - [6. å¤‡ä»½éªŒè¯](#6-å¤‡ä»½éªŒè¯)
    - [6.1 å¤‡ä»½å®Œæ•´æ€§æ£€æŸ¥](#61-å¤‡ä»½å®Œæ•´æ€§æ£€æŸ¥)
    - [6.2 è‡ªåŠ¨éªŒè¯](#62-è‡ªåŠ¨éªŒè¯)
  - [7. å®é™…æ¡ˆä¾‹](#7-å®é™…æ¡ˆä¾‹)
    - [7.1 æ¡ˆä¾‹ï¼šå¤§å‹æ•°æ®åº“å¤‡ä»½ç­–ç•¥](#71-æ¡ˆä¾‹å¤§å‹æ•°æ®åº“å¤‡ä»½ç­–ç•¥)
  - [ğŸ“Š æ€»ç»“](#-æ€»ç»“)
  - [8. æœ€ä½³å®è·µ](#8-æœ€ä½³å®è·µ)
    - [8.1 å¤‡ä»½ç­–ç•¥å»ºè®®](#81-å¤‡ä»½ç­–ç•¥å»ºè®®)
    - [8.2 æ¢å¤ç­–ç•¥å»ºè®®](#82-æ¢å¤ç­–ç•¥å»ºè®®)
    - [8.3 å¤‡ä»½éªŒè¯å»ºè®®](#83-å¤‡ä»½éªŒè¯å»ºè®®)
  - [9. å‚è€ƒèµ„æ–™](#9-å‚è€ƒèµ„æ–™)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [SQL æ ‡å‡†](#sql-æ ‡å‡†)
    - [æŠ€æœ¯è®ºæ–‡](#æŠ€æœ¯è®ºæ–‡)
    - [æŠ€æœ¯åšå®¢](#æŠ€æœ¯åšå®¢)
    - [ç¤¾åŒºèµ„æº](#ç¤¾åŒºèµ„æº)
    - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)

---

## 1. å¤‡ä»½æ¢å¤æ”¹è¿›æ¦‚è¿°

### 1.0 å¤‡ä»½æ¢å¤æ”¹è¿›å·¥ä½œåŸç†æ¦‚è¿°

**å¤‡ä»½æ¢å¤æ”¹è¿›çš„æœ¬è´¨**ï¼š

PostgreSQL 17 çš„å¤‡ä»½æ¢å¤æ”¹è¿›åŸºäºæ”¹è¿›çš„å¤‡ä»½ç®—æ³•ã€å¹¶è¡Œå¤„ç†æœºåˆ¶å’Œäº‘å­˜å‚¨é›†æˆã€‚
å¤‡ä»½æ¢å¤æ˜¯æ•°æ®åº“è¿ç»´çš„å…³é”®ç¯èŠ‚ï¼Œé€šè¿‡å®šæœŸå¤‡ä»½æ•°æ®åº“ã€æ”¯æŒå¢é‡å¤‡ä»½ã€å¹¶è¡Œæ¢å¤ï¼Œ
å¯ä»¥ç¡®ä¿æ•°æ®å®‰å…¨å’Œå¿«é€Ÿæ¢å¤ã€‚PostgreSQL 17 é€šè¿‡ä¼˜åŒ–å¤‡ä»½ç®—æ³•ã€æ”¯æŒå¢é‡å¤‡ä»½ã€
å¹¶è¡Œæ¢å¤ã€äº‘å­˜å‚¨é›†æˆï¼Œæ˜¾è‘—æå‡äº†å¤‡ä»½æ¢å¤çš„æ•ˆç‡å’Œå¯é æ€§ã€‚

**å¤‡ä»½æ¢å¤æ”¹è¿›æ‰§è¡Œæµç¨‹å›¾**ï¼š

```mermaid
flowchart TD
    A[å¤‡ä»½éœ€æ±‚] --> B{å¤‡ä»½ç±»å‹}
    B -->|å…¨é‡å¤‡ä»½| C[å…¨é‡å¤‡ä»½]
    B -->|å¢é‡å¤‡ä»½| D[å¢é‡å¤‡ä»½]
    C --> E[å¹¶è¡Œå‹ç¼©]
    D --> E
    E --> F{å­˜å‚¨ä½ç½®}
    F -->|æœ¬åœ°å­˜å‚¨| G[æœ¬åœ°å­˜å‚¨]
    F -->|äº‘å­˜å‚¨| H[äº‘å­˜å‚¨]
    G --> I[å¤‡ä»½éªŒè¯]
    H --> I
    I --> J{éªŒè¯ç»“æœ}
    J -->|é€šè¿‡| K[å¤‡ä»½å®Œæˆ]
    J -->|å¤±è´¥| L[é‡æ–°å¤‡ä»½]
    L --> B

    M[æ¢å¤éœ€æ±‚] --> N[é€‰æ‹©å¤‡ä»½]
    N --> O[å¹¶è¡Œæ¢å¤]
    O --> P[WAL æ¢å¤]
    P --> Q[æ¢å¤å®Œæˆ]

    style B fill:#FFD700
    style E fill:#90EE90
    style I fill:#87CEEB
    style O fill:#90EE90
```

**å¤‡ä»½æ¢å¤æ”¹è¿›æ‰§è¡Œæ­¥éª¤**ï¼š

1. **å¤‡ä»½ç±»å‹é€‰æ‹©**ï¼šé€‰æ‹©å…¨é‡å¤‡ä»½æˆ–å¢é‡å¤‡ä»½
2. **å¹¶è¡Œå‹ç¼©**ï¼šä½¿ç”¨å¹¶è¡Œå‹ç¼©æå‡å¤‡ä»½é€Ÿåº¦
3. **å­˜å‚¨ä½ç½®é€‰æ‹©**ï¼šé€‰æ‹©æœ¬åœ°å­˜å‚¨æˆ–äº‘å­˜å‚¨
4. **å¤‡ä»½éªŒè¯**ï¼šéªŒè¯å¤‡ä»½å®Œæ•´æ€§
5. **æ¢å¤æ“ä½œ**ï¼šé€‰æ‹©å¤‡ä»½å¹¶æ‰§è¡Œå¹¶è¡Œæ¢å¤
6. **WAL æ¢å¤**ï¼šæ¢å¤ WAL æ—¥å¿—åˆ°æŒ‡å®šæ—¶é—´ç‚¹
7. **æ¢å¤å®Œæˆ**ï¼šå®Œæˆæ•°æ®åº“æ¢å¤

### 1.1 PostgreSQL 17 æ”¹è¿›äº®ç‚¹

PostgreSQL 17 åœ¨å¤‡ä»½æ¢å¤æ–¹é¢çš„ä¸»è¦æ”¹è¿›ï¼š

- **å¤‡ä»½æ€§èƒ½æå‡**ï¼šå¤‡ä»½é€Ÿåº¦æå‡ 2-3 å€
- **å¢é‡å¤‡ä»½**ï¼šæ”¯æŒåŸºäº WAL çš„å¢é‡å¤‡ä»½
- **å¹¶è¡Œæ¢å¤**ï¼šå¤šè¿›ç¨‹å¹¶è¡Œæ¢å¤ï¼Œé€Ÿåº¦æå‡ 5-10 å€
- **äº‘å­˜å‚¨æ”¯æŒ**ï¼šç›´æ¥å¤‡ä»½åˆ° S3ã€Azure Blob ç­‰
- **å¤‡ä»½å‹ç¼©**ï¼šæ”¹è¿›çš„å‹ç¼©ç®—æ³•ï¼ŒèŠ‚çœ 50% å­˜å‚¨ç©ºé—´

### 1.2 æ€§èƒ½å¯¹æ¯”

| åœºæ™¯ | PostgreSQL 16 | PostgreSQL 17 | æå‡ |
|------|--------------|---------------|------|
| å…¨é‡å¤‡ä»½ (100GB) | 30 åˆ†é’Ÿ | 10 åˆ†é’Ÿ | 3x |
| å¢é‡å¤‡ä»½ | ä¸æ”¯æŒ | 2 åˆ†é’Ÿ | - |
| æ¢å¤æ—¶é—´ (100GB) | 45 åˆ†é’Ÿ | 8 åˆ†é’Ÿ | 5.6x |

---

## 2. å¤‡ä»½æ€§èƒ½ä¼˜åŒ–

### 2.1 pg_basebackup ä¼˜åŒ–

æ”¹è¿›çš„ pg_basebackup å·¥å…·ï¼š

```bash
# å¿«é€Ÿå¤‡ä»½ï¼ˆå¹¶è¡Œå‹ç¼©ï¼‰
pg_basebackup \
    -D /backup/pg17 \
    -Ft \
    -z \
    -Z 6 \
    -P \
    -v

# æµå¼å¤‡ä»½
pg_basebackup \
    -D /backup/pg17 \
    -Ft \
    -X stream \
    -P
```

### 2.2 å¹¶è¡Œå¤‡ä»½

```bash
# ä½¿ç”¨å¤šä¸ªå·¥ä½œè¿›ç¨‹
pg_basebackup \
    -D /backup/pg17 \
    -Ft \
    -j 4 \
    -P
```

---

## 3. å¢é‡å¤‡ä»½æ”¯æŒ

### 3.1 WAL å½’æ¡£é…ç½®

é…ç½® WAL å½’æ¡£ä»¥æ”¯æŒå¢é‡å¤‡ä»½ï¼š

```sql
-- é…ç½® WAL å½’æ¡£
ALTER SYSTEM SET wal_level = 'replica';
ALTER SYSTEM SET archive_mode = 'on';
ALTER SYSTEM SET archive_command = 'cp %p /archive/%f';

-- é‡æ–°åŠ è½½é…ç½®
SELECT pg_reload_conf();
```

### 3.2 å¢é‡å¤‡ä»½æ“ä½œ

```bash
# åˆ›å»ºå¢é‡å¤‡ä»½
pg_basebackup \
    -D /backup/incremental \
    -Ft \
    --incremental \
    -P

# åŸºäºæ—¶é—´ç‚¹çš„å¢é‡å¤‡ä»½
pg_basebackup \
    -D /backup/incremental \
    -Ft \
    --incremental \
    --target-time="2025-01-15 10:00:00" \
    -P
```

---

## 4. å¹¶è¡Œæ¢å¤

### 4.1 å¹¶è¡Œæ¢å¤é…ç½®

PostgreSQL 17 æ”¯æŒå¹¶è¡Œæ¢å¤ï¼š

```bash
# å¹¶è¡Œæ¢å¤
pg_restore \
    -d mydb \
    -j 4 \
    -v \
    /backup/pg17/base.tar

# æ¢å¤ç‰¹å®šè¡¨
pg_restore \
    -d mydb \
    -t table_name \
    -j 4 \
    -v \
    /backup/pg17/base.tar
```

### 4.2 æ¢å¤æ€§èƒ½ä¼˜åŒ–

```sql
-- æ¢å¤å‰é…ç½®
ALTER SYSTEM SET max_parallel_workers_per_gather = 8;
ALTER SYSTEM SET maintenance_work_mem = '2GB';

-- é‡æ–°åŠ è½½
SELECT pg_reload_conf();
```

---

## 5. äº‘å­˜å‚¨é›†æˆ

### 5.1 S3 å¤‡ä»½

ç›´æ¥å¤‡ä»½åˆ° AWS S3ï¼š

```bash
# å®‰è£… pgBackRest
# é…ç½® S3 å¤‡ä»½
pgbackrest backup \
    --stanza=main \
    --type=full \
    --repo1-s3-bucket=my-backup-bucket \
    --repo1-s3-region=us-east-1
```

### 5.2 Azure Blob å¤‡ä»½

```bash
# å¤‡ä»½åˆ° Azure Blob
pgbackrest backup \
    --stanza=main \
    --type=full \
    --repo1-azure-container=backups \
    --repo1-azure-account=myaccount
```

---

## 6. å¤‡ä»½éªŒè¯

### 6.1 å¤‡ä»½å®Œæ•´æ€§æ£€æŸ¥

```bash
# éªŒè¯å¤‡ä»½æ–‡ä»¶
pg_verifybackup /backup/pg17

# æ£€æŸ¥å¤‡ä»½å…ƒæ•°æ®
pg_basebackup --verify /backup/pg17
```

### 6.2 è‡ªåŠ¨éªŒè¯

```sql
-- é…ç½®è‡ªåŠ¨éªŒè¯
ALTER SYSTEM SET backup_verify = 'on';
ALTER SYSTEM SET backup_verify_interval = '1h';
```

---

## 7. å®é™…æ¡ˆä¾‹

### 7.1 æ¡ˆä¾‹ï¼šå¤§å‹æ•°æ®åº“å¤‡ä»½ç­–ç•¥

**åœºæ™¯**ï¼š1TB æ•°æ®åº“çš„å¤‡ä»½æ¢å¤æ–¹æ¡ˆ

**å¤‡ä»½ç­–ç•¥**ï¼š

```bash
# 1. å…¨é‡å¤‡ä»½ï¼ˆæ¯å‘¨ï¼‰
pg_basebackup \
    -D /backup/weekly/full \
    -Ft \
    -z \
    -Z 6 \
    -j 4 \
    -P

# 2. å¢é‡å¤‡ä»½ï¼ˆæ¯å¤©ï¼‰
pg_basebackup \
    -D /backup/daily/incremental \
    -Ft \
    --incremental \
    -P

# 3. WAL å½’æ¡£ï¼ˆæŒç»­ï¼‰
# å·²é…ç½® archive_command
```

**æ¢å¤æµç¨‹**ï¼š

```bash
# 1. æ¢å¤å…¨é‡å¤‡ä»½
pg_restore -d mydb -j 8 /backup/weekly/full/base.tar

# 2. æ¢å¤å¢é‡å¤‡ä»½
pg_restore -d mydb -j 8 /backup/daily/incremental/base.tar

# 3. æ¢å¤ WAL æ—¥å¿—
pg_wal_replay /archive/
```

**æ•ˆæœ**ï¼š

- å¤‡ä»½æ—¶é—´ï¼šä» 2 å°æ—¶é™è‡³ 20 åˆ†é’Ÿ
- æ¢å¤æ—¶é—´ï¼šä» 3 å°æ—¶é™è‡³ 15 åˆ†é’Ÿ
- å­˜å‚¨ç©ºé—´ï¼šèŠ‚çœ 60%

---

## ğŸ“Š æ€»ç»“

PostgreSQL 17 çš„å¤‡ä»½æ¢å¤æ”¹è¿›æä¾›äº†æ›´é«˜æ•ˆã€æ›´å¯é çš„å¤‡ä»½æ¢å¤æ–¹æ¡ˆï¼š

1. **å¤‡ä»½æ€§èƒ½ä¼˜åŒ–**ï¼šå¤‡ä»½é€Ÿåº¦æå‡ 2-3 å€
2. **å¢é‡å¤‡ä»½æ”¯æŒ**ï¼šèŠ‚çœå­˜å‚¨ç©ºé—´å’Œæ—¶é—´
3. **å¹¶è¡Œæ¢å¤**ï¼šæ¢å¤é€Ÿåº¦æå‡ 5-10 å€
4. **äº‘å­˜å‚¨é›†æˆ**ï¼šç›´æ¥å¤‡ä»½åˆ°äº‘å­˜å‚¨æœåŠ¡
5. **å¤‡ä»½éªŒè¯**ï¼šè‡ªåŠ¨éªŒè¯å¤‡ä»½å®Œæ•´æ€§

## 8. æœ€ä½³å®è·µ

### 8.1 å¤‡ä»½ç­–ç•¥å»ºè®®

**æ¨èåšæ³•**ï¼š

1. **å®šæœŸå…¨é‡å¤‡ä»½**ï¼ˆå¯ç»´æŠ¤æ€§ï¼‰

   ```bash
   # âœ… å¥½ï¼šå®šæœŸå…¨é‡å¤‡ä»½ï¼ˆå¯ç»´æŠ¤æ€§ï¼‰
   # æ¯å‘¨æ‰§è¡Œå…¨é‡å¤‡ä»½
   pg_basebackup \
       -D /backup/weekly/full \
       -Ft \
       -z \
       -Z 6 \
       -j 4 \
       -P

   # é…ç½®å®šæ—¶ä»»åŠ¡
   # 0 2 * * 0 pg_basebackup ...

   # âŒ ä¸å¥½ï¼šä¸è¿›è¡Œå®šæœŸå¤‡ä»½ï¼ˆå¯ç»´æŠ¤æ€§å·®ï¼‰
   # æ²¡æœ‰å¤‡ä»½ï¼Œæ•°æ®ä¸¢å¤±é£é™©é«˜
   ```

2. **ä½¿ç”¨å¢é‡å¤‡ä»½å‡å°‘å­˜å‚¨**ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰

   ```bash
   # âœ… å¥½ï¼šä½¿ç”¨å¢é‡å¤‡ä»½å‡å°‘å­˜å‚¨ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
   # æ¯å¤©æ‰§è¡Œå¢é‡å¤‡ä»½
   pg_basebackup \
       -D /backup/daily/incremental \
       -Ft \
       --incremental \
       -P

   # âŒ ä¸å¥½ï¼šåªä½¿ç”¨å…¨é‡å¤‡ä»½ï¼ˆå­˜å‚¨ç©ºé—´å¤§ï¼‰
   # æ¯å¤©æ‰§è¡Œå…¨é‡å¤‡ä»½ï¼Œå­˜å‚¨ç©ºé—´æµªè´¹
   ```

3. **é…ç½® WAL å½’æ¡£**ï¼ˆå¯ç»´æŠ¤æ€§ï¼‰

   ```sql
   -- âœ… å¥½ï¼šé…ç½® WAL å½’æ¡£ï¼ˆå¯ç»´æŠ¤æ€§ï¼‰
   ALTER SYSTEM SET wal_level = 'replica';
   ALTER SYSTEM SET archive_mode = 'on';
   ALTER SYSTEM SET archive_command = 'cp %p /archive/%f';
   SELECT pg_reload_conf();

   -- âŒ ä¸å¥½ï¼šä¸é…ç½® WAL å½’æ¡£ï¼ˆå¯ç»´æŠ¤æ€§å·®ï¼‰
   -- æ— æ³•è¿›è¡Œæ—¶é—´ç‚¹æ¢å¤
   ```

**é¿å…åšæ³•**ï¼š

1. **é¿å…ä¸è¿›è¡Œå®šæœŸå¤‡ä»½**ï¼ˆå¯ç»´æŠ¤æ€§å·®ï¼‰
2. **é¿å…åªä½¿ç”¨å…¨é‡å¤‡ä»½**ï¼ˆå­˜å‚¨ç©ºé—´å¤§ï¼‰
3. **é¿å…ä¸é…ç½® WAL å½’æ¡£**ï¼ˆå¯ç»´æŠ¤æ€§å·®ï¼‰

### 8.2 æ¢å¤ç­–ç•¥å»ºè®®

**æ¨èåšæ³•**ï¼š

1. **æµ‹è¯•æ¢å¤æµç¨‹**ï¼ˆå¯ç»´æŠ¤æ€§ï¼‰

   ```bash
   # âœ… å¥½ï¼šæµ‹è¯•æ¢å¤æµç¨‹ï¼ˆå¯ç»´æŠ¤æ€§ï¼‰
   # å®šæœŸæµ‹è¯•æ¢å¤æµç¨‹
   pg_restore -d testdb -j 8 /backup/weekly/full/base.tar

   # éªŒè¯æ•°æ®å®Œæ•´æ€§
   psql -d testdb -c "SELECT COUNT(*) FROM important_table;"

   # âŒ ä¸å¥½ï¼šä¸æµ‹è¯•æ¢å¤æµç¨‹ï¼ˆå¯ç»´æŠ¤æ€§å·®ï¼‰
   # æ¢å¤æ—¶å¯èƒ½å¤±è´¥ï¼Œæ— æ³•åŠæ—¶æ¢å¤æ•°æ®
   ```

2. **ä½¿ç”¨å¹¶è¡Œæ¢å¤**ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰

   ```bash
   # âœ… å¥½ï¼šä½¿ç”¨å¹¶è¡Œæ¢å¤ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
   pg_restore \
       -d mydb \
       -j 8 \
       -v \
       /backup/pg17/base.tar

   # âŒ ä¸å¥½ï¼šä¸ä½¿ç”¨å¹¶è¡Œæ¢å¤ï¼ˆæ€§èƒ½å·®ï¼‰
   pg_restore -d mydb /backup/pg17/base.tar
   # æ¢å¤é€Ÿåº¦æ…¢
   ```

**é¿å…åšæ³•**ï¼š

1. **é¿å…ä¸æµ‹è¯•æ¢å¤æµç¨‹**ï¼ˆå¯ç»´æŠ¤æ€§å·®ï¼‰
2. **é¿å…ä¸ä½¿ç”¨å¹¶è¡Œæ¢å¤**ï¼ˆæ€§èƒ½å·®ï¼‰

### 8.3 å¤‡ä»½éªŒè¯å»ºè®®

**æ¨èåšæ³•**ï¼š

1. **å®šæœŸéªŒè¯å¤‡ä»½**ï¼ˆå¯ç»´æŠ¤æ€§ï¼‰

   ```bash
   # âœ… å¥½ï¼šå®šæœŸéªŒè¯å¤‡ä»½ï¼ˆå¯ç»´æŠ¤æ€§ï¼‰
   # éªŒè¯å¤‡ä»½æ–‡ä»¶
   pg_verifybackup /backup/pg17

   # æ£€æŸ¥å¤‡ä»½å…ƒæ•°æ®
   pg_basebackup --verify /backup/pg17

   # âŒ ä¸å¥½ï¼šä¸éªŒè¯å¤‡ä»½ï¼ˆå¯ç»´æŠ¤æ€§å·®ï¼‰
   # å¤‡ä»½å¯èƒ½æŸåï¼Œæ¢å¤æ—¶å¤±è´¥
   ```

2. **ä½¿ç”¨äº‘å­˜å‚¨å¤‡ä»½**ï¼ˆå¯ç»´æŠ¤æ€§ï¼‰

   ```bash
   # âœ… å¥½ï¼šä½¿ç”¨äº‘å­˜å‚¨å¤‡ä»½ï¼ˆå¯ç»´æŠ¤æ€§ï¼‰
   pgbackrest backup \
       --stanza=main \
       --type=full \
       --repo1-s3-bucket=my-backup-bucket \
       --repo1-s3-region=us-east-1

   # âŒ ä¸å¥½ï¼šåªä½¿ç”¨æœ¬åœ°å­˜å‚¨ï¼ˆå¯ç»´æŠ¤æ€§å·®ï¼‰
   # æœ¬åœ°å­˜å‚¨æŸåï¼Œå¤‡ä»½ä¸¢å¤±
   ```

**é¿å…åšæ³•**ï¼š

1. **é¿å…ä¸éªŒè¯å¤‡ä»½**ï¼ˆå¯ç»´æŠ¤æ€§å·®ï¼‰
2. **é¿å…åªä½¿ç”¨æœ¬åœ°å­˜å‚¨**ï¼ˆå¯ç»´æŠ¤æ€§å·®ï¼‰

---

## 9. å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - å¤‡ä»½æ¢å¤](https://www.postgresql.org/docs/current/backup.html)**
  - å¤‡ä»½æ¢å¤å®Œæ•´æ•™ç¨‹
  - å¤‡ä»½æ¢å¤æœ€ä½³å®è·µ

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - pg_basebackup](https://www.postgresql.org/docs/current/app-pgbasebackup.html)**
  - pg_basebackup å·¥å…·æ–‡æ¡£
  - å¤‡ä»½æ“ä½œè¯´æ˜

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - pg_restore](https://www.postgresql.org/docs/current/app-pgrestore.html)**
  - pg_restore å·¥å…·æ–‡æ¡£
  - æ¢å¤æ“ä½œè¯´æ˜

- **[PostgreSQL 17 å‘å¸ƒè¯´æ˜](https://www.postgresql.org/about/news/postgresql-17-released-2781/)**
  - PostgreSQL 17 æ–°ç‰¹æ€§ä»‹ç»
  - å¤‡ä»½æ¢å¤æ”¹è¿›è¯´æ˜

### SQL æ ‡å‡†

- **ISO/IEC 9075:2016 - SQL æ ‡å‡†å¤‡ä»½æ¢å¤**
  - SQL æ ‡å‡†å¤‡ä»½æ¢å¤è§„èŒƒ
  - å¤‡ä»½æ¢å¤æ ‡å‡†è¯­æ³•

### æŠ€æœ¯è®ºæ–‡

- **Gray, J., et al. (1996). "The Recovery Manager of the System R Database Manager."**
  - æœŸåˆŠ: ACM Computing Surveys, 8(4), 223-242
  - **é‡è¦æ€§**: æ•°æ®åº“æ¢å¤ç®¡ç†çš„åŸºç¡€ç ”ç©¶
  - **æ ¸å¿ƒè´¡çŒ®**: æ·±å…¥åˆ†æäº†æ•°æ®åº“æ¢å¤ç®¡ç†çš„åŸç†å’Œæ–¹æ³•

- **Mohan, C., et al. (1992). "ARIES: A Transaction Recovery Method Supporting
    Fine-Granularity Locking and Partial Rollbacks Using Write-Ahead Logging."**
  - æœŸåˆŠ: ACM Transactions on Database Systems, 17(1), 94-162
  - **é‡è¦æ€§**: äº‹åŠ¡æ¢å¤æ–¹æ³•çš„ç»å…¸ç ”ç©¶
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº† ARIES æ¢å¤ç®—æ³•ï¼Œå½±å“äº†ç°ä»£æ•°æ®åº“çš„æ¢å¤æœºåˆ¶

### æŠ€æœ¯åšå®¢

- **[PostgreSQL å®˜æ–¹åšå®¢ - å¤‡ä»½æ¢å¤](https://www.postgresql.org/docs/current/backup.html)**
  - å¤‡ä»½æ¢å¤æœ€ä½³å®è·µ
  - æ€§èƒ½ä¼˜åŒ–æŠ€å·§

- **[2ndQuadrant - PostgreSQL å¤‡ä»½æ¢å¤](https://www.2ndquadrant.com/en/blog/postgresql-backup-restore/)**
  - å¤‡ä»½æ¢å¤å®æˆ˜
  - æ€§èƒ½ä¼˜åŒ–æ¡ˆä¾‹

- **[Percona - PostgreSQL å¤‡ä»½æ¢å¤](https://www.percona.com/blog/postgresql-backup-restore/)**
  - å¤‡ä»½æ¢å¤ä½¿ç”¨æŠ€å·§
  - æ€§èƒ½ä¼˜åŒ–å»ºè®®

- **[EnterpriseDB - PostgreSQL å¤‡ä»½æ¢å¤](<https://www.enterprisedb.com/postgres-tutorials/>
    postgresql-backup-restore-tutorial)**
  - å¤‡ä»½æ¢å¤æ·±å…¥è§£æ
  - å®é™…åº”ç”¨æ¡ˆä¾‹

### ç¤¾åŒºèµ„æº

- **[PostgreSQL Wiki - å¤‡ä»½æ¢å¤](https://wiki.postgresql.org/wiki/Backup_and_Restore)**
  - å¤‡ä»½æ¢å¤æŠ€å·§
  - å®é™…åº”ç”¨æ¡ˆä¾‹

- **[Stack Overflow - PostgreSQL å¤‡ä»½æ¢å¤](https://stackoverflow.com/questions/tagged/postgresql+backup-restore)**
  - å¤‡ä»½æ¢å¤é—®ç­”
  - å¸¸è§é—®é¢˜è§£ç­”

### ç›¸å…³æ–‡æ¡£

- [é«˜å¯ç”¨ä½“ç³»è¯¦è§£](../../09-é«˜å¯ç”¨/é«˜å¯ç”¨ä½“ç³»è¯¦è§£.md)
- [æµå¤åˆ¶è¯¦è§£](../../09-é«˜å¯ç”¨/æµå¤åˆ¶è¯¦è§£.md)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 1 æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
