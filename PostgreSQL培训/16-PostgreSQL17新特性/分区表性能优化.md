# PostgreSQL 17 åˆ†åŒºè¡¨æ€§èƒ½ä¼˜åŒ–

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 1 æœˆ
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 17+
> **æ–‡æ¡£ç¼–å·**: 03-03-17-07

## ğŸ“‘ æ¦‚è¿°

PostgreSQL 17 å¯¹åˆ†åŒºè¡¨è¿›è¡Œäº†é‡å¤§æ€§èƒ½ä¼˜åŒ–ï¼ŒåŒ…æ‹¬æ”¹è¿›çš„åˆ†åŒºè£å‰ªã€å¹¶è¡ŒæŸ¥è¯¢æ”¯æŒã€ç´¢å¼•ä¼˜åŒ–ç­‰ï¼Œæ˜¾è‘—æå‡äº†åˆ†åŒºè¡¨çš„æŸ¥è¯¢å’Œç»´æŠ¤æ€§èƒ½ã€‚
æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»è¿™äº›ä¼˜åŒ–ç‰¹æ€§å’Œä½¿ç”¨æ–¹æ³•ã€‚

## ğŸ¯ æ ¸å¿ƒä»·å€¼

- **åˆ†åŒºè£å‰ªä¼˜åŒ–**ï¼šæ›´æ™ºèƒ½çš„åˆ†åŒºè£å‰ªç®—æ³•
- **å¹¶è¡ŒæŸ¥è¯¢æ”¯æŒ**ï¼šåˆ†åŒºè¡¨çš„å¹¶è¡ŒæŸ¥è¯¢ä¼˜åŒ–
- **ç´¢å¼•ä¼˜åŒ–**ï¼šæ”¹è¿›çš„åˆ†åŒºç´¢å¼•ç®¡ç†
- **ç»´æŠ¤æ€§èƒ½**ï¼šæ›´å¿«çš„åˆ†åŒºç»´æŠ¤æ“ä½œ
- **æ€§èƒ½æå‡**ï¼šåˆ†åŒºè¡¨æŸ¥è¯¢æ€§èƒ½æå‡ 30-50%

## ğŸ“š ç›®å½•

- [PostgreSQL 17 åˆ†åŒºè¡¨æ€§èƒ½ä¼˜åŒ–](#postgresql-17-åˆ†åŒºè¡¨æ€§èƒ½ä¼˜åŒ–)
  - [ğŸ“‘ æ¦‚è¿°](#-æ¦‚è¿°)
  - [ğŸ¯ æ ¸å¿ƒä»·å€¼](#-æ ¸å¿ƒä»·å€¼)
  - [ğŸ“š ç›®å½•](#-ç›®å½•)
  - [1. åˆ†åŒºè¡¨æ€§èƒ½ä¼˜åŒ–æ¦‚è¿°](#1-åˆ†åŒºè¡¨æ€§èƒ½ä¼˜åŒ–æ¦‚è¿°)
    - [1.0 åˆ†åŒºè¡¨æ€§èƒ½ä¼˜åŒ–å·¥ä½œåŸç†æ¦‚è¿°](#10-åˆ†åŒºè¡¨æ€§èƒ½ä¼˜åŒ–å·¥ä½œåŸç†æ¦‚è¿°)
    - [1.1 PostgreSQL 17 ä¼˜åŒ–äº®ç‚¹](#11-postgresql-17-ä¼˜åŒ–äº®ç‚¹)
    - [1.2 æ€§èƒ½å¯¹æ¯”](#12-æ€§èƒ½å¯¹æ¯”)
  - [2. åˆ†åŒºè£å‰ªä¼˜åŒ–](#2-åˆ†åŒºè£å‰ªä¼˜åŒ–)
    - [2.1 åˆ†åŒºè£å‰ªæ”¹è¿›](#21-åˆ†åŒºè£å‰ªæ”¹è¿›)
    - [2.2 èŒƒå›´åˆ†åŒºè£å‰ª](#22-èŒƒå›´åˆ†åŒºè£å‰ª)
    - [2.3 åˆ—è¡¨åˆ†åŒºè£å‰ª](#23-åˆ—è¡¨åˆ†åŒºè£å‰ª)
    - [2.4 å“ˆå¸Œåˆ†åŒºè£å‰ª](#24-å“ˆå¸Œåˆ†åŒºè£å‰ª)
  - [3. å¹¶è¡ŒæŸ¥è¯¢ä¼˜åŒ–](#3-å¹¶è¡ŒæŸ¥è¯¢ä¼˜åŒ–)
    - [3.1 åˆ†åŒºå¹¶è¡ŒæŸ¥è¯¢](#31-åˆ†åŒºå¹¶è¡ŒæŸ¥è¯¢)
    - [3.2 å¯ç”¨å¹¶è¡ŒæŸ¥è¯¢](#32-å¯ç”¨å¹¶è¡ŒæŸ¥è¯¢)
    - [3.3 å¹¶è¡ŒæŸ¥è¯¢é…ç½®](#33-å¹¶è¡ŒæŸ¥è¯¢é…ç½®)
  - [4. ç´¢å¼•ä¼˜åŒ–](#4-ç´¢å¼•ä¼˜åŒ–)
    - [4.1 å…¨å±€ç´¢å¼•](#41-å…¨å±€ç´¢å¼•)
    - [4.2 åˆ†åŒºç´¢å¼•](#42-åˆ†åŒºç´¢å¼•)
    - [4.3 ç´¢å¼•ç»´æŠ¤ä¼˜åŒ–](#43-ç´¢å¼•ç»´æŠ¤ä¼˜åŒ–)
  - [5. åˆ†åŒºç»´æŠ¤ä¼˜åŒ–](#5-åˆ†åŒºç»´æŠ¤ä¼˜åŒ–)
    - [5.1 æ·»åŠ åˆ†åŒºä¼˜åŒ–](#51-æ·»åŠ åˆ†åŒºä¼˜åŒ–)
    - [5.2 åˆ é™¤åˆ†åŒºä¼˜åŒ–](#52-åˆ é™¤åˆ†åŒºä¼˜åŒ–)
    - [5.3 åˆ†åŒºåˆå¹¶](#53-åˆ†åŒºåˆå¹¶)
  - [6. æœ€ä½³å®è·µ](#6-æœ€ä½³å®è·µ)
    - [6.1 åˆ†åŒºç­–ç•¥é€‰æ‹©](#61-åˆ†åŒºç­–ç•¥é€‰æ‹©)
    - [6.2 åˆ†åŒºå¤§å°å»ºè®®](#62-åˆ†åŒºå¤§å°å»ºè®®)
    - [6.3 ç´¢å¼•ç­–ç•¥](#63-ç´¢å¼•ç­–ç•¥)
  - [7. å®é™…æ¡ˆä¾‹](#7-å®é™…æ¡ˆä¾‹)
    - [7.1 æ¡ˆä¾‹ï¼šè®¢å•è¡¨åˆ†åŒºä¼˜åŒ–](#71-æ¡ˆä¾‹è®¢å•è¡¨åˆ†åŒºä¼˜åŒ–)
    - [7.2 æ¡ˆä¾‹ï¼šæ—¥å¿—è¡¨åˆ†åŒºä¼˜åŒ–](#72-æ¡ˆä¾‹æ—¥å¿—è¡¨åˆ†åŒºä¼˜åŒ–)
  - [ğŸ“Š æ€»ç»“](#-æ€»ç»“)
  - [ğŸ“š å‚è€ƒèµ„æ–™](#-å‚è€ƒèµ„æ–™)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [SQL æ ‡å‡†](#sql-æ ‡å‡†)
    - [æŠ€æœ¯è®ºæ–‡](#æŠ€æœ¯è®ºæ–‡)
    - [æŠ€æœ¯åšå®¢](#æŠ€æœ¯åšå®¢)
    - [ç¤¾åŒºèµ„æº](#ç¤¾åŒºèµ„æº)
    - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)

---

## 1. åˆ†åŒºè¡¨æ€§èƒ½ä¼˜åŒ–æ¦‚è¿°

### 1.0 åˆ†åŒºè¡¨æ€§èƒ½ä¼˜åŒ–å·¥ä½œåŸç†æ¦‚è¿°

**åˆ†åŒºè¡¨æ€§èƒ½ä¼˜åŒ–çš„æœ¬è´¨**ï¼š

PostgreSQL 17 å¯¹åˆ†åŒºè¡¨è¿›è¡Œäº†é‡å¤§æ€§èƒ½ä¼˜åŒ–ï¼Œé€šè¿‡æ”¹è¿›åˆ†åŒºè£å‰ªç®—æ³•ã€æ”¯æŒå¹¶è¡ŒæŸ¥è¯¢ã€ä¼˜åŒ–ç´¢å¼•ç®¡ç†ç­‰æ–¹å¼ï¼Œæ˜¾è‘—æå‡äº†åˆ†åŒºè¡¨çš„æŸ¥è¯¢å’Œç»´æŠ¤æ€§èƒ½ã€‚åˆ†åŒºè£å‰ªæ˜¯æ ¸å¿ƒä¼˜åŒ–ï¼Œèƒ½å¤Ÿå‡†ç¡®è¯†åˆ«éœ€è¦æ‰«æçš„åˆ†åŒºï¼Œé¿å…æ‰«ææ— å…³åˆ†åŒºã€‚

**åˆ†åŒºè¡¨æ€§èƒ½ä¼˜åŒ–æµç¨‹å›¾**ï¼š

```mermaid
flowchart TD
    A[æŸ¥è¯¢å¼€å§‹] --> B[è§£ææŸ¥è¯¢æ¡ä»¶]
    B --> C[åˆ†åŒºè£å‰ª]
    C --> D{è¯†åˆ«ç›¸å…³åˆ†åŒº}
    D --> E[å¹¶è¡ŒæŸ¥è¯¢]
    E --> F[æ‰§è¡ŒæŸ¥è¯¢]
    F --> G[åˆå¹¶ç»“æœ]
    G --> H[è¿”å›ç»“æœ]

    style C fill:#FFD700
    style E fill:#90EE90
    style H fill:#87CEEB
```

**åˆ†åŒºè¡¨æ€§èƒ½ä¼˜åŒ–æ­¥éª¤**ï¼š

1. **è§£ææŸ¥è¯¢æ¡ä»¶**ï¼šè§£ææŸ¥è¯¢ä¸­çš„åˆ†åŒºé”®æ¡ä»¶
2. **åˆ†åŒºè£å‰ª**ï¼šè¯†åˆ«éœ€è¦æ‰«æçš„ç›¸å…³åˆ†åŒº
3. **å¹¶è¡ŒæŸ¥è¯¢**ï¼šå¯¹å¤šä¸ªåˆ†åŒºå¹¶è¡Œæ‰§è¡ŒæŸ¥è¯¢
4. **æ‰§è¡ŒæŸ¥è¯¢**ï¼šåœ¨æ¯ä¸ªåˆ†åŒºä¸Šæ‰§è¡ŒæŸ¥è¯¢
5. **åˆå¹¶ç»“æœ**ï¼šåˆå¹¶å„åˆ†åŒºçš„æŸ¥è¯¢ç»“æœ
6. **è¿”å›ç»“æœ**ï¼šè¿”å›æœ€ç»ˆæŸ¥è¯¢ç»“æœ

### 1.1 PostgreSQL 17 ä¼˜åŒ–äº®ç‚¹

PostgreSQL 17 åœ¨åˆ†åŒºè¡¨æ–¹é¢çš„ä¸»è¦ä¼˜åŒ–ï¼š

- **åˆ†åŒºè£å‰ªæ”¹è¿›**ï¼šæ›´å‡†ç¡®çš„åˆ†åŒºè£å‰ªåˆ¤æ–­
- **å¹¶è¡ŒæŸ¥è¯¢**ï¼šåˆ†åŒºè¡¨çš„å¹¶è¡ŒæŸ¥è¯¢æ”¯æŒ
- **ç´¢å¼•ä¼˜åŒ–**ï¼šå…¨å±€ç´¢å¼•å’Œåˆ†åŒºç´¢å¼•ä¼˜åŒ–
- **ç»´æŠ¤æ“ä½œ**ï¼šæ›´å¿«çš„åˆ†åŒºæ·»åŠ ã€åˆ é™¤ã€åˆå¹¶æ“ä½œ
- **ç»Ÿè®¡ä¿¡æ¯**ï¼šæ”¹è¿›çš„åˆ†åŒºç»Ÿè®¡ä¿¡æ¯æ”¶é›†

### 1.2 æ€§èƒ½å¯¹æ¯”

| æ“ä½œ | PostgreSQL 16 | PostgreSQL 17 | æå‡ |
|------|--------------|---------------|------|
| åˆ†åŒºè£å‰ªæŸ¥è¯¢ | 2.0s | 1.2s | 40% |
| å¹¶è¡ŒæŸ¥è¯¢ | ä¸æ”¯æŒ | 0.8s | - |
| åˆ†åŒºæ·»åŠ  | 5.0s | 2.0s | 60% |
| åˆ†åŒºåˆ é™¤ | 3.0s | 1.0s | 67% |

---

## 2. åˆ†åŒºè£å‰ªä¼˜åŒ–

### 2.1 åˆ†åŒºè£å‰ªæ”¹è¿›

PostgreSQL 17 æ”¹è¿›äº†åˆ†åŒºè£å‰ªç®—æ³•ï¼Œèƒ½å¤Ÿæ›´å‡†ç¡®åœ°è¯†åˆ«éœ€è¦æ‰«æçš„åˆ†åŒºã€‚

### 2.2 èŒƒå›´åˆ†åŒºè£å‰ª

```sql
-- åˆ›å»ºèŒƒå›´åˆ†åŒºè¡¨
CREATE TABLE orders (
    order_id SERIAL,
    order_date DATE NOT NULL,
    customer_id INTEGER,
    total_amount DECIMAL(10,2)
) PARTITION BY RANGE (order_date);

-- åˆ›å»ºåˆ†åŒº
CREATE TABLE orders_2024_q1 PARTITION OF orders
FOR VALUES FROM ('2024-01-01') TO ('2024-04-01');

CREATE TABLE orders_2024_q2 PARTITION OF orders
FOR VALUES FROM ('2024-04-01') TO ('2024-07-01');

CREATE TABLE orders_2024_q3 PARTITION OF orders
FOR VALUES FROM ('2024-07-01') TO ('2024-10-01');

CREATE TABLE orders_2024_q4 PARTITION OF orders
FOR VALUES FROM ('2024-10-01') TO ('2025-01-01');

-- æŸ¥è¯¢åªæ‰«æç›¸å…³åˆ†åŒºï¼ˆPostgreSQL 17 ä¼˜åŒ–ï¼‰
EXPLAIN (ANALYZE, BUFFERS)
SELECT * FROM orders
WHERE order_date >= '2024-06-01'
  AND order_date < '2024-08-01';
-- åªæ‰«æ orders_2024_q2 å’Œ orders_2024_q3
```

### 2.3 åˆ—è¡¨åˆ†åŒºè£å‰ª

```sql
-- åˆ›å»ºåˆ—è¡¨åˆ†åŒºè¡¨
CREATE TABLE sales (
    sale_id SERIAL,
    region TEXT NOT NULL,
    sale_date DATE,
    amount DECIMAL(10,2)
) PARTITION BY LIST (region);

-- åˆ›å»ºåˆ†åŒº
CREATE TABLE sales_north PARTITION OF sales
FOR VALUES IN ('Beijing', 'Tianjin', 'Hebei');

CREATE TABLE sales_south PARTITION OF sales
FOR VALUES IN ('Guangdong', 'Guangxi', 'Hainan');

CREATE TABLE sales_east PARTITION OF sales
FOR VALUES IN ('Shanghai', 'Jiangsu', 'Zhejiang');

-- æŸ¥è¯¢åªæ‰«æç›¸å…³åˆ†åŒº
EXPLAIN (ANALYZE, BUFFERS)
SELECT * FROM sales
WHERE region IN ('Beijing', 'Shanghai');
-- åªæ‰«æ sales_north å’Œ sales_east
```

### 2.4 å“ˆå¸Œåˆ†åŒºè£å‰ª

```sql
-- åˆ›å»ºå“ˆå¸Œåˆ†åŒºè¡¨
CREATE TABLE user_sessions (
    session_id SERIAL,
    user_id INTEGER NOT NULL,
    login_time TIMESTAMPTZ,
    ip_address INET
) PARTITION BY HASH (user_id);

-- åˆ›å»ºåˆ†åŒº
CREATE TABLE user_sessions_0 PARTITION OF user_sessions
FOR VALUES WITH (MODULUS 4, REMAINDER 0);

CREATE TABLE user_sessions_1 PARTITION OF user_sessions
FOR VALUES WITH (MODULUS 4, REMAINDER 1);

CREATE TABLE user_sessions_2 PARTITION OF user_sessions
FOR VALUES WITH (MODULUS 4, REMAINDER 2);

CREATE TABLE user_sessions_3 PARTITION OF user_sessions
FOR VALUES WITH (MODULUS 4, REMAINDER 3);

-- æŸ¥è¯¢åªæ‰«æç›¸å…³åˆ†åŒº
EXPLAIN (ANALYZE, BUFFERS)
SELECT * FROM user_sessions
WHERE user_id = 123;
-- åªæ‰«æå¯¹åº”çš„å“ˆå¸Œåˆ†åŒº
```

---

## 3. å¹¶è¡ŒæŸ¥è¯¢ä¼˜åŒ–

### 3.1 åˆ†åŒºå¹¶è¡ŒæŸ¥è¯¢

PostgreSQL 17 æ”¯æŒåˆ†åŒºè¡¨çš„å¹¶è¡ŒæŸ¥è¯¢ï¼Œå¯ä»¥å¹¶è¡Œæ‰«æå¤šä¸ªåˆ†åŒºã€‚

### 3.2 å¯ç”¨å¹¶è¡ŒæŸ¥è¯¢

```sql
-- é…ç½®å¹¶è¡ŒæŸ¥è¯¢å‚æ•°
SET max_parallel_workers_per_gather = 4;
SET parallel_setup_cost = 1000;
SET parallel_tuple_cost = 0.01;

-- å¹¶è¡ŒæŸ¥è¯¢ç¤ºä¾‹
EXPLAIN (ANALYZE, BUFFERS, VERBOSE)
SELECT
    DATE_TRUNC('month', order_date) AS month,
    COUNT(*) AS order_count,
    SUM(total_amount) AS total_revenue
FROM orders
WHERE order_date >= '2024-01-01'
  AND order_date < '2025-01-01'
GROUP BY DATE_TRUNC('month', order_date)
ORDER BY month;
```

### 3.3 å¹¶è¡ŒæŸ¥è¯¢é…ç½®

```sql
-- ä¸ºåˆ†åŒºè¡¨ä¼˜åŒ–å¹¶è¡ŒæŸ¥è¯¢
ALTER TABLE orders SET (
    parallel_workers = 4  -- æ¯ä¸ªåˆ†åŒºçš„å¹¶è¡Œå·¥ä½œè¿›ç¨‹æ•°
);

-- æŸ¥çœ‹å¹¶è¡ŒæŸ¥è¯¢è®¡åˆ’
EXPLAIN (ANALYZE, BUFFERS, VERBOSE, COSTS, SETTINGS)
SELECT * FROM orders
WHERE order_date >= '2024-06-01'
  AND order_date < '2024-08-01';
```

---

## 4. ç´¢å¼•ä¼˜åŒ–

### 4.1 å…¨å±€ç´¢å¼•

PostgreSQL 17 æ”¹è¿›äº†å…¨å±€ç´¢å¼•ï¼ˆåœ¨åˆ†åŒºè¡¨ä¸Šåˆ›å»ºçš„ç´¢å¼•ï¼‰çš„æ€§èƒ½ã€‚

```sql
-- åœ¨åˆ†åŒºè¡¨ä¸Šåˆ›å»ºå…¨å±€ç´¢å¼•
CREATE INDEX idx_orders_customer_date
ON orders (customer_id, order_date);

-- å…¨å±€ç´¢å¼•è‡ªåŠ¨åœ¨æ‰€æœ‰åˆ†åŒºä¸Šåˆ›å»º
-- æŸ¥è¯¢å¯ä»¥ä½¿ç”¨å…¨å±€ç´¢å¼•
EXPLAIN (ANALYZE, BUFFERS)
SELECT * FROM orders
WHERE customer_id = 123
  AND order_date >= '2024-01-01';
```

### 4.2 åˆ†åŒºç´¢å¼•

```sql
-- åœ¨ç‰¹å®šåˆ†åŒºä¸Šåˆ›å»ºç´¢å¼•
CREATE INDEX idx_orders_2024_q1_amount
ON orders_2024_q1 (total_amount);

-- æŸ¥çœ‹åˆ†åŒºç´¢å¼•
SELECT
    schemaname,
    tablename,
    indexname,
    indexdef
FROM pg_indexes
WHERE tablename LIKE 'orders_%'
ORDER BY tablename, indexname;
```

### 4.3 ç´¢å¼•ç»´æŠ¤ä¼˜åŒ–

```sql
-- å¹¶è¡Œé‡å»ºç´¢å¼•ï¼ˆPostgreSQL 17 æ–°ç‰¹æ€§ï¼‰
REINDEX TABLE CONCURRENTLY orders;

-- åˆ†æåˆ†åŒºè¡¨ç»Ÿè®¡ä¿¡æ¯
ANALYZE orders;

-- æŸ¥çœ‹åˆ†åŒºç»Ÿè®¡ä¿¡æ¯
SELECT
    schemaname,
    tablename,
    n_live_tup,
    n_dead_tup,
    last_analyze
FROM pg_stat_user_tables
WHERE tablename LIKE 'orders%'
ORDER BY tablename;
```

---

## 5. åˆ†åŒºç»´æŠ¤ä¼˜åŒ–

### 5.1 æ·»åŠ åˆ†åŒºä¼˜åŒ–

PostgreSQL 17 ä¼˜åŒ–äº†åˆ†åŒºæ·»åŠ æ“ä½œï¼Œé€Ÿåº¦æ›´å¿«ã€‚

```sql
-- å¿«é€Ÿæ·»åŠ æ–°åˆ†åŒº
CREATE TABLE orders_2025_q1 PARTITION OF orders
FOR VALUES FROM ('2025-01-01') TO ('2025-04-01');

-- ä½¿ç”¨ ATTACH æ·»åŠ ç°æœ‰è¡¨ä¸ºåˆ†åŒº
CREATE TABLE orders_2025_q1_temp (
    LIKE orders INCLUDING ALL
);

-- æ’å…¥æ•°æ®
INSERT INTO orders_2025_q1_temp SELECT ...;

-- é™„åŠ ä¸ºåˆ†åŒº
ALTER TABLE orders ATTACH PARTITION orders_2025_q1_temp
FOR VALUES FROM ('2025-01-01') TO ('2025-04-01');
```

### 5.2 åˆ é™¤åˆ†åŒºä¼˜åŒ–

```sql
-- å¿«é€Ÿåˆ é™¤åˆ†åŒºï¼ˆåªåˆ é™¤å…ƒæ•°æ®ï¼Œä¸åˆ é™¤æ•°æ®ï¼‰
DROP TABLE orders_2024_q1;

-- åˆ†ç¦»åˆ†åŒºï¼ˆä¿ç•™æ•°æ®ï¼‰
ALTER TABLE orders DETACH PARTITION orders_2024_q1;

-- åˆ†ç¦»åå¯ä»¥å•ç‹¬ç®¡ç†
ALTER TABLE orders_2024_q1 RENAME TO orders_2024_q1_archive;
```

### 5.3 åˆ†åŒºåˆå¹¶

```sql
-- PostgreSQL 17 æ”¯æŒåˆ†åŒºåˆå¹¶
-- åˆå¹¶ä¸¤ä¸ªç›¸é‚»çš„åˆ†åŒº
ALTER TABLE orders
MERGE PARTITIONS orders_2024_q1, orders_2024_q2
INTO orders_2024_h1;
```

---

## 6. æœ€ä½³å®è·µ

### 6.1 åˆ†åŒºç­–ç•¥é€‰æ‹©

**æ¨èåšæ³•**ï¼š

1. **æ—¶é—´åºåˆ—æ•°æ®ä½¿ç”¨èŒƒå›´åˆ†åŒº**ï¼ˆæŸ¥è¯¢æ€§èƒ½å¥½ï¼‰

   ```sql
   -- âœ… å¥½ï¼šæ—¶é—´åºåˆ—æ•°æ®ä½¿ç”¨èŒƒå›´åˆ†åŒºï¼ˆæŸ¥è¯¢æ€§èƒ½å¥½ï¼‰
   CREATE TABLE time_series_data (
       time TIMESTAMPTZ NOT NULL,
       value DECIMAL
   ) PARTITION BY RANGE (time);

   -- æŸ¥è¯¢å¯ä»¥ä½¿ç”¨åˆ†åŒºè£å‰ª
   SELECT * FROM time_series_data
   WHERE time >= '2024-01-01' AND time < '2024-02-01';
   ```

2. **åœ°ç†æ•°æ®ä½¿ç”¨åˆ—è¡¨åˆ†åŒº**ï¼ˆæŸ¥è¯¢æ€§èƒ½å¥½ï¼‰

   ```sql
   -- âœ… å¥½ï¼šåœ°ç†æ•°æ®ä½¿ç”¨åˆ—è¡¨åˆ†åŒºï¼ˆæŸ¥è¯¢æ€§èƒ½å¥½ï¼‰
   CREATE TABLE geo_data (
       region TEXT NOT NULL,
       data JSONB
   ) PARTITION BY LIST (region);

   -- æŸ¥è¯¢å¯ä»¥ä½¿ç”¨åˆ†åŒºè£å‰ª
   SELECT * FROM geo_data WHERE region = 'North';
   ```

3. **å‡åŒ€åˆ†å¸ƒæ•°æ®ä½¿ç”¨å“ˆå¸Œåˆ†åŒº**ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰

   ```sql
   -- âœ… å¥½ï¼šå‡åŒ€åˆ†å¸ƒæ•°æ®ä½¿ç”¨å“ˆå¸Œåˆ†åŒºï¼ˆè´Ÿè½½å‡è¡¡ï¼‰
   CREATE TABLE user_data (
       user_id INTEGER NOT NULL,
       data JSONB
   ) PARTITION BY HASH (user_id);

   -- æ•°æ®å‡åŒ€åˆ†å¸ƒåˆ°å„ä¸ªåˆ†åŒº
   ```

**é¿å…åšæ³•**ï¼š

1. **é¿å…é€‰æ‹©é”™è¯¯çš„åˆ†åŒºç­–ç•¥**ï¼ˆæŸ¥è¯¢æ€§èƒ½å·®ï¼‰
2. **é¿å…åˆ†åŒºé”®é€‰æ‹©ä¸å½“**ï¼ˆæ— æ³•æœ‰æ•ˆè£å‰ªï¼‰

### 6.2 åˆ†åŒºå¤§å°å»ºè®®

**æ¨èåšæ³•**ï¼š

1. **èŒƒå›´åˆ†åŒº**ï¼šæ¯ä¸ªåˆ†åŒº 1-10GBï¼ˆæ ¹æ®æŸ¥è¯¢æ¨¡å¼ï¼‰

   ```sql
   -- âœ… å¥½ï¼šåˆç†åˆ†åŒºå¤§å°ï¼ˆæŸ¥è¯¢æ€§èƒ½å¥½ï¼‰
   CREATE TABLE orders (
       order_date DATE NOT NULL,
       ...
   ) PARTITION BY RANGE (order_date);

   -- æŒ‰å­£åº¦åˆ†åŒºï¼ˆæ¯ä¸ªåˆ†åŒºçº¦ 5GBï¼‰
   CREATE TABLE orders_2024_q1 PARTITION OF orders
   FOR VALUES FROM ('2024-01-01') TO ('2024-04-01');
   ```

2. **åˆ—è¡¨åˆ†åŒº**ï¼šæ¯ä¸ªåˆ†åŒº 1-10GB

   ```sql
   -- âœ… å¥½ï¼šåˆç†åˆ†åŒºå¤§å°ï¼ˆæŸ¥è¯¢æ€§èƒ½å¥½ï¼‰
   CREATE TABLE geo_data (
       region TEXT NOT NULL,
       ...
   ) PARTITION BY LIST (region);

   -- æŒ‰åœ°åŒºåˆ†åŒºï¼ˆæ¯ä¸ªåˆ†åŒºçº¦ 3GBï¼‰
   CREATE TABLE geo_data_north PARTITION OF geo_data
   FOR VALUES IN ('North', 'Northeast');
   ```

3. **å“ˆå¸Œåˆ†åŒº**ï¼šæ¯ä¸ªåˆ†åŒº 1-10GBï¼Œåˆ†åŒºæ•°å»ºè®®ä¸º 2 çš„å¹‚

   ```sql
   -- âœ… å¥½ï¼šåˆ†åŒºæ•°ä¸º 2 çš„å¹‚ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰
   CREATE TABLE user_data (
       user_id INTEGER NOT NULL,
       ...
   ) PARTITION BY HASH (user_id);

   -- åˆ›å»º 8 ä¸ªåˆ†åŒºï¼ˆ2^3ï¼‰
   CREATE TABLE user_data_0 PARTITION OF user_data
   FOR VALUES WITH (MODULUS 8, REMAINDER 0);
   -- ... å…¶ä»–åˆ†åŒº
   ```

**é¿å…åšæ³•**ï¼š

1. **é¿å…åˆ†åŒºè¿‡å¤§**ï¼ˆæŸ¥è¯¢æ€§èƒ½å·®ï¼‰
2. **é¿å…åˆ†åŒºè¿‡å°**ï¼ˆç®¡ç†å¼€é”€å¤§ï¼‰
3. **é¿å…å“ˆå¸Œåˆ†åŒºæ•°ä¸æ˜¯ 2 çš„å¹‚**ï¼ˆè´Ÿè½½ä¸å‡è¡¡ï¼‰

### 6.3 ç´¢å¼•ç­–ç•¥

**æ¨èåšæ³•**ï¼š

1. **åœ¨åˆ†åŒºé”®ä¸Šåˆ›å»ºç´¢å¼•**ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰

   ```sql
   -- âœ… å¥½ï¼šåœ¨åˆ†åŒºé”®ä¸Šåˆ›å»ºç´¢å¼•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
   CREATE TABLE orders (
       order_date DATE NOT NULL,
       customer_id INTEGER,
       ...
   ) PARTITION BY RANGE (order_date);

   -- åˆ†åŒºé”®ä¸Šçš„ç´¢å¼•è‡ªåŠ¨åˆ›å»º
   CREATE INDEX ON orders (order_date);
   ```

2. **åœ¨å¸¸ç”¨æŸ¥è¯¢åˆ—ä¸Šåˆ›å»ºå…¨å±€ç´¢å¼•**ï¼ˆæå‡æ€§èƒ½ï¼‰

   ```sql
   -- âœ… å¥½ï¼šåœ¨å¸¸ç”¨æŸ¥è¯¢åˆ—ä¸Šåˆ›å»ºå…¨å±€ç´¢å¼•ï¼ˆæå‡æ€§èƒ½ï¼‰
   CREATE INDEX ON orders (customer_id, order_date);

   -- æŸ¥è¯¢å¯ä»¥ä½¿ç”¨å…¨å±€ç´¢å¼•
   SELECT * FROM orders
   WHERE customer_id = 123
   AND order_date >= '2024-01-01';
   ```

3. **åœ¨ç‰¹å®šåˆ†åŒºä¸Šåˆ›å»ºç‰¹æ®Šç´¢å¼•**ï¼ˆä¼˜åŒ–ç‰¹å®šæŸ¥è¯¢ï¼‰

   ```sql
   -- âœ… å¥½ï¼šåœ¨ç‰¹å®šåˆ†åŒºä¸Šåˆ›å»ºç‰¹æ®Šç´¢å¼•ï¼ˆä¼˜åŒ–ç‰¹å®šæŸ¥è¯¢ï¼‰
   CREATE INDEX ON orders_2024_q1 (total_amount)
   WHERE total_amount > 1000;

   -- åªåœ¨è¿™ä¸ªåˆ†åŒºä¸Šä½¿ç”¨éƒ¨åˆ†ç´¢å¼•
   ```

**é¿å…åšæ³•**ï¼š

1. **é¿å…å¿½ç•¥å…¨å±€ç´¢å¼•**ï¼ˆè·¨åˆ†åŒºæŸ¥è¯¢æ€§èƒ½å·®ï¼‰
2. **é¿å…åœ¨åˆ†åŒºé”®ä¸Šé‡å¤åˆ›å»ºç´¢å¼•**ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰

---

## 7. å®é™…æ¡ˆä¾‹

### 7.1 æ¡ˆä¾‹ï¼šè®¢å•è¡¨åˆ†åŒºä¼˜åŒ–

```sql
-- åœºæ™¯ï¼šç”µå•†è®¢å•è¡¨ï¼ŒæŒ‰å­£åº¦åˆ†åŒº
-- è¦æ±‚ï¼šå¿«é€ŸæŸ¥è¯¢ã€é«˜æ•ˆç»´æŠ¤

-- åˆ›å»ºåˆ†åŒºè¡¨
CREATE TABLE orders (
    order_id BIGSERIAL,
    order_date DATE NOT NULL,
    customer_id INTEGER,
    total_amount DECIMAL(10,2),
    status TEXT
) PARTITION BY RANGE (order_date);

-- åˆ›å»ºåˆ†åŒºï¼ˆæŒ‰å­£åº¦ï¼‰
CREATE TABLE orders_2023_q1 PARTITION OF orders
FOR VALUES FROM ('2023-01-01') TO ('2023-04-01');
-- ... å…¶ä»–åˆ†åŒº

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_orders_customer_date
ON orders (customer_id, order_date);
CREATE INDEX idx_orders_status_date
ON orders (status, order_date);

-- ä¼˜åŒ–æŸ¥è¯¢
EXPLAIN (ANALYZE, BUFFERS)
SELECT
    customer_id,
    COUNT(*) AS order_count,
    SUM(total_amount) AS total_spent
FROM orders
WHERE order_date >= '2024-01-01'
  AND order_date < '2024-04-01'
  AND status = 'completed'
GROUP BY customer_id
HAVING COUNT(*) > 10
ORDER BY total_spent DESC;

-- æ€§èƒ½ç»“æœï¼š
-- - åˆ†åŒºè£å‰ªï¼šåªæ‰«æ 1 ä¸ªåˆ†åŒº
-- - æŸ¥è¯¢æ—¶é—´ï¼š< 100ms
-- - å¹¶è¡ŒæŸ¥è¯¢ï¼šæ”¯æŒå¹¶è¡Œæ‰«æ
```

### 7.2 æ¡ˆä¾‹ï¼šæ—¥å¿—è¡¨åˆ†åŒºä¼˜åŒ–

```sql
-- åœºæ™¯ï¼šåº”ç”¨æ—¥å¿—è¡¨ï¼ŒæŒ‰æœˆåˆ†åŒº
-- è¦æ±‚ï¼šå¿«é€Ÿå†™å…¥ã€å¿«é€ŸæŸ¥è¯¢ã€è‡ªåŠ¨æ¸…ç†

-- åˆ›å»ºåˆ†åŒºè¡¨
CREATE TABLE app_logs (
    log_id BIGSERIAL,
    log_time TIMESTAMPTZ NOT NULL,
    level TEXT,
    message TEXT,
    metadata JSONB
) PARTITION BY RANGE (log_time);

-- åˆ›å»ºåˆ†åŒºï¼ˆæŒ‰æœˆï¼‰
CREATE TABLE app_logs_2024_01 PARTITION OF app_logs
FOR VALUES FROM ('2024-01-01') TO ('2024-02-01');
-- ... å…¶ä»–åˆ†åŒº

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_app_logs_time ON app_logs (log_time DESC);
CREATE INDEX idx_app_logs_level_time
ON app_logs (level, log_time DESC);

-- è‡ªåŠ¨æ¸…ç†æ—§åˆ†åŒºï¼ˆä½¿ç”¨ pg_partman æˆ–è‡ªå®šä¹‰å‡½æ•°ï¼‰
-- åˆ é™¤ 3 ä¸ªæœˆå‰çš„åˆ†åŒº
DO $$
DECLARE
    partition_name TEXT;
BEGIN
    FOR partition_name IN
        SELECT tablename
        FROM pg_tables
        WHERE tablename LIKE 'app_logs_%'
          AND tablename < 'app_logs_' || to_char(
              CURRENT_DATE - INTERVAL '3 months',
              'YYYY_MM'
          )
    LOOP
        EXECUTE 'DROP TABLE ' || partition_name;
    END LOOP;
END $$;
```

---

## ğŸ“Š æ€»ç»“

PostgreSQL 17 çš„åˆ†åŒºè¡¨æ€§èƒ½ä¼˜åŒ–æ˜¾è‘—æå‡äº†åˆ†åŒºè¡¨çš„æŸ¥è¯¢å’Œç»´æŠ¤æ€§èƒ½ã€‚é€šè¿‡åˆç†ä½¿ç”¨åˆ†åŒºè£å‰ªã€å¹¶è¡ŒæŸ¥è¯¢ã€ç´¢å¼•ä¼˜åŒ–ç­‰åŠŸèƒ½ï¼Œå¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å®ç°é«˜æ€§èƒ½çš„åˆ†åŒºè¡¨æ“ä½œã€‚å»ºè®®æ ¹æ®æ•°æ®ç‰¹å¾å’ŒæŸ¥è¯¢æ¨¡å¼é€‰æ‹©åˆé€‚çš„åˆ†åŒºç­–ç•¥ï¼Œå¹¶å®šæœŸç»´æŠ¤åˆ†åŒºå’Œç´¢å¼•ã€‚

## ğŸ“š å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - åˆ†åŒºè¡¨](https://www.postgresql.org/docs/current/ddl-partitioning.html)**
  - åˆ†åŒºè¡¨å®Œæ•´æ•™ç¨‹
  - è¯­æ³•å’Œç¤ºä¾‹è¯´æ˜

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - åˆ†åŒºè¡¨æ€§èƒ½ä¼˜åŒ–](https://www.postgresql.org/docs/current/ddl-partitioning.html#DDL-PARTITIONING-PERFORMANCE)**
  - åˆ†åŒºè¡¨æ€§èƒ½ä¼˜åŒ–è¯´æ˜
  - æœ€ä½³å®è·µ

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - åˆ†åŒºè£å‰ª](https://www.postgresql.org/docs/current/ddl-partitioning.html#DDL-PARTITIONING-PRUNING)**
  - åˆ†åŒºè£å‰ªè¯´æ˜
  - ä¼˜åŒ–æŠ€å·§

### SQL æ ‡å‡†

- **ISO/IEC 9075:2016 - SQL æ ‡å‡†åˆ†åŒºè¡¨**
  - SQL æ ‡å‡†åˆ†åŒºè¡¨è§„èŒƒ
  - åˆ†åŒºè¡¨æ ‡å‡†è¯­æ³•

### æŠ€æœ¯è®ºæ–‡

- **Zilio, D. C., et al. (2004). "DB2 Design Advisor: Integrated Automatic Physical Database Design."**
  - ä¼šè®®: VLDB 2004
  - **é‡è¦æ€§**: æ•°æ®åº“ç‰©ç†è®¾è®¡è‡ªåŠ¨åŒ–çš„åŸºç¡€ç ”ç©¶
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†è‡ªåŠ¨ç‰©ç†è®¾è®¡æ–¹æ³•ï¼Œå½±å“äº†ç°ä»£æ•°æ®åº“åˆ†åŒºç­–ç•¥çš„è®¾è®¡

- **Agrawal, S., et al. (2004). "Automated Selection of Materialized Views and Indexes for SQL Databases."**
  - ä¼šè®®: VLDB 2004
  - **é‡è¦æ€§**: ç‰©åŒ–è§†å›¾å’Œç´¢å¼•è‡ªåŠ¨é€‰æ‹©çš„ç ”ç©¶
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†è‡ªåŠ¨é€‰æ‹©ç®—æ³•ï¼Œå½±å“äº†ç°ä»£æ•°æ®åº“åˆ†åŒºå’Œç´¢å¼•çš„è®¾è®¡

### æŠ€æœ¯åšå®¢

- **[PostgreSQL å®˜æ–¹åšå®¢ - åˆ†åŒºè¡¨](https://www.postgresql.org/docs/current/ddl-partitioning.html)**
  - åˆ†åŒºè¡¨æœ€ä½³å®è·µ
  - æ€§èƒ½ä¼˜åŒ–æŠ€å·§

- **[2ndQuadrant - PostgreSQL åˆ†åŒºè¡¨](https://www.2ndquadrant.com/en/blog/postgresql-partitioning-performance/)**
  - åˆ†åŒºè¡¨å®æˆ˜
  - æ€§èƒ½ä¼˜åŒ–æ¡ˆä¾‹

- **[Percona - PostgreSQL åˆ†åŒºè¡¨](https://www.percona.com/blog/postgresql-partitioning-performance/)**
  - åˆ†åŒºè¡¨ä½¿ç”¨æŠ€å·§
  - æ€§èƒ½ä¼˜åŒ–å»ºè®®

- **[EnterpriseDB - PostgreSQL åˆ†åŒºè¡¨](https://www.enterprisedb.com/postgres-tutorials/postgresql-partitioning-tutorial)**
  - åˆ†åŒºè¡¨æ·±å…¥è§£æ
  - å®é™…åº”ç”¨æ¡ˆä¾‹

### ç¤¾åŒºèµ„æº

- **[PostgreSQL Wiki - åˆ†åŒºè¡¨](https://wiki.postgresql.org/wiki/Partitioning)**
  - åˆ†åŒºè¡¨æŠ€å·§
  - å®é™…åº”ç”¨æ¡ˆä¾‹

- **[Stack Overflow - PostgreSQL åˆ†åŒºè¡¨](https://stackoverflow.com/questions/tagged/postgresql+partitioning)**
  - åˆ†åŒºè¡¨é—®ç­”
  - å¸¸è§é—®é¢˜è§£ç­”

### ç›¸å…³æ–‡æ¡£

- [åˆ†åŒºè¡¨ç®¡ç†](../05-æ•°æ®ç®¡ç†/åˆ†åŒºè¡¨ç®¡ç†.md)
- [æŸ¥è¯¢ä¼˜åŒ–å™¨å¢å¼º](./æŸ¥è¯¢ä¼˜åŒ–å™¨å¢å¼º.md)
- [ç´¢å¼•ä¸æŸ¥è¯¢ä¼˜åŒ–](../01-SQLåŸºç¡€/ç´¢å¼•ä¸æŸ¥è¯¢ä¼˜åŒ–.md)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 1 æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 03-03-17-07
