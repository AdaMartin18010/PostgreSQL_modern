# PostgreSQL 17 æ€§èƒ½è¯Šæ–­æ”¹è¿›

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 1 æœˆ
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 17+
> **æ–‡æ¡£ç¼–å·**: 03-03-17-14

## ğŸ“‘ æ¦‚è¿°

PostgreSQL 17 å¯¹æ€§èƒ½è¯Šæ–­å·¥å…·è¿›è¡Œäº†é‡è¦æ”¹è¿›ï¼ŒåŒ…æ‹¬æ–°çš„è¯Šæ–­è§†å›¾ã€æ€§èƒ½åˆ†æå·¥å…·ã€æŸ¥è¯¢è¿½è¸ªå¢å¼ºç­‰ï¼Œä½¿å¾—æ€§èƒ½é—®é¢˜çš„å®šä½å’Œåˆ†ææ›´åŠ ä¾¿æ·å’Œé«˜æ•ˆã€‚

## ğŸ¯ æ ¸å¿ƒä»·å€¼

- **è¯Šæ–­å·¥å…·å¢å¼º**ï¼šæ–°çš„æ€§èƒ½è¯Šæ–­è§†å›¾å’Œå·¥å…·
- **æŸ¥è¯¢è¿½è¸ªæ”¹è¿›**ï¼šæ›´è¯¦ç»†çš„æŸ¥è¯¢æ‰§è¡Œä¿¡æ¯
- **æ€§èƒ½åˆ†æä¼˜åŒ–**ï¼šæ›´å‡†ç¡®çš„æ€§èƒ½åˆ†æç»“æœ
- **é—®é¢˜å®šä½å¿«é€Ÿ**ï¼šå¿«é€Ÿå®šä½æ€§èƒ½ç“¶é¢ˆ
- **ç›‘æ§èƒ½åŠ›æå‡**ï¼šæ›´å…¨é¢çš„æ€§èƒ½ç›‘æ§

## ğŸ“š ç›®å½•

- [PostgreSQL 17 æ€§èƒ½è¯Šæ–­æ”¹è¿›](#postgresql-17-æ€§èƒ½è¯Šæ–­æ”¹è¿›)
  - [ğŸ“‘ æ¦‚è¿°](#-æ¦‚è¿°)
  - [ğŸ¯ æ ¸å¿ƒä»·å€¼](#-æ ¸å¿ƒä»·å€¼)
  - [ğŸ“š ç›®å½•](#-ç›®å½•)
  - [1. æ€§èƒ½è¯Šæ–­æ”¹è¿›æ¦‚è¿°](#1-æ€§èƒ½è¯Šæ–­æ”¹è¿›æ¦‚è¿°)
    - [1.0 æ€§èƒ½è¯Šæ–­æ”¹è¿›å·¥ä½œåŸç†æ¦‚è¿°](#10-æ€§èƒ½è¯Šæ–­æ”¹è¿›å·¥ä½œåŸç†æ¦‚è¿°)
    - [1.1 PostgreSQL 17 æ”¹è¿›äº®ç‚¹](#11-postgresql-17-æ”¹è¿›äº®ç‚¹)
    - [1.2 åŠŸèƒ½å¯¹æ¯”](#12-åŠŸèƒ½å¯¹æ¯”)
  - [2. æ–°è¯Šæ–­è§†å›¾](#2-æ–°è¯Šæ–­è§†å›¾)
    - [2.1 pg\_stat\_statements å¢å¼º](#21-pg_stat_statements-å¢å¼º)
    - [2.2 pg\_stat\_progress è§†å›¾](#22-pg_stat_progress-è§†å›¾)
    - [2.3 pg\_stat\_activity å¢å¼º](#23-pg_stat_activity-å¢å¼º)
  - [3. æŸ¥è¯¢è¿½è¸ªå¢å¼º](#3-æŸ¥è¯¢è¿½è¸ªå¢å¼º)
    - [3.1 æ‰§è¡Œè®¡åˆ’è¿½è¸ª](#31-æ‰§è¡Œè®¡åˆ’è¿½è¸ª)
    - [3.2 æŸ¥è¯¢ç»Ÿè®¡è¿½è¸ª](#32-æŸ¥è¯¢ç»Ÿè®¡è¿½è¸ª)
    - [3.3 ç­‰å¾…äº‹ä»¶è¿½è¸ª](#33-ç­‰å¾…äº‹ä»¶è¿½è¸ª)
  - [4. æ€§èƒ½åˆ†æå·¥å…·](#4-æ€§èƒ½åˆ†æå·¥å…·)
    - [4.1 EXPLAIN å¢å¼º](#41-explain-å¢å¼º)
    - [4.2 æ€§èƒ½åˆ†æè„šæœ¬](#42-æ€§èƒ½åˆ†æè„šæœ¬)
    - [4.3 è‡ªåŠ¨åŒ–è¯Šæ–­](#43-è‡ªåŠ¨åŒ–è¯Šæ–­)
  - [5. ç›‘æ§å’Œå‘Šè­¦](#5-ç›‘æ§å’Œå‘Šè­¦)
    - [5.1 æ€§èƒ½æŒ‡æ ‡ç›‘æ§](#51-æ€§èƒ½æŒ‡æ ‡ç›‘æ§)
    - [5.2 æ…¢æŸ¥è¯¢ç›‘æ§](#52-æ…¢æŸ¥è¯¢ç›‘æ§)
    - [5.3 å‘Šè­¦é…ç½®](#53-å‘Šè­¦é…ç½®)
  - [6. æœ€ä½³å®è·µ](#6-æœ€ä½³å®è·µ)
    - [6.1 è¯Šæ–­æµç¨‹å»ºè®®](#61-è¯Šæ–­æµç¨‹å»ºè®®)
    - [6.2 æ€§èƒ½åˆ†æå»ºè®®](#62-æ€§èƒ½åˆ†æå»ºè®®)
    - [6.3 ç›‘æ§é…ç½®å»ºè®®](#63-ç›‘æ§é…ç½®å»ºè®®)
  - [7. å®é™…æ¡ˆä¾‹](#7-å®é™…æ¡ˆä¾‹)
    - [7.1 æ¡ˆä¾‹ï¼šæ…¢æŸ¥è¯¢è¯Šæ–­ä¼˜åŒ–](#71-æ¡ˆä¾‹æ…¢æŸ¥è¯¢è¯Šæ–­ä¼˜åŒ–)
    - [7.2 æ¡ˆä¾‹ï¼šæ€§èƒ½ç“¶é¢ˆå®šä½](#72-æ¡ˆä¾‹æ€§èƒ½ç“¶é¢ˆå®šä½)
    - [7.3 æ¡ˆä¾‹ï¼šç­‰å¾…äº‹ä»¶åˆ†æä¼˜åŒ–](#73-æ¡ˆä¾‹ç­‰å¾…äº‹ä»¶åˆ†æä¼˜åŒ–)
  - [8. å¸¸è§é—®é¢˜è§£ç­”ï¼ˆFAQï¼‰](#8-å¸¸è§é—®é¢˜è§£ç­”faq)
    - [Q1: pg\_stat\_statements æ²¡æœ‰æ•°æ®æ€ä¹ˆåŠï¼Ÿ](#q1-pg_stat_statements-æ²¡æœ‰æ•°æ®æ€ä¹ˆåŠ)
    - [Q2: å¦‚ä½•æŸ¥çœ‹ç‰¹å®šæŸ¥è¯¢çš„æ€§èƒ½ï¼Ÿ](#q2-å¦‚ä½•æŸ¥çœ‹ç‰¹å®šæŸ¥è¯¢çš„æ€§èƒ½)
    - [Q3: å¦‚ä½•ç›‘æ§é•¿æ—¶é—´è¿è¡Œçš„æŸ¥è¯¢ï¼Ÿ](#q3-å¦‚ä½•ç›‘æ§é•¿æ—¶é—´è¿è¡Œçš„æŸ¥è¯¢)
    - [Q4: å¦‚ä½•åˆ†æç­‰å¾…äº‹ä»¶ï¼Ÿ](#q4-å¦‚ä½•åˆ†æç­‰å¾…äº‹ä»¶)
    - [Q5: å¦‚ä½•è¯Šæ–­æ…¢æŸ¥è¯¢ï¼Ÿ](#q5-å¦‚ä½•è¯Šæ–­æ…¢æŸ¥è¯¢)
    - [Q6: å¦‚ä½•ç›‘æ§ VACUUM è¿›åº¦ï¼Ÿ](#q6-å¦‚ä½•ç›‘æ§-vacuum-è¿›åº¦)
    - [Q7: å¦‚ä½•è¯Šæ–­é”ç«äº‰é—®é¢˜ï¼Ÿ](#q7-å¦‚ä½•è¯Šæ–­é”ç«äº‰é—®é¢˜)
    - [Q8: å¦‚ä½•é‡ç½®æ€§èƒ½ç»Ÿè®¡ä¿¡æ¯ï¼Ÿ](#q8-å¦‚ä½•é‡ç½®æ€§èƒ½ç»Ÿè®¡ä¿¡æ¯)
  - [9. æ•…éšœæ’æŸ¥æŒ‡å—](#9-æ•…éšœæ’æŸ¥æŒ‡å—)
    - [9.1 å¸¸è§é—®é¢˜è¯Šæ–­](#91-å¸¸è§é—®é¢˜è¯Šæ–­)
    - [9.2 æ€§èƒ½é—®é¢˜æ’æŸ¥æµç¨‹](#92-æ€§èƒ½é—®é¢˜æ’æŸ¥æµç¨‹)
    - [9.3 è¯Šæ–­å·¥å…·ä½¿ç”¨æŠ€å·§](#93-è¯Šæ–­å·¥å…·ä½¿ç”¨æŠ€å·§)
  - [10. æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•](#10-æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•)
  - [ğŸ“Š æ€»ç»“](#-æ€»ç»“)
  - [11. å‚è€ƒèµ„æ–™](#11-å‚è€ƒèµ„æ–™)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [SQL æ ‡å‡†](#sql-æ ‡å‡†)
    - [æŠ€æœ¯è®ºæ–‡](#æŠ€æœ¯è®ºæ–‡)
    - [æŠ€æœ¯åšå®¢](#æŠ€æœ¯åšå®¢)
    - [ç¤¾åŒºèµ„æº](#ç¤¾åŒºèµ„æº)
    - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)

---

## 1. æ€§èƒ½è¯Šæ–­æ”¹è¿›æ¦‚è¿°

### 1.0 æ€§èƒ½è¯Šæ–­æ”¹è¿›å·¥ä½œåŸç†æ¦‚è¿°

**æ€§èƒ½è¯Šæ–­æ”¹è¿›çš„æœ¬è´¨**ï¼š

PostgreSQL 17 çš„æ€§èƒ½è¯Šæ–­æ”¹è¿›åŸºäºå¢å¼ºçš„ç»Ÿè®¡ä¿¡æ¯æ”¶é›†ã€æ–°çš„è¯Šæ–­è§†å›¾å’Œæ™ºèƒ½çš„æ€§èƒ½åˆ†æå·¥å…·ã€‚
æ€§èƒ½è¯Šæ–­æ˜¯æ•°æ®åº“è¿ç»´çš„å…³é”®ç¯èŠ‚ï¼Œé€šè¿‡å®æ—¶ç›‘æ§æ•°æ®åº“æ´»åŠ¨ã€æ”¶é›†æ€§èƒ½æŒ‡æ ‡ã€åˆ†ææ€§èƒ½ç“¶é¢ˆï¼Œå¯ä»¥åŠæ—¶å‘ç°å’Œè§£å†³æ€§èƒ½é—®é¢˜ã€‚
PostgreSQL 17 é€šè¿‡æ–°å¢è¯Šæ–­è§†å›¾ã€å¢å¼ºæŸ¥è¯¢è¿½è¸ªã€ä¼˜åŒ–æ€§èƒ½åˆ†æï¼Œæ˜¾è‘—æå‡äº†æ€§èƒ½é—®é¢˜çš„å®šä½å’Œåˆ†ææ•ˆç‡ã€‚

**æ€§èƒ½è¯Šæ–­æ”¹è¿›æ‰§è¡Œæµç¨‹å›¾**ï¼š

```mermaid
flowchart TD
    A[æ€§èƒ½é—®é¢˜æŠ¥å‘Š] --> B[æ€§èƒ½æŒ‡æ ‡æ”¶é›†]
    B --> C{è¯Šæ–­ç±»å‹}
    C -->|æ…¢æŸ¥è¯¢| D[æŸ¥è¯¢ç»Ÿè®¡åˆ†æ]
    C -->|èµ„æºç“¶é¢ˆ| E[èµ„æºä½¿ç”¨åˆ†æ]
    C -->|ç­‰å¾…äº‹ä»¶| F[ç­‰å¾…äº‹ä»¶åˆ†æ]
    D --> G[æ‰§è¡Œè®¡åˆ’åˆ†æ]
    E --> G
    F --> G
    G --> H[é—®é¢˜å®šä½]
    H --> I{é—®é¢˜ç±»å‹}
    I -->|ç´¢å¼•é—®é¢˜| J[ç´¢å¼•ä¼˜åŒ–]
    I -->|æŸ¥è¯¢é—®é¢˜| K[æŸ¥è¯¢ä¼˜åŒ–]
    I -->|é…ç½®é—®é¢˜| L[é…ç½®ä¼˜åŒ–]
    J --> M[éªŒè¯ä¼˜åŒ–æ•ˆæœ]
    K --> M
    L --> M
    M --> N[é—®é¢˜è§£å†³]

    style B fill:#FFD700
    style C fill:#90EE90
    style G fill:#87CEEB
    style H fill:#FFD700
    style N fill:#87CEEB
```

**æ€§èƒ½è¯Šæ–­æ”¹è¿›æ‰§è¡Œæ­¥éª¤**ï¼š

1. **æ€§èƒ½æŒ‡æ ‡æ”¶é›†**ï¼šæ”¶é›†æ•°æ®åº“æ´»åŠ¨çš„æ€§èƒ½æŒ‡æ ‡
2. **è¯Šæ–­ç±»å‹è¯†åˆ«**ï¼šè¯†åˆ«æ€§èƒ½é—®é¢˜çš„ç±»å‹ï¼ˆæ…¢æŸ¥è¯¢ã€èµ„æºç“¶é¢ˆã€ç­‰å¾…äº‹ä»¶ï¼‰
3. **æ‰§è¡Œè®¡åˆ’åˆ†æ**ï¼šåˆ†ææŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’
4. **é—®é¢˜å®šä½**ï¼šå®šä½æ€§èƒ½é—®é¢˜çš„æ ¹æœ¬åŸå› 
5. **ä¼˜åŒ–æ–¹æ¡ˆ**ï¼šåˆ¶å®šä¼˜åŒ–æ–¹æ¡ˆï¼ˆç´¢å¼•ä¼˜åŒ–ã€æŸ¥è¯¢ä¼˜åŒ–ã€é…ç½®ä¼˜åŒ–ï¼‰
6. **éªŒè¯ä¼˜åŒ–æ•ˆæœ**ï¼šéªŒè¯ä¼˜åŒ–åçš„æ•ˆæœ
7. **é—®é¢˜è§£å†³**ï¼šå®Œæˆæ€§èƒ½é—®é¢˜çš„è§£å†³

### 1.1 PostgreSQL 17 æ”¹è¿›äº®ç‚¹

PostgreSQL 17 åœ¨æ€§èƒ½è¯Šæ–­æ–¹é¢çš„ä¸»è¦æ”¹è¿›ï¼š

- **æ–°è¯Šæ–­è§†å›¾**ï¼špg_stat_progress_vacuumã€pg_stat_progress_cluster ç­‰
- **æŸ¥è¯¢è¿½è¸ªå¢å¼º**ï¼šæ›´è¯¦ç»†çš„æŸ¥è¯¢æ‰§è¡Œä¿¡æ¯
- **æ€§èƒ½åˆ†æä¼˜åŒ–**ï¼šæ›´å‡†ç¡®çš„æ€§èƒ½åˆ†æç»“æœ
- **è‡ªåŠ¨åŒ–è¯Šæ–­**ï¼šæ”¯æŒè‡ªåŠ¨åŒ–æ€§èƒ½è¯Šæ–­
- **ç›‘æ§èƒ½åŠ›æå‡**ï¼šæ›´å…¨é¢çš„æ€§èƒ½ç›‘æ§

### 1.2 åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | PostgreSQL 16 | PostgreSQL 17 |
|------|--------------|---------------|
| è¿›åº¦è§†å›¾ | åŸºç¡€ | å¢å¼º |
| æŸ¥è¯¢è¿½è¸ª | æ”¯æŒ | å¢å¼º |
| æ€§èƒ½åˆ†æ | åŸºç¡€ | ä¼˜åŒ– |
| è‡ªåŠ¨åŒ–è¯Šæ–­ | âŒ | âœ… |

---

## 2. æ–°è¯Šæ–­è§†å›¾

### 2.1 pg_stat_statements å¢å¼º

```sql
-- å¯ç”¨ pg_stat_statements
CREATE EXTENSION IF NOT EXISTS pg_stat_statements;

-- æŸ¥çœ‹æŸ¥è¯¢ç»Ÿè®¡ï¼ˆPostgreSQL 17 å¢å¼ºï¼‰
SELECT
    query,
    calls,
    total_exec_time,
    mean_exec_time,
    max_exec_time,
    min_exec_time,
    stddev_exec_time,
    rows,
    100.0 * shared_blks_hit / NULLIF(shared_blks_hit + shared_blks_read, 0) AS hit_percent
FROM pg_stat_statements
WHERE query NOT LIKE '%pg_stat_statements%'
ORDER BY total_exec_time DESC
LIMIT 20;

-- æŸ¥çœ‹æŸ¥è¯¢è®¡åˆ’ç»Ÿè®¡
SELECT
    query,
    plans,
    total_plan_time,
    mean_plan_time,
    calls,
    total_exec_time,
    mean_exec_time
FROM pg_stat_statements
WHERE plans > 0
ORDER BY total_plan_time DESC
LIMIT 20;
```

### 2.2 pg_stat_progress è§†å›¾

```sql
-- æŸ¥çœ‹ VACUUM è¿›åº¦
SELECT
    pid,
    datname,
    relid::regclass,
    phase,
    heap_blks_total,
    heap_blks_scanned,
    heap_blks_vacuumed,
    index_vacuum_count,
    max_dead_tuples,
    num_dead_tuples
FROM pg_stat_progress_vacuum;

-- æŸ¥çœ‹ CLUSTER è¿›åº¦
SELECT
    pid,
    datname,
    relid::regclass,
    command,
    phase,
    cluster_index_relid::regclass,
    heap_tuples_scanned,
    heap_tuples_written,
    heap_blks_total,
    heap_blks_scanned
FROM pg_stat_progress_cluster;

-- æŸ¥çœ‹ CREATE INDEX è¿›åº¦
SELECT
    pid,
    datname,
    relid::regclass,
    index_relid::regclass,
    command,
    phase,
    tuples_total,
    tuples_done,
    partitions_total,
    partitions_done
FROM pg_stat_progress_create_index;
```

### 2.3 pg_stat_activity å¢å¼º

```sql
-- æŸ¥çœ‹æ´»åŠ¨è¿æ¥ï¼ˆPostgreSQL 17 å¢å¼ºï¼‰
SELECT
    pid,
    usename,
    application_name,
    client_addr,
    state,
    wait_event_type,
    wait_event,
    query_start,
    state_change,
    backend_start,
    xact_start,
    query_start,
    state_change,
    query
FROM pg_stat_activity
WHERE state != 'idle'
ORDER BY query_start;

-- æŸ¥çœ‹ç­‰å¾…äº‹ä»¶ç»Ÿè®¡
SELECT
    wait_event_type,
    wait_event,
    COUNT(*) AS count
FROM pg_stat_activity
WHERE wait_event IS NOT NULL
GROUP BY wait_event_type, wait_event
ORDER BY count DESC;
```

---

## 3. æŸ¥è¯¢è¿½è¸ªå¢å¼º

### 3.1 æ‰§è¡Œè®¡åˆ’è¿½è¸ª

```sql
-- å¯ç”¨æŸ¥è¯¢è¿½è¸ª
SET track_io_timing = on;
SET track_functions = all;

-- æŸ¥çœ‹è¯¦ç»†æ‰§è¡Œè®¡åˆ’
EXPLAIN (ANALYZE, BUFFERS, VERBOSE, COSTS, TIMING)
SELECT * FROM orders WHERE status = 'pending';

-- æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ç»Ÿè®¡
SELECT
    query,
    plans,
    total_plan_time,
    mean_plan_time,
    calls,
    total_exec_time,
    mean_exec_time
FROM pg_stat_statements
WHERE query LIKE '%orders%'
ORDER BY total_exec_time DESC;
```

### 3.2 æŸ¥è¯¢ç»Ÿè®¡è¿½è¸ª

```sql
-- æŸ¥çœ‹æŸ¥è¯¢ç»Ÿè®¡è¯¦æƒ…
SELECT
    queryid,
    query,
    calls,
    total_exec_time,
    mean_exec_time,
    max_exec_time,
    min_exec_time,
    stddev_exec_time,
    rows,
    shared_blks_hit,
    shared_blks_read,
    shared_blks_dirtied,
    shared_blks_written,
    local_blks_hit,
    local_blks_read,
    local_blks_dirtied,
    local_blks_written,
    temp_blks_read,
    temp_blks_written,
    blk_read_time,
    blk_write_time
FROM pg_stat_statements
WHERE query NOT LIKE '%pg_stat_statements%'
ORDER BY total_exec_time DESC
LIMIT 10;
```

### 3.3 ç­‰å¾…äº‹ä»¶è¿½è¸ª

```sql
-- æŸ¥çœ‹ç­‰å¾…äº‹ä»¶
SELECT
    pid,
    usename,
    application_name,
    wait_event_type,
    wait_event,
    state,
    query
FROM pg_stat_activity
WHERE wait_event IS NOT NULL
ORDER BY wait_event_type, wait_event;

-- æŸ¥çœ‹ç­‰å¾…äº‹ä»¶ç»Ÿè®¡
SELECT
    wait_event_type,
    wait_event,
    COUNT(*) AS count,
    AVG(EXTRACT(EPOCH FROM (now() - state_change))) AS avg_wait_time
FROM pg_stat_activity
WHERE wait_event IS NOT NULL
GROUP BY wait_event_type, wait_event
ORDER BY count DESC;
```

---

## 4. æ€§èƒ½åˆ†æå·¥å…·

### 4.1 EXPLAIN å¢å¼º

```sql
-- è¯¦ç»†æ‰§è¡Œè®¡åˆ’åˆ†æ
EXPLAIN (ANALYZE, BUFFERS, VERBOSE, COSTS, TIMING, SUMMARY, FORMAT JSON)
SELECT * FROM orders WHERE status = 'pending';

-- æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’æ ‘
EXPLAIN (ANALYZE, BUFFERS, VERBOSE, COSTS, TIMING, FORMAT TEXT)
SELECT
    o.id,
    o.order_date,
    SUM(oi.amount) AS total_amount
FROM orders o
JOIN order_items oi ON o.id = oi.order_id
WHERE o.status = 'pending'
GROUP BY o.id, o.order_date;

-- æŸ¥çœ‹å¹¶è¡Œæ‰§è¡Œè®¡åˆ’
EXPLAIN (ANALYZE, BUFFERS, VERBOSE, COSTS, TIMING, FORMAT TEXT)
SELECT * FROM orders
WHERE order_date BETWEEN '2025-01-01' AND '2025-01-31';
```

### 4.2 æ€§èƒ½åˆ†æè„šæœ¬

```sql
-- æŸ¥æ‰¾æ…¢æŸ¥è¯¢
SELECT
    query,
    calls,
    total_exec_time,
    mean_exec_time,
    max_exec_time,
    rows,
    100.0 * shared_blks_hit / NULLIF(shared_blks_hit + shared_blks_read, 0) AS hit_percent
FROM pg_stat_statements
WHERE mean_exec_time > 1000  -- å¹³å‡æ‰§è¡Œæ—¶é—´è¶…è¿‡ 1 ç§’
AND query NOT LIKE '%pg_stat_statements%'
ORDER BY mean_exec_time DESC
LIMIT 20;

-- æŸ¥æ‰¾é«˜ I/O æŸ¥è¯¢
SELECT
    query,
    calls,
    total_exec_time,
    mean_exec_time,
    shared_blks_read,
    shared_blks_hit,
    blk_read_time,
    blk_write_time
FROM pg_stat_statements
WHERE shared_blks_read > 1000
AND query NOT LIKE '%pg_stat_statements%'
ORDER BY shared_blks_read DESC
LIMIT 20;

-- æŸ¥æ‰¾é¢‘ç¹æ‰§è¡Œçš„æŸ¥è¯¢
SELECT
    query,
    calls,
    total_exec_time,
    mean_exec_time,
    rows
FROM pg_stat_statements
WHERE calls > 10000
AND query NOT LIKE '%pg_stat_statements%'
ORDER BY calls DESC
LIMIT 20;
```

### 4.3 è‡ªåŠ¨åŒ–è¯Šæ–­

```sql
-- åˆ›å»ºæ€§èƒ½è¯Šæ–­å‡½æ•°
CREATE OR REPLACE FUNCTION diagnose_performance()
RETURNS TABLE (
    metric TEXT,
    value NUMERIC,
    threshold NUMERIC,
    status TEXT
) AS $$
BEGIN
    RETURN QUERY
    SELECT
        'slow_queries'::TEXT,
        COUNT(*)::NUMERIC,
        10::NUMERIC,
        CASE WHEN COUNT(*) > 10 THEN 'WARNING' ELSE 'OK' END
    FROM pg_stat_statements
    WHERE mean_exec_time > 1000;

    RETURN QUERY
    SELECT
        'high_io_queries'::TEXT,
        COUNT(*)::NUMERIC,
        5::NUMERIC,
        CASE WHEN COUNT(*) > 5 THEN 'WARNING' ELSE 'OK' END
    FROM pg_stat_statements
    WHERE shared_blks_read > 10000;

    RETURN QUERY
    SELECT
        'cache_hit_ratio'::TEXT,
        (SELECT
            100.0 * SUM(shared_blks_hit) / NULLIF(SUM(shared_blks_hit) + SUM(shared_blks_read), 0)
         FROM pg_stat_statements)::NUMERIC,
        95::NUMERIC,
        CASE
            WHEN (SELECT 100.0 * SUM(shared_blks_hit) / NULLIF(SUM(shared_blks_hit) + SUM(shared_blks_read), 0)
                  FROM pg_stat_statements) < 95
            THEN 'WARNING'
            ELSE 'OK'
        END;
END;
$$ LANGUAGE plpgsql;

-- æ‰§è¡Œæ€§èƒ½è¯Šæ–­
SELECT * FROM diagnose_performance();
```

---

## 5. ç›‘æ§å’Œå‘Šè­¦

### 5.1 æ€§èƒ½æŒ‡æ ‡ç›‘æ§

```sql
-- ç›‘æ§æ•°æ®åº“æ€§èƒ½æŒ‡æ ‡
SELECT
    datname,
    numbackends,
    xact_commit,
    xact_rollback,
    blks_read,
    blks_hit,
    100.0 * blks_hit / NULLIF(blks_hit + blks_read, 0) AS cache_hit_ratio,
    tup_returned,
    tup_fetched,
    tup_inserted,
    tup_updated,
    tup_deleted,
    conflicts,
    temp_files,
    temp_bytes,
    deadlocks
FROM pg_stat_database
WHERE datname = current_database();

-- ç›‘æ§è¡¨æ€§èƒ½æŒ‡æ ‡
SELECT
    schemaname,
    tablename,
    seq_scan,
    seq_tup_read,
    idx_scan,
    idx_tup_fetch,
    n_tup_ins,
    n_tup_upd,
    n_tup_del,
    n_live_tup,
    n_dead_tup,
    last_vacuum,
    last_autovacuum
FROM pg_stat_user_tables
WHERE schemaname = 'public'
ORDER BY seq_scan DESC;
```

### 5.2 æ…¢æŸ¥è¯¢ç›‘æ§

```sql
-- åˆ›å»ºæ…¢æŸ¥è¯¢ç›‘æ§è§†å›¾
CREATE OR REPLACE VIEW slow_queries AS
SELECT
    query,
    calls,
    total_exec_time,
    mean_exec_time,
    max_exec_time,
    rows,
    100.0 * shared_blks_hit / NULLIF(shared_blks_hit + shared_blks_read, 0) AS hit_percent
FROM pg_stat_statements
WHERE mean_exec_time > 1000  -- å¹³å‡æ‰§è¡Œæ—¶é—´è¶…è¿‡ 1 ç§’
AND query NOT LIKE '%pg_stat_statements%'
ORDER BY mean_exec_time DESC;

-- æŸ¥çœ‹æ…¢æŸ¥è¯¢
SELECT * FROM slow_queries LIMIT 20;

-- ç›‘æ§æ…¢æŸ¥è¯¢è¶‹åŠ¿
SELECT
    DATE_TRUNC('hour', now()) AS hour,
    COUNT(*) AS slow_query_count,
    AVG(mean_exec_time) AS avg_exec_time
FROM slow_queries
GROUP BY DATE_TRUNC('hour', now())
ORDER BY hour DESC;
```

### 5.3 å‘Šè­¦é…ç½®

```sql
-- åˆ›å»ºæ€§èƒ½å‘Šè­¦å‡½æ•°
CREATE OR REPLACE FUNCTION check_performance_alerts()
RETURNS TABLE (
    alert_type TEXT,
    message TEXT,
    severity TEXT
) AS $$
BEGIN
    -- æ£€æŸ¥ç¼“å­˜å‘½ä¸­ç‡
    IF (SELECT 100.0 * SUM(shared_blks_hit) / NULLIF(SUM(shared_blks_hit) + SUM(shared_blks_read), 0)
        FROM pg_stat_statements) < 95 THEN
        RETURN QUERY SELECT
            'cache_hit_ratio'::TEXT,
            'Cache hit ratio is below 95%'::TEXT,
            'WARNING'::TEXT;
    END IF;

    -- æ£€æŸ¥æ…¢æŸ¥è¯¢æ•°é‡
    IF (SELECT COUNT(*) FROM pg_stat_statements WHERE mean_exec_time > 1000) > 10 THEN
        RETURN QUERY SELECT
            'slow_queries'::TEXT,
            'Too many slow queries detected'::TEXT,
            'WARNING'::TEXT;
    END IF;

    -- æ£€æŸ¥æ­»é”
    IF (SELECT deadlocks FROM pg_stat_database WHERE datname = current_database()) > 0 THEN
        RETURN QUERY SELECT
            'deadlocks'::TEXT,
            'Deadlocks detected'::TEXT,
            'ERROR'::TEXT;
    END IF;
END;
$$ LANGUAGE plpgsql;

-- æ‰§è¡Œå‘Šè­¦æ£€æŸ¥
SELECT * FROM check_performance_alerts();
```

---

## 6. æœ€ä½³å®è·µ

### 6.1 è¯Šæ–­æµç¨‹å»ºè®®

**æ¨èåšæ³•**ï¼š

1. **å»ºç«‹ç³»ç»ŸåŒ–çš„è¯Šæ–­æµç¨‹**ï¼ˆå¯ç»´æŠ¤æ€§ï¼‰

   ```sql
   -- âœ… å¥½ï¼šå»ºç«‹ç³»ç»ŸåŒ–çš„è¯Šæ–­æµç¨‹ï¼ˆå¯ç»´æŠ¤æ€§ï¼‰
   -- 1. æŸ¥çœ‹æ•´ä½“æ€§èƒ½æŒ‡æ ‡
   SELECT * FROM pg_stat_database WHERE datname = current_database();

   -- 2. æŸ¥æ‰¾æ…¢æŸ¥è¯¢
   SELECT * FROM pg_stat_statements
   WHERE mean_exec_time > 1000
   ORDER BY mean_exec_time DESC
   LIMIT 20;

   -- 3. åˆ†ææ‰§è¡Œè®¡åˆ’
   EXPLAIN (ANALYZE, BUFFERS, VERBOSE, COSTS, TIMING)
   -- æ…¢æŸ¥è¯¢è¯­å¥

   -- 4. æ£€æŸ¥ç­‰å¾…äº‹ä»¶
   SELECT * FROM pg_stat_activity WHERE wait_event IS NOT NULL;

   -- 5. æ£€æŸ¥èµ„æºä½¿ç”¨
   SELECT * FROM pg_stat_progress_vacuum;

   -- âŒ ä¸å¥½ï¼šæ²¡æœ‰ç³»ç»ŸåŒ–çš„è¯Šæ–­æµç¨‹ï¼ˆå¯ç»´æŠ¤æ€§å·®ï¼‰
   -- éšæœºæ£€æŸ¥ï¼Œæ— æ³•ç³»ç»Ÿæ€§åœ°å®šä½é—®é¢˜
   ```

2. **å®šæœŸåˆ†ææŸ¥è¯¢ç»Ÿè®¡**ï¼ˆå¯ç»´æŠ¤æ€§ï¼‰

   ```sql
   -- âœ… å¥½ï¼šå®šæœŸåˆ†ææŸ¥è¯¢ç»Ÿè®¡ï¼ˆå¯ç»´æŠ¤æ€§ï¼‰
   SELECT
       query,
       calls,
       mean_exec_time,
       rows,
       100.0 * shared_blks_hit / NULLIF(shared_blks_hit + shared_blks_read, 0) AS hit_percent
   FROM pg_stat_statements
   WHERE query NOT LIKE '%pg_stat_statements%'
   ORDER BY total_exec_time DESC
   LIMIT 20;

   -- âŒ ä¸å¥½ï¼šä¸åˆ†ææŸ¥è¯¢ç»Ÿè®¡ï¼ˆå¯ç»´æŠ¤æ€§å·®ï¼‰
   -- æ— æ³•åŠæ—¶å‘ç°æ€§èƒ½é—®é¢˜
   ```

**é¿å…åšæ³•**ï¼š

1. **é¿å…æ²¡æœ‰ç³»ç»ŸåŒ–çš„è¯Šæ–­æµç¨‹**ï¼ˆå¯ç»´æŠ¤æ€§å·®ï¼‰
2. **é¿å…ä¸åˆ†ææŸ¥è¯¢ç»Ÿè®¡**ï¼ˆå¯ç»´æŠ¤æ€§å·®ï¼‰

### 6.2 æ€§èƒ½åˆ†æå»ºè®®

**æ¨èåšæ³•**ï¼š

1. **ä½¿ç”¨ EXPLAIN åˆ†ææ‰§è¡Œè®¡åˆ’**ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰

   ```sql
   -- âœ… å¥½ï¼šä½¿ç”¨ EXPLAIN åˆ†ææ‰§è¡Œè®¡åˆ’ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
   EXPLAIN (ANALYZE, BUFFERS, VERBOSE, COSTS, TIMING)
   SELECT * FROM orders
   WHERE status = 'pending'
   AND order_date > '2025-01-01';

   -- åˆ†ææ‰§è¡Œè®¡åˆ’ï¼Œå‘ç°é—®é¢˜
   -- âŒ ä¸å¥½ï¼šä¸ä½¿ç”¨ EXPLAINï¼ˆæ€§èƒ½å·®ï¼‰
   -- æ— æ³•äº†è§£æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ï¼Œæ— æ³•ä¼˜åŒ–
   ```

2. **åˆ†æç´¢å¼•ä½¿ç”¨æƒ…å†µ**ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰

   ```sql
   -- âœ… å¥½ï¼šåˆ†æç´¢å¼•ä½¿ç”¨æƒ…å†µï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
   SELECT
       schemaname,
       tablename,
       indexname,
       idx_scan,
       idx_tup_read,
       idx_tup_fetch
   FROM pg_stat_user_indexes
   WHERE schemaname = 'public'
   ORDER BY idx_scan DESC;

   -- å‘ç°æœªä½¿ç”¨çš„ç´¢å¼•ï¼Œå¯ä»¥åˆ é™¤
   -- âŒ ä¸å¥½ï¼šä¸åˆ†æç´¢å¼•ä½¿ç”¨æƒ…å†µï¼ˆæ€§èƒ½å·®ï¼‰
   -- æ— æ³•å‘ç°æœªä½¿ç”¨çš„ç´¢å¼•ï¼Œæµªè´¹å­˜å‚¨ç©ºé—´
   ```

**é¿å…åšæ³•**ï¼š

1. **é¿å…ä¸ä½¿ç”¨ EXPLAIN**ï¼ˆæ€§èƒ½å·®ï¼‰
2. **é¿å…ä¸åˆ†æç´¢å¼•ä½¿ç”¨æƒ…å†µ**ï¼ˆæ€§èƒ½å·®ï¼‰

### 6.3 ç›‘æ§é…ç½®å»ºè®®

**æ¨èåšæ³•**ï¼š

1. **é…ç½®æ€§èƒ½è¿½è¸ª**ï¼ˆå¯ç»´æŠ¤æ€§ï¼‰

   ```sql
   -- âœ… å¥½ï¼šé…ç½®æ€§èƒ½è¿½è¸ªï¼ˆå¯ç»´æŠ¤æ€§ï¼‰
   -- postgresql.conf
   track_io_timing = on
   track_functions = all
   track_activity_query_size = 2048

   -- å¯ç”¨ pg_stat_statements
   CREATE EXTENSION IF NOT EXISTS pg_stat_statements;

   -- é…ç½® pg_stat_statements
   -- postgresql.conf
   pg_stat_statements.max = 10000
   pg_stat_statements.track = all
   pg_stat_statements.track_utility = on

   -- âŒ ä¸å¥½ï¼šä¸é…ç½®æ€§èƒ½è¿½è¸ªï¼ˆå¯ç»´æŠ¤æ€§å·®ï¼‰
   -- æ— æ³•æ”¶é›†æ€§èƒ½æŒ‡æ ‡ï¼Œæ— æ³•è¯Šæ–­é—®é¢˜
   ```

2. **é…ç½®åˆç†çš„æ€§èƒ½å‘Šè­¦**ï¼ˆå¯ç»´æŠ¤æ€§ï¼‰

   ```sql
   -- âœ… å¥½ï¼šé…ç½®åˆç†çš„æ€§èƒ½å‘Šè­¦ï¼ˆå¯ç»´æŠ¤æ€§ï¼‰
   -- åˆ›å»ºå‘Šè­¦å‡½æ•°
   CREATE OR REPLACE FUNCTION check_performance_alerts()
   RETURNS TABLE (
       alert_type TEXT,
       alert_message TEXT
   ) AS $$
   BEGIN
       -- æ£€æŸ¥æ…¢æŸ¥è¯¢
       IF EXISTS (
           SELECT 1 FROM pg_stat_statements
           WHERE mean_exec_time > 5000
       ) THEN
           RETURN QUERY SELECT 'slow_query'::TEXT, 'å‘ç°æ…¢æŸ¥è¯¢'::TEXT;
       END IF;

       -- æ£€æŸ¥ç­‰å¾…äº‹ä»¶
       IF EXISTS (
           SELECT 1 FROM pg_stat_activity
           WHERE wait_event IS NOT NULL
           AND state = 'active'
       ) THEN
           RETURN QUERY SELECT 'wait_event'::TEXT, 'å‘ç°ç­‰å¾…äº‹ä»¶'::TEXT;
       END IF;
   END;
   $$ LANGUAGE plpgsql;

   -- âŒ ä¸å¥½ï¼šä¸é…ç½®æ€§èƒ½å‘Šè­¦ï¼ˆå¯ç»´æŠ¤æ€§å·®ï¼‰
   -- æ— æ³•åŠæ—¶å‘ç°æ€§èƒ½é—®é¢˜
   ```

**é¿å…åšæ³•**ï¼š

1. **é¿å…ä¸é…ç½®æ€§èƒ½è¿½è¸ª**ï¼ˆå¯ç»´æŠ¤æ€§å·®ï¼‰
2. **é¿å…ä¸é…ç½®æ€§èƒ½å‘Šè­¦**ï¼ˆå¯ç»´æŠ¤æ€§å·®ï¼‰

---

## 7. å®é™…æ¡ˆä¾‹

### 7.1 æ¡ˆä¾‹ï¼šæ…¢æŸ¥è¯¢è¯Šæ–­ä¼˜åŒ–

**åœºæ™¯**ï¼šç”µå•†ç³»ç»Ÿçš„æ…¢æŸ¥è¯¢è¯Šæ–­å’Œä¼˜åŒ–

**é—®é¢˜**ï¼š

- è®¢å•æŸ¥è¯¢å“åº”æ—¶é—´è¶…è¿‡ 5 ç§’
- ç³»ç»Ÿè´Ÿè½½é«˜
- ç”¨æˆ·ä½“éªŒå·®

**è¯Šæ–­è¿‡ç¨‹**ï¼š

```sql
-- 1. æŸ¥æ‰¾æ…¢æŸ¥è¯¢
SELECT
    query,
    calls,
    mean_exec_time,
    max_exec_time
FROM pg_stat_statements
WHERE query LIKE '%orders%'
AND mean_exec_time > 1000
ORDER BY mean_exec_time DESC;

-- 2. åˆ†ææ‰§è¡Œè®¡åˆ’
EXPLAIN (ANALYZE, BUFFERS, VERBOSE, COSTS, TIMING)
SELECT * FROM orders
WHERE status = 'pending'
AND order_date > '2025-01-01';

-- 3. å‘ç°é—®é¢˜ï¼šç¼ºå°‘ç´¢å¼•
CREATE INDEX idx_orders_status_date
ON orders(status, order_date);

-- 4. éªŒè¯ä¼˜åŒ–æ•ˆæœ
EXPLAIN (ANALYZE, BUFFERS, VERBOSE, COSTS, TIMING)
SELECT * FROM orders
WHERE status = 'pending'
AND order_date > '2025-01-01';
```

**æ•ˆæœ**ï¼š

- æŸ¥è¯¢å“åº”æ—¶é—´ä» 5 ç§’é™è‡³ 50 æ¯«ç§’
- ç³»ç»Ÿè´Ÿè½½é™ä½ 60%
- ç”¨æˆ·ä½“éªŒæ˜¾è‘—æå‡

### 7.2 æ¡ˆä¾‹ï¼šæ€§èƒ½ç“¶é¢ˆå®šä½

**åœºæ™¯**ï¼šæ•°æ®åˆ†æç³»ç»Ÿçš„æ€§èƒ½ç“¶é¢ˆå®šä½

**é—®é¢˜**ï¼š

- æŠ¥è¡¨ç”Ÿæˆæ—¶é—´è¿‡é•¿
- ç³»ç»Ÿèµ„æºä½¿ç”¨ç‡é«˜
- æ— æ³•å®šä½å…·ä½“ç“¶é¢ˆ

**è¯Šæ–­è¿‡ç¨‹**ï¼š

```sql
-- 1. æŸ¥çœ‹ç­‰å¾…äº‹ä»¶
SELECT
    wait_event_type,
    wait_event,
    COUNT(*) AS count
FROM pg_stat_activity
WHERE wait_event IS NOT NULL
GROUP BY wait_event_type, wait_event;

-- 2. æŸ¥çœ‹ I/O ç»Ÿè®¡
SELECT
    query,
    shared_blks_read,
    shared_blks_hit,
    blk_read_time,
    blk_write_time
FROM pg_stat_statements
WHERE shared_blks_read > 10000
ORDER BY shared_blks_read DESC;

-- 3. æŸ¥çœ‹ VACUUM è¿›åº¦
SELECT * FROM pg_stat_progress_vacuum;

-- 4. å‘ç°é—®é¢˜ï¼šè¡¨éœ€è¦ VACUUM
VACUUM ANALYZE large_table;

-- 5. ä¼˜åŒ–æŸ¥è¯¢
-- æ·»åŠ ç´¢å¼•ã€ä¼˜åŒ–æŸ¥è¯¢è¯­å¥ç­‰
```

**æ•ˆæœ**ï¼š

- æŠ¥è¡¨ç”Ÿæˆæ—¶é—´ä» 10 åˆ†é’Ÿé™è‡³ 2 åˆ†é’Ÿ
- ç³»ç»Ÿèµ„æºä½¿ç”¨ç‡é™ä½ 40%
- æ€§èƒ½ç“¶é¢ˆæ¸…æ™°å®šä½

### 7.3 æ¡ˆä¾‹ï¼šç­‰å¾…äº‹ä»¶åˆ†æä¼˜åŒ–

**åœºæ™¯**ï¼šé«˜å¹¶å‘ç³»ç»Ÿçš„ç­‰å¾…äº‹ä»¶åˆ†æå’Œä¼˜åŒ–

**é—®é¢˜**ï¼š

- ç³»ç»Ÿå“åº”æ—¶é—´æ…¢
- å¤§é‡è¿æ¥å¤„äºç­‰å¾…çŠ¶æ€
- é”ç«äº‰ä¸¥é‡

**è¯Šæ–­è¿‡ç¨‹**ï¼š

```sql
-- 1. æŸ¥çœ‹ç­‰å¾…äº‹ä»¶ç»Ÿè®¡
SELECT
    wait_event_type,
    wait_event,
    COUNT(*) AS wait_count,
    SUM(EXTRACT(EPOCH FROM (NOW() - state_change))) AS total_wait_time
FROM pg_stat_activity
WHERE wait_event IS NOT NULL
GROUP BY wait_event_type, wait_event
ORDER BY total_wait_time DESC;

-- 2. æŸ¥çœ‹é”ç­‰å¾…æƒ…å†µ
SELECT
    blocked_locks.pid AS blocked_pid,
    blocked_activity.usename AS blocked_user,
    blocking_locks.pid AS blocking_pid,
    blocking_activity.usename AS blocking_user,
    blocked_activity.query AS blocked_statement,
    blocking_activity.query AS blocking_statement
FROM pg_catalog.pg_locks blocked_locks
JOIN pg_catalog.pg_stat_activity blocked_activity ON blocked_activity.pid = blocked_locks.pid
JOIN pg_catalog.pg_locks blocking_locks
    ON blocking_locks.locktype = blocked_locks.locktype
    AND blocking_locks.database IS NOT DISTINCT FROM blocked_locks.database
    AND blocking_locks.relation IS NOT DISTINCT FROM blocked_locks.relation
    AND blocking_locks.page IS NOT DISTINCT FROM blocked_locks.page
    AND blocking_locks.tuple IS NOT DISTINCT FROM blocked_locks.tuple
    AND blocking_locks.virtualxid IS NOT DISTINCT FROM blocked_locks.virtualxid
    AND blocking_locks.transactionid IS NOT DISTINCT FROM blocked_locks.transactionid
    AND blocking_locks.classid IS NOT DISTINCT FROM blocked_locks.classid
    AND blocking_locks.objid IS NOT DISTINCT FROM blocked_locks.objid
    AND blocking_locks.objsubid IS NOT DISTINCT FROM blocked_locks.objsubid
    AND blocking_locks.pid != blocked_locks.pid
JOIN pg_catalog.pg_stat_activity blocking_activity ON blocking_activity.pid = blocking_locks.pid
WHERE NOT blocked_locks.granted;

-- 3. ä¼˜åŒ–ï¼šå‡å°‘é”ç«äº‰
-- ä½¿ç”¨æ›´ç»†ç²’åº¦çš„é”
-- ä¼˜åŒ–äº‹åŠ¡å¤§å°
-- ä½¿ç”¨åˆé€‚çš„éš”ç¦»çº§åˆ«

-- 4. éªŒè¯ä¼˜åŒ–æ•ˆæœ
SELECT
    wait_event_type,
    COUNT(*) AS wait_count
FROM pg_stat_activity
WHERE wait_event IS NOT NULL
GROUP BY wait_event_type;
```

**æ•ˆæœ**ï¼š

- ç­‰å¾…äº‹ä»¶å‡å°‘ 60%
- é”ç«äº‰é™ä½ 50%
- ç³»ç»Ÿå“åº”æ—¶é—´æå‡ 40%

---

## 8. å¸¸è§é—®é¢˜è§£ç­”ï¼ˆFAQï¼‰

### Q1: pg_stat_statements æ²¡æœ‰æ•°æ®æ€ä¹ˆåŠï¼Ÿ

**ç­”**: æ£€æŸ¥æ˜¯å¦å¯ç”¨äº†æ‰©å±•å’Œé…ç½®ã€‚

```sql
-- 1. æ£€æŸ¥æ‰©å±•æ˜¯å¦å¯ç”¨
SELECT * FROM pg_extension WHERE extname = 'pg_stat_statements';

-- 2. å¦‚æœæ²¡æœ‰ï¼Œåˆ›å»ºæ‰©å±•
CREATE EXTENSION IF NOT EXISTS pg_stat_statements;

-- 3. æ£€æŸ¥é…ç½®
SHOW pg_stat_statements.max;
SHOW pg_stat_statements.track;

-- 4. é‡ç½®ç»Ÿè®¡ä¿¡æ¯ï¼ˆå¦‚æœéœ€è¦ï¼‰
SELECT pg_stat_statements_reset();
```

### Q2: å¦‚ä½•æŸ¥çœ‹ç‰¹å®šæŸ¥è¯¢çš„æ€§èƒ½ï¼Ÿ

**ç­”**: ä½¿ç”¨ pg_stat_statements æŸ¥è¯¢ç‰¹å®šæŸ¥è¯¢æ¨¡å¼ã€‚

```sql
-- æŸ¥æ‰¾åŒ…å«ç‰¹å®šè¡¨çš„æŸ¥è¯¢
SELECT
    query,
    calls,
    mean_exec_time,
    total_exec_time
FROM pg_stat_statements
WHERE query LIKE '%table_name%'
ORDER BY total_exec_time DESC;
```

### Q3: å¦‚ä½•ç›‘æ§é•¿æ—¶é—´è¿è¡Œçš„æŸ¥è¯¢ï¼Ÿ

**ç­”**: ä½¿ç”¨ pg_stat_activity ç›‘æ§æ´»åŠ¨æŸ¥è¯¢ã€‚

```sql
-- æŸ¥çœ‹è¿è¡Œæ—¶é—´è¶…è¿‡ 5 åˆ†é’Ÿçš„æŸ¥è¯¢
SELECT
    pid,
    usename,
    application_name,
    NOW() - query_start AS duration,
    state,
    query
FROM pg_stat_activity
WHERE state = 'active'
  AND NOW() - query_start > INTERVAL '5 minutes'
ORDER BY query_start;
```

### Q4: å¦‚ä½•åˆ†æç­‰å¾…äº‹ä»¶ï¼Ÿ

**ç­”**: ä½¿ç”¨ pg_stat_activity åˆ†æç­‰å¾…äº‹ä»¶ã€‚

```sql
-- æŸ¥çœ‹ç­‰å¾…äº‹ä»¶ç»Ÿè®¡
SELECT
    wait_event_type,
    wait_event,
    COUNT(*) AS count
FROM pg_stat_activity
WHERE wait_event IS NOT NULL
GROUP BY wait_event_type, wait_event
ORDER BY count DESC;
```

### Q5: å¦‚ä½•è¯Šæ–­æ…¢æŸ¥è¯¢ï¼Ÿ

**ç­”**: ç»“åˆ pg_stat_statements å’Œ EXPLAIN åˆ†æã€‚

```sql
-- 1. æŸ¥æ‰¾æ…¢æŸ¥è¯¢
SELECT
    query,
    calls,
    mean_exec_time,
    max_exec_time
FROM pg_stat_statements
WHERE mean_exec_time > 1000
ORDER BY mean_exec_time DESC
LIMIT 10;

-- 2. åˆ†ææ‰§è¡Œè®¡åˆ’
EXPLAIN (ANALYZE, BUFFERS, VERBOSE)
-- ç²˜è´´æ…¢æŸ¥è¯¢è¯­å¥
```

### Q6: å¦‚ä½•ç›‘æ§ VACUUM è¿›åº¦ï¼Ÿ

**ç­”**: ä½¿ç”¨ pg_stat_progress_vacuum è§†å›¾ã€‚

```sql
-- æŸ¥çœ‹ VACUUM è¿›åº¦
SELECT
    pid,
    phase,
    ROUND(100.0 * heap_blks_scanned / NULLIF(heap_blks_total, 0), 2) AS progress_pct,
    heap_blks_vacuumed,
    num_dead_tuples
FROM pg_stat_progress_vacuum;
```

### Q7: å¦‚ä½•è¯Šæ–­é”ç«äº‰é—®é¢˜ï¼Ÿ

**ç­”**: æŸ¥è¯¢ pg_locks å’Œ pg_stat_activityã€‚

```sql
-- æŸ¥çœ‹é”ç­‰å¾…
SELECT
    blocked_locks.pid AS blocked_pid,
    blocking_locks.pid AS blocking_pid,
    blocked_activity.query AS blocked_query,
    blocking_activity.query AS blocking_query
FROM pg_locks blocked_locks
JOIN pg_stat_activity blocked_activity ON blocked_activity.pid = blocked_locks.pid
JOIN pg_locks blocking_locks ON blocking_locks.locktype = blocked_locks.locktype
JOIN pg_stat_activity blocking_activity ON blocking_activity.pid = blocking_locks.pid
WHERE NOT blocked_locks.granted
  AND blocking_locks.pid != blocked_locks.pid;
```

### Q8: å¦‚ä½•é‡ç½®æ€§èƒ½ç»Ÿè®¡ä¿¡æ¯ï¼Ÿ

**ç­”**: ä½¿ç”¨ç›¸åº”çš„é‡ç½®å‡½æ•°ã€‚

```sql
-- é‡ç½® pg_stat_statements
SELECT pg_stat_statements_reset();

-- é‡ç½®ç‰¹å®šæ•°æ®åº“ç»Ÿè®¡
SELECT pg_stat_reset();

-- é‡ç½®ç‰¹å®šè¡¨ç»Ÿè®¡
SELECT pg_stat_reset_single_table_counters('table_name'::regclass);
```

## 9. æ•…éšœæ’æŸ¥æŒ‡å—

### 9.1 å¸¸è§é—®é¢˜è¯Šæ–­

**é—®é¢˜ 1: æŸ¥è¯¢æ€§èƒ½çªç„¶ä¸‹é™**:

**è¯Šæ–­æ­¥éª¤**ï¼š

```sql
-- 1. æ£€æŸ¥æ…¢æŸ¥è¯¢
SELECT
    query,
    calls,
    mean_exec_time,
    max_exec_time
FROM pg_stat_statements
WHERE mean_exec_time > 1000
ORDER BY mean_exec_time DESC
LIMIT 10;

-- 2. æ£€æŸ¥ç»Ÿè®¡ä¿¡æ¯æ˜¯å¦è¿‡æœŸ
SELECT
    schemaname,
    tablename,
    last_analyze,
    last_autoanalyze
FROM pg_stat_user_tables
WHERE last_analyze IS NULL
   OR last_analyze < NOW() - INTERVAL '7 days';

-- 3. æ£€æŸ¥ç´¢å¼•ä½¿ç”¨æƒ…å†µ
SELECT
    schemaname,
    tablename,
    idx_scan,
    seq_scan,
    CASE
        WHEN idx_scan + seq_scan > 0
        THEN ROUND(100.0 * idx_scan / (idx_scan + seq_scan), 2)
        ELSE 0
    END AS idx_scan_pct
FROM pg_stat_user_tables
WHERE seq_scan > 1000
ORDER BY seq_scan DESC;
```

**é—®é¢˜ 2: ç³»ç»Ÿè´Ÿè½½é«˜**:

**è¯Šæ–­æ­¥éª¤**ï¼š

```sql
-- 1. æ£€æŸ¥æ´»åŠ¨è¿æ¥æ•°
SELECT COUNT(*) FROM pg_stat_activity WHERE state != 'idle';

-- 2. æ£€æŸ¥ç­‰å¾…äº‹ä»¶
SELECT
    wait_event_type,
    wait_event,
    COUNT(*) AS count
FROM pg_stat_activity
WHERE wait_event IS NOT NULL
GROUP BY wait_event_type, wait_event
ORDER BY count DESC;

-- 3. æ£€æŸ¥é”ç«äº‰
SELECT COUNT(*) FROM pg_locks WHERE NOT granted;

-- 4. æ£€æŸ¥ I/O ç»Ÿè®¡
SELECT
    datname,
    blks_read,
    blks_hit,
    100.0 * blks_hit / NULLIF(blks_hit + blks_read, 0) AS cache_hit_ratio
FROM pg_stat_database
WHERE datname = current_database();
```

**é—®é¢˜ 3: å†…å­˜ä½¿ç”¨é«˜**:

**è¯Šæ–­æ­¥éª¤**ï¼š

```sql
-- 1. æ£€æŸ¥å…±äº«ç¼“å†²åŒºä½¿ç”¨
SELECT
    setting,
    unit
FROM pg_settings
WHERE name = 'shared_buffers';

-- 2. æ£€æŸ¥å·¥ä½œå†…å­˜ä½¿ç”¨
SELECT
    setting,
    unit
FROM pg_settings
WHERE name = 'work_mem';

-- 3. æ£€æŸ¥ä¸´æ—¶æ–‡ä»¶ä½¿ç”¨
SELECT
    datname,
    temp_files,
    temp_bytes
FROM pg_stat_database
WHERE datname = current_database();
```

### 9.2 æ€§èƒ½é—®é¢˜æ’æŸ¥æµç¨‹

**æ ‡å‡†æ’æŸ¥æµç¨‹**ï¼š

1. **æ”¶é›†æ€§èƒ½æŒ‡æ ‡**

   ```sql
   -- æ”¶é›†å…³é”®æŒ‡æ ‡
   SELECT * FROM pg_stat_statements ORDER BY total_exec_time DESC LIMIT 20;
   SELECT * FROM pg_stat_activity WHERE state != 'idle';
   SELECT * FROM pg_stat_progress_vacuum;
   ```

2. **è¯†åˆ«é—®é¢˜ç±»å‹**
   - æ…¢æŸ¥è¯¢ â†’ æŸ¥è¯¢ä¼˜åŒ–
   - èµ„æºç“¶é¢ˆ â†’ èµ„æºé…ç½®ä¼˜åŒ–
   - ç­‰å¾…äº‹ä»¶ â†’ é”ä¼˜åŒ–ã€I/O ä¼˜åŒ–

3. **åˆ†ææ‰§è¡Œè®¡åˆ’**

   ```sql
   EXPLAIN (ANALYZE, BUFFERS, VERBOSE) -- æŸ¥è¯¢è¯­å¥
   ```

4. **åˆ¶å®šä¼˜åŒ–æ–¹æ¡ˆ**
   - ç´¢å¼•ä¼˜åŒ–
   - æŸ¥è¯¢é‡å†™
   - é…ç½®è°ƒæ•´

5. **éªŒè¯ä¼˜åŒ–æ•ˆæœ**

   ```sql
   -- å¯¹æ¯”ä¼˜åŒ–å‰åçš„æ€§èƒ½æŒ‡æ ‡
   ```

### 9.3 è¯Šæ–­å·¥å…·ä½¿ç”¨æŠ€å·§

**æŠ€å·§ 1: å®šæœŸæ”¶é›†æ€§èƒ½å¿«ç…§**:

```sql
-- åˆ›å»ºæ€§èƒ½å¿«ç…§è¡¨
CREATE TABLE IF NOT EXISTS performance_snapshots (
    snapshot_time TIMESTAMPTZ DEFAULT NOW(),
    metric_name TEXT,
    metric_value NUMERIC
);

-- æ”¶é›†å¿«ç…§
INSERT INTO performance_snapshots (metric_name, metric_value)
SELECT
    'slow_queries',
    COUNT(*)::NUMERIC
FROM pg_stat_statements
WHERE mean_exec_time > 1000;
```

**æŠ€å·§ 2: ä½¿ç”¨è‡ªåŠ¨åŒ–è¯Šæ–­è„šæœ¬**:

```sql
-- åˆ›å»ºè‡ªåŠ¨åŒ–è¯Šæ–­å‡½æ•°
CREATE OR REPLACE FUNCTION auto_diagnose()
RETURNS TABLE (
    issue_type TEXT,
    issue_description TEXT,
    severity TEXT
) AS $$
BEGIN
    -- æ£€æŸ¥æ…¢æŸ¥è¯¢
    IF EXISTS (
        SELECT 1 FROM pg_stat_statements
        WHERE mean_exec_time > 5000
    ) THEN
        RETURN QUERY SELECT
            'slow_query'::TEXT,
            'å‘ç°æ‰§è¡Œæ—¶é—´è¶…è¿‡ 5 ç§’çš„æŸ¥è¯¢'::TEXT,
            'HIGH'::TEXT;
    END IF;

    -- æ£€æŸ¥é”ç­‰å¾…
    IF EXISTS (
        SELECT 1 FROM pg_locks WHERE NOT granted
    ) THEN
        RETURN QUERY SELECT
            'lock_wait'::TEXT,
            'å‘ç°é”ç­‰å¾…'::TEXT,
            'MEDIUM'::TEXT;
    END IF;

    -- æ£€æŸ¥ç»Ÿè®¡ä¿¡æ¯è¿‡æœŸ
    IF EXISTS (
        SELECT 1 FROM pg_stat_user_tables
        WHERE last_analyze IS NULL
           OR last_analyze < NOW() - INTERVAL '7 days'
    ) THEN
        RETURN QUERY SELECT
            'stale_stats'::TEXT,
            'å‘ç°ç»Ÿè®¡ä¿¡æ¯è¿‡æœŸ'::TEXT,
            'LOW'::TEXT;
    END IF;
END;
$$ LANGUAGE plpgsql;

-- æ‰§è¡Œè¯Šæ–­
SELECT * FROM auto_diagnose();
```

**æŠ€å·§ 3: æ€§èƒ½å¯¹æ¯”åˆ†æ**:

```sql
-- åˆ›å»ºæ€§èƒ½å¯¹æ¯”è§†å›¾
CREATE OR REPLACE VIEW performance_comparison AS
SELECT
    query,
    calls,
    mean_exec_time,
    max_exec_time,
    CASE
        WHEN mean_exec_time > 5000 THEN 'CRITICAL'
        WHEN mean_exec_time > 1000 THEN 'HIGH'
        WHEN mean_exec_time > 500 THEN 'MEDIUM'
        ELSE 'LOW'
    END AS severity
FROM pg_stat_statements
WHERE query NOT LIKE '%pg_stat_statements%'
ORDER BY mean_exec_time DESC;
```

## 10. æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•

**æŸ¥è¯¢ä¼˜åŒ–**ï¼š

- [ ] æ˜¯å¦åˆ†æäº†æ…¢æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ï¼Ÿ
- [ ] æ˜¯å¦åˆ›å»ºäº†å¿…è¦çš„ç´¢å¼•ï¼Ÿ
- [ ] æ˜¯å¦ä¼˜åŒ–äº†æŸ¥è¯¢è¯­å¥ï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨äº†åˆé€‚çš„ JOIN ç±»å‹ï¼Ÿ
- [ ] æ˜¯å¦é¿å…äº†å…¨è¡¨æ‰«æï¼Ÿ

**ç´¢å¼•ä¼˜åŒ–**ï¼š

- [ ] æ˜¯å¦ä¸ºå¸¸ç”¨æŸ¥è¯¢åˆ—åˆ›å»ºäº†ç´¢å¼•ï¼Ÿ
- [ ] æ˜¯å¦åˆ›å»ºäº†å¤åˆç´¢å¼•ï¼Ÿ
- [ ] æ˜¯å¦å®šæœŸç»´æŠ¤ç´¢å¼•ï¼ˆREINDEXï¼‰ï¼Ÿ
- [ ] æ˜¯å¦åˆ é™¤äº†æœªä½¿ç”¨çš„ç´¢å¼•ï¼Ÿ

**ç»Ÿè®¡ä¿¡æ¯**ï¼š

- [ ] æ˜¯å¦å®šæœŸæ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼ˆANALYZEï¼‰ï¼Ÿ
- [ ] ç»Ÿè®¡ä¿¡æ¯æ˜¯å¦å‡†ç¡®ï¼Ÿ
- [ ] æ˜¯å¦è®¾ç½®äº†åˆé€‚çš„ç»Ÿè®¡ä¿¡æ¯ç›®æ ‡ï¼Ÿ

**é…ç½®ä¼˜åŒ–**ï¼š

- [ ] æ˜¯å¦é…ç½®äº†åˆé€‚çš„ shared_buffersï¼Ÿ
- [ ] æ˜¯å¦é…ç½®äº†åˆé€‚çš„ work_memï¼Ÿ
- [ ] æ˜¯å¦é…ç½®äº†åˆé€‚çš„ max_connectionsï¼Ÿ
- [ ] æ˜¯å¦å¯ç”¨äº† pg_stat_statementsï¼Ÿ

**ç›‘æ§å’Œè¯Šæ–­**ï¼š

- [ ] æ˜¯å¦å¯ç”¨äº†æ€§èƒ½ç›‘æ§ï¼Ÿ
- [ ] æ˜¯å¦é…ç½®äº†æ€§èƒ½å‘Šè­¦ï¼Ÿ
- [ ] æ˜¯å¦å®šæœŸåˆ†ææ€§èƒ½æŒ‡æ ‡ï¼Ÿ
- [ ] æ˜¯å¦å»ºç«‹äº†è¯Šæ–­æµç¨‹ï¼Ÿ

**ç»´æŠ¤ä»»åŠ¡**ï¼š

- [ ] æ˜¯å¦å®šæœŸæ‰§è¡Œ VACUUMï¼Ÿ
- [ ] æ˜¯å¦å®šæœŸæ‰§è¡Œ ANALYZEï¼Ÿ
- [ ] æ˜¯å¦å®šæœŸæ£€æŸ¥è¡¨è†¨èƒ€ï¼Ÿ
- [ ] æ˜¯å¦å®šæœŸæ£€æŸ¥ç´¢å¼•ä½¿ç”¨æƒ…å†µï¼Ÿ

---

## ğŸ“Š æ€»ç»“

PostgreSQL 17 çš„æ€§èƒ½è¯Šæ–­æ”¹è¿›æ˜¾è‘—æå‡äº†æ€§èƒ½é—®é¢˜çš„å®šä½å’Œåˆ†æèƒ½åŠ›ï¼š

1. **æ–°è¯Šæ–­è§†å›¾**ï¼špg_stat_progress_vacuumã€pg_stat_progress_cluster ç­‰
2. **æŸ¥è¯¢è¿½è¸ªå¢å¼º**ï¼šæ›´è¯¦ç»†çš„æŸ¥è¯¢æ‰§è¡Œä¿¡æ¯
3. **æ€§èƒ½åˆ†æä¼˜åŒ–**ï¼šæ›´å‡†ç¡®çš„æ€§èƒ½åˆ†æç»“æœ
4. **è‡ªåŠ¨åŒ–è¯Šæ–­**ï¼šæ”¯æŒè‡ªåŠ¨åŒ–æ€§èƒ½è¯Šæ–­
5. **ç›‘æ§èƒ½åŠ›æå‡**ï¼šæ›´å…¨é¢çš„æ€§èƒ½ç›‘æ§

**æœ€ä½³å®è·µ**ï¼š

- å®šæœŸåˆ†ææŸ¥è¯¢ç»Ÿè®¡ä¿¡æ¯
- ä½¿ç”¨ EXPLAIN åˆ†ææ‰§è¡Œè®¡åˆ’
- ç›‘æ§ç­‰å¾…äº‹ä»¶å’Œèµ„æºä½¿ç”¨
- é…ç½®åˆç†çš„æ€§èƒ½å‘Šè­¦
- å»ºç«‹ç³»ç»ŸåŒ–çš„è¯Šæ–­æµç¨‹

---

## 11. å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - æ€§èƒ½è¯Šæ–­](https://www.postgresql.org/docs/current/performance-tips.html)**
  - æ€§èƒ½è¯Šæ–­å®Œæ•´æ•™ç¨‹
  - æ€§èƒ½ä¼˜åŒ–æŠ€å·§

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - EXPLAIN](https://www.postgresql.org/docs/current/sql-explain.html)**
  - EXPLAIN è¯­æ³•è¯´æ˜
  - æ‰§è¡Œè®¡åˆ’åˆ†æ

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - pg_stat_statements](https://www.postgresql.org/docs/current/pgstatstatements.html)**
  - pg_stat_statements æ‰©å±•æ–‡æ¡£
  - æŸ¥è¯¢æ€§èƒ½ç›‘æ§

- **[PostgreSQL 17 å‘å¸ƒè¯´æ˜](https://www.postgresql.org/about/news/postgresql-17-released-2781/)**
  - PostgreSQL 17 æ–°ç‰¹æ€§ä»‹ç»
  - æ€§èƒ½è¯Šæ–­æ”¹è¿›è¯´æ˜

### SQL æ ‡å‡†

- **ISO/IEC 9075:2016 - SQL æ ‡å‡†æ€§èƒ½è¯Šæ–­**
  - SQL æ ‡å‡†æ€§èƒ½è¯Šæ–­è§„èŒƒ
  - æ€§èƒ½è¯Šæ–­æ ‡å‡†è¯­æ³•

### æŠ€æœ¯è®ºæ–‡

- **Chaudhuri, S., et al. (2004). "Self-Tuning Database Systems: A Decade of Progress."**
  - ä¼šè®®: VLDB 2004
  - **é‡è¦æ€§**: æ•°æ®åº“è‡ªè°ƒä¼˜çš„åŸºç¡€ç ”ç©¶
  - **æ ¸å¿ƒè´¡çŒ®**: æ·±å…¥åˆ†æäº†æ•°æ®åº“æ€§èƒ½è¯Šæ–­å’Œè‡ªè°ƒä¼˜çš„æ–¹æ³•

- **Graefe, G. (1995). "The Cascades Framework for Query Optimization."**
  - æœŸåˆŠ: IEEE Data Engineering Bulletin, 18(3), 19-29
  - **é‡è¦æ€§**: æŸ¥è¯¢ä¼˜åŒ–å™¨æ¡†æ¶è®¾è®¡çš„åŸºç¡€ç ”ç©¶
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº† Cascades æŸ¥è¯¢ä¼˜åŒ–æ¡†æ¶ï¼Œå½±å“äº†ç°ä»£æ•°æ®åº“ä¼˜åŒ–å™¨çš„è®¾è®¡

### æŠ€æœ¯åšå®¢

- **[PostgreSQL å®˜æ–¹åšå®¢ - æ€§èƒ½è¯Šæ–­](https://www.postgresql.org/docs/current/performance-tips.html)**
  - æ€§èƒ½è¯Šæ–­æœ€ä½³å®è·µ
  - æ€§èƒ½ä¼˜åŒ–æŠ€å·§

- **[2ndQuadrant - PostgreSQL æ€§èƒ½è¯Šæ–­](https://www.2ndquadrant.com/en/blog/postgresql-performance-diagnosis/)**
  - æ€§èƒ½è¯Šæ–­å®æˆ˜
  - æ€§èƒ½ä¼˜åŒ–æ¡ˆä¾‹

- **[Percona - PostgreSQL æ€§èƒ½è¯Šæ–­](https://www.percona.com/blog/postgresql-performance-diagnosis/)**
  - æ€§èƒ½è¯Šæ–­ä½¿ç”¨æŠ€å·§
  - æ€§èƒ½ä¼˜åŒ–å»ºè®®

- **[EnterpriseDB - PostgreSQL æ€§èƒ½è¯Šæ–­](https://www.enterprisedb.com/postgres-tutorials/postgresql-performance-diagnosis-tutorial)**
  - æ€§èƒ½è¯Šæ–­æ·±å…¥è§£æ
  - å®é™…åº”ç”¨æ¡ˆä¾‹

### ç¤¾åŒºèµ„æº

- **[PostgreSQL Wiki - æ€§èƒ½è¯Šæ–­](https://wiki.postgresql.org/wiki/Performance_Diagnosis)**
  - æ€§èƒ½è¯Šæ–­æŠ€å·§
  - å®é™…åº”ç”¨æ¡ˆä¾‹

- **[Stack Overflow - PostgreSQL æ€§èƒ½è¯Šæ–­](https://stackoverflow.com/questions/tagged/postgresql+performance-diagnosis)**
  - æ€§èƒ½è¯Šæ–­é—®ç­”
  - å¸¸è§é—®é¢˜è§£ç­”

### ç›¸å…³æ–‡æ¡£

- [æ€§èƒ½è°ƒä¼˜æ·±å…¥](../../11-æ€§èƒ½è°ƒä¼˜/æ€§èƒ½è°ƒä¼˜æ·±å…¥.md)
- [ç›‘æ§å·¥å…·å¢å¼º](./ç›‘æ§å·¥å…·å¢å¼º.md)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 1 æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
