# PostgreSQL æ•°æ®åº“è®¾è®¡æœ€ä½³å®è·µ

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+
> **æ–‡æ¡£ç¼–å·**: 03-03-10

## ğŸ“‘ ç›®å½•

- [PostgreSQL æ•°æ®åº“è®¾è®¡æœ€ä½³å®è·µ](#postgresql-æ•°æ®åº“è®¾è®¡æœ€ä½³å®è·µ)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 æŠ€æœ¯èƒŒæ™¯](#11-æŠ€æœ¯èƒŒæ™¯)
    - [1.2 è®¾è®¡åŸåˆ™](#12-è®¾è®¡åŸåˆ™)
    - [1.3 æ•°æ®åº“è®¾è®¡ä½“ç³»æ€ç»´å¯¼å›¾](#13-æ•°æ®åº“è®¾è®¡ä½“ç³»æ€ç»´å¯¼å›¾)
  - [2. è§„èŒƒåŒ–è®¾è®¡](#2-è§„èŒƒåŒ–è®¾è®¡)
    - [2.1 ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰](#21-ç¬¬ä¸€èŒƒå¼1nf)
    - [2.2 ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰](#22-ç¬¬äºŒèŒƒå¼2nf)
    - [2.3 ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰](#23-ç¬¬ä¸‰èŒƒå¼3nf)
    - [2.4 åè§„èŒƒåŒ–ï¼ˆDenormalizationï¼‰](#24-åè§„èŒƒåŒ–denormalization)
  - [3. ç´¢å¼•è®¾è®¡åŸåˆ™](#3-ç´¢å¼•è®¾è®¡åŸåˆ™)
    - [3.1 ç´¢å¼•è®¾è®¡æœ€ä½³å®è·µ](#31-ç´¢å¼•è®¾è®¡æœ€ä½³å®è·µ)
  - [4. å‘½åè§„èŒƒ](#4-å‘½åè§„èŒƒ)
    - [4.1 å‘½åè§„èŒƒæœ€ä½³å®è·µ](#41-å‘½åè§„èŒƒæœ€ä½³å®è·µ)
  - [5. æ•°æ®ç±»å‹é€‰æ‹©](#5-æ•°æ®ç±»å‹é€‰æ‹©)
    - [5.1 æ•°æ®ç±»å‹é€‰æ‹©æŒ‡å—](#51-æ•°æ®ç±»å‹é€‰æ‹©æŒ‡å—)
    - [5.2 çº¦æŸè®¾è®¡](#52-çº¦æŸè®¾è®¡)
  - [6. å®é™…åº”ç”¨æ¡ˆä¾‹](#6-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [6.1 æ¡ˆä¾‹: ç”µå•†ç³»ç»Ÿæ•°æ®åº“è®¾è®¡ï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰](#61-æ¡ˆä¾‹-ç”µå•†ç³»ç»Ÿæ•°æ®åº“è®¾è®¡çœŸå®æ¡ˆä¾‹)
  - [7. å®è·µç»ƒä¹ ](#7-å®è·µç»ƒä¹ )
    - [ç»ƒä¹  1: è®¾è®¡æ•°æ®åº“](#ç»ƒä¹ -1-è®¾è®¡æ•°æ®åº“)
  - [8. æœ€ä½³å®è·µæ€»ç»“](#8-æœ€ä½³å®è·µæ€»ç»“)
    - [8.1 è®¾è®¡åŸåˆ™](#81-è®¾è®¡åŸåˆ™)
    - [8.2 å¸¸è§é”™è¯¯](#82-å¸¸è§é”™è¯¯)
  - [9. å‚è€ƒèµ„æ–™](#9-å‚è€ƒèµ„æ–™)

---

## 1. æ¦‚è¿°

### 1.1 æŠ€æœ¯èƒŒæ™¯

**æ•°æ®åº“è®¾è®¡çš„é‡è¦æ€§**:

è‰¯å¥½çš„æ•°æ®åº“è®¾è®¡æ˜¯ç³»ç»ŸæˆåŠŸçš„åŸºç¡€ï¼Œç›´æ¥å½±å“ï¼š

1. **æ€§èƒ½**: åˆç†çš„è¡¨ç»“æ„å’Œç´¢å¼•è®¾è®¡æå‡æŸ¥è¯¢æ€§èƒ½
2. **å¯ç»´æŠ¤æ€§**: è§„èŒƒåŒ–çš„è®¾è®¡ä¾¿äºç»´æŠ¤å’Œæ‰©å±•
3. **æ•°æ®å®Œæ•´æ€§**: é€‚å½“çš„çº¦æŸä¿è¯æ•°æ®è´¨é‡
4. **å¼€å‘æ•ˆç‡**: æ¸…æ™°çš„è®¾è®¡æé«˜å¼€å‘æ•ˆç‡

**æ ¸å¿ƒä»·å€¼** (åŸºäºå®é™…åº”ç”¨æ•°æ®):

| ä»·å€¼é¡¹ | è¯´æ˜ | å½±å“ |
|--------|------|------|
| **æŸ¥è¯¢æ€§èƒ½** | åˆç†è®¾è®¡æå‡æ€§èƒ½ | **2-10x** |
| **å­˜å‚¨ç©ºé—´** | è§„èŒƒåŒ–å‡å°‘å†—ä½™ | **èŠ‚çœ 30-50%** |
| **ç»´æŠ¤æˆæœ¬** | è§„èŒƒè®¾è®¡é™ä½ç»´æŠ¤æˆæœ¬ | **é™ä½ 40%** |
| **å¼€å‘æ•ˆç‡** | æ¸…æ™°è®¾è®¡æé«˜æ•ˆç‡ | **æå‡ 30%** |

### 1.2 è®¾è®¡åŸåˆ™

1. **è§„èŒƒåŒ–**: éµå¾ªæ•°æ®åº“èŒƒå¼ï¼Œå‡å°‘æ•°æ®å†—ä½™
2. **æ€§èƒ½ä¼˜åŒ–**: å¹³è¡¡è§„èŒƒåŒ–å’Œæ€§èƒ½éœ€æ±‚
3. **å¯æ‰©å±•æ€§**: è®¾è®¡æ—¶è€ƒè™‘æœªæ¥æ‰©å±•éœ€æ±‚
4. **å‘½åè§„èŒƒ**: ä½¿ç”¨ç»Ÿä¸€çš„å‘½åè§„èŒƒ

### 1.3 æ•°æ®åº“è®¾è®¡ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((æ•°æ®åº“è®¾è®¡ä½“ç³»))
    è§„èŒƒåŒ–è®¾è®¡
      ç¬¬ä¸€èŒƒå¼
        åŸå­å€¼
        æ¶ˆé™¤é‡å¤
        å­—æ®µè§„èŒƒ
      ç¬¬äºŒèŒƒå¼
        æ¶ˆé™¤éƒ¨åˆ†ä¾èµ–
        å®Œå…¨ä¾èµ–
        ä¸»é”®è§„èŒƒ
      ç¬¬ä¸‰èŒƒå¼
        æ¶ˆé™¤ä¼ é€’ä¾èµ–
        ç‹¬ç«‹è¡¨
        å…³ç³»è§„èŒƒ
      åè§„èŒƒåŒ–
        æ€§èƒ½ä¼˜åŒ–
        é€‚åº¦å†—ä½™
        å¹³è¡¡è®¾è®¡
    ç´¢å¼•è®¾è®¡
      ç´¢å¼•ç±»å‹
        B-treeç´¢å¼•
        Hashç´¢å¼•
        GiSTç´¢å¼•
        GINç´¢å¼•
        BRINç´¢å¼•
      ç´¢å¼•ç­–ç•¥
        ä¸»é”®ç´¢å¼•
        å¤–é”®ç´¢å¼•
        æŸ¥è¯¢ç´¢å¼•
        è¦†ç›–ç´¢å¼•
      ç´¢å¼•ä¼˜åŒ–
        ç´¢å¼•é€‰æ‹©
        ç´¢å¼•ç»´æŠ¤
        ç´¢å¼•ç›‘æ§
    å‘½åè§„èŒƒ
      è¡¨å‘½å
        å¤æ•°å½¢å¼
        ä¸‹åˆ’çº¿åˆ†éš”
        è¯­ä¹‰æ¸…æ™°
      åˆ—å‘½å
        å°å†™å­—æ¯
        ä¸‹åˆ’çº¿åˆ†éš”
        è¯­ä¹‰æ˜ç¡®
      ç´¢å¼•å‘½å
        idx_è¡¨å_åˆ—å
        å”¯ä¸€ç´¢å¼•
        å¤åˆç´¢å¼•
    æ•°æ®ç±»å‹
      ç±»å‹é€‰æ‹©
        åˆé€‚ç±»å‹
        æ€§èƒ½è€ƒè™‘
        å­˜å‚¨ä¼˜åŒ–
      çº¦æŸè®¾è®¡
        ä¸»é”®çº¦æŸ
        å¤–é”®çº¦æŸ
        å”¯ä¸€çº¦æŸ
        æ£€æŸ¥çº¦æŸ
      é»˜è®¤å€¼
        é»˜è®¤å€¼è®¾ç½®
        NOT NULL
        æ•°æ®å®Œæ•´æ€§
    æ€§èƒ½è®¾è®¡
      åˆ†åŒºè®¾è®¡
        è¡¨åˆ†åŒº
        ç´¢å¼•åˆ†åŒº
        æŸ¥è¯¢ä¼˜åŒ–
      ç‰©åŒ–è§†å›¾
        é¢„è®¡ç®—
        æ€§èƒ½ä¼˜åŒ–
        æ•°æ®åŒæ­¥
      æŸ¥è¯¢ä¼˜åŒ–
        æŸ¥è¯¢è®¾è®¡
        ç´¢å¼•ä½¿ç”¨
        ç»Ÿè®¡ä¿¡æ¯
```

## 2. è§„èŒƒåŒ–è®¾è®¡

### 2.1 ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰

```sql
-- ä¸å¥½ï¼šåœ°å€å­—æ®µåŒ…å«å¤šä¸ªå€¼
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name TEXT,
    addresses TEXT  -- åŒ…å«å¤šä¸ªåœ°å€
);

-- å¥½ï¼šæ¯ä¸ªå­—æ®µéƒ½æ˜¯åŸå­å€¼
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name TEXT
);

CREATE TABLE addresses (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    address TEXT
);
```

### 2.2 ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰

```sql
-- ä¸å¥½ï¼šéƒ¨åˆ†ä¾èµ–
CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    user_id INTEGER,
    user_name TEXT,  -- ä¾èµ–äº user_idï¼Œä¸æ˜¯ä¸»é”®
    product_id INTEGER,
    product_name TEXT,  -- ä¾èµ–äº product_idï¼Œä¸æ˜¯ä¸»é”®
    quantity INTEGER
);

-- å¥½ï¼šæ¶ˆé™¤éƒ¨åˆ†ä¾èµ–
CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    product_id INTEGER REFERENCES products(id),
    quantity INTEGER
);
```

### 2.3 ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰

```sql
-- ä¸å¥½ï¼šä¼ é€’ä¾èµ–
CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    name TEXT,
    department_id INTEGER,
    department_name TEXT,  -- ä¾èµ–äº department_idï¼Œä¼ é€’ä¾èµ–
    manager_id INTEGER
);

-- å¥½ï¼šæ¶ˆé™¤ä¼ é€’ä¾èµ–
CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    name TEXT,
    department_id INTEGER REFERENCES departments(id),
    manager_id INTEGER REFERENCES employees(id)
);

CREATE TABLE departments (
    id SERIAL PRIMARY KEY,
    name TEXT
);
```

### 2.4 åè§„èŒƒåŒ–ï¼ˆDenormalizationï¼‰

**ä½•æ—¶åè§„èŒƒåŒ–**:

åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œå¯ä»¥é€‚åº¦åè§„èŒƒåŒ–ï¼š

1. **è¯»å¤šå†™å°‘**: è¯»æ“ä½œè¿œå¤šäºå†™æ“ä½œ
2. **æ€§èƒ½ç“¶é¢ˆ**: è§„èŒƒåŒ–å¯¼è‡´æ€§èƒ½é—®é¢˜
3. **æ•°æ®ä¸€è‡´æ€§**: å¯ä»¥æ¥å—ä¸€å®šç¨‹åº¦çš„æ•°æ®å†—ä½™

**åè§„èŒƒåŒ–ç¤ºä¾‹**:

```sql
-- é€‚åº¦åè§„èŒƒåŒ–ï¼šåœ¨è®¢å•è¡¨ä¸­å†—ä½™ç”¨æˆ·åç§°
CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    user_name TEXT,  -- å†—ä½™å­—æ®µï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½
    total_amount DECIMAL(10, 2),
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ä½¿ç”¨è§¦å‘å™¨ä¿æŒæ•°æ®ä¸€è‡´æ€§
CREATE OR REPLACE FUNCTION update_order_user_name()
RETURNS TRIGGER AS $$
BEGIN
    UPDATE orders
    SET user_name = NEW.name
    WHERE user_id = NEW.id;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER sync_user_name
AFTER UPDATE OF name ON users
FOR EACH ROW
EXECUTE FUNCTION update_order_user_name();
```

## 3. ç´¢å¼•è®¾è®¡åŸåˆ™

```sql
-- 1. ä¸»é”®è‡ªåŠ¨åˆ›å»ºç´¢å¼•
CREATE TABLE users (
    id SERIAL PRIMARY KEY  -- è‡ªåŠ¨åˆ›å»ºä¸»é”®ç´¢å¼•
);

-- 2. å¤–é”®åˆ—åˆ›å»ºç´¢å¼•
CREATE INDEX idx_orders_user_id ON orders(user_id);

-- 3. é¢‘ç¹æŸ¥è¯¢çš„åˆ—åˆ›å»ºç´¢å¼•
CREATE INDEX idx_users_email ON users(email);

-- 4. å¤åˆç´¢å¼•çš„é¡ºåºå¾ˆé‡è¦
CREATE INDEX idx_orders_status_date ON orders(status, created_at);

-- 5. è¦†ç›–ç´¢å¼•
CREATE INDEX idx_users_covering ON users(email) INCLUDE (name, age);

-- 6. éƒ¨åˆ†ç´¢å¼•
CREATE INDEX idx_active_users ON users(email) WHERE is_active = TRUE;
```

### 3.1 ç´¢å¼•è®¾è®¡æœ€ä½³å®è·µ

**ç´¢å¼•é€‰æ‹©æŒ‡å—**:

| åœºæ™¯ | ç´¢å¼•ç±»å‹ | è¯´æ˜ |
|------|---------|------|
| **ä¸»é”®** | B-tree | è‡ªåŠ¨åˆ›å»º |
| **å¤–é”®** | B-tree | æé«˜ JOIN æ€§èƒ½ |
| **ç­‰å€¼æŸ¥è¯¢** | B-tree | æ ‡å‡†ç´¢å¼• |
| **èŒƒå›´æŸ¥è¯¢** | B-tree | æ”¯æŒèŒƒå›´æ‰«æ |
| **å…¨æ–‡æœç´¢** | GIN | æ–‡æœ¬æœç´¢ |
| **æ•°ç»„æŸ¥è¯¢** | GIN | æ•°ç»„æ“ä½œ |
| **JSONB æŸ¥è¯¢** | GIN | JSONB æ“ä½œ |
| **å¤§è¡¨èŒƒå›´æŸ¥è¯¢** | BRIN | èŠ‚çœç©ºé—´ |

**ç´¢å¼•è®¾è®¡æ³¨æ„äº‹é¡¹**:

1. **ä¸è¦è¿‡åº¦ç´¢å¼•**: ç´¢å¼•è¿‡å¤šå½±å“å†™å…¥æ€§èƒ½
2. **å¤åˆç´¢å¼•é¡ºåº**: æœ€å¸¸ç”¨çš„åˆ—æ”¾åœ¨å‰é¢
3. **éƒ¨åˆ†ç´¢å¼•**: åªå¯¹éƒ¨åˆ†æ•°æ®åˆ›å»ºç´¢å¼•
4. **è¦†ç›–ç´¢å¼•**: ä½¿ç”¨ INCLUDE åˆ›å»ºè¦†ç›–ç´¢å¼•

## 4. å‘½åè§„èŒƒ

```sql
-- è¡¨åï¼šå¤æ•°å½¢å¼ï¼Œå°å†™ï¼Œä¸‹åˆ’çº¿åˆ†éš”
CREATE TABLE users (...);
CREATE TABLE order_items (...);

-- åˆ—åï¼šå°å†™ï¼Œä¸‹åˆ’çº¿åˆ†éš”
CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    user_name TEXT,
    created_at TIMESTAMP
);

-- ç´¢å¼•åï¼šidx_è¡¨å_åˆ—å
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_orders_user_id ON orders(user_id);

-- çº¦æŸåï¼šè¡¨å_åˆ—å_çº¦æŸç±»å‹
ALTER TABLE users ADD CONSTRAINT users_email_unique UNIQUE (email);
```

### 4.1 å‘½åè§„èŒƒæœ€ä½³å®è·µ

**å‘½åè§„èŒƒè¡¨**:

| å¯¹è±¡ç±»å‹ | å‘½åè§„èŒƒ | ç¤ºä¾‹ |
|---------|---------|------|
| **è¡¨å** | å¤æ•°å½¢å¼ï¼Œå°å†™ï¼Œä¸‹åˆ’çº¿ | `users`, `order_items` |
| **åˆ—å** | å°å†™ï¼Œä¸‹åˆ’çº¿ | `user_id`, `created_at` |
| **ç´¢å¼•å** | `idx_è¡¨å_åˆ—å` | `idx_users_email` |
| **çº¦æŸå** | `è¡¨å_åˆ—å_çº¦æŸç±»å‹` | `users_email_unique` |
| **å‡½æ•°å** | å°å†™ï¼Œä¸‹åˆ’çº¿ | `calculate_total` |
| **è§†å›¾å** | `v_è¡¨å` æˆ–æè¿°æ€§åç§° | `v_user_summary` |

## 5. æ•°æ®ç±»å‹é€‰æ‹©

### 5.1 æ•°æ®ç±»å‹é€‰æ‹©æŒ‡å—

**æ•°æ®ç±»å‹é€‰æ‹©è¡¨**:

| åœºæ™¯ | æ¨èç±»å‹ | è¯´æ˜ |
|------|---------|------|
| **ä¸»é”®** | SERIAL/BIGSERIAL | è‡ªå¢æ•´æ•° |
| **å¤–é”®** | INTEGER/BIGINT | ä¸ä¸»é”®ç±»å‹ä¸€è‡´ |
| **é‡‘é¢** | DECIMAL(10,2) | ç²¾ç¡®æ•°å€¼ |
| **æ–‡æœ¬** | TEXT | æ— é™é•¿åº¦ |
| **æ—¶é—´æˆ³** | TIMESTAMPTZ | å¸¦æ—¶åŒº |
| **å¸ƒå°”å€¼** | BOOLEAN | TRUE/FALSE |
| **JSON æ•°æ®** | JSONB | äºŒè¿›åˆ¶ JSON |
| **UUID** | UUID | å”¯ä¸€æ ‡è¯†ç¬¦ |

### 5.2 çº¦æŸè®¾è®¡

**çº¦æŸç±»å‹**:

```sql
-- ä¸»é”®çº¦æŸ
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email TEXT UNIQUE NOT NULL
);

-- å¤–é”®çº¦æŸ
CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id) ON DELETE CASCADE
);

-- æ£€æŸ¥çº¦æŸ
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    price DECIMAL(10, 2) CHECK (price > 0),
    stock INTEGER CHECK (stock >= 0)
);

-- éç©ºçº¦æŸ
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    email TEXT NOT NULL
);
```

## 6. å®é™…åº”ç”¨æ¡ˆä¾‹

### 6.1 æ¡ˆä¾‹: ç”µå•†ç³»ç»Ÿæ•°æ®åº“è®¾è®¡ï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

è®¾è®¡ä¸€ä¸ªç”µå•†ç³»ç»Ÿçš„æ•°æ®åº“ï¼ŒåŒ…å«ç”¨æˆ·ã€å•†å“ã€è®¢å•ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

**è®¾è®¡è¦ç‚¹**:

1. **è§„èŒƒåŒ–è®¾è®¡**: éµå¾ª 3NFï¼Œå‡å°‘æ•°æ®å†—ä½™
2. **æ€§èƒ½ä¼˜åŒ–**: åˆç†è®¾è®¡ç´¢å¼•ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½
3. **æ‰©å±•æ€§**: è€ƒè™‘æœªæ¥æ‰©å±•éœ€æ±‚

**æ•°æ®åº“è®¾è®¡**:

```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email TEXT UNIQUE NOT NULL,
    name TEXT NOT NULL,
    password_hash TEXT NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- å•†å“è¡¨
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    description TEXT,
    price DECIMAL(10, 2) NOT NULL CHECK (price > 0),
    stock INTEGER DEFAULT 0 CHECK (stock >= 0),
    category_id INTEGER REFERENCES categories(id),
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- è®¢å•è¡¨
CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
    total_amount DECIMAL(10, 2) NOT NULL,
    status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'paid', 'shipped', 'delivered', 'cancelled')),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- è®¢å•é¡¹è¡¨
CREATE TABLE order_items (
    id SERIAL PRIMARY KEY,
    order_id INTEGER REFERENCES orders(id) ON DELETE CASCADE,
    product_id INTEGER REFERENCES products(id),
    quantity INTEGER NOT NULL CHECK (quantity > 0),
    price DECIMAL(10, 2) NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_orders_user_id ON orders(user_id);
CREATE INDEX idx_orders_status ON orders(status);
CREATE INDEX idx_orders_created_at ON orders(created_at);
CREATE INDEX idx_order_items_order_id ON order_items(order_id);
CREATE INDEX idx_order_items_product_id ON order_items(product_id);
CREATE INDEX idx_products_category_id ON products(category_id);
```

**è®¾è®¡æ•ˆæœ**:

| æŒ‡æ ‡ | æ•ˆæœ |
|------|------|
| **æŸ¥è¯¢æ€§èƒ½** | ç´¢å¼•ä¼˜åŒ–ï¼ŒæŸ¥è¯¢å¿«é€Ÿ |
| **æ•°æ®å®Œæ•´æ€§** | çº¦æŸä¿è¯æ•°æ®è´¨é‡ |
| **å¯ç»´æŠ¤æ€§** | è§„èŒƒåŒ–è®¾è®¡ï¼Œæ˜“äºç»´æŠ¤ |
| **æ‰©å±•æ€§** | ç»“æ„æ¸…æ™°ï¼Œæ˜“äºæ‰©å±• |

## 7. å®è·µç»ƒä¹ 

### ç»ƒä¹  1: è®¾è®¡æ•°æ®åº“

```sql
-- ä»»åŠ¡: è®¾è®¡ä¸€ä¸ªç”µå•†ç³»ç»Ÿçš„æ•°æ®åº“
-- åŒ…å«ï¼šç”¨æˆ·ã€å•†å“ã€è®¢å•ã€è®¢å•é¡¹è¡¨
-- è¦æ±‚ï¼šç¬¦åˆ 3NFï¼ŒåŒ…å«é€‚å½“çš„ç´¢å¼•

CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email TEXT UNIQUE NOT NULL,
    name TEXT NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    stock INTEGER DEFAULT 0,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    total_amount DECIMAL(10, 2),
    status TEXT DEFAULT 'pending',
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE order_items (
    id SERIAL PRIMARY KEY,
    order_id INTEGER REFERENCES orders(id),
    product_id INTEGER REFERENCES products(id),
    quantity INTEGER NOT NULL,
    price DECIMAL(10, 2) NOT NULL
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_orders_user_id ON orders(user_id);
CREATE INDEX idx_orders_status ON orders(status);
CREATE INDEX idx_order_items_order_id ON order_items(order_id);
CREATE INDEX idx_order_items_product_id ON order_items(product_id);
```

## 8. æœ€ä½³å®è·µæ€»ç»“

### 8.1 è®¾è®¡åŸåˆ™

1. **è§„èŒƒåŒ–ä¼˜å…ˆ**: ä¼˜å…ˆè€ƒè™‘è§„èŒƒåŒ–ï¼Œå¿…è¦æ—¶é€‚åº¦åè§„èŒƒåŒ–
2. **æ€§èƒ½å¹³è¡¡**: å¹³è¡¡è§„èŒƒåŒ–å’Œæ€§èƒ½éœ€æ±‚
3. **å‘½åè§„èŒƒ**: ä½¿ç”¨ç»Ÿä¸€çš„å‘½åè§„èŒƒ
4. **çº¦æŸè®¾è®¡**: ä½¿ç”¨é€‚å½“çš„çº¦æŸä¿è¯æ•°æ®å®Œæ•´æ€§

### 8.2 å¸¸è§é”™è¯¯

1. **è¿‡åº¦è§„èŒƒåŒ–**: å¯¼è‡´æŸ¥è¯¢æ€§èƒ½å·®
2. **ç¼ºå°‘ç´¢å¼•**: å¤–é”®å’Œå¸¸ç”¨æŸ¥è¯¢åˆ—ç¼ºå°‘ç´¢å¼•
3. **å‘½åä¸è§„èŒƒ**: å¯¼è‡´ç»´æŠ¤å›°éš¾
4. **ç¼ºå°‘çº¦æŸ**: æ•°æ®å®Œæ•´æ€§æ— æ³•ä¿è¯

## 9. å‚è€ƒèµ„æ–™

- [PostgreSQL å®˜æ–¹æ–‡æ¡£ - æ•°æ®åº“è®¾è®¡](https://www.postgresql.org/docs/current/ddl.html)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 03-03-10
