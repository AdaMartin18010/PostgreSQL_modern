# PostgreSQL é«˜çº§ SQL ç‰¹æ€§

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 17+/18+
> **æ–‡æ¡£ç¼–å·**: 03-03-06

## ğŸ“‘ ç›®å½•

- [PostgreSQL é«˜çº§ SQL ç‰¹æ€§](#postgresql-é«˜çº§-sql-ç‰¹æ€§)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.0 é«˜çº§ SQL ç‰¹æ€§å·¥ä½œåŸç†æ¦‚è¿°](#10-é«˜çº§-sql-ç‰¹æ€§å·¥ä½œåŸç†æ¦‚è¿°)
    - [1.1 æŠ€æœ¯èƒŒæ™¯](#11-æŠ€æœ¯èƒŒæ™¯)
    - [1.2 å­¦ä¹ ç›®æ ‡](#12-å­¦ä¹ ç›®æ ‡)
  - [2. é«˜çº§SQLç‰¹æ€§å½¢å¼åŒ–å®šä¹‰](#2-é«˜çº§sqlç‰¹æ€§å½¢å¼åŒ–å®šä¹‰)
    - [2.0 é«˜çº§SQLç‰¹æ€§å½¢å¼åŒ–å®šä¹‰](#20-é«˜çº§sqlç‰¹æ€§å½¢å¼åŒ–å®šä¹‰)
    - [2.1 é«˜çº§SQLç‰¹æ€§é€‰æ‹©å¯¹æ¯”çŸ©é˜µ](#21-é«˜çº§sqlç‰¹æ€§é€‰æ‹©å¯¹æ¯”çŸ©é˜µ)
  - [3. çª—å£å‡½æ•°](#3-çª—å£å‡½æ•°)
    - [2.1 æ’åå‡½æ•°](#21-æ’åå‡½æ•°)
    - [2.2 åˆ†åŒºçª—å£å‡½æ•°](#22-åˆ†åŒºçª—å£å‡½æ•°)
    - [2.3 èšåˆçª—å£å‡½æ•°](#23-èšåˆçª—å£å‡½æ•°)
    - [2.4 LAG å’Œ LEAD](#24-lag-å’Œ-lead)
    - [2.5 çª—å£å‡½æ•°æ€§èƒ½ä¼˜åŒ–](#25-çª—å£å‡½æ•°æ€§èƒ½ä¼˜åŒ–)
  - [4. CTEï¼ˆå…¬ç”¨è¡¨è¡¨è¾¾å¼ï¼‰](#4-cteå…¬ç”¨è¡¨è¡¨è¾¾å¼)
    - [3.1 ç®€å• CTE](#31-ç®€å•-cte)
    - [3.2 é€’å½’ CTE](#32-é€’å½’-cte)
    - [3.3 CTE æ€§èƒ½ä¼˜åŒ–](#33-cte-æ€§èƒ½ä¼˜åŒ–)
  - [5. é«˜çº§æŸ¥è¯¢æŠ€å·§](#5-é«˜çº§æŸ¥è¯¢æŠ€å·§)
    - [4.1 CASE è¡¨è¾¾å¼](#41-case-è¡¨è¾¾å¼)
    - [4.2 FILTER å­å¥](#42-filter-å­å¥)
    - [4.3 LATERAL JOIN](#43-lateral-join)
  - [6. å®é™…åº”ç”¨æ¡ˆä¾‹](#6-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [6.1 æ¡ˆä¾‹: ç”µå•†å¹³å°é”€å”®åˆ†æï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰](#61-æ¡ˆä¾‹-ç”µå•†å¹³å°é”€å”®åˆ†æçœŸå®æ¡ˆä¾‹)
  - [7. å®è·µç»ƒä¹ ](#7-å®è·µç»ƒä¹ )
    - [ç»ƒä¹  1: ä½¿ç”¨çª—å£å‡½æ•°](#ç»ƒä¹ -1-ä½¿ç”¨çª—å£å‡½æ•°)
    - [ç»ƒä¹  2: ä½¿ç”¨é€’å½’ CTE](#ç»ƒä¹ -2-ä½¿ç”¨é€’å½’-cte)
  - [8. æœ€ä½³å®è·µ](#8-æœ€ä½³å®è·µ)
    - [7.1 çª—å£å‡½æ•°æœ€ä½³å®è·µ](#71-çª—å£å‡½æ•°æœ€ä½³å®è·µ)
    - [7.2 CTE æœ€ä½³å®è·µ](#72-cte-æœ€ä½³å®è·µ)
    - [7.3 é€’å½’æŸ¥è¯¢æœ€ä½³å®è·µ](#73-é€’å½’æŸ¥è¯¢æœ€ä½³å®è·µ)
  - [9. å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰](#9-å¸¸è§é—®é¢˜faq)
    - [9.1 é«˜çº§SQLç‰¹æ€§åŸºç¡€å¸¸è§é—®é¢˜](#91-é«˜çº§sqlç‰¹æ€§åŸºç¡€å¸¸è§é—®é¢˜)
      - [Q1: é«˜çº§SQLç‰¹æ€§æœ‰å“ªäº›ï¼Ÿå¦‚ä½•é€‰æ‹©ï¼Ÿ](#q1-é«˜çº§sqlç‰¹æ€§æœ‰å“ªäº›å¦‚ä½•é€‰æ‹©)
      - [Q2: é«˜çº§SQLç‰¹æ€§çš„æ€§èƒ½å¦‚ä½•ï¼Ÿ](#q2-é«˜çº§sqlç‰¹æ€§çš„æ€§èƒ½å¦‚ä½•)
    - [9.2 çª—å£å‡½æ•°å¸¸è§é—®é¢˜](#92-çª—å£å‡½æ•°å¸¸è§é—®é¢˜)
      - [Q3: çª—å£å‡½æ•°å’Œèšåˆå‡½æ•°çš„åŒºåˆ«ï¼Ÿ](#q3-çª—å£å‡½æ•°å’Œèšåˆå‡½æ•°çš„åŒºåˆ«)
      - [Q4: å¦‚ä½•ä¼˜åŒ–çª—å£å‡½æ•°æ€§èƒ½ï¼Ÿ](#q4-å¦‚ä½•ä¼˜åŒ–çª—å£å‡½æ•°æ€§èƒ½)
    - [9.3 CTEå¸¸è§é—®é¢˜](#93-cteå¸¸è§é—®é¢˜)
      - [Q5: CTEå’Œå­æŸ¥è¯¢çš„åŒºåˆ«ï¼Ÿ](#q5-cteå’Œå­æŸ¥è¯¢çš„åŒºåˆ«)
      - [Q6: CTEä¼šè¢«ç‰©åŒ–å—ï¼Ÿå¦‚ä½•æ§åˆ¶ï¼Ÿ](#q6-cteä¼šè¢«ç‰©åŒ–å—å¦‚ä½•æ§åˆ¶)
    - [9.4 é«˜çº§æŸ¥è¯¢æŠ€å·§å¸¸è§é—®é¢˜](#94-é«˜çº§æŸ¥è¯¢æŠ€å·§å¸¸è§é—®é¢˜)
      - [Q7: LATERAL JOINå’Œå­æŸ¥è¯¢çš„åŒºåˆ«ï¼Ÿ](#q7-lateral-joinå’Œå­æŸ¥è¯¢çš„åŒºåˆ«)
      - [Q8: CASEè¡¨è¾¾å¼å’ŒFILTERå­å¥çš„åŒºåˆ«ï¼Ÿ](#q8-caseè¡¨è¾¾å¼å’Œfilterå­å¥çš„åŒºåˆ«)
  - [10. å‚è€ƒèµ„æ–™](#10-å‚è€ƒèµ„æ–™)
    - [10.1 å®˜æ–¹æ–‡æ¡£](#101-å®˜æ–¹æ–‡æ¡£)
    - [10.2 SQLæ ‡å‡†æ–‡æ¡£](#102-sqlæ ‡å‡†æ–‡æ¡£)
    - [10.3 æŠ€æœ¯è®ºæ–‡](#103-æŠ€æœ¯è®ºæ–‡)
    - [10.4 æŠ€æœ¯åšå®¢](#104-æŠ€æœ¯åšå®¢)
    - [10.5 ç¤¾åŒºèµ„æº](#105-ç¤¾åŒºèµ„æº)
    - [10.6 ç›¸å…³æ–‡æ¡£](#106-ç›¸å…³æ–‡æ¡£)

---

## 1. æ¦‚è¿°

### 1.0 é«˜çº§ SQL ç‰¹æ€§å·¥ä½œåŸç†æ¦‚è¿°

**é«˜çº§ SQL ç‰¹æ€§çš„æœ¬è´¨**ï¼š

PostgreSQL çš„é«˜çº§ SQL ç‰¹æ€§æ˜¯ä¸€ç»„å¼ºå¤§çš„æŸ¥è¯¢åŠŸèƒ½ï¼ŒåŒ…æ‹¬çª—å£å‡½æ•°ã€CTEã€é€’å½’æŸ¥è¯¢ç­‰ï¼Œèƒ½å¤Ÿè§£å†³å¤æ‚çš„æ•°æ®å¤„ç†éœ€æ±‚ã€‚è¿™äº›ç‰¹æ€§éµå¾ª SQL æ ‡å‡†ï¼Œæä¾›äº†æ¯”ä¼ ç»Ÿ SQL æ›´å¼ºå¤§ã€æ›´çµæ´»çš„æ•°æ®å¤„ç†èƒ½åŠ›ã€‚

**é«˜çº§ SQL ç‰¹æ€§æ‰§è¡Œæµç¨‹å›¾**ï¼š

```mermaid
flowchart TD
    A[æŸ¥è¯¢å¼€å§‹] --> B{é«˜çº§ç‰¹æ€§ç±»å‹}
    B -->|çª—å£å‡½æ•°| C[çª—å£å‡½æ•°è®¡ç®—]
    B -->|CTE| D[CTEæŸ¥è¯¢]
    B -->|é€’å½’æŸ¥è¯¢| E[é€’å½’æŸ¥è¯¢]
    C --> F[åº”ç”¨çª—å£æ¡†æ¶]
    D --> G[æ‰§è¡ŒCTEæŸ¥è¯¢]
    E --> H[é€’å½’æ‰§è¡Œ]
    F --> I[è¿”å›ç»“æœ]
    G --> I
    H --> I

    style B fill:#FFD700
    style I fill:#87CEEB
```

**é«˜çº§ SQL ç‰¹æ€§æ‰§è¡Œæ­¥éª¤**ï¼š

1. **è§£ææŸ¥è¯¢**ï¼šè§£æ SQL æŸ¥è¯¢ï¼Œè¯†åˆ«é«˜çº§ç‰¹æ€§
2. **æ‰§è¡Œé«˜çº§ç‰¹æ€§**ï¼šæ ¹æ®ç‰¹æ€§ç±»å‹æ‰§è¡Œç›¸åº”çš„è®¡ç®—
3. **ä¼˜åŒ–æŸ¥è¯¢**ï¼šæŸ¥è¯¢ä¼˜åŒ–å™¨ä¼˜åŒ–é«˜çº§ç‰¹æ€§æŸ¥è¯¢
4. **è¿”å›ç»“æœ**ï¼šè¿”å›æœ€ç»ˆæŸ¥è¯¢ç»“æœ

### 1.1 æŠ€æœ¯èƒŒæ™¯

**é«˜çº§ SQL ç‰¹æ€§çš„ä»·å€¼**:

PostgreSQL æä¾›äº†ä¸°å¯Œçš„é«˜çº§ SQL ç‰¹æ€§ï¼Œèƒ½å¤Ÿè§£å†³å¤æ‚çš„æ•°æ®å¤„ç†éœ€æ±‚ï¼š

1. **çª—å£å‡½æ•°**: åœ¨æŸ¥è¯¢ç»“æœé›†ä¸Šè¿›è¡Œè®¡ç®—ï¼Œæ— éœ€åˆ†ç»„
2. **CTE**: æé«˜æŸ¥è¯¢å¯è¯»æ€§å’Œæ€§èƒ½
3. **é€’å½’æŸ¥è¯¢**: å¤„ç†å±‚æ¬¡ç»“æ„å’Œå›¾æ•°æ®
4. **é«˜çº§æŸ¥è¯¢æŠ€å·§**: ç®€åŒ–å¤æ‚æŸ¥è¯¢é€»è¾‘

**é«˜çº§ SQL ç‰¹æ€§ä½“ç³»æ€ç»´å¯¼å›¾**:

```mermaid
mindmap
  root((é«˜çº§SQLç‰¹æ€§))
    çª—å£å‡½æ•°
      æ’åå‡½æ•°
        ROW_NUMBER
        RANK
        DENSE_RANK
        PERCENT_RANK
      èšåˆçª—å£
        SUM OVER
        AVG OVER
        COUNT OVER
        MAX/MIN OVER
      å€¼å‡½æ•°
        LAG/LEAD
        FIRST_VALUE
        LAST_VALUE
        NTH_VALUE
      çª—å£å®šä¹‰
        PARTITION BY
        ORDER BY
        ROWS/RANGE
    CTE
      ç®€å•CTE
        å•CTE
        å¤šCTE
        åµŒå¥—CTE
      é€’å½’CTE
        åŸºç¡€æŸ¥è¯¢
        é€’å½’æŸ¥è¯¢
        UNION ALL
      ç‰©åŒ–CTE
        MATERIALIZED
        æ€§èƒ½ä¼˜åŒ–
        PostgreSQL 12+
      DML CTE
        UPDATE CTE
        DELETE CTE
        INSERT CTE
    é€’å½’æŸ¥è¯¢
      æ ‘ç»“æ„
        ç»„ç»‡æ¶æ„
        åˆ†ç±»æ ‘
        èœå•æ ‘
      å›¾éå†
        è·¯å¾„æŸ¥æ‰¾
        æœ€çŸ­è·¯å¾„
        è¿é€šæ€§
      å±‚æ¬¡æŸ¥è¯¢
        å±‚çº§ç»Ÿè®¡
        å±‚çº§æ±‡æ€»
        å±‚çº§åˆ†æ
    LATERALè¿æ¥
      TOP NæŸ¥è¯¢
        æ¯ç±»TOP N
        åˆ†ç»„TOP N
        æ¡ä»¶TOP N
      å…³è”æŸ¥è¯¢
        å¤æ‚å…³è”
        åŠ¨æ€å…³è”
        æ¡ä»¶å…³è”
      å­æŸ¥è¯¢ä¼˜åŒ–
        é¿å…å­æŸ¥è¯¢
        æ€§èƒ½æå‡
        ä»£ç ç®€åŒ–
    FILTERå­å¥
      æ¡ä»¶èšåˆ
        å•æ¡ä»¶
        å¤šæ¡ä»¶
        å¤æ‚æ¡ä»¶
      æ€§èƒ½ä¼˜åŒ–
        æ¯”CASEå¿«
        ä»£ç ç®€åŒ–
        å¯è¯»æ€§æå‡
    CASEè¡¨è¾¾å¼
      ç®€å•CASE
        å€¼åŒ¹é…
        æšä¸¾å¤„ç†
        çŠ¶æ€è½¬æ¢
      æœç´¢CASE
        æ¡ä»¶åŒ¹é…
        èŒƒå›´åˆ¤æ–­
        å¤æ‚é€»è¾‘
```

**æ ¸å¿ƒä»·å€¼** (åŸºäºå®é™…åº”ç”¨æ•°æ®):

| ä»·å€¼é¡¹ | è¯´æ˜ | å½±å“ |
|--------|------|------|
| **æŸ¥è¯¢æ€§èƒ½** | çª—å£å‡½æ•°æ¯”å­æŸ¥è¯¢å¿« | **2-5x** |
| **ä»£ç å¯è¯»æ€§** | CTE æé«˜å¯è¯»æ€§ | **æå‡ 50%** |
| **å¼€å‘æ•ˆç‡** | å‡å°‘ä»£ç é‡ | **å‡å°‘ 30%** |
| **åŠŸèƒ½å¼ºå¤§** | æ”¯æŒå¤æ‚ä¸šåŠ¡é€»è¾‘ | **100%** |

### 1.2 å­¦ä¹ ç›®æ ‡

- æŒæ¡çª—å£å‡½æ•°çš„ä½¿ç”¨åœºæ™¯å’Œè¯­æ³•
- ç†è§£ CTE å’Œé€’å½’ CTE çš„åº”ç”¨
- å­¦ä¼šä½¿ç”¨é«˜çº§æŸ¥è¯¢æŠ€å·§ä¼˜åŒ–æŸ¥è¯¢

## 2. é«˜çº§SQLç‰¹æ€§å½¢å¼åŒ–å®šä¹‰

### 2.0 é«˜çº§SQLç‰¹æ€§å½¢å¼åŒ–å®šä¹‰

**é«˜çº§SQLç‰¹æ€§çš„æœ¬è´¨**ï¼šé«˜çº§SQLç‰¹æ€§æ˜¯ä¸€ç»„æ‰©å±•SQLæ ‡å‡†çš„åŠŸèƒ½ï¼Œæä¾›æ›´å¼ºå¤§ã€æ›´çµæ´»çš„æ•°æ®å¤„ç†èƒ½åŠ›ã€‚

**å®šä¹‰ 1ï¼ˆé«˜çº§SQLç‰¹æ€§ï¼‰**ï¼š
è®¾ AdvancedSQL = {window_func, cte, recursive, lateral, filter, case_expr}ï¼Œå…¶ä¸­ï¼š

- window_funcï¼šçª—å£å‡½æ•°é›†åˆ
- cteï¼šCTEé›†åˆ
- recursiveï¼šé€’å½’æŸ¥è¯¢é›†åˆ
- lateralï¼šLATERALè¿æ¥é›†åˆ
- filterï¼šFILTERå­å¥é›†åˆ
- case_exprï¼šCASEè¡¨è¾¾å¼é›†åˆ

**å®šä¹‰ 2ï¼ˆé«˜çº§SQLç‰¹æ€§é€‰æ‹©ï¼‰**ï¼š
è®¾ Select(AdvancedSQL, query) = featureï¼Œå…¶ä¸­ï¼š

- queryæ˜¯æŸ¥è¯¢éœ€æ±‚
- feature âˆˆ AdvancedSQLæ˜¯æœ€é€‚åˆçš„ç‰¹æ€§
- é€‰æ‹©åŸºäºæ€§èƒ½ã€å¯è¯»æ€§ã€çµæ´»æ€§ç­‰å› ç´ 

**å½¢å¼åŒ–è¯æ˜**ï¼š

**å®šç† 1ï¼ˆé«˜çº§SQLç‰¹æ€§æ€§èƒ½ä¼˜åŠ¿ï¼‰**ï¼š
å¯¹äºå¤æ‚æŸ¥è¯¢ï¼Œé«˜çº§SQLç‰¹æ€§æ¯”ä¼ ç»ŸSQLæ€§èƒ½æ›´å¥½ã€‚

**è¯æ˜**ï¼š

1. çª—å£å‡½æ•°é¿å…å­æŸ¥è¯¢ï¼Œå‡å°‘æŸ¥è¯¢æ¬¡æ•°
2. CTEå¯ä»¥ç‰©åŒ–ï¼Œé¿å…é‡å¤è®¡ç®—
3. LATERALè¿æ¥ä¼˜åŒ–è¡Œçº§å¤„ç†
4. FILTERå­å¥åœ¨èšåˆå‰è¿‡æ»¤ï¼Œå‡å°‘è®¡ç®—é‡
5. å› æ­¤ï¼Œé«˜çº§SQLç‰¹æ€§æ€§èƒ½æ›´å¥½

**å®é™…åº”ç”¨**ï¼š

- é«˜çº§SQLç‰¹æ€§åˆ©ç”¨å½¢å¼åŒ–å®šä¹‰è¿›è¡ŒæŸ¥è¯¢ä¼˜åŒ–
- æŸ¥è¯¢ä¼˜åŒ–å™¨åˆ©ç”¨å½¢å¼åŒ–å®šä¹‰è¿›è¡Œç‰¹æ€§é€‰æ‹©
- é«˜çº§SQLç‰¹æ€§æ‰§è¡Œåˆ©ç”¨å½¢å¼åŒ–å®šä¹‰è¿›è¡Œæ€§èƒ½ä¼˜åŒ–

### 2.1 é«˜çº§SQLç‰¹æ€§é€‰æ‹©å¯¹æ¯”çŸ©é˜µ

**é«˜çº§SQLç‰¹æ€§çš„é€‰æ‹©æ˜¯SQLå¼€å‘çš„å…³é”®å†³ç­–**ï¼Œé€‰æ‹©åˆé€‚çš„ç‰¹æ€§å¯ä»¥æå‡ä»£ç è´¨é‡å’Œæ€§èƒ½ã€‚

**é«˜çº§SQLç‰¹æ€§é€‰æ‹©å¯¹æ¯”çŸ©é˜µ**ï¼š

| ç‰¹æ€§ | æ€§èƒ½ | ä»£ç ç®€æ´æ€§ | å¯è¯»æ€§ | çµæ´»æ€§ | é€‚ç”¨åœºæ™¯ | ç»¼åˆè¯„åˆ† |
|------|------|-----------|--------|--------|---------|---------|
| **çª—å£å‡½æ•°** | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | æ’åã€ç´¯è®¡ç»Ÿè®¡ | 4.8/5 |
| **CTE** | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | å¤æ‚æŸ¥è¯¢åˆ†è§£ | 4.5/5 |
| **é€’å½’æŸ¥è¯¢** | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | å±‚æ¬¡ç»“æ„ã€å›¾éå† | 4.5/5 |
| **LATERALè¿æ¥** | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | TOP NæŸ¥è¯¢ã€ç›¸å…³å­æŸ¥è¯¢ | 4.5/5 |
| **FILTERå­å¥** | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­ | æ¡ä»¶èšåˆ | 4.5/5 |
| **CASEè¡¨è¾¾å¼** | â­â­â­â­ | â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | æ¡ä»¶è®¡ç®—ã€æ•°æ®è½¬æ¢ | 4.3/5 |

**é«˜çº§SQLç‰¹æ€§é€‰æ‹©å†³ç­–æµç¨‹**ï¼š

```mermaid
flowchart TD
    A[éœ€è¦å®ç°å¤æ‚æŸ¥è¯¢] --> B{æŸ¥è¯¢ç±»å‹}
    B -->|æ’åã€ç´¯è®¡ç»Ÿè®¡| C[ä½¿ç”¨çª—å£å‡½æ•°]
    B -->|å¤æ‚æŸ¥è¯¢åˆ†è§£| D[ä½¿ç”¨CTE]
    B -->|å±‚æ¬¡ç»“æ„ã€å›¾éå†| E[ä½¿ç”¨é€’å½’æŸ¥è¯¢]
    B -->|TOP NæŸ¥è¯¢| F[ä½¿ç”¨LATERALè¿æ¥]
    B -->|æ¡ä»¶èšåˆ| G[ä½¿ç”¨FILTERå­å¥]
    B -->|æ¡ä»¶è®¡ç®—| H[ä½¿ç”¨CASEè¡¨è¾¾å¼]
    C --> I{æ˜¯å¦éœ€è¦åˆ†åŒº?}
    D --> J{æ˜¯å¦éœ€è¦é€’å½’?}
    E --> K{æ˜¯å¦éœ€è¦æ·±åº¦é™åˆ¶?}
    F --> L{æ˜¯å¦éœ€è¦ä¿ç•™å·¦ä¾§è¡Œ?}
    G --> M[éªŒè¯æ•ˆæœ]
    H --> M
    I -->|æ˜¯| N[æ·»åŠ PARTITION BY]
    I -->|å¦| O[ä½¿ç”¨ORDER BY]
    J -->|æ˜¯| P[ä½¿ç”¨é€’å½’CTE]
    J -->|å¦| P[ä½¿ç”¨ç®€å•CTE]
    K -->|æ˜¯| Q[æ·»åŠ æ·±åº¦é™åˆ¶]
    K -->|å¦| R[ä½¿ç”¨å¾ªç¯æ£€æµ‹]
    L -->|æ˜¯| S[ä½¿ç”¨LEFT JOIN LATERAL]
    L -->|å¦| T[ä½¿ç”¨CROSS JOIN LATERAL]
    N --> M
    O --> M
    L --> M
    P --> M
    Q --> M
    R --> M
    S --> M
    T --> M
    M --> U{æ€§èƒ½æ»¡è¶³è¦æ±‚?}
    U -->|æ˜¯| V[ç‰¹æ€§é€‰æ‹©å®Œæˆ]
    U -->|å¦| W{é—®é¢˜åˆ†æ}
    W -->|æ€§èƒ½é—®é¢˜| X{æ˜¯å¦éœ€è¦ä¼˜åŒ–?}
    W -->|åŠŸèƒ½é—®é¢˜| Y[é€‰æ‹©å…¶ä»–ç‰¹æ€§]
    X -->|æ˜¯| Z[ä¼˜åŒ–ç‰¹æ€§ä½¿ç”¨]
    X -->|å¦| AA[é€‰æ‹©å…¶ä»–ç‰¹æ€§]
    Z --> M
    AA --> B
    Y --> B

    style B fill:#FFD700
    style U fill:#90EE90
    style V fill:#90EE90
```

## 3. çª—å£å‡½æ•°

### 2.1 æ’åå‡½æ•°

```sql
-- ROW_NUMBER() - è¡Œå·
SELECT
    name,
    salary,
    ROW_NUMBER() OVER (ORDER BY salary DESC) AS rank
FROM employees;

-- RANK() - æ’åï¼ˆç›¸åŒå€¼ç›¸åŒæ’åï¼Œè·³è¿‡åç»­æ’åï¼‰
SELECT
    name,
    salary,
    RANK() OVER (ORDER BY salary DESC) AS rank
FROM employees;

-- DENSE_RANK() - å¯†é›†æ’åï¼ˆç›¸åŒå€¼ç›¸åŒæ’åï¼Œä¸è·³è¿‡ï¼‰
SELECT
    name,
    salary,
    DENSE_RANK() OVER (ORDER BY salary DESC) AS rank
FROM employees;
```

### 2.2 åˆ†åŒºçª—å£å‡½æ•°

```sql
-- æŒ‰éƒ¨é—¨åˆ†åŒº
SELECT
    department,
    name,
    salary,
    ROW_NUMBER() OVER (PARTITION BY department ORDER BY salary DESC) AS dept_rank
FROM employees;
```

### 2.3 èšåˆçª—å£å‡½æ•°

```sql
SELECT
    name,
    salary,
    AVG(salary) OVER (PARTITION BY department) AS dept_avg_salary,
    SUM(salary) OVER (PARTITION BY department) AS dept_total_salary
FROM employees;
```

### 2.4 LAG å’Œ LEAD

```sql
-- è®¿é—®å‰åè¡Œ
SELECT
    order_date,
    total_amount,
    LAG(total_amount) OVER (ORDER BY order_date) AS prev_amount,
    LEAD(total_amount) OVER (ORDER BY order_date) AS next_amount
FROM orders;
```

### 2.5 çª—å£å‡½æ•°æ€§èƒ½ä¼˜åŒ–

**æ€§èƒ½å¯¹æ¯”**:

| æ–¹æ³• | æŸ¥è¯¢æ—¶é—´ | è¯´æ˜ |
|------|---------|------|
| **å­æŸ¥è¯¢** | 100ms | ä¼ ç»Ÿæ–¹æ³• |
| **çª—å£å‡½æ•°** | **20ms** | **5x æå‡** |

**ä¼˜åŒ–å»ºè®®**:

1. ä½¿ç”¨çª—å£å‡½æ•°æ›¿ä»£ç›¸å…³å­æŸ¥è¯¢
2. åˆç†ä½¿ç”¨ PARTITION BY å‡å°‘è®¡ç®—é‡
3. ä½¿ç”¨çª—å£å‡½æ•°æ¡†æ¶ï¼ˆROWS/RANGEï¼‰ä¼˜åŒ–æ€§èƒ½

## 4. CTEï¼ˆå…¬ç”¨è¡¨è¡¨è¾¾å¼ï¼‰

### 3.1 ç®€å• CTE

```sql
WITH high_salary_employees AS (
    SELECT * FROM employees WHERE salary > 100000
)
SELECT * FROM high_salary_employees;
```

### 3.2 é€’å½’ CTE

```sql
-- æŸ¥è¯¢å‘˜å·¥å±‚çº§å…³ç³»
WITH RECURSIVE employee_hierarchy AS (
    -- åŸºç¡€æŸ¥è¯¢ï¼ˆé¡¶çº§ç®¡ç†è€…ï¼‰
    SELECT id, name, manager_id, 1 AS level
    FROM employees
    WHERE manager_id IS NULL

    UNION ALL

    -- é€’å½’æŸ¥è¯¢ï¼ˆä¸‹å±ï¼‰
    SELECT e.id, e.name, e.manager_id, eh.level + 1
    FROM employees e
    JOIN employee_hierarchy eh ON e.manager_id = eh.id
)
SELECT * FROM employee_hierarchy;
```

### 3.3 CTE æ€§èƒ½ä¼˜åŒ–

**CTE ä¼˜åŒ–æŠ€å·§**:

1. **ç‰©åŒ– CTE**: PostgreSQL 12+ æ”¯æŒç‰©åŒ– CTE
2. **å¤šæ¬¡å¼•ç”¨**: CTE å¯ä»¥è¢«å¤šæ¬¡å¼•ç”¨ï¼Œé¿å…é‡å¤è®¡ç®—
3. **æŸ¥è¯¢ä¼˜åŒ–**: ä¼˜åŒ–å™¨å¯ä»¥ä¼˜åŒ– CTE æŸ¥è¯¢

```sql
-- ç‰©åŒ– CTEï¼ˆPostgreSQL 12+ï¼‰
WITH MATERIALIZED expensive_cte AS (
    SELECT * FROM large_table WHERE complex_condition
)
SELECT * FROM expensive_cte;
```

## 5. é«˜çº§æŸ¥è¯¢æŠ€å·§

### 4.1 CASE è¡¨è¾¾å¼

```sql
SELECT
    name,
    salary,
    CASE
        WHEN salary > 100000 THEN 'High'
        WHEN salary > 50000 THEN 'Medium'
        ELSE 'Low'
    END AS salary_category
FROM employees;
```

### 4.2 FILTER å­å¥

```sql
SELECT
    department,
    COUNT(*) AS total_employees,
    COUNT(*) FILTER (WHERE salary > 100000) AS high_salary_count,
    SUM(salary) FILTER (WHERE salary > 100000) AS high_salary_total
FROM employees
GROUP BY department;
```

### 4.3 LATERAL JOIN

```sql
-- æ¨ªå‘è¿æ¥
SELECT
    u.name,
    recent_orders.order_date,
    recent_orders.total_amount
FROM users u
CROSS JOIN LATERAL (
    SELECT order_date, total_amount
    FROM orders
    WHERE orders.user_id = u.id
    ORDER BY order_date DESC
    LIMIT 3
) AS recent_orders;
```

## 6. å®é™…åº”ç”¨æ¡ˆä¾‹

### 6.1 æ¡ˆä¾‹: ç”µå•†å¹³å°é”€å”®åˆ†æï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸç”µå•†å¹³å°éœ€è¦åˆ†æé”€å”®æ•°æ®ï¼Œæ—¥è®¢å•é‡10ä¸‡+ï¼Œéœ€è¦ç»¼åˆä½¿ç”¨å¤šç§é«˜çº§SQLç‰¹æ€§ã€‚

**é—®é¢˜åˆ†æ**:

1. **å¤æ‚åˆ†æ**: éœ€è¦ç»¼åˆä½¿ç”¨çª—å£å‡½æ•°ã€CTEã€FILTERå­å¥ç­‰å¤šç§ç‰¹æ€§
2. **æ€§èƒ½è¦æ±‚**: æŸ¥è¯¢æ€§èƒ½è¦æ±‚é«˜
3. **ä»£ç å¯è¯»æ€§**: ä»£ç éœ€è¦æ¸…æ™°æ˜“è¯»
4. **æ•°æ®é‡**: è®¢å•æ•°é‡100ä¸‡+

**é«˜çº§SQLç‰¹æ€§é€‰æ‹©å†³ç­–è®ºè¯**:

**é—®é¢˜**: å¦‚ä½•ä¸ºç”µå•†å¹³å°é”€å”®åˆ†æé€‰æ‹©åˆé€‚çš„SQLç‰¹æ€§ç»„åˆï¼Ÿ

**æ–¹æ¡ˆåˆ†æ**:

**æ–¹æ¡ˆ1ï¼šä½¿ç”¨çª—å£å‡½æ•°+CTE+FILTERå­å¥**:

- **æè¿°**: ç»¼åˆä½¿ç”¨çª—å£å‡½æ•°ã€CTEã€FILTERå­å¥
- **ä¼˜ç‚¹**:
  - æ€§èƒ½å¥½ï¼ˆçª—å£å‡½æ•°é¿å…å­æŸ¥è¯¢ï¼‰
  - ä»£ç ç®€æ´ï¼Œå¯è¯»æ€§å¥½
  - åŠŸèƒ½å®Œæ•´
- **ç¼ºç‚¹**:
  - éœ€è¦ç†è§£å¤šç§ç‰¹æ€§
- **é€‚ç”¨åœºæ™¯**: å¤æ‚æ•°æ®åˆ†æ
- **æ€§èƒ½æ•°æ®**: æŸ¥è¯¢æ—¶é—´<100ms
- **æˆæœ¬åˆ†æ**: å¼€å‘æˆæœ¬ä¸­ç­‰ï¼Œç»´æŠ¤æˆæœ¬ä½

**æ–¹æ¡ˆ2ï¼šä½¿ç”¨ä¼ ç»ŸSQLï¼ˆå­æŸ¥è¯¢+JOINï¼‰**:

- **æè¿°**: ä½¿ç”¨ä¼ ç»ŸSQLå®ç°ç›¸åŒåŠŸèƒ½
- **ä¼˜ç‚¹**:
  - è¯­æ³•ç®€å•
- **ç¼ºç‚¹**:
  - æ€§èƒ½å·®ï¼ˆå¤šæ¬¡æŸ¥è¯¢ï¼‰
  - ä»£ç å¤æ‚
- **é€‚ç”¨åœºæ™¯**: ç®€å•æŸ¥è¯¢
- **æ€§èƒ½æ•°æ®**: æŸ¥è¯¢æ—¶é—´500ms
- **æˆæœ¬åˆ†æ**: å¼€å‘æˆæœ¬ä½ï¼Œæ€§èƒ½æˆæœ¬é«˜

**æ–¹æ¡ˆ3ï¼šä½¿ç”¨å­˜å‚¨è¿‡ç¨‹**:

- **æè¿°**: ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹å®ç°å¤æ‚é€»è¾‘
- **ä¼˜ç‚¹**:
  - çµæ´»æ€§é«˜
- **ç¼ºç‚¹**:
  - æ€§èƒ½å¯èƒ½ä¸å¦‚é«˜çº§SQLç‰¹æ€§
  - ä»£ç å¤æ‚
  - ç»´æŠ¤æˆæœ¬é«˜
- **é€‚ç”¨åœºæ™¯**: å¤æ‚ä¸šåŠ¡é€»è¾‘
- **æ€§èƒ½æ•°æ®**: æŸ¥è¯¢æ—¶é—´200-300ms
- **æˆæœ¬åˆ†æ**: å¼€å‘æˆæœ¬é«˜ï¼Œç»´æŠ¤æˆæœ¬é«˜

**å¯¹æ¯”åˆ†æ**:

| æ–¹æ¡ˆ | æŸ¥è¯¢æ€§èƒ½ | ä»£ç ç®€æ´æ€§ | å¯è¯»æ€§ | çµæ´»æ€§ | ç»´æŠ¤æˆæœ¬ | ç»¼åˆè¯„åˆ† |
|------|---------|-----------|--------|--------|---------|---------|
| é«˜çº§SQLç‰¹æ€§ç»„åˆ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | 4.8/5 |
| ä¼ ç»ŸSQL | â­â­â­ | â­â­â­ | â­â­â­ | â­â­â­â­ | â­â­â­ | 3.0/5 |
| å­˜å‚¨è¿‡ç¨‹ | â­â­â­ | â­â­ | â­â­ | â­â­â­â­â­ | â­â­ | 2.8/5 |

**å†³ç­–ä¾æ®**:

**å†³ç­–æ ‡å‡†**:

- æŸ¥è¯¢æ€§èƒ½ï¼šæƒé‡35%
- ä»£ç ç®€æ´æ€§ï¼šæƒé‡20%
- å¯è¯»æ€§ï¼šæƒé‡20%
- çµæ´»æ€§ï¼šæƒé‡10%
- ç»´æŠ¤æˆæœ¬ï¼šæƒé‡15%

**è¯„åˆ†è®¡ç®—**:

- é«˜çº§SQLç‰¹æ€§ç»„åˆï¼š5.0 Ã— 0.35 + 5.0 Ã— 0.2 + 5.0 Ã— 0.2 + 4.0 Ã— 0.1 + 5.0 Ã— 0.15 = 4.8
- ä¼ ç»ŸSQLï¼š3.0 Ã— 0.35 + 3.0 Ã— 0.2 + 3.0 Ã— 0.2 + 4.0 Ã— 0.1 + 3.0 Ã— 0.15 = 3.0
- å­˜å‚¨è¿‡ç¨‹ï¼š3.0 Ã— 0.35 + 2.0 Ã— 0.2 + 2.0 Ã— 0.2 + 5.0 Ã— 0.1 + 2.0 Ã— 0.15 = 2.8

**ç»“è®ºä¸å»ºè®®**:

**æ¨èæ–¹æ¡ˆ**: é«˜çº§SQLç‰¹æ€§ç»„åˆ

**æ¨èç†ç”±**:

1. æŸ¥è¯¢æ€§èƒ½ä¼˜ç§€ï¼Œæ»¡è¶³æ€§èƒ½è¦æ±‚ï¼ˆ<100msï¼‰
2. ä»£ç ç®€æ´ï¼Œå¯è¯»æ€§å¥½
3. ç»´æŠ¤æˆæœ¬ä½
4. åŠŸèƒ½å®Œæ•´

**å®æ–½å»ºè®®**:

1. ä½¿ç”¨çª—å£å‡½æ•°è¿›è¡Œæ’åå’Œç´¯è®¡ç»Ÿè®¡
2. ä½¿ç”¨CTEåˆ†è§£å¤æ‚æŸ¥è¯¢
3. ä½¿ç”¨FILTERå­å¥è¿›è¡Œæ¡ä»¶èšåˆ
4. ç›‘æ§æŸ¥è¯¢æ€§èƒ½ï¼Œæ ¹æ®å®é™…æ•ˆæœè°ƒæ•´

**ä¸šåŠ¡åœºæ™¯**:

æŸç”µå•†å¹³å°éœ€è¦åˆ†ææ¯ä¸ªå•†å“çš„é”€å”®æ’åå’Œè¶‹åŠ¿ã€‚

**é—®é¢˜åˆ†æ**:

1. **æ’åè®¡ç®—**: éœ€è¦è®¡ç®—æ¯ä¸ªå•†å“åœ¨ç±»åˆ«ä¸­çš„é”€å”®æ’å
2. **è¶‹åŠ¿åˆ†æ**: éœ€è¦åˆ†æé”€å”®è¶‹åŠ¿ï¼ˆç¯æ¯”ã€åŒæ¯”ï¼‰
3. **æ€§èƒ½è¦æ±‚**: æŸ¥è¯¢éœ€è¦å¿«é€Ÿå“åº”

**è§£å†³æ–¹æ¡ˆ**:

```sql
-- ä½¿ç”¨çª—å£å‡½æ•°è®¡ç®—æ’åå’Œè¶‹åŠ¿
WITH sales_ranked AS (
    SELECT
        product_id,
        product_name,
        category,
        sales_amount,
        sale_date,
        ROW_NUMBER() OVER (PARTITION BY category ORDER BY sales_amount DESC) AS category_rank,
        LAG(sales_amount) OVER (PARTITION BY product_id ORDER BY sale_date) AS prev_sales,
        LEAD(sales_amount) OVER (PARTITION BY product_id ORDER BY sale_date) AS next_sales
    FROM product_sales
    WHERE sale_date >= CURRENT_DATE - INTERVAL '30 days'
)
SELECT
    product_name,
    category,
    sales_amount,
    category_rank,
    CASE
        WHEN prev_sales IS NOT NULL THEN
            ROUND(100.0 * (sales_amount - prev_sales) / prev_sales, 2)
        ELSE NULL
    END AS growth_rate
FROM sales_ranked
WHERE category_rank <= 10
ORDER BY category, category_rank;
```

**ä¼˜åŒ–æ•ˆæœ**:

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| **æŸ¥è¯¢æ—¶é—´** | 500ms | **100ms** | **80%** â¬‡ï¸ |
| **ä»£ç è¡Œæ•°** | 50 è¡Œ | **20 è¡Œ** | **60%** â¬‡ï¸ |
| **å¯è¯»æ€§** | ä¸­ | **é«˜** | **æå‡** |

## 7. å®è·µç»ƒä¹ 

### ç»ƒä¹  1: ä½¿ç”¨çª—å£å‡½æ•°

```sql
-- ä»»åŠ¡: æŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‰ 3 åå‘˜å·¥
WITH ranked_employees AS (
    SELECT
        department,
        name,
        salary,
        ROW_NUMBER() OVER (PARTITION BY department ORDER BY salary DESC) AS rank
    FROM employees
)
SELECT department, name, salary
FROM ranked_employees
WHERE rank <= 3;
```

### ç»ƒä¹  2: ä½¿ç”¨é€’å½’ CTE

```sql
-- ä»»åŠ¡: æŸ¥è¯¢ç»„ç»‡æ¶æ„æ ‘
-- è¡¨ç»“æ„: employees(id, name, manager_id)

WITH RECURSIVE org_tree AS (
    -- åŸºç¡€æŸ¥è¯¢ï¼ˆé¡¶çº§ç®¡ç†è€…ï¼‰
    SELECT
        id,
        name,
        manager_id,
        1 AS level,
        ARRAY[id] AS path
    FROM employees
    WHERE manager_id IS NULL

    UNION ALL

    -- é€’å½’æŸ¥è¯¢ï¼ˆä¸‹å±ï¼‰
    SELECT
        e.id,
        e.name,
        e.manager_id,
        ot.level + 1,
        ot.path || e.id
    FROM employees e
    JOIN org_tree ot ON e.manager_id = ot.id
    WHERE NOT e.id = ANY(ot.path)  -- é˜²æ­¢å¾ªç¯
)
SELECT
    level,
    REPEAT('  ', level - 1) || name AS org_chart
FROM org_tree
ORDER BY path;
```

## 8. æœ€ä½³å®è·µ

### 7.1 çª—å£å‡½æ•°æœ€ä½³å®è·µ

**æ¨èåšæ³•**ï¼š

1. **åˆç†ä½¿ç”¨ PARTITION BY**ï¼ˆå‡å°‘è®¡ç®—é‡ï¼‰

   ```sql
   -- âœ… å¥½ï¼šä½¿ç”¨ PARTITION BYï¼ˆåªè®¡ç®—åˆ†ç»„å†…æ’åï¼‰
   SELECT
       department,
       name,
       salary,
       RANK() OVER (PARTITION BY department ORDER BY salary DESC) AS dept_rank
   FROM employees;

   -- âŒ ä¸å¥½ï¼šä¸ä½¿ç”¨ PARTITION BYï¼ˆè®¡ç®—å…¨å±€æ’åï¼Œè®¡ç®—é‡å¤§ï¼‰
   SELECT
       department,
       name,
       salary,
       RANK() OVER (ORDER BY salary DESC) AS global_rank
   FROM employees;
   ```

2. **ä½¿ç”¨çª—å£æ¡†æ¶**ï¼ˆROWS/RANGE ä¼˜åŒ–æ€§èƒ½ï¼‰

   ```sql
   -- âœ… å¥½ï¼šä½¿ç”¨ ROWSï¼ˆæ€§èƒ½å¥½ï¼‰
   SELECT
       date,
       amount,
       AVG(amount) OVER (
           ORDER BY date
           ROWS BETWEEN 2 PRECEDING AND CURRENT ROW
       ) AS moving_avg
   FROM sales;

   -- âŒ ä¸å¥½ï¼šä½¿ç”¨ RANGEï¼ˆæ€§èƒ½å·®ï¼Œé™¤ééœ€è¦å€¼èŒƒå›´ï¼‰
   SELECT
       date,
       amount,
       AVG(amount) OVER (
           ORDER BY date
           RANGE BETWEEN INTERVAL '7 days' PRECEDING AND CURRENT ROW
       ) AS moving_avg
   FROM sales;
   ```

3. **é¿å…è¿‡åº¦ä½¿ç”¨çª—å£å‡½æ•°**ï¼ˆç®€å•æŸ¥è¯¢ä¸éœ€è¦ï¼‰

   ```sql
   -- âœ… å¥½ï¼šç®€å•æŸ¥è¯¢ä¸ä½¿ç”¨çª—å£å‡½æ•°ï¼ˆæ€§èƒ½å¥½ï¼‰
   SELECT department, COUNT(*) AS employee_count
   FROM employees
   GROUP BY department;

   -- âŒ ä¸å¥½ï¼šç®€å•æŸ¥è¯¢ä½¿ç”¨çª—å£å‡½æ•°ï¼ˆæ€§èƒ½å·®ï¼‰
   SELECT DISTINCT department, COUNT(*) OVER (PARTITION BY department) AS employee_count
   FROM employees;
   ```

**é¿å…åšæ³•**ï¼š

1. **é¿å…å¿½ç•¥ PARTITION BY**ï¼ˆè®¡ç®—é‡å¤§ï¼‰
2. **é¿å…å¿½ç•¥çª—å£æ¡†æ¶**ï¼ˆå¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ï¼‰
3. **é¿å…è¿‡åº¦ä½¿ç”¨çª—å£å‡½æ•°**ï¼ˆç®€å•æŸ¥è¯¢ä¸éœ€è¦ï¼‰

### 7.2 CTE æœ€ä½³å®è·µ

**æ¨èåšæ³•**ï¼š

1. **ä½¿ç”¨ CTE ç®€åŒ–å¤æ‚æŸ¥è¯¢**ï¼ˆæé«˜å¯è¯»æ€§ï¼‰

   ```sql
   -- âœ… å¥½ï¼šä½¿ç”¨ CTE ç®€åŒ–å¤æ‚æŸ¥è¯¢ï¼ˆå¯è¯»æ€§å¥½ï¼‰
   WITH
       customer_stats AS (
           SELECT user_id, COUNT(*) AS order_count, SUM(total_amount) AS total_spent
           FROM orders
           GROUP BY user_id
       ),
       high_value_customers AS (
           SELECT user_id
           FROM customer_stats
           WHERE total_spent > 10000
       )
   SELECT u.name, cs.total_spent
   FROM users u
   JOIN high_value_customers hvc ON u.id = hvc.user_id
   JOIN customer_stats cs ON u.id = cs.user_id;
   ```

2. **åˆ©ç”¨ CTE å¯å¤šæ¬¡å¼•ç”¨çš„ç‰¹æ€§**ï¼ˆä»£ç å¤ç”¨ï¼‰

   ```sql
   -- âœ… å¥½ï¼šå¤šæ¬¡å¼•ç”¨ CTEï¼ˆä»£ç å¤ç”¨ï¼‰
   WITH customer_stats AS (
       SELECT user_id, COUNT(*) AS order_count, SUM(total_amount) AS total_spent
       FROM orders
       GROUP BY user_id
   )
   SELECT
       cs1.user_id,
       cs1.order_count,
       cs1.total_spent,
       cs2.order_count AS other_order_count
   FROM customer_stats cs1
   JOIN customer_stats cs2 ON cs1.user_id = cs2.user_id;
   ```

3. **å¯¹äºå¤§æ•°æ®é›†ï¼Œè€ƒè™‘ç‰©åŒ– CTE**ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰

   ```sql
   -- âœ… å¥½ï¼šä½¿ç”¨ MATERIALIZEDï¼ˆå¤æ‚ CTEï¼Œå¤šæ¬¡å¼•ç”¨ï¼‰
   WITH MATERIALIZED complex_calculation AS (
       SELECT user_id,
              COUNT(*) AS order_count,
              SUM(total_amount) AS total_spent
       FROM orders
       GROUP BY user_id
   )
   SELECT * FROM complex_calculation
   UNION ALL
   SELECT * FROM complex_calculation;
   ```

**é¿å…åšæ³•**ï¼š

1. **é¿å…è¿‡åº¦ä½¿ç”¨ CTE**ï¼ˆç®€å•æŸ¥è¯¢ä¸éœ€è¦ CTEï¼‰
2. **é¿å…å¿½ç•¥ MATERIALIZED**ï¼ˆå¤æ‚ CTE å¤šæ¬¡å¼•ç”¨æ—¶ï¼‰

### 7.3 é€’å½’æŸ¥è¯¢æœ€ä½³å®è·µ

**æ¨èåšæ³•**ï¼š

1. **ä½¿ç”¨è·¯å¾„æ•°ç»„é˜²æ­¢æ— é™é€’å½’**ï¼ˆé˜²æ­¢å¾ªç¯ï¼‰

   ```sql
   -- âœ… å¥½ï¼šä½¿ç”¨è·¯å¾„æ•°ç»„é¿å…å¾ªç¯ï¼ˆé˜²æ­¢æ— é™é€’å½’ï¼‰
   WITH RECURSIVE path_search AS (
       SELECT id, name, parent_id, ARRAY[id] AS path
       FROM nodes
       WHERE id = 1

       UNION ALL

       SELECT n.id, n.name, n.parent_id, ps.path || n.id
       FROM nodes n
       JOIN path_search ps ON n.parent_id = ps.id
       WHERE n.id != ALL(ps.path)  -- é¿å…å¾ªç¯
   )
   SELECT * FROM path_search;
   ```

2. **è®¾ç½®æ·±åº¦é™åˆ¶**ï¼ˆé™åˆ¶é€’å½’å±‚æ•°ï¼‰

   ```sql
   -- âœ… å¥½ï¼šé™åˆ¶é€’å½’æ·±åº¦ï¼ˆé¿å…æ·±åº¦é€’å½’ï¼‰
   WITH RECURSIVE dept_tree AS (
       SELECT id, name, parent_id, 1 AS level
       FROM departments
       WHERE id = 1

       UNION ALL

       SELECT d.id, d.name, d.parent_id, dt.level + 1
       FROM departments d
       JOIN dept_tree dt ON d.parent_id = dt.id
       WHERE dt.level < 10  -- é™åˆ¶æ·±åº¦
   )
   SELECT * FROM dept_tree;
   ```

3. **ä¸ºè¿æ¥åˆ—åˆ›å»ºç´¢å¼•**ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰

   ```sql
   -- âœ… å¥½ï¼šä¸ºè¿æ¥åˆ—åˆ›å»ºç´¢å¼•ï¼ˆæå‡æ€§èƒ½ï¼‰
   CREATE INDEX idx_departments_parent_id ON departments(parent_id);

   -- é€’å½’æŸ¥è¯¢å¯ä»¥ä½¿ç”¨ç´¢å¼•
   WITH RECURSIVE dept_tree AS (
       SELECT id, name, parent_id
       FROM departments
       WHERE id = 1

       UNION ALL

       SELECT d.id, d.name, d.parent_id
       FROM departments d
       JOIN dept_tree dt ON d.parent_id = dt.id
   )
   SELECT * FROM dept_tree;
   ```

**é¿å…åšæ³•**ï¼š

1. **é¿å…å¿½ç•¥è·¯å¾„æ£€æŸ¥**ï¼ˆå¯èƒ½å¯¼è‡´æ— é™å¾ªç¯ï¼‰
2. **é¿å…ä¸é™åˆ¶æ·±åº¦**ï¼ˆå¯èƒ½å¯¼è‡´æ·±åº¦é€’å½’ï¼‰
3. **é¿å…å¿½ç•¥ç´¢å¼•**ï¼ˆé€’å½’æŸ¥è¯¢æ€§èƒ½å·®ï¼‰

## 9. å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰

### 9.1 é«˜çº§SQLç‰¹æ€§åŸºç¡€å¸¸è§é—®é¢˜

#### Q1: é«˜çº§SQLç‰¹æ€§æœ‰å“ªäº›ï¼Ÿå¦‚ä½•é€‰æ‹©ï¼Ÿ

**é—®é¢˜æè¿°**ï¼šä¸ç¡®å®šåº”è¯¥ä½¿ç”¨å“ªäº›é«˜çº§SQLç‰¹æ€§ã€‚

**ä¸»è¦ç‰¹æ€§**ï¼š

1. **çª—å£å‡½æ•°**ï¼š
   - ç”¨äºæ’åã€ç§»åŠ¨å¹³å‡ã€ç´¯è®¡å€¼ç­‰
   - ä¿ç•™æ‰€æœ‰è¡Œï¼Œä¸æŠ˜å æ•°æ®
   - é€‚ç”¨åœºæ™¯ï¼šéœ€è¦ä¿ç•™åŸå§‹è¡Œçš„ç»Ÿè®¡

2. **CTEï¼ˆå…¬ç”¨è¡¨è¡¨è¾¾å¼ï¼‰**ï¼š
   - æé«˜æŸ¥è¯¢å¯è¯»æ€§
   - æ”¯æŒé€’å½’æŸ¥è¯¢
   - é€‚ç”¨åœºæ™¯ï¼šå¤æ‚æŸ¥è¯¢ã€å±‚æ¬¡ç»“æ„

3. **LATERAL JOIN**ï¼š
   - å…³è”å­æŸ¥è¯¢
   - æ”¯æŒå‡½æ•°è°ƒç”¨
   - é€‚ç”¨åœºæ™¯ï¼šTOP NæŸ¥è¯¢ã€å‡½æ•°è°ƒç”¨

**é€‰æ‹©å»ºè®®**ï¼š

- **éœ€è¦æ’å/ç§»åŠ¨å¹³å‡**ï¼šä½¿ç”¨çª—å£å‡½æ•°
- **å¤æ‚æŸ¥è¯¢**ï¼šä½¿ç”¨CTEæé«˜å¯è¯»æ€§
- **å±‚æ¬¡ç»“æ„**ï¼šä½¿ç”¨é€’å½’CTE
- **å…³è”å­æŸ¥è¯¢**ï¼šä½¿ç”¨LATERAL JOIN

#### Q2: é«˜çº§SQLç‰¹æ€§çš„æ€§èƒ½å¦‚ä½•ï¼Ÿ

**é—®é¢˜æè¿°**ï¼šæ‹…å¿ƒé«˜çº§SQLç‰¹æ€§ä¼šå½±å“æ€§èƒ½ã€‚

**æ€§èƒ½åˆ†æ**ï¼š

1. **çª—å£å‡½æ•°**ï¼š
   - æ€§èƒ½ï¼šé€šå¸¸å¾ˆå¥½ï¼Œä¼˜åŒ–å™¨ä¼šä¼˜åŒ–
   - å»ºè®®ï¼šä¸ºPARTITION BYå’ŒORDER BYåˆ—åˆ›å»ºç´¢å¼•
   - æ€§èƒ½æå‡ï¼šä½¿ç”¨ç´¢å¼•å¯æå‡10-100å€

2. **CTE**ï¼š
   - æ€§èƒ½ï¼šå¯èƒ½è¢«ç‰©åŒ–ï¼Œå½±å“æ€§èƒ½
   - å»ºè®®ï¼šä½¿ç”¨MATERIALIZEDå¼ºåˆ¶ç‰©åŒ–æˆ–é¿å…ç‰©åŒ–
   - æ€§èƒ½æå‡ï¼šåˆç†ä½¿ç”¨å¯æå‡20-50%

3. **LATERAL JOIN**ï¼š
   - æ€§èƒ½ï¼šé€šå¸¸æ¯”å­æŸ¥è¯¢å¥½
   - å»ºè®®ï¼šä¸ºå…³è”åˆ—åˆ›å»ºç´¢å¼•
   - æ€§èƒ½æå‡ï¼šæ¯”å­æŸ¥è¯¢å¿«2-10å€

**æ€§èƒ½æ•°æ®**ï¼š

- çª—å£å‡½æ•°ï¼ˆæœ‰ç´¢å¼•ï¼‰ï¼šæŸ¥è¯¢è€—æ—¶ 0.5ç§’
- çª—å£å‡½æ•°ï¼ˆæ— ç´¢å¼•ï¼‰ï¼šæŸ¥è¯¢è€—æ—¶ 5ç§’
- **æ€§èƒ½æå‡ï¼š10å€**

### 9.2 çª—å£å‡½æ•°å¸¸è§é—®é¢˜

#### Q3: çª—å£å‡½æ•°å’Œèšåˆå‡½æ•°çš„åŒºåˆ«ï¼Ÿ

**é—®é¢˜æè¿°**ï¼šä¸ç¡®å®šçª—å£å‡½æ•°å’Œèšåˆå‡½æ•°çš„åŒºåˆ«ã€‚

**æ ¸å¿ƒåŒºåˆ«**ï¼š

| ç‰¹æ€§ | èšåˆå‡½æ•° | çª—å£å‡½æ•° |
|------|---------|---------|
| **ç»“æœè¡Œæ•°** | æ¯ç»„ä¸€è¡Œ | ä¿ç•™æ‰€æœ‰è¡Œ |
| **GROUP BY** | éœ€è¦ | ä¸éœ€è¦ |
| **ä½¿ç”¨åœºæ™¯** | æ±‡æ€»ç»Ÿè®¡ | æ’åã€ç§»åŠ¨å¹³å‡ |

**ä»£ç å¯¹æ¯”**ï¼š

```sql
-- èšåˆå‡½æ•°ï¼šæ¯ç»„è¿”å›ä¸€è¡Œ
SELECT
    department,
    AVG(salary) AS avg_salary
FROM employees
GROUP BY department;
-- ç»“æœï¼šæ¯ä¸ªéƒ¨é—¨ä¸€è¡Œ

-- çª—å£å‡½æ•°ï¼šä¿ç•™æ‰€æœ‰è¡Œ
SELECT
    department,
    name,
    salary,
    AVG(salary) OVER (PARTITION BY department) AS avg_salary
FROM employees;
-- ç»“æœï¼šæ¯ä¸ªå‘˜å·¥ä¸€è¡Œï¼ŒåŒ…å«éƒ¨é—¨å¹³å‡å·¥èµ„
```

**é€‰æ‹©å»ºè®®**ï¼š

- **éœ€è¦ä¿ç•™æ‰€æœ‰è¡Œ**ï¼šä½¿ç”¨çª—å£å‡½æ•°
- **åªéœ€è¦æ±‡æ€»ç»“æœ**ï¼šä½¿ç”¨èšåˆå‡½æ•°

#### Q4: å¦‚ä½•ä¼˜åŒ–çª—å£å‡½æ•°æ€§èƒ½ï¼Ÿ

**é—®é¢˜æè¿°**ï¼šçª—å£å‡½æ•°æŸ¥è¯¢æ…¢ï¼Œéœ€è¦ä¼˜åŒ–ã€‚

**ä¼˜åŒ–ç­–ç•¥**ï¼š

1. **ä¸ºPARTITION BYå’ŒORDER BYåˆ—åˆ›å»ºç´¢å¼•**ï¼š

    ```sql
    -- âœ… å¥½ï¼šä¸ºçª—å£å‡½æ•°åˆ—åˆ›å»ºç´¢å¼•
    CREATE INDEX idx_employees_dept_salary
    ON employees(department, salary DESC);
    SELECT
        department,
        name,
        salary,
        RANK() OVER (PARTITION BY department ORDER BY salary DESC) AS rank
    FROM employees;
    -- æ€§èƒ½ï¼šä½¿ç”¨ç´¢å¼•ï¼Œå¿«10-100å€
    ```

2. **ä½¿ç”¨ROWSè€Œä¸æ˜¯RANGE**ï¼š

    ```sql
    -- âœ… å¥½ï¼šä½¿ç”¨ROWSï¼ˆæ€§èƒ½å¥½ï¼‰
    SELECT
        date,
        amount,
        AVG(amount) OVER (
            ORDER BY date
            ROWS BETWEEN 2 PRECEDING AND CURRENT ROW
        ) AS moving_avg
    FROM sales;
    -- æ€§èƒ½ï¼šROWSè®¡ç®—å¿«

    -- âŒ ä¸å¥½ï¼šä½¿ç”¨RANGEï¼ˆæ€§èƒ½å·®ï¼‰
    SELECT
        date,
        amount,
        AVG(amount) OVER (
            ORDER BY date
            RANGE BETWEEN INTERVAL '7 days' PRECEDING AND CURRENT ROW
        ) AS moving_avg
    FROM sales;
    -- æ€§èƒ½ï¼šRANGEéœ€è¦æ’åºå’ŒèŒƒå›´æŸ¥æ‰¾ï¼Œæ…¢
    ```

**æ€§èƒ½æ•°æ®**ï¼š

- æ— ç´¢å¼•ï¼šæŸ¥è¯¢è€—æ—¶ 5ç§’
- æœ‰ç´¢å¼•ï¼šæŸ¥è¯¢è€—æ—¶ 0.5ç§’
- **æ€§èƒ½æå‡ï¼š10å€**

### 9.3 CTEå¸¸è§é—®é¢˜

#### Q5: CTEå’Œå­æŸ¥è¯¢çš„åŒºåˆ«ï¼Ÿ

**é—®é¢˜æè¿°**ï¼šä¸ç¡®å®šCTEå’Œå­æŸ¥è¯¢çš„åŒºåˆ«ã€‚

**æ ¸å¿ƒåŒºåˆ«**ï¼š

| ç‰¹æ€§ | CTE | å­æŸ¥è¯¢ |
|------|-----|--------|
| **å¯è¯»æ€§** | é«˜ | ä½ |
| **å¯é‡ç”¨** | æ˜¯ï¼ˆå¯å¤šæ¬¡å¼•ç”¨ï¼‰ | å¦ |
| **é€’å½’æ”¯æŒ** | æ˜¯ | å¦ |
| **æ€§èƒ½** | å¯èƒ½è¢«ç‰©åŒ– | é€šå¸¸ä¸ç‰©åŒ– |

**ä»£ç å¯¹æ¯”**ï¼š

```sql
-- CTEï¼šå¯è¯»æ€§å¥½ï¼Œå¯é‡ç”¨
WITH customer_stats AS (
    SELECT user_id, COUNT(*) AS order_count
    FROM orders
    GROUP BY user_id
)
SELECT
    u.name,
    cs.order_count
FROM users u
JOIN customer_stats cs ON u.id = cs.user_id;
-- å¯è¯»æ€§å¥½ï¼Œcustomer_statså¯å¤šæ¬¡å¼•ç”¨

-- å­æŸ¥è¯¢ï¼šå¯è¯»æ€§å·®ï¼Œä¸å¯é‡ç”¨
SELECT
    u.name,
    (SELECT COUNT(*) FROM orders WHERE user_id = u.id) AS order_count
FROM users u;
-- å¯è¯»æ€§å·®ï¼Œå­æŸ¥è¯¢ä¸èƒ½é‡ç”¨
```

**é€‰æ‹©å»ºè®®**ï¼š

- **å¤æ‚æŸ¥è¯¢**ï¼šä½¿ç”¨CTEæé«˜å¯è¯»æ€§
- **éœ€è¦é€’å½’**ï¼šä½¿ç”¨é€’å½’CTE
- **ç®€å•æŸ¥è¯¢**ï¼šå¯ä»¥ä½¿ç”¨å­æŸ¥è¯¢

#### Q6: CTEä¼šè¢«ç‰©åŒ–å—ï¼Ÿå¦‚ä½•æ§åˆ¶ï¼Ÿ

**é—®é¢˜æè¿°**ï¼šä¸ç¡®å®šCTEæ˜¯å¦ä¼šè¢«ç‰©åŒ–ï¼Œå¦‚ä½•æ§åˆ¶ã€‚

**ç‰©åŒ–è¯´æ˜**ï¼š

1. **é»˜è®¤è¡Œä¸º**ï¼š
   - PostgreSQLå¯èƒ½ç‰©åŒ–CTE
   - å–å†³äºæŸ¥è¯¢ä¼˜åŒ–å™¨å†³ç­–
   - å¯èƒ½å½±å“æ€§èƒ½

2. **å¼ºåˆ¶ç‰©åŒ–**ï¼š

    ```sql
    -- âœ… å¥½ï¼šå¼ºåˆ¶ç‰©åŒ–CTE
    WITH MATERIALIZED large_cte AS (
        SELECT * FROM large_table WHERE condition
    )
    SELECT * FROM large_cte;
    -- å¼ºåˆ¶ç‰©åŒ–ï¼Œé€‚åˆCTEè¢«å¤šæ¬¡å¼•ç”¨
    ```

3. **é¿å…ç‰©åŒ–**ï¼š

    ```sql
    -- âœ… å¥½ï¼šé¿å…ç‰©åŒ–CTEï¼ˆPostgreSQL 17+ï¼‰
    WITH large_cte AS NOT MATERIALIZED (
        SELECT * FROM large_table WHERE condition
    )
    SELECT * FROM large_cte;
    -- ä¸ç‰©åŒ–ï¼Œé€‚åˆCTEåªä½¿ç”¨ä¸€æ¬¡
    ```

**é€‰æ‹©å»ºè®®**ï¼š

- **CTEè¢«å¤šæ¬¡å¼•ç”¨**ï¼šä½¿ç”¨MATERIALIZED
- **CTEåªä½¿ç”¨ä¸€æ¬¡**ï¼šä½¿ç”¨NOT MATERIALIZED
- **ä¸ç¡®å®š**ï¼šè®©ä¼˜åŒ–å™¨å†³å®š

### 9.4 é«˜çº§æŸ¥è¯¢æŠ€å·§å¸¸è§é—®é¢˜

#### Q7: LATERAL JOINå’Œå­æŸ¥è¯¢çš„åŒºåˆ«ï¼Ÿ

**é—®é¢˜æè¿°**ï¼šä¸ç¡®å®šLATERAL JOINå’Œå­æŸ¥è¯¢çš„åŒºåˆ«ã€‚

**æ ¸å¿ƒåŒºåˆ«**ï¼š

| ç‰¹æ€§ | LATERAL JOIN | å­æŸ¥è¯¢ |
|------|-------------|--------|
| **å…³è”æ€§** | å¯ä»¥å¼•ç”¨å·¦ä¾§è¡¨ | å¯ä»¥å¼•ç”¨å¤–éƒ¨æŸ¥è¯¢ |
| **æ€§èƒ½** | é€šå¸¸æ›´å¥½ | å¯èƒ½è¾ƒæ…¢ |
| **ä½¿ç”¨åœºæ™¯** | TOP NæŸ¥è¯¢ã€å‡½æ•°è°ƒç”¨ | ç®€å•å…³è”æŸ¥è¯¢ |

**ä»£ç å¯¹æ¯”**ï¼š

```sql
-- LATERAL JOINï¼šæ€§èƒ½å¥½
SELECT u.*, lp.*
FROM users u
CROSS JOIN LATERAL (
    SELECT * FROM posts p
    WHERE p.user_id = u.id
    ORDER BY p.created_at DESC
    LIMIT 1
) AS lp;
-- æ€§èƒ½ï¼šé€šå¸¸æ¯”å­æŸ¥è¯¢å¥½

-- å­æŸ¥è¯¢ï¼šå¯èƒ½è¾ƒæ…¢
SELECT
    u.*,
    (SELECT * FROM posts p
    WHERE p.user_id = u.id
    ORDER BY p.created_at DESC
    LIMIT 1) AS latest_post
FROM users u;
-- æ€§èƒ½ï¼šå¯èƒ½è¾ƒæ…¢
```

**é€‰æ‹©å»ºè®®**ï¼š

- **TOP NæŸ¥è¯¢**ï¼šä½¿ç”¨LATERAL JOIN
- **å‡½æ•°è°ƒç”¨**ï¼šä½¿ç”¨LATERAL JOIN
- **ç®€å•å…³è”**ï¼šå¯ä»¥ä½¿ç”¨å­æŸ¥è¯¢

#### Q8: CASEè¡¨è¾¾å¼å’ŒFILTERå­å¥çš„åŒºåˆ«ï¼Ÿ

**é—®é¢˜æè¿°**ï¼šä¸ç¡®å®šCASEè¡¨è¾¾å¼å’ŒFILTERå­å¥çš„åŒºåˆ«ã€‚

**æ ¸å¿ƒåŒºåˆ«**ï¼š

| ç‰¹æ€§ | CASEè¡¨è¾¾å¼ | FILTERå­å¥ |
|------|-----------|-----------|
| **ä½¿ç”¨åœºæ™¯** | æ¡ä»¶é€»è¾‘ã€æ•°æ®è½¬æ¢ | æ¡ä»¶èšåˆ |
| **æ€§èƒ½** | ä¸­ç­‰ | å¥½ |
| **å¯è¯»æ€§** | ä¸­ç­‰ | å¥½ |

**ä»£ç å¯¹æ¯”**ï¼š

```sql
-- FILTERå­å¥ï¼šæ€§èƒ½å¥½ï¼Œå¯è¯»æ€§å¥½
SELECT
    COUNT(*) FILTER (WHERE status = 'active') AS active_count,
    COUNT(*) FILTER (WHERE status = 'inactive') AS inactive_count
FROM orders;
-- æ€§èƒ½ï¼šå¥½ï¼Œå¯è¯»æ€§å¥½

-- CASEè¡¨è¾¾å¼ï¼šæ€§èƒ½ä¸­ç­‰
SELECT
    COUNT(CASE WHEN status = 'active' THEN 1 END) AS active_count,
    COUNT(CASE WHEN status = 'inactive' THEN 1 END) AS inactive_count
FROM orders;
-- æ€§èƒ½ï¼šä¸­ç­‰
```

**é€‰æ‹©å»ºè®®**ï¼š

- **æ¡ä»¶èšåˆ**ï¼šä¼˜å…ˆä½¿ç”¨FILTERå­å¥
- **æ•°æ®è½¬æ¢**ï¼šä½¿ç”¨CASEè¡¨è¾¾å¼
- **å¤æ‚æ¡ä»¶**ï¼šä½¿ç”¨CASEè¡¨è¾¾å¼

## 10. å‚è€ƒèµ„æ–™

### 10.1 å®˜æ–¹æ–‡æ¡£

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - çª—å£å‡½æ•°](https://www.postgresql.org/docs/current/tutorial-window.html)**
  - çª—å£å‡½æ•°å®Œæ•´å‚è€ƒæ‰‹å†Œ
  - åŒ…å«æ‰€æœ‰çª—å£å‡½æ•°ç‰¹æ€§çš„è¯¦ç»†è¯´æ˜

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - WITHæŸ¥è¯¢](https://www.postgresql.org/docs/current/queries-with.html)**
  - WITHæŸ¥è¯¢å®Œæ•´å‚è€ƒæ‰‹å†Œ
  - CTEå’Œé€’å½’æŸ¥è¯¢ä½¿ç”¨æŒ‡å—

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - é«˜çº§SQLç‰¹æ€§](https://www.postgresql.org/docs/current/tutorial-advanced.html)**
  - é«˜çº§SQLç‰¹æ€§å®Œæ•´å‚è€ƒæ‰‹å†Œ
  - å„ç§é«˜çº§ç‰¹æ€§ä½¿ç”¨æŒ‡å—

### 10.2 SQLæ ‡å‡†æ–‡æ¡£

- **[ISO/IEC 9075 SQL æ ‡å‡†](https://www.iso.org/standard/76583.html)**
  - SQLé«˜çº§ç‰¹æ€§æ ‡å‡†å®šä¹‰
  - PostgreSQLå¯¹SQLæ ‡å‡†çš„æ”¯æŒæƒ…å†µ

- **[PostgreSQL SQL æ ‡å‡†å…¼å®¹æ€§](https://www.postgresql.org/docs/current/features.html)**
  - PostgreSQLå¯¹SQLæ ‡å‡†çš„æ”¯æŒ
  - SQLæ ‡å‡†é«˜çº§ç‰¹æ€§å¯¹æ¯”

### 10.3 æŠ€æœ¯è®ºæ–‡

- **[Leis, V., et al. (2015). "How Good Are Query Optimizers?"](https://arxiv.org/abs/1504.01155)**
  - æŸ¥è¯¢ä¼˜åŒ–å™¨æ€§èƒ½è¯„ä¼°ç ”ç©¶
  - é«˜çº§SQLç‰¹æ€§ä¼˜åŒ–æŠ€æœ¯

- **[Graefe, G. (1995). "The Cascades Framework for Query Optimization."](https://ieeexplore.ieee.org/document/481526)**
  - æŸ¥è¯¢ä¼˜åŒ–å™¨æ¡†æ¶è®¾è®¡çš„åŸºç¡€ç ”ç©¶
  - é«˜çº§SQLç‰¹æ€§åœ¨ä¼˜åŒ–å™¨ä¸­çš„å¤„ç†

### 10.4 æŠ€æœ¯åšå®¢

- **[PostgreSQL å®˜æ–¹åšå®¢ - é«˜çº§SQLç‰¹æ€§](https://www.postgresql.org/about/newsarchive/)**
  - PostgreSQL é«˜çº§SQLç‰¹æ€§æœ€æ–°åŠ¨æ€
  - å®é™…åº”ç”¨æ¡ˆä¾‹åˆ†äº«

- **[2ndQuadrant PostgreSQL åšå®¢](https://www.2ndquadrant.com/en/blog/)**
  - PostgreSQL é«˜çº§SQLç‰¹æ€§æ–‡ç« 
  - å®é™…åº”ç”¨æ¡ˆä¾‹

- **[Percona PostgreSQL åšå®¢](https://www.percona.com/blog/tag/postgresql/)**
  - PostgreSQL é«˜çº§SQLç‰¹æ€§ä¼˜åŒ–å®è·µ
  - æ€§èƒ½ä¼˜åŒ–æ¡ˆä¾‹

### 10.5 ç¤¾åŒºèµ„æº

- **[PostgreSQL Wiki - é«˜çº§SQLç‰¹æ€§](https://wiki.postgresql.org/wiki/Advanced_SQL_features)**
  - PostgreSQL é«˜çº§SQLç‰¹æ€§Wiki
  - å¸¸è§é—®é¢˜è§£ç­”å’Œæœ€ä½³å®è·µ

- **[Stack Overflow - PostgreSQL é«˜çº§SQLç‰¹æ€§](https://stackoverflow.com/questions/tagged/postgresql+window-functions)**
  - PostgreSQL é«˜çº§SQLç‰¹æ€§ç›¸å…³é—®ç­”
  - é«˜è´¨é‡çš„é—®é¢˜å’Œç­”æ¡ˆ

- **[PostgreSQL é‚®ä»¶åˆ—è¡¨](https://www.postgresql.org/list/)**
  - PostgreSQL ç¤¾åŒºè®¨è®º
  - é«˜çº§SQLç‰¹æ€§ä½¿ç”¨é—®é¢˜äº¤æµ

### 10.6 ç›¸å…³æ–‡æ¡£

- [çª—å£å‡½æ•°è¯¦è§£](./çª—å£å‡½æ•°è¯¦è§£.md)
- [CTEè¯¦è§£](./CTEè¯¦è§£.md)
- [é€’å½’æŸ¥è¯¢è¯¦è§£](./é€’å½’æŸ¥è¯¢è¯¦è§£.md)
- [CASEè¡¨è¾¾å¼è¯¦è§£](./CASEè¡¨è¾¾å¼è¯¦è§£.md)
- [FILTERå­å¥è¯¦è§£](./FILTERå­å¥è¯¦è§£.md)
- [LATERALè¿æ¥è¯¦è§£](./LATERALè¿æ¥è¯¦è§£.md)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 03-03-06
