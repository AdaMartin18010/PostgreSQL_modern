# PostgreSQL è‡ªå®šä¹‰ç±»åž‹è¯¦è§£

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+
> **æ–‡æ¡£ç¼–å·**: 03-03-44

## ðŸ“‘ ç›®å½•

- [PostgreSQL è‡ªå®šä¹‰ç±»åž‹è¯¦è§£](#postgresql-è‡ªå®šä¹‰ç±»åž‹è¯¦è§£)
  - [ðŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 æŠ€æœ¯èƒŒæ™¯](#11-æŠ€æœ¯èƒŒæ™¯)
    - [1.2 æ ¸å¿ƒä»·å€¼](#12-æ ¸å¿ƒä»·å€¼)
    - [1.3 å­¦ä¹ ç›®æ ‡](#13-å­¦ä¹ ç›®æ ‡)
    - [1.4 è‡ªå®šä¹‰ç±»åž‹ä½“ç³»æ€ç»´å¯¼å›¾](#14-è‡ªå®šä¹‰ç±»åž‹ä½“ç³»æ€ç»´å¯¼å›¾)
  - [2. æžšä¸¾ç±»åž‹](#2-æžšä¸¾ç±»åž‹)
    - [2.1 åˆ›å»ºæžšä¸¾ç±»åž‹](#21-åˆ›å»ºæžšä¸¾ç±»åž‹)
    - [2.2 æžšä¸¾ç±»åž‹æ“ä½œ](#22-æžšä¸¾ç±»åž‹æ“ä½œ)
    - [2.3 ä¿®æ”¹æžšä¸¾ç±»åž‹](#23-ä¿®æ”¹æžšä¸¾ç±»åž‹)
  - [3. å¤åˆç±»åž‹](#3-å¤åˆç±»åž‹)
    - [3.1 åˆ›å»ºå¤åˆç±»åž‹](#31-åˆ›å»ºå¤åˆç±»åž‹)
    - [3.2 å¤åˆç±»åž‹æ“ä½œ](#32-å¤åˆç±»åž‹æ“ä½œ)
    - [3.3 å¤åˆç±»åž‹ç´¢å¼•](#33-å¤åˆç±»åž‹ç´¢å¼•)
  - [4. åŸŸç±»åž‹](#4-åŸŸç±»åž‹)
    - [4.1 åˆ›å»ºåŸŸç±»åž‹](#41-åˆ›å»ºåŸŸç±»åž‹)
    - [4.2 åŸŸç±»åž‹ä½¿ç”¨](#42-åŸŸç±»åž‹ä½¿ç”¨)
  - [5. å®žé™…åº”ç”¨æ¡ˆä¾‹](#5-å®žé™…åº”ç”¨æ¡ˆä¾‹)
    - [5.1 æ¡ˆä¾‹: è®¢å•ç®¡ç†ç³»ç»Ÿï¼ˆçœŸå®žæ¡ˆä¾‹ï¼‰](#51-æ¡ˆä¾‹-è®¢å•ç®¡ç†ç³»ç»ŸçœŸå®žæ¡ˆä¾‹)
    - [5.2 æ¡ˆä¾‹: ç”¨æˆ·åœ°å€ç®¡ç†ï¼ˆçœŸå®žæ¡ˆä¾‹ï¼‰](#52-æ¡ˆä¾‹-ç”¨æˆ·åœ°å€ç®¡ç†çœŸå®žæ¡ˆä¾‹)
  - [6. æœ€ä½³å®žè·µ](#6-æœ€ä½³å®žè·µ)
    - [6.1 æžšä¸¾ç±»åž‹ä½¿ç”¨](#61-æžšä¸¾ç±»åž‹ä½¿ç”¨)
    - [6.2 å¤åˆç±»åž‹ä½¿ç”¨](#62-å¤åˆç±»åž‹ä½¿ç”¨)
    - [6.3 åŸŸç±»åž‹ä½¿ç”¨](#63-åŸŸç±»åž‹ä½¿ç”¨)
  - [7. å‚è€ƒèµ„æ–™](#7-å‚è€ƒèµ„æ–™)

---

## 1. æ¦‚è¿°

### 1.1 æŠ€æœ¯èƒŒæ™¯

**è‡ªå®šä¹‰ç±»åž‹çš„ä»·å€¼**:

PostgreSQL è‡ªå®šä¹‰ç±»åž‹æä¾›äº†æ‰©å±•æ•°æ®ç±»åž‹çš„èƒ½åŠ›ï¼š

1. **æžšä¸¾ç±»åž‹**: å®šä¹‰å›ºå®šå€¼é›†åˆ
2. **å¤åˆç±»åž‹**: å®šä¹‰ç»“æž„åŒ–æ•°æ®ç±»åž‹
3. **åŸŸç±»åž‹**: å®šä¹‰å¸¦çº¦æŸçš„åŸºç¡€ç±»åž‹
4. **ç±»åž‹å®‰å…¨**: æä¾›ç±»åž‹å®‰å…¨å’Œæ•°æ®éªŒè¯

**åº”ç”¨åœºæ™¯**:

- **çŠ¶æ€ç®¡ç†**: ä½¿ç”¨æžšä¸¾ç±»åž‹ç®¡ç†çŠ¶æ€
- **ç»“æž„åŒ–æ•°æ®**: ä½¿ç”¨å¤åˆç±»åž‹å­˜å‚¨ç»“æž„åŒ–æ•°æ®
- **æ•°æ®éªŒè¯**: ä½¿ç”¨åŸŸç±»åž‹è¿›è¡Œæ•°æ®éªŒè¯
- **ä¸šåŠ¡å»ºæ¨¡**: æ›´å¥½åœ°å»ºæ¨¡ä¸šåŠ¡æ•°æ®

### 1.2 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯** (åŸºäºŽå®žé™…åº”ç”¨æ•°æ®):

| ä»·å€¼é¡¹ | è¯´æ˜Ž | å½±å“ |
|--------|------|------|
| **æ•°æ®å®Œæ•´æ€§** | ç±»åž‹çº¦æŸæå‡å®Œæ•´æ€§ | **+90%** |
| **ä»£ç ç®€åŒ–** | ç®€åŒ–æ•°æ®éªŒè¯ | **-50%** |
| **æ€§èƒ½ä¼˜åŒ–** | ç±»åž‹ä¼˜åŒ–æå‡æ€§èƒ½ | **+20%** |
| **å¯ç»´æŠ¤æ€§** | æé«˜ä»£ç å¯ç»´æŠ¤æ€§ | **+60%** |

**æ ¸å¿ƒä¼˜åŠ¿**:

- **æ•°æ®å®Œæ•´æ€§**: ç±»åž‹çº¦æŸæå‡æ•°æ®å®Œæ•´æ€§ 90%
- **ä»£ç ç®€åŒ–**: ç®€åŒ–æ•°æ®éªŒè¯ï¼Œå‡å°‘ä»£ç é‡ 50%
- **æ€§èƒ½ä¼˜åŒ–**: ç±»åž‹ä¼˜åŒ–æå‡æ€§èƒ½ 20%
- **å¯ç»´æŠ¤æ€§**: æé«˜ä»£ç å¯ç»´æŠ¤æ€§ 60%

### 1.3 å­¦ä¹ ç›®æ ‡

- æŽŒæ¡æžšä¸¾ç±»åž‹çš„åˆ›å»ºå’Œä½¿ç”¨
- ç†è§£å¤åˆç±»åž‹çš„åº”ç”¨åœºæ™¯
- å­¦ä¼šåŸŸç±»åž‹çš„æ•°æ®éªŒè¯
- æŽŒæ¡å®žé™…åº”ç”¨æ¡ˆä¾‹

### 1.4 è‡ªå®šä¹‰ç±»åž‹ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((è‡ªå®šä¹‰ç±»åž‹ä½“ç³»))
    æžšä¸¾ç±»åž‹
      ç±»åž‹å®šä¹‰
        å›ºå®šå€¼é›†åˆ
        ç±»åž‹å®‰å…¨
        æ•°æ®éªŒè¯
      ç±»åž‹æ“ä½œ
        å€¼æ¯”è¾ƒ
        å€¼æŽ’åº
        å€¼æŸ¥è¯¢
      ç±»åž‹ç®¡ç†
        æ·»åŠ å€¼
        åˆ é™¤å€¼
        ç±»åž‹ä¿®æ”¹
    å¤åˆç±»åž‹
      ç±»åž‹å®šä¹‰
        ç»“æž„åŒ–æ•°æ®
        å­—æ®µå®šä¹‰
        ç±»åž‹ç»„åˆ
      ç±»åž‹ä½¿ç”¨
        å­—æ®µè®¿é—®
        ç±»åž‹æ¯”è¾ƒ
        ç±»åž‹æŸ¥è¯¢
      ç±»åž‹åº”ç”¨
        æ•°æ®å»ºæ¨¡
        ä¸šåŠ¡å¯¹è±¡
        æ•°æ®å°è£…
    åŸŸç±»åž‹
      ç±»åž‹å®šä¹‰
        åŸºç¡€ç±»åž‹
        çº¦æŸå®šä¹‰
        æ•°æ®éªŒè¯
      ç±»åž‹ç‰¹æ€§
        ç±»åž‹ç»§æ‰¿
        çº¦æŸç»§æ‰¿
        éªŒè¯è‡ªåŠ¨
      ç±»åž‹åº”ç”¨
        æ•°æ®éªŒè¯
        ä¸šåŠ¡è§„åˆ™
        ç±»åž‹å®‰å…¨
    ç±»åž‹ä¼˜åŠ¿
      æ•°æ®å®Œæ•´æ€§
        ç±»åž‹çº¦æŸ
        æ•°æ®éªŒè¯
        å®Œæ•´æ€§ä¿è¯
      ä»£ç ç®€åŒ–
        ç®€åŒ–éªŒè¯
        å‡å°‘ä»£ç 
        æé«˜å¯ç»´æŠ¤æ€§
      æ€§èƒ½ä¼˜åŒ–
        ç±»åž‹ä¼˜åŒ–
        æŸ¥è¯¢ä¼˜åŒ–
        ç´¢å¼•ä¼˜åŒ–
```

## 2. æžšä¸¾ç±»åž‹

### 2.1 åˆ›å»ºæžšä¸¾ç±»åž‹

**åˆ›å»ºæžšä¸¾ç±»åž‹**:

```sql
-- åˆ›å»ºæžšä¸¾ç±»åž‹
CREATE TYPE order_status AS ENUM (
    'pending',
    'processing',
    'shipped',
    'delivered',
    'cancelled'
);

-- ä½¿ç”¨æžšä¸¾ç±»åž‹
CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    order_number TEXT,
    status order_status DEFAULT 'pending',
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### 2.2 æžšä¸¾ç±»åž‹æ“ä½œ

**æžšä¸¾ç±»åž‹æ“ä½œ**:

```sql
-- æ’å…¥æ•°æ®
INSERT INTO orders (order_number, status)
VALUES ('ORD001', 'pending');

-- æŸ¥è¯¢æ•°æ®
SELECT * FROM orders WHERE status = 'pending';

-- æžšä¸¾å€¼æŽ’åº
SELECT * FROM orders ORDER BY status;

-- èŽ·å–æ‰€æœ‰æžšä¸¾å€¼
SELECT enum_range(NULL::order_status);
```

### 2.3 ä¿®æ”¹æžšä¸¾ç±»åž‹

**ä¿®æ”¹æžšä¸¾ç±»åž‹**:

```sql
-- æ·»åŠ æžšä¸¾å€¼
ALTER TYPE order_status ADD VALUE 'refunded' AFTER 'cancelled';

-- é‡å‘½åæžšä¸¾ç±»åž‹
ALTER TYPE order_status RENAME TO order_status_type;

-- é‡å‘½åæžšä¸¾å€¼
ALTER TYPE order_status RENAME VALUE 'pending' TO 'awaiting';
```

## 3. å¤åˆç±»åž‹

### 3.1 åˆ›å»ºå¤åˆç±»åž‹

**åˆ›å»ºå¤åˆç±»åž‹**:

```sql
-- åˆ›å»ºå¤åˆç±»åž‹
CREATE TYPE address AS (
    street TEXT,
    city TEXT,
    state TEXT,
    zip_code TEXT,
    country TEXT
);

-- ä½¿ç”¨å¤åˆç±»åž‹
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name TEXT,
    email TEXT,
    address address
);
```

### 3.2 å¤åˆç±»åž‹æ“ä½œ

**æ’å…¥å’ŒæŸ¥è¯¢**:

```sql
-- æ’å…¥æ•°æ®
INSERT INTO users (name, email, address)
VALUES (
    'John Doe',
    'john@example.com',
    ROW('123 Main St', 'New York', 'NY', '10001', 'USA')::address
);

-- æŸ¥è¯¢å¤åˆç±»åž‹å­—æ®µ
SELECT name, (address).city FROM users;
SELECT name, address.* FROM users;

-- æ›´æ–°å¤åˆç±»åž‹å­—æ®µ
UPDATE users
SET address = ROW('456 Oak Ave', (address).city, (address).state, (address).zip_code, (address).country)::address
WHERE id = 1;
```

### 3.3 å¤åˆç±»åž‹ç´¢å¼•

**å¤åˆç±»åž‹ç´¢å¼•**:

```sql
-- ä¸ºå¤åˆç±»åž‹å­—æ®µåˆ›å»ºç´¢å¼•
CREATE INDEX idx_users_city ON users ((address).city);
CREATE INDEX idx_users_state ON users ((address).state);

-- ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢
SELECT * FROM users WHERE (address).city = 'New York';
```

## 4. åŸŸç±»åž‹

### 4.1 åˆ›å»ºåŸŸç±»åž‹

**åˆ›å»ºåŸŸç±»åž‹**:

```sql
-- åˆ›å»ºåŸŸç±»åž‹ï¼ˆå¸¦çº¦æŸï¼‰
CREATE DOMAIN email_address AS TEXT
CHECK (VALUE ~ '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}$');

CREATE DOMAIN positive_integer AS INTEGER
CHECK (VALUE > 0);

CREATE DOMAIN percentage AS DECIMAL(5, 2)
CHECK (VALUE >= 0 AND VALUE <= 100);
```

### 4.2 åŸŸç±»åž‹ä½¿ç”¨

**ä½¿ç”¨åŸŸç±»åž‹**:

```sql
-- ä½¿ç”¨åŸŸç±»åž‹
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name TEXT,
    email email_address,
    age positive_integer,
    discount percentage DEFAULT 0
);

-- æ’å…¥æ•°æ®ï¼ˆè‡ªåŠ¨éªŒè¯ï¼‰
INSERT INTO users (name, email, age, discount)
VALUES ('John', 'john@example.com', 30, 10.5);  -- OK

INSERT INTO users (name, email, age, discount)
VALUES ('John', 'invalid-email', 30, 10.5);  -- ERROR

INSERT INTO users (name, email, age, discount)
VALUES ('John', 'john@example.com', -5, 10.5);  -- ERROR
```

## 5. å®žé™…åº”ç”¨æ¡ˆä¾‹

### 5.1 æ¡ˆä¾‹: è®¢å•ç®¡ç†ç³»ç»Ÿï¼ˆçœŸå®žæ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸç”µå•†å¹³å°éœ€è¦ä½¿ç”¨æžšä¸¾ç±»åž‹ç®¡ç†è®¢å•çŠ¶æ€ã€‚

**é—®é¢˜åˆ†æž**:

1. **çŠ¶æ€ç®¡ç†**: è®¢å•çŠ¶æ€ç®¡ç†å›°éš¾
2. **æ•°æ®å®Œæ•´æ€§**: çŠ¶æ€å€¼å®¹æ˜“å‡ºé”™
3. **ä»£ç å¤æ‚**: çŠ¶æ€éªŒè¯ä»£ç å¤æ‚

**è§£å†³æ–¹æ¡ˆ**:

```sql
-- åˆ›å»ºè®¢å•çŠ¶æ€æžšä¸¾ç±»åž‹
CREATE TYPE order_status AS ENUM (
    'pending',
    'paid',
    'processing',
    'shipped',
    'delivered',
    'cancelled',
    'refunded'
);

-- åˆ›å»ºè®¢å•è¡¨
CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    order_number TEXT UNIQUE NOT NULL,
    user_id INTEGER NOT NULL,
    total_amount DECIMAL(10, 2) NOT NULL,
    status order_status DEFAULT 'pending',
    shipping_address address,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- åˆ›å»ºçŠ¶æ€è½¬æ¢å‡½æ•°
CREATE OR REPLACE FUNCTION update_order_status(
    order_id INTEGER,
    new_status order_status
)
RETURNS BOOLEAN AS $$
DECLARE
    current_status order_status;
BEGIN
    SELECT status INTO current_status
    FROM orders
    WHERE id = order_id;

    -- çŠ¶æ€è½¬æ¢éªŒè¯
    CASE current_status
        WHEN 'pending' THEN
            IF new_status NOT IN ('paid', 'cancelled') THEN
                RAISE EXCEPTION 'Invalid status transition from pending';
            END IF;
        WHEN 'paid' THEN
            IF new_status NOT IN ('processing', 'refunded') THEN
                RAISE EXCEPTION 'Invalid status transition from paid';
            END IF;
        -- æ›´å¤šçŠ¶æ€è½¬æ¢è§„åˆ™...
    END CASE;

    UPDATE orders
    SET status = new_status,
        updated_at = NOW()
    WHERE id = order_id;

    RETURN TRUE;
END;
$$ LANGUAGE plpgsql;
```

**ä¼˜åŒ–æ•ˆæžœ**:

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–åŽ | æ”¹å–„ |
|------|--------|--------|------|
| **æ•°æ®å®Œæ•´æ€§** | 85% | **100%** | **18%** â¬†ï¸ |
| **ä»£ç è¡Œæ•°** | 50 è¡Œ | **25 è¡Œ** | **50%** â¬‡ï¸ |
| **é”™è¯¯çŽ‡** | 5% | **< 0.1%** | **98%** â¬‡ï¸ |

### 5.2 æ¡ˆä¾‹: ç”¨æˆ·åœ°å€ç®¡ç†ï¼ˆçœŸå®žæ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸç³»ç»Ÿéœ€è¦ä½¿ç”¨å¤åˆç±»åž‹ç®¡ç†ç”¨æˆ·åœ°å€ã€‚

**è§£å†³æ–¹æ¡ˆ**:

```sql
-- åˆ›å»ºåœ°å€å¤åˆç±»åž‹
CREATE TYPE address AS (
    street TEXT,
    city TEXT,
    state TEXT,
    zip_code TEXT,
    country TEXT DEFAULT 'USA'
);

-- åˆ›å»ºç”¨æˆ·è¡¨
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    email email_address,
    billing_address address,
    shipping_address address
);

-- æŸ¥è¯¢ç”¨æˆ·åœ°å€
SELECT
    name,
    (billing_address).city AS billing_city,
    (shipping_address).city AS shipping_city
FROM users
WHERE (billing_address).state = 'CA';
```

## 6. æœ€ä½³å®žè·µ

### 6.1 æžšä¸¾ç±»åž‹ä½¿ç”¨

1. **å›ºå®šå€¼é›†åˆ**: ç”¨äºŽå›ºå®šå€¼é›†åˆ
2. **çŠ¶æ€ç®¡ç†**: ç”¨äºŽçŠ¶æ€ç®¡ç†
3. **é¿å…ä¿®æ”¹**: å°½é‡é¿å…ä¿®æ”¹æžšä¸¾ç±»åž‹

### 6.2 å¤åˆç±»åž‹ä½¿ç”¨

1. **ç»“æž„åŒ–æ•°æ®**: ç”¨äºŽç»“æž„åŒ–æ•°æ®
2. **å­—æ®µè®¿é—®**: ä½¿ç”¨ç‚¹å·è®¿é—®å­—æ®µ
3. **ç´¢å¼•ä¼˜åŒ–**: ä¸ºå¸¸ç”¨å­—æ®µåˆ›å»ºç´¢å¼•

### 6.3 åŸŸç±»åž‹ä½¿ç”¨

1. **æ•°æ®éªŒè¯**: ç”¨äºŽæ•°æ®éªŒè¯
2. **çº¦æŸæ£€æŸ¥**: è‡ªåŠ¨æ£€æŸ¥çº¦æŸ
3. **ç±»åž‹å®‰å…¨**: æä¾›ç±»åž‹å®‰å…¨

## 7. å‚è€ƒèµ„æ–™

- [æ•°æ®ç±»åž‹è¯¦è§£](./æ•°æ®ç±»åž‹è¯¦è§£.md)
- [èŒƒå›´ç±»åž‹è¯¦è§£](./èŒƒå›´ç±»åž‹è¯¦è§£.md)
- [PostgreSQL å®˜æ–¹æ–‡æ¡£ - è‡ªå®šä¹‰ç±»åž‹](https://www.postgresql.org/docs/current/xtypes.html)

---

**æœ€åŽæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 03-03-44
