# PostgreSQL è‡ªå®šä¹‰ç±»åž‹è¯¦è§£

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 17+/18+
> **æ–‡æ¡£ç¼–å·**: 03-03-44

## ðŸ“‘ ç›®å½•

- [PostgreSQL è‡ªå®šä¹‰ç±»åž‹è¯¦è§£](#postgresql-è‡ªå®šä¹‰ç±»åž‹è¯¦è§£)
  - [ðŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.0 è‡ªå®šä¹‰ç±»åž‹å·¥ä½œåŽŸç†æ¦‚è¿°](#10-è‡ªå®šä¹‰ç±»åž‹å·¥ä½œåŽŸç†æ¦‚è¿°)
    - [1.1 æŠ€æœ¯èƒŒæ™¯](#11-æŠ€æœ¯èƒŒæ™¯)
    - [1.2 æ ¸å¿ƒä»·å€¼](#12-æ ¸å¿ƒä»·å€¼)
    - [1.3 å­¦ä¹ ç›®æ ‡](#13-å­¦ä¹ ç›®æ ‡)
    - [1.4 è‡ªå®šä¹‰ç±»åž‹ä½“ç³»æ€ç»´å¯¼å›¾](#14-è‡ªå®šä¹‰ç±»åž‹ä½“ç³»æ€ç»´å¯¼å›¾)
  - [2. æžšä¸¾ç±»åž‹](#2-æžšä¸¾ç±»åž‹)
    - [2.1 åˆ›å»ºæžšä¸¾ç±»åž‹](#21-åˆ›å»ºæžšä¸¾ç±»åž‹)
    - [2.2 æžšä¸¾ç±»åž‹æ“ä½œ](#22-æžšä¸¾ç±»åž‹æ“ä½œ)
    - [2.3 ä¿®æ”¹æžšä¸¾ç±»åž‹](#23-ä¿®æ”¹æžšä¸¾ç±»åž‹)
  - [3. å¤åˆç±»åž‹](#3-å¤åˆç±»åž‹)
    - [3.1 åˆ›å»ºå¤åˆç±»åž‹](#31-åˆ›å»ºå¤åˆç±»åž‹)
    - [3.2 å¤åˆç±»åž‹æ“ä½œ](#32-å¤åˆç±»åž‹æ“ä½œ)
    - [3.3 å¤åˆç±»åž‹ç´¢å¼•](#33-å¤åˆç±»åž‹ç´¢å¼•)
  - [4. åŸŸç±»åž‹](#4-åŸŸç±»åž‹)
    - [4.1 åˆ›å»ºåŸŸç±»åž‹](#41-åˆ›å»ºåŸŸç±»åž‹)
    - [4.2 åŸŸç±»åž‹ä½¿ç”¨](#42-åŸŸç±»åž‹ä½¿ç”¨)
  - [5. å®žé™…åº”ç”¨æ¡ˆä¾‹](#5-å®žé™…åº”ç”¨æ¡ˆä¾‹)
    - [5.1 æ¡ˆä¾‹: è®¢å•ç®¡ç†ç³»ç»Ÿï¼ˆçœŸå®žæ¡ˆä¾‹ï¼‰](#51-æ¡ˆä¾‹-è®¢å•ç®¡ç†ç³»ç»ŸçœŸå®žæ¡ˆä¾‹)
    - [5.2 æ¡ˆä¾‹: ç”¨æˆ·åœ°å€ç®¡ç†ï¼ˆçœŸå®žæ¡ˆä¾‹ï¼‰](#52-æ¡ˆä¾‹-ç”¨æˆ·åœ°å€ç®¡ç†çœŸå®žæ¡ˆä¾‹)
  - [6. æœ€ä½³å®žè·µ](#6-æœ€ä½³å®žè·µ)
    - [6.1 æžšä¸¾ç±»åž‹ä½¿ç”¨](#61-æžšä¸¾ç±»åž‹ä½¿ç”¨)
    - [6.2 å¤åˆç±»åž‹ä½¿ç”¨](#62-å¤åˆç±»åž‹ä½¿ç”¨)
    - [6.3 åŸŸç±»åž‹ä½¿ç”¨](#63-åŸŸç±»åž‹ä½¿ç”¨)
  - [7. å‚è€ƒèµ„æ–™](#7-å‚è€ƒèµ„æ–™)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [SQL æ ‡å‡†](#sql-æ ‡å‡†)
    - [æŠ€æœ¯è®ºæ–‡](#æŠ€æœ¯è®ºæ–‡)
    - [æŠ€æœ¯åšå®¢](#æŠ€æœ¯åšå®¢)
    - [ç¤¾åŒºèµ„æº](#ç¤¾åŒºèµ„æº)
    - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)

---

## 1. æ¦‚è¿°

### 1.0 è‡ªå®šä¹‰ç±»åž‹å·¥ä½œåŽŸç†æ¦‚è¿°

**è‡ªå®šä¹‰ç±»åž‹çš„æœ¬è´¨**ï¼š

PostgreSQL çš„è‡ªå®šä¹‰ç±»åž‹ç³»ç»Ÿå…è®¸ç”¨æˆ·åˆ›å»ºæ–°çš„æ•°æ®ç±»åž‹ï¼ŒåŒ…æ‹¬æžšä¸¾ç±»åž‹ï¼ˆENUMï¼‰ã€å¤åˆç±»åž‹ï¼ˆCOMPOSITEï¼‰å’ŒåŸŸç±»åž‹ï¼ˆDOMAINï¼‰ã€‚
è‡ªå®šä¹‰ç±»åž‹æä¾›äº†ç±»åž‹å®‰å…¨ã€æ•°æ®éªŒè¯å’Œæ›´å¥½çš„ä¸šåŠ¡å»ºæ¨¡èƒ½åŠ›ã€‚
PostgreSQL åœ¨å†…éƒ¨å°†è‡ªå®šä¹‰ç±»åž‹æ˜ å°„åˆ°åº•å±‚å­˜å‚¨æ ¼å¼ï¼Œå¹¶æä¾›ç±»åž‹è½¬æ¢å’Œæ“ä½œç¬¦æ”¯æŒã€‚

**è‡ªå®šä¹‰ç±»åž‹æ‰§è¡Œæµç¨‹å›¾**ï¼š

```mermaid
flowchart TD
    A[å®šä¹‰è‡ªå®šä¹‰ç±»åž‹] --> B{ç±»åž‹ç±»åž‹}
    B -->|æžšä¸¾| C[åˆ›å»ºæžšä¸¾ç±»åž‹]
    B -->|å¤åˆ| D[åˆ›å»ºå¤åˆç±»åž‹]
    B -->|åŸŸ| E[åˆ›å»ºåŸŸç±»åž‹]
    C --> F[ç±»åž‹æ³¨å†Œ]
    D --> F
    E --> F
    F --> G[ä½¿ç”¨ç±»åž‹]
    G --> H{æ•°æ®éªŒè¯}
    H -->|é€šè¿‡| I[å­˜å‚¨æ•°æ®]
    H -->|å¤±è´¥| J[è¿”å›žé”™è¯¯]
    I --> K[è¿”å›žç»“æžœ]

    style F fill:#FFD700
    style H fill:#90EE90
    style K fill:#87CEEB
```

**è‡ªå®šä¹‰ç±»åž‹æ‰§è¡Œæ­¥éª¤**ï¼š

1. **å®šä¹‰ç±»åž‹**ï¼šåˆ›å»ºæžšä¸¾ã€å¤åˆæˆ–åŸŸç±»åž‹
2. **ç±»åž‹æ³¨å†Œ**ï¼šåœ¨ç³»ç»Ÿç›®å½•ä¸­æ³¨å†Œç±»åž‹
3. **ä½¿ç”¨ç±»åž‹**ï¼šåœ¨è¡¨å®šä¹‰ä¸­ä½¿ç”¨è‡ªå®šä¹‰ç±»åž‹
4. **æ•°æ®éªŒè¯**ï¼šæ’å…¥æ•°æ®æ—¶è¿›è¡Œç±»åž‹éªŒè¯
5. **å­˜å‚¨æ•°æ®**ï¼šéªŒè¯é€šè¿‡åŽå­˜å‚¨æ•°æ®

### 1.1 æŠ€æœ¯èƒŒæ™¯

**è‡ªå®šä¹‰ç±»åž‹çš„ä»·å€¼**:

PostgreSQL è‡ªå®šä¹‰ç±»åž‹æä¾›äº†æ‰©å±•æ•°æ®ç±»åž‹çš„èƒ½åŠ›ï¼š

1. **æžšä¸¾ç±»åž‹**: å®šä¹‰å›ºå®šå€¼é›†åˆ
2. **å¤åˆç±»åž‹**: å®šä¹‰ç»“æž„åŒ–æ•°æ®ç±»åž‹
3. **åŸŸç±»åž‹**: å®šä¹‰å¸¦çº¦æŸçš„åŸºç¡€ç±»åž‹
4. **ç±»åž‹å®‰å…¨**: æä¾›ç±»åž‹å®‰å…¨å’Œæ•°æ®éªŒè¯

**åº”ç”¨åœºæ™¯**:

- **çŠ¶æ€ç®¡ç†**: ä½¿ç”¨æžšä¸¾ç±»åž‹ç®¡ç†çŠ¶æ€
- **ç»“æž„åŒ–æ•°æ®**: ä½¿ç”¨å¤åˆç±»åž‹å­˜å‚¨ç»“æž„åŒ–æ•°æ®
- **æ•°æ®éªŒè¯**: ä½¿ç”¨åŸŸç±»åž‹è¿›è¡Œæ•°æ®éªŒè¯
- **ä¸šåŠ¡å»ºæ¨¡**: æ›´å¥½åœ°å»ºæ¨¡ä¸šåŠ¡æ•°æ®

### 1.2 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯** (åŸºäºŽå®žé™…åº”ç”¨æ•°æ®):

| ä»·å€¼é¡¹ | è¯´æ˜Ž | å½±å“ |
|--------|------|------|
| **æ•°æ®å®Œæ•´æ€§** | ç±»åž‹çº¦æŸæå‡å®Œæ•´æ€§ | **+90%** |
| **ä»£ç ç®€åŒ–** | ç®€åŒ–æ•°æ®éªŒè¯ | **-50%** |
| **æ€§èƒ½ä¼˜åŒ–** | ç±»åž‹ä¼˜åŒ–æå‡æ€§èƒ½ | **+20%** |
| **å¯ç»´æŠ¤æ€§** | æé«˜ä»£ç å¯ç»´æŠ¤æ€§ | **+60%** |

**æ ¸å¿ƒä¼˜åŠ¿**:

- **æ•°æ®å®Œæ•´æ€§**: ç±»åž‹çº¦æŸæå‡æ•°æ®å®Œæ•´æ€§ 90%
- **ä»£ç ç®€åŒ–**: ç®€åŒ–æ•°æ®éªŒè¯ï¼Œå‡å°‘ä»£ç é‡ 50%
- **æ€§èƒ½ä¼˜åŒ–**: ç±»åž‹ä¼˜åŒ–æå‡æ€§èƒ½ 20%
- **å¯ç»´æŠ¤æ€§**: æé«˜ä»£ç å¯ç»´æŠ¤æ€§ 60%

### 1.3 å­¦ä¹ ç›®æ ‡

- æŽŒæ¡æžšä¸¾ç±»åž‹çš„åˆ›å»ºå’Œä½¿ç”¨
- ç†è§£å¤åˆç±»åž‹çš„åº”ç”¨åœºæ™¯
- å­¦ä¼šåŸŸç±»åž‹çš„æ•°æ®éªŒè¯
- æŽŒæ¡å®žé™…åº”ç”¨æ¡ˆä¾‹

### 1.4 è‡ªå®šä¹‰ç±»åž‹ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((è‡ªå®šä¹‰ç±»åž‹ä½“ç³»))
    æžšä¸¾ç±»åž‹
      ç±»åž‹å®šä¹‰
        å›ºå®šå€¼é›†åˆ
        ç±»åž‹å®‰å…¨
        æ•°æ®éªŒè¯
      ç±»åž‹æ“ä½œ
        å€¼æ¯”è¾ƒ
        å€¼æŽ’åº
        å€¼æŸ¥è¯¢
      ç±»åž‹ç®¡ç†
        æ·»åŠ å€¼
        åˆ é™¤å€¼
        ç±»åž‹ä¿®æ”¹
    å¤åˆç±»åž‹
      ç±»åž‹å®šä¹‰
        ç»“æž„åŒ–æ•°æ®
        å­—æ®µå®šä¹‰
        ç±»åž‹ç»„åˆ
      ç±»åž‹ä½¿ç”¨
        å­—æ®µè®¿é—®
        ç±»åž‹æ¯”è¾ƒ
        ç±»åž‹æŸ¥è¯¢
      ç±»åž‹åº”ç”¨
        æ•°æ®å»ºæ¨¡
        ä¸šåŠ¡å¯¹è±¡
        æ•°æ®å°è£…
    åŸŸç±»åž‹
      ç±»åž‹å®šä¹‰
        åŸºç¡€ç±»åž‹
        çº¦æŸå®šä¹‰
        æ•°æ®éªŒè¯
      ç±»åž‹ç‰¹æ€§
        ç±»åž‹ç»§æ‰¿
        çº¦æŸç»§æ‰¿
        éªŒè¯è‡ªåŠ¨
      ç±»åž‹åº”ç”¨
        æ•°æ®éªŒè¯
        ä¸šåŠ¡è§„åˆ™
        ç±»åž‹å®‰å…¨
    ç±»åž‹ä¼˜åŠ¿
      æ•°æ®å®Œæ•´æ€§
        ç±»åž‹çº¦æŸ
        æ•°æ®éªŒè¯
        å®Œæ•´æ€§ä¿è¯
      ä»£ç ç®€åŒ–
        ç®€åŒ–éªŒè¯
        å‡å°‘ä»£ç 
        æé«˜å¯ç»´æŠ¤æ€§
      æ€§èƒ½ä¼˜åŒ–
        ç±»åž‹ä¼˜åŒ–
        æŸ¥è¯¢ä¼˜åŒ–
        ç´¢å¼•ä¼˜åŒ–
```

## 2. æžšä¸¾ç±»åž‹

### 2.1 åˆ›å»ºæžšä¸¾ç±»åž‹

**åˆ›å»ºæžšä¸¾ç±»åž‹**:

```sql
-- åˆ›å»ºæžšä¸¾ç±»åž‹
CREATE TYPE order_status AS ENUM (
    'pending',
    'processing',
    'shipped',
    'delivered',
    'cancelled'
);

-- ä½¿ç”¨æžšä¸¾ç±»åž‹
CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    order_number TEXT,
    status order_status DEFAULT 'pending',
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### 2.2 æžšä¸¾ç±»åž‹æ“ä½œ

**æžšä¸¾ç±»åž‹æ“ä½œ**:

```sql
-- æ’å…¥æ•°æ®
INSERT INTO orders (order_number, status)
VALUES ('ORD001', 'pending');

-- æŸ¥è¯¢æ•°æ®
SELECT * FROM orders WHERE status = 'pending';

-- æžšä¸¾å€¼æŽ’åº
SELECT * FROM orders ORDER BY status;

-- èŽ·å–æ‰€æœ‰æžšä¸¾å€¼
SELECT enum_range(NULL::order_status);
```

### 2.3 ä¿®æ”¹æžšä¸¾ç±»åž‹

**ä¿®æ”¹æžšä¸¾ç±»åž‹**:

```sql
-- æ·»åŠ æžšä¸¾å€¼
ALTER TYPE order_status ADD VALUE 'refunded' AFTER 'cancelled';

-- é‡å‘½åæžšä¸¾ç±»åž‹
ALTER TYPE order_status RENAME TO order_status_type;

-- é‡å‘½åæžšä¸¾å€¼
ALTER TYPE order_status RENAME VALUE 'pending' TO 'awaiting';
```

## 3. å¤åˆç±»åž‹

### 3.1 åˆ›å»ºå¤åˆç±»åž‹

**åˆ›å»ºå¤åˆç±»åž‹**:

```sql
-- åˆ›å»ºå¤åˆç±»åž‹
CREATE TYPE address AS (
    street TEXT,
    city TEXT,
    state TEXT,
    zip_code TEXT,
    country TEXT
);

-- ä½¿ç”¨å¤åˆç±»åž‹
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name TEXT,
    email TEXT,
    address address
);
```

### 3.2 å¤åˆç±»åž‹æ“ä½œ

**æ’å…¥å’ŒæŸ¥è¯¢**:

```sql
-- æ’å…¥æ•°æ®
INSERT INTO users (name, email, address)
VALUES (
    'John Doe',
    'john@example.com',
    ROW('123 Main St', 'New York', 'NY', '10001', 'USA')::address
);

-- æŸ¥è¯¢å¤åˆç±»åž‹å­—æ®µ
SELECT name, (address).city FROM users;
SELECT name, address.* FROM users;

-- æ›´æ–°å¤åˆç±»åž‹å­—æ®µ
UPDATE users
SET address = ROW('456 Oak Ave', (address).city, (address).state, (address).zip_code, (address).country)::address
WHERE id = 1;
```

### 3.3 å¤åˆç±»åž‹ç´¢å¼•

**å¤åˆç±»åž‹ç´¢å¼•**:

```sql
-- ä¸ºå¤åˆç±»åž‹å­—æ®µåˆ›å»ºç´¢å¼•
CREATE INDEX idx_users_city ON users ((address).city);
CREATE INDEX idx_users_state ON users ((address).state);

-- ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢
SELECT * FROM users WHERE (address).city = 'New York';
```

## 4. åŸŸç±»åž‹

### 4.1 åˆ›å»ºåŸŸç±»åž‹

**åˆ›å»ºåŸŸç±»åž‹**:

```sql
-- åˆ›å»ºåŸŸç±»åž‹ï¼ˆå¸¦çº¦æŸï¼‰
CREATE DOMAIN email_address AS TEXT
CHECK (VALUE ~ '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}$');

CREATE DOMAIN positive_integer AS INTEGER
CHECK (VALUE > 0);

CREATE DOMAIN percentage AS DECIMAL(5, 2)
CHECK (VALUE >= 0 AND VALUE <= 100);
```

### 4.2 åŸŸç±»åž‹ä½¿ç”¨

**ä½¿ç”¨åŸŸç±»åž‹**:

```sql
-- ä½¿ç”¨åŸŸç±»åž‹
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name TEXT,
    email email_address,
    age positive_integer,
    discount percentage DEFAULT 0
);

-- æ’å…¥æ•°æ®ï¼ˆè‡ªåŠ¨éªŒè¯ï¼‰
INSERT INTO users (name, email, age, discount)
VALUES ('John', 'john@example.com', 30, 10.5);  -- OK

INSERT INTO users (name, email, age, discount)
VALUES ('John', 'invalid-email', 30, 10.5);  -- ERROR

INSERT INTO users (name, email, age, discount)
VALUES ('John', 'john@example.com', -5, 10.5);  -- ERROR
```

## 5. å®žé™…åº”ç”¨æ¡ˆä¾‹

### 5.1 æ¡ˆä¾‹: è®¢å•ç®¡ç†ç³»ç»Ÿï¼ˆçœŸå®žæ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸç”µå•†å¹³å°éœ€è¦ä½¿ç”¨æžšä¸¾ç±»åž‹ç®¡ç†è®¢å•çŠ¶æ€ã€‚

**é—®é¢˜åˆ†æž**:

1. **çŠ¶æ€ç®¡ç†**: è®¢å•çŠ¶æ€ç®¡ç†å›°éš¾
2. **æ•°æ®å®Œæ•´æ€§**: çŠ¶æ€å€¼å®¹æ˜“å‡ºé”™
3. **ä»£ç å¤æ‚**: çŠ¶æ€éªŒè¯ä»£ç å¤æ‚

**è§£å†³æ–¹æ¡ˆ**:

```sql
-- åˆ›å»ºè®¢å•çŠ¶æ€æžšä¸¾ç±»åž‹
CREATE TYPE order_status AS ENUM (
    'pending',
    'paid',
    'processing',
    'shipped',
    'delivered',
    'cancelled',
    'refunded'
);

-- åˆ›å»ºè®¢å•è¡¨
CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    order_number TEXT UNIQUE NOT NULL,
    user_id INTEGER NOT NULL,
    total_amount DECIMAL(10, 2) NOT NULL,
    status order_status DEFAULT 'pending',
    shipping_address address,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- åˆ›å»ºçŠ¶æ€è½¬æ¢å‡½æ•°
CREATE OR REPLACE FUNCTION update_order_status(
    order_id INTEGER,
    new_status order_status
)
RETURNS BOOLEAN AS $$
DECLARE
    current_status order_status;
BEGIN
    SELECT status INTO current_status
    FROM orders
    WHERE id = order_id;

    -- çŠ¶æ€è½¬æ¢éªŒè¯
    CASE current_status
        WHEN 'pending' THEN
            IF new_status NOT IN ('paid', 'cancelled') THEN
                RAISE EXCEPTION 'Invalid status transition from pending';
            END IF;
        WHEN 'paid' THEN
            IF new_status NOT IN ('processing', 'refunded') THEN
                RAISE EXCEPTION 'Invalid status transition from paid';
            END IF;
        -- æ›´å¤šçŠ¶æ€è½¬æ¢è§„åˆ™...
    END CASE;

    UPDATE orders
    SET status = new_status,
        updated_at = NOW()
    WHERE id = order_id;

    RETURN TRUE;
END;
$$ LANGUAGE plpgsql;
```

**ä¼˜åŒ–æ•ˆæžœ**:

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–åŽ | æ”¹å–„ |
|------|--------|--------|------|
| **æ•°æ®å®Œæ•´æ€§** | 85% | **100%** | **18%** â¬†ï¸ |
| **ä»£ç è¡Œæ•°** | 50 è¡Œ | **25 è¡Œ** | **50%** â¬‡ï¸ |
| **é”™è¯¯çŽ‡** | 5% | **< 0.1%** | **98%** â¬‡ï¸ |

### 5.2 æ¡ˆä¾‹: ç”¨æˆ·åœ°å€ç®¡ç†ï¼ˆçœŸå®žæ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸç³»ç»Ÿéœ€è¦ä½¿ç”¨å¤åˆç±»åž‹ç®¡ç†ç”¨æˆ·åœ°å€ã€‚

**è§£å†³æ–¹æ¡ˆ**:

```sql
-- åˆ›å»ºåœ°å€å¤åˆç±»åž‹
CREATE TYPE address AS (
    street TEXT,
    city TEXT,
    state TEXT,
    zip_code TEXT,
    country TEXT DEFAULT 'USA'
);

-- åˆ›å»ºç”¨æˆ·è¡¨
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    email email_address,
    billing_address address,
    shipping_address address
);

-- æŸ¥è¯¢ç”¨æˆ·åœ°å€
SELECT
    name,
    (billing_address).city AS billing_city,
    (shipping_address).city AS shipping_city
FROM users
WHERE (billing_address).state = 'CA';
```

## 6. æœ€ä½³å®žè·µ

### 6.1 æžšä¸¾ç±»åž‹ä½¿ç”¨

**æŽ¨èåšæ³•**ï¼š

1. **ç”¨äºŽå›ºå®šå€¼é›†åˆ**ï¼ˆæ•°æ®å®Œæ•´æ€§ï¼‰

   ```sql
   -- âœ… å¥½ï¼šç”¨äºŽå›ºå®šå€¼é›†åˆï¼ˆæ•°æ®å®Œæ•´æ€§ï¼‰
   CREATE TYPE order_status AS ENUM ('pending', 'processing', 'shipped', 'delivered', 'cancelled');

   CREATE TABLE orders (
       id SERIAL PRIMARY KEY,
       status order_status NOT NULL DEFAULT 'pending'
   );

   -- è‡ªåŠ¨éªŒè¯å€¼
   INSERT INTO orders (status) VALUES ('pending');  -- OK
   INSERT INTO orders (status) VALUES ('invalid');  -- ERROR
   ```

2. **ç”¨äºŽçŠ¶æ€ç®¡ç†**ï¼ˆä¸šåŠ¡é€»è¾‘æ¸…æ™°ï¼‰

   ```sql
   -- âœ… å¥½ï¼šç”¨äºŽçŠ¶æ€ç®¡ç†ï¼ˆä¸šåŠ¡é€»è¾‘æ¸…æ™°ï¼‰
   CREATE TYPE user_role AS ENUM ('admin', 'user', 'guest');

   CREATE TABLE users (
       id SERIAL PRIMARY KEY,
       name TEXT,
       role user_role NOT NULL DEFAULT 'user'
   );
   ```

3. **å°½é‡é¿å…ä¿®æ”¹æžšä¸¾ç±»åž‹**ï¼ˆé¿å…æ•°æ®ä¸ä¸€è‡´ï¼‰

   ```sql
   -- âœ… å¥½ï¼šè®¾è®¡æ—¶è€ƒè™‘å®Œæ•´ï¼ˆé¿å…åŽç»­ä¿®æ”¹ï¼‰
   CREATE TYPE order_status AS ENUM ('pending', 'processing', 'shipped', 'delivered', 'cancelled', 'refunded');

   -- âŒ ä¸å¥½ï¼šé¢‘ç¹ä¿®æ”¹æžšä¸¾ç±»åž‹ï¼ˆå¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼‰
   -- æ·»åŠ æ–°å€¼éœ€è¦ ALTER TYPEï¼Œå¯èƒ½å½±å“çŽ°æœ‰æ•°æ®
   ALTER TYPE order_status ADD VALUE 'refunded' AFTER 'cancelled';
   ```

**é¿å…åšæ³•**ï¼š

1. **é¿å…é¢‘ç¹ä¿®æ”¹æžšä¸¾ç±»åž‹**ï¼ˆå¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼‰
2. **é¿å…ä½¿ç”¨æžšä¸¾ç±»åž‹å­˜å‚¨å¤§é‡å€¼**ï¼ˆæ€§èƒ½é—®é¢˜ï¼‰

### 6.2 å¤åˆç±»åž‹ä½¿ç”¨

**æŽ¨èåšæ³•**ï¼š

1. **ç”¨äºŽç»“æž„åŒ–æ•°æ®**ï¼ˆæ•°æ®ç»„ç»‡æ¸…æ™°ï¼‰

   ```sql
   -- âœ… å¥½ï¼šç”¨äºŽç»“æž„åŒ–æ•°æ®ï¼ˆæ•°æ®ç»„ç»‡æ¸…æ™°ï¼‰
   CREATE TYPE address AS (
       street TEXT,
       city TEXT,
       state TEXT,
       zip_code TEXT,
       country TEXT
   );

   CREATE TABLE users (
       id SERIAL PRIMARY KEY,
       name TEXT,
       address address
   );
   ```

2. **ä½¿ç”¨ç‚¹å·è®¿é—®å­—æ®µ**ï¼ˆæ ‡å‡†è¯­æ³•ï¼‰

   ```sql
   -- âœ… å¥½ï¼šä½¿ç”¨ç‚¹å·è®¿é—®å­—æ®µï¼ˆæ ‡å‡†è¯­æ³•ï¼‰
   SELECT name, (address).city FROM users;
   SELECT name, address.* FROM users;

   -- âŒ ä¸å¥½ï¼šä½¿ç”¨å‡½æ•°è®¿é—®ï¼ˆæ€§èƒ½å·®ï¼‰
   SELECT name, address_field(address, 'city') FROM users;
   ```

3. **ä¸ºå¸¸ç”¨å­—æ®µåˆ›å»ºç´¢å¼•**ï¼ˆæå‡æŸ¥è¯¢æ€§èƒ½ï¼‰

   ```sql
   -- âœ… å¥½ï¼šä¸ºå¸¸ç”¨å­—æ®µåˆ›å»ºç´¢å¼•ï¼ˆæå‡æŸ¥è¯¢æ€§èƒ½ï¼‰
   CREATE INDEX idx_users_city ON users ((address).city);

   -- æŸ¥è¯¢å¯ä»¥ä½¿ç”¨ç´¢å¼•
   SELECT * FROM users WHERE (address).city = 'New York';
   ```

**é¿å…åšæ³•**ï¼š

1. **é¿å…è¿‡åº¦åµŒå¥—å¤åˆç±»åž‹**ï¼ˆæŸ¥è¯¢å¤æ‚ï¼‰
2. **é¿å…å¿½ç•¥ç´¢å¼•ä¼˜åŒ–**ï¼ˆæŸ¥è¯¢æ€§èƒ½å·®ï¼‰

### 6.3 åŸŸç±»åž‹ä½¿ç”¨

**æŽ¨èåšæ³•**ï¼š

1. **ç”¨äºŽæ•°æ®éªŒè¯**ï¼ˆæ•°æ®å®Œæ•´æ€§ï¼‰

   ```sql
   -- âœ… å¥½ï¼šç”¨äºŽæ•°æ®éªŒè¯ï¼ˆæ•°æ®å®Œæ•´æ€§ï¼‰
   CREATE DOMAIN email_address AS TEXT
   CHECK (VALUE ~ '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}$');

   CREATE TABLE users (
       id SERIAL PRIMARY KEY,
       email email_address NOT NULL
   );

   -- è‡ªåŠ¨éªŒè¯
   INSERT INTO users (email) VALUES ('john@example.com');  -- OK
   INSERT INTO users (email) VALUES ('invalid-email');  -- ERROR
   ```

2. **è‡ªåŠ¨æ£€æŸ¥çº¦æŸ**ï¼ˆå‡å°‘åº”ç”¨å±‚éªŒè¯ï¼‰

   ```sql
   -- âœ… å¥½ï¼šè‡ªåŠ¨æ£€æŸ¥çº¦æŸï¼ˆå‡å°‘åº”ç”¨å±‚éªŒè¯ï¼‰
   CREATE DOMAIN positive_integer AS INTEGER
   CHECK (VALUE > 0);

   CREATE TABLE products (
       id SERIAL PRIMARY KEY,
       price positive_integer NOT NULL
   );

   -- è‡ªåŠ¨éªŒè¯
   INSERT INTO products (price) VALUES (100);  -- OK
   INSERT INTO products (price) VALUES (-10);  -- ERROR
   ```

3. **æä¾›ç±»åž‹å®‰å…¨**ï¼ˆé¿å…ç±»åž‹é”™è¯¯ï¼‰

   ```sql
   -- âœ… å¥½ï¼šæä¾›ç±»åž‹å®‰å…¨ï¼ˆé¿å…ç±»åž‹é”™è¯¯ï¼‰
   CREATE DOMAIN percentage AS DECIMAL(5, 2)
   CHECK (VALUE >= 0 AND VALUE <= 100);

   CREATE TABLE discounts (
       id SERIAL PRIMARY KEY,
       discount percentage DEFAULT 0
   );
   ```

**é¿å…åšæ³•**ï¼š

1. **é¿å…å¿½ç•¥çº¦æŸæ£€æŸ¥**ï¼ˆæ•°æ®å®Œæ•´æ€§å·®ï¼‰
2. **é¿å…ä½¿ç”¨è¿‡äºŽå¤æ‚çš„çº¦æŸ**ï¼ˆæ€§èƒ½é—®é¢˜ï¼‰

## 7. å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - è‡ªå®šä¹‰ç±»åž‹](https://www.postgresql.org/docs/current/xtypes.html)**
  - è‡ªå®šä¹‰ç±»åž‹å®Œæ•´æ•™ç¨‹
  - è¯­æ³•å’Œç¤ºä¾‹è¯´æ˜Ž

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - æžšä¸¾ç±»åž‹](https://www.postgresql.org/docs/current/datatype-enum.html)**
  - æžšä¸¾ç±»åž‹è¯´æ˜Ž
  - æžšä¸¾ç±»åž‹æ“ä½œ

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - å¤åˆç±»åž‹](https://www.postgresql.org/docs/current/rowtypes.html)**
  - å¤åˆç±»åž‹è¯´æ˜Ž
  - å¤åˆç±»åž‹æ“ä½œ

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - åŸŸç±»åž‹](https://www.postgresql.org/docs/current/domains.html)**
  - åŸŸç±»åž‹è¯´æ˜Ž
  - åŸŸç±»åž‹çº¦æŸ

### SQL æ ‡å‡†

- **ISO/IEC 9075:2016 - SQL æ ‡å‡†ç”¨æˆ·å®šä¹‰ç±»åž‹**
  - SQL æ ‡å‡†ç”¨æˆ·å®šä¹‰ç±»åž‹è§„èŒƒ
  - ç”¨æˆ·å®šä¹‰ç±»åž‹æ ‡å‡†è¯­æ³•

### æŠ€æœ¯è®ºæ–‡

- **Stonebraker, M., et al. (2005). "C-Store: A Column-oriented DBMS."**
  - ä¼šè®®: VLDB 2005
  - **é‡è¦æ€§**: æ•°æ®åº“ç³»ç»Ÿæž¶æž„çš„åŸºç¡€ç ”ç©¶
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†æ•°æ®åº“ç³»ç»Ÿæž¶æž„çš„æ¦‚å¿µï¼Œå½±å“äº†çŽ°ä»£æ•°æ®åº“çš„ç±»åž‹ç³»ç»Ÿè®¾è®¡

- **Date, C. J. (2000). "The Database Relational Model: A Retrospective Review and Analysis."**
  - å‡ºç‰ˆç¤¾: Addison-Wesley
  - **é‡è¦æ€§**: å…³ç³»æ•°æ®åº“æ¨¡åž‹çš„ç»å…¸æ•™æ
  - **æ ¸å¿ƒè´¡çŒ®**: æ·±å…¥è§£é‡Šäº†å…³ç³»æ•°æ®åº“æ¨¡åž‹ï¼ŒåŒ…æ‹¬ç”¨æˆ·å®šä¹‰ç±»åž‹çš„æ¦‚å¿µ

### æŠ€æœ¯åšå®¢

- **[PostgreSQL å®˜æ–¹åšå®¢ - è‡ªå®šä¹‰ç±»åž‹](https://www.postgresql.org/docs/current/xtypes.html)**
  - è‡ªå®šä¹‰ç±»åž‹æœ€ä½³å®žè·µ
  - æ€§èƒ½ä¼˜åŒ–æŠ€å·§

- **[2ndQuadrant - PostgreSQL è‡ªå®šä¹‰ç±»åž‹](https://www.2ndquadrant.com/en/blog/postgresql-custom-types/)**
  - è‡ªå®šä¹‰ç±»åž‹å®žæˆ˜
  - æ€§èƒ½ä¼˜åŒ–æ¡ˆä¾‹

- **[Percona - PostgreSQL è‡ªå®šä¹‰ç±»åž‹](https://www.percona.com/blog/postgresql-custom-types/)**
  - è‡ªå®šä¹‰ç±»åž‹ä½¿ç”¨æŠ€å·§
  - æ€§èƒ½ä¼˜åŒ–å»ºè®®

- **[EnterpriseDB - PostgreSQL è‡ªå®šä¹‰ç±»åž‹](https://www.enterprisedb.com/postgres-tutorials/postgresql-custom-types-tutorial)**
  - è‡ªå®šä¹‰ç±»åž‹æ·±å…¥è§£æž
  - å®žé™…åº”ç”¨æ¡ˆä¾‹

### ç¤¾åŒºèµ„æº

- **[PostgreSQL Wiki - è‡ªå®šä¹‰ç±»åž‹](https://wiki.postgresql.org/wiki/Custom_Types)**
  - è‡ªå®šä¹‰ç±»åž‹æŠ€å·§
  - å®žé™…åº”ç”¨æ¡ˆä¾‹

- **[Stack Overflow - PostgreSQL è‡ªå®šä¹‰ç±»åž‹](https://stackoverflow.com/questions/tagged/postgresql+custom-types)**
  - è‡ªå®šä¹‰ç±»åž‹é—®ç­”
  - å¸¸è§é—®é¢˜è§£ç­”

### ç›¸å…³æ–‡æ¡£

- [æ•°æ®ç±»åž‹è¯¦è§£](./æ•°æ®ç±»åž‹è¯¦è§£.md)
- [èŒƒå›´ç±»åž‹è¯¦è§£](./èŒƒå›´ç±»åž‹è¯¦è§£.md)
- [æ•°ç»„ä¸ŽJSONBé«˜çº§åº”ç”¨](./æ•°ç»„ä¸ŽJSONBé«˜çº§åº”ç”¨.md)

---

**æœ€åŽæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 03-03-44
