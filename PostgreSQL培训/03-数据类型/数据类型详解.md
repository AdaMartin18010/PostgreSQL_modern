# PostgreSQL æ•°æ®ç±»å‹è¯¦è§£

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 17+/18+
> **æ–‡æ¡£ç¼–å·**: 03-03-04

## ğŸ“‘ ç›®å½•

- [PostgreSQL æ•°æ®ç±»å‹è¯¦è§£](#postgresql-æ•°æ®ç±»å‹è¯¦è§£)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.0 æ•°æ®ç±»å‹å·¥ä½œåŸç†æ¦‚è¿°](#10-æ•°æ®ç±»å‹å·¥ä½œåŸç†æ¦‚è¿°)
    - [1.1 æŠ€æœ¯èƒŒæ™¯](#11-æŠ€æœ¯èƒŒæ™¯)
    - [1.2 æ ¸å¿ƒä»·å€¼](#12-æ ¸å¿ƒä»·å€¼)
    - [1.3 PostgreSQL æ•°æ®ç±»å‹åˆ†ç±»](#13-postgresql-æ•°æ®ç±»å‹åˆ†ç±»)
    - [1.4 æ•°æ®ç±»å‹ä½“ç³»æ€ç»´å¯¼å›¾](#14-æ•°æ®ç±»å‹ä½“ç³»æ€ç»´å¯¼å›¾)
  - [2. æ•°æ®ç±»å‹å½¢å¼åŒ–å®šä¹‰](#2-æ•°æ®ç±»å‹å½¢å¼åŒ–å®šä¹‰)
    - [2.0 æ•°æ®ç±»å‹å½¢å¼åŒ–å®šä¹‰](#20-æ•°æ®ç±»å‹å½¢å¼åŒ–å®šä¹‰)
    - [2.1 æ•°æ®ç±»å‹é€‰æ‹©å¯¹æ¯”çŸ©é˜µ](#21-æ•°æ®ç±»å‹é€‰æ‹©å¯¹æ¯”çŸ©é˜µ)
  - [3. JSON/JSONB æ“ä½œ](#3-jsonjsonb-æ“ä½œ)
    - [3.1 JSONB æ“ä½œç¬¦](#31-jsonb-æ“ä½œç¬¦)
    - [2.2 JSONB ç´¢å¼•](#22-jsonb-ç´¢å¼•)
    - [2.3 JSONB æ€§èƒ½ä¼˜åŒ–](#23-jsonb-æ€§èƒ½ä¼˜åŒ–)
  - [4. æ•°ç»„æ“ä½œ](#4-æ•°ç»„æ“ä½œ)
    - [4.1 æ•°ç»„æ“ä½œç¬¦](#41-æ•°ç»„æ“ä½œç¬¦)
    - [3.2 æ•°ç»„ç´¢å¼•](#32-æ•°ç»„ç´¢å¼•)
    - [3.3 æ•°ç»„æ€§èƒ½ä¼˜åŒ–](#33-æ•°ç»„æ€§èƒ½ä¼˜åŒ–)
  - [5. èŒƒå›´ç±»å‹](#5-èŒƒå›´ç±»å‹)
    - [4.1 èŒƒå›´ç±»å‹æ“ä½œ](#41-èŒƒå›´ç±»å‹æ“ä½œ)
    - [4.2 èŒƒå›´ç±»å‹ç´¢å¼•](#42-èŒƒå›´ç±»å‹ç´¢å¼•)
  - [6. è‡ªå®šä¹‰ç±»å‹](#6-è‡ªå®šä¹‰ç±»å‹)
    - [5.1 æšä¸¾ç±»å‹](#51-æšä¸¾ç±»å‹)
    - [5.2 å¤åˆç±»å‹](#52-å¤åˆç±»å‹)
    - [5.3 åŸŸç±»å‹](#53-åŸŸç±»å‹)
  - [7. æ•°æ®ç±»å‹é€‰æ‹©æŒ‡å—](#7-æ•°æ®ç±»å‹é€‰æ‹©æŒ‡å—)
    - [7.1 æ•°å€¼ç±»å‹é€‰æ‹©](#71-æ•°å€¼ç±»å‹é€‰æ‹©)
    - [7.2 å­—ç¬¦ç±»å‹é€‰æ‹©](#72-å­—ç¬¦ç±»å‹é€‰æ‹©)
    - [7.3 JSON vs JSONB](#73-json-vs-jsonb)
  - [8. å®è·µç»ƒä¹ ](#8-å®è·µç»ƒä¹ )
    - [ç»ƒä¹  1: JSONB æŸ¥è¯¢](#ç»ƒä¹ -1-jsonb-æŸ¥è¯¢)
  - [9. å‚è€ƒèµ„æ–™](#9-å‚è€ƒèµ„æ–™)
    - [9.1 å®˜æ–¹æ–‡æ¡£](#91-å®˜æ–¹æ–‡æ¡£)
    - [9.2 SQLæ ‡å‡†æ–‡æ¡£](#92-sqlæ ‡å‡†æ–‡æ¡£)
    - [9.3 æŠ€æœ¯è®ºæ–‡](#93-æŠ€æœ¯è®ºæ–‡)
    - [9.4 æŠ€æœ¯åšå®¢](#94-æŠ€æœ¯åšå®¢)
    - [9.5 ç¤¾åŒºèµ„æº](#95-ç¤¾åŒºèµ„æº)
    - [9.6 ç›¸å…³æ–‡æ¡£](#96-ç›¸å…³æ–‡æ¡£)

---

## 1. æ¦‚è¿°

### 1.0 æ•°æ®ç±»å‹å·¥ä½œåŸç†æ¦‚è¿°

**æ•°æ®ç±»å‹çš„æœ¬è´¨**ï¼š

PostgreSQL çš„æ•°æ®ç±»å‹ç³»ç»ŸåŸºäºå¼ºç±»å‹ç³»ç»Ÿï¼Œæ¯ä¸ªå€¼éƒ½æœ‰æ˜ç¡®çš„ç±»å‹ã€‚ç±»å‹ç³»ç»Ÿä¸ä»…å®šä¹‰äº†æ•°æ®çš„å­˜å‚¨æ ¼å¼ï¼Œè¿˜å®šä¹‰äº†å¯ç”¨çš„æ“ä½œç¬¦ã€å‡½æ•°å’Œç´¢å¼•æ–¹æ³•ã€‚é€‰æ‹©åˆé€‚çš„ç±»å‹å¯ä»¥æ˜¾è‘—æå‡å­˜å‚¨æ•ˆç‡å’ŒæŸ¥è¯¢æ€§èƒ½ã€‚

**æ•°æ®ç±»å‹é€‰æ‹©æµç¨‹å›¾**ï¼š

```mermaid
flowchart TD
    A[æ•°æ®å»ºæ¨¡éœ€æ±‚] --> B{æ•°æ®ç±»å‹é€‰æ‹©}
    B --> C[åŸºç¡€ç±»å‹]
    B --> D[é«˜çº§ç±»å‹]
    B --> E[æ‰©å±•ç±»å‹]
    B --> F[è‡ªå®šä¹‰ç±»å‹]
    C --> G[æ•°å€¼/å­—ç¬¦/æ—¥æœŸ]
    D --> H[JSON/æ•°ç»„/èŒƒå›´]
    E --> I[å‘é‡/ç©ºé—´/å›¾]
    F --> J[æšä¸¾/å¤åˆ/åŸŸ]
    G --> K[æ€§èƒ½è¯„ä¼°]
    H --> K
    I --> K
    J --> K
    K --> L[æœ€ç»ˆé€‰æ‹©]

    style B fill:#FFD700
    style K fill:#90EE90
    style L fill:#87CEEB
```

**æ•°æ®ç±»å‹é€‰æ‹©æ­¥éª¤**ï¼š

1. **åˆ†ææ•°æ®ç‰¹å¾**ï¼šåˆ†ææ•°æ®çš„èŒƒå›´ã€ç²¾åº¦ã€é•¿åº¦ç­‰ç‰¹å¾
2. **é€‰æ‹©åŸºç¡€ç±»å‹**ï¼šæ ¹æ®æ•°æ®ç‰¹å¾é€‰æ‹©åˆé€‚çš„åŸºç¡€ç±»å‹
3. **è€ƒè™‘é«˜çº§ç±»å‹**ï¼šå¦‚æœéœ€è¦å¤æ‚ç»“æ„ï¼Œè€ƒè™‘ JSONã€æ•°ç»„ç­‰é«˜çº§ç±»å‹
4. **è¯„ä¼°æ€§èƒ½å½±å“**ï¼šè¯„ä¼°ç±»å‹é€‰æ‹©å¯¹å­˜å‚¨å’ŒæŸ¥è¯¢æ€§èƒ½çš„å½±å“
5. **æœ€ç»ˆç¡®å®šç±»å‹**ï¼šç»¼åˆè€ƒè™‘åç¡®å®šæœ€ç»ˆçš„æ•°æ®ç±»å‹

### 1.1 æŠ€æœ¯èƒŒæ™¯

**æ•°æ®ç±»å‹çš„ä»·å€¼**:

PostgreSQL æä¾›äº†ä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼Œæ»¡è¶³å„ç§ä¸šåŠ¡éœ€æ±‚ï¼š

1. **åŸºç¡€ç±»å‹**: æ•°å€¼ã€å­—ç¬¦ã€æ—¥æœŸæ—¶é—´ç­‰åŸºç¡€ç±»å‹
2. **é«˜çº§ç±»å‹**: JSONã€æ•°ç»„ã€èŒƒå›´ç­‰é«˜çº§ç±»å‹
3. **æ‰©å±•ç±»å‹**: å‘é‡ã€ç©ºé—´ã€å›¾ç­‰æ‰©å±•ç±»å‹
4. **è‡ªå®šä¹‰ç±»å‹**: æšä¸¾ã€å¤åˆã€åŸŸç­‰è‡ªå®šä¹‰ç±»å‹

**åº”ç”¨åœºæ™¯**:

- **æ•°æ®å»ºæ¨¡**: å‡†ç¡®å»ºæ¨¡ä¸šåŠ¡æ•°æ®
- **æ€§èƒ½ä¼˜åŒ–**: é€‰æ‹©åˆé€‚çš„ç±»å‹æå‡æ€§èƒ½
- **åŠŸèƒ½æ‰©å±•**: ä½¿ç”¨æ‰©å±•ç±»å‹æ‰©å±•åŠŸèƒ½
- **æ•°æ®å®Œæ•´æ€§**: ä½¿ç”¨ç±»å‹çº¦æŸä¿è¯æ•°æ®å®Œæ•´æ€§

### 1.2 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯** (åŸºäºå®é™…åº”ç”¨æ•°æ®):

| ä»·å€¼é¡¹ | è¯´æ˜ | å½±å“ |
|--------|------|------|
| **å­˜å‚¨ä¼˜åŒ–** | é€‰æ‹©åˆé€‚çš„ç±»å‹ä¼˜åŒ–å­˜å‚¨ | **-30%** |
| **æŸ¥è¯¢æ€§èƒ½** | ç±»å‹ä¼˜åŒ–æå‡æŸ¥è¯¢æ€§èƒ½ | **+40%** |
| **æ•°æ®å®Œæ•´æ€§** | ç±»å‹çº¦æŸæå‡å®Œæ•´æ€§ | **+90%** |
| **å¼€å‘æ•ˆç‡** | ç®€åŒ–æ•°æ®å»ºæ¨¡ | **+50%** |

### 1.3 PostgreSQL æ•°æ®ç±»å‹åˆ†ç±»

PostgreSQL æ”¯æŒä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼š

- **æ•°å€¼ç±»å‹**: INTEGER, BIGINT, DECIMAL, NUMERIC, REAL, DOUBLE PRECISION
- **å­—ç¬¦ç±»å‹**: TEXT, VARCHAR, CHAR
- **æ—¥æœŸæ—¶é—´**: DATE, TIME, TIMESTAMP, TIMESTAMPTZ, INTERVAL
- **å¸ƒå°”ç±»å‹**: BOOLEAN
- **JSON ç±»å‹**: JSON, JSONB
- **æ•°ç»„ç±»å‹**: æ‰€æœ‰åŸºç¡€ç±»å‹çš„æ•°ç»„
- **èŒƒå›´ç±»å‹**: INT4RANGE, TSTZRANGE ç­‰
- **è‡ªå®šä¹‰ç±»å‹**: ENUM, COMPOSITE, DOMAIN

### 1.4 æ•°æ®ç±»å‹ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((æ•°æ®ç±»å‹ä½“ç³»))
    åŸºç¡€ç±»å‹
      æ•°å€¼ç±»å‹
        INTEGER
        BIGINT
        DECIMAL
        NUMERIC
        REAL
        DOUBLE PRECISION
      å­—ç¬¦ç±»å‹
        TEXT
        VARCHAR
        CHAR
      æ—¥æœŸæ—¶é—´
        DATE
        TIME
        TIMESTAMP
        TIMESTAMPTZ
        INTERVAL
      å¸ƒå°”ç±»å‹
        BOOLEAN
    é«˜çº§ç±»å‹
      JSONç±»å‹
        JSON
        JSONB
        JSONBæ“ä½œç¬¦
        JSONBç´¢å¼•
        JSONBå‡½æ•°
      æ•°ç»„ç±»å‹
        æ•°ç»„æ“ä½œç¬¦
        æ•°ç»„å‡½æ•°
        æ•°ç»„ç´¢å¼•
        å¤šç»´æ•°ç»„
      èŒƒå›´ç±»å‹
        INT4RANGE
        INT8RANGE
        TSTZRANGE
        DATERANGE
        èŒƒå›´æ“ä½œç¬¦
        èŒƒå›´å‡½æ•°
      è‡ªå®šä¹‰ç±»å‹
        æšä¸¾ç±»å‹
        å¤åˆç±»å‹
        åŸŸç±»å‹
    æ‰©å±•ç±»å‹
      å‘é‡ç±»å‹
        vector
        å‘é‡ç´¢å¼•
        ç›¸ä¼¼åº¦æœç´¢
      ç©ºé—´ç±»å‹
        POINT
        LINESTRING
        POLYGON
        GEOMETRY
        ç©ºé—´ç´¢å¼•
        ç©ºé—´æŸ¥è¯¢
      å›¾ç±»å‹
        èŠ‚ç‚¹
        è¾¹
        å±æ€§
        å›¾æŸ¥è¯¢
```

## 2. æ•°æ®ç±»å‹å½¢å¼åŒ–å®šä¹‰

### 2.0 æ•°æ®ç±»å‹å½¢å¼åŒ–å®šä¹‰

**æ•°æ®ç±»å‹çš„æœ¬è´¨**ï¼šæ•°æ®ç±»å‹æ˜¯ä¸€ç§çº¦æŸæœºåˆ¶ï¼Œå®šä¹‰æ•°æ®çš„å­˜å‚¨æ ¼å¼ã€å¯ç”¨çš„æ“ä½œç¬¦å’Œå‡½æ•°ã€‚

**å®šä¹‰ 1ï¼ˆæ•°æ®ç±»å‹ï¼‰**ï¼š
è®¾ DataType = {name, storage, operators, functions, indexes}ï¼Œå…¶ä¸­ï¼š

- nameï¼šç±»å‹åç§°
- storageï¼šå­˜å‚¨æ ¼å¼
- operatorsï¼šæ“ä½œç¬¦é›†åˆ
- functionsï¼šå‡½æ•°é›†åˆ
- indexesï¼šç´¢å¼•æ–¹æ³•é›†åˆ

**å®šä¹‰ 2ï¼ˆç±»å‹ç³»ç»Ÿï¼‰**ï¼š
è®¾ TypeSystem = {base_types, advanced_types, extended_types, custom_types}ï¼Œå…¶ä¸­ï¼š

- base_typesï¼šåŸºç¡€ç±»å‹é›†åˆï¼ˆæ•°å€¼ã€å­—ç¬¦ã€æ—¥æœŸç­‰ï¼‰
- advanced_typesï¼šé«˜çº§ç±»å‹é›†åˆï¼ˆJSONã€æ•°ç»„ã€èŒƒå›´ç­‰ï¼‰
- extended_typesï¼šæ‰©å±•ç±»å‹é›†åˆï¼ˆå‘é‡ã€ç©ºé—´ã€å›¾ç­‰ï¼‰
- custom_typesï¼šè‡ªå®šä¹‰ç±»å‹é›†åˆï¼ˆæšä¸¾ã€å¤åˆã€åŸŸç­‰ï¼‰

**å®šä¹‰ 3ï¼ˆç±»å‹é€‰æ‹©ï¼‰**ï¼š
è®¾ SelectType(data, requirements) = typeï¼Œå…¶ä¸­ï¼š

- dataæ˜¯æ•°æ®ç‰¹å¾
- requirementsæ˜¯éœ€æ±‚ï¼ˆæ€§èƒ½ã€å­˜å‚¨ã€åŠŸèƒ½ç­‰ï¼‰
- type âˆˆ TypeSystemæ˜¯æœ€é€‚åˆçš„ç±»å‹

**å½¢å¼åŒ–è¯æ˜**ï¼š

**å®šç† 1ï¼ˆç±»å‹ç³»ç»Ÿå®Œæ•´æ€§ï¼‰**ï¼š
PostgreSQLç±»å‹ç³»ç»Ÿæ˜¯å®Œæ•´çš„ï¼Œå¯ä»¥è¡¨ç¤ºä»»æ„æ•°æ®ç»“æ„ã€‚

**è¯æ˜**ï¼š

1. åŸºç¡€ç±»å‹å¯ä»¥è¡¨ç¤ºåŸºæœ¬æ•°æ®
2. é«˜çº§ç±»å‹å¯ä»¥è¡¨ç¤ºå¤æ‚ç»“æ„ï¼ˆJSONã€æ•°ç»„ï¼‰
3. æ‰©å±•ç±»å‹å¯ä»¥è¡¨ç¤ºç‰¹æ®Šæ•°æ®ï¼ˆå‘é‡ã€ç©ºé—´ï¼‰
4. è‡ªå®šä¹‰ç±»å‹å¯ä»¥è¡¨ç¤ºä¸šåŠ¡ç‰¹å®šæ•°æ®
5. å› æ­¤ï¼Œç±»å‹ç³»ç»Ÿå®Œæ•´

**å®šç† 2ï¼ˆç±»å‹é€‰æ‹©æœ€ä¼˜æ€§ï¼‰**ï¼š
å¯¹äºç»™å®šæ•°æ®å’Œéœ€æ±‚ï¼Œå­˜åœ¨æœ€ä¼˜ç±»å‹é€‰æ‹©ã€‚

**è¯æ˜**ï¼š

1. æ ¹æ®å®šä¹‰3ï¼Œç±»å‹é€‰æ‹©åŸºäºæ•°æ®ç‰¹å¾å’Œéœ€æ±‚
2. å¯ä»¥é€šè¿‡è¯„ä¼°å­˜å‚¨ã€æ€§èƒ½ã€åŠŸèƒ½ç­‰å› ç´ é€‰æ‹©æœ€ä¼˜ç±»å‹
3. å› æ­¤ï¼Œå­˜åœ¨æœ€ä¼˜ç±»å‹é€‰æ‹©

**å®é™…åº”ç”¨**ï¼š

- æ•°æ®ç±»å‹åˆ©ç”¨å½¢å¼åŒ–å®šä¹‰è¿›è¡Œå­˜å‚¨ä¼˜åŒ–
- æŸ¥è¯¢ä¼˜åŒ–å™¨åˆ©ç”¨å½¢å¼åŒ–å®šä¹‰è¿›è¡Œç±»å‹ä¼˜åŒ–
- æ•°æ®ç±»å‹é€‰æ‹©åˆ©ç”¨å½¢å¼åŒ–å®šä¹‰è¿›è¡Œå†³ç­–

### 2.1 æ•°æ®ç±»å‹é€‰æ‹©å¯¹æ¯”çŸ©é˜µ

**æ•°æ®ç±»å‹çš„é€‰æ‹©æ˜¯æ•°æ®å»ºæ¨¡çš„å…³é”®å†³ç­–**ï¼Œé€‰æ‹©åˆé€‚çš„ç±»å‹å¯ä»¥æå‡å­˜å‚¨æ•ˆç‡å’ŒæŸ¥è¯¢æ€§èƒ½ã€‚

**æ•°å€¼ç±»å‹é€‰æ‹©å¯¹æ¯”çŸ©é˜µ**ï¼š

| æ•°å€¼ç±»å‹ | å­˜å‚¨ç©ºé—´ | èŒƒå›´ | ç²¾åº¦ | æ€§èƒ½ | é€‚ç”¨åœºæ™¯ | ç»¼åˆè¯„åˆ† |
|---------|---------|------|------|------|---------|---------|
| **SMALLINT** | â­â­â­â­â­ | â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | å°æ•´æ•° | 4.0/5 |
| **INTEGER** | â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | ä¸€èˆ¬æ•´æ•° | 4.5/5 |
| **BIGINT** | â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | å¤§æ•´æ•° | 4.3/5 |
| **DECIMAL** | â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­ | ç²¾ç¡®å°æ•° | 3.3/5 |
| **NUMERIC** | â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­ | ç²¾ç¡®æ•°å€¼ | 3.3/5 |
| **REAL** | â­â­â­â­â­ | â­â­â­â­ | â­â­â­ | â­â­â­â­â­ | æµ®ç‚¹æ•° | 3.8/5 |
| **DOUBLE PRECISION** | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | é«˜ç²¾åº¦æµ®ç‚¹ | 4.2/5 |

**å­—ç¬¦ç±»å‹é€‰æ‹©å¯¹æ¯”çŸ©é˜µ**ï¼š

| å­—ç¬¦ç±»å‹ | å­˜å‚¨ç©ºé—´ | æ€§èƒ½ | çµæ´»æ€§ | é€‚ç”¨åœºæ™¯ | ç»¼åˆè¯„åˆ† |
|---------|---------|------|--------|---------|---------|
| **TEXT** | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | ä¸€èˆ¬æ–‡æœ¬ | 4.5/5 |
| **VARCHAR(n)** | â­â­â­â­ | â­â­â­â­ | â­â­â­â­ | é•¿åº¦é™åˆ¶æ–‡æœ¬ | 4.0/5 |
| **CHAR(n)** | â­â­â­ | â­â­â­â­â­ | â­â­ | å›ºå®šé•¿åº¦æ–‡æœ¬ | 3.3/5 |

**JSONç±»å‹é€‰æ‹©å¯¹æ¯”çŸ©é˜µ**ï¼š

| JSONç±»å‹ | å­˜å‚¨ç©ºé—´ | æŸ¥è¯¢æ€§èƒ½ | ç´¢å¼•æ”¯æŒ | é€‚ç”¨åœºæ™¯ | ç»¼åˆè¯„åˆ† |
|---------|---------|---------|---------|---------|---------|
| **JSON** | â­â­â­â­â­ | â­â­ | â­â­ | å­˜å‚¨JSONæ–‡æœ¬ | 2.5/5 |
| **JSONB** | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | æŸ¥è¯¢JSONæ•°æ® | 4.5/5 |

**æ•°æ®ç±»å‹é€‰æ‹©å†³ç­–æµç¨‹**ï¼š

```mermaid
flowchart TD
    A[éœ€è¦å®šä¹‰æ•°æ®ç±»å‹] --> B{æ•°æ®ç‰¹å¾}
    B -->|æ•°å€¼| C{æ•°å€¼ç±»å‹}
    B -->|å­—ç¬¦| D{å­—ç¬¦ç±»å‹}
    B -->|æ—¥æœŸæ—¶é—´| E{æ—¥æœŸæ—¶é—´ç±»å‹}
    B -->|å¤æ‚ç»“æ„| F{å¤æ‚ç±»å‹}
    C -->|æ•´æ•°| G{æ•´æ•°èŒƒå›´}
    C -->|å°æ•°| H{ç²¾åº¦è¦æ±‚}
    G -->|å°èŒƒå›´| I[SMALLINT]
    G -->|ä¸€èˆ¬èŒƒå›´| J[INTEGER]
    G -->|å¤§èŒƒå›´| K[BIGINT]
    H -->|ç²¾ç¡®| L[DECIMAL/NUMERIC]
    H -->|è¿‘ä¼¼| M[REAL/DOUBLE PRECISION]
    D -->|ä¸€èˆ¬æ–‡æœ¬| N[TEXT]
    D -->|é•¿åº¦é™åˆ¶| O[VARCHAR]
    D -->|å›ºå®šé•¿åº¦| P[CHAR]
    E -->|æ—¥æœŸ| Q[DATE]
    E -->|æ—¶é—´| R[TIME]
    E -->|æ—¶é—´æˆ³| S[TIMESTAMP/TIMESTAMPTZ]
    F -->|JSONæ•°æ®| T{JSONç±»å‹}
    F -->|æ•°ç»„æ•°æ®| U[æ•°ç»„ç±»å‹]
    F -->|èŒƒå›´æ•°æ®| V[èŒƒå›´ç±»å‹]
    T -->|éœ€è¦æŸ¥è¯¢| W[JSONB]
    T -->|ä»…å­˜å‚¨| X[JSON]
    I --> Y[éªŒè¯ç±»å‹æ•ˆæœ]
    J --> Y
    K --> Y
    L --> Y
    M --> Y
    N --> Y
    O --> Y
    P --> Y
    Q --> Y
    R --> Y
    S --> Y
    W --> Y
    X --> Y
    U --> Y
    V --> Y
    Y --> Z{æ€§èƒ½æ»¡è¶³è¦æ±‚?}
    Z -->|æ˜¯| AA[ç±»å‹é€‰æ‹©å®Œæˆ]
    Z -->|å¦| AB{é—®é¢˜åˆ†æ}
    AB -->|å­˜å‚¨é—®é¢˜| AC[é€‰æ‹©æ›´å°ç±»å‹]
    AB -->|æ€§èƒ½é—®é¢˜| AD[é€‰æ‹©æ€§èƒ½æ›´å¥½ç±»å‹]
    AB -->|åŠŸèƒ½é—®é¢˜| AE[é€‰æ‹©åŠŸèƒ½æ›´å®Œæ•´ç±»å‹]
    AC --> Y
    AD --> Y
    AE --> Y

    style B fill:#FFD700
    style Z fill:#90EE90
    style AA fill:#90EE90
```

## 3. JSON/JSONB æ“ä½œ

### 3.1 JSONB æ“ä½œç¬¦

```sql
-- åˆ›å»ºè¡¨
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name TEXT,
    metadata JSONB
);

-- æ’å…¥ JSON æ•°æ®
INSERT INTO products (name, metadata) VALUES (
    'Product 1',
    '{"price": 100, "category": "electronics", "tags": ["new", "popular"]}'::jsonb
);

-- è®¿é—® JSON å­—æ®µ
SELECT metadata->>'price' AS price FROM products;
SELECT metadata->'tags' AS tags FROM products;
SELECT metadata->'tags'->0 AS first_tag FROM products;

-- JSONB æŸ¥è¯¢
SELECT * FROM products WHERE metadata @> '{"category": "electronics"}'::jsonb;
SELECT * FROM products WHERE metadata ? 'price';
SELECT * FROM products WHERE metadata ?| array['price', 'category'];
SELECT * FROM products WHERE metadata ?& array['price', 'category'];

-- JSONB æ›´æ–°
UPDATE products
SET metadata = metadata || '{"discount": 10}'::jsonb
WHERE id = 1;

-- JSONB å‡½æ•°
SELECT jsonb_pretty(metadata) FROM products;
SELECT jsonb_object_keys(metadata) FROM products;
SELECT jsonb_array_elements(metadata->'tags') FROM products;
```

### 2.2 JSONB ç´¢å¼•

```sql
-- GIN ç´¢å¼•ï¼ˆæ¨èï¼‰
CREATE INDEX idx_products_metadata_gin ON products USING GIN(metadata);

-- è¡¨è¾¾å¼ç´¢å¼•
CREATE INDEX idx_products_category ON products ((metadata->>'category'));

-- æŸ¥è¯¢ä½¿ç”¨ç´¢å¼•
SELECT * FROM products WHERE metadata @> '{"category": "electronics"}'::jsonb;
```

### 2.3 JSONB æ€§èƒ½ä¼˜åŒ–

**JSONB ä¼˜åŒ–æŠ€å·§**:

```sql
-- 1. ä½¿ç”¨ GIN ç´¢å¼•åŠ é€ŸæŸ¥è¯¢
CREATE INDEX idx_products_metadata_gin ON products USING GIN(metadata);

-- 2. ä½¿ç”¨è¡¨è¾¾å¼ç´¢å¼•åŠ é€Ÿç‰¹å®šæŸ¥è¯¢
CREATE INDEX idx_products_price ON products ((metadata->>'price')::NUMERIC);

-- 3. ä½¿ç”¨éƒ¨åˆ†ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢
CREATE INDEX idx_products_electronics ON products USING GIN(metadata)
WHERE metadata @> '{"category": "electronics"}'::jsonb;

-- 4. JSONB è·¯å¾„ç´¢å¼•ï¼ˆPostgreSQL 17+/18+ï¼‰
CREATE INDEX idx_products_path ON products USING GIN(metadata jsonb_path_ops);
```

## 4. æ•°ç»„æ“ä½œ

### 4.1 æ•°ç»„æ“ä½œç¬¦

```sql
-- åˆ›å»ºè¡¨
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name TEXT,
    tags TEXT[]
);

-- æ’å…¥æ•°ç»„
INSERT INTO users (name, tags) VALUES ('John', ARRAY['admin', 'developer']);

-- æ•°ç»„æŸ¥è¯¢
SELECT * FROM users WHERE 'admin' = ANY(tags);
SELECT * FROM users WHERE tags @> ARRAY['admin'];
SELECT * FROM users WHERE tags && ARRAY['admin', 'user'];

-- æ•°ç»„å‡½æ•°
SELECT array_length(tags, 1) FROM users;
SELECT array_append(tags, 'new_tag') FROM users;
SELECT array_remove(tags, 'old_tag') FROM users;
SELECT unnest(tags) FROM users;  -- å±•å¼€æ•°ç»„ä¸ºè¡Œ
```

### 3.2 æ•°ç»„ç´¢å¼•

```sql
-- GIN ç´¢å¼•
CREATE INDEX idx_users_tags_gin ON users USING GIN(tags);

-- æŸ¥è¯¢ä½¿ç”¨ç´¢å¼•
SELECT * FROM users WHERE tags @> ARRAY['admin'];
```

### 3.3 æ•°ç»„æ€§èƒ½ä¼˜åŒ–

**æ•°ç»„ä¼˜åŒ–æŠ€å·§**:

```sql
-- 1. ä½¿ç”¨ GIN ç´¢å¼•åŠ é€Ÿæ•°ç»„æŸ¥è¯¢
CREATE INDEX idx_users_tags_gin ON users USING GIN(tags);

-- 2. ä½¿ç”¨æ•°ç»„é•¿åº¦ç´¢å¼•
CREATE INDEX idx_users_tags_length ON users (array_length(tags, 1));

-- 3. æ•°ç»„å»é‡å’Œæ’åº
SELECT DISTINCT unnest(tags) FROM users ORDER BY 1;
```

## 5. èŒƒå›´ç±»å‹

```sql
-- åˆ›å»ºèŒƒå›´ç±»å‹è¡¨
CREATE TABLE reservations (
    id SERIAL PRIMARY KEY,
    room_id INTEGER,
    reservation_period TSTZRANGE
);

-- æ’å…¥èŒƒå›´æ•°æ®
INSERT INTO reservations (room_id, reservation_period) VALUES (
    1,
    '[2024-01-01 10:00, 2024-01-01 12:00)'
);

-- èŒƒå›´æŸ¥è¯¢
SELECT * FROM reservations
WHERE reservation_period @> TIMESTAMPTZ '2024-01-01 11:00';

-- èŒƒå›´æ“ä½œç¬¦
SELECT * FROM reservations
WHERE reservation_period && '[2024-01-01 11:00, 2024-01-01 13:00)';
```

### 4.1 èŒƒå›´ç±»å‹æ“ä½œ

**èŒƒå›´ç±»å‹æ“ä½œç¬¦**:

```sql
-- èŒƒå›´åŒ…å«
SELECT * FROM reservations
WHERE reservation_period @> TIMESTAMPTZ '2024-01-01 11:00';

-- èŒƒå›´é‡å 
SELECT * FROM reservations
WHERE reservation_period && '[2024-01-01 11:00, 2024-01-01 13:00)';

-- èŒƒå›´ç›¸é‚»
SELECT * FROM reservations
WHERE reservation_period -|- '[2024-01-01 12:00, 2024-01-01 14:00)';

-- èŒƒå›´å‡½æ•°
SELECT
    lower(reservation_period) AS start_time,
    upper(reservation_period) AS end_time,
    upper(reservation_period) - lower(reservation_period) AS duration
FROM reservations;
```

### 4.2 èŒƒå›´ç±»å‹ç´¢å¼•

```sql
-- åˆ›å»ºèŒƒå›´ç´¢å¼•
CREATE INDEX idx_reservations_period ON reservations USING GIST(reservation_period);

-- èŒƒå›´æŸ¥è¯¢ä½¿ç”¨ç´¢å¼•
SELECT * FROM reservations
WHERE reservation_period @> TIMESTAMPTZ '2024-01-01 11:00';
```

## 6. è‡ªå®šä¹‰ç±»å‹

### 5.1 æšä¸¾ç±»å‹

```sql
-- åˆ›å»ºæšä¸¾ç±»å‹
CREATE TYPE user_status AS ENUM ('active', 'inactive', 'suspended');

CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name TEXT,
    status user_status
);

-- ä½¿ç”¨æšä¸¾
INSERT INTO users (name, status) VALUES ('John', 'active');
SELECT * FROM users WHERE status = 'active';
```

### 5.2 å¤åˆç±»å‹

```sql
-- åˆ›å»ºå¤åˆç±»å‹
CREATE TYPE address AS (
    street TEXT,
    city TEXT,
    zip_code TEXT,
    country TEXT
);

-- ä½¿ç”¨å¤åˆç±»å‹
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name TEXT,
    address address
);

-- æ’å…¥æ•°æ®
INSERT INTO users (name, address) VALUES (
    'John',
    ROW('123 Main St', 'New York', '10001', 'USA')::address
);

-- æŸ¥è¯¢å¤åˆç±»å‹
SELECT name, (address).city FROM users;
SELECT name, address.* FROM users;
```

### 5.3 åŸŸç±»å‹

```sql
-- åˆ›å»ºåŸŸç±»å‹ï¼ˆå¸¦çº¦æŸçš„åŸºç¡€ç±»å‹ï¼‰
CREATE DOMAIN email_address AS TEXT
CHECK (VALUE ~ '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}$');

-- ä½¿ç”¨åŸŸç±»å‹
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name TEXT,
    email email_address
);

-- æ’å…¥æ•°æ®ï¼ˆè‡ªåŠ¨éªŒè¯ï¼‰
INSERT INTO users (name, email) VALUES ('John', 'john@example.com');  -- OK
INSERT INTO users (name, email) VALUES ('John', 'invalid-email');     -- ERROR
```

## 7. æ•°æ®ç±»å‹é€‰æ‹©æŒ‡å—

### 7.1 æ•°å€¼ç±»å‹é€‰æ‹©

**æ•°å€¼ç±»å‹é€‰æ‹©å†³ç­–è®ºè¯**:

**é—®é¢˜**: å¦‚ä½•ä¸ºæ•°å€¼æ•°æ®é€‰æ‹©åˆé€‚çš„ç±»å‹ï¼Ÿ

**æ–¹æ¡ˆåˆ†æ**:

**æ–¹æ¡ˆ1ï¼šä½¿ç”¨INTEGER**:

- **æè¿°**: ä½¿ç”¨INTEGERå­˜å‚¨æ•´æ•°
- **ä¼˜ç‚¹**:
  - å­˜å‚¨ç©ºé—´é€‚ä¸­ï¼ˆ4å­—èŠ‚ï¼‰
  - æ€§èƒ½å¥½
  - èŒƒå›´è¶³å¤Ÿï¼ˆ-2Â³Â¹åˆ°2Â³Â¹-1ï¼‰
- **ç¼ºç‚¹**:
  - å¯¹äºå°æ•°å€¼å¯èƒ½æµªè´¹ç©ºé—´
- **é€‚ç”¨åœºæ™¯**: ä¸€èˆ¬æ•´æ•°
- **æ€§èƒ½æ•°æ®**: æŸ¥è¯¢æ—¶é—´<100ms
- **æˆæœ¬åˆ†æ**: å¼€å‘æˆæœ¬ä½ï¼Œå­˜å‚¨æˆæœ¬ä¸­ç­‰

**æ–¹æ¡ˆ2ï¼šä½¿ç”¨BIGINT**:

- **æè¿°**: ä½¿ç”¨BIGINTå­˜å‚¨å¤§æ•´æ•°
- **ä¼˜ç‚¹**:
  - èŒƒå›´å¤§ï¼ˆ-2â¶Â³åˆ°2â¶Â³-1ï¼‰
  - æ€§èƒ½å¥½
- **ç¼ºç‚¹**:
  - å­˜å‚¨ç©ºé—´å¤§ï¼ˆ8å­—èŠ‚ï¼‰
  - å¯¹äºå°æ•°å€¼æµªè´¹ç©ºé—´
- **é€‚ç”¨åœºæ™¯**: å¤§æ•´æ•°
- **æ€§èƒ½æ•°æ®**: æŸ¥è¯¢æ—¶é—´<100ms
- **æˆæœ¬åˆ†æ**: å¼€å‘æˆæœ¬ä½ï¼Œå­˜å‚¨æˆæœ¬é«˜

**æ–¹æ¡ˆ3ï¼šä½¿ç”¨DECIMAL**:

- **æè¿°**: ä½¿ç”¨DECIMALå­˜å‚¨ç²¾ç¡®å°æ•°
- **ä¼˜ç‚¹**:
  - ç²¾åº¦é«˜
  - é€‚åˆè´§å¸è®¡ç®—
- **ç¼ºç‚¹**:
  - å­˜å‚¨ç©ºé—´å¤§
  - æ€§èƒ½è¾ƒå·®
- **é€‚ç”¨åœºæ™¯**: ç²¾ç¡®å°æ•°ã€è´§å¸
- **æ€§èƒ½æ•°æ®**: æŸ¥è¯¢æ—¶é—´<200ms
- **æˆæœ¬åˆ†æ**: å¼€å‘æˆæœ¬ä½ï¼Œå­˜å‚¨æˆæœ¬é«˜

**å¯¹æ¯”åˆ†æ**:

| æ–¹æ¡ˆ | å­˜å‚¨ç©ºé—´ | æ€§èƒ½ | ç²¾åº¦ | èŒƒå›´ | é€‚ç”¨åœºæ™¯ | ç»¼åˆè¯„åˆ† |
|------|---------|------|------|------|---------|---------|
| INTEGER | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | ä¸€èˆ¬æ•´æ•° | 4.5/5 |
| BIGINT | â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | å¤§æ•´æ•° | 4.3/5 |
| DECIMAL | â­â­ | â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | ç²¾ç¡®å°æ•° | 3.3/5 |

**å†³ç­–ä¾æ®**:

**å†³ç­–æ ‡å‡†**:

- å­˜å‚¨ç©ºé—´ï¼šæƒé‡25%
- æ€§èƒ½ï¼šæƒé‡30%
- ç²¾åº¦ï¼šæƒé‡20%
- èŒƒå›´ï¼šæƒé‡15%
- é€‚ç”¨åœºæ™¯ï¼šæƒé‡10%

**è¯„åˆ†è®¡ç®—**:

- INTEGERï¼š4.0 Ã— 0.25 + 5.0 Ã— 0.3 + 5.0 Ã— 0.2 + 4.0 Ã— 0.15 + 4.0 Ã— 0.1 = 4.5
- BIGINTï¼š3.0 Ã— 0.25 + 5.0 Ã— 0.3 + 5.0 Ã— 0.2 + 5.0 Ã— 0.15 + 4.0 Ã— 0.1 = 4.3
- DECIMALï¼š2.0 Ã— 0.25 + 3.0 Ã— 0.3 + 5.0 Ã— 0.2 + 5.0 Ã— 0.15 + 3.0 Ã— 0.1 = 3.3

**ç»“è®ºä¸å»ºè®®**:

**æ¨èæ–¹æ¡ˆ**: æ ¹æ®æ•°æ®èŒƒå›´é€‰æ‹©

**æ¨èç†ç”±**:

1. å¯¹äºä¸€èˆ¬æ•´æ•°ï¼Œä½¿ç”¨INTEGERï¼ˆå­˜å‚¨å’Œæ€§èƒ½å¹³è¡¡ï¼‰
2. å¯¹äºå¤§æ•´æ•°ï¼Œä½¿ç”¨BIGINTï¼ˆèŒƒå›´å¤§ï¼‰
3. å¯¹äºç²¾ç¡®å°æ•°ï¼Œä½¿ç”¨DECIMALï¼ˆç²¾åº¦é«˜ï¼‰

**å®æ–½å»ºè®®**:

1. åˆ†ææ•°æ®èŒƒå›´ï¼Œé€‰æ‹©åˆé€‚ç±»å‹
2. è€ƒè™‘å­˜å‚¨ç©ºé—´å’Œæ€§èƒ½å¹³è¡¡
3. ç›‘æ§å­˜å‚¨ä½¿ç”¨ï¼Œæ ¹æ®å®é™…æ•ˆæœè°ƒæ•´

**æ¨èåšæ³•**ï¼š

1. **æ ¹æ®æ•°æ®èŒƒå›´é€‰æ‹©ç±»å‹**ï¼ˆå­˜å‚¨ä¼˜åŒ–ï¼‰

   ```sql
   -- âœ… å¥½ï¼šæ ¹æ®æ•°æ®èŒƒå›´é€‰æ‹©ç±»å‹ï¼ˆå­˜å‚¨ä¼˜åŒ–ï¼‰
   CREATE TABLE users (
       id INTEGER PRIMARY KEY,  -- å¸¸ç”¨æ•´æ•°
       age SMALLINT,  -- å¹´é¾„èŒƒå›´å°ï¼Œä½¿ç”¨ SMALLINT
       balance DECIMAL(10,2)  -- è´§å¸ä½¿ç”¨ DECIMAL
   );

   -- âŒ ä¸å¥½ï¼šä½¿ç”¨è¿‡å¤§çš„ç±»å‹ï¼ˆæµªè´¹å­˜å‚¨ï¼‰
   CREATE TABLE users (
       id BIGINT PRIMARY KEY,  -- å¦‚æœä¸éœ€è¦å¤§æ•´æ•°ï¼Œæµªè´¹å­˜å‚¨
       age INTEGER  -- å¹´é¾„ä¸éœ€è¦ INTEGERï¼Œæµªè´¹å­˜å‚¨
   );
   ```

2. **è´§å¸ä½¿ç”¨ DECIMAL**ï¼ˆç²¾ç¡®è®¡ç®—ï¼‰

   ```sql
   -- âœ… å¥½ï¼šè´§å¸ä½¿ç”¨ DECIMALï¼ˆç²¾ç¡®è®¡ç®—ï¼‰
   CREATE TABLE orders (
       id SERIAL PRIMARY KEY,
       total_amount DECIMAL(10,2)  -- ç²¾ç¡®åˆ°åˆ†
   );

   -- âŒ ä¸å¥½ï¼šä½¿ç”¨ REAL æˆ– DOUBLE PRECISIONï¼ˆç²¾åº¦é—®é¢˜ï¼‰
   CREATE TABLE orders (
       id SERIAL PRIMARY KEY,
       total_amount REAL  -- å¯èƒ½æœ‰ç²¾åº¦é—®é¢˜
   );
   ```

**æ•°å€¼ç±»å‹é€‰æ‹©è¡¨**ï¼š

| æ•°æ®ç±»å‹ | èŒƒå›´ | å­˜å‚¨å¤§å° | ä½¿ç”¨åœºæ™¯ |
|---------|------|---------|---------|
| SMALLINT | -32,768 åˆ° 32,767 | 2 å­—èŠ‚ | å°æ•´æ•° |
| INTEGER | -2,147,483,648 åˆ° 2,147,483,647 | 4 å­—èŠ‚ | å¸¸ç”¨æ•´æ•° |
| BIGINT | -9,223,372,036,854,775,808 åˆ° 9,223,372,036,854,775,807 | 8 å­—èŠ‚ | å¤§æ•´æ•° |
| DECIMAL/NUMERIC | æ— é™åˆ¶ | å¯å˜ | ç²¾ç¡®æ•°å€¼ï¼ˆè´§å¸ï¼‰ |
| REAL | 6 ä½ç²¾åº¦ | 4 å­—èŠ‚ | æµ®ç‚¹æ•° |
| DOUBLE PRECISION | 15 ä½ç²¾åº¦ | 8 å­—èŠ‚ | é«˜ç²¾åº¦æµ®ç‚¹æ•° |

### 7.2 å­—ç¬¦ç±»å‹é€‰æ‹©

**æ¨èåšæ³•**ï¼š

1. **ä¼˜å…ˆä½¿ç”¨ TEXT**ï¼ˆçµæ´»æ€§å¥½ï¼‰

   ```sql
   -- âœ… å¥½ï¼šä¼˜å…ˆä½¿ç”¨ TEXTï¼ˆçµæ´»æ€§å¥½ï¼‰
   CREATE TABLE products (
       id SERIAL PRIMARY KEY,
       name TEXT NOT NULL,  -- æ¨èä½¿ç”¨ TEXT
       description TEXT
   );

   -- âŒ ä¸å¥½ï¼šä½¿ç”¨ VARCHAR(n) é™åˆ¶é•¿åº¦ï¼ˆçµæ´»æ€§å·®ï¼‰
   CREATE TABLE products (
       id SERIAL PRIMARY KEY,
       name VARCHAR(100) NOT NULL  -- é™åˆ¶é•¿åº¦ï¼Œçµæ´»æ€§å·®
   );
   ```

2. **éœ€è¦é™åˆ¶é•¿åº¦æ—¶ä½¿ç”¨ VARCHAR**ï¼ˆæ•°æ®å®Œæ•´æ€§ï¼‰

   ```sql
   -- âœ… å¥½ï¼šéœ€è¦é™åˆ¶é•¿åº¦æ—¶ä½¿ç”¨ VARCHARï¼ˆæ•°æ®å®Œæ•´æ€§ï¼‰
   CREATE TABLE users (
       id SERIAL PRIMARY KEY,
       email VARCHAR(255) NOT NULL,  -- é‚®ç®±é•¿åº¦æœ‰é™åˆ¶
       phone VARCHAR(20)  -- ç”µè¯å·ç é•¿åº¦æœ‰é™åˆ¶
   );
   ```

**å­—ç¬¦ç±»å‹é€‰æ‹©è¡¨**ï¼š

| æ•°æ®ç±»å‹ | ç‰¹ç‚¹ | ä½¿ç”¨åœºæ™¯ |
|---------|------|---------|
| TEXT | æ— é•¿åº¦é™åˆ¶ | **æ¨èä½¿ç”¨** |
| VARCHAR(n) | æœ‰é•¿åº¦é™åˆ¶ | éœ€è¦é™åˆ¶é•¿åº¦ |
| CHAR(n) | å›ºå®šé•¿åº¦ï¼Œå¡«å……ç©ºæ ¼ | å›ºå®šé•¿åº¦å­—ç¬¦ä¸² |

### 7.3 JSON vs JSONB

**æ¨èåšæ³•**ï¼š

1. **ä¼˜å…ˆä½¿ç”¨ JSONB**ï¼ˆæŸ¥è¯¢æ€§èƒ½å¥½ï¼‰

   ```sql
   -- âœ… å¥½ï¼šä¼˜å…ˆä½¿ç”¨ JSONBï¼ˆæŸ¥è¯¢æ€§èƒ½å¥½ï¼‰
   CREATE TABLE products (
       id SERIAL PRIMARY KEY,
       metadata JSONB NOT NULL  -- æ¨èä½¿ç”¨ JSONB
   );

   -- åˆ›å»º GIN ç´¢å¼•
   CREATE INDEX idx_products_metadata ON products USING GIN (metadata);

   -- âŒ ä¸å¥½ï¼šä½¿ç”¨ JSONï¼ˆæŸ¥è¯¢æ€§èƒ½å·®ï¼‰
   CREATE TABLE products (
       id SERIAL PRIMARY KEY,
       metadata JSON NOT NULL  -- æŸ¥è¯¢æ€§èƒ½å·®
   );
   ```

**JSON vs JSONB å¯¹æ¯”è¡¨**ï¼š

| ç‰¹æ€§ | JSON | JSONB |
|------|------|-------|
| å­˜å‚¨æ ¼å¼ | æ–‡æœ¬ | äºŒè¿›åˆ¶ |
| æŸ¥è¯¢æ€§èƒ½ | æ…¢ | **å¿«** |
| ç´¢å¼•æ”¯æŒ | æœ‰é™ | **å®Œæ•´æ”¯æŒ** |
| æ¨èä½¿ç”¨ | âŒ | âœ… |

## 8. å®è·µç»ƒä¹ 

### ç»ƒä¹  1: JSONB æŸ¥è¯¢

```sql
-- ä»»åŠ¡: æŸ¥è¯¢ä»·æ ¼åœ¨ 100-500 ä¹‹é—´çš„ç”µå­äº§å“
SELECT name, metadata->>'price' AS price
FROM products
WHERE metadata @> '{"category": "electronics"}'::jsonb
AND (metadata->>'price')::INTEGER BETWEEN 100 AND 500;
```

## 9. å‚è€ƒèµ„æ–™

### 9.1 å®˜æ–¹æ–‡æ¡£

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - æ•°æ®ç±»å‹](https://www.postgresql.org/docs/current/datatype.html)**
  - æ•°æ®ç±»å‹å®Œæ•´å‚è€ƒæ‰‹å†Œ
  - åŒ…å«æ‰€æœ‰æ•°æ®ç±»å‹çš„è¯¦ç»†è¯´æ˜

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - JSONç±»å‹](https://www.postgresql.org/docs/current/datatype-json.html)**
  - JSON/JSONBç±»å‹è¯¦ç»†è¯´æ˜
  - JSONæ“ä½œç¬¦å’Œå‡½æ•°ä½¿ç”¨æŒ‡å—

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - æ•°ç»„ç±»å‹](https://www.postgresql.org/docs/current/arrays.html)**
  - æ•°ç»„ç±»å‹è¯¦ç»†è¯´æ˜
  - æ•°ç»„æ“ä½œç¬¦å’Œå‡½æ•°ä½¿ç”¨æŒ‡å—

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - èŒƒå›´ç±»å‹](https://www.postgresql.org/docs/current/rangetypes.html)**
  - èŒƒå›´ç±»å‹è¯¦ç»†è¯´æ˜
  - èŒƒå›´æ“ä½œç¬¦å’Œå‡½æ•°ä½¿ç”¨æŒ‡å—

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - è‡ªå®šä¹‰ç±»å‹](https://www.postgresql.org/docs/current/datatype-enum.html)**
  - æšä¸¾ç±»å‹è¯¦ç»†è¯´æ˜
  - å¤åˆç±»å‹å’ŒåŸŸç±»å‹ä½¿ç”¨æŒ‡å—

### 9.2 SQLæ ‡å‡†æ–‡æ¡£

- **[ISO/IEC 9075 SQL æ ‡å‡†](https://www.iso.org/standard/76583.html)**
  - SQLæ•°æ®ç±»å‹æ ‡å‡†å®šä¹‰
  - PostgreSQLå¯¹SQLæ ‡å‡†çš„æ”¯æŒæƒ…å†µ

- **[PostgreSQL SQL æ ‡å‡†å…¼å®¹æ€§](https://www.postgresql.org/docs/current/features.html)**
  - PostgreSQLå¯¹SQLæ ‡å‡†çš„æ”¯æŒ
  - SQLæ ‡å‡†æ•°æ®ç±»å‹å¯¹æ¯”

### 9.3 æŠ€æœ¯è®ºæ–‡

- **[Stonebraker, M., et al. (2005). "C-Store: A Column-oriented DBMS."](https://www.vldb.org/conf/2005/papers/p553-stonebraker.pdf)**
  - åˆ—å¼å­˜å‚¨çš„åŸºç¡€ç ”ç©¶
  - æ•°æ®ç±»å‹åœ¨åˆ—å¼å­˜å‚¨ä¸­çš„åº”ç”¨

- **[Agrawal, R., et al. (2008). "The Claremont Report on Database Research."](https://cacm.acm.org/magazines/2009/5/24646-the-claremont-report-on-database-research/fulltext)**
  - æ•°æ®åº“ç ”ç©¶çš„ç»¼è¿°æ€§æŠ¥å‘Š
  - æ•°æ®ç±»å‹ç³»ç»Ÿçš„æ¼”è¿›

### 9.4 æŠ€æœ¯åšå®¢

- **[PostgreSQL å®˜æ–¹åšå®¢ - æ•°æ®ç±»å‹](https://www.postgresql.org/about/newsarchive/)**
  - PostgreSQL æ•°æ®ç±»å‹æœ€æ–°åŠ¨æ€
  - å®é™…åº”ç”¨æ¡ˆä¾‹åˆ†äº«

- **[2ndQuadrant PostgreSQL åšå®¢](https://www.2ndquadrant.com/en/blog/)**
  - PostgreSQL æ•°æ®ç±»å‹æ–‡ç« 
  - å®é™…åº”ç”¨æ¡ˆä¾‹

- **[Percona PostgreSQL åšå®¢](https://www.percona.com/blog/tag/postgresql/)**
  - PostgreSQL æ•°æ®ç±»å‹ä¼˜åŒ–å®è·µ
  - æ€§èƒ½ä¼˜åŒ–æ¡ˆä¾‹

### 9.5 ç¤¾åŒºèµ„æº

- **[PostgreSQL Wiki - æ•°æ®ç±»å‹](https://wiki.postgresql.org/wiki/Data_Types)**
  - PostgreSQL æ•°æ®ç±»å‹Wiki
  - å¸¸è§é—®é¢˜è§£ç­”å’Œæœ€ä½³å®è·µ

- **[Stack Overflow - PostgreSQL æ•°æ®ç±»å‹](https://stackoverflow.com/questions/tagged/postgresql+data-types)**
  - PostgreSQL æ•°æ®ç±»å‹ç›¸å…³é—®ç­”
  - é«˜è´¨é‡çš„é—®é¢˜å’Œç­”æ¡ˆ

- **[PostgreSQL é‚®ä»¶åˆ—è¡¨](https://www.postgresql.org/list/)**
  - PostgreSQL ç¤¾åŒºè®¨è®º
  - æ•°æ®ç±»å‹ä½¿ç”¨é—®é¢˜äº¤æµ

### 9.6 ç›¸å…³æ–‡æ¡£

- [æ•°æ®ç±»å‹ä½“ç³»è¯¦è§£](./æ•°æ®ç±»å‹ä½“ç³»è¯¦è§£.md)
- [æ•°ç»„ä¸JSONBé«˜çº§åº”ç”¨](./æ•°ç»„ä¸JSONBé«˜çº§åº”ç”¨.md)
- [èŒƒå›´ç±»å‹è¯¦è§£](./èŒƒå›´ç±»å‹è¯¦è§£.md)
- [è‡ªå®šä¹‰ç±»å‹è¯¦è§£](./è‡ªå®šä¹‰ç±»å‹è¯¦è§£.md)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 03-03-04
