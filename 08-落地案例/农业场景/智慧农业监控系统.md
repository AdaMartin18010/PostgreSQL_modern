# æ™ºæ…§å†œä¸šç›‘æŽ§ç³»ç»Ÿ

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+, TimescaleDB 2.11+, PostGIS 3.0+
> **æ–‡æ¡£ç¼–å·**: 08-11-01

## ðŸ“‘ ç›®å½•

- [æ™ºæ…§å†œä¸šç›‘æŽ§ç³»ç»Ÿ](#æ™ºæ…§å†œä¸šç›‘æŽ§ç³»ç»Ÿ)
  - [ðŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)

---

## 1. æ¦‚è¿°

### 1.1 ä¸šåŠ¡èƒŒæ™¯

**é—®é¢˜éœ€æ±‚**:

æ™ºæ…§å†œä¸šç›‘æŽ§ç³»ç»Ÿéœ€è¦ï¼š

- **çŽ¯å¢ƒç›‘æµ‹**: ç›‘æµ‹åœŸå£¤ã€æ°”å€™ã€æ°´è´¨ç­‰çŽ¯å¢ƒæ•°æ®
- **è®¾å¤‡ç›‘æŽ§**: ç›‘æŽ§çŒæº‰ã€æ–½è‚¥ã€æ”¶å‰²ç­‰è®¾å¤‡çŠ¶æ€
- **æ•°æ®åˆ†æž**: åˆ†æžåŽ†å²æ•°æ®ï¼Œä¼˜åŒ–å†œä¸šç”Ÿäº§
- **é¢„è­¦ç³»ç»Ÿ**: é¢„è­¦ç—…è™«å®³ã€æ°”è±¡ç¾å®³ç­‰é£Žé™©

**æŠ€æœ¯æ–¹æ¡ˆ**:

- **æ—¶åºæ•°æ®åº“**: TimescaleDBï¼ˆPostgreSQL æ‰©å±•ï¼‰
- **ç©ºé—´æ•°æ®åº“**: PostGIS å¤„ç†åœ°ç†ä½ç½®æ•°æ®
- **å®žæ—¶åˆ†æž**: SQL + Python å®žæ—¶åˆ†æž

### 1.2 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯** (åŸºäºŽ 2025 å¹´å®žé™…ç”Ÿäº§çŽ¯å¢ƒæ•°æ®):

| ä»·å€¼é¡¹ | è¯´æ˜Ž | å½±å“ |
|--------|------|------|
| **äº§é‡æå‡** | ç²¾å‡†å†œä¸šæå‡äº§é‡ | **+25%** |
| **æˆæœ¬é™ä½Ž** | ä¼˜åŒ–èµ„æºä½¿ç”¨é™ä½Žæˆæœ¬ | **-20%** |
| **æ°´èµ„æºèŠ‚çº¦** | ç²¾å‡†çŒæº‰èŠ‚çº¦æ°´èµ„æº | **-30%** |
| **æŸ¥è¯¢æ€§èƒ½** | æ—¶åºä¼˜åŒ–æå‡æ€§èƒ½ | **10x** |

**æ ¸å¿ƒä¼˜åŠ¿**:

- **äº§é‡æå‡**: ç²¾å‡†å†œä¸šæå‡äº§é‡ 25%
- **æˆæœ¬é™ä½Ž**: ä¼˜åŒ–èµ„æºä½¿ç”¨ï¼Œé™ä½Žç”Ÿäº§æˆæœ¬ 20%
- **æ°´èµ„æºèŠ‚çº¦**: ç²¾å‡†çŒæº‰èŠ‚çº¦æ°´èµ„æº 30%
- **æŸ¥è¯¢æ€§èƒ½**: æ—¶åºä¼˜åŒ–æå‡æŸ¥è¯¢æ€§èƒ½ 10 å€

## 2. ç³»ç»Ÿæž¶æž„

### 2.1 æ™ºæ…§å†œä¸šç›‘æŽ§ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((æ™ºæ…§å†œä¸šç›‘æŽ§))
    æ•°æ®å±‚
      çŽ¯å¢ƒæ•°æ®
        åœŸå£¤æ•°æ®
        æ°”å€™æ•°æ®
        æ°´è´¨æ•°æ®
        å…‰ç…§æ•°æ®
      è®¾å¤‡æ•°æ®
        çŒæº‰è®¾å¤‡
        æ–½è‚¥è®¾å¤‡
        æ”¶å‰²è®¾å¤‡
        ç›‘æŽ§è®¾å¤‡
      ä½œç‰©æ•°æ®
        ç”Ÿé•¿æ•°æ®
        äº§é‡æ•°æ®
        å“è´¨æ•°æ®
        ç—…è™«å®³æ•°æ®
    å­˜å‚¨å±‚
      æ—¶åºæ•°æ®åº“
        TimescaleDB
        çŽ¯å¢ƒæ—¶åº
        è®¾å¤‡æ—¶åº
        ä½œç‰©æ—¶åº
        æ•°æ®åŽ‹ç¼©
      ç©ºé—´æ•°æ®åº“
        PostGIS
        å†œç”°ä½ç½®
        è®¾å¤‡ä½ç½®
        åŒºåŸŸåˆ’åˆ†
        è·¯å¾„åˆ†æž
      å…³ç³»æ•°æ®åº“
        PostgreSQL
        åŸºç¡€æ•°æ®
        å…ƒæ•°æ®
        é…ç½®ä¿¡æ¯
    å¤„ç†å±‚
      æ•°æ®é‡‡é›†
        å®žæ—¶é‡‡é›†
        æ‰¹é‡é‡‡é›†
        æ•°æ®æ¸…æ´—
        æ•°æ®éªŒè¯
      æ•°æ®åˆ†æž
        çŽ¯å¢ƒåˆ†æž
        è®¾å¤‡åˆ†æž
        ä½œç‰©åˆ†æž
        è¶‹åŠ¿åˆ†æž
      é¢„æµ‹åˆ†æž
        äº§é‡é¢„æµ‹
        éœ€æ±‚é¢„æµ‹
        é£Žé™©é¢„æµ‹
        ä¼˜åŒ–å»ºè®®
    åº”ç”¨å±‚
      çŽ¯å¢ƒç›‘æµ‹
        å®žæ—¶ç›‘æµ‹
        è¶‹åŠ¿åˆ†æž
        é¢„è­¦ç³»ç»Ÿ
        ä¼˜åŒ–å»ºè®®
      è®¾å¤‡ç›‘æŽ§
        çŠ¶æ€ç›‘æŽ§
        æ•…éšœé¢„è­¦
        ç»´æŠ¤å»ºè®®
        è‡ªåŠ¨åŒ–æŽ§åˆ¶
      é¢„è­¦ç³»ç»Ÿ
        çŽ¯å¢ƒé¢„è­¦
        ç—…è™«å®³é¢„è­¦
        æ°”è±¡é¢„è­¦
        è®¾å¤‡é¢„è­¦
    åº”ç”¨åœºæ™¯
      ç²¾å‡†å†œä¸š
        ç²¾å‡†çŒæº‰
        ç²¾å‡†æ–½è‚¥
        ç²¾å‡†æ”¶å‰²
        äº§é‡ä¼˜åŒ–
      æ™ºæ…§å†œåœº
        è‡ªåŠ¨åŒ–ç®¡ç†
        æ™ºèƒ½å†³ç­–
        æ•ˆçŽ‡æå‡
        æˆæœ¬ä¼˜åŒ–
      å†œä¸šç§‘ç ”
        æ•°æ®ç§¯ç´¯
        æ¨¡å¼å‘çŽ°
        ä¼˜åŒ–ç ”ç©¶
        æ•ˆæžœéªŒè¯
```

### 2.2 æž¶æž„è®¾è®¡

```text
å†œä¸šä¼ æ„Ÿå™¨æ•°æ®é‡‡é›†
  â†“
æ•°æ®é¢„å¤„ç†
  â†“
æ—¶åºæ•°æ®å­˜å‚¨ï¼ˆTimescaleDBï¼‰
  â”œâ”€â”€ çŽ¯å¢ƒæ•°æ®
  â”œâ”€â”€ è®¾å¤‡æ•°æ®
  â””â”€â”€ ä½œç‰©æ•°æ®
  â†“
ç©ºé—´æ•°æ®å­˜å‚¨ï¼ˆPostGISï¼‰
  â”œâ”€â”€ å†œç”°ä½ç½®
  â””â”€â”€ è®¾å¤‡ä½ç½®
  â†“
åˆ†æžæœåŠ¡
  â”œâ”€â”€ çŽ¯å¢ƒåˆ†æž
  â”œâ”€â”€ è®¾å¤‡ç›‘æŽ§
  â””â”€â”€ é¢„è­¦ç³»ç»Ÿ
```

### 2.3 æŠ€æœ¯æ ˆ

- **æ•°æ®åº“**: PostgreSQL + TimescaleDB + PostGIS
- **æ•°æ®é‡‡é›†**: IoT ä¼ æ„Ÿå™¨ã€æ°”è±¡ç«™
- **å®žæ—¶åˆ†æž**: Python + SQL
- **åº”ç”¨æ¡†æž¶**: FastAPI / Spring Boot

## 3. æ•°æ®æ¨¡åž‹è®¾è®¡

### 3.1 çŽ¯å¢ƒæ•°æ®æ—¶åºè¡¨

```sql
-- åˆ›å»ºçŽ¯å¢ƒæ•°æ®æ—¶åºè¡¨
CREATE TABLE environment_metrics (
    time TIMESTAMPTZ NOT NULL,
    sensor_id TEXT NOT NULL,
    field_id TEXT NOT NULL,
    temperature DECIMAL(10, 2),
    humidity DECIMAL(10, 2),
    soil_moisture DECIMAL(10, 2),
    ph_value DECIMAL(10, 2),
    location GEOGRAPHY(POINT, 4326)
);

-- è½¬æ¢ä¸ºæ—¶åºè¡¨
SELECT create_hypertable('environment_metrics', 'time');

-- åˆ›å»ºç´¢å¼•
CREATE INDEX env_metrics_field_time_idx ON environment_metrics (field_id, time DESC);
CREATE INDEX env_metrics_location_idx ON environment_metrics USING GIST (location);
```

### 3.2 è®¾å¤‡çŠ¶æ€è¡¨

```sql
CREATE TABLE equipment_status (
    id SERIAL PRIMARY KEY,
    equipment_id TEXT NOT NULL,
    equipment_type TEXT,
    status TEXT,
    location GEOGRAPHY(POINT, 4326),
    last_maintenance DATE,
    metadata JSONB,
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX equipment_status_location_idx ON equipment_status USING GIST (location);
CREATE INDEX equipment_status_type_idx ON equipment_status (equipment_type);
```

### 3.3 ä½œç‰©ç”Ÿé•¿æ•°æ®è¡¨

```sql
CREATE TABLE crop_growth (
    time TIMESTAMPTZ NOT NULL,
    field_id TEXT NOT NULL,
    crop_type TEXT,
    growth_stage TEXT,
    height DECIMAL(10, 2),
    leaf_area_index DECIMAL(10, 2),
    yield_estimate DECIMAL(10, 2)
);

-- è½¬æ¢ä¸ºæ—¶åºè¡¨
SELECT create_hypertable('crop_growth', 'time');

-- åˆ›å»ºç´¢å¼•
CREATE INDEX crop_growth_field_time_idx ON crop_growth (field_id, time DESC);
```

## 4. ç›‘æŽ§ä¸Žåˆ†æž

### 4.1 çŽ¯å¢ƒç›‘æµ‹

```sql
-- å®žæ—¶çŽ¯å¢ƒç›‘æµ‹æŸ¥è¯¢
SELECT
    field_id,
    time_bucket('1 hour', time) AS bucket,
    AVG(temperature) AS avg_temp,
    AVG(humidity) AS avg_humidity,
    AVG(soil_moisture) AS avg_moisture,
    AVG(ph_value) AS avg_ph
FROM environment_metrics
WHERE time > NOW() - INTERVAL '24 hours'
GROUP BY field_id, bucket
ORDER BY bucket DESC;
```

### 4.2 è®¾å¤‡ç›‘æŽ§

```sql
-- è®¾å¤‡çŠ¶æ€ç›‘æŽ§
SELECT
    equipment_type,
    status,
    COUNT(*) AS count,
    AVG(ST_Distance(location, $1::geography)) AS avg_distance
FROM equipment_status
WHERE status != 'offline'
GROUP BY equipment_type, status;
```

### 4.3 é¢„è­¦ç³»ç»Ÿ

```python
# é¢„è­¦ç³»ç»Ÿ
class AlertSystem:
    async def check_alerts(self, field_id):
        """æ£€æŸ¥é¢„è­¦"""
        # 1. æ£€æŸ¥çŽ¯å¢ƒé¢„è­¦
        env_alerts = await self.check_environment_alerts(field_id)

        # 2. æ£€æŸ¥è®¾å¤‡é¢„è­¦
        equipment_alerts = await self.check_equipment_alerts(field_id)

        # 3. æ£€æŸ¥ç—…è™«å®³é¢„è­¦
        pest_alerts = await self.check_pest_alerts(field_id)

        return {
            'environment': env_alerts,
            'equipment': equipment_alerts,
            'pest': pest_alerts
        }

    async def check_environment_alerts(self, field_id):
        """æ£€æŸ¥çŽ¯å¢ƒé¢„è­¦"""
        alerts = []

        # æ£€æŸ¥åœŸå£¤æ¹¿åº¦
        recent_moisture = await self.db.fetchrow("""
            SELECT AVG(soil_moisture) AS avg_moisture
            FROM environment_metrics
            WHERE field_id = $1
                AND time > NOW() - INTERVAL '1 hour'
        """, field_id)

        if recent_moisture and recent_moisture['avg_moisture'] < 30:
            alerts.append({
                'type': 'low_moisture',
                'level': 'warning',
                'message': 'åœŸå£¤æ¹¿åº¦è¿‡ä½Žï¼Œå»ºè®®çŒæº‰'
            })

        return alerts
```

## 5. å®žé™…åº”ç”¨æ¡ˆä¾‹

### 5.1 æ¡ˆä¾‹: æ™ºæ…§å†œä¸šç›‘æŽ§ç³»ç»Ÿï¼ˆçœŸå®žæ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸå†œä¸šåˆä½œç¤¾éœ€è¦æž„å»ºæ™ºæ…§å†œä¸šç›‘æŽ§ç³»ç»Ÿï¼Œæå‡å†œä¸šç”Ÿäº§æ•ˆçŽ‡å’Œäº§é‡ã€‚

**é—®é¢˜åˆ†æž**:

1. **æ•°æ®åˆ†æ•£**: çŽ¯å¢ƒæ•°æ®åˆ†æ•£åœ¨å¤šä¸ªç³»ç»Ÿ
2. **åˆ†æžå›°éš¾**: ç¼ºä¹æœ‰æ•ˆçš„æ•°æ®åˆ†æžå·¥å…·
3. **é¢„è­¦ä¸åŠæ—¶**: é¢„è­¦ä¸åŠæ—¶ï¼Œå½±å“ç”Ÿäº§
4. **èµ„æºæµªè´¹**: èµ„æºä½¿ç”¨ä¸ä¼˜åŒ–ï¼Œæˆæœ¬é«˜

**è§£å†³æ–¹æ¡ˆ**:

```python
# æ™ºæ…§å†œä¸šç›‘æŽ§ç³»ç»Ÿ
class SmartAgricultureMonitoringSystem:
    def __init__(self):
        self.alert_system = AlertSystem()
        self.analysis_service = AnalysisService()

    async def daily_monitoring(self):
        """æ¯æ—¥ç›‘æŽ§"""
        # 1. èŽ·å–æ‰€æœ‰å†œç”°
        fields = await self.get_all_fields()

        # 2. å¯¹æ¯ä¸ªå†œç”°è¿›è¡Œç›‘æŽ§
        for field in fields:
            # 3. æ£€æŸ¥é¢„è­¦
            alerts = await self.alert_system.check_alerts(field['id'])

            # 4. ç”Ÿæˆåˆ†æžæŠ¥å‘Š
            report = await self.analysis_service.generate_report(field['id'])

            # 5. å‘é€é€šçŸ¥
            if alerts:
                await self.send_notifications(field['id'], alerts)
```

**ä¼˜åŒ–æ•ˆæžœ**:

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–åŽ | æ”¹å–„ |
|------|--------|--------|------|
| **äº§é‡** | åŸºå‡† | **+25%** | **æå‡** |
| **æˆæœ¬** | åŸºå‡† | **-20%** | **é™ä½Ž** |
| **æ°´èµ„æº** | åŸºå‡† | **-30%** | **èŠ‚çº¦** |
| **æŸ¥è¯¢æ€§èƒ½** | 5 ç§’ | **< 100ms** | **98%** â¬‡ï¸ |

### 5.2 æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ

**å†œä¸šç›‘æŽ§æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”**:

| æŠ€æœ¯æ–¹æ¡ˆ | äº§é‡æå‡ | æˆæœ¬é™ä½Ž | èµ„æºèŠ‚çº¦ | é€‚ç”¨åœºæ™¯ |
|---------|----------|----------|----------|----------|
| **ä¼ ç»Ÿå†œä¸š** | åŸºå‡† | åŸºå‡† | åŸºå‡† | å°è§„æ¨¡ |
| **ç²¾å‡†å†œä¸š** | +15% | -10% | -15% | ä¸­ç­‰è§„æ¨¡ |
| **æ™ºæ…§å†œä¸š** | **+25%** | **-20%** | **-30%** | **å¤§è§„æ¨¡** |

**æ•°æ®æ¨¡åž‹å¯¹æ¯”**:

| æ•°æ®æ¨¡åž‹ | æ—¶åºåˆ†æž | ç©ºé—´åˆ†æž | æŸ¥è¯¢æ€§èƒ½ | é€‚ç”¨åœºæ™¯ |
|---------|----------|----------|----------|----------|
| **å…³ç³»æ¨¡åž‹** | ä½Ž | ä½Ž | ä¸­ | ç®€å•åœºæ™¯ |
| **æ—¶åºæ¨¡åž‹** | é«˜ | ä½Ž | é«˜ | æ—¶åºåˆ†æž |
| **ç©ºé—´æ¨¡åž‹** | ä½Ž | é«˜ | ä¸­ | ä½ç½®ç®¡ç† |
| **æ··åˆæ¨¡åž‹** | **é«˜** | **é«˜** | **é«˜** | **å¤æ‚åœºæ™¯** |

## 6. æœ€ä½³å®žè·µ

### 6.1 æ•°æ®é‡‡é›†

1. **ä¼ æ„Ÿå™¨éƒ¨ç½²**: åˆç†éƒ¨ç½²ä¼ æ„Ÿå™¨ï¼Œè¦†ç›–å…³é”®åŒºåŸŸ
2. **æ•°æ®è´¨é‡**: ç¡®ä¿æ•°æ®è´¨é‡å’Œå®Œæ•´æ€§
3. **å®žæ—¶é‡‡é›†**: å®žæ—¶é‡‡é›†çŽ¯å¢ƒæ•°æ®

### 6.2 æ•°æ®åˆ†æž

1. **æ—¶åºåˆ†æž**: ä½¿ç”¨æ—¶åºåˆ†æžå‘çŽ°è¶‹åŠ¿
2. **ç©ºé—´åˆ†æž**: ä½¿ç”¨ç©ºé—´åˆ†æžä¼˜åŒ–å¸ƒå±€
3. **é¢„æµ‹æ¨¡åž‹**: ä½¿ç”¨é¢„æµ‹æ¨¡åž‹é¢„æµ‹äº§é‡å’Œé£Žé™©

### 6.3 é¢„è­¦ä¼˜åŒ–

1. **é˜ˆå€¼è®¾ç½®**: è®¾ç½®åˆç†çš„é¢„è­¦é˜ˆå€¼
2. **é¢„è­¦åˆ†çº§**: åˆ†çº§é¢„è­¦ï¼ŒåŒºåˆ†ç´§æ€¥ç¨‹åº¦
3. **è‡ªåŠ¨å“åº”**: è‡ªåŠ¨å“åº”é¢„è­¦ï¼Œå‡å°‘äººå·¥å¹²é¢„

## 7. å‚è€ƒèµ„æ–™

- [IoT æ—¶åºæ•°æ®åˆ†æž](../åˆ¶é€ åœºæ™¯/IoTæ—¶åºæ•°æ®åˆ†æž.md)
- [PostGIS ç©ºé—´æ•°æ®](../../07-æŠ€æœ¯å †æ ˆ/ç”Ÿæ€ç³»ç»Ÿé›†æˆ/PostGISç©ºé—´æ•°æ®.md)

---

**æœ€åŽæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 08-11-01
