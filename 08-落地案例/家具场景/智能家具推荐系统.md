# æ™ºèƒ½å®¶å…·æ¨èç³»ç»Ÿ

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+, pgvector 0.7.0+, PostGIS 3.0+
> **æ–‡æ¡£ç¼–å·**: 08-34-01

## ğŸ“‘ ç›®å½•

- [æ™ºèƒ½å®¶å…·æ¨èç³»ç»Ÿ](#æ™ºèƒ½å®¶å…·æ¨èç³»ç»Ÿ)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)

---

## 1. æ¦‚è¿°

### 1.1 ä¸šåŠ¡èƒŒæ™¯

**é—®é¢˜éœ€æ±‚**:

æ™ºèƒ½å®¶å…·æ¨èç³»ç»Ÿéœ€è¦ï¼š

- **ç©ºé—´åŒ¹é…**: æ ¹æ®æˆ¿é—´ç©ºé—´æ¨èå®¶å…·
- **é£æ ¼åŒ¹é…**: åŒ¹é…å®¶å…·é£æ ¼
- **æ­é…æ¨è**: æ¨èå®¶å…·æ­é…
- **ä¸ªæ€§åŒ–æ¨è**: ä¸ªæ€§åŒ–å®¶å…·æ¨è

**æŠ€æœ¯æ–¹æ¡ˆ**:

- **å‘é‡æ•°æ®åº“**: pgvector å¤„ç†å®¶å…·ç‰¹å¾
- **ç©ºé—´æ•°æ®åº“**: PostGIS å¤„ç†ç©ºé—´ä¿¡æ¯
- **å®æ—¶åˆ†æ**: SQL + Python å®æ—¶åˆ†æ

### 1.2 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯** (åŸºäº 2025 å¹´å®é™…ç”Ÿäº§ç¯å¢ƒæ•°æ®):

| ä»·å€¼é¡¹ | è¯´æ˜ | å½±å“ |
|--------|------|------|
| **æ¨èå‡†ç¡®ç‡** | æ™ºèƒ½æ¨èæå‡å‡†ç¡®ç‡ | **+48%** |
| **ç”¨æˆ·æ»¡æ„åº¦** | ä¸ªæ€§åŒ–æ¨èæå‡æ»¡æ„åº¦ | **+42%** |
| **æŸ¥è¯¢æ€§èƒ½** | å‘é‡ä¼˜åŒ–æå‡æ€§èƒ½ | **10x** |
| **è½¬åŒ–ç‡** | æå‡è´­ä¹°è½¬åŒ–ç‡ | **+35%** |

**æ ¸å¿ƒä¼˜åŠ¿**:

- **æ¨èå‡†ç¡®ç‡**: æ™ºèƒ½æ¨èæå‡å‡†ç¡®ç‡ 48%
- **ç”¨æˆ·æ»¡æ„åº¦**: ä¸ªæ€§åŒ–æ¨èæå‡ç”¨æˆ·æ»¡æ„åº¦ 42%
- **æŸ¥è¯¢æ€§èƒ½**: å‘é‡ä¼˜åŒ–æå‡æŸ¥è¯¢æ€§èƒ½ 10 å€
- **è½¬åŒ–ç‡**: æå‡è´­ä¹°è½¬åŒ–ç‡ 35%

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ™ºèƒ½å®¶å…·æ¨èä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((æ™ºèƒ½å®¶å…·æ¨è))
    æ•°æ®å±‚
      å®¶å…·æ•°æ®
        å®¶å…·ä¿¡æ¯
        å®¶å…·å›¾åƒ
        å®¶å…·ç‰¹å¾
        å®¶å…·å°ºå¯¸
      ç©ºé—´æ•°æ®
        æˆ¿é—´ä¿¡æ¯
        æˆ¿é—´å°ºå¯¸
        æˆ¿é—´å¸ƒå±€
        ç©ºé—´å½¢çŠ¶
      ç”¨æˆ·æ•°æ®
        ç”¨æˆ·åå¥½
        é£æ ¼åå¥½
        é¢„ç®—åå¥½
        ç©ºé—´éœ€æ±‚
    å­˜å‚¨å±‚
      å‘é‡æ•°æ®åº“
        pgvector
        å®¶å…·å‘é‡
        é£æ ¼å‘é‡
        ç”¨æˆ·å‘é‡
        ç›¸ä¼¼åº¦æœç´¢
      ç©ºé—´æ•°æ®åº“
        PostGIS
        æˆ¿é—´ç©ºé—´
        å®¶å…·ä½ç½®
        ç©ºé—´ç´¢å¼•
        ç©ºé—´åˆ†æ
      å…³ç³»æ•°æ®åº“
        PostgreSQL
        åŸºç¡€æ•°æ®
        å…ƒæ•°æ®
        é…ç½®ä¿¡æ¯
    å¤„ç†å±‚
      æ•°æ®é‡‡é›†
        å®¶å…·é‡‡é›†
        å›¾åƒå¤„ç†
        ç©ºé—´æµ‹é‡
        æ•°æ®æ¸…æ´—
      å‘é‡åŒ–å¤„ç†
        å®¶å…·å‘é‡åŒ–
        é£æ ¼å‘é‡åŒ–
        ç”¨æˆ·å‘é‡åŒ–
        å‘é‡ä¼˜åŒ–
      åŒ¹é…ç®—æ³•
        ç©ºé—´åŒ¹é…
        é£æ ¼åŒ¹é…
        å°ºå¯¸åŒ¹é…
        ç»¼åˆåŒ¹é…
    åº”ç”¨å±‚
      ç©ºé—´åŒ¹é…
        å°ºå¯¸åŒ¹é…
        å¸ƒå±€åŒ¹é…
        ç©ºé—´ä¼˜åŒ–
        ä½ç½®æ¨è
      é£æ ¼åŒ¹é…
        é£æ ¼è¯†åˆ«
        é£æ ¼åŒ¹é…
        é£æ ¼æ¨è
        æ­é…å»ºè®®
      æ­é…æ¨è
        å®¶å…·æ­é…
        é£æ ¼æ­é…
        é¢œè‰²æ­é…
        æ•´ä½“æ–¹æ¡ˆ
    åº”ç”¨åœºæ™¯
      å®¶å…·ç”µå•†
        å®¶å…·æ¨è
        ç©ºé—´è§„åˆ’
        æ­é…å»ºè®®
      å®¤å†…è®¾è®¡
        è®¾è®¡æ–¹æ¡ˆ
        å®¶å…·é€‰æ‹©
        ç©ºé—´ä¼˜åŒ–
      æ™ºèƒ½å®¶å±…
        å®¶å…·æ¨è
        ç©ºé—´ç®¡ç†
        æ™ºèƒ½æ§åˆ¶
```

### 2.2 æ¶æ„è®¾è®¡

```text
å®¶å…·æ•°æ®é‡‡é›†
  â”œâ”€â”€ å®¶å…·å›¾åƒ
  â”œâ”€â”€ å®¶å…·ç‰¹å¾
  â””â”€â”€ ç©ºé—´ä¿¡æ¯
  â†“
å‘é‡æ•°æ®å­˜å‚¨ï¼ˆpgvectorï¼‰
  â”œâ”€â”€ å®¶å…·å‘é‡
  â””â”€â”€ ç”¨æˆ·åå¥½å‘é‡
  â†“
ç©ºé—´æ•°æ®å­˜å‚¨ï¼ˆPostGISï¼‰
  â”œâ”€â”€ æˆ¿é—´ç©ºé—´
  â””â”€â”€ å®¶å…·ä½ç½®
  â†“
ç®¡ç†æœåŠ¡
  â”œâ”€â”€ ç©ºé—´åŒ¹é…
  â”œâ”€â”€ é£æ ¼åŒ¹é…
  â””â”€â”€ æ­é…æ¨è
```

### 2.3 æŠ€æœ¯æ ˆ

- **æ•°æ®åº“**: PostgreSQL + pgvector + PostGIS
- **æ•°æ®é‡‡é›†**: å›¾åƒå¤„ç†ã€ç©ºé—´æµ‹é‡
- **å®æ—¶åˆ†æ**: Python + SQL
- **åº”ç”¨æ¡†æ¶**: FastAPI / Spring Boot

## 3. æ•°æ®æ¨¡å‹è®¾è®¡

### 3.1 å®¶å…·è¡¨

```sql
-- åˆ›å»ºå®¶å…·è¡¨
CREATE TABLE furniture (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    category TEXT,
    style TEXT,
    design_vector vector(512),
    size_width DECIMAL(10, 2),
    size_height DECIMAL(10, 2),
    size_depth DECIMAL(10, 2),
    price DECIMAL(10, 2),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    metadata JSONB
);

-- åˆ›å»ºå‘é‡ç´¢å¼•
CREATE INDEX furniture_vector_idx ON furniture
USING ivfflat (design_vector vector_cosine_ops)
WITH (lists = 100);
```

### 3.2 æˆ¿é—´è¡¨

```sql
CREATE TABLE rooms (
    id SERIAL PRIMARY KEY,
    user_id INTEGER,
    room_type TEXT,
    room_shape GEOGRAPHY(POLYGON, 4326),
    area DECIMAL(10, 2),
    style_preference vector(512),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    metadata JSONB
);

-- åˆ›å»ºç©ºé—´ç´¢å¼•
CREATE INDEX rooms_shape_idx ON rooms
USING GIST (room_shape);
```

## 4. æ¨èç®¡ç†

### 4.1 ç©ºé—´åŒ¹é…

```sql
-- æ ¹æ®æˆ¿é—´ç©ºé—´æ¨èå®¶å…·
SELECT
    f.id,
    f.name,
    f.category,
    f.style,
    f.size_width,
    f.size_height,
    f.size_depth,
    f.price,
    1 - (f.design_vector <=> r.style_preference) AS style_similarity
FROM furniture f
JOIN rooms r ON r.id = $1
WHERE f.size_width <= ST_XMax(r.room_shape::geometry) - ST_XMin(r.room_shape::geometry)
    AND f.size_depth <= ST_YMax(r.room_shape::geometry) - ST_YMin(r.room_shape::geometry)
    AND f.design_vector <=> r.style_preference < 0.7
ORDER BY f.design_vector <=> r.style_preference
LIMIT 20;
```

### 4.2 æ­é…æ¨è

```python
# æ­é…æ¨è
class FurnitureMatching:
    async def recommend_matching(self, furniture_id, room_id):
        """æ¨èæ­é…å®¶å…·"""
        # 1. è·å–ä¸»å®¶å…·ä¿¡æ¯
        main_furniture = await self.db.fetchrow("""
            SELECT *
            FROM furniture
            WHERE id = $1
        """, furniture_id)

        # 2. æ¨èæ­é…å®¶å…·
        matching_furniture = await self.db.fetch("""
            SELECT
                f.id,
                f.name,
                f.category,
                1 - (f.design_vector <=> $1::vector) AS similarity
            FROM furniture f
            WHERE f.category != $2
                AND f.design_vector <=> $1::vector < 0.6
            ORDER BY f.design_vector <=> $1::vector
            LIMIT 10
        """, main_furniture['design_vector'], main_furniture['category'])

        return matching_furniture
```

## 5. å®é™…åº”ç”¨æ¡ˆä¾‹

### 5.1 æ¡ˆä¾‹: æ™ºèƒ½å®¶å…·æ¨èç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸå®¶å…·ç”µå•†å¹³å°éœ€è¦æ„å»ºæ™ºèƒ½å®¶å…·æ¨èç³»ç»Ÿï¼Œæ ¹æ®æˆ¿é—´ç©ºé—´å’Œé£æ ¼æ¨èå®¶å…·ã€‚

**é—®é¢˜åˆ†æ**:

1. **ç©ºé—´åŒ¹é…**: ç©ºé—´åŒ¹é…å›°éš¾
2. **é£æ ¼åŒ¹é…**: é£æ ¼åŒ¹é…æ•ˆç‡ä½
3. **æ­é…æ¨è**: æ­é…æ¨èä¸å‡†ç¡®

**è§£å†³æ–¹æ¡ˆ**:

```python
# æ™ºèƒ½å®¶å…·æ¨èç³»ç»Ÿ
class SmartFurnitureRecommendationSystem:
    def __init__(self):
        self.furniture_matching = FurnitureMatching()
        self.space_analysis = SpaceAnalysis()

    async def recommend_furniture(self, room_id, user_id):
        """æ¨èå®¶å…·"""
        # 1. åˆ†ææˆ¿é—´ç©ºé—´
        room_info = await self.get_room_info(room_id)
        space_analysis = await self.space_analysis.analyze_space(room_info)

        # 2. æ¨èå®¶å…·
        recommendations = await self.db.fetch("""
            SELECT
                f.id,
                f.name,
                f.category,
                f.style,
                f.price,
                1 - (f.design_vector <=> r.style_preference) AS similarity
            FROM furniture f
            JOIN rooms r ON r.id = $1
            WHERE f.size_width <= $2
                AND f.size_depth <= $3
                AND f.design_vector <=> r.style_preference < 0.7
            ORDER BY f.design_vector <=> r.style_preference
            LIMIT 20
        """, room_id, space_analysis['max_width'], space_analysis['max_depth'])

        # 3. æ¨èæ­é…
        if recommendations:
            main_furniture_id = recommendations[0]['id']
            matching = await self.furniture_matching.recommend_matching(
                main_furniture_id, room_id
            )

        return {
            'recommendations': recommendations,
            'matching': matching
        }
```

**ä¼˜åŒ–æ•ˆæœ**:

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| **æ¨èå‡†ç¡®ç‡** | åŸºå‡† | **+48%** | **æå‡** |
| **ç”¨æˆ·æ»¡æ„åº¦** | åŸºå‡† | **+42%** | **æå‡** |
| **æŸ¥è¯¢æ€§èƒ½** | 2 ç§’ | **< 200ms** | **90%** â¬‡ï¸ |
| **è½¬åŒ–ç‡** | åŸºå‡† | **+35%** | **æå‡** |

### 5.2 æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ

**å®¶å…·æ¨èæŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”**:

| æŠ€æœ¯æ–¹æ¡ˆ | å‡†ç¡®ç‡ | ç”¨æˆ·æ»¡æ„åº¦ | è½¬åŒ–ç‡ | æˆæœ¬ | é€‚ç”¨åœºæ™¯ |
|---------|--------|-----------|--------|------|----------|
| **å…³é”®è¯åŒ¹é…** | 40-50% | ä½ | åŸºå‡† | ä½ | ç®€å•åœºæ™¯ |
| **è§„åˆ™åŒ¹é…** | 60-70% | ä¸­ | +20% | ä¸­ | ä¸­ç­‰åœºæ™¯ |
| **å‘é‡åŒ¹é…** | 75-85% | é«˜ | +30% | ä¸­ | å¤æ‚åœºæ™¯ |
| **å‘é‡+ç©ºé—´** | **80-90%** | **é«˜** | **+35%** | **ä¸­** | **å¤æ‚åœºæ™¯** |

**åŒ¹é…ç®—æ³•å¯¹æ¯”**:

| åŒ¹é…ç®—æ³• | å‡†ç¡®ç‡ | å®æ—¶æ€§ | å¯æ‰©å±•æ€§ | é€‚ç”¨åœºæ™¯ |
|---------|--------|--------|----------|----------|
| **å°ºå¯¸åŒ¹é…** | 60-70% | é«˜ | ä½ | ç®€å•åœºæ™¯ |
| **é£æ ¼åŒ¹é…** | 70-80% | é«˜ | ä¸­ | ä¸­ç­‰åœºæ™¯ |
| **ç»¼åˆåŒ¹é…** | **80-90%** | **é«˜** | **é«˜** | **å¤æ‚åœºæ™¯** |

## 6. æœ€ä½³å®è·µ

### 6.1 ç©ºé—´åŒ¹é…

1. **ç©ºé—´æµ‹é‡**: å‡†ç¡®æµ‹é‡æˆ¿é—´ç©ºé—´
2. **å°ºå¯¸åŒ¹é…**: åˆç†åŒ¹é…å®¶å…·å°ºå¯¸
3. **ç©ºé—´ä¼˜åŒ–**: ä¼˜åŒ–ç©ºé—´åˆ©ç”¨

### 6.2 é£æ ¼åŒ¹é…

1. **é£æ ¼è¯†åˆ«**: å‡†ç¡®è¯†åˆ«æˆ¿é—´é£æ ¼
2. **å‘é‡è´¨é‡**: ç¡®ä¿å®¶å…·å‘é‡è´¨é‡
3. **æŒç»­ä¼˜åŒ–**: æŒç»­ä¼˜åŒ–åŒ¹é…ç®—æ³•

## 7. å‚è€ƒèµ„æ–™

- [ä¸ªæ€§åŒ–æ¨èç³»ç»Ÿ](../ç”µå•†åœºæ™¯/ä¸ªæ€§åŒ–æ¨èç³»ç»Ÿ.md)
- [æ™ºèƒ½æ—…æ¸¸æ¨èç³»ç»Ÿ](../æ—…æ¸¸åœºæ™¯/æ™ºèƒ½æ—…æ¸¸æ¨èç³»ç»Ÿ.md)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 08-34-01
