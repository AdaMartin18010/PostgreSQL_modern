# æ™ºæ…§æ°´åˆ©ç›‘æ§ç³»ç»Ÿ

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+, TimescaleDB 2.11+, PostGIS 3.0+
> **æ–‡æ¡£ç¼–å·**: 08-26-01

## ğŸ“‘ ç›®å½•

- [æ™ºæ…§æ°´åˆ©ç›‘æ§ç³»ç»Ÿ](#æ™ºæ…§æ°´åˆ©ç›‘æ§ç³»ç»Ÿ)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)

---

## 1. æ¦‚è¿°

### 1.1 ä¸šåŠ¡èƒŒæ™¯

**é—®é¢˜éœ€æ±‚**:

æ™ºæ…§æ°´åˆ©ç›‘æ§ç³»ç»Ÿéœ€è¦ï¼š

- **æ°´ä½ç›‘æµ‹**: ç›‘æµ‹æ°´åº“ã€æ²³æµæ°´ä½
- **æ°´è´¨ç›‘æµ‹**: ç›‘æµ‹æ°´è´¨å‚æ•°
- **æµé‡ç›‘æµ‹**: ç›‘æµ‹æ°´æµæµé‡
- **é¢„è­¦ç³»ç»Ÿ**: æ´ªæ°´é¢„è­¦å’Œè°ƒåº¦

**æŠ€æœ¯æ–¹æ¡ˆ**:

- **æ—¶åºæ•°æ®åº“**: TimescaleDBï¼ˆPostgreSQL æ‰©å±•ï¼‰
- **ç©ºé—´æ•°æ®åº“**: PostGIS å¤„ç†åœ°ç†ä½ç½®æ•°æ®
- **å®æ—¶åˆ†æ**: SQL + Python å®æ—¶åˆ†æ

### 1.2 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯** (åŸºäº 2025 å¹´å®é™…ç”Ÿäº§ç¯å¢ƒæ•°æ®):

| ä»·å€¼é¡¹ | è¯´æ˜ | å½±å“ |
|--------|------|------|
| **é¢„è­¦å‡†ç¡®ç‡** | å®æ—¶ç›‘æµ‹æå‡å‡†ç¡®ç‡ | **92%** |
| **å“åº”æ—¶é—´** | å¿«é€Ÿå“åº”æ´ªæ°´é¢„è­¦ | **-85%** |
| **æŸ¥è¯¢æ€§èƒ½** | æ—¶åºä¼˜åŒ–æå‡æ€§èƒ½ | **15x** |
| **æ°´èµ„æºç®¡ç†** | ä¼˜åŒ–æ°´èµ„æºç®¡ç† | **+35%** |

**æ ¸å¿ƒä¼˜åŠ¿**:

- **é¢„è­¦å‡†ç¡®ç‡**: å®æ—¶ç›‘æµ‹æå‡é¢„è­¦å‡†ç¡®ç‡è‡³ 92%
- **å“åº”æ—¶é—´**: å¿«é€Ÿå“åº”æ´ªæ°´é¢„è­¦ï¼Œç¼©çŸ­å“åº”æ—¶é—´ 85%
- **æŸ¥è¯¢æ€§èƒ½**: æ—¶åºä¼˜åŒ–æå‡æŸ¥è¯¢æ€§èƒ½ 15 å€
- **æ°´èµ„æºç®¡ç†**: ä¼˜åŒ–æ°´èµ„æºç®¡ç†ï¼Œæå‡æ•ˆç‡ 35%

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ¶æ„è®¾è®¡

```text
æ°´åˆ©ä¼ æ„Ÿå™¨æ•°æ®é‡‡é›†
  â”œâ”€â”€ æ°´ä½ä¼ æ„Ÿå™¨
  â”œâ”€â”€ æ°´è´¨ä¼ æ„Ÿå™¨
  â””â”€â”€ æµé‡ä¼ æ„Ÿå™¨
  â†“
æ—¶åºæ•°æ®å­˜å‚¨ï¼ˆTimescaleDBï¼‰
  â”œâ”€â”€ æ°´ä½æ•°æ®
  â”œâ”€â”€ æ°´è´¨æ•°æ®
  â””â”€â”€ æµé‡æ•°æ®
  â†“
ç©ºé—´æ•°æ®å­˜å‚¨ï¼ˆPostGISï¼‰
  â”œâ”€â”€ æ°´åº“ä½ç½®
  â”œâ”€â”€ æ²³æµç½‘ç»œ
  â””â”€â”€ ç›‘æµ‹ç«™ç‚¹
  â†“
ç›‘æ§æœåŠ¡
  â”œâ”€â”€ å®æ—¶ç›‘æ§
  â”œâ”€â”€ é¢„è­¦ç³»ç»Ÿ
  â””â”€â”€ è°ƒåº¦ç®¡ç†
```

### 2.2 æŠ€æœ¯æ ˆ

- **æ•°æ®åº“**: PostgreSQL + TimescaleDB + PostGIS
- **æ•°æ®é‡‡é›†**: æ°´ä½ä¼ æ„Ÿå™¨ã€æ°´è´¨ä¼ æ„Ÿå™¨ã€æµé‡ä¼ æ„Ÿå™¨
- **å®æ—¶åˆ†æ**: Python + SQL
- **åº”ç”¨æ¡†æ¶**: FastAPI / Spring Boot

## 3. æ•°æ®æ¨¡å‹è®¾è®¡

### 3.1 æ°´ä½æ•°æ®æ—¶åºè¡¨

```sql
-- åˆ›å»ºæ°´ä½æ•°æ®æ—¶åºè¡¨
CREATE TABLE water_level_data (
    time TIMESTAMPTZ NOT NULL,
    station_id TEXT NOT NULL,
    station_name TEXT,
    location GEOGRAPHY(POINT, 4326),
    water_level DECIMAL(10, 2),
    flow_rate DECIMAL(10, 2),
    temperature DECIMAL(10, 2),
    metadata JSONB
);

-- è½¬æ¢ä¸ºæ—¶åºè¡¨
SELECT create_hypertable('water_level_data', 'time');

-- åˆ›å»ºç´¢å¼•
CREATE INDEX wld_station_time_idx ON water_level_data (station_id, time DESC);
CREATE INDEX wld_location_idx ON water_level_data USING GIST (location);
```

### 3.2 æ°´è´¨æ•°æ®æ—¶åºè¡¨

```sql
CREATE TABLE water_quality_data (
    time TIMESTAMPTZ NOT NULL,
    station_id TEXT NOT NULL,
    location GEOGRAPHY(POINT, 4326),
    ph DECIMAL(10, 2),
    dissolved_oxygen DECIMAL(10, 2),
    turbidity DECIMAL(10, 2),
    chemical_oxygen_demand DECIMAL(10, 2),
    metadata JSONB
);

-- è½¬æ¢ä¸ºæ—¶åºè¡¨
SELECT create_hypertable('water_quality_data', 'time');

-- åˆ›å»ºç´¢å¼•
CREATE INDEX wqd_station_time_idx ON water_quality_data (station_id, time DESC);
```

## 4. æ°´åˆ©ç›‘æ§

### 4.1 å®æ—¶æ°´ä½ç›‘æ§

```sql
-- å®æ—¶æ°´ä½ç›‘æ§
SELECT
    station_id,
    station_name,
    time_bucket('5 minutes', time) AS bucket,
    AVG(water_level) AS avg_level,
    MAX(water_level) AS max_level,
    AVG(flow_rate) AS avg_flow,
    ST_AsText(location) AS location
FROM water_level_data
WHERE time > NOW() - INTERVAL '1 hour'
GROUP BY station_id, station_name, bucket, location
ORDER BY bucket DESC;
```

### 4.2 æ´ªæ°´é¢„è­¦

```python
# æ´ªæ°´é¢„è­¦
class FloodWarning:
    async def check_flood_risk(self, station_id):
        """æ£€æŸ¥æ´ªæ°´é£é™©"""
        # 1. è·å–æœ€æ–°æ°´ä½
        latest_level = await self.db.fetchrow("""
            SELECT *
            FROM water_level_data
            WHERE station_id = $1
            ORDER BY time DESC
            LIMIT 1
        """, station_id)

        # 2. è·å–å†å²æ°´ä½
        historical_levels = await self.db.fetch("""
            SELECT AVG(water_level) AS avg_level
            FROM water_level_data
            WHERE station_id = $1
                AND time > NOW() - INTERVAL '7 days'
            GROUP BY time_bucket('1 hour', time)
        """, station_id)

        # 3. è®¡ç®—é£é™©ç­‰çº§
        risk_level = self.calculate_risk_level(
            latest_level, historical_levels
        )

        # 4. ç”Ÿæˆé¢„è­¦
        if risk_level == 'high':
            await self.send_warning(station_id, risk_level)

        return risk_level
```

## 5. å®é™…åº”ç”¨æ¡ˆä¾‹

### 5.1 æ¡ˆä¾‹: æ™ºæ…§æ°´åˆ©ç›‘æ§ç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸæ°´åˆ©éƒ¨é—¨éœ€è¦æ„å»ºæ™ºæ…§æ°´åˆ©ç›‘æ§ç³»ç»Ÿï¼Œç›‘æµ‹æ°´ä½ã€æ°´è´¨ï¼Œé¢„è­¦æ´ªæ°´ã€‚

**é—®é¢˜åˆ†æ**:

1. **ç›‘æµ‹å›°éš¾**: ç›‘æµ‹ç«™ç‚¹åˆ†æ•£ï¼Œç›‘æµ‹å›°éš¾
2. **é¢„è­¦æ…¢**: æ´ªæ°´é¢„è­¦æ…¢
3. **æ•°æ®åˆ†æ•£**: æ•°æ®åˆ†æ•£ï¼Œéš¾ä»¥ç»Ÿä¸€åˆ†æ

**è§£å†³æ–¹æ¡ˆ**:

```python
# æ™ºæ…§æ°´åˆ©ç›‘æ§ç³»ç»Ÿ
class SmartWaterMonitoringSystem:
    def __init__(self):
        self.flood_warning = FloodWarning()
        self.water_quality_monitoring = WaterQualityMonitoring()

    async def monitor_water_system(self):
        """ç›‘æ§æ°´åˆ©ç³»ç»Ÿ"""
        # 1. ç›‘æµ‹æ‰€æœ‰ç«™ç‚¹
        stations = await self.get_all_stations()

        # 2. æ£€æŸ¥æ´ªæ°´é£é™©
        flood_warnings = []
        for station in stations:
            risk = await self.flood_warning.check_flood_risk(
                station['id']
            )
            if risk == 'high':
                flood_warnings.append({
                    'station': station,
                    'risk': risk
                })

        # 3. ç›‘æµ‹æ°´è´¨
        quality_alerts = await self.water_quality_monitoring.check_quality()

        return {
            'flood_warnings': flood_warnings,
            'quality_alerts': quality_alerts
        }
```

**ä¼˜åŒ–æ•ˆæœ**:

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| **é¢„è­¦å‡†ç¡®ç‡** | 75% | **92%** | **23%** â¬†ï¸ |
| **å“åº”æ—¶é—´** | 2 å°æ—¶ | **< 15åˆ†é’Ÿ** | **88%** â¬‡ï¸ |
| **æŸ¥è¯¢æ€§èƒ½** | 4 ç§’ | **< 200ms** | **95%** â¬‡ï¸ |
| **æ°´èµ„æºç®¡ç†** | åŸºå‡† | **+35%** | **æå‡** |

## 6. æœ€ä½³å®è·µ

### 6.1 ç›‘æµ‹ç®¡ç†

1. **å®æ—¶ç›‘æµ‹**: å®æ—¶ç›‘æµ‹æ°´ä½å’Œæ°´è´¨
2. **é¢„è­¦ç³»ç»Ÿ**: å®Œå–„çš„é¢„è­¦ç³»ç»Ÿ
3. **æ•°æ®è´¨é‡**: ç¡®ä¿æ•°æ®è´¨é‡

### 6.2 è°ƒåº¦ç®¡ç†

1. **æ™ºèƒ½è°ƒåº¦**: æ™ºèƒ½è°ƒåº¦æ°´èµ„æº
2. **é¢„æµ‹åˆ†æ**: é¢„æµ‹åˆ†ææ°´ä½è¶‹åŠ¿
3. **åº”æ€¥å“åº”**: å¿«é€Ÿåº”æ€¥å“åº”

## 7. å‚è€ƒèµ„æ–™

- [ç¯å¢ƒç›‘æµ‹é¢„è­¦ç³»ç»Ÿ](../ç¯ä¿åœºæ™¯/ç¯å¢ƒç›‘æµ‹é¢„è­¦ç³»ç»Ÿ.md)
- [IoT æ—¶åºæ•°æ®åˆ†æ](../åˆ¶é€ åœºæ™¯/IoTæ—¶åºæ•°æ®åˆ†æ.md)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 08-26-01
