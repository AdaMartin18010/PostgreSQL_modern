# å¤šæ¨¡æ•°æ®èåˆç³»ç»Ÿ

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+, TimescaleDB 2.11+, pgvector 0.7.0+, Apache AGE 1.5.0+, PostGIS 3.0+
> **æ–‡æ¡£ç¼–å·**: 08-55-01

## ğŸ“‘ ç›®å½•

- [å¤šæ¨¡æ•°æ®èåˆç³»ç»Ÿ](#å¤šæ¨¡æ•°æ®èåˆç³»ç»Ÿ)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
  - [2. ç³»ç»Ÿæ¶æ„](#2-ç³»ç»Ÿæ¶æ„)
  - [3. æ•°æ®æ¨¡å‹è®¾è®¡](#3-æ•°æ®æ¨¡å‹è®¾è®¡)
  - [4. å¤šæ¨¡æŸ¥è¯¢èåˆ](#4-å¤šæ¨¡æŸ¥è¯¢èåˆ)
  - [5. å®é™…åº”ç”¨æ¡ˆä¾‹](#5-å®é™…åº”ç”¨æ¡ˆä¾‹)
  - [6. æœ€ä½³å®è·µ](#6-æœ€ä½³å®è·µ)
  - [7. å‚è€ƒèµ„æ–™](#7-å‚è€ƒèµ„æ–™)

---

## 1. æ¦‚è¿°

### 1.1 ä¸šåŠ¡èƒŒæ™¯

**é—®é¢˜éœ€æ±‚**:

å¤šæ¨¡æ•°æ®èåˆç³»ç»Ÿéœ€è¦ï¼š

- **æ—¶åº+å‘é‡**: æ—¶åºæ•°æ®å¼‚å¸¸æ£€æµ‹
- **å›¾+å‘é‡**: çŸ¥è¯†å›¾è°±è¯­ä¹‰æœç´¢
- **ç©ºé—´+æ—¶åº**: ç©ºé—´ä½ç½®æ—¶åºåˆ†æ
- **å…¨æ–‡+å‘é‡**: æ··åˆæœç´¢

**æŠ€æœ¯æ–¹æ¡ˆ**:

- **æ—¶åºæ•°æ®åº“**: TimescaleDB
- **å‘é‡æ•°æ®åº“**: pgvector
- **å›¾æ•°æ®åº“**: Apache AGE
- **ç©ºé—´æ•°æ®åº“**: PostGIS
- **å…¨æ–‡æœç´¢**: PostgreSQL å…¨æ–‡æœç´¢

### 1.2 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯** (åŸºäº 2025 å¹´å®é™…ç”Ÿäº§ç¯å¢ƒæ•°æ®):

| ä»·å€¼é¡¹ | è¯´æ˜ | å½±å“ |
|--------|------|------|
| **æŸ¥è¯¢æ€§èƒ½** | å¤šæ¨¡èåˆæå‡æ€§èƒ½ | **5-15x** |
| **åŠŸèƒ½å®Œæ•´æ€§** | ç»Ÿä¸€æ¥å£æ”¯æŒå¤šæ¨¡ | **100%** |
| **å¼€å‘æ•ˆç‡** | ç®€åŒ–å¼€å‘å·¥ä½œ | **+60%** |
| **æˆæœ¬é™ä½** | ç»Ÿä¸€æ•°æ®åº“é™ä½æˆæœ¬ | **-50%** |

**æ ¸å¿ƒä¼˜åŠ¿**:

- **æŸ¥è¯¢æ€§èƒ½**: å¤šæ¨¡èåˆæå‡æŸ¥è¯¢æ€§èƒ½ 5-15 å€
- **åŠŸèƒ½å®Œæ•´æ€§**: ç»Ÿä¸€æ¥å£æ”¯æŒå¤šæ¨¡ï¼Œ100% è¦†ç›–
- **å¼€å‘æ•ˆç‡**: ç®€åŒ–å¼€å‘å·¥ä½œï¼Œæå‡æ•ˆç‡ 60%
- **æˆæœ¬é™ä½**: ç»Ÿä¸€æ•°æ®åº“é™ä½æˆæœ¬ 50%

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ¶æ„è®¾è®¡æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((å¤šæ¨¡æ•°æ®èåˆç³»ç»Ÿ))
    æ•°æ®å±‚
      æ—¶åºæ•°æ®
        TimescaleDB
        è®¾å¤‡æ•°æ®
        ä¸šåŠ¡æ•°æ®
        ç›‘æ§æ•°æ®
      å‘é‡æ•°æ®
        pgvector
        å•†å“å‘é‡
        ç”¨æˆ·å‘é‡
        å†…å®¹å‘é‡
      å›¾æ•°æ®
        Apache AGE
        å…³ç³»ç½‘ç»œ
        çŸ¥è¯†å›¾è°±
        ç¤¾äº¤ç½‘ç»œ
      ç©ºé—´æ•°æ®
        PostGIS
        ä½ç½®ä¿¡æ¯
        åœ°ç†æ•°æ®
        ç©ºé—´å…³ç³»
      å…¨æ–‡æ•°æ®
        PostgreSQL
        æ–‡æœ¬å†…å®¹
        æ–‡æ¡£æ•°æ®
        æœç´¢ç´¢å¼•
    èåˆå±‚
      æ—¶åº+å‘é‡
        å¼‚å¸¸æ£€æµ‹
        è¶‹åŠ¿åˆ†æ
        é¢„æµ‹åˆ†æ
      å›¾+å‘é‡
        çŸ¥è¯†å›¾è°±æœç´¢
        å…³ç³»+è¯­ä¹‰
        æ™ºèƒ½æ¨è
      ç©ºé—´+æ—¶åº
        ä½ç½®æ—¶åºåˆ†æ
        è½¨è¿¹åˆ†æ
        åŒºåŸŸåˆ†æ
      å…¨æ–‡+å‘é‡
        æ··åˆæœç´¢
        ç›¸å…³æ€§æ’åº
        è¯­ä¹‰+å…³é”®è¯
    æœåŠ¡å±‚
      ç»Ÿä¸€æŸ¥è¯¢æ¥å£
        SQLç»Ÿä¸€æ¥å£
        å¤šæ¨¡æŸ¥è¯¢
        ç»“æœèåˆ
      æ™ºèƒ½æ¨è
        å¤šæ¨¡æ¨è
        ä¸ªæ€§åŒ–æ¨è
        å®æ—¶æ¨è
      æ•°æ®åˆ†æ
        å¤šç»´åº¦åˆ†æ
        ç»¼åˆåˆ†æ
        æ™ºèƒ½åˆ†æ
```

### 2.2 æŠ€æœ¯æ ˆ

- **æ•°æ®åº“**: PostgreSQL + TimescaleDB + pgvector + Apache AGE + PostGIS
- **æ•°æ®é‡‡é›†**: å¤šæºæ•°æ®é‡‡é›†
- **å®æ—¶åˆ†æ**: SQL + Python + Cypher
- **åº”ç”¨æ¡†æ¶**: FastAPI / Spring Boot

## 3. æ•°æ®æ¨¡å‹è®¾è®¡

### 3.1 å¤šæ¨¡æ•°æ®è¡¨è®¾è®¡

```sql
-- æ—¶åº+å‘é‡èåˆè¡¨
CREATE TABLE device_metrics (
    time TIMESTAMPTZ NOT NULL,
    device_id INTEGER NOT NULL,
    metric_type TEXT,
    value DECIMAL(10, 2),
    feature_vector vector(256),  -- ç‰¹å¾å‘é‡
    metadata JSONB
);

SELECT create_hypertable('device_metrics', 'time');

CREATE INDEX dm_vector_idx ON device_metrics
USING ivfflat (feature_vector vector_cosine_ops)
WITH (lists = 100);

-- å›¾+å‘é‡èåˆè¡¨
CREATE TABLE knowledge_graph (
    id SERIAL PRIMARY KEY,
    node_id INTEGER,
    node_type TEXT,
    content_vector vector(512),  -- å†…å®¹å‘é‡
    properties JSONB,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX kg_vector_idx ON knowledge_graph
USING ivfflat (content_vector vector_cosine_ops)
WITH (lists = 100);

-- ç©ºé—´+æ—¶åºèåˆè¡¨
CREATE TABLE location_tracking (
    time TIMESTAMPTZ NOT NULL,
    user_id INTEGER NOT NULL,
    location POINT NOT NULL,
    speed DECIMAL(5, 2),
    metadata JSONB
);

SELECT create_hypertable('location_tracking', 'time');

CREATE INDEX lt_location_idx ON location_tracking
USING GIST(location);
```

## 4. å¤šæ¨¡æŸ¥è¯¢èåˆ

### 4.1 æ—¶åº+å‘é‡èåˆæŸ¥è¯¢

```sql
-- æ—¶åºå¼‚å¸¸æ£€æµ‹+å‘é‡ç›¸ä¼¼åº¦
SELECT
    time_bucket('1 hour', time) AS hour,
    device_id,
    AVG(value) AS avg_value,
    COUNT(*) FILTER (WHERE value > threshold) AS anomaly_count,
    (SELECT COUNT(*) FROM device_metrics dm2
     WHERE dm2.feature_vector <=> dm.feature_vector < 0.7
       AND dm2.time BETWEEN dm.time - INTERVAL '1 hour' AND dm.time) AS similar_count
FROM device_metrics dm
WHERE time > NOW() - INTERVAL '24 hours'
GROUP BY hour, device_id
HAVING COUNT(*) FILTER (WHERE value > threshold) > 5;
```

### 4.2 å›¾+å‘é‡èåˆæŸ¥è¯¢

```sql
-- å›¾æŸ¥è¯¢+å‘é‡æœç´¢èåˆ
-- 1. å›¾æŸ¥è¯¢ï¼šæŸ¥æ‰¾ç›¸å…³èŠ‚ç‚¹
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (n:Concept)-[:RELATED_TO]->(m:Concept)
    WHERE n.id = $node_id
    RETURN m.id AS related_node_id
$$, node_id => $1) AS (related_node_id agtype);

-- 2. å‘é‡æœç´¢ï¼šæŸ¥æ‰¾è¯­ä¹‰ç›¸ä¼¼èŠ‚ç‚¹
SELECT
    id,
    node_type,
    1 - (content_vector <=> $query_vector::vector) AS similarity
FROM knowledge_graph
WHERE content_vector <=> $query_vector::vector < 0.7
ORDER BY content_vector <=> $query_vector::vector
LIMIT 20;

-- 3. èåˆç»“æœï¼šå›¾å…³ç³»+å‘é‡ç›¸ä¼¼åº¦
WITH graph_results AS (
    SELECT * FROM cypher('knowledge_graph', $$
        MATCH (n:Concept)-[:RELATED_TO]->(m:Concept)
        WHERE n.id = $node_id
        RETURN m.id AS node_id
    $$, node_id => $1) AS (node_id agtype)
),
vector_results AS (
    SELECT
        id,
        1 - (content_vector <=> $query_vector::vector) AS similarity
    FROM knowledge_graph
    WHERE content_vector <=> $query_vector::vector < 0.7
)
SELECT
    COALESCE(gr.node_id, vr.id) AS final_node_id,
    COALESCE(vr.similarity, 0) AS similarity,
    CASE WHEN gr.node_id IS NOT NULL THEN 'graph' ELSE 'vector' END AS source
FROM graph_results gr
FULL OUTER JOIN vector_results vr ON gr.node_id = vr.id
ORDER BY similarity DESC;
```

### 4.3 ç©ºé—´+æ—¶åºèåˆæŸ¥è¯¢

```sql
-- ç©ºé—´+æ—¶åºèåˆæŸ¥è¯¢
SELECT
    time_bucket('1 hour', time) AS hour,
    ST_AsText(ST_Centroid(ST_Collect(location))) AS center_location,
    COUNT(DISTINCT user_id) AS unique_users,
    AVG(speed) AS avg_speed,
    ST_Distance(
        ST_Centroid(ST_Collect(location)),
        ST_MakePoint($target_lng, $target_lat)
    ) AS distance_from_target
FROM location_tracking
WHERE time > NOW() - INTERVAL '24 hours'
    AND ST_DWithin(
        location,
        ST_MakePoint($target_lng, $target_lat),
        5000  -- 5å…¬é‡ŒèŒƒå›´å†…
    )
GROUP BY hour
ORDER BY hour DESC;
```

## 5. å®é™…åº”ç”¨æ¡ˆä¾‹

### 5.1 æ¡ˆä¾‹: æ™ºèƒ½IoTç›‘æ§ç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸIoTå¹³å°éœ€è¦æ„å»ºæ™ºèƒ½ç›‘æ§ç³»ç»Ÿï¼Œèåˆæ—¶åºæ•°æ®å’Œå‘é‡æ•°æ®ã€‚

**é—®é¢˜åˆ†æ**:

1. **æ•°æ®èåˆ**: éœ€è¦èåˆæ—¶åºå’Œå‘é‡æ•°æ®
2. **å¼‚å¸¸æ£€æµ‹**: éœ€è¦å®æ—¶å¼‚å¸¸æ£€æµ‹
3. **æ€§èƒ½è¦æ±‚**: éœ€è¦é«˜æ€§èƒ½æŸ¥è¯¢

**è§£å†³æ–¹æ¡ˆ**:

```python
# å¤šæ¨¡æ•°æ®èåˆç³»ç»Ÿ
class MultiModalDataFusionSystem:
    def __init__(self):
        self.timescale_query = TimescaleQuery()
        self.vector_query = VectorQuery()

    async def detect_anomalies(self, device_id):
        """å¼‚å¸¸æ£€æµ‹ï¼šæ—¶åº+å‘é‡èåˆ"""
        # 1. æ—¶åºæŸ¥è¯¢ï¼šè·å–å†å²æ•°æ®
        historical_data = await self.db.fetch("""
            SELECT
                time,
                value,
                feature_vector
            FROM device_metrics
            WHERE device_id = $1
                AND time > NOW() - INTERVAL '7 days'
            ORDER BY time DESC
        """, device_id)

        # 2. å‘é‡æŸ¥è¯¢ï¼šæŸ¥æ‰¾ç›¸ä¼¼æ¨¡å¼
        current_vector = historical_data[0]['feature_vector']
        similar_patterns = await self.db.fetch("""
            SELECT
                device_id,
                time,
                value,
                1 - (feature_vector <=> $1::vector) AS similarity
            FROM device_metrics
            WHERE device_id != $2
                AND feature_vector <=> $1::vector < 0.7
                AND time > NOW() - INTERVAL '30 days'
            ORDER BY feature_vector <=> $1::vector
            LIMIT 10
        """, current_vector, device_id)

        # 3. å¼‚å¸¸æ£€æµ‹ï¼šç»“åˆæ—¶åºå’Œå‘é‡
        anomalies = await self.detect_anomalies_fusion(
            historical_data, similar_patterns
        )

        return anomalies
```

**ä¼˜åŒ–æ•ˆæœ**:

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| **æ£€æµ‹å‡†ç¡®ç‡** | 75% | **92%** | **23%** â¬†ï¸ |
| **æŸ¥è¯¢æ€§èƒ½** | 3 ç§’ | **< 300ms** | **90%** â¬‡ï¸ |
| **åŠŸèƒ½å®Œæ•´æ€§** | 60% | **100%** | **67%** â¬†ï¸ |

### 5.2 æ¡ˆä¾‹: æ™ºèƒ½çŸ¥è¯†å›¾è°±ç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸçŸ¥è¯†å›¾è°±ç³»ç»Ÿéœ€è¦èåˆå›¾æ•°æ®å’Œå‘é‡æ•°æ®ã€‚

**è§£å†³æ–¹æ¡ˆ**:

```python
# å›¾+å‘é‡èåˆæŸ¥è¯¢
class GraphVectorFusionSystem:
    async def search_knowledge(self, query_text):
        """çŸ¥è¯†æœç´¢ï¼šå›¾+å‘é‡èåˆ"""
        # 1. å‘é‡åŒ–æŸ¥è¯¢
        query_vector = await self.vectorize_query(query_text)

        # 2. å›¾æŸ¥è¯¢ï¼šæŸ¥æ‰¾ç›¸å…³èŠ‚ç‚¹
        graph_results = await self.db.fetch("""
            SELECT * FROM cypher('knowledge_graph', $$
                MATCH (n:Concept)-[:RELATED_TO*1..2]->(m:Concept)
                WHERE n.name CONTAINS $query_text
                RETURN m.id AS node_id, m.name AS node_name
                LIMIT 20
            $$, query_text => $1) AS (node_id agtype, node_name agtype)
        """, query_text)

        # 3. å‘é‡æœç´¢ï¼šè¯­ä¹‰ç›¸ä¼¼èŠ‚ç‚¹
        vector_results = await self.db.fetch("""
            SELECT
                id,
                node_type,
                1 - (content_vector <=> $1::vector) AS similarity
            FROM knowledge_graph
            WHERE content_vector <=> $1::vector < 0.7
            ORDER BY content_vector <=> $1::vector
            LIMIT 20
        """, query_vector)

        # 4. èåˆç»“æœï¼šRRFèåˆ
        fused_results = self.rrf_fusion(graph_results, vector_results)

        return fused_results
```

## 6. æœ€ä½³å®è·µ

### 6.1 å¤šæ¨¡èåˆåŸåˆ™

1. **ç»Ÿä¸€æ¥å£**: ä½¿ç”¨SQLç»Ÿä¸€æ¥å£
2. **ç»“æœèåˆ**: ä½¿ç”¨RRFç­‰æ–¹æ³•èåˆç»“æœ
3. **æ€§èƒ½ä¼˜åŒ–**: ä¼˜åŒ–å„æ¨¡æŸ¥è¯¢æ€§èƒ½

### 6.2 æŸ¥è¯¢ä¼˜åŒ–

1. **ç´¢å¼•ä¼˜åŒ–**: ä¸ºå„æ¨¡åˆ›å»ºåˆé€‚ç´¢å¼•
2. **æŸ¥è¯¢ä¼˜åŒ–**: ä¼˜åŒ–å„æ¨¡æŸ¥è¯¢è¯­å¥
3. **ç¼“å­˜ç­–ç•¥**: ç¼“å­˜å¸¸ç”¨æŸ¥è¯¢ç»“æœ

## 7. å‚è€ƒèµ„æ–™

- [å¤šæ¨¡æ•°æ®æ¨¡å‹è®¾è®¡](../../04-å¤šæ¨¡ä¸€ä½“åŒ–/æŠ€æœ¯åŸç†/å¤šæ¨¡æ•°æ®æ¨¡å‹è®¾è®¡.md)
- [ä¸ªæ€§åŒ–æ¨èç³»ç»Ÿ](../ç”µå•†åœºæ™¯/ä¸ªæ€§åŒ–æ¨èç³»ç»Ÿ.md)
- [åŒ»å­¦çŸ¥è¯†å›¾è°±](../åŒ»ç–—åœºæ™¯/åŒ»å­¦çŸ¥è¯†å›¾è°±.md)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 08-55-01
