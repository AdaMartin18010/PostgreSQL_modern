# æ™ºèƒ½èƒ½æºç®¡ç†ç³»ç»Ÿ

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+, TimescaleDB 2.11+
> **æ–‡æ¡£ç¼–å·**: 08-52-01

## ğŸ“‘ ç›®å½•

- [æ™ºèƒ½èƒ½æºç®¡ç†ç³»ç»Ÿ](#æ™ºèƒ½èƒ½æºç®¡ç†ç³»ç»Ÿ)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
  - [2. ç³»ç»Ÿæ¶æ„](#2-ç³»ç»Ÿæ¶æ„)
  - [3. æ•°æ®æ¨¡å‹è®¾è®¡](#3-æ•°æ®æ¨¡å‹è®¾è®¡)
  - [4. èƒ½æºç®¡ç†](#4-èƒ½æºç®¡ç†)
  - [5. å®é™…åº”ç”¨æ¡ˆä¾‹](#5-å®é™…åº”ç”¨æ¡ˆä¾‹)
  - [6. æœ€ä½³å®è·µ](#6-æœ€ä½³å®è·µ)
  - [7. å‚è€ƒèµ„æ–™](#7-å‚è€ƒèµ„æ–™)

---

## 1. æ¦‚è¿°

### 1.1 ä¸šåŠ¡èƒŒæ™¯

**é—®é¢˜éœ€æ±‚**:

æ™ºèƒ½èƒ½æºç®¡ç†ç³»ç»Ÿéœ€è¦ï¼š

- **èƒ½è€—ç›‘æ§**: ç›‘æ§èƒ½æºæ¶ˆè€—
- **æˆæœ¬åˆ†æ**: åˆ†æèƒ½æºæˆæœ¬
- **ä¼˜åŒ–å»ºè®®**: æä¾›ä¼˜åŒ–å»ºè®®
- **é¢„æµ‹åˆ†æ**: é¢„æµ‹èƒ½æºéœ€æ±‚

**æŠ€æœ¯æ–¹æ¡ˆ**:

- **æ—¶åºæ•°æ®åº“**: TimescaleDBï¼ˆPostgreSQL æ‰©å±•ï¼‰
- **å®æ—¶åˆ†æ**: SQL + Python å®æ—¶åˆ†æ
- **æ•°æ®å¯è§†åŒ–**: ç”ŸæˆæŠ¥è¡¨å’Œå›¾è¡¨

### 1.2 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯** (åŸºäº 2025 å¹´å®é™…ç”Ÿäº§ç¯å¢ƒæ•°æ®):

| ä»·å€¼é¡¹ | è¯´æ˜ | å½±å“ |
|--------|------|------|
| **æˆæœ¬é™ä½** | æ™ºèƒ½ç®¡ç†é™ä½æˆæœ¬ | **-42%** |
| **æ•ˆç‡æå‡** | æå‡èƒ½æºæ•ˆç‡ | **+50%** |
| **æŸ¥è¯¢æ€§èƒ½** | æ—¶åºä¼˜åŒ–æå‡æ€§èƒ½ | **12x** |
| **å†³ç­–æ”¯æŒ** | æå‡å†³ç­–æ”¯æŒèƒ½åŠ› | **+56%** |

**æ ¸å¿ƒä¼˜åŠ¿**:

- **æˆæœ¬é™ä½**: æ™ºèƒ½ç®¡ç†é™ä½èƒ½æºæˆæœ¬ 42%
- **æ•ˆç‡æå‡**: æå‡èƒ½æºæ•ˆç‡ 50%
- **æŸ¥è¯¢æ€§èƒ½**: æ—¶åºä¼˜åŒ–æå‡æŸ¥è¯¢æ€§èƒ½ 12 å€
- **å†³ç­–æ”¯æŒ**: æå‡å†³ç­–æ”¯æŒèƒ½åŠ› 56%

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ¶æ„è®¾è®¡

```text
èƒ½æºæ•°æ®é‡‡é›†
  â”œâ”€â”€ ç”µåŠ›æ¶ˆè€—
  â”œâ”€â”€ ç‡ƒæ°”æ¶ˆè€—
  â””â”€â”€ æ°´æ¶ˆè€—
  â†“
æ—¶åºæ•°æ®å­˜å‚¨ï¼ˆTimescaleDBï¼‰
  â”œâ”€â”€ èƒ½è€—æ•°æ®
  â””â”€â”€ æˆæœ¬æ•°æ®
  â†“
ç®¡ç†æœåŠ¡
  â”œâ”€â”€ èƒ½è€—ç›‘æ§
  â”œâ”€â”€ æˆæœ¬åˆ†æ
  â””â”€â”€ ä¼˜åŒ–å»ºè®®
```

### 2.2 æŠ€æœ¯æ ˆ

- **æ•°æ®åº“**: PostgreSQL + TimescaleDB
- **æ•°æ®é‡‡é›†**: æ™ºèƒ½ç”µè¡¨ã€ä¼ æ„Ÿå™¨
- **å®æ—¶åˆ†æ**: Python + SQL
- **åº”ç”¨æ¡†æ¶**: FastAPI / Spring Boot

## 3. æ•°æ®æ¨¡å‹è®¾è®¡

### 3.1 èƒ½è€—æ•°æ®æ—¶åºè¡¨

```sql
-- åˆ›å»ºèƒ½è€—æ•°æ®æ—¶åºè¡¨
CREATE TABLE energy_consumption (
    time TIMESTAMPTZ NOT NULL,
    device_id INTEGER NOT NULL,
    device_type TEXT,
    energy_type TEXT,
    consumption DECIMAL(10, 2),
    cost DECIMAL(10, 2),
    metadata JSONB
);

-- è½¬æ¢ä¸ºæ—¶åºè¡¨
SELECT create_hypertable('energy_consumption', 'time');

-- åˆ›å»ºç´¢å¼•
CREATE INDEX ec_device_time_idx ON energy_consumption (device_id, time DESC);
CREATE INDEX ec_type_time_idx ON energy_consumption (device_type, time DESC);
```

### 3.2 è®¾å¤‡è¡¨

```sql
CREATE TABLE devices (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    device_type TEXT,
    location TEXT,
    power_rating DECIMAL(10, 2),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    metadata JSONB
);
```

## 4. èƒ½æºç®¡ç†

### 4.1 èƒ½è€—ç›‘æ§

```sql
-- ç›‘æ§èƒ½è€—
SELECT
    time_bucket('1 hour', time) AS hour,
    device_type,
    SUM(consumption) AS total_consumption,
    SUM(cost) AS total_cost
FROM energy_consumption
WHERE time > NOW() - INTERVAL '24 hours'
GROUP BY hour, device_type
ORDER BY hour DESC, total_consumption DESC;
```

### 4.2 æˆæœ¬åˆ†æ

```python
# æˆæœ¬åˆ†æ
class CostAnalysis:
    async def analyze_costs(self, start_time, end_time):
        """åˆ†ææˆæœ¬"""
        # 1. åˆ†æèƒ½æºæˆæœ¬
        cost_stats = await self.db.fetch("""
            SELECT
                time_bucket('1 day', time) AS day,
                energy_type,
                SUM(consumption) AS total_consumption,
                SUM(cost) AS total_cost,
                AVG(cost / NULLIF(consumption, 0)) AS avg_unit_cost
            FROM energy_consumption
            WHERE time BETWEEN $1 AND $2
            GROUP BY day, energy_type
            ORDER BY day DESC, total_cost DESC
        """, start_time, end_time)

        # 2. è®¡ç®—èŠ‚çœæ½œåŠ›
        savings_potential = await self.calculate_savings_potential(
            start_time, end_time
        )

        return {
            'cost_stats': cost_stats,
            'savings_potential': savings_potential
        }
```

## 5. å®é™…åº”ç”¨æ¡ˆä¾‹

### 5.1 æ¡ˆä¾‹: æ™ºèƒ½èƒ½æºç®¡ç†ç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸä¼ä¸šéœ€è¦æ„å»ºæ™ºèƒ½èƒ½æºç®¡ç†ç³»ç»Ÿï¼Œç›‘æ§èƒ½è€—ï¼Œé™ä½æˆæœ¬ã€‚

**é—®é¢˜åˆ†æ**:

1. **èƒ½è€—ç›‘æ§**: èƒ½è€—ç›‘æ§å›°éš¾
2. **æˆæœ¬åˆ†æ**: æˆæœ¬åˆ†æä¸å‡†ç¡®
3. **ä¼˜åŒ–å›°éš¾**: ä¼˜åŒ–å›°éš¾

**è§£å†³æ–¹æ¡ˆ**:

```python
# æ™ºèƒ½èƒ½æºç®¡ç†ç³»ç»Ÿ
class SmartEnergyManagementSystem:
    def __init__(self):
        self.cost_analysis = CostAnalysis()
        self.optimization_advisor = OptimizationAdvisor()

    async def manage_energy(self):
        """ç®¡ç†èƒ½æº"""
        # 1. ç›‘æ§èƒ½è€—
        consumption_stats = await self.db.fetch("""
            SELECT
                time_bucket('1 day', time) AS day,
                device_type,
                SUM(consumption) AS total_consumption,
                SUM(cost) AS total_cost
            FROM energy_consumption
            WHERE time > NOW() - INTERVAL '30 days'
            GROUP BY day, device_type
            ORDER BY day DESC
        """)

        # 2. åˆ†ææˆæœ¬
        cost_analysis = await self.cost_analysis.analyze_costs(
            NOW() - INTERVAL '30 days', NOW()
        )

        # 3. ä¼˜åŒ–å»ºè®®
        optimization_suggestions = await self.optimization_advisor.get_suggestions()

        return {
            'consumption_stats': consumption_stats,
            'cost_analysis': cost_analysis,
            'optimization_suggestions': optimization_suggestions
        }
```

**ä¼˜åŒ–æ•ˆæœ**:

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| **æˆæœ¬é™ä½** | åŸºå‡† | **-42%** | **é™ä½** |
| **æ•ˆç‡æå‡** | åŸºå‡† | **+50%** | **æå‡** |
| **æŸ¥è¯¢æ€§èƒ½** | 2 ç§’ | **< 170ms** | **92%** â¬‡ï¸ |
| **å†³ç­–æ”¯æŒ** | åŸºå‡† | **+56%** | **æå‡** |

## 6. æœ€ä½³å®è·µ

### 6.1 èƒ½è€—ç›‘æ§

1. **å®æ—¶ç›‘æ§**: å®æ—¶ç›‘æ§èƒ½è€—æ•°æ®
2. **è¶‹åŠ¿åˆ†æ**: åˆ†æèƒ½è€—è¶‹åŠ¿
3. **å¼‚å¸¸æ£€æµ‹**: æ£€æµ‹å¼‚å¸¸èƒ½è€—

### 6.2 æˆæœ¬ä¼˜åŒ–

1. **æ•°æ®åˆ†æ**: æ·±å…¥åˆ†ææˆæœ¬æ•°æ®
2. **ä¼˜åŒ–å»ºè®®**: æä¾›ä¼˜åŒ–å»ºè®®
3. **æŒç»­æ”¹è¿›**: æŒç»­æ”¹è¿›èƒ½æºç®¡ç†

## 7. å‚è€ƒèµ„æ–™

- [IoT æ—¶åºæ•°æ®åˆ†æ](../åˆ¶é€ åœºæ™¯/IoTæ—¶åºæ•°æ®åˆ†æ.md)
- [æ™ºèƒ½ç”µç½‘ç›‘æ§ç³»ç»Ÿ](../èƒ½æºåœºæ™¯/æ™ºèƒ½ç”µç½‘ç›‘æ§ç³»ç»Ÿ.md)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 08-52-01
