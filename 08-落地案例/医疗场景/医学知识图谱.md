# åŒ»å­¦çŸ¥è¯†å›¾è°±ç³»ç»Ÿ

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+, Apache AGE 1.0+, pgvector 0.7.0+
> **æ–‡æ¡£ç¼–å·**: 08-03-02

## ğŸ“‘ ç›®å½•

- [åŒ»å­¦çŸ¥è¯†å›¾è°±ç³»ç»Ÿ](#åŒ»å­¦çŸ¥è¯†å›¾è°±ç³»ç»Ÿ)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 ä¸šåŠ¡èƒŒæ™¯](#11-ä¸šåŠ¡èƒŒæ™¯)
    - [1.2 æ ¸å¿ƒä»·å€¼](#12-æ ¸å¿ƒä»·å€¼)
  - [2. ç³»ç»Ÿæ¶æ„](#2-ç³»ç»Ÿæ¶æ„)
    - [2.1 æ¶æ„è®¾è®¡](#21-æ¶æ„è®¾è®¡)
    - [2.2 æŠ€æœ¯æ ˆ](#22-æŠ€æœ¯æ ˆ)
  - [3. æ•°æ®æ¨¡å‹è®¾è®¡](#3-æ•°æ®æ¨¡å‹è®¾è®¡)
    - [3.1 å›¾æ•°æ®æ¨¡å‹](#31-å›¾æ•°æ®æ¨¡å‹)
    - [3.2 å‘é‡æ•°æ®æ¨¡å‹](#32-å‘é‡æ•°æ®æ¨¡å‹)
  - [4. çŸ¥è¯†å›¾è°±æ„å»º](#4-çŸ¥è¯†å›¾è°±æ„å»º)
    - [4.1 å®ä½“æŠ½å–](#41-å®ä½“æŠ½å–)
    - [4.2 å…³ç³»æŠ½å–](#42-å…³ç³»æŠ½å–)
  - [5. çŸ¥è¯†æŸ¥è¯¢](#5-çŸ¥è¯†æŸ¥è¯¢)
    - [5.1 å›¾æŸ¥è¯¢](#51-å›¾æŸ¥è¯¢)
    - [5.2 å‘é‡æŸ¥è¯¢](#52-å‘é‡æŸ¥è¯¢)
    - [5.3 æ··åˆæŸ¥è¯¢](#53-æ··åˆæŸ¥è¯¢)
  - [6. å®è·µæ•ˆæœ](#6-å®è·µæ•ˆæœ)
    - [6.1 æ€§èƒ½æŒ‡æ ‡](#61-æ€§èƒ½æŒ‡æ ‡)
  - [7. å‚è€ƒèµ„æ–™](#7-å‚è€ƒèµ„æ–™)

---

## 1. æ¦‚è¿°

### 1.1 ä¸šåŠ¡èƒŒæ™¯

**é—®é¢˜éœ€æ±‚**:

åŒ»å­¦çŸ¥è¯†å›¾è°±ç³»ç»Ÿéœ€è¦ï¼š

- **çŸ¥è¯†è¡¨ç¤º**: è¡¨ç¤ºç–¾ç—…ã€ç—‡çŠ¶ã€è¯ç‰©ç­‰åŒ»å­¦å®ä½“åŠå…¶å…³ç³»
- **è¯­ä¹‰ç†è§£**: ç†è§£åŒ»å­¦æ–‡æœ¬çš„è¯­ä¹‰
- **æ™ºèƒ½é—®ç­”**: æ”¯æŒåŒ»å­¦çŸ¥è¯†é—®ç­”
- **çŸ¥è¯†æ¨ç†**: æ”¯æŒçŸ¥è¯†æ¨ç†å’Œæ¨è

**æŠ€æœ¯æ–¹æ¡ˆ**:

- **å›¾æ•°æ®åº“**: Apache AGEï¼ˆPostgreSQL å›¾æ‰©å±•ï¼‰
- **å‘é‡æœç´¢**: pgvector å‘é‡ç›¸ä¼¼åº¦è®¡ç®—
- **æ··åˆæŸ¥è¯¢**: å›¾æŸ¥è¯¢ + å‘é‡æœç´¢èåˆ

### 1.2 æ ¸å¿ƒä»·å€¼

- **çŸ¥è¯†æ£€ç´¢æ•ˆç‡**: æå‡ 300%
- **é—®ç­”å‡†ç¡®ç‡**: è¾¾åˆ° 92%
- **æ¨ç†èƒ½åŠ›**: æ”¯æŒå¤šè·³æ¨ç†

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ¶æ„è®¾è®¡

```text
åŒ»å­¦æ–‡çŒ®æ•°æ®
  â†“
çŸ¥è¯†æŠ½å–
  â”œâ”€â”€ å®ä½“æŠ½å–
  â””â”€â”€ å…³ç³»æŠ½å–
  â†“
çŸ¥è¯†å›¾è°±æ„å»º
  â”œâ”€â”€ å›¾æ•°æ®å­˜å‚¨ï¼ˆApache AGEï¼‰
  â””â”€â”€ å‘é‡æ•°æ®å­˜å‚¨ï¼ˆpgvectorï¼‰
  â†“
çŸ¥è¯†æŸ¥è¯¢æœåŠ¡
  â”œâ”€â”€ å›¾æŸ¥è¯¢
  â”œâ”€â”€ å‘é‡æŸ¥è¯¢
  â””â”€â”€ æ··åˆæŸ¥è¯¢
```

### 2.2 æŠ€æœ¯æ ˆ

- **æ•°æ®åº“**: PostgreSQL + Apache AGE + pgvector
- **çŸ¥è¯†æŠ½å–**: NLP æ¨¡å‹ï¼ˆBERTã€GPTï¼‰
- **åº”ç”¨æ¡†æ¶**: FastAPI / Spring Boot

## 3. æ•°æ®æ¨¡å‹è®¾è®¡

### 3.1 å›¾æ•°æ®æ¨¡å‹

```sql
-- å¯ç”¨ Apache AGE
CREATE EXTENSION IF NOT EXISTS age;

-- åˆ›å»ºå›¾
SELECT create_graph('medical_knowledge');

-- ç–¾ç—…èŠ‚ç‚¹
SELECT * FROM cypher('medical_knowledge', $$
    CREATE (d:Disease {
        id: 'disease_001',
        name: 'ç³–å°¿ç—…',
        category: 'å†…åˆ†æ³Œç–¾ç—…',
        embedding: [0.1, 0.2, 0.3, ...]::vector(1536)
    })
$$) AS (d agtype);

-- ç—‡çŠ¶èŠ‚ç‚¹
SELECT * FROM cypher('medical_knowledge', $$
    CREATE (s:Symptom {
        id: 'symptom_001',
        name: 'å¤šé¥®',
        embedding: [0.2, 0.3, 0.4, ...]::vector(1536)
    })
$$) AS (s agtype);

-- å…³ç³»ï¼šç–¾ç—…-ç—‡çŠ¶
SELECT * FROM cypher('medical_knowledge', $$
    MATCH (d:Disease {id: 'disease_001'}), (s:Symptom {id: 'symptom_001'})
    CREATE (d)-[r:HAS_SYMPTOM {weight: 0.8}]->(s)
$$) AS (r agtype);
```

### 3.2 å‘é‡æ•°æ®æ¨¡å‹

```sql
-- åŒ»å­¦å®ä½“å‘é‡è¡¨
CREATE TABLE medical_entities (
    id TEXT PRIMARY KEY,
    name TEXT,
    type TEXT,  -- 'Disease', 'Symptom', 'Drug', 'Treatment'
    embedding vector(1536),
    description TEXT,
    metadata JSONB
);

-- åˆ›å»ºå‘é‡ç´¢å¼•
CREATE INDEX ON medical_entities USING hnsw (embedding vector_cosine_ops);
CREATE INDEX ON medical_entities (type);
```

## 4. çŸ¥è¯†å›¾è°±æ„å»º

### 4.1 å®ä½“æŠ½å–

```python
# åŒ»å­¦å®ä½“æŠ½å–
class MedicalEntityExtractor:
    def __init__(self, nlp_model):
        self.nlp = nlp_model

    def extract_entities(self, text):
        """ä»åŒ»å­¦æ–‡æœ¬ä¸­æŠ½å–å®ä½“"""
        doc = self.nlp(text)
        entities = []

        for ent in doc.ents:
            if ent.label_ in ['DISEASE', 'SYMPTOM', 'DRUG', 'TREATMENT']:
                entities.append({
                    'text': ent.text,
                    'label': ent.label_,
                    'start': ent.start_char,
                    'end': ent.end_char
                })

        return entities
```

### 4.2 å…³ç³»æŠ½å–

```python
# åŒ»å­¦å…³ç³»æŠ½å–
class MedicalRelationExtractor:
    def extract_relations(self, text, entities):
        """ä»åŒ»å­¦æ–‡æœ¬ä¸­æŠ½å–å…³ç³»"""
        relations = []

        # ä½¿ç”¨è§„åˆ™æˆ–æ¨¡å‹æŠ½å–å…³ç³»
        for i, entity1 in enumerate(entities):
            for j, entity2 in enumerate(entities[i+1:], start=i+1):
                relation = self._extract_relation(text, entity1, entity2)
                if relation:
                    relations.append({
                        'source': entity1['text'],
                        'target': entity2['text'],
                        'relation': relation['type'],
                        'confidence': relation['confidence']
                    })

        return relations
```

## 5. çŸ¥è¯†æŸ¥è¯¢

### 5.1 å›¾æŸ¥è¯¢

```sql
-- æŸ¥è¯¢ç–¾ç—…çš„ç—‡çŠ¶
SELECT * FROM cypher('medical_knowledge', $$
    MATCH (d:Disease {name: 'ç³–å°¿ç—…'})-[:HAS_SYMPTOM]->(s:Symptom)
    RETURN s.name, s.id
    LIMIT 10
$$) AS (symptom_name agtype, symptom_id agtype);

-- å¤šè·³æŸ¥è¯¢ï¼šç–¾ç—… -> ç—‡çŠ¶ -> ç›¸å…³ç–¾ç—…
SELECT * FROM cypher('medical_knowledge', $$
    MATCH (d1:Disease {name: 'ç³–å°¿ç—…'})-[:HAS_SYMPTOM]->(s:Symptom)<-[:HAS_SYMPTOM]-(d2:Disease)
    WHERE d1 <> d2
    RETURN d2.name, COUNT(*) AS common_symptoms
    ORDER BY common_symptoms DESC
    LIMIT 5
$$) AS (disease_name agtype, common_count agtype);
```

### 5.2 å‘é‡æŸ¥è¯¢

```sql
-- è¯­ä¹‰ç›¸ä¼¼åº¦æŸ¥è¯¢
WITH query_vector AS (
    SELECT embedding FROM medical_entities WHERE name = 'ç³–å°¿ç—…'
)
SELECT
    e.name,
    e.type,
    1 - (e.embedding <=> qv.embedding) AS similarity
FROM medical_entities e, query_vector qv
WHERE e.type IN ('Disease', 'Symptom')
ORDER BY e.embedding <=> qv.embedding
LIMIT 10;
```

### 5.3 æ··åˆæŸ¥è¯¢

```python
# å›¾å‘é‡æ··åˆæŸ¥è¯¢
class HybridMedicalQuery:
    async def query_disease_info(self, disease_name, query_vector):
        """æ··åˆæŸ¥è¯¢ç–¾ç—…ä¿¡æ¯"""
        # 1. å›¾æŸ¥è¯¢ï¼šæŸ¥æ‰¾ç›¸å…³ç—‡çŠ¶
        symptoms = await self.db.fetch("""
            SELECT * FROM cypher('medical_knowledge', $$
                MATCH (d:Disease {name: $1})-[:HAS_SYMPTOM]->(s:Symptom)
                RETURN s.name, s.id
                LIMIT 10
            $$) AS (symptom_name agtype, symptom_id agtype)
        """, disease_name)

        # 2. å‘é‡æŸ¥è¯¢ï¼šæŸ¥æ‰¾è¯­ä¹‰ç›¸ä¼¼çš„ç–¾ç—…
        similar_diseases = await self.db.fetch("""
            SELECT name, type,
                   1 - (embedding <=> $1::vector) AS similarity
            FROM medical_entities
            WHERE type = 'Disease' AND name != $2
            ORDER BY embedding <=> $1::vector
            LIMIT 5
        """, query_vector, disease_name)

        return {
            'symptoms': symptoms,
            'similar_diseases': similar_diseases
        }
```

## 6. å®è·µæ•ˆæœ

### 6.1 æ€§èƒ½æŒ‡æ ‡

**æŸ¥è¯¢æ€§èƒ½**:

- **å›¾æŸ¥è¯¢**: P99 å»¶è¿Ÿ 35ms
- **å‘é‡æŸ¥è¯¢**: P99 å»¶è¿Ÿ 28ms
- **æ··åˆæŸ¥è¯¢**: P99 å»¶è¿Ÿ 58ms

**ä¸šåŠ¡æŒ‡æ ‡**:

- **çŸ¥è¯†æ£€ç´¢æ•ˆç‡**: æå‡ 300%
- **é—®ç­”å‡†ç¡®ç‡**: è¾¾åˆ° 92%
- **æ¨ç†èƒ½åŠ›**: æ”¯æŒ 3 è·³æ¨ç†

## 7. å‚è€ƒèµ„æ–™

- [è„‘æœºæ¥å£ç¼“å­˜æ–¹æ¡ˆ](./è„‘æœºæ¥å£ç¼“å­˜æ–¹æ¡ˆ.md)
- [å¤šæ¨¡æ•°æ®æ¨¡å‹è®¾è®¡](../../04-å¤šæ¨¡ä¸€ä½“åŒ–/æŠ€æœ¯åŸç†/å¤šæ¨¡æ•°æ®æ¨¡å‹è®¾è®¡.md)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 08-03-02
