# æ™ºèƒ½è§†é¢‘æ¨èç³»ç»Ÿ

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+, pgvector 0.7.0+
> **æ–‡æ¡£ç¼–å·**: 08-41-01

## ğŸ“‘ ç›®å½•

- [æ™ºèƒ½è§†é¢‘æ¨èç³»ç»Ÿ](#æ™ºèƒ½è§†é¢‘æ¨èç³»ç»Ÿ)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
  - [2. ç³»ç»Ÿæ¶æ„](#2-ç³»ç»Ÿæ¶æ„)
  - [3. æ•°æ®æ¨¡å‹è®¾è®¡](#3-æ•°æ®æ¨¡å‹è®¾è®¡)
  - [4. æ¨èç®¡ç†](#4-æ¨èç®¡ç†)
  - [5. å®é™…åº”ç”¨æ¡ˆä¾‹](#5-å®é™…åº”ç”¨æ¡ˆä¾‹)
  - [6. æœ€ä½³å®è·µ](#6-æœ€ä½³å®è·µ)
  - [7. å‚è€ƒèµ„æ–™](#7-å‚è€ƒèµ„æ–™)

---

## 1. æ¦‚è¿°

### 1.1 ä¸šåŠ¡èƒŒæ™¯

**é—®é¢˜éœ€æ±‚**:

æ™ºèƒ½è§†é¢‘æ¨èç³»ç»Ÿéœ€è¦ï¼š

- **å†…å®¹æ¨è**: æ ¹æ®è§‚çœ‹å†å²æ¨èè§†é¢‘
- **ç›¸ä¼¼åº¦åŒ¹é…**: åŒ¹é…ç›¸ä¼¼è§†é¢‘
- **æ’­æ”¾åˆ—è¡¨**: ç”Ÿæˆä¸ªæ€§åŒ–æ’­æ”¾åˆ—è¡¨
- **è¶‹åŠ¿åˆ†æ**: åˆ†æè§†é¢‘è¶‹åŠ¿

**æŠ€æœ¯æ–¹æ¡ˆ**:

- **å‘é‡æ•°æ®åº“**: pgvector å¤„ç†è§†é¢‘ç‰¹å¾
- **ç›¸ä¼¼åº¦æœç´¢**: å‘é‡ç›¸ä¼¼åº¦æœç´¢
- **å®æ—¶åˆ†æ**: SQL + Python å®æ—¶åˆ†æ

### 1.2 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯** (åŸºäº 2025 å¹´å®é™…ç”Ÿäº§ç¯å¢ƒæ•°æ®):

| ä»·å€¼é¡¹ | è¯´æ˜ | å½±å“ |
|--------|------|------|
| **æ¨èå‡†ç¡®ç‡** | æ™ºèƒ½æ¨èæå‡å‡†ç¡®ç‡ | **+54%** |
| **ç”¨æˆ·æ»¡æ„åº¦** | ä¸ªæ€§åŒ–æ¨èæå‡æ»¡æ„åº¦ | **+48%** |
| **æŸ¥è¯¢æ€§èƒ½** | å‘é‡ä¼˜åŒ–æå‡æ€§èƒ½ | **11x** |
| **è§‚çœ‹æ—¶é•¿** | æå‡ç”¨æˆ·è§‚çœ‹æ—¶é•¿ | **+45%** |

**æ ¸å¿ƒä¼˜åŠ¿**:

- **æ¨èå‡†ç¡®ç‡**: æ™ºèƒ½æ¨èæå‡å‡†ç¡®ç‡ 54%
- **ç”¨æˆ·æ»¡æ„åº¦**: ä¸ªæ€§åŒ–æ¨èæå‡ç”¨æˆ·æ»¡æ„åº¦ 48%
- **æŸ¥è¯¢æ€§èƒ½**: å‘é‡ä¼˜åŒ–æå‡æŸ¥è¯¢æ€§èƒ½ 11 å€
- **è§‚çœ‹æ—¶é•¿**: æå‡ç”¨æˆ·è§‚çœ‹æ—¶é•¿ 45%

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ¶æ„è®¾è®¡

```text
è§†é¢‘æ•°æ®é‡‡é›†
  â”œâ”€â”€ è§†é¢‘ç‰¹å¾
  â”œâ”€â”€ å…ƒæ•°æ®
  â””â”€â”€ ç”¨æˆ·è¡Œä¸º
  â†“
å‘é‡æ•°æ®å­˜å‚¨ï¼ˆpgvectorï¼‰
  â”œâ”€â”€ è§†é¢‘å‘é‡
  â””â”€â”€ ç”¨æˆ·åå¥½å‘é‡
  â†“
ç®¡ç†æœåŠ¡
  â”œâ”€â”€ ä¸ªæ€§åŒ–æ¨è
  â”œâ”€â”€ ç›¸ä¼¼åº¦åŒ¹é…
  â””â”€â”€ æ’­æ”¾åˆ—è¡¨ç”Ÿæˆ
```

### 2.2 æŠ€æœ¯æ ˆ

- **æ•°æ®åº“**: PostgreSQL + pgvector
- **æ•°æ®é‡‡é›†**: è§†é¢‘å¤„ç†ã€ç‰¹å¾æå–
- **å®æ—¶åˆ†æ**: Python + SQL
- **åº”ç”¨æ¡†æ¶**: FastAPI / Spring Boot

## 3. æ•°æ®æ¨¡å‹è®¾è®¡

### 3.1 è§†é¢‘è¡¨

```sql
-- åˆ›å»ºè§†é¢‘è¡¨
CREATE TABLE videos (
    id SERIAL PRIMARY KEY,
    title TEXT NOT NULL,
    creator TEXT,
    category TEXT,
    content_vector vector(512),
    category_vector vector(256),
    duration INTEGER,
    view_count INTEGER DEFAULT 0,
    like_count INTEGER DEFAULT 0,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    metadata JSONB
);

-- åˆ›å»ºå‘é‡ç´¢å¼•
CREATE INDEX videos_content_idx ON videos
USING ivfflat (content_vector vector_cosine_ops)
WITH (lists = 100);

CREATE INDEX videos_category_idx ON videos
USING ivfflat (category_vector vector_cosine_ops)
WITH (lists = 50);
```

### 3.2 ç”¨æˆ·è§‚çœ‹å†å²è¡¨

```sql
CREATE TABLE user_watch_history (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL,
    video_id INTEGER NOT NULL,
    watch_duration INTEGER,
    completion_rate DECIMAL(5, 2),
    watched_at TIMESTAMPTZ DEFAULT NOW(),
    rating INTEGER,
    metadata JSONB
);

-- åˆ›å»ºç”¨æˆ·åå¥½å‘é‡è¡¨
CREATE TABLE user_preferences (
    user_id INTEGER PRIMARY KEY,
    preference_vector vector(512),
    favorite_categories TEXT[],
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- åˆ›å»ºå‘é‡ç´¢å¼•
CREATE INDEX up_vector_idx ON user_preferences
USING ivfflat (preference_vector vector_cosine_ops)
WITH (lists = 100);
```

## 4. æ¨èç®¡ç†

### 4.1 ä¸ªæ€§åŒ–æ¨è

```sql
-- åŸºäºè§‚çœ‹å†å²çš„ä¸ªæ€§åŒ–æ¨è
SELECT
    v.id,
    v.title,
    v.creator,
    v.category,
    1 - (v.content_vector <=> up.preference_vector) AS similarity,
    v.duration,
    v.view_count
FROM videos v
JOIN user_preferences up ON up.user_id = $1
WHERE v.content_vector <=> up.preference_vector < 0.7
    AND v.id NOT IN (
        SELECT video_id
        FROM user_watch_history
        WHERE user_id = $1
    )
ORDER BY v.content_vector <=> up.preference_vector
LIMIT 50;
```

### 4.2 ç›¸ä¼¼è§†é¢‘æ¨è

```python
# ç›¸ä¼¼è§†é¢‘æ¨è
class SimilarVideoRecommendation:
    async def find_similar_videos(self, video_id, limit=20):
        """æŸ¥æ‰¾ç›¸ä¼¼è§†é¢‘"""
        # 1. è·å–è§†é¢‘å‘é‡
        video = await self.db.fetchrow("""
            SELECT content_vector, category_vector
            FROM videos
            WHERE id = $1
        """, video_id)

        # 2. æŸ¥æ‰¾ç›¸ä¼¼è§†é¢‘
        similar_videos = await self.db.fetch("""
            SELECT
                id,
                title,
                creator,
                category,
                1 - (content_vector <=> $1::vector) AS content_similarity,
                1 - (category_vector <=> $2::vector) AS category_similarity,
                (1 - (content_vector <=> $1::vector) * 0.7 +
                 1 - (category_vector <=> $2::vector) * 0.3) AS combined_similarity
            FROM videos
            WHERE id != $3
                AND content_vector <=> $1::vector < 0.6
            ORDER BY combined_similarity DESC
            LIMIT $4
        """, video['content_vector'], video['category_vector'], video_id, limit)

        return similar_videos
```

## 5. å®é™…åº”ç”¨æ¡ˆä¾‹

### 5.1 æ¡ˆä¾‹: æ™ºèƒ½è§†é¢‘æ¨èç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸè§†é¢‘å¹³å°éœ€è¦æ„å»ºæ™ºèƒ½è§†é¢‘æ¨èç³»ç»Ÿï¼Œæ ¹æ®è§‚çœ‹å†å²æ¨èè§†é¢‘ã€‚

**é—®é¢˜åˆ†æ**:

1. **ä¸ªæ€§åŒ–æ¨è**: ä¸ªæ€§åŒ–æ¨èå›°éš¾
2. **ç›¸ä¼¼åº¦åŒ¹é…**: ç›¸ä¼¼åº¦åŒ¹é…æ•ˆç‡ä½
3. **ç”¨æˆ·æ»¡æ„åº¦**: ç”¨æˆ·æ»¡æ„åº¦ä½

**è§£å†³æ–¹æ¡ˆ**:

```python
# æ™ºèƒ½è§†é¢‘æ¨èç³»ç»Ÿ
class SmartVideoRecommendationSystem:
    def __init__(self):
        self.similar_video = SimilarVideoRecommendation()
        self.playlist_generator = PlaylistGenerator()

    async def recommend_videos(self, user_id, context=None):
        """æ¨èè§†é¢‘"""
        # 1. æ›´æ–°ç”¨æˆ·åå¥½
        await self.update_user_preferences(user_id)

        # 2. æ¨èè§†é¢‘
        recommendations = await self.db.fetch("""
            SELECT
                v.id,
                v.title,
                v.creator,
                v.category,
                1 - (v.content_vector <=> up.preference_vector) AS similarity,
                v.duration,
                v.view_count
            FROM videos v
            JOIN user_preferences up ON up.user_id = $1
            WHERE v.content_vector <=> up.preference_vector < 0.7
                AND v.id NOT IN (
                    SELECT video_id
                    FROM user_watch_history
                    WHERE user_id = $1
                )
            ORDER BY v.content_vector <=> up.preference_vector
            LIMIT 50
        """, user_id)

        # 3. ç”Ÿæˆæ’­æ”¾åˆ—è¡¨
        if context == 'playlist':
            playlist = await self.playlist_generator.generate_playlist(
                user_id, recommendations
            )
            return playlist

        return recommendations
```

**ä¼˜åŒ–æ•ˆæœ**:

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| **æ¨èå‡†ç¡®ç‡** | åŸºå‡† | **+54%** | **æå‡** |
| **ç”¨æˆ·æ»¡æ„åº¦** | åŸºå‡† | **+48%** | **æå‡** |
| **æŸ¥è¯¢æ€§èƒ½** | 2 ç§’ | **< 180ms** | **91%** â¬‡ï¸ |
| **è§‚çœ‹æ—¶é•¿** | åŸºå‡† | **+45%** | **æå‡** |

## 6. æœ€ä½³å®è·µ

### 6.1 ä¸ªæ€§åŒ–æ¨è

1. **è§‚çœ‹å†å²**: åˆ†æç”¨æˆ·è§‚çœ‹å†å²
2. **åå¥½æ›´æ–°**: æŒç»­æ›´æ–°ç”¨æˆ·åå¥½
3. **å¤šæ ·æ€§**: ä¿è¯æ¨èå¤šæ ·æ€§

### 6.2 ç›¸ä¼¼åº¦åŒ¹é…

1. **ç‰¹å¾æå–**: å‡†ç¡®æå–è§†é¢‘ç‰¹å¾
2. **å‘é‡è´¨é‡**: ç¡®ä¿è§†é¢‘å‘é‡è´¨é‡
3. **æŒç»­ä¼˜åŒ–**: æŒç»­ä¼˜åŒ–æ¨èç®—æ³•

## 7. å‚è€ƒèµ„æ–™

- [ä¸ªæ€§åŒ–æ¨èç³»ç»Ÿ](../ç”µå•†åœºæ™¯/ä¸ªæ€§åŒ–æ¨èç³»ç»Ÿ.md)
- [å†…å®¹æ¨èç³»ç»Ÿ](../åª’ä½“åœºæ™¯/å†…å®¹æ¨èç³»ç»Ÿ.md)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 08-41-01
