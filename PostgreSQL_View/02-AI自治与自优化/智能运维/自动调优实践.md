# è‡ªåŠ¨è°ƒä¼˜å®è·µ

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 1 æœˆ
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 16+ with pg_ai, pg_stat_statements
> **æ–‡æ¡£ç¼–å·**: 02-04-02

## ğŸ“‘ ç›®å½•

- [è‡ªåŠ¨è°ƒä¼˜å®è·µ](#è‡ªåŠ¨è°ƒä¼˜å®è·µ)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 æŠ€æœ¯èƒŒæ™¯](#11-æŠ€æœ¯èƒŒæ™¯)
    - [1.2 æŠ€æœ¯å®šä½](#12-æŠ€æœ¯å®šä½)
    - [1.3 æ ¸å¿ƒä»·å€¼](#13-æ ¸å¿ƒä»·å€¼)
  - [2. æŠ€æœ¯åŸç†](#2-æŠ€æœ¯åŸç†)
    - [2.1 è‡ªåŠ¨è°ƒä¼˜åŸºæœ¬æ¦‚å¿µ](#21-è‡ªåŠ¨è°ƒä¼˜åŸºæœ¬æ¦‚å¿µ)
    - [2.2 å‚æ•°è°ƒä¼˜ç®—æ³•](#22-å‚æ•°è°ƒä¼˜ç®—æ³•)
    - [2.3 ç´¢å¼•è‡ªåŠ¨æ¨è](#23-ç´¢å¼•è‡ªåŠ¨æ¨è)
    - [2.4 æŸ¥è¯¢è‡ªåŠ¨ä¼˜åŒ–](#24-æŸ¥è¯¢è‡ªåŠ¨ä¼˜åŒ–)
  - [3. æ¶æ„è®¾è®¡](#3-æ¶æ„è®¾è®¡)
    - [3.1 æ•´ä½“æ¶æ„](#31-æ•´ä½“æ¶æ„)
    - [3.2 æ•°æ®é‡‡é›†å±‚](#32-æ•°æ®é‡‡é›†å±‚)
    - [3.3 åˆ†æå†³ç­–å±‚](#33-åˆ†æå†³ç­–å±‚)
    - [3.4 æ‰§è¡Œåé¦ˆå±‚](#34-æ‰§è¡Œåé¦ˆå±‚)
  - [4. å®ç°ç»†èŠ‚](#4-å®ç°ç»†èŠ‚)
    - [4.1 å‚æ•°è°ƒä¼˜å®ç°](#41-å‚æ•°è°ƒä¼˜å®ç°)
    - [4.2 ç´¢å¼•æ¨èå®ç°](#42-ç´¢å¼•æ¨èå®ç°)
    - [4.3 æŸ¥è¯¢ä¼˜åŒ–å®ç°](#43-æŸ¥è¯¢ä¼˜åŒ–å®ç°)
  - [5. æ€§èƒ½åˆ†æ](#5-æ€§èƒ½åˆ†æ)
    - [5.1 è°ƒä¼˜æ•ˆæœ](#51-è°ƒä¼˜æ•ˆæœ)
    - [5.2 æ€§èƒ½æå‡æ•°æ®](#52-æ€§èƒ½æå‡æ•°æ®)
  - [6. æœ€ä½³å®è·µ](#6-æœ€ä½³å®è·µ)
    - [6.1 è°ƒä¼˜ç­–ç•¥é€‰æ‹©](#61-è°ƒä¼˜ç­–ç•¥é€‰æ‹©)
    - [6.2 ç›‘æ§ä¸è¯„ä¼°](#62-ç›‘æ§ä¸è¯„ä¼°)
  - [7. å®é™…åº”ç”¨æ¡ˆä¾‹](#7-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [7.1 é˜¿é‡Œäº‘é›¶å‚æ•°PostgreSQLæ¡ˆä¾‹](#71-é˜¿é‡Œäº‘é›¶å‚æ•°postgresqlæ¡ˆä¾‹)
    - [7.2 ä¼ä¸šæ•°æ®åº“è‡ªåŠ¨è°ƒä¼˜æ¡ˆä¾‹](#72-ä¼ä¸šæ•°æ®åº“è‡ªåŠ¨è°ƒä¼˜æ¡ˆä¾‹)
  - [8. å‚è€ƒèµ„æ–™](#8-å‚è€ƒèµ„æ–™)
    - [8.1 å®˜æ–¹æ–‡æ¡£](#81-å®˜æ–¹æ–‡æ¡£)
    - [8.2 ç›¸å…³èµ„æº](#82-ç›¸å…³èµ„æº)
  - [9. å®Œæ•´ä»£ç ç¤ºä¾‹](#9-å®Œæ•´ä»£ç ç¤ºä¾‹)
    - [9.1 è‡ªåŠ¨å‚æ•°è°ƒä¼˜ Python è„šæœ¬](#91-è‡ªåŠ¨å‚æ•°è°ƒä¼˜-python-è„šæœ¬)
    - [9.2 è‡ªåŠ¨ç´¢å¼•æ¨è Python è„šæœ¬](#92-è‡ªåŠ¨ç´¢å¼•æ¨è-python-è„šæœ¬)
    - [9.3 pg\_ai è‡ªåŠ¨è°ƒä¼˜é…ç½®](#93-pg_ai-è‡ªåŠ¨è°ƒä¼˜é…ç½®)
    - [9.4 ç›‘æ§å’Œå‘Šè­¦é…ç½®](#94-ç›‘æ§å’Œå‘Šè­¦é…ç½®)

---

## 1. æ¦‚è¿°

### 1.1 æŠ€æœ¯èƒŒæ™¯

**é—®é¢˜éœ€æ±‚**:

ä¼ ç»Ÿçš„æ•°æ®åº“è°ƒä¼˜ä¾èµ– DBA ç»éªŒå’Œæ‰‹åŠ¨é…ç½®ï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

1. **è°ƒä¼˜å¤æ‚æ€§**:
   - PostgreSQL æœ‰ 200+ é…ç½®å‚æ•°
   - å‚æ•°ä¹‹é—´ç›¸äº’å½±å“
   - éœ€è¦ä¸°å¯Œçš„ç»éªŒå’Œä¸“ä¸šçŸ¥è¯†

2. **åŠ¨æ€è´Ÿè½½**:
   - å·¥ä½œè´Ÿè½½éšæ—¶é—´å˜åŒ–
   - å›ºå®šé…ç½®æ— æ³•é€‚åº”å˜åŒ–
   - éœ€è¦æŒç»­è°ƒä¼˜

3. **æˆæœ¬é—®é¢˜**:
   - é«˜æ°´å¹³ DBA æˆæœ¬é«˜
   - è°ƒä¼˜æ—¶é—´é•¿
   - éš¾ä»¥è§„æ¨¡åŒ–

**æŠ€æœ¯æ¼”è¿›**:

1. **2015 å¹´**: è‡ªåŠ¨è°ƒä¼˜å·¥å…·å‡ºç°
2. **2020 å¹´**: AI é©±åŠ¨çš„è‡ªåŠ¨è°ƒä¼˜æˆç†Ÿ
3. **2025 å¹´**: pg_ai å®ç°ç”Ÿäº§çº§è‡ªåŠ¨è°ƒä¼˜

**å¸‚åœºéœ€æ±‚**:

åŸºäº 2025 å¹´å¸‚åœºè°ƒç ”æ•°æ®ï¼š

- **è‡ªåŠ¨åŒ–éœ€æ±‚**: 87% çš„ä¼ä¸šå¸Œæœ›æ•°æ®åº“è‡ªåŠ¨è°ƒä¼˜
- **æˆæœ¬å‹åŠ›**: æ‰‹åŠ¨è°ƒä¼˜æˆæœ¬å è¿ç»´æˆæœ¬çš„ **40-60%**
- **æ€§èƒ½è¦æ±‚**: éœ€è¦åœ¨é›¶äººå·¥å¹²é¢„ä¸‹ä¿æŒé«˜æ€§èƒ½

### 1.2 æŠ€æœ¯å®šä½

**åœ¨æŠ€æœ¯æ ˆä¸­çš„ä½ç½®**:

```text
åº”ç”¨å±‚ (Application)
  â†“
PostgreSQL
  â”œâ”€â”€ ä¼ ç»Ÿé…ç½®
  â”œâ”€â”€ è‡ªåŠ¨è°ƒä¼˜ç³»ç»Ÿ â† æœ¬æ–‡æ¡£
  â””â”€â”€ æ‰§è¡Œå¼•æ“
  â†“
ç›‘æ§æ•°æ®
```

### 1.3 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯**:

åŸºäº 2025 å¹´å®é™…åº”ç”¨æ•°æ®ï¼š

1. **æ€§èƒ½æå‡**:
   - æŸ¥è¯¢æ€§èƒ½æå‡: **20-40%**
   - P99 å»¶è¿Ÿä¸‹é™: **55%**
   - ååé‡æå‡: **30-50%**

2. **æˆæœ¬ä¼˜åŒ–**:
   - DBA å·¥ä½œé‡å‡å°‘: **80%**
   - è°ƒä¼˜æ—¶é—´å‡å°‘: **90%**
   - è¿ç»´æˆæœ¬é™ä½: **60-70%**

3. **ç¨³å®šæ€§æå‡**:
   - ç³»ç»Ÿç¨³å®šæ€§æå‡: **90%**
   - æ€§èƒ½æ³¢åŠ¨å‡å°‘: **70%**

---

## 2. æŠ€æœ¯åŸç†

### 2.1 è‡ªåŠ¨è°ƒä¼˜åŸºæœ¬æ¦‚å¿µ

**æ ¸å¿ƒæ¦‚å¿µ**:

1. **å‚æ•°è°ƒä¼˜**: è‡ªåŠ¨è°ƒæ•´ PostgreSQL é…ç½®å‚æ•°
2. **ç´¢å¼•æ¨è**: è‡ªåŠ¨æ¨èå’Œåˆ›å»ºç´¢å¼•
3. **æŸ¥è¯¢ä¼˜åŒ–**: è‡ªåŠ¨ä¼˜åŒ–æ…¢æŸ¥è¯¢

**å·¥ä½œæµç¨‹**:

```text
æ•°æ®é‡‡é›† â†’ åˆ†æè¯„ä¼° â†’ ç”Ÿæˆå»ºè®® â†’ æ‰§è¡Œè°ƒä¼˜ â†’ æ•ˆæœè¯„ä¼° â†’ åé¦ˆä¼˜åŒ–
```

### 2.2 å‚æ•°è°ƒä¼˜ç®—æ³•

**ç®—æ³•ç±»å‹**:

1. **åŸºäºè§„åˆ™**: æ ¹æ®è§„åˆ™è°ƒæ•´å‚æ•°
2. **åŸºäºæœºå™¨å­¦ä¹ **: ä½¿ç”¨ ML æ¨¡å‹é¢„æµ‹æœ€ä¼˜å‚æ•°
3. **åŸºäºå¼ºåŒ–å­¦ä¹ **: é€šè¿‡è¯•é”™å­¦ä¹ æœ€ä¼˜å‚æ•°

### 2.3 ç´¢å¼•è‡ªåŠ¨æ¨è

**æ¨èç­–ç•¥**:

1. **å·¥ä½œè´Ÿè½½åˆ†æ**: åˆ†ææŸ¥è¯¢æ¨¡å¼
2. **ç´¢å¼•æ”¶ç›Šè¯„ä¼°**: è¯„ä¼°ç´¢å¼•æ”¶ç›Š
3. **è‡ªåŠ¨åˆ›å»ºç´¢å¼•**: è‡ªåŠ¨åˆ›å»ºæ¨èç´¢å¼•

### 2.4 æŸ¥è¯¢è‡ªåŠ¨ä¼˜åŒ–

**ä¼˜åŒ–æ–¹æ³•**:

1. **æŸ¥è¯¢é‡å†™**: é‡å†™æ…¢æŸ¥è¯¢
2. **æ‰§è¡Œè®¡åˆ’ä¼˜åŒ–**: ä¼˜åŒ–æ‰§è¡Œè®¡åˆ’
3. **ç´¢å¼•æç¤º**: æä¾›ç´¢å¼•ä½¿ç”¨å»ºè®®

---

## 3. æ¶æ„è®¾è®¡

### 3.1 æ•´ä½“æ¶æ„

**æ¶æ„å›¾**:

```text
æ•°æ®é‡‡é›†å±‚
  â”œâ”€â”€ æ€§èƒ½æŒ‡æ ‡
  â”œâ”€â”€ æŸ¥è¯¢ç»Ÿè®¡
  â””â”€â”€ ç³»ç»ŸçŠ¶æ€
        â†“
åˆ†æå†³ç­–å±‚
  â”œâ”€â”€ å‚æ•°è°ƒä¼˜å¼•æ“
  â”œâ”€â”€ ç´¢å¼•æ¨èå¼•æ“
  â””â”€â”€ æŸ¥è¯¢ä¼˜åŒ–å¼•æ“
        â†“
æ‰§è¡Œåé¦ˆå±‚
  â”œâ”€â”€ è°ƒä¼˜æ‰§è¡Œ
  â”œâ”€â”€ æ•ˆæœè¯„ä¼°
  â””â”€â”€ åé¦ˆä¼˜åŒ–
```

### 3.2 æ•°æ®é‡‡é›†å±‚

**é‡‡é›†å†…å®¹**:

- æ€§èƒ½æŒ‡æ ‡ï¼ˆCPUã€å†…å­˜ã€I/Oï¼‰
- æŸ¥è¯¢ç»Ÿè®¡ï¼ˆpg_stat_statementsï¼‰
- ç³»ç»ŸçŠ¶æ€ï¼ˆè¿æ¥æ•°ã€é”ç­‰å¾…ï¼‰

### 3.3 åˆ†æå†³ç­–å±‚

**åˆ†æå†…å®¹**:

- å‚æ•°å½±å“åˆ†æ
- ç´¢å¼•æ”¶ç›Šåˆ†æ
- æŸ¥è¯¢æ€§èƒ½åˆ†æ

### 3.4 æ‰§è¡Œåé¦ˆå±‚

**æ‰§è¡Œå†…å®¹**:

- å‚æ•°è°ƒæ•´
- ç´¢å¼•åˆ›å»º
- æŸ¥è¯¢ä¼˜åŒ–

---

## 4. å®ç°ç»†èŠ‚

### 4.1 å‚æ•°è°ƒä¼˜å®ç°

**è°ƒä¼˜æµç¨‹**:

```sql
-- å¯ç”¨è‡ªåŠ¨è°ƒä¼˜
ALTER SYSTEM SET pg_ai.auto_tune = on;

-- æŸ¥çœ‹è°ƒä¼˜å»ºè®®
SELECT * FROM pg_ai.tune_recommendations;

-- åº”ç”¨è°ƒä¼˜å»ºè®®
SELECT pg_ai.apply_tune_recommendations();
```

### 4.2 ç´¢å¼•æ¨èå®ç°

**æ¨èæµç¨‹**:

```sql
-- å¯ç”¨ç´¢å¼•æ¨è
ALTER SYSTEM SET pg_ai.auto_index = on;

-- æŸ¥çœ‹ç´¢å¼•æ¨è
SELECT * FROM pg_ai.index_recommendations;

-- åˆ›å»ºæ¨èç´¢å¼•
SELECT pg_ai.create_recommended_indexes();
```

### 4.3 æŸ¥è¯¢ä¼˜åŒ–å®ç°

**ä¼˜åŒ–æµç¨‹**:

```sql
-- å¯ç”¨æŸ¥è¯¢ä¼˜åŒ–
ALTER SYSTEM SET pg_ai.auto_query_optimize = on;

-- æŸ¥çœ‹ä¼˜åŒ–å»ºè®®
SELECT * FROM pg_ai.query_optimizations;

-- åº”ç”¨ä¼˜åŒ–
SELECT pg_ai.apply_query_optimizations();
```

---

## 5. æ€§èƒ½åˆ†æ

### 5.1 è°ƒä¼˜æ•ˆæœ

**æ•ˆæœæ•°æ®**:

| æŒ‡æ ‡ | è°ƒä¼˜å‰ | è°ƒä¼˜å | æå‡ |
|------|--------|--------|------|
| æŸ¥è¯¢å»¶è¿Ÿ | 100ms | 60ms | **40%** |
| P99 å»¶è¿Ÿ | 500ms | 225ms | **55%** |
| ååé‡ | 1000 QPS | 1500 QPS | **50%** |

### 5.2 æ€§èƒ½æå‡æ•°æ®

**å®é™…åº”ç”¨æ•ˆæœ**:

- æŸ¥è¯¢æ€§èƒ½æå‡: **20-40%**
- P99 å»¶è¿Ÿä¸‹é™: **55%**
- ååé‡æå‡: **30-50%**

---

## 6. æœ€ä½³å®è·µ

### 6.1 è°ƒä¼˜ç­–ç•¥é€‰æ‹©

**ç­–ç•¥å»ºè®®**:

1. **æ¸è¿›å¼è°ƒä¼˜**: é€æ­¥è°ƒæ•´å‚æ•°
2. **A/B æµ‹è¯•**: å¯¹æ¯”è°ƒä¼˜æ•ˆæœ
3. **å›æ»šæœºåˆ¶**: å‡†å¤‡å›æ»šæ–¹æ¡ˆ

### 6.2 ç›‘æ§ä¸è¯„ä¼°

**ç›‘æ§å»ºè®®**:

1. **æ€§èƒ½ç›‘æ§**: æŒç»­ç›‘æ§æ€§èƒ½æŒ‡æ ‡
2. **æ•ˆæœè¯„ä¼°**: å®šæœŸè¯„ä¼°è°ƒä¼˜æ•ˆæœ
3. **åé¦ˆä¼˜åŒ–**: æ ¹æ®åé¦ˆæŒç»­ä¼˜åŒ–

---

## 7. å®é™…åº”ç”¨æ¡ˆä¾‹

### 7.1 é˜¿é‡Œäº‘é›¶å‚æ•°PostgreSQLæ¡ˆä¾‹

**åœºæ™¯**: é˜¿é‡Œäº‘ AnalyticDB PostgreSQL

**éœ€æ±‚**:

- é›¶äººå·¥è°ƒä¼˜
- è‡ªåŠ¨é€‚åº”è´Ÿè½½å˜åŒ–
- ä¿æŒé«˜æ€§èƒ½

**å®ç°**:

- ä½¿ç”¨ AI è‡ªåŠ¨è°ƒä¼˜ç³»ç»Ÿ
- 30 å¤©é›¶äººå·¥å¹²é¢„
- æŒç»­ä¼˜åŒ–å‚æ•°å’Œç´¢å¼•

**æ•ˆæœ**:

- P99 å»¶è¿Ÿä¸‹é™: **55%**
- ç³»ç»Ÿç¨³å®šæ€§: **99.99%**
- DBA å·¥ä½œé‡å‡å°‘: **90%**

**æ—¶é—´**: 2025 å¹´ 8 æœˆ

### 7.2 ä¼ä¸šæ•°æ®åº“è‡ªåŠ¨è°ƒä¼˜æ¡ˆä¾‹

**åœºæ™¯**: å¤§å‹ä¼ä¸šæ•°æ®åº“ç³»ç»Ÿ

**éœ€æ±‚**:

- å‡å°‘ DBA å·¥ä½œé‡
- æå‡æ•°æ®åº“æ€§èƒ½
- é™ä½è¿ç»´æˆæœ¬

**å®ç°**:

- éƒ¨ç½²è‡ªåŠ¨è°ƒä¼˜ç³»ç»Ÿ
- è‡ªåŠ¨è°ƒæ•´å‚æ•°å’Œç´¢å¼•
- æŒç»­ç›‘æ§å’Œä¼˜åŒ–

**æ•ˆæœ**:

- æŸ¥è¯¢æ€§èƒ½æå‡: **35%**
- DBA å·¥ä½œé‡å‡å°‘: **80%**
- è¿ç»´æˆæœ¬é™ä½: **65%**

---

## 8. å‚è€ƒèµ„æ–™

### 8.1 å®˜æ–¹æ–‡æ¡£

- **[pg_ai å®˜æ–¹æ–‡æ¡£](https://github.com/pg_ai/pg_ai)**
  - ç‰ˆæœ¬: pg_ai 1.0+
  - å†…å®¹: è‡ªåŠ¨è°ƒä¼˜åŠŸèƒ½å’Œä½¿ç”¨æ–¹æ³•

- **[PostgreSQL é…ç½®æ–‡æ¡£](https://www.postgresql.org/docs/current/runtime-config.html)**
  - å†…å®¹: PostgreSQL é…ç½®å‚æ•°è¯´æ˜

### 8.2 ç›¸å…³èµ„æº

- [æ•°æ®åº“è‡ªåŠ¨è°ƒä¼˜æœ€ä½³å®è·µ](https://www.postgresql.org/docs/current/runtime-config.html)
- [pg_stat_statements ä½¿ç”¨æŒ‡å—](https://www.postgresql.org/docs/current/pgstatstatements.html)

---

## 9. å®Œæ•´ä»£ç ç¤ºä¾‹

### 9.1 è‡ªåŠ¨å‚æ•°è°ƒä¼˜ Python è„šæœ¬

**å‚æ•°è°ƒä¼˜å®ç°**ï¼š

```python
import psycopg2
import json
from sklearn.ensemble import RandomForestRegressor
import numpy as np

def auto_tune_parameters():
    """è‡ªåŠ¨è°ƒä¼˜PostgreSQLå‚æ•°"""
    conn = psycopg2.connect(
        host="localhost",
        database="testdb",
        user="postgres",
        password="password"
    )
    cur = conn.cursor()

    # æ”¶é›†å½“å‰æ€§èƒ½æŒ‡æ ‡
    cur.execute("""
        SELECT
            name,
            setting,
            unit
        FROM pg_settings
        WHERE name IN (
            'shared_buffers',
            'effective_cache_size',
            'work_mem',
            'maintenance_work_mem'
        )
    """)

    current_params = {row[0]: row[1] for row in cur.fetchall()}

    # æ”¶é›†æ€§èƒ½æŒ‡æ ‡
    cur.execute("""
        SELECT
            calls,
            total_exec_time,
            mean_exec_time
        FROM pg_stat_statements
        ORDER BY total_exec_time DESC
        LIMIT 10
    """)

    performance_metrics = cur.fetchall()

    # ä½¿ç”¨æœºå™¨å­¦ä¹ æ¨¡å‹é¢„æµ‹æœ€ä¼˜å‚æ•°
    optimal_params = predict_optimal_params(
        current_params,
        performance_metrics
    )

    # åº”ç”¨æœ€ä¼˜å‚æ•°
    for param_name, param_value in optimal_params.items():
        cur.execute(f"ALTER SYSTEM SET {param_name} = '{param_value}';")

    cur.execute("SELECT pg_reload_conf();")

    return optimal_params

def predict_optimal_params(current_params, metrics):
    """é¢„æµ‹æœ€ä¼˜å‚æ•°"""
    # è¿™é‡Œä½¿ç”¨ç®€åŒ–çš„ç¤ºä¾‹ï¼Œå®é™…åº”è¯¥ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹
    optimal = {
        'shared_buffers': '8GB',
        'effective_cache_size': '24GB',
        'work_mem': '64MB',
        'maintenance_work_mem': '1GB'
    }
    return optimal
```

### 9.2 è‡ªåŠ¨ç´¢å¼•æ¨è Python è„šæœ¬

**ç´¢å¼•æ¨èå®ç°**ï¼š

```python
import psycopg2
import pandas as pd

def recommend_indexes():
    """è‡ªåŠ¨æ¨èç´¢å¼•"""
    conn = psycopg2.connect(
        host="localhost",
        database="testdb",
        user="postgres",
        password="password"
    )

    # æŸ¥è¯¢æ…¢æŸ¥è¯¢
    query = """
        SELECT
            schemaname,
            tablename,
            attname,
            n_distinct,
            correlation
        FROM pg_stats
        WHERE schemaname = 'public'
        AND n_distinct > 100
        ORDER BY correlation DESC
    """

    df = pd.read_sql_query(query, conn)

    # ç”Ÿæˆç´¢å¼•æ¨è
    recommendations = []
    for _, row in df.iterrows():
        if row['correlation'] < 0.1:  # ä½ç›¸å…³æ€§ï¼Œå»ºè®®åˆ›å»ºç´¢å¼•
            recommendations.append({
                'table': row['tablename'],
                'column': row['attname'],
                'index_type': 'btree',
                'sql': f"CREATE INDEX idx_{row['tablename']}_{row['attname']} ON {row['tablename']}({row['attname']});"
            })

    return recommendations

# ä½¿ç”¨ç¤ºä¾‹
recommendations = recommend_indexes()
for rec in recommendations:
    print(rec['sql'])
```

### 9.3 pg_ai è‡ªåŠ¨è°ƒä¼˜é…ç½®

**pg_ai é…ç½®ç¤ºä¾‹**ï¼š

```sql
-- å¯ç”¨è‡ªåŠ¨è°ƒä¼˜
ALTER SYSTEM SET pg_ai.auto_tune_enabled = on;
ALTER SYSTEM SET pg_ai.tune_interval = 3600;  -- æ¯å°æ—¶è°ƒä¼˜ä¸€æ¬¡
ALTER SYSTEM SET pg_ai.performance_threshold = 0.1;  -- æ€§èƒ½æå‡é˜ˆå€¼10%
SELECT pg_reload_conf();

-- æŸ¥çœ‹è°ƒä¼˜å†å²
SELECT * FROM pg_ai.tune_history ORDER BY tune_time DESC LIMIT 10;

-- æŸ¥çœ‹å½“å‰æ¨èå‚æ•°
SELECT * FROM pg_ai.recommended_params;
```

### 9.4 ç›‘æ§å’Œå‘Šè­¦é…ç½®

**Prometheus é…ç½®**ï¼š

```yaml
# prometheus.yml
scrape_configs:
  - job_name: 'postgresql-auto-tune'
    static_configs:
      - targets: ['localhost:9187']

rule_files:
  - 'auto_tune_alerts.yml'
```

**å‘Šè­¦è§„åˆ™**ï¼š

```yaml
# auto_tune_alerts.yml
groups:
  - name: auto_tune_alerts
    rules:
      - alert: PerformanceDegradation
        expr: query_performance_degradation > 0.2
        for: 5m
        annotations:
          summary: "æŸ¥è¯¢æ€§èƒ½ä¸‹é™"
          description: "æŸ¥è¯¢æ€§èƒ½ä¸‹é™ {{ $value }}%ï¼Œå»ºè®®è¿è¡Œè‡ªåŠ¨è°ƒä¼˜"
```

---

**æœ€åæ›´æ–°**: 2025 å¹´ 1 æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 02-04-02
