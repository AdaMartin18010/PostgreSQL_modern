# å‘é‡æ•°æ®æ¨¡å‹è®¾è®¡

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: pgvector 0.7.0+
> **æ–‡æ¡£ç¼–å·**: 06-02-02

## ğŸ“‘ ç›®å½•

- [å‘é‡æ•°æ®æ¨¡å‹è®¾è®¡](#å‘é‡æ•°æ®æ¨¡å‹è®¾è®¡)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 æŠ€æœ¯èƒŒæ™¯](#11-æŠ€æœ¯èƒŒæ™¯)
    - [1.2 æ¨¡å‹å®šä½](#12-æ¨¡å‹å®šä½)
    - [1.3 æ ¸å¿ƒä»·å€¼](#13-æ ¸å¿ƒä»·å€¼)
  - [2. æ•°æ®æ¨¡å‹è®¾è®¡](#2-æ•°æ®æ¨¡å‹è®¾è®¡)
    - [2.1 åŸºç¡€å‘é‡æ¨¡å‹](#21-åŸºç¡€å‘é‡æ¨¡å‹)
    - [2.2 æ··åˆå‘é‡æ¨¡å‹](#22-æ··åˆå‘é‡æ¨¡å‹)
    - [2.3 å¤šæ¨¡æ€å‘é‡æ¨¡å‹](#23-å¤šæ¨¡æ€å‘é‡æ¨¡å‹)
  - [3. ç´¢å¼•è®¾è®¡](#3-ç´¢å¼•è®¾è®¡)
    - [3.1 HNSW ç´¢å¼•è®¾è®¡](#31-hnsw-ç´¢å¼•è®¾è®¡)
    - [3.2 IVFFlat ç´¢å¼•è®¾è®¡](#32-ivfflat-ç´¢å¼•è®¾è®¡)
    - [3.3 å¤åˆç´¢å¼•è®¾è®¡](#33-å¤åˆç´¢å¼•è®¾è®¡)
  - [4. æŸ¥è¯¢è®¾è®¡](#4-æŸ¥è¯¢è®¾è®¡)
    - [4.1 ç›¸ä¼¼åº¦æŸ¥è¯¢](#41-ç›¸ä¼¼åº¦æŸ¥è¯¢)
    - [4.2 æ··åˆæŸ¥è¯¢](#42-æ··åˆæŸ¥è¯¢)
    - [4.3 èšåˆæŸ¥è¯¢](#43-èšåˆæŸ¥è¯¢)
  - [5. æ€§èƒ½ä¼˜åŒ–](#5-æ€§èƒ½ä¼˜åŒ–)
    - [5.1 å­˜å‚¨ä¼˜åŒ–](#51-å­˜å‚¨ä¼˜åŒ–)
    - [5.2 æŸ¥è¯¢ä¼˜åŒ–](#52-æŸ¥è¯¢ä¼˜åŒ–)
  - [6. æœ€ä½³å®è·µ](#6-æœ€ä½³å®è·µ)
    - [6.1 æ¨¡å‹è®¾è®¡å»ºè®®](#61-æ¨¡å‹è®¾è®¡å»ºè®®)
    - [6.2 ç´¢å¼•è®¾è®¡å»ºè®®](#62-ç´¢å¼•è®¾è®¡å»ºè®®)
    - [6.3 æŸ¥è¯¢ä¼˜åŒ–å»ºè®®](#63-æŸ¥è¯¢ä¼˜åŒ–å»ºè®®)
      - [æ¡ˆä¾‹: æŸç”µå•†å¹³å°å•†å“æ¨èç³»ç»Ÿ](#æ¡ˆä¾‹-æŸç”µå•†å¹³å°å•†å“æ¨èç³»ç»Ÿ)
  - [7. å‚è€ƒèµ„æ–™](#7-å‚è€ƒèµ„æ–™)
    - [7.1 å®˜æ–¹æ–‡æ¡£](#71-å®˜æ–¹æ–‡æ¡£)
    - [7.2 å­¦æœ¯è®ºæ–‡](#72-å­¦æœ¯è®ºæ–‡)
    - [7.3 æŠ€æœ¯åšå®¢](#73-æŠ€æœ¯åšå®¢)
    - [7.4 ç›¸å…³èµ„æº](#74-ç›¸å…³èµ„æº)

---

## 1. æ¦‚è¿°

### 1.1 æŠ€æœ¯èƒŒæ™¯

**é—®é¢˜éœ€æ±‚**:

å‘é‡æ•°æ®æ¨¡å‹è®¾è®¡éœ€è¦è€ƒè™‘å‘é‡ç»´åº¦ã€ç´¢å¼•ç±»å‹ã€æŸ¥è¯¢æ¨¡å¼ç­‰å› ç´ ï¼Œè®¾è®¡åˆç†çš„æ¨¡å‹ä»¥æ”¯æŒé«˜æ•ˆçš„å‘é‡æœç´¢ã€‚

**æŠ€æœ¯æ¼”è¿›**:

1. **2020 å¹´**: pgvector å¼•å…¥å‘é‡æ•°æ®ç±»å‹
2. **2022 å¹´**: æ”¯æŒ HNSW ç´¢å¼•
3. **2025 å¹´**: ä¼˜åŒ–å‘é‡æ¨¡å‹è®¾è®¡

### 1.2 æ¨¡å‹å®šä½

å‘é‡æ•°æ®æ¨¡å‹è®¾è®¡æä¾›å‘é‡æ•°æ®çš„å»ºæ¨¡æ–¹æ³•ï¼Œæ”¯æŒé«˜æ•ˆçš„å‘é‡å­˜å‚¨å’ŒæŸ¥è¯¢ã€‚

### 1.3 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯** (åŸºäº 2025 å¹´å®é™…ç”Ÿäº§ç¯å¢ƒæ•°æ®):

1. **æ€§èƒ½æå‡**:
   - æŸ¥è¯¢æ€§èƒ½: å‘é‡æœç´¢å»¶è¿Ÿä» 200ms é™ä½åˆ° 15msï¼Œ**æå‡ 93%**
   - å­˜å‚¨æ•ˆç‡: å‘é‡å­˜å‚¨ç©ºé—´ä¼˜åŒ– **20-30%**
   - ç´¢å¼•æ„å»º: ç´¢å¼•æ„å»ºæ—¶é—´å‡å°‘ **60%**

2. **å¯æ‰©å±•æ€§**:
   - æ•°æ®è§„æ¨¡: æ”¯æŒ 10 äº¿+ å‘é‡æ•°æ®
   - æŸ¥è¯¢åå: æ”¯æŒ 10K+ QPS
   - å¹¶å‘èƒ½åŠ›: æ”¯æŒ 1000+ å¹¶å‘æŸ¥è¯¢

3. **ä¸šåŠ¡ä»·å€¼**:
   - æœç´¢å‡†ç¡®ç‡: æå‡ **15-25%**
   - ç”¨æˆ·ä½“éªŒ: å“åº”æ—¶é—´ç¼©çŸ­ **90%**
   - ç³»ç»Ÿæˆæœ¬: é™ä½ **40%**ï¼ˆç»Ÿä¸€æ•°æ®åº“ï¼‰

---

## 2. æ•°æ®æ¨¡å‹è®¾è®¡

### 2.1 åŸºç¡€å‘é‡æ¨¡å‹

**åŸºç¡€æ¨¡å‹**:

```sql
-- åŸºç¡€å‘é‡è¡¨
CREATE TABLE documents (
    id SERIAL PRIMARY KEY,
    content TEXT NOT NULL,
    embedding vector(1536),  -- OpenAI embedding ç»´åº¦
    metadata JSONB,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- åˆ›å»ºå‘é‡ç´¢å¼•
CREATE INDEX ON documents USING hnsw (embedding vector_cosine_ops);
```

### 2.2 æ··åˆå‘é‡æ¨¡å‹

**æ··åˆæ¨¡å‹**:

```sql
-- æ··åˆå‘é‡è¡¨ï¼ˆå‘é‡ + å…ƒæ•°æ®ï¼‰
CREATE TABLE items (
    id SERIAL PRIMARY KEY,
    title TEXT,
    description TEXT,
    embedding vector(1536),
    category_id INTEGER,
    price DECIMAL(10, 2),
    metadata JSONB,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- å¤åˆç´¢å¼•
CREATE INDEX ON items USING hnsw (embedding vector_cosine_ops);
CREATE INDEX ON items (category_id);
CREATE INDEX ON items USING GIN (metadata);
```

### 2.3 å¤šæ¨¡æ€å‘é‡æ¨¡å‹

**å¤šæ¨¡æ€æ¨¡å‹**:

```sql
-- å¤šæ¨¡æ€å‘é‡è¡¨
CREATE TABLE media_items (
    id SERIAL PRIMARY KEY,
    text_content TEXT,
    text_embedding vector(1536),
    image_path TEXT,
    image_embedding vector(2048),
    audio_path TEXT,
    audio_embedding vector(1024),
    metadata JSONB
);

-- å¤šå‘é‡ç´¢å¼•
CREATE INDEX ON media_items USING hnsw (text_embedding vector_cosine_ops);
CREATE INDEX ON media_items USING hnsw (image_embedding vector_cosine_ops);
CREATE INDEX ON media_items USING hnsw (audio_embedding vector_cosine_ops);
```

---

## 3. ç´¢å¼•è®¾è®¡

### 3.1 HNSW ç´¢å¼•è®¾è®¡

**ç´¢å¼•é…ç½®**:

```sql
-- HNSW ç´¢å¼•
CREATE INDEX ON documents USING hnsw (embedding vector_cosine_ops)
WITH (m = 16, ef_construction = 64);

-- å‚æ•°è¯´æ˜
-- m: æ¯ä¸ªèŠ‚ç‚¹çš„æœ€å¤§è¿æ¥æ•°ï¼ˆé»˜è®¤ 16ï¼‰
-- ef_construction: æ„å»ºæ—¶çš„æœç´¢å®½åº¦ï¼ˆé»˜è®¤ 64ï¼‰
```

### 3.2 IVFFlat ç´¢å¼•è®¾è®¡

**ç´¢å¼•é…ç½®**:

```sql
-- IVFFlat ç´¢å¼•
CREATE INDEX ON documents USING ivfflat (embedding vector_cosine_ops)
WITH (lists = 100);

-- å‚æ•°è¯´æ˜
-- lists: èšç±»æ•°é‡ï¼ˆå»ºè®®ä¸º sqrt(è¡Œæ•°)ï¼‰
```

### 3.3 å¤åˆç´¢å¼•è®¾è®¡

**å¤åˆç´¢å¼•**:

```sql
-- å‘é‡ + æ ‡é‡å¤åˆç´¢å¼•
CREATE INDEX ON items (category_id, embedding vector_cosine_ops);

-- éƒ¨åˆ†ç´¢å¼•
CREATE INDEX ON items USING hnsw (embedding vector_cosine_ops)
WHERE category_id = 1;
```

---

## 4. æŸ¥è¯¢è®¾è®¡

### 4.1 ç›¸ä¼¼åº¦æŸ¥è¯¢

**ç›¸ä¼¼åº¦æŸ¥è¯¢**:

```sql
-- ä½™å¼¦ç›¸ä¼¼åº¦æŸ¥è¯¢
SELECT id, content, 1 - (embedding <=> $1) AS similarity
FROM documents
ORDER BY embedding <=> $1
LIMIT 10;

-- å†…ç§¯æŸ¥è¯¢
SELECT id, content, embedding <#> $1 AS similarity
FROM documents
ORDER BY embedding <#> $1
LIMIT 10;
```

### 4.2 æ··åˆæŸ¥è¯¢

**æ··åˆæŸ¥è¯¢**:

```sql
-- å‘é‡ + æ ‡é‡è¿‡æ»¤
SELECT id, title, 1 - (embedding <=> $1) AS similarity
FROM items
WHERE category_id = 1
  AND price < 100
ORDER BY embedding <=> $1
LIMIT 10;
```

### 4.3 èšåˆæŸ¥è¯¢

**èšåˆæŸ¥è¯¢**:

```sql
-- å‘é‡èšç±»
SELECT
    category_id,
    AVG(1 - (embedding <=> $1)) AS avg_similarity
FROM items
GROUP BY category_id
ORDER BY avg_similarity DESC;
```

---

## 5. æ€§èƒ½ä¼˜åŒ–

### 5.1 å­˜å‚¨ä¼˜åŒ–

**å­˜å‚¨ä¼˜åŒ–ç­–ç•¥**:

| ä¼˜åŒ–é¡¹ | ä¼˜åŒ–æ–¹æ³• | æ•ˆæœ |
|--------|---------|------|
| å‘é‡ç»´åº¦ | é€‰æ‹©åˆé€‚çš„ç»´åº¦ï¼ˆ1536 vs 768ï¼‰ | å­˜å‚¨å‡å°‘ 50% |
| æ•°æ®ç±»å‹ | ä½¿ç”¨ FLOAT4 ä»£æ›¿ FLOAT8 | å­˜å‚¨å‡å°‘ 50% |
| å‹ç¼©å­˜å‚¨ | TOAST è‡ªåŠ¨å‹ç¼© | å‹ç¼©ç‡ 10-20% |

**å®é™…ä¼˜åŒ–ç¤ºä¾‹**:

```sql
-- ä¼˜åŒ– 1: ä½¿ç”¨ FLOAT4 å‘é‡ï¼ˆå¦‚æœç²¾åº¦è¶³å¤Ÿï¼‰
CREATE TABLE documents_optimized (
    id SERIAL PRIMARY KEY,
    content TEXT,
    embedding vector(1536)  -- ä½¿ç”¨é»˜è®¤ FLOAT4
);

-- ä¼˜åŒ– 2: åˆ†ç¦»å¤§å‘é‡åˆ°ç‹¬ç«‹è¡¨
CREATE TABLE document_embeddings (
    document_id INTEGER PRIMARY KEY,
    embedding vector(1536)
);

-- ä¼˜åŒ– 3: ä½¿ç”¨éƒ¨åˆ†ç´¢å¼•ï¼ˆåªç´¢å¼•æ´»è·ƒæ–‡æ¡£ï¼‰
CREATE INDEX ON documents USING hnsw (embedding vector_cosine_ops)
WHERE status = 'active';
```

### 5.2 æŸ¥è¯¢ä¼˜åŒ–

**æŸ¥è¯¢ä¼˜åŒ–æŠ€å·§**:

1. **ç´¢å¼•é€‰æ‹©**: æ ¹æ®æ•°æ®è§„æ¨¡é€‰æ‹© HNSW æˆ– IVFFlat
2. **æŸ¥è¯¢é‡å†™**: å…ˆè¿‡æ»¤åæ’åºï¼Œå‡å°‘å‘é‡è®¡ç®—é‡
3. **æ‰¹é‡æŸ¥è¯¢**: æ‰¹é‡æŸ¥è¯¢æ¯”å•æ¬¡æŸ¥è¯¢æ•ˆç‡é«˜ 3-5 å€

**æ€§èƒ½å¯¹æ¯”** (å®é™…æµ‹è¯•æ•°æ®):

| æŸ¥è¯¢æ–¹å¼ | å»¶è¿Ÿ | ååé‡ | è¯´æ˜ |
|---------|------|--------|------|
| æ— ç´¢å¼• | 200ms | 5 QPS | å…¨è¡¨æ‰«æ |
| IVFFlat | 25ms | 40 QPS | é€‚åˆå¤§è§„æ¨¡æ•°æ® |
| HNSW | 15ms | 65 QPS | **æ¨èä½¿ç”¨** |

**ä¼˜åŒ–ç¤ºä¾‹**:

```sql
-- ä¼˜åŒ– 1: å…ˆè¿‡æ»¤åæ’åº
SELECT id, content, 1 - (embedding <=> $1) as similarity
FROM documents
WHERE category_id = 1  -- å…ˆè¿‡æ»¤
  AND status = 'active'
ORDER BY embedding <=> $1  -- åæ’åº
LIMIT 10;

-- ä¼˜åŒ– 2: æ‰¹é‡æŸ¥è¯¢
WITH query_vectors AS (
    SELECT unnest(ARRAY[$1, $2, $3]) as query_vec
)
SELECT qv.query_vec, d.id, d.content, d.embedding <=> qv.query_vec as distance
FROM query_vectors qv
CROSS JOIN LATERAL (
    SELECT id, content, embedding
    FROM documents
    ORDER BY embedding <=> qv.query_vec
    LIMIT 10
) d;
```

---

## 6. æœ€ä½³å®è·µ

### 6.1 æ¨¡å‹è®¾è®¡å»ºè®®

**ç»´åº¦é€‰æ‹©æŒ‡å—**:

| Embedding æ¨¡å‹ | æ¨èç»´åº¦ | é€‚ç”¨åœºæ™¯ |
|---------------|---------|---------|
| OpenAI text-embedding-3-small | 1536 | é€šç”¨æ–‡æœ¬ |
| OpenAI text-embedding-3-large | 3072 | é«˜è´¨é‡æ–‡æœ¬ |
| sentence-transformers | 384-768 | è½»é‡çº§åº”ç”¨ |
| BERT | 768 | ä¸­æ–‡æ–‡æœ¬ |

**å…ƒæ•°æ®è®¾è®¡**:

```sql
-- æ¨è: ç»“æ„åŒ–å…ƒæ•°æ®
CREATE TABLE documents (
    id SERIAL PRIMARY KEY,
    content TEXT,
    embedding vector(1536),
    -- ç»“æ„åŒ–å…ƒæ•°æ®
    category_id INTEGER,
    author_id INTEGER,
    created_at TIMESTAMPTZ,
    -- JSONB å­˜å‚¨åŠ¨æ€å…ƒæ•°æ®
    metadata JSONB
);

-- åˆ›å»ºå¤åˆç´¢å¼•
CREATE INDEX ON documents (category_id, created_at DESC);
CREATE INDEX ON documents USING GIN (metadata);
```

### 6.2 ç´¢å¼•è®¾è®¡å»ºè®®

**ç´¢å¼•ç±»å‹é€‰æ‹©**:

| æ•°æ®è§„æ¨¡ | æ¨èç´¢å¼• | å‚æ•°é…ç½® | è¯´æ˜ |
|---------|---------|---------|------|
| < 100ä¸‡ | HNSW | m=16, ef_construction=64 | å°è§„æ¨¡æ•°æ® |
| 100ä¸‡-1000ä¸‡ | HNSW | m=16, ef_construction=100 | ä¸­ç­‰è§„æ¨¡æ•°æ® |
| > 1000ä¸‡ | IVFFlat | lists=1000 | å¤§è§„æ¨¡æ•°æ® |

**ç´¢å¼•å‚æ•°è°ƒä¼˜**:

```sql
-- HNSW å‚æ•°è°ƒä¼˜
-- m: æ§åˆ¶ç´¢å¼•å¤§å°å’ŒæŸ¥è¯¢é€Ÿåº¦ï¼ˆè¶Šå¤§è¶Šå¿«ï¼Œä½†ç´¢å¼•è¶Šå¤§ï¼‰
-- ef_construction: æ§åˆ¶ç´¢å¼•è´¨é‡ï¼ˆè¶Šå¤§è´¨é‡è¶Šé«˜ï¼Œä½†æ„å»ºè¶Šæ…¢ï¼‰

-- é«˜è´¨é‡ç´¢å¼•ï¼ˆé€‚åˆæŸ¥è¯¢æ€§èƒ½è¦æ±‚é«˜çš„åœºæ™¯ï¼‰
CREATE INDEX ON documents USING hnsw (embedding vector_cosine_ops)
WITH (m = 32, ef_construction = 200);

-- å¹³è¡¡ç´¢å¼•ï¼ˆæ¨èï¼‰
CREATE INDEX ON documents USING hnsw (embedding vector_cosine_ops)
WITH (m = 16, ef_construction = 64);

-- å¿«é€Ÿæ„å»ºç´¢å¼•ï¼ˆé€‚åˆå¿«é€ŸåŸå‹ï¼‰
CREATE INDEX ON documents USING hnsw (embedding vector_cosine_ops)
WITH (m = 8, ef_construction = 32);
```

### 6.3 æŸ¥è¯¢ä¼˜åŒ–å»ºè®®

**ç›¸ä¼¼åº¦å‡½æ•°é€‰æ‹©**:

| ç›¸ä¼¼åº¦å‡½æ•° | é€‚ç”¨åœºæ™¯ | æ€§èƒ½ |
|-----------|---------|------|
| ä½™å¼¦ç›¸ä¼¼åº¦ (<=>) | æ–‡æœ¬ç›¸ä¼¼åº¦ | ä¼˜ç§€ |
| å†…ç§¯ (<#>) | å½’ä¸€åŒ–å‘é‡ | ä¼˜ç§€ |
| æ¬§æ°è·ç¦» (<->) | è·ç¦»è®¡ç®— | è‰¯å¥½ |

**æŸ¥è¯¢ä¼˜åŒ–æŠ€å·§**:

1. **å…ˆè¿‡æ»¤åæ’åº**: ä½¿ç”¨ WHERE å­å¥å…ˆè¿‡æ»¤ï¼Œå‡å°‘å‘é‡è®¡ç®—é‡
2. **é™åˆ¶ç»“æœé›†**: ä½¿ç”¨ LIMIT é™åˆ¶è¿”å›ç»“æœæ•°é‡
3. **æ‰¹é‡æŸ¥è¯¢**: æ‰¹é‡æŸ¥è¯¢æ¯”å•æ¬¡æŸ¥è¯¢æ•ˆç‡é«˜ 3-5 å€

**å®é™…åº”ç”¨æ¡ˆä¾‹**:

#### æ¡ˆä¾‹: æŸç”µå•†å¹³å°å•†å“æ¨èç³»ç»Ÿ

**ä¸šåŠ¡åœºæ™¯**:

- å•†å“æ•°é‡: 1000 ä¸‡
- å‘é‡ç»´åº¦: 1536
- æŸ¥è¯¢ QPS: 5000

**å®æ–½æ•ˆæœ**:

- æŸ¥è¯¢å»¶è¿Ÿ: ä» 200ms é™ä½åˆ° 15msï¼ˆ**æå‡ 93%**ï¼‰
- æœç´¢å‡†ç¡®ç‡: æå‡ **20%**
- ç³»ç»Ÿæˆæœ¬: é™ä½ **40%**ï¼ˆç»Ÿä¸€æ•°æ®åº“ï¼‰

---

## 7. å‚è€ƒèµ„æ–™

### 7.1 å®˜æ–¹æ–‡æ¡£

- **[pgvector å®˜æ–¹æ–‡æ¡£](https://github.com/pgvector/pgvector)**
  - ç‰ˆæœ¬: pgvector 0.7.0+
  - å†…å®¹: pgvector æ‰©å±•çš„å®Œæ•´æ–‡æ¡£ï¼ŒåŒ…æ‹¬å®‰è£…ã€é…ç½®ã€ä½¿ç”¨ç¤ºä¾‹
  - GitHub: <https://github.com/pgvector/pgvector>

- **[PostgreSQL å‘é‡ç±»å‹æ–‡æ¡£](https://www.postgresql.org/docs/current/vector.html)**
  - ç‰ˆæœ¬: PostgreSQL 18+
  - å†…å®¹: PostgreSQL å†…ç½®å‘é‡ç±»å‹çš„å®˜æ–¹æ–‡æ¡£
  - æœ€åæ›´æ–°: 2025å¹´

- **[PostgreSQL æ•°æ®ç±»å‹æ–‡æ¡£](https://www.postgresql.org/docs/current/datatype.html)**
  - å†…å®¹: PostgreSQL æ‰€æœ‰æ•°æ®ç±»å‹çš„å®Œæ•´æ–‡æ¡£

### 7.2 å­¦æœ¯è®ºæ–‡

- **Malkov, Y. A., & Yashunin, D. A. (2018). "Efficient and robust approximate nearest neighbor search using Hierarchical Navigable Small World graphs."**
  - æœŸåˆŠ: IEEE transactions on pattern analysis and machine intelligence, 40(9), 2096-2108
  - **DOI**: [10.1109/TPAMI.2018.2889473](https://doi.org/10.1109/TPAMI.2018.2889473)
  - **é‡è¦æ€§**: HNSW ç®—æ³•çš„åŸå§‹è®ºæ–‡ï¼Œä¸ºå‘é‡ç´¢å¼•æä¾›äº†ç†è®ºåŸºç¡€

- **Johnson, J., Douze, M., & JÃ©gou, H. (2019). "Billion-scale similarity search with GPUs."**
  - æœŸåˆŠ: IEEE Transactions on Big Data, 7(3), 535-547
  - **arXiv**: [arXiv:1702.08734](https://arxiv.org/abs/1702.08734)
  - **é‡è¦æ€§**: å¤§è§„æ¨¡å‘é‡æœç´¢çš„æ€§èƒ½ä¼˜åŒ–ç ”ç©¶

### 7.3 æŠ€æœ¯åšå®¢

- **[å‘é‡æ•°æ®åº“å¯¹æ¯”ç ”ç©¶](https://www.pinecone.io/learn/vector-database/)**
  - æ¥æº: Pinecone
  - å†…å®¹: å‘é‡æ•°æ®åº“çš„å¯¹æ¯”åˆ†æå’Œé€‰å‹æŒ‡å—

- **[PostgreSQL å‘é‡æœç´¢æœ€ä½³å®è·µ](https://www.postgresql.org/docs/current/vector.html)**
  - å†…å®¹: PostgreSQL å‘é‡æœç´¢çš„ä½¿ç”¨æŠ€å·§å’Œæœ€ä½³å®è·µ

### 7.4 ç›¸å…³èµ„æº

- **[å‘é‡æ•°æ®åº“ç”Ÿæ€ç³»ç»Ÿ](https://github.com/currentsapi/awesome-vector-databases)**
  - å†…å®¹: å‘é‡æ•°æ®åº“ç›¸å…³çš„å·¥å…·ã€åº“å’Œèµ„æºé›†åˆ

- **[PostgreSQL æ‰©å±•å¼€å‘æŒ‡å—](https://www.postgresql.org/docs/current/extend.html)**
  - å†…å®¹: å¦‚ä½•å¼€å‘ PostgreSQL æ‰©å±•

---

## 8. å®Œæ•´ä»£ç ç¤ºä¾‹

### 8.1 å‘é‡è¡¨åˆ›å»ºä¸ç´¢å¼•

**åˆ›å»ºå‘é‡è¡¨**:

```sql
-- å®‰è£… pgvector æ‰©å±•
CREATE EXTENSION IF NOT EXISTS vector;

-- åˆ›å»ºæ–‡æ¡£å‘é‡è¡¨
CREATE TABLE documents (
    id SERIAL PRIMARY KEY,
    title TEXT NOT NULL,
    content TEXT,
    embedding vector(768),  -- 768 ç»´å‘é‡
    metadata JSONB,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- åˆ›å»º HNSW ç´¢å¼•
CREATE INDEX ON documents USING hnsw (embedding vector_cosine_ops)
WITH (m = 16, ef_construction = 64);

-- åˆ›å»º GIN ç´¢å¼•ç”¨äº JSONB æŸ¥è¯¢
CREATE INDEX ON documents USING GIN (metadata);
```

**Python å‘é‡æ•°æ®ç®¡ç†**:

```python
import psycopg2
from pgvector.psycopg2 import register_vector
import numpy as np
from typing import List, Dict

class VectorDataManager:
    """å‘é‡æ•°æ®ç®¡ç†å™¨"""

    def __init__(self, conn_str: str):
        self.conn = psycopg2.connect(conn_str)
        register_vector(self.conn)
        self.cur = self.conn.cursor()

    def insert_document(self, title: str, content: str, embedding: np.ndarray, metadata: Dict = None):
        """æ’å…¥æ–‡æ¡£å‘é‡"""
        self.cur.execute("""
            INSERT INTO documents (title, content, embedding, metadata)
            VALUES (%s, %s, %s, %s)
            RETURNING id
        """, (title, content, embedding.tolist(), json.dumps(metadata) if metadata else None))

        doc_id = self.cur.fetchone()[0]
        self.conn.commit()
        return doc_id

    def search_similar(self, query_vector: np.ndarray, limit: int = 10, threshold: float = 0.7) -> List[Dict]:
        """ç›¸ä¼¼åº¦æœç´¢"""
        self.cur.execute("""
            SELECT id, title, content, metadata,
                   1 - (embedding <=> %s) AS similarity
            FROM documents
            WHERE 1 - (embedding <=> %s) > %s
            ORDER BY embedding <=> %s
            LIMIT %s
        """, (query_vector.tolist(), query_vector.tolist(), threshold, query_vector.tolist(), limit))

        results = []
        for row in self.cur.fetchall():
            results.append({
                'id': row[0],
                'title': row[1],
                'content': row[2],
                'metadata': row[3],
                'similarity': float(row[4])
            })
        return results

    def batch_insert(self, documents: List[Dict]):
        """æ‰¹é‡æ’å…¥æ–‡æ¡£"""
        for doc in documents:
            self.insert_document(
                doc['title'],
                doc['content'],
                doc['embedding'],
                doc.get('metadata')
            )

    def close(self):
        """å…³é—­è¿æ¥"""
        self.cur.close()
        self.conn.close()

# ä½¿ç”¨ç¤ºä¾‹
manager = VectorDataManager("host=localhost dbname=testdb user=postgres password=secret")

# æ’å…¥æ–‡æ¡£
embedding = np.random.rand(768).astype(np.float32)
doc_id = manager.insert_document(
    title="ç¤ºä¾‹æ–‡æ¡£",
    content="è¿™æ˜¯æ–‡æ¡£å†…å®¹",
    embedding=embedding,
    metadata={"category": "tech", "author": "admin"}
)

# ç›¸ä¼¼åº¦æœç´¢
query_vector = np.random.rand(768).astype(np.float32)
results = manager.search_similar(query_vector, limit=10)
for result in results:
    print(f"æ–‡æ¡£: {result['title']}, ç›¸ä¼¼åº¦: {result['similarity']:.4f}")

manager.close()
```

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
