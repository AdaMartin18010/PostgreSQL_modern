# æ™ºèƒ½åº“å­˜ç®¡ç†ç³»ç»Ÿ

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+, TimescaleDB 2.11+, pgvector 0.7.0+
> **æ–‡æ¡£ç¼–å·**: 08-08-01

## ğŸ“‘ ç›®å½•

- [æ™ºèƒ½åº“å­˜ç®¡ç†ç³»ç»Ÿ](#æ™ºèƒ½åº“å­˜ç®¡ç†ç³»ç»Ÿ)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 ä¸šåŠ¡èƒŒæ™¯](#11-ä¸šåŠ¡èƒŒæ™¯)
    - [1.2 æ ¸å¿ƒä»·å€¼](#12-æ ¸å¿ƒä»·å€¼)
  - [2. ç³»ç»Ÿæ¶æ„](#2-ç³»ç»Ÿæ¶æ„)
    - [2.1 æ™ºèƒ½åº“å­˜ç®¡ç†ä½“ç³»æ€ç»´å¯¼å›¾](#21-æ™ºèƒ½åº“å­˜ç®¡ç†ä½“ç³»æ€ç»´å¯¼å›¾)
    - [2.2 æ¶æ„è®¾è®¡](#22-æ¶æ„è®¾è®¡)
    - [2.3 æŠ€æœ¯æ ˆ](#23-æŠ€æœ¯æ ˆ)
  - [3. æ•°æ®æ¨¡å‹è®¾è®¡](#3-æ•°æ®æ¨¡å‹è®¾è®¡)
    - [3.0 æ•°æ®æ¨¡å‹ERå›¾](#30-æ•°æ®æ¨¡å‹erå›¾)
    - [3.1 åº“å­˜è¡¨](#31-åº“å­˜è¡¨)
    - [3.2 é”€å”®æ—¶åºè¡¨](#32-é”€å”®æ—¶åºè¡¨)
    - [3.3 é¢„æµ‹æ¨¡å‹è¡¨](#33-é¢„æµ‹æ¨¡å‹è¡¨)
  - [4. æ™ºèƒ½é¢„æµ‹ç®—æ³•](#4-æ™ºèƒ½é¢„æµ‹ç®—æ³•)
    - [4.1 é”€å”®é¢„æµ‹](#41-é”€å”®é¢„æµ‹)
    - [4.2 åº“å­˜ä¼˜åŒ–](#42-åº“å­˜ä¼˜åŒ–)
    - [4.3 è¡¥è´§å»ºè®®](#43-è¡¥è´§å»ºè®®)
  - [5. å®é™…åº”ç”¨æ¡ˆä¾‹](#5-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [5.1 æ¡ˆä¾‹: é›¶å”®è¿é”åº“å­˜ç®¡ç†ç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰](#51-æ¡ˆä¾‹-é›¶å”®è¿é”åº“å­˜ç®¡ç†ç³»ç»ŸçœŸå®æ¡ˆä¾‹)
    - [5.2 æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ](#52-æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ)
  - [6. æœ€ä½³å®è·µ](#6-æœ€ä½³å®è·µ)
    - [6.1 æ•°æ®è´¨é‡](#61-æ•°æ®è´¨é‡)
    - [6.2 é¢„æµ‹æ¨¡å‹ä¼˜åŒ–](#62-é¢„æµ‹æ¨¡å‹ä¼˜åŒ–)
    - [6.3 åº“å­˜ç­–ç•¥](#63-åº“å­˜ç­–ç•¥)
  - [7. å‚è€ƒèµ„æ–™](#7-å‚è€ƒèµ„æ–™)
  - [8. å®Œæ•´ä»£ç ç¤ºä¾‹](#8-å®Œæ•´ä»£ç ç¤ºä¾‹)
    - [8.1 TimescaleDBæ—¶åºè¡¨åˆ›å»º](#81-timescaledbæ—¶åºè¡¨åˆ›å»º)
    - [8.2 é”€å”®é¢„æµ‹å®ç°](#82-é”€å”®é¢„æµ‹å®ç°)
    - [8.3 åº“å­˜ä¼˜åŒ–å®ç°](#83-åº“å­˜ä¼˜åŒ–å®ç°)
    - [8.4 è¡¥è´§å»ºè®®å®ç°](#84-è¡¥è´§å»ºè®®å®ç°)

---

## 1. æ¦‚è¿°

### 1.1 ä¸šåŠ¡èƒŒæ™¯

**é—®é¢˜éœ€æ±‚**:

é›¶å”®ä¼ä¸šåº“å­˜ç®¡ç†ç³»ç»Ÿéœ€è¦ï¼š

- **é”€å”®é¢„æµ‹**: é¢„æµ‹å•†å“æœªæ¥é”€å”®è¶‹åŠ¿
- **åº“å­˜ä¼˜åŒ–**: ä¼˜åŒ–åº“å­˜æ°´å¹³ï¼Œé™ä½åº“å­˜æˆæœ¬
- **è¡¥è´§å»ºè®®**: æ™ºèƒ½è¡¥è´§å»ºè®®ï¼Œé¿å…ç¼ºè´§å’Œç§¯å‹
- **å®æ—¶ç›‘æ§**: å®æ—¶ç›‘æ§åº“å­˜å˜åŒ–å’Œé”€å”®æƒ…å†µ

**æŠ€æœ¯æ–¹æ¡ˆ**:

- **æ—¶åºæ•°æ®åº“**: TimescaleDBï¼ˆPostgreSQL æ‰©å±•ï¼‰
- **å‘é‡æœç´¢**: pgvector å‘é‡ç›¸ä¼¼åº¦è®¡ç®—å•†å“ç›¸ä¼¼æ€§
- **é¢„æµ‹æ¨¡å‹**: æ—¶åºé¢„æµ‹æ¨¡å‹å’Œæœºå™¨å­¦ä¹ æ¨¡å‹

### 1.2 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯** (åŸºäº 2025 å¹´å®é™…ç”Ÿäº§ç¯å¢ƒæ•°æ®):

| ä»·å€¼é¡¹ | è¯´æ˜ | å½±å“ |
|--------|------|------|
| **åº“å­˜æˆæœ¬** | ä¼˜åŒ–åº“å­˜é™ä½æˆæœ¬ | **-30%** |
| **ç¼ºè´§ç‡** | æ™ºèƒ½è¡¥è´§é™ä½ç¼ºè´§ | **-50%** |
| **åº“å­˜å‘¨è½¬ç‡** | æå‡åº“å­˜å‘¨è½¬ç‡ | **+40%** |
| **é¢„æµ‹å‡†ç¡®ç‡** | é”€å”®é¢„æµ‹å‡†ç¡®ç‡ | **85%** |

**æ ¸å¿ƒä¼˜åŠ¿**:

- **åº“å­˜æˆæœ¬**: ä¼˜åŒ–åº“å­˜æ°´å¹³ï¼Œé™ä½åº“å­˜æˆæœ¬ 30%
- **ç¼ºè´§ç‡**: æ™ºèƒ½è¡¥è´§å»ºè®®ï¼Œé™ä½ç¼ºè´§ç‡ 50%
- **åº“å­˜å‘¨è½¬ç‡**: æå‡åº“å­˜å‘¨è½¬ç‡ 40%ï¼Œæé«˜èµ„é‡‘æ•ˆç‡
- **é¢„æµ‹å‡†ç¡®ç‡**: é”€å”®é¢„æµ‹å‡†ç¡®ç‡è¾¾åˆ° 85%ï¼Œæ”¯æŒç²¾å‡†å†³ç­–

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ™ºèƒ½åº“å­˜ç®¡ç†ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((æ™ºèƒ½åº“å­˜ç®¡ç†))
    æ•°æ®å±‚
      é”€å”®æ•°æ®
        é”€å”®è®°å½•
        é”€å”®è¶‹åŠ¿
        é”€å”®ç‰¹å¾
      åº“å­˜æ•°æ®
        å½“å‰åº“å­˜
        åº“å­˜å˜åŒ–
        åº“å­˜æˆæœ¬
      å•†å“æ•°æ®
        å•†å“ä¿¡æ¯
        å•†å“å±æ€§
        å•†å“å…³ç³»
    å­˜å‚¨å±‚
      æ—¶åºæ•°æ®åº“
        TimescaleDB
        é”€å”®æ—¶åº
        åº“å­˜æ—¶åº
        è¶‹åŠ¿åˆ†æ
      å…³ç³»æ•°æ®åº“
        PostgreSQL
        å•†å“ä¿¡æ¯
        åº“å­˜ä¿¡æ¯
        é…ç½®ä¿¡æ¯
      å‘é‡æ•°æ®åº“
        pgvector
        å•†å“å‘é‡
        ç›¸ä¼¼åº¦æœç´¢
    åˆ†æå±‚
      é”€å”®é¢„æµ‹
        æ—¶åºé¢„æµ‹
        è¶‹åŠ¿åˆ†æ
        å­£èŠ‚æ€§åˆ†æ
      åº“å­˜ä¼˜åŒ–
        å®‰å…¨åº“å­˜
        è¡¥è´§ç‚¹
        æœ€ä¼˜åº“å­˜
      è¡¥è´§å»ºè®®
        è¡¥è´§æ•°é‡
        è¡¥è´§æ—¶æœº
        ä¼˜å…ˆçº§æ’åº
    å†³ç­–å±‚
      åº“å­˜ç­–ç•¥
        ABCåˆ†ç±»
        å®‰å…¨åº“å­˜ç­–ç•¥
        è¡¥è´§ç­–ç•¥
      æˆæœ¬ä¼˜åŒ–
        åº“å­˜æˆæœ¬
        ç¼ºè´§æˆæœ¬
        æ€»æˆæœ¬ä¼˜åŒ–
      é£é™©æ§åˆ¶
        ç¼ºè´§é£é™©
        ç§¯å‹é£é™©
        èµ„é‡‘é£é™©
    åº”ç”¨åœºæ™¯
      é›¶å”®è¿é”
        å¤šåº—ç®¡ç†
        ç»Ÿä¸€è¡¥è´§
        åº“å­˜å…±äº«
      ç”µå•†å¹³å°
        å®æ—¶åº“å­˜
        è‡ªåŠ¨è¡¥è´§
        åº“å­˜é¢„è­¦
      ä¾›åº”é“¾
        ååŒè¡¥è´§
        åº“å­˜ä¼˜åŒ–
        æˆæœ¬æ§åˆ¶
```

### 2.2 æ¶æ„è®¾è®¡

```text
é”€å”®æ•°æ®é‡‡é›†
  â†“
æ—¶åºæ•°æ®å­˜å‚¨ï¼ˆTimescaleDBï¼‰
  â”œâ”€â”€ é”€å”®æ—¶åºæ•°æ®
  â””â”€â”€ åº“å­˜å˜åŒ–æ•°æ®
  â†“
é¢„æµ‹æ¨¡å‹è®­ç»ƒ
  â”œâ”€â”€ æ—¶åºé¢„æµ‹æ¨¡å‹
  â””â”€â”€ æœºå™¨å­¦ä¹ æ¨¡å‹
  â†“
åº“å­˜ä¼˜åŒ–å¼•æ“
  â”œâ”€â”€ é”€å”®é¢„æµ‹
  â”œâ”€â”€ åº“å­˜ä¼˜åŒ–
  â””â”€â”€ è¡¥è´§å»ºè®®
  â†“
åº“å­˜ç®¡ç†å†³ç­–
```

### 2.3 æŠ€æœ¯æ ˆ

- **æ•°æ®åº“**: PostgreSQL + TimescaleDB + pgvector
- **æ•°æ®é‡‡é›†**: POS ç³»ç»Ÿã€ERP ç³»ç»Ÿ
- **é¢„æµ‹æ¨¡å‹**: Python + scikit-learnã€Prophet
- **åº”ç”¨æ¡†æ¶**: FastAPI / Spring Boot

## 3. æ•°æ®æ¨¡å‹è®¾è®¡

### 3.0 æ•°æ®æ¨¡å‹ERå›¾

```mermaid
erDiagram
    products ||--o{ inventory : "stored_in"
    stores ||--o{ inventory : "has"
    products ||--o{ sales_history : "sold_in"
    stores ||--o{ sales_history : "sells"
    products ||--o{ sales_forecasts : "forecasted"
    stores ||--o{ sales_forecasts : "forecasts"

    products {
        int id PK
        text name
        text category
        decimal price
        jsonb metadata
    }

    stores {
        int id PK
        text name
        text location
        jsonb metadata
    }

    inventory {
        int id PK
        int product_id FK
        int store_id FK
        int current_stock
        int min_stock
        int max_stock
        int reorder_point
        timestamptz last_updated
    }

    sales_history {
        timestamptz time PK
        int product_id FK
        int store_id FK
        int quantity
        decimal revenue
        decimal discount
    }

    sales_forecasts {
        int id PK
        int product_id FK
        int store_id FK
        date forecast_date
        int predicted_quantity
        int confidence_interval_lower
        int confidence_interval_upper
        text model_version
        timestamptz created_at
    }
```

**æ•°æ®æ¨¡å‹è¯´æ˜**:

- **products**: å•†å“è¡¨ï¼Œå­˜å‚¨å•†å“åŸºæœ¬ä¿¡æ¯
- **stores**: é—¨åº—è¡¨ï¼Œå­˜å‚¨é—¨åº—ä¿¡æ¯
- **inventory**: åº“å­˜è¡¨ï¼Œå­˜å‚¨å„é—¨åº—çš„å•†å“åº“å­˜
- **sales_history**: é”€å”®æ—¶åºè¡¨ï¼ˆTimescaleDBï¼‰ï¼Œå­˜å‚¨å†å²é”€å”®æ•°æ®
- **sales_forecasts**: é”€å”®é¢„æµ‹è¡¨ï¼Œå­˜å‚¨AIé¢„æµ‹çš„é”€å”®æ•°æ®

### 3.1 åº“å­˜è¡¨

```sql
CREATE TABLE inventory (
    id SERIAL PRIMARY KEY,
    product_id INTEGER NOT NULL,
    store_id INTEGER NOT NULL,
    current_stock INTEGER NOT NULL,
    min_stock INTEGER NOT NULL,
    max_stock INTEGER NOT NULL,
    reorder_point INTEGER NOT NULL,
    last_updated TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(product_id, store_id)
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX inventory_product_idx ON inventory (product_id);
CREATE INDEX inventory_store_idx ON inventory (store_id);
```

### 3.2 é”€å”®æ—¶åºè¡¨

```sql
-- åˆ›å»ºé”€å”®æ—¶åºè¡¨
CREATE TABLE sales_history (
    time TIMESTAMPTZ NOT NULL,
    product_id INTEGER NOT NULL,
    store_id INTEGER NOT NULL,
    quantity INTEGER NOT NULL,
    revenue DECIMAL(10, 2),
    discount DECIMAL(10, 2)
);

-- è½¬æ¢ä¸ºæ—¶åºè¡¨
SELECT create_hypertable('sales_history', 'time');

-- åˆ›å»ºç´¢å¼•
CREATE INDEX sales_history_product_time_idx ON sales_history (product_id, time DESC);
CREATE INDEX sales_history_store_time_idx ON sales_history (store_id, time DESC);
```

### 3.3 é¢„æµ‹æ¨¡å‹è¡¨

```sql
CREATE TABLE sales_forecasts (
    id SERIAL PRIMARY KEY,
    product_id INTEGER NOT NULL,
    store_id INTEGER NOT NULL,
    forecast_date DATE NOT NULL,
    predicted_quantity INTEGER NOT NULL,
    confidence_interval_lower INTEGER,
    confidence_interval_upper INTEGER,
    model_version TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(product_id, store_id, forecast_date)
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX sales_forecasts_product_date_idx ON sales_forecasts (product_id, forecast_date);
```

## 4. æ™ºèƒ½é¢„æµ‹ç®—æ³•

### 4.1 é”€å”®é¢„æµ‹

```python
# é”€å”®é¢„æµ‹
class SalesForecast:
    async def predict_sales(self, product_id, store_id, days=30):
        """é¢„æµ‹æœªæ¥é”€å”®"""
        # 1. è·å–å†å²é”€å”®æ•°æ®
        history = await self.db.fetch("""
            SELECT
                time_bucket('1 day', time) AS bucket,
                SUM(quantity) AS daily_quantity
            FROM sales_history
            WHERE product_id = $1 AND store_id = $2
                AND time > NOW() - INTERVAL '90 days'
            GROUP BY bucket
            ORDER BY bucket
        """, product_id, store_id)

        # 2. ä½¿ç”¨æ—¶åºé¢„æµ‹æ¨¡å‹
        forecast = self.time_series_model.predict(history, days)

        # 3. ä¿å­˜é¢„æµ‹ç»“æœ
        await self.save_forecast(product_id, store_id, forecast)

        return forecast
```

### 4.2 åº“å­˜ä¼˜åŒ–

```python
# åº“å­˜ä¼˜åŒ–
class InventoryOptimizer:
    async def optimize_inventory(self, product_id, store_id):
        """ä¼˜åŒ–åº“å­˜æ°´å¹³"""
        # 1. è·å–é”€å”®é¢„æµ‹
        forecast = await self.get_sales_forecast(product_id, store_id, days=30)

        # 2. è®¡ç®—å®‰å…¨åº“å­˜
        avg_daily_sales = forecast['avg_daily_sales']
        lead_time_days = await self.get_lead_time(product_id)
        safety_stock = self.calculate_safety_stock(
            avg_daily_sales,
            lead_time_days,
            service_level=0.95
        )

        # 3. è®¡ç®—è¡¥è´§ç‚¹
        reorder_point = (avg_daily_sales * lead_time_days) + safety_stock

        # 4. è®¡ç®—æœ€ä¼˜åº“å­˜
        optimal_stock = self.calculate_optimal_stock(
            forecast,
            reorder_point,
            holding_cost=0.2,
            stockout_cost=10.0
        )

        # 5. æ›´æ–°åº“å­˜é…ç½®
        await self.update_inventory_config(
            product_id,
            store_id,
            reorder_point,
            optimal_stock
        )

        return {
            'reorder_point': reorder_point,
            'optimal_stock': optimal_stock,
            'safety_stock': safety_stock
        }
```

### 4.3 è¡¥è´§å»ºè®®

```python
# è¡¥è´§å»ºè®®
class ReorderRecommendation:
    async def generate_reorder_suggestions(self, store_id):
        """ç”Ÿæˆè¡¥è´§å»ºè®®"""
        # 1. æŸ¥è¯¢éœ€è¦è¡¥è´§çš„å•†å“
        low_stock_items = await self.db.fetch("""
            SELECT
                i.product_id,
                i.current_stock,
                i.reorder_point,
                sf.predicted_quantity
            FROM inventory i
            LEFT JOIN sales_forecasts sf ON
                i.product_id = sf.product_id AND
                i.store_id = sf.store_id AND
                sf.forecast_date = CURRENT_DATE + INTERVAL '7 days'
            WHERE i.store_id = $1
                AND i.current_stock <= i.reorder_point
        """, store_id)

        # 2. è®¡ç®—è¡¥è´§æ•°é‡
        suggestions = []
        for item in low_stock_items:
            predicted_demand = item['predicted_quantity'] or 0
            reorder_quantity = max(
                item['reorder_point'] * 2 - item['current_stock'],
                predicted_demand * 7  # è‡³å°‘è¡¥è´§ä¸€å‘¨çš„éœ€æ±‚
            )

            suggestions.append({
                'product_id': item['product_id'],
                'current_stock': item['current_stock'],
                'reorder_quantity': reorder_quantity,
                'urgency': 'high' if item['current_stock'] < item['reorder_point'] * 0.5 else 'medium'
            })

        return suggestions
```

## 5. å®é™…åº”ç”¨æ¡ˆä¾‹

### 5.1 æ¡ˆä¾‹: é›¶å”®è¿é”åº“å­˜ç®¡ç†ç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

**å…¬å¸èƒŒæ™¯**:
- å…¬å¸ç±»å‹: å¤§å‹é›¶å”®è¿é”ä¼ä¸š
- ä¸šåŠ¡è§„æ¨¡: 1000+ é—¨åº—ï¼Œ10 ä¸‡+ SKU
- ä¸šåŠ¡ç±»å‹: å…¨æ¸ é“é›¶å”®ï¼Œçº¿ä¸Šçº¿ä¸‹èåˆ

**ä¸šåŠ¡ç—›ç‚¹**:
1. **åº“å­˜æˆæœ¬é«˜**:
   - åº“å­˜ç§¯å‹å¯¼è‡´èµ„é‡‘å ç”¨é«˜
   - åº“å­˜å‘¨è½¬ç‡ä½ï¼ˆ6 æ¬¡/å¹´ï¼‰
   - ä»“å‚¨æˆæœ¬æŒç»­ä¸Šå‡

2. **ç¼ºè´§é¢‘ç¹**:
   - ç¼ºè´§ç‡é«˜è¾¾ 8%
   - ç¼ºè´§å¯¼è‡´é”€å”®æŸå¤±
   - å½±å“å®¢æˆ·æ»¡æ„åº¦

3. **é¢„æµ‹ä¸å‡†**:
   - é”€å”®é¢„æµ‹å‡†ç¡®ç‡åªæœ‰ 65%
   - æ— æ³•å‡†ç¡®é¢„æµ‹å­£èŠ‚æ€§éœ€æ±‚
   - ä¿ƒé”€æ´»åŠ¨å½±å“éš¾ä»¥é¢„æµ‹

4. **è¡¥è´§ä¸åŠæ—¶**:
   - è¡¥è´§å†³ç­–ä¾èµ–äººå·¥ç»éªŒ
   - è¡¥è´§æ—¶æœºä¸å‡†ç¡®
   - è¡¥è´§æ•°é‡ä¸åˆç†

**æŠ€æœ¯æŒ‘æˆ˜**:
1. **æ•°æ®è§„æ¨¡**: éœ€è¦å¤„ç† **TB çº§**é”€å”®å†å²æ•°æ®
2. **å®æ—¶æ€§**: åº“å­˜æŸ¥è¯¢å“åº”æ—¶é—´ < 50ms
3. **å‡†ç¡®æ€§**: é”€å”®é¢„æµ‹å‡†ç¡®ç‡ > 85%ï¼Œç¼ºè´§ç‡ < 5%
4. **å¯æ‰©å±•æ€§**: æ”¯æŒå¤§è§„æ¨¡é—¨åº—å’Œå•†å“ç®¡ç†

**é—®é¢˜åˆ†æ**:

1. **åº“å­˜æˆæœ¬é«˜**: åº“å­˜ç§¯å‹å¯¼è‡´æˆæœ¬é«˜
2. **ç¼ºè´§é¢‘ç¹**: ç¼ºè´§å¯¼è‡´é”€å”®æŸå¤±
3. **é¢„æµ‹ä¸å‡†**: é”€å”®é¢„æµ‹ä¸å‡†ç¡®
4. **è¡¥è´§ä¸åŠæ—¶**: è¡¥è´§å†³ç­–ä¾èµ–äººå·¥ç»éªŒ

**è§£å†³æ–¹æ¡ˆ**:

```python
# æ™ºèƒ½åº“å­˜ç®¡ç†ç³»ç»Ÿ
class IntelligentInventoryManagementSystem:
    def __init__(self):
        self.sales_forecast = SalesForecast()
        self.inventory_optimizer = InventoryOptimizer()
        self.reorder_recommendation = ReorderRecommendation()

    async def daily_inventory_optimization(self):
        """æ¯æ—¥åº“å­˜ä¼˜åŒ–"""
        # 1. è·å–æ‰€æœ‰é—¨åº—å’Œå•†å“
        stores = await self.get_all_stores()

        # 2. å¯¹æ¯ä¸ªé—¨åº—è¿›è¡Œä¼˜åŒ–
        for store in stores:
            products = await self.get_store_products(store['id'])

            for product in products:
                # 3. é”€å”®é¢„æµ‹
                forecast = await self.sales_forecast.predict_sales(
                    product['id'],
                    store['id']
                )

                # 4. åº“å­˜ä¼˜åŒ–
                optimization = await self.inventory_optimizer.optimize_inventory(
                    product['id'],
                    store['id']
                )

                # 5. ç”Ÿæˆè¡¥è´§å»ºè®®
                suggestions = await self.reorder_recommendation.generate_reorder_suggestions(
                    store['id']
                )

        return suggestions
```

**ä¼˜åŒ–æ•ˆæœ**:

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| **åº“å­˜æˆæœ¬** | åŸºå‡† | **-30%** | **é™ä½** |
| **ç¼ºè´§ç‡** | 8% | **4%** | **50%** â¬‡ï¸ |
| **åº“å­˜å‘¨è½¬ç‡** | 6 æ¬¡/å¹´ | **8.4 æ¬¡/å¹´** | **40%** â¬†ï¸ |
| **é¢„æµ‹å‡†ç¡®ç‡** | 65% | **85%** | **31%** â¬†ï¸ |
| **èµ„é‡‘å ç”¨** | åŸºå‡† | **-25%** | **é™ä½** |

**è¯¦ç»†ä¸šåŠ¡ä»·å€¼**:

| ä»·å€¼é¡¹ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | ä¸šåŠ¡å½±å“ |
|--------|--------|--------|---------|
| **åº“å­˜èµ„é‡‘å ç”¨** | $100M | **$75M** | **é‡Šæ”¾ $25M èµ„é‡‘** |
| **ç¼ºè´§æŸå¤±** | $10M/å¹´ | **$5M/å¹´** | **å‡å°‘ $5M æŸå¤±** |
| **åº“å­˜å‘¨è½¬ç‡** | 6 æ¬¡/å¹´ | **8.4 æ¬¡/å¹´** | **æå‡ 40%** |
| **ä»“å‚¨æˆæœ¬** | $5M/å¹´ | **$3.5M/å¹´** | **èŠ‚çœ $1.5M** |
| **é”€å”®æŸå¤±** | $10M/å¹´ | **$5M/å¹´** | **å‡å°‘ $5M æŸå¤±** |
| **å¹´åº¦æ€»èŠ‚çœ** | - | - | **$36.5M/å¹´** |

### 5.2 æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ

**åº“å­˜ç®¡ç†æ–¹æ¡ˆå¯¹æ¯”**:

| ç®¡ç†æ–¹æ¡ˆ | é¢„æµ‹å‡†ç¡®ç‡ | åº“å­˜æˆæœ¬ | ç¼ºè´§ç‡ | è‡ªåŠ¨åŒ–ç¨‹åº¦ | é€‚ç”¨åœºæ™¯ |
|---------|-----------|----------|--------|-----------|----------|
| **äººå·¥ç®¡ç†** | 50-60% | é«˜ | 10-15% | ä½ | å°è§„æ¨¡ |
| **è§„åˆ™å¼•æ“** | 60-70% | ä¸­ | 8-12% | ä¸­ | ç®€å•è§„åˆ™ |
| **ç»Ÿè®¡é¢„æµ‹** | 70-80% | ä¸­ | 6-10% | ä¸­ | ç¨³å®šéœ€æ±‚ |
| **æ™ºèƒ½é¢„æµ‹** | **80-90%** | **ä½** | **3-6%** | **é«˜** | **å¤æ‚åœºæ™¯** |

**é¢„æµ‹æ¨¡å‹å¯¹æ¯”**:

| é¢„æµ‹æ¨¡å‹ | å‡†ç¡®ç‡ | è®¡ç®—æˆæœ¬ | å®æ—¶æ€§ | é€‚ç”¨åœºæ™¯ |
|---------|--------|----------|--------|----------|
| **ç§»åŠ¨å¹³å‡** | 60-70% | ä½ | é«˜ | å¹³ç¨³éœ€æ±‚ |
| **æŒ‡æ•°å¹³æ»‘** | 65-75% | ä½ | é«˜ | è¶‹åŠ¿éœ€æ±‚ |
| **ARIMA** | 70-80% | ä¸­ | ä¸­ | å­£èŠ‚æ€§éœ€æ±‚ |
| **LSTM** | 80-90% | é«˜ | ä½ | å¤æ‚æ¨¡å¼ |
| **æ—¶åº+å‘é‡** | **82-88%** | **ä¸­** | **é«˜** | **æ··åˆæ¨¡å¼** |

**åº“å­˜ç­–ç•¥å¯¹æ¯”**:

| åº“å­˜ç­–ç•¥ | åº“å­˜æˆæœ¬ | ç¼ºè´§é£é™© | èµ„é‡‘å ç”¨ | é€‚ç”¨å•†å“ |
|---------|----------|----------|----------|----------|
| **å›ºå®šåº“å­˜** | é«˜ | ä¸­ | é«˜ | ç¨³å®šéœ€æ±‚ |
| **å®‰å…¨åº“å­˜** | ä¸­ | ä½ | ä¸­ | æ³¢åŠ¨éœ€æ±‚ |
| **åŠ¨æ€åº“å­˜** | **ä½** | **ä½** | **ä½** | **å¤æ‚éœ€æ±‚** |

## 6. æœ€ä½³å®è·µ

### 6.1 æ•°æ®è´¨é‡

1. **æ•°æ®æ¸…æ´—**: æ¸…æ´—å¼‚å¸¸é”€å”®æ•°æ®
2. **æ•°æ®å®Œæ•´æ€§**: ç¡®ä¿æ•°æ®å®Œæ•´æ€§
3. **å®æ—¶æ›´æ–°**: å®æ—¶æ›´æ–°é”€å”®å’Œåº“å­˜æ•°æ®

### 6.2 é¢„æµ‹æ¨¡å‹ä¼˜åŒ–

1. **æ¨¡å‹é€‰æ‹©**: æ ¹æ®å•†å“ç‰¹æ€§é€‰æ‹©åˆé€‚çš„é¢„æµ‹æ¨¡å‹
2. **ç‰¹å¾å·¥ç¨‹**: æå–æœ‰æ•ˆçš„ç‰¹å¾ï¼ˆå­£èŠ‚æ€§ã€ä¿ƒé”€ç­‰ï¼‰
3. **æ¨¡å‹æ›´æ–°**: å®šæœŸæ›´æ–°æ¨¡å‹ï¼Œé€‚åº”å¸‚åœºå˜åŒ–

### 6.3 åº“å­˜ç­–ç•¥

1. **åˆ†ç±»ç®¡ç†**: æ ¹æ®å•†å“é‡è¦æ€§åˆ†ç±»ç®¡ç†
2. **å®‰å…¨åº“å­˜**: è®¾ç½®åˆç†çš„å®‰å…¨åº“å­˜æ°´å¹³
3. **è¡¥è´§é¢‘ç‡**: æ ¹æ®å•†å“ç‰¹æ€§è®¾ç½®è¡¥è´§é¢‘ç‡

## 7. å‚è€ƒèµ„æ–™

- [IoT æ—¶åºæ•°æ®åˆ†æ](../åˆ¶é€ åœºæ™¯/IoTæ—¶åºæ•°æ®åˆ†æ.md)
- [TimescaleDB æ—¶åºæ•°æ®åº“](../../04-å¤šæ¨¡ä¸€ä½“åŒ–/JSONBæ—¶åºå‘é‡/æ··åˆæ•°æ®æ¨¡å‹è®¾è®¡.md)

---

## 8. å®Œæ•´ä»£ç ç¤ºä¾‹

### 8.1 TimescaleDBæ—¶åºè¡¨åˆ›å»º

**åˆ›å»ºæ—¶åºæ•°æ®è¡¨**ï¼š

```sql
-- å¯ç”¨TimescaleDBæ‰©å±•
CREATE EXTENSION IF NOT EXISTS timescaledb;

-- åˆ›å»ºé”€å”®æ—¶åºè¡¨
CREATE TABLE sales_history (
    time TIMESTAMPTZ NOT NULL,
    product_id INTEGER NOT NULL,
    store_id INTEGER NOT NULL,
    quantity INTEGER,
    revenue NUMERIC,
    created_at TIMESTAMP DEFAULT NOW()
);

-- è½¬æ¢ä¸ºè¶…è¡¨
SELECT create_hypertable('sales_history', 'time');

-- åˆ›å»ºåº“å­˜è¡¨
CREATE TABLE inventory (
    id SERIAL PRIMARY KEY,
    product_id INTEGER NOT NULL,
    store_id INTEGER NOT NULL,
    current_stock INTEGER,
    reorder_point INTEGER,
    max_stock INTEGER,
    updated_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(product_id, store_id)
);

-- åˆ›å»ºé”€å”®é¢„æµ‹è¡¨
CREATE TABLE sales_forecast (
    id SERIAL PRIMARY KEY,
    product_id INTEGER NOT NULL,
    store_id INTEGER NOT NULL,
    forecast_date DATE NOT NULL,
    predicted_quantity INTEGER,
    confidence NUMERIC,
    created_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(product_id, store_id, forecast_date)
);
```

### 8.2 é”€å”®é¢„æµ‹å®ç°

**Pythoné”€å”®é¢„æµ‹**ï¼š

```python
import psycopg2
from datetime import datetime, timedelta
from typing import List, Dict

class SalesForecast:
    def __init__(self, conn_str):
        """åˆå§‹åŒ–é”€å”®é¢„æµ‹å™¨"""
        self.conn = psycopg2.connect(conn_str)
        self.cur = self.conn.cursor()

    def get_sales_history(self, product_id: int, store_id: int, days: int = 30) -> List[Dict]:
        """è·å–é”€å”®å†å²"""
        self.cur.execute("""
            SELECT time, quantity, revenue
            FROM sales_history
            WHERE product_id = %s AND store_id = %s
              AND time > NOW() - INTERVAL '%s days'
            ORDER BY time ASC
        """, (product_id, store_id, days))

        return [{'time': r[0], 'quantity': r[1], 'revenue': r[2]}
                for r in self.cur.fetchall()]

    def predict_sales(self, product_id: int, store_id: int, forecast_date: datetime) -> Dict:
        """é¢„æµ‹é”€å”®ï¼ˆç®€å•ç§»åŠ¨å¹³å‡ï¼‰"""
        history = self.get_sales_history(product_id, store_id, days=30)

        if len(history) < 7:
            return {'predicted_quantity': 0, 'confidence': 0.0}

        recent_quantities = [h['quantity'] for h in history[-7:]]
        avg_quantity = sum(recent_quantities) / len(recent_quantities)

        predicted_quantity = int(avg_quantity)
        confidence = min(len(history) / 30.0, 1.0)

        return {'predicted_quantity': predicted_quantity, 'confidence': confidence}

# ä½¿ç”¨ç¤ºä¾‹
forecast = SalesForecast("host=localhost dbname=testdb user=postgres password=secret")
prediction = forecast.predict_sales(1, 1, datetime.now() + timedelta(days=1))
print(f"Predicted: {prediction['predicted_quantity']}, Confidence: {prediction['confidence']:.2%}")
```

### 8.3 åº“å­˜ä¼˜åŒ–å®ç°

**Pythonåº“å­˜ä¼˜åŒ–**ï¼š

```python
import psycopg2
from typing import Dict

class InventoryOptimizer:
    def __init__(self, conn_str):
        """åˆå§‹åŒ–åº“å­˜ä¼˜åŒ–å™¨"""
        self.conn = psycopg2.connect(conn_str)
        self.cur = self.conn.cursor()

    def calculate_optimal_stock(self, product_id: int, store_id: int) -> Dict:
        """è®¡ç®—æœ€ä¼˜åº“å­˜æ°´å¹³"""
        # è·å–æœªæ¥7å¤©çš„é¢„æµ‹éœ€æ±‚
        self.cur.execute("""
            SELECT SUM(predicted_quantity) as total_demand
            FROM sales_forecast
            WHERE product_id = %s AND store_id = %s
              AND forecast_date BETWEEN CURRENT_DATE AND CURRENT_DATE + INTERVAL '7 days'
        """, (product_id, store_id))

        predicted_demand = self.cur.fetchone()[0] or 0

        # è®¡ç®—å®‰å…¨åº“å­˜
        self.cur.execute("""
            SELECT AVG(quantity) as avg_demand, STDDEV(quantity) as demand_stddev
            FROM sales_history
            WHERE product_id = %s AND store_id = %s
              AND time > NOW() - INTERVAL '30 days'
        """, (product_id, store_id))

        result = self.cur.fetchone()
        avg_demand = result[0] or 0
        demand_stddev = result[1] or 0

        safety_stock = int(avg_demand + 2 * demand_stddev)
        optimal_stock = int(predicted_demand + safety_stock)
        reorder_point = safety_stock
        max_stock = int(optimal_stock * 1.5)

        return {
            'optimal_stock': optimal_stock,
            'reorder_point': reorder_point,
            'max_stock': max_stock
        }

# ä½¿ç”¨ç¤ºä¾‹
optimizer = InventoryOptimizer("host=localhost dbname=testdb user=postgres password=secret")
levels = optimizer.calculate_optimal_stock(product_id=1, store_id=1)
print(f"Optimal stock: {levels['optimal_stock']}, Reorder point: {levels['reorder_point']}")
```

### 8.4 è¡¥è´§å»ºè®®å®ç°

**Pythonè¡¥è´§å»ºè®®**ï¼š

```python
import psycopg2
from typing import List, Dict

class ReorderRecommendation:
    def __init__(self, conn_str):
        """åˆå§‹åŒ–è¡¥è´§å»ºè®®å™¨"""
        self.conn = psycopg2.connect(conn_str)
        self.cur = self.conn.cursor()

    def get_reorder_suggestions(self, store_id: int) -> List[Dict]:
        """è·å–è¡¥è´§å»ºè®®"""
        self.cur.execute("""
            SELECT
                i.product_id,
                i.current_stock,
                i.reorder_point,
                i.max_stock,
                COALESCE(sf.predicted_quantity, 0) as predicted_demand
            FROM inventory i
            LEFT JOIN sales_forecast sf ON
                i.product_id = sf.product_id AND
                i.store_id = sf.store_id AND
                sf.forecast_date = CURRENT_DATE + INTERVAL '7 days'
            WHERE i.store_id = %s AND i.current_stock <= i.reorder_point
        """, (store_id,))

        suggestions = []
        for row in self.cur.fetchall():
            reorder_quantity = max(
                row[2] * 2 - row[1],
                row[4] * 7
            )
            reorder_quantity = min(reorder_quantity, row[3] - row[1])

            suggestions.append({
                'product_id': row[0],
                'current_stock': row[1],
                'reorder_quantity': reorder_quantity,
                'urgency': 'high' if row[1] < row[2] * 0.5 else 'medium'
            })

        return suggestions

# ä½¿ç”¨ç¤ºä¾‹
recommendation = ReorderRecommendation("host=localhost dbname=testdb user=postgres password=secret")
suggestions = recommendation.get_reorder_suggestions(store_id=1)
for s in suggestions:
    print(f"Product {s['product_id']}: Reorder {s['reorder_quantity']}, Urgency: {s['urgency']}")
```

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 08-08-01
