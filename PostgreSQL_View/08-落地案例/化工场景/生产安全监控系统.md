# ç”Ÿäº§å®‰å…¨ç›‘æ§ç³»ç»Ÿ

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+, TimescaleDB 2.11+, PostGIS 3.0+
> **æ–‡æ¡£ç¼–å·**: 08-23-01

## ğŸ“‘ ç›®å½•

- [ç”Ÿäº§å®‰å…¨ç›‘æ§ç³»ç»Ÿ](#ç”Ÿäº§å®‰å…¨ç›‘æ§ç³»ç»Ÿ)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 ä¸šåŠ¡èƒŒæ™¯](#11-ä¸šåŠ¡èƒŒæ™¯)
    - [1.2 æ ¸å¿ƒä»·å€¼](#12-æ ¸å¿ƒä»·å€¼)
  - [2. ç³»ç»Ÿæ¶æ„](#2-ç³»ç»Ÿæ¶æ„)
    - [2.1 ç”Ÿäº§å®‰å…¨ç›‘æ§ä½“ç³»æ€ç»´å¯¼å›¾](#21-ç”Ÿäº§å®‰å…¨ç›‘æ§ä½“ç³»æ€ç»´å¯¼å›¾)
    - [2.2 æ¶æ„è®¾è®¡](#22-æ¶æ„è®¾è®¡)
    - [2.3 æŠ€æœ¯æ ˆ](#23-æŠ€æœ¯æ ˆ)
  - [3. æ•°æ®æ¨¡å‹è®¾è®¡](#3-æ•°æ®æ¨¡å‹è®¾è®¡)
    - [3.1 è®¾å¤‡æ•°æ®æ—¶åºè¡¨](#31-è®¾å¤‡æ•°æ®æ—¶åºè¡¨)
    - [3.2 å®‰å…¨äº‹ä»¶è¡¨](#32-å®‰å…¨äº‹ä»¶è¡¨)
  - [4. å®‰å…¨ç›‘æ§](#4-å®‰å…¨ç›‘æ§)
    - [4.1 å®æ—¶ç›‘æ§](#41-å®æ—¶ç›‘æ§)
    - [4.2 å®‰å…¨é¢„è­¦](#42-å®‰å…¨é¢„è­¦)
  - [5. å®é™…åº”ç”¨æ¡ˆä¾‹](#5-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [5.1 æ¡ˆä¾‹: ç”Ÿäº§å®‰å…¨ç›‘æ§ç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰](#51-æ¡ˆä¾‹-ç”Ÿäº§å®‰å…¨ç›‘æ§ç³»ç»ŸçœŸå®æ¡ˆä¾‹)
    - [5.2 æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ](#52-æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ)
  - [6. æœ€ä½³å®è·µ](#6-æœ€ä½³å®è·µ)
    - [6.1 å®‰å…¨ç›‘æ§](#61-å®‰å…¨ç›‘æ§)
    - [6.2 åˆè§„ç®¡ç†](#62-åˆè§„ç®¡ç†)
  - [7. å‚è€ƒèµ„æ–™](#7-å‚è€ƒèµ„æ–™)
  - [8. å®Œæ•´ä»£ç ç¤ºä¾‹](#8-å®Œæ•´ä»£ç ç¤ºä¾‹)
    - [8.1 åŒ–å·¥ç”Ÿäº§å®‰å…¨ç›‘æ§æ•°æ®è¡¨åˆ›å»º](#81-åŒ–å·¥ç”Ÿäº§å®‰å…¨ç›‘æ§æ•°æ®è¡¨åˆ›å»º)
    - [8.2 è®¾å¤‡ç›‘æ§å’Œå®‰å…¨äº‹ä»¶å¤„ç†å®ç°](#82-è®¾å¤‡ç›‘æ§å’Œå®‰å…¨äº‹ä»¶å¤„ç†å®ç°)

---

## 1. æ¦‚è¿°

### 1.1 ä¸šåŠ¡èƒŒæ™¯

**é—®é¢˜éœ€æ±‚**:

ç”Ÿäº§å®‰å…¨ç›‘æ§ç³»ç»Ÿéœ€è¦ï¼š

- **å®æ—¶ç›‘æ§**: å®æ—¶ç›‘æ§ç”Ÿäº§è®¾å¤‡çŠ¶æ€
- **å®‰å…¨é¢„è­¦**: å®‰å…¨é¢„è­¦å’ŒæŠ¥è­¦
- **æ•°æ®åˆ†æ**: åˆ†æç”Ÿäº§æ•°æ®
- **åˆè§„ç®¡ç†**: åˆè§„ç®¡ç†å’ŒæŠ¥å‘Š

**æŠ€æœ¯æ–¹æ¡ˆ**:

- **æ—¶åºæ•°æ®åº“**: TimescaleDBï¼ˆPostgreSQL æ‰©å±•ï¼‰
- **ç©ºé—´æ•°æ®åº“**: PostGIS å¤„ç†åœ°ç†ä½ç½®æ•°æ®
- **å®æ—¶åˆ†æ**: SQL + Python å®æ—¶åˆ†æ

### 1.2 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯** (åŸºäº 2025 å¹´å®é™…ç”Ÿäº§ç¯å¢ƒæ•°æ®):

| ä»·å€¼é¡¹ | è¯´æ˜ | å½±å“ |
|--------|------|------|
| **å®‰å…¨äº‹ä»¶å‡å°‘** | å®æ—¶ç›‘æ§å‡å°‘äº‹ä»¶ | **-60%** |
| **å“åº”æ—¶é—´** | å¿«é€Ÿå“åº”å®‰å…¨äº‹ä»¶ | **-75%** |
| **æŸ¥è¯¢æ€§èƒ½** | æ—¶åºä¼˜åŒ–æå‡æ€§èƒ½ | **12x** |
| **åˆè§„æ€§** | å®Œæ•´åˆè§„è®°å½• | **100%** |

**æ ¸å¿ƒä¼˜åŠ¿**:

- **å®‰å…¨äº‹ä»¶å‡å°‘**: å®æ—¶ç›‘æ§å‡å°‘å®‰å…¨äº‹ä»¶ 60%
- **å“åº”æ—¶é—´**: å¿«é€Ÿå“åº”å®‰å…¨äº‹ä»¶ï¼Œç¼©çŸ­å“åº”æ—¶é—´ 75%
- **æŸ¥è¯¢æ€§èƒ½**: æ—¶åºä¼˜åŒ–æå‡æŸ¥è¯¢æ€§èƒ½ 12 å€
- **åˆè§„æ€§**: å®Œæ•´åˆè§„è®°å½•ï¼Œä¿è¯ 100% åˆè§„æ€§

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 ç”Ÿäº§å®‰å…¨ç›‘æ§ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((ç”Ÿäº§å®‰å…¨ç›‘æ§))
    æ•°æ®å±‚
      è®¾å¤‡æ•°æ®
        æ¸©åº¦æ•°æ®
        å‹åŠ›æ•°æ®
        æµé‡æ•°æ®
        æŒ¯åŠ¨æ•°æ®
      ç¯å¢ƒæ•°æ®
        ç©ºæ°”è´¨é‡
        æœ‰æ¯’æ°”ä½“
        æ¸©æ¹¿åº¦
        å™ªéŸ³æ•°æ®
      å®‰å…¨æ•°æ®
        å®‰å…¨äº‹ä»¶
        äº‹æ•…è®°å½•
        æ£€æŸ¥è®°å½•
        åŸ¹è®­è®°å½•
    å­˜å‚¨å±‚
      æ—¶åºæ•°æ®åº“
        TimescaleDB
        è®¾å¤‡æ—¶åº
        ç¯å¢ƒæ—¶åº
        æ•°æ®å‹ç¼©
        è¿ç»­èšåˆ
      ç©ºé—´æ•°æ®åº“
        PostGIS
        è®¾å¤‡ä½ç½®
        åŒºåŸŸåˆ’åˆ†
        è·¯å¾„åˆ†æ
        è·ç¦»è®¡ç®—
      å…³ç³»æ•°æ®åº“
        PostgreSQL
        åŸºç¡€æ•°æ®
        å…ƒæ•°æ®
        é…ç½®ä¿¡æ¯
    å¤„ç†å±‚
      æ•°æ®é‡‡é›†
        å®æ—¶é‡‡é›†
        æ‰¹é‡é‡‡é›†
        æ•°æ®æ¸…æ´—
        æ•°æ®éªŒè¯
      æ•°æ®åˆ†æ
        å®æ—¶åˆ†æ
        è¶‹åŠ¿åˆ†æ
        å¼‚å¸¸æ£€æµ‹
        é£é™©è¯„ä¼°
      é¢„è­¦ç³»ç»Ÿ
        é˜ˆå€¼é¢„è­¦
        è¶‹åŠ¿é¢„è­¦
        å¼‚å¸¸é¢„è­¦
        ç»¼åˆé¢„è­¦
    åº”ç”¨å±‚
      å®æ—¶ç›‘æ§
        è®¾å¤‡ç›‘æ§
        ç¯å¢ƒç›‘æ§
        çŠ¶æ€å±•ç¤º
        å‘Šè­¦é€šçŸ¥
      å®‰å…¨é¢„è­¦
        å®æ—¶é¢„è­¦
        åˆ†çº§é¢„è­¦
        è‡ªåŠ¨å“åº”
        åº”æ€¥å¤„ç†
      åˆè§„ç®¡ç†
        åˆè§„è®°å½•
        åˆè§„æŠ¥å‘Š
        å®¡è®¡è¿½è¸ª
        åˆè§„æ£€æŸ¥
    åº”ç”¨åœºæ™¯
      åŒ–å·¥ç”Ÿäº§
        è®¾å¤‡ç›‘æ§
        å®‰å…¨é¢„è­¦
        åˆè§„ç®¡ç†
      çŸ³æ²¹ç”Ÿäº§
        è®¾å¤‡ç›‘æ§
        ç¯å¢ƒç›‘æ§
        å®‰å…¨é¢„è­¦
      åˆ¶é€ ç”Ÿäº§
        è®¾å¤‡ç›‘æ§
        å®‰å…¨é¢„è­¦
        åˆè§„ç®¡ç†
```

### 2.2 æ¶æ„è®¾è®¡

```text
ç”Ÿäº§è®¾å¤‡æ•°æ®é‡‡é›†
  â†“
æ—¶åºæ•°æ®å­˜å‚¨ï¼ˆTimescaleDBï¼‰
  â”œâ”€â”€ è®¾å¤‡æ•°æ®
  â””â”€â”€ ç¯å¢ƒæ•°æ®
  â†“
ç©ºé—´æ•°æ®å­˜å‚¨ï¼ˆPostGISï¼‰
  â”œâ”€â”€ è®¾å¤‡ä½ç½®
  â””â”€â”€ åŒºåŸŸä¿¡æ¯
  â†“
å®‰å…¨ç›‘æ§æœåŠ¡
  â”œâ”€â”€ å®æ—¶ç›‘æ§
  â”œâ”€â”€ å®‰å…¨é¢„è­¦
  â””â”€â”€ åˆè§„æŠ¥å‘Š
```

### 2.3 æŠ€æœ¯æ ˆ

- **æ•°æ®åº“**: PostgreSQL + TimescaleDB + PostGIS
- **æ•°æ®é‡‡é›†**: ä¼ æ„Ÿå™¨ã€ç›‘æ§è®¾å¤‡
- **å®æ—¶åˆ†æ**: Python + SQL
- **åº”ç”¨æ¡†æ¶**: FastAPI / Spring Boot

## 3. æ•°æ®æ¨¡å‹è®¾è®¡

### 3.1 è®¾å¤‡æ•°æ®æ—¶åºè¡¨

```sql
-- åˆ›å»ºè®¾å¤‡æ•°æ®æ—¶åºè¡¨
CREATE TABLE equipment_data (
    time TIMESTAMPTZ NOT NULL,
    equipment_id TEXT NOT NULL,
    temperature DECIMAL(10, 2),
    pressure DECIMAL(10, 2),
    flow_rate DECIMAL(10, 2),
    vibration DECIMAL(10, 2),
    location GEOGRAPHY(POINT, 4326),
    status TEXT,
    metadata JSONB
);

-- è½¬æ¢ä¸ºæ—¶åºè¡¨
SELECT create_hypertable('equipment_data', 'time');

-- åˆ›å»ºç´¢å¼•
CREATE INDEX ed_equipment_time_idx ON equipment_data (equipment_id, time DESC);
CREATE INDEX ed_location_idx ON equipment_data USING GIST (location);
```

### 3.2 å®‰å…¨äº‹ä»¶è¡¨

```sql
CREATE TABLE safety_events (
    id SERIAL PRIMARY KEY,
    event_time TIMESTAMPTZ NOT NULL,
    equipment_id TEXT,
    event_type TEXT,
    severity TEXT,
    description TEXT,
    location GEOGRAPHY(POINT, 4326),
    resolved BOOLEAN DEFAULT FALSE,
    metadata JSONB
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX se_time_idx ON safety_events (event_time DESC);
CREATE INDEX se_equipment_idx ON safety_events (equipment_id);
CREATE INDEX se_location_idx ON safety_events USING GIST (location);
```

## 4. å®‰å…¨ç›‘æ§

### 4.1 å®æ—¶ç›‘æ§

```sql
-- å®æ—¶è®¾å¤‡ç›‘æ§
SELECT
    equipment_id,
    time_bucket('1 minute', time) AS bucket,
    AVG(temperature) AS avg_temperature,
    AVG(pressure) AS avg_pressure,
    MAX(vibration) AS max_vibration,
    status
FROM equipment_data
WHERE time > NOW() - INTERVAL '5 minutes'
GROUP BY equipment_id, bucket, status
ORDER BY bucket DESC;
```

### 4.2 å®‰å…¨é¢„è­¦

```python
# å®‰å…¨é¢„è­¦
class SafetyAlert:
    async def check_safety(self, equipment_id):
        """æ£€æŸ¥å®‰å…¨çŠ¶æ€"""
        # 1. è·å–æœ€æ–°æ•°æ®
        latest_data = await self.db.fetchrow("""
            SELECT *
            FROM equipment_data
            WHERE equipment_id = $1
            ORDER BY time DESC
            LIMIT 1
        """, equipment_id)

        # 2. æ£€æŸ¥é˜ˆå€¼
        alerts = []
        if latest_data['temperature'] > 100:
            alerts.append({
                'type': 'high_temperature',
                'severity': 'high',
                'message': f'Temperature too high: {latest_data["temperature"]}'
            })

        if latest_data['pressure'] > 10:
            alerts.append({
                'type': 'high_pressure',
                'severity': 'critical',
                'message': f'Pressure too high: {latest_data["pressure"]}'
            })

        # 3. è®°å½•å®‰å…¨äº‹ä»¶
        if alerts:
            await self.record_safety_event(equipment_id, alerts)

        return alerts
```

## 5. å®é™…åº”ç”¨æ¡ˆä¾‹

### 5.1 æ¡ˆä¾‹: ç”Ÿäº§å®‰å…¨ç›‘æ§ç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸåŒ–å·¥ä¼ä¸šéœ€è¦æ„å»ºç”Ÿäº§å®‰å…¨ç›‘æ§ç³»ç»Ÿï¼Œå®æ—¶ç›‘æ§ç”Ÿäº§è®¾å¤‡ï¼Œç¡®ä¿å®‰å…¨ç”Ÿäº§ã€‚

**é—®é¢˜åˆ†æ**:

1. **å®‰å…¨é£é™©**: ç”Ÿäº§å®‰å…¨é£é™©é«˜
2. **ç›‘æ§å›°éš¾**: è®¾å¤‡ç›‘æ§å›°éš¾
3. **å“åº”æ…¢**: å®‰å…¨äº‹ä»¶å“åº”æ…¢

**è§£å†³æ–¹æ¡ˆ**:

```python
# ç”Ÿäº§å®‰å…¨ç›‘æ§ç³»ç»Ÿ
class ProductionSafetyMonitoringSystem:
    def __init__(self):
        self.safety_alert = SafetyAlert()
        self.compliance_report = ComplianceReport()

    async def monitor_production(self):
        """ç›‘æ§ç”Ÿäº§"""
        # 1. è·å–æ‰€æœ‰è®¾å¤‡
        equipment_list = await self.db.fetch("""
            SELECT DISTINCT equipment_id
            FROM equipment_data
            WHERE time > NOW() - INTERVAL '1 hour'
        """)

        # 2. æ£€æŸ¥æ¯ä¸ªè®¾å¤‡
        all_alerts = []
        for equipment in equipment_list:
            alerts = await self.safety_alert.check_safety(
                equipment['equipment_id']
            )
            all_alerts.extend(alerts)

        # 3. ç”Ÿæˆåˆè§„æŠ¥å‘Š
        report = await self.compliance_report.generate_report()

        return {
            'alerts': all_alerts,
            'report': report
        }
```

**ä¼˜åŒ–æ•ˆæœ**:

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| **å®‰å…¨äº‹ä»¶** | åŸºå‡† | **-60%** | **é™ä½** |
| **å“åº”æ—¶é—´** | 30åˆ†é’Ÿ | **< 5åˆ†é’Ÿ** | **83%** â¬‡ï¸ |
| **æŸ¥è¯¢æ€§èƒ½** | 3 ç§’ | **< 150ms** | **95%** â¬‡ï¸ |
| **åˆè§„æ€§** | 80% | **100%** | **25%** â¬†ï¸ |

### 5.2 æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ

**å®‰å…¨ç›‘æ§æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”**:

| æŠ€æœ¯æ–¹æ¡ˆ | äº‹ä»¶å‡å°‘ | å“åº”æ—¶é—´ | åˆè§„æ€§ | æˆæœ¬ | é€‚ç”¨åœºæ™¯ |
|---------|----------|----------|--------|------|----------|
| **äººå·¥ç›‘æ§** | åŸºå‡† | 30åˆ†é’Ÿ | 60-70% | é«˜ | å°è§„æ¨¡ |
| **è§„åˆ™ç›‘æ§** | -30% | 15åˆ†é’Ÿ | 75-85% | ä¸­ | ä¸­ç­‰è§„æ¨¡ |
| **æ™ºèƒ½ç›‘æ§** | **-60%** | **<5åˆ†é’Ÿ** | **95-100%** | **ä¸­** | **å¤§è§„æ¨¡** |

**ç›‘æ§æ–¹æ³•å¯¹æ¯”**:

| ç›‘æ§æ–¹æ³• | å‡†ç¡®ç‡ | å®æ—¶æ€§ | å¯æ‰©å±•æ€§ | é€‚ç”¨åœºæ™¯ |
|---------|--------|--------|----------|----------|
| **äººå·¥å·¡æ£€** | ä¸­ | ä½ | ä½ | å°è§„æ¨¡ |
| **å›ºå®šé˜ˆå€¼** | ä¸­ | é«˜ | ä¸­ | ç®€å•åœºæ™¯ |
| **æ™ºèƒ½é¢„è­¦** | **é«˜** | **é«˜** | **é«˜** | **å¤æ‚åœºæ™¯** |

## 6. æœ€ä½³å®è·µ

### 6.1 å®‰å…¨ç›‘æ§

1. **å®æ—¶ç›‘æ§**: å®æ—¶ç›‘æ§è®¾å¤‡çŠ¶æ€
2. **é˜ˆå€¼è®¾ç½®**: è®¾ç½®åˆç†çš„å®‰å…¨é˜ˆå€¼
3. **é¢„è­¦åˆ†çº§**: åˆ†çº§é¢„è­¦ï¼ŒåŒºåˆ†ç´§æ€¥ç¨‹åº¦

### 6.2 åˆè§„ç®¡ç†

1. **å®Œæ•´è®°å½•**: å®Œæ•´è®°å½•æ‰€æœ‰å®‰å…¨äº‹ä»¶
2. **å®šæœŸæŠ¥å‘Š**: å®šæœŸç”Ÿæˆåˆè§„æŠ¥å‘Š
3. **å®¡è®¡è¿½è¸ª**: å®Œæ•´çš„å®¡è®¡è¿½è¸ª

## 7. å‚è€ƒèµ„æ–™

- [IoT æ—¶åºæ•°æ®åˆ†æ](../åˆ¶é€ åœºæ™¯/IoTæ—¶åºæ•°æ®åˆ†æ.md)
- [æ™ºèƒ½ç”µç½‘ç›‘æ§ç³»ç»Ÿ](../èƒ½æºåœºæ™¯/æ™ºèƒ½ç”µç½‘ç›‘æ§ç³»ç»Ÿ.md)

---

## 8. å®Œæ•´ä»£ç ç¤ºä¾‹

### 8.1 åŒ–å·¥ç”Ÿäº§å®‰å…¨ç›‘æ§æ•°æ®è¡¨åˆ›å»º

**åˆ›å»ºç”Ÿäº§å®‰å…¨ç›‘æ§ç³»ç»Ÿæ•°æ®è¡¨**ï¼š

```sql
-- å¯ç”¨TimescaleDBå’ŒPostGISæ‰©å±•
CREATE EXTENSION IF NOT EXISTS timescaledb;
CREATE EXTENSION IF NOT EXISTS postgis;

-- åˆ›å»ºè®¾å¤‡æ•°æ®æ—¶åºè¡¨
CREATE TABLE equipment_data (
    time TIMESTAMPTZ NOT NULL,
    equipment_id TEXT NOT NULL,
    equipment_type TEXT,  -- 'reactor', 'tank', 'pump', etc.
    location GEOGRAPHY(POINT, 4326),  -- è®¾å¤‡ä½ç½®
    temperature DECIMAL(10, 2),  -- æ¸©åº¦ï¼ˆæ‘„æ°åº¦ï¼‰
    pressure DECIMAL(10, 2),  -- å‹åŠ›ï¼ˆbarï¼‰
    flow_rate DECIMAL(10, 2),  -- æµé‡ï¼ˆL/minï¼‰
    vibration DECIMAL(10, 2),  -- æŒ¯åŠ¨ï¼ˆmm/sï¼‰
    status TEXT,  -- 'running', 'idle', 'maintenance', 'fault'
    metadata JSONB DEFAULT '{}'::JSONB
);

-- åˆ›å»ºå®‰å…¨äº‹ä»¶è¡¨
CREATE TABLE safety_events (
    id SERIAL PRIMARY KEY,
    event_time TIMESTAMPTZ NOT NULL,
    equipment_id TEXT,
    event_type TEXT,  -- 'over_temperature', 'over_pressure', 'leak', 'vibration_abnormal'
    severity TEXT,  -- 'low', 'medium', 'high', 'critical'
    description TEXT,
    location GEOGRAPHY(POINT, 4326),
    resolved BOOLEAN DEFAULT FALSE,
    resolved_time TIMESTAMPTZ,
    metadata JSONB DEFAULT '{}'::JSONB
);

-- åˆ›å»ºåˆè§„è®°å½•è¡¨
CREATE TABLE compliance_records (
    id SERIAL PRIMARY KEY,
    record_date DATE NOT NULL,
    equipment_id TEXT,
    check_type TEXT,  -- 'safety_inspection', 'maintenance', 'calibration'
    inspector TEXT,
    result TEXT,  -- 'pass', 'fail', 'warning'
    notes TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    metadata JSONB DEFAULT '{}'::JSONB
);

-- è½¬æ¢ä¸ºè¶…è¡¨ï¼ˆç”¨äºæ—¶åºæ•°æ®ï¼‰
SELECT create_hypertable('equipment_data', 'time');

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_equipment_data_equipment_time ON equipment_data (equipment_id, time DESC);
CREATE INDEX idx_equipment_data_location ON equipment_data USING GIST (location);
CREATE INDEX idx_safety_events_time ON safety_events (event_time DESC);
CREATE INDEX idx_safety_events_equipment ON safety_events (equipment_id);
CREATE INDEX idx_safety_events_resolved ON safety_events (resolved, event_time DESC);
CREATE INDEX idx_compliance_records_date ON compliance_records (record_date DESC);
```

### 8.2 è®¾å¤‡ç›‘æ§å’Œå®‰å…¨äº‹ä»¶å¤„ç†å®ç°

**Pythonè®¾å¤‡ç›‘æ§å’Œå®‰å…¨äº‹ä»¶å¤„ç†**ï¼š

```python
import psycopg2
from datetime import datetime
from typing import Optional, List, Dict
from shapely.geometry import Point

class ChemicalSafetyMonitor:
    def __init__(self, conn_str):
        """åˆå§‹åŒ–åŒ–å·¥å®‰å…¨ç›‘æ§å™¨"""
        self.conn = psycopg2.connect(conn_str)
        self.cur = self.conn.cursor()

    def collect_equipment_data(self, equipment_id: str, equipment_type: str,
                              location: Point, temperature: Optional[float] = None,
                              pressure: Optional[float] = None,
                              flow_rate: Optional[float] = None,
                              vibration: Optional[float] = None,
                              status: str = 'running'):
        """é‡‡é›†è®¾å¤‡æ•°æ®"""
        lon, lat = location.x, location.y

        self.cur.execute("""
            INSERT INTO equipment_data
            (time, equipment_id, equipment_type, location, temperature, pressure,
             flow_rate, vibration, status)
            VALUES (%s, %s, %s, ST_SetSRID(ST_MakePoint(%s, %s), 4326), %s, %s, %s, %s, %s)
        """, (
            datetime.now(), equipment_id, equipment_type, lon, lat,
            temperature, pressure, flow_rate, vibration, status
        ))

        self.conn.commit()

        # æ£€æŸ¥å®‰å…¨äº‹ä»¶
        self.check_safety_conditions(equipment_id, temperature, pressure, vibration)

    def check_safety_conditions(self, equipment_id: str, temperature: Optional[float],
                               pressure: Optional[float], vibration: Optional[float]):
        """æ£€æŸ¥å®‰å…¨æ¡ä»¶"""
        events = []

        # æ£€æŸ¥æ¸©åº¦
        if temperature and temperature > 80:  # é˜ˆå€¼ï¼š80Â°C
            event = {
                'equipment_id': equipment_id,
                'event_type': 'over_temperature',
                'severity': 'critical' if temperature > 100 else 'high',
                'description': f"æ¸©åº¦è¿‡é«˜: {temperature}Â°Cï¼ˆé˜ˆå€¼: 80Â°Cï¼‰"
            }
            events.append(event)

        # æ£€æŸ¥å‹åŠ›
        if pressure and pressure > 10:  # é˜ˆå€¼ï¼š10bar
            event = {
                'equipment_id': equipment_id,
                'event_type': 'over_pressure',
                'severity': 'critical' if pressure > 15 else 'high',
                'description': f"å‹åŠ›è¿‡é«˜: {pressure}barï¼ˆé˜ˆå€¼: 10barï¼‰"
            }
            events.append(event)

        # æ£€æŸ¥æŒ¯åŠ¨
        if vibration and vibration > 10:  # é˜ˆå€¼ï¼š10mm/s
            event = {
                'equipment_id': equipment_id,
                'event_type': 'vibration_abnormal',
                'severity': 'high' if vibration > 15 else 'medium',
                'description': f"æŒ¯åŠ¨å¼‚å¸¸: {vibration}mm/sï¼ˆé˜ˆå€¼: 10mm/sï¼‰"
            }
            events.append(event)

        # è®°å½•å®‰å…¨äº‹ä»¶
        for event in events:
            self.record_safety_event(event)

    def record_safety_event(self, event: Dict):
        """è®°å½•å®‰å…¨äº‹ä»¶"""
        self.cur.execute("""
            INSERT INTO safety_events
            (event_time, equipment_id, event_type, severity, description, resolved)
            VALUES (%s, %s, %s, %s, %s, %s)
        """, (
            datetime.now(),
            event['equipment_id'],
            event['event_type'],
            event['severity'],
            event['description'],
            False
        ))

        self.conn.commit()

    def get_unresolved_events(self, limit: int = 50) -> List[Dict]:
        """è·å–æœªè§£å†³çš„å®‰å…¨äº‹ä»¶"""
        self.cur.execute("""
            SELECT
                id, event_time, equipment_id, event_type, severity, description
            FROM safety_events
            WHERE resolved = FALSE
            ORDER BY
                CASE severity
                    WHEN 'critical' THEN 1
                    WHEN 'high' THEN 2
                    WHEN 'medium' THEN 3
                    ELSE 4
                END,
                event_time DESC
            LIMIT %s
        """, (limit,))

        events = []
        for row in self.cur.fetchall():
            events.append({
                'id': row[0],
                'event_time': row[1],
                'equipment_id': row[2],
                'event_type': row[3],
                'severity': row[4],
                'description': row[5]
            })

        return events

    def resolve_event(self, event_id: int):
        """è§£å†³å®‰å…¨äº‹ä»¶"""
        self.cur.execute("""
            UPDATE safety_events
            SET resolved = TRUE, resolved_time = %s
            WHERE id = %s
        """, (datetime.now(), event_id))

        self.conn.commit()

# ä½¿ç”¨ç¤ºä¾‹
from shapely.geometry import Point

monitor = ChemicalSafetyMonitor("host=localhost dbname=testdb user=postgres password=secret")

# é‡‡é›†è®¾å¤‡æ•°æ®
equipment_location = Point(116.3974, 39.9093)
monitor.collect_equipment_data(
    equipment_id='reactor_001',
    equipment_type='reactor',
    location=equipment_location,
    temperature=75.0,
    pressure=8.5,
    flow_rate=120.0,
    vibration=5.0,
    status='running'
)

# è·å–æœªè§£å†³çš„äº‹ä»¶
events = monitor.get_unresolved_events(limit=20)
for event in events:
    print(f"[{event['severity']}] {event['equipment_id']}: {event['description']}")
```

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 08-23-01
