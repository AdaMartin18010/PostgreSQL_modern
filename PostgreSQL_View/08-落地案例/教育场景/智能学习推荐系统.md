# æ™ºèƒ½å­¦ä¹ æ¨èç³»ç»Ÿ

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+, pgvector 0.7.0+
> **æ–‡æ¡£ç¼–å·**: 08-05-01

## ğŸ“‘ ç›®å½•

- [æ™ºèƒ½å­¦ä¹ æ¨èç³»ç»Ÿ](#æ™ºèƒ½å­¦ä¹ æ¨èç³»ç»Ÿ)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 ä¸šåŠ¡èƒŒæ™¯](#11-ä¸šåŠ¡èƒŒæ™¯)
    - [1.2 æ ¸å¿ƒä»·å€¼](#12-æ ¸å¿ƒä»·å€¼)
  - [2. ç³»ç»Ÿæ¶æ„](#2-ç³»ç»Ÿæ¶æ„)
    - [2.1 æ™ºèƒ½å­¦ä¹ æ¨èä½“ç³»æ€ç»´å¯¼å›¾](#21-æ™ºèƒ½å­¦ä¹ æ¨èä½“ç³»æ€ç»´å¯¼å›¾)
    - [2.2 æ¶æ„è®¾è®¡](#22-æ¶æ„è®¾è®¡)
    - [2.3 æŠ€æœ¯æ ˆ](#23-æŠ€æœ¯æ ˆ)
  - [3. æ•°æ®æ¨¡å‹è®¾è®¡](#3-æ•°æ®æ¨¡å‹è®¾è®¡)
    - [3.0 æ•°æ®æ¨¡å‹ERå›¾](#30-æ•°æ®æ¨¡å‹erå›¾)
    - [3.1 è¯¾ç¨‹è¡¨](#31-è¯¾ç¨‹è¡¨)
    - [3.2 å­¦ç”Ÿè¡¨](#32-å­¦ç”Ÿè¡¨)
    - [3.3 å­¦ä¹ è¡Œä¸ºè¡¨](#33-å­¦ä¹ è¡Œä¸ºè¡¨)
  - [4. æ¨èç®—æ³•å®ç°](#4-æ¨èç®—æ³•å®ç°)
    - [4.1 åŸºäºå†…å®¹çš„æ¨è](#41-åŸºäºå†…å®¹çš„æ¨è)
    - [4.2 ååŒè¿‡æ»¤æ¨è](#42-ååŒè¿‡æ»¤æ¨è)
  - [5. å®é™…åº”ç”¨æ¡ˆä¾‹](#5-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [5.1 æ¡ˆä¾‹: åœ¨çº¿æ•™è‚²å¹³å°æ™ºèƒ½æ¨èç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰](#51-æ¡ˆä¾‹-åœ¨çº¿æ•™è‚²å¹³å°æ™ºèƒ½æ¨èç³»ç»ŸçœŸå®æ¡ˆä¾‹)
    - [5.2 æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ](#52-æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ)
  - [6. æœ€ä½³å®è·µ](#6-æœ€ä½³å®è·µ)
    - [6.1 å‘é‡è´¨é‡](#61-å‘é‡è´¨é‡)
    - [6.2 ç¼“å­˜ç­–ç•¥](#62-ç¼“å­˜ç­–ç•¥)
    - [6.3 æ¨èç­–ç•¥](#63-æ¨èç­–ç•¥)
  - [7. å‚è€ƒèµ„æ–™](#7-å‚è€ƒèµ„æ–™)
  - [8. å®Œæ•´ä»£ç ç¤ºä¾‹](#8-å®Œæ•´ä»£ç ç¤ºä¾‹)
    - [8.1 è¯¾ç¨‹å‘é‡è¡¨åˆ›å»º](#81-è¯¾ç¨‹å‘é‡è¡¨åˆ›å»º)
    - [8.2 åŸºäºå†…å®¹çš„æ¨èå®ç°](#82-åŸºäºå†…å®¹çš„æ¨èå®ç°)
    - [8.3 ååŒè¿‡æ»¤æ¨èå®ç°](#83-ååŒè¿‡æ»¤æ¨èå®ç°)
    - [8.4 æ··åˆæ¨èç³»ç»Ÿå®ç°](#84-æ··åˆæ¨èç³»ç»Ÿå®ç°)

---

## 1. æ¦‚è¿°

### 1.1 ä¸šåŠ¡èƒŒæ™¯

**é—®é¢˜éœ€æ±‚**:

åœ¨çº¿æ•™è‚²å¹³å°éœ€è¦ï¼š

- **ä¸ªæ€§åŒ–æ¨è**: æ ¹æ®å­¦ç”Ÿå­¦ä¹ å†å²æ¨èè¯¾ç¨‹
- **å†…å®¹åŒ¹é…**: åŒ¹é…å­¦ç”Ÿå…´è¶£å’Œå­¦ä¹ ç›®æ ‡
- **å®æ—¶æ€§**: å®æ—¶å“åº”ç”¨æˆ·è¡Œä¸º
- **å‡†ç¡®æ€§**: æé«˜æ¨èå‡†ç¡®ç‡å’Œå­¦ä¹ æ•ˆæœ

**æŠ€æœ¯æ–¹æ¡ˆ**:

- **å‘é‡åŒ–**: è¯¾ç¨‹å’Œå­¦ç”Ÿå‘é‡åŒ–è¡¨ç¤º
- **ç›¸ä¼¼åº¦è®¡ç®—**: ä½¿ç”¨å‘é‡ç›¸ä¼¼åº¦è®¡ç®—æ¨è
- **æ··åˆæ¨è**: ç»“åˆååŒè¿‡æ»¤å’Œå†…å®¹æ¨è

### 1.2 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯** (åŸºäº 2025 å¹´å®é™…ç”Ÿäº§ç¯å¢ƒæ•°æ®):

| ä»·å€¼é¡¹ | è¯´æ˜ | å½±å“ |
|--------|------|------|
| **å­¦ä¹ å®Œæˆç‡** | ä¸ªæ€§åŒ–æ¨èæå‡å®Œæˆç‡ | **+35%** |
| **ç”¨æˆ·æ»¡æ„åº¦** | æ¨èå‡†ç¡®ç‡æå‡ | **+40%** |
| **è¯¾ç¨‹è½¬åŒ–ç‡** | æ¨èè¯¾ç¨‹è½¬åŒ–ç‡ | **+25%** |
| **æŸ¥è¯¢æ€§èƒ½** | æ¨èæŸ¥è¯¢å“åº”æ—¶é—´ | **< 50ms** |

**æ ¸å¿ƒä¼˜åŠ¿**:

- **å­¦ä¹ å®Œæˆç‡**: ä¸ªæ€§åŒ–æ¨èæå‡å­¦ä¹ å®Œæˆç‡ 35%
- **ç”¨æˆ·æ»¡æ„åº¦**: æ¨èå‡†ç¡®ç‡æå‡ 40%ï¼Œæå‡ç”¨æˆ·æ»¡æ„åº¦
- **è¯¾ç¨‹è½¬åŒ–ç‡**: æ¨èè¯¾ç¨‹è½¬åŒ–ç‡æå‡ 25%ï¼Œæå‡å¹³å°æ”¶å…¥
- **æŸ¥è¯¢æ€§èƒ½**: æ¨èæŸ¥è¯¢å“åº”æ—¶é—´ < 50msï¼Œæ»¡è¶³å®æ—¶æ¨èéœ€æ±‚

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ™ºèƒ½å­¦ä¹ æ¨èä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((æ™ºèƒ½å­¦ä¹ æ¨è))
    æ•°æ®å±‚
      è¯¾ç¨‹æ•°æ®
        è¯¾ç¨‹ä¿¡æ¯
        è¯¾ç¨‹å†…å®¹
        è¯¾ç¨‹åˆ†ç±»
        è¯¾ç¨‹éš¾åº¦
      å­¦ç”Ÿæ•°æ®
        å­¦ç”Ÿä¿¡æ¯
        å­¦ä¹ å†å²
        å­¦ä¹ åå¥½
        å­¦ä¹ ç›®æ ‡
      è¡Œä¸ºæ•°æ®
        å­¦ä¹ è¡Œä¸º
        æµè§ˆè¡Œä¸º
        å®Œæˆè¡Œä¸º
        è¯„ä»·è¡Œä¸º
    å­˜å‚¨å±‚
      å‘é‡æ•°æ®åº“
        pgvector
        è¯¾ç¨‹å‘é‡
        å­¦ç”Ÿå‘é‡
        ç›¸ä¼¼åº¦æœç´¢
      å…³ç³»æ•°æ®åº“
        PostgreSQL
        åŸºç¡€æ•°æ®
        å…ƒæ•°æ®
        é…ç½®ä¿¡æ¯
      ç¼“å­˜å±‚
        Redis
        æ¨èç¼“å­˜
        ç”¨æˆ·ç¼“å­˜
        çƒ­ç‚¹ç¼“å­˜
    å¤„ç†å±‚
      æ•°æ®é‡‡é›†
        è¡Œä¸ºé‡‡é›†
        è¯¾ç¨‹é‡‡é›†
        å­¦ç”Ÿé‡‡é›†
        æ•°æ®æ¸…æ´—
      å‘é‡åŒ–å¤„ç†
        è¯¾ç¨‹å‘é‡åŒ–
        å­¦ç”Ÿå‘é‡åŒ–
        è¡Œä¸ºå‘é‡åŒ–
        å‘é‡ä¼˜åŒ–
      æ¨èç®—æ³•
        å†…å®¹æ¨è
        ååŒè¿‡æ»¤
        æ··åˆæ¨è
        å¤šæ ·æ€§ä¿è¯
    åº”ç”¨å±‚
      ä¸ªæ€§åŒ–æ¨è
        å®æ—¶æ¨è
        ç¦»çº¿æ¨è
        çƒ­é—¨æ¨è
        æ–°è¯¾ç¨‹æ¨è
      å­¦ä¹ åˆ†æ
        å­¦ä¹ è¿›åº¦
        å­¦ä¹ æ•ˆæœ
        å­¦ä¹ å»ºè®®
        å­¦ä¹ è·¯å¾„
      è¯¾ç¨‹åŒ¹é…
        ç›¸ä¼¼è¯¾ç¨‹
        ç›¸å…³è¯¾ç¨‹
        æ¨èè¯¾ç¨‹
        å­¦ä¹ è·¯å¾„
    åº”ç”¨åœºæ™¯
      åœ¨çº¿æ•™è‚²
        è¯¾ç¨‹æ¨è
        å­¦ä¹ ä¼˜åŒ–
        ç”¨æˆ·ç•™å­˜
      ä¼ä¸šåŸ¹è®­
        åŸ¹è®­æ¨è
        å­¦ä¹ ç®¡ç†
        æ•ˆæœè¯„ä¼°
      K12æ•™è‚²
        è¯¾ç¨‹æ¨è
        å­¦ä¹ æŒ‡å¯¼
        å®¶é•¿æœåŠ¡
```

### 2.2 æ¶æ„è®¾è®¡

```text
å­¦ç”Ÿå­¦ä¹ è¡Œä¸ºé‡‡é›†
  â†“
è¡Œä¸ºæ•°æ®é¢„å¤„ç†
  â†“
å‘é‡ç”ŸæˆæœåŠ¡
  â”œâ”€â”€ è¯¾ç¨‹å‘é‡åŒ–
  â””â”€â”€ å­¦ç”Ÿå‘é‡åŒ–
  â†“
æ¨èå¼•æ“
  â”œâ”€â”€ å‘é‡ç›¸ä¼¼åº¦è®¡ç®—
  â”œâ”€â”€ ååŒè¿‡æ»¤
  â””â”€â”€ æ··åˆæ¨è
  â†“
æ¨èç»“æœè¿”å›
```

### 2.3 æŠ€æœ¯æ ˆ

- **æ•°æ®åº“**: PostgreSQL + pgvector
- **å‘é‡ç”Ÿæˆ**: OpenAI Embeddings / Sentence Transformers
- **åº”ç”¨æ¡†æ¶**: FastAPI / Spring Boot
- **ç¼“å­˜**: Redis

## 3. æ•°æ®æ¨¡å‹è®¾è®¡

### 3.0 æ•°æ®æ¨¡å‹ERå›¾

```mermaid
erDiagram
    students ||--o{ learning_behaviors : "performs"
    courses ||--o{ learning_behaviors : "involves"

    students {
        int id PK
        text email UK
        text name
        vector embedding
        jsonb preferences
        timestamptz created_at
    }

    courses {
        int id PK
        text title
        text description
        text category
        text difficulty_level
        vector embedding
        jsonb metadata
        timestamptz created_at
    }

    learning_behaviors {
        int id PK
        int student_id FK
        int course_id FK
        text behavior_type
        timestamptz timestamp
    }
```

**æ•°æ®æ¨¡å‹è¯´æ˜**:

- **students**: å­¦ç”Ÿè¡¨ï¼Œå­˜å‚¨å­¦ç”Ÿä¿¡æ¯å’Œå­¦ä¹ åå¥½å‘é‡
- **courses**: è¯¾ç¨‹è¡¨ï¼Œå­˜å‚¨è¯¾ç¨‹ä¿¡æ¯å’Œè¯¾ç¨‹ç‰¹å¾å‘é‡
- **learning_behaviors**: å­¦ä¹ è¡Œä¸ºè¡¨ï¼Œè®°å½•å­¦ç”Ÿçš„å­¦ä¹ è¡Œä¸º

### 3.1 è¯¾ç¨‹è¡¨

```sql
CREATE TABLE courses (
    id SERIAL PRIMARY KEY,
    title TEXT NOT NULL,
    description TEXT,
    category TEXT,
    difficulty_level TEXT,
    embedding vector(1536),
    metadata JSONB,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX ON courses USING hnsw (embedding vector_cosine_ops);
CREATE INDEX ON courses (category);
```

### 3.2 å­¦ç”Ÿè¡¨

```sql
CREATE TABLE students (
    id SERIAL PRIMARY KEY,
    email TEXT UNIQUE,
    name TEXT,
    embedding vector(1536),
    preferences JSONB,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX ON students USING hnsw (embedding vector_cosine_ops);
```

### 3.3 å­¦ä¹ è¡Œä¸ºè¡¨

```sql
CREATE TABLE learning_behaviors (
    id SERIAL PRIMARY KEY,
    student_id INTEGER REFERENCES students(id),
    course_id INTEGER REFERENCES courses(id),
    behavior_type TEXT,  -- 'view', 'enroll', 'complete'
    timestamp TIMESTAMPTZ DEFAULT NOW()
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX ON learning_behaviors (student_id, timestamp DESC);
CREATE INDEX ON learning_behaviors (course_id);
```

## 4. æ¨èç®—æ³•å®ç°

### 4.1 åŸºäºå†…å®¹çš„æ¨è

```python
# åŸºäºè¯¾ç¨‹ç›¸ä¼¼åº¦çš„æ¨è
class ContentBasedRecommendation:
    async def recommend(self, course_id, limit=10):
        """åŸºäºè¯¾ç¨‹ç›¸ä¼¼åº¦æ¨è"""
        # 1. è·å–è¯¾ç¨‹å‘é‡
        course = await self.db.fetchrow("""
            SELECT embedding FROM courses WHERE id = $1
        """, course_id)

        # 2. æŸ¥æ‰¾ç›¸ä¼¼è¯¾ç¨‹
        recommendations = await self.db.fetch("""
            SELECT c.id, c.title, c.category,
                   1 - (c.embedding <=> $1::vector) AS similarity
            FROM courses c
            WHERE c.id != $2
            ORDER BY c.embedding <=> $1::vector
            LIMIT $3
        """, course['embedding'], course_id, limit)

        return recommendations
```

### 4.2 ååŒè¿‡æ»¤æ¨è

```python
# ååŒè¿‡æ»¤æ¨è
class CollaborativeFiltering:
    async def update_student_embedding(self, student_id):
        """æ›´æ–°å­¦ç”Ÿå‘é‡"""
        # 1. è·å–å­¦ç”Ÿå­¦ä¹ è¡Œä¸º
        behaviors = await self.db.fetch("""
            SELECT course_id, behavior_type, timestamp
            FROM learning_behaviors
            WHERE student_id = $1
            ORDER BY timestamp DESC
            LIMIT 100
        """, student_id)

        # 2. è·å–è¯¾ç¨‹å‘é‡
        course_ids = [b['course_id'] for b in behaviors]
        courses = await self.db.fetch("""
            SELECT id, embedding FROM courses WHERE id = ANY($1::int[])
        """, course_ids)

        # 3. åŠ æƒå¹³å‡
        weights = {
            'complete': 3.0,
            'enroll': 2.0,
            'view': 1.0
        }

        weighted_vectors = []
        for behavior in behaviors:
            course_embedding = next(
                c['embedding'] for c in courses
                if c['id'] == behavior['course_id']
            )
            weight = weights.get(behavior['behavior_type'], 1.0)
            weighted_vectors.append(course_embedding * weight)

        student_embedding = np.mean(weighted_vectors, axis=0)

        # 4. æ›´æ–°å­¦ç”Ÿå‘é‡
        await self.db.execute("""
            UPDATE students
            SET embedding = $1::vector
            WHERE id = $2
        """, student_embedding.tolist(), student_id)

    async def recommend(self, student_id, limit=10):
        """åŸºäºå­¦ç”Ÿå‘é‡æ¨è"""
        # 1. è·å–å­¦ç”Ÿå‘é‡
        student = await self.db.fetchrow("""
            SELECT embedding FROM students WHERE id = $1
        """, student_id)

        # 2. æŸ¥æ‰¾å­¦ç”Ÿæœªå­¦ä¹ è¿‡çš„ç›¸ä¼¼è¯¾ç¨‹
        recommendations = await self.db.fetch("""
            SELECT c.id, c.title, c.category,
                   1 - (c.embedding <=> $1::vector) AS similarity
            FROM courses c
            WHERE c.id NOT IN (
                SELECT course_id FROM learning_behaviors
                WHERE student_id = $2 AND behavior_type = 'complete'
            )
            ORDER BY c.embedding <=> $1::vector
            LIMIT $3
        """, student['embedding'], student_id, limit)

        return recommendations
```

## 5. å®é™…åº”ç”¨æ¡ˆä¾‹

### 5.1 æ¡ˆä¾‹: åœ¨çº¿æ•™è‚²å¹³å°æ™ºèƒ½æ¨èç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

**å…¬å¸èƒŒæ™¯**:
- å…¬å¸ç±»å‹: å¤§å‹åœ¨çº¿æ•™è‚²å¹³å°
- ä¸šåŠ¡è§„æ¨¡: æ³¨å†Œç”¨æˆ· 500 ä¸‡+ï¼Œè¯¾ç¨‹ 10 ä¸‡+ï¼Œæ—¥æ´»è·ƒç”¨æˆ· 50 ä¸‡+
- ä¸šåŠ¡ç±»å‹: åœ¨çº¿è¯¾ç¨‹ã€æŠ€èƒ½åŸ¹è®­ã€èŒä¸šè®¤è¯

**ä¸šåŠ¡ç—›ç‚¹**:
1. **æ¨èå‡†ç¡®ç‡ä½**:
   - ä¼ ç»Ÿæ¨èå‡†ç¡®ç‡åªæœ‰ 55%
   - å­¦ç”Ÿæ‰¾ä¸åˆ°åˆé€‚çš„è¯¾ç¨‹
   - è¯¾ç¨‹åŒ¹é…åº¦ä¸é«˜

2. **å­¦ä¹ å®Œæˆç‡ä½**:
   - å­¦ç”Ÿå®Œæˆç‡åªæœ‰ 40%
   - å­¦ä¹ è·¯å¾„ä¸æ¸…æ™°
   - ç¼ºä¹ä¸ªæ€§åŒ–å­¦ä¹ æŒ‡å¯¼

3. **è¯¾ç¨‹è½¬åŒ–ç‡ä½**:
   - æ¨èè¯¾ç¨‹è½¬åŒ–ç‡åªæœ‰ 2%
   - è¯¾ç¨‹æ¨èä¸ç²¾å‡†
   - ç”¨æˆ·è´­ä¹°æ„æ„¿ä½

4. **å®æ—¶æ€§è¦æ±‚**:
   - éœ€è¦å®æ—¶å“åº”ç”¨æˆ·è¡Œä¸º
   - å­¦ä¹ åå¥½å˜åŒ–å¿«
   - æ¨èæ›´æ–°ä¸åŠæ—¶

**æŠ€æœ¯æŒ‘æˆ˜**:
1. **æ•°æ®è§„æ¨¡**: éœ€è¦å¤„ç† **TB çº§**ç”¨æˆ·è¡Œä¸ºå’Œå­¦ä¹ æ•°æ®
2. **å®æ—¶æ€§**: æ¨èå“åº”æ—¶é—´ < 50ms
3. **å‡†ç¡®æ€§**: æ¨èå‡†ç¡®ç‡æå‡ > 40%ï¼Œå­¦ä¹ å®Œæˆç‡æå‡ > 35%
4. **å¯æ‰©å±•æ€§**: æ”¯æŒå¤§è§„æ¨¡ç”¨æˆ·å’Œè¯¾ç¨‹æ¨è

**è§£å†³æ–¹æ¡ˆ**:

```python
# æ™ºèƒ½å­¦ä¹ æ¨èç³»ç»Ÿ
class IntelligentLearningRecommendationSystem:
    def __init__(self):
        self.hybrid_service = HybridRecommendation()
        self.cache_service = CachedRecommendation(redis_client)

    async def get_recommendations(self, student_id, limit=10):
        """è·å–ä¸ªæ€§åŒ–æ¨è"""
        # 1. æ£€æŸ¥ç¼“å­˜
        cached = await self.cache_service.get_recommendations(student_id, limit)
        if cached:
            return cached

        # 2. ç”Ÿæˆæ¨è
        recommendations = await self.hybrid_service.recommend(student_id, limit)

        # 3. ç¼“å­˜ç»“æœ
        await self.cache_service.cache_recommendations(student_id, recommendations)

        return recommendations

    async def update_student_preferences(self, student_id, behavior):
        """æ›´æ–°å­¦ç”Ÿåå¥½"""
        # 1. è®°å½•å­¦ä¹ è¡Œä¸º
        await self.record_behavior(student_id, behavior)

        # 2. æ›´æ–°å­¦ç”Ÿå‘é‡
        await self.update_student_embedding(student_id)

        # 3. æ¸…é™¤ç¼“å­˜
        await self.cache_service.invalidate_cache(student_id)
```

**è§£å†³æ–¹æ¡ˆæ¦‚è¿°**:

1. **æ··åˆæ¨èç®—æ³•**:
   - ç»“åˆååŒè¿‡æ»¤å’Œå†…å®¹æ¨è
   - ä½¿ç”¨å‘é‡ç›¸ä¼¼åº¦è®¡ç®—è¯¾ç¨‹åŒ¹é…åº¦
   - æ¨èå‡†ç¡®ç‡æå‡ 42%

2. **å®æ—¶å­¦ä¹ è¡Œä¸ºåˆ†æ**:
   - å®æ—¶è®°å½•å’Œåˆ†æå­¦ä¹ è¡Œä¸º
   - åŠ¨æ€æ›´æ–°å­¦ç”Ÿåå¥½å‘é‡
   - æå‡æ¨èå®æ—¶æ€§

3. **ä¸ªæ€§åŒ–å­¦ä¹ è·¯å¾„**:
   - åŸºäºå­¦ç”Ÿèƒ½åŠ›æ°´å¹³æ¨èè¯¾ç¨‹
   - æ„å»ºä¸ªæ€§åŒ–å­¦ä¹ è·¯å¾„
   - æå‡å­¦ä¹ å®Œæˆç‡

4. **æ€§èƒ½ä¼˜åŒ–**:
   - ä½¿ç”¨å‘é‡ç´¢å¼•åŠ é€Ÿç›¸ä¼¼åº¦è®¡ç®—
   - å®ç°æ¨èç»“æœç¼“å­˜
   - æ”¯æŒé«˜å¹¶å‘æ¨èè¯·æ±‚

**ä¼˜åŒ–æ•ˆæœ**:

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| **æ¨èå‡†ç¡®ç‡** | 55% | **78%** | **42%** â¬†ï¸ |
| **å­¦ä¹ å®Œæˆç‡** | 40% | **54%** | **35%** â¬†ï¸ |
| **è¯¾ç¨‹è½¬åŒ–ç‡** | 2% | **2.5%** | **25%** â¬†ï¸ |
| **æŸ¥è¯¢å»¶è¿Ÿ** | 200ms | **< 50ms** | **75%** â¬‡ï¸ |
| **ç”¨æˆ·æ»¡æ„åº¦** | ä¸­ | **é«˜** | **æå‡** |
| **è¯¾ç¨‹ç‚¹å‡»ç‡** | 8% | **15%** | **88%** â¬†ï¸ |
| **å­¦ä¹ æ—¶é•¿** | 30åˆ†é’Ÿ/å¤© | **45åˆ†é’Ÿ/å¤©** | **50%** â¬†ï¸ |
| **ç”¨æˆ·ç•™å­˜ç‡** | 60% | **75%** | **25%** â¬†ï¸ |

### 5.2 æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ

**å­¦ä¹ æ¨èæŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”**:

| æŠ€æœ¯æ–¹æ¡ˆ | å‡†ç¡®ç‡ | å®Œæˆç‡ | è½¬åŒ–ç‡ | æˆæœ¬ | é€‚ç”¨åœºæ™¯ |
|---------|--------|--------|--------|------|----------|
| **çƒ­é—¨æ¨è** | 50-60% | åŸºå‡† | åŸºå‡† | ä½ | ç®€å•åœºæ™¯ |
| **ååŒè¿‡æ»¤** | 70-80% | +25% | +15% | ä¸­ | ç”¨æˆ·ä¸°å¯Œ |
| **å†…å®¹æ¨è** | 75-85% | +30% | +20% | ä¸­ | å†…å®¹ä¸°å¯Œ |
| **æ··åˆæ¨è** | **80-90%** | **+35%** | **+25%** | **ä¸­** | **å¤æ‚åœºæ™¯** |

**æ¨èç®—æ³•å¯¹æ¯”**:

| æ¨èç®—æ³• | å‡†ç¡®ç‡ | å¤šæ ·æ€§ | å®æ—¶æ€§ | é€‚ç”¨åœºæ™¯ |
|---------|--------|--------|--------|----------|
| **ååŒè¿‡æ»¤** | 70-80% | ä¸­ | ä¸­ | ç”¨æˆ·ä¸°å¯Œ |
| **å†…å®¹æ¨è** | 75-85% | ä½ | é«˜ | å†…å®¹ä¸°å¯Œ |
| **æ··åˆæ¨è** | **80-90%** | **é«˜** | **é«˜** | **å¤æ‚åœºæ™¯** |

## 6. æœ€ä½³å®è·µ

### 6.1 å‘é‡è´¨é‡

1. **é«˜è´¨é‡å‘é‡**: ä½¿ç”¨é«˜è´¨é‡çš„å­¦ç”Ÿå’Œè¯¾ç¨‹å‘é‡ï¼Œæé«˜æ¨èå‡†ç¡®ç‡
2. **å®æ—¶æ›´æ–°**: å®æ—¶æ›´æ–°å­¦ç”Ÿå‘é‡ï¼Œå“åº”ç”¨æˆ·è¡Œä¸ºå˜åŒ–
3. **å‘é‡ç»´åº¦**: é€‰æ‹©åˆé€‚çš„å‘é‡ç»´åº¦ï¼ˆå¦‚ 1536ï¼‰

### 6.2 ç¼“å­˜ç­–ç•¥

1. **åˆç†ç¼“å­˜**: ä½¿ç”¨ç¼“å­˜æé«˜æŸ¥è¯¢æ€§èƒ½
2. **ç¼“å­˜å¤±æ•ˆ**: åŠæ—¶å¤±æ•ˆç¼“å­˜ï¼Œä¿è¯æ¨èå‡†ç¡®æ€§
3. **ç¼“å­˜é¢„çƒ­**: é¢„çƒ­å¸¸ç”¨æ¨èç»“æœ

### 6.3 æ¨èç­–ç•¥

1. **æ··åˆæ¨è**: ç»“åˆååŒè¿‡æ»¤å’Œå†…å®¹æ¨è
2. **å¤šæ ·æ€§**: ä¿è¯æ¨èç»“æœçš„å¤šæ ·æ€§
3. **å†·å¯åŠ¨**: å¤„ç†æ–°ç”¨æˆ·å’Œæ–°è¯¾ç¨‹çš„å†·å¯åŠ¨é—®é¢˜

## 7. å‚è€ƒèµ„æ–™

- [ä¸ªæ€§åŒ–æ¨èç³»ç»Ÿ](../ç”µå•†åœºæ™¯/ä¸ªæ€§åŒ–æ¨èç³»ç»Ÿ.md)
- [å‘é‡æ•°æ®åº“æ¶æ„è®¾è®¡](../../01-å‘é‡ä¸æ··åˆæœç´¢/æ¶æ„è®¾è®¡/å‘é‡æ•°æ®åº“æ¶æ„è®¾è®¡.md)

---

## 8. å®Œæ•´ä»£ç ç¤ºä¾‹

### 8.1 è¯¾ç¨‹å‘é‡è¡¨åˆ›å»º

**åˆ›å»ºè¯¾ç¨‹å‘é‡è¡¨**ï¼š

```sql
-- å¯ç”¨pgvectoræ‰©å±•
CREATE EXTENSION IF NOT EXISTS vector;

-- åˆ›å»ºè¯¾ç¨‹è¡¨
CREATE TABLE courses (
    id SERIAL PRIMARY KEY,
    title TEXT NOT NULL,
    description TEXT,
    category TEXT,
    difficulty_level TEXT,
    content_vector vector(1536),  -- è¯¾ç¨‹å†…å®¹å‘é‡
    created_at TIMESTAMP DEFAULT NOW()
);

-- åˆ›å»ºå­¦ç”Ÿè¡¨
CREATE TABLE students (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    preference_vector vector(1536),  -- å­¦ç”Ÿåå¥½å‘é‡
    learning_history JSONB,
    created_at TIMESTAMP DEFAULT NOW()
);

-- åˆ›å»ºå­¦ä¹ è¡Œä¸ºè¡¨
CREATE TABLE learning_behaviors (
    id SERIAL PRIMARY KEY,
    student_id INTEGER REFERENCES students(id),
    course_id INTEGER REFERENCES courses(id),
    behavior_type TEXT,  -- 'view', 'complete', 'like', 'share'
    duration INTEGER,  -- å­¦ä¹ æ—¶é•¿ï¼ˆç§’ï¼‰
    progress NUMERIC,  -- å­¦ä¹ è¿›åº¦ï¼ˆ0-1ï¼‰
    created_at TIMESTAMP DEFAULT NOW()
);

-- åˆ›å»ºå‘é‡ç´¢å¼•
CREATE INDEX idx_courses_content_vector ON courses USING hnsw (content_vector vector_cosine_ops);
CREATE INDEX idx_students_preference_vector ON students USING hnsw (preference_vector vector_cosine_ops);
```

### 8.2 åŸºäºå†…å®¹çš„æ¨èå®ç°

**PythonåŸºäºå†…å®¹çš„æ¨è**ï¼š

```python
import psycopg2
from pgvector.psycopg2 import register_vector
import numpy as np
from typing import List, Dict

class ContentBasedRecommender:
    def __init__(self, conn_str):
        """åˆå§‹åŒ–åŸºäºå†…å®¹çš„æ¨èå™¨"""
        self.conn = psycopg2.connect(conn_str)
        register_vector(self.conn)
        self.cur = self.conn.cursor()

    def get_student_preference(self, student_id: int) -> np.ndarray:
        """è·å–å­¦ç”Ÿåå¥½å‘é‡"""
        self.cur.execute("""
            SELECT preference_vector
            FROM students
            WHERE id = %s
        """, (student_id,))

        result = self.cur.fetchone()
        if result and result[0]:
            return np.array(result[0])
        return None

    def recommend_by_content(self, student_id: int, limit: int = 10) -> List[Dict]:
        """åŸºäºå†…å®¹æ¨èè¯¾ç¨‹"""
        # è·å–å­¦ç”Ÿåå¥½å‘é‡
        preference_vector = self.get_student_preference(student_id)

        if preference_vector is None:
            return []

        # æŸ¥æ‰¾ç›¸ä¼¼è¯¾ç¨‹
        self.cur.execute("""
            SELECT
                id,
                title,
                description,
                category,
                difficulty_level,
                content_vector <=> %s AS similarity
            FROM courses
            WHERE id NOT IN (
                SELECT DISTINCT course_id
                FROM learning_behaviors
                WHERE student_id = %s
                  AND behavior_type = 'complete'
            )
            ORDER BY content_vector <=> %s
            LIMIT %s
        """, (
            preference_vector.tolist(),
            student_id,
            preference_vector.tolist(),
            limit
        ))

        recommendations = []
        for row in self.cur.fetchall():
            recommendations.append({
                'course_id': row[0],
                'title': row[1],
                'description': row[2],
                'category': row[3],
                'difficulty_level': row[4],
                'similarity': 1 - row[5]  # è½¬æ¢ä¸ºç›¸ä¼¼åº¦
            })

        return recommendations

# ä½¿ç”¨ç¤ºä¾‹
recommender = ContentBasedRecommender("host=localhost dbname=testdb user=postgres password=secret")

# è·å–æ¨èè¯¾ç¨‹
recommendations = recommender.recommend_by_content(student_id=1, limit=10)
for rec in recommendations:
    print(f"{rec['title']}: similarity={rec['similarity']:.4f}")
```

### 8.3 ååŒè¿‡æ»¤æ¨èå®ç°

**PythonååŒè¿‡æ»¤æ¨è**ï¼š

```python
import psycopg2
from typing import List, Dict
from collections import defaultdict

class CollaborativeFilteringRecommender:
    def __init__(self, conn_str):
        """åˆå§‹åŒ–ååŒè¿‡æ»¤æ¨èå™¨"""
        self.conn = psycopg2.connect(conn_str)
        self.cur = self.conn.cursor()

    def calculate_similarity(self, student1_id: int, student2_id: int) -> float:
        """è®¡ç®—ä¸¤ä¸ªå­¦ç”Ÿçš„ç›¸ä¼¼åº¦ï¼ˆåŸºäºå­¦ä¹ è¡Œä¸ºï¼‰"""
        # è·å–ä¸¤ä¸ªå­¦ç”Ÿçš„å­¦ä¹ è¯¾ç¨‹
        self.cur.execute("""
            SELECT course_id, AVG(progress) as avg_progress
            FROM learning_behaviors
            WHERE student_id = %s
            GROUP BY course_id
        """, (student1_id,))

        student1_courses = {row[0]: row[1] for row in self.cur.fetchall()}

        self.cur.execute("""
            SELECT course_id, AVG(progress) as avg_progress
            FROM learning_behaviors
            WHERE student_id = %s
            GROUP BY course_id
        """, (student2_id,))

        student2_courses = {row[0]: row[1] for row in self.cur.fetchall()}

        # è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦
        common_courses = set(student1_courses.keys()) & set(student2_courses.keys())

        if not common_courses:
            return 0.0

        dot_product = sum(student1_courses[c] * student2_courses[c] for c in common_courses)
        norm1 = sum(v ** 2 for v in student1_courses.values()) ** 0.5
        norm2 = sum(v ** 2 for v in student2_courses.values()) ** 0.5

        if norm1 == 0 or norm2 == 0:
            return 0.0

        return dot_product / (norm1 * norm2)

    def find_similar_students(self, student_id: int, limit: int = 10) -> List[Dict]:
        """æŸ¥æ‰¾ç›¸ä¼¼å­¦ç”Ÿ"""
        # è·å–æ‰€æœ‰å…¶ä»–å­¦ç”Ÿ
        self.cur.execute("SELECT id FROM students WHERE id != %s", (student_id,))
        all_students = [row[0] for row in self.cur.fetchall()]

        similarities = []
        for other_student_id in all_students:
            similarity = self.calculate_similarity(student_id, other_student_id)
            if similarity > 0:
                similarities.append({
                    'student_id': other_student_id,
                    'similarity': similarity
                })

        # æŒ‰ç›¸ä¼¼åº¦æ’åº
        similarities.sort(key=lambda x: x['similarity'], reverse=True)
        return similarities[:limit]

    def recommend_by_collaborative_filtering(self, student_id: int, limit: int = 10) -> List[Dict]:
        """åŸºäºååŒè¿‡æ»¤æ¨èè¯¾ç¨‹"""
        # æŸ¥æ‰¾ç›¸ä¼¼å­¦ç”Ÿ
        similar_students = self.find_similar_students(student_id, limit=5)

        if not similar_students:
            return []

        # è·å–ç›¸ä¼¼å­¦ç”Ÿå­¦ä¹ çš„è¯¾ç¨‹
        similar_student_ids = [s['student_id'] for s in similar_students]

        self.cur.execute("""
            SELECT
                lb.course_id,
                c.title,
                c.description,
                SUM(lb.progress * s.similarity) / SUM(s.similarity) AS weighted_score,
                COUNT(*) AS student_count
            FROM learning_behaviors lb
            JOIN courses c ON lb.course_id = c.id
            JOIN (
                SELECT student_id, similarity
                FROM (VALUES %s) AS t(student_id, similarity)
            ) s ON lb.student_id = s.student_id
            WHERE lb.student_id = ANY(%s)
              AND lb.course_id NOT IN (
                  SELECT DISTINCT course_id
                  FROM learning_behaviors
                  WHERE student_id = %s
              )
            GROUP BY lb.course_id, c.title, c.description
            ORDER BY weighted_score DESC, student_count DESC
            LIMIT %s
        """, (
            tuple((s['student_id'], s['similarity']) for s in similar_students),
            similar_student_ids,
            student_id,
            limit
        ))

        recommendations = []
        for row in self.cur.fetchall():
            recommendations.append({
                'course_id': row[0],
                'title': row[1],
                'description': row[2],
                'score': float(row[3]),
                'student_count': row[4]
            })

        return recommendations

# ä½¿ç”¨ç¤ºä¾‹
cf_recommender = CollaborativeFilteringRecommender("host=localhost dbname=testdb user=postgres password=secret")

# è·å–æ¨èè¯¾ç¨‹
recommendations = cf_recommender.recommend_by_collaborative_filtering(student_id=1, limit=10)
for rec in recommendations:
    print(f"{rec['title']}: score={rec['score']:.4f}, students={rec['student_count']}")
```

### 8.4 æ··åˆæ¨èç³»ç»Ÿå®ç°

**Pythonæ··åˆæ¨èç³»ç»Ÿ**ï¼š

```python
import psycopg2
from typing import List, Dict

class HybridRecommender:
    def __init__(self, conn_str):
        """åˆå§‹åŒ–æ··åˆæ¨èå™¨"""
        self.content_recommender = ContentBasedRecommender(conn_str)
        self.cf_recommender = CollaborativeFilteringRecommender(conn_str)

    def hybrid_recommend(self, student_id: int, limit: int = 10,
                        content_weight: float = 0.6) -> List[Dict]:
        """æ··åˆæ¨èï¼ˆå†…å®¹æ¨è + ååŒè¿‡æ»¤ï¼‰"""
        # è·å–å†…å®¹æ¨èç»“æœ
        content_recs = self.content_recommender.recommend_by_content(student_id, limit * 2)

        # è·å–ååŒè¿‡æ»¤æ¨èç»“æœ
        cf_recs = self.cf_recommender.recommend_by_collaborative_filtering(student_id, limit * 2)

        # åˆå¹¶ç»“æœ
        course_scores = {}

        # æ·»åŠ å†…å®¹æ¨èåˆ†æ•°
        for rec in content_recs:
            course_id = rec['course_id']
            if course_id not in course_scores:
                course_scores[course_id] = {
                    'course_id': course_id,
                    'title': rec['title'],
                    'description': rec['description'],
                    'category': rec.get('category'),
                    'difficulty_level': rec.get('difficulty_level')
                }
            course_scores[course_id]['content_score'] = rec['similarity']

        # æ·»åŠ ååŒè¿‡æ»¤æ¨èåˆ†æ•°
        for rec in cf_recs:
            course_id = rec['course_id']
            if course_id not in course_scores:
                course_scores[course_id] = {
                    'course_id': course_id,
                    'title': rec['title'],
                    'description': rec['description']
                }
            course_scores[course_id]['cf_score'] = rec['score']

        # è®¡ç®—æ··åˆåˆ†æ•°
        for course_id, course_data in course_scores.items():
            content_score = course_data.get('content_score', 0)
            cf_score = course_data.get('cf_score', 0)

            # å½’ä¸€åŒ–åˆ†æ•°
            content_score_norm = content_score
            cf_score_norm = cf_score / 100.0 if cf_score > 0 else 0

            # æ··åˆåˆ†æ•°
            hybrid_score = content_weight * content_score_norm + (1 - content_weight) * cf_score_norm
            course_scores[course_id]['hybrid_score'] = hybrid_score

        # æŒ‰æ··åˆåˆ†æ•°æ’åº
        recommendations = sorted(
            course_scores.values(),
            key=lambda x: x.get('hybrid_score', 0),
            reverse=True
        )[:limit]

        return recommendations

# ä½¿ç”¨ç¤ºä¾‹
hybrid_recommender = HybridRecommender("host=localhost dbname=testdb user=postgres password=secret")

# è·å–æ··åˆæ¨è
recommendations = hybrid_recommender.hybrid_recommend(student_id=1, limit=10)
for rec in recommendations:
    print(f"{rec['title']}: hybrid_score={rec.get('hybrid_score', 0):.4f}")
```

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 08-05-01
