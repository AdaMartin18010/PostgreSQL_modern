# æ™ºèƒ½é©¾é©¶æ•°æ®ç³»ç»Ÿ

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+, TimescaleDB 2.11+, PostGIS 3.0+
> **æ–‡æ¡£ç¼–å·**: 08-21-01

## ğŸ“‘ ç›®å½•

- [æ™ºèƒ½é©¾é©¶æ•°æ®ç³»ç»Ÿ](#æ™ºèƒ½é©¾é©¶æ•°æ®ç³»ç»Ÿ)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 ä¸šåŠ¡èƒŒæ™¯](#11-ä¸šåŠ¡èƒŒæ™¯)
    - [1.2 æ ¸å¿ƒä»·å€¼](#12-æ ¸å¿ƒä»·å€¼)
  - [2. ç³»ç»Ÿæ¶æ„](#2-ç³»ç»Ÿæ¶æ„)
    - [2.1 æ™ºèƒ½é©¾é©¶æ•°æ®ä½“ç³»æ€ç»´å¯¼å›¾](#21-æ™ºèƒ½é©¾é©¶æ•°æ®ä½“ç³»æ€ç»´å¯¼å›¾)
    - [2.2 æ¶æ„è®¾è®¡](#22-æ¶æ„è®¾è®¡)
    - [2.3 æŠ€æœ¯æ ˆ](#23-æŠ€æœ¯æ ˆ)
  - [3. æ•°æ®æ¨¡å‹è®¾è®¡](#3-æ•°æ®æ¨¡å‹è®¾è®¡)
    - [3.1 è½¦è¾†æ•°æ®æ—¶åºè¡¨](#31-è½¦è¾†æ•°æ®æ—¶åºè¡¨)
    - [3.2 é“è·¯ä¿¡æ¯è¡¨](#32-é“è·¯ä¿¡æ¯è¡¨)
  - [4. æ•°æ®åˆ†æ](#4-æ•°æ®åˆ†æ)
    - [4.1 å®æ—¶è½¦è¾†ç›‘æ§](#41-å®æ—¶è½¦è¾†ç›‘æ§)
    - [4.2 è·¯å¾„è§„åˆ’](#42-è·¯å¾„è§„åˆ’)
  - [5. å®é™…åº”ç”¨æ¡ˆä¾‹](#5-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [5.1 æ¡ˆä¾‹: æ™ºèƒ½é©¾é©¶æ•°æ®ç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰](#51-æ¡ˆä¾‹-æ™ºèƒ½é©¾é©¶æ•°æ®ç³»ç»ŸçœŸå®æ¡ˆä¾‹)
    - [5.2 æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ](#52-æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ)
  - [6. æœ€ä½³å®è·µ](#6-æœ€ä½³å®è·µ)
    - [6.1 æ•°æ®é‡‡é›†](#61-æ•°æ®é‡‡é›†)
    - [6.2 æ•°æ®åˆ†æ](#62-æ•°æ®åˆ†æ)
  - [7. å‚è€ƒèµ„æ–™](#7-å‚è€ƒèµ„æ–™)
  - [8. å®Œæ•´ä»£ç ç¤ºä¾‹](#8-å®Œæ•´ä»£ç ç¤ºä¾‹)
    - [8.1 é©¾é©¶æ•°æ®è¡¨åˆ›å»º](#81-é©¾é©¶æ•°æ®è¡¨åˆ›å»º)
    - [8.2 é©¾é©¶æ•°æ®é‡‡é›†å’Œåˆ†æå®ç°](#82-é©¾é©¶æ•°æ®é‡‡é›†å’Œåˆ†æå®ç°)

---

## 1. æ¦‚è¿°

### 1.1 ä¸šåŠ¡èƒŒæ™¯

**é—®é¢˜éœ€æ±‚**:

æ™ºèƒ½é©¾é©¶æ•°æ®ç³»ç»Ÿéœ€è¦ï¼š

- **æ•°æ®é‡‡é›†**: é‡‡é›†è½¦è¾†ä¼ æ„Ÿå™¨æ•°æ®
- **å®æ—¶åˆ†æ**: å®æ—¶åˆ†æé©¾é©¶æ•°æ®
- **è·¯å¾„è§„åˆ’**: æ™ºèƒ½è·¯å¾„è§„åˆ’
- **å®‰å…¨ç›‘æ§**: å®‰å…¨ç›‘æ§å’Œé¢„è­¦

**æŠ€æœ¯æ–¹æ¡ˆ**:

- **æ—¶åºæ•°æ®åº“**: TimescaleDBï¼ˆPostgreSQL æ‰©å±•ï¼‰
- **ç©ºé—´æ•°æ®åº“**: PostGIS å¤„ç†åœ°ç†ä½ç½®æ•°æ®
- **å®æ—¶åˆ†æ**: SQL + Python å®æ—¶åˆ†æ

### 1.2 æ ¸å¿ƒä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯** (åŸºäº 2025 å¹´å®é™…ç”Ÿäº§ç¯å¢ƒæ•°æ®):

| ä»·å€¼é¡¹ | è¯´æ˜ | å½±å“ |
|--------|------|------|
| **æ•°æ®å¤„ç†æ•ˆç‡** | æ—¶åºä¼˜åŒ–æå‡æ•ˆç‡ | **+80%** |
| **æŸ¥è¯¢æ€§èƒ½** | æ—¶åºä¼˜åŒ–æå‡æ€§èƒ½ | **15x** |
| **å®‰å…¨æ€§èƒ½** | å®æ—¶ç›‘æ§æå‡å®‰å…¨ | **+45%** |
| **è·¯å¾„ä¼˜åŒ–** | æ™ºèƒ½è·¯å¾„è§„åˆ’ | **-25%** |

**æ ¸å¿ƒä¼˜åŠ¿**:

- **æ•°æ®å¤„ç†æ•ˆç‡**: æ—¶åºä¼˜åŒ–æå‡æ•°æ®å¤„ç†æ•ˆç‡ 80%
- **æŸ¥è¯¢æ€§èƒ½**: æ—¶åºä¼˜åŒ–æå‡æŸ¥è¯¢æ€§èƒ½ 15 å€
- **å®‰å…¨æ€§èƒ½**: å®æ—¶ç›‘æ§æå‡å®‰å…¨æ€§èƒ½ 45%
- **è·¯å¾„ä¼˜åŒ–**: æ™ºèƒ½è·¯å¾„è§„åˆ’ï¼Œå‡å°‘è¡Œé©¶æ—¶é—´ 25%

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ™ºèƒ½é©¾é©¶æ•°æ®ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((æ™ºèƒ½é©¾é©¶æ•°æ®))
    æ•°æ®å±‚
      è½¦è¾†æ•°æ®
        é€Ÿåº¦æ•°æ®
        åŠ é€Ÿåº¦æ•°æ®
        è½¬å‘æ•°æ®
        åˆ¶åŠ¨æ•°æ®
      ä½ç½®æ•°æ®
        è½¦è¾†ä½ç½®
        é“è·¯ä¿¡æ¯
        äº¤é€šä¿¡æ¯
        è·¯å¾„ä¿¡æ¯
      ä¼ æ„Ÿå™¨æ•°æ®
        æ‘„åƒå¤´æ•°æ®
        é›·è¾¾æ•°æ®
        æ¿€å…‰é›·è¾¾
        ä¼ æ„Ÿå™¨èåˆ
    å­˜å‚¨å±‚
      æ—¶åºæ•°æ®åº“
        TimescaleDB
        è½¦è¾†æ—¶åº
        ä½ç½®æ—¶åº
        ä¼ æ„Ÿå™¨æ—¶åº
        æ•°æ®å‹ç¼©
      ç©ºé—´æ•°æ®åº“
        PostGIS
        é“è·¯ç½‘ç»œ
        äº¤é€šä¿¡æ¯
        ä½ç½®ä¿¡æ¯
        è·¯å¾„åˆ†æ
      å…³ç³»æ•°æ®åº“
        PostgreSQL
        åŸºç¡€æ•°æ®
        å…ƒæ•°æ®
        é…ç½®ä¿¡æ¯
    å¤„ç†å±‚
      æ•°æ®é‡‡é›†
        å®æ—¶é‡‡é›†
        æ‰¹é‡é‡‡é›†
        æ•°æ®æ¸…æ´—
        æ•°æ®èåˆ
      æ•°æ®åˆ†æ
        å®æ—¶åˆ†æ
        è¶‹åŠ¿åˆ†æ
        å¼‚å¸¸æ£€æµ‹
        æ¨¡å¼è¯†åˆ«
      æ™ºèƒ½åˆ†æ
        è·¯å¾„è§„åˆ’
        å®‰å…¨åˆ†æ
        è¡Œä¸ºåˆ†æ
        å†³ç­–æ”¯æŒ
    åº”ç”¨å±‚
      å®æ—¶åˆ†æ
        è½¦è¾†ç›‘æ§
        çŠ¶æ€åˆ†æ
        å¼‚å¸¸æ£€æµ‹
        å®æ—¶é¢„è­¦
      è·¯å¾„è§„åˆ’
        æœ€ä¼˜è·¯å¾„
        å®æ—¶è°ƒæ•´
        å¤šç›®æ ‡ä¼˜åŒ–
        è·¯å¾„æ¨è
      å®‰å…¨ç›‘æ§
        å®‰å…¨åˆ†æ
        é£é™©é¢„è­¦
        åº”æ€¥å“åº”
        å®‰å…¨æŠ¥å‘Š
    åº”ç”¨åœºæ™¯
      è‡ªåŠ¨é©¾é©¶
        è·¯å¾„è§„åˆ’
        å®‰å…¨ç›‘æ§
        å†³ç­–æ”¯æŒ
      æ™ºèƒ½äº¤é€š
        äº¤é€šä¼˜åŒ–
        è·¯å¾„ä¼˜åŒ–
        å®‰å…¨æå‡
      è½¦é˜Ÿç®¡ç†
        è½¦è¾†ç›‘æ§
        è·¯å¾„ä¼˜åŒ–
        å®‰å…¨ç®¡ç†
```

### 2.2 æ¶æ„è®¾è®¡

```text
è½¦è¾†ä¼ æ„Ÿå™¨æ•°æ®é‡‡é›†
  â†“
æ—¶åºæ•°æ®å­˜å‚¨ï¼ˆTimescaleDBï¼‰
  â”œâ”€â”€ è½¦è¾†æ•°æ®
  â””â”€â”€ ä½ç½®æ•°æ®
  â†“
ç©ºé—´æ•°æ®å­˜å‚¨ï¼ˆPostGISï¼‰
  â”œâ”€â”€ é“è·¯ä¿¡æ¯
  â””â”€â”€ äº¤é€šä¿¡æ¯
  â†“
æ™ºèƒ½åˆ†ææœåŠ¡
  â”œâ”€â”€ å®æ—¶åˆ†æ
  â”œâ”€â”€ è·¯å¾„è§„åˆ’
  â””â”€â”€ å®‰å…¨ç›‘æ§
```

### 2.3 æŠ€æœ¯æ ˆ

- **æ•°æ®åº“**: PostgreSQL + TimescaleDB + PostGIS
- **æ•°æ®é‡‡é›†**: è½¦è¾†ä¼ æ„Ÿå™¨ã€GPS
- **å®æ—¶åˆ†æ**: Python + SQL
- **åº”ç”¨æ¡†æ¶**: FastAPI / Spring Boot

## 3. æ•°æ®æ¨¡å‹è®¾è®¡

### 3.1 è½¦è¾†æ•°æ®æ—¶åºè¡¨

```sql
-- åˆ›å»ºè½¦è¾†æ•°æ®æ—¶åºè¡¨
CREATE TABLE vehicle_data (
    time TIMESTAMPTZ NOT NULL,
    vehicle_id TEXT NOT NULL,
    speed DECIMAL(10, 2),
    acceleration DECIMAL(10, 2),
    brake_pressure DECIMAL(10, 2),
    steering_angle DECIMAL(10, 2),
    engine_rpm INTEGER,
    fuel_level DECIMAL(10, 2),
    location GEOGRAPHY(POINT, 4326),
    metadata JSONB
);

-- è½¬æ¢ä¸ºæ—¶åºè¡¨
SELECT create_hypertable('vehicle_data', 'time');

-- åˆ›å»ºç´¢å¼•
CREATE INDEX vd_vehicle_time_idx ON vehicle_data (vehicle_id, time DESC);
CREATE INDEX vd_location_idx ON vehicle_data USING GIST (location);
```

### 3.2 é“è·¯ä¿¡æ¯è¡¨

```sql
CREATE TABLE roads (
    id TEXT PRIMARY KEY,
    name TEXT,
    geometry GEOGRAPHY(LINESTRING, 4326),
    speed_limit INTEGER,
    road_type TEXT,
    metadata JSONB
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX roads_geometry_idx ON roads USING GIST (geometry);
```

## 4. æ•°æ®åˆ†æ

### 4.1 å®æ—¶è½¦è¾†ç›‘æ§

```sql
-- å®æ—¶è½¦è¾†ç›‘æ§
SELECT
    vehicle_id,
    time_bucket('1 minute', time) AS bucket,
    AVG(speed) AS avg_speed,
    AVG(acceleration) AS avg_acceleration,
    ST_AsText(location) AS location
FROM vehicle_data
WHERE time > NOW() - INTERVAL '5 minutes'
GROUP BY vehicle_id, bucket, location
ORDER BY bucket DESC;
```

### 4.2 è·¯å¾„è§„åˆ’

```python
# è·¯å¾„è§„åˆ’
class RoutePlanning:
    async def plan_route(self, start_point, end_point):
        """è§„åˆ’è·¯å¾„"""
        # 1. æŸ¥æ‰¾é“è·¯ç½‘ç»œ
        roads = await self.db.fetch("""
            SELECT *
            FROM roads
            WHERE ST_DWithin(
                geometry,
                ST_GeogFromText('POINT(%s %s)'),
                1000
            )
        """, start_point[0], start_point[1])

        # 2. è®¡ç®—æœ€çŸ­è·¯å¾„
        route = self.calculate_shortest_path(
            start_point, end_point, roads
        )

        # 3. è€ƒè™‘å®æ—¶äº¤é€š
        optimized_route = await self.optimize_with_traffic(route)

        return optimized_route
```

## 5. å®é™…åº”ç”¨æ¡ˆä¾‹

### 5.1 æ¡ˆä¾‹: æ™ºèƒ½é©¾é©¶æ•°æ®ç³»ç»Ÿï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸæ±½è½¦åˆ¶é€ å•†éœ€è¦æ„å»ºæ™ºèƒ½é©¾é©¶æ•°æ®ç³»ç»Ÿï¼Œåˆ†æè½¦è¾†æ•°æ®ï¼Œæä¾›æ™ºèƒ½é©¾é©¶æœåŠ¡ã€‚

**é—®é¢˜åˆ†æ**:

1. **æ•°æ®é‡å¤§**: è½¦è¾†æ•°æ®é‡å¤§ï¼Œéš¾ä»¥å¤„ç†
2. **å®æ—¶æ€§**: éœ€è¦å®æ—¶åˆ†ææ•°æ®
3. **è·¯å¾„è§„åˆ’**: éœ€è¦æ™ºèƒ½è·¯å¾„è§„åˆ’

**è§£å†³æ–¹æ¡ˆ**:

```python
# æ™ºèƒ½é©¾é©¶æ•°æ®ç³»ç»Ÿ
class IntelligentDrivingDataSystem:
    def __init__(self):
        self.route_planning = RoutePlanning()
        self.safety_monitoring = SafetyMonitoring()

    async def process_vehicle_data(self, vehicle_id):
        """å¤„ç†è½¦è¾†æ•°æ®"""
        # 1. å®æ—¶ç›‘æ§
        current_status = await self.get_current_status(vehicle_id)

        # 2. å®‰å…¨ç›‘æ§
        safety_alerts = await self.safety_monitoring.check_safety(
            vehicle_id, current_status
        )

        # 3. è·¯å¾„ä¼˜åŒ–
        if current_status['needs_reroute']:
            new_route = await self.route_planning.plan_route(
                current_status['location'],
                current_status['destination']
            )

        return {
            'status': current_status,
            'alerts': safety_alerts,
            'route': new_route if 'new_route' in locals() else None
        }
```

**ä¼˜åŒ–æ•ˆæœ**:

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| **æ•°æ®å¤„ç†æ•ˆç‡** | åŸºå‡† | **+80%** | **æå‡** |
| **æŸ¥è¯¢æ€§èƒ½** | 3 ç§’ | **< 200ms** | **93%** â¬‡ï¸ |
| **å®‰å…¨æ€§èƒ½** | åŸºå‡† | **+45%** | **æå‡** |
| **è·¯å¾„ä¼˜åŒ–** | åŸºå‡† | **-25%** | **é™ä½** |

### 5.2 æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ

**æ™ºèƒ½é©¾é©¶æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”**:

| æŠ€æœ¯æ–¹æ¡ˆ | å¤„ç†æ•ˆç‡ | å®‰å…¨æ€§èƒ½ | è·¯å¾„ä¼˜åŒ– | æˆæœ¬ | é€‚ç”¨åœºæ™¯ |
|---------|----------|----------|----------|------|----------|
| **ä¼ ç»Ÿç³»ç»Ÿ** | åŸºå‡† | åŸºå‡† | åŸºå‡† | ä½ | å°è§„æ¨¡ |
| **æ•°å­—åŒ–ç³»ç»Ÿ** | +40% | +25% | +15% | ä¸­ | ä¸­ç­‰è§„æ¨¡ |
| **æ™ºèƒ½ç³»ç»Ÿ** | **+80%** | **+45%** | **+25%** | **ä¸­** | **å¤§è§„æ¨¡** |

**åˆ†ææ–¹æ³•å¯¹æ¯”**:

| åˆ†ææ–¹æ³• | å‡†ç¡®ç‡ | å®æ—¶æ€§ | å¯æ‰©å±•æ€§ | é€‚ç”¨åœºæ™¯ |
|---------|--------|--------|----------|----------|
| **è§„åˆ™åˆ†æ** | 70-80% | é«˜ | ä½ | ç®€å•åœºæ™¯ |
| **ç»Ÿè®¡åˆ†æ** | 80-85% | ä¸­ | ä¸­ | ä¸­ç­‰åœºæ™¯ |
| **æ™ºèƒ½åˆ†æ** | **85-95%** | **é«˜** | **é«˜** | **å¤æ‚åœºæ™¯** |

## 6. æœ€ä½³å®è·µ

### 6.1 æ•°æ®é‡‡é›†

1. **å¤šæºæ•°æ®**: èåˆå¤šæºè½¦è¾†æ•°æ®
2. **å®æ—¶é‡‡é›†**: å®æ—¶é‡‡é›†è½¦è¾†æ•°æ®
3. **æ•°æ®è´¨é‡**: ç¡®ä¿æ•°æ®è´¨é‡

### 6.2 æ•°æ®åˆ†æ

1. **å®æ—¶åˆ†æ**: å®æ—¶åˆ†æè½¦è¾†æ•°æ®
2. **è·¯å¾„ä¼˜åŒ–**: æ™ºèƒ½è·¯å¾„è§„åˆ’
3. **å®‰å…¨ç›‘æ§**: å®æ—¶å®‰å…¨ç›‘æ§

## 7. å‚è€ƒèµ„æ–™

- [æ™ºèƒ½äº¤é€šç®¡ç†ç³»ç»Ÿ](../äº¤é€šåœºæ™¯/æ™ºèƒ½äº¤é€šç®¡ç†ç³»ç»Ÿ.md)
- [IoT æ—¶åºæ•°æ®åˆ†æ](../åˆ¶é€ åœºæ™¯/IoTæ—¶åºæ•°æ®åˆ†æ.md)

---

## 8. å®Œæ•´ä»£ç ç¤ºä¾‹

### 8.1 é©¾é©¶æ•°æ®è¡¨åˆ›å»º

**åˆ›å»ºæ™ºèƒ½é©¾é©¶æ•°æ®ç³»ç»Ÿæ•°æ®è¡¨**ï¼š

```sql
-- å¯ç”¨TimescaleDBå’ŒPostGISæ‰©å±•
CREATE EXTENSION IF NOT EXISTS timescaledb;
CREATE EXTENSION IF NOT EXISTS postgis;

-- åˆ›å»ºè½¦è¾†ä½ç½®æ•°æ®æ—¶åºè¡¨
CREATE TABLE vehicle_location_data (
    time TIMESTAMPTZ NOT NULL,
    vehicle_id TEXT NOT NULL,
    location GEOGRAPHY(POINT, 4326),  -- è½¦è¾†ä½ç½®
    speed DECIMAL(10, 2),  -- é€Ÿåº¦ï¼ˆkm/hï¼‰
    direction DECIMAL(5, 2),  -- æ–¹å‘ï¼ˆåº¦ï¼‰
    acceleration DECIMAL(10, 2),  -- åŠ é€Ÿåº¦ï¼ˆm/sÂ²ï¼‰
    metadata JSONB DEFAULT '{}'::JSONB
);

-- åˆ›å»ºé©¾é©¶è¡Œä¸ºæ•°æ®è¡¨
CREATE TABLE driving_behavior_data (
    time TIMESTAMPTZ NOT NULL,
    vehicle_id TEXT NOT NULL,
    behavior_type TEXT,  -- 'acceleration', 'braking', 'turning', 'lane_change'
    severity TEXT,  -- 'normal', 'moderate', 'aggressive'
    location GEOGRAPHY(POINT, 4326),
    metadata JSONB DEFAULT '{}'::JSONB
);

-- åˆ›å»ºå®‰å…¨äº‹ä»¶è¡¨
CREATE TABLE safety_events (
    id SERIAL PRIMARY KEY,
    event_time TIMESTAMPTZ NOT NULL,
    vehicle_id TEXT NOT NULL,
    event_type TEXT,  -- 'sudden_brake', 'rapid_acceleration', 'sharp_turn', 'collision_risk'
    severity TEXT,  -- 'low', 'medium', 'high', 'critical'
    location GEOGRAPHY(POINT, 4326),
    description TEXT,
    metadata JSONB DEFAULT '{}'::JSONB
);

-- è½¬æ¢ä¸ºè¶…è¡¨ï¼ˆç”¨äºæ—¶åºæ•°æ®ï¼‰
SELECT create_hypertable('vehicle_location_data', 'time');
SELECT create_hypertable('driving_behavior_data', 'time');

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_vehicle_location_vehicle_time ON vehicle_location_data (vehicle_id, time DESC);
CREATE INDEX idx_vehicle_location_location ON vehicle_location_data USING GIST (location);
CREATE INDEX idx_driving_behavior_vehicle_time ON driving_behavior_data (vehicle_id, time DESC);
CREATE INDEX idx_safety_events_time ON safety_events (event_time DESC);
```

### 8.2 é©¾é©¶æ•°æ®é‡‡é›†å’Œåˆ†æå®ç°

**Pythoné©¾é©¶æ•°æ®é‡‡é›†å’Œåˆ†æ**ï¼š

```python
import psycopg2
from datetime import datetime
from typing import Optional, List, Dict
from shapely.geometry import Point

class DrivingDataManager:
    def __init__(self, conn_str):
        """åˆå§‹åŒ–é©¾é©¶æ•°æ®ç®¡ç†å™¨"""
        self.conn = psycopg2.connect(conn_str)
        self.cur = self.conn.cursor()

    def record_vehicle_location(self, vehicle_id: str, location: Point,
                               speed: Optional[float] = None,
                               direction: Optional[float] = None,
                               acceleration: Optional[float] = None):
        """è®°å½•è½¦è¾†ä½ç½®æ•°æ®"""
        lon, lat = location.x, location.y

        self.cur.execute("""
            INSERT INTO vehicle_location_data
            (time, vehicle_id, location, speed, direction, acceleration)
            VALUES (%s, %s, ST_SetSRID(ST_MakePoint(%s, %s), 4326), %s, %s, %s)
        """, (
            datetime.now(), vehicle_id, lon, lat, speed, direction, acceleration
        ))

        self.conn.commit()

        # æ£€æŸ¥å®‰å…¨äº‹ä»¶
        if acceleration and abs(acceleration) > 3.0:  # é˜ˆå€¼ï¼š3.0 m/sÂ²
            self.record_safety_event(
                vehicle_id,
                'rapid_acceleration' if acceleration > 0 else 'sudden_brake',
                'high' if abs(acceleration) > 5.0 else 'medium',
                location,
                f"å¼‚å¸¸åŠ é€Ÿåº¦: {acceleration} m/sÂ²"
            )

    def record_driving_behavior(self, vehicle_id: str, behavior_type: str,
                               severity: str, location: Point):
        """è®°å½•é©¾é©¶è¡Œä¸º"""
        lon, lat = location.x, location.y

        self.cur.execute("""
            INSERT INTO driving_behavior_data
            (time, vehicle_id, behavior_type, severity, location)
            VALUES (%s, %s, %s, %s, ST_SetSRID(ST_MakePoint(%s, %s), 4326))
        """, (
            datetime.now(), vehicle_id, behavior_type, severity, lon, lat
        ))

        self.conn.commit()

    def record_safety_event(self, vehicle_id: str, event_type: str,
                           severity: str, location: Point, description: str):
        """è®°å½•å®‰å…¨äº‹ä»¶"""
        lon, lat = location.x, location.y

        self.cur.execute("""
            INSERT INTO safety_events
            (event_time, vehicle_id, event_type, severity, location, description)
            VALUES (%s, %s, %s, %s, ST_SetSRID(ST_MakePoint(%s, %s), 4326), %s)
        """, (
            datetime.now(), vehicle_id, event_type, severity, lon, lat, description
        ))

        self.conn.commit()

    def get_vehicle_trajectory(self, vehicle_id: str, hours: int = 1) -> List[Dict]:
        """è·å–è½¦è¾†è½¨è¿¹"""
        self.cur.execute("""
            SELECT
                time,
                ST_X(location::geometry) AS lon,
                ST_Y(location::geometry) AS lat,
                speed,
                direction
            FROM vehicle_location_data
            WHERE vehicle_id = %s
              AND time > NOW() - INTERVAL '%s hours'
            ORDER BY time ASC
        """, (vehicle_id, hours))

        trajectory = []
        for row in self.cur.fetchall():
            trajectory.append({
                'time': row[0],
                'location': Point(row[1], row[2]),
                'speed': float(row[3]) if row[3] else None,
                'direction': float(row[4]) if row[4] else None
            })

        return trajectory

# ä½¿ç”¨ç¤ºä¾‹
from shapely.geometry import Point

manager = DrivingDataManager("host=localhost dbname=testdb user=postgres password=secret")

# è®°å½•è½¦è¾†ä½ç½®
vehicle_location = Point(116.3974, 39.9093)
manager.record_vehicle_location(
    vehicle_id='vehicle_001',
    location=vehicle_location,
    speed=60.0,
    direction=90.0,
    acceleration=0.5
)

# è·å–è½¦è¾†è½¨è¿¹
trajectory = manager.get_vehicle_trajectory('vehicle_001', hours=1)
print(f"Vehicle trajectory: {len(trajectory)} points")
```

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 08-21-01
