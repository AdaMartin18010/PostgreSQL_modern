# PostgreSQL 18 äº‘åŸç”Ÿå­˜å‚¨å¼•æ“é€‚é…æŒ‡å—

> **ç‰ˆæœ¬**: PostgreSQL 18
> **æ›´æ–°æ—¶é—´**: 2025å¹´12æœˆ4æ—¥
> **æ–‡æ¡£ç¼–å·**: PG18-DOC-28
> **éš¾åº¦**: â­â­â­â­â­

---

## ğŸ“‘ ç›®å½•

- [PostgreSQL 18 äº‘åŸç”Ÿå­˜å‚¨å¼•æ“é€‚é…æŒ‡å—](#postgresql-18-äº‘åŸç”Ÿå­˜å‚¨å¼•æ“é€‚é…æŒ‡å—)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. äº‘åŸç”Ÿå­˜å‚¨æ¶æ„](#1-äº‘åŸç”Ÿå­˜å‚¨æ¶æ„)
    - [1.1 ä¼ ç»Ÿæ¶æ„ vs äº‘åŸç”Ÿæ¶æ„](#11-ä¼ ç»Ÿæ¶æ„-vs-äº‘åŸç”Ÿæ¶æ„)
    - [1.2 å­˜å‚¨è®¡ç®—åˆ†ç¦»](#12-å­˜å‚¨è®¡ç®—åˆ†ç¦»)
  - [2. PostgreSQLå­˜å‚¨å¼•æ“è§£æ](#2-postgresqlå­˜å‚¨å¼•æ“è§£æ)
    - [2.1 å­˜å‚¨ç®¡ç†å™¨æ¶æ„](#21-å­˜å‚¨ç®¡ç†å™¨æ¶æ„)
    - [2.2 Pluggable Storageå¯æ’æ‹”å­˜å‚¨](#22-pluggable-storageå¯æ’æ‹”å­˜å‚¨)
  - [3. äº‘å­˜å‚¨é€‚é…](#3-äº‘å­˜å‚¨é€‚é…)
    - [3.1 S3å¯¹è±¡å­˜å‚¨é€‚é…](#31-s3å¯¹è±¡å­˜å‚¨é€‚é…)
    - [3.2 EBSå—å­˜å‚¨ä¼˜åŒ–](#32-ebså—å­˜å‚¨ä¼˜åŒ–)
    - [3.3 Azure Diskä¼˜åŒ–](#33-azure-diskä¼˜åŒ–)
  - [4. Neonå­˜å‚¨å¼•æ“è§£æ](#4-neonå­˜å‚¨å¼•æ“è§£æ)
    - [4.1 Neonæ¶æ„](#41-neonæ¶æ„)
    - [4.2 åˆ†æ”¯ä¸æ—¶é—´æ—…è¡Œ](#42-åˆ†æ”¯ä¸æ—¶é—´æ—…è¡Œ)
    - [4.3 Serverlesså†·å¯åŠ¨ä¼˜åŒ–](#43-serverlesså†·å¯åŠ¨ä¼˜åŒ–)
  - [5. Auroraå­˜å‚¨å¼•æ“è§£æ](#5-auroraå­˜å‚¨å¼•æ“è§£æ)
    - [5.1 Auroraæ¶æ„](#51-auroraæ¶æ„)
    - [5.2 æ—¥å¿—å³æ•°æ®åº“](#52-æ—¥å¿—å³æ•°æ®åº“)
    - [5.3 æ€§èƒ½å¯¹æ¯”](#53-æ€§èƒ½å¯¹æ¯”)
  - [6. AlloyDBå­˜å‚¨å¼•æ“](#6-alloydbå­˜å‚¨å¼•æ“)
    - [6.1 åˆ—å¼å­˜å‚¨é›†æˆ](#61-åˆ—å¼å­˜å‚¨é›†æˆ)
    - [6.2 æ™ºèƒ½ç¼“å­˜](#62-æ™ºèƒ½ç¼“å­˜)
  - [7. æ€§èƒ½ä¼˜åŒ–ä¸æˆæœ¬åˆ†æ](#7-æ€§èƒ½ä¼˜åŒ–ä¸æˆæœ¬åˆ†æ)
    - [7.1 IOPSä¼˜åŒ–](#71-iopsä¼˜åŒ–)
    - [7.2 ååé‡ä¼˜åŒ–](#72-ååé‡ä¼˜åŒ–)
    - [7.3 æˆæœ¬ä¼˜åŒ–](#73-æˆæœ¬ä¼˜åŒ–)
  - [8. å­˜å‚¨å¼•æ“é€‰å‹](#8-å­˜å‚¨å¼•æ“é€‰å‹)
    - [8.1 é€‰å‹å†³ç­–æ ‘](#81-é€‰å‹å†³ç­–æ ‘)
    - [8.2 æˆæœ¬å¯¹æ¯”](#82-æˆæœ¬å¯¹æ¯”)
  - [9. ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ](#9-ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ)
    - [9.1 æ··åˆå­˜å‚¨æ¶æ„](#91-æ··åˆå­˜å‚¨æ¶æ„)
    - [9.2 ç¾å¤‡ç­–ç•¥](#92-ç¾å¤‡ç­–ç•¥)
  - [10. æœªæ¥å‘å±•æ–¹å‘](#10-æœªæ¥å‘å±•æ–¹å‘)
    - [10.1 å­˜å‚¨å¼•æ“å‘å±•è¶‹åŠ¿](#101-å­˜å‚¨å¼•æ“å‘å±•è¶‹åŠ¿)
    - [10.2 PostgreSQL Roadmap](#102-postgresql-roadmap)
  - [æ€»ç»“](#æ€»ç»“)
    - [PostgreSQL 18äº‘åŸç”Ÿå­˜å‚¨æ ¸å¿ƒä»·å€¼](#postgresql-18äº‘åŸç”Ÿå­˜å‚¨æ ¸å¿ƒä»·å€¼)

---

## 1. äº‘åŸç”Ÿå­˜å‚¨æ¶æ„

### 1.1 ä¼ ç»Ÿæ¶æ„ vs äº‘åŸç”Ÿæ¶æ„

```mermaid
graph TB
    subgraph ä¼ ç»Ÿæ¶æ„
        A1[PostgreSQLå®ä¾‹] --> B1[æœ¬åœ°ç£ç›˜<br/>RAID SSD]
        B1 --> C1[å¤‡ä»½<br/>pg_dump]
        C1 --> D1[ç¦»çº¿å­˜å‚¨]
    end

    subgraph äº‘åŸç”Ÿæ¶æ„
        A2[PostgreSQLè®¡ç®—èŠ‚ç‚¹] --> B2[äº‘å­˜å‚¨å±‚]
        B2 --> C2[S3å¯¹è±¡å­˜å‚¨]
        B2 --> C3[EBSå—å­˜å‚¨]
        B2 --> C4[è‡ªåŠ¨å¤‡ä»½]

        A2 -.åªè¯»å‰¯æœ¬.-> A3[åªè¯»èŠ‚ç‚¹1]
        A2 -.åªè¯»å‰¯æœ¬.-> A4[åªè¯»èŠ‚ç‚¹N]

        A3 --> B2
        A4 --> B2
    end

    style A2 fill:#4ecdc4,color:#fff
    style B2 fill:#95e1d3,color:#000
```

**å¯¹æ¯”åˆ†æ**ï¼š

| ç»´åº¦ | ä¼ ç»Ÿæ¶æ„ | äº‘åŸç”Ÿæ¶æ„ | ä¼˜åŠ¿ |
|-----|---------|-----------|------|
| **æ‰©å±•æ€§** | å‚ç›´æ‰©å±•ï¼ˆå‡çº§ç¡¬ä»¶ï¼‰ | æ°´å¹³æ‰©å±•ï¼ˆå¢åŠ èŠ‚ç‚¹ï¼‰ | **äº‘åŸç”Ÿ** |
| **æˆæœ¬** | å‰æœŸæŠ•å…¥é«˜ | æŒ‰éœ€ä»˜è´¹ | **äº‘åŸç”Ÿ** |
| **å¤‡ä»½** | æ‰‹åŠ¨è„šæœ¬ | è‡ªåŠ¨å¿«ç…§ | **äº‘åŸç”Ÿ** |
| **æ•…éšœæ¢å¤** | RTO 30-60åˆ†é’Ÿ | RTO <5åˆ†é’Ÿ | **äº‘åŸç”Ÿ** |
| **åªè¯»å‰¯æœ¬** | é€»è¾‘å¤åˆ¶ï¼ˆå»¶è¿Ÿé«˜ï¼‰ | å…±äº«å­˜å‚¨ï¼ˆå»¶è¿Ÿä½ï¼‰ | **äº‘åŸç”Ÿ** |
| **æ€§èƒ½** | æœ¬åœ°SSDå¿« | ç½‘ç»œå»¶è¿Ÿ | **ä¼ ç»Ÿ** |
| **å¯æ§æ€§** | å®Œå…¨æ§åˆ¶ | æ‰˜ç®¡æœåŠ¡ | **ä¼ ç»Ÿ** |

### 1.2 å­˜å‚¨è®¡ç®—åˆ†ç¦»

**Aurora/Neonæ¶æ„æ ¸å¿ƒ**ï¼š

```mermaid
sequenceDiagram
    participant Compute as è®¡ç®—èŠ‚ç‚¹<br/>(PostgreSQL)
    participant Cache as ç¼“å­˜å±‚<br/>(SSD Cache)
    participant Storage as å­˜å‚¨å±‚<br/>(S3/åˆ†å¸ƒå¼å­˜å‚¨)

    Compute->>Cache: 1. è¯»å–Pageè¯·æ±‚

    alt ç¼“å­˜å‘½ä¸­
        Cache-->>Compute: 2a. è¿”å›Pageï¼ˆå¿«ï¼‰
    else ç¼“å­˜æœªå‘½ä¸­
        Cache->>Storage: 2b. ä»å­˜å‚¨è¯»å–
        Storage-->>Cache: 3. è¿”å›Page
        Cache-->>Compute: 4. è¿”å›Pageï¼ˆæ…¢ï¼‰
    end

    Compute->>Cache: 5. å†™å…¥Pageï¼ˆå¼‚æ­¥ï¼‰
    Cache->>Storage: 6. åˆ·ç›˜åˆ°å­˜å‚¨ï¼ˆæ‰¹é‡ï¼‰

    Note over Compute,Storage: ä¼˜åŠ¿ï¼š<br/>1. è®¡ç®—èŠ‚ç‚¹æ— çŠ¶æ€<br/>2. å­˜å‚¨å¼¹æ€§æ‰©å±•<br/>3. ç§’çº§åªè¯»å‰¯æœ¬
```

---

## 2. PostgreSQLå­˜å‚¨å¼•æ“è§£æ

### 2.1 å­˜å‚¨ç®¡ç†å™¨æ¶æ„

```c
// PostgreSQLå­˜å‚¨ç®¡ç†å™¨æ¥å£ï¼ˆç®€åŒ–ï¼‰
// src/include/access/tableam.h

typedef struct TableAmRoutine
{
    // è¡¨æ‰«æ
    TableScanDesc (*scan_begin)(Relation relation, ...);
    bool (*scan_getnextslot)(TableScanDesc scan, ...);
    void (*scan_end)(TableScanDesc scan);

    // å…ƒç»„æ“ä½œ
    void (*tuple_insert)(Relation relation, ...);
    void (*tuple_delete)(Relation relation, ...);
    void (*tuple_update)(Relation relation, ...);

    // ç´¢å¼•æ”¯æŒ
    bool (*index_fetch_tuple)(struct IndexFetchTableData *scan, ...);

    // VACUUM
    void (*relation_vacuum)(Relation rel, ...);

    // ...æ›´å¤šæ–¹æ³•
} TableAmRoutine;

// é»˜è®¤å®ç°ï¼šHeapå­˜å‚¨
const TableAmRoutine heap_tableam = {
    .scan_begin = heap_beginscan,
    .scan_getnextslot = heap_getnextslot,
    .tuple_insert = heap_insert,
    // ...
};

// è‡ªå®šä¹‰å­˜å‚¨å¼•æ“ï¼ˆç†è®ºä¸Šå¯å®ç°ï¼‰
const TableAmRoutine columnar_tableam = {
    .scan_begin = columnar_beginscan,
    .scan_getnextslot = columnar_getnextslot,
    .tuple_insert = columnar_insert,
    // ...
};
```

### 2.2 Pluggable Storageå¯æ’æ‹”å­˜å‚¨

**PostgreSQL 12+å¼•å…¥ï¼Œä½†ç”Ÿæ€å°šæœªæˆç†Ÿ**ï¼š

```sql
-- åˆ›å»ºä½¿ç”¨è‡ªå®šä¹‰å­˜å‚¨å¼•æ“çš„è¡¨ï¼ˆç†è®ºï¼‰
CREATE TABLE columnar_data (
    id INT,
    value TEXT
) USING columnar;  -- â† æŒ‡å®šå­˜å‚¨å¼•æ“

-- å½“å‰æ”¯æŒçš„å­˜å‚¨å¼•æ“ï¼š
-- 1. heapï¼ˆé»˜è®¤ï¼‰
-- 2. columnarï¼ˆCitusæä¾›ï¼‰
-- 3. zedstoreï¼ˆå®éªŒæ€§ï¼Œåˆ—å¼å­˜å‚¨ï¼‰
-- 4. zheapï¼ˆå®éªŒæ€§ï¼Œundoæ—¥å¿—MVCCï¼‰

-- æŸ¥çœ‹è¡¨çš„å­˜å‚¨å¼•æ“
SELECT
    relname,
    amname AS access_method
FROM pg_class c
JOIN pg_am am ON c.relam = am.oid
WHERE relname = 'my_table';
```

---

## 3. äº‘å­˜å‚¨é€‚é…

### 3.1 S3å¯¹è±¡å­˜å‚¨é€‚é…

**ä½¿ç”¨s3_fdwå¤–éƒ¨è¡¨**ï¼š

```sql
-- æ€§èƒ½æµ‹è¯•ï¼šå®‰è£…s3_fdwï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
CREATE EXTENSION IF NOT EXISTS s3_fdw;
COMMIT;
EXCEPTION
    WHEN duplicate_object THEN
        RAISE NOTICE 'æ‰©å±•s3_fdwå·²å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE NOTICE 'å®‰è£…s3_fdwæ‰©å±•å¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;

-- æ€§èƒ½æµ‹è¯•ï¼šåˆ›å»ºS3æœåŠ¡å™¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
DROP SERVER IF EXISTS s3_server CASCADE;
CREATE SERVER s3_server
FOREIGN DATA WRAPPER s3_fdw
OPTIONS (
    endpoint 's3.amazonaws.com',
    region 'us-east-1'
);
COMMIT;
EXCEPTION
    WHEN undefined_object THEN
        RAISE NOTICE 's3_fdwæœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£…æ‰©å±•';
    WHEN OTHERS THEN
        RAISE NOTICE 'åˆ›å»ºS3æœåŠ¡å™¨å¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;

-- æ€§èƒ½æµ‹è¯•ï¼šåˆ›å»ºç”¨æˆ·æ˜ å°„ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
DROP USER MAPPING IF EXISTS FOR postgres SERVER s3_server;
CREATE USER MAPPING FOR postgres
SERVER s3_server
OPTIONS (
    access_key_id 'AKIAXXXXXXXX',
    secret_access_key 'xxxxxx'
);
COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        RAISE NOTICE 'åˆ›å»ºç”¨æˆ·æ˜ å°„å¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;

-- æ€§èƒ½æµ‹è¯•ï¼šåˆ›å»ºå¤–éƒ¨è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
DROP FOREIGN TABLE IF EXISTS s3_logs;
CREATE FOREIGN TABLE s3_logs (
    log_time TIMESTAMPTZ,
    user_id INT,
    event_type TEXT,
    data JSONB
) SERVER s3_server
OPTIONS (
    bucket 'my-company-logs',
    prefix 'postgresql/',
    format 'parquet'  -- æˆ–'csv', 'json'
);
COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        RAISE NOTICE 'åˆ›å»ºå¤–éƒ¨è¡¨å¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;

-- æ€§èƒ½æµ‹è¯•ï¼šæŸ¥è¯¢S3æ•°æ®ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½åˆ†æï¼‰
BEGIN;
EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT * FROM s3_logs
WHERE log_time >= '2024-12-01'
LIMIT 100;
COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        RAISE NOTICE 'æŸ¥è¯¢S3æ•°æ®å¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;

-- æ€§èƒ½æµ‹è¯•ï¼šæ··åˆæŸ¥è¯¢ï¼ˆå¸¦é”™è¯¯å¤„ç†å’Œæ€§èƒ½åˆ†æï¼‰
BEGIN;
EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT
    s.user_id,
    u.username,
    COUNT(*) AS event_count
FROM s3_logs s
JOIN users u ON s.user_id = u.user_id
WHERE s.log_time >= '2024-12-01'
GROUP BY s.user_id, u.username;
COMMIT;
EXCEPTION
    WHEN undefined_table THEN
        RAISE NOTICE 'è¡¨s3_logsæˆ–usersä¸å­˜åœ¨';
    WHEN OTHERS THEN
        RAISE NOTICE 'æ··åˆæŸ¥è¯¢å¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;
```

**S3æ€§èƒ½ä¼˜åŒ–**ï¼š

```sql
-- æ€§èƒ½æµ‹è¯•ï¼šä¼˜åŒ–1ï¼šåˆ†åŒºè£å‰ªï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
DROP FOREIGN TABLE IF EXISTS s3_logs_partitioned;
CREATE FOREIGN TABLE s3_logs_partitioned (
    log_time TIMESTAMPTZ,
    user_id INT,
    event_type TEXT
) SERVER s3_server
OPTIONS (
    bucket 'my-logs',
    prefix 'year=2024/month=12/day=01/',  -- â† åˆ†åŒºè·¯å¾„
    format 'parquet'
);
COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        RAISE NOTICE 'åˆ›å»ºåˆ†åŒºå¤–éƒ¨è¡¨å¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;
-- ä¼˜åŒ–2ï¼šåˆ—å¼å­˜å‚¨ï¼ˆParquetï¼‰
-- Parquetå­˜å‚¨ä¼˜åŠ¿ï¼š
-- - ä»…è¯»å–éœ€è¦çš„åˆ—
-- - é«˜å‹ç¼©ç‡ï¼ˆ-80%ï¼‰
-- - æ›´å¥½çš„è°“è¯ä¸‹æ¨

-- æ€§èƒ½æµ‹è¯•ï¼šä¼˜åŒ–3ï¼šå¹¶è¡Œè¯»å–ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
BEGIN;
SET max_parallel_workers_per_gather = 8;
COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        RAISE NOTICE 'è®¾ç½®å¹¶è¡Œworkeræ•°å¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;

BEGIN;
EXPLAIN (ANALYZE, BUFFERS, TIMING)
SELECT COUNT(*) FROM s3_logs_partitioned;
-- Parallel Seq Scan on s3_logs_partitioned
-- Workers: 8ï¼ˆæ¯ä¸ªworkerè¯»å–ä¸åŒS3å¯¹è±¡ï¼‰
COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        RAISE NOTICE 'å¹¶è¡Œè¯»å–S3æ•°æ®å¤±è´¥: %', SQLERRM;
        ROLLBACK;
        RAISE;
```

### 3.2 EBSå—å­˜å‚¨ä¼˜åŒ–

**AWS EBSé…ç½®ä¼˜åŒ–**ï¼š

```yaml
EBSå·ç±»å‹é€‰æ‹©:

  gp3 (é€šç”¨SSD):
    - åŸºå‡†: 3000 IOPS, 125 MB/s
    - å¯æ‰©å±•: 16000 IOPS, 1000 MB/s
    - ä»·æ ¼: $0.08/GB/æœˆ
    - æ¨è: ä¸­å°è§„æ¨¡æ•°æ®åº“

  io2 Block Express (é«˜æ€§èƒ½):
    - IOPS: æœ€é«˜256000
    - åå: 4000 MB/s
    - å»¶è¿Ÿ: <0.25ms
    - ä»·æ ¼: $0.125/GB/æœˆ + $0.065/IOPS/æœˆ
    - æ¨è: å¤§å‹OLTPæ•°æ®åº“

  st1 (ååä¼˜åŒ–HDD):
    - åå: 500 MB/s
    - ä»·æ ¼: $0.045/GB/æœˆ
    - æ¨è: æ•°æ®ä»“åº“ã€å½’æ¡£
```

**PostgreSQL 18 + EBSä¼˜åŒ–é…ç½®**ï¼š

```sql
-- EBSä¼˜åŒ–é…ç½®ï¼ˆgp3ï¼‰
-- postgresql.conf

-- 1. IOPSé…ç½®
shared_buffers = '32GB'  -- 25%å†…å­˜
effective_cache_size = '96GB'  -- 75%å†…å­˜
random_page_cost = 1.1  -- SSD
seq_page_cost = 1.0

-- 2. å†™å…¥ä¼˜åŒ–
wal_buffers = '128MB'
checkpoint_timeout = '15min'
max_wal_size = '8GB'
checkpoint_completion_target = 0.9

-- 3. AIOé…ç½®ï¼ˆPostgreSQL 18ï¼‰
aio = on
aio_max_workers = 64  -- EBSæ”¯æŒé«˜å¹¶å‘I/O
io_direct = on  -- ç»•è¿‡OSç¼“å­˜ï¼Œç›´æ¥I/O

-- 4. WALé…ç½®ï¼ˆç‹¬ç«‹EBSå·ï¼‰
# å°†pg_walç§»åˆ°ç‹¬ç«‹EBSå·
# mount /dev/xvdf /var/lib/postgresql/18/wal
# ln -s /var/lib/postgresql/18/wal /var/lib/postgresql/18/main/pg_wal
```

**æ€§èƒ½æµ‹è¯•**ï¼ˆgp3 vs io2ï¼‰ï¼š

| æµ‹è¯• | gp3 (3000 IOPS) | io2 (16000 IOPS) | æå‡ |
|-----|----------------|-----------------|------|
| **pgbench TPS** | 5,200 | 18,500 | **+256%** |
| **å¤§æŸ¥è¯¢ï¼ˆ10GBæ‰«æï¼‰** | 45s | 15s | **+200%** |
| **VACUUMå¤§è¡¨** | 25åˆ†é’Ÿ | 8åˆ†é’Ÿ | **+212%** |
| **æˆæœ¬/æœˆï¼ˆ1TBï¼‰** | $80 | $125 + $1040 = $1165 | **+1356%** |

### 3.3 Azure Diskä¼˜åŒ–

```yaml
Azure Managed Diskç±»å‹:

  Premium SSD v2:
    - IOPS: æœ€é«˜80000
    - åå: 1200 MB/s
    - æ€§èƒ½: ä¸io2ç›¸å½“
    - ä»·æ ¼: æŒ‰å®¹é‡+IOPSç‹¬ç«‹è®¡è´¹

  Ultra Disk:
    - IOPS: æœ€é«˜160000
    - åå: 4000 MB/s
    - å»¶è¿Ÿ: <1ms
    - ä»·æ ¼: æœ€è´µ
    - æ¨è: æè‡´æ€§èƒ½éœ€æ±‚

PostgreSQLé…ç½®:
  # ä¸EBSç±»ä¼¼
  random_page_cost = 1.1
  effective_io_concurrency = 200
  aio = on
```

---

## 4. Neonå­˜å‚¨å¼•æ“è§£æ

### 4.1 Neonæ¶æ„

```mermaid
graph TB
    A[Neonæ¶æ„] --> B[è®¡ç®—å±‚<br/>Compute Nodes]
    A --> C[å­˜å‚¨å±‚<br/>Pageserver]
    A --> D[æŒä¹…å±‚<br/>S3]

    B --> B1[PostgreSQLå®ä¾‹<br/>æ— çŠ¶æ€]
    B --> B2[æœ¬åœ°SSDç¼“å­˜]

    C --> C1[Pageç‰ˆæœ¬ç®¡ç†]
    C --> C2[åˆ†æ”¯ç®¡ç†]
    C --> C3[å†™å…¥æ”¾å¤§ä¼˜åŒ–]

    D --> D1[WALå­˜å‚¨]
    D --> D2[Pageå­˜å‚¨]
    D --> D3[å¿«ç…§å­˜å‚¨]

    B1 -.WALå†™å…¥.-> C
    B1 -.Pageè¯»å–.-> C
    C -.æŒä¹…åŒ–.-> D

    style A fill:#ff6b6b,color:#fff
    style C fill:#4ecdc4,color:#fff
```

**Neonæ ¸å¿ƒç‰¹æ€§**ï¼š

1. **ç§’çº§åˆ†æ”¯**ï¼š

    ```sql
    -- Neon CLI
    neonctl branches create --name dev_branch --parent main
    -- åˆ›å»ºæ—¶é—´ï¼š<1ç§’ï¼ˆåŸºäºå†™æ—¶å¤åˆ¶ï¼‰

    -- åˆ†æ”¯ä¹‹é—´ç‹¬ç«‹
    -- mainåˆ†æ”¯ï¼šç”Ÿäº§æ•°æ®
    -- dev_branchï¼šå¼€å‘æµ‹è¯•ï¼Œä¿®æ”¹ä¸å½±å“main
    ```

2. **æ—¶é—´æ—…è¡Œ**ï¼š

    ```sql
    -- å›åˆ°ä»»æ„æ—¶é—´ç‚¹ï¼ˆæ— éœ€PITRï¼‰
    neonctl branches create --name debug_branch --parent main --timestamp '2024-12-04 10:00:00'

    -- è¿æ¥åˆ°å†å²æ—¶é—´ç‚¹åˆ†æ”¯
    psql postgresql://...@debug_branch.neon.tech/mydb
    SELECT * FROM orders WHERE order_id = 12345;
    -- æŸ¥çœ‹10:00æ—¶åˆ»çš„æ•°æ®çŠ¶æ€
    ```

3. **å†·å¯åŠ¨ä¼˜åŒ–**ï¼š

    ```yaml
    Serverlesså†·å¯åŠ¨ï¼ˆNeonï¼‰:
      ä¼ ç»ŸPostgreSQL:
        - å¯åŠ¨æ—¶é—´: 10-30ç§’
        - éœ€è¦: åŠ è½½shared_buffersã€é¢„çƒ­ç¼“å­˜

      Neon:
        - å¯åŠ¨æ—¶é—´: <1ç§’
        - åŸç†: è®¡ç®—èŠ‚ç‚¹æ— çŠ¶æ€ï¼ŒPageæŒ‰éœ€ä»Pageserveræ‹‰å–
        - æ€§èƒ½: é¦–æ¬¡æŸ¥è¯¢å¯èƒ½æ…¢ï¼ˆç¼“å­˜missï¼‰ï¼Œåç»­æ­£å¸¸
    ```

### 4.2 åˆ†æ”¯ä¸æ—¶é—´æ—…è¡Œ

```bash
# å®Œæ•´çš„Neonå·¥ä½œæµ

# 1. åˆ›å»ºé¡¹ç›®
neonctl projects create --name my-project

# 2. ä¸»åˆ†æ”¯ï¼ˆç”Ÿäº§ï¼‰
neonctl branches list
# main (primary)

# 3. åˆ›å»ºå¼€å‘åˆ†æ”¯
neonctl branches create --name dev --parent main

# 4. å¼€å‘åˆ†æ”¯æµ‹è¯•ï¼ˆç ´åæ€§æ“ä½œï¼‰
psql postgresql://...@dev.neon.tech/mydb
DELETE FROM users WHERE created_at < '2023-01-01';  -- åˆ é™¤æ—§ç”¨æˆ·
-- ä»…å½±å“devåˆ†æ”¯ï¼Œmainåˆ†æ”¯æ•°æ®å®Œæ•´

# 5. æµ‹è¯•å®Œæˆååˆ é™¤åˆ†æ”¯
neonctl branches delete dev
-- å­˜å‚¨è‡ªåŠ¨å›æ”¶ï¼ˆå†™æ—¶å¤åˆ¶ï¼Œæœªä¿®æ”¹çš„Pageå…±äº«ï¼‰

# 6. ç”Ÿäº§é—®é¢˜è°ƒè¯•ï¼ˆæ—¶é—´æ—…è¡Œï¼‰
neonctl branches create --name debug --parent main --timestamp '2024-12-04 09:00:00'
psql postgresql://...@debug.neon.tech/mydb
-- æŸ¥çœ‹09:00æ—¶åˆ»çš„æ•°æ®çŠ¶æ€ï¼Œå®šä½é—®é¢˜
```

### 4.3 Serverlesså†·å¯åŠ¨ä¼˜åŒ–

**Neon vs ä¼ ç»ŸServerless PostgreSQL**ï¼š

| æŒ‡æ ‡ | ä¼ ç»ŸServerless | Neon | æå‡ |
|-----|---------------|------|------|
| **å†·å¯åŠ¨æ—¶é—´** | 15-30s | <1s | **+95%** |
| **é¦–æ¬¡æŸ¥è¯¢** | æ­£å¸¸ | +50msï¼ˆç¼“å­˜é¢„çƒ­ï¼‰ | å¯æ¥å— |
| **åç»­æŸ¥è¯¢** | æ­£å¸¸ | æ­£å¸¸ | ç›¸åŒ |
| **è®¡è´¹ç²’åº¦** | æŒ‰åˆ†é’Ÿ | æŒ‰ç§’ | æ›´ç²¾ç»† |

---

## 5. Auroraå­˜å‚¨å¼•æ“è§£æ

### 5.1 Auroraæ¶æ„

**AWS Aurora for PostgreSQL**ï¼š

```mermaid
graph TB
    A[Auroraæ¶æ„] --> B[è®¡ç®—å±‚]
    A --> C[å­˜å‚¨å±‚<br/>Aurora Storage]

    B --> B1[ä¸»èŠ‚ç‚¹<br/>Read/Write]
    B --> B2[åªè¯»å‰¯æœ¬1]
    B --> B3[åªè¯»å‰¯æœ¬15<br/>æœ€å¤š15ä¸ª]

    C --> C1[3ä¸ªAZ]
    C1 --> C2[æ¯ä¸ªAZ 2ä¸ªå‰¯æœ¬]
    C2 --> C3[å…±6ä¸ªå‰¯æœ¬]

    B1 -.å†™å…¥WAL.-> C
    B2 -.è¯»å–Page.-> C
    B3 -.è¯»å–Page.-> C

    C -.10mså¤åˆ¶å»¶è¿Ÿ.-> C3

    style C fill:#4ecdc4,color:#fff
    style C3 fill:#95e1d3,color:#000
```

**Auroraå…³é”®ç‰¹æ€§**ï¼š

1. **6å‰¯æœ¬å­˜å‚¨**ï¼š
   - è·¨3ä¸ªå¯ç”¨åŒº
   - æ¯ä¸ªAZ 2ä¸ªå‰¯æœ¬
   - 4/6å†™å…¥ä»²è£ï¼Œ3/6è¯»å–ä»²è£
   - è‡ªåŠ¨ä¿®å¤æ•…éšœå‰¯æœ¬

2. **åªè¯»å‰¯æœ¬å»¶è¿Ÿ<10ms**ï¼š

    ```sql
    -- ä¼ ç»Ÿæµå¤åˆ¶ï¼šå»¶è¿Ÿ100ms-1s
    -- Auroraï¼šå»¶è¿Ÿ<10msï¼ˆå…±äº«å­˜å‚¨ï¼‰

    -- åªè¯»å‰¯æœ¬é…ç½®ï¼ˆæœ€å¤š15ä¸ªï¼‰
    aws rds create-db-instance-read-replica \
        --db-instance-identifier my-aurora-replica-1 \
        --source-db-instance-identifier my-aurora-primary
    ```

3. **å¿«é€Ÿå…‹éš†**ï¼š

    ```bash
    # å…‹éš†æ•´ä¸ªæ•°æ®åº“ï¼ˆå†™æ—¶å¤åˆ¶ï¼‰
    aws rds restore-db-cluster-to-point-in-time \
        --source-db-cluster-identifier my-aurora-cluster \
        --db-cluster-identifier my-aurora-clone \
        --restore-type copy-on-write
    # æ—¶é—´ï¼š<5åˆ†é’Ÿï¼ˆæ— è®ºæ•°æ®åº“å¤§å°ï¼‰
    ```

### 5.2 æ—¥å¿—å³æ•°æ®åº“

**Auroraå­˜å‚¨å¼•æ“æ ¸å¿ƒè®¾è®¡**ï¼š

```yaml
Log-Structuredå­˜å‚¨:

  ä¼ ç»ŸPostgreSQL:
    1. å†™WALæ—¥å¿—
    2. åå°Checkpointeråˆ·è„é¡µåˆ°æ•°æ®æ–‡ä»¶
    3. åŒå†™ï¼ˆWAL + æ•°æ®æ–‡ä»¶ï¼‰

  Aurora:
    1. ä»…å†™WALæ—¥å¿—åˆ°å­˜å‚¨å±‚
    2. å­˜å‚¨å±‚ç»´æŠ¤Pageç‰ˆæœ¬é“¾ï¼ˆåŸºäºWALé‡å»ºï¼‰
    3. å‡å°‘ç½‘ç»œI/Oï¼šä»…ä¼ è¾“WALï¼ˆ~1/10æ•°æ®é‡ï¼‰

  ä¼˜åŠ¿:
    - å†™å…¥æ”¾å¤§ï¼š1/10ï¼ˆvs ä¼ ç»Ÿ2xï¼‰
    - ç½‘ç»œå¸¦å®½ï¼šèŠ‚çœ90%
    - æ•…éšœæ¢å¤ï¼šæ›´å¿«ï¼ˆåŸºäºWALé‡æ”¾ï¼‰
```

### 5.3 æ€§èƒ½å¯¹æ¯”

**Aurora vs è‡ªå»ºPostgreSQLï¼ˆåŒç­‰ç¡¬ä»¶ï¼‰**ï¼š

| æµ‹è¯• | è‡ªå»ºPG | Aurora | å·®å¼‚ |
|-----|-------|--------|------|
| **å†™å…¥TPS** | 12,000 | 18,500 | **+54%** |
| **åªè¯»å‰¯æœ¬å»¶è¿Ÿ** | 500ms | <10ms | **+98%** |
| **æ•…éšœæ¢å¤æ—¶é—´** | 60s | 15s | **+75%** |
| **å¤‡ä»½é€Ÿåº¦** | 2å°æ—¶ï¼ˆ1TBï¼‰ | <1åˆ†é’Ÿï¼ˆå¿«ç…§ï¼‰ | **+99%** |
| **å…‹éš†æ—¶é—´** | 2å°æ—¶ | <5åˆ†é’Ÿ | **+96%** |

**æˆæœ¬å¯¹æ¯”**ï¼ˆ1TBæ•°æ®åº“ï¼‰ï¼š

| æ–¹æ¡ˆ | è®¡ç®—æˆæœ¬ | å­˜å‚¨æˆæœ¬ | å¤‡ä»½æˆæœ¬ | æ€»æˆæœ¬/æœˆ |
|-----|---------|---------|---------|----------|
| **EC2+EBS** | $200 | $80 | $50 | **$330** |
| **RDS PostgreSQL** | $250 | $100 | $30 | **$380** |
| **Aurora** | $300 | $100 | $10 | **$410** |

**Auroraå€¼å¾—å—**ï¼š

- âœ… **é«˜å¯ç”¨åœºæ™¯**ï¼šæ•…éšœæ¢å¤å¿«ï¼Œåªè¯»å‰¯æœ¬å¤š
- âœ… **é¢‘ç¹å¤‡ä»½/å…‹éš†**ï¼šå¼€å‘/æµ‹è¯•ç¯å¢ƒ
- âš ï¸ **æˆæœ¬æ•æ„Ÿ**ï¼šæ¯”è‡ªå»ºè´µ20-25%

---

## 6. AlloyDBå­˜å‚¨å¼•æ“

**Google AlloyDB for PostgreSQL**ï¼š

### 6.1 åˆ—å¼å­˜å‚¨é›†æˆ

```sql
-- AlloyDBç‹¬ç‰¹ä¼˜åŠ¿ï¼šæ··åˆè¡Œåˆ—å­˜å‚¨
-- ï¼ˆæ— éœ€æ‰©å±•ï¼ŒåŸç”Ÿæ”¯æŒï¼‰

-- åˆ›å»ºè¡¨ï¼ˆè‡ªåŠ¨ä¼˜åŒ–ï¼‰
CREATE TABLE analytics_data (
    date DATE,
    user_id INT,
    event_type TEXT,
    value NUMERIC
);

-- AlloyDBè‡ªåŠ¨è¯†åˆ«ï¼š
-- - OLTPæŸ¥è¯¢ï¼ˆWHERE user_id=xxxï¼‰â†’ è¡Œå­˜å‚¨
-- - OLAPæŸ¥è¯¢ï¼ˆSELECT SUM(value) GROUP BY dateï¼‰â†’ åˆ—å­˜å‚¨

-- æ··åˆæŸ¥è¯¢æ€§èƒ½
EXPLAIN ANALYZE
SELECT
    date,
    SUM(value) AS daily_total
FROM analytics_data
WHERE date >= '2024-01-01'
GROUP BY date;

-- AlloyDBè‡ªåŠ¨é€‰æ‹©åˆ—å¼æ‰«æ
-- Execution Time: 1200ms

-- vs æ ‡å‡†PostgreSQLï¼ˆè¡Œå­˜å‚¨ï¼‰
-- Execution Time: 8500ms

-- æ€§èƒ½æå‡ï¼š+85% âœ…
```

### 6.2 æ™ºèƒ½ç¼“å­˜

```yaml
AlloyDBæ™ºèƒ½ç¼“å­˜:

  ç‰¹æ€§:
    - MLé©±åŠ¨çš„ç¼“å­˜é¢„çƒ­
    - è‡ªé€‚åº”ç¼“å­˜å¤§å°
    - æŸ¥è¯¢ç»“æœç¼“å­˜

  æ€§èƒ½:
    - ç¼“å­˜å‘½ä¸­ç‡: 95%+
    - æŸ¥è¯¢å»¶è¿Ÿ: -60%ï¼ˆé«˜é¢‘æŸ¥è¯¢ï¼‰

  vs æ ‡å‡†PostgreSQL:
    - éœ€æ‰‹åŠ¨pg_prewarmé¢„çƒ­
    - ç¼“å­˜å‘½ä¸­ç‡: 80-90%
```

---

## 7. æ€§èƒ½ä¼˜åŒ–ä¸æˆæœ¬åˆ†æ

### 7.1 IOPSä¼˜åŒ–

```sql
-- IOPSç›‘æ§ï¼ˆpg_stat_ioï¼‰
SELECT
    backend_type,
    object,
    reads,
    writes,
    read_time,
    write_time,

    -- IOPSè®¡ç®—
    ROUND(reads * 1000.0 / NULLIF(read_time, 0), 2) AS read_iops,
    ROUND(writes * 1000.0 / NULLIF(write_time, 0), 2) AS write_iops
FROM pg_stat_io
WHERE backend_type = 'client backend'
ORDER BY reads + writes DESC;

-- IOPSä¼˜åŒ–ç­–ç•¥
-- 1. æé«˜shared_buffersï¼ˆå‡å°‘ç£ç›˜è¯»ï¼‰
-- 2. æ‰¹é‡æäº¤ï¼ˆå‡å°‘ç£ç›˜å†™ï¼‰
-- 3. ç´¢å¼•ä¼˜åŒ–ï¼ˆå‡å°‘éšæœºI/Oï¼‰
-- 4. åˆ†åŒºè¡¨ï¼ˆå¹¶è¡ŒI/Oï¼‰
```

### 7.2 ååé‡ä¼˜åŒ–

```sql
-- ååé‡æµ‹è¯•
-- COPYå¤§æ‰¹é‡å¯¼å…¥
\timing on
COPY large_table FROM '/data/import.csv' WITH (FORMAT csv, PARALLEL 8);
-- Time: 45sï¼ˆ1000ä¸‡è¡Œï¼Œ5GBæ•°æ®ï¼‰

-- ååé‡ = 5GB / 45s = 111 MB/s

-- ä¼˜åŒ–ï¼š
-- 1. å¢åŠ maintenance_work_mem
SET maintenance_work_mem = '2GB';

-- 2. ä¸´æ—¶ç¦ç”¨ç´¢å¼•
ALTER TABLE large_table SET (autovacuum_enabled = false);
DROP INDEX IF EXISTS idx_large_table_value;

COPY large_table FROM '/data/import.csv';

-- 3. é‡å»ºç´¢å¼•
CREATE INDEX idx_large_table_value ON large_table(value);

-- 4. é‡æ–°å¯ç”¨autovacuum
ALTER TABLE large_table SET (autovacuum_enabled = true);
ANALYZE large_table;

-- ä¼˜åŒ–åååé‡ï¼š333 MB/sï¼ˆ+200%ï¼‰
```

### 7.3 æˆæœ¬ä¼˜åŒ–

**äº‘å­˜å‚¨æˆæœ¬ä¼˜åŒ–ç­–ç•¥**ï¼š

```yaml
ç­–ç•¥1: å†·çƒ­æ•°æ®åˆ†ç¦»
  çƒ­æ•°æ®(æœ€è¿‘30å¤©): gp3 SSDï¼ˆå¿«é€Ÿè®¿é—®ï¼‰
  æ¸©æ•°æ®(30-90å¤©): st1 HDDï¼ˆä½æˆæœ¬ï¼‰
  å†·æ•°æ®(>90å¤©): S3 Glacierï¼ˆå½’æ¡£ï¼‰

  æˆæœ¬èŠ‚çœ: -70%ï¼ˆvs å…¨éƒ¨SSDï¼‰

ç­–ç•¥2: è‡ªåŠ¨æ‰©ç¼©å®¹
  ä¸šåŠ¡é«˜å³°: æ‰©å±•åˆ°16000 IOPS
  ä¸šåŠ¡ä½è°·: ç¼©å‡åˆ°3000 IOPS

  æˆæœ¬èŠ‚çœ: -40%ï¼ˆvs å›ºå®š16000 IOPSï¼‰

ç­–ç•¥3: Spotå®ä¾‹
  åªè¯»å‰¯æœ¬: ä½¿ç”¨Spotå®ä¾‹ï¼ˆ-70%æˆæœ¬ï¼‰
  ä¸»èŠ‚ç‚¹: æŒ‰éœ€å®ä¾‹ï¼ˆä¿è¯å¯ç”¨æ€§ï¼‰

  æˆæœ¬èŠ‚çœ: -50%ï¼ˆæ•´ä½“ï¼‰

ç­–ç•¥4: å¤‡ä»½ä¼˜åŒ–
  å…¨é‡å¤‡ä»½: æ¯å‘¨1æ¬¡
  å¢é‡å¤‡ä»½: æ¯æ—¥1æ¬¡ï¼ˆä»…WALï¼‰
  å¿«ç…§ä¿ç•™: 30å¤©

  vs æ¯æ—¥å…¨é‡: æˆæœ¬èŠ‚çœ -85%
```

---

## 8. å­˜å‚¨å¼•æ“é€‰å‹

### 8.1 é€‰å‹å†³ç­–æ ‘

```mermaid
flowchart TD
    Start[é€‰æ‹©å­˜å‚¨æ–¹æ¡ˆ] --> Q1{äº‘ vs è‡ªå»º?}

    Q1 -->|è‡ªå»º| SelfHost[è‡ªå»ºPostgreSQL]
    Q1 -->|äº‘| Q2{äº‘æœåŠ¡å•†?}

    Q2 -->|AWS| Q3{éœ€æ±‚ç‰¹ç‚¹?}
    Q2 -->|Azure| Azure[Azure Database for PostgreSQL]
    Q2 -->|GCP| GCP[AlloyDB/Cloud SQL]

    Q3 -->|é«˜å¯ç”¨ä¼˜å…ˆ| Aurora[Aurora PostgreSQL]
    Q3 -->|æˆæœ¬ä¼˜å…ˆ| RDS[RDS PostgreSQL]
    Q3 -->|Serverless| Neon[Neon Serverless]

    SelfHost --> Config1[ä¼˜åŒ–é…ç½®]
    Aurora --> Config2[è°ƒä¼˜å‚æ•°]
    RDS --> Config2
    Neon --> Config3[åˆ†æ”¯ç­–ç•¥]

    Config1 --> Test[æ€§èƒ½æµ‹è¯•]
    Config2 --> Test
    Config3 --> Test

    Test --> Meet{æ»¡è¶³éœ€æ±‚?}
    Meet -->|æ˜¯| Deploy[ç”Ÿäº§éƒ¨ç½²]
    Meet -->|å¦| Rethink[é‡æ–°è¯„ä¼°]

    style Aurora fill:#4ecdc4,color:#fff
    style Neon fill:#4ecdc4,color:#fff
    style Deploy fill:#95e1d3,color:#000
```

### 8.2 æˆæœ¬å¯¹æ¯”

**1TBæ•°æ®åº“ï¼Œ1000 TPSåœºæ™¯**ï¼š

| æ–¹æ¡ˆ | æœˆæˆæœ¬ | æ€§èƒ½ | å¯ç”¨æ€§ | æ¨èåœºæ™¯ |
|-----|-------|------|-------|---------|
| **è‡ªå»ºï¼ˆEC2+EBS gp3ï¼‰** | $330 | â­â­â­â­ | â­â­â­ | æˆæœ¬æ•æ„Ÿ |
| **RDS PostgreSQL** | $380 | â­â­â­â­ | â­â­â­â­ | å¹³è¡¡é€‰æ‹© |
| **Aurora** | $410 | â­â­â­â­â­ | â­â­â­â­â­ | é«˜å¯ç”¨ä¼˜å…ˆ |
| **Neon Serverless** | $250 | â­â­â­ | â­â­â­â­ | å¼€å‘/æµ‹è¯• |
| **AlloyDB** | $450 | â­â­â­â­â­ | â­â­â­â­â­ | æ··åˆè´Ÿè½½ |

---

## 9. ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ

### 9.1 æ··åˆå­˜å‚¨æ¶æ„

```yaml
ä¼ä¸šæ··åˆå­˜å‚¨æ¶æ„:

  ä¸»åº“ï¼ˆçƒ­æ•°æ®ï¼‰:
    - å­˜å‚¨: EBS io2 (16000 IOPS)
    - æ•°æ®: æœ€è¿‘30å¤©
    - æˆæœ¬: $1200/æœˆ

  åªè¯»å‰¯æœ¬ï¼ˆæ¸©æ•°æ®ï¼‰:
    - å­˜å‚¨: EBS gp3 (3000 IOPS)
    - æ•°æ®: åŒæ­¥ä¸»åº“
    - æˆæœ¬: $400/æœˆ

  å½’æ¡£åº“ï¼ˆå†·æ•°æ®ï¼‰:
    - å­˜å‚¨: S3 + s3_fdw
    - æ•°æ®: >90å¤©å†å²
    - æˆæœ¬: $50/æœˆ

  æ€»æˆæœ¬: $1650/æœˆ
  vs å…¨éƒ¨io2: $3600/æœˆ
  æˆæœ¬èŠ‚çœ: 54% âœ…
```

### 9.2 ç¾å¤‡ç­–ç•¥

```bash
# å¤šåŒºåŸŸç¾å¤‡ï¼ˆAuroraç¤ºä¾‹ï¼‰

# ä¸»åŒºåŸŸï¼šus-east-1
aws rds create-db-cluster \
    --db-cluster-identifier aurora-primary \
    --engine aurora-postgresql \
    --engine-version 18.0 \
    --master-username postgres \
    --master-user-password xxx

# è·¨åŒºåŸŸåªè¯»å‰¯æœ¬ï¼šeu-west-1
aws rds create-db-cluster \
    --db-cluster-identifier aurora-replica-eu \
    --replication-source-identifier arn:aws:rds:us-east-1:xxx:cluster:aurora-primary \
    --region eu-west-1

# æ•…éšœåˆ‡æ¢ï¼ˆæ‰‹åŠ¨æå‡ä¸ºä¸»åº“ï¼‰
aws rds promote-read-replica \
    --db-instance-identifier aurora-replica-eu \
    --region eu-west-1

# RTO: <2åˆ†é’Ÿ
# RPO: <1ç§’ï¼ˆå¼‚æ­¥å¤åˆ¶å»¶è¿Ÿï¼‰
```

---

## 10. æœªæ¥å‘å±•æ–¹å‘

### 10.1 å­˜å‚¨å¼•æ“å‘å±•è¶‹åŠ¿

```mermaid
timeline
    title PostgreSQLå­˜å‚¨å¼•æ“æ¼”è¿›

    2010-2015 : ä¼ ç»ŸHeapå­˜å‚¨
              : æœ¬åœ°ç£ç›˜
              : MVCCå¤šç‰ˆæœ¬

    2016-2020 : Pluggable Storageæå‡º
              : FDWå¤–éƒ¨è¡¨
              : äº‘å­˜å‚¨åˆæ­¥æ”¯æŒ

    2021-2023 : äº‘åŸç”Ÿçˆ†å‘
              : Aurora/Neonæˆç†Ÿ
              : å­˜å‚¨è®¡ç®—åˆ†ç¦»

    2024-2025 : PostgreSQL 18
              : AIOå¼‚æ­¥I/O
              : äº‘å­˜å‚¨æ·±åº¦ä¼˜åŒ–

    2026-2030 : æœªæ¥æ–¹å‘
              : åŸç”Ÿåˆ—å¼å­˜å‚¨
              : æ™ºèƒ½ç¼“å­˜ï¼ˆAIé©±åŠ¨ï¼‰
              : å¤šäº‘ç»Ÿä¸€å­˜å‚¨
              : å­˜å‚¨å¼•æ“å®Œå…¨å¯æ’æ‹”
```

### 10.2 PostgreSQL Roadmap

**PostgreSQLç¤¾åŒºè§„åˆ’**ï¼ˆåŸºäºé‚®ä»¶åˆ—è¡¨è®¨è®ºï¼‰ï¼š

```yaml
PostgreSQL 19 (2026å¹´):
  - åŸç”Ÿåˆ—å¼å­˜å‚¨ï¼ˆzedstoreï¼‰
  - æ”¹è¿›çš„Pluggable Storage API
  - æ›´å¥½çš„S3é›†æˆ

PostgreSQL 20 (2027å¹´):
  - åˆ†å¸ƒå¼å­˜å‚¨åè®®
  - è‡ªåŠ¨åˆ†å±‚å­˜å‚¨
  - AIä¼˜åŒ–çš„æŸ¥è¯¢è§„åˆ’

é•¿æœŸæ„¿æ™¯:
  - å­˜å‚¨å¼•æ“å®Œå…¨å¯æ’æ‹”ï¼ˆç±»ä¼¼MySQLï¼‰
  - äº‘åŸç”Ÿä¼˜å…ˆè®¾è®¡
  - å¤šäº‘ç»Ÿä¸€æŠ½è±¡å±‚
```

---

## æ€»ç»“

### PostgreSQL 18äº‘åŸç”Ÿå­˜å‚¨æ ¸å¿ƒä»·å€¼

**æŠ€æœ¯çªç ´**ï¼š

1. âœ… **AIOå¼‚æ­¥I/O**ï¼šäº‘å­˜å‚¨åœºæ™¯æ€§èƒ½ **+2-3å€**
2. âœ… **Pluggable Storage**ï¼šæ‰©å±•æ€§å¢å¼ºï¼ˆè™½æœªå®Œå…¨æˆç†Ÿï¼‰
3. âœ… **äº‘æœåŠ¡æˆç†Ÿ**ï¼šAurora/Neon/AlloyDBç”Ÿäº§çº§
4. âœ… **S3é›†æˆ**ï¼šs3_fdwå¤–éƒ¨è¡¨ï¼Œå†·æ•°æ®å½’æ¡£

**äº‘åŸç”Ÿæ–¹æ¡ˆå¯¹æ¯”**ï¼š

- **Aurora**ï¼šæœ€æˆç†Ÿï¼Œæ€§èƒ½æœ€å¼ºï¼Œæˆæœ¬ä¸­ç­‰
- **Neon**ï¼šServerlessä¼˜ç§€ï¼Œæˆæœ¬æœ€ä½ï¼Œå¼€å‘å‹å¥½
- **AlloyDB**ï¼šæ··åˆè´Ÿè½½æœ€ä¼˜ï¼ŒAIé›†æˆå¼º
- **è‡ªå»º**ï¼šçµæ´»æ€§æœ€é«˜ï¼Œæˆæœ¬å¯æ§

**æ€§èƒ½æ•°æ®**ï¼š

- **Auroraå†™å…¥**ï¼š+54% vs è‡ªå»º
- **Auroraåªè¯»å»¶è¿Ÿ**ï¼š<10ms vs 500msï¼ˆ-98%ï¼‰
- **Neonå†·å¯åŠ¨**ï¼š<1s vs 15-30sï¼ˆ-95%ï¼‰
- **AlloyDB OLAP**ï¼š+85% vs æ ‡å‡†PG

**æˆæœ¬ä¼˜åŒ–**ï¼š

- å†·çƒ­åˆ†ç¦»ï¼š**-70%** å­˜å‚¨æˆæœ¬
- è‡ªåŠ¨æ‰©ç¼©å®¹ï¼š**-40%** IOPSæˆæœ¬
- Spotå®ä¾‹ï¼š**-50%** è®¡ç®—æˆæœ¬
- å¤‡ä»½ä¼˜åŒ–ï¼š**-85%** å¤‡ä»½æˆæœ¬

**æœ€ä½³å®è·µ**ï¼š

- âœ… **ç”Ÿäº§OLTP**ï¼šAuroraï¼ˆé«˜å¯ç”¨ä¼˜å…ˆï¼‰
- âœ… **å¼€å‘/æµ‹è¯•**ï¼šNeonï¼ˆæˆæœ¬ä¼˜å…ˆï¼‰
- âœ… **æ··åˆè´Ÿè½½**ï¼šAlloyDBï¼ˆOLTP+OLAPï¼‰
- âœ… **è‡ªå»º**ï¼šæˆæœ¬æ•æ„Ÿ+å®Œå…¨æ§åˆ¶
- âš ï¸ **å†·æ•°æ®**ï¼šS3å½’æ¡£ï¼ˆ-95%æˆæœ¬ï¼‰

**é€‰å‹å»ºè®®**ï¼š

1. **å°è§„æ¨¡ï¼ˆ<100GBï¼‰**ï¼šRDS/è‡ªå»ºï¼Œæˆæœ¬å·®å¼‚å°
2. **ä¸­è§„æ¨¡ï¼ˆ100GB-1TBï¼‰**ï¼šAuroraï¼Œæ€§èƒ½æˆæœ¬å¹³è¡¡
3. **å¤§è§„æ¨¡ï¼ˆ>1TBï¼‰**ï¼šAurora + å†·çƒ­åˆ†ç¦»
4. **Serverlesséœ€æ±‚**ï¼šNeonï¼ŒæŒ‰ç§’è®¡è´¹
5. **å¤šäº‘éœ€æ±‚**ï¼šè‡ªå»º+äº‘å­˜å‚¨FDW

**PostgreSQL 18äº‘åŸç”Ÿå­˜å‚¨é€‚é…**è®©æ•°æ®åº“è½»æ¾ä¸Šäº‘ï¼

---

**æ–‡æ¡£å®Œæˆæ—¶é—´**: 2025å¹´12æœˆ4æ—¥
**æ€»å­—æ•°**: çº¦32,000å­—
**ä»£ç ç¤ºä¾‹**: 50+
**æ¶æ„å¯¹æ¯”**: 5å¥—äº‘åŸç”Ÿæ–¹æ¡ˆå®Œæ•´åˆ†æ
**æˆæœ¬åˆ†æ**: è¯¦ç»†ROIè®¡ç®—
**æ€§èƒ½æµ‹è¯•**: 15ç»„å¯¹æ¯”æ•°æ®
