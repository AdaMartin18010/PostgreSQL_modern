# æ–‡æ¡£å·¥å…·

> **æ–‡æ¡£ç¼–å·**: TOOLS-DOC-001
> **ä¸»é¢˜**: Rusté¡¹ç›®æ–‡æ¡£å·¥å…·ä¸PostgreSQL MVCCæ–‡æ¡£ç”Ÿæˆ
> **ç‰ˆæœ¬**: PostgreSQL 17 & 18
> **ç›¸å…³æ–‡æ¡£**:
>
> - [å¼€å‘å·¥å…·é“¾](å¼€å‘å·¥å…·é“¾.md)
> - [ä»£ç è´¨é‡å·¥å…·](ä»£ç è´¨é‡å·¥å…·.md)
> - [CI/CDé›†æˆ](CI-CDé›†æˆ.md)

---

## ğŸ“‘ ç›®å½•

- [æ–‡æ¡£å·¥å…·](#æ–‡æ¡£å·¥å…·)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [ğŸ“‹ æ¦‚è¿°](#-æ¦‚è¿°)
  - [ğŸ“ ç¬¬ä¸€éƒ¨åˆ†ï¼šRustæ–‡æ¡£å·¥å…·](#-ç¬¬ä¸€éƒ¨åˆ†rustæ–‡æ¡£å·¥å…·)
    - [1.1 rustdoc](#11-rustdoc)
      - [1.1.1 rustdocä½¿ç”¨](#111-rustdocä½¿ç”¨)
    - [1.2 mdBook](#12-mdbook)
      - [1.2.1 mdBookä½¿ç”¨](#121-mdbookä½¿ç”¨)
    - [1.3 cargo-doc](#13-cargo-doc)
      - [1.3.1 cargo-docä½¿ç”¨](#131-cargo-docä½¿ç”¨)
  - [ğŸ“Š ç¬¬äºŒéƒ¨åˆ†ï¼šMVCCæ–‡æ¡£ç”Ÿæˆ](#-ç¬¬äºŒéƒ¨åˆ†mvccæ–‡æ¡£ç”Ÿæˆ)
    - [2.1 APIæ–‡æ¡£ç”Ÿæˆ](#21-apiæ–‡æ¡£ç”Ÿæˆ)
      - [2.1.1 æ–‡æ¡£ç”Ÿæˆ](#211-æ–‡æ¡£ç”Ÿæˆ)
    - [2.2 ç¤ºä¾‹æ–‡æ¡£ç”Ÿæˆ](#22-ç¤ºä¾‹æ–‡æ¡£ç”Ÿæˆ)
      - [2.2.1 ç¤ºä¾‹ç”Ÿæˆ](#221-ç¤ºä¾‹ç”Ÿæˆ)
  - [âš¡ ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ–‡æ¡£å·¥å…·é›†æˆ](#-ç¬¬ä¸‰éƒ¨åˆ†æ–‡æ¡£å·¥å…·é›†æˆ)
    - [3.1 CIé›†æˆ](#31-cié›†æˆ)
      - [3.1.1 CIé…ç½®](#311-cié…ç½®)
    - [3.2 è‡ªåŠ¨åŒ–æ–‡æ¡£](#32-è‡ªåŠ¨åŒ–æ–‡æ¡£)
      - [3.2.1 è‡ªåŠ¨åŒ–æµç¨‹](#321-è‡ªåŠ¨åŒ–æµç¨‹)
  - [ğŸ¯ ç¬¬å››éƒ¨åˆ†ï¼šæœ€ä½³å®è·µ](#-ç¬¬å››éƒ¨åˆ†æœ€ä½³å®è·µ)
    - [4.1 æ–‡æ¡£ç¼–å†™](#41-æ–‡æ¡£ç¼–å†™)
      - [4.1.1 ç¼–å†™è§„èŒƒ](#411-ç¼–å†™è§„èŒƒ)
    - [4.2 æ–‡æ¡£ç»´æŠ¤](#42-æ–‡æ¡£ç»´æŠ¤)
      - [4.2.1 ç»´æŠ¤æ–¹æ³•](#421-ç»´æŠ¤æ–¹æ³•)
  - [ğŸ“ æ€»ç»“](#-æ€»ç»“)

---

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜Rusté¡¹ç›®æ–‡æ¡£å·¥å…·åœ¨PostgreSQL MVCCæ–‡æ¡£ç”Ÿæˆä¸­çš„åº”ç”¨ï¼ŒåŒ…æ‹¬Rustæ–‡æ¡£å·¥å…·ã€MVCCæ–‡æ¡£ç”Ÿæˆã€æ–‡æ¡£å·¥å…·é›†æˆå’Œæœ€ä½³å®è·µã€‚

**æ ¸å¿ƒå†…å®¹**ï¼š

- Rustæ–‡æ¡£å·¥å…·ï¼ˆrustdocã€mdBookã€cargo-docï¼‰
- MVCCæ–‡æ¡£ç”Ÿæˆï¼ˆAPIæ–‡æ¡£ç”Ÿæˆã€ç¤ºä¾‹æ–‡æ¡£ç”Ÿæˆï¼‰
- æ–‡æ¡£å·¥å…·é›†æˆï¼ˆCIé›†æˆã€è‡ªåŠ¨åŒ–æ–‡æ¡£ï¼‰
- æœ€ä½³å®è·µï¼ˆæ–‡æ¡£ç¼–å†™ã€æ–‡æ¡£ç»´æŠ¤ï¼‰

**ç›®æ ‡è¯»è€…**ï¼š

- æ–‡æ¡£ç¼–å†™äººå‘˜
- é¡¹ç›®ç»´æŠ¤è€…
- æŠ€æœ¯å†™ä½œè€…

---

## ğŸ“ ç¬¬ä¸€éƒ¨åˆ†ï¼šRustæ–‡æ¡£å·¥å…·

### 1.1 rustdoc

#### 1.1.1 rustdocä½¿ç”¨

```rust
// rustdocï¼šRustå†…ç½®æ–‡æ¡£å·¥å…·
// è¿è¡Œï¼šcargo doc
// ç‰¹ç‚¹ï¼š
// - å†…ç½®æ”¯æŒ
// - Markdownæ”¯æŒ
// - ä»£ç ç¤ºä¾‹æµ‹è¯•

/// PostgreSQL MVCCäº‹åŠ¡ç®¡ç†å™¨
///
/// # ç¤ºä¾‹
///
/// ```rust
/// use sqlx::PgPool;
///
/// let pool = PgPool::connect("postgres://...").await?;
/// let mut tx = pool.begin().await?;
/// tx.commit().await?;
/// ```
pub struct TransactionManager {
    pool: PgPool,
}
```

### 1.2 mdBook

#### 1.2.1 mdBookä½¿ç”¨

```bash
# å®‰è£…mdBook
cargo install mdbook

# åˆ›å»ºæ–°ä¹¦
mdbook init

# æ„å»ºæ–‡æ¡£
mdbook build

# é¢„è§ˆæ–‡æ¡£
mdbook serve
```

### 1.3 cargo-doc

#### 1.3.1 cargo-docä½¿ç”¨

```bash
# ç”Ÿæˆæ–‡æ¡£
cargo doc

# ç”Ÿæˆæ–‡æ¡£å¹¶æ‰“å¼€
cargo doc --open

# ç”Ÿæˆæ‰€æœ‰ä¾èµ–æ–‡æ¡£
cargo doc --all
```

---

## ğŸ“Š ç¬¬äºŒéƒ¨åˆ†ï¼šMVCCæ–‡æ¡£ç”Ÿæˆ

### 2.1 APIæ–‡æ¡£ç”Ÿæˆ

#### 2.1.1 æ–‡æ¡£ç”Ÿæˆ

```rust
/// PostgreSQL MVCCäº‹åŠ¡API
///
/// ## MVCCç‰¹æ€§
///
/// - å¿«ç…§éš”ç¦»
/// - æ— é”è¯»
/// - ç‰ˆæœ¬é“¾ç®¡ç†
///
/// ## ç¤ºä¾‹
///
/// ```rust,no_run
/// use sqlx::PgPool;
///
/// async fn example(pool: &PgPool) -> Result<(), sqlx::Error> {
///     let mut tx = pool.begin().await?;
///     sqlx::query("INSERT INTO users (id, name) VALUES ($1, $2)")
///         .bind(1i32)
///         .bind("Alice")
///         .execute(&mut *tx)
///         .await?;
///     tx.commit().await?;
///     Ok(())
/// }
/// ```
pub async fn begin_transaction(pool: &PgPool) -> Result<Transaction, Error> {
    pool.begin().await
}
```

### 2.2 ç¤ºä¾‹æ–‡æ¡£ç”Ÿæˆ

#### 2.2.1 ç¤ºä¾‹ç”Ÿæˆ

```rust
/// # MVCCäº‹åŠ¡ç¤ºä¾‹
///
/// æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨PostgreSQL MVCCè¿›è¡Œäº‹åŠ¡å¤„ç†
///
/// ```rust,no_run
/// # use sqlx::PgPool;
/// # async fn example(pool: PgPool) -> Result<(), sqlx::Error> {
/// let mut tx = pool.begin().await?;
/// sqlx::query("SET TRANSACTION ISOLATION LEVEL REPEATABLE READ")
///     .execute(&mut *tx)
///     .await?;
/// tx.commit().await?;
/// # Ok(())
/// # }
/// ```
pub mod examples {
    // ç¤ºä¾‹ä»£ç 
}
```

---

## âš¡ ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ–‡æ¡£å·¥å…·é›†æˆ

### 3.1 CIé›†æˆ

#### 3.1.1 CIé…ç½®

```yaml
# .github/workflows/docs.yml
name: Documentation

on:
  push:
    branches: [main]

jobs:
  docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup Rust
        uses: actions-rs/toolchain@v1
        with:
          toolchain: stable
      - name: Generate docs
        run: cargo doc --no-deps
      - name: Deploy docs
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./target/doc
```

### 3.2 è‡ªåŠ¨åŒ–æ–‡æ¡£

#### 3.2.1 è‡ªåŠ¨åŒ–æµç¨‹

```bash
#!/bin/bash
# è‡ªåŠ¨åŒ–æ–‡æ¡£ç”Ÿæˆè„šæœ¬

# ç”ŸæˆAPIæ–‡æ¡£
cargo doc --no-deps

# ç”ŸæˆmdBookæ–‡æ¡£
mdbook build

# éƒ¨ç½²æ–‡æ¡£
./deploy-docs.sh
```

---

## ğŸ¯ ç¬¬å››éƒ¨åˆ†ï¼šæœ€ä½³å®è·µ

### 4.1 æ–‡æ¡£ç¼–å†™

#### 4.1.1 ç¼–å†™è§„èŒƒ

```rust
// æ–‡æ¡£ç¼–å†™è§„èŒƒï¼š
// 1. ä½¿ç”¨///æ³¨é‡Š
// 2. åŒ…å«ç¤ºä¾‹ä»£ç 
// 3. è¯´æ˜MVCCç‰¹æ€§
// 4. æ ‡æ³¨é”™è¯¯æƒ…å†µ
```

### 4.2 æ–‡æ¡£ç»´æŠ¤

#### 4.2.1 ç»´æŠ¤æ–¹æ³•

```rust
// æ–‡æ¡£ç»´æŠ¤æ–¹æ³•ï¼š
// 1. å®šæœŸæ›´æ–°æ–‡æ¡£
// 2. ä¿æŒç¤ºä¾‹ä»£ç å¯è¿è¡Œ
// 3. åŒæ­¥ä»£ç å˜æ›´
// 4. å®¡æŸ¥æ–‡æ¡£è´¨é‡
```

---

## ğŸ“ æ€»ç»“

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†Rusté¡¹ç›®æ–‡æ¡£å·¥å…·åœ¨PostgreSQL MVCCæ–‡æ¡£ç”Ÿæˆä¸­çš„åº”ç”¨ã€‚

**æ ¸å¿ƒè¦ç‚¹**ï¼š

1. **Rustæ–‡æ¡£å·¥å…·**ï¼š
   - rustdocã€mdBookã€cargo-doc

2. **MVCCæ–‡æ¡£ç”Ÿæˆ**ï¼š
   - APIæ–‡æ¡£ç”Ÿæˆã€ç¤ºä¾‹æ–‡æ¡£ç”Ÿæˆ

3. **æ–‡æ¡£å·¥å…·é›†æˆ**ï¼š
   - CIé›†æˆã€è‡ªåŠ¨åŒ–æ–‡æ¡£

4. **æœ€ä½³å®è·µ**ï¼š
   - æ–‡æ¡£ç¼–å†™ã€æ–‡æ¡£ç»´æŠ¤

**ä¸‹ä¸€æ­¥**ï¼š

- å®Œå–„æ–‡æ¡£ç”Ÿæˆæ¡ˆä¾‹
- æ·»åŠ æ›´å¤šæ–‡æ¡£å·¥å…·
- å®Œå–„è‡ªåŠ¨åŒ–æ–‡æ¡£æµç¨‹

---

**æœ€åæ›´æ–°**: 2024å¹´
**ç»´æŠ¤çŠ¶æ€**: âœ… æŒç»­æ›´æ–°
