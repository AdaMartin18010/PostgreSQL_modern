# 金融交易系统 - 需求分析

## 元数据

- **案例类型**: 强一致性 + 审计 + 高可用
- **难度等级**: ⭐⭐⭐⭐⭐
- **数据规模**: 千万账户、亿级交易
- **技术栈**: PostgreSQL 18 + Serializable + 审计日志
- **创建日期**: 2025-12-04

---

## 1. 业务背景

某数字银行需要构建**核心交易系统**，处理转账、支付等关键业务。

**核心要求**:

- **零数据丢失**: RPO = 0
- **强一致性**: Serializable隔离级别
- **完整审计**: 所有操作可追溯
- **高可用**: 99.99%可用性

---

## 2. 技术挑战

### 2.1 ACID保证

```sql
-- Serializable隔离级别
BEGIN TRANSACTION ISOLATION LEVEL SERIALIZABLE;

-- 转账操作（防止并发问题）
UPDATE accounts
SET balance = balance - 1000
WHERE account_id = 'A001'
  AND balance >= 1000;

UPDATE accounts
SET balance = balance + 1000
WHERE account_id = 'B001';

-- 审计日志
INSERT INTO audit_log (operation, details)
VALUES ('transfer', jsonb_build_object(...));

COMMIT;
```

### 2.2 审计设计

```sql
-- 审计表设计
CREATE TABLE audit_log (
    log_id BIGSERIAL PRIMARY KEY,
    operation_type VARCHAR(50),
    user_id BIGINT,
    entity_type VARCHAR(50),
    entity_id BIGINT,
    old_value JSONB,
    new_value JSONB,
    client_ip INET,
    session_id UUID,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) PARTITION BY RANGE (created_at);

-- 自动审计触发器
CREATE TRIGGER audit_account_changes
AFTER UPDATE ON accounts
FOR EACH ROW
EXECUTE FUNCTION log_account_change();
```

---

## 3. 性能指标

| 指标 | 目标 |
|------|------|
| **TPS** | 5,000+ |
| **延迟** | <50ms (P95) |
| **可用性** | 99.99% |
| **RPO** | 0 (零数据丢失) |
| **RTO** | <30秒 |

---

**下一步**: [02-架构设计](./02-架构设计.md) | [返回案例库](../README.md)
