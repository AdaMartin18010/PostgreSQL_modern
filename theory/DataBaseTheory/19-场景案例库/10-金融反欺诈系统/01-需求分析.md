# 金融反欺诈系统 - 需求分析

## 元数据
- **案例类型**: 图数据库 + 实时风控
- **难度等级**: ⭐⭐⭐⭐⭐
- **数据规模**: 千万用户、亿级交易
- **技术栈**: Apache AGE + 实时图算法
- **创建日期**: 2025-12-04

---

## 1. 业务背景

某互联网金融平台需要构建**实时反欺诈系统**，识别异常交易和欺诈团伙。

**欺诈类型**:
- 账户盗用
- 洗钱网络
- 薅羊毛团伙
- 虚假交易
- 信用卡欺诈

**业务损失**:
- 年度欺诈损失: $50M+
- 误伤正常用户: 1%
- 人工审核成本: $10M/年

---

## 2. 检测策略

### 2.1 基于规则的检测

```sql
-- 规则1: 异常登录地点
SELECT user_id
FROM login_events
WHERE ST_Distance(
    login_location,
    LAG(login_location) OVER (PARTITION BY user_id ORDER BY login_time)
) > 1000000  -- 1000公里
AND login_time - LAG(login_time) OVER (PARTITION BY user_id ORDER BY login_time) < INTERVAL '1 hour';

-- 规则2: 异常交易金额
SELECT transaction_id
FROM transactions
WHERE amount > (
    SELECT AVG(amount) + 3 * STDDEV(amount)
    FROM transactions
    WHERE user_id = transactions.user_id
);
```

### 2.2 基于图的团伙发现

```cypher
-- 使用Apache AGE发现欺诈团伙

// 检测模式: 多个账户短时间内转账到同一账户
MATCH (a1:Account)-[t1:TRANSFER]->(target:Account)<-[t2:TRANSFER]-(a2:Account)
WHERE t1.timestamp - t2.timestamp < 3600  // 1小时内
  AND t1.amount > 10000
  AND t2.amount > 10000
  AND a1 <> a2
RETURN target, COUNT(DISTINCT a1) AS suspicious_count
HAVING suspicious_count >= 5  // 至少5个账户
ORDER BY suspicious_count DESC;
```

### 2.3 社区发现算法

```python
# Louvain社区发现 - 识别欺诈团伙

def detect_fraud_community(graph, min_community_size=10):
    """
    检测可疑社区

    特征:
    - 社区内部高度连接
    - 与外部连接稀疏
    - 短时间内大量交易
    """

    # 运行Louvain算法
    communities = louvain_algorithm(graph)

    suspicious_communities = []
    for community_id, members in communities.items():
        if len(members) < min_community_size:
            continue

        # 计算社区特征
        features = calculate_community_features(community_id, members)

        # 欺诈模式匹配
        if is_suspicious(features):
            suspicious_communities.append({
                'community_id': community_id,
                'members': members,
                'risk_score': features['risk_score']
            })

    return suspicious_communities
```

---

## 3. 性能指标

| 指标 | 目标 | 说明 |
|------|------|------|
| **检测延迟** | <100ms | 实时检测 |
| **准确率** | >95% | 减少误报 |
| **召回率** | >90% | 减少漏报 |
| **QPS** | 10,000+ | 高并发 |
| **误报率** | <5% | 减少误伤 |

---

## 4. 图模型设计

```cypher
// 节点类型
(:Account)      - 账户
(:Device)       - 设备
(:IP)           - IP地址
(:Merchant)     - 商户

// 关系类型
(Account)-[:TRANSFER {amount, timestamp}]->(Account)
(Account)-[:LOGIN_FROM]->(Device)
(Account)-[:ACCESS_FROM]->(IP)
(Account)-[:TRADE_WITH]->(Merchant)
(Device)-[:BIND_TO]->(Account)
```

---

**下一步**: [02-架构设计](./02-架构设计.md) | [返回案例库](../README.md)
