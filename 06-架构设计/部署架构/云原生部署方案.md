# äº‘åŸç”Ÿéƒ¨ç½²æ–¹æ¡ˆ

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥  
> **æŠ€æœ¯ç‰ˆæœ¬**: Kubernetes 1.28+, PostgreSQL 18+  
> **æ–‡æ¡£ç¼–å·**: 06-03-01

## ğŸ“‘ ç›®å½•

- [äº‘åŸç”Ÿéƒ¨ç½²æ–¹æ¡ˆ](#äº‘åŸç”Ÿéƒ¨ç½²æ–¹æ¡ˆ)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 æŠ€æœ¯èƒŒæ™¯](#11-æŠ€æœ¯èƒŒæ™¯)
    - [1.2 æ–¹æ¡ˆå®šä½](#12-æ–¹æ¡ˆå®šä½)
    - [1.3 æ ¸å¿ƒä»·å€¼](#13-æ ¸å¿ƒä»·å€¼)
  - [2. æ¶æ„è®¾è®¡](#2-æ¶æ„è®¾è®¡)
    - [2.1 æ•´ä½“æ¶æ„](#21-æ•´ä½“æ¶æ„)
    - [2.2 ç»„ä»¶è®¾è®¡](#22-ç»„ä»¶è®¾è®¡)
    - [2.3 ç½‘ç»œè®¾è®¡](#23-ç½‘ç»œè®¾è®¡)
  - [3. Kubernetes éƒ¨ç½²](#3-kubernetes-éƒ¨ç½²)
    - [3.1 StatefulSet éƒ¨ç½²](#31-statefulset-éƒ¨ç½²)
    - [3.2 æœåŠ¡å‘ç°](#32-æœåŠ¡å‘ç°)
    - [3.3 å­˜å‚¨ç®¡ç†](#33-å­˜å‚¨ç®¡ç†)
  - [4. é«˜å¯ç”¨é…ç½®](#4-é«˜å¯ç”¨é…ç½®)
    - [4.1 ä¸»ä»å¤åˆ¶](#41-ä¸»ä»å¤åˆ¶)
    - [4.2 è‡ªåŠ¨æ•…éšœè½¬ç§»](#42-è‡ªåŠ¨æ•…éšœè½¬ç§»)
    - [4.3 è´Ÿè½½å‡è¡¡](#43-è´Ÿè½½å‡è¡¡)
  - [5. ç›‘æ§ä¸è¿ç»´](#5-ç›‘æ§ä¸è¿ç»´)
    - [5.1 ç›‘æ§é…ç½®](#51-ç›‘æ§é…ç½®)
    - [5.2 æ—¥å¿—ç®¡ç†](#52-æ—¥å¿—ç®¡ç†)
    - [5.3 å¤‡ä»½æ¢å¤](#53-å¤‡ä»½æ¢å¤)
  - [6. æœ€ä½³å®è·µ](#6-æœ€ä½³å®è·µ)
    - [6.1 éƒ¨ç½²å»ºè®®](#61-éƒ¨ç½²å»ºè®®)
    - [6.2 è¿ç»´å»ºè®®](#62-è¿ç»´å»ºè®®)
  - [7. å‚è€ƒèµ„æ–™](#7-å‚è€ƒèµ„æ–™)

---

## 1. æ¦‚è¿°

### 1.1 æŠ€æœ¯èƒŒæ™¯

**é—®é¢˜éœ€æ±‚**:

äº‘åŸç”Ÿéƒ¨ç½²éœ€è¦æ”¯æŒå®¹å™¨åŒ–ã€è‡ªåŠ¨åŒ–ã€å¯æ‰©å±•çš„æ•°æ®åº“éƒ¨ç½²ï¼Œä½¿ç”¨ Kubernetes ç­‰å®¹å™¨ç¼–æ’å¹³å°ç®¡ç† PostgreSQL
é›†ç¾¤ã€‚

**æŠ€æœ¯æ¼”è¿›**:

1. **2015 å¹´**: Kubernetes é¡¹ç›®å¯åŠ¨
1. **2018 å¹´**: PostgreSQL Operator å‡ºç°
1. **2020 å¹´**: äº‘åŸç”Ÿæ•°æ®åº“æˆç†Ÿ
1. **2025 å¹´**: PostgreSQL 18 ä¼˜åŒ–äº‘åŸç”Ÿéƒ¨ç½²

### 1.2 æ–¹æ¡ˆå®šä½

äº‘åŸç”Ÿéƒ¨ç½²æ–¹æ¡ˆæä¾›åŸºäº Kubernetes çš„ PostgreSQL éƒ¨ç½²æ–¹æ¡ˆï¼Œæ”¯æŒè‡ªåŠ¨åŒ–éƒ¨ç½²ã€æ‰©å±•å’Œç®¡ç†ã€‚

### 1.3 æ ¸å¿ƒä»·å€¼

- **è‡ªåŠ¨åŒ–éƒ¨ç½²**: è‡ªåŠ¨åŒ–éƒ¨ç½²å’Œé…ç½®
- **å¼¹æ€§æ‰©å±•**: æ”¯æŒæ°´å¹³æ‰©å±•
- **é«˜å¯ç”¨æ€§**: ä¿è¯é«˜å¯ç”¨æ€§
- **æ˜“äºç®¡ç†**: ç®€åŒ–è¿ç»´ç®¡ç†

---

## 2. æ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Kubernetes Cluster                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PostgreSQL StatefulSet          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚ Primary  â”‚  â”‚ Replica  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  Pod     â”‚  â”‚  Pod     â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Service                         â”‚  â”‚
â”‚  â”‚  - Primary Service               â”‚  â”‚
â”‚  â”‚  - Replica Service               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PersistentVolume                â”‚  â”‚
â”‚  â”‚  - Data Volume                   â”‚  â”‚
â”‚  â”‚  - WAL Volume                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ç»„ä»¶è®¾è®¡

**æ ¸å¿ƒç»„ä»¶**:

- **StatefulSet**: ç®¡ç†æœ‰çŠ¶æ€ Pod
- **Service**: æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡
- **PersistentVolume**: æŒä¹…åŒ–å­˜å‚¨
- **ConfigMap**: é…ç½®ç®¡ç†
- **Secret**: å¯†é’¥ç®¡ç†

### 2.3 ç½‘ç»œè®¾è®¡

**ç½‘ç»œé…ç½®**:

- **ClusterIP**: é›†ç¾¤å†…éƒ¨è®¿é—®
- **NodePort**: èŠ‚ç‚¹ç«¯å£è®¿é—®
- **LoadBalancer**: è´Ÿè½½å‡è¡¡å™¨è®¿é—®

---

## 3. Kubernetes éƒ¨ç½²

### 3.1 StatefulSet éƒ¨ç½²

**StatefulSet é…ç½®**:

```yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: postgresql
spec:
  serviceName: postgresql
  replicas: 3
  selector:
    matchLabels:
      app: postgresql
  template:
    metadata:
      labels:
        app: postgresql
    spec:
      containers:
        - name: postgresql
          image: postgres:18
          env:
            - name: POSTGRES_DB
              value: mydb
            - name: POSTGRES_USER
              valueFrom:
                secretKeyRef:
                  name: postgresql-secret
                  key: username
            - name: POSTGRES_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: postgresql-secret
                  key: password
          volumeMounts:
            - name: data
              mountPath: /var/lib/postgresql/data
  volumeClaimTemplates:
    - metadata:
        name: data
      spec:
        accessModes: ["ReadWriteOnce"]
        resources:
          requests:
            storage: 100Gi
```

### 3.2 æœåŠ¡å‘ç°

**Service é…ç½®**:

```yaml
apiVersion: v1
kind: Service
metadata:
  name: postgresql-primary
spec:
  selector:
    app: postgresql
    role: primary
  ports:
    - port: 5432
      targetPort: 5432
  type: ClusterIP
```

### 3.3 å­˜å‚¨ç®¡ç†

**å­˜å‚¨é…ç½®**:

```yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: postgresql-data
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 100Gi
  storageClassName: fast-ssd
```

---

## 4. é«˜å¯ç”¨é…ç½®

### 4.1 ä¸»ä»å¤åˆ¶

**å¤åˆ¶é…ç½®**:

```yaml
# ä½¿ç”¨ PostgreSQL Operator é…ç½®ä¸»ä»å¤åˆ¶
apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: postgresql-cluster
spec:
  instances: 3
  postgresql:
    parameters:
      max_connections: "200"
      shared_buffers: "256MB"
  bootstrap:
    initdb:
      database: mydb
      owner: myuser
      secret:
        name: postgresql-secret
```

### 4.2 è‡ªåŠ¨æ•…éšœè½¬ç§»

**æ•…éšœè½¬ç§»é…ç½®**:

- **å¥åº·æ£€æŸ¥**: å®šæœŸå¥åº·æ£€æŸ¥
- **è‡ªåŠ¨åˆ‡æ¢**: ä¸»èŠ‚ç‚¹æ•…éšœè‡ªåŠ¨åˆ‡æ¢
- **æ•°æ®åŒæ­¥**: ä¿è¯æ•°æ®åŒæ­¥

### 4.3 è´Ÿè½½å‡è¡¡

**è´Ÿè½½å‡è¡¡é…ç½®**:

```yaml
apiVersion: v1
kind: Service
metadata:
  name: postgresql-read
spec:
  selector:
    app: postgresql
    role: replica
  ports:
    - port: 5432
      targetPort: 5432
  type: LoadBalancer
```

---

## 5. ç›‘æ§ä¸è¿ç»´

### 5.1 ç›‘æ§é…ç½®

**ç›‘æ§æ–¹æ¡ˆ**:

- **Prometheus**: æŒ‡æ ‡æ”¶é›†
- **Grafana**: å¯è§†åŒ–å±•ç¤º
- **AlertManager**: å‘Šè­¦ç®¡ç†

### 5.2 æ—¥å¿—ç®¡ç†

**æ—¥å¿—é…ç½®**:

- **é›†ä¸­æ—¥å¿—**: ä½¿ç”¨ ELK æˆ– Loki
- **æ—¥å¿—è½®è½¬**: è‡ªåŠ¨æ—¥å¿—è½®è½¬
- **æ—¥å¿—æŸ¥è¯¢**: æ”¯æŒæ—¥å¿—æŸ¥è¯¢

### 5.3 å¤‡ä»½æ¢å¤

**å¤‡ä»½é…ç½®**:

- **å®šæœŸå¤‡ä»½**: è‡ªåŠ¨å®šæœŸå¤‡ä»½
- **å¢é‡å¤‡ä»½**: æ”¯æŒå¢é‡å¤‡ä»½
- **å¿«é€Ÿæ¢å¤**: æ”¯æŒå¿«é€Ÿæ¢å¤

---

## 6. æœ€ä½³å®è·µ

### 6.1 éƒ¨ç½²å»ºè®®

- **èµ„æºè§„åˆ’**: åˆç†è§„åˆ’èµ„æº
- **å­˜å‚¨é€‰æ‹©**: é€‰æ‹©åˆé€‚çš„å­˜å‚¨ç±»å‹
- **ç½‘ç»œé…ç½®**: ä¼˜åŒ–ç½‘ç»œé…ç½®

### 6.2 è¿ç»´å»ºè®®

- **ç›‘æ§å‘Šè­¦**: è®¾ç½®ç›‘æ§å’Œå‘Šè­¦
- **å®šæœŸå¤‡ä»½**: å®šæœŸå¤‡ä»½æ•°æ®
- **ç‰ˆæœ¬å‡çº§**: è§„åˆ’ç‰ˆæœ¬å‡çº§

---

## 7. å‚è€ƒèµ„æ–™

- [Kubernetes æ–‡æ¡£](https://kubernetes.io/docs/)
- [PostgreSQL Operator](https://www.crunchydata.com/products/crunchy-postgresql-for-kubernetes)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥  
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
