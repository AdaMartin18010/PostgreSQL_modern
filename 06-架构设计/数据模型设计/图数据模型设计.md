# å›¾æ•°æ®æ¨¡åž‹è®¾è®¡

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+, Apache AGE 1.0+
> **æ–‡æ¡£ç¼–å·**: 06-02-03

## ðŸ“‘ ç›®å½•

- [å›¾æ•°æ®æ¨¡åž‹è®¾è®¡](#å›¾æ•°æ®æ¨¡åž‹è®¾è®¡)
  - [ðŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 æŠ€æœ¯èƒŒæ™¯](#11-æŠ€æœ¯èƒŒæ™¯)
    - [1.2 æ ¸å¿ƒä»·å€¼](#12-æ ¸å¿ƒä»·å€¼)
  - [2. æ•°æ®æ¨¡åž‹è®¾è®¡](#2-æ•°æ®æ¨¡åž‹è®¾è®¡)
    - [2.1 èŠ‚ç‚¹è®¾è®¡](#21-èŠ‚ç‚¹è®¾è®¡)
    - [2.2 è¾¹è®¾è®¡](#22-è¾¹è®¾è®¡)
    - [2.3 å›¾æ¨¡å¼è®¾è®¡](#23-å›¾æ¨¡å¼è®¾è®¡)
  - [3. Apache AGE é›†æˆ](#3-apache-age-é›†æˆ)
    - [3.1 AGE å®‰è£…](#31-age-å®‰è£…)
    - [3.2 å›¾åˆ›å»º](#32-å›¾åˆ›å»º)
    - [3.3 Cypher æŸ¥è¯¢](#33-cypher-æŸ¥è¯¢)
  - [4. æŸ¥è¯¢ä¼˜åŒ–](#4-æŸ¥è¯¢ä¼˜åŒ–)
    - [4.1 å›¾æŸ¥è¯¢ä¼˜åŒ–](#41-å›¾æŸ¥è¯¢ä¼˜åŒ–)
    - [4.2 ç´¢å¼•ç­–ç•¥](#42-ç´¢å¼•ç­–ç•¥)
  - [5. æœ€ä½³å®žè·µ](#5-æœ€ä½³å®žè·µ)
    - [5.1 å›¾è®¾è®¡å»ºè®®](#51-å›¾è®¾è®¡å»ºè®®)
    - [5.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®](#52-æ€§èƒ½ä¼˜åŒ–å»ºè®®)
  - [6. å‚è€ƒèµ„æ–™](#6-å‚è€ƒèµ„æ–™)

---

## 1. æ¦‚è¿°

### 1.1 æŠ€æœ¯èƒŒæ™¯

**é—®é¢˜éœ€æ±‚**:

å›¾æ•°æ®æ¨¡åž‹è®¾è®¡éœ€è¦ï¼š

- **å…³ç³»å»ºæ¨¡**: è¡¨ç¤ºå®žä½“ä¹‹é—´çš„å…³ç³»
- **å›¾æŸ¥è¯¢**: æ”¯æŒå¤æ‚çš„å›¾æŸ¥è¯¢ï¼ˆè·¯å¾„æŸ¥è¯¢ã€ç¤¾åŒºå‘çŽ°ï¼‰
- **æ€§èƒ½ä¼˜åŒ–**: é«˜æ•ˆçš„å›¾æŸ¥è¯¢æ€§èƒ½
- **ä¸Ž SQL é›†æˆ**: ä¸Ž PostgreSQL SQL æ— ç¼é›†æˆ

**æŠ€æœ¯æ–¹æ¡ˆ**:

- **Apache AGE**: PostgreSQL å›¾æ‰©å±•
- **Cypher**: å›¾æŸ¥è¯¢è¯­è¨€
- **å…³ç³»è¡¨**: ä¼ ç»Ÿå…³ç³»è¡¨å­˜å‚¨å›¾æ•°æ®

### 1.2 æ ¸å¿ƒä»·å€¼

- **æŸ¥è¯¢èƒ½åŠ›**: æ”¯æŒå¤æ‚å›¾æŸ¥è¯¢
- **æ€§èƒ½**: é«˜æ•ˆçš„å›¾æŸ¥è¯¢æ€§èƒ½
- **é›†æˆ**: ä¸Ž PostgreSQL æ— ç¼é›†æˆ

## 2. æ•°æ®æ¨¡åž‹è®¾è®¡

### 2.1 èŠ‚ç‚¹è®¾è®¡

```sql
-- ä½¿ç”¨ Apache AGE åˆ›å»ºèŠ‚ç‚¹
SELECT * FROM cypher('knowledge_graph', $$
    CREATE (p:Person {
        id: 'person_001',
        name: 'Alice',
        age: 30,
        email: 'alice@example.com'
    })
$$) AS (p agtype);

-- ä½¿ç”¨å…³ç³»è¡¨å­˜å‚¨èŠ‚ç‚¹ï¼ˆå¤‡é€‰æ–¹æ¡ˆï¼‰
CREATE TABLE nodes (
    id TEXT PRIMARY KEY,
    label TEXT NOT NULL,
    properties JSONB,
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX ON nodes (label);
CREATE INDEX ON nodes USING GIN (properties);
```

### 2.2 è¾¹è®¾è®¡

```sql
-- ä½¿ç”¨ Apache AGE åˆ›å»ºè¾¹
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (a:Person {id: 'person_001'}), (b:Person {id: 'person_002'})
    CREATE (a)-[r:KNOWS {
        since: '2020-01-01',
        strength: 0.8
    }]->(b)
$$) AS (r agtype);

-- ä½¿ç”¨å…³ç³»è¡¨å­˜å‚¨è¾¹ï¼ˆå¤‡é€‰æ–¹æ¡ˆï¼‰
CREATE TABLE edges (
    id SERIAL PRIMARY KEY,
    source_id TEXT NOT NULL REFERENCES nodes(id),
    target_id TEXT NOT NULL REFERENCES nodes(id),
    label TEXT NOT NULL,
    properties JSONB,
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX ON edges (source_id, target_id);
CREATE INDEX ON edges (label);
```

### 2.3 å›¾æ¨¡å¼è®¾è®¡

```sql
-- çŸ¥è¯†å›¾è°±æ¨¡å¼è®¾è®¡
-- èŠ‚ç‚¹ç±»åž‹ï¼šPerson, Organization, Document
-- è¾¹ç±»åž‹ï¼šKNOWS, WORKS_FOR, AUTHORED

-- åˆ›å»ºå›¾
SELECT create_graph('knowledge_graph');

-- åˆ›å»ºèŠ‚ç‚¹
SELECT * FROM cypher('knowledge_graph', $$
    CREATE
        (p:Person {id: 'p1', name: 'Alice'}),
        (o:Organization {id: 'o1', name: 'Company A'}),
        (d:Document {id: 'd1', title: 'Paper 1'})
$$) AS (result agtype);

-- åˆ›å»ºè¾¹
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (p:Person {id: 'p1'}), (o:Organization {id: 'o1'})
    CREATE (p)-[:WORKS_FOR {since: '2020-01-01'}]->(o)
$$) AS (result agtype);
```

## 3. Apache AGE é›†æˆ

### 3.1 AGE å®‰è£…

```sql
-- å®‰è£… Apache AGE æ‰©å±•
CREATE EXTENSION IF NOT EXISTS age;

-- åŠ è½½ AGE
LOAD 'age';

-- éªŒè¯å®‰è£…
SELECT * FROM pg_extension WHERE extname = 'age';
```

### 3.2 å›¾åˆ›å»º

```sql
-- åˆ›å»ºå›¾
SELECT create_graph('my_graph');

-- åˆ—å‡ºæ‰€æœ‰å›¾
SELECT * FROM ag_catalog.ag_graph;

-- åˆ é™¤å›¾
SELECT drop_graph('my_graph', true);
```

### 3.3 Cypher æŸ¥è¯¢

```sql
-- 1. èŠ‚ç‚¹æŸ¥è¯¢
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (p:Person)
    RETURN p.name, p.age
    LIMIT 10
$$) AS (name agtype, age agtype);

-- 2. è·¯å¾„æŸ¥è¯¢
SELECT * FROM cypher('knowledge_graph', $$
    MATCH path = (a:Person)-[:KNOWS*..3]->(b:Person)
    WHERE a.id = 'person_001'
    RETURN path, length(path) AS path_length
    LIMIT 10
$$) AS (path agtype, path_length agtype);

-- 3. æœ€çŸ­è·¯å¾„æŸ¥è¯¢
SELECT * FROM cypher('knowledge_graph', $$
    MATCH path = shortestPath(
        (a:Person {id: 'person_001'})-[*..10]-(b:Person {id: 'person_002'})
    )
    RETURN path
$$) AS (path agtype);
```

## 4. æŸ¥è¯¢ä¼˜åŒ–

### 4.1 å›¾æŸ¥è¯¢ä¼˜åŒ–

```sql
-- 1. é™åˆ¶æŸ¥è¯¢æ·±åº¦
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (a:Person)-[*..2]-(b:Person)
    WHERE a.id = 'person_001'
    RETURN b
    LIMIT 100
$$) AS (b agtype);

-- 2. ä½¿ç”¨ç´¢å¼•åŠ é€ŸæŸ¥è¯¢
-- åœ¨èŠ‚ç‚¹å±žæ€§ä¸Šåˆ›å»ºç´¢å¼•
CREATE INDEX ON nodes USING GIN (properties);

-- 3. è¿‡æ»¤æ¡ä»¶å‰ç½®
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (p:Person)
    WHERE p.age > 25 AND p.age < 35
    RETURN p
    LIMIT 100
$$) AS (p agtype);
```

### 4.2 ç´¢å¼•ç­–ç•¥

```sql
-- 1. èŠ‚ç‚¹æ ‡ç­¾ç´¢å¼•
CREATE INDEX ON nodes (label);

-- 2. èŠ‚ç‚¹å±žæ€§ç´¢å¼•
CREATE INDEX ON nodes USING GIN (properties);

-- 3. è¾¹ç´¢å¼•
CREATE INDEX ON edges (source_id, target_id);
CREATE INDEX ON edges (label);
```

## 5. æœ€ä½³å®žè·µ

### 5.1 å›¾è®¾è®¡å»ºè®®

1. **èŠ‚ç‚¹è®¾è®¡**:
   - ä½¿ç”¨æœ‰æ„ä¹‰çš„æ ‡ç­¾ï¼ˆPerson, Organizationï¼‰
   - èŠ‚ç‚¹å±žæ€§ä½¿ç”¨ JSONB å­˜å‚¨

2. **è¾¹è®¾è®¡**:
   - ä½¿ç”¨æœ‰æ„ä¹‰çš„è¾¹ç±»åž‹ï¼ˆKNOWS, WORKS_FORï¼‰
   - è¾¹å±žæ€§å­˜å‚¨å…³ç³»å…ƒæ•°æ®

3. **æŸ¥è¯¢ä¼˜åŒ–**:
   - é™åˆ¶æŸ¥è¯¢æ·±åº¦ï¼ˆ*..3ï¼‰
   - ä½¿ç”¨ç´¢å¼•åŠ é€ŸæŸ¥è¯¢
   - è¿‡æ»¤æ¡ä»¶å‰ç½®

### 5.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **ç´¢å¼•**: åœ¨å¸¸ç”¨æŸ¥è¯¢å±žæ€§ä¸Šåˆ›å»ºç´¢å¼•
2. **æŸ¥è¯¢æ·±åº¦**: é™åˆ¶å›¾æŸ¥è¯¢æ·±åº¦
3. **ç»“æžœé™åˆ¶**: ä½¿ç”¨ LIMIT é™åˆ¶è¿”å›žç»“æžœ

## 6. å‚è€ƒèµ„æ–™

- [å¤šæ¨¡æ•°æ®æ¨¡åž‹è®¾è®¡](./å¤šæ¨¡æ•°æ®æ¨¡åž‹è®¾è®¡.md)
- [å‘é‡æ•°æ®æ¨¡åž‹è®¾è®¡](./å‘é‡æ•°æ®æ¨¡åž‹è®¾è®¡.md)
- [å¤šæ¨¡æ•°æ®æ¨¡åž‹è®¾è®¡](../../04-å¤šæ¨¡ä¸€ä½“åŒ–/æŠ€æœ¯åŽŸç†/å¤šæ¨¡æ•°æ®æ¨¡åž‹è®¾è®¡.md)

---

**æœ€åŽæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 06-02-03
