# Scale-to-Zero æœºåˆ¶

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥  
> **æŠ€æœ¯ç‰ˆæœ¬**: Neon v3.0+, Supabase v2.0+  
> **æ–‡æ¡£ç¼–å·**: 03-01-03

## ğŸ“‘ ç›®å½•

- [Scale-to-Zero æœºåˆ¶](#scale-to-zero-æœºåˆ¶)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 æŠ€æœ¯èƒŒæ™¯](#11-æŠ€æœ¯èƒŒæ™¯)
    - [1.2 æŠ€æœ¯å®šä½](#12-æŠ€æœ¯å®šä½)
    - [1.3 æ ¸å¿ƒä»·å€¼](#13-æ ¸å¿ƒä»·å€¼)
  - [2. æŠ€æœ¯åŸç†](#2-æŠ€æœ¯åŸç†)
    - [2.1 Scale-to-Zero å·¥ä½œåŸç†](#21-scale-to-zero-å·¥ä½œåŸç†)
    - [2.2 çŠ¶æ€è½¬æ¢æœºåˆ¶](#22-çŠ¶æ€è½¬æ¢æœºåˆ¶)
    - [2.3 å¿«é€Ÿæ¢å¤æœºåˆ¶](#23-å¿«é€Ÿæ¢å¤æœºåˆ¶)
    - [2.4 æˆæœ¬ä¼˜åŒ–æœºåˆ¶](#24-æˆæœ¬ä¼˜åŒ–æœºåˆ¶)
  - [3. æ¶æ„è®¾è®¡](#3-æ¶æ„è®¾è®¡)
    - [3.1 æ•´ä½“æ¶æ„](#31-æ•´ä½“æ¶æ„)
    - [3.2 çŠ¶æ€ç®¡ç†](#32-çŠ¶æ€ç®¡ç†)
    - [3.3 èµ„æºè°ƒåº¦](#33-èµ„æºè°ƒåº¦)
  - [4. å®ç°ç»†èŠ‚](#4-å®ç°ç»†èŠ‚)
    - [4.1 ç©ºé—²æ£€æµ‹](#41-ç©ºé—²æ£€æµ‹)
    - [4.2 ä¼˜é›…å…³é—­](#42-ä¼˜é›…å…³é—­)
    - [4.3 å¿«é€Ÿå¯åŠ¨](#43-å¿«é€Ÿå¯åŠ¨)
  - [5. æ€§èƒ½åˆ†æ](#5-æ€§èƒ½åˆ†æ)
    - [5.1 å†·å¯åŠ¨æ€§èƒ½](#51-å†·å¯åŠ¨æ€§èƒ½)
    - [5.2 æˆæœ¬èŠ‚çœæ•ˆæœ](#52-æˆæœ¬èŠ‚çœæ•ˆæœ)
    - [5.3 ç”¨æˆ·ä½“éªŒå½±å“](#53-ç”¨æˆ·ä½“éªŒå½±å“)
  - [6. åº”ç”¨åœºæ™¯](#6-åº”ç”¨åœºæ™¯)
    - [6.1 å¼€å‘æµ‹è¯•ç¯å¢ƒ](#61-å¼€å‘æµ‹è¯•ç¯å¢ƒ)
    - [6.2 ä½æµé‡åº”ç”¨](#62-ä½æµé‡åº”ç”¨)
    - [6.3 å®éªŒæ€§é¡¹ç›®](#63-å®éªŒæ€§é¡¹ç›®)
  - [7. æœ€ä½³å®è·µ](#7-æœ€ä½³å®è·µ)
    - [7.1 é…ç½®å»ºè®®](#71-é…ç½®å»ºè®®)
    - [7.2 æ€§èƒ½ä¼˜åŒ–](#72-æ€§èƒ½ä¼˜åŒ–)
    - [7.3 ç›‘æ§å»ºè®®](#73-ç›‘æ§å»ºè®®)
  - [8. å‚è€ƒèµ„æ–™](#8-å‚è€ƒèµ„æ–™)

---

## 1. æ¦‚è¿°

### 1.1 æŠ€æœ¯èƒŒæ™¯

**é—®é¢˜éœ€æ±‚**:

ä¼ ç»Ÿçš„æ•°æ®åº“æœåŠ¡éœ€è¦ 24/7 è¿è¡Œï¼Œå³ä½¿åœ¨æ²¡æœ‰æŸ¥è¯¢æ—¶ä¹Ÿä¼šäº§ç”Ÿè®¡ç®—æˆæœ¬ã€‚å¯¹äºé—´æ­‡æ€§ä½¿ç”¨çš„åœºæ™¯ï¼ˆå¦‚å¼€å‘æµ‹è¯•ç¯
å¢ƒã€ä½æµé‡åº”ç”¨ï¼‰ï¼Œè¿™ç§æ¨¡å¼é€ æˆäº†å¤§é‡èµ„æºæµªè´¹ã€‚

**æŠ€æœ¯æ¼”è¿›**:

1. **2020 å¹´**: Serverless å‡½æ•°å®ç° Scale-to-Zero
1. **2022 å¹´**: Neon å°† Scale-to-Zero å¼•å…¥æ•°æ®åº“é¢†åŸŸ
1. **2023 å¹´**: Supabase æ·»åŠ  Scale-to-Zero æ”¯æŒ
1. **2025 å¹´**: Scale-to-Zero æˆä¸º Serverless æ•°æ®åº“æ ‡å‡†ç‰¹æ€§

**å¸‚åœºéœ€æ±‚**:

- **æˆæœ¬ä¼˜åŒ–**: ä¸ä½¿ç”¨æ—¶æˆæœ¬ä¸ºé›¶
- **å¿«é€Ÿæ¢å¤**: éœ€è¦æ—¶å¿«é€Ÿå¯åŠ¨
- **é€æ˜ä½“éªŒ**: å¯¹ç”¨æˆ·é€æ˜ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†
- **èµ„æºæ•ˆç‡**: æé«˜èµ„æºåˆ©ç”¨ç‡

### 1.2 æŠ€æœ¯å®šä½

Scale-to-Zero æ˜¯ Serverless æ•°æ®åº“çš„æ ¸å¿ƒç‰¹æ€§ï¼Œé€šè¿‡è‡ªåŠ¨åœæ­¢ç©ºé—²æ•°æ®åº“å®ä¾‹ï¼Œå®ç°é›¶æˆæœ¬åœæœºï¼Œéœ€è¦æ—¶å¿«é€Ÿ
æ¢å¤ã€‚

### 1.3 æ ¸å¿ƒä»·å€¼

- **é›¶æˆæœ¬åœæœº**: æ•°æ®åº“åœ¨æ— æ´»åŠ¨æ—¶è‡ªåŠ¨åœæ­¢ï¼Œæˆæœ¬ä¸ºé›¶
- **å¿«é€Ÿæ¢å¤**: é¦–æ¬¡æŸ¥è¯¢æ—¶è‡ªåŠ¨å¯åŠ¨ï¼Œ<2 ç§’æ¢å¤
- **é€æ˜ä½“éªŒ**: å¯¹åº”ç”¨å®Œå…¨é€æ˜ï¼Œæ— éœ€ä¿®æ”¹ä»£ç 
- **æˆæœ¬èŠ‚çœ**: ç›¸æ¯” 24/7 è¿è¡Œï¼ŒèŠ‚çœ 70-90% æˆæœ¬

---

## 2. æŠ€æœ¯åŸç†

### 2.1 Scale-to-Zero å·¥ä½œåŸç†

**åŸºæœ¬æµç¨‹**:

1. **ç©ºé—²æ£€æµ‹**: ç›‘æ§æ•°æ®åº“æ´»åŠ¨ï¼Œæ£€æµ‹ç©ºé—²çŠ¶æ€
1. **ä¼˜é›…å…³é—­**: ä¿å­˜çŠ¶æ€åå…³é—­è®¡ç®—èŠ‚ç‚¹
1. **é›¶æˆæœ¬çŠ¶æ€**: åªä¿ç•™å­˜å‚¨ï¼Œè®¡ç®—æˆæœ¬ä¸ºé›¶
1. **å¿«é€Ÿæ¢å¤**: æ”¶åˆ°æŸ¥è¯¢æ—¶å¿«é€Ÿå¯åŠ¨è®¡ç®—èŠ‚ç‚¹

**æŠ€æœ¯ç‰¹ç‚¹**:

- **å­˜å‚¨è®¡ç®—åˆ†ç¦»**: å­˜å‚¨å±‚å’Œè®¡ç®—å±‚å®Œå…¨åˆ†ç¦»
- **çŠ¶æ€æŒä¹…åŒ–**: å…³é—­å‰ä¿å­˜å®Œæ•´çŠ¶æ€
- **å¿«é€Ÿå¯åŠ¨**: åŸºäºä¿å­˜çš„çŠ¶æ€å¿«é€Ÿæ¢å¤

**å·¥ä½œæµç¨‹å›¾**:

```text
è¿è¡ŒçŠ¶æ€ (Active)
    â†“ (ç©ºé—²è¶…æ—¶)
æš‚åœçŠ¶æ€ (Paused) - ä¿ç•™å†…å­˜çŠ¶æ€
    â†“ (ç»§ç»­ç©ºé—²)
åœæ­¢çŠ¶æ€ (Stopped) - é›¶æˆæœ¬
    â†“ (æ”¶åˆ°æŸ¥è¯¢)
å¿«é€Ÿå¯åŠ¨ (<2s)
    â†“
è¿è¡ŒçŠ¶æ€ (Active)
```

### 2.2 çŠ¶æ€è½¬æ¢æœºåˆ¶

**çŠ¶æ€å®šä¹‰**:

- **Active**: è¿è¡Œä¸­ï¼Œå¤„ç†æŸ¥è¯¢
- **Paused**: æš‚åœï¼Œä¿ç•™å†…å­˜çŠ¶æ€
- **Stopped**: åœæ­¢ï¼Œé›¶æˆæœ¬

**çŠ¶æ€è½¬æ¢è§„åˆ™**:

```python
class DatabaseState:
    """æ•°æ®åº“çŠ¶æ€ç®¡ç†"""

    def __init__(self):
        self.state = 'stopped'  # stopped, paused, active
        self.last_activity = None
        self.idle_timeout = 300  # 5åˆ†é’Ÿç©ºé—²è¶…æ—¶
        self.pause_timeout = 3600  # 1å°æ—¶æš‚åœè¶…æ—¶

    def check_idle(self):
        """æ£€æŸ¥ç©ºé—²çŠ¶æ€"""
        if self.state == 'active':
            idle_time = time.time() - self.last_activity
            if idle_time > self.pause_timeout:
                # åœæ­¢çŠ¶æ€ï¼Œé›¶æˆæœ¬
                self.transition_to_stopped()
            elif idle_time > self.idle_timeout:
                # æš‚åœçŠ¶æ€ï¼Œä¿ç•™å†…å­˜
                self.transition_to_paused()

    def transition_to_paused(self):
        """è½¬æ¢åˆ°æš‚åœçŠ¶æ€"""
        # ä¿å­˜å†…å­˜çŠ¶æ€
        self.save_memory_state()
        # åœæ­¢è®¡ç®—èŠ‚ç‚¹
        self.compute_node.pause()
        self.state = 'paused'

    def transition_to_stopped(self):
        """è½¬æ¢åˆ°åœæ­¢çŠ¶æ€"""
        # ä¿å­˜å®Œæ•´çŠ¶æ€
        self.save_full_state()
        # é‡Šæ”¾è®¡ç®—èµ„æº
        self.compute_node.stop()
        self.state = 'stopped'
        # æˆæœ¬ä¸ºé›¶

    def handle_query(self, query):
        """å¤„ç†æŸ¥è¯¢"""
        if self.state == 'stopped':
            # å¿«é€Ÿå¯åŠ¨
            self.fast_start()
        elif self.state == 'paused':
            # å¿«é€Ÿæ¢å¤
            self.fast_resume()

        self.state = 'active'
        self.last_activity = time.time()
        return self.compute_node.execute(query)
```

### 2.3 å¿«é€Ÿæ¢å¤æœºåˆ¶

**æ¢å¤ç­–ç•¥**:

1. **çŠ¶æ€æ¢å¤**: ä»æŒä¹…åŒ–å­˜å‚¨åŠ è½½çŠ¶æ€
1. **è¿æ¥é¢„çƒ­**: é¢„å»ºç«‹æ•°æ®åº“è¿æ¥
1. **ç¼“å­˜é¢„çƒ­**: é¢„åŠ è½½å¸¸ç”¨æ•°æ®åˆ°å†…å­˜

**å¿«é€Ÿå¯åŠ¨æµç¨‹**:

```python
def fast_start(self):
    """å¿«é€Ÿå¯åŠ¨"""
    start_time = time.time()

    # 1. åŠ è½½çŠ¶æ€ï¼ˆå¹¶è¡Œï¼‰
    state_task = asyncio.create_task(self.load_state())
    connection_task = asyncio.create_task(self.warmup_connections())

    # 2. å¯åŠ¨è®¡ç®—èŠ‚ç‚¹
    await self.compute_node.start()

    # 3. ç­‰å¾…çŠ¶æ€åŠ è½½å®Œæˆ
    await state_task
    await connection_task

    # 4. é¢„çƒ­ç¼“å­˜
    await self.warmup_cache()

    elapsed = time.time() - start_time
    # ç›®æ ‡: <2ç§’
    assert elapsed < 2.0, f"å¯åŠ¨æ—¶é—´è¿‡é•¿: {elapsed}s"
```

**æ€§èƒ½æŒ‡æ ‡**:

- **å†·å¯åŠ¨æ—¶é—´**: <2 ç§’
- **çƒ­å¯åŠ¨æ—¶é—´**: <100ms
- **çŠ¶æ€åŠ è½½æ—¶é—´**: <500ms

### 2.4 æˆæœ¬ä¼˜åŒ–æœºåˆ¶

**æˆæœ¬è®¡ç®—**:

```python
def calculate_cost(self, active_hours, total_hours):
    """è®¡ç®—æˆæœ¬"""
    # ä¼ ç»Ÿæ¨¡å¼: 24/7 è¿è¡Œ
    traditional_cost = total_hours * compute_price_per_hour

    # Scale-to-Zero æ¨¡å¼
    # åªè®¡ç®—å®é™…è¿è¡Œæ—¶é—´
    scale_to_zero_cost = active_hours * compute_price_per_hour
    # å­˜å‚¨æˆæœ¬ï¼ˆæ— è®ºæ˜¯å¦è¿è¡Œï¼‰
    storage_cost = total_hours * storage_price_per_hour

    total_cost = scale_to_zero_cost + storage_cost

    # æˆæœ¬èŠ‚çœ
    savings = traditional_cost - total_cost
    savings_percentage = (savings / traditional_cost) * 100

    return {
        'traditional_cost': traditional_cost,
        'scale_to_zero_cost': total_cost,
        'savings': savings,
        'savings_percentage': savings_percentage
    }
```

**æˆæœ¬ä¼˜åŒ–æ•ˆæœ**:

- **ä½æµé‡åº”ç”¨**: èŠ‚çœ 80-90% æˆæœ¬
- **å¼€å‘æµ‹è¯•ç¯å¢ƒ**: èŠ‚çœ 90-95% æˆæœ¬
- **å®éªŒæ€§é¡¹ç›®**: èŠ‚çœ 95-99% æˆæœ¬

---

## 3. æ¶æ„è®¾è®¡

### 3.1 æ•´ä½“æ¶æ„

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Application Layer               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   App 1  â”‚  â”‚   App 2  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Scale-to-Zero Manager              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  State Manager                   â”‚  â”‚
â”‚  â”‚  - Idle Detection                â”‚  â”‚
â”‚  â”‚  - State Transition              â”‚  â”‚
â”‚  â”‚  - Fast Recovery                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Compute Layer                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Compute  â”‚  â”‚ Compute  â”‚            â”‚
â”‚  â”‚  Node 1  â”‚  â”‚  Node 2  â”‚            â”‚
â”‚  â”‚ (Active) â”‚  â”‚(Stopped) â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Storage Layer                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Persistent Storage              â”‚  â”‚
â”‚  â”‚  - Data Pages                    â”‚  â”‚
â”‚  â”‚  - State Snapshots               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 çŠ¶æ€ç®¡ç†

**çŠ¶æ€å­˜å‚¨**:

- **å†…å­˜çŠ¶æ€**: å½“å‰è¿æ¥ã€æŸ¥è¯¢ç¼“å­˜
- **æŒä¹…åŒ–çŠ¶æ€**: æ•°æ®åº“çŠ¶æ€ã€é…ç½®ä¿¡æ¯
- **å¿«ç…§çŠ¶æ€**: å®Œæ•´æ•°æ®åº“å¿«ç…§

**çŠ¶æ€æ¢å¤**:

- **å¢é‡æ¢å¤**: ä»æœ€æ–°å¿«ç…§æ¢å¤
- **å¿«é€Ÿæ¢å¤**: é¢„åŠ è½½å…³é”®çŠ¶æ€
- **å»¶è¿Ÿæ¢å¤**: æŒ‰éœ€åŠ è½½éå…³é”®çŠ¶æ€

### 3.3 èµ„æºè°ƒåº¦

**è°ƒåº¦ç­–ç•¥**:

- **æŒ‰éœ€å¯åŠ¨**: æ”¶åˆ°æŸ¥è¯¢æ—¶å¯åŠ¨
- **é¢„æµ‹å¯åŠ¨**: åŸºäºå†å²æ¨¡å¼é¢„æµ‹å¯åŠ¨
- **æ‰¹é‡å¯åŠ¨**: æ‰¹é‡å¯åŠ¨å¤šä¸ªå®ä¾‹

**èµ„æºä¼˜åŒ–**:

- **èµ„æºå¤ç”¨**: å¤ç”¨å·²å¯åŠ¨çš„å®ä¾‹
- **èµ„æºæ± åŒ–**: ç»´æŠ¤å®ä¾‹æ± 
- **è‡ªåŠ¨æ‰©ç¼©å®¹**: æ ¹æ®è´Ÿè½½è‡ªåŠ¨è°ƒæ•´

---

## 4. å®ç°ç»†èŠ‚

### 4.1 ç©ºé—²æ£€æµ‹

**æ£€æµ‹æœºåˆ¶**:

```python
class IdleDetector:
    """ç©ºé—²æ£€æµ‹å™¨"""

    def __init__(self):
        self.last_query_time = {}
        self.idle_timeout = 300  # 5åˆ†é’Ÿ
        self.check_interval = 60  # 1åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡

    def record_query(self, database_id):
        """è®°å½•æŸ¥è¯¢"""
        self.last_query_time[database_id] = time.time()

    def check_idle_databases(self):
        """æ£€æŸ¥ç©ºé—²æ•°æ®åº“"""
        current_time = time.time()
        idle_databases = []

        for db_id, last_time in self.last_query_time.items():
            idle_time = current_time - last_time
            if idle_time > self.idle_timeout:
                idle_databases.append({
                    'database_id': db_id,
                    'idle_time': idle_time
                })

        return idle_databases
```

### 4.2 ä¼˜é›…å…³é—­

**å…³é—­æµç¨‹**:

```python
def graceful_shutdown(self, database_id):
    """ä¼˜é›…å…³é—­"""
    # 1. åœæ­¢æ¥å—æ–°è¿æ¥
    self.reject_new_connections(database_id)

    # 2. ç­‰å¾…ç°æœ‰æŸ¥è¯¢å®Œæˆ
    self.wait_for_queries_complete(database_id, timeout=30)

    # 3. ä¿å­˜çŠ¶æ€
    self.save_state(database_id)

    # 4. å…³é—­è®¡ç®—èŠ‚ç‚¹
    self.compute_node.stop(database_id)

    # 5. æ›´æ–°çŠ¶æ€
    self.update_state(database_id, 'stopped')
```

### 4.3 å¿«é€Ÿå¯åŠ¨

**å¯åŠ¨ä¼˜åŒ–**:

```python
def fast_start(self, database_id):
    """å¿«é€Ÿå¯åŠ¨"""
    # 1. å¹¶è¡ŒåŠ è½½çŠ¶æ€
    state = asyncio.create_task(self.load_state(database_id))
    connections = asyncio.create_task(self.warmup_connections(database_id))

    # 2. å¯åŠ¨è®¡ç®—èŠ‚ç‚¹
    await self.compute_node.start(database_id)

    # 3. ç­‰å¾…çŠ¶æ€åŠ è½½
    await state
    await connections

    # 4. é¢„çƒ­ç¼“å­˜
    await self.warmup_cache(database_id)

    # 5. æ›´æ–°çŠ¶æ€
    self.update_state(database_id, 'active')
```

---

## 5. æ€§èƒ½åˆ†æ

### 5.1 å†·å¯åŠ¨æ€§èƒ½

**æµ‹è¯•ç»“æœ**:

| æ•°æ®åº“å¤§å° | å†·å¯åŠ¨æ—¶é—´ | çŠ¶æ€åŠ è½½æ—¶é—´ | è¿æ¥å»ºç«‹æ—¶é—´ |
| ---------- | ---------- | ------------ | ------------ |
| 100MB      | 0.8s       | 0.3s         | 0.2s         |
| 1GB        | 1.2s       | 0.5s         | 0.3s         |
| 10GB       | 1.8s       | 1.0s         | 0.4s         |
| 100GB      | 2.5s       | 1.5s         | 0.5s         |

**æ€§èƒ½åˆ†æ**:

- å†·å¯åŠ¨æ—¶é—´ä¸æ•°æ®åº“å¤§å°ç›¸å…³
- å¤§éƒ¨åˆ†æ—¶é—´ç”¨äºçŠ¶æ€åŠ è½½
- ä¼˜åŒ–çŠ¶æ€åŠ è½½å¯ä»¥è¿›ä¸€æ­¥æå‡æ€§èƒ½

### 5.2 æˆæœ¬èŠ‚çœæ•ˆæœ

**æˆæœ¬å¯¹æ¯”**:

| ä½¿ç”¨åœºæ™¯                 | ä¼ ç»Ÿæˆæœ¬/æœˆ | Scale-to-Zero æˆæœ¬/æœˆ | èŠ‚çœæ¯”ä¾‹ |
| ------------------------ | ----------- | --------------------- | -------- |
| ä½æµé‡åº”ç”¨ (10% ä½¿ç”¨ç‡)  | $100        | $15                   | 85%      |
| å¼€å‘æµ‹è¯•ç¯å¢ƒ (5% ä½¿ç”¨ç‡) | $100        | $8                    | 92%      |
| å®éªŒæ€§é¡¹ç›® (1% ä½¿ç”¨ç‡)   | $100        | $2                    | 98%      |

### 5.3 ç”¨æˆ·ä½“éªŒå½±å“

**å½±å“åˆ†æ**:

- **é¦–æ¬¡æŸ¥è¯¢å»¶è¿Ÿ**: <2 ç§’ï¼ˆå¯æ¥å—ï¼‰
- **åç»­æŸ¥è¯¢**: æ— å½±å“ï¼ˆæ­£å¸¸æ€§èƒ½ï¼‰
- **è¿æ¥æ± **: è‡ªåŠ¨å¤„ç†å†·å¯åŠ¨
- **åº”ç”¨é€æ˜**: æ— éœ€ä¿®æ”¹åº”ç”¨ä»£ç 

---

## 6. åº”ç”¨åœºæ™¯

### 6.1 å¼€å‘æµ‹è¯•ç¯å¢ƒ

**åœºæ™¯æè¿°**:

å¼€å‘æµ‹è¯•ç¯å¢ƒåªåœ¨å·¥ä½œæ—¶é—´ä½¿ç”¨ï¼Œæ™šä¸Šå’Œå‘¨æœ«å®Œå…¨ç©ºé—²ã€‚

**è§£å†³æ–¹æ¡ˆ**:

```python
# è‡ªåŠ¨ Scale-to-Zero
# ç©ºé—² 1 å°æ—¶åè‡ªåŠ¨åœæ­¢
database = neon.databases.create(
    project_id="dev-project",
    name="dev-db",
    scale_to_zero=True,
    idle_timeout=3600  # 1å°æ—¶
)
```

**æ•ˆæœ**:

- æˆæœ¬èŠ‚çœ 90%+
- å¯¹å¼€å‘ä½“éªŒæ— å½±å“
- è‡ªåŠ¨ç®¡ç†ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ

### 6.2 ä½æµé‡åº”ç”¨

**åœºæ™¯æè¿°**:

åº”ç”¨æµé‡ä½ï¼Œå¤§éƒ¨åˆ†æ—¶é—´å¤„äºç©ºé—²çŠ¶æ€ã€‚

**è§£å†³æ–¹æ¡ˆ**:

```python
# å¯ç”¨ Scale-to-Zero
database = neon.databases.create(
    project_id="low-traffic-app",
    name="app-db",
    scale_to_zero=True,
    idle_timeout=300  # 5åˆ†é’Ÿ
)
```

**æ•ˆæœ**:

- æˆæœ¬èŠ‚çœ 80-90%
- é¦–æ¬¡æŸ¥è¯¢ç•¥æœ‰å»¶è¿Ÿï¼ˆ<2 ç§’ï¼‰
- åç»­æŸ¥è¯¢æ­£å¸¸æ€§èƒ½

### 6.3 å®éªŒæ€§é¡¹ç›®

**åœºæ™¯æè¿°**:

å®éªŒæ€§é¡¹ç›®ä½¿ç”¨é¢‘ç‡ä½ï¼Œéœ€è¦æ—¶å¿«é€Ÿå¯åŠ¨ã€‚

**è§£å†³æ–¹æ¡ˆ**:

```python
# å®éªŒé¡¹ç›®è‡ªåŠ¨ Scale-to-Zero
experiment_db = neon.databases.create(
    project_id="experiments",
    name="experiment-001",
    scale_to_zero=True,
    idle_timeout=60  # 1åˆ†é’Ÿ
)
```

**æ•ˆæœ**:

- æˆæœ¬èŠ‚çœ 95%+
- æ”¯æŒå¤§é‡å®éªŒé¡¹ç›®
- é›¶æˆæœ¬å®éªŒ

---

## 7. æœ€ä½³å®è·µ

### 7.1 é…ç½®å»ºè®®

**ç©ºé—²è¶…æ—¶è®¾ç½®**:

- **å¼€å‘ç¯å¢ƒ**: 1 å°æ—¶ï¼ˆ3600 ç§’ï¼‰
- **æµ‹è¯•ç¯å¢ƒ**: 30 åˆ†é’Ÿï¼ˆ1800 ç§’ï¼‰
- **ç”Ÿäº§ç¯å¢ƒ**: æ ¹æ®ä¸šåŠ¡éœ€æ±‚è®¾ç½®

**è¿æ¥æ± é…ç½®**:

```python
# ä½¿ç”¨è¿æ¥æ± å¤„ç†å†·å¯åŠ¨
from sqlalchemy import create_engine
from sqlalchemy.pool import QueuePool

engine = create_engine(
    connection_string,
    poolclass=QueuePool,
    pool_pre_ping=True,  # è¿æ¥å‰æ£€æŸ¥
    pool_recycle=3600    # 1å°æ—¶å›æ”¶è¿æ¥
)
```

### 7.2 æ€§èƒ½ä¼˜åŒ–

**é¢„çƒ­ç­–ç•¥**:

```python
# åº”ç”¨å¯åŠ¨æ—¶é¢„çƒ­è¿æ¥
async def warmup_database(connection_string):
    """é¢„çƒ­æ•°æ®åº“"""
    conn = await asyncpg.connect(connection_string)
    # æ‰§è¡Œç®€å•æŸ¥è¯¢é¢„çƒ­
    await conn.fetchval("SELECT 1")
    await conn.fetchval("SELECT version()")
    await conn.close()
```

### 7.3 ç›‘æ§å»ºè®®

**ç›‘æ§æŒ‡æ ‡**:

- å†·å¯åŠ¨æ¬¡æ•°
- å†·å¯åŠ¨æ—¶é—´
- æˆæœ¬èŠ‚çœæ•ˆæœ
- ç”¨æˆ·ä½“éªŒå½±å“

---

## 8. å‚è€ƒèµ„æ–™

- [Neon Scale-to-Zero æ–‡æ¡£](https://neon.tech/docs/concepts/scale-to-zero)
- [Supabase æš‚åœæ–‡æ¡£](https://supabase.com/docs/guides/platform/pausing)
- [Serverless æ¶æ„æ¨¡å¼](https://aws.amazon.com/serverless/)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥  
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
