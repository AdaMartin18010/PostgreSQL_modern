# Supabase æ¶æ„è®¾è®¡

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥  
> **æŠ€æœ¯ç‰ˆæœ¬**: Supabase v2.0+  
> **æ–‡æ¡£ç¼–å·**: 03-03-01

## ğŸ“‘ ç›®å½•

- [Supabase æ¶æ„è®¾è®¡](#supabase-æ¶æ„è®¾è®¡)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 æŠ€æœ¯èƒŒæ™¯](#11-æŠ€æœ¯èƒŒæ™¯)
    - [1.2 æ¶æ„å®šä½](#12-æ¶æ„å®šä½)
    - [1.3 æ ¸å¿ƒä»·å€¼](#13-æ ¸å¿ƒä»·å€¼)
  - [2. æ¶æ„è®¾è®¡](#2-æ¶æ„è®¾è®¡)
    - [2.1 æ•´ä½“æ¶æ„](#21-æ•´ä½“æ¶æ„)
    - [2.2 æ ¸å¿ƒç»„ä»¶](#22-æ ¸å¿ƒç»„ä»¶)
    - [2.3 æ•°æ®æµè®¾è®¡](#23-æ•°æ®æµè®¾è®¡)
  - [3. æ ¸å¿ƒç‰¹æ€§](#3-æ ¸å¿ƒç‰¹æ€§)
    - [3.1 å®æ—¶åŠŸèƒ½](#31-å®æ—¶åŠŸèƒ½)
    - [3.2 æ··åˆæœç´¢](#32-æ··åˆæœç´¢)
    - [3.3 è®¤è¯æˆæƒ](#33-è®¤è¯æˆæƒ)
  - [4. å®ç°ç»†èŠ‚](#4-å®ç°ç»†èŠ‚)
    - [4.1 å®æ—¶è®¢é˜…å®ç°](#41-å®æ—¶è®¢é˜…å®ç°)
    - [4.2 æ··åˆæœç´¢é›†æˆ](#42-æ··åˆæœç´¢é›†æˆ)
  - [5. æ€§èƒ½åˆ†æ](#5-æ€§èƒ½åˆ†æ)
  - [6. æœ€ä½³å®è·µ](#6-æœ€ä½³å®è·µ)
    - [6.1 å®æ—¶åŠŸèƒ½ä½¿ç”¨](#61-å®æ—¶åŠŸèƒ½ä½¿ç”¨)
    - [6.2 æ··åˆæœç´¢ä¼˜åŒ–](#62-æ··åˆæœç´¢ä¼˜åŒ–)
    - [6.3 å®‰å…¨æœ€ä½³å®è·µ](#63-å®‰å…¨æœ€ä½³å®è·µ)
  - [7. å‚è€ƒèµ„æ–™](#7-å‚è€ƒèµ„æ–™)

---

## 1. æ¦‚è¿°

### 1.1 æŠ€æœ¯èƒŒæ™¯

**é—®é¢˜éœ€æ±‚**:

Supabase æ˜¯ä¸€ä¸ªå¼€æºçš„ Firebase æ›¿ä»£æ–¹æ¡ˆï¼ŒåŸºäº PostgreSQL æ„å»ºï¼Œæä¾›ï¼š

1. **å®æ—¶æ•°æ®åŒæ­¥**: éœ€è¦å®æ—¶æ¨é€æ•°æ®å˜æ›´
2. **æ··åˆæœç´¢**: é›†æˆå‘é‡æœç´¢å’Œå…¨æ–‡æœç´¢
3. **è®¤è¯æˆæƒ**: å®Œæ•´çš„ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†
4. **API è‡ªåŠ¨ç”Ÿæˆ**: åŸºäºæ•°æ®åº“è‡ªåŠ¨ç”Ÿæˆ REST API

**æŠ€æœ¯æ¼”è¿›**:

1. **2020 å¹´**: Supabase é¡¹ç›®å¯åŠ¨
2. **2022 å¹´**: é›†æˆ pgvector æ”¯æŒå‘é‡æœç´¢
3. **2024 å¹´**: æ”¯æŒæ··åˆæœç´¢å’Œå®æ—¶åŠŸèƒ½
4. **2025 å¹´**: æˆä¸º AI åº”ç”¨çš„ä¸»æµåç«¯å¹³å°

### 1.2 æ¶æ„å®šä½

Supabase æ˜¯ PostgreSQL çš„ Serverless å¹³å°ï¼Œæä¾›å®Œæ•´çš„åç«¯å³æœåŠ¡ï¼ˆBaaSï¼‰èƒ½åŠ›ã€‚

### 1.3 æ ¸å¿ƒä»·å€¼

1. **å¼€æºæ€§**: å®Œå…¨å¼€æºï¼Œå¯è‡ªæ‰˜ç®¡
2. **PostgreSQL åŸç”Ÿ**: åŸºäº PostgreSQLï¼Œå…¼å®¹ç°æœ‰ç”Ÿæ€
3. **å®æ—¶èƒ½åŠ›**: å†…ç½®å®æ—¶æ•°æ®åŒæ­¥
4. **AI å‹å¥½**: åŸç”Ÿæ”¯æŒå‘é‡æœç´¢å’Œæ··åˆæœç´¢

---

## 2. æ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å®¢æˆ·ç«¯åº”ç”¨                     â”‚
â”‚  Web | Mobile | Desktop                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Supabase API Gateway            â”‚
â”‚  REST API | GraphQL | Realtime          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
       â”‚               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL  â”‚ â”‚  Realtime   â”‚
â”‚  + pgvector â”‚ â”‚   Engine    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒç»„ä»¶

**1. PostgreSQL æ•°æ®åº“**:

- åŸºäº PostgreSQLï¼Œæ”¯æŒæ‰€æœ‰æ‰©å±•
- é›†æˆ pgvector æ”¯æŒå‘é‡æœç´¢
- æ”¯æŒ Row Level Security (RLS)

**2. Realtime Engine**:

- åŸºäº PostgreSQL çš„é€»è¾‘å¤åˆ¶
- WebSocket å®æ—¶æ¨é€æ•°æ®å˜æ›´
- æ”¯æŒè®¢é˜…è¡¨çº§åˆ«çš„å˜æ›´

**3. Auth æœåŠ¡**:

- ç”¨æˆ·è®¤è¯å’Œæˆæƒ
- æ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼ˆé‚®ç®±ã€OAuthã€Magic Linkï¼‰
- JWT Token ç®¡ç†

**4. Storage æœåŠ¡**:

- å¯¹è±¡å­˜å‚¨æœåŠ¡
- æ”¯æŒæ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½
- é›†æˆ CDN åŠ é€Ÿ

### 2.3 æ•°æ®æµè®¾è®¡

**å®æ—¶æ•°æ®æµ**:

```text
PostgreSQL æ•°æ®å˜æ›´
    â”‚
    â–¼
é€»è¾‘å¤åˆ¶ (Logical Replication)
    â”‚
    â–¼
Realtime Engine
    â”‚
    â–¼
WebSocket æ¨é€
    â”‚
    â–¼
å®¢æˆ·ç«¯åº”ç”¨
```

---

## 3. æ ¸å¿ƒç‰¹æ€§

### 3.1 å®æ—¶åŠŸèƒ½

**å®æ—¶è®¢é˜…**:

```javascript
// JavaScript å®¢æˆ·ç«¯
import { createClient } from "@supabase/supabase-js";

const supabase = createClient(url, key);

// è®¢é˜…è¡¨å˜æ›´
const subscription = supabase
  .channel("public:documents")
  .on("postgres_changes", { event: "INSERT", schema: "public", table: "documents" }, (payload) => {
    console.log("New document:", payload.new);
  })
  .subscribe();
```

**å®æ—¶æ€§èƒ½**:

| æŒ‡æ ‡   | å€¼                 |
| ------ | ------------------ |
| å»¶è¿Ÿ   | < 100ms            |
| ååé‡ | 10K+ æ¶ˆæ¯/ç§’       |
| è¿æ¥æ•° | æ”¯æŒ 10K+ å¹¶å‘è¿æ¥ |

### 3.2 æ··åˆæœç´¢

**å‘é‡æœç´¢é›†æˆ**:

```sql
-- åˆ›å»ºå‘é‡è¡¨
CREATE TABLE documents (
    id BIGSERIAL PRIMARY KEY,
    content TEXT,
    embedding vector(768)
);

-- åˆ›å»ºå‘é‡ç´¢å¼•
CREATE INDEX ON documents
USING hnsw (embedding vector_cosine_ops);

-- æ··åˆæœç´¢æŸ¥è¯¢
SELECT id, content,
       embedding <=> $1 as distance,
       ts_rank(to_tsvector('english', content),
               plainto_tsquery('english', $2)) as rank
FROM documents
WHERE embedding <=> $1 < 0.8
   OR to_tsvector('english', content) @@ plainto_tsquery('english', $2)
ORDER BY (embedding <=> $1) + (1 - ts_rank(...)) DESC
LIMIT 10;
```

### 3.3 è®¤è¯æˆæƒ

**Row Level Security**:

```sql
-- å¯ç”¨ RLS
ALTER TABLE documents ENABLE ROW LEVEL SECURITY;

-- åˆ›å»ºç­–ç•¥
CREATE POLICY "Users can view own documents"
ON documents FOR SELECT
USING (auth.uid() = user_id);
```

---

## 4. å®ç°ç»†èŠ‚

### 4.1 å®æ—¶è®¢é˜…å®ç°

**PostgreSQL é€»è¾‘å¤åˆ¶**:

```sql
-- åˆ›å»ºå‘å¸ƒ
CREATE PUBLICATION supabase_realtime FOR TABLE documents;

-- é…ç½®é€»è¾‘å¤åˆ¶æ§½
SELECT * FROM pg_replication_slots;
```

### 4.2 æ··åˆæœç´¢é›†æˆ

**API é›†æˆ**:

```javascript
// Supabase å®¢æˆ·ç«¯æ··åˆæœç´¢
const { data, error } = await supabase.rpc("hybrid_search", {
  query_vector: embedding,
  query_text: "search text",
  limit: 10
});
```

---

## 5. æ€§èƒ½åˆ†æ

**å¹³å°æ€§èƒ½**:

| æŒ‡æ ‡     | å€¼               |
| -------- | ---------------- |
| API å»¶è¿Ÿ | < 50ms (P99)     |
| å®æ—¶å»¶è¿Ÿ | < 100ms          |
| å‘é‡æœç´¢ | < 20ms (1M å‘é‡) |
| å¹¶å‘è¿æ¥ | 10K+             |

---

## 6. æœ€ä½³å®è·µ

### 6.1 å®æ—¶åŠŸèƒ½ä½¿ç”¨

1. **è®¢é˜…ä¼˜åŒ–**: åªè®¢é˜…éœ€è¦çš„è¡¨å’Œäº‹ä»¶
2. **è¿æ¥ç®¡ç†**: åˆç†ç®¡ç† WebSocket è¿æ¥
3. **é”™è¯¯å¤„ç†**: å®ç°é‡è¿å’Œé”™è¯¯å¤„ç†æœºåˆ¶

### 6.2 æ··åˆæœç´¢ä¼˜åŒ–

1. **ç´¢å¼•ä¼˜åŒ–**: ä¸ºå‘é‡å’Œå…¨æ–‡æœç´¢åˆ›å»ºåˆé€‚ç´¢å¼•
2. **æŸ¥è¯¢ä¼˜åŒ–**: ä½¿ç”¨ RRF ç®—æ³•èåˆç»“æœ
3. **ç¼“å­˜ç­–ç•¥**: ç¼“å­˜çƒ­ç‚¹æŸ¥è¯¢ç»“æœ

### 6.3 å®‰å…¨æœ€ä½³å®è·µ

1. **RLS ç­–ç•¥**: ä¸ºæ‰€æœ‰è¡¨å¯ç”¨ RLS
2. **API å¯†é’¥**: å®‰å…¨ç®¡ç† API å¯†é’¥
3. **æƒé™æ§åˆ¶**: æœ€å°æƒé™åŸåˆ™

---

## 7. å‚è€ƒèµ„æ–™

- [Serverless æ¶æ„åŸç†](../æŠ€æœ¯åŸç†/Serverlessæ¶æ„åŸç†.md)
- [å®æ—¶åŠŸèƒ½åº”ç”¨](./å®æ—¶åŠŸèƒ½åº”ç”¨.md)
- [æ··åˆæœç´¢é›†æˆ](./æ··åˆæœç´¢é›†æˆ.md)
- [Supabase å®˜æ–¹æ–‡æ¡£](https://supabase.com/docs)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥  
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
