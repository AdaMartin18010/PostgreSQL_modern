# PostgreSQL æ•°æ®åº“è®¾è®¡æœ€ä½³å®è·µ

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+
> **æ–‡æ¡£ç¼–å·**: 03-03-10

## ğŸ“‘ ç›®å½•

- [PostgreSQL æ•°æ®åº“è®¾è®¡æœ€ä½³å®è·µ](#postgresql-æ•°æ®åº“è®¾è®¡æœ€ä½³å®è·µ)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. è§„èŒƒåŒ–è®¾è®¡](#1-è§„èŒƒåŒ–è®¾è®¡)
  - [2. ç´¢å¼•è®¾è®¡åŸåˆ™](#2-ç´¢å¼•è®¾è®¡åŸåˆ™)
  - [3. å‘½åè§„èŒƒ](#3-å‘½åè§„èŒƒ)
  - [4. å®è·µç»ƒä¹ ](#4-å®è·µç»ƒä¹ )
  - [5. å‚è€ƒèµ„æ–™](#5-å‚è€ƒèµ„æ–™)

---

## 1. è§„èŒƒåŒ–è®¾è®¡

### 1.1 ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰

```sql
-- ä¸å¥½ï¼šåœ°å€å­—æ®µåŒ…å«å¤šä¸ªå€¼
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name TEXT,
    addresses TEXT  -- åŒ…å«å¤šä¸ªåœ°å€
);

-- å¥½ï¼šæ¯ä¸ªå­—æ®µéƒ½æ˜¯åŸå­å€¼
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name TEXT
);

CREATE TABLE addresses (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    address TEXT
);
```

### 1.2 ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰

```sql
-- ä¸å¥½ï¼šéƒ¨åˆ†ä¾èµ–
CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    user_id INTEGER,
    user_name TEXT,  -- ä¾èµ–äº user_idï¼Œä¸æ˜¯ä¸»é”®
    product_id INTEGER,
    product_name TEXT,  -- ä¾èµ–äº product_idï¼Œä¸æ˜¯ä¸»é”®
    quantity INTEGER
);

-- å¥½ï¼šæ¶ˆé™¤éƒ¨åˆ†ä¾èµ–
CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    product_id INTEGER REFERENCES products(id),
    quantity INTEGER
);
```

### 1.3 ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰

```sql
-- ä¸å¥½ï¼šä¼ é€’ä¾èµ–
CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    name TEXT,
    department_id INTEGER,
    department_name TEXT,  -- ä¾èµ–äº department_idï¼Œä¼ é€’ä¾èµ–
    manager_id INTEGER
);

-- å¥½ï¼šæ¶ˆé™¤ä¼ é€’ä¾èµ–
CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    name TEXT,
    department_id INTEGER REFERENCES departments(id),
    manager_id INTEGER REFERENCES employees(id)
);

CREATE TABLE departments (
    id SERIAL PRIMARY KEY,
    name TEXT
);
```

## 2. ç´¢å¼•è®¾è®¡åŸåˆ™

```sql
-- 1. ä¸»é”®è‡ªåŠ¨åˆ›å»ºç´¢å¼•
CREATE TABLE users (
    id SERIAL PRIMARY KEY  -- è‡ªåŠ¨åˆ›å»ºä¸»é”®ç´¢å¼•
);

-- 2. å¤–é”®åˆ—åˆ›å»ºç´¢å¼•
CREATE INDEX idx_orders_user_id ON orders(user_id);

-- 3. é¢‘ç¹æŸ¥è¯¢çš„åˆ—åˆ›å»ºç´¢å¼•
CREATE INDEX idx_users_email ON users(email);

-- 4. å¤åˆç´¢å¼•çš„é¡ºåºå¾ˆé‡è¦
CREATE INDEX idx_orders_status_date ON orders(status, created_at);

-- 5. è¦†ç›–ç´¢å¼•
CREATE INDEX idx_users_covering ON users(email) INCLUDE (name, age);

-- 6. éƒ¨åˆ†ç´¢å¼•
CREATE INDEX idx_active_users ON users(email) WHERE is_active = TRUE;
```

## 3. å‘½åè§„èŒƒ

```sql
-- è¡¨åï¼šå¤æ•°å½¢å¼ï¼Œå°å†™ï¼Œä¸‹åˆ’çº¿åˆ†éš”
CREATE TABLE users (...);
CREATE TABLE order_items (...);

-- åˆ—åï¼šå°å†™ï¼Œä¸‹åˆ’çº¿åˆ†éš”
CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    user_name TEXT,
    created_at TIMESTAMP
);

-- ç´¢å¼•åï¼šidx_è¡¨å_åˆ—å
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_orders_user_id ON orders(user_id);

-- çº¦æŸåï¼šè¡¨å_åˆ—å_çº¦æŸç±»å‹
ALTER TABLE users ADD CONSTRAINT users_email_unique UNIQUE (email);
```

## 4. å®è·µç»ƒä¹ 

### ç»ƒä¹  1: è®¾è®¡æ•°æ®åº“

```sql
-- ä»»åŠ¡: è®¾è®¡ä¸€ä¸ªç”µå•†ç³»ç»Ÿçš„æ•°æ®åº“
-- åŒ…å«ï¼šç”¨æˆ·ã€å•†å“ã€è®¢å•ã€è®¢å•é¡¹è¡¨
-- è¦æ±‚ï¼šç¬¦åˆ 3NFï¼ŒåŒ…å«é€‚å½“çš„ç´¢å¼•

CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email TEXT UNIQUE NOT NULL,
    name TEXT NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    stock INTEGER DEFAULT 0,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    total_amount DECIMAL(10, 2),
    status TEXT DEFAULT 'pending',
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE order_items (
    id SERIAL PRIMARY KEY,
    order_id INTEGER REFERENCES orders(id),
    product_id INTEGER REFERENCES products(id),
    quantity INTEGER NOT NULL,
    price DECIMAL(10, 2) NOT NULL
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_orders_user_id ON orders(user_id);
CREATE INDEX idx_orders_status ON orders(status);
CREATE INDEX idx_order_items_order_id ON order_items(order_id);
CREATE INDEX idx_order_items_product_id ON order_items(product_id);
```

## 5. å‚è€ƒèµ„æ–™

- [PostgreSQL å®˜æ–¹æ–‡æ¡£ - æ•°æ®åº“è®¾è®¡](https://www.postgresql.org/docs/current/ddl.html)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 03-03-10
