# PostgreSQL æƒé™ç®¡ç†

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+
> **æ–‡æ¡£ç¼–å·**: 03-03-08

## ğŸ“‘ ç›®å½•

- [PostgreSQL æƒé™ç®¡ç†](#postgresql-æƒé™ç®¡ç†)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. ç”¨æˆ·å’Œè§’è‰²](#1-ç”¨æˆ·å’Œè§’è‰²)
    - [1.1 åˆ›å»ºè§’è‰²](#11-åˆ›å»ºè§’è‰²)
    - [1.2 è§’è‰²ç®¡ç†](#12-è§’è‰²ç®¡ç†)
  - [2. æƒé™æˆäºˆ](#2-æƒé™æˆäºˆ)
    - [2.1 è¡¨æƒé™](#21-è¡¨æƒé™)
    - [2.2 æŸ¥çœ‹æƒé™](#22-æŸ¥çœ‹æƒé™)
  - [3. è¡Œçº§å®‰å…¨ï¼ˆRLSï¼‰](#3-è¡Œçº§å®‰å…¨rls)
    - [3.1 å¯ç”¨ RLS](#31-å¯ç”¨-rls)
  - [4. å®è·µç»ƒä¹ ](#4-å®è·µç»ƒä¹ )
    - [ç»ƒä¹  1: åˆ›å»ºåªè¯»ç”¨æˆ·](#ç»ƒä¹ -1-åˆ›å»ºåªè¯»ç”¨æˆ·)
  - [5. å‚è€ƒèµ„æ–™](#5-å‚è€ƒèµ„æ–™)

---

## 1. ç”¨æˆ·å’Œè§’è‰²

### 1.1 åˆ›å»ºè§’è‰²

```sql
-- åˆ›å»ºè§’è‰²
CREATE ROLE app_user WITH LOGIN PASSWORD 'password';

-- åˆ›å»ºåªè¯»è§’è‰²
CREATE ROLE readonly_user WITH LOGIN PASSWORD 'password';

-- åˆ›å»ºç®¡ç†å‘˜è§’è‰²
CREATE ROLE admin_user WITH SUPERUSER CREATEDB CREATEROLE;
```

### 1.2 è§’è‰²ç®¡ç†

```sql
-- ä¿®æ”¹è§’è‰²å¯†ç 
ALTER ROLE app_user WITH PASSWORD 'new_password';

-- ä¿®æ”¹è§’è‰²å±æ€§
ALTER ROLE app_user WITH CREATEDB;

-- åˆ é™¤è§’è‰²
DROP ROLE app_user;
```

## 2. æƒé™æˆäºˆ

### 2.1 è¡¨æƒé™

```sql
-- æˆäºˆ SELECT æƒé™
GRANT SELECT ON users TO readonly_user;

-- æˆäºˆæ‰€æœ‰æƒé™
GRANT ALL PRIVILEGES ON users TO app_user;

-- æˆäºˆæ‰€æœ‰è¡¨çš„æƒé™
GRANT SELECT ON ALL TABLES IN SCHEMA public TO readonly_user;

-- æˆäºˆæœªæ¥è¡¨çš„æƒé™
ALTER DEFAULT PRIVILEGES IN SCHEMA public
GRANT SELECT ON TABLES TO readonly_user;

-- æ’¤é”€æƒé™
REVOKE SELECT ON users FROM readonly_user;
```

### 2.2 æŸ¥çœ‹æƒé™

```sql
-- æŸ¥çœ‹è¡¨æƒé™
SELECT
    grantee,
    table_schema,
    table_name,
    privilege_type
FROM information_schema.table_privileges
WHERE grantee = 'readonly_user';
```

## 3. è¡Œçº§å®‰å…¨ï¼ˆRLSï¼‰

### 3.1 å¯ç”¨ RLS

```sql
-- å¯ç”¨è¡Œçº§å®‰å…¨
ALTER TABLE orders ENABLE ROW LEVEL SECURITY;

-- åˆ›å»ºç­–ç•¥
CREATE POLICY user_orders_policy ON orders
FOR ALL
TO app_user
USING (user_id = current_setting('app.user_id')::INTEGER);

-- ä½¿ç”¨ç­–ç•¥
SET app.user_id = 1;
SELECT * FROM orders;  -- åªèƒ½çœ‹åˆ° user_id = 1 çš„è®¢å•
```

## 4. å®è·µç»ƒä¹ 

### ç»ƒä¹  1: åˆ›å»ºåªè¯»ç”¨æˆ·

```sql
-- ä»»åŠ¡: åˆ›å»ºä¸€ä¸ªåªèƒ½è¯»å– users è¡¨çš„ç”¨æˆ·
CREATE ROLE readonly_user WITH LOGIN PASSWORD 'password';
GRANT SELECT ON users TO readonly_user;
GRANT USAGE ON SCHEMA public TO readonly_user;
```

## 5. å‚è€ƒèµ„æ–™

- [PostgreSQL å®˜æ–¹æ–‡æ¡£ - è§’è‰²å’Œæƒé™](https://www.postgresql.org/docs/current/user-manag.html)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 03-03-08
