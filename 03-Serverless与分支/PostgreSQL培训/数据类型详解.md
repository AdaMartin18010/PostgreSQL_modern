# PostgreSQL æ•°æ®ç±»å‹è¯¦è§£

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+
> **æ–‡æ¡£ç¼–å·**: 03-03-04

## ğŸ“‘ ç›®å½•

- [PostgreSQL æ•°æ®ç±»å‹è¯¦è§£](#postgresql-æ•°æ®ç±»å‹è¯¦è§£)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. JSON/JSONB æ“ä½œ](#1-jsonjsonb-æ“ä½œ)
    - [1.1 JSONB æ“ä½œç¬¦](#11-jsonb-æ“ä½œç¬¦)
    - [1.2 JSONB ç´¢å¼•](#12-jsonb-ç´¢å¼•)
  - [2. æ•°ç»„æ“ä½œ](#2-æ•°ç»„æ“ä½œ)
    - [2.1 æ•°ç»„æ“ä½œç¬¦](#21-æ•°ç»„æ“ä½œç¬¦)
    - [2.2 æ•°ç»„ç´¢å¼•](#22-æ•°ç»„ç´¢å¼•)
  - [3. èŒƒå›´ç±»å‹](#3-èŒƒå›´ç±»å‹)
  - [4. è‡ªå®šä¹‰ç±»å‹](#4-è‡ªå®šä¹‰ç±»å‹)
  - [5. å®è·µç»ƒä¹ ](#5-å®è·µç»ƒä¹ )
    - [ç»ƒä¹  1: JSONB æŸ¥è¯¢](#ç»ƒä¹ -1-jsonb-æŸ¥è¯¢)
  - [6. å‚è€ƒèµ„æ–™](#6-å‚è€ƒèµ„æ–™)

---

## 1. JSON/JSONB æ“ä½œ

### 1.1 JSONB æ“ä½œç¬¦

```sql
-- åˆ›å»ºè¡¨
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name TEXT,
    metadata JSONB
);

-- æ’å…¥ JSON æ•°æ®
INSERT INTO products (name, metadata) VALUES (
    'Product 1',
    '{"price": 100, "category": "electronics", "tags": ["new", "popular"]}'::jsonb
);

-- è®¿é—® JSON å­—æ®µ
SELECT metadata->>'price' AS price FROM products;
SELECT metadata->'tags' AS tags FROM products;
SELECT metadata->'tags'->0 AS first_tag FROM products;

-- JSONB æŸ¥è¯¢
SELECT * FROM products WHERE metadata @> '{"category": "electronics"}'::jsonb;
SELECT * FROM products WHERE metadata ? 'price';
SELECT * FROM products WHERE metadata ?| array['price', 'category'];
SELECT * FROM products WHERE metadata ?& array['price', 'category'];

-- JSONB æ›´æ–°
UPDATE products
SET metadata = metadata || '{"discount": 10}'::jsonb
WHERE id = 1;

-- JSONB å‡½æ•°
SELECT jsonb_pretty(metadata) FROM products;
SELECT jsonb_object_keys(metadata) FROM products;
SELECT jsonb_array_elements(metadata->'tags') FROM products;
```

### 1.2 JSONB ç´¢å¼•

```sql
-- GIN ç´¢å¼•ï¼ˆæ¨èï¼‰
CREATE INDEX idx_products_metadata_gin ON products USING GIN(metadata);

-- è¡¨è¾¾å¼ç´¢å¼•
CREATE INDEX idx_products_category ON products ((metadata->>'category'));

-- æŸ¥è¯¢ä½¿ç”¨ç´¢å¼•
SELECT * FROM products WHERE metadata @> '{"category": "electronics"}'::jsonb;
```

## 2. æ•°ç»„æ“ä½œ

### 2.1 æ•°ç»„æ“ä½œç¬¦

```sql
-- åˆ›å»ºè¡¨
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name TEXT,
    tags TEXT[]
);

-- æ’å…¥æ•°ç»„
INSERT INTO users (name, tags) VALUES ('John', ARRAY['admin', 'developer']);

-- æ•°ç»„æŸ¥è¯¢
SELECT * FROM users WHERE 'admin' = ANY(tags);
SELECT * FROM users WHERE tags @> ARRAY['admin'];
SELECT * FROM users WHERE tags && ARRAY['admin', 'user'];

-- æ•°ç»„å‡½æ•°
SELECT array_length(tags, 1) FROM users;
SELECT array_append(tags, 'new_tag') FROM users;
SELECT array_remove(tags, 'old_tag') FROM users;
SELECT unnest(tags) FROM users;  -- å±•å¼€æ•°ç»„ä¸ºè¡Œ
```

### 2.2 æ•°ç»„ç´¢å¼•

```sql
-- GIN ç´¢å¼•
CREATE INDEX idx_users_tags_gin ON users USING GIN(tags);

-- æŸ¥è¯¢ä½¿ç”¨ç´¢å¼•
SELECT * FROM users WHERE tags @> ARRAY['admin'];
```

## 3. èŒƒå›´ç±»å‹

```sql
-- åˆ›å»ºèŒƒå›´ç±»å‹è¡¨
CREATE TABLE reservations (
    id SERIAL PRIMARY KEY,
    room_id INTEGER,
    reservation_period TSTZRANGE
);

-- æ’å…¥èŒƒå›´æ•°æ®
INSERT INTO reservations (room_id, reservation_period) VALUES (
    1,
    '[2024-01-01 10:00, 2024-01-01 12:00)'
);

-- èŒƒå›´æŸ¥è¯¢
SELECT * FROM reservations
WHERE reservation_period @> TIMESTAMPTZ '2024-01-01 11:00';

-- èŒƒå›´æ“ä½œç¬¦
SELECT * FROM reservations
WHERE reservation_period && '[2024-01-01 11:00, 2024-01-01 13:00)';
```

## 4. è‡ªå®šä¹‰ç±»å‹

```sql
-- åˆ›å»ºæšä¸¾ç±»å‹
CREATE TYPE user_status AS ENUM ('active', 'inactive', 'suspended');

CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name TEXT,
    status user_status
);

-- ä½¿ç”¨æšä¸¾
INSERT INTO users (name, status) VALUES ('John', 'active');
SELECT * FROM users WHERE status = 'active';
```

## 5. å®è·µç»ƒä¹ 

### ç»ƒä¹  1: JSONB æŸ¥è¯¢

```sql
-- ä»»åŠ¡: æŸ¥è¯¢ä»·æ ¼åœ¨ 100-500 ä¹‹é—´çš„ç”µå­äº§å“
SELECT name, metadata->>'price' AS price
FROM products
WHERE metadata @> '{"category": "electronics"}'::jsonb
AND (metadata->>'price')::INTEGER BETWEEN 100 AND 500;
```

## 6. å‚è€ƒèµ„æ–™

- [PostgreSQL å®˜æ–¹æ–‡æ¡£ - JSON ç±»å‹](https://www.postgresql.org/docs/current/datatype-json.html)
- [PostgreSQL å®˜æ–¹æ–‡æ¡£ - æ•°ç»„ç±»å‹](https://www.postgresql.org/docs/current/arrays.html)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 03-03-04
