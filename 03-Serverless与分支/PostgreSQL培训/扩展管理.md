# PostgreSQL æ‰©å±•ç®¡ç†

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+
> **æ–‡æ¡£ç¼–å·**: 03-03-14

## ğŸ“‘ ç›®å½•

- [PostgreSQL æ‰©å±•ç®¡ç†](#postgresql-æ‰©å±•ç®¡ç†)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ‰©å±•åŸºç¡€](#1-æ‰©å±•åŸºç¡€)
  - [2. å¸¸ç”¨æ‰©å±•](#2-å¸¸ç”¨æ‰©å±•)
  - [3. æ‰©å±•ç®¡ç†](#3-æ‰©å±•ç®¡ç†)
  - [4. å®è·µç»ƒä¹ ](#4-å®è·µç»ƒä¹ )
  - [5. å‚è€ƒèµ„æ–™](#5-å‚è€ƒèµ„æ–™)

---

## 1. æ‰©å±•åŸºç¡€

### 1.1 ä»€ä¹ˆæ˜¯æ‰©å±•

PostgreSQL æ‰©å±•ï¼ˆExtensionï¼‰æ˜¯å¯é€‰çš„é™„åŠ åŠŸèƒ½æ¨¡å—ï¼Œå¯ä»¥å¢å¼ºæ•°æ®åº“çš„åŠŸèƒ½ã€‚

### 1.2 æŸ¥çœ‹å¯ç”¨æ‰©å±•

```sql
-- æŸ¥çœ‹æ‰€æœ‰å¯ç”¨æ‰©å±•
SELECT * FROM pg_available_extensions ORDER BY name;

-- æŸ¥çœ‹å·²å®‰è£…çš„æ‰©å±•
SELECT * FROM pg_extension;

-- æŸ¥çœ‹æ‰©å±•è¯¦ç»†ä¿¡æ¯
SELECT
    extname,
    extversion,
    extrelocatable,
    extconfig,
    extcondition
FROM pg_extension;
```

## 2. å¸¸ç”¨æ‰©å±•

### 2.1 pg_stat_statementsï¼ˆæŸ¥è¯¢ç»Ÿè®¡ï¼‰

```sql
-- å®‰è£…æ‰©å±•
CREATE EXTENSION IF NOT EXISTS pg_stat_statements;

-- æŸ¥çœ‹æŸ¥è¯¢ç»Ÿè®¡
SELECT
    query,
    calls,
    total_exec_time,
    mean_exec_time,
    max_exec_time
FROM pg_stat_statements
ORDER BY mean_exec_time DESC
LIMIT 10;

-- é‡ç½®ç»Ÿè®¡
SELECT pg_stat_statements_reset();
```

### 2.2 pg_trgmï¼ˆæ¨¡ç³Šæœç´¢ï¼‰

```sql
-- å®‰è£…æ‰©å±•
CREATE EXTENSION IF NOT EXISTS pg_trgm;

-- åˆ›å»º GIN ç´¢å¼•
CREATE INDEX idx_users_name_trgm ON users USING GIN(name gin_trgm_ops);

-- ä½¿ç”¨ç›¸ä¼¼åº¦æœç´¢
SELECT name, similarity(name, 'John') AS sim
FROM users
WHERE name % 'John'  -- ç›¸ä¼¼åº¦æ“ä½œç¬¦
ORDER BY sim DESC;

-- ä½¿ç”¨ç›¸ä¼¼åº¦é˜ˆå€¼
SELECT name FROM users
WHERE similarity(name, 'John') > 0.3;
```

### 2.3 pgcryptoï¼ˆåŠ å¯†ï¼‰

```sql
-- å®‰è£…æ‰©å±•
CREATE EXTENSION IF NOT EXISTS pgcrypto;

-- åŠ å¯†å¯†ç 
SELECT crypt('mypassword', gen_salt('bf', 8));

-- éªŒè¯å¯†ç 
SELECT crypt('mypassword', stored_hash) = stored_hash AS password_match;

-- å“ˆå¸Œå‡½æ•°
SELECT encode(digest('message', 'sha256'), 'hex');
```

### 2.4 uuid-osspï¼ˆUUID ç”Ÿæˆï¼‰

```sql
-- å®‰è£…æ‰©å±•
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- ç”Ÿæˆ UUID
SELECT uuid_generate_v1();  -- åŸºäºæ—¶é—´æˆ³
SELECT uuid_generate_v4();  -- éšæœº UUID

-- åœ¨è¡¨ä¸­ä½¿ç”¨
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name TEXT
);
```

### 2.5 hstoreï¼ˆé”®å€¼å¯¹å­˜å‚¨ï¼‰

```sql
-- å®‰è£…æ‰©å±•
CREATE EXTENSION IF NOT EXISTS hstore;

-- åˆ›å»º hstore åˆ—
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name TEXT,
    attributes HSTORE
);

-- æ’å…¥æ•°æ®
INSERT INTO products (name, attributes) VALUES (
    'Product 1',
    'color => red, size => large, weight => 1kg'::hstore
);

-- æŸ¥è¯¢
SELECT * FROM products WHERE attributes @> 'color => red';
SELECT * FROM products WHERE attributes ? 'size';
```

## 3. æ‰©å±•ç®¡ç†

### 3.1 å®‰è£…æ‰©å±•

```sql
-- åŸºæœ¬å®‰è£…
CREATE EXTENSION extension_name;

-- å®‰è£…åˆ°ç‰¹å®šæ¨¡å¼
CREATE EXTENSION extension_name SCHEMA schema_name;

-- å®‰è£…æŒ‡å®šç‰ˆæœ¬
CREATE EXTENSION extension_name VERSION '1.0';
```

### 3.2 æ›´æ–°æ‰©å±•

```sql
-- æ›´æ–°æ‰©å±•
ALTER EXTENSION extension_name UPDATE TO '1.1';

-- æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
ALTER EXTENSION extension_name UPDATE;
```

### 3.3 å¸è½½æ‰©å±•

```sql
-- å¸è½½æ‰©å±•
DROP EXTENSION extension_name;

-- çº§è”å¸è½½ï¼ˆåŒæ—¶åˆ é™¤ä¾èµ–å¯¹è±¡ï¼‰
DROP EXTENSION extension_name CASCADE;
```

### 3.4 æ‰©å±•é…ç½®

```sql
-- æŸ¥çœ‹æ‰©å±•é…ç½®
SELECT * FROM pg_extension_config_dump('extension_name', 'pattern');

-- æŸ¥çœ‹æ‰©å±•ä¾èµ–
SELECT
    e.extname,
    d.objid::regclass
FROM pg_depend d
JOIN pg_extension e ON d.refobjid = e.oid
WHERE d.deptype = 'e';
```

## 4. å®è·µç»ƒä¹ 

### ç»ƒä¹  1: å®‰è£…å’Œä½¿ç”¨ pg_trgm

```sql
-- ä»»åŠ¡: å®‰è£… pg_trgm å¹¶åˆ›å»ºæ¨¡ç³Šæœç´¢åŠŸèƒ½
-- 1. å®‰è£…æ‰©å±•
CREATE EXTENSION IF NOT EXISTS pg_trgm;

-- 2. åˆ›å»ºæµ‹è¯•è¡¨
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name TEXT
);

-- 3. æ’å…¥æµ‹è¯•æ•°æ®
INSERT INTO products (name) VALUES
    ('iPhone 15 Pro'),
    ('iPhone 15'),
    ('Samsung Galaxy S24'),
    ('iPad Pro');

-- 4. åˆ›å»º GIN ç´¢å¼•
CREATE INDEX idx_products_name_trgm ON products USING GIN(name gin_trgm_ops);

-- 5. æ‰§è¡Œæ¨¡ç³Šæœç´¢
SELECT name, similarity(name, 'iPhone') AS sim
FROM products
WHERE name % 'iPhone'
ORDER BY sim DESC;
```

## 5. å‚è€ƒèµ„æ–™

- [PostgreSQL å®˜æ–¹æ–‡æ¡£ - æ‰©å±•](https://www.postgresql.org/docs/current/extend-extensions.html)
- [PostgreSQL æ‰©å±•åˆ—è¡¨](https://www.postgresql.org/docs/current/contrib.html)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 03-03-14
