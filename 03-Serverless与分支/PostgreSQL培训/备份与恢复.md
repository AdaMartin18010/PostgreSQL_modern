# PostgreSQL å¤‡ä»½ä¸æ¢å¤

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+
> **æ–‡æ¡£ç¼–å·**: 03-03-09

## ğŸ“‘ ç›®å½•

- [PostgreSQL å¤‡ä»½ä¸æ¢å¤](#postgresql-å¤‡ä»½ä¸æ¢å¤)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. é€»è¾‘å¤‡ä»½](#1-é€»è¾‘å¤‡ä»½)
  - [2. ç‰©ç†å¤‡ä»½](#2-ç‰©ç†å¤‡ä»½)
  - [3. æ—¶é—´ç‚¹æ¢å¤](#3-æ—¶é—´ç‚¹æ¢å¤)
  - [4. å®è·µç»ƒä¹ ](#4-å®è·µç»ƒä¹ )
  - [5. å‚è€ƒèµ„æ–™](#5-å‚è€ƒèµ„æ–™)

---

## 1. é€»è¾‘å¤‡ä»½

### 1.1 pg_dump

```bash
# å¤‡ä»½å•ä¸ªæ•°æ®åº“
pg_dump -h localhost -U postgres -d mydb > backup.sql

# å‹ç¼©å¤‡ä»½
pg_dump -h localhost -U postgres -d mydb | gzip > backup.sql.gz

# åªå¤‡ä»½è¡¨ç»“æ„
pg_dump -h localhost -U postgres -d mydb --schema-only > schema.sql

# åªå¤‡ä»½æ•°æ®
pg_dump -h localhost -U postgres -d mydb --data-only > data.sql

# å¤‡ä»½ç‰¹å®šè¡¨
pg_dump -h localhost -U postgres -d mydb -t users -t orders > tables.sql
```

### 1.2 pg_dumpall

```bash
# å¤‡ä»½æ‰€æœ‰æ•°æ®åº“
pg_dumpall -h localhost -U postgres > all_databases.sql

# åªå¤‡ä»½å…¨å±€å¯¹è±¡ï¼ˆè§’è‰²ã€è¡¨ç©ºé—´ç­‰ï¼‰
pg_dumpall -h localhost -U postgres --globals-only > globals.sql
```

### 1.3 æ¢å¤

```bash
# æ¢å¤æ•°æ®åº“
psql -h localhost -U postgres -d mydb < backup.sql

# æ¢å¤æ‰€æœ‰æ•°æ®åº“
psql -h localhost -U postgres < all_databases.sql
```

## 2. ç‰©ç†å¤‡ä»½

### 2.1 pg_basebackup

```bash
# åŸºç¡€å¤‡ä»½ï¼ˆéœ€è¦é…ç½®æµå¤åˆ¶ï¼‰
pg_basebackup -h localhost -U postgres -D /backup/postgresql -Ft -z -P
```

### 2.2 WAL å½’æ¡£

```sql
-- åœ¨ postgresql.conf ä¸­é…ç½®ï¼š
-- archive_mode = on
-- archive_command = 'cp %p /backup/wal/%f'
```

## 3. æ—¶é—´ç‚¹æ¢å¤

```sql
-- åˆ›å»ºæ¢å¤ç‚¹
SELECT pg_create_restore_point('before_migration');

-- æ¢å¤é…ç½®ï¼ˆrecovery.confï¼‰
-- restore_command = 'cp /backup/wal/%f %p'
-- recovery_target_time = '2024-01-01 12:00:00'
```

## 4. å®è·µç»ƒä¹ 

### ç»ƒä¹  1: å¤‡ä»½å’Œæ¢å¤

```bash
# ä»»åŠ¡: å¤‡ä»½æ•°æ®åº“å¹¶æ¢å¤
# 1. å¤‡ä»½
pg_dump -h localhost -U postgres -d mydb > backup.sql

# 2. åˆ é™¤æ•°æ®åº“
dropdb -h localhost -U postgres mydb

# 3. æ¢å¤
psql -h localhost -U postgres -d postgres < backup.sql
```

## 5. å‚è€ƒèµ„æ–™

- [PostgreSQL å®˜æ–¹æ–‡æ¡£ - å¤‡ä»½å’Œæ¢å¤](https://www.postgresql.org/docs/current/backup.html)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 03-03-09
