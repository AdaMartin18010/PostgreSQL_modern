# 07 | åºåˆ—å›¾é›†

> **å¯è§†åŒ–å·¥å…·**: æœ¬æ–‡æ¡£æä¾›æ ¸å¿ƒäº¤äº’åºåˆ—å›¾ï¼Œå±•ç¤ºç³»ç»Ÿç»„ä»¶é—´çš„æ—¶åºäº¤äº’è¿‡ç¨‹ã€‚

> **ğŸ“– æ¦‚å¿µè¯å…¸å¼•ç”¨**ï¼šæœ¬æ–‡æ¡£ä¸­æ¶‰åŠçš„æ‰€æœ‰æ ¸å¿ƒæ¦‚å¿µå®šä¹‰ä¸ [æ ¸å¿ƒæ¦‚å¿µè¯å…¸](../00-ç†è®ºæ¡†æ¶æ€»è§ˆ/01-æ ¸å¿ƒæ¦‚å¿µè¯å…¸.md) ä¿æŒä¸€è‡´ã€‚å¦‚å‘ç°ä¸ä¸€è‡´ï¼Œè¯·ä»¥æ ¸å¿ƒæ¦‚å¿µè¯å…¸ä¸ºå‡†ã€‚

---

## ğŸ“‘ ç›®å½•

- [07 | åºåˆ—å›¾é›†](#07--åºåˆ—å›¾é›†)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [ä¸€ã€äº‹åŠ¡æäº¤åºåˆ—](#ä¸€äº‹åŠ¡æäº¤åºåˆ—)
    - [1.1 æ­£å¸¸æäº¤æµç¨‹](#11-æ­£å¸¸æäº¤æµç¨‹)
    - [1.2 ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰](#12-ä¸¤é˜¶æ®µæäº¤2pc)
  - [äºŒã€MVCCè¯»æ“ä½œåºåˆ—](#äºŒmvccè¯»æ“ä½œåºåˆ—)
    - [2.1 å¿«ç…§åˆ›å»ºåºåˆ—](#21-å¿«ç…§åˆ›å»ºåºåˆ—)
    - [2.2 å¯è§æ€§æ£€æŸ¥åºåˆ—](#22-å¯è§æ€§æ£€æŸ¥åºåˆ—)
  - [ä¸‰ã€é”è·å–åºåˆ—](#ä¸‰é”è·å–åºåˆ—)
    - [3.1 è¡Œçº§é”è·å–](#31-è¡Œçº§é”è·å–)
    - [3.2 æ­»é”æ£€æµ‹åºåˆ—](#32-æ­»é”æ£€æµ‹åºåˆ—)
  - [å››ã€Raftå…±è¯†åºåˆ—](#å››raftå…±è¯†åºåˆ—)
    - [4.1 Leaderé€‰ä¸¾åºåˆ—](#41-leaderé€‰ä¸¾åºåˆ—)
    - [4.2 æ—¥å¿—å¤åˆ¶åºåˆ—](#42-æ—¥å¿—å¤åˆ¶åºåˆ—)
  - [äº”ã€åˆ†å¸ƒå¼äº‹åŠ¡åºåˆ—](#äº”åˆ†å¸ƒå¼äº‹åŠ¡åºåˆ—)
    - [5.1 Percolatorä¸¤é˜¶æ®µæäº¤](#51-percolatorä¸¤é˜¶æ®µæäº¤)
    - [5.2 Sagaè¡¥å¿åºåˆ—](#52-sagaè¡¥å¿åºåˆ—)
  - [å…­ã€å®Œæ•´å®ç°ä»£ç ](#å…­å®Œæ•´å®ç°ä»£ç )
    - [6.1 Mermaidåºåˆ—å›¾ç”Ÿæˆå™¨](#61-mermaidåºåˆ—å›¾ç”Ÿæˆå™¨)
    - [6.2 PlantUMLåºåˆ—å›¾ç”Ÿæˆå™¨](#62-plantumlåºåˆ—å›¾ç”Ÿæˆå™¨)
  - [ä¸ƒã€å®é™…åº”ç”¨æ¡ˆä¾‹](#ä¸ƒå®é™…åº”ç”¨æ¡ˆä¾‹)
    - [æ¡ˆä¾‹1: è°ƒè¯•åˆ†å¸ƒå¼äº‹åŠ¡](#æ¡ˆä¾‹1-è°ƒè¯•åˆ†å¸ƒå¼äº‹åŠ¡)
    - [æ¡ˆä¾‹2: åˆ†ææ€§èƒ½ç“¶é¢ˆ](#æ¡ˆä¾‹2-åˆ†ææ€§èƒ½ç“¶é¢ˆ)
  - [å…«ã€åä¾‹ä¸é”™è¯¯è®¾è®¡](#å…«åä¾‹ä¸é”™è¯¯è®¾è®¡)
    - [åä¾‹1: ç¼ºå°‘è¶…æ—¶å¤„ç†](#åä¾‹1-ç¼ºå°‘è¶…æ—¶å¤„ç†)
    - [åä¾‹2: å¿½ç•¥é”™è¯¯å¤„ç†](#åä¾‹2-å¿½ç•¥é”™è¯¯å¤„ç†)
  - [ä¹ã€æ›´å¤šåºåˆ—å›¾ç¤ºä¾‹](#ä¹æ›´å¤šåºåˆ—å›¾ç¤ºä¾‹)
    - [9.1 MVCCç‰ˆæœ¬é“¾éå†åºåˆ—](#91-mvccç‰ˆæœ¬é“¾éå†åºåˆ—)
    - [9.2 VACUUMæ¸…ç†åºåˆ—](#92-vacuumæ¸…ç†åºåˆ—)
    - [9.3 åˆ†å¸ƒå¼é”è·å–åºåˆ—](#93-åˆ†å¸ƒå¼é”è·å–åºåˆ—)
  - [åã€åºåˆ—å›¾åˆ†æå·¥å…·](#ååºåˆ—å›¾åˆ†æå·¥å…·)
    - [10.1 æ—¶åºæ€§èƒ½åˆ†æå™¨](#101-æ—¶åºæ€§èƒ½åˆ†æå™¨)
    - [10.2 äº¤äº’ä¾èµ–åˆ†æå™¨](#102-äº¤äº’ä¾èµ–åˆ†æå™¨)

---

## ä¸€ã€äº‹åŠ¡æäº¤åºåˆ—

### 1.1 æ­£å¸¸æäº¤æµç¨‹

```mermaid
sequenceDiagram
    participant Client
    participant PG as PostgreSQL
    participant WAL as WAL Writer
    participant Disk

    Client->>PG: BEGIN
    PG->>PG: åˆ†é…äº‹åŠ¡ID (xid=100)
    PG->>PG: åˆ›å»ºå¿«ç…§

    Client->>PG: UPDATE accounts SET balance = 1000
    PG->>PG: è·å–è¡Œé”
    PG->>PG: åˆ›å»ºæ–°ç‰ˆæœ¬ (xmin=100)
    PG->>WAL: å†™WALè®°å½•
    WAL->>Disk: fsync WAL

    Client->>PG: COMMIT
    PG->>WAL: å†™COMMITè®°å½•
    WAL->>Disk: fsync COMMIT
    PG->>PG: æ›´æ–°pg_clog (xid=100 â†’ committed)
    PG->>PG: é‡Šæ”¾é”
    PG->>Client: COMMITæˆåŠŸ
```

**å…³é”®æ—¶åºç‚¹**:

1. **T1**: äº‹åŠ¡å¼€å§‹ï¼Œåˆ†é…xid
2. **T2**: å†™æ“ä½œï¼Œå…ˆå†™WAL
3. **T3**: WALåŒæ­¥åˆ°ç£ç›˜ï¼ˆfsyncï¼‰
4. **T4**: COMMITè®°å½•å†™å…¥WAL
5. **T5**: COMMITåŒæ­¥åˆ°ç£ç›˜
6. **T6**: æ›´æ–°äº‹åŠ¡çŠ¶æ€ï¼ˆpg_clogï¼‰

**æ€§èƒ½å½±å“**:

- **WAL fsync**: æœ€è€—æ—¶æ“ä½œï¼ˆ~10msï¼‰
- **ä¼˜åŒ–**: æ‰¹é‡æäº¤ã€å¼‚æ­¥fsyncï¼ˆé£é™©ï¼‰

### 1.2 ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰

```mermaid
sequenceDiagram
    participant Coordinator
    participant PG1 as PostgreSQL Node1
    participant PG2 as PostgreSQL Node2

    Coordinator->>PG1: PREPARE TRANSACTION
    PG1->>PG1: å†™PREPARE WAL
    PG1->>Coordinator: PREPARED

    Coordinator->>PG2: PREPARE TRANSACTION
    PG2->>PG2: å†™PREPARE WAL
    PG2->>Coordinator: PREPARED

    Coordinator->>PG1: COMMIT PREPARED
    Coordinator->>PG2: COMMIT PREPARED
    PG1->>Coordinator: COMMITTED
    PG2->>Coordinator: COMMITTED
```

**æ—¶åºçº¦æŸ**:

- **Phase 1**: æ‰€æœ‰èŠ‚ç‚¹å¿…é¡»PREPARED
- **Phase 2**: æ‰€æœ‰èŠ‚ç‚¹å¿…é¡»COMMITTED
- **é˜»å¡é—®é¢˜**: å¦‚æœCoordinatoræ•…éšœï¼ŒèŠ‚ç‚¹å¯èƒ½æ°¸ä¹…é˜»å¡

---

## äºŒã€MVCCè¯»æ“ä½œåºåˆ—

### 2.1 å¿«ç…§åˆ›å»ºåºåˆ—

```mermaid
sequenceDiagram
    participant Client
    participant PG as PostgreSQL
    participant ProcArray as ProcArray
    participant Snapshot

    Client->>PG: BEGIN ISOLATION LEVEL REPEATABLE READ
    PG->>ProcArray: è·å–æ‰€æœ‰æ´»è·ƒäº‹åŠ¡ID
    ProcArray->>PG: xids = [101, 102, 103]
    PG->>PG: è®¡ç®—xmin = 100 (æœ€è€æ´»è·ƒäº‹åŠ¡)
    PG->>PG: è®¡ç®—xmax = 104 (ä¸‹ä¸€ä¸ªxid)
    PG->>Snapshot: åˆ›å»ºå¿«ç…§ {xmin=100, xmax=104, xip=[101,102,103]}
    PG->>Client: äº‹åŠ¡å¼€å§‹ï¼Œå¿«ç…§å·²åˆ›å»º

    Note over Snapshot: å¿«ç…§åœ¨æ•´ä¸ªäº‹åŠ¡æœŸé—´ä¿æŒä¸å˜
```

**å¿«ç…§åˆ›å»ºæ—¶æœº**:

- **Read Committed**: æ¯æ¡è¯­å¥åˆ›å»ºæ–°å¿«ç…§
- **Repeatable Read**: äº‹åŠ¡å¼€å§‹æ—¶åˆ›å»ºï¼Œå¤ç”¨æ•´ä¸ªäº‹åŠ¡
- **Serializable**: åŒRepeatable Readï¼Œä½†å¢åŠ SSIæ£€æµ‹

### 2.2 å¯è§æ€§æ£€æŸ¥åºåˆ—

```mermaid
sequenceDiagram
    participant Query
    participant HeapScan as Heap Scan
    participant Tuple as å…ƒç»„ç‰ˆæœ¬
    participant Snapshot
    participant CLog as pg_clog

    Query->>HeapScan: SELECT * FROM accounts
    HeapScan->>Tuple: è¯»å–å…ƒç»„ (xmin=99, xmax=NULL)

    HeapScan->>Snapshot: æ£€æŸ¥å¯è§æ€§
    Snapshot->>Snapshot: xmin(99) < xmin_snap(100)? â†’ Yes
    Snapshot->>CLog: æŸ¥è¯¢xid=99çŠ¶æ€
    CLog->>Snapshot: committed

    Snapshot->>Snapshot: xmax=NULL? â†’ Yes
    Snapshot->>HeapScan: å¯è§ âœ“

    HeapScan->>Tuple: è¯»å–ä¸‹ä¸€ä¸ªç‰ˆæœ¬
    Tuple->>HeapScan: (xmin=101, xmax=102)

    HeapScan->>Snapshot: æ£€æŸ¥å¯è§æ€§
    Snapshot->>Snapshot: xmin(101) in xip([101,102,103])? â†’ Yes
    Snapshot->>HeapScan: ä¸å¯è§ âœ— (åˆ›å»ºè€…æœªæäº¤)
```

**å¯è§æ€§åˆ¤æ–­ç®—æ³•**:

```python
def is_visible(tuple, snapshot):
    """å…ƒç»„å¯è§æ€§åˆ¤æ–­"""
    # è§„åˆ™1: xminå¿…é¡»å·²æäº¤
    if not is_committed(tuple.xmin):
        return False

    # è§„åˆ™2: xminä¸èƒ½åœ¨æ´»è·ƒäº‹åŠ¡åˆ—è¡¨ä¸­
    if tuple.xmin in snapshot.xip:
        return False

    # è§„åˆ™3: xminå¿…é¡»å°äºå¿«ç…§xmax
    if tuple.xmin >= snapshot.xmax:
        return False

    # è§„åˆ™4: å¦‚æœxmaxå­˜åœ¨ï¼Œæ£€æŸ¥åˆ é™¤è€…
    if tuple.xmax is not None:
        if is_committed(tuple.xmax) and tuple.xmax < snapshot.xmax:
            if tuple.xmax not in snapshot.xip:
                return False  # å·²è¢«åˆ é™¤

    return True
```

---

## ä¸‰ã€é”è·å–åºåˆ—

### 3.1 è¡Œçº§é”è·å–

```mermaid
sequenceDiagram
    participant T1 as äº‹åŠ¡1
    participant LM as é”ç®¡ç†å™¨
    participant T2 as äº‹åŠ¡2
    participant Row

    T1->>LM: SELECT * FROM accounts WHERE id=1 FOR UPDATE
    LM->>Row: æ£€æŸ¥é”çŠ¶æ€
    Row->>LM: æ— é”
    LM->>Row: è·å–æ’ä»–é” (X-lock)
    LM->>T1: é”è·å–æˆåŠŸ

    T2->>LM: SELECT * FROM accounts WHERE id=1 FOR UPDATE
    LM->>Row: æ£€æŸ¥é”çŠ¶æ€
    Row->>LM: å·²æœ‰X-lock (æŒæœ‰è€…: T1)
    LM->>T2: ç­‰å¾…é”é‡Šæ”¾

    Note over T2: ç­‰å¾…é˜Ÿåˆ—: [T2]

    T1->>T1: COMMIT
    T1->>LM: é‡Šæ”¾æ‰€æœ‰é”
    LM->>Row: é‡Šæ”¾X-lock
    LM->>T2: é€šçŸ¥é”å¯ç”¨
    T2->>Row: è·å–X-lock
    LM->>T2: é”è·å–æˆåŠŸ
```

**é”ç­‰å¾…è¶…æ—¶**:

```sql
-- è®¾ç½®é”ç­‰å¾…è¶…æ—¶
SET lock_timeout = '5s';

-- å¦‚æœ5ç§’å†…æœªè·å¾—é”ï¼ŒæŠ›å‡ºé”™è¯¯
ERROR: canceling statement due to lock timeout
```

### 3.2 æ­»é”æ£€æµ‹åºåˆ—

```mermaid
sequenceDiagram
    participant T1 as äº‹åŠ¡1
    participant T2 as äº‹åŠ¡2
    participant DM as æ­»é”æ£€æµ‹å™¨
    participant WaitGraph

    T1->>WaitGraph: è·å–Açš„X-lock
    T2->>WaitGraph: è·å–Bçš„X-lock

    T1->>WaitGraph: è¯·æ±‚Bçš„X-lock (ç­‰å¾…T2)
    T2->>WaitGraph: è¯·æ±‚Açš„X-lock (ç­‰å¾…T1)

    Note over WaitGraph: ç­‰å¾…å›¾: T1â†’T2, T2â†’T1 (å½¢æˆç¯!)

    DM->>WaitGraph: å‘¨æœŸæ€§æ£€æµ‹ (æ¯1ç§’)
    WaitGraph->>DM: å‘ç°ç¯: T1â†’T2â†’T1
    DM->>DM: é€‰æ‹©å—å®³è€… (T2: æˆæœ¬æ›´ä½)
    DM->>T2: ä¸­æ­¢äº‹åŠ¡ (ROLLBACK)
    DM->>WaitGraph: ç§»é™¤T2çš„ç­‰å¾…è¾¹
    T1->>WaitGraph: è·å¾—Bçš„é”
    T1->>T1: ç»§ç»­æ‰§è¡Œ
```

**æ­»é”æ£€æµ‹ç®—æ³•**:

```python
def detect_deadlock(wait_graph):
    """æ­»é”æ£€æµ‹ï¼ˆDFSæ‰¾ç¯ï¼‰"""
    visited = set()
    rec_stack = set()

    def dfs(node):
        visited.add(node)
        rec_stack.add(node)

        for neighbor in wait_graph.get(node, []):
            if neighbor not in visited:
                if dfs(neighbor):
                    return True
            elif neighbor in rec_stack:
                # å‘ç°ç¯ï¼
                return True

        rec_stack.remove(node)
        return False

    for node in wait_graph:
        if node not in visited:
            if dfs(node):
                return True  # å­˜åœ¨æ­»é”

    return False  # æ— æ­»é”
```

---

## å››ã€Raftå…±è¯†åºåˆ—

### 4.1 Leaderé€‰ä¸¾åºåˆ—

```mermaid
sequenceDiagram
    participant N1 as Node1 (Follower)
    participant N2 as Node2 (Follower)
    participant N3 as Node3 (Follower)
    participant Leader

    Note over N1,N3: Leaderæ•…éšœï¼Œå¿ƒè·³è¶…æ—¶

    N1->>N1: é€‰ä¸¾è¶…æ—¶ (150ms)
    N1->>N1: è½¬æ¢ä¸ºCandidate
    N1->>N1: term++ (term=5)
    N1->>N2: RequestVote(term=5)
    N1->>N3: RequestVote(term=5)

    N2->>N1: VoteGranted(term=5)
    N3->>N1: VoteGranted(term=5)

    Note over N1: è·å¾—å¤šæ•°ç¥¨ (2/3)

    N1->>N1: è½¬æ¢ä¸ºLeader
    N1->>N2: AppendEntries(term=5, heartbeat)
    N1->>N3: AppendEntries(term=5, heartbeat)

    N2->>N1: Success
    N3->>N1: Success

    Note over N1,N3: æ–°Leaderå·²é€‰å‡º
```

**é€‰ä¸¾è¶…æ—¶è®¾ç½®**:

- **æœ€å°å€¼**: 150msï¼ˆé¿å…é¢‘ç¹é€‰ä¸¾ï¼‰
- **æœ€å¤§å€¼**: 300msï¼ˆå¿«é€Ÿæ•…éšœæ¢å¤ï¼‰
- **éšæœºåŒ–**: 150-300mséšæœºï¼ˆé¿å…åŒæ—¶é€‰ä¸¾ï¼‰

### 4.2 æ—¥å¿—å¤åˆ¶åºåˆ—

```mermaid
sequenceDiagram
    participant Client
    participant L as Leader
    participant F1 as Follower1
    participant F2 as Follower2

    Client->>L: SET key=value
    L->>L: è¿½åŠ åˆ°æœ¬åœ°æ—¥å¿— (index=100, term=5)
    L->>F1: AppendEntries(prev_index=99, entries=[entry])
    L->>F2: AppendEntries(prev_index=99, entries=[entry])

    F1->>F1: æ£€æŸ¥prev_indexåŒ¹é…
    F1->>F1: è¿½åŠ æ—¥å¿—
    F1->>L: Success

    F2->>F2: æ£€æŸ¥prev_indexåŒ¹é…
    F2->>F2: è¿½åŠ æ—¥å¿—
    F2->>L: Success

    Note over L: å¤šæ•°æ´¾ç¡®è®¤ (2/3)

    L->>L: commitIndex = 100
    L->>L: åº”ç”¨åˆ°çŠ¶æ€æœº
    L->>Client: OK

    L->>F1: AppendEntries(commitIndex=100)
    L->>F2: AppendEntries(commitIndex=100)

    F1->>F1: commitIndex = 100
    F1->>F1: åº”ç”¨åˆ°çŠ¶æ€æœº
    F2->>F2: commitIndex = 100
    F2->>F2: åº”ç”¨åˆ°çŠ¶æ€æœº
```

**æ—¥å¿—å¤åˆ¶ä¿è¯**:

- **å¤šæ•°æ´¾å†™å…¥**: è‡³å°‘âŒŠn/2âŒ‹+1ä¸ªèŠ‚ç‚¹ç¡®è®¤
- **çº¿æ€§ä¸€è‡´æ€§**: æ‰€æœ‰èŠ‚ç‚¹æŒ‰ç›¸åŒé¡ºåºåº”ç”¨

---

## äº”ã€åˆ†å¸ƒå¼äº‹åŠ¡åºåˆ—

### 5.1 Percolatorä¸¤é˜¶æ®µæäº¤

```mermaid
sequenceDiagram
    participant Client
    participant Primary as Primary Key
    participant Secondary as Secondary Key
    participant TS as Timestamp Oracle

    Client->>TS: è·å–å¼€å§‹æ—¶é—´æˆ³ (start_ts=100)
    Client->>Primary: å†™å…¥ (key=p, value=v, start_ts=100)
    Client->>Secondary: å†™å…¥ (key=s, value=v, start_ts=100)

    Client->>TS: è·å–æäº¤æ—¶é—´æˆ³ (commit_ts=200)
    Client->>Primary: æäº¤ (commit_ts=200)
    Primary->>Primary: æ£€æŸ¥é”çŠ¶æ€
    Primary->>Primary: å†™å…¥æäº¤è®°å½•
    Primary->>Client: æäº¤æˆåŠŸ

    Client->>Secondary: æäº¤ (commit_ts=200)
    Secondary->>Secondary: æ£€æŸ¥Primaryæ˜¯å¦å·²æäº¤
    Secondary->>Secondary: å†™å…¥æäº¤è®°å½•
    Secondary->>Client: æäº¤æˆåŠŸ
```

**Percolatorç‰¹ç‚¹**:

- **å¼‚æ­¥æäº¤**: Secondaryåœ¨Primaryæäº¤åæ‰æäº¤
- **æ•…éšœæ¢å¤**: é€šè¿‡æ£€æŸ¥PrimaryçŠ¶æ€å†³å®šæäº¤æˆ–å›æ»š

### 5.2 Sagaè¡¥å¿åºåˆ—

```mermaid
sequenceDiagram
    participant Orchestrator
    participant S1 as æœåŠ¡1 (è®¢å•)
    participant S2 as æœåŠ¡2 (æ”¯ä»˜)
    participant S3 as æœåŠ¡3 (åº“å­˜)

    Orchestrator->>S1: åˆ›å»ºè®¢å•
    S1->>Orchestrator: è®¢å•åˆ›å»ºæˆåŠŸ

    Orchestrator->>S2: æ‰£å‡ä½™é¢
    S2->>Orchestrator: æ”¯ä»˜æˆåŠŸ

    Orchestrator->>S3: æ‰£å‡åº“å­˜
    S3->>Orchestrator: åº“å­˜ä¸è¶³ (å¤±è´¥)

    Note over Orchestrator: éœ€è¦è¡¥å¿å‰ä¸¤æ­¥

    Orchestrator->>S2: è¡¥å¿: é€€å›ä½™é¢
    S2->>Orchestrator: è¡¥å¿æˆåŠŸ

    Orchestrator->>S1: è¡¥å¿: å–æ¶ˆè®¢å•
    S1->>Orchestrator: è¡¥å¿æˆåŠŸ

    Note over Orchestrator: Sagaäº‹åŠ¡å›æ»šå®Œæˆ
```

**Sagaæ¨¡å¼**:

- **æ­£å‘æ“ä½œ**: é¡ºåºæ‰§è¡Œ
- **è¡¥å¿æ“ä½œ**: é€†åºæ‰§è¡Œï¼ˆå¤±è´¥æ—¶ï¼‰
- **æœ€ç»ˆä¸€è‡´æ€§**: å…è®¸ä¸­é—´çŠ¶æ€ä¸ä¸€è‡´

---

## å…­ã€å®Œæ•´å®ç°ä»£ç 

### 6.1 Mermaidåºåˆ—å›¾ç”Ÿæˆå™¨

```python
from typing import List, Dict
from dataclasses import dataclass

@dataclass
class Participant:
    name: str
    alias: str = None

@dataclass
class Message:
    from_participant: str
    to_participant: str
    message: str
    arrow_type: str = "->>"  # ->>, -->, -x, -)

@dataclass
class Note:
    participants: List[str]
    text: str

class SequenceDiagramGenerator:
    """åºåˆ—å›¾ç”Ÿæˆå™¨"""

    def __init__(self):
        self.participants = []
        self.messages = []
        self.notes = []

    def add_participant(self, name: str, alias: str = None):
        """æ·»åŠ å‚ä¸è€…"""
        self.participants.append(Participant(name, alias))

    def add_message(self, from_p: str, to_p: str, msg: str, arrow: str = "->>"):
        """æ·»åŠ æ¶ˆæ¯"""
        self.messages.append(Message(from_p, to_p, msg, arrow))

    def add_note(self, participants: List[str], text: str):
        """æ·»åŠ æ³¨é‡Š"""
        self.notes.append(Note(participants, text))

    def generate(self) -> str:
        """ç”ŸæˆMermaidä»£ç """
        lines = ["sequenceDiagram"]

        # æ·»åŠ å‚ä¸è€…
        for p in self.participants:
            if p.alias:
                lines.append(f"    participant {p.alias} as {p.name}")
            else:
                lines.append(f"    participant {p.name}")

        lines.append("")

        # æ·»åŠ æ¶ˆæ¯
        for msg in self.messages:
            lines.append(f"    {msg.from_participant}{msg.arrow_type}{msg.to_participant}: {msg.message}")

        # æ·»åŠ æ³¨é‡Š
        for note in self.notes:
            participants_str = ",".join(note.participants)
            lines.append(f"    Note over {participants_str}: {note.text}")

        return "\n".join(lines)

# ä½¿ç”¨ç¤ºä¾‹
gen = SequenceDiagramGenerator()
gen.add_participant("Client")
gen.add_participant("PostgreSQL", "PG")
gen.add_participant("WAL")
gen.add_message("Client", "PG", "BEGIN")
gen.add_message("PG", "PG", "åˆ†é…äº‹åŠ¡ID")
gen.add_message("Client", "PG", "UPDATE accounts")
gen.add_message("PG", "WAL", "å†™WALè®°å½•")
gen.add_message("Client", "PG", "COMMIT")
gen.add_note(["Client", "WAL"], "äº‹åŠ¡æäº¤å®Œæˆ")

print(gen.generate())
```

### 6.2 PlantUMLåºåˆ—å›¾ç”Ÿæˆå™¨

```python
class PlantUMLSequenceGenerator:
    """PlantUMLåºåˆ—å›¾ç”Ÿæˆå™¨"""

    def __init__(self):
        self.participants = []
        self.messages = []
        self.notes = []

    def add_participant(self, name: str, stereotype: str = None):
        """æ·»åŠ å‚ä¸è€…"""
        if stereotype:
            self.participants.append(f'participant "{name}" as {name.replace(" ", "")} <<{stereotype}>>')
        else:
            self.participants.append(f'participant "{name}" as {name.replace(" ", "")}')

    def add_message(self, from_p: str, to_p: str, msg: str, arrow: str = "->"):
        """æ·»åŠ æ¶ˆæ¯"""
        from_clean = from_p.replace(" ", "")
        to_clean = to_p.replace(" ", "")
        self.messages.append(f'{from_clean} {arrow} {to_clean}: {msg}')

    def add_note(self, position: str, participants: List[str], text: str):
        """æ·»åŠ æ³¨é‡Š (position: left/right/over)"""
        participants_clean = [p.replace(" ", "") for p in participants]
        participants_str = ", ".join(participants_clean)
        self.notes.append(f'note {position} of {participants_str}: {text}')

    def generate(self) -> str:
        """ç”ŸæˆPlantUMLä»£ç """
        lines = ["@startuml", "autonumber"]
        lines.extend(self.participants)
        lines.append("")
        lines.extend(self.messages)
        lines.append("")
        lines.extend(self.notes)
        lines.append("@enduml")
        return "\n".join(lines)
```

---

## ä¸ƒã€å®é™…åº”ç”¨æ¡ˆä¾‹

### æ¡ˆä¾‹1: è°ƒè¯•åˆ†å¸ƒå¼äº‹åŠ¡

**é—®é¢˜**: åˆ†å¸ƒå¼äº‹åŠ¡å¶å°”å¤±è´¥ï¼Œéœ€è¦åˆ†ææ—¶åº

**ä½¿ç”¨åºåˆ—å›¾åˆ†æ**:

```mermaid
sequenceDiagram
    participant App
    participant PG1 as PostgreSQL Node1
    participant PG2 as PostgreSQL Node2
    participant Coordinator

    App->>Coordinator: å¼€å§‹åˆ†å¸ƒå¼äº‹åŠ¡
    Coordinator->>PG1: PREPARE
    PG1->>Coordinator: PREPARED (è€—æ—¶50ms)

    Coordinator->>PG2: PREPARE
    Note over PG2: ç½‘ç»œå»¶è¿Ÿ (200ms)
    PG2->>Coordinator: PREPARED (è€—æ—¶250ms)

    Note over Coordinator: æ€»è€—æ—¶300ms

    Coordinator->>PG1: COMMIT PREPARED
    Coordinator->>PG2: COMMIT PREPARED

    Note over App,Coordinator: é—®é¢˜: PG2ç½‘ç»œå»¶è¿Ÿå¯¼è‡´æ•´ä½“å»¶è¿Ÿé«˜
```

**ä¼˜åŒ–æ–¹æ¡ˆ**:

1. **å¹¶è¡ŒPREPARE**: åŒæ—¶å‘é€ç»™æ‰€æœ‰èŠ‚ç‚¹
2. **è¶…æ—¶è®¾ç½®**: è®¾ç½®PREPAREè¶…æ—¶ï¼ˆé¿å…æ— é™ç­‰å¾…ï¼‰
3. **é‡è¯•æœºåˆ¶**: ç½‘ç»œé”™è¯¯æ—¶è‡ªåŠ¨é‡è¯•

### æ¡ˆä¾‹2: åˆ†ææ€§èƒ½ç“¶é¢ˆ

**é—®é¢˜**: äº‹åŠ¡æäº¤æ…¢ï¼Œéœ€è¦å®šä½ç“¶é¢ˆ

**ä½¿ç”¨åºåˆ—å›¾åˆ†æ**:

```mermaid
sequenceDiagram
    participant Client
    participant PG as PostgreSQL
    participant WAL as WAL Writer
    participant Disk

    Client->>PG: COMMIT
    Note over PG: T1: 0ms

    PG->>WAL: å†™COMMITè®°å½•
    Note over WAL: T2: 1ms

    WAL->>Disk: fsync WAL
    Note over Disk: T3: 15ms (ç“¶é¢ˆ!)

    Disk->>WAL: fsyncå®Œæˆ
    WAL->>PG: WALå·²åŒæ­¥
    PG->>PG: æ›´æ–°pg_clog
    Note over PG: T4: 16ms

    PG->>Client: COMMITæˆåŠŸ
    Note over Client: T5: 16ms
```

**æ€§èƒ½åˆ†æ**:

- **æ€»è€—æ—¶**: 16ms
- **ç“¶é¢ˆ**: fsyncæ“ä½œï¼ˆ15msï¼Œå 94%ï¼‰
- **ä¼˜åŒ–**: ä½¿ç”¨`commit_delay`æ‰¹é‡æäº¤ï¼Œæˆ–ä½¿ç”¨SSDé™ä½fsyncå»¶è¿Ÿ

---

## å…«ã€åä¾‹ä¸é”™è¯¯è®¾è®¡

### åä¾‹1: ç¼ºå°‘è¶…æ—¶å¤„ç†

**é”™è¯¯è®¾è®¡**:

```mermaid
sequenceDiagram
    participant Client
    participant Service
    participant DB

    Client->>Service: è½¬è´¦è¯·æ±‚
    Service->>DB: BEGIN TRANSACTION
    Service->>DB: UPDATE account1
    Service->>DB: UPDATE account2

    Note over DB: å¦‚æœDBæ•…éšœï¼ŒClientæ°¸ä¹…ç­‰å¾…!

    DB--xService: æ— å“åº”
    Service--xClient: æ— å“åº”
```

**é—®é¢˜**: æ²¡æœ‰è¶…æ—¶æœºåˆ¶ï¼Œæ•…éšœæ—¶å®¢æˆ·ç«¯æ°¸ä¹…é˜»å¡

**æ­£ç¡®è®¾è®¡**:

```mermaid
sequenceDiagram
    participant Client
    participant Service
    participant DB
    participant Timeout

    Client->>Service: è½¬è´¦è¯·æ±‚
    Service->>DB: BEGIN TRANSACTION
    Service->>Timeout: è®¾ç½®è¶…æ—¶ (5ç§’)

    Service->>DB: UPDATE account1
    Service->>DB: UPDATE account2

    alt DBæ­£å¸¸å“åº”
        DB->>Service: COMMITæˆåŠŸ
        Service->>Timeout: å–æ¶ˆè¶…æ—¶
        Service->>Client: æˆåŠŸ
    else è¶…æ—¶
        Timeout->>Service: è¶…æ—¶è§¦å‘
        Service->>DB: ROLLBACK
        Service->>Client: è¶…æ—¶é”™è¯¯
    end
```

### åä¾‹2: å¿½ç•¥é”™è¯¯å¤„ç†

**é”™è¯¯è®¾è®¡**:

```mermaid
sequenceDiagram
    participant Client
    participant PG1
    participant PG2

    Client->>PG1: PREPARE
    PG1->>Client: PREPARED

    Client->>PG2: PREPARE
    PG2--xClient: ç½‘ç»œé”™è¯¯

    Note over Client: é—®é¢˜: æ²¡æœ‰å¤„ç†PG2å¤±è´¥ï¼Œç›´æ¥COMMIT PG1
    Client->>PG1: COMMIT PREPARED
    Note over PG1,PG2: æ•°æ®ä¸ä¸€è‡´!
```

**æ­£ç¡®è®¾è®¡**:

```mermaid
sequenceDiagram
    participant Client
    participant PG1
    participant PG2

    Client->>PG1: PREPARE
    PG1->>Client: PREPARED

    Client->>PG2: PREPARE
    PG2--xClient: ç½‘ç»œé”™è¯¯

    Note over Client: æ£€æµ‹åˆ°å¤±è´¥ï¼Œå›æ»šæ‰€æœ‰èŠ‚ç‚¹
    Client->>PG1: ROLLBACK PREPARED
    Client->>Client: è¿”å›é”™è¯¯ç»™ç”¨æˆ·
```

---

## ä¹ã€æ›´å¤šåºåˆ—å›¾ç¤ºä¾‹

### 9.1 MVCCç‰ˆæœ¬é“¾éå†åºåˆ—

**å®Œæ•´åºåˆ—**: æŸ¥è¯¢æ—¶éå†ç‰ˆæœ¬é“¾æ‰¾åˆ°å¯è§ç‰ˆæœ¬

```mermaid
sequenceDiagram
    participant Query
    participant Heap
    participant Index
    participant Snapshot

    Query->>Index: æŸ¥æ‰¾ç´¢å¼•æ¡ç›®
    Index-->>Query: è¿”å›TID (page=5, offset=123)

    Query->>Heap: è¯»å–å…ƒç»„ (page=5, offset=123)
    Heap-->>Query: è¿”å›å…ƒç»„ç‰ˆæœ¬ (xmin=100, xmax=null)

    Query->>Snapshot: æ£€æŸ¥å¯è§æ€§ (xid=100)
    Snapshot-->>Query: xid=100 å·²æäº¤ï¼Œå¯è§

    Note over Query: æ‰¾åˆ°å¯è§ç‰ˆæœ¬ï¼Œè¿”å›ç»“æœ

    alt ç‰ˆæœ¬ä¸å¯è§ï¼Œéœ€è¦éå†ç‰ˆæœ¬é“¾
        Query->>Heap: è¯»å–ä¸‹ä¸€ä¸ªç‰ˆæœ¬ (ctidæŒ‡å‘)
        Heap-->>Query: è¿”å›å…ƒç»„ç‰ˆæœ¬ (xmin=99, xmax=100)
        Query->>Snapshot: æ£€æŸ¥å¯è§æ€§ (xid=99)
        Snapshot-->>Query: xid=99 å·²æäº¤ï¼Œå¯è§
        Query->>Query: è¿”å›ç»“æœ
    end
```

**æ€§èƒ½åˆ†æ**:

| æ“ä½œ | è€—æ—¶ | ä¼˜åŒ– |
|-----|------|------|
| ç´¢å¼•æŸ¥æ‰¾ | 0.1ms | ç´¢å¼•ä¼˜åŒ– |
| å †è¯»å– | 0.2ms | é¢„è¯» |
| å¯è§æ€§æ£€æŸ¥ | 0.05ms | ç¼“å­˜å¿«ç…§ |
| ç‰ˆæœ¬é“¾éå† | 0.5ms/ç‰ˆæœ¬ | HOTä¼˜åŒ– |

### 9.2 VACUUMæ¸…ç†åºåˆ—

**å®Œæ•´åºåˆ—**: VACUUMæ¸…ç†æ­»å…ƒç»„çš„å®Œæ•´æµç¨‹

```mermaid
sequenceDiagram
    participant AutoVacuum
    participant Heap
    participant Index
    participant FSM as Free Space Map
    participant VM as Visibility Map

    AutoVacuum->>Heap: æ‰«æå †è¡¨ç¬¬ä¸€é
    Heap-->>AutoVacuum: è¿”å›æ­»å…ƒç»„TIDåˆ—è¡¨

    AutoVacuum->>Index: æ¸…ç†ç´¢å¼•æ¡ç›®
    loop æ¯ä¸ªæ­»å…ƒç»„
        Index->>Index: åˆ é™¤ç´¢å¼•æ¡ç›®
    end
    Index-->>AutoVacuum: æ¸…ç†å®Œæˆ

    AutoVacuum->>Heap: æ‰«æå †è¡¨ç¬¬äºŒé
    loop æ¯ä¸ªæ­»å…ƒç»„
        Heap->>Heap: å›æ”¶ç©ºé—´
        Heap->>FSM: æ›´æ–°ç©ºé—²ç©ºé—´
    end

    AutoVacuum->>VM: æ›´æ–°å¯è§æ€§æ˜ å°„
    VM-->>AutoVacuum: æ›´æ–°å®Œæˆ

    AutoVacuum->>AutoVacuum: æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
```

**å…³é”®æ—¶åºç‚¹**:

1. **T1**: ç¬¬ä¸€éæ‰«æï¼Œæ”¶é›†æ­»å…ƒç»„ï¼ˆI/Oå¯†é›†ï¼‰
2. **T2**: æ¸…ç†ç´¢å¼•ï¼ˆCPUå¯†é›†ï¼‰
3. **T3**: ç¬¬äºŒéæ‰«æï¼Œå›æ”¶ç©ºé—´ï¼ˆI/Oå¯†é›†ï¼‰
4. **T4**: æ›´æ–°FSM/VMï¼ˆè½»é‡çº§ï¼‰

**ä¼˜åŒ–ç­–ç•¥**:

- **å¹¶è¡ŒVACUUM**: å¤šè¿›ç¨‹å¹¶è¡Œå¤„ç†
- **å¢é‡VACUUM**: åªå¤„ç†è„é¡µ
- **æ™ºèƒ½è°ƒåº¦**: é¿å¼€ä¸šåŠ¡é«˜å³°æœŸ

### 9.3 åˆ†å¸ƒå¼é”è·å–åºåˆ—

**å®Œæ•´åºåˆ—**: Redisåˆ†å¸ƒå¼é”çš„è·å–å’Œé‡Šæ”¾

```mermaid
sequenceDiagram
    participant App1
    participant App2
    participant Redis

    App1->>Redis: SET lock:resource1 "uuid1" EX 30 NX
    Redis-->>App1: OK (è·å–æˆåŠŸ)

    App2->>Redis: SET lock:resource1 "uuid2" EX 30 NX
    Redis-->>App2: nil (è·å–å¤±è´¥)

    App2->>App2: ç­‰å¾…é‡è¯•

    Note over App1: æ‰§è¡Œä¸šåŠ¡é€»è¾‘ (20ç§’)

    App1->>Redis: GET lock:resource1
    Redis-->>App1: "uuid1"
    App1->>App1: éªŒè¯uuidåŒ¹é…

    App1->>Redis: DEL lock:resource1
    Redis-->>App1: 1 (åˆ é™¤æˆåŠŸ)

    App2->>Redis: SET lock:resource1 "uuid2" EX 30 NX
    Redis-->>App2: OK (è·å–æˆåŠŸ)
```

**å…³é”®è®¾è®¡ç‚¹**:

1. **NXé€‰é¡¹**: åªåœ¨keyä¸å­˜åœ¨æ—¶è®¾ç½®
2. **EXè¿‡æœŸ**: é˜²æ­¢æ­»é”
3. **UUIDéªŒè¯**: é˜²æ­¢è¯¯åˆ å…¶ä»–è¿›ç¨‹çš„é”
4. **é‡è¯•æœºåˆ¶**: è·å–å¤±è´¥æ—¶ç­‰å¾…é‡è¯•

---

## åã€åºåˆ—å›¾åˆ†æå·¥å…·

### 10.1 æ—¶åºæ€§èƒ½åˆ†æå™¨

**å®Œæ•´å®ç°**: ä»åºåˆ—å›¾æå–æ€§èƒ½ç“¶é¢ˆ

```python
from dataclasses import dataclass
from typing import List, Dict
import re

@dataclass
class SequenceStep:
    """åºåˆ—æ­¥éª¤"""
    from_actor: str
    to_actor: str
    message: str
    timestamp: float
    duration: float

class SequencePerformanceAnalyzer:
    """åºåˆ—å›¾æ€§èƒ½åˆ†æå™¨"""

    def __init__(self):
        self.steps: List[SequenceStep] = []

    def parse_mermaid(self, mermaid_code: str):
        """è§£æMermaidåºåˆ—å›¾"""
        lines = mermaid_code.split('\n')
        current_time = 0.0

        for line in lines:
            # è§£æç®­å¤´: App1->>Redis: message
            match = re.match(r'\s*(\w+)(->>|-->>|->|--x)(\w+):\s*(.+)', line)
            if match:
                from_actor, arrow_type, to_actor, message = match.groups()

                # ä¼°ç®—è€—æ—¶ï¼ˆç®€åŒ–å®ç°ï¼‰
                duration = self._estimate_duration(message, arrow_type)

                step = SequenceStep(
                    from_actor=from_actor,
                    to_actor=to_actor,
                    message=message,
                    timestamp=current_time,
                    duration=duration
                )
                self.steps.append(step)
                current_time += duration

    def _estimate_duration(self, message: str, arrow_type: str) -> float:
        """ä¼°ç®—æ“ä½œè€—æ—¶ï¼ˆmsï¼‰"""
        if 'fsync' in message.lower():
            return 10.0  # ç£ç›˜åŒæ­¥
        elif 'network' in message.lower() or '->>' in arrow_type:
            return 1.0  # ç½‘ç»œè°ƒç”¨
        elif 'lock' in message.lower():
            return 0.5  # é”æ“ä½œ
        else:
            return 0.1  # æœ¬åœ°æ“ä½œ

    def analyze_bottlenecks(self) -> List[Dict]:
        """åˆ†ææ€§èƒ½ç“¶é¢ˆ"""
        bottlenecks = []

        # æ‰¾å‡ºè€—æ—¶æœ€é•¿çš„æ“ä½œ
        sorted_steps = sorted(self.steps, key=lambda s: s.duration, reverse=True)

        for step in sorted_steps[:5]:  # å‰5ä¸ªç“¶é¢ˆ
            bottlenecks.append({
                'operation': f"{step.from_actor} -> {step.to_actor}: {step.message}",
                'duration': step.duration,
                'timestamp': step.timestamp,
                'percentage': step.duration / sum(s.duration for s in self.steps) * 100
            })

        return bottlenecks

    def generate_report(self) -> str:
        """ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š"""
        bottlenecks = self.analyze_bottlenecks()
        total_time = sum(s.duration for s in self.steps)

        report = f"åºåˆ—å›¾æ€§èƒ½åˆ†ææŠ¥å‘Š\n"
        report += f"{'='*60}\n"
        report += f"æ€»è€—æ—¶: {total_time:.2f}ms\n"
        report += f"æ­¥éª¤æ•°: {len(self.steps)}\n"
        report += f"\næ€§èƒ½ç“¶é¢ˆ (Top 5):\n"

        for i, bottleneck in enumerate(bottlenecks, 1):
            report += f"{i}. {bottleneck['operation']}\n"
            report += f"   è€—æ—¶: {bottleneck['duration']:.2f}ms ({bottleneck['percentage']:.1f}%)\n"

        return report

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    mermaid_code = """
sequenceDiagram
    Client->>PG: BEGIN
    PG->>WAL: å†™WALè®°å½•
    WAL->>Disk: fsync WAL
    PG->>Client: COMMITæˆåŠŸ
"""

    analyzer = SequencePerformanceAnalyzer()
    analyzer.parse_mermaid(mermaid_code)
    report = analyzer.generate_report()
    print(report)
```

### 10.2 äº¤äº’ä¾èµ–åˆ†æå™¨

**å®Œæ•´å®ç°**: åˆ†æç»„ä»¶é—´çš„ä¾èµ–å…³ç³»

```python
from collections import defaultdict
from typing import Set, Dict

class InteractionDependencyAnalyzer:
    """äº¤äº’ä¾èµ–åˆ†æå™¨"""

    def __init__(self):
        self.interactions: List[SequenceStep] = []
        self.dependencies: Dict[str, Set[str]] = defaultdict(set)

    def add_interaction(self, step: SequenceStep):
        """æ·»åŠ äº¤äº’"""
        self.interactions.append(step)
        # è®°å½•ä¾èµ–: to_actor ä¾èµ– from_actor
        self.dependencies[step.to_actor].add(step.from_actor)

    def analyze_dependencies(self) -> Dict[str, Dict]:
        """åˆ†æä¾èµ–å…³ç³»"""
        results = {}

        for actor, deps in self.dependencies.items():
            results[actor] = {
                'dependencies': list(deps),
                'dependency_count': len(deps),
                'is_critical': len(deps) > 3,  # ä¾èµ–è¶…è¿‡3ä¸ªè§†ä¸ºå…³é”®ç»„ä»¶
            }

        return results

    def find_critical_path(self) -> List[str]:
        """æ‰¾å‡ºå…³é”®è·¯å¾„ï¼ˆä¾èµ–é“¾æœ€é•¿çš„è·¯å¾„ï¼‰"""
        def dfs(actor: str, path: List[str], visited: Set[str]) -> List[str]:
            if actor in visited:
                return path

            visited.add(actor)
            path.append(actor)

            max_path = path.copy()
            for dep in self.dependencies[actor]:
                candidate = dfs(dep, path.copy(), visited.copy())
                if len(candidate) > len(max_path):
                    max_path = candidate

            return max_path

        all_paths = []
        for actor in self.dependencies:
            path = dfs(actor, [], set())
            all_paths.append(path)

        return max(all_paths, key=len) if all_paths else []

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    analyzer = InteractionDependencyAnalyzer()

    # æ·»åŠ äº¤äº’
    analyzer.add_interaction(SequenceStep("Client", "PG", "BEGIN", 0, 0.1))
    analyzer.add_interaction(SequenceStep("PG", "WAL", "å†™WAL", 0.1, 0.2))
    analyzer.add_interaction(SequenceStep("WAL", "Disk", "fsync", 0.3, 10.0))

    # åˆ†æä¾èµ–
    deps = analyzer.analyze_dependencies()
    print("ä¾èµ–å…³ç³»:")
    for actor, info in deps.items():
        print(f"  {actor}: ä¾èµ– {info['dependencies']} (å…³é”®ç»„ä»¶: {info['is_critical']})")

    # æ‰¾å‡ºå…³é”®è·¯å¾„
    critical_path = analyzer.find_critical_path()
    print(f"\nå…³é”®è·¯å¾„: {' -> '.join(critical_path)}")
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: 2.0.0ï¼ˆå¤§å¹…å……å®ï¼‰
**æœ€åæ›´æ–°**: 2025-12-05
**æ–°å¢å†…å®¹**: æ›´å¤šåºåˆ—å›¾ç¤ºä¾‹ï¼ˆMVCCç‰ˆæœ¬é“¾ã€VACUUMæ¸…ç†ã€åˆ†å¸ƒå¼é”ï¼‰ã€åºåˆ—å›¾åˆ†æå·¥å…·ï¼ˆæ€§èƒ½åˆ†æå™¨ã€ä¾èµ–åˆ†æå™¨ï¼‰ã€å®Œæ•´å·¥å…·å®ç°

**å·¥å…·ä»£ç **: æ‰€æœ‰Pythonä»£ç å¯ç›´æ¥è¿è¡Œ
**GitHub**: <https://github.com/db-theory/sequence-diagram-tools>

**å…³è”æ–‡æ¡£**:

- `04-æµç¨‹å›¾é›†.md` (æµç¨‹å›¾)
- `05-çŠ¶æ€è½¬æ¢å›¾é›†.md` (çŠ¶æ€å›¾)
- `01-æ ¸å¿ƒç†è®ºæ¨¡å‹/` (ç†è®ºåŸºç¡€)
