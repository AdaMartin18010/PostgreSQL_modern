# Read Committed (è¯»å·²æäº¤) å®Œæ•´è®ºè¯

> **æ¦‚å¿µç±»å‹**: äº‹åŠ¡éš”ç¦»çº§åˆ«
> **æ ¸å¿ƒå®šä½**: ANSI SQLæ ‡å‡†å®šä¹‰çš„å››ä¸ªéš”ç¦»çº§åˆ«ä¹‹ä¸€ï¼Œæ˜¯æœ€å¸¸ç”¨çš„é»˜è®¤éš”ç¦»çº§åˆ«
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-05
> **æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0
> **ğŸ“– æ¦‚å¿µè¯å…¸å¼•ç”¨**ï¼šæœ¬æ–‡æ¡£ä¸­çš„ Read Committed å®šä¹‰ä¸ [æ ¸å¿ƒæ¦‚å¿µè¯å…¸ - Isolation Level](./01-æ ¸å¿ƒæ¦‚å¿µè¯å…¸.md#isolation-level-éš”ç¦»çº§åˆ«) ä¿æŒä¸€è‡´ã€‚å¦‚å‘ç°ä¸ä¸€è‡´ï¼Œè¯·ä»¥æ ¸å¿ƒæ¦‚å¿µè¯å…¸ä¸ºå‡†ã€‚

---

## ğŸ“‹ ç›®å½•

- [Read Committed (è¯»å·²æäº¤) å®Œæ•´è®ºè¯](#read-committed-è¯»å·²æäº¤-å®Œæ•´è®ºè¯)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [ä¸€ã€æƒå¨å®šä¹‰](#ä¸€æƒå¨å®šä¹‰)
    - [1.1 Wikipediaå®šä¹‰](#11-wikipediaå®šä¹‰)
    - [1.2 ANSI SQLæ ‡å‡†å®šä¹‰](#12-ansi-sqlæ ‡å‡†å®šä¹‰)
    - [1.3 å­¦æœ¯è®ºæ–‡å½¢å¼åŒ–å®šä¹‰](#13-å­¦æœ¯è®ºæ–‡å½¢å¼åŒ–å®šä¹‰)
      - [å®šä¹‰1: Adya et al. (2000) æ¡†æ¶](#å®šä¹‰1-adya-et-al-2000-æ¡†æ¶)
      - [å®šä¹‰2: Bernstein \& Goodman (1981) æ¡†æ¶](#å®šä¹‰2-bernstein--goodman-1981-æ¡†æ¶)
    - [1.4 PostgreSQLå®ç°å®šä¹‰](#14-postgresqlå®ç°å®šä¹‰)
    - [1.5 å®šä¹‰å¯¹æ¯”åˆ†æ](#15-å®šä¹‰å¯¹æ¯”åˆ†æ)
  - [äºŒã€å½¢å¼åŒ–å®šä¹‰](#äºŒå½¢å¼åŒ–å®šä¹‰)
    - [2.1 æ•°å­¦è¡¨è¾¾å¼](#21-æ•°å­¦è¡¨è¾¾å¼)
    - [2.2 é€»è¾‘è¡¨è¾¾å¼](#22-é€»è¾‘è¡¨è¾¾å¼)
    - [2.3 é›†åˆè®ºè¡¨ç¤º](#23-é›†åˆè®ºè¡¨ç¤º)
    - [2.4 çŠ¶æ€æœºæ¨¡å‹](#24-çŠ¶æ€æœºæ¨¡å‹)
  - [ä¸‰ã€ç†è®ºæ¨ç†é“¾æ¡](#ä¸‰ç†è®ºæ¨ç†é“¾æ¡)
    - [3.1 é—®é¢˜èµ·æº](#31-é—®é¢˜èµ·æº)
    - [3.2 ç†è®ºåŸºç¡€](#32-ç†è®ºåŸºç¡€)
    - [3.3 æ¨ç†è¿‡ç¨‹](#33-æ¨ç†è¿‡ç¨‹)
    - [3.4 è¯æ˜æ€è·¯](#34-è¯æ˜æ€è·¯)
  - [å››ã€å±æ€§ä¸å…³ç³»](#å››å±æ€§ä¸å…³ç³»)
    - [4.1 æ ¸å¿ƒå±æ€§](#41-æ ¸å¿ƒå±æ€§)
    - [4.2 ä¸å…¶ä»–æ¦‚å¿µçš„å…³ç³»](#42-ä¸å…¶ä»–æ¦‚å¿µçš„å…³ç³»)
    - [4.3 è·¨å±‚æ˜ å°„ï¼ˆLSEMï¼‰](#43-è·¨å±‚æ˜ å°„lsem)
  - [äº”ã€å¼‚å¸¸ç°è±¡åˆ†æ](#äº”å¼‚å¸¸ç°è±¡åˆ†æ)
    - [5.1 å¯èƒ½å‘ç”Ÿçš„å¼‚å¸¸](#51-å¯èƒ½å‘ç”Ÿçš„å¼‚å¸¸)
      - [å¼‚å¸¸1: ä¸å¯é‡å¤è¯» (Non-repeatable Read / P2)](#å¼‚å¸¸1-ä¸å¯é‡å¤è¯»-non-repeatable-read--p2)
      - [å¼‚å¸¸2: å¹»è¯» (Phantom Read / P3)](#å¼‚å¸¸2-å¹»è¯»-phantom-read--p3)
    - [5.2 å¼‚å¸¸æ¡ä»¶](#52-å¼‚å¸¸æ¡ä»¶)
    - [5.3 å¼‚å¸¸ç¤ºä¾‹](#53-å¼‚å¸¸ç¤ºä¾‹)
    - [5.4 å¦‚ä½•é¿å…](#54-å¦‚ä½•é¿å…)
  - [å…­ã€åä¾‹ä¸é”™è¯¯ä½¿ç”¨](#å…­åä¾‹ä¸é”™è¯¯ä½¿ç”¨)
    - [åä¾‹1: é”™è¯¯ä½¿ç”¨Read Committedè¿›è¡Œè´¢åŠ¡è®¡ç®—](#åä¾‹1-é”™è¯¯ä½¿ç”¨read-committedè¿›è¡Œè´¢åŠ¡è®¡ç®—)
    - [åä¾‹2: è¯¯ä»¥ä¸ºRead Committedé˜²æ­¢å¹»è¯»](#åä¾‹2-è¯¯ä»¥ä¸ºread-committedé˜²æ­¢å¹»è¯»)
    - [åä¾‹3: åœ¨Read Committedä¸‹ä½¿ç”¨åº”ç”¨å±‚é”](#åä¾‹3-åœ¨read-committedä¸‹ä½¿ç”¨åº”ç”¨å±‚é”)
  - [ä¸ƒã€æ­£ç¡®ä½¿ç”¨ç¤ºä¾‹](#ä¸ƒæ­£ç¡®ä½¿ç”¨ç¤ºä¾‹)
    - [ç¤ºä¾‹1: Webåº”ç”¨çš„å…¸å‹ä½¿ç”¨](#ç¤ºä¾‹1-webåº”ç”¨çš„å…¸å‹ä½¿ç”¨)
    - [ç¤ºä¾‹2: æ—¥å¿—è®°å½•](#ç¤ºä¾‹2-æ—¥å¿—è®°å½•)
    - [ç¤ºä¾‹3: å®æ—¶æ•°æ®å±•ç¤º](#ç¤ºä¾‹3-å®æ—¶æ•°æ®å±•ç¤º)
  - [å…«ã€æ€§èƒ½å½±å“åˆ†æ](#å…«æ€§èƒ½å½±å“åˆ†æ)
    - [8.1 æ€§èƒ½ç‰¹å¾](#81-æ€§èƒ½ç‰¹å¾)
    - [8.2 å½±å“å› ç´ ](#82-å½±å“å› ç´ )
    - [8.3 ä¼˜åŒ–å»ºè®®](#83-ä¼˜åŒ–å»ºè®®)
  - [ä¹ã€å…³è”æ¦‚å¿µå›¾è°±](#ä¹å…³è”æ¦‚å¿µå›¾è°±)
  - [åã€æ¨ç†æ ‘](#åæ¨ç†æ ‘)
  - [åä¸€ã€è¯æ˜æ ‘](#åä¸€è¯æ˜æ ‘)
  - [åäºŒã€å‚è€ƒèµ„æº](#åäºŒå‚è€ƒèµ„æº)
    - [æƒå¨æ ‡å‡†](#æƒå¨æ ‡å‡†)
    - [å­¦æœ¯è®ºæ–‡](#å­¦æœ¯è®ºæ–‡)
    - [å®ç°æ–‡æ¡£](#å®ç°æ–‡æ¡£)
    - [åœ¨çº¿èµ„æº](#åœ¨çº¿èµ„æº)

---

## ä¸€ã€æƒå¨å®šä¹‰

### 1.1 Wikipediaå®šä¹‰

**æ¥æº**: [Isolation (database systems) - Wikipedia](https://en.wikipedia.org/wiki/Isolation_(database_systems))

**å®šä¹‰åŸæ–‡**:

> **Read Committed** is an isolation level that guarantees that any data read is committed at the moment it is read. It simply restricts the reader from seeing any intermediate, uncommitted, 'dirty' read. It makes no promise whatsoever that if the transaction re-issues the read, it will find the same data; data is free to change after it is read.

**ä¸­æ–‡ç¿»è¯‘**:

> **è¯»å·²æäº¤**æ˜¯ä¸€ä¸ªéš”ç¦»çº§åˆ«ï¼Œå®ƒä¿è¯è¯»å–çš„ä»»ä½•æ•°æ®åœ¨è¢«è¯»å–æ—¶éƒ½æ˜¯å·²æäº¤çš„ã€‚å®ƒåªæ˜¯é™åˆ¶è¯»å–è€…çœ‹åˆ°ä»»ä½•ä¸­é—´çŠ¶æ€ã€æœªæäº¤çš„"è„"æ•°æ®ã€‚å®ƒä¸ä¿è¯å¦‚æœäº‹åŠ¡é‡æ–°è¯»å–æ•°æ®ï¼Œå°†æ‰¾åˆ°ç›¸åŒçš„æ•°æ®ï¼›æ•°æ®å¯ä»¥åœ¨è¢«è¯»å–åè‡ªç”±æ›´æ”¹ã€‚

**å…³é”®ç‰¹å¾**:

1. âœ… é˜²æ­¢è„è¯»ï¼ˆDirty Readï¼‰
2. âŒ å…è®¸ä¸å¯é‡å¤è¯»ï¼ˆNon-repeatable Readï¼‰
3. âŒ å…è®¸å¹»è¯»ï¼ˆPhantom Readï¼‰

---

### 1.2 ANSI SQLæ ‡å‡†å®šä¹‰

**æ¥æº**: ANSI SQL-92æ ‡å‡† (ISO/IEC 9075:1992)

**æ ‡å‡†å®šä¹‰**:

> **READ COMMITTED** is defined by ANSI SQL as the isolation level that:
>
> - **P1 (Dirty Read)**: Prohibited - A transaction must not read uncommitted data written by another transaction.
> - **P2 (Non-repeatable Read)**: Allowed - A transaction may read the same row twice and see different values.
> - **P3 (Phantom Read)**: Allowed - A transaction may execute a query twice and see different sets of rows.

**å½¢å¼åŒ–æè¿°** (ANSI SQL-92):

```text
READ COMMITTED Level:
  - P1 (Dirty Read): NOT POSSIBLE
  - P2 (Non-repeatable Read): POSSIBLE
  - P3 (Phantom): POSSIBLE
```

**æ ‡å‡†ç¼–å·**: SQL-92 Section 4.28.2.2

---

### 1.3 å­¦æœ¯è®ºæ–‡å½¢å¼åŒ–å®šä¹‰

#### å®šä¹‰1: Adya et al. (2000) æ¡†æ¶

**æ¥æº**: Adya, A., et al. (2000). "Generalized Isolation Level Definitions"

**å½¢å¼åŒ–å®šä¹‰**:

Read Committedçº§åˆ«åœ¨Adyaçš„å¼‚å¸¸ç°è±¡åˆ†ç±»ä¸­çš„å®šä¹‰ï¼š

```text
RC = {G0, G1a, G1b, G1c} - {P0}

å…¶ä¸­:
- G0 (Dirty Write): ç¦æ­¢
- G1a (Aborted Read/Dirty Read): ç¦æ­¢
- G1b (Intermediate Read): ç¦æ­¢
- G1c (Circular Information Flow): å…è®¸
- P0 (Dirty Write): ç¦æ­¢
```

**å…³é”®å¼‚å¸¸ç°è±¡**:

- âœ… **ç¦æ­¢**: P0 (Dirty Write), G1a (Dirty Read)
- âŒ **å…è®¸**: G1b (Non-repeatable Read), G1c (Phantom Read)

#### å®šä¹‰2: Bernstein & Goodman (1981) æ¡†æ¶

**æ¥æº**: Bernstein, P. A., & Goodman, N. (1981). "Concurrency Control in Distributed Database Systems"

**åŸºäºå†²çªå›¾çš„å®šä¹‰**:

```text
RCå…è®¸çš„å†²çª:
  - wr (Write-Read): å…è®¸ï¼ˆå¯¼è‡´ä¸å¯é‡å¤è¯»ï¼‰
  - rw (Read-Write): å…è®¸ï¼ˆå¯¼è‡´å¹»è¯»ï¼‰

RCç¦æ­¢çš„å†²çª:
  - ww (Write-Write) åœ¨æœªæäº¤é˜¶æ®µ: ç¦æ­¢ï¼ˆé˜²æ­¢è„å†™ï¼‰
  - wr (Write-Read) åœ¨æœªæäº¤é˜¶æ®µ: ç¦æ­¢ï¼ˆé˜²æ­¢è„è¯»ï¼‰
```

---

### 1.4 PostgreSQLå®ç°å®šä¹‰

**æ¥æº**: PostgreSQLå®˜æ–¹æ–‡æ¡£ - [Transaction Isolation](https://www.postgresql.org/docs/current/transaction-iso.html)

**PostgreSQLå®ç°**:

> **Read Committed** (the default):
>
> Each statement within a transaction sees a snapshot of data committed before that statement began. If another transaction commits changes between statement executions within the current transaction, the current transaction will see those new changes.

**å…³é”®å®ç°æœºåˆ¶**:

1. **æ¯ä¸ªè¯­å¥è·å–æ–°å¿«ç…§**
   - ä¸æ˜¯æ•´ä¸ªäº‹åŠ¡ä½¿ç”¨ä¸€ä¸ªå¿«ç…§
   - æ¯ä¸ªSQLè¯­å¥å¼€å§‹æ—¶è·å–å½“å‰å¿«ç…§

2. **å¯è§æ€§åˆ¤æ–­**
   - åŸºäº`xmin`å’Œ`xmax`
   - åªçœ‹åˆ°è¯­å¥å¼€å§‹æ—¶å·²æäº¤çš„æ•°æ®

3. **æ— é”ç­‰å¾…ï¼ˆè¯»æ“ä½œï¼‰**
   - è¯»æ“ä½œä¸éœ€è¦ç­‰å¾…å†™é”é‡Šæ”¾
   - é€šè¿‡MVCCå®ç°æ— é˜»å¡è¯»å–

**SQLè®¾ç½®**:

```sql
SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
-- æˆ–è€…ï¼ˆé»˜è®¤ï¼‰
BEGIN;  -- PostgreSQLé»˜è®¤ä½¿ç”¨READ COMMITTED
```

---

### 1.5 å®šä¹‰å¯¹æ¯”åˆ†æ

**å®šä¹‰å¯¹æ¯”çŸ©é˜µ**:

| å®šä¹‰æ¥æº | æ ¸å¿ƒç‰¹å¾ | å·®å¼‚ç‚¹ |
|---------|---------|--------|
| **Wikipedia** | é˜²æ­¢è„è¯»ï¼Œä¸ä¿è¯é‡å¤è¯» | éå½¢å¼åŒ–ï¼Œé€šä¿—æ˜“æ‡‚ |
| **ANSI SQL-92** | åŸºäºå¼‚å¸¸ç°è±¡åˆ†ç±»ï¼ˆP1/P2/P3ï¼‰ | æ ‡å‡†å®šä¹‰ï¼Œå½¢å¼åŒ–ç¨‹åº¦ä¸­ç­‰ |
| **Adyaæ¡†æ¶** | åŸºäºå¼‚å¸¸ç°è±¡åˆ†ç±»ï¼ˆG0/G1a/G1b/G1cï¼‰ | æœ€å½¢å¼åŒ–ï¼Œæ•°å­¦ä¸¥è°¨ |
| **PostgreSQL** | åŸºäºè¯­å¥çº§å¿«ç…§ | å®ç°ç»†èŠ‚ï¼Œå®é™…è¡Œä¸º |

**å…³é”®å·®å¼‚**:

1. **å¿«ç…§ç²’åº¦**:
   - ANSIæ ‡å‡†: æœªæ˜ç¡®è§„å®šå¿«ç…§ç²’åº¦
   - PostgreSQL: è¯­å¥çº§å¿«ç…§ï¼ˆæ¯ä¸ªè¯­å¥æ–°å¿«ç…§ï¼‰

2. **å®ç°æ–¹å¼**:
   - æ ‡å‡†: å…è®¸é”æˆ–MVCCå®ç°
   - PostgreSQL: ä½¿ç”¨MVCCå®ç°

3. **å¼‚å¸¸ç°è±¡**:
   - æ ‡å‡†: åŸºäºå¼‚å¸¸ç°è±¡å®šä¹‰ï¼ˆP1/P2/P3ï¼‰
   - PostgreSQL: åŸºäºå¿«ç…§å¯è§æ€§å®ç°

---

## äºŒã€å½¢å¼åŒ–å®šä¹‰

### 2.1 æ•°å­¦è¡¨è¾¾å¼

**åŸºäºçŠ¶æ€è½¬æ¢çš„å½¢å¼åŒ–å®šä¹‰**:

è®¾äº‹åŠ¡é›†åˆ $T = \{T_1, T_2, ..., T_n\}$ï¼Œæ“ä½œé›†åˆ $O = \{r, w, c, a\}$ï¼ˆè¯»ã€å†™ã€æäº¤ã€ä¸­æ­¢ï¼‰ï¼Œæ•°æ®é¡¹é›†åˆ $D = \{x, y, ...\}$ã€‚

**Read Committedçš„å®šä¹‰**:

å¯¹äºè°ƒåº¦ $S$ï¼Œå¦‚æœæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼Œåˆ™ $S$ æ»¡è¶³ Read Committed çº§åˆ«ï¼š

$$
\forall T_i, T_j \in T, \forall x \in D: \\
(r_i(x) \in S \land w_j(x) \in S \land c_j \notin S) \implies (r_i(x) \prec_S c_j)
$$

**è§£é‡Š**:

- å¦‚æœäº‹åŠ¡ $T_i$ è¯»å–æ•°æ®é¡¹ $x$ï¼Œè€Œäº‹åŠ¡ $T_j$ å†™å…¥äº† $x$ ä½†å°šæœªæäº¤
- åˆ™ $T_i$ çš„è¯»å–æ“ä½œå¿…é¡»åœ¨ $T_j$ æäº¤ä¹‹å‰å‘ç”Ÿ
- æˆ–è€…æ›´å‡†ç¡®åœ°è¯´ï¼Œ$T_i$ ä¸èƒ½è¯»å– $T_j$ æœªæäº¤çš„æ•°æ®

**ç­‰ä»·å½¢å¼**:

$$
\forall T_i \in T, \forall r_i(x) \in O_i: \\
\text{visible}(x, r_i) = \{w_j(x) | c_j \prec r_i \lor (w_j(x) \prec r_i \land c_j \prec r_i)\}
$$

**å«ä¹‰**: äº‹åŠ¡ $T_i$ åªèƒ½çœ‹åˆ°åœ¨å®ƒè¯»å–ä¹‹å‰å·²æäº¤çš„å†™å…¥æ“ä½œã€‚

---

### 2.2 é€»è¾‘è¡¨è¾¾å¼

**ä¸€é˜¶é€»è¾‘è¡¨è¾¾**:

```text
âˆ€ Tâ‚, Tâ‚‚: Transaction
âˆ€ x: DataItem
âˆ€ r, w: Operation
âˆ€ c: Commit

ReadCommitted(S) âŸº
  (râ‚(x) âˆˆ S âˆ§ wâ‚‚(x) âˆˆ S âˆ§ Â¬committed(Tâ‚‚, before(râ‚))) âŸ¹
    (râ‚(x) cannot see wâ‚‚(x))
```

**è°“è¯é€»è¾‘è¯¦ç»†è¡¨è¾¾**:

```text
ReadCommitted(S) â‰¡
  âˆ€Tâ‚, Tâ‚‚ âˆˆ Transactions(S),
  âˆ€x âˆˆ DataItems(S),
  âˆ€r = Read(Tâ‚, x) âˆˆ Operations(S),
  âˆ€w = Write(Tâ‚‚, x) âˆˆ Operations(S):
    (âˆƒc = Commit(Tâ‚‚) âˆˆ Operations(S) âˆ§ c < r) âŸ¹
      (r can see w) âˆ§
    (Â¬âˆƒc = Commit(Tâ‚‚) âˆˆ Operations(S) âˆ¨ c > r) âŸ¹
      (r cannot see w)
```

---

### 2.3 é›†åˆè®ºè¡¨ç¤º

**åŸºäºæ“ä½œåºåˆ—çš„å®šä¹‰**:

è®¾è°ƒåº¦ $S$ æ˜¯æ“ä½œçš„ååºé›† $(O_S, \prec_S)$ï¼Œå…¶ä¸­ï¼š

- $O_S$ æ˜¯æ‰€æœ‰æ“ä½œçš„é›†åˆ
- $\prec_S$ æ˜¯æ“ä½œä¹‹é—´çš„é¡ºåºå…³ç³»

**Read Committedçº¦æŸ**:

$$
RC(S) = \{S | \forall r_i(x) \in O_S, \forall w_j(x) \in O_S: \\
  (\text{committed}(T_j, \text{before}(r_i)) \iff r_i(x) \text{ can see } w_j(x))\}
$$

**å¯è§æ€§å‡½æ•°å½¢å¼åŒ–**:

å®šä¹‰å¯è§æ€§å‡½æ•°ï¼š

$$
\text{Visible}(x, t) = \{w_j(x) | T_j \text{ committed before } t \text{ or at } t\}
$$

Read Committedè¦æ±‚ï¼š

$$
\forall r_i(x) \text{ at time } t: \\
  \text{ReadValue}(r_i(x)) \in \{v | v = \text{Value}(\text{Visible}(x, t))\}
$$

---

### 2.4 çŠ¶æ€æœºæ¨¡å‹

**äº‹åŠ¡çŠ¶æ€è½¬æ¢**:

```text
Read Committedäº‹åŠ¡çŠ¶æ€æœº:

BEGIN
  â†“
[Active] â†â”€â”€â”
  â†“         â”‚
[Read] â”€â”€â”€â”€â”€â”˜ (æ¯æ¬¡è¯»æ“ä½œè·å–æ–°å¿«ç…§)
  â†“
[Write]
  â†“
COMMIT â†’ [Committed]
  â†“
ROLLBACK â†’ [Aborted]
```

**æ•°æ®é¡¹çŠ¶æ€è½¬æ¢**:

```text
æ•°æ®é¡¹ x çš„çŠ¶æ€è½¬æ¢ (Read Committedè§†è§’):

[Uncommitted] â”€â”€(Tâ‚å†™å…¥)â”€â”€â†’ [Uncommitted]
     â”‚                             â”‚
     â”‚                             â”‚ (Tâ‚æäº¤)
     â”‚                             â†“
     â”‚                        [Committed]
     â”‚                             â”‚
     â”‚                             â”‚ (Tâ‚‚è¯»å–)
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              (Tâ‚‚åªèƒ½çœ‹åˆ°å·²æäº¤ç‰ˆæœ¬)
```

**å¯è§æ€§çŠ¶æ€**:

```text
å¯è§æ€§åˆ¤æ–­çŠ¶æ€æœº:

[è¯»å–è¯·æ±‚]
    â†“
{æ£€æŸ¥å¿«ç…§æ—¶é—´æˆ³}
    â†“
{æ£€æŸ¥æ•°æ®é¡¹çš„xmin/xmax}
    â†“
xmin <= snapshot < xmax?
    â”œâ”€ Yes â†’ [å¯è§] â†’ [è¿”å›æ•°æ®]
    â””â”€ No  â†’ [ä¸å¯è§] â†’ [è¿”å›NULLæˆ–é”™è¯¯]
```

---

## ä¸‰ã€ç†è®ºæ¨ç†é“¾æ¡

### 3.1 é—®é¢˜èµ·æº

**ä¸ºä»€ä¹ˆéœ€è¦ Read Committed éš”ç¦»çº§åˆ«ï¼Ÿ**

**é—®é¢˜1: è„è¯»é—®é¢˜**:

```text
åœºæ™¯: ä¸¤ä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œ

T1: BEGIN
      UPDATE accounts SET balance = balance - 100 WHERE id = 1;
      -- balance = 900 (æœªæäº¤)
T2: BEGIN
      SELECT balance FROM accounts WHERE id = 1;
      -- å¦‚æœå…è®¸è„è¯»ï¼ŒT2çœ‹åˆ°900
T1: ROLLBACK  -- äº‹åŠ¡å›æ»š
      -- balance å®é™…è¿˜æ˜¯1000
T2: -- ä½†T2å·²ç»åŸºäºé”™è¯¯çš„900åšäº†å†³ç­–ï¼
```

**é—®é¢˜**: å¦‚æœå…è®¸è¯»å–æœªæäº¤çš„æ•°æ®ï¼Œäº‹åŠ¡å¯èƒ½åŸºäºé”™è¯¯çš„ä¿¡æ¯åšå‡ºå†³ç­–ã€‚

**é—®é¢˜2: éš”ç¦»çº§åˆ«å±‚æ¬¡éœ€æ±‚**:

åœ¨éš”ç¦»çº§åˆ«å±‚æ¬¡ä¸­ï¼ŒRead Committedå¤„äºæœ€ä½çš„å®ç”¨çº§åˆ«ï¼š

```text
Read Uncommitted  (æœ€ä½ï¼Œå…è®¸è„è¯»)
      â†“
Read Committed    (å®ç”¨æœ€ä½çº§åˆ«ï¼Œé˜²æ­¢è„è¯») â† æˆ‘ä»¬åœ¨è¿™é‡Œ
      â†“
Repeatable Read   (é˜²æ­¢ä¸å¯é‡å¤è¯»)
      â†“
Serializable      (æœ€é«˜ï¼Œå®Œå…¨ä¸²è¡ŒåŒ–)
```

---

### 3.2 ç†è®ºåŸºç¡€

**ç†è®ºåŸºç¡€1: å¯è§æ€§ç†è®º**:

Read CommittedåŸºäº**å¯è§æ€§æ§åˆ¶**ç†è®ºï¼š

- **æ ¸å¿ƒæ€æƒ³**: é€šè¿‡æ§åˆ¶äº‹åŠ¡èƒ½"çœ‹åˆ°"å“ªäº›æ•°æ®æ¥ä¿è¯éš”ç¦»
- **å®ç°æ–¹å¼**: åªå…è®¸çœ‹åˆ°å·²æäº¤çš„æ•°æ®
- **ç†è®ºåŸºç¡€**: Lamportçš„æ—¶åºé€»è¾‘å’Œå¯è§æ€§ååº

**ç†è®ºåŸºç¡€2: MVCCæœºåˆ¶**:

PostgreSQLé€šè¿‡MVCCå®ç°Read Committedï¼š

- **å¤šç‰ˆæœ¬**: æ¯ä¸ªæ•°æ®é¡¹å¯ä»¥æœ‰å¤šä¸ªç‰ˆæœ¬
- **ç‰ˆæœ¬æ ‡è¯†**: é€šè¿‡äº‹åŠ¡ID (xmin/xmax) æ ‡è¯†ç‰ˆæœ¬
- **å¯è§æ€§åˆ¤æ–­**: åŸºäºå¿«ç…§æ—¶é—´æˆ³åˆ¤æ–­ç‰ˆæœ¬å¯è§æ€§

**ç†è®ºåŸºç¡€3: å¼‚å¸¸ç°è±¡åˆ†ç±»**:

åŸºäºANSI SQLæ ‡å‡†å’ŒAdyaæ¡†æ¶çš„å¼‚å¸¸ç°è±¡åˆ†ç±»ï¼š

- **P1 (Dirty Read)**: Read Committedå¿…é¡»ç¦æ­¢
- **P2 (Non-repeatable Read)**: Read Committedå…è®¸
- **P3 (Phantom)**: Read Committedå…è®¸

---

### 3.3 æ¨ç†è¿‡ç¨‹

**æ¨ç†é“¾æ¡1: ä»é—®é¢˜åˆ°è§£å†³æ–¹æ¡ˆ**:

```text
å‰æ1: å¹¶å‘äº‹åŠ¡å¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´
  â†“
å‰æ2: è„è¯»æ˜¯æœ€åŸºæœ¬çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜
  â†“
æ¨ç†1: éœ€è¦é˜²æ­¢äº‹åŠ¡è¯»å–æœªæäº¤çš„æ•°æ®
  â†“
å‰æ3: å¯ä»¥é€šè¿‡æ§åˆ¶å¯è§æ€§æ¥é˜²æ­¢è„è¯»
  â†“
æ¨ç†2: åªå…è®¸äº‹åŠ¡çœ‹åˆ°å·²æäº¤çš„æ•°æ®
  â†“
å‰æ4: MVCCå¯ä»¥å®ç°ç‰ˆæœ¬çº§çš„å¯è§æ€§æ§åˆ¶
  â†“
ç»“è®º: Read Committed = åªçœ‹åˆ°å·²æäº¤çš„æ•°æ®ç‰ˆæœ¬
```

**æ¨ç†é“¾æ¡2: ä»éœ€æ±‚åˆ°å®ç°**:

```text
éœ€æ±‚: é˜²æ­¢è„è¯»ï¼Œä½†ä¸è¦æ±‚å¯é‡å¤è¯»
  â†“
è®¾è®¡å†³ç­–1: æ¯ä¸ªè¯­å¥è·å–æ–°å¿«ç…§ï¼ˆè€Œä¸æ˜¯æ•´ä¸ªäº‹åŠ¡ä¸€ä¸ªå¿«ç…§ï¼‰
  â†“
è®¾è®¡å†³ç­–2: å¿«ç…§æ—¶é—´æˆ³ = è¯­å¥å¼€å§‹æ—¶é—´
  â†“
è®¾è®¡å†³ç­–3: å¯è§æ€§åˆ¤æ–­ = xmin <= snapshot < xmax
  â†“
å®ç°: PostgreSQL MVCCæœºåˆ¶
```

**æ¨ç†é“¾æ¡3: ä»å®šä¹‰åˆ°ä¿è¯**:

```text
å®šä¹‰: Read Committed = ç¦æ­¢è„è¯»ï¼Œå…è®¸ä¸å¯é‡å¤è¯»
  â†“
ä¿è¯1: å¦‚æœT2å†™å…¥xä½†æœªæäº¤ï¼ŒT1ä¸èƒ½è¯»å–x
  â†“
ä¿è¯2: å¦‚æœT2æäº¤äº†å†™å…¥xï¼ŒT1çš„ä¸‹ä¸€ä¸ªè¯­å¥å¯ä»¥è¯»å–x
  â†“
ç»“æœ: T1åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ä¸¤æ¬¡è¯»å–xå¯èƒ½çœ‹åˆ°ä¸åŒå€¼ï¼ˆä¸å¯é‡å¤è¯»ï¼‰
```

---

### 3.4 è¯æ˜æ€è·¯

**å®šç†**: Read Committedçº§åˆ«ä¸‹ï¼Œä¸ä¼šå‘ç”Ÿè„è¯»ã€‚

**è¯æ˜æ€è·¯**:

1. **å®šä¹‰è„è¯»**: äº‹åŠ¡è¯»å–äº†å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡å†™å…¥çš„æ•°æ®

2. **å½¢å¼åŒ–æè¿°**:
   $$
   \text{DirtyRead}(S) \iff \exists T_i, T_j, x: \\
     r_i(x) \text{ sees } w_j(x) \land c_j \notin S \text{ before } r_i
   $$

3. **Read Committedçº¦æŸ**:
   $$
   \text{ReadCommitted}(S) \implies \\
     \forall r_i(x): \text{visible}(x, r_i) \subseteq \{w_j(x) | c_j < r_i\}
   $$

4. **åè¯æ³•**:
   - å‡è®¾å­˜åœ¨è„è¯»
   - åˆ™å­˜åœ¨ $r_i(x)$ çœ‹åˆ°äº† $w_j(x)$ï¼Œä½† $c_j$ åœ¨ $r_i$ ä¹‹å
   - è¿™ä¸Read Committedçš„å¯è§æ€§çº¦æŸçŸ›ç›¾
   - å› æ­¤ä¸å¯èƒ½å­˜åœ¨è„è¯»

**å®Œæ•´è¯æ˜**: è§ [åä¸€ã€è¯æ˜æ ‘](#åä¸€è¯æ˜æ ‘)

---

## å››ã€å±æ€§ä¸å…³ç³»

### 4.1 æ ¸å¿ƒå±æ€§

**å±æ€§1: é˜²æ­¢è„è¯» (Dirty Read Prevention)**:

- **å®šä¹‰**: äº‹åŠ¡ä¸èƒ½è¯»å–å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡å†™å…¥çš„æ•°æ®
- **å½¢å¼åŒ–**: $\forall r_i(x), w_j(x): c_j \prec r_i \implies r_i(x) \text{ cannot see } w_j(x)$
- **ä¿è¯çº§åˆ«**: 100%ä¿è¯

**å±æ€§2: å…è®¸ä¸å¯é‡å¤è¯» (Non-repeatable Read Allowed)**:

- **å®šä¹‰**: åŒä¸€äº‹åŠ¡ä¸­ä¸¤æ¬¡è¯»å–åŒä¸€æ•°æ®é¡¹å¯èƒ½çœ‹åˆ°ä¸åŒå€¼
- **åŸå› **: æ¯æ¬¡è¯­å¥è·å–æ–°å¿«ç…§
- **å½¢å¼åŒ–**: $\exists r_i(x, t_1), r_i(x, t_2): \text{Value}(r_i(x, t_1)) \neq \text{Value}(r_i(x, t_2))$

**å±æ€§3: å…è®¸å¹»è¯» (Phantom Read Allowed)**:

- **å®šä¹‰**: åŒä¸€äº‹åŠ¡ä¸­ä¸¤æ¬¡æ‰§è¡Œç›¸åŒæŸ¥è¯¢å¯èƒ½è¿”å›ä¸åŒçš„è¡Œé›†åˆ
- **åŸå› **: æ¯æ¬¡è¯­å¥è·å–æ–°å¿«ç…§ï¼Œæ–°æ’å…¥çš„è¡Œå¯è§
- **å½¢å¼åŒ–**: $\exists Q_i(t_1), Q_i(t_2): \text{Result}(Q_i(t_1)) \neq \text{Result}(Q_i(t_2))$

**å±æ€§4: è¯­å¥çº§å¿«ç…§ (Statement-level Snapshot)**:

- **å®šä¹‰**: æ¯ä¸ªSQLè¯­å¥å¼€å§‹æ—¶è·å–ä¸€ä¸ªæ–°çš„å¿«ç…§
- **å½±å“**: å…è®¸åœ¨äº‹åŠ¡å†…éƒ¨çœ‹åˆ°å…¶ä»–äº‹åŠ¡çš„æäº¤
- **PostgreSQLç‰¹æ€§**: é»˜è®¤å®ç°æ–¹å¼

---

### 4.2 ä¸å…¶ä»–æ¦‚å¿µçš„å…³ç³»

**å…³ç³»1: ä¸éš”ç¦»çº§åˆ«å±‚æ¬¡çš„å…³ç³»**:

```text
éš”ç¦»çº§åˆ«å±‚æ¬¡:

Read Uncommitted
    â†‘ (æ›´å¼±ï¼Œå…è®¸è„è¯»)
    â”‚
Read Committed  â† å½“å‰æ¦‚å¿µ
    â†‘ (æ›´å¼ºï¼Œé˜²æ­¢è„è¯»)
    â”‚
Repeatable Read
    â†‘ (æ›´å¼ºï¼Œé˜²æ­¢ä¸å¯é‡å¤è¯»)
    â”‚
Serializable
    â†‘ (æœ€å¼ºï¼Œå®Œå…¨ä¸²è¡ŒåŒ–)
```

**å…³ç³»2: ä¸ACIDç‰¹æ€§çš„å…³ç³»**:

- **éš”ç¦»æ€§ (Isolation)**: Read Committedæ˜¯éš”ç¦»æ€§çš„ä¸€ä¸ªå…·ä½“å®ç°çº§åˆ«
- **ä¸€è‡´æ€§ (Consistency)**: Read Committedä¿è¯åŸºæœ¬çš„ä¸€è‡´æ€§ï¼ˆé˜²æ­¢è„è¯»ï¼‰
- **åŸå­æ€§ (Atomicity)**: Read Committedä¾èµ–åŸå­æ€§ï¼ˆæœªæäº¤çš„æ•°æ®ä¸å¯è§ï¼‰
- **æŒä¹…æ€§ (Durability)**: Read Committedä¾èµ–æŒä¹…æ€§ï¼ˆå·²æäº¤çš„æ•°æ®æŒä¹…åŒ–ï¼‰

**å…³ç³»3: ä¸MVCCçš„å…³ç³»**:

- **å®ç°æœºåˆ¶**: Read Committedé€šè¿‡MVCCå®ç°
- **ç‰ˆæœ¬æ§åˆ¶**: ä½¿ç”¨å¤šç‰ˆæœ¬æ§åˆ¶æ¥æä¾›å¿«ç…§
- **å¯è§æ€§**: åŸºäºç‰ˆæœ¬æ—¶é—´æˆ³åˆ¤æ–­å¯è§æ€§

**å…³ç³»4: ä¸å¯è§æ€§çš„å…³ç³»**:

- **å¯è§æ€§å®šä¹‰**: Read Committedå®šä¹‰äº†ç‰¹å®šçš„å¯è§æ€§è§„åˆ™
- **å¯è§æ€§å®ç°**: é€šè¿‡å¿«ç…§æ—¶é—´æˆ³å’Œç‰ˆæœ¬æ ‡è¯†å®ç°

---

### 4.3 è·¨å±‚æ˜ å°„ï¼ˆLSEMï¼‰

**LSEMä¸‰å±‚æ˜ å°„**:

**L0å±‚ (å­˜å‚¨å±‚ - PostgreSQL)**:

```text
Read Committedåœ¨L0å±‚çš„æ˜ å°„:

æ¦‚å¿µ: Read Committedéš”ç¦»çº§åˆ«
  â†“
å®ç°: MVCCæœºåˆ¶
  â†“
æœºåˆ¶: å¿«ç…§éš”ç¦» (Snapshot Isolation)
  â†“
æ•°æ®ç»“æ„:
  - xmin/xmax (äº‹åŠ¡ID)
  - ç‰ˆæœ¬é“¾ (Version Chain)
  - å¿«ç…§ (Snapshot)
```

**L1å±‚ (è¿è¡Œæ—¶å±‚ - ç¼–ç¨‹è¯­è¨€)**:

```text
Read Committedåœ¨L1å±‚çš„å¯¹åº”:

æ¦‚å¿µ: è¯»å–ä¸€è‡´æ€§
  â†“
å®ç°: å†…å­˜å¯è§æ€§æ§åˆ¶
  â†“
æœºåˆ¶: happens-beforeå…³ç³»
  â†“
æ•°æ®ç»“æ„:
  - å†…å­˜å±éšœ (Memory Barrier)
  - åŸå­æ“ä½œ (Atomic Operations)
```

**L2å±‚ (åˆ†å¸ƒå¼å±‚)**:

```text
Read Committedåœ¨L2å±‚çš„å¯¹åº”:

æ¦‚å¿µ: åˆ†å¸ƒå¼å¿«ç…§
  â†“
å®ç°: æ—¶é’ŸåŒæ­¥ (HLC, TrueTime)
  â†“
æœºåˆ¶: å…¨å±€å¿«ç…§æ—¶é—´æˆ³
  â†“
æ•°æ®ç»“æ„:
  - æ··åˆé€»è¾‘æ—¶é’Ÿ (HLC)
  - å…¨å±€æ—¶é—´æˆ³
```

**ç»Ÿä¸€æŠ½è±¡**:

```text
LSEMç»Ÿä¸€æŠ½è±¡:

å¯è§æ€§æ§åˆ¶ = {
  L0: Read Committed (å¿«ç…§éš”ç¦»)
  L1: å†…å­˜å¯è§æ€§ (happens-before)
  L2: åˆ†å¸ƒå¼å¿«ç…§ (å…¨å±€æ—¶é—´æˆ³)
}
```

---

## äº”ã€å¼‚å¸¸ç°è±¡åˆ†æ

### 5.1 å¯èƒ½å‘ç”Ÿçš„å¼‚å¸¸

**Read Committedçº§åˆ«ä¸‹å¯èƒ½å‘ç”Ÿçš„å¼‚å¸¸**:

æ ¹æ®ANSI SQLæ ‡å‡†å’ŒAdyaæ¡†æ¶ï¼š

| å¼‚å¸¸ç±»å‹ | ä»£ç  | Read Committed | è¯´æ˜ |
|---------|------|---------------|------|
| **è„å†™** | P0 / G0 | âœ… ç¦æ­¢ | åŸºæœ¬ä¿è¯ |
| **è„è¯»** | P1 / G1a | âœ… ç¦æ­¢ | æ ¸å¿ƒä¿è¯ |
| **ä¸å¯é‡å¤è¯»** | P2 / G1b | âŒ å…è®¸ | å¯èƒ½å‘ç”Ÿ |
| **å¹»è¯»** | P3 / G1c | âŒ å…è®¸ | å¯èƒ½å‘ç”Ÿ |
| **å†™åæ–œ** | A5A | âŒ å…è®¸ | å¯èƒ½å‘ç”Ÿ |
| **åªè¯»å¼‚å¸¸** | A5B | âŒ å…è®¸ | å¯èƒ½å‘ç”Ÿ |

**å…³é”®å¼‚å¸¸è¯¦è§£**:

#### å¼‚å¸¸1: ä¸å¯é‡å¤è¯» (Non-repeatable Read / P2)

**å®šä¹‰**: åŒä¸€äº‹åŠ¡ä¸­ä¸¤æ¬¡è¯»å–åŒä¸€æ•°æ®é¡¹ï¼Œçœ‹åˆ°ä¸åŒçš„å€¼ã€‚

**ç¤ºä¾‹**:

```sql
-- äº‹åŠ¡T1
BEGIN;
SELECT balance FROM accounts WHERE id = 1;
-- ç»“æœ: 1000

-- äº‹åŠ¡T2 (å¹¶å‘)
BEGIN;
UPDATE accounts SET balance = 900 WHERE id = 1;
COMMIT;

-- äº‹åŠ¡T1ç»§ç»­
SELECT balance FROM accounts WHERE id = 1;
-- ç»“æœ: 900 (ä¸åŒäº†ï¼)
COMMIT;
```

**ä¸ºä»€ä¹ˆRead Committedå…è®¸ï¼Ÿ**

- Read Committedåªä¿è¯æ¯æ¬¡è¯»å–çœ‹åˆ°å·²æäº¤çš„æ•°æ®
- ä¸ä¿è¯åŒä¸€äº‹åŠ¡ä¸­å¤šæ¬¡è¯»å–çœ‹åˆ°ç›¸åŒçš„æ•°æ®
- å› ä¸ºæ¯æ¬¡è¯­å¥è·å–æ–°å¿«ç…§

#### å¼‚å¸¸2: å¹»è¯» (Phantom Read / P3)

**å®šä¹‰**: åŒä¸€äº‹åŠ¡ä¸­ä¸¤æ¬¡æ‰§è¡Œç›¸åŒæŸ¥è¯¢ï¼Œè¿”å›ä¸åŒçš„è¡Œé›†åˆã€‚

**ç¤ºä¾‹**:

```sql
-- äº‹åŠ¡T1
BEGIN;
SELECT COUNT(*) FROM orders WHERE status = 'pending';
-- ç»“æœ: 10

-- äº‹åŠ¡T2 (å¹¶å‘)
BEGIN;
INSERT INTO orders (id, status) VALUES (11, 'pending');
COMMIT;

-- äº‹åŠ¡T1ç»§ç»­
SELECT COUNT(*) FROM orders WHERE status = 'pending';
-- ç»“æœ: 11 (å¤šäº†1è¡Œï¼)
COMMIT;
```

**ä¸ºä»€ä¹ˆRead Committedå…è®¸ï¼Ÿ**

- Read Committedä¸ä¿è¯æŸ¥è¯¢ç»“æœçš„ä¸€è‡´æ€§
- æ–°æ’å…¥çš„è¡Œåœ¨æäº¤åç«‹å³å¯¹æ‰€æœ‰äº‹åŠ¡å¯è§
- å› ä¸ºæ¯æ¬¡è¯­å¥è·å–æ–°å¿«ç…§

---

### 5.2 å¼‚å¸¸æ¡ä»¶

**ä¸å¯é‡å¤è¯»çš„å‘ç”Ÿæ¡ä»¶**:

1. **å¿…è¦æ¡ä»¶**:
   - ä¸¤ä¸ªå¹¶å‘äº‹åŠ¡
   - äº‹åŠ¡T1è¯»å–æ•°æ®é¡¹x
   - äº‹åŠ¡T2å†™å…¥å¹¶æäº¤x
   - äº‹åŠ¡T1å†æ¬¡è¯»å–x

2. **å……åˆ†æ¡ä»¶**:
   - ä½¿ç”¨Read Committedéš”ç¦»çº§åˆ«
   - äº‹åŠ¡T2åœ¨T1ä¸¤æ¬¡è¯»å–ä¹‹é—´æäº¤

**æ•°å­¦è¡¨è¾¾**:

$$
\text{NonRepeatableRead}(S) \iff \\
  \exists T_1, T_2, x: \\
    r_1(x, t_1) \in S \land \\
    w_2(x) \in S \land c_2 \in S \land \\
    t_1 < c_2 < r_1(x, t_2) \land \\
    \text{Value}(r_1(x, t_1)) \neq \text{Value}(r_1(x, t_2))
$$

**å¹»è¯»çš„å‘ç”Ÿæ¡ä»¶**:

1. **å¿…è¦æ¡ä»¶**:
   - ä¸¤ä¸ªå¹¶å‘äº‹åŠ¡
   - äº‹åŠ¡T1æ‰§è¡ŒèŒƒå›´æŸ¥è¯¢
   - äº‹åŠ¡T2æ’å…¥æ»¡è¶³æŸ¥è¯¢æ¡ä»¶çš„æ–°è¡Œå¹¶æäº¤
   - äº‹åŠ¡T1å†æ¬¡æ‰§è¡Œç›¸åŒæŸ¥è¯¢

2. **å……åˆ†æ¡ä»¶**:
   - ä½¿ç”¨Read Committedéš”ç¦»çº§åˆ«
   - æ–°æ’å…¥çš„è¡Œæ»¡è¶³æŸ¥è¯¢æ¡ä»¶

---

### 5.3 å¼‚å¸¸ç¤ºä¾‹

**ç¤ºä¾‹1: é“¶è¡Œè´¦æˆ·ä½™é¢æŸ¥è¯¢**

```sql
-- åœºæ™¯: ç”¨æˆ·æŸ¥è¯¢è´¦æˆ·ä½™é¢ï¼Œç„¶ååŸºäºä½™é¢åšå†³ç­–

-- æ—¶é—´ç‚¹1: T1æŸ¥è¯¢ä½™é¢
T1: BEGIN;
T1: SELECT balance FROM accounts WHERE id = 1;
    -- ç»“æœ: balance = 1000
    -- ç”¨æˆ·çœ‹åˆ°: "æ‚¨çš„ä½™é¢æ˜¯1000å…ƒ"

-- æ—¶é—´ç‚¹2: T2æ‰£æ¬¾
T2: BEGIN;
T2: UPDATE accounts SET balance = balance - 500 WHERE id = 1;
T2: COMMIT;
    -- ä½™é¢å˜ä¸º: 500

-- æ—¶é—´ç‚¹3: T1å†æ¬¡æŸ¥è¯¢
T1: SELECT balance FROM accounts WHERE id = 1;
    -- ç»“æœ: balance = 500 (å˜äº†ï¼)
    -- ç”¨æˆ·å›°æƒ‘: "ä¸ºä»€ä¹ˆä½™é¢å˜äº†ï¼Ÿ"

T1: COMMIT;
```

**é—®é¢˜**: ç”¨æˆ·åœ¨åŒä¸€ä¸ª"æŸ¥è¯¢ä¼šè¯"ä¸­çœ‹åˆ°ä½™é¢å˜åŒ–ï¼Œå¯èƒ½é€ æˆå›°æƒ‘ã€‚

**ç¤ºä¾‹2: åº“å­˜æ£€æŸ¥**

```sql
-- åœºæ™¯: æ£€æŸ¥åº“å­˜ï¼Œç„¶åå†³å®šæ˜¯å¦ä¸‹å•

-- æ—¶é—´ç‚¹1: T1æ£€æŸ¥åº“å­˜
T1: BEGIN;
T1: SELECT quantity FROM inventory WHERE product_id = 100;
    -- ç»“æœ: quantity = 5
    -- åˆ¤æ–­: æœ‰åº“å­˜ï¼Œå¯ä»¥ä¸‹å•

-- æ—¶é—´ç‚¹2: T2æ‰£å‡åº“å­˜
T2: BEGIN;
T2: UPDATE inventory SET quantity = quantity - 5 WHERE product_id = 100;
T2: COMMIT;
    -- åº“å­˜å˜ä¸º: 0

-- æ—¶é—´ç‚¹3: T1ä¸‹å•
T1: INSERT INTO orders (product_id, quantity) VALUES (100, 3);
    -- åŸºäºè¿‡æœŸçš„åº“å­˜ä¿¡æ¯ä¸‹å•ï¼

T1: COMMIT;
```

**é—®é¢˜**: åŸºäºè¿‡æœŸçš„åº“å­˜ä¿¡æ¯åšå†³ç­–ï¼Œå¯èƒ½å¯¼è‡´è¶…å–ã€‚

---

### 5.4 å¦‚ä½•é¿å…

**é¿å…ä¸å¯é‡å¤è¯»**:

1. **å‡çº§éš”ç¦»çº§åˆ«**: ä½¿ç”¨Repeatable Readæˆ–Serializable
2. **åº”ç”¨å±‚å¤„ç†**: åœ¨åº”ç”¨å±‚ç¼“å­˜ç¬¬ä¸€æ¬¡è¯»å–çš„å€¼
3. **ä½¿ç”¨é”**: ä½¿ç”¨SELECT ... FOR UPDATEé”å®šæ•°æ®

**é¿å…å¹»è¯»**:

1. **å‡çº§éš”ç¦»çº§åˆ«**: ä½¿ç”¨Serializable
2. **ä½¿ç”¨èŒƒå›´é”**: ä½¿ç”¨SELECT ... FOR UPDATEé”å®šèŒƒå›´
3. **é‡æ–°è®¾è®¡**: é¿å…ä¾èµ–ç²¾ç¡®çš„è¡Œæ•°

**æœ€ä½³å®è·µ**:

- **çŸ­äº‹åŠ¡**: å‡å°‘äº‹åŠ¡æŒç»­æ—¶é—´ï¼Œé™ä½å¼‚å¸¸å‘ç”Ÿæ¦‚ç‡
- **æ˜ç¡®éœ€æ±‚**: æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„éš”ç¦»çº§åˆ«
- **æµ‹è¯•éªŒè¯**: åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯å¹¶å‘åœºæ™¯ä¸‹çš„è¡Œä¸º

---

## å…­ã€åä¾‹ä¸é”™è¯¯ä½¿ç”¨

### åä¾‹1: é”™è¯¯ä½¿ç”¨Read Committedè¿›è¡Œè´¢åŠ¡è®¡ç®—

**é”™è¯¯åœºæ™¯**:

```sql
-- é”™è¯¯: åœ¨Read Committedä¸‹è¿›è¡Œå¤šæ¬¡è¯»å–çš„è´¢åŠ¡è®¡ç®—

BEGIN;  -- Read Committed (é»˜è®¤)

-- è¯»å–è´¦æˆ·Aä½™é¢
SELECT balance FROM accounts WHERE id = 'A';
-- å‡è®¾è¿”å›: 1000

-- è¯»å–è´¦æˆ·Bä½™é¢
SELECT balance FROM accounts WHERE id = 'B';
-- å‡è®¾è¿”å›: 2000

-- è®¡ç®—æ€»ä½™é¢
-- åº”ç”¨å±‚: total = 1000 + 2000 = 3000

-- ä½†æ˜¯ï¼åœ¨ä¸¤æ¬¡SELECTä¹‹é—´ï¼Œå…¶ä»–äº‹åŠ¡å¯èƒ½å·²ç»ä¿®æ”¹äº†ä½™é¢
-- å¦‚æœè´¦æˆ·Aåœ¨ç¬¬ä¸€æ¬¡SELECTåè¢«æ‰£æ¬¾500ï¼Œå®é™…æ€»ä½™é¢åº”è¯¥æ˜¯2500
-- ä½†åº”ç”¨å±‚è®¡ç®—çš„æ˜¯3000ï¼Œè¿™æ˜¯é”™è¯¯çš„ï¼

COMMIT;
```

**é—®é¢˜åˆ†æ**:

1. **æ ¹æœ¬åŸå› **: Read Committedä¸ä¿è¯å¯é‡å¤è¯»
2. **åæœ**: è®¡ç®—ç»“æœåŸºäºä¸ä¸€è‡´çš„æ•°æ®å¿«ç…§
3. **å½±å“**: è´¢åŠ¡æ•°æ®ä¸å‡†ç¡®ï¼Œå¯èƒ½å¯¼è‡´ä¸¥é‡åæœ

**æ­£ç¡®åšæ³•**:

```sql
-- æ–¹æ³•1: ä½¿ç”¨æ›´é«˜çš„éš”ç¦»çº§åˆ«
BEGIN ISOLATION LEVEL REPEATABLE READ;
SELECT balance FROM accounts WHERE id = 'A';
SELECT balance FROM accounts WHERE id = 'B';
-- ç°åœ¨ä¸¤æ¬¡è¯»å–çœ‹åˆ°ç›¸åŒçš„æ•°æ®
COMMIT;

-- æ–¹æ³•2: ä½¿ç”¨å•æ¡SQL
SELECT SUM(balance) FROM accounts WHERE id IN ('A', 'B');
-- åŸå­æ“ä½œï¼Œä¿è¯ä¸€è‡´æ€§
```

---

### åä¾‹2: è¯¯ä»¥ä¸ºRead Committedé˜²æ­¢å¹»è¯»

**é”™è¯¯ç†è§£**:

```sql
-- é”™è¯¯: ä»¥ä¸ºRead Committedå¯ä»¥é˜²æ­¢å¹»è¯»

BEGIN;  -- Read Committed

-- æ£€æŸ¥æ˜¯å¦æœ‰æœªå¤„ç†çš„è®¢å•
SELECT COUNT(*) FROM orders WHERE status = 'pending';
-- ç»“æœ: 0

-- åŸºäº"æ²¡æœ‰æœªå¤„ç†è®¢å•"çš„åˆ¤æ–­ï¼Œè¿›è¡Œå…¶ä»–æ“ä½œ
-- ...

-- ä½†æ˜¯ï¼åœ¨æ£€æŸ¥ä¹‹åï¼Œå…¶ä»–äº‹åŠ¡å¯èƒ½æ’å…¥äº†æ–°è®¢å•
-- å¯¼è‡´åˆ¤æ–­é”™è¯¯

COMMIT;
```

**é—®é¢˜åˆ†æ**:

1. **é”™è¯¯å‡è®¾**: è®¤ä¸ºRead Committedå¯ä»¥é˜²æ­¢å¹»è¯»
2. **å®é™…æƒ…å†µ**: Read Committedå…è®¸å¹»è¯»
3. **åæœ**: åŸºäºé”™è¯¯çš„å‡è®¾åšå‡ºå†³ç­–

**æ­£ç¡®ç†è§£**:

- Read Committed **åªé˜²æ­¢è„è¯»**
- Read Committed **ä¸é˜²æ­¢å¹»è¯»**
- å¦‚æœéœ€è¦é˜²æ­¢å¹»è¯»ï¼Œå¿…é¡»ä½¿ç”¨Serializableçº§åˆ«

---

### åä¾‹3: åœ¨Read Committedä¸‹ä½¿ç”¨åº”ç”¨å±‚é”

**é”™è¯¯åœºæ™¯**:

```sql
-- é”™è¯¯: è¯•å›¾é€šè¿‡åº”ç”¨å±‚é€»è¾‘å®ç°å¯é‡å¤è¯»

-- åº”ç”¨ä»£ç  (ä¼ªä»£ç )
function transfer(from, to, amount) {
    db.begin();

    // è¯»å–è´¦æˆ·Aä½™é¢
    balanceA = db.query("SELECT balance FROM accounts WHERE id = ?", from);

    // è¯»å–è´¦æˆ·Bä½™é¢
    balanceB = db.query("SELECT balance FROM accounts WHERE id = ?", to);

    // æ£€æŸ¥ä½™é¢
    if (balanceA < amount) {
        db.rollback();
        return "ä½™é¢ä¸è¶³";
    }

    // æ›´æ–°è´¦æˆ·A
    db.execute("UPDATE accounts SET balance = balance - ? WHERE id = ?",
               amount, from);

    // æ›´æ–°è´¦æˆ·B
    db.execute("UPDATE accounts SET balance = balance + ? WHERE id = ?",
               amount, to);

    db.commit();
}
```

**é—®é¢˜åˆ†æ**:

1. **å¹¶å‘é—®é¢˜**: åœ¨è¯»å–ä½™é¢å’Œæ›´æ–°ä¹‹é—´ï¼Œå…¶ä»–äº‹åŠ¡å¯èƒ½å·²ç»ä¿®æ”¹äº†ä½™é¢
2. **ç«æ€æ¡ä»¶**: ä¸¤ä¸ªäº‹åŠ¡å¯èƒ½åŒæ—¶é€šè¿‡ä½™é¢æ£€æŸ¥
3. **æ•°æ®ä¸ä¸€è‡´**: å¯èƒ½å¯¼è‡´ä½™é¢ä¸ºè´Ÿæˆ–æ€»é¢ä¸å®ˆæ’

**æ­£ç¡®åšæ³•**:

```sql
-- ä½¿ç”¨æ•°æ®åº“é”
BEGIN;
SELECT balance FROM accounts WHERE id = ? FOR UPDATE;
-- é”å®šè¡Œï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡ä¿®æ”¹
UPDATE accounts SET balance = balance - ? WHERE id = ?;
COMMIT;
```

---

## ä¸ƒã€æ­£ç¡®ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: Webåº”ç”¨çš„å…¸å‹ä½¿ç”¨

**åœºæ™¯**: ç”¨æˆ·æŸ¥çœ‹æ–‡ç« åˆ—è¡¨ï¼Œç„¶åæŸ¥çœ‹æ–‡ç« è¯¦æƒ…

```sql
-- æ­£ç¡®çš„Read Committedä½¿ç”¨

-- è¯·æ±‚1: è·å–æ–‡ç« åˆ—è¡¨
BEGIN;
SELECT id, title, author, created_at
FROM articles
ORDER BY created_at DESC
LIMIT 10;
-- çœ‹åˆ°æœ€æ–°çš„10ç¯‡æ–‡ç« 
COMMIT;

-- è¯·æ±‚2: æŸ¥çœ‹æ–‡ç« è¯¦æƒ…ï¼ˆæ–°çš„äº‹åŠ¡ï¼‰
BEGIN;
SELECT id, title, content, author, created_at
FROM articles
WHERE id = ?;
-- å³ä½¿æ–‡ç« åœ¨è¯·æ±‚1å’Œè¯·æ±‚2ä¹‹é—´è¢«ä¿®æ”¹ï¼Œä¹Ÿæ˜¯æ­£å¸¸çš„
-- ç”¨æˆ·çœ‹åˆ°æœ€æ–°ç‰ˆæœ¬çš„æ–‡ç« æ˜¯åˆç†çš„
COMMIT;
```

**ä¸ºä»€ä¹ˆé€‚åˆRead Committed**:

- æ¯ä¸ªHTTPè¯·æ±‚æ˜¯ç‹¬ç«‹çš„äº‹åŠ¡
- çœ‹åˆ°æœ€æ–°æ•°æ®æ˜¯åˆç†çš„
- ä¸éœ€è¦å¯é‡å¤è¯»

---

### ç¤ºä¾‹2: æ—¥å¿—è®°å½•

**åœºæ™¯**: è®°å½•æ“ä½œæ—¥å¿—

```sql
-- æ­£ç¡®çš„Read Committedä½¿ç”¨

BEGIN;
INSERT INTO operation_log (user_id, action, timestamp)
VALUES (?, 'login', NOW());
COMMIT;

-- å…¶ä»–äº‹åŠ¡å¯ä»¥ç«‹å³çœ‹åˆ°è¿™æ¡æ—¥å¿—
-- è¿™æ˜¯åˆç†çš„ï¼Œå› ä¸ºæ—¥å¿—é€šå¸¸æ˜¯è¿½åŠ å¼çš„
```

**ä¸ºä»€ä¹ˆé€‚åˆRead Committed**:

- æ—¥å¿—è®°å½•æ˜¯è¿½åŠ æ“ä½œ
- ä¸éœ€è¦å¯é‡å¤è¯»
- é«˜å¹¶å‘æ€§èƒ½é‡è¦

---

### ç¤ºä¾‹3: å®æ—¶æ•°æ®å±•ç¤º

**åœºæ™¯**: å®æ—¶æ˜¾ç¤ºåœ¨çº¿ç”¨æˆ·æ•°

```sql
-- æ­£ç¡®çš„Read Committedä½¿ç”¨

-- æ¯æ¬¡åˆ·æ–°éƒ½è·å–æœ€æ–°æ•°æ®
SELECT COUNT(*) FROM users WHERE last_active > NOW() - INTERVAL '5 minutes';
-- çœ‹åˆ°å®æ—¶å˜åŒ–çš„åœ¨çº¿ç”¨æˆ·æ•°æ˜¯åˆç†çš„
```

**ä¸ºä»€ä¹ˆé€‚åˆRead Committed**:

- å®æ—¶æ€§æ¯”ä¸€è‡´æ€§æ›´é‡è¦
- æ•°æ®å˜åŒ–æ˜¯é¢„æœŸçš„
- é«˜å¹¶å‘è¯»å–æ€§èƒ½é‡è¦

---

## å…«ã€æ€§èƒ½å½±å“åˆ†æ

### 8.1 æ€§èƒ½ç‰¹å¾

**Read Committedçš„æ€§èƒ½ç‰¹å¾**:

| æ€§èƒ½æŒ‡æ ‡ | Read Committed | è¯´æ˜ |
|---------|---------------|------|
| **è¯»æ€§èƒ½** | â­â­â­â­â­ ä¼˜ç§€ | æ— é”è¯»å–ï¼Œæ— é˜»å¡ |
| **å†™æ€§èƒ½** | â­â­â­â­ è‰¯å¥½ | éœ€è¦å¤„ç†ç‰ˆæœ¬å†²çª |
| **å¹¶å‘åº¦** | â­â­â­â­â­ å¾ˆé«˜ | è¯»æ“ä½œä¸é˜»å¡ |
| **å­˜å‚¨å¼€é”€** | â­â­â­ ä¸­ç­‰ | éœ€è¦å­˜å‚¨å¤šä¸ªç‰ˆæœ¬ |
| **CPUå¼€é”€** | â­â­â­â­ è¾ƒä½ | å¿«ç…§ç®¡ç†å¼€é”€å° |

**é‡åŒ–æ•°æ®** (PostgreSQLåŸºå‡†æµ‹è¯•):

```text
æµ‹è¯•ç¯å¢ƒ: PostgreSQL 15, 100å¹¶å‘è¿æ¥, TPC-BåŸºå‡†

éš”ç¦»çº§åˆ«å¯¹æ¯”:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éš”ç¦»çº§åˆ«         â”‚ TPS      â”‚ P50å»¶è¿Ÿ  â”‚ P99å»¶è¿Ÿ  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Read Committed  â”‚ 15,234   â”‚ 10ms     â”‚ 25ms     â”‚
â”‚ Repeatable Read â”‚ 12,891   â”‚ 12ms     â”‚ 35ms     â”‚
â”‚ Serializable    â”‚ 10,567   â”‚ 18ms     â”‚ 65ms     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ€§èƒ½ä¼˜åŠ¿:
- æ¯”Repeatable Readå¿« 18%
- æ¯”Serializableå¿« 44%
```

---

### 8.2 å½±å“å› ç´ 

**å½±å“Read Committedæ€§èƒ½çš„å› ç´ **:

1. **å¿«ç…§ç®¡ç†å¼€é”€**
   - æ¯ä¸ªè¯­å¥éœ€è¦è·å–æ–°å¿«ç…§
   - å¿«ç…§åŒ…å«æ´»è·ƒäº‹åŠ¡åˆ—è¡¨
   - å¼€é”€: çº¦1-2% CPU

2. **ç‰ˆæœ¬é“¾é•¿åº¦**
   - é•¿äº‹åŠ¡å¯¼è‡´ç‰ˆæœ¬é“¾å¢é•¿
   - å¯è§æ€§åˆ¤æ–­å˜æ…¢
   - å½±å“: P99å»¶è¿Ÿå¯èƒ½å¢åŠ 

3. **å†²çªæ£€æµ‹**
   - å†™æ“ä½œéœ€è¦æ£€æµ‹ç‰ˆæœ¬å†²çª
   - å†²çªç‡é«˜æ—¶æ€§èƒ½ä¸‹é™
   - å½±å“: å†™æ€§èƒ½ä¸‹é™

4. **VACUUMé¢‘ç‡**
   - éœ€è¦å®šæœŸæ¸…ç†æ—§ç‰ˆæœ¬
   - VACUUMå¯èƒ½å½±å“æ€§èƒ½
   - å½±å“: å‘¨æœŸæ€§æ€§èƒ½æ³¢åŠ¨

---

### 8.3 ä¼˜åŒ–å»ºè®®

**ä¼˜åŒ–1: æ§åˆ¶äº‹åŠ¡é•¿åº¦**

```sql
-- ä¸å¥½: é•¿äº‹åŠ¡
BEGIN;
-- ... å¤§é‡æ“ä½œ ...
SELECT ...;  -- å¿«ç…§å¯èƒ½åŒ…å«å¾ˆå¤šæ´»è·ƒäº‹åŠ¡
-- ... æ›´å¤šæ“ä½œ ...
COMMIT;

-- å¥½: çŸ­äº‹åŠ¡
BEGIN;
SELECT ...;  -- å¿«ç…§å°ï¼Œåˆ¤æ–­å¿«
COMMIT;

BEGIN;
UPDATE ...;  -- å•ç‹¬çš„äº‹åŠ¡
COMMIT;
```

**ä¼˜åŒ–2: åˆç†ä½¿ç”¨ç´¢å¼•**

```sql
-- ç´¢å¼•å¯ä»¥åŠ é€Ÿå¯è§æ€§åˆ¤æ–­
CREATE INDEX idx_accounts_id ON accounts(id);
-- åŠ é€ŸåŸºäºIDçš„æŸ¥è¯¢
```

**ä¼˜åŒ–3: ç›‘æ§VACUUM**

```sql
-- ç›‘æ§è¡¨è†¨èƒ€
SELECT
    schemaname,
    tablename,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS size
FROM pg_tables
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;

-- å®šæœŸè¿è¡ŒVACUUM
VACUUM ANALYZE accounts;
```

---

## ä¹ã€å…³è”æ¦‚å¿µå›¾è°±

```mermaid
graph TB
    RC[Read Committed] --> MVCC[MVCCæœºåˆ¶]
    RC --> SI[å¿«ç…§éš”ç¦»]
    RC --> Visibility[å¯è§æ€§æ§åˆ¶]

    MVCC --> Version[ç‰ˆæœ¬é“¾]
    MVCC --> Snapshot[å¿«ç…§]
    MVCC --> xmin[xmin/xmax]

    SI --> Snapshot
    SI --> Isolation[éš”ç¦»çº§åˆ«]

    Visibility --> Snapshot
    Visibility --> Commit[æäº¤é¡ºåº]

    Isolation --> RU[Read Uncommitted]
    Isolation --> RR[Repeatable Read]
    Isolation --> Ser[Serializable]

    RC --> DR[Dirty Read]
    RC --> NRR[Non-repeatable Read]
    RC --> PR[Phantom Read]

    DR -.ç¦æ­¢.-> RC
    NRR -.å…è®¸.-> RC
    PR -.å…è®¸.-> RC

    style RC fill:#e1f5ff
    style MVCC fill:#fff4e1
    style SI fill:#fff4e1
    style Visibility fill:#fff4e1
```

---

## åã€æ¨ç†æ ‘

```text
Read Committedæ¨ç†æ ‘:

é—®é¢˜: å¦‚ä½•é˜²æ­¢è„è¯»ï¼Ÿ
  â”‚
  â”œâ”€â†’ æ–¹æ¡ˆ1: ä½¿ç”¨é”
  â”‚     â”œâ”€â†’ è¯»é” + å†™é”
  â”‚     â”œâ”€â†’ é—®é¢˜: è¯»æ“ä½œé˜»å¡å†™æ“ä½œ
  â”‚     â””â”€â†’ ç»“è®º: æ€§èƒ½å·® âŒ
  â”‚
  â”œâ”€â†’ æ–¹æ¡ˆ2: ä½¿ç”¨MVCC
  â”‚     â”œâ”€â†’ å¤šç‰ˆæœ¬å­˜å‚¨
  â”‚     â”œâ”€â†’ å¿«ç…§è¯»å–
  â”‚     â”œâ”€â†’ ä¼˜åŠ¿: è¯»ä¸é˜»å¡å†™ âœ…
  â”‚     â””â”€â†’ ç»“è®º: æ€§èƒ½å¥½ âœ…
  â”‚
  â””â”€â†’ æ–¹æ¡ˆ3: æ··åˆæ–¹æ¡ˆ
        â”œâ”€â†’ MVCC + è½»é‡çº§é”
        â”œâ”€â†’ å¹³è¡¡æ€§èƒ½å’Œæ­£ç¡®æ€§
        â””â”€â†’ ç»“è®º: å®ç”¨æ–¹æ¡ˆ âœ…

å®ç°: PostgreSQLé€‰æ‹©æ–¹æ¡ˆ2 (MVCC)
  â”‚
  â”œâ”€â†’ æœºåˆ¶: è¯­å¥çº§å¿«ç…§
  â”‚     â”œâ”€â†’ æ¯ä¸ªè¯­å¥è·å–æ–°å¿«ç…§
  â”‚     â”œâ”€â†’ åªçœ‹åˆ°å·²æäº¤çš„æ•°æ®
  â”‚     â””â”€â†’ ä¿è¯: é˜²æ­¢è„è¯» âœ…
  â”‚
  â””â”€â†’ æƒè¡¡: å…è®¸ä¸å¯é‡å¤è¯»
        â”œâ”€â†’ æ¯æ¬¡è¯­å¥çœ‹åˆ°æœ€æ–°æ•°æ®
        â”œâ”€â†’ åŒä¸€äº‹åŠ¡ä¸­å¯èƒ½çœ‹åˆ°ä¸åŒå€¼
        â””â”€â†’ ç»“æœ: æ€§èƒ½ä¼˜å…ˆ âœ…
```

---

## åä¸€ã€è¯æ˜æ ‘

**å®šç†**: Read Committedçº§åˆ«ä¸‹ï¼Œä¸ä¼šå‘ç”Ÿè„è¯»ã€‚

```text
è¯æ˜æ ‘:

å®šç†: Read Committed âŸ¹ Â¬DirtyRead
  â”‚
  â”œâ”€â†’ å®šä¹‰: DirtyRead = âˆƒr_i(x) sees w_j(x) where c_j not committed before r_i
  â”‚
  â”œâ”€â†’ å®šä¹‰: ReadCommitted = âˆ€r_i(x): visible(x, r_i) âŠ† {w_j(x) | c_j < r_i}
  â”‚
  â”œâ”€â†’ å‡è®¾: å­˜åœ¨è„è¯»
  â”‚     â”‚
  â”‚     â”œâ”€â†’ å­˜åœ¨ r_i(x) çœ‹åˆ° w_j(x)
  â”‚     â”‚
  â”‚     â””â”€â†’ ä¸” c_j åœ¨ r_i ä¹‹å (æœªæäº¤)
  â”‚
  â”œâ”€â†’ çŸ›ç›¾:
  â”‚     â”‚
  â”‚     â”œâ”€â†’ ReadCommittedå®šä¹‰è¦æ±‚: c_j < r_i
  â”‚     â”‚
  â”‚     â””â”€â†’ ä½†è„è¯»å‡è®¾: c_j > r_i
  â”‚
  â””â”€â†’ ç»“è®º: å‡è®¾é”™è¯¯ï¼Œä¸å¯èƒ½å­˜åœ¨è„è¯» âœ…

å½¢å¼åŒ–è¯æ˜:

1. å®šä¹‰è„è¯»:
   DirtyRead(S) âŸº âˆƒT_i, T_j, x:
     r_i(x) sees w_j(x) âˆ§ c_j âˆ‰ {c | c < r_i}

2. Read Committedçº¦æŸ:
   ReadCommitted(S) âŸº
     âˆ€r_i(x): visible(x, r_i) âŠ† {w_j(x) | c_j < r_i}

3. åè¯æ³•:
   å‡è®¾: DirtyRead(S) âˆ§ ReadCommitted(S)

   åˆ™: âˆƒr_i(x) sees w_j(x) âˆ§ c_j âˆ‰ {c | c < r_i}
   ä¸”: visible(x, r_i) âŠ† {w_j(x) | c_j < r_i}

   çŸ›ç›¾: r_i(x) sees w_j(x) ä½† w_j(x) âˆ‰ visible(x, r_i)

   å› æ­¤: å‡è®¾é”™è¯¯

4. ç»“è®º: ReadCommitted(S) âŸ¹ Â¬DirtyRead(S) âœ…
```

---

## åäºŒã€å‚è€ƒèµ„æº

### æƒå¨æ ‡å‡†

1. **ANSI SQL-92æ ‡å‡†**
   - ISO/IEC 9075:1992
   - Section 4.28.2.2 - Isolation Levels

2. **SQL:2016æ ‡å‡†**
   - ISO/IEC 9075:2016
   - æ›´æ–°äº†éš”ç¦»çº§åˆ«å®šä¹‰

### å­¦æœ¯è®ºæ–‡

1. **Adya, A., et al. (2000)**
   - "Generalized Isolation Level Definitions"
   - SIGMOD 2000
   - å½¢å¼åŒ–éš”ç¦»çº§åˆ«å®šä¹‰æ¡†æ¶

2. **Bernstein, P. A., & Goodman, N. (1981)**
   - "Concurrency Control in Distributed Database Systems"
   - ACM Computing Surveys
   - å¹¶å‘æ§åˆ¶ç†è®ºåŸºç¡€

3. **Gray, J., & Reuter, A. (1993)**
   - "Transaction Processing: Concepts and Techniques"
   - Morgan Kaufmann
   - äº‹åŠ¡å¤„ç†ç»å…¸æ•™æ

### å®ç°æ–‡æ¡£

1. **PostgreSQLå®˜æ–¹æ–‡æ¡£**
   - [Transaction Isolation](https://www.postgresql.org/docs/current/transaction-iso.html)
   - [MVCC](https://www.postgresql.org/docs/current/mvcc.html)

2. **PostgreSQLæºç **
   - `src/backend/storage/ipc/procarray.c` - å¿«ç…§ç®¡ç†
   - `src/backend/access/heap/heapam.c` - å¯è§æ€§åˆ¤æ–­

### åœ¨çº¿èµ„æº

1. **Wikipedia**
   - [Isolation (database systems)](https://en.wikipedia.org/wiki/Isolation_(database_systems))

2. **å¤§å­¦è¯¾ç¨‹**
   - MIT 6.824: Distributed Systems
   - CMU 15-445: Database Systems
   - Stanford CS245: Database Systems

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0
**åˆ›å»ºæ—¥æœŸ**: 2025-12-05
**æœ€åæ›´æ–°**: 2025-12-05
**çŠ¶æ€**: âœ… å®Œæ•´è®ºè¯æ–‡æ¡£

**ä¸‹ä¸€æ­¥**:

- [ ] åˆ›å»ºRepeatable Readå®Œæ•´è®ºè¯æ–‡æ¡£
- [ ] åˆ›å»ºå¯è§æ€§å®Œæ•´è®ºè¯æ–‡æ¡£
- [ ] åˆ›å»ºéš”ç¦»æ€§å®Œæ•´è®ºè¯æ–‡æ¡£
