# 05 | 贡献指南

> **协作工具**: 本文档说明如何为理论体系贡献内容，保持项目的持续发展。

---

## 📑 目录

- [05 | 贡献指南](#05--贡献指南)
  - [📑 目录](#-目录)
  - [一、贡献方式](#一贡献方式)
    - [1.1 贡献类型](#11-贡献类型)
  - [二、文档规范](#二文档规范)
    - [2.1 编号规范](#21-编号规范)
    - [2.2 文档结构](#22-文档结构)
  - [三、内容要求](#三内容要求)
    - [3.1 理论严谨性](#31-理论严谨性)
    - [3.2 工程实用性](#32-工程实用性)
    - [3.3 可读性](#33-可读性)
  - [四、提交流程](#四提交流程)
    - [4.1 提交步骤](#41-提交步骤)
    - [4.2 Commit规范](#42-commit规范)
  - [五、审核标准](#五审核标准)
    - [5.1 必须满足](#51-必须满足)
    - [5.2 优先接受](#52-优先接受)
    - [5.3 审核流程](#53-审核流程)
  - [🎯 优先贡献方向](#-优先贡献方向)
    - [高优先级 (P0)](#高优先级-p0)
    - [中优先级 (P1)](#中优先级-p1)
    - [低优先级 (P2)](#低优先级-p2)
  - [📧 联系方式](#-联系方式)
  - [🙏 感谢贡献者](#-感谢贡献者)
  - [六、贡献示例](#六贡献示例)
    - [6.1 文档补充示例](#61-文档补充示例)
    - [6.2 代码规范示例](#62-代码规范示例)
    - [6.3 测试要求](#63-测试要求)
  - [七、质量检查清单](#七质量检查清单)
    - [7.1 提交前自检](#71-提交前自检)
    - [7.2 自动化检查工具](#72-自动化检查工具)
  - [八、贡献流程详解](#八贡献流程详解)
    - [8.1 完整提交流程](#81-完整提交流程)
    - [8.2 Code Review流程](#82-code-review流程)
  - [九、贡献奖励机制](#九贡献奖励机制)
    - [9.1 贡献类型与奖励](#91-贡献类型与奖励)
    - [9.2 贡献者权益](#92-贡献者权益)
  - [十、常见问题FAQ](#十常见问题faq)
    - [Q1: 如何开始贡献？](#q1-如何开始贡献)
    - [Q2: 贡献的代码需要多完整？](#q2-贡献的代码需要多完整)
    - [Q3: 如何确保贡献质量？](#q3-如何确保贡献质量)
    - [Q4: 贡献被拒绝怎么办？](#q4-贡献被拒绝怎么办)
  - [十一、贡献模板](#十一贡献模板)
    - [11.1 新文档模板](#111-新文档模板)
  - [十二、贡献统计](#十二贡献统计)
    - [12.1 贡献类型统计](#121-贡献类型统计)
    - [12.2 贡献者统计](#122-贡献者统计)

---

## 一、贡献方式

### 1.1 贡献类型

**欢迎的贡献**:

- ✅ 补充待创建文档
- ✅ 改进现有文档
- ✅ 添加案例和思考题
- ✅ 修正错误和typo
- ✅ 补充代码示例
- ✅ 完善证明细节
- ✅ 翻译成其他语言

**暂不接受**:

- ❌ 大幅修改核心理论（需先讨论）
- ❌ 破坏结构一致性
- ❌ 低质量内容

---

## 二、文档规范

### 2.1 编号规范

**文件命名**:

```
XX-主题名称.md

例如：
01-分层状态演化模型(LSEM).md
02-MVCC理论完整解析.md
```

**编号规则**:

- 01-09: 子主题文档
- README.md: 模块索引

### 2.2 文档结构

**必需元素**:

```markdown
# XX | 文档标题

> **定位**: 一句话说明文档定位

---

## 📑 目录

[自动生成或手动维护]

---

### 2.3 格式规范

**Markdown规范**:

- 使用标准Markdown语法
- 代码块指定语言
- 公式使用LaTeX语法
- 图表使用Mermaid

**示例**:

```markdown
**加粗文本**
*斜体文本*

\`\`\`python
def example():
    pass
\`\`\`

$$E = mc^2$$

\`\`\`mermaid
graph TD
    A --> B
\`\`\`
```

---

## 三、内容要求

### 3.1 理论严谨性

**要求**:

- ✅ 核心概念形式化定义
- ✅ 定理带证明或证明引用
- ✅ 公式推导完整
- ✅ 逻辑一致无矛盾

**检查清单**:

- [ ] 所有定义形式化
- [ ] 所有定理有证明
- [ ] 所有公式可验证
- [ ] 引用文献准确

### 3.2 工程实用性

**要求**:

- ✅ 提供可运行代码
- ✅ 包含实际案例
- ✅ 给出优化建议
- ✅ 标注性能数据

**检查清单**:

- [ ] 代码可执行
- [ ] 案例真实可信
- [ ] 建议具体可操作
- [ ] 数据有来源

### 3.3 可读性

**要求**:

- ✅ 结构清晰（TOC导航）
- ✅ 图文并茂（思维导图）
- ✅ 由浅入深（循序渐进）
- ✅ 提供思考题

---

## 四、提交流程

### 4.1 提交步骤

**Step 1**: Fork项目（如果适用）

**Step 2**: 创建分支

```bash
git checkout -b feature/add-new-doc
```

**Step 3**: 编写文档

- 遵循文档规范
- 保持结构一致
- 添加TOC导航

**Step 4**: 自检

- [ ] 拼写检查
- [ ] 格式正确
- [ ] 链接有效
- [ ] 代码可运行

**Step 5**: 提交

```bash
git add .
git commit -m "docs: 添加XX文档"
git push origin feature/add-new-doc
```

**Step 6**: 创建Pull Request

- 描述改动内容
- 说明改动原因
- 附上测试结果（如适用）

### 4.2 Commit规范

**格式**:

```
<type>(<scope>): <subject>

<body>

<footer>
```

**Type类型**:

- `docs`: 文档修改
- `feat`: 新增内容
- `fix`: 修正错误
- `refactor`: 重构
- `style`: 格式调整

**示例**:

```
docs(mvcc): 补充HOT机制证明

- 添加HOT条件的形式化定义
- 补充优化效果的量化分析
- 增加代码示例

Refs: #123
```

---

## 五、审核标准

### 5.1 必须满足

- ✅ 内容准确无误
- ✅ 格式符合规范
- ✅ 结构保持一致
- ✅ 质量达到4.0+

### 5.2 优先接受

- ⭐ 填补空白（待创建文档）
- ⭐ 补充案例（工业实践）
- ⭐ 完善证明（形式化）
- ⭐ 优化性能（实测数据）

### 5.3 审核流程

1. **自动检查**: 格式、链接
2. **内容审核**: 准确性、完整性
3. **质量评估**: 评分≥4.0
4. **合并决策**: 维护者批准

---

## 🎯 优先贡献方向

### 高优先级 (P0)

- [ ] 补充00-理论框架的2篇文档
- [ ] 添加更多工业案例
- [ ] 补充思考题答案
- [ ] 完善代码示例

### 中优先级 (P1)

- [ ] 翻译成英文版本
- [ ] 添加视频教程
- [ ] 实现Web工具
- [ ] 性能基准测试

### 低优先级 (P2)

- [ ] 探索量子数据库
- [ ] AI驱动优化
- [ ] 硬件事务内存

---

## 📧 联系方式

**项目维护**: PostgreSQL理论研究组
**反馈渠道**:

- Issue tracker (即将开放)
- 邮件联系 (即将公布)
- 讨论组 (即将创建)

---

## 🙏 感谢贡献者

**所有贡献者名单**: (持续更新)

- 项目发起者
- 内容贡献者
- 问题反馈者
- 传播推广者

**每一份贡献都很重要！** 🌟

---

## 六、贡献示例

### 6.1 文档补充示例

**示例1: 补充工业案例**

```markdown
# 新增案例: 某电商平台订单系统

## 业务场景
- 订单量: 1000万/天
- 峰值TPS: 50,000
- 一致性要求: 强一致

## LSEM分析
- L0: PostgreSQL MVCC (Read Committed)
- L1: Rust服务层 (乐观锁)
- L2: 无（单机）

## 架构设计
[详细架构图]

## 性能数据
[实测数据]

## 优化迭代
[优化过程]
```

**示例2: 补充代码实现**

```python
# 新增: MVCC可见性检查的Rust实现
use tokio_postgres::Client;

pub struct MVCCVisibilityChecker {
    client: Arc<Client>,
}

impl MVCCVisibilityChecker {
    pub async fn is_visible(
        &self,
        tuple_xmin: i64,
        tuple_xmax: Option<i64>,
        snapshot: &Snapshot,
    ) -> bool {
        // 实现可见性检查逻辑
        // ...
    }
}
```

### 6.2 代码规范示例

**命名规范**:

```rust
// ✅ 正确: 清晰命名
pub struct MVCCSnapshotManager {
    active_transactions: HashSet<TransactionId>,
}

// ❌ 错误: 缩写不清晰
pub struct MVCCSnapMgr {
    act_txs: HashSet<TxId>,
}
```

**文档注释规范**:

```rust
/// MVCC可见性检查器
///
/// # 功能
/// 根据快照判断元组版本是否对当前事务可见
///
/// # 示例
/// ```rust
/// let checker = MVCCVisibilityChecker::new();
/// let visible = checker.is_visible(tuple, snapshot).await?;
/// ```
///
/// # 性能
/// - 时间复杂度: O(log n)，n为活跃事务数
/// - 空间复杂度: O(1)
pub struct MVCCVisibilityChecker {
    // ...
}
```

### 6.3 测试要求

**单元测试示例**:

```python
import pytest
from mvcc_visibility import MVCCVisibilityChecker, Snapshot

def test_visible_committed_tuple():
    """测试已提交元组的可见性"""
    checker = MVCCVisibilityChecker()
    snapshot = Snapshot(xmin=100, xmax=200, xip=[105, 110])

    # 元组xmin=90 < snapshot.xmin，且已提交
    tuple = Tuple(xmin=90, xmax=0)
    assert checker.is_visible(tuple, snapshot, txid=150) == True

def test_invisible_uncommitted_tuple():
    """测试未提交元组的不可见性"""
    checker = MVCCVisibilityChecker()
    snapshot = Snapshot(xmin=100, xmax=200, xip=[105, 110])

    # 元组xmin=105在xip中（未提交）
    tuple = Tuple(xmin=105, xmax=0)
    assert checker.is_visible(tuple, snapshot, txid=150) == False
```

**性能测试示例**:

```python
def test_visibility_check_performance():
    """测试可见性检查性能"""
    checker = MVCCVisibilityChecker()
    snapshot = create_large_snapshot(active_txs=10000)

    start = time.time()
    for _ in range(10000):
        checker.is_visible(random_tuple(), snapshot, txid=20000)
    duration = time.time() - start

    # 要求: 10000次检查 < 1秒
    assert duration < 1.0, f"Too slow: {duration:.2f}s"
```

---

## 七、质量检查清单

### 7.1 提交前自检

**内容检查**:

- [ ] 所有定义形式化（数学公式）
- [ ] 所有定理有证明或引用
- [ ] 代码可运行（无语法错误）
- [ ] 案例真实可信（有来源）
- [ ] 反例清晰（错误vs正确对比）

**格式检查**:

- [ ] TOC目录完整
- [ ] 章节编号连续（一、二、三...）
- [ ] 子章节编号正确（1.1, 1.2...）
- [ ] 代码块指定语言
- [ ] 公式使用LaTeX语法
- [ ] 链接有效（相对路径）

**一致性检查**:

- [ ] 术语与核心概念词典一致
- [ ] 公式符号与标准一致
- [ ] 引用文档路径正确
- [ ] 版本号格式统一

### 7.2 自动化检查工具

**Markdown检查**:

```bash
# 检查链接有效性
markdown-link-check *.md

# 检查拼写
aspell check *.md

# 检查格式
markdownlint *.md
```

**代码检查**:

```bash
# Python代码
pylint *.py
black --check *.py

# Rust代码
cargo clippy
cargo fmt --check
```

---

## 八、贡献流程详解

### 8.1 完整提交流程

**Step 1: 准备工作**

```bash
# 1. Fork仓库（如适用）
# 2. Clone本地
git clone https://github.com/db-theory/theory-system.git
cd theory-system

# 3. 创建分支
git checkout -b feature/add-xxx-doc
```

**Step 2: 编写文档**

```bash
# 1. 创建文档文件
touch DataBaseTheory/90-事务与并发设计理论体系/XX-新文档.md

# 2. 编写内容（遵循规范）
# 3. 添加TOC
# 4. 补充代码示例
# 5. 添加测试
```

**Step 3: 本地验证**

```bash
# 1. 检查格式
markdownlint XX-新文档.md

# 2. 运行测试
pytest tests/

# 3. 构建文档（如适用）
mkdocs build
```

**Step 4: 提交代码**

```bash
# 1. 暂存更改
git add DataBaseTheory/90-事务与并发设计理论体系/XX-新文档.md

# 2. 提交（遵循Commit规范）
git commit -m "docs(mvcc): 补充HOT机制证明

- 添加HOT条件的形式化定义
- 补充优化效果的量化分析
- 增加Rust代码示例
- 添加性能测试数据

Refs: #123"

# 3. 推送
git push origin feature/add-xxx-doc
```

**Step 5: 创建Pull Request**

```markdown
## 改动说明

### 新增内容
- 补充XX文档
- 添加XX案例
- 完善XX证明

### 改动原因
- 填补理论空白
- 补充工程实践

### 测试结果
- [ ] 本地测试通过
- [ ] 格式检查通过
- [ ] 链接检查通过

### 相关Issue
Closes #123
```

### 8.2 Code Review流程

**Review检查点**:

1. **内容准确性** (必须)
   - 理论正确
   - 公式无误
   - 代码可运行

2. **结构完整性** (必须)
   - TOC完整
   - 章节连贯
   - 链接有效

3. **质量要求** (必须)
   - 达到4.0+评分
   - 符合规范
   - 无低级错误

4. **改进建议** (可选)
   - 补充案例
   - 优化表达
   - 增强可视化

**Review反馈示例**:

```markdown
## Review反馈

### ✅ 通过项
- 理论正确
- 代码可运行
- 格式规范

### ⚠️ 需要改进
- [ ] 补充更多案例（建议3个以上）
- [ ] 添加性能测试数据
- [ ] 完善反例分析

### 💡 建议
- 可以添加Mermaid流程图
- 建议补充参考文献
```

---

## 九、贡献奖励机制

### 9.1 贡献类型与奖励

| 贡献类型 | 奖励 | 示例 |
|---------|------|------|
| **核心理论补充** | ⭐⭐⭐⭐⭐ | 补充LSEM公理证明 |
| **工业案例** | ⭐⭐⭐⭐ | 添加真实生产案例 |
| **代码实现** | ⭐⭐⭐⭐ | 完整可运行代码 |
| **文档改进** | ⭐⭐⭐ | 修正错误、优化表达 |
| **问题反馈** | ⭐⭐ | 报告Bug、提出建议 |
| **翻译** | ⭐⭐⭐ | 翻译成其他语言 |

### 9.2 贡献者权益

**所有贡献者**:

- ✅ GitHub Contributors徽章
- ✅ 官网致谢名单
- ✅ 优先获得技术支持

**优秀贡献者** (Top 10):

- ⭐ 特别致谢
- ⭐ 优先参与新功能设计
- ⭐ 获得项目周边礼品

**核心贡献者** (Top 3):

- 🌟 成为项目维护者
- 🌟 参与路线图规划
- 🌟 获得研究合作机会

---

## 十、常见问题FAQ

### Q1: 如何开始贡献？

**A**: 建议从以下方向开始：

1. **补充待创建文档**（见`08-扩展规划/02-未解决问题清单.md`）
2. **添加工业案例**（参考`09-工业案例库/`中的案例格式）
3. **完善代码示例**（补充可运行的完整代码）
4. **修正错误**（报告并修复文档中的错误）

### Q2: 贡献的代码需要多完整？

**A**: 代码要求：

- ✅ **必须**: 语法正确，可编译/运行
- ✅ **必须**: 有注释说明
- ✅ **推荐**: 包含单元测试
- ✅ **推荐**: 有性能数据

**示例**:

```python
# ✅ 好的贡献: 完整可运行
class MVCCChecker:
    def is_visible(self, tuple, snapshot):
        # 完整实现
        return True

# 使用示例
checker = MVCCChecker()
result = checker.is_visible(tuple, snapshot)

# ❌ 不好的贡献: 伪代码
def is_visible(tuple, snapshot):
    # TODO: 实现
    pass
```

### Q3: 如何确保贡献质量？

**A**: 质量检查清单：

1. **自检**: 使用检查清单（第7.1节）
2. **测试**: 运行自动化检查工具
3. **Peer Review**: 邀请他人审查
4. **迭代**: 根据反馈改进

### Q4: 贡献被拒绝怎么办？

**A**: 常见原因和解决方案：

| 原因 | 解决方案 |
|-----|---------|
| **格式不符合** | 参考第2.2节文档规范 |
| **内容不准确** | 查阅相关理论文档，修正错误 |
| **质量不足** | 补充案例、代码、测试 |
| **重复内容** | 检查是否已有类似内容 |

**处理流程**:

1. 阅读Review反馈
2. 理解拒绝原因
3. 修改并重新提交
4. 如仍有疑问，在PR中讨论

---

## 十一、贡献模板

### 11.1 新文档模板

```markdown
        # XX | 文档标题

        > **定位**: 一句话说明文档定位

        ---

        ## 📑 目录

        - [XX | 文档标题](#xx--文档标题)
        - [📑 目录](#-目录)
        - [一、第一章节](#一第一章节)
            - [1.1 小节](#11-小节)
        - [二、第二章节](#二第二章节)
        - [三、总结](#三总结)
        - [四、延伸阅读](#四延伸阅读)

        ```

        ### 11.2 案例补充模板

        ```markdown
        ## 案例X: 案例名称

        **业务场景**:
        - 需求1
        - 需求2

        **LSEM分析**:
        - L0: XXX
        - L1: XXX
        - L2: XXX

        **架构设计**:
        [架构图/描述]

        **实现代码**:
        ```python
        # 完整代码
        ```

        **性能数据**:

        | 指标 | 值 |
        |-----|---|
        | TPS | XXX |

        **优化迭代**:

        1. 初始方案
        2. 问题发现
        3. 优化方案
        4. 效果对比

```

---

## 十二、贡献统计

### 12.1 贡献类型统计

**当前统计** (截至2025-12-05):

| 类型 | 数量 | 占比 |
|-----|------|------|
| 核心理论 | 25篇 | 35% |
| 工业案例 | 8篇 | 11% |
| 代码实现 | 15篇 | 21% |
| 证明文档 | 6篇 | 8% |
| 工具文档 | 10篇 | 14% |
| 其他 | 8篇 | 11% |

### 12.2 贡献者统计

**活跃贡献者**: 5人
**总贡献数**: 72次提交
**代码行数**: 15,000+行
**文档字数**: 400,000+字

---

**版本**: 2.0.0（大幅充实）
**最后更新**: 2025-12-05
**新增内容**: 贡献示例、代码规范、测试要求、完整流程、FAQ、模板、统计

**状态**: 开放贡献，持续更新
