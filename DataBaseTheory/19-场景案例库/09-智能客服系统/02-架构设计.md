# 案例9：智能客服系统 - 架构设计

## 总体架构

```text
┌──────────────────────────────────────────────┐
│          智能客服系统架构                     │
├──────────────────────────────────────────────┤
│                                              │
│  [用户] → [对话API] → [意图识别]              │
│                │            │               │
│                ↓            ↓                │
│         [RAG检索] → [LLM] → [答案]            │
│                │                             │
│         [PostgreSQL 18]                      │
│          ├─ pgvector (FAQ)                   │
│          ├─ 对话历史                          │
│          └─ 工单系统                          │
│                                              │
└──────────────────────────────────────────────┘
```

---

## 核心模块

### 1. 向量检索

```python
# 语义检索Top-K
SELECT
    faq_id,
    question,
    answer,
    1 - (embedding <-> query_vec) AS similarity
FROM faqs
ORDER BY embedding <-> query_vec
LIMIT 5;
```

### 2. 对话上下文

```python
# 最近N轮对话
SELECT * FROM conversations
WHERE session_id = ?
ORDER BY created_at DESC
LIMIT 10;
```

### 3. LLM生成

```python
context = retrieve_faqs(question)
history = get_conversation_history(session_id)

prompt = f"""
上下文: {context}
历史: {history}
问题: {question}

回答:
"""

answer = llm.generate(prompt)
```

---

**返回**: [案例9主页](./README.md)
