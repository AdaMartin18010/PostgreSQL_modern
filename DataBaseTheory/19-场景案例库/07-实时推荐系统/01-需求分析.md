# 案例7：实时推荐系统 - 需求分析

## 业务背景

电商平台需要为用户实时推荐商品，要求：

- **实时性**: 用户行为后100ms内更新推荐
- **个性化**: 基于用户历史行为
- **准确性**: CTR目标>5%
- **规模**: 1000万用户，1亿商品，10亿行为记录

---

## 技术需求

### 1. 数据存储

**用户画像**:

```sql
用户基础信息 (1000万)
├─ 用户ID
├─ 年龄段、性别、地域
├─ 注册时间、活跃度
└─ 消费偏好标签
```

**商品特征**:

```sql
商品信息 (1亿)
├─ 商品ID、类目
├─ 价格、品牌
├─ 销量、评分
└─ 标签向量
```

**行为数据**:

```sql
用户行为 (10亿+，实时增长)
├─ 浏览 (PV)
├─ 点击
├─ 加购
├─ 购买
└─ 评价
```

---

### 2. 推荐算法

**协同过滤**:

- User-Based CF
- Item-Based CF
- 基于PostgreSQL相似度计算

**特征工程**:

```sql
-- 用户特征
用户活跃度、购买力、偏好品类

-- 商品特征
热度、转化率、相似商品

-- 交叉特征
用户-品类亲和度
```

**排序模型**:

- CTR预估（逻辑回归）
- 多目标优化（点击+购买）

---

### 3. 性能要求

| 指标 | 目标 | 说明 |
|------|------|------|
| 推荐延迟 | <100ms | P95 |
| 行为写入 | 100K/秒 | 峰值 |
| 推荐QPS | 50K | 峰值 |
| 模型更新 | 小时级 | 增量更新 |

---

## 数据流

```text
用户行为 → 实时写入 → PostgreSQL
    │                      │
    └──────────────────────┘
                ↓
         特征提取 (实时)
                ↓
         推荐召回 (多路)
         ├─ 协同过滤
         ├─ 热门推荐
         └─ 内容推荐
                ↓
         排序打分 (CTR)
                ↓
         返回Top-N (100ms内)
```

---

## PostgreSQL 18特性应用

✅ **pgvector**: 商品向量相似度计算
✅ **HNSW索引**: 快速向量检索
✅ **Skip Scan**: 稀疏条件查询优化
✅ **并行查询**: 多路召回并行
✅ **分区表**: 行为数据按时间分区

---

**返回**: [案例7主页](./README.md)
