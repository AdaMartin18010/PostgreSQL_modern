# 案例6：全文搜索系统 - 架构设计

## 元数据

- **创建日期**: 2025-12-04
- **技术**: PostgreSQL 18 + GIN索引 + tsvector
- **文档量**: 百万级

---

## 1. 总体架构

```text
┌─────────────────────────────────────────────────────┐
│            全文搜索系统架构                          │
├─────────────────────────────────────────────────────┤
│                                                       │
│  [用户搜索] → [API] → [搜索服务]                    │
│                           │                          │
│                     [PostgreSQL 18]                  │
│                           │                          │
│                    [GIN索引 + tsvector]              │
│                           │                          │
│                     [文档表]                         │
│                           │                          │
│                    [排序模块]                        │
│                  (ts_rank_cd + BM25)                 │
│                                                       │
└─────────────────────────────────────────────────────┘
```

---

## 2. 核心组件

### 2.1 索引策略

**GIN vs GiST**:

| 索引类型 | 构建时间 | 查询速度 | 更新成本 | 适用场景 |
|---------|---------|---------|---------|---------|
| **GIN** | 慢 | 快 | 高 | 读多写少 |
| **GiST** | 快 | 较快 | 低 | 写多读少 |

**选择**: GIN（PostgreSQL 18并行构建优化）

---

### 2.2 中文分词

**方案对比**:

| 方案 | 优点 | 缺点 | 选择 |
|------|------|------|------|
| **zhparser** | 开源、成熟 | 需要编译安装 | ✅ |
| **jieba分词** | 灵活 | 需要应用层处理 | ⚠️ |
| **内置simple** | 无需安装 | 不支持中文 | ❌ |

---

## 3. 排序算法

### 3.1 相关性排序

**PostgreSQL内置**:

- `ts_rank`: 基于TF-IDF
- `ts_rank_cd`: 考虑覆盖密度

**BM25实现**:

```sql
CREATE FUNCTION bm25_score(
    doc_length INT,
    avg_doc_length FLOAT,
    term_freq INT,
    doc_freq INT,
    total_docs INT
) RETURNS FLOAT AS $$
    -- BM25计算公式
$$ LANGUAGE sql IMMUTABLE;
```

---

**完成日期**: 2025-12-04
**搜索引擎**: PostgreSQL全文搜索
**性能**: ms级响应

**返回**: [案例6主页](./README.md)
