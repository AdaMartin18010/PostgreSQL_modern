# æ•°æ®åº“ç³»ç»Ÿåº”ç”¨æ€»ç»“-æŠ€æœ¯æ ˆä¸æ¶æ„æ¨¡å¼çš„å½¢å¼åŒ–

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **æœ€åæ›´æ–°**: 2025-01-16
> **ç‰ˆæœ¬è¦†ç›–**: PostgreSQL 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x (å…¼å®¹)
> **æ–‡æ¡£çŠ¶æ€**: âœ… å†…å®¹å·²å®Œæˆ

---

## ğŸ“‹ ç›®å½•

- [æ•°æ®åº“ç³»ç»Ÿåº”ç”¨æ€»ç»“-æŠ€æœ¯æ ˆä¸æ¶æ„æ¨¡å¼çš„å½¢å¼åŒ–](#æ•°æ®åº“ç³»ç»Ÿåº”ç”¨æ€»ç»“-æŠ€æœ¯æ ˆä¸æ¶æ„æ¨¡å¼çš„å½¢å¼åŒ–)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.0 æ•°æ®åº“ç³»ç»Ÿåº”ç”¨æ€»ç»“å·¥ä½œåŸç†æ¦‚è¿°](#10-æ•°æ®åº“ç³»ç»Ÿåº”ç”¨æ€»ç»“å·¥ä½œåŸç†æ¦‚è¿°)
    - [1.1 æœ¬æ–‡æ¡£çš„èŒƒå›´](#11-æœ¬æ–‡æ¡£çš„èŒƒå›´)
  - [2. æ ¸å¿ƒå†…å®¹](#2-æ ¸å¿ƒå†…å®¹)
    - [2.1 æŠ€æœ¯æ ˆ](#21-æŠ€æœ¯æ ˆ)
    - [2.2 æ¶æ„æ¨¡å¼](#22-æ¶æ„æ¨¡å¼)
  - [3. å½¢å¼åŒ–å®šä¹‰](#3-å½¢å¼åŒ–å®šä¹‰)
    - [3.1 åº”ç”¨ä½“ç³»å½¢å¼åŒ–](#31-åº”ç”¨ä½“ç³»å½¢å¼åŒ–)
  - [4. å®šç†ä¸è¯æ˜](#4-å®šç†ä¸è¯æ˜)
    - [4.1 æ¶æ„æ¨¡å¼æ­£ç¡®æ€§å®šç†](#41-æ¶æ„æ¨¡å¼æ­£ç¡®æ€§å®šç†)
  - [5. å®é™…åº”ç”¨](#5-å®é™…åº”ç”¨)
    - [5.1 PostgreSQL 18æ¶æ„å®è·µ](#51-postgresql-18æ¶æ„å®è·µ)
      - [5.1.1 ä¸»ä»å¤åˆ¶æ¶æ„](#511-ä¸»ä»å¤åˆ¶æ¶æ„)
    - [5.2 å®é™…åº”ç”¨åœºæ™¯](#52-å®é™…åº”ç”¨åœºæ™¯)
      - [åœºæ™¯1ï¼šOLTPç³»ç»Ÿæ¶æ„](#åœºæ™¯1oltpç³»ç»Ÿæ¶æ„)
      - [åœºæ™¯2ï¼šåˆ†ç‰‡æ¶æ„](#åœºæ™¯2åˆ†ç‰‡æ¶æ„)
  - [6. ç›¸å…³æ–‡æ¡£](#6-ç›¸å…³æ–‡æ¡£)
    - [5.1 ç†è®ºåŸºç¡€æ–‡æ¡£](#51-ç†è®ºåŸºç¡€æ–‡æ¡£)
  - [7. å‚è€ƒæ–‡çŒ®](#7-å‚è€ƒæ–‡çŒ®)
    - [6.1 æ ¸å¿ƒç†è®ºæ–‡çŒ®](#61-æ ¸å¿ƒç†è®ºæ–‡çŒ®)
    - [6.2 PostgreSQLå®ç°ç›¸å…³](#62-postgresqlå®ç°ç›¸å…³)
    - [6.3 ç›¸å…³æ–‡æ¡£](#63-ç›¸å…³æ–‡æ¡£)

---

## 1. æ¦‚è¿°

### 1.0 æ•°æ®åº“ç³»ç»Ÿåº”ç”¨æ€»ç»“å·¥ä½œåŸç†æ¦‚è¿°

**åº”ç”¨æ€»ç»“**ï¼š

æ€»ç»“æ•°æ®åº“ç³»ç»ŸæŠ€æœ¯æ ˆå’Œæ¶æ„æ¨¡å¼ã€‚

**åº”ç”¨ä½“ç³»æ€ç»´å¯¼å›¾**ï¼š

```mermaid
mindmap
  root((åº”ç”¨ä½“ç³»))
    æŠ€æœ¯æ ˆ
      æ•°æ®åº“å¼•æ“
      å­˜å‚¨ç³»ç»Ÿ
      æŸ¥è¯¢ä¼˜åŒ–å™¨
    æ¶æ„æ¨¡å¼
      ä¸»ä»å¤åˆ¶
      åˆ†ç‰‡æ¶æ„
      å¾®æœåŠ¡æ¶æ„
    åº”ç”¨åœºæ™¯
      OLTP
      OLAP
      æ··åˆè´Ÿè½½
```

### 1.1 æœ¬æ–‡æ¡£çš„èŒƒå›´

æœ¬æ–‡æ¡£æ¶µç›–ï¼š

- **æŠ€æœ¯æ ˆ**ï¼šæ ¸å¿ƒæŠ€æœ¯ç»„ä»¶
- **æ¶æ„æ¨¡å¼**ï¼šç³»ç»Ÿæ¶æ„
- **åº”ç”¨åœºæ™¯**ï¼šä½¿ç”¨åœºæ™¯

---

## 2. æ ¸å¿ƒå†…å®¹

### 2.1 æŠ€æœ¯æ ˆ

**æ ¸å¿ƒç»„ä»¶**ï¼š

| ç»„ä»¶ | åŠŸèƒ½ | æŠ€æœ¯ |
|------|------|------|
| **å­˜å‚¨å¼•æ“** | æ•°æ®å­˜å‚¨ | B-Treeã€LSM |
| **æŸ¥è¯¢ä¼˜åŒ–å™¨** | æŸ¥è¯¢ä¼˜åŒ– | ä»£ä»·æ¨¡å‹ |
| **äº‹åŠ¡ç®¡ç†å™¨** | äº‹åŠ¡å¤„ç† | MVCCã€2PL |

### 2.2 æ¶æ„æ¨¡å¼

**æ¶æ„ç±»å‹**ï¼š

- **ä¸»ä»å¤åˆ¶**ï¼šè¯»å†™åˆ†ç¦»
- **åˆ†ç‰‡æ¶æ„**ï¼šæ°´å¹³æ‰©å±•
- **å¾®æœåŠ¡æ¶æ„**ï¼šæœåŠ¡åŒ–

---

## 3. å½¢å¼åŒ–å®šä¹‰

### 3.1 åº”ç”¨ä½“ç³»å½¢å¼åŒ–

**åº”ç”¨ä½“ç³»**ï¼š

```haskell
-- åº”ç”¨ä½“ç³»å½¢å¼åŒ–
Application = (S, A, P)
where
    S = technology stack
    A = architecture pattern
    P = application pattern
```

---

## 4. å®šç†ä¸è¯æ˜

### 4.1 æ¶æ„æ¨¡å¼æ­£ç¡®æ€§å®šç†

**å®šç†1ï¼ˆæ¶æ„æ¨¡å¼æ­£ç¡®æ€§ï¼‰**ï¼š

æ•°æ®åº“ç³»ç»Ÿæ¶æ„æ¨¡å¼æ˜¯æ­£ç¡®çš„ï¼Œå³å®ƒèƒ½å¤Ÿæ»¡è¶³åº”ç”¨éœ€æ±‚ï¼Œä¿è¯ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚

**å½¢å¼åŒ–è¡¨è¿°**ï¼š

è®¾æ¶æ„æ¨¡å¼Architecture = (S, A, P)ï¼ŒæŠ€æœ¯æ ˆSï¼Œæ¶æ„æ¨¡å¼Aï¼Œåº”ç”¨æ¨¡å¼Pã€‚åˆ™ï¼š

```text
satisfies(Architecture, Requirements) âˆ§ scalable(Architecture) âˆ§ available(Architecture)
```

**è¯æ˜**ï¼š

**æ­¥éª¤1ï¼šéœ€æ±‚æ»¡è¶³æ€§**ï¼š

- æ¶æ„æ¨¡å¼èƒ½å¤Ÿæ»¡è¶³åº”ç”¨çš„åŠŸèƒ½å’ŒéåŠŸèƒ½éœ€æ±‚
- æ¶æ„è®¾è®¡åŸºäºåº”ç”¨åœºæ™¯å’Œéœ€æ±‚åˆ†æ

**æ­¥éª¤2ï¼šå¯æ‰©å±•æ€§**ï¼š

- æ¶æ„æ¨¡å¼æ”¯æŒæ°´å¹³æ‰©å±•å’Œå‚ç›´æ‰©å±•
- æ‰©å±•ç­–ç•¥èƒ½å¤Ÿåº”å¯¹è´Ÿè½½å¢é•¿

**æ­¥éª¤3ï¼šå¯ç”¨æ€§**ï¼š

- æ¶æ„æ¨¡å¼é€šè¿‡å†—ä½™å’Œæ•…éšœæ¢å¤ä¿è¯é«˜å¯ç”¨æ€§
- ç³»ç»Ÿè®¾è®¡éµå¾ªå®¹é”™åŸåˆ™

**æ­¥éª¤4ï¼šç»“è®º**ï¼š

- æ¶æ„æ¨¡å¼æ­£ç¡®æ€§å®šç†å¾—è¯

**è¯æ˜æ ‘**ï¼š

```mermaid
graph TD
    A[æ¶æ„æ¨¡å¼æ­£ç¡®æ€§å®šç†] --> B[éœ€æ±‚æ»¡è¶³æ€§]
    B --> C[å¯æ‰©å±•æ€§]
    C --> D[å¯ç”¨æ€§]
    D --> E[å®šç†å¾—è¯]

    style A fill:#FFD700
    style E fill:#90EE90
```

---

## 5. å®é™…åº”ç”¨

### 5.1 PostgreSQL 18æ¶æ„å®è·µ

#### 5.1.1 ä¸»ä»å¤åˆ¶æ¶æ„

**PostgreSQL 18ä¸»ä»å¤åˆ¶æ¶æ„**ï¼š

PostgreSQL 18æ”¯æŒæµå¤åˆ¶å®ç°ä¸»ä»æ¶æ„ï¼Œæä¾›é«˜å¯ç”¨æ€§å’Œè¯»å†™åˆ†ç¦»ã€‚

**ä¸»ä»å¤åˆ¶é…ç½®**ï¼š

```sql
-- åœºæ™¯ï¼šä¸»ä»å¤åˆ¶æ¶æ„
-- 1. ä¸»åº“é…ç½®ï¼ˆpostgresql.confï¼‰
wal_level = replica
max_wal_senders = 3
max_replication_slots = 3

-- 2. ä»åº“é…ç½®ï¼ˆrecovery.confæˆ–postgresql.confï¼‰
primary_conninfo = 'host=primary.example.com port=5432 user=replicator'
primary_slot_name = 'replica_slot'

-- 3. åˆ›å»ºå¤åˆ¶æ§½
SELECT pg_create_physical_replication_slot('replica_slot');

-- 4. ç›‘æ§å¤åˆ¶çŠ¶æ€
SELECT
    client_addr,
    state,
    sync_state,
    sync_priority,
    pg_wal_lsn_diff(pg_current_wal_lsn(), sent_lsn) AS replication_lag
FROM pg_stat_replication;
```

### 5.2 å®é™…åº”ç”¨åœºæ™¯

#### åœºæ™¯1ï¼šOLTPç³»ç»Ÿæ¶æ„

**ä¸šåŠ¡èƒŒæ™¯**ï¼š

æ„å»ºé«˜å¯ç”¨OLTPç³»ç»Ÿï¼Œä½¿ç”¨ä¸»ä»å¤åˆ¶å®ç°è¯»å†™åˆ†ç¦»å’Œæ•…éšœåˆ‡æ¢ã€‚

**PostgreSQL 18å®ç°**ï¼š

```sql
-- åœºæ™¯ï¼šOLTPç³»ç»Ÿæ¶æ„
-- 1. ä¸»åº“ï¼šå¤„ç†å†™æ“ä½œ
CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    customer_id INTEGER,
    order_date TIMESTAMPTZ DEFAULT NOW(),
    total_amount DECIMAL(10,2)
);

-- 2. ä»åº“ï¼šå¤„ç†è¯»æ“ä½œ
-- åº”ç”¨å±‚è·¯ç”±ï¼šå†™æ“ä½œ -> ä¸»åº“ï¼Œè¯»æ“ä½œ -> ä»åº“

-- 3. ç›‘æ§ä¸»ä»å»¶è¿Ÿ
SELECT
    application_name,
    client_addr,
    state,
    pg_wal_lsn_diff(pg_current_wal_lsn(), sent_lsn) AS lag_bytes
FROM pg_stat_replication;
```

#### åœºæ™¯2ï¼šåˆ†ç‰‡æ¶æ„

**ä¸šåŠ¡èƒŒæ™¯**ï¼š

ä½¿ç”¨åˆ†ç‰‡æ¶æ„å®ç°æ°´å¹³æ‰©å±•ï¼Œæ”¯æŒå¤§è§„æ¨¡æ•°æ®å­˜å‚¨ã€‚

**PostgreSQL 18å®ç°**ï¼š

```sql
-- åœºæ™¯ï¼šåˆ†ç‰‡æ¶æ„
-- 1. åˆ›å»ºåˆ†ç‰‡è¡¨ï¼ˆæŒ‰customer_idåˆ†ç‰‡ï¼‰
CREATE TABLE orders_shard_0 (
    LIKE orders INCLUDING ALL
) PARTITION BY RANGE (customer_id);

CREATE TABLE orders_shard_0_p1 PARTITION OF orders_shard_0
FOR VALUES FROM (0) TO (10000);

CREATE TABLE orders_shard_0_p2 PARTITION OF orders_shard_0
FOR VALUES FROM (10000) TO (20000);

-- 2. åº”ç”¨å±‚è·¯ç”±ï¼šæ ¹æ®customer_idé€‰æ‹©åˆ†ç‰‡
-- SELECT * FROM orders_shard_0 WHERE customer_id = 5000;
```

---

---

## 6. ç›¸å…³æ–‡æ¡£

### 5.1 ç†è®ºåŸºç¡€æ–‡æ¡£

- [å½¢å¼è¯­è¨€ä¸è¯æ˜ï¼šæ€»è®º](./1.1.25-å½¢å¼è¯­è¨€ä¸è¯æ˜-æ€»è®º.md)
- [ç†è®ºåŸºç¡€å¯¼èˆª](./README.md)

---

## 7. å‚è€ƒæ–‡çŒ®

### 6.1 æ ¸å¿ƒç†è®ºæ–‡çŒ®

- **Tanenbaum, A. S., & Van Steen, M. (2017). "Distributed Systems: Principles and Paradigms."**
  - å‡ºç‰ˆç¤¾: Pearson
  - **é‡è¦æ€§**: åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç»å…¸æ•™æ
  - **æ ¸å¿ƒè´¡çŒ®**: ç³»ç»Ÿé˜è¿°äº†æ¶æ„æ¨¡å¼

- **Kleppmann, M. (2017). "Designing Data-Intensive Applications."**
  - å‡ºç‰ˆç¤¾: O'Reilly Media
  - **é‡è¦æ€§**: æ•°æ®å¯†é›†å‹åº”ç”¨è®¾è®¡çš„ç»å…¸æ•™æ
  - **æ ¸å¿ƒè´¡çŒ®**: æ€»ç»“äº†æŠ€æœ¯æ ˆå’Œæ¶æ„æ¨¡å¼

### 6.2 PostgreSQLå®ç°ç›¸å…³

- **PostgreSQLå®˜æ–¹æ–‡æ¡£ - æ¶æ„](<https://www.postgresql.org/docs/current/architecture.html>)**
  - PostgreSQLæ¶æ„è¯´æ˜

### 6.3 ç›¸å…³æ–‡æ¡£

- [ç†è®ºåŸºç¡€å¯¼èˆª](../README.md)

---

**æœ€åæ›´æ–°**: 2025-01-16
**ç»´æŠ¤è€…**: Documentation Team
**çŠ¶æ€**: âœ… å†…å®¹å·²å®Œæˆ
