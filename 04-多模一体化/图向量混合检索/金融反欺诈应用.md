# é‡‘èžåæ¬ºè¯ˆåº”ç”¨

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥  
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 18+ / Apache AGE 1.5+ / pgvector 0.7.0+  
> **æ–‡æ¡£ç¼–å·**: 04-03-02

## ðŸ“‘ ç›®å½•

- [é‡‘èžåæ¬ºè¯ˆåº”ç”¨](#é‡‘èžåæ¬ºè¯ˆåº”ç”¨)
  - [ðŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
  - [2. åº”ç”¨æž¶æž„](#2-åº”ç”¨æž¶æž„)
  - [3. å®žçŽ°ç»†èŠ‚](#3-å®žçŽ°ç»†èŠ‚)
    - [3.1 æ•°æ®æ¨¡åž‹](#31-æ•°æ®æ¨¡åž‹)
    - [3.2 æ¬ºè¯ˆæ£€æµ‹](#32-æ¬ºè¯ˆæ£€æµ‹)
  - [4. æ€§èƒ½åˆ†æž](#4-æ€§èƒ½åˆ†æž)
  - [5. æœ€ä½³å®žè·µ](#5-æœ€ä½³å®žè·µ)
  - [6. å‚è€ƒèµ„æ–™](#6-å‚è€ƒèµ„æ–™)

---

## 1. æ¦‚è¿°

é‡‘èžåæ¬ºè¯ˆåº”ç”¨ç»“åˆå›¾æ•°æ®åº“çš„å…³ç³»åˆ†æžå’Œå‘é‡æ•°æ®åº“çš„æ¨¡å¼åŒ¹é…ï¼Œå®žçŽ°é«˜æ•ˆçš„æ¬ºè¯ˆæ£€æµ‹ã€‚

---

## 2. åº”ç”¨æž¶æž„

```text
äº¤æ˜“æ•°æ®
    â”‚
    â”œâ”€â”€â–º å›¾æ•°æ®åº“ï¼ˆå…³ç³»åˆ†æžï¼‰
    â”‚        â”‚
    â”‚        â–¼
    â”‚    è´¦æˆ·å…³ç³»å›¾
    â”‚
    â””â”€â”€â–º å‘é‡æ•°æ®åº“ï¼ˆæ¨¡å¼åŒ¹é…ï¼‰
             â”‚
             â–¼
         äº¤æ˜“å‘é‡
             â”‚
             â–¼
         æ¬ºè¯ˆæ£€æµ‹
```

---

## 3. å®žçŽ°ç»†èŠ‚

### 3.1 æ•°æ®æ¨¡åž‹

```sql
-- äº¤æ˜“å‘é‡è¡¨
CREATE TABLE transaction_embeddings (
    transaction_id BIGSERIAL PRIMARY KEY,
    account_id BIGINT,
    amount DECIMAL,
    timestamp TIMESTAMPTZ,
    embedding vector(256),
    metadata JSONB
);

-- åˆ›å»ºå‘é‡ç´¢å¼•
CREATE INDEX ON transaction_embeddings
USING hnsw (embedding vector_cosine_ops);

-- åˆ›å»ºå›¾
SELECT create_graph('transaction_graph');

-- åˆ›å»ºèŠ‚ç‚¹å’Œè¾¹
SELECT * FROM cypher('transaction_graph', $$
    CREATE (a:Account {id: 1})
    CREATE (t:Transaction {id: 1, amount: 1000})
    CREATE (a)-[:MAKES]->(t)
$$) AS (a agtype);
```

### 3.2 æ¬ºè¯ˆæ£€æµ‹

```sql
-- å®žæ—¶æ¬ºè¯ˆæ£€æµ‹
CREATE OR REPLACE FUNCTION detect_fraud(
    transaction_id_param BIGINT,
    transaction_embedding vector(256)
)
RETURNS TABLE (
    fraud_score FLOAT,
    risk_level TEXT,
    related_accounts BIGINT[]
) AS $$
BEGIN
    RETURN QUERY
    WITH pattern_match AS (
        SELECT
            pattern_type,
            transaction_embedding <=> pattern_vector as distance
        FROM fraud_patterns
        WHERE transaction_embedding <=> pattern_vector < 0.7
        ORDER BY distance
        LIMIT 1
    ),
    graph_analysis AS (
        SELECT * FROM cypher('transaction_graph', $$
            MATCH (t:Transaction {id: $transaction_id})-[:INVOLVES]->(a:Account)
            MATCH (a)-[:CONNECTED_TO*2..3]->(related:Account)
            RETURN collect(DISTINCT related.id) as related_accounts
        $$, transaction_id_param) AS (related_accounts agtype)
    )
    SELECT
        (1 - pm.distance)::FLOAT as fraud_score,
        CASE
            WHEN pm.distance < 0.5 THEN 'high'
            WHEN pm.distance < 0.7 THEN 'medium'
            ELSE 'low'
        END as risk_level,
        ga.related_accounts::bigint[] as related_accounts
    FROM pattern_match pm
    CROSS JOIN graph_analysis ga;
END;
$$ LANGUAGE plpgsql;
```

---

## 4. æ€§èƒ½åˆ†æž

**æ£€æµ‹æ€§èƒ½**:

| æŒ‡æ ‡     | å€¼     |
| -------- | ------ |
| æ£€æµ‹å»¶è¿Ÿ | < 50ms |
| å‡†ç¡®çŽ‡   | 95%    |
| å¬å›žçŽ‡   | 92%    |

---

## 5. æœ€ä½³å®žè·µ

1. **æ¨¡å¼åº“ç®¡ç†**: å®šæœŸæ›´æ–°æ¬ºè¯ˆæ¨¡å¼åº“
2. **å›¾ä¼˜åŒ–**: ä¼˜åŒ–å›¾æŸ¥è¯¢æ€§èƒ½
3. **å®žæ—¶æ£€æµ‹**: å®žçŽ°å®žæ—¶æ¬ºè¯ˆæ£€æµ‹
4. **å‘Šè­¦ç­–ç•¥**: è®¾ç½®åˆç†çš„å‘Šè­¦é˜ˆå€¼

---

## 6. å‚è€ƒèµ„æ–™

- [å›¾å‘é‡è”åˆæŸ¥è¯¢](./å›¾å‘é‡è”åˆæŸ¥è¯¢.md)
- [å¬å›žçŽ‡ä¼˜åŒ–ç­–ç•¥](./å¬å›žçŽ‡ä¼˜åŒ–ç­–ç•¥.md)

---

**æœ€åŽæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥  
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
