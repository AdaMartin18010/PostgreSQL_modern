# æ€§èƒ½ç›‘æ§

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥  
> **æ–‡æ¡£ç¼–å·**: 09-02-02

## ğŸ“‘ ç›®å½•

- [æ€§èƒ½ç›‘æ§](#æ€§èƒ½ç›‘æ§)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 ç›‘æ§ç›®æ ‡](#11-ç›‘æ§ç›®æ ‡)
    - [1.2 ç›‘æ§èŒƒå›´](#12-ç›‘æ§èŒƒå›´)
    - [1.3 ç›‘æ§æ¶æ„](#13-ç›‘æ§æ¶æ„)
  - [2. ç›‘æ§æŒ‡æ ‡](#2-ç›‘æ§æŒ‡æ ‡)
    - [2.1 æ•°æ®åº“æ€§èƒ½æŒ‡æ ‡](#21-æ•°æ®åº“æ€§èƒ½æŒ‡æ ‡)
      - [2.1.1 å…³é”®æŒ‡æ ‡æŸ¥è¯¢](#211-å…³é”®æŒ‡æ ‡æŸ¥è¯¢)
      - [2.1.2 è¡¨ç»Ÿè®¡ä¿¡æ¯](#212-è¡¨ç»Ÿè®¡ä¿¡æ¯)
      - [2.1.3 ç´¢å¼•ä½¿ç”¨æƒ…å†µ](#213-ç´¢å¼•ä½¿ç”¨æƒ…å†µ)
    - [2.2 å‘é‡æŸ¥è¯¢ç›‘æ§](#22-å‘é‡æŸ¥è¯¢ç›‘æ§)
      - [2.2.1 å‘é‡æŸ¥è¯¢æ€§èƒ½ç»Ÿè®¡](#221-å‘é‡æŸ¥è¯¢æ€§èƒ½ç»Ÿè®¡)
      - [2.2.2 å‘é‡æŸ¥è¯¢ QPS](#222-å‘é‡æŸ¥è¯¢-qps)
      - [2.2.3 å‘é‡æŸ¥è¯¢å»¶è¿Ÿåˆ†æ](#223-å‘é‡æŸ¥è¯¢å»¶è¿Ÿåˆ†æ)
    - [2.3 ç´¢å¼•æ€§èƒ½ç›‘æ§](#23-ç´¢å¼•æ€§èƒ½ç›‘æ§)
      - [2.3.1 HNSW ç´¢å¼•æ€§èƒ½](#231-hnsw-ç´¢å¼•æ€§èƒ½)
      - [2.3.2 IVFFlat ç´¢å¼•æ€§èƒ½](#232-ivfflat-ç´¢å¼•æ€§èƒ½)
      - [2.3.3 ç´¢å¼•æ•ˆç‡å¯¹æ¯”](#233-ç´¢å¼•æ•ˆç‡å¯¹æ¯”)
  - [3. Prometheus é›†æˆ](#3-prometheus-é›†æˆ)
    - [3.1 postgres_exporter é…ç½®](#31-postgres_exporter-é…ç½®)
      - [3.1.1 Exporter é…ç½®](#311-exporter-é…ç½®)
      - [3.1.2 è‡ªå®šä¹‰æŸ¥è¯¢](#312-è‡ªå®šä¹‰æŸ¥è¯¢)
    - [3.2 Grafana ä»ªè¡¨ç›˜é…ç½®](#32-grafana-ä»ªè¡¨ç›˜é…ç½®)
      - [3.2.1 ä»ªè¡¨ç›˜è®¾ç½®](#321-ä»ªè¡¨ç›˜è®¾ç½®)
      - [3.2.2 å¯è§†åŒ–é¢æ¿](#322-å¯è§†åŒ–é¢æ¿)
  - [4. æ€§èƒ½åˆ†æå·¥å…·](#4-æ€§èƒ½åˆ†æå·¥å…·)
    - [4.1 æ…¢æŸ¥è¯¢åˆ†æ](#41-æ…¢æŸ¥è¯¢åˆ†æ)
      - [4.1.1 æ…¢æŸ¥è¯¢æ—¥å¿—è§†å›¾](#411-æ…¢æŸ¥è¯¢æ—¥å¿—è§†å›¾)
      - [4.1.2 æ…¢æŸ¥è¯¢åˆ†æ](#412-æ…¢æŸ¥è¯¢åˆ†æ)
    - [4.2 æŸ¥è¯¢è®¡åˆ’åˆ†æ](#42-æŸ¥è¯¢è®¡åˆ’åˆ†æ)
      - [4.2.1 EXPLAIN åˆ†æ](#421-explain-åˆ†æ)
      - [4.2.2 æŸ¥è¯¢è®¡åˆ’ä¼˜åŒ–](#422-æŸ¥è¯¢è®¡åˆ’ä¼˜åŒ–)
  - [5. æ€§èƒ½ä¼˜åŒ–å»ºè®®](#5-æ€§èƒ½ä¼˜åŒ–å»ºè®®)
    - [5.1 åŸºäºç›‘æ§æ•°æ®çš„ä¼˜åŒ–](#51-åŸºäºç›‘æ§æ•°æ®çš„ä¼˜åŒ–)
      - [5.1.1 è¯†åˆ«æœªä½¿ç”¨çš„ç´¢å¼•](#511-è¯†åˆ«æœªä½¿ç”¨çš„ç´¢å¼•)
      - [5.1.2 è¯†åˆ«éœ€è¦ VACUUM çš„è¡¨](#512-è¯†åˆ«éœ€è¦-vacuum-çš„è¡¨)
    - [5.2 è‡ªåŠ¨åŒ–ä¼˜åŒ–è„šæœ¬](#52-è‡ªåŠ¨åŒ–ä¼˜åŒ–è„šæœ¬)
      - [5.2.1 Python ä¼˜åŒ–è„šæœ¬](#521-python-ä¼˜åŒ–è„šæœ¬)
      - [5.2.2 è‡ªåŠ¨åŒ–è°ƒåº¦](#522-è‡ªåŠ¨åŒ–è°ƒåº¦)
  - [6. æ€§èƒ½åŸºå‡†æµ‹è¯•](#6-æ€§èƒ½åŸºå‡†æµ‹è¯•)
    - [6.1 åŸºå‡†æµ‹è¯•è„šæœ¬](#61-åŸºå‡†æµ‹è¯•è„šæœ¬)
    - [6.2 æ€§èƒ½å¯¹æ¯”åˆ†æ](#62-æ€§èƒ½å¯¹æ¯”åˆ†æ)
  - [7. æœ€ä½³å®è·µ](#7-æœ€ä½³å®è·µ)
    - [7.1 ç›‘æ§æŒ‡æ ‡é€‰æ‹©](#71-ç›‘æ§æŒ‡æ ‡é€‰æ‹©)
    - [7.2 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#72-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
  - [8. å‚è€ƒèµ„æ–™](#8-å‚è€ƒèµ„æ–™)
    - [8.1 å®˜æ–¹æ–‡æ¡£](#81-å®˜æ–¹æ–‡æ¡£)
    - [8.2 æŠ€æœ¯æ–‡æ¡£](#82-æŠ€æœ¯æ–‡æ¡£)
    - [8.3 ç›¸å…³èµ„æº](#83-ç›¸å…³èµ„æº)

---

## 1. æ¦‚è¿°

### 1.1 ç›‘æ§ç›®æ ‡

**æ ¸å¿ƒç›®æ ‡**:

æœ¬æ–‡æ¡£æä¾› PostgreSQL + pgvector æ€§èƒ½ç›‘æ§çš„å®Œæ•´æŒ‡å—ï¼Œå¸®åŠ©æ‚¨å®æ—¶æŒæ¡ç³»ç»Ÿæ€§èƒ½çŠ¶æ€ã€‚

**ç›‘æ§ç›®æ ‡**:

1. **æ€§èƒ½ç›‘æ§**: å®æ—¶ç›‘æ§æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½ï¼ŒåŒ…æ‹¬å‘é‡æŸ¥è¯¢å»¶è¿Ÿã€ååé‡ç­‰
2. **èµ„æºç›‘æ§**: ç›‘æ§æ•°æ®åº“è¿æ¥æ•°ã€å†…å­˜ä½¿ç”¨ã€ç£ç›˜ I/O ç­‰èµ„æºä½¿ç”¨æƒ…å†µ
3. **ç´¢å¼•ç›‘æ§**: ç›‘æ§ç´¢å¼•ä½¿ç”¨æƒ…å†µï¼Œè¯†åˆ«æœªä½¿ç”¨çš„ç´¢å¼•å’Œéœ€è¦ä¼˜åŒ–çš„ç´¢å¼•
4. **ä¼˜åŒ–å»ºè®®**: åŸºäºç›‘æ§æ•°æ®æä¾›æ€§èƒ½ä¼˜åŒ–å»ºè®®

**ç›‘æ§ä»·å€¼**:

| ç›‘æ§é¡¹       | ä»·å€¼             | å½±å“             |
| ------------ | ---------------- | ---------------- |
| **æ€§èƒ½ç›‘æ§** | åŠæ—¶å‘ç°æ€§èƒ½ç“¶é¢ˆ | å‡å°‘ç”¨æˆ·ä½“éªŒå½±å“ |
| **èµ„æºç›‘æ§** | é¢„æµ‹èµ„æºéœ€æ±‚     | é¿å…èµ„æºè€—å°½     |
| **ç´¢å¼•ç›‘æ§** | ä¼˜åŒ–ç´¢å¼•ç­–ç•¥     | æå‡æŸ¥è¯¢æ€§èƒ½     |
| **ä¼˜åŒ–å»ºè®®** | è‡ªåŠ¨åŒ–ä¼˜åŒ–       | å‡å°‘äººå·¥æˆæœ¬     |

### 1.2 ç›‘æ§èŒƒå›´

**ç›‘æ§èŒƒå›´**:

1. **æ•°æ®åº“æ€§èƒ½æŒ‡æ ‡**:

   - è¿æ¥æ•°ã€äº‹åŠ¡æ•°ã€ç¼“å­˜å‘½ä¸­ç‡
   - è¡¨ç»Ÿè®¡ä¿¡æ¯ã€ç´¢å¼•ä½¿ç”¨æƒ…å†µ

2. **å‘é‡æŸ¥è¯¢ç›‘æ§**:

   - å‘é‡æŸ¥è¯¢å»¶è¿Ÿï¼ˆP50, P95, P99ï¼‰
   - å‘é‡æŸ¥è¯¢ QPS
   - å‘é‡æŸ¥è¯¢ç¼“å­˜å‘½ä¸­ç‡

3. **ç´¢å¼•æ€§èƒ½ç›‘æ§**:

   - HNSW ç´¢å¼•ä½¿ç”¨æƒ…å†µ
   - IVFFlat ç´¢å¼•ä½¿ç”¨æƒ…å†µ
   - ç´¢å¼•æ•ˆç‡åˆ†æ

4. **ç³»ç»Ÿèµ„æºç›‘æ§**:
   - CPU ä½¿ç”¨ç‡
   - å†…å­˜ä½¿ç”¨ç‡
   - ç£ç›˜ I/O

### 1.3 ç›‘æ§æ¶æ„

**ç›‘æ§æ¶æ„è®¾è®¡**:

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PostgreSQL + pgvector                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚pg_stat   â”‚  â”‚pg_stat   â”‚                    â”‚
â”‚  â”‚_statementsâ”‚ â”‚_database â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         postgres_exporter                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚Metric    â”‚  â”‚Custom    â”‚                    â”‚
â”‚  â”‚Collector â”‚  â”‚Queries   â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Prometheus                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚Time      â”‚  â”‚Metric    â”‚                    â”‚
â”‚  â”‚Series DB â”‚  â”‚Queries   â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Grafana                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚Dashboard â”‚  â”‚Alert     â”‚                    â”‚
â”‚  â”‚Panel     â”‚  â”‚Rules     â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. ç›‘æ§æŒ‡æ ‡

### 2.1 æ•°æ®åº“æ€§èƒ½æŒ‡æ ‡

#### 2.1.1 å…³é”®æŒ‡æ ‡æŸ¥è¯¢

**æ•°æ®åº“è¿æ¥æ•°å’Œç¼“å­˜ç»Ÿè®¡**:

```sql
-- æ•°æ®åº“è¿æ¥æ•°å’Œç¼“å­˜ç»Ÿè®¡
SELECT
    datname,
    numbackends as connections,
    xact_commit as commits,
    xact_rollback as rollbacks,
    blks_read as disk_reads,
    blks_hit as cache_hits,
    (blks_hit::float / NULLIF(blks_hit + blks_read, 0)) * 100 as cache_hit_rate,
    tup_returned,
    tup_fetched,
    tup_inserted,
    tup_updated,
    tup_deleted
FROM pg_stat_database
WHERE datname = 'vector_db';
```

**å…³é”®æŒ‡æ ‡è¯´æ˜**:

| æŒ‡æ ‡             | è¯´æ˜       | é‡è¦æ€§ |
| ---------------- | ---------- | ------ |
| `connections`    | å½“å‰è¿æ¥æ•° | **é«˜** |
| `commits`        | æäº¤äº‹åŠ¡æ•° | é«˜     |
| `rollbacks`      | å›æ»šäº‹åŠ¡æ•° | ä¸­     |
| `cache_hit_rate` | ç¼“å­˜å‘½ä¸­ç‡ | **é«˜** |
| `tup_returned`   | è¿”å›è¡Œæ•°   | ä¸­     |
| `tup_fetched`    | è·å–è¡Œæ•°   | ä¸­     |

#### 2.1.2 è¡¨ç»Ÿè®¡ä¿¡æ¯

**è¡¨ç»Ÿè®¡ä¿¡æ¯æŸ¥è¯¢**:

```sql
-- è¡¨ç»Ÿè®¡ä¿¡æ¯
SELECT
    schemaname,
    tablename,
    n_live_tup as live_tuples,
    n_dead_tup as dead_tuples,
    (n_dead_tup::float / NULLIF(n_live_tup + n_dead_tup, 0)) * 100 as dead_tuple_ratio,
    last_vacuum,
    last_autovacuum,
    last_analyze,
    last_autoanalyze,
    vacuum_count,
    autovacuum_count,
    analyze_count,
    autoanalyze_count
FROM pg_stat_user_tables
WHERE schemaname = 'public'
ORDER BY n_live_tup DESC;
```

**è¡¨ç»Ÿè®¡ä¿¡æ¯åˆ†æ**:

| æŒ‡æ ‡               | æ­£å¸¸èŒƒå›´ | è­¦å‘Šé˜ˆå€¼ | è¯´æ˜             |
| ------------------ | -------- | -------- | ---------------- |
| `dead_tuple_ratio` | **<10%** | **>20%** | æ­»å…ƒç»„æ¯”ä¾‹       |
| `last_autovacuum`  | **<24h** | **>7d**  | ä¸Šæ¬¡è‡ªåŠ¨æ¸…ç†æ—¶é—´ |
| `last_autoanalyze` | **<24h** | **>7d**  | ä¸Šæ¬¡è‡ªåŠ¨åˆ†ææ—¶é—´ |

#### 2.1.3 ç´¢å¼•ä½¿ç”¨æƒ…å†µ

**ç´¢å¼•ä½¿ç”¨æƒ…å†µæŸ¥è¯¢**:

```sql
-- ç´¢å¼•ä½¿ç”¨æƒ…å†µ
SELECT
    schemaname,
    tablename,
    indexname,
    idx_scan as index_scans,
    idx_tup_read as tuples_read,
    idx_tup_fetch as tuples_fetched,
    pg_size_pretty(pg_relation_size(indexrelid)) as index_size,
    CASE
        WHEN idx_scan = 0 THEN 'æœªä½¿ç”¨'
        WHEN idx_scan < 10 THEN 'ä½ä½¿ç”¨'
        WHEN idx_scan < 100 THEN 'ä¸­ä½¿ç”¨'
        ELSE 'é«˜ä½¿ç”¨'
    END as usage_status
FROM pg_stat_user_indexes
WHERE schemaname = 'public'
ORDER BY idx_scan DESC;
```

### 2.2 å‘é‡æŸ¥è¯¢ç›‘æ§

#### 2.2.1 å‘é‡æŸ¥è¯¢æ€§èƒ½ç»Ÿè®¡

**å‘é‡æŸ¥è¯¢æ€§èƒ½ç»Ÿè®¡**:

```sql
-- å‘é‡æŸ¥è¯¢æ€§èƒ½ç»Ÿè®¡
SELECT
    LEFT(query, 100) as query_preview,
    calls,
    total_exec_time,
    mean_exec_time,
    max_exec_time,
    min_exec_time,
    stddev_exec_time,
    rows,
    (shared_blks_hit::float / NULLIF(shared_blks_hit + shared_blks_read, 0)) * 100 as cache_hit_rate,
    (shared_blks_hit + shared_blks_read) as total_blks
FROM pg_stat_statements
WHERE query LIKE '%<=>%' OR query LIKE '%<->%' OR query LIKE '%<#%'  -- å‘é‡æŸ¥è¯¢
ORDER BY mean_exec_time DESC
LIMIT 20;
```

**å‘é‡æŸ¥è¯¢æ€§èƒ½æŒ‡æ ‡**:

| æŒ‡æ ‡             | è¯´æ˜         | é‡è¦æ€§ |
| ---------------- | ------------ | ------ |
| `calls`          | æŸ¥è¯¢æ‰§è¡Œæ¬¡æ•° | é«˜     |
| `mean_exec_time` | å¹³å‡æ‰§è¡Œæ—¶é—´ | **é«˜** |
| `max_exec_time`  | æœ€å¤§æ‰§è¡Œæ—¶é—´ | ä¸­     |
| `cache_hit_rate` | ç¼“å­˜å‘½ä¸­ç‡   | **é«˜** |

#### 2.2.2 å‘é‡æŸ¥è¯¢ QPS

**å‘é‡æŸ¥è¯¢ QPS ç»Ÿè®¡**:

```sql
-- å‘é‡æŸ¥è¯¢ QPS ç»Ÿè®¡
SELECT
    COUNT(*) as query_count,
    SUM(calls) as total_calls,
    AVG(mean_exec_time) as avg_latency,
    PERCENTILE_CONT(0.50) WITHIN GROUP (ORDER BY mean_exec_time) as p50_latency,
    PERCENTILE_CONT(0.95) WITHIN GROUP (ORDER BY mean_exec_time) as p95_latency,
    PERCENTILE_CONT(0.99) WITHIN GROUP (ORDER BY mean_exec_time) as p99_latency,
    MIN(mean_exec_time) as min_latency,
    MAX(mean_exec_time) as max_latency,
    AVG((shared_blks_hit::float / NULLIF(shared_blks_hit + shared_blks_read, 0))) * 100 as avg_cache_hit_rate
FROM pg_stat_statements
WHERE query LIKE '%<=>%' OR query LIKE '%<->%' OR query LIKE '%<#%';
```

**å‘é‡æŸ¥è¯¢æ€§èƒ½åŸºå‡†**:

| æ•°æ®é‡     | P50 å»¶è¿Ÿ  | P95 å»¶è¿Ÿ   | P99 å»¶è¿Ÿ   | QPS       |
| ---------- | --------- | ---------- | ---------- | --------- |
| **1 ä¸‡**   | **<5ms**  | **<10ms**  | **<20ms**  | **>2000** |
| **10 ä¸‡**  | **<10ms** | **<20ms**  | **<50ms**  | **>1000** |
| **100 ä¸‡** | **<50ms** | **<100ms** | **<200ms** | **>500**  |

#### 2.2.3 å‘é‡æŸ¥è¯¢å»¶è¿Ÿåˆ†æ

**å‘é‡æŸ¥è¯¢å»¶è¿Ÿè¶‹åŠ¿**:

```sql
-- å‘é‡æŸ¥è¯¢å»¶è¿Ÿè¶‹åŠ¿ï¼ˆéœ€è¦é…åˆæ—¶é—´åºåˆ—æ•°æ®åº“ï¼‰
SELECT
    time_bucket('5 minutes', timestamp) as time,
    AVG(duration_ms) as avg_duration,
    PERCENTILE_CONT(0.95) WITHIN GROUP (ORDER BY duration_ms) as p95_duration,
    PERCENTILE_CONT(0.99) WITHIN GROUP (ORDER BY duration_ms) as p99_duration,
    COUNT(*) as query_count
FROM query_logs
WHERE query_type = 'vector_search'
  AND timestamp > NOW() - INTERVAL '1 hour'
GROUP BY time
ORDER BY time;
```

### 2.3 ç´¢å¼•æ€§èƒ½ç›‘æ§

#### 2.3.1 HNSW ç´¢å¼•æ€§èƒ½

**HNSW ç´¢å¼•æ€§èƒ½ç›‘æ§**:

```sql
-- HNSW ç´¢å¼•æ€§èƒ½ç›‘æ§
SELECT
    tablename,
    indexname,
    idx_scan as scan_count,
    idx_tup_read as tuples_read,
    idx_tup_fetch as tuples_fetched,
    pg_size_pretty(pg_relation_size(indexrelid)) as index_size,
    pg_size_pretty(pg_relation_size((schemaname||'.'||tablename)::regclass)) as table_size,
    ROUND(
        100.0 * pg_relation_size(indexrelid) /
        NULLIF(pg_relation_size((schemaname||'.'||tablename)::regclass), 0),
        2
    ) as index_ratio
FROM pg_stat_user_indexes
WHERE indexdef LIKE '%hnsw%'
ORDER BY idx_scan DESC;
```

**HNSW ç´¢å¼•æ€§èƒ½æŒ‡æ ‡**:

| æŒ‡æ ‡          | æ­£å¸¸èŒƒå›´   | è¯´æ˜         |
| ------------- | ---------- | ------------ |
| `scan_count`  | **>1000**  | ç´¢å¼•æ‰«ææ¬¡æ•° |
| `index_ratio` | **<100%**  | ç´¢å¼•å¤§å°å æ¯” |
| `tuples_read` | **>10000** | è¯»å–å…ƒç»„æ•°   |

#### 2.3.2 IVFFlat ç´¢å¼•æ€§èƒ½

**IVFFlat ç´¢å¼•æ€§èƒ½ç›‘æ§**:

```sql
-- IVFFlat ç´¢å¼•æ€§èƒ½ç›‘æ§
SELECT
    tablename,
    indexname,
    idx_scan as scan_count,
    idx_tup_read as tuples_read,
    idx_tup_fetch as tuples_fetched,
    pg_size_pretty(pg_relation_size(indexrelid)) as index_size,
    pg_size_pretty(pg_relation_size((schemaname||'.'||tablename)::regclass)) as table_size,
    ROUND(
        100.0 * pg_relation_size(indexrelid) /
        NULLIF(pg_relation_size((schemaname||'.'||tablename)::regclass), 0),
        2
    ) as index_ratio
FROM pg_stat_user_indexes
WHERE indexdef LIKE '%ivfflat%'
ORDER BY idx_scan DESC;
```

#### 2.3.3 ç´¢å¼•æ•ˆç‡å¯¹æ¯”

**ç´¢å¼•æ•ˆç‡å¯¹æ¯”åˆ†æ**:

| ç´¢å¼•ç±»å‹    | æ‰«ææ¬¡æ•°  | å¹³å‡å»¶è¿Ÿ  | ç´¢å¼•å¤§å° | é€‚ç”¨åœºæ™¯        |
| ----------- | --------- | --------- | -------- | --------------- |
| **HNSW**    | **>1000** | **<10ms** | è¾ƒå¤§     | **<100 ä¸‡æ•°æ®** |
| **IVFFlat** | **>100**  | **<50ms** | è¾ƒå°     | **>100 ä¸‡æ•°æ®** |
| **æœªä½¿ç”¨**  | **<10**   | N/A       | N/A      | è€ƒè™‘åˆ é™¤        |

## 3. Prometheus é›†æˆ

### 3.1 postgres_exporter é…ç½®

#### 3.1.1 Exporter é…ç½®

**postgres_exporter é…ç½®**:

```yaml
# postgres_exporter.yml
data_source_names:
  - postgresql://postgres:password@localhost:5432/vector_db?sslmode=disable

queries:
  - name: "vector_query_performance"
    help: "å‘é‡æŸ¥è¯¢æ€§èƒ½æŒ‡æ ‡"
    values:
      - calls: calls
      - total_time: total_exec_time
      - mean_time: mean_exec_time
      - max_time: max_exec_time
    query: |
      SELECT 
        calls,
        total_exec_time,
        mean_exec_time,
        max_exec_time
      FROM pg_stat_statements
      WHERE query LIKE '%<=>%' OR query LIKE '%<->%' OR query LIKE '%<#%'
      ORDER BY mean_exec_time DESC
      LIMIT 10

  - name: "index_usage"
    help: "ç´¢å¼•ä½¿ç”¨æƒ…å†µ"
    values:
      - idx_scan: idx_scan
      - idx_tup_read: idx_tup_read
      - index_size: index_size_bytes
    query: |
      SELECT
        idx_scan,
        idx_tup_read,
        pg_relation_size(indexrelid) as index_size_bytes
      FROM pg_stat_user_indexes
      WHERE schemaname = 'public'
      ORDER BY idx_scan DESC
```

#### 3.1.2 è‡ªå®šä¹‰æŸ¥è¯¢

**è‡ªå®šä¹‰æŸ¥è¯¢é…ç½®**:

```yaml
# è‡ªå®šä¹‰æŸ¥è¯¢ç¤ºä¾‹
queries:
  - name: "vector_query_qps"
    help: "å‘é‡æŸ¥è¯¢ QPS"
    values:
      - qps: qps
    query: |
      SELECT
        SUM(calls) / 60.0 as qps
      FROM pg_stat_statements
      WHERE query LIKE '%<=>%' OR query LIKE '%<->%'

  - name: "cache_hit_rate"
    help: "ç¼“å­˜å‘½ä¸­ç‡"
    values:
      - hit_rate: hit_rate
    query: |
      SELECT
        (blks_hit::float / NULLIF(blks_hit + blks_read, 0)) * 100 as hit_rate
      FROM pg_stat_database
      WHERE datname = 'vector_db'
```

### 3.2 Grafana ä»ªè¡¨ç›˜é…ç½®

#### 3.2.1 ä»ªè¡¨ç›˜è®¾ç½®

**Grafana ä»ªè¡¨ç›˜ JSON**:

```json
{
  "dashboard": {
    "title": "PostgreSQL Vector Performance",
    "refresh": "5s",
    "panels": [
      {
        "id": 1,
        "title": "å‘é‡æŸ¥è¯¢å»¶è¿Ÿ (P95)",
        "type": "graph",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(pg_stat_statements_mean_exec_time{query=~'.*<=>.*'}[5m]))",
            "legendFormat": "P95 å»¶è¿Ÿ"
          }
        ]
      },
      {
        "id": 2,
        "title": "å‘é‡æŸ¥è¯¢ QPS",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(pg_stat_statements_calls{query=~'.*<=>.*'}[5m])",
            "legendFormat": "QPS"
          }
        ]
      },
      {
        "id": 3,
        "title": "ç´¢å¼•å¤§å°",
        "type": "graph",
        "targets": [
          {
            "expr": "pg_database_size_bytes{datname='vector_db'}",
            "legendFormat": "æ•°æ®åº“å¤§å°"
          }
        ]
      },
      {
        "id": 4,
        "title": "ç¼“å­˜å‘½ä¸­ç‡",
        "type": "graph",
        "targets": [
          {
            "expr": "pg_stat_database_blks_hit{datname='vector_db'} / (pg_stat_database_blks_hit{datname='vector_db'} + pg_stat_database_blks_read{datname='vector_db'})",
            "legendFormat": "å‘½ä¸­ç‡"
          }
        ]
      }
    ]
  }
}
```

#### 3.2.2 å¯è§†åŒ–é¢æ¿

**ä»ªè¡¨ç›˜é¢æ¿è¯´æ˜**:

| é¢æ¿             | ç±»å‹   | æŒ‡æ ‡     | æ›´æ–°é¢‘ç‡ | å‘Šè­¦é˜ˆå€¼ |
| ---------------- | ------ | -------- | -------- | -------- |
| **æŸ¥è¯¢å»¶è¿Ÿ**     | æŠ˜çº¿å›¾ | P95 å»¶è¿Ÿ | 5 åˆ†é’Ÿ   | >100ms   |
| **å‘é‡æŸ¥è¯¢ QPS** | æŠ˜çº¿å›¾ | QPS      | 5 åˆ†é’Ÿ   | -        |
| **ç´¢å¼•å¤§å°**     | æŠ˜çº¿å›¾ | æ€»å¤§å°   | 1 å°æ—¶   | >500GB   |
| **ç¼“å­˜å‘½ä¸­ç‡**   | æŠ˜çº¿å›¾ | å‘½ä¸­ç‡   | 5 åˆ†é’Ÿ   | <90%     |

## 4. æ€§èƒ½åˆ†æå·¥å…·

### 4.1 æ…¢æŸ¥è¯¢åˆ†æ

#### 4.1.1 æ…¢æŸ¥è¯¢æ—¥å¿—è§†å›¾

**åˆ›å»ºæ…¢æŸ¥è¯¢æ—¥å¿—è§†å›¾**:

```sql
-- åˆ›å»ºæ…¢æŸ¥è¯¢æ—¥å¿—è§†å›¾
CREATE OR REPLACE VIEW slow_queries AS
SELECT
    query,
    calls,
    total_exec_time,
    mean_exec_time,
    max_exec_time,
    min_exec_time,
    stddev_exec_time,
    (total_exec_time / NULLIF(calls, 0)) as avg_time_per_call,
    rows,
    (shared_blks_hit::float / NULLIF(shared_blks_hit + shared_blks_read, 0)) * 100 as cache_hit_rate,
    ROW_NUMBER() OVER (ORDER BY mean_exec_time DESC) as rank
FROM pg_stat_statements
WHERE mean_exec_time > 100  -- è¶…è¿‡ 100ms
ORDER BY mean_exec_time DESC
LIMIT 50;

-- æŸ¥çœ‹æ…¢æŸ¥è¯¢
SELECT * FROM slow_queries;
```

#### 4.1.2 æ…¢æŸ¥è¯¢åˆ†æ

**æ…¢æŸ¥è¯¢è¯¦ç»†åˆ†æ**:

```sql
-- æ…¢æŸ¥è¯¢è¯¦ç»†åˆ†æ
SELECT
    query,
    calls,
    total_exec_time,
    mean_exec_time,
    max_exec_time,
    (total_exec_time / NULLIF(calls, 0)) as avg_time_per_call,
    CASE
        WHEN mean_exec_time > 1000 THEN 'ä¸¥é‡'
        WHEN mean_exec_time > 500 THEN 'è­¦å‘Š'
        WHEN mean_exec_time > 100 THEN 'æ³¨æ„'
        ELSE 'æ­£å¸¸'
    END as severity
FROM pg_stat_statements
WHERE mean_exec_time > 100
ORDER BY mean_exec_time DESC
LIMIT 20;
```

### 4.2 æŸ¥è¯¢è®¡åˆ’åˆ†æ

#### 4.2.1 EXPLAIN åˆ†æ

**æŸ¥è¯¢è®¡åˆ’åˆ†æ**:

```sql
-- åˆ†æå‘é‡æŸ¥è¯¢è®¡åˆ’
EXPLAIN (ANALYZE, BUFFERS, VERBOSE, FORMAT JSON)
SELECT
    id,
    content,
    1 - (embedding <=> '[0.1, 0.2, 0.3, ...]'::vector(1536)) as similarity
FROM documents
ORDER BY embedding <=> '[0.1, 0.2, 0.3, ...]'::vector(1536)
LIMIT 10;

-- æ–‡æœ¬æ ¼å¼è¾“å‡ºï¼ˆæ›´æ˜“è¯»ï¼‰
EXPLAIN (ANALYZE, BUFFERS, VERBOSE)
SELECT
    id,
    content,
    1 - (embedding <=> '[0.1, 0.2, 0.3, ...]'::vector(1536)) as similarity
FROM documents
ORDER BY embedding <=> '[0.1, 0.2, 0.3, ...]'::vector(1536)
LIMIT 10;
```

#### 4.2.2 æŸ¥è¯¢è®¡åˆ’ä¼˜åŒ–

**æŸ¥è¯¢è®¡åˆ’å…³é”®æŒ‡æ ‡**:

| æŒ‡æ ‡                     | è¯´æ˜         | ä¼˜åŒ–å»ºè®®              |
| ------------------------ | ------------ | --------------------- |
| **Execution Time**       | æ‰§è¡Œæ—¶é—´     | å¦‚æœ >100msï¼Œè€ƒè™‘ä¼˜åŒ– |
| **Planning Time**        | è®¡åˆ’æ—¶é—´     | å¦‚æœ >10msï¼Œè€ƒè™‘ä¼˜åŒ–  |
| **Buffers: shared hit**  | å…±äº«ç¼“å­˜å‘½ä¸­ | å‘½ä¸­ç‡åº” >90%         |
| **Buffers: shared read** | å…±äº«ç¼“å­˜è¯»å– | è¯»å–æ¬¡æ•°åº”å°½å¯èƒ½å°‘    |

## 5. æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 5.1 åŸºäºç›‘æ§æ•°æ®çš„ä¼˜åŒ–

#### 5.1.1 è¯†åˆ«æœªä½¿ç”¨çš„ç´¢å¼•

**è¯†åˆ«æœªä½¿ç”¨çš„ç´¢å¼•**:

```sql
-- è¯†åˆ«æœªä½¿ç”¨çš„ç´¢å¼•
SELECT
    schemaname,
    tablename,
    indexname,
    idx_scan as scan_count,
    pg_size_pretty(pg_relation_size(indexrelid)) as index_size,
    pg_size_pretty(pg_relation_size((schemaname||'.'||tablename)::regclass)) as table_size,
    CASE
        WHEN idx_scan = 0 THEN 'æœªä½¿ç”¨ - è€ƒè™‘åˆ é™¤'
        WHEN idx_scan < 10 AND pg_relation_size(indexrelid) > 10485760 THEN 'ä½ä½¿ç”¨ - è€ƒè™‘åˆ é™¤'
        ELSE 'æ­£å¸¸'
    END as recommendation
FROM pg_stat_user_indexes
WHERE idx_scan < 10
  AND pg_relation_size(indexrelid) > 1048576  -- å¤§äº 1MB
ORDER BY pg_relation_size(indexrelid) DESC;
```

**ç´¢å¼•ä¼˜åŒ–å»ºè®®**:

| æ‰«ææ¬¡æ•° | ç´¢å¼•å¤§å°  | å»ºè®®     |
| -------- | --------- | -------- |
| **0**    | **>1MB**  | **åˆ é™¤** |
| **<10**  | **>10MB** | **åˆ é™¤** |
| **<10**  | **<1MB**  | **ä¿ç•™** |

#### 5.1.2 è¯†åˆ«éœ€è¦ VACUUM çš„è¡¨

**è¯†åˆ«éœ€è¦ VACUUM çš„è¡¨**:

```sql
-- è¯†åˆ«éœ€è¦ VACUUM çš„è¡¨
SELECT
    schemaname,
    tablename,
    n_live_tup as live_tuples,
    n_dead_tup as dead_tuples,
    (n_dead_tup::float / NULLIF(n_live_tup + n_dead_tup, 0)) * 100 as dead_tuple_ratio,
    pg_size_pretty(pg_total_relation_size((schemaname||'.'||tablename)::regclass)) as table_size,
    last_vacuum,
    last_autovacuum,
    CASE
        WHEN n_dead_tup > 10000 AND (n_dead_tup::float / NULLIF(n_live_tup, 0)) > 0.2 THEN 'ç´§æ€¥ VACUUM'
        WHEN n_dead_tup > 1000 AND (n_dead_tup::float / NULLIF(n_live_tup, 0)) > 0.1 THEN 'å»ºè®® VACUUM'
        ELSE 'æ­£å¸¸'
    END as recommendation
FROM pg_stat_user_tables
WHERE n_dead_tup > 1000
ORDER BY n_dead_tup DESC;
```

**VACUUM ä¼˜åŒ–å»ºè®®**:

| æ­»å…ƒç»„æ¯”ä¾‹ | æ­»å…ƒç»„æ•°é‡ | å»ºè®®            |
| ---------- | ---------- | --------------- |
| **>20%**   | **>10000** | **ç´§æ€¥ VACUUM** |
| **>10%**   | **>1000**  | **å»ºè®® VACUUM** |
| **<10%**   | **<1000**  | **æ­£å¸¸**        |

### 5.2 è‡ªåŠ¨åŒ–ä¼˜åŒ–è„šæœ¬

#### 5.2.1 Python ä¼˜åŒ–è„šæœ¬

**è‡ªåŠ¨åŒ–ä¼˜åŒ–è„šæœ¬**:

```python
# optimize.py
import psycopg2
from psycopg2.extras import RealDictCursor
import logging

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

DATABASE_URL = "postgresql://postgres:postgres@localhost:5432/vector_db"

def analyze_and_optimize():
    """åˆ†æå¹¶ä¼˜åŒ–"""
    conn = psycopg2.connect(DATABASE_URL)
    cur = conn.cursor(cursor_factory=RealDictCursor)

    try:
        # 1. æ£€æŸ¥éœ€è¦ VACUUM çš„è¡¨
        cur.execute("""
            SELECT schemaname, tablename, n_dead_tup
            FROM pg_stat_user_tables
            WHERE n_dead_tup > 1000
              AND (n_dead_tup::float / NULLIF(n_live_tup, 0)) > 0.1
            ORDER BY n_dead_tup DESC
        """)

        for row in cur.fetchall():
            logger.info(f"æ‰§è¡Œ VACUUM ANALYZE: {row['schemaname']}.{row['tablename']}")
            cur.execute(f"VACUUM ANALYZE {row['schemaname']}.{row['tablename']}")
            conn.commit()

        # 2. æ£€æŸ¥éœ€è¦é‡å»ºçš„ç´¢å¼•
        cur.execute("""
            SELECT schemaname, tablename, indexname, idx_scan
            FROM pg_stat_user_indexes
            WHERE idx_scan = 0
              AND pg_relation_size(indexrelid) > 1048576  -- å¤§äº 1MB
        """)

        unused_indexes = cur.fetchall()
        if unused_indexes:
            logger.warning(f"å‘ç° {len(unused_indexes)} ä¸ªæœªä½¿ç”¨çš„ç´¢å¼•ï¼ˆ>1MBï¼‰")
            for row in unused_indexes:
                logger.info(f"è€ƒè™‘åˆ é™¤æœªä½¿ç”¨çš„ç´¢å¼•: {row['indexname']}")
                # æ³¨æ„ï¼šåˆ é™¤ç´¢å¼•éœ€è¦è°¨æ…ï¼Œå»ºè®®å…ˆæ‰‹åŠ¨ç¡®è®¤

        # 3. æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        cur.execute("ANALYZE")
        conn.commit()
        logger.info("ç»Ÿè®¡ä¿¡æ¯æ›´æ–°å®Œæˆ")

    except Exception as e:
        logger.error(f"ä¼˜åŒ–é”™è¯¯: {e}")
        conn.rollback()
    finally:
        conn.close()

if __name__ == "__main__":
    analyze_and_optimize()
```

#### 5.2.2 è‡ªåŠ¨åŒ–è°ƒåº¦

**ä½¿ç”¨ cron æˆ– systemd å®šæ—¶ä»»åŠ¡**:

```bash
# ä½¿ç”¨ cron æ¯å¤©å‡Œæ™¨ 2 ç‚¹æ‰§è¡Œ
# crontab -e
0 2 * * * /usr/bin/python3 /path/to/optimize.py >> /var/log/postgres_optimize.log 2>&1
```

**ä½¿ç”¨ systemd timer**:

```ini
# /etc/systemd/system/postgres-optimize.service
[Unit]
Description=PostgreSQL Optimization Script
After=postgresql.service

[Service]
Type=oneshot
ExecStart=/usr/bin/python3 /path/to/optimize.py
User=postgres

# /etc/systemd/system/postgres-optimize.timer
[Unit]
Description=Run PostgreSQL Optimization Daily
Requires=postgres-optimize.service

[Timer]
OnCalendar=daily
AccuracySec=1h
Persistent=true

[Install]
WantedBy=timers.target
```

## 6. æ€§èƒ½åŸºå‡†æµ‹è¯•

### 6.1 åŸºå‡†æµ‹è¯•è„šæœ¬

**æ€§èƒ½åŸºå‡†æµ‹è¯•è„šæœ¬**:

```sql
-- benchmark.sql
CREATE OR REPLACE FUNCTION benchmark_vector_search(
    test_rows INTEGER DEFAULT 100000,
    test_queries INTEGER DEFAULT 1000
) RETURNS TABLE (
    metric TEXT,
    value NUMERIC
) AS $$
DECLARE
    start_time TIMESTAMPTZ;
    end_time TIMESTAMPTZ;
    elapsed INTERVAL;
    query_vector vector(1536);
BEGIN
    -- åˆ›å»ºæµ‹è¯•è¡¨
    CREATE TABLE IF NOT EXISTS benchmark_docs (
        id SERIAL PRIMARY KEY,
        content TEXT,
        embedding vector(1536)
    );

    -- æ¸…ç©ºæµ‹è¯•æ•°æ®
    TRUNCATE benchmark_docs;

    -- æ’å…¥æµ‹è¯•æ•°æ®
    INSERT INTO benchmark_docs (content, embedding)
    SELECT
        'Document ' || i,
        (SELECT array_agg(random())::vector(1536)
         FROM generate_series(1, 1536))
    FROM generate_series(1, test_rows);

    -- åˆ›å»ºç´¢å¼•
    CREATE INDEX IF NOT EXISTS benchmark_docs_idx
    ON benchmark_docs
    USING hnsw (embedding vector_cosine_ops)
    WITH (m = 16, ef_construction = 64);

    -- åŸºå‡†æµ‹è¯•
    start_time := clock_timestamp();

    FOR i IN 1..test_queries LOOP
        query_vector := (SELECT array_agg(random())::vector(1536)
                       FROM generate_series(1, 1536));

        PERFORM * FROM (
            SELECT * FROM benchmark_docs
            ORDER BY embedding <=> query_vector
            LIMIT 10
        ) q;
    END LOOP;

    end_time := clock_timestamp();
    elapsed := end_time - start_time;

    -- è¿”å›ç»“æœ
    RETURN QUERY SELECT 'æ€»è€—æ—¶ (ç§’)'::TEXT, EXTRACT(EPOCH FROM elapsed);
    RETURN QUERY SELECT 'å¹³å‡å»¶è¿Ÿ (ms)'::TEXT, EXTRACT(EPOCH FROM elapsed) / test_queries * 1000;
    RETURN QUERY SELECT 'QPS'::TEXT, test_queries / EXTRACT(EPOCH FROM elapsed);
END;
$$ LANGUAGE plpgsql;

-- è¿è¡ŒåŸºå‡†æµ‹è¯•
SELECT * FROM benchmark_vector_search(100000, 1000);
```

### 6.2 æ€§èƒ½å¯¹æ¯”åˆ†æ

**æ€§èƒ½åŸºå‡†æµ‹è¯•ç»“æœ**:

| æ•°æ®è§„æ¨¡   | ç´¢å¼•ç±»å‹ | P50 å»¶è¿Ÿ  | P95 å»¶è¿Ÿ   | P99 å»¶è¿Ÿ   | QPS       |
| ---------- | -------- | --------- | ---------- | ---------- | --------- |
| **1 ä¸‡**   | HNSW     | **<5ms**  | **<10ms**  | **<20ms**  | **>2000** |
| **10 ä¸‡**  | HNSW     | **<10ms** | **<20ms**  | **<50ms**  | **>1000** |
| **100 ä¸‡** | IVFFlat  | **<50ms** | **<100ms** | **<200ms** | **>500**  |

## 7. æœ€ä½³å®è·µ

### 7.1 ç›‘æ§æŒ‡æ ‡é€‰æ‹©

**ç›‘æ§æŒ‡æ ‡é€‰æ‹©åŸåˆ™**:

1. **å…³é”®æŒ‡æ ‡ä¼˜å…ˆ**: ä¼˜å…ˆç›‘æ§å½±å“ä¸šåŠ¡çš„å…³é”®æŒ‡æ ‡ï¼ˆæŸ¥è¯¢å»¶è¿Ÿã€QPSï¼‰
2. **å…¨é¢è¦†ç›–**: è¦†ç›–æ€§èƒ½ã€èµ„æºã€ç´¢å¼•ç­‰å„ä¸ªæ–¹é¢
3. **åˆç†é¢‘ç‡**: æ ¹æ®æŒ‡æ ‡ç‰¹æ€§è®¾ç½®åˆç†çš„é‡‡é›†é¢‘ç‡
4. **æˆæœ¬æ§åˆ¶**: å¹³è¡¡ç›‘æ§æˆæœ¬å’Œç›‘æ§ä»·å€¼

### 7.2 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

**æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**:

1. **å®šæœŸ VACUUM**: å®šæœŸæ¸…ç†æ­»å…ƒç»„ï¼Œä¿æŒè¡¨å¥åº·
2. **ç´¢å¼•ä¼˜åŒ–**: åˆ é™¤æœªä½¿ç”¨çš„ç´¢å¼•ï¼Œä¼˜åŒ–ç´¢å¼•å‚æ•°
3. **æŸ¥è¯¢ä¼˜åŒ–**: åŸºäºæ…¢æŸ¥è¯¢æ—¥å¿—ä¼˜åŒ–æŸ¥è¯¢è¯­å¥
4. **èµ„æºä¼˜åŒ–**: æ ¹æ®ç›‘æ§æ•°æ®è°ƒæ•´èµ„æºåˆ†é…

## 8. å‚è€ƒèµ„æ–™

### 8.1 å®˜æ–¹æ–‡æ¡£

- [PostgreSQL æ€§èƒ½ç›‘æ§](https://www.postgresql.org/docs/current/monitoring-stats.html) - Monitoring
  Stats
- [pg_stat_statements æ–‡æ¡£](https://www.postgresql.org/docs/current/pgstatstatements.html) -
  pg_stat_statements

### 8.2 æŠ€æœ¯æ–‡æ¡£

- [ç›‘æ§ä¸å‘Šè­¦](./ç›‘æ§ä¸å‘Šè­¦.md) - Monitoring and Alerting
- [æ€§èƒ½è°ƒä¼˜æŠ€å·§](../../01-å‘é‡ä¸æ··åˆæœç´¢/æœ€ä½³å®è·µ/æ€§èƒ½è°ƒä¼˜æŠ€å·§.md) - Performance Tuning

### 8.3 ç›¸å…³èµ„æº

- [PostgreSQL æ€§èƒ½ä¼˜åŒ–æŒ‡å—](https://www.postgresql.org/docs/current/performance-tips.html) -
  Performance Tips
- [æŸ¥è¯¢ä¼˜åŒ–æœ€ä½³å®è·µ](https://www.postgresql.org/docs/current/using-explain.html) - Using EXPLAIN

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥  
**ç»´æŠ¤è€…**: PostgreSQL Modern Team  
**æ–‡æ¡£ç¼–å·**: 09-02-02
