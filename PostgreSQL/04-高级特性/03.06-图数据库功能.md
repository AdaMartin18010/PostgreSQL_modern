# å›¾æ•°æ®åº“åŠŸèƒ½

> **æ–‡æ¡£ç‰ˆæœ¬**: v2.0
> **æœ€åæ›´æ–°**: 2025-11-12
> **ç‰ˆæœ¬è¦†ç›–**: PostgreSQL 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x (å…¼å®¹)
> **æ–‡æ¡£çŠ¶æ€**: âœ… å·²æ›´æ–°
>
> âš ï¸ **é‡è¦æç¤º**: æœ¬æ–‡æ¡£å·²è¿ç§»å¹¶å‡çº§è‡³ `å¤šæ¨¡å‹é›†æˆ/` ä¸“é¢˜ç›®å½•
>
> **ğŸ‘‰ æ¨èé˜…è¯»æ–°æ–‡æ¡£**:
>
> - ğŸ¯ **[å¤šæ¨¡å‹é›†æˆä¸“é¢˜ç›®å½•](./å¤šæ¨¡å‹é›†æˆ/README.md)** â­â­â­â­â­ - å®Œæ•´æ–‡æ¡£ç´¢å¼•å’Œå¯¼èˆª
> - ğŸ“š **[å›¾æ•°æ®åº“åŠŸèƒ½ï¼ˆæ–°ç‰ˆï¼‰](./å¤šæ¨¡å‹é›†æˆ/04.06-å›¾æ•°æ®åº“åŠŸèƒ½.md)** â­â­â­â­ - å®Œæ•´æŒ‡å—ï¼ˆv2.0ï¼‰
> - ğŸ“Š **[å‘é‡æ•°æ®åº“æ”¯æŒï¼ˆæ–°ç‰ˆï¼‰](./å¤šæ¨¡å‹é›†æˆ/04.05-å‘é‡æ•°æ®åº“æ”¯æŒ.md)** â­â­â­â­â­ - å‘é‡æ•°æ®åº“å®Œæ•´æŒ‡å—
>
> **æœ¬æ–‡æ¡£ä¿ç•™ä½œä¸ºåŸºç¡€æ¦‚è¿°**ï¼Œæä¾›å›¾æ•°æ®åº“åŠŸèƒ½çš„åŸºç¡€æ¦‚è¿°ã€‚å¦‚éœ€è¯¦ç»†å†…å®¹ï¼Œè¯·å‚è€ƒï¼š
>
> - ğŸ“‹ [AI æ—¶ä»£ä¸“é¢˜ - å¤šæ¨¡ä¸€ä½“åŒ–](../05-å‰æ²¿æŠ€æœ¯/AI-æ—¶ä»£/ai_view.md) â­â­â­ (v3.0, 2025-11-11)
> - ğŸ“Š [å‘é‡æ•°æ®åº“æ”¯æŒ](./03.05-å‘é‡æ•°æ®åº“æ”¯æŒ.md) (PG 18+ â­)

---

## ğŸ“‹ ç›®å½•

- [å›¾æ•°æ®åº“åŠŸèƒ½](#å›¾æ•°æ®åº“åŠŸèƒ½)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [ğŸ“Š æ€ç»´å¯¼å›¾](#-æ€ç»´å¯¼å›¾)
  - [ğŸ“Š å¤šç»´æ¦‚å¿µçŸ©é˜µå¯¹æ¯”](#-å¤šç»´æ¦‚å¿µçŸ©é˜µå¯¹æ¯”)
    - [å›¾æ•°æ®æ¨¡å‹å¯¹æ¯”çŸ©é˜µ](#å›¾æ•°æ®æ¨¡å‹å¯¹æ¯”çŸ©é˜µ)
    - [å›¾æŸ¥è¯¢æ–¹æ³•å¯¹æ¯”çŸ©é˜µ](#å›¾æŸ¥è¯¢æ–¹æ³•å¯¹æ¯”çŸ©é˜µ)
    - [å›¾ç®—æ³•å®ç°å¯¹æ¯”çŸ©é˜µ](#å›¾ç®—æ³•å®ç°å¯¹æ¯”çŸ©é˜µ)
  - [ğŸŒ Wikipediaå¯¹é½](#-wikipediaå¯¹é½)
    - [å›¾æ•°æ®åº“æ¦‚å¿µå¯¹é½](#å›¾æ•°æ®åº“æ¦‚å¿µå¯¹é½)
    - [11.2 å±æ€§å›¾æ¨¡å‹æ¦‚å¿µå¯¹é½](#112-å±æ€§å›¾æ¨¡å‹æ¦‚å¿µå¯¹é½)
    - [11.3 CypheræŸ¥è¯¢è¯­è¨€å¯¹é½](#113-cypheræŸ¥è¯¢è¯­è¨€å¯¹é½)
    - [11.4 PostgreSQLå›¾æ•°æ®åº“å¯¹é½](#114-postgresqlå›¾æ•°æ®åº“å¯¹é½)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
  - [2. å±æ€§å›¾æ¨¡å‹](#2-å±æ€§å›¾æ¨¡å‹)
  - [3. SQL/PGQL é£æ ¼æŸ¥è¯¢](#3-sqlpgql-é£æ ¼æŸ¥è¯¢)
  - [4. å›¾ç®—æ³•ä¸å®ç°](#4-å›¾ç®—æ³•ä¸å®ç°)
    - [4.1 Apache AGEï¼ˆå¼€æ”¾Cypher on PostgreSQLï¼‰](#41-apache-ageå¼€æ”¾cypher-on-postgresql)
    - [4.2 PG-Cypher/FDW æ··åˆ](#42-pg-cypherfdw-æ··åˆ)
  - [5. ä¸å‘é‡/å…¨æ–‡/JSON çš„æ··åˆ](#5-ä¸å‘é‡å…¨æ–‡json-çš„æ··åˆ)
  - [6. çº¦æŸä¸ä¸€è‡´æ€§](#6-çº¦æŸä¸ä¸€è‡´æ€§)
  - [7. æ€§èƒ½ä¸è¿ç»´](#7-æ€§èƒ½ä¸è¿ç»´)
  - [8. ç¤ºä¾‹å»ºæ¨¡è„šæœ¬](#8-ç¤ºä¾‹å»ºæ¨¡è„šæœ¬)
  - [9. äº¤å‰å¼•ç”¨](#9-äº¤å‰å¼•ç”¨)
    - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)
      - [é«˜çº§ç‰¹æ€§](#é«˜çº§ç‰¹æ€§)
      - [æ ¸å¿ƒè¯¾ç¨‹](#æ ¸å¿ƒè¯¾ç¨‹)
      - [æ•°æ®æ¨¡å‹è®¾è®¡](#æ•°æ®æ¨¡å‹è®¾è®¡)
      - [å·¥å…·èµ„æº](#å·¥å…·èµ„æº)
  - [10. å½¢å¼è¯æ˜ä¸ç†è®ºè®ºè¯](#10-å½¢å¼è¯æ˜ä¸ç†è®ºè®ºè¯)
    - [10.1 å›¾éå†æ­£ç¡®æ€§è¯æ˜](#101-å›¾éå†æ­£ç¡®æ€§è¯æ˜)
    - [10.2 æœ€çŸ­è·¯å¾„ç®—æ³•æ­£ç¡®æ€§è¯æ˜](#102-æœ€çŸ­è·¯å¾„ç®—æ³•æ­£ç¡®æ€§è¯æ˜)
    - [10.3 å›¾æŸ¥è¯¢ç­‰ä»·æ€§è¯æ˜](#103-å›¾æŸ¥è¯¢ç­‰ä»·æ€§è¯æ˜)
  - [11. Wikipediaå¯¹é½](#11-wikipediaå¯¹é½)
    - [11.1 å›¾æ•°æ®åº“æ¦‚å¿µå¯¹é½](#111-å›¾æ•°æ®åº“æ¦‚å¿µå¯¹é½)
    - [11.2 å±æ€§å›¾æ¨¡å‹æ¦‚å¿µå¯¹é½](#112-å±æ€§å›¾æ¨¡å‹æ¦‚å¿µå¯¹é½-1)
    - [11.3 CypheræŸ¥è¯¢è¯­è¨€å¯¹é½](#113-cypheræŸ¥è¯¢è¯­è¨€å¯¹é½-1)
    - [11.4 PostgreSQLå›¾æ•°æ®åº“å¯¹é½](#114-postgresqlå›¾æ•°æ®åº“å¯¹é½-1)
  - [12. å‚è€ƒæ–‡çŒ®](#12-å‚è€ƒæ–‡çŒ®)

---

## ğŸ“Š æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((å›¾æ•°æ®åº“åŠŸèƒ½))
    å±æ€§å›¾æ¨¡å‹
      é¡¶ç‚¹æ¨¡å‹
        é¡¶ç‚¹ID
        é¡¶ç‚¹æ ‡ç­¾
        é¡¶ç‚¹å±æ€§
      è¾¹æ¨¡å‹
        è¾¹ID
        æºé¡¶ç‚¹
        ç›®æ ‡é¡¶ç‚¹
        è¾¹æ ‡ç­¾
        è¾¹å±æ€§
      å­˜å‚¨å»ºæ¨¡
        é¡¶ç‚¹è¡¨
        è¾¹è¡¨
        ç´¢å¼•è®¾è®¡
    æŸ¥è¯¢è¯­è¨€
      SQLæŸ¥è¯¢
        ç›´æ¥é‚»å±…
        kæ­¥å¯è¾¾
        æœ€çŸ­è·¯å¾„
      CypheræŸ¥è¯¢
        Apache AGE
        PG-Cypher
        æ¨¡å¼åŒ¹é…
    å›¾ç®—æ³•
      è·¯å¾„ç®—æ³•
        æœ€çŸ­è·¯å¾„
        BFS/DFS
        è·¯å¾„æšä¸¾
      ä¸­å¿ƒæ€§ç®—æ³•
        PageRank
        åº¦ä¸­å¿ƒæ€§
        æ¥è¿‘ä¸­å¿ƒæ€§
      è¿é€šæ€§ç®—æ³•
        è¿é€šåˆ†é‡
        å¼ºè¿é€šåˆ†é‡
        å¼±è¿é€šåˆ†é‡
    æ··åˆæŸ¥è¯¢
      å›¾+å‘é‡
        å›¾éå†+å‘é‡æ£€ç´¢
        æ··åˆç›¸ä¼¼åº¦
      å›¾+å…¨æ–‡
        å›¾éå†+å…¨æ–‡æœç´¢
        ç›¸å…³æ€§èåˆ
      å›¾+JSONB
        å±æ€§è¿‡æ»¤
        å›¾æŸ¥è¯¢
    æ€§èƒ½ä¼˜åŒ–
      ç´¢å¼•ä¼˜åŒ–
        é¡¶ç‚¹ç´¢å¼•
        è¾¹ç´¢å¼•
        å±æ€§ç´¢å¼•
      æŸ¥è¯¢ä¼˜åŒ–
        è·¯å¾„å‰ªæ
        æ‰¹é‡å¤„ç†
    åº”ç”¨æ¡ˆä¾‹
      ç¤¾äº¤ç½‘ç»œ
        å¥½å‹æ¨è
        å½±å“åŠ›åˆ†æ
      çŸ¥è¯†å›¾è°±
        å®ä½“å…³ç³»
        è¯­ä¹‰æŸ¥è¯¢
```

---

## ğŸ“Š å¤šç»´æ¦‚å¿µçŸ©é˜µå¯¹æ¯”

### å›¾æ•°æ®æ¨¡å‹å¯¹æ¯”çŸ©é˜µ

| å›¾æ¨¡å‹ | é¡¶ç‚¹è¡¨ç¤º | è¾¹è¡¨ç¤º | å±æ€§å­˜å‚¨ | æŸ¥è¯¢èƒ½åŠ› | é€‚ç”¨åœºæ™¯ | PostgreSQLæ”¯æŒ |
|--------|---------|--------|---------|---------|---------|---------------|
| **å±æ€§å›¾æ¨¡å‹** | è¡¨è¡Œ | è¡¨è¡Œ | JSONB | é«˜ | é€šç”¨åœºæ™¯ | âœ… åŸç”Ÿæ”¯æŒ |
| **è¾¹åˆ—è¡¨æ¨¡å‹** | ID | (src, dst) | åˆ†ç¦»è¡¨ | ä¸­ | ç®€å•å›¾ | âœ… æ”¯æŒ |
| **é‚»æ¥è¡¨æ¨¡å‹** | ID | æ•°ç»„åˆ— | JSONB | ä¸­ | å°å›¾ | âœ… æ”¯æŒ |
| **ä¸‰å…ƒç»„æ¨¡å‹** | èµ„æº | (ä¸»ä½“,è°“è¯,å®¢ä½“) | åˆ†ç¦» | é«˜ | RDFå›¾ | âœ… æ”¯æŒ |

### å›¾æŸ¥è¯¢æ–¹æ³•å¯¹æ¯”çŸ©é˜µ

| æŸ¥è¯¢æ–¹æ³• | è¡¨è¾¾èƒ½åŠ› | æ€§èƒ½ | å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ | PostgreSQLæ”¯æŒ |
|---------|---------|------|--------|---------|---------------|
| **SQLé€’å½’CTE** | é«˜ | ä¸­ | ä¸­ | è·¯å¾„æŸ¥è¯¢ | âœ… åŸç”Ÿæ”¯æŒ |
| **Cypher (AGE)** | å¾ˆé«˜ | é«˜ | ä½ | å¤æ‚å›¾æŸ¥è¯¢ | âœ… Apache AGE |
| **å­˜å‚¨è¿‡ç¨‹** | é«˜ | é«˜ | é«˜ | è‡ªå®šä¹‰ç®—æ³• | âœ… åŸç”Ÿæ”¯æŒ |
| **å¤–éƒ¨å›¾å¼•æ“** | æé«˜ | å¾ˆé«˜ | é«˜ | å¤§è§„æ¨¡å›¾ | âœ… FDWæ”¯æŒ |

### å›¾ç®—æ³•å®ç°å¯¹æ¯”çŸ©é˜µ

| å›¾ç®—æ³• | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ | å¹¶è¡ŒåŒ– | é€‚ç”¨åœºæ™¯ | PostgreSQLå®ç° |
|---------|-----------|-----------|--------|---------|---------------|
| **BFSæœ€çŸ­è·¯å¾„** | O(V+E) | O(V) | æœ‰é™ | æ— æƒå›¾ | âœ… é€’å½’CTE |
| **DFSéå†** | O(V+E) | O(V) | æœ‰é™ | æ·±åº¦ä¼˜å…ˆ | âœ… é€’å½’CTE |
| **PageRank** | O(kÃ—E) | O(V) | æ”¯æŒ | å½±å“åŠ›åˆ†æ | âš ï¸ æœ‰é™æ”¯æŒ |
| **è¿é€šåˆ†é‡** | O(V+E) | O(V) | æ”¯æŒ | è¿é€šæ€§åˆ†æ | âš ï¸ æœ‰é™æ”¯æŒ |

---

## ğŸŒ Wikipediaå¯¹é½

### å›¾æ•°æ®åº“æ¦‚å¿µå¯¹é½

**Wikipediaå®šä¹‰**: [Graph database](https://en.wikipedia.org/wiki/Graph_database)

> A graph database is a database that uses graph structures for semantic queries with nodes, edges, and properties to represent and store data.

**å¯¹é½è¯´æ˜**:

- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒå›¾æ•°æ®åº“ä½¿ç”¨å›¾ç»“æ„ï¼ˆèŠ‚ç‚¹ã€è¾¹ã€å±æ€§ï¼‰è¡¨ç¤ºå’Œå­˜å‚¨æ•°æ®
- âœ… **æ ¸å¿ƒæ¦‚å¿µ**: éƒ½åŒ…å«é¡¶ç‚¹ã€è¾¹ã€å±æ€§ç­‰æ ¸å¿ƒæ¦‚å¿µ
- âœ… **æŸ¥è¯¢èƒ½åŠ›**: éƒ½æåˆ°è¯­ä¹‰æŸ¥è¯¢ã€å›¾éå†ç­‰æŸ¥è¯¢èƒ½åŠ›

### 11.2 å±æ€§å›¾æ¨¡å‹æ¦‚å¿µå¯¹é½

**Wikipediaå®šä¹‰**: [Property graph model](https://en.wikipedia.org/wiki/Property_graph_model)

> The property graph model is a graph data model that represents entities as nodes and relationships as edges, where both nodes and edges can have properties.

**å¯¹é½è¯´æ˜**:

- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒå±æ€§å›¾æ¨¡å‹ä¸­èŠ‚ç‚¹å’Œè¾¹éƒ½å¯ä»¥æœ‰å±æ€§
- âœ… **å­˜å‚¨æ–¹å¼**: PostgreSQLä½¿ç”¨è¡¨+JSONBçš„æ–¹å¼å®ç°å±æ€§å›¾æ¨¡å‹
- âœ… **æŸ¥è¯¢èƒ½åŠ›**: éƒ½æ”¯æŒåŸºäºå±æ€§çš„æŸ¥è¯¢å’Œè¿‡æ»¤

### 11.3 CypheræŸ¥è¯¢è¯­è¨€å¯¹é½

**Wikipediaå®šä¹‰**: [Cypher (query language)](https://en.wikipedia.org/wiki/Cypher_(query_language))

> Cypher is a declarative graph query language that allows for expressive and efficient querying and updating of a property graph.

**å¯¹é½è¯´æ˜**:

- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒCypheræ˜¯å£°æ˜å¼çš„å›¾æŸ¥è¯¢è¯­è¨€
- âœ… **æ ¸å¿ƒç‰¹æ€§**: éƒ½æåˆ°æ¨¡å¼åŒ¹é…ã€è·¯å¾„æŸ¥è¯¢ç­‰æ ¸å¿ƒç‰¹æ€§
- âœ… **å®ç°æ–¹å¼**: Apache AGEåœ¨PostgreSQLä¸Šå®ç°äº†CypheræŸ¥è¯¢è¯­è¨€

### 11.4 PostgreSQLå›¾æ•°æ®åº“å¯¹é½

- **Wikidata ID**: Q192490
- **ç›¸å…³å±æ€§**:
  - P31: Q176165 (instance of: database management system)
  - P178: Q9366 (developer: PostgreSQL Global Development Group)
  - P277: Q193321 (programmed in: C)
  - P348: 18.0 (software version)
- **å¤–éƒ¨é“¾æ¥**:
  - <https://www.postgresql.org/docs/current/queries-with.html>
  - [Apache AGE](https://age.apache.org/)

---

## 1. æ¦‚è¿°

- å›¾æ•°æ®å»ºæ¨¡ã€å›¾æŸ¥è¯¢ã€å›¾ç®—æ³•ï¼Œå±æ€§å›¾ä¸è·¯å¾„åˆ†æã€‚

## 2. å±æ€§å›¾æ¨¡å‹

- å…ƒç´ ï¼š`Vertex(v_id, label, properties)`ï¼›`Edge(e_id, src, dst, label, properties)`ã€‚
- è¯­ä¹‰ï¼šå±æ€§é”®å€¼å¯¹ï¼ˆJSONB é€‚åˆå±æ€§æ‰¿è½½ï¼‰ï¼Œæ ‡ç­¾ç”¨äºç±»å‹ä¸çº¦æŸåˆ†ç±»ï¼›è¾¹å¯å®šå‘/æ— å‘ä»¥åˆ—æ¨¡å‹è¡¨ç¤ºã€‚
- å­˜å‚¨å»ºæ¨¡ï¼š
  - é¡¶ç‚¹è¡¨ï¼š`vertices(id bigint pk, label text, props jsonb)`ã€‚
  - è¾¹è¡¨ï¼š`edges(id bigint pk, src bigint, dst bigint, label text, props jsonb)`ï¼Œç´¢å¼• `(src)`, `(dst)`, `(label)`ï¼Œä»¥åŠ `GIN(props)`ã€‚

## 3. SQL/PGQL é£æ ¼æŸ¥è¯¢

- å¯åœ¨ SQL ä¸­è¡¨è¾¾å›¾éå†ï¼šåŠè¿æ¥/é€’å½’CTE è¡¨è¾¾å¯è¾¾æ€§ä¸è·¯å¾„æšä¸¾ï¼›
- PGQL/å¼€æ”¾Cypheré£æ ¼å¯æ˜ å°„åˆ° CTE + è¿æ¥è®¡åˆ’ï¼›

```sql
-- 3.1 ç›´æ¥é‚»å±…
SELECT v2.*
FROM vertices v1
JOIN edges e ON e.src = v1.id AND e.label = 'follows'
JOIN vertices v2 ON v2.id = e.dst
WHERE v1.id = $1;

-- 3.2 kæ­¥å¯è¾¾ï¼ˆé€’å½’CTEï¼‰
WITH RECURSIVE reach(id, depth, path) AS (
  SELECT $1, 0, ARRAY[$1]
  UNION ALL
  SELECT e.dst, r.depth + 1, r.path || e.dst
  FROM reach r
  JOIN edges e ON e.src = r.id
  WHERE r.depth < 3 AND NOT e.dst = ANY(r.path)
)
SELECT * FROM reach;

-- 3.3 æœ€çŸ­è·¯ï¼ˆæ— æƒ BFS è½®å»“ï¼‰
WITH RECURSIVE bfs(node, depth, path) AS (
  SELECT $1, 0, ARRAY[$1]
  UNION ALL
  SELECT e.dst, b.depth + 1, b.path || e.dst
  FROM bfs b
  JOIN edges e ON e.src = b.node
  WHERE NOT e.dst = ANY(b.path)
)
SELECT * FROM bfs WHERE node = $2 ORDER BY depth LIMIT 1;
```

## 4. å›¾ç®—æ³•ä¸å®ç°

- æ— æƒæœ€çŸ­è·¯å¾„ï¼šé€’å½’CTE / åˆ†æ‰¹BFSï¼›å¤§å›¾å»ºè®®åœ¨åº”ç”¨å±‚æ‰¹æ¬¡æ¨è¿›ã€‚
- PageRank/è¿é€šåˆ†é‡ï¼šä»¥è¿­ä»£è®¡ç®—è¡¨è¾¾ï¼Œæˆ–ç”¨å¤–éƒ¨å¼•æ“ï¼ˆå¦‚Apache AGEæ‰©å±•ã€GraphBLAS/å¤–éƒ¨è®¡ç®—ï¼‰ã€‚
- ç´¢å¼•å»ºè®®ï¼š`(src)`, `(dst)`, ä»¥åŠçƒ­é—¨è¾¹æ ‡ç­¾è¿‡æ»¤ç´¢å¼•ï¼›å±æ€§æ£€ç´¢ä½¿ç”¨ `props` ä¸Šçš„è¡¨è¾¾å¼/GIN ç´¢å¼•ã€‚

### 4.1 Apache AGEï¼ˆå¼€æ”¾Cypher on PostgreSQLï¼‰

- å®‰è£…ä¸å¯ç”¨ï¼š

  ```sql
  CREATE EXTENSION IF NOT EXISTS age;
  LOAD 'age';
  SELECT * FROM create_graph('g');
  ```

- Cypher ç¤ºä¾‹ï¼š

  ```sql
  SELECT * FROM cypher('g', $$
    CREATE (a:User {id:1,name:'A'})-[:FOLLOWS]->(b:User {id:2,name:'B'})
  $$) as (v agtype);

  SELECT * FROM cypher('g', $$
    MATCH (a:User {id:1})-[:FOLLOWS*1..3]->(x)
    RETURN x LIMIT 10
  $$) as (x agtype);
  ```

- è¿ç»´è¦ç‚¹ï¼šç‰ˆæœ¬å…¼å®¹ï¼ˆPG/AGEï¼‰ã€ç»Ÿè®¡ä¸ ANALYZEã€ä¸å¸¸è§„SQLæ··åˆæŸ¥è¯¢çš„ä»£ä»·æ§åˆ¶ã€‚

### 4.2 PG-Cypher/FDW æ··åˆ

- é€šè¿‡ FDW å¯¹æ¥ä¸“ç”¨å›¾å¼•æ“ï¼ˆNeo4j/TigerGraphï¼‰è¿›è¡Œè·¨åº“æŸ¥è¯¢ï¼›åœ¨PGåšè¿‡æ»¤ã€åœ¨å›¾å¼•æ“åšéå†ã€‚

## 5. ä¸å‘é‡/å…¨æ–‡/JSON çš„æ··åˆ

- èŠ‚ç‚¹å±æ€§å‘é‡åŒ–ï¼šåœ¨ `vertices` ä¾§å¢åŠ  `embedding vector(n)` åˆ—ï¼Œç»“åˆ pgvector åšâ€œå›¾å†…è¯­ä¹‰æ£€ç´¢ + è·¯å¾„çº¦æŸâ€ã€‚
- å…¨æ–‡ç»“åˆï¼šå¯¹ `props->>'text'` å»ºç«‹ `to_tsvector` + GINï¼Œå…ˆå…¨æ–‡å¬å›å†èµ°è·¯å¾„ã€‚
- JSON æ¨¡å¼ï¼šå±æ€§é‡‡ç”¨ JSONBï¼Œé‡è¦å­—æ®µå†—ä½™åˆ—ä»¥æå‡ç»Ÿè®¡ä¸ç´¢å¼•è´¨é‡ã€‚

## 6. çº¦æŸä¸ä¸€è‡´æ€§

- å”¯ä¸€çº¦æŸï¼š`vertices(label,id)`ã€`edges(id)`ï¼›
- å‚ç…§å®Œæ•´æ€§ï¼š`edges.src`/`edges.dst` å¼•ç”¨ `vertices.id`ï¼Œ`ON DELETE CASCADE | RESTRICT` è§†è¯­ä¹‰é€‰æ‹©ï¼›
- ä¸šåŠ¡çº¦æŸï¼šé¿å…è‡ªç¯/å¤šé‡è¾¹å¯ç”¨æ’ä»–çº¦æŸæˆ–å”¯ä¸€ç»„åˆã€‚

## 7. æ€§èƒ½ä¸è¿ç»´

- æ‰¹é‡å¯¼å…¥ï¼šå…³é—­æ¬¡è¦ç´¢å¼•ã€ä½¿ç”¨ `COPY`ã€å¯¼å…¥åå¹¶å‘åˆ›å»ºç´¢å¼•ï¼›
- åˆ†åŒºç­–ç•¥ï¼šæŒ‰æ ‡ç­¾æˆ–èŒƒå›´åˆ†åŒºå¤§å›¾ï¼›
- ç›‘æ§ï¼š`pg_stat_user_tables`ã€çƒ­ç‚¹è¾¹è¿‡æ»¤ã€é€’å½’CTEæ·±åº¦ä¸æˆæœ¬å®¡è®¡ã€‚

## 8. ç¤ºä¾‹å»ºæ¨¡è„šæœ¬

```sql
CREATE TABLE vertices (
  id   BIGSERIAL PRIMARY KEY,
  label TEXT NOT NULL,
  props JSONB NOT NULL DEFAULT '{}'
);
CREATE TABLE edges (
  id   BIGSERIAL PRIMARY KEY,
  src  BIGINT NOT NULL REFERENCES vertices(id) ON DELETE CASCADE,
  dst  BIGINT NOT NULL REFERENCES vertices(id) ON DELETE CASCADE,
  label TEXT NOT NULL,
  props JSONB NOT NULL DEFAULT '{}'
);
CREATE INDEX idx_edges_src ON edges(src);
CREATE INDEX idx_edges_dst ON edges(dst);
CREATE INDEX idx_edges_label ON edges(label);
CREATE INDEX idx_vertices_props_gin ON vertices USING GIN (props);
```

## 9. äº¤å‰å¼•ç”¨

### ç›¸å…³æ–‡æ¡£

#### é«˜çº§ç‰¹æ€§

- â­â­ [å‘é‡æ•°æ®åº“æ”¯æŒ](./03.05-å‘é‡æ•°æ®åº“æ”¯æŒ.md) - å¤šæ¨¡å‹é›†æˆ
- â­ [æ‰©å±•ç³»ç»Ÿä¸æ’ä»¶å¼€å‘](./03.01-æ‰©å±•ç³»ç»Ÿä¸æ’ä»¶å¼€å‘.md) - æ‰©å±•å¼€å‘

#### æ ¸å¿ƒè¯¾ç¨‹

- â­â­ [SQLè¯­è¨€è§„èŒƒä¸æ ‡å‡†](../../01-æ ¸å¿ƒè¯¾ç¨‹/01.03-SQLè¯­è¨€è§„èŒƒä¸æ ‡å‡†.md) - é€’å½’æŸ¥è¯¢åŸºç¡€
- â­ [å…³ç³»æ•°æ®æ¨¡å‹ä¸ç†è®º](../../01-æ ¸å¿ƒè¯¾ç¨‹/01.02-å…³ç³»æ•°æ®æ¨¡å‹ä¸ç†è®º.md) - æ•°æ®æ¨¡å‹åŸºç¡€

#### æ•°æ®æ¨¡å‹è®¾è®¡

- â­â­ [æ•°æ®å»ºæ¨¡å®Œæ•´æŒ‡å—](../../09-åº”ç”¨è®¾è®¡/æ•°æ®æ¨¡å‹è®¾è®¡/09.02-æ•°æ®å»ºæ¨¡å®Œæ•´æŒ‡å—.md) - å›¾æ•°æ®å»ºæ¨¡å®è·µ
- â­ [æ•°æ®åˆ†æå®Œæ•´æŒ‡å—](../../09-åº”ç”¨è®¾è®¡/æ•°æ®æ¨¡å‹è®¾è®¡/09.01-æ•°æ®åˆ†æå®Œæ•´æŒ‡å—.md) - å›¾æ•°æ®åˆ†æ

#### å·¥å…·èµ„æº

- â­ [çŸ¥è¯†å›¾è°±æ„å»º](../../11-å·¥å…·èµ„æº/08.02-çŸ¥è¯†å›¾è°±æ„å»º.md) - çŸ¥è¯†å›¾è°±å·¥å…·

## 10. å½¢å¼è¯æ˜ä¸ç†è®ºè®ºè¯

### 10.1 å›¾éå†æ­£ç¡®æ€§è¯æ˜

**å®šç†**: é€’å½’CTEå®ç°çš„å›¾éå†ç®—æ³•èƒ½å¤Ÿæ­£ç¡®æ‰¾åˆ°æ‰€æœ‰å¯è¾¾é¡¶ç‚¹ã€‚

**è¯æ˜**:

```latex
\begin{theorem}[å›¾éå†æ­£ç¡®æ€§]
è®¾å›¾ G = (V, E)ï¼Œèµ·å§‹é¡¶ç‚¹ sï¼Œé€’å½’CTEéå†ç®—æ³•ã€‚

é€’å½’CTEå®šä¹‰ï¼š
\text{reachable}(s) = \{s\} \cup \bigcup_{v \in \text{reachable}(s)} \{u | (v, u) \in E\}

å¯è¾¾æ€§å®šä¹‰ï¼š
\text{reachable}(s) = \{v \in V | \exists \text{path from } s \text{ to } v\}

æ­£ç¡®æ€§è¯æ˜ï¼š
1. åŸºç¡€æƒ…å†µï¼šs \in \text{reachable}(s)ï¼ˆèµ·å§‹é¡¶ç‚¹å¯è¾¾ï¼‰
2. å½’çº³æ­¥éª¤ï¼šå¦‚æœ v \in \text{reachable}(s) ä¸” (v, u) \in Eï¼Œåˆ™ u \in \text{reachable}(s)
3. å®Œå¤‡æ€§ï¼šæ‰€æœ‰ä» s å¯è¾¾çš„é¡¶ç‚¹éƒ½ä¼šè¢«æ‰¾åˆ°

PostgreSQLé€’å½’CTEï¼š
1. åŸºç¡€æŸ¥è¯¢ï¼šSELECT s
2. é€’å½’æŸ¥è¯¢ï¼šJOIN edges æ‰¾åˆ°ä¸‹ä¸€å±‚é¡¶ç‚¹
3. ç»ˆæ­¢æ¡ä»¶ï¼šdepthé™åˆ¶æˆ–è·¯å¾„æ£€æŸ¥

å› æ­¤ï¼Œé€’å½’CTEå®ç°çš„å›¾éå†ç®—æ³•èƒ½å¤Ÿæ­£ç¡®æ‰¾åˆ°æ‰€æœ‰å¯è¾¾é¡¶ç‚¹ã€‚
\end{theorem}
```

### 10.2 æœ€çŸ­è·¯å¾„ç®—æ³•æ­£ç¡®æ€§è¯æ˜

**å®šç†**: BFSç®—æ³•èƒ½å¤Ÿæ‰¾åˆ°æ— æƒå›¾ä¸­çš„æœ€çŸ­è·¯å¾„ã€‚

**è¯æ˜**:

```latex
\begin{theorem}[æœ€çŸ­è·¯å¾„ç®—æ³•æ­£ç¡®æ€§]
è®¾å›¾ G = (V, E) ä¸ºæ— æƒå›¾ï¼Œèµ·å§‹é¡¶ç‚¹ sï¼Œç›®æ ‡é¡¶ç‚¹ tã€‚

BFSç®—æ³•ï¼š
1. åˆå§‹åŒ–ï¼š\text{distance}(s) = 0ï¼Œ\text{distance}(v) = \inftyï¼ˆv \neq sï¼‰
2. éå†ï¼šå¯¹äºæ¯ä¸ªé¡¶ç‚¹ vï¼Œéå†å…¶é‚»å±… uï¼Œå¦‚æœ \text{distance}(u) = \inftyï¼Œåˆ™ \text{distance}(u) = \text{distance}(v) + 1
3. ç»ˆæ­¢ï¼šå½“æ‰¾åˆ° t æˆ–é˜Ÿåˆ—ä¸ºç©ºæ—¶ç»ˆæ­¢

æœ€çŸ­è·¯å¾„æ€§è´¨ï¼š
è®¾æœ€çŸ­è·¯å¾„é•¿åº¦ä¸º d^*ï¼ŒBFSæ‰¾åˆ°çš„ dã€‚

æ­£ç¡®æ€§è¯æ˜ï¼š
1. å¦‚æœå­˜åœ¨è·¯å¾„ï¼ŒBFSä¸€å®šèƒ½æ‰¾åˆ°ï¼ˆå›¾çš„è¿é€šæ€§ï¼‰
2. BFSæ‰¾åˆ°çš„è·¯å¾„æ˜¯æœ€çŸ­çš„ï¼ˆBFSæŒ‰å±‚éå†ï¼Œå…ˆåˆ°è¾¾çš„è·¯å¾„æ›´çŸ­ï¼‰
3. d = d^*ï¼ˆæœ€çŸ­è·¯å¾„é•¿åº¦ï¼‰

PostgreSQLå®ç°ï¼š
1. ä½¿ç”¨é€’å½’CTEå®ç°BFS
2. ç»´æŠ¤depthå’Œpathä¿¡æ¯
3. æ‰¾åˆ°ç›®æ ‡é¡¶ç‚¹æ—¶ç»ˆæ­¢

å› æ­¤ï¼ŒBFSç®—æ³•èƒ½å¤Ÿæ‰¾åˆ°æ— æƒå›¾ä¸­çš„æœ€çŸ­è·¯å¾„ã€‚
\end{theorem}
```

### 10.3 å›¾æŸ¥è¯¢ç­‰ä»·æ€§è¯æ˜

**å®šç†**: SQLé€’å½’CTEæŸ¥è¯¢ä¸CypheræŸ¥è¯¢åœ¨è¡¨è¾¾èƒ½åŠ›ä¸Šç­‰ä»·ã€‚

**è¯æ˜**:

```latex
\begin{theorem}[å›¾æŸ¥è¯¢ç­‰ä»·æ€§]
è®¾å›¾æŸ¥è¯¢è¯­è¨€ L_1ï¼ˆSQLé€’å½’CTEï¼‰å’Œ L_2ï¼ˆCypherï¼‰ã€‚

ç­‰ä»·æ€§å®šä¹‰ï¼š
L_1 \equiv L_2 \Leftrightarrow \forall Q_1 \in L_1, \exists Q_2 \in L_2: Q_1 \equiv Q_2

è¡¨è¾¾èƒ½åŠ›ï¼š
1. è·¯å¾„æŸ¥è¯¢ï¼šSQLé€’å½’CTEå¯ä»¥è¡¨è¾¾Cypherçš„è·¯å¾„æ¨¡å¼
2. æ¨¡å¼åŒ¹é…ï¼šSQL JOINå¯ä»¥è¡¨è¾¾Cypherçš„æ¨¡å¼åŒ¹é…
3. èšåˆæŸ¥è¯¢ï¼šSQLèšåˆå‡½æ•°å¯ä»¥è¡¨è¾¾Cypherçš„èšåˆ

ç­‰ä»·æ€§è¯æ˜ï¼š
å¯¹äºä»»æ„CypheræŸ¥è¯¢ Q_cï¼Œå­˜åœ¨SQLæŸ¥è¯¢ Q_s ä½¿å¾—ï¼š
\forall G: Q_c(G) = Q_s(G)

PostgreSQLå®ç°ï¼š
1. Apache AGEå°†CypheræŸ¥è¯¢è½¬æ¢ä¸ºSQL
2. SQLé€’å½’CTEå®ç°å›¾éå†
3. SQL JOINå®ç°æ¨¡å¼åŒ¹é…

å› æ­¤ï¼ŒSQLé€’å½’CTEæŸ¥è¯¢ä¸CypheræŸ¥è¯¢åœ¨è¡¨è¾¾èƒ½åŠ›ä¸Šç­‰ä»·ã€‚
\end{theorem}
```

---

## 11. Wikipediaå¯¹é½

### 11.1 å›¾æ•°æ®åº“æ¦‚å¿µå¯¹é½

- **Wikidata ID**: Q192490 (Graph database)
- **ç›¸å…³å±æ€§**:
  - P31: Q192490 (instance of: database type)
- **å¤–éƒ¨é“¾æ¥**:
  - [Wikipedia - Graph database](https://en.wikipedia.org/wiki/Graph_database)
  - [Wikipedia - Property graph model](https://en.wikipedia.org/wiki/Property_graph_model)
  - [Wikipedia - Cypher](https://en.wikipedia.org/wiki/Cypher_(query_language))

**Wikipediaå®šä¹‰**: [Graph database](https://en.wikipedia.org/wiki/Graph_database)

> A graph database is a database that uses graph structures for semantic queries with nodes, edges, and properties to represent and store data.

**å¯¹é½è¯´æ˜**:

- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒå›¾æ•°æ®åº“ä½¿ç”¨å›¾ç»“æ„ï¼ˆèŠ‚ç‚¹ã€è¾¹ã€å±æ€§ï¼‰è¡¨ç¤ºå’Œå­˜å‚¨æ•°æ®
- âœ… **æ ¸å¿ƒæ¦‚å¿µ**: éƒ½åŒ…å«é¡¶ç‚¹ã€è¾¹ã€å±æ€§ç­‰æ ¸å¿ƒæ¦‚å¿µ
- âœ… **æŸ¥è¯¢èƒ½åŠ›**: éƒ½æåˆ°è¯­ä¹‰æŸ¥è¯¢ã€å›¾éå†ç­‰æŸ¥è¯¢èƒ½åŠ›

### 11.2 å±æ€§å›¾æ¨¡å‹æ¦‚å¿µå¯¹é½

**Wikipediaå®šä¹‰**: [Property graph model](https://en.wikipedia.org/wiki/Property_graph_model)

> The property graph model is a graph data model that represents entities as nodes and relationships as edges, where both nodes and edges can have properties.

**å¯¹é½è¯´æ˜**:

- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒå±æ€§å›¾æ¨¡å‹ä¸­èŠ‚ç‚¹å’Œè¾¹éƒ½å¯ä»¥æœ‰å±æ€§
- âœ… **å­˜å‚¨æ–¹å¼**: PostgreSQLä½¿ç”¨è¡¨+JSONBçš„æ–¹å¼å®ç°å±æ€§å›¾æ¨¡å‹
- âœ… **æŸ¥è¯¢èƒ½åŠ›**: éƒ½æ”¯æŒåŸºäºå±æ€§çš„æŸ¥è¯¢å’Œè¿‡æ»¤

### 11.3 CypheræŸ¥è¯¢è¯­è¨€å¯¹é½

**Wikipediaå®šä¹‰**: [Cypher (query language)](https://en.wikipedia.org/wiki/Cypher_(query_language))

> Cypher is a declarative graph query language that allows for expressive and efficient querying and updating of a property graph.

**å¯¹é½è¯´æ˜**:

- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒCypheræ˜¯å£°æ˜å¼çš„å›¾æŸ¥è¯¢è¯­è¨€
- âœ… **æ ¸å¿ƒç‰¹æ€§**: éƒ½æåˆ°æ¨¡å¼åŒ¹é…ã€è·¯å¾„æŸ¥è¯¢ç­‰æ ¸å¿ƒç‰¹æ€§
- âœ… **å®ç°æ–¹å¼**: Apache AGEåœ¨PostgreSQLä¸Šå®ç°äº†CypheræŸ¥è¯¢è¯­è¨€

### 11.4 PostgreSQLå›¾æ•°æ®åº“å¯¹é½

- **Wikidata ID**: Q192490
- **ç›¸å…³å±æ€§**:
  - P31: Q176165 (instance of: database management system)
  - P178: Q9366 (developer: PostgreSQL Global Development Group)
  - P277: Q193321 (programmed in: C)
  - P348: 18.0 (software version)
- **å¤–éƒ¨é“¾æ¥**:
  - <https://www.postgresql.org/docs/current/queries-with.html>
  - [Apache AGE](https://age.apache.org/)

---

## 12. å‚è€ƒæ–‡çŒ®

1. PostgreSQL Global Development Group. (2025). PostgreSQL 18 Documentation. <https://www.postgresql.org/docs/18/>
2. PostgreSQL Global Development Group. (2024). PostgreSQL 17 Documentation. <https://www.postgresql.org/docs/17/>
3. PostgreSQLå®˜æ–¹æ–‡æ¡£ - [é€’å½’æŸ¥è¯¢](https://www.postgresql.org/docs/current/queries-with.html)
4. PostgreSQLå®˜æ–¹æ–‡æ¡£ - [JSONBç±»å‹](https://www.postgresql.org/docs/current/datatype-json.html)
