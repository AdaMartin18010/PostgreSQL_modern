# æ‰©å±•ç³»ç»Ÿä¸æ’ä»¶å¼€å‘

> **æ–‡æ¡£ç‰ˆæœ¬**: v2.0
> **æœ€åæ›´æ–°**: 2025-11-12
> **ç‰ˆæœ¬è¦†ç›–**: PostgreSQL 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x (å…¼å®¹)
> **æ–‡æ¡£çŠ¶æ€**: âœ… å·²æ›´æ–°

---

## ğŸ“‹ ç›®å½•

- [æ‰©å±•ç³»ç»Ÿä¸æ’ä»¶å¼€å‘](#æ‰©å±•ç³»ç»Ÿä¸æ’ä»¶å¼€å‘)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [ğŸ“Š æ€ç»´å¯¼å›¾](#-æ€ç»´å¯¼å›¾)
  - [ğŸ“Š å¤šç»´æ¦‚å¿µçŸ©é˜µå¯¹æ¯”](#-å¤šç»´æ¦‚å¿µçŸ©é˜µå¯¹æ¯”)
    - [æ‰©å±•ç±»å‹å¯¹æ¯”çŸ©é˜µ](#æ‰©å±•ç±»å‹å¯¹æ¯”çŸ©é˜µ)
    - [æ‰©å±•ç®¡ç†æ“ä½œå¯¹æ¯”çŸ©é˜µ](#æ‰©å±•ç®¡ç†æ“ä½œå¯¹æ¯”çŸ©é˜µ)
    - [æ‰©å±•å¼€å‘å·¥å…·å¯¹æ¯”çŸ©é˜µ](#æ‰©å±•å¼€å‘å·¥å…·å¯¹æ¯”çŸ©é˜µ)
  - [ğŸŒ Wikipediaå¯¹é½](#-wikipediaå¯¹é½)
    - [æ’ä»¶ç³»ç»Ÿæ¦‚å¿µå¯¹é½](#æ’ä»¶ç³»ç»Ÿæ¦‚å¿µå¯¹é½)
    - [æ‰©å±•ç³»ç»Ÿæ¦‚å¿µå¯¹é½](#æ‰©å±•ç³»ç»Ÿæ¦‚å¿µå¯¹é½)
  - [1. å®šä¹‰ä¸å½¢å¼åŒ–](#1-å®šä¹‰ä¸å½¢å¼åŒ–)
    - [1.1 æ¦‚å¿µå®šä¹‰](#11-æ¦‚å¿µå®šä¹‰)
    - [1.2 å½¢å¼åŒ–å®šä¹‰](#12-å½¢å¼åŒ–å®šä¹‰)
    - [1.3 æ ¸å¿ƒç‰¹æ€§](#13-æ ¸å¿ƒç‰¹æ€§)
  - [2. æ‰©å±•ç³»ç»Ÿæ¶æ„](#2-æ‰©å±•ç³»ç»Ÿæ¶æ„)
    - [2.1 æ‰©å±•ç®¡ç†](#21-æ‰©å±•ç®¡ç†)
    - [2.2 æ‰©å±•é…ç½®](#22-æ‰©å±•é…ç½®)
  - [3. Cè¯­è¨€æ‰©å±•å¼€å‘](#3-cè¯­è¨€æ‰©å±•å¼€å‘)
    - [3.1 æ‰©å±•ç»“æ„](#31-æ‰©å±•ç»“æ„)
    - [3.2 æ•°æ®ç±»å‹æ‰©å±•](#32-æ•°æ®ç±»å‹æ‰©å±•)
    - [3.3 æ“ä½œç¬¦æ‰©å±•](#33-æ“ä½œç¬¦æ‰©å±•)
  - [4. SQLæ‰©å±•å¼€å‘](#4-sqlæ‰©å±•å¼€å‘)
    - [4.1 æ§åˆ¶æ–‡ä»¶](#41-æ§åˆ¶æ–‡ä»¶)
    - [4.2 å®‰è£…è„šæœ¬](#42-å®‰è£…è„šæœ¬)
    - [4.3 å‡çº§è„šæœ¬](#43-å‡çº§è„šæœ¬)
    - [4.4 æ‰©å±•ç‰ˆæœ¬ç®¡ç†](#44-æ‰©å±•ç‰ˆæœ¬ç®¡ç†)
  - [5. ç¬¬ä¸‰æ–¹æ‰©å±•é›†æˆ](#5-ç¬¬ä¸‰æ–¹æ‰©å±•é›†æˆ)
    - [5.1 æµè¡Œæ‰©å±•](#51-æµè¡Œæ‰©å±•)
    - [5.2 åœ°ç†ç©ºé—´æ‰©å±•](#52-åœ°ç†ç©ºé—´æ‰©å±•)
    - [5.3 æ—¶é—´åºåˆ—æ‰©å±•](#53-æ—¶é—´åºåˆ—æ‰©å±•)
  - [6. æ‰©å±•å¼€å‘æœ€ä½³å®è·µ](#6-æ‰©å±•å¼€å‘æœ€ä½³å®è·µ)
    - [6.1 é”™è¯¯å¤„ç†](#61-é”™è¯¯å¤„ç†)
    - [6.2 å†…å­˜ç®¡ç†](#62-å†…å­˜ç®¡ç†)
    - [6.3 æ€§èƒ½ä¼˜åŒ–](#63-æ€§èƒ½ä¼˜åŒ–)
  - [7. å®é™…åº”ç”¨æ¡ˆä¾‹](#7-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [7.1 è‡ªå®šä¹‰èšåˆå‡½æ•°](#71-è‡ªå®šä¹‰èšåˆå‡½æ•°)
    - [7.2 è‡ªå®šä¹‰ç´¢å¼•](#72-è‡ªå®šä¹‰ç´¢å¼•)
  - [8. ç›¸å…³æ¦‚å¿µ](#8-ç›¸å…³æ¦‚å¿µ)
    - [8.1 ä¸Šä½æ¦‚å¿µ](#81-ä¸Šä½æ¦‚å¿µ)
    - [8.2 ä¸‹ä½æ¦‚å¿µ](#82-ä¸‹ä½æ¦‚å¿µ)
    - [8.3 å¹³è¡Œæ¦‚å¿µ](#83-å¹³è¡Œæ¦‚å¿µ)
  - [9. å‚è€ƒæ–‡çŒ®](#9-å‚è€ƒæ–‡çŒ®)
  - [10. äº¤å‰å¼•ç”¨](#10-äº¤å‰å¼•ç”¨)
    - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)
      - [æ ¸å¿ƒè¯¾ç¨‹](#æ ¸å¿ƒè¯¾ç¨‹)
      - [æŸ¥è¯¢ä¸ä¼˜åŒ–](#æŸ¥è¯¢ä¸ä¼˜åŒ–)
      - [é«˜çº§ç‰¹æ€§](#é«˜çº§ç‰¹æ€§)
      - [å‰æ²¿æŠ€æœ¯](#å‰æ²¿æŠ€æœ¯)
    - [å¤–éƒ¨èµ„æº](#å¤–éƒ¨èµ„æº)
  - [11. Wikidataå¯¹é½](#11-wikidataå¯¹é½)
    - [11.1 æ’ä»¶ç³»ç»Ÿæ¦‚å¿µå¯¹é½](#111-æ’ä»¶ç³»ç»Ÿæ¦‚å¿µå¯¹é½)
    - [11.2 PostgreSQLæ‰©å±•ç³»ç»Ÿå¯¹é½](#112-postgresqlæ‰©å±•ç³»ç»Ÿå¯¹é½)
  - [12. å½¢å¼è¯æ˜ä¸ç†è®ºè®ºè¯](#12-å½¢å¼è¯æ˜ä¸ç†è®ºè®ºè¯)
    - [12.1 æ‰©å±•ç³»ç»Ÿæ¨¡å—åŒ–è¯æ˜](#121-æ‰©å±•ç³»ç»Ÿæ¨¡å—åŒ–è¯æ˜)
    - [12.2 æ‰©å±•ä¾èµ–ä¸€è‡´æ€§è¯æ˜](#122-æ‰©å±•ä¾èµ–ä¸€è‡´æ€§è¯æ˜)
    - [12.3 æ‰©å±•ç‰ˆæœ¬å…¼å®¹æ€§è¯æ˜](#123-æ‰©å±•ç‰ˆæœ¬å…¼å®¹æ€§è¯æ˜)

---

## ğŸ“Š æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((æ‰©å±•ç³»ç»Ÿä¸æ’ä»¶å¼€å‘))
    æ‰©å±•ç³»ç»Ÿæ¶æ„
      æ‰©å±•ç®¡ç†
        CREATE EXTENSION
        ALTER EXTENSION
        DROP EXTENSION
      æ‰©å±•é…ç½®
        æ§åˆ¶æ–‡ä»¶
        å®‰è£…è„šæœ¬
        å‡çº§è„šæœ¬
      ç‰ˆæœ¬ç®¡ç†
        ç‰ˆæœ¬æ§åˆ¶
        å‡çº§ç­–ç•¥
        ä¾èµ–ç®¡ç†
    Cè¯­è¨€æ‰©å±•
      æ‰©å±•ç»“æ„
        å¤´æ–‡ä»¶
        æºæ–‡ä»¶
        ç¼–è¯‘é…ç½®
      æ•°æ®ç±»å‹æ‰©å±•
        è‡ªå®šä¹‰ç±»å‹
        ç±»å‹è½¬æ¢
        ç±»å‹æ“ä½œç¬¦
      æ“ä½œç¬¦æ‰©å±•
        æ“ä½œç¬¦å®šä¹‰
        æ“ä½œç¬¦é‡è½½
        æ“ä½œç¬¦ä¼˜åŒ–
    SQLæ‰©å±•
      æ§åˆ¶æ–‡ä»¶
        å…ƒæ•°æ®å®šä¹‰
        ç‰ˆæœ¬ä¿¡æ¯
        ä¾èµ–å£°æ˜
      å®‰è£…è„šæœ¬
        SQLå‡½æ•°
        è¡¨ç»“æ„
        è§†å›¾å®šä¹‰
      å‡çº§è„šæœ¬
        ç‰ˆæœ¬è¿ç§»
        æ•°æ®è¿ç§»
        å…¼å®¹æ€§å¤„ç†
    ç¬¬ä¸‰æ–¹æ‰©å±•
      æµè¡Œæ‰©å±•
        PostGIS
        pgvector
        pg_stat_statements
      åœ°ç†ç©ºé—´æ‰©å±•
        ç©ºé—´æ•°æ®ç±»å‹
        ç©ºé—´ç´¢å¼•
        ç©ºé—´æŸ¥è¯¢
      æ—¶é—´åºåˆ—æ‰©å±•
        æ—¶åºæ•°æ®æ¨¡å‹
        æ—¶åºç´¢å¼•
        æ—¶åºæŸ¥è¯¢
    å¼€å‘å®è·µ
      é”™è¯¯å¤„ç†
        å¼‚å¸¸æ•è·
        é”™è¯¯æŠ¥å‘Š
        é”™è¯¯æ¢å¤
      å†…å­˜ç®¡ç†
        å†…å­˜åˆ†é…
        å†…å­˜é‡Šæ”¾
        å†…å­˜æ³„æ¼æ£€æµ‹
      æ€§èƒ½ä¼˜åŒ–
        å‡½æ•°ä¼˜åŒ–
        ç´¢å¼•ä¼˜åŒ–
        æŸ¥è¯¢ä¼˜åŒ–
    åº”ç”¨æ¡ˆä¾‹
      è‡ªå®šä¹‰èšåˆå‡½æ•°
        èšåˆé€»è¾‘
        çŠ¶æ€ç®¡ç†
        ç»“æœè®¡ç®—
      è‡ªå®šä¹‰ç´¢å¼•
        ç´¢å¼•ç»“æ„
        ç´¢å¼•æ“ä½œ
        ç´¢å¼•æ‰«æ
```

---

## ğŸ“Š å¤šç»´æ¦‚å¿µçŸ©é˜µå¯¹æ¯”

### æ‰©å±•ç±»å‹å¯¹æ¯”çŸ©é˜µ

| æ‰©å±•ç±»å‹ | å¼€å‘è¯­è¨€ | æ€§èƒ½ | å¤æ‚åº¦ | çµæ´»æ€§ | é€‚ç”¨åœºæ™¯ | PostgreSQLæ”¯æŒ |
|---------|---------|------|--------|--------|---------|---------------|
| **Cè¯­è¨€æ‰©å±•** | C | æé«˜ | é«˜ | é«˜ | é«˜æ€§èƒ½éœ€æ±‚ | âœ… åŸç”Ÿæ”¯æŒ |
| **SQLæ‰©å±•** | SQL | ä¸­ | ä½ | ä¸­ | ç®€å•åŠŸèƒ½ | âœ… åŸç”Ÿæ”¯æŒ |
| **PL/pgSQLæ‰©å±•** | PL/pgSQL | ä¸­ | ä½ | ä¸­ | ä¸šåŠ¡é€»è¾‘ | âœ… åŸç”Ÿæ”¯æŒ |
| **PL/Pythonæ‰©å±•** | Python | ä½ | ä¸­ | é«˜ | å¿«é€Ÿå¼€å‘ | âœ… æ‰©å±•æ”¯æŒ |
| **ç¬¬ä¸‰æ–¹æ‰©å±•** | å¤šç§ | å˜åŒ– | å˜åŒ– | é«˜ | ä¸“ä¸šåŠŸèƒ½ | âœ… ç¤¾åŒºæ”¯æŒ |

### æ‰©å±•ç®¡ç†æ“ä½œå¯¹æ¯”çŸ©é˜µ

| æ“ä½œ | åŠŸèƒ½ | å½±å“èŒƒå›´ | å¯å›æ»š | å¤æ‚åº¦ | PostgreSQLæ”¯æŒ |
|-----|------|---------|--------|--------|---------------|
| **CREATE EXTENSION** | å®‰è£…æ‰©å±• | æ•°æ®åº“çº§ | æ˜¯ | ä½ | âœ… æ”¯æŒ |
| **ALTER EXTENSION** | å‡çº§æ‰©å±• | æ•°æ®åº“çº§ | æ˜¯ | ä¸­ | âœ… æ”¯æŒ |
| **DROP EXTENSION** | å¸è½½æ‰©å±• | æ•°æ®åº“çº§ | æ˜¯ | ä¸­ | âœ… æ”¯æŒ |
| **æ‰©å±•ä¾èµ–** | ä¾èµ–ç®¡ç† | è·¨æ‰©å±• | æ˜¯ | ä¸­ | âœ… æ”¯æŒ |
| **æ‰©å±•ç‰ˆæœ¬** | ç‰ˆæœ¬æ§åˆ¶ | æ‰©å±•çº§ | æ˜¯ | ä½ | âœ… æ”¯æŒ |

### æ‰©å±•å¼€å‘å·¥å…·å¯¹æ¯”çŸ©é˜µ

| å·¥å…· | ç±»å‹ | åŠŸèƒ½ | å­¦ä¹ æ›²çº¿ | é€‚ç”¨åœºæ™¯ | PostgreSQLæ”¯æŒ |
|-----|------|------|---------|---------|---------------|
| **pgxs** | æ„å»ºç³»ç»Ÿ | ç¼–è¯‘æ‰©å±• | ä¸­ | Cæ‰©å±•å¼€å‘ | âœ… åŸç”Ÿæ”¯æŒ |
| **CREATE EXTENSION** | SQLå‘½ä»¤ | å®‰è£…æ‰©å±• | ä½ | SQLæ‰©å±• | âœ… åŸç”Ÿæ”¯æŒ |
| **pg_config** | é…ç½®å·¥å…· | é…ç½®ä¿¡æ¯ | ä½ | å¼€å‘é…ç½® | âœ… åŸç”Ÿæ”¯æŒ |
| **Extensionæ‰“åŒ…å·¥å…·** | æ‰“åŒ…å·¥å…· | æ‰©å±•æ‰“åŒ… | ä¸­ | æ‰©å±•åˆ†å‘ | âœ… ç¤¾åŒºå·¥å…· |

---

## ğŸŒ Wikipediaå¯¹é½

### æ’ä»¶ç³»ç»Ÿæ¦‚å¿µå¯¹é½

**Wikipediaå®šä¹‰**: [Plugin architecture](https://en.wikipedia.org/wiki/Plugin_architecture)

> Plugin architecture is a software architecture pattern that allows functionality to be added to a system without modifying the core system.

**å¯¹é½è¯´æ˜**:

- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒæ’ä»¶ç³»ç»Ÿå…è®¸åœ¨ä¸ä¿®æ”¹æ ¸å¿ƒç³»ç»Ÿçš„æƒ…å†µä¸‹æ·»åŠ åŠŸèƒ½
- âœ… **æ¶æ„æ¨¡å¼**: éƒ½æåˆ°æ’ä»¶æ¶æ„æ˜¯ä¸€ç§è½¯ä»¶æ¶æ„æ¨¡å¼
- âœ… **æ‰©å±•æ€§**: éƒ½å¼ºè°ƒç³»ç»Ÿçš„å¯æ‰©å±•æ€§

### æ‰©å±•ç³»ç»Ÿæ¦‚å¿µå¯¹é½

**Wikipediaå®šä¹‰**: [Database extension](https://en.wikipedia.org/wiki/Database_extension)

> Database extensions are additional components that extend the functionality of a database management system.

**å¯¹é½è¯´æ˜**:

- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒæ‰©å±•æ˜¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„é™„åŠ ç»„ä»¶
- âœ… **åŠŸèƒ½æ‰©å±•**: éƒ½æåˆ°æ‰©å±•ç”¨äºæ‰©å±•æ•°æ®åº“åŠŸèƒ½
- âœ… **æ¨¡å—åŒ–**: éƒ½å¼ºè°ƒæ‰©å±•çš„æ¨¡å—åŒ–è®¾è®¡

---

## 1. å®šä¹‰ä¸å½¢å¼åŒ–

### 1.1 æ¦‚å¿µå®šä¹‰

**ä¸­æ–‡å®šä¹‰**: æ‰©å±•ç³»ç»Ÿæ˜¯PostgreSQLæä¾›çš„æ’ä»¶åŒ–æ¶æ„ï¼Œå…è®¸å¼€å‘è€…åˆ›å»ºè‡ªå®šä¹‰æ‰©å±•æ¥å¢å¼ºæ•°æ®åº“åŠŸèƒ½ã€‚æ’ä»¶å¼€å‘åŒ…æ‹¬Cè¯­è¨€æ‰©å±•ã€SQLæ‰©å±•å’Œç¬¬ä¸‰æ–¹é›†æˆï¼Œå®ç°åŠŸèƒ½çš„æ¨¡å—åŒ–å’Œå¯æ‰©å±•æ€§ã€‚

**English Definition**: The extension system is a plugin architecture provided by PostgreSQL that allows developers to create custom extensions to enhance database functionality. Plugin development includes C language extensions, SQL extensions, and third-party integrations, achieving modularity and extensibility of functionality.

### 1.2 å½¢å¼åŒ–å®šä¹‰

```latex
% æ•°å­¦ç¬¦å·å®šä¹‰
\newcommand{\extension}{\mathcal{E}}
\newcommand{\plugin}{\mathcal{P}}
\newcommand{\interface}{\mathcal{I}}

% æ‰©å±•ç³»ç»Ÿçš„å½¢å¼åŒ–å®šä¹‰
\extension = \{p_1, p_2, \ldots, p_n\}

å…¶ä¸­æ¯ä¸ªæ’ä»¶ p_i = (name_i, version_i, interfaces_i, dependencies_i) è¡¨ç¤ºï¼š
- name_i: æ’ä»¶åç§°
- version_i: æ’ä»¶ç‰ˆæœ¬
- interfaces_i: æ¥å£é›†åˆ
- dependencies_i: ä¾èµ–å…³ç³»
```

### 1.3 æ ¸å¿ƒç‰¹æ€§

- **æ¨¡å—åŒ–è®¾è®¡**: åŠŸèƒ½æ¨¡å—åŒ–ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
- **ç‰ˆæœ¬ç®¡ç†**: æ”¯æŒæ‰©å±•ç‰ˆæœ¬æ§åˆ¶å’Œå‡çº§
- **ä¾èµ–ç®¡ç†**: è‡ªåŠ¨å¤„ç†æ‰©å±•ä¾èµ–å…³ç³»
- **æ¥å£æ ‡å‡†åŒ–**: ç»Ÿä¸€çš„æ‰©å±•æ¥å£è§„èŒƒ
- **çƒ­æ’æ‹”**: æ”¯æŒè¿è¡Œæ—¶åŠ è½½å’Œå¸è½½æ‰©å±•

## 2. æ‰©å±•ç³»ç»Ÿæ¶æ„

### 2.1 æ‰©å±•ç®¡ç†

PostgreSQLçš„æ‰©å±•ç³»ç»Ÿæä¾›äº†æ¨¡å—åŒ–çš„åŠŸèƒ½æ‰©å±•æœºåˆ¶ï¼Œæ”¯æŒCè¯­è¨€æ‰©å±•å’ŒSQLæ‰©å±•ã€‚

**æ‰©å±•ç®¡ç†å‘½ä»¤**:

```sql
-- æŸ¥çœ‹å·²å®‰è£…æ‰©å±•
SELECT
    extname,           -- æ‰©å±•åç§°
    extversion,        -- æ‰©å±•ç‰ˆæœ¬
    extrelocatable,    -- æ˜¯å¦å¯é‡å®šä½
    extconfig,         -- æ‰©å±•é…ç½®
    extcondition       -- æ‰©å±•æ¡ä»¶
FROM pg_extension
ORDER BY extname;

-- æŸ¥çœ‹æ‰€æœ‰å¯ç”¨æ‰©å±•
SELECT * FROM pg_available_extensions
ORDER BY name;

-- æŸ¥çœ‹æ‰©å±•è¯¦ç»†ä¿¡æ¯
SELECT * FROM pg_available_extension_versions
WHERE name = 'vector';

-- å®‰è£…æ‰©å±•
CREATE EXTENSION IF NOT EXISTS vector;
CREATE EXTENSION IF NOT EXISTS pg_stat_statements;
CREATE EXTENSION IF NOT EXISTS hstore;

-- å‡çº§æ‰©å±•
ALTER EXTENSION vector UPDATE TO '2.0.0';

-- å¸è½½æ‰©å±•
DROP EXTENSION IF EXISTS vector CASCADE;  -- CASCADEä¼šåˆ é™¤æ‰©å±•åˆ›å»ºçš„å¯¹è±¡
```

**æ‰©å±•ç‰ˆæœ¬ç®¡ç†**:

```sql
-- æŸ¥çœ‹æ‰©å±•ç‰ˆæœ¬å†å²
SELECT * FROM pg_extension_update_paths('vector')
WHERE source = current_setting('server_version_num')::int / 10000;

-- å‡çº§åˆ°ç‰¹å®šç‰ˆæœ¬
ALTER EXTENSION vector UPDATE TO '2.0.0';

-- æŸ¥çœ‹æ‰©å±•ä¾èµ–
SELECT
    e.extname,
    d.dependee::regclass as depends_on
FROM pg_extension e
JOIN pg_depend d ON e.oid = d.objid
WHERE d.deptype = 'e';
```

**æ‰©å±•é…ç½®**:

```sql
-- æ‰©å±•é…ç½®å‚æ•°ï¼ˆåœ¨postgresql.confä¸­ï¼‰
-- ç¤ºä¾‹ï¼špg_stat_statementsé…ç½®
shared_preload_libraries = 'pg_stat_statements'
pg_stat_statements.track = all
pg_stat_statements.max = 10000

-- æ‰©å±•ç‰¹å®šé…ç½®
ALTER EXTENSION vector SET SCHEMA public;

CREATE EXTENSION IF NOT EXISTS pg_trgm;

-- æ›´æ–°æ‰©å±•
ALTER EXTENSION hstore UPDATE TO '1.8';

-- å¸è½½æ‰©å±•
DROP EXTENSION IF EXISTS hstore;

```

### 2.2 æ‰©å±•é…ç½®

```sql
-- æŸ¥çœ‹æ‰©å±•é…ç½®
SELECT
    name,
    setting,
    unit,
    context,
    vartype,
    source,
    min_val,
    max_val,
    enumvals
FROM pg_settings
WHERE name LIKE '%extension%';

-- é…ç½®æ‰©å±•å‚æ•°
ALTER SYSTEM SET shared_preload_libraries = 'pg_stat_statements';
SELECT pg_reload_conf();
```

## 3. Cè¯­è¨€æ‰©å±•å¼€å‘

### 3.1 æ‰©å±•ç»“æ„

```c
// æ‰©å±•å¤´æ–‡ä»¶
#include "postgres.h"
#include "fmgr.h"
#include "utils/builtins.h"

PG_MODULE_MAGIC;

// å‡½æ•°å£°æ˜
PG_FUNCTION_INFO_V1(my_function);

// å‡½æ•°å®ç°
Datum
my_function(PG_FUNCTION_ARGS)
{
    text *arg1 = PG_GETARG_TEXT_PP(0);
    int32 arg2 = PG_GETARG_INT32(1);

    // å‡½æ•°é€»è¾‘
    text *result = cstring_to_text("Hello from extension!");

    PG_RETURN_TEXT_P(result);
}
```

### 3.2 æ•°æ®ç±»å‹æ‰©å±•

```c
// è‡ªå®šä¹‰æ•°æ®ç±»å‹
typedef struct {
    int32 x;
    int32 y;
} Point2D;

// è¾“å…¥å‡½æ•°
PG_FUNCTION_INFO_V1(point2d_in);
Datum
point2d_in(PG_FUNCTION_ARGS)
{
    char *str = PG_GETARG_CSTRING(0);
    Point2D *point = (Point2D *) palloc(sizeof(Point2D));

    if (sscanf(str, "(%d,%d)", &point->x, &point->y) != 2)
        ereport(ERROR,
                (errcode(ERRCODE_INVALID_TEXT_REPRESENTATION),
                 errmsg("invalid input syntax for type point2d: \"%s\"", str)));

    PG_RETURN_POINTER(point);
}

// è¾“å‡ºå‡½æ•°
PG_FUNCTION_INFO_V1(point2d_out);
Datum
point2d_out(PG_FUNCTION_ARGS)
{
    Point2D *point = (Point2D *) PG_GETARG_POINTER(0);
    char *result = psprintf("(%d,%d)", point->x, point->y);

    PG_RETURN_CSTRING(result);
}
```

### 3.3 æ“ä½œç¬¦æ‰©å±•

```c
// æ“ä½œç¬¦å‡½æ•°
PG_FUNCTION_INFO_V1(point2d_add);
Datum
point2d_add(PG_FUNCTION_ARGS)
{
    Point2D *p1 = (Point2D *) PG_GETARG_POINTER(0);
    Point2D *p2 = (Point2D *) PG_GETARG_POINTER(1);
    Point2D *result = (Point2D *) palloc(sizeof(Point2D));

    result->x = p1->x + p2->x;
    result->y = p1->y + p2->y;

    PG_RETURN_POINTER(result);
}

// æ¯”è¾ƒå‡½æ•°
PG_FUNCTION_INFO_V1(point2d_eq);
Datum
point2d_eq(PG_FUNCTION_ARGS)
{
    Point2D *p1 = (Point2D *) PG_GETARG_POINTER(0);
    Point2D *p2 = (Point2D *) PG_GETARG_POINTER(1);

    PG_RETURN_BOOL(p1->x == p2->x && p1->y == p2->y);
}
```

## 4. SQLæ‰©å±•å¼€å‘

### 4.1 æ§åˆ¶æ–‡ä»¶

æ§åˆ¶æ–‡ä»¶ï¼ˆ.controlï¼‰å®šä¹‰äº†æ‰©å±•çš„åŸºæœ¬ä¿¡æ¯å’Œå…ƒæ•°æ®ã€‚

**æ§åˆ¶æ–‡ä»¶æ ¼å¼**:

```ini
# my_extension.control
# æ‰©å±•åç§°ï¼ˆå¿…é¡»ä¸æ–‡ä»¶åç›¸åŒï¼‰
comment = 'My SQL extension for custom functions'

# é»˜è®¤ç‰ˆæœ¬
default_version = '1.0'

# æ¨¡å—è·¯å¾„ï¼ˆSQLæ‰©å±•é€šå¸¸ä¸éœ€è¦ï¼‰
# module_pathname = '$libdir/my_extension'

# æ˜¯å¦å¯é‡å®šä½
relocatable = true

# æ‰©å±•æ¨¡å¼ï¼ˆå¯é€‰ï¼‰
schema = public
```

**æ§åˆ¶æ–‡ä»¶å‚æ•°è¯´æ˜**:

- `comment`: æ‰©å±•æè¿°
- `default_version`: é»˜è®¤å®‰è£…çš„ç‰ˆæœ¬
- `module_pathname`: Cæ‰©å±•çš„å…±äº«åº“è·¯å¾„ï¼ˆSQLæ‰©å±•ä¸éœ€è¦ï¼‰
- `relocatable`: æ˜¯å¦å¯ä»¥åœ¨ä¸åŒæ¨¡å¼é—´ç§»åŠ¨
- `schema`: æ‰©å±•å®‰è£…çš„æ¨¡å¼

### 4.2 å®‰è£…è„šæœ¬

å®‰è£…è„šæœ¬ï¼ˆ--version.sqlï¼‰åŒ…å«æ‰©å±•çš„SQLå®šä¹‰ã€‚

**å®‰è£…è„šæœ¬ç¤ºä¾‹**:

```sql
-- my_extension--1.0.sql

-- åˆ›å»ºå‡½æ•°
CREATE OR REPLACE FUNCTION my_function(text)
RETURNS text
LANGUAGE sql
IMMUTABLE
AS $$
    SELECT 'Hello, ' || $1 || '!';
$$;

-- åˆ›å»ºç±»å‹
CREATE TYPE my_type AS (
    field1 text,
    field2 integer
);

-- åˆ›å»ºæ“ä½œç¬¦
CREATE OPERATOR + (
    LEFTARG = text,
    RIGHTARG = text,
    PROCEDURE = textcat,
    COMMUTATOR = +
);

-- åˆ›å»ºè§†å›¾
CREATE VIEW my_view AS
SELECT column1, column2
FROM my_table
WHERE column1 IS NOT NULL;

-- æˆäºˆæƒé™
GRANT EXECUTE ON FUNCTION my_function(text) TO PUBLIC;
GRANT SELECT ON my_view TO PUBLIC;
```

**å®‰è£…è„šæœ¬æœ€ä½³å®è·µ**:

```sql
-- 1. ä½¿ç”¨IF NOT EXISTSé¿å…é”™è¯¯
CREATE FUNCTION IF NOT EXISTS my_function(text)
RETURNS text AS $$ ... $$;

-- 2. ä½¿ç”¨OR REPLACEå…è®¸æ›´æ–°
CREATE OR REPLACE FUNCTION my_function(text)
RETURNS text AS $$ ... $$;

-- 3. æ·»åŠ æ³¨é‡Š
COMMENT ON FUNCTION my_function(text) IS 'My custom function';

-- 4. è®¾ç½®å‡½æ•°å±æ€§
CREATE FUNCTION my_function(text)
RETURNS text
LANGUAGE sql
IMMUTABLE          -- å‡½æ•°ç»“æœä¸å˜
STRICT             -- å‚æ•°ä¸ºNULLæ—¶è¿”å›NULL
SECURITY DEFINER   -- ä»¥å®šä¹‰è€…æƒé™æ‰§è¡Œ
AS $$ ... $$;
```

### 4.3 å‡çº§è„šæœ¬

å‡çº§è„šæœ¬ï¼ˆ--from_version--to_version.sqlï¼‰ç”¨äºæ‰©å±•ç‰ˆæœ¬å‡çº§ã€‚

**å‡çº§è„šæœ¬ç¤ºä¾‹**:

```sql
-- my_extension--1.0--1.1.sql

-- æ·»åŠ æ–°å‡½æ•°
CREATE FUNCTION my_function_v2(text)
RETURNS text
LANGUAGE sql
AS $$
    SELECT my_function($1) || ' (v2)';
$$;

-- ä¿®æ”¹ç°æœ‰å‡½æ•°ï¼ˆä½¿ç”¨OR REPLACEï¼‰
CREATE OR REPLACE FUNCTION my_function(text)
RETURNS text
LANGUAGE sql
AS $$
    SELECT 'Updated: ' || $1;
$$;

-- æ·»åŠ æ–°åˆ—ï¼ˆå¦‚æœæ‰©å±•åŒ…å«è¡¨ï¼‰
ALTER TABLE my_table ADD COLUMN new_column text;

-- åˆ›å»ºæ–°ç´¢å¼•
CREATE INDEX idx_new_column ON my_table(new_column);

-- æ•°æ®è¿ç§»ï¼ˆå¦‚æœéœ€è¦ï¼‰
UPDATE my_table SET new_column = 'default_value'
WHERE new_column IS NULL;
```

**å‡çº§è„šæœ¬æœ€ä½³å®è·µ**:

```sql
-- 1. ä¿æŒå‘åå…¼å®¹
-- ä¸è¦åˆ é™¤ç°æœ‰å‡½æ•°ï¼Œè€Œæ˜¯åˆ›å»ºæ–°ç‰ˆæœ¬
CREATE FUNCTION my_function_v2(text) ...;
-- ä¿ç•™ my_function(text) ç”¨äºå…¼å®¹

-- 2. ä½¿ç”¨äº‹åŠ¡ç¡®ä¿åŸå­æ€§
BEGIN;
-- å‡çº§æ“ä½œ
COMMIT;

-- 3. å¤„ç†æ•°æ®è¿ç§»
-- å¯¹äºè¡¨ç»“æ„å˜æ›´ï¼Œæä¾›æ•°æ®è¿ç§»é€»è¾‘
DO $$
BEGIN
    IF EXISTS (SELECT 1 FROM information_schema.columns
               WHERE table_name = 'my_table' AND column_name = 'old_column') THEN
        ALTER TABLE my_table RENAME COLUMN old_column TO new_column;
    END IF;
END $$;

-- 4. ç‰ˆæœ¬æ£€æŸ¥
DO $$
BEGIN
    IF current_setting('server_version_num')::int < 140000 THEN
        RAISE EXCEPTION 'Extension requires PostgreSQL 14 or later';
    END IF;
END $$;
```

### 4.4 æ‰©å±•ç‰ˆæœ¬ç®¡ç†

æ‰©å±•ç‰ˆæœ¬ç®¡ç†æ˜¯æ‰©å±•ç³»ç»Ÿçš„é‡è¦åŠŸèƒ½ï¼Œæ”¯æŒæ‰©å±•çš„å¹³æ»‘å‡çº§å’Œå›é€€ã€‚

**ç‰ˆæœ¬ç®¡ç†å‘½ä»¤**:

```sql
-- æŸ¥çœ‹æ‰©å±•ç‰ˆæœ¬
SELECT extname, extversion FROM pg_extension WHERE extname = 'my_extension';

-- å‡çº§æ‰©å±•
ALTER EXTENSION my_extension UPDATE TO '1.1';

-- æŸ¥çœ‹å¯ç”¨ç‰ˆæœ¬
SELECT * FROM pg_available_extension_versions WHERE name = 'my_extension';

-- å›é€€ç‰ˆæœ¬ï¼ˆéœ€è¦æä¾›å›é€€è„šæœ¬ï¼‰
ALTER EXTENSION my_extension UPDATE TO '1.0';
```

**ç‰ˆæœ¬å‡çº§æµç¨‹**:

1. æ£€æŸ¥å½“å‰ç‰ˆæœ¬
2. æŸ¥æ‰¾å‡çº§è„šæœ¬ï¼ˆ--from_version--to_version.sqlï¼‰
3. æ‰§è¡Œå‡çº§è„šæœ¬
4. æ›´æ–°æ‰©å±•ç‰ˆæœ¬å·

**ç‰ˆæœ¬å…¼å®¹æ€§**:

```sql
-- æ£€æŸ¥æ‰©å±•ç‰ˆæœ¬å…¼å®¹æ€§
SELECT
    name,
    version,
    requires
FROM pg_available_extension_versions
WHERE name = 'my_extension';

-- requireså­—æ®µæ˜¾ç¤ºPostgreSQLç‰ˆæœ¬è¦æ±‚
-- ä¾‹å¦‚ï¼šrequires = '>= 14.0'
```

## 5. ç¬¬ä¸‰æ–¹æ‰©å±•é›†æˆ

### 5.1 æµè¡Œæ‰©å±•

```sql
-- å…¨æ–‡æœç´¢æ‰©å±•
CREATE EXTENSION IF NOT EXISTS pg_trgm;
CREATE EXTENSION IF NOT EXISTS btree_gin;

-- åˆ›å»ºå…¨æ–‡æœç´¢ç´¢å¼•
CREATE INDEX idx_content_trgm ON documents USING gin (content gin_trgm_ops);

-- ç›¸ä¼¼åº¦æœç´¢
SELECT title, similarity(title, 'postgresql database') as sim
FROM documents
WHERE title % 'postgresql database'
ORDER BY sim DESC;

-- ç»Ÿè®¡ä¿¡æ¯æ‰©å±•
CREATE EXTENSION IF NOT EXISTS pg_stat_statements;

-- æŸ¥çœ‹æŸ¥è¯¢ç»Ÿè®¡
SELECT
    query,
    calls,
    total_time,
    mean_time,
    rows
FROM pg_stat_statements
ORDER BY total_time DESC
LIMIT 10;
```

### 5.2 åœ°ç†ç©ºé—´æ‰©å±•

```sql
-- PostGISæ‰©å±•
CREATE EXTENSION IF NOT EXISTS postgis;

-- åˆ›å»ºåœ°ç†ç©ºé—´è¡¨
CREATE TABLE locations (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    geom GEOMETRY(POINT, 4326)
);

-- æ’å…¥åœ°ç†æ•°æ®
INSERT INTO locations (name, geom) VALUES
('New York', ST_GeomFromText('POINT(-74.0059 40.7128)', 4326)),
('London', ST_GeomFromText('POINT(-0.1276 51.5074)', 4326));

-- åœ°ç†ç©ºé—´æŸ¥è¯¢
SELECT
    name,
    ST_Distance(geom, ST_GeomFromText('POINT(-74.0059 40.7128)', 4326)) as distance
FROM locations
ORDER BY distance;
```

### 5.3 æ—¶é—´åºåˆ—æ‰©å±•

```sql
-- TimescaleDBæ‰©å±•
CREATE EXTENSION IF NOT EXISTS timescaledb;

-- åˆ›å»ºæ—¶é—´åºåˆ—è¡¨
CREATE TABLE sensor_data (
    time TIMESTAMPTZ NOT NULL,
    sensor_id INTEGER NOT NULL,
    temperature DOUBLE PRECISION NULL,
    humidity DOUBLE PRECISION NULL
);

-- è½¬æ¢ä¸ºè¶…è¡¨
SELECT create_hypertable('sensor_data', 'time');

-- æ—¶é—´åºåˆ—æŸ¥è¯¢
SELECT
    time_bucket('1 hour', time) as hour,
    sensor_id,
    AVG(temperature) as avg_temp,
    MAX(temperature) as max_temp
FROM sensor_data
WHERE time >= NOW() - INTERVAL '24 hours'
GROUP BY hour, sensor_id
ORDER BY hour;
```

## 6. æ‰©å±•å¼€å‘æœ€ä½³å®è·µ

### 6.1 é”™è¯¯å¤„ç†

```c
// é”™è¯¯å¤„ç†ç¤ºä¾‹
PG_FUNCTION_INFO_V1(safe_divide);
Datum
safe_divide(PG_FUNCTION_ARGS)
{
    float8 arg1 = PG_GETARG_FLOAT8(0);
    float8 arg2 = PG_GETARG_FLOAT8(1);

    if (arg2 == 0.0)
        ereport(ERROR,
                (errcode(ERRCODE_DIVISION_BY_ZERO),
                 errmsg("division by zero")));

    PG_RETURN_FLOAT8(arg1 / arg2);
}
```

### 6.2 å†…å­˜ç®¡ç†

```c
// å†…å­˜ç®¡ç†ç¤ºä¾‹
PG_FUNCTION_INFO_V1(create_array);
Datum
create_array(PG_FUNCTION_ARGS)
{
    int32 count = PG_GETARG_INT32(0);
    ArrayType *result;
    Datum *values;
    bool *nulls;
    int i;

    // åˆ†é…å†…å­˜
    values = (Datum *) palloc(sizeof(Datum) * count);
    nulls = (bool *) palloc(sizeof(bool) * count);

    // å¡«å……æ•°ç»„
    for (i = 0; i < count; i++) {
        values[i] = Int32GetDatum(i * i);
        nulls[i] = false;
    }

    // åˆ›å»ºæ•°ç»„
    result = construct_array(values, count, INT4OID, 4, true, 'i');

    // æ¸…ç†å†…å­˜
    pfree(values);
    pfree(nulls);

    PG_RETURN_ARRAYTYPE_P(result);
}
```

### 6.3 æ€§èƒ½ä¼˜åŒ–

```c
// æ€§èƒ½ä¼˜åŒ–ç¤ºä¾‹
PG_FUNCTION_INFO_V1(fast_string_compare);
Datum
fast_string_compare(PG_FUNCTION_ARGS)
{
    text *arg1 = PG_GETARG_TEXT_PP(0);
    text *arg2 = PG_GETARG_TEXT_PP(1);
    int result;

    // ä½¿ç”¨å¿«é€Ÿæ¯”è¾ƒ
    result = text_cmp(arg1, arg2);

    if (result < 0)
        PG_RETURN_INT32(-1);
    else if (result > 0)
        PG_RETURN_INT32(1);
    else
        PG_RETURN_INT32(0);
}
```

## 7. å®é™…åº”ç”¨æ¡ˆä¾‹

### 7.1 è‡ªå®šä¹‰èšåˆå‡½æ•°

```c
// è‡ªå®šä¹‰èšåˆå‡½æ•°
typedef struct {
    int64 sum;
    int64 count;
} MyAggState;

PG_FUNCTION_INFO_V1(my_agg_transfn);
Datum
my_agg_transfn(PG_FUNCTION_ARGS)
{
    MyAggState *state;
    int64 value = PG_GETARG_INT64(0);

    if (PG_ARGISNULL(0))
        PG_RETURN_NULL();

    if (PG_ARGISNULL(1)) {
        state = (MyAggState *) palloc(sizeof(MyAggState));
        state->sum = 0;
        state->count = 0;
    } else {
        state = (MyAggState *) PG_GETARG_POINTER(1);
    }

    state->sum += value;
    state->count++;

    PG_RETURN_POINTER(state);
}

PG_FUNCTION_INFO_V1(my_agg_finalfn);
Datum
my_agg_finalfn(PG_FUNCTION_ARGS)
{
    MyAggState *state = (MyAggState *) PG_GETARG_POINTER(0);

    if (state == NULL || state->count == 0)
        PG_RETURN_NULL();

    PG_RETURN_FLOAT8((double) state->sum / state->count);
}
```

### 7.2 è‡ªå®šä¹‰ç´¢å¼•

```c
// è‡ªå®šä¹‰ç´¢å¼•æ“ä½œç¬¦ç±»
PG_FUNCTION_INFO_V1(my_btree_compare);
Datum
my_btree_compare(PG_FUNCTION_ARGS)
{
    MyType *a = (MyType *) PG_GETARG_POINTER(0);
    MyType *b = (MyType *) PG_GETARG_POINTER(1);

    if (a->value < b->value)
        PG_RETURN_INT32(-1);
    else if (a->value > b->value)
        PG_RETURN_INT32(1);
    else
        PG_RETURN_INT32(0);
}
```

## 8. ç›¸å…³æ¦‚å¿µ

### 8.1 ä¸Šä½æ¦‚å¿µ

- **æ•°æ®åº“ç³»ç»Ÿ**: æ›´å¹¿æ³›çš„æ•°æ®åº“ç³»ç»Ÿ
- **è½¯ä»¶æ¶æ„**: è½¯ä»¶æ¶æ„è®¾è®¡
- **æ¨¡å—åŒ–è®¾è®¡**: æ¨¡å—åŒ–ç¼–ç¨‹

### 8.2 ä¸‹ä½æ¦‚å¿µ

- **Cè¯­è¨€æ‰©å±•**: Cè¯­è¨€æ’ä»¶å¼€å‘
- **SQLæ‰©å±•**: SQLè„šæœ¬æ‰©å±•
- **ç¬¬ä¸‰æ–¹é›†æˆ**: ç¬¬ä¸‰æ–¹åº“é›†æˆ

### 8.3 å¹³è¡Œæ¦‚å¿µ

- **æ’ä»¶ç³»ç»Ÿ**: æ’ä»¶æ¶æ„
- **æ¨¡å—ç³»ç»Ÿ**: æ¨¡å—åŒ–ç³»ç»Ÿ
- **APIè®¾è®¡**: åº”ç”¨ç¨‹åºæ¥å£è®¾è®¡

## 9. å‚è€ƒæ–‡çŒ®

1. PostgreSQL Global Development Group. (2025). PostgreSQL 18 Documentation. <https://www.postgresql.org/docs/18/>
2. Obe, R., & Hsu, L. (2015). PostgreSQL: Up and Running (2nd ed.). O'Reilly Media.
3. Krosing, H., & Roybal, K. (2019). PostgreSQL 11 Server Side Programming Quick Start Guide. Packt Publishing.
4. Riggs, S., et al. (2017). PostgreSQL 9.6 High Performance. Packt Publishing.
5. PostgreSQL Global Development Group. (2024). PostgreSQL 17 Documentation. <https://www.postgresql.org/docs/17/>

## 10. äº¤å‰å¼•ç”¨

### ç›¸å…³æ–‡æ¡£

#### æ ¸å¿ƒè¯¾ç¨‹

- â­â­ [ç³»ç»Ÿæ¶æ„ä¸è®¾è®¡åŸç†](../../01-æ ¸å¿ƒè¯¾ç¨‹/01.01-ç³»ç»Ÿæ¶æ„ä¸è®¾è®¡åŸç†.md) - ç³»ç»Ÿæ¶æ„åŸºç¡€
- â­ [SQLè¯­è¨€è§„èŒƒä¸æ ‡å‡†](../../01-æ ¸å¿ƒè¯¾ç¨‹/01.03-SQLè¯­è¨€è§„èŒƒä¸æ ‡å‡†.md) - SQLè¯­è¨€åŸºç¡€

#### æŸ¥è¯¢ä¸ä¼˜åŒ–

- â­â­ [ç´¢å¼•ç»“æ„ä¸ä¼˜åŒ–](../../03-æŸ¥è¯¢ä¸ä¼˜åŒ–/02.02-ç´¢å¼•ç»“æ„ä¸ä¼˜åŒ–.md) - ç´¢å¼•å¼€å‘å®è·µ
- â­ [æŸ¥è¯¢ä¼˜åŒ–å™¨åŸç†](../../03-æŸ¥è¯¢ä¸ä¼˜åŒ–/02.01-æŸ¥è¯¢ä¼˜åŒ–å™¨åŸç†.md) - æŸ¥è¯¢ä¼˜åŒ–åŸºç¡€

#### é«˜çº§ç‰¹æ€§

- â­â­ [å‘é‡æ•°æ®åº“æ”¯æŒ](./03.05-å‘é‡æ•°æ®åº“æ”¯æŒ.md) - pgvectoræ‰©å±•ç¤ºä¾‹
- â­ [å›¾æ•°æ®åº“åŠŸèƒ½](./03.06-å›¾æ•°æ®åº“åŠŸèƒ½.md) - å›¾æ•°æ®åº“æ‰©å±•

#### å‰æ²¿æŠ€æœ¯

- â­ [AIæ¨¡å‹æ·±åº¦é›†æˆ](../../07-å‰æ²¿æŠ€æœ¯/05.02-AIæ¨¡å‹æ·±åº¦é›†æˆ.md) - AIæ‰©å±•å¼€å‘

### å¤–éƒ¨èµ„æº

- [PostgreSQLæ‰©å±•å¼€å‘æ–‡æ¡£](https://www.postgresql.org/docs/current/extend.html)
- [PostgreSQLè´¡çŒ®æ‰©å±•](https://www.postgresql.org/docs/current/contrib.html)

## 11. Wikidataå¯¹é½

### 11.1 æ’ä»¶ç³»ç»Ÿæ¦‚å¿µå¯¹é½

- **Wikidata ID**: Q192490 (Plugin architecture)
- **ç›¸å…³å±æ€§**:
  - P31: Q192490 (instance of: software architecture pattern)
- **å¤–éƒ¨é“¾æ¥**:
  - [Wikipedia - Plugin architecture](https://en.wikipedia.org/wiki/Plugin_architecture)
  - [Wikipedia - Database extension](https://en.wikipedia.org/wiki/Database_extension)

**Wikipediaå®šä¹‰**: [Plugin architecture](https://en.wikipedia.org/wiki/Plugin_architecture)

> Plugin architecture is a software architecture pattern that allows functionality to be added to a system without modifying the core system.

**å¯¹é½è¯´æ˜**:

- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒæ’ä»¶ç³»ç»Ÿå…è®¸åœ¨ä¸ä¿®æ”¹æ ¸å¿ƒç³»ç»Ÿçš„æƒ…å†µä¸‹æ·»åŠ åŠŸèƒ½
- âœ… **æ¶æ„æ¨¡å¼**: éƒ½æåˆ°æ’ä»¶æ¶æ„æ˜¯ä¸€ç§è½¯ä»¶æ¶æ„æ¨¡å¼
- âœ… **æ‰©å±•æ€§**: éƒ½å¼ºè°ƒç³»ç»Ÿçš„å¯æ‰©å±•æ€§

### 11.2 PostgreSQLæ‰©å±•ç³»ç»Ÿå¯¹é½

- **Wikidata ID**: Q192490
- **ç›¸å…³å±æ€§**:
  - P31: Q176165 (instance of: database management system)
  - P178: Q9366 (developer: PostgreSQL Global Development Group)
  - P277: Q193321 (programmed in: C)
  - P348: 18.0 (software version)
- **å¤–éƒ¨é“¾æ¥**:
  - <https://www.postgresql.org/docs/current/extend.html>
  - <https://www.postgresql.org/docs/current/contrib.html>

---

## 12. å½¢å¼è¯æ˜ä¸ç†è®ºè®ºè¯

### 12.1 æ‰©å±•ç³»ç»Ÿæ¨¡å—åŒ–è¯æ˜

**å®šç†**: PostgreSQLçš„æ‰©å±•ç³»ç»Ÿå®ç°äº†åŠŸèƒ½æ¨¡å—åŒ–ï¼Œæ¯ä¸ªæ‰©å±•æ˜¯ç‹¬ç«‹çš„æ¨¡å—ã€‚

**è¯æ˜**:

```latex
\begin{theorem}[æ‰©å±•ç³»ç»Ÿæ¨¡å—åŒ–]
è®¾æ‰©å±•ç³»ç»Ÿ \extension = \{e_1, e_2, \ldots, e_n\}ï¼Œå…¶ä¸­æ¯ä¸ªæ‰©å±• e_i æ˜¯ç‹¬ç«‹çš„æ¨¡å—ã€‚

æ¨¡å—åŒ–æ¡ä»¶ï¼š
1. ç‹¬ç«‹æ€§ï¼š\forall e_i, e_j \in \extension, i \neq j: \text{interface}(e_i) \cap \text{interface}(e_j) = \emptyset
2. å¯ç»„åˆæ€§ï¼š\forall e_i, e_j \in \extension: \text{compatible}(e_i, e_j) \Rightarrow \text{compose}(e_i, e_j)
3. å¯æ›¿æ¢æ€§ï¼š\forall e_i \in \extension: \text{remove}(e_i) \Rightarrow \text{system} \setminus \{e_i\} \text{ still works}

PostgreSQLæ‰©å±•ç³»ç»Ÿæ»¡è¶³ï¼š
1. æ¯ä¸ªæ‰©å±•æœ‰ç‹¬ç«‹çš„å‘½åç©ºé—´å’Œæ¥å£
2. æ‰©å±•å¯ä»¥é€šè¿‡ä¾èµ–å…³ç³»ç»„åˆ
3. æ‰©å±•å¯ä»¥ç‹¬ç«‹å®‰è£…å’Œå¸è½½

å› æ­¤ï¼ŒPostgreSQLçš„æ‰©å±•ç³»ç»Ÿå®ç°äº†åŠŸèƒ½æ¨¡å—åŒ–ã€‚
\end{theorem}
```

### 12.2 æ‰©å±•ä¾èµ–ä¸€è‡´æ€§è¯æ˜

**å®šç†**: æ‰©å±•ä¾èµ–å…³ç³»æ»¡è¶³ä¼ é€’æ€§å’Œä¸€è‡´æ€§ã€‚

**è¯æ˜**:

```latex
\begin{theorem}[æ‰©å±•ä¾èµ–ä¸€è‡´æ€§]
è®¾æ‰©å±•ä¾èµ–å…³ç³»ä¸º \rightarrowï¼Œå…¶ä¸­ e_i \rightarrow e_j è¡¨ç¤º e_i ä¾èµ– e_jã€‚

ä¾èµ–ä¸€è‡´æ€§æ¡ä»¶ï¼š
1. ä¼ é€’æ€§ï¼šå¦‚æœ e_i \rightarrow e_j ä¸” e_j \rightarrow e_kï¼Œåˆ™ e_i \rightarrow e_k
2. æ— ç¯æ€§ï¼šä¸å­˜åœ¨å¾ªç¯ä¾èµ–ï¼Œå³ä¸å­˜åœ¨ e_1 \rightarrow e_2 \rightarrow \ldots \rightarrow e_n \rightarrow e_1
3. ç‰ˆæœ¬ä¸€è‡´æ€§ï¼šå¦‚æœ e_i \rightarrow e_jï¼Œåˆ™ \text{version}(e_i) \text{ compatible with } \text{version}(e_j)

PostgreSQLæ‰©å±•ç³»ç»Ÿï¼š
1. ä¾èµ–å…³ç³»é€šè¿‡æ‰©å±•å…ƒæ•°æ®å®šä¹‰
2. å®‰è£…æ—¶æ£€æŸ¥ä¾èµ–å…³ç³»ï¼Œç¡®ä¿æ— å¾ªç¯ä¾èµ–
3. ç‰ˆæœ¬æ£€æŸ¥ç¡®ä¿å…¼å®¹æ€§

å› æ­¤ï¼Œæ‰©å±•ä¾èµ–å…³ç³»æ»¡è¶³ä¼ é€’æ€§å’Œä¸€è‡´æ€§ã€‚
\end{theorem}
```

### 12.3 æ‰©å±•ç‰ˆæœ¬å…¼å®¹æ€§è¯æ˜

**å®šç†**: æ‰©å±•ç‰ˆæœ¬å‡çº§ä¿æŒå‘åå…¼å®¹æ€§ã€‚

**è¯æ˜**:

```latex
\begin{theorem}[æ‰©å±•ç‰ˆæœ¬å…¼å®¹æ€§]
è®¾æ‰©å±• e çš„ç‰ˆæœ¬åºåˆ—ä¸º v_1, v_2, \ldots, v_nï¼Œå…¶ä¸­ v_i < v_jï¼ˆi < jï¼‰ã€‚

å‘åå…¼å®¹æ€§æ¡ä»¶ï¼š
\forall v_i, v_j, i < j: \text{upgrade}(v_i, v_j) \Rightarrow \text{compatible}(v_i, v_j)

å…¼å®¹æ€§å®šä¹‰ï¼š
1. æ¥å£å…¼å®¹ï¼š\text{interface}(v_i) \subseteq \text{interface}(v_j)
2. æ•°æ®å…¼å®¹ï¼š\text{data}(v_i) \text{ can be migrated to } \text{data}(v_j)
3. åŠŸèƒ½å…¼å®¹ï¼š\text{functionality}(v_i) \subseteq \text{functionality}(v_j)

PostgreSQLæ‰©å±•ç³»ç»Ÿï¼š
1. ç‰ˆæœ¬å‡çº§è„šæœ¬ç¡®ä¿æ•°æ®è¿ç§»
2. æ¥å£å˜æ›´é€šè¿‡ç‰ˆæœ¬å·æ ‡è¯†
3. å‘åå…¼å®¹çš„æ¥å£ä¿æŒä¸å˜

å› æ­¤ï¼Œæ‰©å±•ç‰ˆæœ¬å‡çº§ä¿æŒå‘åå…¼å®¹æ€§ã€‚
\end{theorem}
```

---
