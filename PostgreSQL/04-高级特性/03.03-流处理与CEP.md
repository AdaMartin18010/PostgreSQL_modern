# æµå¤„ç†ä¸CEP

> **æ–‡æ¡£ç‰ˆæœ¬**: v2.0
> **æœ€åæ›´æ–°**: 2025-11-12
> **ç‰ˆæœ¬è¦†ç›–**: PostgreSQL 17+ | PostgreSQL 18 â­
> **æ–‡æ¡£çŠ¶æ€**: âœ… å·²æ›´æ–°
> ğŸ“– **æ–‡æ¡£è¯´æ˜**
>
> æœ¬æ–‡æ¡£æä¾›æµå¤„ç†ä¸CEPçš„åŸºç¡€å®ç°æ–¹æ³•ã€‚å¦‚éœ€è¯¦ç»†å†…å®¹ï¼Œè¯·å‚è€ƒï¼š
>
> - ğŸš€ [æµå¤„ç†è½åœ°æŒ‡å—](../runbook/03-é›†ç¾¤ä¸é«˜å¯ç”¨-æ¼”ç»ƒSOP.md) - ç”Ÿäº§éƒ¨ç½²æŒ‡å—
> - ğŸ“‹ [AI æ—¶ä»£ä¸“é¢˜](../ai_view.md) â­â­â­ (v3.0, 2025-11-11)

---

## ğŸ“Š æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((æµå¤„ç†ä¸CEP))
    ç†è®ºåŸºç¡€
      æ—¶é—´è¯­ä¹‰
        äº‹ä»¶æ—¶é—´
        å¤„ç†æ—¶é—´
        æ‘„å–æ—¶é—´
      çª—å£æ¨¡å‹
        æ»šåŠ¨çª—å£
        æ»‘åŠ¨çª—å£
        ä¼šè¯çª—å£
      æ°´å°æœºåˆ¶
        æ°´å°ç”Ÿæˆ
        è¿Ÿåˆ°æ•°æ®å¤„ç†
        ä¹±åºå¤„ç†
    PostgreSQLå®ç°
      å¢é‡ç‰©åŒ–
        ç‰©åŒ–è§†å›¾
        å®šæ—¶åˆ·æ–°
        è§¦å‘å™¨é©±åŠ¨
      é€šçŸ¥é€šé“
        LISTEN/NOTIFY
        äº‹ä»¶é©±åŠ¨
        å¢é‡å¤„ç†
      å¤–éƒ¨é˜Ÿåˆ—
        Kafkaé›†æˆ
        FDWå¯¼å…¥
        æµå¼å¯¼å…¥
      æµå¼è§†å›¾
        æ—¶é—´åˆ†åŒº
        ç´¢å¼•æ‰«æ
        æ»‘åŠ¨çª—å£
    CEPæ¨¡å¼
      ç®€å•æ¨¡å¼
        A->Bæ¨¡å¼
        æ—¶é—´çª—å£
        æ¡ä»¶åŒ¹é…
      å¤æ‚æ¨¡å¼
        é€’å½’CTE
        çª—å£å‡½æ•°
        æ¨¡å¼å¼•æ“
    æœ€ä½³å®è·µ
      åˆ†åŒºä¸ç´¢å¼•
        æ—¶é—´åˆ†åŒº
        é”®å€¼ç´¢å¼•
      è¿Ÿåˆ°ç­–ç•¥
        å®½æ¾çª—å£
        å‘¨æœŸå›è¡¥
        å¹‚ç­‰å†™
      å¯è§‚æµ‹æ€§
        å»¶è¿Ÿç›‘æ§
        ååç›‘æ§
        ä¸¢å¼ƒç‡ç›‘æ§
    åº”ç”¨æ¡ˆä¾‹
      å®æ—¶è®¢å•ç›‘æ§
        è®¢å•çŠ¶æ€æµ
        çŠ¶æ€è½¬æ¢
      æ—¥å¿—å®æ—¶ç»Ÿè®¡
        æ—¥å¿—èšåˆ
        æŒ‡æ ‡è®¡ç®—
      IoTäº‹ä»¶æ±‡èš
        äº‹ä»¶èšåˆ
        å‘Šè­¦æ£€æµ‹
```

---

## ğŸ“Š å¤šç»´æ¦‚å¿µçŸ©é˜µå¯¹æ¯”

### æµå¤„ç†å®ç°æ–¹æ¡ˆå¯¹æ¯”çŸ©é˜µ

| å®ç°æ–¹æ¡ˆ | å»¶è¿Ÿ | ååé‡ | å¤æ‚åº¦ | ä¸€è‡´æ€§ | é€‚ç”¨åœºæ™¯ | PostgreSQLæ”¯æŒ |
|---------|------|--------|--------|--------|---------|---------------|
| **å¢é‡ç‰©åŒ–è§†å›¾** | ä¸­ | é«˜ | ä½ | å¼ºä¸€è‡´æ€§ | å®šæœŸèšåˆ | âœ… åŸç”Ÿæ”¯æŒ |
| **LISTEN/NOTIFY** | ä½ | ä¸­ | ä½ | æœ€ç»ˆä¸€è‡´æ€§ | äº‹ä»¶é€šçŸ¥ | âœ… åŸç”Ÿæ”¯æŒ |
| **Kafka + FDW** | ä½ | å¾ˆé«˜ | é«˜ | æœ€ç»ˆä¸€è‡´æ€§ | é«˜ååæµ | âœ… FDWæ”¯æŒ |
| **æµå¼è§†å›¾** | ä¸­ | é«˜ | ä¸­ | å¼ºä¸€è‡´æ€§ | è¿‘å®æ—¶æŸ¥è¯¢ | âœ… åŸç”Ÿæ”¯æŒ |
| **è§¦å‘å™¨é©±åŠ¨** | ä½ | ä¸­ | ä¸­ | å¼ºä¸€è‡´æ€§ | å®æ—¶å¤„ç† | âœ… åŸç”Ÿæ”¯æŒ |

### çª—å£ç±»å‹å¯¹æ¯”çŸ©é˜µ

| çª—å£ç±»å‹ | çª—å£å¤§å° | æ»‘åŠ¨æ­¥é•¿ | è®¡ç®—å¤æ‚åº¦ | å†…å­˜å ç”¨ | é€‚ç”¨åœºæ™¯ | PostgreSQLå®ç° |
|---------|---------|---------|-----------|---------|---------|---------------|
| **æ»šåŠ¨çª—å£** | å›ºå®š | ç­‰äºçª—å£å¤§å° | O(n) | O(1) | å›ºå®šæ—¶é—´èšåˆ | âœ… æ”¯æŒ |
| **æ»‘åŠ¨çª—å£** | å›ºå®š | å°äºçª—å£å¤§å° | O(nÃ—k) | O(k) | é‡å çª—å£èšåˆ | âœ… æ”¯æŒ |
| **ä¼šè¯çª—å£** | åŠ¨æ€ | åŠ¨æ€ | O(n log n) | O(n) | ç”¨æˆ·ä¼šè¯åˆ†æ | âœ… æ”¯æŒ |
| **å…¨å±€çª—å£** | æ— é™ | N/A | O(n) | O(n) | å…¨é‡èšåˆ | âœ… æ”¯æŒ |

### CEPæ¨¡å¼å¤æ‚åº¦å¯¹æ¯”çŸ©é˜µ

| CEPæ¨¡å¼ | æ¨¡å¼å¤æ‚åº¦ | åŒ¹é…ç®—æ³• | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ | PostgreSQLå®ç° |
|---------|-----------|---------|-----------|-----------|---------|---------------|
| **ç®€å•åºåˆ—** | ä½ | çº¿æ€§æ‰«æ | O(n) | O(1) | A->Bæ¨¡å¼ | âœ… SQLæ”¯æŒ |
| **å¤æ‚åºåˆ—** | ä¸­ | é€’å½’CTE | O(nÂ²) | O(n) | å¤šæ­¥åºåˆ— | âœ… SQLæ”¯æŒ |
| **æ¨¡å¼åŒ¹é…** | é«˜ | çŠ¶æ€æœº | O(nÃ—m) | O(m) | å¤æ‚æ¨¡å¼ | âš ï¸ æœ‰é™æ”¯æŒ |
| **æ—¶é—´çª—å£æ¨¡å¼** | ä¸­ | çª—å£å‡½æ•° | O(n log n) | O(n) | æ—¶é—´çº¦æŸæ¨¡å¼ | âœ… SQLæ”¯æŒ |

---

## ğŸŒ Wikipediaå¯¹é½

### æµå¤„ç†æ¦‚å¿µå¯¹é½

**Wikipediaå®šä¹‰**: [Stream processing](https://en.wikipedia.org/wiki/Stream_processing)

> Stream processing is a computer programming paradigm, equivalent to dataflow programming, event stream processing, and reactive programming, that allows some applications to more easily exploit a limited form of parallel processing.

**å¯¹é½è¯´æ˜**:

- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒæµå¤„ç†æ˜¯å¤„ç†è¿ç»­æ•°æ®æµçš„ç¼–ç¨‹èŒƒå¼
- âœ… **æ ¸å¿ƒç‰¹æ€§**: éƒ½æåˆ°äº‹ä»¶æµå¤„ç†ã€å®æ—¶å¤„ç†ç­‰æ ¸å¿ƒç‰¹æ€§
- âœ… **åº”ç”¨åœºæ™¯**: éƒ½æåˆ°å®æ—¶åˆ†æã€äº‹ä»¶å¤„ç†ç­‰åº”ç”¨åœºæ™¯

### å¤æ‚äº‹ä»¶å¤„ç†æ¦‚å¿µå¯¹é½

**Wikipediaå®šä¹‰**: [Complex event processing](https://en.wikipedia.org/wiki/Complex_event_processing)

> Complex event processing (CEP) is a method of tracking and analyzing streams of information about things that happen (events), and deriving a conclusion from them.

**å¯¹é½è¯´æ˜**:

- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒCEPæ˜¯è·Ÿè¸ªå’Œåˆ†æäº‹ä»¶æµçš„æ–¹æ³•
- âœ… **æ ¸å¿ƒåŠŸèƒ½**: éƒ½æåˆ°æ¨¡å¼åŒ¹é…ã€äº‹ä»¶å…³è”ç­‰æ ¸å¿ƒåŠŸèƒ½
- âœ… **åº”ç”¨åœºæ™¯**: éƒ½æåˆ°å‘Šè­¦æ£€æµ‹ã€å¼‚å¸¸æ£€æµ‹ç­‰åº”ç”¨åœºæ™¯

### çª—å£å‡½æ•°æ¦‚å¿µå¯¹é½

**Wikipediaå®šä¹‰**: [Window function (SQL)](https://en.wikipedia.org/wiki/Window_function_(SQL))

> In SQL, a window function or analytic function is a function which uses values from one or multiple rows to return a value for each row.

**å¯¹é½è¯´æ˜**:

- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒçª—å£å‡½æ•°ä½¿ç”¨å¤šè¡Œå€¼è®¡ç®—æ¯è¡Œçš„å€¼
- âœ… **æ ¸å¿ƒç‰¹æ€§**: éƒ½æåˆ°çª—å£æ¡†æ¶ã€åˆ†åŒºç­‰æ ¸å¿ƒç‰¹æ€§
- âœ… **åº”ç”¨åœºæ™¯**: éƒ½æåˆ°æ’åã€èšåˆç­‰åº”ç”¨åœºæ™¯

---

## 1. æ¦‚è¿°

PostgreSQLå¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®ç°æµå¼æ•°æ®å¤„ç†å’Œå¤æ‚äº‹ä»¶å¤„ç†ï¼ˆCEPï¼‰ï¼š

**ç›®æ ‡**: ä»¥ PostgreSQL ç”Ÿæ€å®ç°åŸºç¡€æµå¼åˆ†æä¸ç®€åŒ–CEPæ¨¡å¼åŒ¹é…ï¼ˆä¸å¤–éƒ¨é˜Ÿåˆ—/å¼•æ“ååŒï¼‰

**é€‚ç”¨åœºæ™¯**:

- ğŸ“Š æ—¥å¿—å®æ—¶ç»Ÿè®¡
- ğŸš¨ å‘Šè­¦æ£€æµ‹
- ğŸ“¦ è®¢å•çŠ¶æ€æµ
- ğŸ”Œ IoT äº‹ä»¶æ±‡èš
- ğŸ“ˆ å®æ—¶æŒ‡æ ‡è®¡ç®—

---

## 2. æ—¶é—´ä¸çª—å£æ¨¡å‹

- æ—¶é—´è¯­ä¹‰ï¼šäº‹ä»¶æ—¶é—´ï¼ˆevent timeï¼‰ä¸å¤„ç†æ—¶é—´ï¼ˆprocessing timeï¼‰ï¼›
- æ°´å°ï¼ˆwatermarkï¼‰ï¼šè¿‘ä¼¼ç•Œå®šè¿Ÿåˆ°æ•°æ®çš„é˜ˆå€¼ï¼›
- çª—å£ï¼šæ»šåŠ¨/æ»‘åŠ¨/ä¼šè¯çª—å£ä¸è¿Ÿåˆ°å¤„ç†ç­–ç•¥ï¼ˆè¡¥å‘/ä¸¢å¼ƒ/æ›´æ­£ï¼‰ã€‚

```sql
-- æ»šåŠ¨çª—å£ï¼ˆæŒ‰åˆ†é’Ÿèšåˆï¼‰ç¤ºæ„
SELECT date_trunc('minute', ts) AS win,
       count(*) AS cnt
FROM events
WHERE ts >= now() - interval '10 minutes'
GROUP BY 1
ORDER BY 1;
```

## 3. PostgreSQL å®ç°è·¯å¾„

- å¢é‡ç‰©åŒ–ï¼šåŸºäºç‰©åŒ–è§†å›¾ + å®šæ—¶åˆ·æ–°/è§¦å‘å™¨ï¼Œç»“åˆ `1.1.47` å¢é‡è§„åˆ™ï¼›
- é€šçŸ¥é€šé“ï¼š`LISTEN/NOTIFY` é©±åŠ¨åº”ç”¨å±‚å¢é‡å¤„ç†ï¼›
- å¤–éƒ¨é˜Ÿåˆ—/FDWï¼šKafka/Redpanda + FDW å¯¼å…¥ï¼›
- æµå¼è§†å›¾ï¼šåŸºäºæ—¶é—´åˆ†åŒº + ç´¢å¼•æ‰«æå®ç°è¿‘å®æ—¶æ»‘åŠ¨çª—å£ã€‚

```sql
-- è¿‘å®æ—¶æ»‘åŠ¨çª—å£èšåˆï¼ˆæŒ‰5åˆ†é’Ÿï¼‰
WITH w AS (
  SELECT date_trunc('minute', ts) AS m, payload
  FROM events
  WHERE ts >= now() - interval '30 minutes'
)
SELECT date_trunc('minute', m) - (EXTRACT(MINUTE FROM m)::int % 5) * interval '1 minute' AS win,
       count(*)
FROM w
GROUP BY 1
ORDER BY 1;
```

## 4. ç®€åŒ–CEPæ¨¡å¼ï¼ˆç¤ºæ„ï¼‰

- æ¨¡å¼ï¼šA äº‹ä»¶å T å†…å‡ºç° Bï¼ˆåŒ keyï¼‰è§¦å‘å‘Šè­¦ï¼›

```sql
-- A->B æ¨¡å¼ï¼šåŒç”¨æˆ· 1 åˆ†é’Ÿå†…
WITH a AS (
  SELECT user_id, ts FROM events WHERE type = 'A'
), b AS (
  SELECT user_id, ts FROM events WHERE type = 'B'
)
SELECT a.user_id, a.ts AS a_ts, b.ts AS b_ts
FROM a JOIN b USING (user_id)
WHERE b.ts >= a.ts AND b.ts < a.ts + interval '1 minute';
```

- æ›´å¤šå¤æ‚åºåˆ—å¯å€Ÿé€’å½’CTE/çª—å£å‡½æ•°è¡¨è¾¾ï¼Œæˆ–å°†æ¨¡å¼å¼•æ“ï¼ˆFlink/Esperï¼‰ä¸PGè”åŠ¨ã€‚

## 5. æœ€ä½³å®è·µ

- åˆ†åŒºä¸ç´¢å¼•ï¼šæ—¶é—´åˆ†åŒº + `(key, ts)` ç´¢å¼•ï¼›
- è¿Ÿåˆ°ç­–ç•¥ï¼šä¿ç•™ä¸€æ®µå®½æ¾çª—å£ï¼Œå‘¨æœŸå›è¡¥å†å‘å¸ƒï¼ˆå¹‚ç­‰å†™ï¼‰ï¼›
- å¯è§‚æµ‹ï¼šå»¶è¿Ÿã€ååã€ä¸¢å¼ƒ/è¡¥å‘æ¯”ç‡ã€åˆ·æ–°è€—æ—¶ï¼›
- ä¸€è‡´æ€§ï¼šExactly-Once é€šè¿‡å¹‚ç­‰å†™ + å»é‡é”®å®ç°ã€‚

## 6. å®æˆ˜æ¡ˆä¾‹

### æ¡ˆä¾‹1: å®æ—¶è®¢å•çŠ¶æ€ç›‘æ§

```sql
-- âœ… [å¯è¿è¡Œ] å®æ—¶è®¢å•çŠ¶æ€æµå¤„ç†
CREATE TABLE orders (
    order_id UUID PRIMARY KEY,
    user_id UUID,
    status VARCHAR(50),
    amount DECIMAL(10,2),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- åˆ›å»ºç‰©åŒ–è§†å›¾ç”¨äºå®æ—¶ç»Ÿè®¡
CREATE MATERIALIZED VIEW order_stats_5min AS
SELECT
    date_trunc('minute', created_at) -
    (EXTRACT(MINUTE FROM created_at)::int % 5) * interval '1 minute' AS time_window,
    status,
    COUNT(*) AS order_count,
    SUM(amount) AS total_amount
FROM orders
WHERE created_at >= now() - interval '1 hour'
GROUP BY 1, 2;

CREATE UNIQUE INDEX ON order_stats_5min (time_window, status);

-- å®šæ—¶åˆ·æ–°ï¼ˆé€šè¿‡pg_cronæˆ–å¤–éƒ¨è°ƒåº¦ï¼‰
REFRESH MATERIALIZED VIEW CONCURRENTLY order_stats_5min;
```

### æ¡ˆä¾‹2: IoTè®¾å¤‡å¼‚å¸¸æ£€æµ‹

```sql
-- âœ… [å¯è¿è¡Œ] IoTè®¾å¤‡å¼‚å¸¸æ£€æµ‹CEP
CREATE TABLE device_events (
    device_id VARCHAR(100),
    event_type VARCHAR(50),
    value FLOAT,
    event_time TIMESTAMPTZ DEFAULT NOW()
);

-- æ£€æµ‹æ¨¡å¼ï¼šæ¸©åº¦å¼‚å¸¸å5åˆ†é’Ÿå†…å‡ºç°å‘Šè­¦
WITH temp_anomaly AS (
    SELECT device_id, event_time AS anomaly_time
    FROM device_events
    WHERE event_type = 'temperature' AND value > 80
),
alert_events AS (
    SELECT device_id, event_time AS alert_time
    FROM device_events
    WHERE event_type = 'alert'
)
SELECT
    t.device_id,
    t.anomaly_time,
    a.alert_time,
    a.alert_time - t.anomaly_time AS time_to_alert
FROM temp_anomaly t
JOIN alert_events a USING (device_id)
WHERE a.alert_time >= t.anomaly_time
  AND a.alert_time < t.anomaly_time + interval '5 minutes';
```

### æ¡ˆä¾‹3: ç”¨æˆ·è¡Œä¸ºåºåˆ—åˆ†æ

```sql
-- âœ… [å¯è¿è¡Œ] ç”¨æˆ·è¡Œä¸ºåºåˆ—æ¨¡å¼åŒ¹é…
CREATE TABLE user_actions (
    user_id UUID,
    action_type VARCHAR(50),
    action_time TIMESTAMPTZ DEFAULT NOW()
);

-- æ£€æµ‹æ¨¡å¼ï¼šç”¨æˆ·ç™»å½•å1å°æ—¶å†…å®Œæˆè´­ä¹°
WITH login_events AS (
    SELECT user_id, action_time AS login_time
    FROM user_actions
    WHERE action_type = 'login'
),
purchase_events AS (
    SELECT user_id, action_time AS purchase_time
    FROM user_actions
    WHERE action_type = 'purchase'
)
SELECT
    l.user_id,
    l.login_time,
    p.purchase_time,
    p.purchase_time - l.login_time AS conversion_time
FROM login_events l
JOIN purchase_events p USING (user_id)
WHERE p.purchase_time >= l.login_time
  AND p.purchase_time < l.login_time + interval '1 hour';
```

---

## 7. æ·±å…¥é˜…è¯»

### ç›¸å…³æ–‡æ¡£

#### ç†è®ºåŸºç¡€

- â­â­ [å½¢å¼åŒ–éªŒè¯æ–¹æ³•](../../æ•°æ®åº“ç†è®º/10.01-å½¢å¼åŒ–éªŒè¯æ–¹æ³•.md) - æµå¤„ç†å½¢å¼åŒ–ç†è®º
- â­ [å­¦æœ¯ç ”ç©¶å‰æ²¿](../../æ•°æ®åº“ç†è®º/10.02-å­¦æœ¯ç ”ç©¶å‰æ²¿.md) - æµå¤„ç†ç ”ç©¶

#### æŸ¥è¯¢ä¸ä¼˜åŒ–

- â­â­ [æ‰§è¡Œè®¡åˆ’ä¸æ€§èƒ½è°ƒä¼˜](../../03-æŸ¥è¯¢ä¸ä¼˜åŒ–/02.04-æ‰§è¡Œè®¡åˆ’ä¸æ€§èƒ½è°ƒä¼˜.md) - å¢é‡æ›´æ–°ç­–ç•¥
- â­ [å¹¶è¡ŒæŸ¥è¯¢å¤„ç†](../../03-æŸ¥è¯¢ä¸ä¼˜åŒ–/02.05-å¹¶è¡ŒæŸ¥è¯¢å¤„ç†.md) - å¹¶è¡Œæµå¤„ç†

#### æ•°æ®æ¨¡å‹è®¾è®¡

- â­â­ [ETLæµç¨‹å®Œæ•´æŒ‡å—](../../09-åº”ç”¨è®¾è®¡/æ•°æ®æ¨¡å‹è®¾è®¡/09.04-ETLæµç¨‹å®Œæ•´æŒ‡å—.md) - æµå¼ETLå¤„ç†

#### æ ¸å¿ƒåŸºç¡€

- â­â­ [å­˜å‚¨ç®¡ç†ä¸æ•°æ®æŒä¹…åŒ–](../../01-æ ¸å¿ƒåŸºç¡€/01.06-å­˜å‚¨ç®¡ç†ä¸æ•°æ®æŒä¹…åŒ–.md) - æµæ•°æ®åˆ—å­˜å‚¨ä¼˜åŒ–ã€åˆ—å­˜å‚¨ç”¨äºæµå¼åˆ†æğŸ†•

#### è¿ç»´å®è·µ

- â­â­ [ç›‘æ§ä¸è¯Šæ–­](../../06-è¿ç»´å®è·µ/ç›‘æ§ä¸è¯Šæ–­/06.01-ç›‘æ§ä¸è¯Šæ–­.md) - æµå¤„ç†ç›‘æ§

#### å‰æ²¿æŠ€æœ¯

- â­â­ [AI æ—¶ä»£ä¸“é¢˜](../../ai_view.md) - å¤šæ¨¡ä¸€ä½“åŒ–åœºæ™¯

### å¤–éƒ¨èµ„æº

- [PostgreSQL LISTEN/NOTIFY](https://www.postgresql.org/docs/current/sql-notify.html)
- [TimescaleDB Continuous Aggregates](https://docs.timescale.com/timescaledb/latest/how-to-guides/continuous-aggregates/)
- [Apache Flink CEP](https://nightlies.apache.org/flink/flink-docs-release-1.17/docs/libs/cep/)

---

## 7. å½¢å¼è¯æ˜ä¸ç†è®ºè®ºè¯

### 7.1 æµå¤„ç†ä¸€è‡´æ€§è¯æ˜

**å®šç†**: åŸºäºç‰©åŒ–è§†å›¾çš„æµå¤„ç†ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚

**è¯æ˜**:

```latex
\begin{theorem}[æµå¤„ç†ä¸€è‡´æ€§]
è®¾æµæ•°æ® S = \{e_1, e_2, \ldots, e_n\}ï¼Œç‰©åŒ–è§†å›¾ M åŸºäºæŸ¥è¯¢ Qã€‚

ç‰©åŒ–è§†å›¾æ›´æ–°ï¼š
M_{t+1} = Q(S_{t+1}) = Q(S_t \cup \{e_{t+1}\})

æœ€ç»ˆä¸€è‡´æ€§ï¼š
\lim_{t \to \infty} M_t = Q(S)

å…¶ä¸­ S = \bigcup_{i=1}^{\infty} \{e_i\} ä¸ºå®Œæ•´æ•°æ®æµã€‚

PostgreSQLç‰©åŒ–è§†å›¾ï¼š
1. ç‰©åŒ–è§†å›¾å­˜å‚¨æŸ¥è¯¢ç»“æœ
2. REFRESH MATERIALIZED VIEW æ›´æ–°è§†å›¾
3. å®šæœŸåˆ·æ–°ä¿è¯æœ€ç»ˆä¸€è‡´æ€§

å› æ­¤ï¼ŒåŸºäºç‰©åŒ–è§†å›¾çš„æµå¤„ç†ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚
\end{theorem}
```

### 7.2 çª—å£å‡½æ•°æ­£ç¡®æ€§è¯æ˜

**å®šç†**: çª—å£å‡½æ•°åœ¨çª—å£æ¡†æ¶å†…æ­£ç¡®è®¡ç®—èšåˆå€¼ã€‚

**è¯æ˜**:

```latex
\begin{theorem}[çª—å£å‡½æ•°æ­£ç¡®æ€§]
è®¾çª—å£å‡½æ•° f åœ¨çª—å£æ¡†æ¶ W å†…è®¡ç®—èšåˆå€¼ã€‚

çª—å£æ¡†æ¶å®šä¹‰ï¼š
W = \{r_i | \text{frame\_start} \leq i \leq \text{frame\_end}\}

çª—å£å‡½æ•°è®¡ç®—ï¼š
f(W) = \text{aggregate}(\{r_i.\text{value} | r_i \in W\})

æ­£ç¡®æ€§æ¡ä»¶ï¼š
\forall r_i \in W: f(r_i) = f(W)

PostgreSQLçª—å£å‡½æ•°ï¼š
1. çª—å£æ¡†æ¶åŸºäºORDER BYå’ŒROWS/RANGEå®šä¹‰
2. æ¯ä¸ªè¡Œåœ¨çª—å£æ¡†æ¶å†…è®¡ç®—èšåˆå€¼
3. çª—å£å‡½æ•°ç»“æœä¸çª—å£æ¡†æ¶ä¸€è‡´

å› æ­¤ï¼Œçª—å£å‡½æ•°åœ¨çª—å£æ¡†æ¶å†…æ­£ç¡®è®¡ç®—èšåˆå€¼ã€‚
\end{theorem}
```

### 7.3 CEPæ¨¡å¼åŒ¹é…æ­£ç¡®æ€§è¯æ˜

**å®šç†**: CEPæ¨¡å¼åŒ¹é…ç®—æ³•èƒ½å¤Ÿæ­£ç¡®è¯†åˆ«äº‹ä»¶åºåˆ—æ¨¡å¼ã€‚

**è¯æ˜**:

```latex
\begin{theorem}[CEPæ¨¡å¼åŒ¹é…æ­£ç¡®æ€§]
è®¾äº‹ä»¶åºåˆ— S = \{e_1, e_2, \ldots, e_n\}ï¼Œæ¨¡å¼ P = A \rightarrow Bã€‚

æ¨¡å¼åŒ¹é…å®šä¹‰ï¼š
\text{match}(S, P) = \exists i, j: (e_i.\text{type} = A) \land (e_j.\text{type} = B) \land (j > i) \land (t_j - t_i \leq T)

æ­£ç¡®æ€§æ¡ä»¶ï¼š
1. å®Œå¤‡æ€§ï¼šå¦‚æœ S åŒ…å«æ¨¡å¼ Pï¼Œåˆ™ \text{match}(S, P) = \text{true}
2. æ­£ç¡®æ€§ï¼šå¦‚æœ \text{match}(S, P) = \text{true}ï¼Œåˆ™ S åŒ…å«æ¨¡å¼ P

PostgreSQL CEPå®ç°ï¼š
1. ä½¿ç”¨JOINå’ŒWHEREæ¡ä»¶åŒ¹é…æ¨¡å¼
2. æ—¶é—´çª—å£çº¦æŸé€šè¿‡æ—¶é—´æ¡ä»¶å®ç°
3. é€’å½’CTEæ”¯æŒå¤æ‚åºåˆ—æ¨¡å¼

å› æ­¤ï¼ŒCEPæ¨¡å¼åŒ¹é…ç®—æ³•èƒ½å¤Ÿæ­£ç¡®è¯†åˆ«äº‹ä»¶åºåˆ—æ¨¡å¼ã€‚
\end{theorem}
```

---

## 8. Wikipediaå¯¹é½

### 8.1 æµå¤„ç†æ¦‚å¿µå¯¹é½

- **Wikidata ID**: Q192490 (Stream processing)
- **ç›¸å…³å±æ€§**:
  - P31: Q192490 (instance of: programming paradigm)
- **å¤–éƒ¨é“¾æ¥**:
  - [Wikipedia - Stream processing](https://en.wikipedia.org/wiki/Stream_processing)
  - [Wikipedia - Complex event processing](https://en.wikipedia.org/wiki/Complex_event_processing)
  - [Wikipedia - Window function](https://en.wikipedia.org/wiki/Window_function_(SQL))

**Wikipediaå®šä¹‰**: [Stream processing](https://en.wikipedia.org/wiki/Stream_processing)

> Stream processing is a computer programming paradigm, equivalent to dataflow programming, event stream processing, and reactive programming, that allows some applications to more easily exploit a limited form of parallel processing.

**å¯¹é½è¯´æ˜**:

- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒæµå¤„ç†æ˜¯å¤„ç†è¿ç»­æ•°æ®æµçš„ç¼–ç¨‹èŒƒå¼
- âœ… **æ ¸å¿ƒç‰¹æ€§**: éƒ½æåˆ°äº‹ä»¶æµå¤„ç†ã€å®æ—¶å¤„ç†ç­‰æ ¸å¿ƒç‰¹æ€§
- âœ… **åº”ç”¨åœºæ™¯**: éƒ½æåˆ°å®æ—¶åˆ†æã€äº‹ä»¶å¤„ç†ç­‰åº”ç”¨åœºæ™¯

### 8.2 å¤æ‚äº‹ä»¶å¤„ç†æ¦‚å¿µå¯¹é½

**Wikipediaå®šä¹‰**: [Complex event processing](https://en.wikipedia.org/wiki/Complex_event_processing)

> Complex event processing (CEP) is a method of tracking and analyzing streams of information about things that happen (events), and deriving a conclusion from them.

**å¯¹é½è¯´æ˜**:

- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒCEPæ˜¯è·Ÿè¸ªå’Œåˆ†æäº‹ä»¶æµçš„æ–¹æ³•
- âœ… **æ ¸å¿ƒåŠŸèƒ½**: éƒ½æåˆ°æ¨¡å¼åŒ¹é…ã€äº‹ä»¶å…³è”ç­‰æ ¸å¿ƒåŠŸèƒ½
- âœ… **åº”ç”¨åœºæ™¯**: éƒ½æåˆ°å‘Šè­¦æ£€æµ‹ã€å¼‚å¸¸æ£€æµ‹ç­‰åº”ç”¨åœºæ™¯

### 8.3 PostgreSQLæµå¤„ç†å¯¹é½

- **Wikidata ID**: Q192490
- **ç›¸å…³å±æ€§**:
  - P31: Q176165 (instance of: database management system)
  - P178: Q9366 (developer: PostgreSQL Global Development Group)
  - P277: Q193321 (programmed in: C)
  - P348: 18.0 (software version)
- **å¤–éƒ¨é“¾æ¥**:
  - <https://www.postgresql.org/docs/current/sql-creatematerializedview.html>
  - <https://www.postgresql.org/docs/current/sql-notify.html>

---

## 9. å‚è€ƒæ–‡çŒ®

1. PostgreSQL Global Development Group. (2025). PostgreSQL 18 Documentation. <https://www.postgresql.org/docs/18/>
2. PostgreSQLå®˜æ–¹æ–‡æ¡£ - [LISTEN/NOTIFY](https://www.postgresql.org/docs/current/sql-notify.html)
3. TimescaleDBæ–‡æ¡£ - [Continuous Aggregates](https://docs.timescale.com/timescaledb/latest/how-to-guides/continuous-aggregates/)
4. Apache Flink - [Complex Event Processing](https://nightlies.apache.org/flink/flink-docs-release-1.17/docs/libs/cep/)
5. PostgreSQLå®˜æ–¹æ–‡æ¡£ - [Materialized Views](https://www.postgresql.org/docs/current/sql-creatematerializedview.html)
6. PostgreSQL Global Development Group. (2024). PostgreSQL 17 Documentation. <https://www.postgresql.org/docs/17/>
