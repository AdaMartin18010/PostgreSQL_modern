# PostgreSQL åˆ†å¸ƒå¼æ¶æ„è®¾è®¡

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **æœ€åæ›´æ–°**: 2025-11-12
> **ç‰ˆæœ¬è¦†ç›–**: PostgreSQL 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x (å…¼å®¹)
> **æ–‡æ¡£çŠ¶æ€**: âœ… å·²åˆ›å»º
> **å¯¹æ ‡æ ‡å‡†**: MIT/Stanfordåˆ†å¸ƒå¼æ•°æ®åº“è¯¾ç¨‹ã€Cituså®˜æ–¹æ–‡æ¡£

---

## ğŸ“‹ ç›®å½•

- [PostgreSQL åˆ†å¸ƒå¼æ¶æ„è®¾è®¡](#postgresql-åˆ†å¸ƒå¼æ¶æ„è®¾è®¡)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [ğŸ“Š æ€ç»´å¯¼å›¾](#-æ€ç»´å¯¼å›¾)
  - [ğŸ“Š å¤šç»´æ¦‚å¿µçŸ©é˜µå¯¹æ¯”](#-å¤šç»´æ¦‚å¿µçŸ©é˜µå¯¹æ¯”)
    - [åˆ†å¸ƒå¼æ–¹æ¡ˆå¯¹æ¯”çŸ©é˜µ](#åˆ†å¸ƒå¼æ–¹æ¡ˆå¯¹æ¯”çŸ©é˜µ)
    - [åˆ†ç‰‡ç­–ç•¥å¯¹æ¯”çŸ©é˜µ](#åˆ†ç‰‡ç­–ç•¥å¯¹æ¯”çŸ©é˜µ)
    - [ä¸€è‡´æ€§æ¨¡å‹å¯¹æ¯”çŸ©é˜µ](#ä¸€è‡´æ€§æ¨¡å‹å¯¹æ¯”çŸ©é˜µ)
  - [ğŸŒ Wikipediaå¯¹é½](#-wikipediaå¯¹é½)
    - [åˆ†å¸ƒå¼æ•°æ®åº“æ¦‚å¿µå¯¹é½](#åˆ†å¸ƒå¼æ•°æ®åº“æ¦‚å¿µå¯¹é½)
    - [CAPå®šç†æ¦‚å¿µå¯¹é½](#capå®šç†æ¦‚å¿µå¯¹é½)
    - [åˆ†ç‰‡æ¦‚å¿µå¯¹é½](#åˆ†ç‰‡æ¦‚å¿µå¯¹é½)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
  - [2. åˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºåŸºç¡€](#2-åˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºåŸºç¡€)
    - [2.1 CAPå®šç†](#21-capå®šç†)
    - [2.2 åˆ†å¸ƒå¼ä¸€è‡´æ€§æ¨¡å‹](#22-åˆ†å¸ƒå¼ä¸€è‡´æ€§æ¨¡å‹)
    - [2.3 åˆ†å¸ƒå¼äº‹åŠ¡ç†è®º](#23-åˆ†å¸ƒå¼äº‹åŠ¡ç†è®º)
  - [3. Citusåˆ†å¸ƒå¼æ‰©å±•](#3-citusåˆ†å¸ƒå¼æ‰©å±•)
    - [3.1 Citusæ¶æ„è®¾è®¡](#31-citusæ¶æ„è®¾è®¡)
    - [3.2 åˆ†å¸ƒå¼è¡¨è®¾è®¡](#32-åˆ†å¸ƒå¼è¡¨è®¾è®¡)
    - [3.3 åˆ†å¸ƒå¼æŸ¥è¯¢ä¼˜åŒ–](#33-åˆ†å¸ƒå¼æŸ¥è¯¢ä¼˜åŒ–)
    - [3.4 Citusé…ç½®ä¸ä¼˜åŒ–](#34-citusé…ç½®ä¸ä¼˜åŒ–)
  - [4. Greenplumæ•°æ®ä»“åº“](#4-greenplumæ•°æ®ä»“åº“)
    - [4.1 Greenplumæ¶æ„](#41-greenplumæ¶æ„)
    - [4.2 æ•°æ®åˆ†å¸ƒç­–ç•¥](#42-æ•°æ®åˆ†å¸ƒç­–ç•¥)
    - [4.3 å¹¶è¡ŒæŸ¥è¯¢ä¼˜åŒ–](#43-å¹¶è¡ŒæŸ¥è¯¢ä¼˜åŒ–)
  - [5. PostgreSQL-XLé›†ç¾¤](#5-postgresql-xlé›†ç¾¤)
    - [5.1 PostgreSQL-XLæ¶æ„](#51-postgresql-xlæ¶æ„)
    - [5.2 åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†](#52-åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†)
  - [6. åˆ†å¸ƒå¼æ¶æ„å¯¹æ¯”](#6-åˆ†å¸ƒå¼æ¶æ„å¯¹æ¯”)
  - [7. å®æˆ˜æ¡ˆä¾‹](#7-å®æˆ˜æ¡ˆä¾‹)
    - [7.1 å¤šç§Ÿæˆ·SaaSæ¶æ„](#71-å¤šç§Ÿæˆ·saasæ¶æ„)
    - [7.2 å…¨çƒåˆ†å¸ƒå¼éƒ¨ç½²](#72-å…¨çƒåˆ†å¸ƒå¼éƒ¨ç½²)
    - [7.3 æ•°æ®åˆ†ç‰‡ç­–ç•¥](#73-æ•°æ®åˆ†ç‰‡ç­–ç•¥)
  - [8. æ€§èƒ½ä¼˜åŒ–](#8-æ€§èƒ½ä¼˜åŒ–)
    - [8.1 æŸ¥è¯¢ä¼˜åŒ–](#81-æŸ¥è¯¢ä¼˜åŒ–)
    - [8.2 PostgreSQL 18ä¼˜åŒ–](#82-postgresql-18ä¼˜åŒ–)
  - [9. ç›‘æ§ä¸è¯Šæ–­](#9-ç›‘æ§ä¸è¯Šæ–­)
    - [9.1 Citusç›‘æ§](#91-citusç›‘æ§)
    - [9.2 æ€§èƒ½è¯Šæ–­](#92-æ€§èƒ½è¯Šæ–­)
  - [10. ç›¸å…³æ–‡æ¡£](#10-ç›¸å…³æ–‡æ¡£)
    - [éƒ¨ç½²æ¶æ„](#éƒ¨ç½²æ¶æ„)
    - [æ ¸å¿ƒè¯¾ç¨‹](#æ ¸å¿ƒè¯¾ç¨‹)
    - [é«˜çº§ç‰¹æ€§](#é«˜çº§ç‰¹æ€§)
    - [æ•°æ®æ¨¡å‹è®¾è®¡](#æ•°æ®æ¨¡å‹è®¾è®¡)
    - [è¿ç»´å®è·µ](#è¿ç»´å®è·µ)
    - [ç†è®ºåŸºç¡€](#ç†è®ºåŸºç¡€)
  - [11. å‚è€ƒæ–‡çŒ®](#11-å‚è€ƒæ–‡çŒ®)

---

## ğŸ“Š æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((åˆ†å¸ƒå¼æ¶æ„è®¾è®¡))
    ç†è®ºåŸºç¡€
      CAPå®šç†
        ä¸€è‡´æ€§
        å¯ç”¨æ€§
        åˆ†åŒºå®¹é”™
      ä¸€è‡´æ€§æ¨¡å‹
        å¼ºä¸€è‡´æ€§
        æœ€ç»ˆä¸€è‡´æ€§
        å¼±ä¸€è‡´æ€§
      åˆ†å¸ƒå¼äº‹åŠ¡
        2PCåè®®
        SAGAæ¨¡å¼
        åˆ†å¸ƒå¼é”
    åˆ†å¸ƒå¼æ–¹æ¡ˆ
      Citusæ‰©å±•
        åˆ†ç‰‡æ¶æ„
        åˆ†å¸ƒå¼è¡¨
        æŸ¥è¯¢ä¼˜åŒ–
      Greenplum
        MPPæ¶æ„
        æ•°æ®åˆ†å¸ƒ
        å¹¶è¡ŒæŸ¥è¯¢
      PostgreSQL-XL
        å¤šä¸»æ¶æ„
        åˆ†å¸ƒå¼äº‹åŠ¡
        åè°ƒèŠ‚ç‚¹
    åˆ†ç‰‡ç­–ç•¥
      å“ˆå¸Œåˆ†ç‰‡
        ä¸€è‡´æ€§å“ˆå¸Œ
        å“ˆå¸Œå‡½æ•°
      èŒƒå›´åˆ†ç‰‡
        èŒƒå›´åˆ’åˆ†
        çƒ­ç‚¹é—®é¢˜
      ç›®å½•åˆ†ç‰‡
        æŸ¥æ‰¾è¡¨
        åŠ¨æ€åˆ†ç‰‡
    æŸ¥è¯¢ä¼˜åŒ–
      åˆ†å¸ƒå¼æŸ¥è¯¢
        æŸ¥è¯¢ä¸‹æ¨
        å¹¶è¡Œæ‰§è¡Œ
        ç»“æœåˆå¹¶
      è¿æ¥ä¼˜åŒ–
        æœ¬åœ°è¿æ¥
        é‡åˆ†å¸ƒè¿æ¥
        å¹¿æ’­è¿æ¥
    ä¸€è‡´æ€§ä¿è¯
      å¼ºä¸€è‡´æ€§
        åŒæ­¥å¤åˆ¶
        åˆ†å¸ƒå¼é”
      æœ€ç»ˆä¸€è‡´æ€§
        å¼‚æ­¥å¤åˆ¶
        å†²çªè§£å†³
    åº”ç”¨æ¡ˆä¾‹
      å¤šç§Ÿæˆ·SaaS
        ç§Ÿæˆ·åˆ†ç‰‡
        æ•°æ®éš”ç¦»
      å…¨çƒåˆ†å¸ƒå¼
        åœ°ç†åˆ†å¸ƒ
        å»¶è¿Ÿä¼˜åŒ–
      æ•°æ®ä»“åº“
        åˆ†ææŸ¥è¯¢
        å¹¶è¡Œå¤„ç†
```

---

## ğŸ“Š å¤šç»´æ¦‚å¿µçŸ©é˜µå¯¹æ¯”

### åˆ†å¸ƒå¼æ–¹æ¡ˆå¯¹æ¯”çŸ©é˜µ

| åˆ†å¸ƒå¼æ–¹æ¡ˆ | æ¶æ„ç±»å‹ | åˆ†ç‰‡ç²’åº¦ | æŸ¥è¯¢èƒ½åŠ› | äº‹åŠ¡æ”¯æŒ | é€‚ç”¨åœºæ™¯ | PostgreSQLæ”¯æŒ |
|---------|---------|---------|---------|---------|---------|---------------|
| **Citus** | æ‰©å±• | è¡¨çº§ | é«˜ | åˆ†å¸ƒå¼äº‹åŠ¡ | å¤šç§Ÿæˆ·ã€å®æ—¶åˆ†æ | âœ… æ‰©å±•æ”¯æŒ |
| **Greenplum** | MPP | è¡¨çº§ | å¾ˆé«˜ | åˆ†å¸ƒå¼äº‹åŠ¡ | æ•°æ®ä»“åº“ã€OLAP | âœ… åŸºäºPG |
| **PostgreSQL-XL** | å¤šä¸» | è¡¨çº§ | é«˜ | åˆ†å¸ƒå¼äº‹åŠ¡ | å¤§è§„æ¨¡OLTP | âœ… åŸºäºPG |
| **åŸç”ŸPostgreSQL** | å•æœº | N/A | ä¸­ | å•æœºäº‹åŠ¡ | å°è§„æ¨¡åº”ç”¨ | âœ… åŸç”Ÿæ”¯æŒ |

### åˆ†ç‰‡ç­–ç•¥å¯¹æ¯”çŸ©é˜µ

| åˆ†ç‰‡ç­–ç•¥ | æ•°æ®åˆ†å¸ƒ | æŸ¥è¯¢æ€§èƒ½ | æ‰©å±•æ€§ | çƒ­ç‚¹é—®é¢˜ | é€‚ç”¨åœºæ™¯ | PostgreSQLæ”¯æŒ |
|---------|---------|---------|--------|---------|---------|---------------|
| **å“ˆå¸Œåˆ†ç‰‡** | å‡åŒ€ | é«˜ | é«˜ | ä½ | å‡åŒ€è´Ÿè½½ | âœ… Citusæ”¯æŒ |
| **èŒƒå›´åˆ†ç‰‡** | æœ‰åº | ä¸­ | ä¸­ | é«˜ | èŒƒå›´æŸ¥è¯¢ | âœ… Citusæ”¯æŒ |
| **ç›®å½•åˆ†ç‰‡** | çµæ´» | ä¸­ | ä¸­ | ä¸­ | åŠ¨æ€åˆ†ç‰‡ | âœ… Citusæ”¯æŒ |
| **å¤åˆ¶åˆ†ç‰‡** | å…¨å¤åˆ¶ | å¾ˆé«˜ | ä½ | ä½ | å°è¡¨ | âœ… Citusæ”¯æŒ |

### ä¸€è‡´æ€§æ¨¡å‹å¯¹æ¯”çŸ©é˜µ

| ä¸€è‡´æ€§æ¨¡å‹ | ä¸€è‡´æ€§å¼ºåº¦ | æ€§èƒ½ | å¯ç”¨æ€§ | å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ | PostgreSQLæ”¯æŒ |
|---------|-----------|------|--------|--------|---------|---------------|
| **å¼ºä¸€è‡´æ€§** | æœ€é«˜ | ä½ | ä½ | é«˜ | é‡‘èåœºæ™¯ | âœ… åŒæ­¥å¤åˆ¶ |
| **æœ€ç»ˆä¸€è‡´æ€§** | ä½ | é«˜ | é«˜ | ä¸­ | é€šç”¨åœºæ™¯ | âœ… å¼‚æ­¥å¤åˆ¶ |
| **ä¼šè¯ä¸€è‡´æ€§** | ä¸­ | ä¸­ | ä¸­ | ä¸­ | Webåº”ç”¨ | âœ… åº”ç”¨å±‚å®ç° |
| **å› æœä¸€è‡´æ€§** | ä¸­ | ä¸­ | ä¸­ | é«˜ | åˆ†å¸ƒå¼ç³»ç»Ÿ | âš ï¸ æœ‰é™æ”¯æŒ |

---

## ğŸŒ Wikipediaå¯¹é½

### åˆ†å¸ƒå¼æ•°æ®åº“æ¦‚å¿µå¯¹é½

**Wikipediaå®šä¹‰**: [Distributed database](https://en.wikipedia.org/wiki/Distributed_database)

> A distributed database is a database in which data is stored across different physical locations. It may be stored in multiple computers located in the same physical location, or may be dispersed over a network of interconnected computers.

**å¯¹é½è¯´æ˜**:

- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒåˆ†å¸ƒå¼æ•°æ®åº“çš„æ•°æ®å­˜å‚¨åœ¨å¤šä¸ªç‰©ç†ä½ç½®
- âœ… **æ ¸å¿ƒç‰¹æ€§**: éƒ½æåˆ°æ•°æ®åˆ†å¸ƒã€æŸ¥è¯¢ä¼˜åŒ–ã€äº‹åŠ¡ç®¡ç†ç­‰æ ¸å¿ƒç‰¹æ€§
- âœ… **åº”ç”¨åœºæ™¯**: éƒ½æåˆ°å¤§è§„æ¨¡æ•°æ®ã€é«˜å¯ç”¨æ€§ã€æ°´å¹³æ‰©å±•ç­‰åº”ç”¨åœºæ™¯

### CAPå®šç†æ¦‚å¿µå¯¹é½

**Wikipediaå®šä¹‰**: [CAP theorem](https://en.wikipedia.org/wiki/CAP_theorem)

> In theoretical computer science, the CAP theorem states that it is impossible for a distributed data store to simultaneously provide more than two out of the following three guarantees: Consistency, Availability, and Partition tolerance.

**å¯¹é½è¯´æ˜**:

- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒCAPå®šç†è¯´æ˜åˆ†å¸ƒå¼ç³»ç»Ÿä¸èƒ½åŒæ—¶æ»¡è¶³ä¸‰ä¸ªä¿è¯
- âœ… **æ ¸å¿ƒæ¦‚å¿µ**: éƒ½æåˆ°ä¸€è‡´æ€§ã€å¯ç”¨æ€§ã€åˆ†åŒºå®¹é”™ç­‰æ ¸å¿ƒæ¦‚å¿µ
- âœ… **åº”ç”¨**: éƒ½æåˆ°ä¸åŒç³»ç»Ÿåœ¨CAPä¹‹é—´çš„æƒè¡¡é€‰æ‹©

### åˆ†ç‰‡æ¦‚å¿µå¯¹é½

**Wikipediaå®šä¹‰**: [Shard (database architecture)](https://en.wikipedia.org/wiki/Shard_(database_architecture))

> A database shard is a horizontal partition of data in a database or search engine. Each shard is held on a separate database server instance, to spread load.

**å¯¹é½è¯´æ˜**:

- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒåˆ†ç‰‡æ˜¯æ•°æ®çš„æ°´å¹³åˆ†åŒº
- âœ… **åˆ†ç‰‡ç­–ç•¥**: éƒ½æåˆ°å“ˆå¸Œåˆ†ç‰‡ã€èŒƒå›´åˆ†ç‰‡ç­‰ç­–ç•¥
- âœ… **åº”ç”¨åœºæ™¯**: éƒ½æåˆ°è´Ÿè½½å‡è¡¡ã€æ°´å¹³æ‰©å±•ç­‰åº”ç”¨åœºæ™¯

---

## 1. æ¦‚è¿°

PostgreSQLé€šè¿‡å¤šç§æ–¹å¼å®ç°åˆ†å¸ƒå¼æ¶æ„ï¼ŒåŒ…æ‹¬åŸºäºæ‰©å±•çš„åˆ†å¸ƒå¼æ–¹æ¡ˆï¼ˆå¦‚Citusï¼‰å’ŒåŸºäºPostgreSQLçš„åˆ†å¸ƒå¼æ•°æ®åº“ï¼ˆå¦‚Greenplumã€PostgreSQL-XLï¼‰ã€‚è¿™äº›æ–¹æ¡ˆåœ¨ä¸åŒåœºæ™¯ä¸‹æä¾›æ°´å¹³æ‰©å±•ã€é«˜å¯ç”¨æ€§å’Œåˆ†å¸ƒå¼æŸ¥è¯¢èƒ½åŠ›ã€‚

**ä¸»è¦åˆ†å¸ƒå¼æ–¹æ¡ˆ**ï¼š

- **Citus**: PostgreSQLæ‰©å±•ï¼Œæä¾›åˆ†ç‰‡å’Œåˆ†å¸ƒå¼æŸ¥è¯¢
- **Greenplum**: åŸºäºPostgreSQLçš„æ•°æ®ä»“åº“ï¼ŒMPPæ¶æ„
- **PostgreSQL-XL**: å¤šä¸»æ¶æ„çš„PostgreSQLé›†ç¾¤

**é€‚ç”¨åœºæ™¯**ï¼š

- å¤§è§„æ¨¡æ•°æ®å­˜å‚¨å’ŒæŸ¥è¯¢
- å¤šç§Ÿæˆ·SaaSåº”ç”¨
- æ•°æ®ä»“åº“å’Œåˆ†æ
- å…¨çƒåˆ†å¸ƒå¼éƒ¨ç½²

---

## 2. åˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºåŸºç¡€

### 2.1 CAPå®šç†

**CAPå®šç†**ï¼ˆConsistency, Availability, Partition toleranceï¼‰ï¼š

- **ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰**: æ‰€æœ‰èŠ‚ç‚¹åŒæ—¶çœ‹åˆ°ç›¸åŒæ•°æ®
- **å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰**: ç³»ç»ŸæŒç»­å¯ç”¨
- **åˆ†åŒºå®¹é”™ï¼ˆPartition toleranceï¼‰**: ç½‘ç»œåˆ†åŒºæ—¶ç³»ç»Ÿä»å¯å·¥ä½œ

**PostgreSQLåˆ†å¸ƒå¼æ–¹æ¡ˆçš„é€‰æ‹©**ï¼š

| æ–¹æ¡ˆ | ä¸€è‡´æ€§ | å¯ç”¨æ€§ | åˆ†åŒºå®¹é”™ | é€‰æ‹© |
|-----|--------|--------|---------|------|
| Citus | å¼ºä¸€è‡´æ€§ | é«˜ | æ˜¯ | CP |
| Greenplum | å¼ºä¸€è‡´æ€§ | é«˜ | æ˜¯ | CP |
| PostgreSQL-XL | å¼ºä¸€è‡´æ€§ | é«˜ | æ˜¯ | CP |

### 2.2 åˆ†å¸ƒå¼ä¸€è‡´æ€§æ¨¡å‹

**ä¸€è‡´æ€§çº§åˆ«**ï¼š

1. **å¼ºä¸€è‡´æ€§**: æ‰€æœ‰èŠ‚ç‚¹ç«‹å³çœ‹åˆ°ç›¸åŒæ•°æ®
2. **æœ€ç»ˆä¸€è‡´æ€§**: æœ€ç»ˆæ‰€æœ‰èŠ‚ç‚¹çœ‹åˆ°ç›¸åŒæ•°æ®
3. **å¼±ä¸€è‡´æ€§**: ä¸ä¿è¯ä¸€è‡´æ€§

**PostgreSQLåˆ†å¸ƒå¼æ–¹æ¡ˆ**ï¼š

- Citus: å¼ºä¸€è‡´æ€§ï¼ˆé€šè¿‡2PCï¼‰
- Greenplum: å¼ºä¸€è‡´æ€§ï¼ˆé€šè¿‡åˆ†å¸ƒå¼äº‹åŠ¡ï¼‰
- PostgreSQL-XL: å¼ºä¸€è‡´æ€§ï¼ˆé€šè¿‡å…¨å±€äº‹åŠ¡ç®¡ç†å™¨ï¼‰

### 2.3 åˆ†å¸ƒå¼äº‹åŠ¡ç†è®º

**ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰**ï¼š

```sql
-- Phase 1: Prepare
BEGIN;
UPDATE distributed_table SET value = 'new' WHERE id = 1;
PREPARE TRANSACTION 'txn-001';

-- Phase 2: Commit (coordinator)
COMMIT PREPARED 'txn-001';
```

**SAGAæ¨¡å¼**ï¼š

```sql
-- è¡¥å¿äº‹åŠ¡ç¤ºä¾‹
BEGIN;
-- æ‰§è¡Œæ“ä½œ
UPDATE orders SET status = 'cancelled' WHERE id = 1;
-- è¡¥å¿æ“ä½œ
UPDATE inventory SET quantity = quantity + 1 WHERE product_id = 1;
COMMIT;
```

---

## 3. Citusåˆ†å¸ƒå¼æ‰©å±•

### 3.1 Citusæ¶æ„è®¾è®¡

**Citusæ¶æ„**ï¼š

- **åè°ƒèŠ‚ç‚¹ï¼ˆCoordinatorï¼‰**: æ¥æ”¶æŸ¥è¯¢ï¼Œåˆ†å‘åˆ°å·¥ä½œèŠ‚ç‚¹
- **å·¥ä½œèŠ‚ç‚¹ï¼ˆWorkerï¼‰**: å­˜å‚¨æ•°æ®åˆ†ç‰‡ï¼Œæ‰§è¡ŒæŸ¥è¯¢
- **å…ƒæ•°æ®èŠ‚ç‚¹**: å­˜å‚¨åˆ†ç‰‡å…ƒæ•°æ®

**æ ¸å¿ƒç»„ä»¶**ï¼š

```sql
-- å®‰è£…Citusæ‰©å±•
CREATE EXTENSION citus;

-- æŸ¥çœ‹Citusç‰ˆæœ¬
SELECT * FROM citus_version();

-- æ·»åŠ å·¥ä½œèŠ‚ç‚¹
SELECT citus_add_node('192.168.1.11', 5432);
SELECT citus_add_node('192.168.1.12', 5432);
SELECT citus_add_node('192.168.1.13', 5432);

-- æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯
SELECT * FROM citus_get_active_worker_nodes();
```

### 3.2 åˆ†å¸ƒå¼è¡¨è®¾è®¡

**åˆ†å¸ƒå¼è¡¨ç±»å‹**ï¼š

1. **åˆ†ç‰‡è¡¨ï¼ˆDistributed Tableï¼‰**: æ•°æ®åˆ†ç‰‡åˆ°å¤šä¸ªèŠ‚ç‚¹
2. **å‚è€ƒè¡¨ï¼ˆReference Tableï¼‰**: å¤åˆ¶åˆ°æ‰€æœ‰èŠ‚ç‚¹
3. **æœ¬åœ°è¡¨ï¼ˆLocal Tableï¼‰**: ä»…å­˜å‚¨åœ¨åè°ƒèŠ‚ç‚¹

**åˆ›å»ºåˆ†å¸ƒå¼è¡¨**ï¼š

```sql
-- åˆ›å»ºåˆ†ç‰‡è¡¨ï¼ˆå“ˆå¸Œåˆ†ç‰‡ï¼‰
CREATE TABLE users (
    id BIGSERIAL PRIMARY KEY,
    name TEXT,
    email TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- æŒ‰idåˆ†ç‰‡
SELECT create_distributed_table('users', 'id');

-- åˆ›å»ºå‚è€ƒè¡¨ï¼ˆå¤åˆ¶åˆ°æ‰€æœ‰èŠ‚ç‚¹ï¼‰
CREATE TABLE countries (
    id SERIAL PRIMARY KEY,
    name TEXT,
    code TEXT
);

SELECT create_reference_table('countries');

-- æŸ¥çœ‹åˆ†ç‰‡ä¿¡æ¯
SELECT * FROM citus_shards WHERE table_name = 'users';
```

**åˆ†ç‰‡ç­–ç•¥**ï¼š

```sql
-- å“ˆå¸Œåˆ†ç‰‡ï¼ˆé»˜è®¤ï¼‰
SELECT create_distributed_table('orders', 'user_id', 'hash');

-- èŒƒå›´åˆ†ç‰‡
SELECT create_distributed_table('events', 'created_at', 'range');

-- æŸ¥çœ‹åˆ†ç‰‡åˆ†å¸ƒ
SELECT
    shardid,
    shard_size,
    node_name,
    node_port
FROM citus_shards
WHERE table_name = 'orders';
```

### 3.3 åˆ†å¸ƒå¼æŸ¥è¯¢ä¼˜åŒ–

**æŸ¥è¯¢ç±»å‹**ï¼š

1. **å•åˆ†ç‰‡æŸ¥è¯¢**: æŸ¥è¯¢æ¡ä»¶åŒ…å«åˆ†ç‰‡é”®
2. **å¤šåˆ†ç‰‡æŸ¥è¯¢**: æŸ¥è¯¢æ¡ä»¶ä¸åŒ…å«åˆ†ç‰‡é”®
3. **è·¨åˆ†ç‰‡JOIN**: å¤šä¸ªåˆ†ç‰‡è¡¨JOIN

**æŸ¥è¯¢ä¼˜åŒ–ç¤ºä¾‹**ï¼š

```sql
-- å•åˆ†ç‰‡æŸ¥è¯¢ï¼ˆé«˜æ•ˆï¼‰
SELECT * FROM users WHERE id = 123;

-- å¤šåˆ†ç‰‡æŸ¥è¯¢ï¼ˆéœ€è¦èšåˆï¼‰
SELECT COUNT(*) FROM users WHERE created_at > '2025-01-01';

-- è·¨åˆ†ç‰‡JOINï¼ˆéœ€è¦é‡åˆ†å¸ƒï¼‰
SELECT u.name, o.total
FROM users u
JOIN orders o ON u.id = o.user_id
WHERE u.id = 123;
```

**PostgreSQL 18ä¼˜åŒ–**ï¼š

- å¼‚æ­¥I/Oæå‡è·¨åˆ†ç‰‡æŸ¥è¯¢æ€§èƒ½
- å¹¶è¡ŒæŸ¥è¯¢å¢å¼ºåˆ†å¸ƒå¼èšåˆ
- è™šæ‹Ÿç”Ÿæˆåˆ—ä¼˜åŒ–åˆ†å¸ƒå¼è®¡ç®—

### 3.4 Citusé…ç½®ä¸ä¼˜åŒ–

**é…ç½®å‚æ•°**ï¼š

```sql
-- Citusé…ç½®
SET citus.shard_count = 32;
SET citus.shard_replication_factor = 1;
SET citus.max_adaptive_executor_pool_size = 20;

-- æŸ¥è¯¢è¶…æ—¶
SET citus.executor_slow_start_interval = 10;
SET citus.task_executor_type = 'adaptive';
```

**å®Œæ•´é…ç½®ç¤ºä¾‹**ï¼š

```sql
-- 1. åˆ†ç‰‡é…ç½®
-- è®¾ç½®é»˜è®¤åˆ†ç‰‡æ•°é‡ï¼ˆå»ºè®®ï¼šCPUæ ¸å¿ƒæ•° * 2ï¼‰
ALTER SYSTEM SET citus.shard_count = 32;
ALTER SYSTEM SET citus.shard_replication_factor = 1;  -- ç”Ÿäº§ç¯å¢ƒå»ºè®®2

-- 2. æ‰§è¡Œå™¨é…ç½®
ALTER SYSTEM SET citus.max_adaptive_executor_pool_size = 20;
ALTER SYSTEM SET citus.task_executor_type = 'adaptive';  -- 'real-time', 'task-tracker', 'adaptive'
ALTER SYSTEM SET citus.executor_slow_start_interval = 10;  -- æ…¢å¯åŠ¨é—´éš”ï¼ˆç§’ï¼‰

-- 3. è¿æ¥æ± é…ç½®
ALTER SYSTEM SET citus.max_cached_conns_per_worker = 1;
ALTER SYSTEM SET citus.connection_timeout = 60000;  -- è¿æ¥è¶…æ—¶ï¼ˆæ¯«ç§’ï¼‰

-- 4. æŸ¥è¯¢è¶…æ—¶
ALTER SYSTEM SET citus.limit_clause_row_fetch_count = 100000;
ALTER SYSTEM SET citus.all_modifications_commutative = false;

-- 5. é‡æ–°åŠ è½½é…ç½®
SELECT pg_reload_conf();
```

**æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**ï¼š

```sql
-- 1. åˆ†æåˆ†å¸ƒå¼è¡¨ç»Ÿè®¡ä¿¡æ¯
SELECT citus_analyze_shard_statistics();

-- 2. æŸ¥çœ‹åˆ†ç‰‡å¤§å°å’Œåˆ†å¸ƒ
SELECT
    table_name,
    shardid,
    pg_size_pretty(shard_size) as size,
    node_name,
    node_port
FROM citus_shards
ORDER BY shard_size DESC;

-- 3. æŸ¥çœ‹æŸ¥è¯¢è®¡åˆ’ï¼ˆåˆ†å¸ƒå¼æŸ¥è¯¢ï¼‰
EXPLAIN (ANALYZE, BUFFERS, VERBOSE)
SELECT COUNT(*) FROM users WHERE created_at > '2025-01-01';

-- 4. ç›‘æ§æŸ¥è¯¢æ€§èƒ½
SELECT
    query,
    calls,
    total_exec_time,
    mean_exec_time,
    max_exec_time,
    rows
FROM citus_stat_statements
ORDER BY total_exec_time DESC
LIMIT 10;

-- 5. æ£€æŸ¥åˆ†ç‰‡å¹³è¡¡
SELECT
    node_name,
    COUNT(*) as shard_count,
    SUM(shard_size) as total_size
FROM citus_shards
GROUP BY node_name
ORDER BY shard_count DESC;

-- 6. é‡æ–°å¹³è¡¡åˆ†ç‰‡ï¼ˆå¦‚æœéœ€è¦ï¼‰
SELECT rebalance_table_shards('users');
```

**åˆ†ç‰‡æ•°é‡é€‰æ‹©**ï¼š

```sql
-- åˆ†ç‰‡æ•°é‡å»ºè®®ï¼š
-- - å°è¡¨ï¼ˆ<10GBï¼‰: 4-8ä¸ªåˆ†ç‰‡
-- - ä¸­è¡¨ï¼ˆ10-100GBï¼‰: 16-32ä¸ªåˆ†ç‰‡
-- - å¤§è¡¨ï¼ˆ>100GBï¼‰: 32-64ä¸ªåˆ†ç‰‡
-- - è¶…å¤§è¡¨ï¼ˆ>1TBï¼‰: 64-128ä¸ªåˆ†ç‰‡

-- åˆ›å»ºè¡¨æ—¶æŒ‡å®šåˆ†ç‰‡æ•°é‡
SELECT create_distributed_table('large_table', 'id',
    shard_count => 64);
```

**æŸ¥è¯¢ä¼˜åŒ–æŠ€å·§**ï¼š

```sql
-- 1. ä½¿ç”¨åˆ†ç‰‡é”®æŸ¥è¯¢ï¼ˆå•åˆ†ç‰‡æŸ¥è¯¢ï¼Œæœ€å¿«ï¼‰
SELECT * FROM users WHERE id = 123;

-- 2. ä½¿ç”¨å‚è€ƒè¡¨å‡å°‘JOIN
-- å°†å°è¡¨åˆ›å»ºä¸ºå‚è€ƒè¡¨ï¼Œå¤åˆ¶åˆ°æ‰€æœ‰èŠ‚ç‚¹
SELECT create_reference_table('small_lookup_table');

-- 3. ä½¿ç”¨å…±åˆ†å¸ƒè¡¨ï¼ˆco-located tablesï¼‰
-- ä¸¤ä¸ªè¡¨ä½¿ç”¨ç›¸åŒçš„åˆ†ç‰‡é”®å’Œåˆ†ç‰‡å‡½æ•°
SELECT create_distributed_table('orders', 'user_id');
SELECT create_distributed_table('order_items', 'user_id');
-- è¿™æ ·JOINæ—¶ä¸éœ€è¦é‡åˆ†å¸ƒæ•°æ®

-- 4. é¿å…è·¨åˆ†ç‰‡JOIN
-- é”™è¯¯ç¤ºä¾‹ï¼šä¸åŒåˆ†ç‰‡é”®çš„JOIN
SELECT u.name, o.total
FROM users u
JOIN orders o ON u.id = o.user_id;  -- å¦‚æœåˆ†ç‰‡é”®ä¸åŒï¼Œéœ€è¦é‡åˆ†å¸ƒ

-- æ­£ç¡®ç¤ºä¾‹ï¼šä½¿ç”¨å…±åˆ†å¸ƒè¡¨
-- ç¡®ä¿userså’Œorderséƒ½æŒ‰user_idåˆ†ç‰‡
```

---

## 4. Greenplumæ•°æ®ä»“åº“

### 4.1 Greenplumæ¶æ„

**Greenplumæ¶æ„**ï¼ˆMPP - Massively Parallel Processingï¼‰ï¼š

- **MasterèŠ‚ç‚¹**: åè°ƒæŸ¥è¯¢ï¼Œç®¡ç†å…ƒæ•°æ®
- **SegmentèŠ‚ç‚¹**: å­˜å‚¨æ•°æ®ï¼Œå¹¶è¡Œæ‰§è¡ŒæŸ¥è¯¢
- **Interconnect**: èŠ‚ç‚¹é—´é«˜é€Ÿç½‘ç»œ

**æ ¸å¿ƒç‰¹æ€§**ï¼š

- åˆ—å­˜å‚¨æ”¯æŒ
- å¹¶è¡ŒæŸ¥è¯¢ä¼˜åŒ–
- æ•°æ®å‹ç¼©
- å¤–éƒ¨è¡¨æ”¯æŒ

**å®‰è£…å’Œåˆå§‹åŒ–**ï¼š

```bash
# 1. å®‰è£…Greenplum
# ä¸‹è½½Greenplum Database
wget https://github.com/greenplum-db/gpdb/releases/download/7.0.0/greenplum-db-7.0.0-rhel7-x86_64.rpm
sudo rpm -ivh greenplum-db-7.0.0-rhel7-x86_64.rpm

# 2. åˆ›å»ºgpadminç”¨æˆ·
sudo groupadd gpadmin
sudo useradd -g gpadmin -m gpadmin
sudo passwd gpadmin

# 3. é…ç½®SSHå…å¯†ç™»å½•
sudo -u gpadmin ssh-keygen -t rsa
sudo -u gpadmin ssh-copy-id gpadmin@mdw  # MasterèŠ‚ç‚¹
sudo -u gpadmin ssh-copy-id gpadmin@sdw1  # SegmentèŠ‚ç‚¹1
sudo -u gpadmin ssh-copy-id gpadmin@sdw2  # SegmentèŠ‚ç‚¹2

# 4. åˆå§‹åŒ–æ•°æ®åº“
sudo -u gpadmin /usr/local/greenplum-db/bin/gpinitsystem -c /home/gpadmin/gpinitsystem_config
```

**æ¶æ„é…ç½®**ï¼š

```bash
# gpconfigé…ç½®ç¤ºä¾‹
gpconfig -c max_connections -v 200
gpconfig -c shared_buffers -v 256MB
gpconfig -c work_mem -v 64MB
gpconfig -c maintenance_work_mem -v 512MB

# åº”ç”¨é…ç½®åˆ°æ‰€æœ‰Segment
gpstop -u
```

### 4.2 æ•°æ®åˆ†å¸ƒç­–ç•¥

**åˆ†å¸ƒç­–ç•¥**ï¼š

```sql
-- å“ˆå¸Œåˆ†å¸ƒï¼ˆé»˜è®¤ï¼Œæ¨èï¼‰
CREATE TABLE sales (
    id BIGSERIAL,
    product_id INT,
    amount DECIMAL(10,2),
    sale_date DATE
) DISTRIBUTED BY (product_id);

-- éšæœºåˆ†å¸ƒï¼ˆä¸æ¨èï¼Œå¯èƒ½å¯¼è‡´æ•°æ®å€¾æ–œï¼‰
CREATE TABLE logs (
    id BIGSERIAL,
    log_text TEXT,
    created_at TIMESTAMPTZ
) DISTRIBUTED RANDOMLY;

-- å¤åˆ¶åˆ†å¸ƒï¼ˆå°è¡¨ï¼Œ<2GBï¼‰
CREATE TABLE config (
    key TEXT,
    value TEXT
) DISTRIBUTED REPLICATED;

-- æŸ¥çœ‹è¡¨åˆ†å¸ƒä¿¡æ¯
SELECT
    schemaname,
    tablename,
    distkey,
    diststyle
FROM pg_class c
JOIN pg_namespace n ON n.oid = c.relnamespace
WHERE relkind = 'r'
AND tablename = 'sales';
```

**åˆ†å¸ƒé”®é€‰æ‹©åŸåˆ™**ï¼š

```sql
-- 1. é€‰æ‹©é«˜åŸºæ•°åˆ—ï¼ˆå”¯ä¸€å€¼å¤šï¼‰
CREATE TABLE orders (
    order_id BIGSERIAL,
    user_id INT,
    product_id INT,
    amount DECIMAL(10,2)
) DISTRIBUTED BY (order_id);  -- order_idå”¯ä¸€ï¼Œåˆ†å¸ƒå‡åŒ€

-- 2. é¿å…æ•°æ®å€¾æ–œ
-- é”™è¯¯ç¤ºä¾‹ï¼šä½¿ç”¨ä½åŸºæ•°åˆ—
CREATE TABLE events (
    id BIGSERIAL,
    event_type TEXT,  -- åªæœ‰å‡ ç§ç±»å‹ï¼Œä¼šå¯¼è‡´å€¾æ–œ
    created_at TIMESTAMPTZ
) DISTRIBUTED BY (event_type);  -- ä¸æ¨è

-- 3. è€ƒè™‘JOINæ€§èƒ½
-- å¦‚æœç»å¸¸JOINï¼Œä½¿ç”¨ç›¸åŒçš„åˆ†å¸ƒé”®
CREATE TABLE users (
    user_id INT,
    name TEXT
) DISTRIBUTED BY (user_id);

CREATE TABLE orders (
    order_id BIGSERIAL,
    user_id INT,
    amount DECIMAL(10,2)
) DISTRIBUTED BY (user_id);  -- ä¸userså…±åˆ†å¸ƒï¼ŒJOINé«˜æ•ˆ
```

**åˆ†åŒºè¡¨**ï¼š

```sql
-- åˆ›å»ºåˆ†åŒºè¡¨ï¼ˆæŒ‰æ—¶é—´åˆ†åŒºï¼‰
CREATE TABLE sales_partitioned (
    id BIGSERIAL,
    product_id INT,
    amount DECIMAL(10,2),
    sale_date DATE
) DISTRIBUTED BY (product_id)
PARTITION BY RANGE (sale_date) (
    PARTITION p2024_q1 START ('2024-01-01') END ('2024-04-01'),
    PARTITION p2024_q2 START ('2024-04-01') END ('2024-07-01'),
    PARTITION p2024_q3 START ('2024-07-01') END ('2024-10-01'),
    PARTITION p2024_q4 START ('2024-10-01') END ('2025-01-01')
);

-- åŠ¨æ€æ·»åŠ åˆ†åŒº
ALTER TABLE sales_partitioned ADD PARTITION p2025_q1
START ('2025-01-01') END ('2025-04-01');
```

### 4.3 å¹¶è¡ŒæŸ¥è¯¢ä¼˜åŒ–

**å¹¶è¡ŒæŸ¥è¯¢ç‰¹æ€§**ï¼š

- è‡ªåŠ¨å¹¶è¡ŒåŒ–
- åŠ¨æ€åˆ†åŒºè£å‰ª
- å¹¶è¡Œèšåˆ
- å¹¶è¡ŒJOIN

**å¹¶è¡ŒæŸ¥è¯¢é…ç½®**ï¼š

```sql
-- 1. å¯ç”¨å¹¶è¡ŒæŸ¥è¯¢
SET max_parallel_workers_per_gather = 4;
SET parallel_setup_cost = 1000;
SET parallel_tuple_cost = 0.01;

-- 2. æŸ¥çœ‹å¹¶è¡ŒæŸ¥è¯¢è®¡åˆ’
EXPLAIN (ANALYZE, VERBOSE, BUFFERS)
SELECT
    product_id,
    SUM(amount) as total_sales,
    COUNT(*) as order_count
FROM sales
WHERE sale_date >= '2024-01-01'
GROUP BY product_id;

-- 3. å¹¶è¡Œèšåˆä¼˜åŒ–
-- Greenplumè‡ªåŠ¨å¹¶è¡ŒåŒ–èšåˆæ“ä½œ
SELECT
    region,
    product_category,
    SUM(sales_amount) as total,
    AVG(sales_amount) as avg_amount
FROM sales_fact
JOIN dimension_table ON sales_fact.product_id = dimension_table.product_id
GROUP BY region, product_category;

-- 4. å¹¶è¡ŒJOINä¼˜åŒ–
-- ä½¿ç”¨å…±åˆ†å¸ƒè¡¨é¿å…é‡åˆ†å¸ƒ
SELECT
    u.name,
    o.order_id,
    o.amount
FROM users u
JOIN orders o ON u.user_id = o.user_id  -- å…±åˆ†å¸ƒï¼Œæ— éœ€é‡åˆ†å¸ƒ
WHERE u.region = 'US';

-- 5. åŠ¨æ€åˆ†åŒºè£å‰ª
-- æŸ¥è¯¢æ—¶è‡ªåŠ¨è·³è¿‡ä¸ç›¸å…³çš„åˆ†åŒº
SELECT * FROM sales_partitioned
WHERE sale_date >= '2024-10-01';  -- åªæ‰«æp2024_q4åˆ†åŒº
```

**åˆ—å­˜å‚¨ä¼˜åŒ–**ï¼š

```sql
-- åˆ›å»ºåˆ—å­˜å‚¨è¡¨ï¼ˆé€‚åˆOLAPåœºæ™¯ï¼‰
CREATE TABLE sales_columnar (
    id BIGSERIAL,
    product_id INT,
    amount DECIMAL(10,2),
    sale_date DATE
) WITH (appendonly=true, orientation=column, compresstype=zstd, compresslevel=1)
DISTRIBUTED BY (product_id);

-- åˆ—å­˜å‚¨ä¼˜åŠ¿ï¼š
-- - å‹ç¼©ç‡é«˜ï¼ˆ3-10å€ï¼‰
-- - æŸ¥è¯¢æ—¶åªè¯»å–éœ€è¦çš„åˆ—
-- - é€‚åˆåˆ†ææŸ¥è¯¢
```

---

## 5. PostgreSQL-XLé›†ç¾¤

### 5.1 PostgreSQL-XLæ¶æ„

**PostgreSQL-XLæ¶æ„**ï¼š

- **GTMï¼ˆGlobal Transaction Managerï¼‰**: å…¨å±€äº‹åŠ¡ç®¡ç†ï¼Œåˆ†é…å…¨å±€äº‹åŠ¡ID
- **CoordinatorèŠ‚ç‚¹**: æŸ¥è¯¢åè°ƒï¼Œè§£æSQLå¹¶åˆ†å‘åˆ°Datanode
- **DatanodeèŠ‚ç‚¹**: æ•°æ®å­˜å‚¨ï¼Œæ‰§è¡ŒæŸ¥è¯¢å¹¶è¿”å›ç»“æœ

**æ ¸å¿ƒç‰¹æ€§**ï¼š

- å¤šä¸»æ¶æ„ï¼ˆå¤šä¸ªCoordinatorï¼‰
- å…¨å±€äº‹åŠ¡ç®¡ç†ï¼ˆGTMä¿è¯ä¸€è‡´æ€§ï¼‰
- åˆ†å¸ƒå¼æŸ¥è¯¢ä¼˜åŒ–
- è¯»å†™åˆ†ç¦»æ”¯æŒ

**å®‰è£…å’Œé…ç½®**ï¼š

```bash
# 1. ç¼–è¯‘å®‰è£…PostgreSQL-XL
wget https://www.postgres-xl.org/downloads/postgres-xl-10r1.1.tar.gz
tar -xzf postgres-xl-10r1.1.tar.gz
cd postgres-xl-10r1.1

./configure --prefix=/usr/local/pgxl \
    --with-openssl \
    --with-libxml \
    --enable-nls

make -j$(nproc)
sudo make install

# 2. é…ç½®GTM
sudo -u postgres /usr/local/pgxl/bin/initgtm -D /data/gtm -Z gtm

# 3. é…ç½®Coordinator
sudo -u postgres /usr/local/pgxl/bin/initdb -D /data/coord1 -Z coordinator

# 4. é…ç½®Datanode
sudo -u postgres /usr/local/pgxl/bin/initdb -D /data/datanode1 -Z datanode
```

**é›†ç¾¤é…ç½®**ï¼š

```bash
# pgxc_ctlé…ç½®ç¤ºä¾‹
cat > /usr/local/pgxl/pgxc_ctl/pgxc_ctl.conf <<EOF
# GTMé…ç½®
gtmName=gtm
gtmMasterServer=192.168.1.10
gtmMasterPort=6666
gtmMasterDir=/data/gtm

# Coordinatoré…ç½®
coordNames=(coord1 coord2)
coordMasterServers=(192.168.1.11 192.168.1.12)
coordMasterPorts=(5432 5432)
coordMasterDirs=(/data/coord1 /data/coord2)

# Datanodeé…ç½®
datanodeNames=(datanode1 datanode2 datanode3)
datanodeMasterServers=(192.168.1.13 192.168.1.14 192.168.1.15)
datanodeMasterPorts=(5432 5432 5432)
datanodeMasterDirs=(/data/datanode1 /data/datanode2 /data/datanode3)
EOF

# å¯åŠ¨é›†ç¾¤
pgxc_ctl -c /usr/local/pgxl/pgxc_ctl/pgxc_ctl.conf start all
```

**åˆ›å»ºåˆ†å¸ƒå¼è¡¨**ï¼š

```sql
-- 1. è¿æ¥åˆ°Coordinator
psql -h 192.168.1.11 -p 5432 -U postgres -d postgres

-- 2. åˆ›å»ºåˆ†å¸ƒå¼è¡¨ï¼ˆå“ˆå¸Œåˆ†å¸ƒï¼‰
CREATE TABLE distributed_users (
    id BIGSERIAL,
    name TEXT,
    email TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW()
) DISTRIBUTE BY HASH(id);

-- 3. åˆ›å»ºå¤åˆ¶è¡¨ï¼ˆå¤åˆ¶åˆ°æ‰€æœ‰Datanodeï¼‰
CREATE TABLE replicated_config (
    key TEXT PRIMARY KEY,
    value TEXT
) DISTRIBUTE BY REPLICATION;

-- 4. æŸ¥çœ‹è¡¨åˆ†å¸ƒ
SELECT
    schemaname,
    tablename,
    distkey,
    diststyle
FROM pg_class c
JOIN pg_namespace n ON n.oid = c.relnamespace
WHERE relkind = 'r';
```

### 5.2 åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†

**å…¨å±€äº‹åŠ¡**ï¼š

```sql
-- å…¨å±€äº‹åŠ¡ç¤ºä¾‹
BEGIN;
UPDATE distributed_table1 SET value = 'new1' WHERE id = 1;
UPDATE distributed_table2 SET value = 'new2' WHERE id = 2;
COMMIT;  -- GTMåè°ƒæ‰€æœ‰Datanodeæäº¤

-- æŸ¥çœ‹å…¨å±€äº‹åŠ¡ID
SELECT pgxc_get_gtm_status();

-- æŸ¥çœ‹äº‹åŠ¡çŠ¶æ€
SELECT * FROM pg_stat_activity WHERE xact_start IS NOT NULL;
```

**äº‹åŠ¡éš”ç¦»çº§åˆ«**ï¼š

```sql
-- PostgreSQL-XLæ”¯æŒæ ‡å‡†éš”ç¦»çº§åˆ«
SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

-- åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§ä¿è¯
BEGIN;
-- æ‰€æœ‰Datanodeä½¿ç”¨ç›¸åŒçš„å…¨å±€äº‹åŠ¡ID
INSERT INTO distributed_table1 VALUES (1, 'value1');
INSERT INTO distributed_table2 VALUES (2, 'value2');
COMMIT;  -- ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰
```

**GTMé…ç½®ä¼˜åŒ–**ï¼š

```bash
# GTMé…ç½®æ–‡ä»¶ï¼ˆgtm.confï¼‰
gtm_host = '192.168.1.10'
gtm_port = 6666
gtm_standby = '192.168.1.20'  # GTM Standby

# Coordinatorå’ŒDatanodeé…ç½®
cat >> /data/coord1/postgresql.conf <<EOF
# GTMè¿æ¥é…ç½®
gtm_host = '192.168.1.10'
gtm_port = 6666
gtm_connect_timeout = 10
EOF
```

---

## 6. åˆ†å¸ƒå¼æ¶æ„å¯¹æ¯”

| ç‰¹æ€§ | Citus | Greenplum | PostgreSQL-XL |
|-----|-------|-----------|---------------|
| **æ¶æ„ç±»å‹** | æ‰©å±• | ç‹¬ç«‹æ•°æ®åº“ | é›†ç¾¤ |
| **åˆ†ç‰‡æ–¹å¼** | å“ˆå¸Œ/èŒƒå›´ | å“ˆå¸Œ/éšæœº | å“ˆå¸Œ |
| **æŸ¥è¯¢ä¼˜åŒ–** | è‡ªé€‚åº”æ‰§è¡Œå™¨ | MPPä¼˜åŒ–å™¨ | åˆ†å¸ƒå¼ä¼˜åŒ–å™¨ |
| **äº‹åŠ¡æ”¯æŒ** | 2PC | åˆ†å¸ƒå¼äº‹åŠ¡ | å…¨å±€äº‹åŠ¡ |
| **é€‚ç”¨åœºæ™¯** | OLTP/OLAP | æ•°æ®ä»“åº“ | OLTP |
| **PostgreSQLå…¼å®¹** | 100% | é«˜åº¦å…¼å®¹ | é«˜åº¦å…¼å®¹ |

---

## 7. å®æˆ˜æ¡ˆä¾‹

### 7.1 å¤šç§Ÿæˆ·SaaSæ¶æ„

**åœºæ™¯**: å¤šç§Ÿæˆ·SaaSåº”ç”¨ï¼Œæ¯ä¸ªç§Ÿæˆ·æ•°æ®éš”ç¦»

**Cituså®ç°**ï¼š

```sql
-- ç§Ÿæˆ·è¡¨ï¼ˆæŒ‰tenant_idåˆ†ç‰‡ï¼‰
CREATE TABLE tenants (
    id BIGSERIAL PRIMARY KEY,
    name TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

SELECT create_distributed_table('tenants', 'id');

-- ç§Ÿæˆ·æ•°æ®è¡¨ï¼ˆæŒ‰tenant_idåˆ†ç‰‡ï¼‰
CREATE TABLE tenant_data (
    id BIGSERIAL,
    tenant_id BIGINT,
    data JSONB,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

SELECT create_distributed_table('tenant_data', 'tenant_id');

-- æŸ¥è¯¢ç‰¹å®šç§Ÿæˆ·æ•°æ®ï¼ˆå•åˆ†ç‰‡æŸ¥è¯¢ï¼‰
SELECT * FROM tenant_data WHERE tenant_id = 123;
```

### 7.2 å…¨çƒåˆ†å¸ƒå¼éƒ¨ç½²

**åœºæ™¯**: å…¨çƒç”¨æˆ·ï¼Œæ•°æ®æŒ‰åœ°åŒºåˆ†å¸ƒ

**å®ç°æ–¹æ¡ˆ**ï¼š

```sql
-- æŒ‰åœ°åŒºåˆ†ç‰‡
CREATE TABLE global_users (
    id BIGSERIAL PRIMARY KEY,
    region TEXT,
    name TEXT,
    email TEXT
);

-- æŒ‰regionåˆ†ç‰‡
SELECT create_distributed_table('global_users', 'region', 'hash');

-- è·¨åœ°åŒºæŸ¥è¯¢
SELECT region, COUNT(*)
FROM global_users
GROUP BY region;
```

### 7.3 æ•°æ®åˆ†ç‰‡ç­–ç•¥

**åˆ†ç‰‡ç­–ç•¥é€‰æ‹©**ï¼š

1. **å“ˆå¸Œåˆ†ç‰‡**: å‡åŒ€åˆ†å¸ƒï¼Œé€‚åˆOLTP
2. **èŒƒå›´åˆ†ç‰‡**: æ—¶é—´åºåˆ—æ•°æ®ï¼Œé€‚åˆOLAP
3. **åˆ—è¡¨åˆ†ç‰‡**: æŒ‰ä¸šåŠ¡è§„åˆ™åˆ†ç‰‡

---

## 8. æ€§èƒ½ä¼˜åŒ–

### 8.1 æŸ¥è¯¢ä¼˜åŒ–

**ä¼˜åŒ–ç­–ç•¥**ï¼š

- ä½¿ç”¨åˆ†ç‰‡é”®æŸ¥è¯¢
- é¿å…è·¨åˆ†ç‰‡JOIN
- ä½¿ç”¨å‚è€ƒè¡¨å‡å°‘JOIN
- åˆç†è®¾ç½®åˆ†ç‰‡æ•°é‡

**CitusæŸ¥è¯¢ä¼˜åŒ–**ï¼š

```sql
-- 1. å•åˆ†ç‰‡æŸ¥è¯¢ï¼ˆæœ€å¿«ï¼‰
-- æŸ¥è¯¢æ¡ä»¶åŒ…å«åˆ†ç‰‡é”®
SELECT * FROM users WHERE id = 123;

-- 2. ä½¿ç”¨å…±åˆ†å¸ƒè¡¨ï¼ˆé¿å…é‡åˆ†å¸ƒï¼‰
-- ç¡®ä¿ä¸¤ä¸ªè¡¨ä½¿ç”¨ç›¸åŒçš„åˆ†ç‰‡é”®
SELECT u.name, o.total
FROM users u
JOIN orders o ON u.id = o.user_id  -- å…±åˆ†å¸ƒï¼Œé«˜æ•ˆ
WHERE u.id = 123;

-- 3. ä½¿ç”¨å‚è€ƒè¡¨ï¼ˆå°è¡¨å¤åˆ¶åˆ°æ‰€æœ‰èŠ‚ç‚¹ï¼‰
SELECT create_reference_table('countries');
-- åç»­JOINæ—¶ä¸éœ€è¦é‡åˆ†å¸ƒ

-- 4. é¿å…è·¨åˆ†ç‰‡JOIN
-- é”™è¯¯ç¤ºä¾‹ï¼šä¸åŒåˆ†ç‰‡é”®çš„JOIN
SELECT u.name, p.title
FROM users u
JOIN products p ON u.preference = p.category;  -- éœ€è¦é‡åˆ†å¸ƒï¼Œæ…¢

-- 5. ä½¿ç”¨å­æŸ¥è¯¢ä¼˜åŒ–
-- å…ˆè¿‡æ»¤å†JOIN
SELECT u.name, o.total
FROM users u
JOIN (
    SELECT user_id, SUM(amount) as total
    FROM orders
    WHERE order_date >= '2024-01-01'
    GROUP BY user_id
) o ON u.id = o.user_id;
```

**GreenplumæŸ¥è¯¢ä¼˜åŒ–**ï¼š

```sql
-- 1. ä½¿ç”¨åˆ†å¸ƒé”®æŸ¥è¯¢ï¼ˆæœ¬åœ°æŸ¥è¯¢ï¼‰
SELECT * FROM sales WHERE product_id = 123;

-- 2. ä½¿ç”¨å…±åˆ†å¸ƒè¡¨JOIN
SELECT s.sale_date, p.product_name, SUM(s.amount)
FROM sales s
JOIN products p ON s.product_id = p.product_id  -- å…±åˆ†å¸ƒ
GROUP BY s.sale_date, p.product_name;

-- 3. åˆ†åŒºè£å‰ª
SELECT * FROM sales_partitioned
WHERE sale_date >= '2024-10-01';  -- åªæ‰«æç›¸å…³åˆ†åŒº

-- 4. åˆ—å­˜å‚¨ä¼˜åŒ–ï¼ˆOLAPåœºæ™¯ï¼‰
SELECT product_category, SUM(sales_amount)
FROM sales_columnar  -- åˆ—å­˜å‚¨è¡¨
WHERE sale_date >= '2024-01-01'
GROUP BY product_category;

-- 5. å¹¶è¡ŒæŸ¥è¯¢é…ç½®
SET max_parallel_workers_per_gather = 4;
SET parallel_setup_cost = 1000;
```

**PostgreSQL-XLæŸ¥è¯¢ä¼˜åŒ–**ï¼š

```sql
-- 1. ä½¿ç”¨åˆ†å¸ƒé”®æŸ¥è¯¢
SELECT * FROM distributed_users WHERE id = 123;

-- 2. ä½¿ç”¨å¤åˆ¶è¡¨å‡å°‘JOIN
SELECT u.name, c.country_name
FROM distributed_users u
JOIN replicated_countries c ON u.country_id = c.id;  -- å¤åˆ¶è¡¨ï¼Œé«˜æ•ˆ

-- 3. é¿å…è·¨èŠ‚ç‚¹JOIN
-- ç¡®ä¿JOINé”®æ˜¯åˆ†å¸ƒé”®
SELECT u.name, o.order_id
FROM distributed_users u
JOIN distributed_orders o ON u.id = o.user_id;  -- å…±åˆ†å¸ƒ
```

### 8.2 PostgreSQL 18ä¼˜åŒ–

**æ–°ç‰¹æ€§åº”ç”¨**ï¼š

- **å¼‚æ­¥I/O**: æå‡è·¨åˆ†ç‰‡æŸ¥è¯¢æ€§èƒ½2-3å€
- **è™šæ‹Ÿç”Ÿæˆåˆ—**: ä¼˜åŒ–åˆ†å¸ƒå¼è®¡ç®—
- **å¹¶è¡ŒæŸ¥è¯¢å¢å¼º**: æ›´æ™ºèƒ½çš„åˆ†å¸ƒå¼èšåˆ

**å¼‚æ­¥I/Oé…ç½®**ï¼š

```sql
-- 1. å¯ç”¨å¼‚æ­¥I/Oï¼ˆPostgreSQL 18ï¼‰
ALTER SYSTEM SET backend_flush_after = 0;  -- ç¦ç”¨åŒæ­¥åˆ·æ–°
ALTER SYSTEM SET effective_io_concurrency = 200;  -- æé«˜å¹¶å‘I/O

-- 2. åœ¨Citusä¸­åº”ç”¨
-- è·¨åˆ†ç‰‡æŸ¥è¯¢æ—¶è‡ªåŠ¨ä½¿ç”¨å¼‚æ­¥I/O
SELECT COUNT(*) FROM users WHERE created_at > '2024-01-01';
-- å¤šä¸ªåˆ†ç‰‡å¹¶è¡Œè¯»å–ï¼Œå¼‚æ­¥I/Oæå‡æ€§èƒ½

-- 3. ç›‘æ§å¼‚æ­¥I/Oæ•ˆæœ
SELECT
    wait_event_type,
    wait_event,
    COUNT(*) as count
FROM pg_stat_activity
WHERE wait_event_type = 'IO'
GROUP BY wait_event_type, wait_event;
```

**è™šæ‹Ÿç”Ÿæˆåˆ—ä¼˜åŒ–**ï¼š

```sql
-- 1. åˆ›å»ºè™šæ‹Ÿç”Ÿæˆåˆ—ï¼ˆPostgreSQL 18ï¼‰
CREATE TABLE distributed_orders (
    id BIGSERIAL,
    user_id INT,
    amount DECIMAL(10,2),
    tax_rate DECIMAL(5,2),
    -- è™šæ‹Ÿç”Ÿæˆåˆ—ï¼Œä¸å­˜å‚¨ä½†å¯æŸ¥è¯¢
    tax_amount DECIMAL(10,2) GENERATED ALWAYS AS (amount * tax_rate) STORED
) DISTRIBUTED BY (user_id);

-- 2. åœ¨åˆ†å¸ƒå¼æŸ¥è¯¢ä¸­ä½¿ç”¨
-- è®¡ç®—åœ¨æŸ¥è¯¢æ—¶è¿›è¡Œï¼Œå‡å°‘å­˜å‚¨ç©ºé—´
SELECT
    user_id,
    SUM(amount) as total_amount,
    SUM(tax_amount) as total_tax  -- ä½¿ç”¨ç”Ÿæˆåˆ—
FROM distributed_orders
GROUP BY user_id;

-- 3. åˆ›å»ºç´¢å¼•ï¼ˆå¦‚æœç”Ÿæˆåˆ—æ˜¯STOREDï¼‰
CREATE INDEX idx_orders_tax ON distributed_orders (tax_amount);
```

**å¹¶è¡ŒæŸ¥è¯¢å¢å¼º**ï¼š

```sql
-- 1. é…ç½®å¹¶è¡ŒæŸ¥è¯¢ï¼ˆPostgreSQL 18ï¼‰
ALTER SYSTEM SET max_parallel_workers_per_gather = 4;
ALTER SYSTEM SET parallel_workers = 4;
ALTER SYSTEM SET min_parallel_table_scan_size = 8MB;

-- 2. åˆ†å¸ƒå¼å¹¶è¡Œèšåˆ
-- Citusè‡ªåŠ¨å¹¶è¡ŒåŒ–èšåˆæ“ä½œ
SELECT
    DATE_TRUNC('month', created_at) as month,
    COUNT(*) as user_count,
    AVG(EXTRACT(EPOCH FROM (NOW() - created_at))) as avg_age
FROM users
WHERE created_at >= '2024-01-01'
GROUP BY month
ORDER BY month;

-- 3. æŸ¥çœ‹å¹¶è¡ŒæŸ¥è¯¢è®¡åˆ’
EXPLAIN (ANALYZE, VERBOSE, BUFFERS)
SELECT COUNT(*) FROM users WHERE created_at > '2024-01-01';
-- ä¼šæ˜¾ç¤ºå¹¶è¡Œå·¥ä½œè¿›ç¨‹æ•°é‡
```

---

## 9. ç›‘æ§ä¸è¯Šæ–­

### 9.1 Citusç›‘æ§

```sql
-- æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€
SELECT * FROM citus_get_active_worker_nodes();

-- æŸ¥çœ‹åˆ†ç‰‡åˆ†å¸ƒ
SELECT * FROM citus_shards;

-- æŸ¥çœ‹æŸ¥è¯¢ç»Ÿè®¡
SELECT * FROM citus_stat_statements
ORDER BY total_exec_time DESC
LIMIT 10;
```

**å®Œæ•´ç›‘æ§æŸ¥è¯¢**ï¼š

```sql
-- 1. èŠ‚ç‚¹å¥åº·æ£€æŸ¥
SELECT
    node_name,
    node_port,
    isactive,
    noderole,
    shouldhaveshards
FROM citus_get_active_worker_nodes();

-- 2. åˆ†ç‰‡åˆ†å¸ƒå’Œå¤§å°
SELECT
    table_name,
    shardid,
    pg_size_pretty(shard_size) as size,
    node_name,
    node_port,
    shard_state
FROM citus_shards
ORDER BY shard_size DESC;

-- 3. åˆ†ç‰‡å¹³è¡¡æ£€æŸ¥
SELECT
    node_name,
    COUNT(*) as shard_count,
    pg_size_pretty(SUM(shard_size)) as total_size,
    AVG(shard_size) as avg_size
FROM citus_shards
GROUP BY node_name
ORDER BY shard_count DESC;

-- 4. æŸ¥è¯¢æ€§èƒ½ç»Ÿè®¡
SELECT
    LEFT(query, 100) as query_preview,
    calls,
    total_exec_time,
    mean_exec_time,
    max_exec_time,
    rows
FROM citus_stat_statements
ORDER BY total_exec_time DESC
LIMIT 20;

-- 5. åˆ†å¸ƒå¼æŸ¥è¯¢æ‰§è¡Œæƒ…å†µ
SELECT
    query,
    executor_type,
    execution_time,
    rows_processed
FROM citus_stat_activity
WHERE state = 'active'
ORDER BY execution_time DESC;

-- 6. è¿æ¥æ± ä½¿ç”¨æƒ…å†µ
SELECT
    node_name,
    active_connections,
    max_connections,
    pool_size
FROM citus_connpool_stats();
```

**Prometheusç›‘æ§é›†æˆ**ï¼š

```yaml
# prometheus.yml
scrape_configs:
  - job_name: 'citus'
    static_configs:
      - targets:
          - 'coordinator:9187'
          - 'worker1:9187'
          - 'worker2:9187'
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
```

### 9.2 æ€§èƒ½è¯Šæ–­

```sql
-- åˆ†ææ…¢æŸ¥è¯¢
SELECT
    query,
    calls,
    total_exec_time,
    mean_exec_time
FROM citus_stat_statements
WHERE mean_exec_time > 1000
ORDER BY mean_exec_time DESC;
```

**å®Œæ•´è¯Šæ–­æµç¨‹**ï¼š

```sql
-- 1. è¯†åˆ«æ…¢æŸ¥è¯¢
SELECT
    queryid,
    LEFT(query, 200) as query_preview,
    calls,
    total_exec_time,
    mean_exec_time,
    max_exec_time,
    stddev_exec_time,
    rows
FROM citus_stat_statements
WHERE mean_exec_time > 1000
ORDER BY total_exec_time DESC
LIMIT 10;

-- 2. åˆ†ææŸ¥è¯¢è®¡åˆ’
EXPLAIN (ANALYZE, BUFFERS, VERBOSE, COSTS)
SELECT COUNT(*) FROM users WHERE created_at > '2024-01-01';

-- 3. æ£€æŸ¥åˆ†ç‰‡å€¾æ–œ
SELECT
    table_name,
    node_name,
    COUNT(*) as shard_count,
    SUM(shard_size) as total_size
FROM citus_shards
GROUP BY table_name, node_name
HAVING COUNT(*) > (
    SELECT AVG(shard_count)
    FROM (
        SELECT COUNT(*) as shard_count
        FROM citus_shards
        GROUP BY node_name
    ) sub
) * 1.2;  -- è¶…è¿‡å¹³å‡å€¼çš„20%è®¤ä¸ºå€¾æ–œ

-- 4. æ£€æŸ¥è·¨åˆ†ç‰‡æŸ¥è¯¢
SELECT
    query,
    executor_type,
    execution_time,
    CASE
        WHEN executor_type = 'adaptive' THEN 'è·¨åˆ†ç‰‡æŸ¥è¯¢'
        WHEN executor_type = 'real-time' THEN 'å•åˆ†ç‰‡æŸ¥è¯¢'
        ELSE 'å…¶ä»–'
    END as query_type
FROM citus_stat_activity
WHERE state = 'active'
ORDER BY execution_time DESC;

-- 5. æ£€æŸ¥è¿æ¥æ± ç“¶é¢ˆ
SELECT
    node_name,
    active_connections,
    max_connections,
    waiting_connections,
    CASE
        WHEN active_connections::float / max_connections > 0.8 THEN 'é«˜'
        WHEN active_connections::float / max_connections > 0.6 THEN 'ä¸­'
        ELSE 'ä½'
    END as load_level
FROM citus_connpool_stats();

-- 6. æ£€æŸ¥æ•°æ®åˆ†å¸ƒå‡åŒ€æ€§
SELECT
    table_name,
    MIN(shard_size) as min_size,
    MAX(shard_size) as max_size,
    AVG(shard_size) as avg_size,
    (MAX(shard_size) - MIN(shard_size))::float / AVG(shard_size) * 100 as skew_percent
FROM citus_shards
GROUP BY table_name
HAVING (MAX(shard_size) - MIN(shard_size))::float / AVG(shard_size) > 0.2
ORDER BY skew_percent DESC;

-- 7. åˆ†æé”ç­‰å¾…
SELECT
    blocked_locks.pid AS blocked_pid,
    blocking_locks.pid AS blocking_pid,
    blocked_activity.query AS blocked_query,
    blocking_activity.query AS blocking_query,
    blocked_activity.node_name AS blocked_node,
    blocking_activity.node_name AS blocking_node
FROM pg_catalog.pg_locks blocked_locks
JOIN pg_catalog.pg_stat_activity blocked_activity ON blocked_activity.pid = blocked_locks.pid
JOIN pg_catalog.pg_locks blocking_locks
    ON blocking_locks.locktype = blocked_locks.locktype
    AND blocking_locks.pid != blocked_locks.pid
JOIN pg_catalog.pg_stat_activity blocking_activity ON blocking_activity.pid = blocking_locks.pid
WHERE NOT blocked_locks.granted;
```

**Greenplumè¯Šæ–­**ï¼š

```sql
-- 1. æŸ¥çœ‹SegmentçŠ¶æ€
SELECT * FROM gp_segment_configuration ORDER BY content;

-- 2. æŸ¥çœ‹æŸ¥è¯¢åˆ†å‘æƒ…å†µ
SELECT
    datname,
    usename,
    application_name,
    state,
    query_start,
    LEFT(query, 100) as query_preview
FROM pg_stat_activity
WHERE state = 'active'
ORDER BY query_start;

-- 3. æ£€æŸ¥æ•°æ®å€¾æ–œ
SELECT
    schemaname,
    tablename,
    attname as distkey,
    n_distinct,
    correlation
FROM pg_stats
WHERE schemaname = 'public'
AND tablename = 'sales'
ORDER BY correlation;
```

**PostgreSQL-XLè¯Šæ–­**ï¼š

```sql
-- 1. æŸ¥çœ‹é›†ç¾¤çŠ¶æ€
SELECT * FROM pgxc_node;

-- 2. æŸ¥çœ‹GTMçŠ¶æ€
SELECT pgxc_get_gtm_status();

-- 3. æŸ¥çœ‹åˆ†å¸ƒå¼æŸ¥è¯¢è®¡åˆ’
EXPLAIN (ANALYZE, VERBOSE, BUFFERS)
SELECT COUNT(*) FROM distributed_users WHERE id > 1000;
```

---

## 10. ç›¸å…³æ–‡æ¡£

### éƒ¨ç½²æ¶æ„

- â­â­â­ [é›†ç¾¤éƒ¨ç½²ä¸é«˜å¯ç”¨](../é›†ç¾¤éƒ¨ç½²/05.04-é›†ç¾¤éƒ¨ç½²ä¸é«˜å¯ç”¨.md) - é«˜å¯ç”¨æ¶æ„
- â­â­ [æ€§èƒ½è°ƒä¼˜å®è·µ](../å•æœºéƒ¨ç½²/05.02-æ€§èƒ½è°ƒä¼˜å®è·µ.md) - æ€§èƒ½ä¼˜åŒ–

### æ ¸å¿ƒè¯¾ç¨‹

- â­â­â­ [äº‹åŠ¡ç®¡ç†ä¸ACIDç‰¹æ€§](../../01-æ ¸å¿ƒè¯¾ç¨‹/01.04-äº‹åŠ¡ç®¡ç†ä¸ACIDç‰¹æ€§.md) - äº‹åŠ¡ç†è®º
- â­â­ [å¹¶å‘æ§åˆ¶ä¸MVCCæœºåˆ¶](../../01-æ ¸å¿ƒè¯¾ç¨‹/01.05-å¹¶å‘æ§åˆ¶ä¸MVCCæœºåˆ¶.md) - å¹¶å‘æ§åˆ¶

### é«˜çº§ç‰¹æ€§

- â­â­â­ [åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†](../../04-é«˜çº§ç‰¹æ€§/03.07-åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†.md) - åˆ†å¸ƒå¼äº‹åŠ¡

### æ•°æ®æ¨¡å‹è®¾è®¡

- â­â­ [æ•°æ®ä»“åº“è®¾è®¡æŒ‡å—](../../09-åº”ç”¨è®¾è®¡/æ•°æ®æ¨¡å‹è®¾è®¡/09.03-æ•°æ®ä»“åº“è®¾è®¡æŒ‡å—.md) - åˆ†å¸ƒå¼æ•°æ®ä»“åº“
- â­ [ETLæµç¨‹å®Œæ•´æŒ‡å—](../../09-åº”ç”¨è®¾è®¡/æ•°æ®æ¨¡å‹è®¾è®¡/09.04-ETLæµç¨‹å®Œæ•´æŒ‡å—.md) - åˆ†å¸ƒå¼ETL

### è¿ç»´å®è·µ

- â­â­ [ç›‘æ§ä¸è¯Šæ–­](../../06-è¿ç»´å®è·µ/ç›‘æ§ä¸è¯Šæ–­/06.01-ç›‘æ§ä¸è¯Šæ–­.md) - ç›‘æ§æ–¹æ³•

### ç†è®ºåŸºç¡€

- â­â­ [å½¢å¼åŒ–éªŒè¯æ–¹æ³•](../../10-ç†è®ºåŸºç¡€/10.01-å½¢å¼åŒ–éªŒè¯æ–¹æ³•.md) - åˆ†å¸ƒå¼åè®®å½¢å¼åŒ–éªŒè¯
- â­ [å­¦æœ¯ç ”ç©¶å‰æ²¿](../../10-ç†è®ºåŸºç¡€/10.02-å­¦æœ¯ç ”ç©¶å‰æ²¿.md) - åˆ†å¸ƒå¼ç³»ç»Ÿç ”ç©¶

---

## 11. å‚è€ƒæ–‡çŒ®

1. PostgreSQL Global Development Group. (2025). PostgreSQL 18 Documentation. <https://www.postgresql.org/docs/18/>

2. Citus Data. (2025). Citus Documentation. <https://docs.citusdata.com/>

3. Greenplum. (2025). Greenplum Documentation. <https://docs.greenplum.org/>

4. PostgreSQL-XL. (2025). PostgreSQL-XL Documentation. <https://www.postgres-xl.org/documentation/>

5. Brewer, E. (2000). Towards robust distributed systems. PODC 2000.

6. PostgreSQL Global Development Group. (2024). PostgreSQL 17 Documentation. <https://www.postgresql.org/docs/17/>

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-11-22
**ç»´æŠ¤è€…**: PostgreSQL Documentation Team
