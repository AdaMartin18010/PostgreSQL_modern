# æŸ¥è¯¢é‡å†™ç­‰ä»·æ€§-åŸºäºåŒæ„çš„å……åˆ†å¿…è¦æ¡ä»¶

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **æœ€åæ›´æ–°**: 2025-01-16
> **ç‰ˆæœ¬è¦†ç›–**: PostgreSQL 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x (å…¼å®¹)
> **æ–‡æ¡£çŠ¶æ€**: ğŸŸ¡ æ¡†æ¶å·²åˆ›å»ºï¼Œå†…å®¹å¾…å®Œå–„

---

## ğŸ“‹ ç›®å½•

- [æŸ¥è¯¢é‡å†™ç­‰ä»·æ€§-åŸºäºåŒæ„çš„å……åˆ†å¿…è¦æ¡ä»¶](#æŸ¥è¯¢é‡å†™ç­‰ä»·æ€§-åŸºäºåŒæ„çš„å……åˆ†å¿…è¦æ¡ä»¶)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.0 æŸ¥è¯¢é‡å†™ç­‰ä»·æ€§å·¥ä½œåŸç†æ¦‚è¿°](#10-æŸ¥è¯¢é‡å†™ç­‰ä»·æ€§å·¥ä½œåŸç†æ¦‚è¿°)
    - [1.1 æœ¬æ–‡æ¡£çš„èŒƒå›´](#11-æœ¬æ–‡æ¡£çš„èŒƒå›´)
  - [2. æ ¸å¿ƒå†…å®¹](#2-æ ¸å¿ƒå†…å®¹)
    - [2.1 æŸ¥è¯¢å›¾åŒæ„](#21-æŸ¥è¯¢å›¾åŒæ„)
    - [2.2 å……åˆ†å¿…è¦æ¡ä»¶](#22-å……åˆ†å¿…è¦æ¡ä»¶)
    - [2.3 åŒæ„ç®—æ³•](#23-åŒæ„ç®—æ³•)
  - [3. å½¢å¼åŒ–å®šä¹‰](#3-å½¢å¼åŒ–å®šä¹‰)
    - [3.1 æŸ¥è¯¢å›¾å½¢å¼åŒ–](#31-æŸ¥è¯¢å›¾å½¢å¼åŒ–)
    - [3.2 åŒæ„å½¢å¼åŒ–](#32-åŒæ„å½¢å¼åŒ–)
    - [3.3 ç­‰ä»·æ€§å½¢å¼åŒ–](#33-ç­‰ä»·æ€§å½¢å¼åŒ–)
  - [4. å®šç†ä¸è¯æ˜](#4-å®šç†ä¸è¯æ˜)
    - [4.1 å……åˆ†æ€§å®šç†](#41-å……åˆ†æ€§å®šç†)
    - [4.2 å¿…è¦æ€§å®šç†](#42-å¿…è¦æ€§å®šç†)
  - [5. å®é™…åº”ç”¨](#5-å®é™…åº”ç”¨)
    - [5.1 PostgreSQLæŸ¥è¯¢é‡å†™](#51-postgresqlæŸ¥è¯¢é‡å†™)
    - [5.2 æŸ¥è¯¢ä¼˜åŒ–åº”ç”¨](#52-æŸ¥è¯¢ä¼˜åŒ–åº”ç”¨)
    - [5.3 ç‰©åŒ–è§†å›¾åŒ¹é…](#53-ç‰©åŒ–è§†å›¾åŒ¹é…)
  - [6. ç›¸å…³æ–‡æ¡£](#6-ç›¸å…³æ–‡æ¡£)
    - [6.1 ç†è®ºåŸºç¡€æ–‡æ¡£](#61-ç†è®ºåŸºç¡€æ–‡æ¡£)
  - [7. å‚è€ƒæ–‡çŒ®](#7-å‚è€ƒæ–‡çŒ®)
    - [7.1 æ ¸å¿ƒç†è®ºæ–‡çŒ®](#71-æ ¸å¿ƒç†è®ºæ–‡çŒ®)
    - [7.2 æŸ¥è¯¢ä¼˜åŒ–ç›¸å…³](#72-æŸ¥è¯¢ä¼˜åŒ–ç›¸å…³)
    - [7.3 PostgreSQLå®ç°ç›¸å…³](#73-postgresqlå®ç°ç›¸å…³)
    - [7.4 ç›¸å…³æ–‡æ¡£](#74-ç›¸å…³æ–‡æ¡£)

---

## 1. æ¦‚è¿°

### 1.0 æŸ¥è¯¢é‡å†™ç­‰ä»·æ€§å·¥ä½œåŸç†æ¦‚è¿°

**æŸ¥è¯¢é‡å†™ç­‰ä»·æ€§**ï¼š

æŸ¥è¯¢ä¼˜åŒ–å™¨é€šè¿‡æŸ¥è¯¢é‡å†™æ¥ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ã€‚ä¸¤ä¸ªæŸ¥è¯¢å¦‚æœå¯¹äºæ‰€æœ‰æ•°æ®åº“å®ä¾‹éƒ½äº§ç”Ÿç›¸åŒçš„ç»“æœï¼Œåˆ™å®ƒä»¬æ˜¯ç­‰ä»·çš„ã€‚æœ¬æ–‡æ¡£åŸºäºåŒæ„ç†è®ºæä¾›æŸ¥è¯¢é‡å†™ç­‰ä»·æ€§çš„å……åˆ†å¿…è¦æ¡ä»¶ã€‚

**æŸ¥è¯¢ç­‰ä»·æ€§åˆ¤å®š**ï¼š

```mermaid
flowchart TD
    A[ä¸¤ä¸ªæŸ¥è¯¢] --> B[æ„å»ºæŸ¥è¯¢å›¾]
    B --> C[æ£€æŸ¥åŒæ„]
    C --> D{åŒæ„?}
    D -->|æ˜¯| E[æ£€æŸ¥è¯­ä¹‰ç­‰ä»·]
    D -->|å¦| F[æŸ¥è¯¢ä¸ç­‰ä»·]
    E --> G{è¯­ä¹‰ç­‰ä»·?}
    G -->|æ˜¯| H[æŸ¥è¯¢ç­‰ä»·]
    G -->|å¦| F

    style A fill:#FFD700
    style C fill:#90EE90
    style H fill:#87CEEB
```

**åŒæ„åˆ¤å®šæµç¨‹**ï¼š

```mermaid
flowchart TD
    A[æŸ¥è¯¢å›¾] --> B[æå–ç»“æ„]
    B --> C[æ„å»ºåŒæ„æ˜ å°„]
    C --> D{æ˜ å°„å­˜åœ¨?}
    D -->|æ˜¯| E[æ£€æŸ¥è¯­ä¹‰çº¦æŸ]
    D -->|å¦| F[ä¸åŒæ„]
    E --> G{çº¦æŸæ»¡è¶³?}
    G -->|æ˜¯| H[åŒæ„]
    G -->|å¦| F

    style A fill:#FFD700
    style C fill:#90EE90
    style H fill:#87CEEB
```

### 1.1 æœ¬æ–‡æ¡£çš„èŒƒå›´

æœ¬æ–‡æ¡£æ¶µç›–ï¼š

- **åŒæ„ç†è®º**ï¼šæŸ¥è¯¢å›¾åŒæ„çš„æ•°å­¦å®šä¹‰
- **å……åˆ†æ¡ä»¶**ï¼šåŒæ„æ˜¯æŸ¥è¯¢ç­‰ä»·çš„å……åˆ†æ¡ä»¶
- **å¿…è¦æ¡ä»¶**ï¼šåŒæ„æ˜¯æŸ¥è¯¢ç­‰ä»·çš„å¿…è¦æ¡ä»¶
- **å®é™…åº”ç”¨**ï¼šç­‰ä»·æ€§åˆ¤å®šåœ¨æŸ¥è¯¢ä¼˜åŒ–ä¸­çš„åº”ç”¨

---

## 2. æ ¸å¿ƒå†…å®¹

### 2.1 æŸ¥è¯¢å›¾åŒæ„

**æŸ¥è¯¢å›¾å®šä¹‰**ï¼š

```haskell
-- æŸ¥è¯¢å›¾
data QueryGraph = QueryGraph {
    nodes :: [Relation],
    edges :: [Join],
    selections :: [Selection],
    projections :: [Projection]
}

-- åŒæ„æ˜ å°„
type Isomorphism = Map Node Node
```

**æŸ¥è¯¢å›¾åŒæ„åˆ¤å®šæ€ç»´å¯¼å›¾**ï¼š

```mermaid
mindmap
  root((æŸ¥è¯¢åŒæ„))
    ç»“æ„åŒæ„
      èŠ‚ç‚¹å¯¹åº”
      è¾¹å¯¹åº”
      åº¦åºåˆ—åŒ¹é…
    è¯­ä¹‰åŒæ„
      å…³ç³»å¯¹åº”
      è¿æ¥æ¡ä»¶å¯¹åº”
      é€‰æ‹©æ¡ä»¶å¯¹åº”
      æŠ•å½±å±æ€§å¯¹åº”
    åŒæ„åˆ¤å®š
      å›¾åŒæ„ç®—æ³•
      è¯­ä¹‰éªŒè¯
      å……åˆ†æ¡ä»¶
      å¿…è¦æ¡ä»¶
```

**åŒæ„åˆ¤å®šå†³ç­–æ ‘**ï¼š

```mermaid
flowchart TD
    A[ä¸¤ä¸ªæŸ¥è¯¢Q1, Q2] --> B[æ„å»ºæŸ¥è¯¢å›¾G1, G2]
    B --> C{èŠ‚ç‚¹æ•°ç›¸åŒ?}
    C -->|å¦| D[ä¸åŒæ„]
    C -->|æ˜¯| E{è¾¹æ•°ç›¸åŒ?}
    E -->|å¦| D
    E -->|æ˜¯| F[å°è¯•åŒæ„æ˜ å°„]
    F --> G{æ‰¾åˆ°æ˜ å°„?}
    G -->|å¦| D
    G -->|æ˜¯| H[éªŒè¯è¯­ä¹‰çº¦æŸ]
    H --> I{çº¦æŸæ»¡è¶³?}
    I -->|æ˜¯| J[åŒæ„]
    I -->|å¦| D

    style A fill:#FFD700
    style J fill:#90EE90
    style D fill:#FF6B6B
```

### 2.2 å……åˆ†å¿…è¦æ¡ä»¶

**ç­‰ä»·æ€§åˆ¤å®šå¯¹æ¯”çŸ©é˜µ**ï¼š

| æ¡ä»¶ç±»å‹ | å®šä¹‰ | æ˜¯å¦å……åˆ† | æ˜¯å¦å¿…è¦ |
|---------|------|---------|---------|
| **ç»“æ„åŒæ„** | æŸ¥è¯¢å›¾åŒæ„ | å¦ | å¦ |
| **è¯­ä¹‰åŒæ„** | ç»“æ„+è¯­ä¹‰å¯¹åº” | æ˜¯ | æ˜¯ |
| **ç»“æœç­‰ä»·** | æ‰€æœ‰å®ä¾‹ç»“æœç›¸åŒ | æ˜¯ | æ˜¯ |

### 2.3 åŒæ„ç®—æ³•

**åŒæ„æŸ¥æ‰¾ç®—æ³•**ï¼š

```haskell
-- åŒæ„æŸ¥æ‰¾
findIsomorphism :: QueryGraph -> QueryGraph -> Maybe Isomorphism
findIsomorphism g1 g2 =
    if |nodes g1| â‰  |nodes g2| then Nothing
    else if |edges g1| â‰  |edges g2| then Nothing
    else searchIsomorphism g1 g2
```

---

## 3. å½¢å¼åŒ–å®šä¹‰

### 3.1 æŸ¥è¯¢å›¾å½¢å¼åŒ–

**æŸ¥è¯¢å›¾å®šä¹‰**ï¼š

```haskell
-- æŸ¥è¯¢å›¾
G = (V, E, S, P)

å…¶ä¸­:
  V = {R1, R2, ..., Rn}  -- å…³ç³»èŠ‚ç‚¹
  E = {(Ri, Rj, cond)}   -- è¿æ¥è¾¹
  S = {Ïƒ_cond}            -- é€‰æ‹©æ¡ä»¶
  P = {Ï€_attrs}           -- æŠ•å½±å±æ€§
```

### 3.2 åŒæ„å½¢å¼åŒ–

**å›¾åŒæ„**ï¼š

```haskell
-- æŸ¥è¯¢å›¾åŒæ„
G1 â‰… G2 iff
    exists bijection f: V1 â†’ V2 such that:
      (u, v, cond) âˆˆ E1 âŸº (f(u), f(v), f(cond)) âˆˆ E2
      S1 âŸº f(S2)
      P1 âŸº f(P2)
```

### 3.3 ç­‰ä»·æ€§å½¢å¼åŒ–

**æŸ¥è¯¢ç­‰ä»·**ï¼š

```haskell
-- æŸ¥è¯¢ç­‰ä»·
Q1 â‰¡ Q2 iff forall DB: âŸ¦Q1âŸ§(DB) = âŸ¦Q2âŸ§(DB)

-- åŒæ„ä¸ç­‰ä»·çš„å…³ç³»
Q1 â‰… Q2 âŸ¹ Q1 â‰¡ Q2  (å……åˆ†æ¡ä»¶)
Q1 â‰¡ Q2 âŸ¹ Q1 â‰… Q2  (å¿…è¦æ¡ä»¶)
```

---

## 4. å®šç†ä¸è¯æ˜

### 4.1 å……åˆ†æ€§å®šç†

**å®šç†**ï¼šå¦‚æœä¸¤ä¸ªæŸ¥è¯¢å›¾åŒæ„ï¼Œåˆ™æŸ¥è¯¢ç­‰ä»·ã€‚

**è¯æ˜æ ‘**ï¼š

```mermaid
graph TD
    A[å……åˆ†æ€§å®šç†] --> B[å‡è®¾: Q1 â‰… Q2]
    B --> C[å­˜åœ¨åŒæ„æ˜ å°„f]
    C --> D[è¯æ˜: ç»“æ„å¯¹åº”]
    C --> E[è¯æ˜: è¯­ä¹‰å¯¹åº”]
    D --> F[å…³ç³»å¯¹åº”]
    E --> G[æ¡ä»¶å¯¹åº”]
    F --> H[ç»“æœç›¸åŒ]
    G --> H
    H --> I[Q1 â‰¡ Q2]
    I --> J[å®šç†å¾—è¯]

    style A fill:#FFD700
    style J fill:#90EE90
```

**è¯æ˜æ­¥éª¤**ï¼š

1. è®¾Q1å’ŒQ2åŒæ„ï¼Œå­˜åœ¨åŒæ„æ˜ å°„f
2. å¯¹äºä»»æ„æ•°æ®åº“DBï¼ŒæŸ¥è¯¢å›¾çš„ç»“æ„å¯¹åº”ä¿è¯å…³ç³»å¯¹åº”
3. è¿æ¥æ¡ä»¶ã€é€‰æ‹©æ¡ä»¶ã€æŠ•å½±å±æ€§çš„å¯¹åº”ä¿è¯è¯­ä¹‰å¯¹åº”
4. å› æ­¤å¯¹äºæ‰€æœ‰DBï¼ŒQ1å’ŒQ2äº§ç”Ÿç›¸åŒç»“æœ
5. å› æ­¤Q1 â‰¡ Q2

### 4.2 å¿…è¦æ€§å®šç†

**å®šç†**ï¼šå¦‚æœä¸¤ä¸ªæŸ¥è¯¢ç­‰ä»·ï¼Œåˆ™æŸ¥è¯¢å›¾åŒæ„ã€‚

**è¯æ˜æ€è·¯**ï¼š

1. å‡è®¾Q1 â‰¡ Q2ä½†ä¸åŒæ„
2. æ„é€ åä¾‹æ•°æ®åº“ï¼Œä½¿å¾—Q1å’ŒQ2äº§ç”Ÿä¸åŒç»“æœ
3. çŸ›ç›¾ï¼Œå› æ­¤Q1å’ŒQ2å¿…é¡»åŒæ„

---

## 5. å®é™…åº”ç”¨

### 5.1 PostgreSQLæŸ¥è¯¢é‡å†™

**æŸ¥è¯¢ç­‰ä»·æ€§æ£€æµ‹**ï¼š

```sql
-- åŸå§‹æŸ¥è¯¢
SELECT s.name, c.course_name
FROM students s
JOIN enrollments e ON s.id = e.student_id
JOIN courses c ON e.course_id = c.id
WHERE s.age > 18;

-- ç­‰ä»·é‡å†™ï¼ˆé€šè¿‡åŒæ„æ£€æµ‹ï¼‰
SELECT s.name, c.course_name
FROM courses c
JOIN enrollments e ON c.id = e.course_id
JOIN students s ON e.student_id = s.id
WHERE s.age > 18;

-- PostgreSQLä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨æ£€æµ‹è¿™ç§ç­‰ä»·æ€§
```

### 5.2 æŸ¥è¯¢ä¼˜åŒ–åº”ç”¨

**åŸºäºåŒæ„çš„ä¼˜åŒ–**ï¼š

```sql
-- æŸ¥è¯¢ä¼˜åŒ–å™¨ä½¿ç”¨åŒæ„æ£€æµ‹æ¥ï¼š
-- 1. è¯†åˆ«ç­‰ä»·æŸ¥è¯¢è®¡åˆ’
-- 2. é€‰æ‹©æœ€ä¼˜æ‰§è¡Œé¡ºåº
-- 3. åº”ç”¨æŸ¥è¯¢é‡å†™è§„åˆ™

EXPLAIN (ANALYZE, BUFFERS)
SELECT * FROM orders o
JOIN customers c ON o.customer_id = c.id
JOIN products p ON o.product_id = p.id;

-- ä¼˜åŒ–å™¨ä¼šå°è¯•ä¸åŒçš„è¿æ¥é¡ºåº
-- é€šè¿‡åŒæ„æ£€æµ‹ç¡®ä¿ç»“æœç­‰ä»·
```

### 5.3 ç‰©åŒ–è§†å›¾åŒ¹é…

**ç‰©åŒ–è§†å›¾æŸ¥è¯¢é‡å†™**ï¼š

```sql
-- ç‰©åŒ–è§†å›¾
CREATE MATERIALIZED VIEW mv_order_summary AS
SELECT
    c.customer_id,
    c.customer_name,
    COUNT(o.order_id) as order_count,
    SUM(o.total) as total_amount
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id, c.customer_name;

-- æŸ¥è¯¢ï¼ˆé€šè¿‡åŒæ„æ£€æµ‹åŒ¹é…ç‰©åŒ–è§†å›¾ï¼‰
SELECT
    customer_id,
    customer_name,
    COUNT(order_id) as order_count,
    SUM(total) as total_amount
FROM customers
JOIN orders ON customers.customer_id = orders.customer_id
GROUP BY customer_id, customer_name;

-- ä¼˜åŒ–å™¨æ£€æµ‹åˆ°åŒæ„ï¼Œä½¿ç”¨ç‰©åŒ–è§†å›¾
```

---

## 6. ç›¸å…³æ–‡æ¡£

### 6.1 ç†è®ºåŸºç¡€æ–‡æ¡£

- [æŸ¥è¯¢è¯­è¨€çš„å½¢å¼è¯­ä¹‰ä¸ç­‰ä»·å¾‹](../01-å½¢å¼åŒ–æ–¹æ³•ä¸åŸºç¡€ç†è®º/01.06-æŸ¥è¯¢è¯­è¨€çš„å½¢å¼è¯­ä¹‰ä¸ç­‰ä»·å¾‹.md)
- [å½¢å¼è¯­è¨€ä¸è¯æ˜ï¼šæ€»è®º](../01-å½¢å¼åŒ–æ–¹æ³•ä¸åŸºç¡€ç†è®º/01.05-å½¢å¼è¯­è¨€ä¸è¯æ˜-æ€»è®º.md)
- [ç†è®ºåŸºç¡€å¯¼èˆª](../README.md)

---

## 7. å‚è€ƒæ–‡çŒ®

### 7.1 æ ¸å¿ƒç†è®ºæ–‡çŒ®

- **Chandra, A. K., & Merlin, P. M. (1977). "Optimal Implementation of Conjunctive Queries in Relational Data Bases."**
  - ä¼šè®®: STOC 1977
  - **é‡è¦æ€§**: æŸ¥è¯¢ç­‰ä»·æ€§çš„ç»å…¸è®ºæ–‡
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†æŸ¥è¯¢åŒæ„çš„æ¦‚å¿µ

- **Ullman, J. D. (1988). "Principles of Database and Knowledge-Base Systems."**
  - å‡ºç‰ˆç¤¾: Computer Science Press
  - **é‡è¦æ€§**: æ•°æ®åº“ç³»ç»Ÿçš„ç»å…¸æ•™æ
  - **æ ¸å¿ƒè´¡çŒ®**: ç³»ç»Ÿé˜è¿°äº†æŸ¥è¯¢ä¼˜åŒ–ç†è®º

### 7.2 æŸ¥è¯¢ä¼˜åŒ–ç›¸å…³

- **Ioannidis, Y. E., & Kang, Y. C. (1990). "Randomized Algorithms for Optimizing Large Join Queries."**
  - ä¼šè®®: SIGMOD 1990
  - **é‡è¦æ€§**: æŸ¥è¯¢ä¼˜åŒ–çš„ç»å…¸ç ”ç©¶
  - **æ ¸å¿ƒè´¡çŒ®**: æä¾›äº†æŸ¥è¯¢ç­‰ä»·æ€§åˆ¤å®šçš„æ–¹æ³•

### 7.3 PostgreSQLå®ç°ç›¸å…³

- **PostgreSQLå®˜æ–¹æ–‡æ¡£ - æŸ¥è¯¢ä¼˜åŒ–å™¨](<https://www.postgresql.org/docs/current/planner-optimizer.html>)**
  - PostgreSQLæŸ¥è¯¢ä¼˜åŒ–å™¨å®ç°è¯´æ˜

### 7.4 ç›¸å…³æ–‡æ¡£

- [ä»£ä»·æ¨¡å‹ä¸ä¼˜åŒ–å™¨-ç­‰ä»·é‡å†™ä¸æœ€ä¼˜æ€§](./05.01-ä»£ä»·æ¨¡å‹ä¸ä¼˜åŒ–å™¨-ç­‰ä»·é‡å†™ä¸æœ€ä¼˜æ€§.md)
- [æŸ¥è¯¢è¯­è¨€çš„å½¢å¼è¯­ä¹‰ä¸ç­‰ä»·å¾‹](../01-å½¢å¼åŒ–æ–¹æ³•ä¸åŸºç¡€ç†è®º/01.06-æŸ¥è¯¢è¯­è¨€çš„å½¢å¼è¯­ä¹‰ä¸ç­‰ä»·å¾‹.md)
- [ç†è®ºåŸºç¡€å¯¼èˆª](../README.md)

---

**æœ€åæ›´æ–°**: 2025-01-16
**ç»´æŠ¤è€…**: Documentation Team
**çŠ¶æ€**: ğŸŸ¡ æ¡†æ¶å·²åˆ›å»ºï¼Œå†…å®¹å¾…å®Œå–„
