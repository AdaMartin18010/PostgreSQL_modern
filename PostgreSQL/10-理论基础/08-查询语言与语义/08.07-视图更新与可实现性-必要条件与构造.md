# è§†å›¾æ›´æ–°ä¸å¯å®ç°æ€§-å¿…è¦æ¡ä»¶ä¸æ„é€ 

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **æœ€åæ›´æ–°**: 2025-01-16
> **ç‰ˆæœ¬è¦†ç›–**: PostgreSQL 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x (å…¼å®¹)
> **æ–‡æ¡£çŠ¶æ€**: ğŸŸ¡ æ¡†æ¶å·²åˆ›å»ºï¼Œå†…å®¹å¾…å®Œå–„

---

## ğŸ“‹ ç›®å½•

- [è§†å›¾æ›´æ–°ä¸å¯å®ç°æ€§-å¿…è¦æ¡ä»¶ä¸æ„é€ ](#è§†å›¾æ›´æ–°ä¸å¯å®ç°æ€§-å¿…è¦æ¡ä»¶ä¸æ„é€ )
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.0 è§†å›¾æ›´æ–°å·¥ä½œåŸç†æ¦‚è¿°](#10-è§†å›¾æ›´æ–°å·¥ä½œåŸç†æ¦‚è¿°)
    - [1.1 æœ¬æ–‡æ¡£çš„èŒƒå›´](#11-æœ¬æ–‡æ¡£çš„èŒƒå›´)
  - [2. æ ¸å¿ƒå†…å®¹](#2-æ ¸å¿ƒå†…å®¹)
    - [2.1 å¯å®ç°æ€§æ¡ä»¶](#21-å¯å®ç°æ€§æ¡ä»¶)
    - [2.2 æ„é€ æ–¹æ³•](#22-æ„é€ æ–¹æ³•)
    - [2.3 æ›´æ–°è¯­ä¹‰](#23-æ›´æ–°è¯­ä¹‰)
  - [3. å½¢å¼åŒ–å®šä¹‰](#3-å½¢å¼åŒ–å®šä¹‰)
    - [3.1 å¯å®ç°æ€§å½¢å¼åŒ–](#31-å¯å®ç°æ€§å½¢å¼åŒ–)
    - [3.2 æ›´æ–°æ˜ å°„å½¢å¼åŒ–](#32-æ›´æ–°æ˜ å°„å½¢å¼åŒ–)
    - [3.3 æ­£ç¡®æ€§å½¢å¼åŒ–](#33-æ­£ç¡®æ€§å½¢å¼åŒ–)
  - [4. å®šç†ä¸è¯æ˜](#4-å®šç†ä¸è¯æ˜)
    - [4.1 å¯å®ç°æ€§åˆ¤å®šå®šç†](#41-å¯å®ç°æ€§åˆ¤å®šå®šç†)
    - [4.2 æ›´æ–°æ­£ç¡®æ€§å®šç†](#42-æ›´æ–°æ­£ç¡®æ€§å®šç†)
  - [5. å®é™…åº”ç”¨](#5-å®é™…åº”ç”¨)
    - [5.1 PostgreSQLè§†å›¾æ›´æ–°](#51-postgresqlè§†å›¾æ›´æ–°)
    - [5.2 è§†å›¾æ›´æ–°è§„åˆ™](#52-è§†å›¾æ›´æ–°è§„åˆ™)
    - [5.3 è§†å›¾æ›´æ–°æ£€æŸ¥](#53-è§†å›¾æ›´æ–°æ£€æŸ¥)
  - [6. ç›¸å…³æ–‡æ¡£](#6-ç›¸å…³æ–‡æ¡£)
    - [6.1 ç†è®ºåŸºç¡€æ–‡æ¡£](#61-ç†è®ºåŸºç¡€æ–‡æ¡£)
  - [7. å‚è€ƒæ–‡çŒ®](#7-å‚è€ƒæ–‡çŒ®)
    - [7.1 æ ¸å¿ƒç†è®ºæ–‡çŒ®](#71-æ ¸å¿ƒç†è®ºæ–‡çŒ®)
    - [7.2 è§†å›¾æ›´æ–°ç›¸å…³](#72-è§†å›¾æ›´æ–°ç›¸å…³)
    - [7.3 PostgreSQLå®ç°ç›¸å…³](#73-postgresqlå®ç°ç›¸å…³)
    - [7.4 ç›¸å…³æ–‡æ¡£](#74-ç›¸å…³æ–‡æ¡£)

---

## 1. æ¦‚è¿°

### 1.0 è§†å›¾æ›´æ–°å·¥ä½œåŸç†æ¦‚è¿°

**è§†å›¾æ›´æ–°**ï¼š

è§†å›¾æ›´æ–°æ˜¯æŒ‡é€šè¿‡è§†å›¾ä¿®æ”¹åº•å±‚åŸºè¡¨æ•°æ®ã€‚å¹¶éæ‰€æœ‰è§†å›¾éƒ½å¯ä»¥æ›´æ–°ï¼Œéœ€è¦æ»¡è¶³ç‰¹å®šçš„å¯å®ç°æ€§æ¡ä»¶ã€‚

**è§†å›¾æ›´æ–°ä½“ç³»æ€ç»´å¯¼å›¾**ï¼š

```mermaid
mindmap
  root((è§†å›¾æ›´æ–°))
    å¯å®ç°æ€§
      å•è¡¨è§†å›¾
      è¿æ¥è§†å›¾
      èšåˆè§†å›¾
      æ¡ä»¶
    æ›´æ–°ç±»å‹
      INSERT
      UPDATE
      DELETE
    æ„é€ æ–¹æ³•
      å”¯ä¸€æ˜ å°„
      å¯é€†æ˜ å°„
      è¡¥å¿æ›´æ–°
    æ­£ç¡®æ€§
      è¯­ä¹‰æ­£ç¡®
      å®Œæ•´æ€§ä¿æŒ
      çº¦æŸæ»¡è¶³
```

**è§†å›¾æ›´æ–°åˆ¤å®šå†³ç­–æ ‘**ï¼š

```mermaid
flowchart TD
    A[è§†å›¾æ›´æ–°è¯·æ±‚] --> B{è§†å›¾ç±»å‹}
    B -->|å•è¡¨æŠ•å½±| C[æ£€æŸ¥å”¯ä¸€æ€§]
    B -->|è¿æ¥è§†å›¾| D[æ£€æŸ¥ä¸€å¯¹ä¸€æ˜ å°„]
    B -->|èšåˆè§†å›¾| E[ä¸å¯æ›´æ–°]
    C --> F{ä¸»é”®å¯è§?}
    F -->|æ˜¯| G[å¯æ›´æ–°]
    F -->|å¦| H[ä¸å¯æ›´æ–°]
    D --> I{ä¸€å¯¹ä¸€æ˜ å°„?}
    I -->|æ˜¯| G
    I -->|å¦| H
    G --> J[æ‰§è¡Œæ›´æ–°]
    H --> K[æ‹’ç»æ›´æ–°]

    style A fill:#FFD700
    style G fill:#90EE90
    style K fill:#FF6B6B
```

**è§†å›¾ç±»å‹æ›´æ–°èƒ½åŠ›å¯¹æ¯”çŸ©é˜µ**ï¼š

| è§†å›¾ç±»å‹ | INSERT | UPDATE | DELETE | æ¡ä»¶ |
|---------|--------|--------|--------|------|
| **å•è¡¨æŠ•å½±** | æ˜¯ | æ˜¯ | æ˜¯ | ä¸»é”®å¯è§ |
| **å•è¡¨é€‰æ‹©** | æ˜¯ | æ˜¯ | æ˜¯ | ä¸»é”®å¯è§ |
| **è¿æ¥è§†å›¾** | å¦ | éƒ¨åˆ† | éƒ¨åˆ† | ä¸€å¯¹ä¸€æ˜ å°„ |
| **èšåˆè§†å›¾** | å¦ | å¦ | å¦ | ä¸å¯æ›´æ–° |
| **UNIONè§†å›¾** | å¦ | å¦ | å¦ | ä¸å¯æ›´æ–° |

### 1.1 æœ¬æ–‡æ¡£çš„èŒƒå›´

æœ¬æ–‡æ¡£æ¶µç›–ï¼š

- **å¯å®ç°æ€§æ¡ä»¶**ï¼šè§†å›¾å¯æ›´æ–°çš„å¿…è¦å’Œå……åˆ†æ¡ä»¶
- **æ„é€ æ–¹æ³•**ï¼šæ„é€ å¯æ›´æ–°è§†å›¾çš„æ–¹æ³•
- **æ›´æ–°è¯­ä¹‰**ï¼šè§†å›¾æ›´æ–°çš„è¯­ä¹‰å®šä¹‰
- **å®é™…åº”ç”¨**ï¼šPostgreSQLè§†å›¾æ›´æ–°çš„å®ç°

---

## 2. æ ¸å¿ƒå†…å®¹

### 2.1 å¯å®ç°æ€§æ¡ä»¶

**å¿…è¦æ¡ä»¶**ï¼š

```haskell
-- è§†å›¾å¯æ›´æ–°æ¡ä»¶
updatable :: View -> Bool
updatable V =
    -- æ¡ä»¶1: è§†å›¾å®šä¹‰ä¸åŒ…å«èšåˆ
    not (hasAggregation(V.definition)) &&
    -- æ¡ä»¶2: è§†å›¾å®šä¹‰ä¸åŒ…å«DISTINCT
    not (hasDistinct(V.definition)) &&
    -- æ¡ä»¶3: è§†å›¾å®šä¹‰ä¸åŒ…å«UNION
    not (hasUnion(V.definition)) &&
    -- æ¡ä»¶4: åŸºè¡¨ä¸»é”®åœ¨è§†å›¾ä¸­å¯è§
    hasPrimaryKey(V)
```

**å……åˆ†æ¡ä»¶**ï¼š

```haskell
-- å•è¡¨è§†å›¾å¯æ›´æ–°
singleTableUpdatable :: View -> Bool
singleTableUpdatable V =
    isSingleTable(V) &&
    hasPrimaryKey(V) &&
    not (hasAggregation(V.definition))
```

**è§†å›¾æ›´æ–°åˆ¤å®šæµç¨‹**ï¼š

```mermaid
graph TD
    A[è§†å›¾V] --> B{å•è¡¨è§†å›¾?}
    B -->|æ˜¯| C{ä¸»é”®å¯è§?}
    B -->|å¦| D{è¿æ¥è§†å›¾?}
    C -->|æ˜¯| E[å¯æ›´æ–°]
    C -->|å¦| F[ä¸å¯æ›´æ–°]
    D -->|æ˜¯| G{ä¸€å¯¹ä¸€æ˜ å°„?}
    D -->|å¦| H[ä¸å¯æ›´æ–°]
    G -->|æ˜¯| I[éƒ¨åˆ†å¯æ›´æ–°]
    G -->|å¦| H

    style A fill:#FFD700
    style E fill:#90EE90
    style I fill:#87CEEB
    style F fill:#FF6B6B
    style H fill:#FF6B6B
```

### 2.2 æ„é€ æ–¹æ³•

**å¯æ›´æ–°è§†å›¾æ„é€ **ï¼š

```haskell
-- æ„é€ å¯æ›´æ–°è§†å›¾
constructUpdatable :: Table -> Attributes -> View
constructUpdatable T attrs =
    View {
        definition = Ï€_attrs(T),
        baseTable = T,
        primaryKey = getPrimaryKey(T)
    }
```

**æ›´æ–°æ˜ å°„**ï¼š

```haskell
-- è§†å›¾æ›´æ–°åˆ°åŸºè¡¨æ›´æ–°
mapUpdate :: View -> Update -> Update
mapUpdate V (Update viewAttrs newVals) =
    Update V.baseTable (mapToBaseAttrs(V, viewAttrs)) (mapToBaseVals(V, newVals))
```

### 2.3 æ›´æ–°è¯­ä¹‰

**INSERTè¯­ä¹‰**ï¼š

```haskell
-- è§†å›¾INSERT
insertIntoView :: View -> Tuple -> Database -> Database
insertIntoView V t db =
    let baseTuple = mapToBaseTuple(V, t)
    in insertIntoTable(V.baseTable, baseTuple, db)
```

**UPDATEè¯­ä¹‰**ï¼š

```haskell
-- è§†å›¾UPDATE
updateView :: View -> Condition -> Update -> Database -> Database
updateView V cond update db =
    let baseCond = mapToBaseCondition(V, cond)
        baseUpdate = mapToBaseUpdate(V, update)
    in updateTable(V.baseTable, baseCond, baseUpdate, db)
```

---

## 3. å½¢å¼åŒ–å®šä¹‰

### 3.1 å¯å®ç°æ€§å½¢å¼åŒ–

**å¯æ›´æ–°æ€§**ï¼š

```haskell
-- è§†å›¾å¯æ›´æ–°
updatable(V) iff
    exists function f: ViewUpdate -> BaseUpdate such that:
      forall DB: âŸ¦VâŸ§(f(update, DB)) = update(âŸ¦VâŸ§(DB))
```

### 3.2 æ›´æ–°æ˜ å°„å½¢å¼åŒ–

**æ›´æ–°æ˜ å°„**ï¼š

```haskell
-- æ›´æ–°æ˜ å°„
mapUpdate(V, u) = u' such that:
    forall DB: âŸ¦VâŸ§(u'(DB)) = u(âŸ¦VâŸ§(DB))
```

### 3.3 æ­£ç¡®æ€§å½¢å¼åŒ–

**æ›´æ–°æ­£ç¡®æ€§**ï¼š

```haskell
-- è§†å›¾æ›´æ–°æ­£ç¡®
correct(V, u) iff
    forall DB: âŸ¦VâŸ§(mapUpdate(V, u)(DB)) = u(âŸ¦VâŸ§(DB))
```

---

## 4. å®šç†ä¸è¯æ˜

### 4.1 å¯å®ç°æ€§åˆ¤å®šå®šç†

**å®šç†**ï¼šå•è¡¨è§†å›¾å¯æ›´æ–°å½“ä¸”ä»…å½“ä¸»é”®åœ¨è§†å›¾ä¸­å¯è§ã€‚

**è¯æ˜æ ‘**ï¼š

```mermaid
graph TD
    A[å¯å®ç°æ€§åˆ¤å®š] --> B[å¿…è¦æ€§: å¯æ›´æ–° âŸ¹ ä¸»é”®å¯è§]
    A --> C[å……åˆ†æ€§: ä¸»é”®å¯è§ âŸ¹ å¯æ›´æ–°]
    B --> D[åè¯: æ— ä¸»é”®åˆ™æ— æ³•å”¯ä¸€æ˜ å°„]
    C --> E[ä¸»é”®ä¿è¯å”¯ä¸€æ˜ å°„]
    D --> F[çŸ›ç›¾]
    E --> G[å¯æ›´æ–°]
    F --> H[å®šç†å¾—è¯]
    G --> H

    style A fill:#FFD700
    style H fill:#90EE90
```

**è¯æ˜**ï¼š

1. **å¿…è¦æ€§**ï¼šå¦‚æœè§†å›¾å¯æ›´æ–°ï¼Œåˆ™å¿…é¡»èƒ½å¤Ÿå”¯ä¸€ç¡®å®šåŸºè¡¨è¡Œï¼Œè¿™è¦æ±‚ä¸»é”®å¯è§
2. **å……åˆ†æ€§**ï¼šå¦‚æœä¸»é”®å¯è§ï¼Œåˆ™å¯ä»¥é€šè¿‡ä¸»é”®å”¯ä¸€æ˜ å°„åˆ°åŸºè¡¨è¡Œï¼Œè§†å›¾å¯æ›´æ–°

### 4.2 æ›´æ–°æ­£ç¡®æ€§å®šç†

**å®šç†**ï¼šå¯æ›´æ–°è§†å›¾çš„æ›´æ–°æ˜ å°„æ˜¯æ­£ç¡®çš„ã€‚

**è¯æ˜**ï¼š

1. å¯æ›´æ–°è§†å›¾æ»¡è¶³å¯å®ç°æ€§æ¡ä»¶
2. æ›´æ–°æ˜ å°„ä¿è¯è§†å›¾æ›´æ–°ä¸åŸºè¡¨æ›´æ–°ä¸€è‡´
3. å› æ­¤æ›´æ–°æ˜ å°„æ­£ç¡®

---

## 5. å®é™…åº”ç”¨

### 5.1 PostgreSQLè§†å›¾æ›´æ–°

**åˆ›å»ºå¯æ›´æ–°è§†å›¾**ï¼š

```sql
-- å•è¡¨è§†å›¾ï¼ˆå¯æ›´æ–°ï¼‰
CREATE VIEW active_customers AS
SELECT customer_id, customer_name, email
FROM customers
WHERE status = 'active';

-- è§†å›¾æ›´æ–°
INSERT INTO active_customers (customer_name, email)
VALUES ('Alice', 'alice@example.com');

UPDATE active_customers
SET email = 'newemail@example.com'
WHERE customer_id = 1;

DELETE FROM active_customers
WHERE customer_id = 1;
```

**ä¸å¯æ›´æ–°è§†å›¾**ï¼š

```sql
-- èšåˆè§†å›¾ï¼ˆä¸å¯æ›´æ–°ï¼‰
CREATE VIEW customer_stats AS
SELECT
    customer_id,
    COUNT(*) as order_count,
    SUM(total) as total_amount
FROM orders
GROUP BY customer_id;

-- å°è¯•æ›´æ–°ä¼šå¤±è´¥
UPDATE customer_stats SET order_count = 10;  -- é”™è¯¯ï¼šä¸å¯æ›´æ–°

-- è¿æ¥è§†å›¾ï¼ˆéƒ¨åˆ†å¯æ›´æ–°ï¼‰
CREATE VIEW customer_orders AS
SELECT
    c.customer_id,
    c.customer_name,
    o.order_id,
    o.order_date
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id;

-- åªèƒ½æ›´æ–°æŸäº›åˆ—
UPDATE customer_orders
SET customer_name = 'New Name'
WHERE customer_id = 1;  -- å¯èƒ½æˆåŠŸï¼Œå–å†³äºå®ç°
```

### 5.2 è§†å›¾æ›´æ–°è§„åˆ™

**INSTEAD OFè§¦å‘å™¨**ï¼š

```sql
-- ä½¿ç”¨INSTEAD OFè§¦å‘å™¨å®ç°å¤æ‚è§†å›¾æ›´æ–°
CREATE VIEW customer_order_summary AS
SELECT
    c.customer_id,
    c.customer_name,
    COUNT(o.order_id) as order_count
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id, c.customer_name;

-- åˆ›å»ºINSTEAD OFè§¦å‘å™¨
CREATE OR REPLACE FUNCTION update_customer_order_summary()
RETURNS TRIGGER AS $$
BEGIN
    -- å®ç°æ›´æ–°é€»è¾‘
    UPDATE customers
    SET customer_name = NEW.customer_name
    WHERE customer_id = NEW.customer_id;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER instead_of_update_customer_order_summary
INSTEAD OF UPDATE ON customer_order_summary
FOR EACH ROW
EXECUTE FUNCTION update_customer_order_summary();
```

### 5.3 è§†å›¾æ›´æ–°æ£€æŸ¥

**æ£€æŸ¥è§†å›¾å¯æ›´æ–°æ€§**ï¼š

```sql
-- æŸ¥çœ‹è§†å›¾å®šä¹‰
SELECT definition
FROM pg_views
WHERE viewname = 'active_customers';

-- æ£€æŸ¥è§†å›¾æ˜¯å¦å¯æ›´æ–°ï¼ˆPostgreSQLä¸ç›´æ¥æ”¯æŒï¼Œéœ€è¦æ‰‹åŠ¨åˆ†æï¼‰
-- æ¡ä»¶ï¼š
-- 1. å•è¡¨æˆ–ç®€å•è¿æ¥
-- 2. ä¸åŒ…å«èšåˆã€DISTINCTã€UNION
-- 3. ä¸»é”®æˆ–å”¯ä¸€é”®å¯è§
```

---

## 6. ç›¸å…³æ–‡æ¡£

### 6.1 ç†è®ºåŸºç¡€æ–‡æ¡£

- [å…³ç³»ä»£æ•°ä¸å…³ç³»æ¼”ç®—-ç§‘å¾·å®šç†ä¸å¯è¡¨è¾¾æ€§](./08.02-å…³ç³»ä»£æ•°ä¸å…³ç³»æ¼”ç®—-ç§‘å¾·å®šç†ä¸å¯è¡¨è¾¾æ€§.md)
- [ç†è®ºåŸºç¡€å¯¼èˆª](../README.md)

---

## 7. å‚è€ƒæ–‡çŒ®

### 7.1 æ ¸å¿ƒç†è®ºæ–‡çŒ®

- **Dayal, U., & Bernstein, P. A. (1982). "On the Correct Translation of Update Operations on Relational Views."**
  - ä¼šè®®: TODS 1982
  - **é‡è¦æ€§**: è§†å›¾æ›´æ–°çš„ç»å…¸è®ºæ–‡
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†è§†å›¾æ›´æ–°çš„å¯å®ç°æ€§æ¡ä»¶

- **Keller, A. M. (1985). "Algorithms for Translating View Updates to Database Updates for Views Involving Selections, Projections, and Joins."**
  - ä¼šè®®: PODS 1985
  - **é‡è¦æ€§**: è§†å›¾æ›´æ–°ç®—æ³•çš„ç»å…¸ç ”ç©¶
  - **æ ¸å¿ƒè´¡çŒ®**: æä¾›äº†è§†å›¾æ›´æ–°çš„æ„é€ ç®—æ³•

### 7.2 è§†å›¾æ›´æ–°ç›¸å…³

- **Abiteboul, S., et al. (1995). "Foundations of Databases."**
  - å‡ºç‰ˆç¤¾: Addison-Wesley 1995
  - **é‡è¦æ€§**: æ•°æ®åº“ç†è®ºçš„ç»å…¸æ•™æ
  - **æ ¸å¿ƒè´¡çŒ®**: è¯¦ç»†é˜è¿°äº†è§†å›¾æ›´æ–°çš„ç†è®º

### 7.3 PostgreSQLå®ç°ç›¸å…³

- **[PostgreSQLå®˜æ–¹æ–‡æ¡£ - è§†å›¾](<https://www.postgresql.org/docs/current/sql-createview.html>)**
  - PostgreSQLè§†å›¾å®ç°è¯´æ˜

### 7.4 ç›¸å…³æ–‡æ¡£

- [å…³ç³»ä»£æ•°ä¸å…³ç³»æ¼”ç®—-ç§‘å¾·å®šç†ä¸å¯è¡¨è¾¾æ€§](./08.02-å…³ç³»ä»£æ•°ä¸å…³ç³»æ¼”ç®—-ç§‘å¾·å®šç†ä¸å¯è¡¨è¾¾æ€§.md)
- [ç†è®ºåŸºç¡€å¯¼èˆª](../README.md)

---

**æœ€åæ›´æ–°**: 2025-01-16
**ç»´æŠ¤è€…**: Documentation Team
**çŠ¶æ€**: ğŸŸ¡ æ¡†æ¶å·²åˆ›å»ºï¼Œå†…å®¹å¾…å®Œå–„
