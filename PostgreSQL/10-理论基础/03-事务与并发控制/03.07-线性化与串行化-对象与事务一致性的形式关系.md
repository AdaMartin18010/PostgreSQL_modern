# çº¿æ€§åŒ–ä¸ä¸²è¡ŒåŒ–-å¯¹è±¡ä¸äº‹åŠ¡ä¸€è‡´æ€§çš„å½¢å¼å…³ç³»

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **æœ€åæ›´æ–°**: 2025-01-16
> **ç‰ˆæœ¬è¦†ç›–**: PostgreSQL 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x (å…¼å®¹)
> **æ–‡æ¡£çŠ¶æ€**: ğŸŸ¡ æ¡†æ¶å·²åˆ›å»ºï¼Œå†…å®¹å¾…å®Œå–„

---

## ğŸ“‹ ç›®å½•

- [çº¿æ€§åŒ–ä¸ä¸²è¡ŒåŒ–-å¯¹è±¡ä¸äº‹åŠ¡ä¸€è‡´æ€§çš„å½¢å¼å…³ç³»](#çº¿æ€§åŒ–ä¸ä¸²è¡ŒåŒ–-å¯¹è±¡ä¸äº‹åŠ¡ä¸€è‡´æ€§çš„å½¢å¼å…³ç³»)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.0 çº¿æ€§åŒ–ä¸ä¸²è¡ŒåŒ–å·¥ä½œåŸç†æ¦‚è¿°](#10-çº¿æ€§åŒ–ä¸ä¸²è¡ŒåŒ–å·¥ä½œåŸç†æ¦‚è¿°)
    - [1.1 æœ¬æ–‡æ¡£çš„èŒƒå›´](#11-æœ¬æ–‡æ¡£çš„èŒƒå›´)
  - [2. æ ¸å¿ƒå†…å®¹](#2-æ ¸å¿ƒå†…å®¹)
    - [2.1 çº¿æ€§åŒ–](#21-çº¿æ€§åŒ–)
    - [2.2 ä¸²è¡ŒåŒ–](#22-ä¸²è¡ŒåŒ–)
    - [2.3 å½¢å¼å…³ç³»](#23-å½¢å¼å…³ç³»)
  - [3. å½¢å¼åŒ–å®šä¹‰](#3-å½¢å¼åŒ–å®šä¹‰)
    - [3.1 çº¿æ€§åŒ–å½¢å¼åŒ–](#31-çº¿æ€§åŒ–å½¢å¼åŒ–)
    - [3.2 ä¸²è¡ŒåŒ–å½¢å¼åŒ–](#32-ä¸²è¡ŒåŒ–å½¢å¼åŒ–)
    - [3.3 å…³ç³»å½¢å¼åŒ–](#33-å…³ç³»å½¢å¼åŒ–)
  - [4. å®šç†ä¸è¯æ˜](#4-å®šç†ä¸è¯æ˜)
    - [4.1 çº¿æ€§åŒ–è•´å«ä¸²è¡ŒåŒ–å®šç†](#41-çº¿æ€§åŒ–è•´å«ä¸²è¡ŒåŒ–å®šç†)
    - [4.2 ä¸²è¡ŒåŒ–ä¸è•´å«çº¿æ€§åŒ–å®šç†](#42-ä¸²è¡ŒåŒ–ä¸è•´å«çº¿æ€§åŒ–å®šç†)
  - [5. å®é™…åº”ç”¨](#5-å®é™…åº”ç”¨)
    - [5.1 PostgreSQLäº‹åŠ¡éš”ç¦»](#51-postgresqläº‹åŠ¡éš”ç¦»)
    - [5.2 å¹¶å‘æ•°æ®ç»“æ„](#52-å¹¶å‘æ•°æ®ç»“æ„)
    - [5.3 åˆ†å¸ƒå¼ç³»ç»Ÿ](#53-åˆ†å¸ƒå¼ç³»ç»Ÿ)
  - [6. ç›¸å…³æ–‡æ¡£](#6-ç›¸å…³æ–‡æ¡£)
    - [6.1 ç†è®ºåŸºç¡€æ–‡æ¡£](#61-ç†è®ºåŸºç¡€æ–‡æ¡£)
  - [7. å‚è€ƒæ–‡çŒ®](#7-å‚è€ƒæ–‡çŒ®)
    - [7.1 æ ¸å¿ƒç†è®ºæ–‡çŒ®](#71-æ ¸å¿ƒç†è®ºæ–‡çŒ®)
    - [7.2 ä¸€è‡´æ€§æ¨¡å‹ç›¸å…³](#72-ä¸€è‡´æ€§æ¨¡å‹ç›¸å…³)
    - [7.3 PostgreSQLå®ç°ç›¸å…³](#73-postgresqlå®ç°ç›¸å…³)
    - [7.4 ç›¸å…³æ–‡æ¡£](#74-ç›¸å…³æ–‡æ¡£)

---

## 1. æ¦‚è¿°

### 1.0 çº¿æ€§åŒ–ä¸ä¸²è¡ŒåŒ–å·¥ä½œåŸç†æ¦‚è¿°

**ä¸€è‡´æ€§æ¨¡å‹**ï¼š

çº¿æ€§åŒ–ï¼ˆLinearizabilityï¼‰å’Œä¸²è¡ŒåŒ–ï¼ˆSerializabilityï¼‰æ˜¯ä¸¤ç§é‡è¦çš„å¹¶å‘ä¸€è‡´æ€§æ¨¡å‹ã€‚çº¿æ€§åŒ–é€‚ç”¨äºå•ä¸ªå¯¹è±¡çš„æ“ä½œï¼Œä¸²è¡ŒåŒ–é€‚ç”¨äºäº‹åŠ¡çš„å¤šä¸ªæ“ä½œã€‚æœ¬æ–‡æ¡£å½¢å¼åŒ–åˆ†æä¸¤è€…çš„å…³ç³»ã€‚

**ä¸€è‡´æ€§æ¨¡å‹ä½“ç³»æ€ç»´å¯¼å›¾**ï¼š

```mermaid
mindmap
  root((ä¸€è‡´æ€§æ¨¡å‹))
    çº¿æ€§åŒ–
      å•å¯¹è±¡ä¸€è‡´æ€§
      å®æ—¶æ€§è¦æ±‚
      å¯ç»„åˆæ€§
    ä¸²è¡ŒåŒ–
      å¤šå¯¹è±¡ä¸€è‡´æ€§
      äº‹åŠ¡éš”ç¦»
      å¯ä¸²è¡ŒåŒ–è°ƒåº¦
    å…³ç³»
      çº¿æ€§åŒ– âŸ¹ ä¸²è¡ŒåŒ–
      ä¸²è¡ŒåŒ– âŸ¹ çº¿æ€§åŒ–
      ç­‰ä»·æ¡ä»¶
    åº”ç”¨åœºæ™¯
      åˆ†å¸ƒå¼ç³»ç»Ÿ
      æ•°æ®åº“äº‹åŠ¡
      å¹¶å‘æ•°æ®ç»“æ„
```

**ä¸€è‡´æ€§æ¨¡å‹é€‰æ‹©å†³ç­–æ ‘**ï¼š

```mermaid
flowchart TD
    A[å¹¶å‘æ“ä½œ] --> B{æ“ä½œèŒƒå›´}
    B -->|å•å¯¹è±¡| C[çº¿æ€§åŒ–]
    B -->|å¤šå¯¹è±¡| D{éœ€è¦äº‹åŠ¡?}
    D -->|æ˜¯| E[ä¸²è¡ŒåŒ–]
    D -->|å¦| F[é¡ºåºä¸€è‡´æ€§]
    C --> G[ä¿è¯å®æ—¶æ€§]
    E --> H[ä¿è¯éš”ç¦»æ€§]
    F --> I[ä¿è¯é¡ºåºæ€§]

    style A fill:#FFD700
    style G fill:#90EE90
    style H fill:#90EE90
    style I fill:#87CEEB
```

**ä¸€è‡´æ€§æ¨¡å‹å¯¹æ¯”çŸ©é˜µ**ï¼š

| æ¨¡å‹ | èŒƒå›´ | å®æ—¶æ€§ | å¯ç»„åˆæ€§ | å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ |
|------|------|--------|---------|--------|---------|
| **çº¿æ€§åŒ–** | å•å¯¹è±¡ | æ˜¯ | æ˜¯ | é«˜ | å¯„å­˜å™¨ã€é˜Ÿåˆ— |
| **ä¸²è¡ŒåŒ–** | å¤šå¯¹è±¡ | å¦ | å¦ | ä¸­ | æ•°æ®åº“äº‹åŠ¡ |
| **é¡ºåºä¸€è‡´æ€§** | å¤šå¯¹è±¡ | å¦ | æ˜¯ | ä¸­ | å…±äº«å†…å­˜ |
| **å› æœä¸€è‡´æ€§** | å¤šå¯¹è±¡ | å¦ | æ˜¯ | ä½ | åˆ†å¸ƒå¼ç³»ç»Ÿ |

### 1.1 æœ¬æ–‡æ¡£çš„èŒƒå›´

æœ¬æ–‡æ¡£æ¶µç›–ï¼š

- **çº¿æ€§åŒ–**ï¼šå•å¯¹è±¡æ“ä½œçš„ä¸€è‡´æ€§æ¨¡å‹
- **ä¸²è¡ŒåŒ–**ï¼šå¤šå¯¹è±¡äº‹åŠ¡çš„ä¸€è‡´æ€§æ¨¡å‹
- **å½¢å¼å…³ç³»**ï¼šçº¿æ€§åŒ–ä¸ä¸²è¡ŒåŒ–çš„å½¢å¼åŒ–å…³ç³»
- **å®é™…åº”ç”¨**ï¼šPostgreSQLäº‹åŠ¡éš”ç¦»çº§åˆ«çš„å®ç°

---

## 2. æ ¸å¿ƒå†…å®¹

### 2.1 çº¿æ€§åŒ–

**çº¿æ€§åŒ–å®šä¹‰**ï¼š

```haskell
-- æ“ä½œå†å²
data Operation = Operation {
    opType :: OpType,  -- Read or Write
    object :: Object,
    value :: Value,
    startTime :: Time,
    endTime :: Time
}

-- çº¿æ€§åŒ–ç‚¹
linearizationPoint :: Operation -> Time
linearizationPoint op =
    case op.opType of
        Read -> op.endTime
        Write -> op.startTime

-- çº¿æ€§åŒ–åˆ¤å®š
linearizable :: [Operation] -> Bool
linearizable ops =
    exists totalOrder < such that:
      forall op1, op2:
        if op1.endTime < op2.startTime then op1 < op2
      and
      forall op: result(op) = result of sequential execution at linearizationPoint(op)
```

**çº¿æ€§åŒ–æ‰§è¡Œæµç¨‹**ï¼š

```mermaid
graph TD
    A[å¹¶å‘æ“ä½œå†å²] --> B[ç¡®å®šçº¿æ€§åŒ–ç‚¹]
    B --> C[æ„å»ºå…¨åºå…³ç³»]
    C --> D{æ»¡è¶³å®æ—¶æ€§?}
    D -->|æ˜¯| E{æ»¡è¶³é¡ºåºè¯­ä¹‰?}
    D -->|å¦| F[ä¸çº¿æ€§åŒ–]
    E -->|æ˜¯| G[çº¿æ€§åŒ–]
    E -->|å¦| F

    style A fill:#FFD700
    style G fill:#90EE90
    style F fill:#FF6B6B
```

### 2.2 ä¸²è¡ŒåŒ–

**ä¸²è¡ŒåŒ–å®šä¹‰**ï¼š

```haskell
-- äº‹åŠ¡
data Transaction = Transaction {
    operations :: [Operation],
    commitTime :: Time
}

-- ä¸²è¡ŒåŒ–è°ƒåº¦
serializable :: [Transaction] -> Bool
serializable txs =
    exists serialSchedule such that:
      forall tx: result(tx) = result of tx in serialSchedule
      and
      conflictOrder is preserved
```

**ä¸²è¡ŒåŒ–åˆ¤å®šæµç¨‹**ï¼š

```mermaid
graph TD
    A[äº‹åŠ¡è°ƒåº¦] --> B[æ„å»ºå†²çªå›¾]
    B --> C{å†²çªå›¾æ— ç¯?}
    C -->|æ˜¯| D[å¯ä¸²è¡ŒåŒ–]
    C -->|å¦| E[ä¸å¯ä¸²è¡ŒåŒ–]
    D --> F[å­˜åœ¨ä¸²è¡Œç­‰ä»·è°ƒåº¦]

    style A fill:#FFD700
    style D fill:#90EE90
    style E fill:#FF6B6B
```

### 2.3 å½¢å¼å…³ç³»

**çº¿æ€§åŒ–ä¸ä¸²è¡ŒåŒ–çš„å…³ç³»**ï¼š

```haskell
-- å®šç†ï¼šçº¿æ€§åŒ– âŸ¹ ä¸²è¡ŒåŒ–
linearizableImpliesSerializable :: [Operation] -> Bool
linearizableImpliesSerializable ops =
    if linearizable(ops) then
        -- çº¿æ€§åŒ–ä¿è¯æ¯ä¸ªå¯¹è±¡ä¸Šçš„æ“ä½œé¡ºåºä¸€è‡´
        -- å› æ­¤æ•´ä¸ªäº‹åŠ¡è°ƒåº¦å¯ä¸²è¡ŒåŒ–
        serializable(groupByTransaction(ops))
    else
        False
```

---

## 3. å½¢å¼åŒ–å®šä¹‰

### 3.1 çº¿æ€§åŒ–å½¢å¼åŒ–

**çº¿æ€§åŒ–**ï¼š

```haskell
-- çº¿æ€§åŒ–å†å²
H is linearizable iff
    exists sequential history S such that:
      S is equivalent to H
      and
      forall op1, op2: if op1 completes before op2 starts then op1 <_S op2
```

### 3.2 ä¸²è¡ŒåŒ–å½¢å¼åŒ–

**ä¸²è¡ŒåŒ–**ï¼š

```haskell
-- ä¸²è¡ŒåŒ–è°ƒåº¦
Schedule S is serializable iff
    exists serial schedule S' such that:
      S â‰¡_conflict S'
```

### 3.3 å…³ç³»å½¢å¼åŒ–

**çº¿æ€§åŒ– âŸ¹ ä¸²è¡ŒåŒ–**ï¼š

```haskell
-- å¦‚æœæ‰€æœ‰å¯¹è±¡çš„æ“ä½œéƒ½çº¿æ€§åŒ–ï¼Œåˆ™äº‹åŠ¡è°ƒåº¦å¯ä¸²è¡ŒåŒ–
if forall obj: linearizable(operations(obj)) then
    serializable(transactions)
```

---

## 4. å®šç†ä¸è¯æ˜

### 4.1 çº¿æ€§åŒ–è•´å«ä¸²è¡ŒåŒ–å®šç†

**å®šç†**ï¼šå¦‚æœæ‰€æœ‰å¯¹è±¡çš„æ“ä½œéƒ½çº¿æ€§åŒ–ï¼Œåˆ™äº‹åŠ¡è°ƒåº¦å¯ä¸²è¡ŒåŒ–ã€‚

**è¯æ˜æ ‘**ï¼š

```mermaid
graph TD
    A[çº¿æ€§åŒ– âŸ¹ ä¸²è¡ŒåŒ–] --> B[æ¯ä¸ªå¯¹è±¡çº¿æ€§åŒ–]
    B --> C[å­˜åœ¨å…¨å±€å…¨åº]
    C --> D[å…¨åºå®šä¹‰ä¸²è¡Œè°ƒåº¦]
    D --> E[ä¸²è¡Œè°ƒåº¦ç­‰ä»·åŸè°ƒåº¦]
    E --> F[å¯ä¸²è¡ŒåŒ–]

    style A fill:#FFD700
    style F fill:#90EE90
```

**è¯æ˜**ï¼š

1. å¦‚æœæ‰€æœ‰å¯¹è±¡çš„æ“ä½œéƒ½çº¿æ€§åŒ–ï¼Œåˆ™å­˜åœ¨å…¨å±€å…¨åºå…³ç³»
2. å…¨åºå…³ç³»å®šä¹‰äº†ä¸²è¡Œè°ƒåº¦
3. ä¸²è¡Œè°ƒåº¦ä¸åŸè°ƒåº¦å†²çªç­‰ä»·
4. å› æ­¤è°ƒåº¦å¯ä¸²è¡ŒåŒ–

### 4.2 ä¸²è¡ŒåŒ–ä¸è•´å«çº¿æ€§åŒ–å®šç†

**å®šç†**ï¼šä¸²è¡ŒåŒ–ä¸è•´å«çº¿æ€§åŒ–ã€‚

**è¯æ˜**ï¼š

1. ä¸²è¡ŒåŒ–åªè¦æ±‚å†²çªç­‰ä»·ï¼Œä¸è¦æ±‚å®æ—¶æ€§
2. çº¿æ€§åŒ–è¦æ±‚å®æ—¶æ€§ï¼ˆæ“ä½œå®Œæˆçš„é¡ºåºï¼‰
3. å› æ­¤ä¸²è¡ŒåŒ–è°ƒåº¦å¯èƒ½ä¸æ»¡è¶³çº¿æ€§åŒ–

---

## 5. å®é™…åº”ç”¨

### 5.1 PostgreSQLäº‹åŠ¡éš”ç¦»

**éš”ç¦»çº§åˆ«ä¸ä¸€è‡´æ€§**ï¼š

```sql
-- READ COMMITTEDï¼ˆä¸ä¿è¯ä¸²è¡ŒåŒ–ï¼‰
SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
BEGIN;
SELECT * FROM accounts WHERE id = 1;  -- å¯èƒ½çœ‹åˆ°ä¸­é—´çŠ¶æ€
COMMIT;

-- SERIALIZABLEï¼ˆä¿è¯ä¸²è¡ŒåŒ–ï¼‰
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
BEGIN;
SELECT * FROM accounts WHERE id = 1;  -- ä¿è¯ä¸²è¡ŒåŒ–è§†å›¾
COMMIT;
```

### 5.2 å¹¶å‘æ•°æ®ç»“æ„

**çº¿æ€§åŒ–å®ç°**ï¼š

```haskell
-- çº¿æ€§åŒ–å¯„å­˜å™¨
data LinearizableRegister a = LinearizableRegister {
    value :: IORef a,
    lock :: MVar ()
}

-- çº¿æ€§åŒ–å†™æ“ä½œ
write :: LinearizableRegister a -> a -> IO ()
write reg newVal =
    withMVar reg.lock $ \_ -> do
        writeIORef reg.value newVal
        -- çº¿æ€§åŒ–ç‚¹åœ¨é”è·å–æ—¶
```

### 5.3 åˆ†å¸ƒå¼ç³»ç»Ÿ

**çº¿æ€§åŒ–ä¸å…±è¯†**ï¼š

```haskell
-- å…±è¯†ç®—æ³•ä¿è¯çº¿æ€§åŒ–
consensus :: [Node] -> Value -> IO Value
consensus nodes value =
    -- ä½¿ç”¨Raftæˆ–Paxosä¿è¯çº¿æ€§åŒ–
    let leader = electLeader(nodes)
    in replicateValue(leader, value, nodes)
```

---

## 6. ç›¸å…³æ–‡æ¡£

### 6.1 ç†è®ºåŸºç¡€æ–‡æ¡£

- [äº‹åŠ¡éš”ç¦»ä¸MVCC-ç»Ÿä¸€å½¢å¼æ¨¡å‹ä¸å®Œå¤‡æ€§è¯æ˜](./03.03-äº‹åŠ¡éš”ç¦»ä¸MVCC-ç»Ÿä¸€å½¢å¼æ¨¡å‹ä¸å®Œå¤‡æ€§è¯æ˜.md)
- [è°ƒåº¦ç­‰ä»·-å†²çªä¸è§†å›¾ç­‰ä»·çš„å……è¦å…³ç³»](./03.05-è°ƒåº¦ç­‰ä»·-å†²çªä¸è§†å›¾ç­‰ä»·çš„å……è¦å…³ç³».md)
- [ç†è®ºåŸºç¡€å¯¼èˆª](../README.md)

---

## 7. å‚è€ƒæ–‡çŒ®

### 7.1 æ ¸å¿ƒç†è®ºæ–‡çŒ®

- **Herlihy, M. P., & Wing, J. M. (1990). "Linearizability: A Correctness Condition for Concurrent Objects."**
  - æœŸåˆŠ: ACM Transactions on Programming Languages and Systems 1990
  - **é‡è¦æ€§**: çº¿æ€§åŒ–çš„ç»å…¸å®šä¹‰
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†çº¿æ€§åŒ–çš„å½¢å¼åŒ–å®šä¹‰
  - **æ‰¹åˆ¤æ€§åˆ†æ**: çº¿æ€§åŒ–è¦æ±‚å®æ—¶æ€§ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹å¯èƒ½è¿‡äºä¸¥æ ¼ï¼Œå¯¼è‡´æ€§èƒ½é—®é¢˜

- **Papadimitriou, C. H. (1979). "The Serializability of Concurrent Database Updates."**
  - æœŸåˆŠ: Journal of the ACM 1979
  - **é‡è¦æ€§**: ä¸²è¡ŒåŒ–çš„ç»å…¸ç†è®º
  - **æ ¸å¿ƒè´¡çŒ®**: æä¾›äº†ä¸²è¡ŒåŒ–çš„åˆ¤å®šæ–¹æ³•
  - **æ‰¹åˆ¤æ€§åˆ†æ**: ä¸²è¡ŒåŒ–åˆ¤å®šæ˜¯NPå®Œå…¨çš„ï¼Œå®é™…ç³»ç»Ÿä¸­éœ€è¦å¯å‘å¼æ–¹æ³•

### 7.2 ä¸€è‡´æ€§æ¨¡å‹ç›¸å…³

- **Lamport, L. (1979). "How to Make a Multiprocessor Computer That Correctly Executes Multiprocess Programs."**
  - æœŸåˆŠ: IEEE Transactions on Computers 1979
  - **é‡è¦æ€§**: é¡ºåºä¸€è‡´æ€§çš„ç»å…¸å®šä¹‰
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†é¡ºåºä¸€è‡´æ€§æ¨¡å‹
  - **æ‰¹åˆ¤æ€§åˆ†æ**: é¡ºåºä¸€è‡´æ€§æ¯”çº¿æ€§åŒ–å¼±ï¼Œä½†å®ç°æ›´ç®€å•

### 7.3 PostgreSQLå®ç°ç›¸å…³

- **[PostgreSQLå®˜æ–¹æ–‡æ¡£ - äº‹åŠ¡éš”ç¦»](<https://www.postgresql.org/docs/current/transaction-iso.html>)**
  - PostgreSQLäº‹åŠ¡éš”ç¦»çº§åˆ«å®ç°è¯´æ˜

### 7.4 ç›¸å…³æ–‡æ¡£

- [äº‹åŠ¡éš”ç¦»ä¸MVCC-ç»Ÿä¸€å½¢å¼æ¨¡å‹ä¸å®Œå¤‡æ€§è¯æ˜](./03.03-äº‹åŠ¡éš”ç¦»ä¸MVCC-ç»Ÿä¸€å½¢å¼æ¨¡å‹ä¸å®Œå¤‡æ€§è¯æ˜.md)
- [è°ƒåº¦ç­‰ä»·-å†²çªä¸è§†å›¾ç­‰ä»·çš„å……è¦å…³ç³»](./03.05-è°ƒåº¦ç­‰ä»·-å†²çªä¸è§†å›¾ç­‰ä»·çš„å……è¦å…³ç³».md)
- [ç†è®ºåŸºç¡€å¯¼èˆª](../README.md)

---

**æœ€åæ›´æ–°**: 2025-01-16
**ç»´æŠ¤è€…**: Documentation Team
**çŠ¶æ€**: ğŸŸ¡ æ¡†æ¶å·²åˆ›å»ºï¼Œå†…å®¹å¾…å®Œå–„
