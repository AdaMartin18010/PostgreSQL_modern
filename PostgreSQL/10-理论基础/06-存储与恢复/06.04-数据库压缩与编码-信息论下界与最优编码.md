# æ•°æ®åº“å‹ç¼©ä¸ç¼–ç -ä¿¡æ¯è®ºä¸‹ç•Œä¸æœ€ä¼˜ç¼–ç 

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **æœ€åæ›´æ–°**: 2025-01-16
> **ç‰ˆæœ¬è¦†ç›–**: PostgreSQL 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x (å…¼å®¹)
> **æ–‡æ¡£çŠ¶æ€**: ğŸŸ¡ æ¡†æ¶å·²åˆ›å»ºï¼Œå†…å®¹å¾…å®Œå–„

---

## ğŸ“‹ ç›®å½•

- [æ•°æ®åº“å‹ç¼©ä¸ç¼–ç -ä¿¡æ¯è®ºä¸‹ç•Œä¸æœ€ä¼˜ç¼–ç ](#æ•°æ®åº“å‹ç¼©ä¸ç¼–ç -ä¿¡æ¯è®ºä¸‹ç•Œä¸æœ€ä¼˜ç¼–ç )
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.0 æ•°æ®åº“å‹ç¼©ä¸ç¼–ç å·¥ä½œåŸç†æ¦‚è¿°](#10-æ•°æ®åº“å‹ç¼©ä¸ç¼–ç å·¥ä½œåŸç†æ¦‚è¿°)
    - [1.1 æœ¬æ–‡æ¡£çš„èŒƒå›´](#11-æœ¬æ–‡æ¡£çš„èŒƒå›´)
  - [2. æ ¸å¿ƒå†…å®¹](#2-æ ¸å¿ƒå†…å®¹)
    - [2.1 ä¿¡æ¯è®ºåŸºç¡€](#21-ä¿¡æ¯è®ºåŸºç¡€)
    - [2.2 æœ€ä¼˜ç¼–ç ç®—æ³•](#22-æœ€ä¼˜ç¼–ç ç®—æ³•)
    - [2.3 æ•°æ®åº“å‹ç¼©](#23-æ•°æ®åº“å‹ç¼©)
  - [3. å½¢å¼åŒ–å®šä¹‰](#3-å½¢å¼åŒ–å®šä¹‰)
    - [3.1 ä¿¡æ¯è®ºå½¢å¼åŒ–](#31-ä¿¡æ¯è®ºå½¢å¼åŒ–)
    - [3.2 ç¼–ç å½¢å¼åŒ–](#32-ç¼–ç å½¢å¼åŒ–)
    - [3.3 æœ€ä¼˜æ€§å½¢å¼åŒ–](#33-æœ€ä¼˜æ€§å½¢å¼åŒ–)
  - [4. å®é™…åº”ç”¨](#4-å®é™…åº”ç”¨)
    - [4.1 PostgreSQLå‹ç¼©](#41-postgresqlå‹ç¼©)
    - [4.2 å‹ç¼©ä¼˜åŒ–](#42-å‹ç¼©ä¼˜åŒ–)
  - [5. ç›¸å…³æ–‡æ¡£](#5-ç›¸å…³æ–‡æ¡£)
    - [5.1 ç†è®ºåŸºç¡€æ–‡æ¡£](#51-ç†è®ºåŸºç¡€æ–‡æ¡£)
  - [6. å‚è€ƒæ–‡çŒ®](#6-å‚è€ƒæ–‡çŒ®)
    - [6.1 æ ¸å¿ƒç†è®ºæ–‡çŒ®](#61-æ ¸å¿ƒç†è®ºæ–‡çŒ®)
    - [6.2 å‹ç¼©ç®—æ³•ç›¸å…³](#62-å‹ç¼©ç®—æ³•ç›¸å…³)
    - [6.3 PostgreSQLå®ç°ç›¸å…³](#63-postgresqlå®ç°ç›¸å…³)
    - [6.4 ç›¸å…³æ–‡æ¡£](#64-ç›¸å…³æ–‡æ¡£)

---

## 1. æ¦‚è¿°

### 1.0 æ•°æ®åº“å‹ç¼©ä¸ç¼–ç å·¥ä½œåŸç†æ¦‚è¿°

**æ•°æ®å‹ç¼©**ï¼š

æ•°æ®å‹ç¼©é€šè¿‡æ¶ˆé™¤å†—ä½™æ¥å‡å°‘å­˜å‚¨ç©ºé—´ã€‚ä¿¡æ¯è®ºæä¾›äº†å‹ç¼©çš„ç†è®ºä¸‹ç•Œï¼ˆé¦™å†œç†µï¼‰ï¼Œæœ€ä¼˜ç¼–ç ç®—æ³•ï¼ˆå¦‚Huffmanç¼–ç ã€LZ77ï¼‰æ¥è¿‘è¿™ä¸ªä¸‹ç•Œã€‚

**å‹ç¼©ç®—æ³•æ€ç»´å¯¼å›¾**ï¼š

```mermaid
mindmap
  root((æ•°æ®å‹ç¼©))
    ä¿¡æ¯è®ºåŸºç¡€
      é¦™å†œç†µ
      ä¿¡æ¯è®ºä¸‹ç•Œ
      ç¼–ç å®šç†
    å‹ç¼©ç®—æ³•
      æ— æŸå‹ç¼©
        Huffmanç¼–ç 
        LZ77/LZ78
        å­—å…¸å‹ç¼©
      æœ‰æŸå‹ç¼©
        é‡åŒ–
        å˜æ¢ç¼–ç 
    æ•°æ®åº“åº”ç”¨
      åˆ—å‹ç¼©
      é¡µå‹ç¼©
      ç´¢å¼•å‹ç¼©
```

**å‹ç¼©å·¥ä½œæµç¨‹**ï¼š

```mermaid
flowchart TD
    A[åŸå§‹æ•°æ®] --> B[åˆ†ææ•°æ®åˆ†å¸ƒ]
    B --> C[è®¡ç®—ç†µ]
    C --> D[é€‰æ‹©ç¼–ç ç®—æ³•]
    D --> E[æ„å»ºç¼–ç è¡¨]
    E --> F[å‹ç¼©æ•°æ®]
    F --> G[å‹ç¼©åæ•°æ®]

    style A fill:#FFD700
    style G fill:#90EE90
```

### 1.1 æœ¬æ–‡æ¡£çš„èŒƒå›´

æœ¬æ–‡æ¡£æ¶µç›–ï¼š

- **ä¿¡æ¯è®ºåŸºç¡€**ï¼šé¦™å†œç†µå’Œä¿¡æ¯è®ºä¸‹ç•Œ
- **æœ€ä¼˜ç¼–ç **ï¼šHuffmanç¼–ç ã€ç®—æœ¯ç¼–ç ç­‰
- **æ•°æ®åº“å‹ç¼©**ï¼šåˆ—å‹ç¼©ã€é¡µå‹ç¼©ç­‰åº”ç”¨
- **å®é™…åº”ç”¨**ï¼šPostgreSQLå‹ç¼©å®ç°

---

## 2. æ ¸å¿ƒå†…å®¹

### 2.1 ä¿¡æ¯è®ºåŸºç¡€

**é¦™å†œç†µ**ï¼š

```haskell
-- é¦™å†œç†µ
entropy :: [Symbol] -> Double
entropy symbols =
    let frequencies = countFrequencies(symbols)
        probabilities = map (\f -> f / total) frequencies
    in -sum [p * log2 p | p <- probabilities]

-- ä¿¡æ¯è®ºä¸‹ç•Œ
compressionLowerBound :: [Symbol] -> Double
compressionLowerBound symbols =
    entropy symbols  -- å¹³å‡ç é•¿ä¸èƒ½ä½äºç†µ
```

**ç¼–ç æ•ˆç‡**ï¼š

```haskell
-- ç¼–ç æ•ˆç‡
efficiency :: Encoding -> [Symbol] -> Double
efficiency encoding symbols =
    entropy(symbols) / averageCodeLength(encoding, symbols)
```

### 2.2 æœ€ä¼˜ç¼–ç ç®—æ³•

**Huffmanç¼–ç **ï¼š

```haskell
-- Huffmanæ ‘
data HuffmanTree =
    Leaf Symbol Frequency
  | Node HuffmanTree HuffmanTree Frequency

-- æ„å»ºHuffmanæ ‘
buildHuffmanTree :: [(Symbol, Frequency)] -> HuffmanTree
buildHuffmanTree symbols =
    let forest = map (uncurry Leaf) symbols
    in buildTree(forest)
    where
        buildTree [tree] = tree
        buildTree trees =
            let (t1, t2) = extractTwoSmallest(trees)
                newTree = Node t1 t2 (frequency t1 + frequency t2)
            in buildTree(insert newTree (remove [t1, t2] trees))
```

**å‹ç¼©ç®—æ³•å¯¹æ¯”**ï¼š

| ç®—æ³• | ç±»å‹ | å‹ç¼©æ¯” | é€Ÿåº¦ | é€‚ç”¨åœºæ™¯ |
|------|------|--------|------|---------|
| **Huffman** | æ— æŸ | ä¸­ | å¿« | æ–‡æœ¬æ•°æ® |
| **LZ77** | æ— æŸ | é«˜ | ä¸­ | é€šç”¨æ•°æ® |
| **ç®—æœ¯ç¼–ç ** | æ— æŸ | é«˜ | æ…¢ | é«˜å‹ç¼©æ¯”éœ€æ±‚ |
| **å­—å…¸å‹ç¼©** | æ— æŸ | ä¸­ | å¿« | é‡å¤æ•°æ® |

### 2.3 æ•°æ®åº“å‹ç¼©

**åˆ—å‹ç¼©**ï¼š

```haskell
-- åˆ—å‹ç¼©
compressColumn :: Column -> CompressedColumn
compressColumn column =
    let encoding = buildOptimalEncoding(column.values)
        compressed = map (encode encoding) column.values
    in CompressedColumn {
        encoding = encoding,
        data = compressed
    }
```

---

## 3. å½¢å¼åŒ–å®šä¹‰

### 3.1 ä¿¡æ¯è®ºå½¢å¼åŒ–

**é¦™å†œç†µ**ï¼š

```haskell
-- é¦™å†œç†µå½¢å¼åŒ–
H(X) = -Î£ P(x) * log2(P(x))
where
    X = random variable
    P(x) = probability of x
```

### 3.2 ç¼–ç å½¢å¼åŒ–

**ç¼–ç **ï¼š

```haskell
-- ç¼–ç å½¢å¼åŒ–
Encoding = (S, C, f)
where
    S = symbol set
    C = code set
    f: S â†’ C = encoding function
```

### 3.3 æœ€ä¼˜æ€§å½¢å¼åŒ–

**æœ€ä¼˜ç¼–ç **ï¼š

```haskell
-- æœ€ä¼˜ç¼–ç 
optimal(encoding) =
    forall symbol s:
        codeLength(encoding, s) = -log2(P(s))
        and
        averageCodeLength(encoding) = H(X)
```

---

## 4. å®é™…åº”ç”¨

### 4.1 PostgreSQLå‹ç¼©

**PostgreSQL TOASTå‹ç¼©**ï¼š

```sql
-- æŸ¥çœ‹TOASTå‹ç¼©
SELECT
    schemaname,
    tablename,
    attname,
    attstorage  -- 'x' = extended (compressed)
FROM pg_attribute
WHERE attstorage = 'x';

-- æŸ¥çœ‹å‹ç¼©ç»Ÿè®¡
SELECT
    schemaname,
    relname,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||relname)) AS total_size,
    pg_size_pretty(pg_relation_size(schemaname||'.'||relname)) AS table_size,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||relname) -
                   pg_relation_size(schemaname||'.'||relname)) AS toast_size
FROM pg_stat_user_tables;
```

**åˆ—å‹ç¼©**ï¼š

```sql
-- ä½¿ç”¨å‹ç¼©è¡¨
CREATE TABLE compressed_table (
    id INTEGER,
    data TEXT
) WITH (compression = 'pglz');

-- æŸ¥çœ‹å‹ç¼©æ•ˆæœ
SELECT
    pg_size_pretty(pg_total_relation_size('compressed_table')) AS compressed_size;
```

### 4.2 å‹ç¼©ä¼˜åŒ–

**å‹ç¼©ç­–ç•¥é€‰æ‹©**ï¼š

```sql
-- é€‰æ‹©å‹ç¼©ç®—æ³•
ALTER TABLE my_table SET (compression = 'lz4');  -- å¿«é€Ÿå‹ç¼©
-- æˆ–
ALTER TABLE my_table SET (compression = 'pglz');  -- é«˜å‹ç¼©æ¯”

-- æŸ¥çœ‹å‹ç¼©ç»Ÿè®¡
SELECT
    schemaname,
    relname,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||relname)) AS size
FROM pg_stat_user_tables
ORDER BY pg_total_relation_size(schemaname||'.'||relname) DESC;
```

---

## 5. ç›¸å…³æ–‡æ¡£

### 5.1 ç†è®ºåŸºç¡€æ–‡æ¡£

- [ç†è®ºåŸºç¡€å¯¼èˆª](../README.md)

---

## 6. å‚è€ƒæ–‡çŒ®

### 6.1 æ ¸å¿ƒç†è®ºæ–‡çŒ®

- **Shannon, C. E. (1948). "A Mathematical Theory of Communication."**
  - æœŸåˆŠ: Bell System Technical Journal 1948
  - **é‡è¦æ€§**: ä¿¡æ¯è®ºçš„å¥ åŸºæ€§è®ºæ–‡
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†é¦™å†œç†µå’Œç¼–ç å®šç†
  - **æ‰¹åˆ¤æ€§åˆ†æ**: ç†è®ºå®Œç¾ï¼Œä½†å®é™…å‹ç¼©ç®—æ³•éœ€è¦è€ƒè™‘è®¡ç®—å¤æ‚åº¦

- **Huffman, D. A. (1952). "A Method for the Construction of Minimum-Redundancy Codes."**
  - æœŸåˆŠ: Proceedings of the IRE 1952
  - **é‡è¦æ€§**: Huffmanç¼–ç çš„ç»å…¸è®ºæ–‡
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†æœ€ä¼˜å‰ç¼€ç¼–ç ç®—æ³•

### 6.2 å‹ç¼©ç®—æ³•ç›¸å…³

- **Ziv, J., & Lempel, A. (1977). "A Universal Algorithm for Sequential Data Compression."**
  - æœŸåˆŠ: IEEE Transactions on Information Theory 1977
  - **é‡è¦æ€§**: LZ77ç®—æ³•çš„ç»å…¸è®ºæ–‡
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†å­—å…¸å‹ç¼©ç®—æ³•

### 6.3 PostgreSQLå®ç°ç›¸å…³

- **[PostgreSQLå®˜æ–¹æ–‡æ¡£ - TOAST](<https://www.postgresql.org/docs/current/storage-toast.html>)**
  - PostgreSQL TOASTå‹ç¼©å®ç°è¯´æ˜

### 6.4 ç›¸å…³æ–‡æ¡£

- [ç†è®ºåŸºç¡€å¯¼èˆª](../README.md)

---

**æœ€åæ›´æ–°**: 2025-01-16
**ç»´æŠ¤è€…**: Documentation Team
**çŠ¶æ€**: ğŸŸ¡ æ¡†æ¶å·²åˆ›å»ºï¼Œå†…å®¹å¾…å®Œå–„
