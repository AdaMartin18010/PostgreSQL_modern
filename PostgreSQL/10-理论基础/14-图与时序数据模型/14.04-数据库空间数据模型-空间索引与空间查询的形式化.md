# æ•°æ®åº“ç©ºé—´æ•°æ®æ¨¡å‹-ç©ºé—´ç´¢å¼•ä¸ç©ºé—´æŸ¥è¯¢çš„å½¢å¼åŒ–

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **æœ€åæ›´æ–°**: 2025-01-16
> **ç‰ˆæœ¬è¦†ç›–**: PostgreSQL 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x (å…¼å®¹)
> **æ–‡æ¡£çŠ¶æ€**: ğŸŸ¡ æ¡†æ¶å·²åˆ›å»ºï¼Œå†…å®¹å¾…å®Œå–„

---

## ğŸ“‹ ç›®å½•

- [æ•°æ®åº“ç©ºé—´æ•°æ®æ¨¡å‹-ç©ºé—´ç´¢å¼•ä¸ç©ºé—´æŸ¥è¯¢çš„å½¢å¼åŒ–](#æ•°æ®åº“ç©ºé—´æ•°æ®æ¨¡å‹-ç©ºé—´ç´¢å¼•ä¸ç©ºé—´æŸ¥è¯¢çš„å½¢å¼åŒ–)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.0 ç©ºé—´æ•°æ®æ¨¡å‹å·¥ä½œåŸç†æ¦‚è¿°](#10-ç©ºé—´æ•°æ®æ¨¡å‹å·¥ä½œåŸç†æ¦‚è¿°)
    - [1.1 æœ¬æ–‡æ¡£çš„èŒƒå›´](#11-æœ¬æ–‡æ¡£çš„èŒƒå›´)
  - [2. æ ¸å¿ƒå†…å®¹](#2-æ ¸å¿ƒå†…å®¹)
    - [2.1 ç©ºé—´æ•°æ®æ¨¡å‹](#21-ç©ºé—´æ•°æ®æ¨¡å‹)
    - [2.2 ç©ºé—´ç´¢å¼•](#22-ç©ºé—´ç´¢å¼•)
    - [2.3 ç©ºé—´æŸ¥è¯¢](#23-ç©ºé—´æŸ¥è¯¢)
  - [3. å½¢å¼åŒ–å®šä¹‰](#3-å½¢å¼åŒ–å®šä¹‰)
    - [3.1 ç©ºé—´å¯¹è±¡å½¢å¼åŒ–](#31-ç©ºé—´å¯¹è±¡å½¢å¼åŒ–)
    - [3.2 ç©ºé—´å…³ç³»å½¢å¼åŒ–](#32-ç©ºé—´å…³ç³»å½¢å¼åŒ–)
    - [3.3 ç©ºé—´ç´¢å¼•å½¢å¼åŒ–](#33-ç©ºé—´ç´¢å¼•å½¢å¼åŒ–)
  - [4. å®é™…åº”ç”¨](#4-å®é™…åº”ç”¨)
    - [4.1 PostgreSQL PostGIS](#41-postgresql-postgis)
    - [4.2 ç©ºé—´åˆ†æ](#42-ç©ºé—´åˆ†æ)
  - [5. ç›¸å…³æ–‡æ¡£](#5-ç›¸å…³æ–‡æ¡£)
    - [5.1 ç†è®ºåŸºç¡€æ–‡æ¡£](#51-ç†è®ºåŸºç¡€æ–‡æ¡£)
  - [6. å‚è€ƒæ–‡çŒ®](#6-å‚è€ƒæ–‡çŒ®)
    - [6.1 æ ¸å¿ƒç†è®ºæ–‡çŒ®](#61-æ ¸å¿ƒç†è®ºæ–‡çŒ®)
    - [6.2 ç©ºé—´æŸ¥è¯¢ç›¸å…³](#62-ç©ºé—´æŸ¥è¯¢ç›¸å…³)
    - [6.3 PostgreSQLå®ç°ç›¸å…³](#63-postgresqlå®ç°ç›¸å…³)
    - [6.4 ç›¸å…³æ–‡æ¡£](#64-ç›¸å…³æ–‡æ¡£)

---

## 1. æ¦‚è¿°

### 1.0 ç©ºé—´æ•°æ®æ¨¡å‹å·¥ä½œåŸç†æ¦‚è¿°

**ç©ºé—´æ•°æ®æ¨¡å‹**ï¼š

ç©ºé—´æ•°æ®æ¨¡å‹ç”¨äºè¡¨ç¤ºåœ°ç†ç©ºé—´å¯¹è±¡ï¼ˆç‚¹ã€çº¿ã€é¢ç­‰ï¼‰åŠå…¶ç©ºé—´å…³ç³»ã€‚ç©ºé—´ç´¢å¼•ï¼ˆå¦‚R-treeã€Quadtreeï¼‰ç”¨äºåŠ é€Ÿç©ºé—´æŸ¥è¯¢ã€‚

**ç©ºé—´æ•°æ®æ¨¡å‹ä½“ç³»æ€ç»´å¯¼å›¾**ï¼š

```mermaid
mindmap
  root((ç©ºé—´æ•°æ®æ¨¡å‹))
    ç©ºé—´å¯¹è±¡
      ç‚¹Point
      çº¿LineString
      é¢Polygon
      å¤šç‚¹MultiPoint
    ç©ºé—´å…³ç³»
      åŒ…å«Contains
      ç›¸äº¤Intersects
      ç›¸é‚»Touches
      è¦†ç›–Overlaps
    ç©ºé—´ç´¢å¼•
      R-tree
      Quadtree
      Gridç´¢å¼•
    ç©ºé—´æŸ¥è¯¢
      èŒƒå›´æŸ¥è¯¢
      æœ€è¿‘é‚»æŸ¥è¯¢
      ç©ºé—´è¿æ¥
```

**ç©ºé—´æŸ¥è¯¢å¤„ç†å†³ç­–æ ‘**ï¼š

```mermaid
flowchart TD
    A[ç©ºé—´æŸ¥è¯¢Q] --> B{æŸ¥è¯¢ç±»å‹}
    B -->|èŒƒå›´æŸ¥è¯¢| C[R-treeèŒƒå›´æœç´¢]
    B -->|æœ€è¿‘é‚»| D[R-treeæœ€è¿‘é‚»æœç´¢]
    B -->|ç©ºé—´è¿æ¥| E[ç©ºé—´è¿æ¥ç®—æ³•]
    C --> F[ä½¿ç”¨ç©ºé—´ç´¢å¼•]
    D --> F
    E --> F
    F --> G[æ‰§è¡ŒæŸ¥è¯¢]
    G --> H[è¿”å›ç»“æœ]

    style A fill:#FFD700
    style H fill:#90EE90
```

**ç©ºé—´ç´¢å¼•å¯¹æ¯”çŸ©é˜µ**ï¼š

| ç´¢å¼•ç±»å‹ | æŸ¥è¯¢æ€§èƒ½ | æ›´æ–°æ€§èƒ½ | é€‚ç”¨åœºæ™¯ |
|---------|---------|---------|---------|
| **R-tree** | é«˜ | ä¸­ | é€šç”¨ç©ºé—´æ•°æ® |
| **Quadtree** | ä¸­ | é«˜ | å‡åŒ€åˆ†å¸ƒæ•°æ® |
| **Gridç´¢å¼•** | ä¸­ | é«˜ | å›ºå®šç½‘æ ¼æ•°æ® |

### 1.1 æœ¬æ–‡æ¡£çš„èŒƒå›´

æœ¬æ–‡æ¡£æ¶µç›–ï¼š

- **ç©ºé—´æ•°æ®æ¨¡å‹**ï¼šç‚¹ã€çº¿ã€é¢ç­‰ç©ºé—´å¯¹è±¡çš„å½¢å¼åŒ–å®šä¹‰
- **ç©ºé—´ç´¢å¼•**ï¼šR-treeã€Quadtreeç­‰ç´¢å¼•ç»“æ„
- **ç©ºé—´æŸ¥è¯¢**ï¼šèŒƒå›´æŸ¥è¯¢ã€æœ€è¿‘é‚»æŸ¥è¯¢çš„è¯­ä¹‰
- **å®é™…åº”ç”¨**ï¼šPostgreSQL PostGISçš„å®ç°

---

## 2. æ ¸å¿ƒå†…å®¹

### 2.1 ç©ºé—´æ•°æ®æ¨¡å‹

**ç©ºé—´å¯¹è±¡å®šä¹‰**ï¼š

```haskell
-- ç©ºé—´å¯¹è±¡
data SpatialObject =
    Point Coordinate
  | LineString [Coordinate]
  | Polygon [Ring]
  | MultiPoint [Coordinate]
  | MultiLineString [[Coordinate]]
  | MultiPolygon [[Ring]]

-- åæ ‡
data Coordinate = Coordinate {
    x :: Double,
    y :: Double,
    z :: Maybe Double  -- å¯é€‰Zåæ ‡
}

-- ç¯ï¼ˆå¤šè¾¹å½¢è¾¹ç•Œï¼‰
type Ring = [Coordinate]
```

**ç©ºé—´å…³ç³»**ï¼š

```haskell
-- ç©ºé—´å…³ç³»
data SpatialRelation =
    Contains
  | Intersects
  | Touches
  | Overlaps
  | Within
  | Disjoint

-- ç©ºé—´å…³ç³»åˆ¤å®š
spatialRelation :: SpatialObject -> SpatialRelation -> SpatialObject -> Bool
spatialRelation obj1 rel obj2 =
    case rel of
        Contains -> contains(obj1, obj2)
        Intersects -> intersects(obj1, obj2)
        Touches -> touches(obj1, obj2)
        Overlaps -> overlaps(obj1, obj2)
        Within -> within(obj1, obj2)
        Disjoint -> disjoint(obj1, obj2)
```

### 2.2 ç©ºé—´ç´¢å¼•

**R-treeç´¢å¼•**ï¼š

```haskell
-- R-treeèŠ‚ç‚¹
data RTreeNode = RTreeNode {
    mbr :: MBR,  -- æœ€å°è¾¹ç•ŒçŸ©å½¢
    children :: Either [RTreeNode] [SpatialObject]
}

-- æœ€å°è¾¹ç•ŒçŸ©å½¢
data MBR = MBR {
    minX :: Double,
    minY :: Double,
    maxX :: Double,
    maxY :: Double
}

-- R-treeæŸ¥è¯¢
rTreeQuery :: RTreeNode -> MBR -> [SpatialObject]
rTreeQuery node queryMBR =
    if intersects(node.mbr, queryMBR) then
        case node.children of
            Left subtrees -> concatMap (rTreeQuery queryMBR) subtrees
            Right objects -> filter (intersects queryMBR) objects
    else
        []
```

**ç©ºé—´ç´¢å¼•å¯¹æ¯”çŸ©é˜µ**ï¼š

| ç´¢å¼•ç±»å‹ | èŒƒå›´æŸ¥è¯¢ | æœ€è¿‘é‚»æŸ¥è¯¢ | æ›´æ–°å¤æ‚åº¦ | å­˜å‚¨å¼€é”€ |
|---------|---------|-----------|-----------|---------|
| **R-tree** | é«˜ | é«˜ | O(log n) | ä¸­ |
| **Quadtree** | ä¸­ | ä¸­ | O(log n) | ä½ |
| **Gridç´¢å¼•** | ä¸­ | ä½ | O(1) | é«˜ |

### 2.3 ç©ºé—´æŸ¥è¯¢

**èŒƒå›´æŸ¥è¯¢**ï¼š

```haskell
-- èŒƒå›´æŸ¥è¯¢
rangeQuery :: SpatialIndex -> MBR -> [SpatialObject]
rangeQuery index mbr =
    indexQuery(index, Î»obj. intersects(obj.mbr, mbr))
```

**æœ€è¿‘é‚»æŸ¥è¯¢**ï¼š

```haskell
-- æœ€è¿‘é‚»æŸ¥è¯¢
nearestNeighbor :: SpatialIndex -> Coordinate -> Int -> [SpatialObject]
nearestNeighbor index point k =
    -- ä½¿ç”¨R-treeæœ€è¿‘é‚»æœç´¢
    rTreeNearestNeighbor(index, point, k)
```

**ç©ºé—´æŸ¥è¯¢æ‰§è¡Œæµç¨‹**ï¼š

```mermaid
graph TD
    A[ç©ºé—´æŸ¥è¯¢Q] --> B[è®¡ç®—æŸ¥è¯¢MBR]
    B --> C[ä½¿ç”¨ç©ºé—´ç´¢å¼•]
    C --> D[ç´¢å¼•æŸ¥æ‰¾å€™é€‰å¯¹è±¡]
    D --> E[ç²¾ç¡®å‡ ä½•è®¡ç®—]
    E --> F[è¿‡æ»¤ç»“æœ]
    F --> G[è¿”å›ç»“æœ]

    style A fill:#FFD700
    style G fill:#90EE90
```

---

## 3. å½¢å¼åŒ–å®šä¹‰

### 3.1 ç©ºé—´å¯¹è±¡å½¢å¼åŒ–

**ç©ºé—´å¯¹è±¡**ï¼š

```haskell
-- ç‚¹
Point(p) = {p} where p âˆˆ â„Â² or â„Â³

-- çº¿ä¸²
LineString([pâ‚, ..., pâ‚™]) = âˆª_{i=1}^{n-1} segment(p_i, p_{i+1})

-- å¤šè¾¹å½¢
Polygon([râ‚, ..., râ‚˜]) = râ‚ - âˆª_{i=2}^m r_i
```

### 3.2 ç©ºé—´å…³ç³»å½¢å¼åŒ–

**ç©ºé—´å…³ç³»**ï¼š

```haskell
-- åŒ…å«
Contains(A, B) iff B âŠ† A

-- ç›¸äº¤
Intersects(A, B) iff A âˆ© B â‰  âˆ…

-- ç›¸é‚»
Touches(A, B) iff A âˆ© B â‰  âˆ… and interior(A) âˆ© interior(B) = âˆ…
```

### 3.3 ç©ºé—´ç´¢å¼•å½¢å¼åŒ–

**R-tree**ï¼š

```haskell
-- R-treeæ€§è´¨
R-tree(G) satisfies:
  forall node n: MBR(n) contains all objects in subtree(n)
  forall leaf l: objects(l) are spatial objects
```

---

## 4. å®é™…åº”ç”¨

### 4.1 PostgreSQL PostGIS

**åˆ›å»ºç©ºé—´è¡¨**ï¼š

```sql
-- å¯ç”¨PostGISæ‰©å±•
CREATE EXTENSION postgis;

-- åˆ›å»ºç©ºé—´è¡¨
CREATE TABLE locations (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    geom GEOMETRY(POINT, 4326)  -- WGS84åæ ‡ç³»
);

-- åˆ›å»ºç©ºé—´ç´¢å¼•
CREATE INDEX idx_locations_geom ON locations USING GIST (geom);
```

**ç©ºé—´æŸ¥è¯¢ç¤ºä¾‹**ï¼š

```sql
-- èŒƒå›´æŸ¥è¯¢
SELECT name, ST_AsText(geom)
FROM locations
WHERE ST_Intersects(
    geom,
    ST_MakeEnvelope(-74.0, 40.7, -73.9, 40.8, 4326)
);

-- æœ€è¿‘é‚»æŸ¥è¯¢
SELECT name, ST_Distance(geom, ST_SetSRID(ST_MakePoint(-73.985, 40.758), 4326)) as distance
FROM locations
ORDER BY geom <-> ST_SetSRID(ST_MakePoint(-73.985, 40.758), 4326)
LIMIT 10;

-- ç©ºé—´è¿æ¥
SELECT a.name, b.name, ST_Distance(a.geom, b.geom) as distance
FROM locations a, locations b
WHERE a.id < b.id
  AND ST_DWithin(a.geom, b.geom, 1000);  -- 1000ç±³å†…
```

### 4.2 ç©ºé—´åˆ†æ

**ç©ºé—´èšåˆ**ï¼š

```sql
-- è®¡ç®—å‡¸åŒ…
SELECT ST_AsText(ST_ConvexHull(ST_Collect(geom)))
FROM locations;

-- è®¡ç®—ç¼“å†²åŒº
SELECT ST_AsText(ST_Buffer(geom, 1000)) as buffer
FROM locations
WHERE id = 1;
```

---

## 5. ç›¸å…³æ–‡æ¡£

### 5.1 ç†è®ºåŸºç¡€æ–‡æ¡£

- [å›¾æ•°æ®æ¨¡å‹-å›¾æŸ¥è¯¢è¯­è¨€ä¸å›¾ç®—æ³•çš„å½¢å¼åŒ–](./14.01-æ•°æ®åº“å›¾æ•°æ®æ¨¡å‹-å›¾æŸ¥è¯¢è¯­è¨€ä¸å›¾ç®—æ³•çš„å½¢å¼åŒ–.md)
- [ç†è®ºåŸºç¡€å¯¼èˆª](../README.md)

---

## 6. å‚è€ƒæ–‡çŒ®

### 6.1 æ ¸å¿ƒç†è®ºæ–‡çŒ®

- **Guttman, A. (1984). "R-trees: A Dynamic Index Structure for Spatial Searching."**
  - ä¼šè®®: SIGMOD 1984
  - **é‡è¦æ€§**: R-treeçš„ç»å…¸è®ºæ–‡
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†R-treeç´¢å¼•ç»“æ„

- **Samet, H. (1990). "The Design and Analysis of Spatial Data Structures."**
  - å‡ºç‰ˆç¤¾: Addison-Wesley 1990
  - **é‡è¦æ€§**: ç©ºé—´æ•°æ®ç»“æ„çš„ç»å…¸æ•™æ
  - **æ ¸å¿ƒè´¡çŒ®**: ç³»ç»Ÿé˜è¿°äº†ç©ºé—´ç´¢å¼•å’ŒæŸ¥è¯¢

### 6.2 ç©ºé—´æŸ¥è¯¢ç›¸å…³

- **Rigaux, P., et al. (2002). "Spatial Databases: With Application to GIS."**
  - å‡ºç‰ˆç¤¾: Morgan Kaufmann 2002
  - **é‡è¦æ€§**: ç©ºé—´æ•°æ®åº“çš„ç»å…¸æ•™æ
  - **æ ¸å¿ƒè´¡çŒ®**: è¯¦ç»†é˜è¿°äº†ç©ºé—´æ•°æ®æ¨¡å‹å’ŒæŸ¥è¯¢

### 6.3 PostgreSQLå®ç°ç›¸å…³

- **[PostGISå®˜æ–¹æ–‡æ¡£](<https://postgis.net/documentation/>)**
  - PostGISç©ºé—´æ•°æ®åº“æ‰©å±•è¯´æ˜

### 6.4 ç›¸å…³æ–‡æ¡£

- [å›¾æ•°æ®æ¨¡å‹-å›¾æŸ¥è¯¢è¯­è¨€ä¸å›¾ç®—æ³•çš„å½¢å¼åŒ–](./14.01-æ•°æ®åº“å›¾æ•°æ®æ¨¡å‹-å›¾æŸ¥è¯¢è¯­è¨€ä¸å›¾ç®—æ³•çš„å½¢å¼åŒ–.md)
- [ç†è®ºåŸºç¡€å¯¼èˆª](../README.md)

---

**æœ€åæ›´æ–°**: 2025-01-16
**ç»´æŠ¤è€…**: Documentation Team
**çŠ¶æ€**: ğŸŸ¡ æ¡†æ¶å·²åˆ›å»ºï¼Œå†…å®¹å¾…å®Œå–„
