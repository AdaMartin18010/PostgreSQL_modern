# PostgreSQLäº‹åŠ¡ç®¡ç†ä¸ACIDç‰¹æ€§å®Œæ•´æŒ‡å—

> **ç‰ˆæœ¬**: v3.1
> **æœ€åæ›´æ–°**: 2025-11-22
> **ç‰ˆæœ¬è¦†ç›–**: PostgreSQL 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x (å…¼å®¹)
> **éš¾åº¦**: â­â­â­â­
> **åº”ç”¨åœºæ™¯**: äº‹åŠ¡ç®¡ç†ã€å¹¶å‘æ§åˆ¶ã€æ•°æ®ä¸€è‡´æ€§ã€ç³»ç»Ÿè®¾è®¡
> ğŸ†• **PostgreSQL 18äº‹åŠ¡æ”¹è¿›**: MVCCä¼˜åŒ–ã€æ›´é«˜æ•ˆçš„VACUUMæœºåˆ¶ã€é€»è¾‘å¤åˆ¶æ€§èƒ½æå‡38%ï¼ˆå·²è¯¦ç»†å±•å¼€ï¼‰ã€å¼‚æ­¥I/Oæå‡äº‹åŠ¡æ—¥å¿—å†™å…¥æ€§èƒ½ï¼ˆå·²è¯¦ç»†å±•å¼€ï¼‰

---

## ğŸ“‘ ç›®å½•

- [PostgreSQLäº‹åŠ¡ç®¡ç†ä¸ACIDç‰¹æ€§å®Œæ•´æŒ‡å—](#postgresqläº‹åŠ¡ç®¡ç†ä¸acidç‰¹æ€§å®Œæ•´æŒ‡å—)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [ğŸ“Š æ€ç»´å¯¼å›¾](#-æ€ç»´å¯¼å›¾)
  - [ä¸€ã€å®šä¹‰ä¸å½¢å¼åŒ–](#ä¸€å®šä¹‰ä¸å½¢å¼åŒ–)
    - [1.1 æ¦‚å¿µå®šä¹‰](#11-æ¦‚å¿µå®šä¹‰)
    - [1.2 å½¢å¼åŒ–å®šä¹‰](#12-å½¢å¼åŒ–å®šä¹‰)
    - [1.3 æ ¸å¿ƒå±æ€§](#13-æ ¸å¿ƒå±æ€§)
  - [äºŒã€çŸ¥è¯†çŸ©é˜µå¯¹æ¯”](#äºŒçŸ¥è¯†çŸ©é˜µå¯¹æ¯”)
    - [2.1 äº‹åŠ¡éš”ç¦»çº§åˆ«å¯¹æ¯”](#21-äº‹åŠ¡éš”ç¦»çº§åˆ«å¯¹æ¯”)
    - [2.2 ACIDç‰¹æ€§å®ç°å¯¹æ¯”](#22-acidç‰¹æ€§å®ç°å¯¹æ¯”)
  - [ä¸‰ã€ç†è®ºåŸºç¡€](#ä¸‰ç†è®ºåŸºç¡€)
    - [3.1 ACIDæ€§è´¨ç†è®º](#31-acidæ€§è´¨ç†è®º)
    - [3.2 äº‹åŠ¡éš”ç¦»ç†è®º](#32-äº‹åŠ¡éš”ç¦»ç†è®º)
      - [3.2.1 READ UNCOMMITTEDï¼ˆè¯»æœªæäº¤ï¼‰](#321-read-uncommittedè¯»æœªæäº¤)
      - [3.2.2 READ COMMITTEDï¼ˆè¯»å·²æäº¤ï¼‰](#322-read-committedè¯»å·²æäº¤)
      - [3.2.3 REPEATABLE READï¼ˆå¯é‡å¤è¯»ï¼‰](#323-repeatable-readå¯é‡å¤è¯»)
      - [3.2.4 SERIALIZABLEï¼ˆå¯ä¸²è¡ŒåŒ–ï¼‰](#324-serializableå¯ä¸²è¡ŒåŒ–)
      - [3.2.5 éš”ç¦»çº§åˆ«é€‰æ‹©æŒ‡å—](#325-éš”ç¦»çº§åˆ«é€‰æ‹©æŒ‡å—)
    - [3.3 äº‹åŠ¡çŠ¶æ€è½¬æ¢](#33-äº‹åŠ¡çŠ¶æ€è½¬æ¢)
  - [å››ã€PostgreSQLå®ç°](#å››postgresqlå®ç°)
    - [4.1 äº‹åŠ¡æ§åˆ¶è¯­å¥](#41-äº‹åŠ¡æ§åˆ¶è¯­å¥)
    - [4.2 äº‹åŠ¡IDç®¡ç†](#42-äº‹åŠ¡idç®¡ç†)
    - [4.3 é•¿äº‹åŠ¡ç®¡ç†](#43-é•¿äº‹åŠ¡ç®¡ç†)
  - [äº”ã€å¹¶å‘æ§åˆ¶æœºåˆ¶](#äº”å¹¶å‘æ§åˆ¶æœºåˆ¶)
    - [5.1 MVCCå®ç°](#51-mvccå®ç°)
    - [5.2 é”æœºåˆ¶](#52-é”æœºåˆ¶)
    - [5.3 æ­»é”æ£€æµ‹](#53-æ­»é”æ£€æµ‹)
  - [å…­ã€äº‹åŠ¡æ—¥å¿—ä¸æ¢å¤](#å…­äº‹åŠ¡æ—¥å¿—ä¸æ¢å¤)
    - [6.1 WALæœºåˆ¶](#61-walæœºåˆ¶)
    - [6.2 äº‹åŠ¡æ¢å¤](#62-äº‹åŠ¡æ¢å¤)
  - [ä¸ƒã€æ€§èƒ½ä¼˜åŒ–](#ä¸ƒæ€§èƒ½ä¼˜åŒ–)
    - [7.1 äº‹åŠ¡ä¼˜åŒ–ç­–ç•¥](#71-äº‹åŠ¡ä¼˜åŒ–ç­–ç•¥)
    - [7.2 é”ä¼˜åŒ–](#72-é”ä¼˜åŒ–)
    - [7.3 PostgreSQL 18é€»è¾‘å¤åˆ¶æ€§èƒ½æå‡ ğŸ†•](#73-postgresql-18é€»è¾‘å¤åˆ¶æ€§èƒ½æå‡-)
  - [å…«ã€å®é™…åº”ç”¨æ¡ˆä¾‹](#å…«å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [8.1 é“¶è¡Œè½¬è´¦ç³»ç»Ÿ](#81-é“¶è¡Œè½¬è´¦ç³»ç»Ÿ)
    - [8.2 åº“å­˜ç®¡ç†ç³»ç»Ÿ](#82-åº“å­˜ç®¡ç†ç³»ç»Ÿ)
  - [ä¹ã€ç›¸å…³æ¦‚å¿µ](#ä¹ç›¸å…³æ¦‚å¿µ)
    - [9.1 ä¸Šä½æ¦‚å¿µ](#91-ä¸Šä½æ¦‚å¿µ)
    - [9.2 ä¸‹ä½æ¦‚å¿µ](#92-ä¸‹ä½æ¦‚å¿µ)
    - [9.3 å¹³è¡Œæ¦‚å¿µ](#93-å¹³è¡Œæ¦‚å¿µ)
  - [åã€å‚è€ƒèµ„æº](#åå‚è€ƒèµ„æº)
    - [10.1 ç›¸å…³æ–‡æ¡£](#101-ç›¸å…³æ–‡æ¡£)
    - [10.2 å®æˆ˜æ¡ˆä¾‹ä¸ç¤ºä¾‹](#102-å®æˆ˜æ¡ˆä¾‹ä¸ç¤ºä¾‹)
    - [10.3 å‚è€ƒæ–‡çŒ®](#103-å‚è€ƒæ–‡çŒ®)
    - [10.4 Wikidataå¯¹é½](#104-wikidataå¯¹é½)
  - [åä¸€ã€äº¤å‰å¼•ç”¨](#åä¸€äº¤å‰å¼•ç”¨)
    - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)
    - [å¤–éƒ¨èµ„æº](#å¤–éƒ¨èµ„æº)

---

## ğŸ“Š æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((äº‹åŠ¡ç®¡ç†))
    ACIDç‰¹æ€§
      åŸå­æ€§
      ä¸€è‡´æ€§
      éš”ç¦»æ€§
      æŒä¹…æ€§
    ç†è®ºåŸºç¡€
      ACIDç†è®º
      éš”ç¦»çº§åˆ«
      çŠ¶æ€è½¬æ¢
    PostgreSQLå®ç°
      äº‹åŠ¡æ§åˆ¶
      äº‹åŠ¡ID
      é•¿äº‹åŠ¡
    å¹¶å‘æ§åˆ¶
      MVCC
      é”æœºåˆ¶
      æ­»é”æ£€æµ‹
    äº‹åŠ¡æ—¥å¿—
      WALæœºåˆ¶
      äº‹åŠ¡æ¢å¤
    æ€§èƒ½ä¼˜åŒ–
      äº‹åŠ¡ä¼˜åŒ–
      é”ä¼˜åŒ–
    å®é™…åº”ç”¨
      é“¶è¡Œè½¬è´¦
      åº“å­˜ç®¡ç†
```

---

## ä¸€ã€å®šä¹‰ä¸å½¢å¼åŒ–

### 1.1 æ¦‚å¿µå®šä¹‰

**ä¸­æ–‡å®šä¹‰**: äº‹åŠ¡æ˜¯æ•°æ®åº“ä¸­çš„é€»è¾‘å·¥ä½œå•å…ƒï¼Œå…·æœ‰ACIDç‰¹æ€§ï¼ˆåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ï¼‰ã€‚PostgreSQLé€šè¿‡WALæœºåˆ¶ã€MVCCå’Œé”æœºåˆ¶ç¡®ä¿äº‹åŠ¡çš„ACIDç‰¹æ€§ã€‚

**English Definition**: A transaction is a logical unit of work in a database with ACID properties (Atomicity, Consistency, Isolation, Durability). PostgreSQL ensures ACID properties through WAL mechanism, MVCC, and locking mechanisms.

### 1.2 å½¢å¼åŒ–å®šä¹‰

```latex
% æ•°å­¦ç¬¦å·å®šä¹‰
\newcommand{\trans}{\mathcal{T}}
\newcommand{\op}{\mathcal{O}}
\newcommand{\state}{\mathcal{S}}
\newcommand{\commit}{\mathcal{C}}
\newcommand{\abort}{\mathcal{A}}

% äº‹åŠ¡çš„å½¢å¼åŒ–å®šä¹‰
\trans = \{\op_1, \op_2, \ldots, \op_n\}

% ACIDæ€§è´¨çš„å½¢å¼åŒ–å®šä¹‰
\begin{align}
\text{Atomicity: } & \forall \trans, \trans \text{ è¦ä¹ˆå®Œå…¨æ‰§è¡Œï¼Œè¦ä¹ˆå®Œå…¨ä¸æ‰§è¡Œ} \\
\text{Consistency: } & \forall \trans, \state_{\text{before}} \models \text{constraints} \Rightarrow \state_{\text{after}} \models \text{constraints} \\
\text{Isolation: } & \forall \trans_1, \trans_2, \trans_1 \parallel \trans_2 \equiv \trans_1; \trans_2 \text{ æˆ– } \trans_2; \trans_1 \\
\text{Durability: } & \forall \trans, \commit(\trans) \Rightarrow \text{ç»“æœæ°¸ä¹…ä¿å­˜}
\end{align}
```

### 1.3 æ ¸å¿ƒå±æ€§

- **åŸå­æ€§ (Atomicity)**: äº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„å·¥ä½œå•å…ƒ
- **ä¸€è‡´æ€§ (Consistency)**: äº‹åŠ¡æ‰§è¡Œå‰åæ•°æ®åº“ä¿æŒä¸€è‡´çŠ¶æ€
- **éš”ç¦»æ€§ (Isolation)**: å¹¶å‘äº‹åŠ¡é—´ç›¸äº’éš”ç¦»
- **æŒä¹…æ€§ (Durability)**: æäº¤çš„äº‹åŠ¡ç»“æœæ°¸ä¹…ä¿å­˜

---

## äºŒã€çŸ¥è¯†çŸ©é˜µå¯¹æ¯”

### 2.1 äº‹åŠ¡éš”ç¦»çº§åˆ«å¯¹æ¯”

| éš”ç¦»çº§åˆ« | è„è¯» | ä¸å¯é‡å¤è¯» | å¹»è¯» | æ€§èƒ½ | é€‚ç”¨åœºæ™¯ |
|---------|------|-----------|------|------|---------|
| READ UNCOMMITTED | å¯èƒ½ | å¯èƒ½ | å¯èƒ½ | æœ€é«˜ | å¾ˆå°‘ä½¿ç”¨ |
| READ COMMITTED | ä¸å¯èƒ½ | å¯èƒ½ | å¯èƒ½ | é«˜ | PostgreSQLé»˜è®¤ |
| REPEATABLE READ | ä¸å¯èƒ½ | ä¸å¯èƒ½ | å¯èƒ½ | ä¸­ | éœ€è¦ä¸€è‡´æ€§è¯» |
| SERIALIZABLE | ä¸å¯èƒ½ | ä¸å¯èƒ½ | ä¸å¯èƒ½ | æœ€ä½ | æœ€é«˜ä¸€è‡´æ€§è¦æ±‚ |

### 2.2 ACIDç‰¹æ€§å®ç°å¯¹æ¯”

| ACIDç‰¹æ€§ | PostgreSQLå®ç° | æ€§èƒ½å½±å“ | å¯é æ€§ |
|---------|---------------|---------|--------|
| åŸå­æ€§ | WAL + å›æ»šæ®µ | ä½ | æé«˜ |
| ä¸€è‡´æ€§ | çº¦æŸæ£€æŸ¥ + é” | ä¸­ | æé«˜ |
| éš”ç¦»æ€§ | MVCC + é” | ä½-ä¸­ | é«˜ |
| æŒä¹…æ€§ | WAL + fsync | ä¸­ | æé«˜ |

---

## ä¸‰ã€ç†è®ºåŸºç¡€

### 3.1 ACIDæ€§è´¨ç†è®º

```latex
\begin{theorem}[ACIDæ€§è´¨å®Œå¤‡æ€§]
è®¾äº‹åŠ¡ T = \{op_1, op_2, \ldots, op_n\}ï¼Œåˆ™ï¼š
1. åŸå­æ€§ï¼šâˆ€T, Tè¦ä¹ˆå®Œå…¨æ‰§è¡Œï¼Œè¦ä¹ˆå®Œå…¨ä¸æ‰§è¡Œ
2. ä¸€è‡´æ€§ï¼šâˆ€T, æ‰§è¡Œå‰åæ•°æ®åº“çŠ¶æ€æ»¡è¶³å®Œæ•´æ€§çº¦æŸ
3. éš”ç¦»æ€§ï¼šâˆ€Tâ‚,Tâ‚‚, Tâ‚çš„æ‰§è¡Œå¯¹Tâ‚‚ä¸å¯è§
4. æŒä¹…æ€§ï¼šâˆ€T, æäº¤åçš„äº‹åŠ¡ç»“æœæ°¸ä¹…ä¿å­˜
\end{theorem}

\begin{proof}
åŸºäºWALåè®®ã€MVCCæœºåˆ¶å’Œé”åè®®ï¼Œå¯ä»¥è¯æ˜ACIDæ€§è´¨çš„æ­£ç¡®æ€§ã€‚
\end{proof}
```

### 3.2 äº‹åŠ¡éš”ç¦»ç†è®º

```latex
\begin{theorem}[éš”ç¦»çº§åˆ«å±‚æ¬¡]
äº‹åŠ¡éš”ç¦»çº§åˆ«æ»¡è¶³ä»¥ä¸‹å±‚æ¬¡ç»“æ„ï¼š
1. READ UNCOMMITTED: æœ€ä½éš”ç¦»çº§åˆ«ï¼Œå…è®¸è„è¯»
2. READ COMMITTED: é˜²æ­¢è„è¯»ï¼Œå…è®¸ä¸å¯é‡å¤è¯»
3. REPEATABLE READ: é˜²æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œå…è®¸å¹»è¯»
4. SERIALIZABLE: æœ€é«˜éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨ä¸²è¡ŒåŒ–
\end{theorem}
```

#### 3.2.1 READ UNCOMMITTEDï¼ˆè¯»æœªæäº¤ï¼‰

**å®šä¹‰**: READ UNCOMMITTEDæ˜¯æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸äº‹åŠ¡è¯»å–å…¶ä»–äº‹åŠ¡æœªæäº¤çš„æ•°æ®ã€‚

**ç‰¹ç‚¹**:

- âœ… æ€§èƒ½æœ€é«˜ï¼ˆæ— é”ç­‰å¾…ï¼‰
- âŒ å…è®¸è„è¯»ï¼ˆDirty Readï¼‰
- âŒ å…è®¸ä¸å¯é‡å¤è¯»ï¼ˆNon-repeatable Readï¼‰
- âŒ å…è®¸å¹»è¯»ï¼ˆPhantom Readï¼‰

**PostgreSQLè¯´æ˜**: PostgreSQLå®é™…ä¸Šä¸æ”¯æŒREAD UNCOMMITTEDçº§åˆ«ï¼Œå³ä½¿è®¾ç½®ä¹Ÿä¼šè¢«æå‡ä¸ºREAD COMMITTEDã€‚

**è„è¯»ç¤ºä¾‹**:

```sql
-- äº‹åŠ¡1ï¼ˆæœªæäº¤ï¼‰
BEGIN;
UPDATE accounts SET balance = balance - 100 WHERE account_id = 1001;
-- æ­¤æ—¶balance = 900ï¼Œä½†äº‹åŠ¡æœªæäº¤

-- äº‹åŠ¡2ï¼ˆREAD UNCOMMITTEDï¼Œå¦‚æœæ”¯æŒï¼‰
BEGIN TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;
SELECT balance FROM accounts WHERE account_id = 1001;  -- å¯èƒ½è¯»åˆ°900ï¼ˆè„è¯»ï¼‰
-- å¦‚æœäº‹åŠ¡1å›æ»šï¼Œäº‹åŠ¡2è¯»åˆ°çš„å°±æ˜¯é”™è¯¯æ•°æ®

-- äº‹åŠ¡1å›æ»š
ROLLBACK;  -- balanceæ¢å¤ä¸º1000

-- äº‹åŠ¡2æäº¤
COMMIT;  -- ä½†å·²ç»åŸºäºé”™è¯¯æ•°æ®åšäº†å†³ç­–
```

**é€‚ç”¨åœºæ™¯**: å‡ ä¹ä¸ä½¿ç”¨ï¼Œå› ä¸ºæ•°æ®ä¸€è‡´æ€§æ— æ³•ä¿è¯ã€‚

#### 3.2.2 READ COMMITTEDï¼ˆè¯»å·²æäº¤ï¼‰

**å®šä¹‰**: READ COMMITTEDæ˜¯PostgreSQLçš„é»˜è®¤éš”ç¦»çº§åˆ«ï¼Œç¡®ä¿äº‹åŠ¡åªèƒ½è¯»å–å·²æäº¤çš„æ•°æ®ã€‚

**ç‰¹ç‚¹**:

- âœ… é˜²æ­¢è„è¯»
- âŒ å…è®¸ä¸å¯é‡å¤è¯»
- âŒ å…è®¸å¹»è¯»
- âœ… æ€§èƒ½è¾ƒé«˜

**å®ç°æœºåˆ¶**: PostgreSQLä½¿ç”¨MVCCæœºåˆ¶ï¼Œæ¯ä¸ªæŸ¥è¯¢è¯­å¥éƒ½ä¼šè·å–ä¸€ä¸ªæ–°çš„å¿«ç…§ï¼Œçœ‹åˆ°å·²æäº¤çš„æ•°æ®ã€‚

**ä¸å¯é‡å¤è¯»ç¤ºä¾‹**:

```sql
-- äº‹åŠ¡1
BEGIN TRANSACTION ISOLATION LEVEL READ COMMITTED;
SELECT balance FROM accounts WHERE account_id = 1001;  -- è¿”å›1000

-- äº‹åŠ¡2ï¼ˆå¹¶å‘ï¼‰
BEGIN;
UPDATE accounts SET balance = balance - 100 WHERE account_id = 1001;
COMMIT;  -- balanceå˜ä¸º900

-- äº‹åŠ¡1å†æ¬¡è¯»å–
SELECT balance FROM accounts WHERE account_id = 1001;  -- è¿”å›900ï¼ˆä¸å¯é‡å¤è¯»ï¼‰
COMMIT;
```

**å®é™…åº”ç”¨åœºæ™¯**:

```sql
-- åœºæ™¯ï¼šé“¶è¡Œè´¦æˆ·ä½™é¢æŸ¥è¯¢
BEGIN TRANSACTION ISOLATION LEVEL READ COMMITTED;

-- ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼šæ£€æŸ¥ä½™é¢
SELECT balance FROM accounts WHERE account_id = 1001;
-- è¿”å›ï¼š1000

-- åœ¨æ­¤æœŸé—´ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡å¯èƒ½å·²ç»æ‰£æ¬¾
-- ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼šå†æ¬¡æ£€æŸ¥ä½™é¢ï¼ˆå¯èƒ½ä¸åŒï¼‰
SELECT balance FROM accounts WHERE account_id = 1001;
-- è¿”å›ï¼š900ï¼ˆå¦‚æœå¦ä¸€ä¸ªäº‹åŠ¡å·²æ‰£æ¬¾ï¼‰

COMMIT;
```

**é…ç½®æ–¹æ³•**:

```sql
-- è®¾ç½®ä¼šè¯éš”ç¦»çº§åˆ«
SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;

-- è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«
BEGIN TRANSACTION ISOLATION LEVEL READ COMMITTED;
-- ... äº‹åŠ¡æ“ä½œ ...
COMMIT;
```

#### 3.2.3 REPEATABLE READï¼ˆå¯é‡å¤è¯»ï¼‰

**å®šä¹‰**: REPEATABLE READç¡®ä¿äº‹åŠ¡åœ¨æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹ä¸­çœ‹åˆ°ä¸€è‡´çš„æ•°æ®å¿«ç…§ã€‚

**ç‰¹ç‚¹**:

- âœ… é˜²æ­¢è„è¯»
- âœ… é˜²æ­¢ä¸å¯é‡å¤è¯»
- âŒ å…è®¸å¹»è¯»
- âš ï¸ æ€§èƒ½ä¸­ç­‰

**å®ç°æœºåˆ¶**: PostgreSQLä½¿ç”¨å¿«ç…§éš”ç¦»ï¼ˆSnapshot Isolationï¼‰ï¼Œäº‹åŠ¡å¼€å§‹æ—¶è·å–å¿«ç…§ï¼Œæ•´ä¸ªäº‹åŠ¡æœŸé—´éƒ½çœ‹åˆ°è¿™ä¸ªå¿«ç…§çš„æ•°æ®ã€‚

**å¯é‡å¤è¯»ç¤ºä¾‹**:

```sql
-- äº‹åŠ¡1
BEGIN TRANSACTION ISOLATION LEVEL REPEATABLE READ;
SELECT balance FROM accounts WHERE account_id = 1001;  -- è¿”å›1000

-- äº‹åŠ¡2ï¼ˆå¹¶å‘ï¼‰
BEGIN;
UPDATE accounts SET balance = balance - 100 WHERE account_id = 1001;
COMMIT;  -- balanceå˜ä¸º900

-- äº‹åŠ¡1å†æ¬¡è¯»å–ï¼ˆä»ç„¶çœ‹åˆ°1000ï¼‰
SELECT balance FROM accounts WHERE account_id = 1001;  -- è¿”å›1000ï¼ˆå¯é‡å¤è¯»ï¼‰
COMMIT;
```

**å¹»è¯»ç¤ºä¾‹**:

```sql
-- äº‹åŠ¡1
BEGIN TRANSACTION ISOLATION LEVEL REPEATABLE READ;
SELECT COUNT(*) FROM orders WHERE customer_id = 1001;  -- è¿”å›5

-- äº‹åŠ¡2ï¼ˆå¹¶å‘ï¼‰
BEGIN;
INSERT INTO orders (customer_id, amount) VALUES (1001, 100);
COMMIT;  -- æ–°å¢ä¸€æ¡è®¢å•

-- äº‹åŠ¡1å†æ¬¡æŸ¥è¯¢ï¼ˆä»ç„¶çœ‹åˆ°5ï¼‰
SELECT COUNT(*) FROM orders WHERE customer_id = 1001;  -- è¿”å›5ï¼ˆé˜²æ­¢å¹»è¯»ï¼‰

-- ä½†å¦‚æœåœ¨äº‹åŠ¡1ä¸­æ‰§è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œå¯èƒ½çœ‹åˆ°æ–°æ’å…¥çš„æ•°æ®
SELECT * FROM orders WHERE customer_id = 1001 AND order_id > 100;  -- å¯èƒ½çœ‹åˆ°æ–°æ•°æ®
COMMIT;
```

**å®é™…åº”ç”¨åœºæ™¯**:

```sql
-- åœºæ™¯ï¼šç”Ÿæˆæœˆåº¦æŠ¥è¡¨
BEGIN TRANSACTION ISOLATION LEVEL REPEATABLE READ;

-- æŸ¥è¯¢æœˆåˆä½™é¢
SELECT balance FROM accounts WHERE account_id = 1001;
-- è¿”å›ï¼š1000

-- è®¡ç®—æœ¬æœˆäº¤æ˜“æ€»é¢
SELECT SUM(amount) FROM transactions
WHERE account_id = 1001
AND transaction_date >= '2025-01-01'
AND transaction_date < '2025-02-01';
-- è¿”å›ï¼š-200

-- è®¡ç®—æœˆæœ«ä½™é¢ï¼ˆåŸºäºä¸€è‡´çš„æ•°æ®å¿«ç…§ï¼‰
-- æœˆæœ«ä½™é¢ = 1000 - 200 = 800

COMMIT;
```

**é…ç½®æ–¹æ³•**:

```sql
-- è®¾ç½®ä¼šè¯éš”ç¦»çº§åˆ«
SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;

-- è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«
BEGIN TRANSACTION ISOLATION LEVEL REPEATABLE READ;
-- ... äº‹åŠ¡æ“ä½œ ...
COMMIT;
```

#### 3.2.4 SERIALIZABLEï¼ˆå¯ä¸²è¡ŒåŒ–ï¼‰

**å®šä¹‰**: SERIALIZABLEæ˜¯æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œç¡®ä¿äº‹åŠ¡æ‰§è¡Œç»“æœä¸ä¸²è¡Œæ‰§è¡Œç›¸åŒã€‚

**ç‰¹ç‚¹**:

- âœ… é˜²æ­¢è„è¯»
- âœ… é˜²æ­¢ä¸å¯é‡å¤è¯»
- âœ… é˜²æ­¢å¹»è¯»
- âŒ æ€§èƒ½æœ€ä½ï¼ˆå¯èƒ½é¢‘ç¹å›æ»šï¼‰

**å®ç°æœºåˆ¶**: PostgreSQLä½¿ç”¨å¯ä¸²è¡ŒåŒ–å¿«ç…§éš”ç¦»ï¼ˆSerializable Snapshot Isolation, SSIï¼‰ï¼Œé€šè¿‡æ£€æµ‹è¯»å†™å†²çªæ¥é˜²æ­¢åºåˆ—åŒ–å¼‚å¸¸ã€‚

**åºåˆ—åŒ–å¼‚å¸¸æ£€æµ‹**:

```sql
-- äº‹åŠ¡1
BEGIN TRANSACTION ISOLATION LEVEL SERIALIZABLE;
SELECT SUM(amount) FROM accounts WHERE account_id IN (1001, 1002);
-- è¿”å›ï¼š2000

-- äº‹åŠ¡2ï¼ˆå¹¶å‘ï¼‰
BEGIN TRANSACTION ISOLATION LEVEL SERIALIZABLE;
UPDATE accounts SET balance = balance - 100 WHERE account_id = 1001;
COMMIT;

-- äº‹åŠ¡1å°è¯•æ›´æ–°
UPDATE accounts SET balance = balance + 100 WHERE account_id = 1002;
-- å¯èƒ½è§¦å‘åºåˆ—åŒ–é”™è¯¯ï¼šERROR: could not serialize access due to read/write dependencies among transactions
COMMIT;  -- éœ€è¦é‡è¯•
```

**å®é™…åº”ç”¨åœºæ™¯**:

```sql
-- åœºæ™¯ï¼šé“¶è¡Œè½¬è´¦ï¼ˆéœ€è¦æœ€é«˜ä¸€è‡´æ€§ï¼‰
BEGIN TRANSACTION ISOLATION LEVEL SERIALIZABLE;

-- æ£€æŸ¥è½¬å‡ºè´¦æˆ·ä½™é¢
SELECT balance FROM accounts WHERE account_id = 1001 FOR UPDATE;
-- è¿”å›ï¼š1000

-- æ£€æŸ¥è½¬å…¥è´¦æˆ·
SELECT balance FROM accounts WHERE account_id = 1002 FOR UPDATE;
-- è¿”å›ï¼š500

-- æ‰§è¡Œè½¬è´¦
UPDATE accounts SET balance = balance - 200 WHERE account_id = 1001;
UPDATE accounts SET balance = balance + 200 WHERE account_id = 1002;

COMMIT;  -- å¦‚æœæ£€æµ‹åˆ°å†²çªï¼Œä¼šè‡ªåŠ¨å›æ»šå¹¶æŠ¥é”™
```

**é…ç½®æ–¹æ³•**:

```sql
-- è®¾ç½®ä¼šè¯éš”ç¦»çº§åˆ«
SET SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;

-- è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«
BEGIN TRANSACTION ISOLATION LEVEL SERIALIZABLE;
-- ... äº‹åŠ¡æ“ä½œ ...
COMMIT;
```

**æ€§èƒ½è€ƒè™‘**:

```sql
-- ç›‘æ§åºåˆ—åŒ–å¤±è´¥
SELECT
    datname,
    xact_rollback,
    conflicts
FROM pg_stat_database
WHERE datname = current_database();

-- æŸ¥çœ‹åºåˆ—åŒ–å†²çªç»Ÿè®¡
SELECT * FROM pg_stat_database_conflicts;
```

#### 3.2.5 éš”ç¦»çº§åˆ«é€‰æ‹©æŒ‡å—

**é€‰æ‹©çŸ©é˜µ**:

| åœºæ™¯ | æ¨èéš”ç¦»çº§åˆ« | åŸå›  |
|------|------------|------|
| ä¸€èˆ¬æŸ¥è¯¢ | READ COMMITTED | æ€§èƒ½å¥½ï¼Œæ»¡è¶³å¤§å¤šæ•°éœ€æ±‚ |
| æŠ¥è¡¨ç”Ÿæˆ | REPEATABLE READ | éœ€è¦ä¸€è‡´æ€§å¿«ç…§ |
| è´¢åŠ¡äº¤æ˜“ | SERIALIZABLE | éœ€è¦æœ€é«˜ä¸€è‡´æ€§ |
| é«˜å¹¶å‘è¯» | READ COMMITTED | æ€§èƒ½ä¼˜å…ˆ |
| æ•°æ®è¿ç§» | REPEATABLE READ | éœ€è¦ä¸€è‡´æ€§ |

**æ€§èƒ½å¯¹æ¯”**:

```sql
-- æ€§èƒ½æµ‹è¯•ï¼šä¸åŒéš”ç¦»çº§åˆ«çš„ååé‡
-- READ COMMITTED: 1000 TPSï¼ˆåŸºå‡†ï¼‰
-- REPEATABLE READ: 800 TPSï¼ˆ-20%ï¼‰
-- SERIALIZABLE: 500 TPSï¼ˆ-50%ï¼Œå¯èƒ½æ›´ä½ï¼‰

-- å®é™…æµ‹è¯•å»ºè®®
BEGIN TRANSACTION ISOLATION LEVEL READ COMMITTED;
-- æ‰§è¡Œæµ‹è¯•æŸ¥è¯¢
COMMIT;
```

**æœ€ä½³å®è·µ**:

1. **é»˜è®¤ä½¿ç”¨**: READ COMMITTEDï¼ˆPostgreSQLé»˜è®¤ï¼‰
2. **éœ€è¦ä¸€è‡´æ€§**: REPEATABLE READ
3. **å…³é”®ä¸šåŠ¡**: SERIALIZABLE
4. **ç›‘æ§å†²çª**: å®šæœŸæ£€æŸ¥åºåˆ—åŒ–å¤±è´¥
5. **åº”ç”¨é‡è¯•**: å¯¹äºSERIALIZABLEçº§åˆ«ï¼Œå®ç°é‡è¯•æœºåˆ¶

### 3.3 äº‹åŠ¡çŠ¶æ€è½¬æ¢

```latex
\begin{theorem}[äº‹åŠ¡çŠ¶æ€æœº]
äº‹åŠ¡çŠ¶æ€è½¬æ¢æ»¡è¶³ä»¥ä¸‹è§„åˆ™ï¼š
\begin{align}
\text{ACTIVE} & \rightarrow \text{COMMITTED} \text{ (é€šè¿‡COMMIT)} \\
\text{ACTIVE} & \rightarrow \text{ABORTED} \text{ (é€šè¿‡ROLLBACK)} \\
\text{ACTIVE} & \rightarrow \text{PARTIALLY COMMITTED} \text{ (æäº¤å¼€å§‹)} \\
\text{PARTIALLY COMMITTED} & \rightarrow \text{COMMITTED} \text{ (æäº¤å®Œæˆ)} \\
\text{PARTIALLY COMMITTED} & \rightarrow \text{ABORTED} \text{ (æäº¤å¤±è´¥)}
\end{align}
\end{theorem}
```

---

## å››ã€PostgreSQLå®ç°

### 4.1 äº‹åŠ¡æ§åˆ¶è¯­å¥

```sql
-- åŸºæœ¬äº‹åŠ¡æ§åˆ¶
BEGIN;
INSERT INTO accounts (account_id, balance) VALUES (1001, 1000);
UPDATE accounts SET balance = balance - 100 WHERE account_id = 1001;
COMMIT;

-- ä¿å­˜ç‚¹æœºåˆ¶
BEGIN;
INSERT INTO accounts (account_id, balance) VALUES (1002, 2000);
SAVEPOINT sp1;
UPDATE accounts SET balance = balance - 500 WHERE account_id = 1002;
ROLLBACK TO sp1;  -- å›æ»šåˆ°ä¿å­˜ç‚¹
COMMIT;  -- åªæäº¤ç¬¬ä¸€ä¸ªæ’å…¥

-- äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®
BEGIN TRANSACTION ISOLATION LEVEL SERIALIZABLE;
SELECT * FROM accounts WHERE balance > 1000;
COMMIT;
```

### 4.2 äº‹åŠ¡IDç®¡ç†

```sql
-- æŸ¥çœ‹å½“å‰äº‹åŠ¡ID
SELECT txid_current();

-- æŸ¥çœ‹äº‹åŠ¡çŠ¶æ€
SELECT
    pid,
    usename,
    application_name,
    state,
    query_start,
    query
FROM pg_stat_activity
WHERE state = 'active';

-- æŸ¥çœ‹äº‹åŠ¡é”ä¿¡æ¯
SELECT
    locktype,
    database,
    relation,
    page,
    tuple,
    virtualxid,
    transactionid,
    classid,
    objid,
    objsubid,
    virtualtransaction,
    pid,
    mode,
    granted
FROM pg_locks
WHERE NOT granted;
```

### 4.3 é•¿äº‹åŠ¡ç®¡ç†

```sql
-- æŸ¥çœ‹é•¿äº‹åŠ¡
SELECT
    pid,
    usename,
    application_name,
    client_addr,
    backend_start,
    state,
    query_start,
    state_change,
    query
FROM pg_stat_activity
WHERE state = 'active'
AND query_start < NOW() - INTERVAL '1 hour';

-- ç»ˆæ­¢é•¿äº‹åŠ¡
SELECT pg_terminate_backend(pid)
FROM pg_stat_activity
WHERE pid = 12345;
```

---

## äº”ã€å¹¶å‘æ§åˆ¶æœºåˆ¶

### 5.1 MVCCå®ç°

```sql
-- æŸ¥çœ‹è¡Œç‰ˆæœ¬ä¿¡æ¯
SELECT
    ctid,
    xmin,
    xmax,
    cmin,
    cmax,
    *
FROM employees
WHERE emp_id = 1001;

-- æŸ¥çœ‹äº‹åŠ¡å¿«ç…§
SELECT txid_snapshot_xmin(txid_current_snapshot()),
       txid_snapshot_xmax(txid_current_snapshot()),
       txid_snapshot_xip(txid_current_snapshot());
```

### 5.2 é”æœºåˆ¶

```sql
-- æ˜¾å¼é”è¡¨
LOCK TABLE employees IN SHARE MODE;
LOCK TABLE departments IN EXCLUSIVE MODE;

-- è¡Œçº§é”
SELECT * FROM employees WHERE emp_id = 1001 FOR UPDATE;
SELECT * FROM employees WHERE dept_id = 1 FOR SHARE;

-- æŸ¥çœ‹é”ç­‰å¾…
SELECT
    blocked_locks.pid AS blocked_pid,
    blocked_activity.usename AS blocked_user,
    blocking_locks.pid AS blocking_pid,
    blocking_activity.usename AS blocking_user,
    blocked_activity.query AS blocked_statement,
    blocking_activity.query AS current_statement_in_blocking_process
FROM pg_catalog.pg_locks blocked_locks
JOIN pg_catalog.pg_stat_activity blocked_activity ON blocked_activity.pid = blocked_locks.pid
JOIN pg_catalog.pg_locks blocking_locks ON blocking_locks.locktype = blocked_locks.locktype
JOIN pg_catalog.pg_stat_activity blocking_activity ON blocking_activity.pid = blocking_locks.pid
WHERE NOT blocked_locks.granted;
```

### 5.3 æ­»é”æ£€æµ‹

```sql
-- æ­»é”æ£€æµ‹é…ç½®
SHOW deadlock_timeout;
SET deadlock_timeout = '1s';

-- æŸ¥çœ‹æ­»é”æ—¥å¿—
SELECT * FROM pg_stat_database_conflicts;

-- æ­»é”é¿å…ç­–ç•¥
BEGIN;
-- æŒ‰å›ºå®šé¡ºåºè®¿é—®èµ„æº
SELECT * FROM accounts WHERE account_id = 1001 FOR UPDATE;
SELECT * FROM accounts WHERE account_id = 1002 FOR UPDATE;
COMMIT;
```

---

## å…­ã€äº‹åŠ¡æ—¥å¿—ä¸æ¢å¤

### 6.1 WALæœºåˆ¶

```sql
-- WALé…ç½®
SHOW wal_level;
SHOW wal_buffers;
SHOW checkpoint_timeout;
SHOW max_wal_size;

-- æŸ¥çœ‹WALç»Ÿè®¡ä¿¡æ¯
SELECT * FROM pg_stat_wal;

-- æ‰‹åŠ¨æ£€æŸ¥ç‚¹
CHECKPOINT;
```

### 6.2 äº‹åŠ¡æ¢å¤

```sql
-- æŸ¥çœ‹æ¢å¤çŠ¶æ€
SELECT pg_is_in_recovery();

-- æŸ¥çœ‹WALä½ç½®
SELECT pg_current_wal_lsn();
SELECT pg_walfile_name(pg_current_wal_lsn());

-- æŸ¥çœ‹æ£€æŸ¥ç‚¹ä¿¡æ¯
SELECT * FROM pg_control_checkpoint();
```

**PostgreSQL 18å¼‚æ­¥I/Oæå‡äº‹åŠ¡æ—¥å¿—å†™å…¥æ€§èƒ½** ğŸ†•

PostgreSQL 18çš„å¼‚æ­¥I/Oå­ç³»ç»Ÿæ˜¾è‘—æå‡äº†WALå†™å…¥æ€§èƒ½ï¼Œå‡å°‘äº‹åŠ¡æäº¤å»¶è¿Ÿï¼Œæå‡ç³»ç»Ÿæ•´ä½“ååé‡ã€‚

**æ€§èƒ½æå‡**:

- WALå†™å…¥æ€§èƒ½æå‡ï¼šå¼‚æ­¥I/Oå‡å°‘I/Oç­‰å¾…æ—¶é—´
- äº‹åŠ¡æäº¤å»¶è¿Ÿé™ä½ï¼šç‰¹åˆ«æ˜¯åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹
- ç³»ç»Ÿååé‡æå‡ï¼šæ”¯æŒæ›´é«˜çš„å¹¶å‘äº‹åŠ¡æ•°

**é…ç½®æ–¹æ³•**:

```sql
-- PostgreSQL 18å¼‚æ­¥I/Oé…ç½®
-- postgresql.conf

-- æœ‰æ•ˆI/Oå¹¶å‘æ•°
effective_io_concurrency = 200   -- æå‡WALå†™å…¥æ€§èƒ½

-- æŸ¥çœ‹WALå†™å…¥ç»Ÿè®¡
SELECT
    wal_records,
    wal_write,
    wal_sync,
    wal_bytes,
    wal_buffers_full,
    wal_write_time,
    wal_sync_time
FROM pg_stat_wal;
```

**ä½¿ç”¨åœºæ™¯**:

1. **é«˜å¹¶å‘äº‹åŠ¡åœºæ™¯**

   ```sql
   -- é«˜å¹¶å‘äº‹åŠ¡æäº¤
   BEGIN;
   INSERT INTO orders (user_id, amount) VALUES (1, 100);
   COMMIT;  -- PostgreSQL 18: å¼‚æ­¥I/Oå‡å°‘æäº¤å»¶è¿Ÿ
   ```

2. **æ‰¹é‡äº‹åŠ¡å¤„ç†**

   ```sql
   -- æ‰¹é‡äº‹åŠ¡å¤„ç†
   BEGIN;
   INSERT INTO large_table SELECT * FROM source_table;
   COMMIT;  -- PostgreSQL 18: å¼‚æ­¥I/Oæå‡æ‰¹é‡å†™å…¥æ€§èƒ½
   ```

**æ€§èƒ½å¯¹æ¯”**:

- PostgreSQL 17: åŒæ­¥WALå†™å…¥ï¼Œé«˜å¹¶å‘æ—¶å»¶è¿Ÿè¾ƒé«˜
- PostgreSQL 18: å¼‚æ­¥I/Oï¼ŒWALå†™å…¥æ€§èƒ½æå‡ï¼Œäº‹åŠ¡å»¶è¿Ÿé™ä½
- é«˜å¹¶å‘åœºæ™¯ï¼šäº‹åŠ¡ååé‡æå‡20-30%

---

## ä¸ƒã€æ€§èƒ½ä¼˜åŒ–

### 7.1 äº‹åŠ¡ä¼˜åŒ–ç­–ç•¥

```sql
-- æ‰¹é‡æ“ä½œä¼˜åŒ–
BEGIN;
INSERT INTO large_table (col1, col2, col3)
SELECT generate_series(1, 1000000),
       'data' || generate_series(1, 1000000),
       random() * 1000;
COMMIT;

-- é¿å…é•¿äº‹åŠ¡
BEGIN;
-- å¿«é€Ÿæ“ä½œ
UPDATE accounts SET balance = balance + 100 WHERE account_id = 1001;
COMMIT;

-- ä½¿ç”¨é€‚å½“çš„éš”ç¦»çº§åˆ«
BEGIN TRANSACTION ISOLATION LEVEL READ COMMITTED;
SELECT * FROM accounts WHERE balance > 1000;
COMMIT;
```

### 7.2 é”ä¼˜åŒ–

```sql
-- å‡å°‘é”ç«äº‰
BEGIN;
-- ä½¿ç”¨ç´¢å¼•å‡å°‘é”èŒƒå›´
UPDATE employees SET salary = salary * 1.1
WHERE dept_id = 1 AND emp_id > 1000;
COMMIT;

-- ä½¿ç”¨ä¹è§‚é”
BEGIN;
SELECT version, salary FROM employees WHERE emp_id = 1001;
-- åº”ç”¨å±‚å¤„ç†
UPDATE employees SET salary = 60000, version = version + 1
WHERE emp_id = 1001 AND version = 1;
COMMIT;
```

### 7.3 PostgreSQL 18é€»è¾‘å¤åˆ¶æ€§èƒ½æå‡ ğŸ†•

PostgreSQL 18å¯¹é€»è¾‘å¤åˆ¶è¿›è¡Œäº†é‡å¤§ä¼˜åŒ–ï¼Œæ€§èƒ½æå‡38%ï¼Œç‰¹åˆ«é€‚ç”¨äºé«˜ååé‡çš„æ•°æ®åŒæ­¥åœºæ™¯ã€‚

**æ€§èƒ½ä¼˜åŒ–**:

1. **å¹¶è¡Œåº”ç”¨**: æ”¯æŒå¤šä¸ªäº‹åŠ¡å¹¶è¡Œåº”ç”¨ï¼Œæå‡å¤åˆ¶ååé‡
2. **æ‰¹é‡å¤„ç†**: ä¼˜åŒ–æ‰¹é‡äº‹åŠ¡çš„å¤„ç†æ•ˆç‡
3. **å†…å­˜ä¼˜åŒ–**: æ”¹è¿›å†…å­˜ä½¿ç”¨ï¼Œå‡å°‘å¤åˆ¶å»¶è¿Ÿ

**é…ç½®æ–¹æ³•**:

```sql
-- PostgreSQL 18é€»è¾‘å¤åˆ¶é…ç½®
-- postgresql.conf

-- é€»è¾‘å¤åˆ¶å·¥ä½œè¿›ç¨‹æ•°ï¼ˆPostgreSQL 18ä¼˜åŒ–ï¼‰
max_logical_replication_workers = 4
max_sync_workers_per_subscription = 2

-- æŸ¥çœ‹é€»è¾‘å¤åˆ¶çŠ¶æ€
SELECT * FROM pg_stat_replication;
SELECT * FROM pg_replication_slots;

-- æŸ¥çœ‹è®¢é˜…çŠ¶æ€
SELECT * FROM pg_subscription;
SELECT * FROM pg_subscription_rel;
```

**ä½¿ç”¨åœºæ™¯**:

1. **è·¨æ•°æ®åº“åŒæ­¥**

   ```sql
   -- åˆ›å»ºå‘å¸ƒ
   CREATE PUBLICATION mypub FOR TABLE users, orders;

   -- åˆ›å»ºè®¢é˜…ï¼ˆPostgreSQL 18æ€§èƒ½æå‡38%ï¼‰
   CREATE SUBSCRIPTION mysub
   CONNECTION 'host=target_host dbname=target_db'
   PUBLICATION mypub;
   ```

2. **é«˜ååé‡æ•°æ®åŒæ­¥**

   ```sql
   -- é«˜å¹¶å‘å†™å…¥åœºæ™¯
   -- PostgreSQL 18: é€»è¾‘å¤åˆ¶æ€§èƒ½æå‡38%
   INSERT INTO large_table SELECT * FROM source_table;
   ```

**æ€§èƒ½å¯¹æ¯”**:

- PostgreSQL 17: é€»è¾‘å¤åˆ¶åŸºå‡†æ€§èƒ½
- PostgreSQL 18: é€»è¾‘å¤åˆ¶æ€§èƒ½æå‡38%
- é«˜ååé‡åœºæ™¯ï¼šæ€§èƒ½æå‡æ›´æ˜æ˜¾ï¼Œå¯è¾¾50%

**æœ€ä½³å®è·µ**:

- æ ¹æ®æ•°æ®é‡è°ƒæ•´`max_logical_replication_workers`
- ç›‘æ§å¤åˆ¶å»¶è¿Ÿå’Œååé‡
- PostgreSQL 18çš„é€»è¾‘å¤åˆ¶ä¼˜åŒ–ç‰¹åˆ«é€‚ç”¨äºå¤§å‹æ•°æ®åº“åŒæ­¥

---

## å…«ã€å®é™…åº”ç”¨æ¡ˆä¾‹

### 8.1 é“¶è¡Œè½¬è´¦ç³»ç»Ÿ

```sql
-- åŸå­æ€§è½¬è´¦
BEGIN;
-- æ£€æŸ¥è´¦æˆ·ä½™é¢
SELECT balance FROM accounts WHERE account_id = 1001 FOR UPDATE;
-- æ‰£é™¤è½¬å‡ºè´¦æˆ·
UPDATE accounts SET balance = balance - 1000 WHERE account_id = 1001;
-- å¢åŠ è½¬å…¥è´¦æˆ·
UPDATE accounts SET balance = balance + 1000 WHERE account_id = 1002;
-- è®°å½•äº¤æ˜“
INSERT INTO transactions (from_account, to_account, amount, transaction_date)
VALUES (1001, 1002, 1000, NOW());
COMMIT;
```

### 8.2 åº“å­˜ç®¡ç†ç³»ç»Ÿ

```sql
-- åº“å­˜æ‰£å‡
BEGIN;
-- æ£€æŸ¥åº“å­˜
SELECT stock_quantity FROM products WHERE product_id = 1001 FOR UPDATE;
-- æ‰£å‡åº“å­˜
UPDATE products SET stock_quantity = stock_quantity - 5
WHERE product_id = 1001 AND stock_quantity >= 5;
-- å¦‚æœåº“å­˜ä¸è¶³ï¼Œå›æ»š
IF NOT FOUND THEN
    ROLLBACK;
    RAISE EXCEPTION 'åº“å­˜ä¸è¶³';
END IF;
-- è®°å½•å‡ºåº“
INSERT INTO stock_movements (product_id, movement_type, quantity, movement_date)
VALUES (1001, 'OUT', 5, NOW());
COMMIT;
```

---

## ä¹ã€ç›¸å…³æ¦‚å¿µ

### 9.1 ä¸Šä½æ¦‚å¿µ

- **æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ**: æ›´å¹¿æ³›çš„ç³»ç»Ÿç±»åˆ«
- **å¹¶å‘æ§åˆ¶**: å¹¶å‘è®¿é—®ç®¡ç†æœºåˆ¶
- **æ•°æ®ä¸€è‡´æ€§**: æ•°æ®å®Œæ•´æ€§ä¿è¯

### 9.2 ä¸‹ä½æ¦‚å¿µ

- **äº‹åŠ¡æ—¥å¿—**: äº‹åŠ¡è®°å½•æœºåˆ¶
- **é”æœºåˆ¶**: å¹¶å‘æ§åˆ¶å®ç°
- **MVCC**: å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶
- **WAL**: é¢„å†™æ—¥å¿—

### 9.3 å¹³è¡Œæ¦‚å¿µ

- **åˆ†å¸ƒå¼äº‹åŠ¡**: è·¨èŠ‚ç‚¹äº‹åŠ¡ç®¡ç†
- **ä¸¤é˜¶æ®µæäº¤**: åˆ†å¸ƒå¼äº‹åŠ¡åè®®
- **SAGAæ¨¡å¼**: é•¿äº‹åŠ¡ç®¡ç†æ¨¡å¼

---

## åã€å‚è€ƒèµ„æº

### 10.1 ç›¸å…³æ–‡æ¡£

- [å¹¶å‘æ§åˆ¶ä¸MVCCæœºåˆ¶](./01.05-å¹¶å‘æ§åˆ¶ä¸MVCCæœºåˆ¶.md) - å¹¶å‘æ§åˆ¶å®ç°
- [åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†](../04-é«˜çº§ç‰¹æ€§/03.07-åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†.md) - åˆ†å¸ƒå¼äº‹åŠ¡
- [å½¢å¼åŒ–éªŒè¯æ–¹æ³•](../æ•°æ®åº“ç†è®º/10.01-å½¢å¼åŒ–éªŒè¯æ–¹æ³•.md) - ACIDç‰¹æ€§å½¢å¼åŒ–éªŒè¯
- [å­¦æœ¯ç ”ç©¶å‰æ²¿](../æ•°æ®åº“ç†è®º/10.02-å­¦æœ¯ç ”ç©¶å‰æ²¿.md) - äº‹åŠ¡ç†è®ºç ”ç©¶

### 10.2 å®æˆ˜æ¡ˆä¾‹ä¸ç¤ºä¾‹

- [å¯è¿è¡Œç¤ºä¾‹é¡¹ç›®](../examples/README.md) â­ - 8ä¸ªå®Œæ•´çš„Docker Composeç¤ºä¾‹
- [åˆ†å¸ƒå¼æ•°æ®åº“å®æˆ˜](../08-å®æˆ˜æ¡ˆä¾‹/06.04-åˆ†å¸ƒå¼æ•°æ®åº“å®æˆ˜.md) - åˆ†å¸ƒå¼äº‹åŠ¡å®è·µ
- [é‡‘èè´¦åŠ¡ä¸€è‡´æ€§](../09-åº”ç”¨è®¾è®¡/è¡Œä¸šæ¡ˆä¾‹/é‡‘èè´¦åŠ¡ä¸€è‡´æ€§.md) - ACIDç‰¹æ€§åº”ç”¨æ¡ˆä¾‹

### 10.3 å‚è€ƒæ–‡çŒ®

1. Berenson, H., et al. (1995). A critique of ANSI SQL isolation levels. ACM SIGMOD Record, 24(2), 1-10.
2. Mohan, C., et al. (1992). ARIES: A transaction recovery method supporting fine-granularity locking and partial rollbacks using write-ahead logging. ACM TODS, 17(1), 94-162.
3. PostgreSQL Global Development Group. (2025). PostgreSQL 18 Documentation. <https://www.postgresql.org/docs/18/>
4. Gray, J., & Reuter, A. (1993). Transaction Processing: Concepts and Techniques. Morgan Kaufmann.
5. PostgreSQL Global Development Group. (2024). PostgreSQL 17 Documentation. <https://www.postgresql.org/docs/17/>

### 10.4 Wikidataå¯¹é½

- **Wikidata ID**: Q192490
- **ç›¸å…³å±æ€§**:
  - P31: Q176165 (instance of: database management system)
  - P178: Q9366 (developer: PostgreSQL Global Development Group)
  - P277: Q193321 (programmed in: C)
  - P348: 18.0 (software version)
- **å¤–éƒ¨é“¾æ¥**:
  - <https://www.postgresql.org/docs/current/transaction-iso.html>
  - <https://www.postgresql.org/docs/current/mvcc.html>

---

## åä¸€ã€äº¤å‰å¼•ç”¨

### ç›¸å…³æ–‡æ¡£

- â­â­â­ [å¹¶å‘æ§åˆ¶ä¸MVCCæœºåˆ¶](./01.05-å¹¶å‘æ§åˆ¶ä¸MVCCæœºåˆ¶.md) - MVCCå®ç°æœºåˆ¶
- â­â­â­ [å­˜å‚¨ç®¡ç†ä¸æ•°æ®æŒä¹…åŒ–](./01.06-å­˜å‚¨ç®¡ç†ä¸æ•°æ®æŒä¹…åŒ–.md) - WALæœºåˆ¶
- â­â­ [SQLè¯­è¨€è§„èŒƒä¸æ ‡å‡†](./01.03-SQLè¯­è¨€è§„èŒƒä¸æ ‡å‡†.md) - äº‹åŠ¡SQLè¯­å¥
- â­â­ [ç³»ç»Ÿæ¶æ„ä¸è®¾è®¡åŸç†](./01.01-ç³»ç»Ÿæ¶æ„ä¸è®¾è®¡åŸç†.md) - ç³»ç»Ÿæ¶æ„ç†è®ºåŸºç¡€
- â­â­ [é‡‘èè´¦åŠ¡ä¸€è‡´æ€§](../../09-åº”ç”¨è®¾è®¡/è¡Œä¸šæ¡ˆä¾‹/é‡‘èè´¦åŠ¡ä¸€è‡´æ€§.md) - äº‹åŠ¡åº”ç”¨æ¡ˆä¾‹
- â­ [å¤‡ä»½ä¸æ¢å¤](../../06-è¿ç»´å®è·µ/å¤‡ä»½ä¸æ¢å¤/06.06-å¤‡ä»½ä¸æ¢å¤.md) - äº‹åŠ¡æ¢å¤å®è·µ

### å¤–éƒ¨èµ„æº

- [PostgreSQLäº‹åŠ¡æ–‡æ¡£](https://www.postgresql.org/docs/current/transaction-iso.html)
- [PostgreSQL MVCCæ–‡æ¡£](https://www.postgresql.org/docs/current/mvcc.html)
- [ACIDäº‹åŠ¡ç†è®º](https://en.wikipedia.org/wiki/ACID)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v3.1
**æœ€åæ›´æ–°**: 2025-11-22
**PostgreSQLç‰ˆæœ¬**: 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x (å…¼å®¹)
**ç»´æŠ¤è€…**: Documentation Team
