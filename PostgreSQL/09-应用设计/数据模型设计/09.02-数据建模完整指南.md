# PostgreSQLæ•°æ®å»ºæ¨¡å®Œæ•´æŒ‡å—

> **ç‰ˆæœ¬**: v1.1
> **æœ€åæ›´æ–°**: 2025-11-22
> **ç‰ˆæœ¬è¦†ç›–**: PostgreSQL 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x (å…¼å®¹)
> **éš¾åº¦**: â­â­â­â­
> **åº”ç”¨åœºæ™¯**: æ•°æ®åº“è®¾è®¡ã€æ•°æ®å»ºæ¨¡ã€ç³»ç»Ÿè®¾è®¡ã€æ•°æ®æ¶æ„

---

## ğŸ“‹ ç›®å½•

- [PostgreSQLæ•°æ®å»ºæ¨¡å®Œæ•´æŒ‡å—](#postgresqlæ•°æ®å»ºæ¨¡å®Œæ•´æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [ä¸€ã€æ¦‚è¿°](#ä¸€æ¦‚è¿°)
    - [1.1 æ•°æ®å»ºæ¨¡æ¦‚å¿µ](#11-æ•°æ®å»ºæ¨¡æ¦‚å¿µ)
    - [1.2 å»ºæ¨¡å±‚æ¬¡](#12-å»ºæ¨¡å±‚æ¬¡)
    - [1.3 PostgreSQLå»ºæ¨¡ä¼˜åŠ¿](#13-postgresqlå»ºæ¨¡ä¼˜åŠ¿)
    - [1.4 ç‰ˆæœ¬è¦æ±‚](#14-ç‰ˆæœ¬è¦æ±‚)
  - [äºŒã€æ¦‚å¿µå»ºæ¨¡](#äºŒæ¦‚å¿µå»ºæ¨¡)
    - [2.1 å®ä½“è¯†åˆ«](#21-å®ä½“è¯†åˆ«)
    - [2.2 å…³ç³»è¯†åˆ«](#22-å…³ç³»è¯†åˆ«)
    - [2.3 ERå›¾è®¾è®¡](#23-erå›¾è®¾è®¡)
  - [ä¸‰ã€é€»è¾‘å»ºæ¨¡](#ä¸‰é€»è¾‘å»ºæ¨¡)
    - [3.1 å…³ç³»æ¨¡å‹è®¾è®¡](#31-å…³ç³»æ¨¡å‹è®¾è®¡)
    - [3.2 èŒƒå¼åŒ–è®¾è®¡](#32-èŒƒå¼åŒ–è®¾è®¡)
    - [3.3 åèŒƒå¼åŒ–è®¾è®¡](#33-åèŒƒå¼åŒ–è®¾è®¡)
    - [3.4 ç»´åº¦å»ºæ¨¡](#34-ç»´åº¦å»ºæ¨¡)
  - [å››ã€ç‰©ç†å»ºæ¨¡](#å››ç‰©ç†å»ºæ¨¡)
    - [4.1 è¡¨ç»“æ„è®¾è®¡](#41-è¡¨ç»“æ„è®¾è®¡)
    - [4.2 æ•°æ®ç±»å‹é€‰æ‹©](#42-æ•°æ®ç±»å‹é€‰æ‹©)
    - [4.3 çº¦æŸè®¾è®¡](#43-çº¦æŸè®¾è®¡)
    - [4.4 ç´¢å¼•è®¾è®¡](#44-ç´¢å¼•è®¾è®¡)
    - [4.5 åˆ†åŒºè®¾è®¡](#45-åˆ†åŒºè®¾è®¡)
    - [4.6 å­˜å‚¨æ¶æ„é€‰æ‹© ğŸ†•](#46-å­˜å‚¨æ¶æ„é€‰æ‹©-)
      - [ğŸ“Š å­˜å‚¨æ¶æ„é€‰æ‹©çŸ¥è¯†ä½“ç³»](#-å­˜å‚¨æ¶æ„é€‰æ‹©çŸ¥è¯†ä½“ç³»)
      - [ğŸ“Š è¡Œå­˜å‚¨ vs åˆ—å­˜å‚¨ vs æ··åˆå­˜å‚¨å¯¹æ¯”çŸ©é˜µ](#-è¡Œå­˜å‚¨-vs-åˆ—å­˜å‚¨-vs-æ··åˆå­˜å‚¨å¯¹æ¯”çŸ©é˜µ)
      - [ğŸ“Š å­˜å‚¨æ¶æ„é€‰æ‹©å†³ç­–æ ‘](#-å­˜å‚¨æ¶æ„é€‰æ‹©å†³ç­–æ ‘)
      - [ğŸ“Š å­˜å‚¨æ¶æ„è®¾è®¡ERå›¾](#-å­˜å‚¨æ¶æ„è®¾è®¡erå›¾)
      - [ğŸ“Š æ··åˆå­˜å‚¨æ¶æ„æ•°æ®æµå›¾](#-æ··åˆå­˜å‚¨æ¶æ„æ•°æ®æµå›¾)
      - [ğŸ“Š æ··åˆå­˜å‚¨æ¶æ„æŸ¥è¯¢æ—¶åºå›¾](#-æ··åˆå­˜å‚¨æ¶æ„æŸ¥è¯¢æ—¶åºå›¾)
  - [äº”ã€é«˜çº§å»ºæ¨¡æŠ€æœ¯](#äº”é«˜çº§å»ºæ¨¡æŠ€æœ¯)
    - [5.1 ç»§æ‰¿å»ºæ¨¡](#51-ç»§æ‰¿å»ºæ¨¡)
    - [5.2 JSONBå»ºæ¨¡](#52-jsonbå»ºæ¨¡)
    - [5.3 æ•°ç»„å»ºæ¨¡](#53-æ•°ç»„å»ºæ¨¡)
    - [5.4 ç‰©åŒ–è§†å›¾å»ºæ¨¡](#54-ç‰©åŒ–è§†å›¾å»ºæ¨¡)
  - [å…­ã€å»ºæ¨¡æ¨¡å¼](#å…­å»ºæ¨¡æ¨¡å¼)
    - [6.1 æ˜Ÿå‹æ¨¡å‹](#61-æ˜Ÿå‹æ¨¡å‹)
    - [6.2 é›ªèŠ±æ¨¡å‹](#62-é›ªèŠ±æ¨¡å‹)
    - [6.3 è§„èŒƒåŒ–æ¨¡å‹](#63-è§„èŒƒåŒ–æ¨¡å‹)
    - [6.4 æ··åˆæ¨¡å‹](#64-æ··åˆæ¨¡å‹)
  - [å…­ã€ç°ä»£å»ºæ¨¡æ–¹æ³•](#å…­ç°ä»£å»ºæ¨¡æ–¹æ³•)
    - [6.5 é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰](#65-é¢†åŸŸé©±åŠ¨è®¾è®¡ddd)
    - [6.6 ç»Ÿä¸€å…ƒæ¨¡å‹ï¼ˆU-Schemaï¼‰](#66-ç»Ÿä¸€å…ƒæ¨¡å‹u-schema)
  - [ä¸ƒã€å®è·µæ¡ˆä¾‹](#ä¸ƒå®è·µæ¡ˆä¾‹)
    - [7.1 ç”µå•†ç³»ç»Ÿå»ºæ¨¡](#71-ç”µå•†ç³»ç»Ÿå»ºæ¨¡)
    - [7.2 å†…å®¹ç®¡ç†ç³»ç»Ÿå»ºæ¨¡](#72-å†…å®¹ç®¡ç†ç³»ç»Ÿå»ºæ¨¡)
    - [7.3 å¤šç§Ÿæˆ·ç³»ç»Ÿå»ºæ¨¡](#73-å¤šç§Ÿæˆ·ç³»ç»Ÿå»ºæ¨¡)
  - [å…«ã€PostgreSQL 18æ–°ç‰¹æ€§](#å…«postgresql-18æ–°ç‰¹æ€§)
    - [8.1 è™šæ‹Ÿç”Ÿæˆåˆ—](#81-è™šæ‹Ÿç”Ÿæˆåˆ—)
    - [8.2 æ”¹è¿›çš„åˆ†åŒº](#82-æ”¹è¿›çš„åˆ†åŒº)
  - [ä¹ã€æœ€ä½³å®è·µ](#ä¹æœ€ä½³å®è·µ)
  - [åã€å‚è€ƒèµ„æº](#åå‚è€ƒèµ„æº)
    - [10.1 å®˜æ–¹æ–‡æ¡£](#101-å®˜æ–¹æ–‡æ¡£)
    - [10.2 ç›¸å…³æ–‡æ¡£](#102-ç›¸å…³æ–‡æ¡£)
    - [10.3 å¤–éƒ¨èµ„æº](#103-å¤–éƒ¨èµ„æº)
  - [åä¸€ã€äº¤å‰å¼•ç”¨](#åä¸€äº¤å‰å¼•ç”¨)
    - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)
    - [å¤–éƒ¨èµ„æº](#å¤–éƒ¨èµ„æº)

---

## ä¸€ã€æ¦‚è¿°

### 1.1 æ•°æ®å»ºæ¨¡æ¦‚å¿µ

**æ•°æ®å»ºæ¨¡**æ˜¯å°†ç°å®ä¸–ç•Œçš„ä¸šåŠ¡éœ€æ±‚è½¬åŒ–ä¸ºæ•°æ®åº“ç»“æ„çš„è¿‡ç¨‹ï¼ŒåŒ…æ‹¬æ¦‚å¿µå»ºæ¨¡ã€é€»è¾‘å»ºæ¨¡å’Œç‰©ç†å»ºæ¨¡ä¸‰ä¸ªå±‚æ¬¡ã€‚

**æ•°æ®å»ºæ¨¡çš„ç›®æ ‡**ï¼š

- **å‡†ç¡®æ€§**ï¼šå‡†ç¡®åæ˜ ä¸šåŠ¡éœ€æ±‚
- **å®Œæ•´æ€§**ï¼šå®Œæ•´è¦†ç›–ä¸šåŠ¡åœºæ™¯
- **æ€§èƒ½**ï¼šæ”¯æŒé«˜æ•ˆæŸ¥è¯¢å’Œæ“ä½œ
- **å¯ç»´æŠ¤æ€§**ï¼šæ˜“äºç†è§£å’Œç»´æŠ¤
- **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒæœªæ¥æ‰©å±•

### 1.2 å»ºæ¨¡å±‚æ¬¡

**ä¸‰å±‚å»ºæ¨¡æ¶æ„**ï¼š

1. **æ¦‚å¿µå»ºæ¨¡**ï¼šä¸šåŠ¡å±‚é¢çš„æŠ½è±¡ï¼Œå…³æ³¨å®ä½“å’Œå…³ç³»
2. **é€»è¾‘å»ºæ¨¡**ï¼šæ•°æ®å±‚é¢çš„è®¾è®¡ï¼Œå…³æ³¨è¡¨ç»“æ„å’Œå…³ç³»
3. **ç‰©ç†å»ºæ¨¡**ï¼šå®ç°å±‚é¢çš„ä¼˜åŒ–ï¼Œå…³æ³¨å­˜å‚¨å’Œæ€§èƒ½

### 1.3 PostgreSQLå»ºæ¨¡ä¼˜åŠ¿

**PostgreSQLåœ¨æ•°æ®å»ºæ¨¡ä¸­çš„ä¼˜åŠ¿**ï¼š

- âœ… **ä¸°å¯Œçš„æ•°æ®ç±»å‹**ï¼šæ”¯æŒå¤šç§æ•°æ®ç±»å‹å’Œè‡ªå®šä¹‰ç±»å‹
- âœ… **å¼ºå¤§çš„çº¦æŸç³»ç»Ÿ**ï¼šæ”¯æŒå¤šç§çº¦æŸå’Œè§„åˆ™
- âœ… **çµæ´»çš„ç»§æ‰¿**ï¼šæ”¯æŒè¡¨ç»§æ‰¿å’Œç±»å‹ç»§æ‰¿
- âœ… **JSONBæ”¯æŒ**ï¼šçµæ´»å¤„ç†åŠç»“æ„åŒ–æ•°æ®
- âœ… **æ•°ç»„æ”¯æŒ**ï¼šæ”¯æŒæ•°ç»„å’Œå¤åˆç±»å‹
- âœ… **åˆ†åŒºæ”¯æŒ**ï¼šæ”¯æŒå¤šç§åˆ†åŒºç­–ç•¥
- âœ… **ç‰©åŒ–è§†å›¾**ï¼šæ”¯æŒé¢„è®¡ç®—å’Œç¼“å­˜

### 1.4 ç‰ˆæœ¬è¦æ±‚

- **PostgreSQL 18.x**ï¼ˆæ¨èï¼‰- æ”¯æŒè™šæ‹Ÿç”Ÿæˆåˆ—ã€æ”¹è¿›çš„åˆ†åŒº
- **PostgreSQL 17.x**ï¼ˆæ¨èï¼‰- åŠŸèƒ½å®Œæ•´
- **PostgreSQL 16.x**ï¼ˆå…¼å®¹ï¼‰- åŸºç¡€åŠŸèƒ½æ”¯æŒ

---

## äºŒã€æ¦‚å¿µå»ºæ¨¡

### 2.1 å®ä½“è¯†åˆ«

**å®ä½“è¯†åˆ«**æ˜¯è¯†åˆ«ä¸šåŠ¡ä¸­çš„æ ¸å¿ƒå®ä½“ã€‚

**å®ä½“è¯†åˆ«æ–¹æ³•**ï¼š

```sql
-- ç¤ºä¾‹ï¼šç”µå•†ç³»ç»Ÿå®ä½“è¯†åˆ«
-- æ ¸å¿ƒå®ä½“ï¼š
-- 1. ç”¨æˆ·ï¼ˆUserï¼‰
-- 2. å•†å“ï¼ˆProductï¼‰
-- 3. è®¢å•ï¼ˆOrderï¼‰
-- 4. è®¢å•é¡¹ï¼ˆOrderItemï¼‰
-- 5. æ”¯ä»˜ï¼ˆPaymentï¼‰
-- 6. ç‰©æµï¼ˆShippingï¼‰
-- 7. è¯„ä»·ï¼ˆReviewï¼‰
-- 8. åˆ†ç±»ï¼ˆCategoryï¼‰
```

### 2.2 å…³ç³»è¯†åˆ«

**å…³ç³»è¯†åˆ«**æ˜¯è¯†åˆ«å®ä½“ä¹‹é—´çš„å…³ç³»ã€‚

**å…³ç³»ç±»å‹**ï¼š

- **ä¸€å¯¹ä¸€ï¼ˆ1:1ï¼‰**ï¼šä¸€ä¸ªå®ä½“å¯¹åº”å¦ä¸€ä¸ªå®ä½“
- **ä¸€å¯¹å¤šï¼ˆ1:Nï¼‰**ï¼šä¸€ä¸ªå®ä½“å¯¹åº”å¤šä¸ªå®ä½“
- **å¤šå¯¹å¤šï¼ˆN:Mï¼‰**ï¼šå¤šä¸ªå®ä½“å¯¹åº”å¤šä¸ªå®ä½“

**å…³ç³»è¯†åˆ«ç¤ºä¾‹**ï¼š

```sql
-- å…³ç³»è¯†åˆ«ï¼š
-- ç”¨æˆ· - è®¢å•ï¼š1å¯¹å¤š
-- è®¢å• - è®¢å•é¡¹ï¼š1å¯¹å¤š
-- å•†å“ - è®¢å•é¡¹ï¼š1å¯¹å¤š
-- ç”¨æˆ· - å•†å“ï¼ˆæ”¶è—ï¼‰ï¼šå¤šå¯¹å¤š
-- å•†å“ - åˆ†ç±»ï¼šå¤šå¯¹å¤š
```

### 2.3 ERå›¾è®¾è®¡

**ERå›¾ï¼ˆå®ä½“å…³ç³»å›¾ï¼‰**ç”¨äºå¯è§†åŒ–å®ä½“å’Œå…³ç³»ã€‚

**ERå›¾å…ƒç´ **ï¼š

- **å®ä½“**ï¼šçŸ©å½¢è¡¨ç¤º
- **å±æ€§**ï¼šæ¤­åœ†è¡¨ç¤º
- **å…³ç³»**ï¼šè±å½¢è¡¨ç¤º
- **åŸºæ•°**ï¼š1ã€Nã€Mè¡¨ç¤º

---

## ä¸‰ã€é€»è¾‘å»ºæ¨¡

### 3.1 å…³ç³»æ¨¡å‹è®¾è®¡

**å…³ç³»æ¨¡å‹è®¾è®¡**å°†æ¦‚å¿µæ¨¡å‹è½¬åŒ–ä¸ºå…³ç³»è¡¨ç»“æ„ã€‚

**åŸºæœ¬è®¾è®¡åŸåˆ™**ï¼š

```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    user_id BIGSERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- å•†å“è¡¨
CREATE TABLE products (
    product_id BIGSERIAL PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    description TEXT,
    price NUMERIC(10,2) NOT NULL CHECK (price > 0),
    stock_quantity INTEGER DEFAULT 0 CHECK (stock_quantity >= 0),
    category_id BIGINT REFERENCES categories(category_id),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- è®¢å•è¡¨
CREATE TABLE orders (
    order_id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES users(user_id),
    order_status VARCHAR(20) NOT NULL DEFAULT 'pending',
    total_amount NUMERIC(10,2) NOT NULL CHECK (total_amount >= 0),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- è®¢å•é¡¹è¡¨
CREATE TABLE order_items (
    order_item_id BIGSERIAL PRIMARY KEY,
    order_id BIGINT NOT NULL REFERENCES orders(order_id) ON DELETE CASCADE,
    product_id BIGINT NOT NULL REFERENCES products(product_id),
    quantity INTEGER NOT NULL CHECK (quantity > 0),
    unit_price NUMERIC(10,2) NOT NULL CHECK (unit_price > 0),
    subtotal NUMERIC(10,2) GENERATED ALWAYS AS (quantity * unit_price) STORED,
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### 3.2 èŒƒå¼åŒ–è®¾è®¡

**èŒƒå¼åŒ–è®¾è®¡**ç”¨äºæ¶ˆé™¤æ•°æ®å†—ä½™å’Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚

**ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰**ï¼šæ¯ä¸ªå±æ€§éƒ½æ˜¯åŸå­å€¼

```sql
-- è¿å1NFçš„ç¤ºä¾‹ï¼ˆå¤šå€¼å±æ€§ï¼‰
-- âŒ é”™è¯¯è®¾è®¡
CREATE TABLE users_bad (
    user_id BIGSERIAL PRIMARY KEY,
    phone_numbers TEXT  -- å­˜å‚¨å¤šä¸ªç”µè¯å·ç ï¼Œå¦‚"13800138000,13900139000"
);

-- âœ… æ­£ç¡®è®¾è®¡ï¼ˆ1NFï¼‰
CREATE TABLE users (
    user_id BIGSERIAL PRIMARY KEY,
    username VARCHAR(50) NOT NULL
);

CREATE TABLE user_phones (
    phone_id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES users(user_id),
    phone_number VARCHAR(20) NOT NULL,
    is_primary BOOLEAN DEFAULT FALSE
);
```

**ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰**ï¼šæ¶ˆé™¤éƒ¨åˆ†å‡½æ•°ä¾èµ–

```sql
-- è¿å2NFçš„ç¤ºä¾‹
-- âŒ é”™è¯¯è®¾è®¡ï¼ˆè®¢å•é¡¹è¡¨åŒ…å«å•†å“åç§°ï¼Œéƒ¨åˆ†ä¾èµ–è®¢å•é¡¹IDï¼‰
CREATE TABLE order_items_bad (
    order_item_id BIGSERIAL PRIMARY KEY,
    order_id BIGINT NOT NULL,
    product_id BIGINT NOT NULL,
    product_name VARCHAR(200),  -- éƒ¨åˆ†ä¾èµ–product_idï¼Œä¸ä¾èµ–order_item_id
    quantity INTEGER NOT NULL
);

-- âœ… æ­£ç¡®è®¾è®¡ï¼ˆ2NFï¼‰
CREATE TABLE order_items (
    order_item_id BIGSERIAL PRIMARY KEY,
    order_id BIGINT NOT NULL REFERENCES orders(order_id),
    product_id BIGINT NOT NULL REFERENCES products(product_id),
    quantity INTEGER NOT NULL
    -- product_nameå­˜å‚¨åœ¨productsè¡¨ä¸­
);
```

**ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰**ï¼šæ¶ˆé™¤ä¼ é€’ä¾èµ–

```sql
-- è¿å3NFçš„ç¤ºä¾‹
-- âŒ é”™è¯¯è®¾è®¡ï¼ˆè®¢å•è¡¨åŒ…å«ç”¨æˆ·åœ°å€ï¼Œä¼ é€’ä¾èµ–ï¼‰
CREATE TABLE orders_bad (
    order_id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL,
    user_address TEXT,  -- ä¼ é€’ä¾èµ–user_id
    order_date DATE NOT NULL
);

-- âœ… æ­£ç¡®è®¾è®¡ï¼ˆ3NFï¼‰
CREATE TABLE orders (
    order_id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES users(user_id),
    shipping_address_id BIGINT REFERENCES addresses(address_id),
    order_date DATE NOT NULL
);
```

**BCNFï¼ˆBoyce-CoddèŒƒå¼ï¼‰**ï¼šæ¶ˆé™¤æ‰€æœ‰å‡½æ•°ä¾èµ–

```sql
-- BCNFç¤ºä¾‹ï¼šç¡®ä¿æ‰€æœ‰å†³å®šå› ç´ éƒ½æ˜¯å€™é€‰é”®
CREATE TABLE course_instructors (
    course_id BIGINT NOT NULL,
    instructor_id BIGINT NOT NULL,
    semester VARCHAR(20) NOT NULL,
    PRIMARY KEY (course_id, instructor_id, semester),
    -- å¦‚æœæ¯ä¸ªè¯¾ç¨‹åœ¨æ¯ä¸ªå­¦æœŸåªæœ‰ä¸€ä¸ªè®²å¸ˆï¼Œåˆ™æ»¡è¶³BCNF
    UNIQUE (course_id, semester)
);
```

### 3.3 åèŒƒå¼åŒ–è®¾è®¡

**åèŒƒå¼åŒ–è®¾è®¡**åœ¨ç‰¹å®šåœºæ™¯ä¸‹é€‚åº¦å†—ä½™ä»¥æå‡æ€§èƒ½ã€‚

**åèŒƒå¼åŒ–åœºæ™¯**ï¼š

```sql
-- åœºæ™¯1ï¼šé¢‘ç¹æŸ¥è¯¢çš„èšåˆæ•°æ®
-- åœ¨è®¢å•è¡¨ä¸­å†—ä½™æ€»é‡‘é¢ï¼Œé¿å…æ¯æ¬¡æŸ¥è¯¢éƒ½è®¡ç®—
CREATE TABLE orders (
    order_id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES users(user_id),
    total_amount NUMERIC(10,2) NOT NULL,  -- å†—ä½™å­—æ®µï¼Œæå‡æŸ¥è¯¢æ€§èƒ½
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ä½¿ç”¨è§¦å‘å™¨ç»´æŠ¤ä¸€è‡´æ€§
CREATE OR REPLACE FUNCTION update_order_total()
RETURNS TRIGGER AS $$
BEGIN
    UPDATE orders
    SET total_amount = (
        SELECT COALESCE(SUM(quantity * unit_price), 0)
        FROM order_items
        WHERE order_id = NEW.order_id
    )
    WHERE order_id = NEW.order_id;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_update_order_total
AFTER INSERT OR UPDATE OR DELETE ON order_items
FOR EACH ROW EXECUTE FUNCTION update_order_total();

-- åœºæ™¯2ï¼šç»Ÿè®¡å­—æ®µå†—ä½™
CREATE TABLE products (
    product_id BIGSERIAL PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    price NUMERIC(10,2) NOT NULL,
    -- å†—ä½™ç»Ÿè®¡å­—æ®µ
    total_sales INTEGER DEFAULT 0,
    total_revenue NUMERIC(10,2) DEFAULT 0,
    avg_rating NUMERIC(3,2) DEFAULT 0,
    review_count INTEGER DEFAULT 0
);
```

### 3.4 ç»´åº¦å»ºæ¨¡

**ç»´åº¦å»ºæ¨¡**ç”¨äºæ•°æ®ä»“åº“å’Œåˆ†æç³»ç»Ÿã€‚

**æ˜Ÿå‹æ¨¡å‹**ï¼š

```sql
-- äº‹å®è¡¨ï¼ˆFact Tableï¼‰
CREATE TABLE sales_fact (
    sale_id BIGSERIAL PRIMARY KEY,
    date_id INTEGER NOT NULL REFERENCES date_dim(date_id),
    product_id INTEGER NOT NULL REFERENCES product_dim(product_id),
    customer_id INTEGER NOT NULL REFERENCES customer_dim(customer_id),
    store_id INTEGER NOT NULL REFERENCES store_dim(store_id),
    -- åº¦é‡ï¼ˆMeasuresï¼‰
    quantity INTEGER NOT NULL,
    amount NUMERIC(10,2) NOT NULL,
    cost NUMERIC(10,2) NOT NULL,
    profit NUMERIC(10,2) GENERATED ALWAYS AS (amount - cost) STORED
);

-- ç»´åº¦è¡¨ï¼ˆDimension Tablesï¼‰
CREATE TABLE date_dim (
    date_id INTEGER PRIMARY KEY,
    date DATE NOT NULL UNIQUE,
    year INTEGER NOT NULL,
    quarter INTEGER NOT NULL,
    month INTEGER NOT NULL,
    week INTEGER NOT NULL,
    day_of_month INTEGER NOT NULL,
    day_of_week INTEGER NOT NULL,
    is_weekend BOOLEAN NOT NULL,
    is_holiday BOOLEAN NOT NULL
);

CREATE TABLE product_dim (
    product_id INTEGER PRIMARY KEY,
    product_code VARCHAR(50) UNIQUE NOT NULL,
    product_name VARCHAR(200) NOT NULL,
    category_id INTEGER NOT NULL,
    category_name VARCHAR(100) NOT NULL,
    brand VARCHAR(100),
    price NUMERIC(10,2) NOT NULL
);

CREATE TABLE customer_dim (
    customer_id INTEGER PRIMARY KEY,
    customer_code VARCHAR(50) UNIQUE NOT NULL,
    customer_name VARCHAR(100) NOT NULL,
    gender VARCHAR(10),
    age INTEGER,
    city VARCHAR(100),
    region VARCHAR(100)
);

CREATE TABLE store_dim (
    store_id INTEGER PRIMARY KEY,
    store_code VARCHAR(50) UNIQUE NOT NULL,
    store_name VARCHAR(200) NOT NULL,
    city VARCHAR(100),
    region VARCHAR(100),
    store_type VARCHAR(50)
);
```

**é›ªèŠ±æ¨¡å‹**ï¼š

```sql
-- é›ªèŠ±æ¨¡å‹ï¼šç»´åº¦è¡¨è¿›ä¸€æ­¥è§„èŒƒåŒ–
CREATE TABLE product_dim (
    product_id INTEGER PRIMARY KEY,
    product_code VARCHAR(50) UNIQUE NOT NULL,
    product_name VARCHAR(200) NOT NULL,
    category_id INTEGER NOT NULL REFERENCES category_dim(category_id),
    brand_id INTEGER NOT NULL REFERENCES brand_dim(brand_id),
    price NUMERIC(10,2) NOT NULL
);

CREATE TABLE category_dim (
    category_id INTEGER PRIMARY KEY,
    category_name VARCHAR(100) NOT NULL,
    category_group_id INTEGER NOT NULL REFERENCES category_group_dim(category_group_id)
);

CREATE TABLE category_group_dim (
    category_group_id INTEGER PRIMARY KEY,
    category_group_name VARCHAR(100) NOT NULL
);

CREATE TABLE brand_dim (
    brand_id INTEGER PRIMARY KEY,
    brand_name VARCHAR(100) NOT NULL,
    manufacturer_id INTEGER NOT NULL REFERENCES manufacturer_dim(manufacturer_id)
);

CREATE TABLE manufacturer_dim (
    manufacturer_id INTEGER PRIMARY KEY,
    manufacturer_name VARCHAR(200) NOT NULL,
    country VARCHAR(100)
);
```

---

## å››ã€ç‰©ç†å»ºæ¨¡

### 4.1 è¡¨ç»“æ„è®¾è®¡

**è¡¨ç»“æ„è®¾è®¡åŸåˆ™**ï¼š

```sql
-- å®Œæ•´çš„è¡¨ç»“æ„è®¾è®¡ç¤ºä¾‹
CREATE TABLE orders (
    -- ä¸»é”®
    order_id BIGSERIAL PRIMARY KEY,

    -- å¤–é”®
    user_id BIGINT NOT NULL REFERENCES users(user_id) ON DELETE RESTRICT,

    -- ä¸šåŠ¡å­—æ®µ
    order_number VARCHAR(50) UNIQUE NOT NULL,
    order_status VARCHAR(20) NOT NULL DEFAULT 'pending'
        CHECK (order_status IN ('pending', 'paid', 'shipped', 'delivered', 'cancelled')),
    total_amount NUMERIC(10,2) NOT NULL CHECK (total_amount >= 0),

    -- æ—¶é—´æˆ³å­—æ®µ
    created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
    updated_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
    deleted_at TIMESTAMPTZ,  -- è½¯åˆ é™¤

    -- å…ƒæ•°æ®å­—æ®µ
    metadata JSONB DEFAULT '{}'::jsonb,

    -- ç´¢å¼•
    CONSTRAINT idx_orders_user_id FOREIGN KEY (user_id) REFERENCES users(user_id),
    CONSTRAINT idx_orders_status CHECK (order_status IN ('pending', 'paid', 'shipped', 'delivered', 'cancelled'))
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_orders_user_id ON orders(user_id);
CREATE INDEX idx_orders_status ON orders(order_status);
CREATE INDEX idx_orders_created_at ON orders(created_at DESC);
CREATE INDEX idx_orders_metadata ON orders USING GIN (metadata);
```

### 4.2 æ•°æ®ç±»å‹é€‰æ‹©

**æ•°æ®ç±»å‹é€‰æ‹©æŒ‡å—**ï¼š

```sql
-- æ•´æ•°ç±»å‹é€‰æ‹©
CREATE TABLE example_types (
    -- å°æ•´æ•°ï¼š-32768 åˆ° 32767
    small_int_col SMALLINT,

    -- æ•´æ•°ï¼š-2147483648 åˆ° 2147483647
    int_col INTEGER,

    -- å¤§æ•´æ•°ï¼š-9223372036854775808 åˆ° 9223372036854775807
    big_int_col BIGINT,

    -- è‡ªå¢ä¸»é”®ï¼šä½¿ç”¨BIGSERIAL
    id BIGSERIAL PRIMARY KEY,

    -- æ•°å€¼ç±»å‹ï¼šç²¾ç¡®æ•°å€¼
    price NUMERIC(10,2),  -- 10ä½æ•°å­—ï¼Œ2ä½å°æ•°
    amount DECIMAL(10,2),  -- åŒNUMERIC

    -- æµ®ç‚¹æ•°ï¼šè¿‘ä¼¼æ•°å€¼
    ratio REAL,  -- å•ç²¾åº¦
    percentage DOUBLE PRECISION,  -- åŒç²¾åº¦

    -- å­—ç¬¦ä¸²ç±»å‹
    short_text VARCHAR(50),  -- å˜é•¿å­—ç¬¦ä¸²ï¼Œæœ€å¤§50å­—ç¬¦
    long_text TEXT,  -- æ— é•¿åº¦é™åˆ¶
    fixed_text CHAR(10),  -- å®šé•¿å­—ç¬¦ä¸²ï¼Œ10å­—ç¬¦

    -- æ—¥æœŸæ—¶é—´ç±»å‹
    date_col DATE,
    time_col TIME,
    timestamp_col TIMESTAMP,  -- ä¸å¸¦æ—¶åŒº
    timestamptz_col TIMESTAMPTZ,  -- å¸¦æ—¶åŒºï¼ˆæ¨èï¼‰
    interval_col INTERVAL,

    -- å¸ƒå°”ç±»å‹
    is_active BOOLEAN DEFAULT TRUE,

    -- JSONç±»å‹
    json_col JSON,  -- æ–‡æœ¬JSON
    jsonb_col JSONB,  -- äºŒè¿›åˆ¶JSONï¼ˆæ¨èï¼Œæ”¯æŒç´¢å¼•ï¼‰

    -- æ•°ç»„ç±»å‹
    tags TEXT[],
    numbers INTEGER[],

    -- UUIDç±»å‹
    uuid_col UUID DEFAULT gen_random_uuid(),

    -- äºŒè¿›åˆ¶ç±»å‹
    binary_data BYTEA
);
```

### 4.3 çº¦æŸè®¾è®¡

**çº¦æŸè®¾è®¡**ç”¨äºä¿è¯æ•°æ®å®Œæ•´æ€§ã€‚

```sql
-- ä¸»é”®çº¦æŸ
CREATE TABLE users (
    user_id BIGSERIAL PRIMARY KEY,  -- æ–¹å¼1ï¼šåˆ—çº§çº¦æŸ
    -- æˆ–
    CONSTRAINT pk_users PRIMARY KEY (user_id)  -- æ–¹å¼2ï¼šè¡¨çº§çº¦æŸ
);

-- å¤–é”®çº¦æŸ
CREATE TABLE orders (
    order_id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES users(user_id)  -- æ–¹å¼1ï¼šåˆ—çº§çº¦æŸ
        ON DELETE RESTRICT  -- åˆ é™¤é™åˆ¶
        ON UPDATE CASCADE,  -- æ›´æ–°çº§è”
    -- æˆ–
    CONSTRAINT fk_orders_user FOREIGN KEY (user_id)  -- æ–¹å¼2ï¼šè¡¨çº§çº¦æŸ
        REFERENCES users(user_id)
        ON DELETE RESTRICT
        ON UPDATE CASCADE
);

-- å”¯ä¸€çº¦æŸ
CREATE TABLE products (
    product_id BIGSERIAL PRIMARY KEY,
    product_code VARCHAR(50) UNIQUE NOT NULL,  -- æ–¹å¼1ï¼šåˆ—çº§çº¦æŸ
    -- æˆ–
    CONSTRAINT uk_products_code UNIQUE (product_code),  -- æ–¹å¼2ï¼šè¡¨çº§çº¦æŸ
    -- å¤åˆå”¯ä¸€çº¦æŸ
    CONSTRAINT uk_products_name_category UNIQUE (product_name, category_id)
);

-- æ£€æŸ¥çº¦æŸ
CREATE TABLE orders (
    order_id BIGSERIAL PRIMARY KEY,
    total_amount NUMERIC(10,2) NOT NULL CHECK (total_amount >= 0),  -- æ–¹å¼1ï¼šåˆ—çº§çº¦æŸ
    order_status VARCHAR(20) NOT NULL,
    -- æ–¹å¼2ï¼šè¡¨çº§çº¦æŸ
    CONSTRAINT chk_orders_status CHECK (
        order_status IN ('pending', 'paid', 'shipped', 'delivered', 'cancelled')
    ),
    CONSTRAINT chk_orders_amount CHECK (total_amount >= 0)
);

-- éç©ºçº¦æŸ
CREATE TABLE users (
    user_id BIGSERIAL PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL,
    phone VARCHAR(20)  -- å…è®¸NULL
);

-- é»˜è®¤å€¼çº¦æŸ
CREATE TABLE orders (
    order_id BIGSERIAL PRIMARY KEY,
    order_status VARCHAR(20) NOT NULL DEFAULT 'pending',
    created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
    updated_at TIMESTAMPTZ DEFAULT NOW() NOT NULL
);
```

### 4.4 ç´¢å¼•è®¾è®¡

**ç´¢å¼•è®¾è®¡**ç”¨äºæå‡æŸ¥è¯¢æ€§èƒ½ã€‚

```sql
-- B-Treeç´¢å¼•ï¼ˆé»˜è®¤ï¼‰
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_orders_user_id ON orders(user_id);
CREATE INDEX idx_orders_status ON orders(order_status);

-- å¤åˆç´¢å¼•
CREATE INDEX idx_orders_user_status ON orders(user_id, order_status);
CREATE INDEX idx_orders_user_date ON orders(user_id, created_at DESC);

-- å”¯ä¸€ç´¢å¼•
CREATE UNIQUE INDEX idx_users_email_unique ON users(email);
CREATE UNIQUE INDEX idx_products_code_unique ON products(product_code);

-- éƒ¨åˆ†ç´¢å¼•ï¼ˆæ¡ä»¶ç´¢å¼•ï¼‰
CREATE INDEX idx_active_users ON users(email) WHERE is_active = TRUE;
CREATE INDEX idx_recent_orders ON orders(order_id) WHERE created_at >= '2024-01-01';

-- è¡¨è¾¾å¼ç´¢å¼•
CREATE INDEX idx_users_lower_email ON users(LOWER(email));
CREATE INDEX idx_orders_year ON orders(EXTRACT(YEAR FROM created_at));

-- è¦†ç›–ç´¢å¼•ï¼ˆINCLUDEï¼‰
CREATE INDEX idx_orders_user_covering ON orders(user_id) INCLUDE (order_status, total_amount);

-- GINç´¢å¼•ï¼ˆJSONBã€æ•°ç»„ã€å…¨æ–‡æœç´¢ï¼‰
CREATE INDEX idx_products_tags ON products USING GIN (tags);
CREATE INDEX idx_products_metadata ON products USING GIN (metadata);
CREATE INDEX idx_products_content ON products USING GIN (to_tsvector('english', description));

-- GiSTç´¢å¼•ï¼ˆç©ºé—´æ•°æ®ã€å…¨æ–‡æœç´¢ï¼‰
CREATE INDEX idx_locations_geom ON locations USING GIST (geom);

-- BRINç´¢å¼•ï¼ˆæ—¶é—´åºåˆ—æ•°æ®ï¼‰
CREATE INDEX idx_metrics_ts ON metrics USING BRIN (ts);

-- Hashç´¢å¼•ï¼ˆç­‰å€¼æŸ¥è¯¢ï¼‰
CREATE INDEX idx_users_username_hash ON users USING HASH (username);
```

### 4.5 åˆ†åŒºè®¾è®¡

**åˆ†åŒºè®¾è®¡**ç”¨äºç®¡ç†å¤§æ•°æ®è¡¨ã€‚

```sql
-- èŒƒå›´åˆ†åŒºï¼ˆRange Partitioningï¼‰
CREATE TABLE sales (
    sale_id BIGSERIAL,
    sale_date DATE NOT NULL,
    amount NUMERIC(10,2) NOT NULL,
    PRIMARY KEY (sale_id, sale_date)
) PARTITION BY RANGE (sale_date);

-- åˆ›å»ºåˆ†åŒº
CREATE TABLE sales_2024_q1 PARTITION OF sales
    FOR VALUES FROM ('2024-01-01') TO ('2024-04-01');

CREATE TABLE sales_2024_q2 PARTITION OF sales
    FOR VALUES FROM ('2024-04-01') TO ('2024-07-01');

CREATE TABLE sales_2024_q3 PARTITION OF sales
    FOR VALUES FROM ('2024-07-01') TO ('2024-10-01');

CREATE TABLE sales_2024_q4 PARTITION OF sales
    FOR VALUES FROM ('2024-10-01') TO ('2025-01-01');

-- åˆ—è¡¨åˆ†åŒºï¼ˆList Partitioningï¼‰
CREATE TABLE orders (
    order_id BIGSERIAL,
    region VARCHAR(50) NOT NULL,
    amount NUMERIC(10,2) NOT NULL,
    PRIMARY KEY (order_id, region)
) PARTITION BY LIST (region);

CREATE TABLE orders_north PARTITION OF orders
    FOR VALUES IN ('Beijing', 'Tianjin', 'Hebei');

CREATE TABLE orders_south PARTITION OF orders
    FOR VALUES IN ('Guangdong', 'Guangxi', 'Hainan');

CREATE TABLE orders_other PARTITION OF orders
    DEFAULT;

-- å“ˆå¸Œåˆ†åŒºï¼ˆHash Partitioningï¼‰
CREATE TABLE users (
    user_id BIGSERIAL PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL
) PARTITION BY HASH (user_id);

CREATE TABLE users_p0 PARTITION OF users
    FOR VALUES WITH (MODULUS 4, REMAINDER 0);

CREATE TABLE users_p1 PARTITION OF users
    FOR VALUES WITH (MODULUS 4, REMAINDER 1);

CREATE TABLE users_p2 PARTITION OF users
    FOR VALUES WITH (MODULUS 4, REMAINDER 2);

CREATE TABLE users_p3 PARTITION OF users
    FOR VALUES WITH (MODULUS 4, REMAINDER 3);
```

### 4.6 å­˜å‚¨æ¶æ„é€‰æ‹© ğŸ†•

#### ğŸ“Š å­˜å‚¨æ¶æ„é€‰æ‹©çŸ¥è¯†ä½“ç³»

```mermaid
mindmap
  root((å­˜å‚¨æ¶æ„é€‰æ‹©))
    å­˜å‚¨æ¶æ„ç±»å‹
      è¡Œå­˜å‚¨
        PostgreSQLåŸç”Ÿ
        OLTPä¼˜åŠ¿
        ç‚¹æŸ¥è¯¢ä¼˜åŒ–
      åˆ—å­˜å‚¨
        cstore_fdwæ‰©å±•
        OLAPä¼˜åŠ¿
        åˆ†ææŸ¥è¯¢ä¼˜åŒ–
      æ··åˆå­˜å‚¨
        çƒ­æ•°æ®è¡Œå­˜å‚¨
        å†·æ•°æ®åˆ—å­˜å‚¨
        æ··åˆè´Ÿè½½ä¼˜åŒ–
    é€‰æ‹©å› ç´ 
      æŸ¥è¯¢æ¨¡å¼
        ç‚¹æŸ¥è¯¢
        åˆ†ææŸ¥è¯¢
        æ··åˆæŸ¥è¯¢
      æ•°æ®è§„æ¨¡
        å°è§„æ¨¡ < 100GB
        ä¸­è§„æ¨¡ 100GB-1TB
        å¤§è§„æ¨¡ > 1TB
      æ›´æ–°é¢‘ç‡
        é¢‘ç¹æ›´æ–°
        å¶å°”æ›´æ–°
        åªè¯»åœºæ™¯
      æ€§èƒ½è¦æ±‚
        ä½å»¶è¿Ÿ
        é«˜åå
        å­˜å‚¨ä¼˜åŒ–
    è®¾è®¡æ¨¡å¼
      è¡Œå­˜å‚¨è®¾è®¡
        è¡¨ç»“æ„è®¾è®¡
        ç´¢å¼•è®¾è®¡
        åˆ†åŒºè®¾è®¡
      åˆ—å­˜å‚¨è®¾è®¡
        åˆ—å­˜å‚¨è¡¨è®¾è®¡
        å‹ç¼©é…ç½®
        æŸ¥è¯¢ä¼˜åŒ–
      æ··åˆå­˜å‚¨è®¾è®¡
        çƒ­å†·åˆ†ç¦»
        æ•°æ®è¿ç§»
        æŸ¥è¯¢è·¯ç”±
```

**å­˜å‚¨æ¶æ„æ¦‚è¿°**ï¼š

åœ¨æ•°æ®å»ºæ¨¡çš„ç‰©ç†å±‚ï¼Œéœ€è¦é€‰æ‹©åˆé€‚çš„å­˜å‚¨æ¶æ„ã€‚PostgreSQLæ”¯æŒä¸¤ç§ä¸»è¦å­˜å‚¨æ¶æ„ï¼š

1. **è¡Œå­˜å‚¨ï¼ˆRow Storageï¼‰**ï¼šPostgreSQLåŸç”Ÿå­˜å‚¨æ–¹å¼
2. **åˆ—å­˜å‚¨ï¼ˆColumn Storageï¼‰**ï¼šé€šè¿‡æ‰©å±•å®ç°ï¼Œé€‚åˆåˆ†æåœºæ™¯

#### ğŸ“Š è¡Œå­˜å‚¨ vs åˆ—å­˜å‚¨ vs æ··åˆå­˜å‚¨å¯¹æ¯”çŸ©é˜µ

| ç»´åº¦ | è¡Œå­˜å‚¨ | åˆ—å­˜å‚¨ | æ··åˆå­˜å‚¨ | æœ€ä½³é€‰æ‹© |
|------|--------|--------|---------|---------|
| **æ•°æ®ç»„ç»‡** | æŒ‰è¡Œå­˜å‚¨ï¼Œä¸€è¡Œæ•°æ®è¿ç»­å­˜å‚¨ | æŒ‰åˆ—å­˜å‚¨ï¼Œä¸€åˆ—æ•°æ®è¿ç»­å­˜å‚¨ | çƒ­æ•°æ®è¡Œå­˜å‚¨+å†·æ•°æ®åˆ—å­˜å‚¨ | - |
| **æŸ¥è¯¢æ¨¡å¼** | é€‚åˆç‚¹æŸ¥è¯¢ã€äº‹åŠ¡å¤„ç† | é€‚åˆåˆ†ææŸ¥è¯¢ã€èšåˆæ“ä½œ | é€‚åˆæ··åˆæŸ¥è¯¢ | - |
| **ç‚¹æŸ¥è¯¢** | â­â­â­â­â­ | â­â­ | â­â­â­â­ | è¡Œå­˜å‚¨ |
| **åˆ†ææŸ¥è¯¢** | â­â­ | â­â­â­â­â­ | â­â­â­â­ | åˆ—å­˜å‚¨ |
| **I/Oæ•ˆç‡** | æŸ¥è¯¢å¤šåˆ—æ—¶æ•ˆç‡é«˜ | æŸ¥è¯¢å°‘åˆ—æ—¶æ•ˆç‡é«˜ | æ ¹æ®æŸ¥è¯¢ç±»å‹é€‰æ‹© | - |
| **å‹ç¼©ç‡** | â­â­ (10-30%) | â­â­â­â­â­ (70-90%) | â­â­â­â­ (50-70%) | åˆ—å­˜å‚¨ |
| **æ›´æ–°æ€§èƒ½** | â­â­â­â­â­ | â­â­ | â­â­â­ | è¡Œå­˜å‚¨ |
| **æ’å…¥æ€§èƒ½** | â­â­â­â­â­ | â­â­ | â­â­â­ | è¡Œå­˜å‚¨ |
| **å­˜å‚¨æˆæœ¬** | â­â­ | â­â­â­â­â­ | â­â­â­â­ | åˆ—å­˜å‚¨ |
| **ç»´æŠ¤å¤æ‚åº¦** | â­â­â­â­â­ (ä½) | â­â­â­ (ä¸­) | â­â­ (é«˜) | è¡Œå­˜å‚¨ |
| **é€‚ç”¨åœºæ™¯** | OLTPã€ç‚¹æŸ¥è¯¢ã€äº‹åŠ¡å¤„ç† | OLAPã€åˆ†ææŸ¥è¯¢ã€æ•°æ®ä»“åº“ | æ··åˆè´Ÿè½½ã€å†å²æ•°æ®å½’æ¡£ | - |
| **æ•°æ®è§„æ¨¡** | ä»»æ„è§„æ¨¡ | > 100GBæ¨è | ä»»æ„è§„æ¨¡ | - |

#### ğŸ“Š å­˜å‚¨æ¶æ„é€‰æ‹©å†³ç­–æ ‘

```mermaid
flowchart TD
    A[é€‰æ‹©å­˜å‚¨æ¶æ„] --> B{æŸ¥è¯¢æ¨¡å¼}

    B -->|ç‚¹æŸ¥è¯¢ä¸ºä¸»<br/>SELECT * WHERE id = ?| C[è¡Œå­˜å‚¨ âœ…]
    B -->|åˆ†ææŸ¥è¯¢ä¸ºä¸»<br/>SELECT col1, SUM col2 GROUP BY| D{æ•°æ®é‡}
    B -->|æ··åˆåœºæ™¯<br/>ç‚¹æŸ¥è¯¢+åˆ†ææŸ¥è¯¢| J[æ··åˆå­˜å‚¨æ¶æ„ âœ…]

    D -->|< 100GB| E{æ›´æ–°é¢‘ç‡}
    D -->|100GB - 1TB| F{æ›´æ–°é¢‘ç‡}
    D -->|> 1TB| I[åˆ—å­˜å‚¨ âœ…]

    E -->|é¢‘ç¹æ›´æ–°| G[è¡Œå­˜å‚¨ + ç´¢å¼• âœ…]
    E -->|åªè¯»/å¾ˆå°‘æ›´æ–°| H[åˆ—å­˜å‚¨ âœ…]

    F -->|é¢‘ç¹æ›´æ–°| G1[è¡Œå­˜å‚¨ + åˆ†åŒº âœ…]
    F -->|åªè¯»/å¾ˆå°‘æ›´æ–°| H1[åˆ—å­˜å‚¨ âœ…]

    J --> J1[çƒ­æ•°æ®: è¡Œå­˜å‚¨<br/>æœ€è¿‘æ•°æ®]
    J --> J2[å†·æ•°æ®: åˆ—å­˜å‚¨<br/>å†å²æ•°æ®]

    style C fill:#90EE90
    style G fill:#90EE90
    style G1 fill:#90EE90
    style H fill:#87CEEB
    style H1 fill:#87CEEB
    style I fill:#87CEEB
    style J fill:#FFD700
    style J1 fill:#90EE90
    style J2 fill:#87CEEB
```

**è¡Œå­˜å‚¨è®¾è®¡**ï¼š

```sql
-- è¡Œå­˜å‚¨è¡¨ï¼ˆPostgreSQLé»˜è®¤ï¼‰
CREATE TABLE orders (
    order_id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL,
    product_id BIGINT NOT NULL,
    quantity INTEGER NOT NULL,
    amount NUMERIC(10,2) NOT NULL,
    order_date TIMESTAMPTZ NOT NULL,
    status VARCHAR(20) NOT NULL
);

-- è¡Œå­˜å‚¨ä¼˜åŠ¿ï¼š
-- âœ… ç‚¹æŸ¥è¯¢å¿«ï¼šSELECT * FROM orders WHERE order_id = 12345
-- âœ… æ›´æ–°å¿«ï¼šUPDATE orders SET status = 'shipped' WHERE order_id = 12345
-- âœ… æ’å…¥å¿«ï¼šINSERT INTO orders VALUES (...)
-- âœ… é€‚åˆOLTPåœºæ™¯
```

**åˆ—å­˜å‚¨è®¾è®¡**ï¼š

```sql
-- 1. å®‰è£…åˆ—å­˜å‚¨æ‰©å±•
CREATE EXTENSION IF NOT EXISTS cstore_fdw;

-- 2. åˆ›å»ºåˆ—å­˜å‚¨æœåŠ¡å™¨
CREATE SERVER cstore_server
FOREIGN DATA WRAPPER cstore_fdw;

-- 3. åˆ›å»ºåˆ—å­˜å‚¨è¡¨
CREATE FOREIGN TABLE analytics_columnar (
    event_id BIGINT,
    user_id BIGINT,
    event_type VARCHAR(50),
    event_time TIMESTAMPTZ,
    metric_value DOUBLE PRECISION,
    metadata JSONB
) SERVER cstore_server
OPTIONS (
    compression 'pglz',
    stripe_row_count '150000'
);

-- åˆ—å­˜å‚¨ä¼˜åŠ¿ï¼š
-- âœ… åˆ†ææŸ¥è¯¢å¿«ï¼šSELECT event_type, SUM(metric_value) FROM analytics_columnar GROUP BY event_type
-- âœ… å‹ç¼©ç‡é«˜ï¼šå­˜å‚¨ç©ºé—´èŠ‚çœ70-90%
-- âœ… I/Oå‡å°‘ï¼šåªè¯»å–éœ€è¦çš„åˆ—
-- âœ… é€‚åˆOLAPåœºæ™¯
```

#### ğŸ“Š å­˜å‚¨æ¶æ„è®¾è®¡ERå›¾

```mermaid
erDiagram
    ORDERS_HOT ||--o{ ORDER_ITEMS_HOT : "åŒ…å«"
    ORDERS_COLD ||--o{ ORDER_ITEMS_COLD : "åŒ…å«"
    ORDERS_HOT {
        bigint order_id PK
        bigint user_id FK
        timestamptz order_date
        varchar status
        numeric amount
    }
    ORDERS_COLD {
        bigint order_id PK
        bigint user_id FK
        timestamptz order_date
        varchar status
        numeric amount
    }
    ORDER_ITEMS_HOT {
        bigint item_id PK
        bigint order_id FK
        bigint product_id
        integer quantity
    }
    ORDER_ITEMS_COLD {
        bigint item_id PK
        bigint order_id FK
        bigint product_id
        integer quantity
    }
    USERS {
        bigint user_id PK
        varchar username
        varchar email
    }

    ORDERS_HOT }o--|| USERS : "å±äº"
    ORDERS_COLD }o--|| USERS : "å±äº"
```

#### ğŸ“Š æ··åˆå­˜å‚¨æ¶æ„æ•°æ®æµå›¾

```mermaid
flowchart LR
    subgraph "æ•°æ®å†™å…¥"
        A[æ–°è®¢å•æ•°æ®] --> B{è®¢å•æ—¥æœŸ}
        B -->|æœ€è¿‘3ä¸ªæœˆ| C[orders_hot<br/>è¡Œå­˜å‚¨]
        B -->|3ä¸ªæœˆä»¥å‰| D[orders_cold<br/>åˆ—å­˜å‚¨]
    end

    subgraph "æ•°æ®è¿ç§»"
        E[å®šæ—¶ä»»åŠ¡] --> F{æ£€æŸ¥orders_hot}
        F -->|è¶…è¿‡3ä¸ªæœˆ| G[è¿ç§»åˆ°orders_cold]
        G --> H[è½¬æ¢ä¸ºåˆ—å­˜å‚¨]
    end

    subgraph "æŸ¥è¯¢è·¯ç”±"
        I[æŸ¥è¯¢è¯·æ±‚] --> J{æŸ¥è¯¢æ¡ä»¶}
        J -->|æœ€è¿‘3ä¸ªæœˆ| K[æŸ¥è¯¢orders_hot]
        J -->|å†å²æ•°æ®| L[æŸ¥è¯¢orders_cold]
        J -->|å…¨é‡æ•°æ®| M[UNIONæŸ¥è¯¢]
    end

    C --> E
    K --> N[è¿”å›ç»“æœ]
    L --> N
    M --> N

    style C fill:#90EE90
    style D fill:#87CEEB
    style K fill:#90EE90
    style L fill:#87CEEB
```

**æ··åˆå­˜å‚¨æ¶æ„è®¾è®¡**ï¼š

```sql
-- æ··åˆå­˜å‚¨æ¶æ„ï¼šçƒ­æ•°æ®è¡Œå­˜å‚¨ + å†·æ•°æ®åˆ—å­˜å‚¨

-- 1. çƒ­æ•°æ®è¡¨ï¼ˆè¡Œå­˜å‚¨ï¼Œæœ€è¿‘3ä¸ªæœˆï¼‰
CREATE TABLE orders_hot (
    order_id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL,
    product_id BIGINT NOT NULL,
    quantity INTEGER NOT NULL,
    amount NUMERIC(10,2) NOT NULL,
    order_date TIMESTAMPTZ NOT NULL,
    status VARCHAR(20) NOT NULL
) PARTITION BY RANGE (order_date);

-- 2. å†·æ•°æ®è¡¨ï¼ˆåˆ—å­˜å‚¨ï¼Œ3ä¸ªæœˆä»¥å‰ï¼‰
CREATE FOREIGN TABLE orders_cold (
    order_id BIGINT,
    user_id BIGINT,
    product_id BIGINT,
    quantity INTEGER,
    amount NUMERIC(10,2),
    order_date TIMESTAMPTZ,
    status VARCHAR(20)
) SERVER cstore_server
OPTIONS (
    compression 'pglz',
    stripe_row_count '150000'
);

-- 3. ç»Ÿä¸€è§†å›¾ï¼ˆé€æ˜è®¿é—®ï¼‰
CREATE VIEW orders_all AS
SELECT * FROM orders_hot
UNION ALL
SELECT * FROM orders_cold;

-- 4. å®šæœŸå½’æ¡£å‡½æ•°
CREATE OR REPLACE FUNCTION archive_old_orders()
RETURNS void AS $$
BEGIN
    -- å°†3ä¸ªæœˆå‰çš„æ•°æ®è¿ç§»åˆ°åˆ—å­˜å‚¨
    INSERT INTO orders_cold
    SELECT order_id, user_id, product_id, quantity, amount, order_date, status
    FROM orders_hot
    WHERE order_date < CURRENT_DATE - INTERVAL '3 months';

    -- åˆ é™¤å·²å½’æ¡£çš„æ•°æ®
    DELETE FROM orders_hot
    WHERE order_date < CURRENT_DATE - INTERVAL '3 months';
END;
$$ LANGUAGE plpgsql;
```

#### ğŸ“Š æ··åˆå­˜å‚¨æ¶æ„æŸ¥è¯¢æ—¶åºå›¾

```mermaid
sequenceDiagram
    participant Client
    participant Query Router
    participant OrdersHot
    participant OrdersCold
    participant Result Merger

    Client->>Query Router: SELECT * FROM orders WHERE order_date BETWEEN ? AND ?
    Query Router->>Query Router: åˆ†ææŸ¥è¯¢æ¡ä»¶

    alt æŸ¥è¯¢æœ€è¿‘3ä¸ªæœˆæ•°æ®
        Query Router->>OrdersHot: æŸ¥è¯¢çƒ­æ•°æ®è¡¨
        OrdersHot-->>Query Router: è¿”å›çƒ­æ•°æ®
    else æŸ¥è¯¢å†å²æ•°æ®
        Query Router->>OrdersCold: æŸ¥è¯¢å†·æ•°æ®è¡¨ï¼ˆåˆ—å­˜å‚¨ï¼‰
        OrdersCold-->>Query Router: è¿”å›å†·æ•°æ®
    else æŸ¥è¯¢è·¨æ—¶é—´æ®µæ•°æ®
        Query Router->>OrdersHot: æŸ¥è¯¢çƒ­æ•°æ®
        Query Router->>OrdersCold: æŸ¥è¯¢å†·æ•°æ®
        OrdersHot-->>Result Merger: çƒ­æ•°æ®ç»“æœ
        OrdersCold-->>Result Merger: å†·æ•°æ®ç»“æœ
        Result Merger->>Result Merger: UNIONåˆå¹¶ç»“æœ
        Result Merger-->>Query Router: åˆå¹¶ç»“æœ
    end

    Query Router-->>Client: è¿”å›æœ€ç»ˆç»“æœ
```

**å­˜å‚¨æ¶æ„é€‰æ‹©æœ€ä½³å®è·µ**ï¼š

1. **OLTPç³»ç»Ÿ**ï¼šä½¿ç”¨è¡Œå­˜å‚¨
   - ç‚¹æŸ¥è¯¢ä¸ºä¸»
   - é¢‘ç¹æ›´æ–°
   - äº‹åŠ¡å¤„ç†

2. **OLAPç³»ç»Ÿ**ï¼šä½¿ç”¨åˆ—å­˜å‚¨
   - åˆ†ææŸ¥è¯¢ä¸ºä¸»
   - åªè¯»æˆ–å¾ˆå°‘æ›´æ–°
   - å¤§é‡èšåˆæ“ä½œ

3. **æ··åˆç³»ç»Ÿ**ï¼šä½¿ç”¨æ··åˆå­˜å‚¨
   - çƒ­æ•°æ®è¡Œå­˜å‚¨ï¼ˆæ”¯æŒæ›´æ–°ï¼‰
   - å†·æ•°æ®åˆ—å­˜å‚¨ï¼ˆåªè¯»åˆ†æï¼‰

4. **æ•°æ®ä»“åº“**ï¼šä½¿ç”¨åˆ—å­˜å‚¨
   - å†å²æ•°æ®æŸ¥è¯¢
   - åˆ†ææŠ¥è¡¨
   - æ•°æ®æŒ–æ˜

---

## äº”ã€é«˜çº§å»ºæ¨¡æŠ€æœ¯

### 5.1 ç»§æ‰¿å»ºæ¨¡

**è¡¨ç»§æ‰¿**ç”¨äºå»ºæ¨¡å±‚æ¬¡ç»“æ„ã€‚

```sql
-- çˆ¶è¡¨
CREATE TABLE vehicles (
    vehicle_id BIGSERIAL PRIMARY KEY,
    brand VARCHAR(50) NOT NULL,
    model VARCHAR(50) NOT NULL,
    year INTEGER NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- å­è¡¨ç»§æ‰¿
CREATE TABLE cars (
    num_doors INTEGER NOT NULL,
    fuel_type VARCHAR(20) NOT NULL
) INHERITS (vehicles);

CREATE TABLE trucks (
    load_capacity NUMERIC(10,2) NOT NULL,
    num_axles INTEGER NOT NULL
) INHERITS (vehicles);

-- æŸ¥è¯¢çˆ¶è¡¨ä¼šåŒ…å«æ‰€æœ‰å­è¡¨æ•°æ®
SELECT * FROM vehicles;  -- åŒ…å«carså’Œtrucksçš„æ•°æ®

-- åªæŸ¥è¯¢çˆ¶è¡¨æ•°æ®ï¼ˆä¸åŒ…å«å­è¡¨ï¼‰
SELECT * FROM ONLY vehicles;
```

### 5.2 JSONBå»ºæ¨¡

**JSONBå»ºæ¨¡**ç”¨äºçµæ´»çš„åŠç»“æ„åŒ–æ•°æ®ã€‚

```sql
-- ä½¿ç”¨JSONBå­˜å‚¨çµæ´»æ•°æ®
CREATE TABLE products (
    product_id BIGSERIAL PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    price NUMERIC(10,2) NOT NULL,
    -- JSONBå­—æ®µå­˜å‚¨çµæ´»å±æ€§
    attributes JSONB DEFAULT '{}'::jsonb,
    specifications JSONB DEFAULT '{}'::jsonb,
    metadata JSONB DEFAULT '{}'::jsonb
);

-- åˆ›å»ºGINç´¢å¼•æ”¯æŒJSONBæŸ¥è¯¢
CREATE INDEX idx_products_attributes ON products USING GIN (attributes);
CREATE INDEX idx_products_specifications ON products USING GIN (specifications);

-- JSONBæŸ¥è¯¢ç¤ºä¾‹
SELECT *
FROM products
WHERE attributes->>'color' = 'red'
  AND (attributes->>'size')::INTEGER > 10
  AND specifications @> '{"brand": "Apple"}'::jsonb;
```

### 5.3 æ•°ç»„å»ºæ¨¡

**æ•°ç»„å»ºæ¨¡**ç”¨äºå­˜å‚¨åˆ—è¡¨æ•°æ®ã€‚

```sql
-- ä½¿ç”¨æ•°ç»„å­˜å‚¨æ ‡ç­¾ã€åˆ†ç±»ç­‰
CREATE TABLE articles (
    article_id BIGSERIAL PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    content TEXT NOT NULL,
    tags TEXT[] DEFAULT '{}',
    categories INTEGER[] DEFAULT '{}',
    author_ids INTEGER[] DEFAULT '{}'
);

-- æ•°ç»„æŸ¥è¯¢
SELECT *
FROM articles
WHERE 'PostgreSQL' = ANY(tags)
  AND 1 = ANY(categories);

-- æ•°ç»„æ“ä½œ
UPDATE articles
SET tags = array_append(tags, 'NewTag')
WHERE article_id = 1;

UPDATE articles
SET tags = array_remove(tags, 'OldTag')
WHERE article_id = 1;
```

### 5.4 ç‰©åŒ–è§†å›¾å»ºæ¨¡

**ç‰©åŒ–è§†å›¾**ç”¨äºé¢„è®¡ç®—å’Œç¼“å­˜ã€‚

```sql
-- åˆ›å»ºç‰©åŒ–è§†å›¾
CREATE MATERIALIZED VIEW mv_sales_summary AS
SELECT
    DATE_TRUNC('month', sale_date) AS month,
    category_id,
    COUNT(*) AS order_count,
    SUM(amount) AS total_amount,
    AVG(amount) AS avg_amount
FROM sales
GROUP BY DATE_TRUNC('month', sale_date), category_id;

-- åˆ›å»ºå”¯ä¸€ç´¢å¼•æ”¯æŒCONCURRENTLYåˆ·æ–°
CREATE UNIQUE INDEX ON mv_sales_summary(month, category_id);

-- åˆ·æ–°ç‰©åŒ–è§†å›¾
REFRESH MATERIALIZED VIEW CONCURRENTLY mv_sales_summary;
```

---

## å…­ã€å»ºæ¨¡æ¨¡å¼

### 6.1 æ˜Ÿå‹æ¨¡å‹

**æ˜Ÿå‹æ¨¡å‹**æ˜¯æ•°æ®ä»“åº“çš„ç»å…¸æ¨¡å‹ã€‚

```sql
-- æ˜Ÿå‹æ¨¡å‹ï¼šä¸€ä¸ªäº‹å®è¡¨ + å¤šä¸ªç»´åº¦è¡¨
-- äº‹å®è¡¨
CREATE TABLE sales_fact (
    sale_id BIGSERIAL PRIMARY KEY,
    date_id INTEGER NOT NULL REFERENCES date_dim(date_id),
    product_id INTEGER NOT NULL REFERENCES product_dim(product_id),
    customer_id INTEGER NOT NULL REFERENCES customer_dim(customer_id),
    store_id INTEGER NOT NULL REFERENCES store_dim(store_id),
    quantity INTEGER NOT NULL,
    amount NUMERIC(10,2) NOT NULL
);

-- ç»´åº¦è¡¨ï¼ˆæ‰å¹³åŒ–ï¼Œä¸è§„èŒƒåŒ–ï¼‰
CREATE TABLE product_dim (
    product_id INTEGER PRIMARY KEY,
    product_code VARCHAR(50) UNIQUE NOT NULL,
    product_name VARCHAR(200) NOT NULL,
    category_name VARCHAR(100) NOT NULL,  -- ç›´æ¥å­˜å‚¨ï¼Œä¸å¼•ç”¨categoryè¡¨
    brand_name VARCHAR(100) NOT NULL,  -- ç›´æ¥å­˜å‚¨ï¼Œä¸å¼•ç”¨brandè¡¨
    price NUMERIC(10,2) NOT NULL
);
```

### 6.2 é›ªèŠ±æ¨¡å‹

**é›ªèŠ±æ¨¡å‹**æ˜¯è§„èŒƒåŒ–çš„ç»´åº¦æ¨¡å‹ã€‚

```sql
-- é›ªèŠ±æ¨¡å‹ï¼šç»´åº¦è¡¨è¿›ä¸€æ­¥è§„èŒƒåŒ–
CREATE TABLE product_dim (
    product_id INTEGER PRIMARY KEY,
    product_code VARCHAR(50) UNIQUE NOT NULL,
    product_name VARCHAR(200) NOT NULL,
    category_id INTEGER NOT NULL REFERENCES category_dim(category_id),
    brand_id INTEGER NOT NULL REFERENCES brand_dim(brand_id)
);

CREATE TABLE category_dim (
    category_id INTEGER PRIMARY KEY,
    category_name VARCHAR(100) NOT NULL,
    category_group_id INTEGER NOT NULL REFERENCES category_group_dim(category_group_id)
);
```

### 6.3 è§„èŒƒåŒ–æ¨¡å‹

**è§„èŒƒåŒ–æ¨¡å‹**ç”¨äºOLTPç³»ç»Ÿã€‚

```sql
-- è§„èŒƒåŒ–æ¨¡å‹ï¼šæ¶ˆé™¤å†—ä½™ï¼Œä¿è¯ä¸€è‡´æ€§
CREATE TABLE users (
    user_id BIGSERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL
);

CREATE TABLE orders (
    order_id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES users(user_id),
    order_date DATE NOT NULL
);

CREATE TABLE order_items (
    order_item_id BIGSERIAL PRIMARY KEY,
    order_id BIGINT NOT NULL REFERENCES orders(order_id),
    product_id BIGINT NOT NULL REFERENCES products(product_id),
    quantity INTEGER NOT NULL
);
```

### 6.4 æ··åˆæ¨¡å‹

**æ··åˆæ¨¡å‹**ç»“åˆå¤šç§å»ºæ¨¡æ–¹æ³•ã€‚

```sql
-- æ··åˆæ¨¡å‹ï¼šOLTPä½¿ç”¨è§„èŒƒåŒ–ï¼ŒOLAPä½¿ç”¨ç»´åº¦å»ºæ¨¡
-- OLTPè¡¨ï¼ˆè§„èŒƒåŒ–ï¼‰
CREATE TABLE orders_oltp (
    order_id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES users(user_id),
    order_date DATE NOT NULL
);

-- OLAPè¡¨ï¼ˆç»´åº¦å»ºæ¨¡ï¼‰
CREATE TABLE sales_fact (
    sale_id BIGSERIAL PRIMARY KEY,
    date_id INTEGER NOT NULL REFERENCES date_dim(date_id),
    product_id INTEGER NOT NULL REFERENCES product_dim(product_id),
    customer_id INTEGER NOT NULL REFERENCES customer_dim(customer_id),
    amount NUMERIC(10,2) NOT NULL
);

-- ETLå°†OLTPæ•°æ®è½¬æ¢ä¸ºOLAPæ•°æ®
```

---

## å…­ã€ç°ä»£å»ºæ¨¡æ–¹æ³•

### 6.5 é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰

**é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDomain-Driven Design, DDDï¼‰**æ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡æ–¹æ³•ï¼Œå¼ºè°ƒå°†è½¯ä»¶çš„ç»“æ„å’Œè¯­è¨€ä¸ä¸šåŠ¡é¢†åŸŸçš„ä¹ æƒ¯ç”¨æ³•ç›¸ä¸€è‡´ã€‚åœ¨PostgreSQLæ•°æ®å»ºæ¨¡ä¸­ï¼ŒDDDæ–¹æ³•æœ‰åŠ©äºåˆ›å»ºç¬¦åˆä¸šåŠ¡éœ€æ±‚çš„æ¨¡å‹ã€‚

**DDDæ ¸å¿ƒæ¦‚å¿µ**ï¼š

1. **é¢†åŸŸï¼ˆDomainï¼‰**ï¼šä¸šåŠ¡é¢†åŸŸï¼ŒåŒ…å«ä¸šåŠ¡é€»è¾‘å’Œè§„åˆ™
2. **å®ä½“ï¼ˆEntityï¼‰**ï¼šå…·æœ‰å”¯ä¸€æ ‡è¯†çš„å¯¹è±¡
3. **å€¼å¯¹è±¡ï¼ˆValue Objectï¼‰**ï¼šæ²¡æœ‰å”¯ä¸€æ ‡è¯†çš„å¯¹è±¡ï¼Œé€šè¿‡å±æ€§å€¼å®šä¹‰
4. **èšåˆï¼ˆAggregateï¼‰**ï¼šä¸€ç»„ç›¸å…³å¯¹è±¡çš„é›†åˆï¼Œæœ‰æ˜ç¡®çš„è¾¹ç•Œ
5. **ä»“å‚¨ï¼ˆRepositoryï¼‰**ï¼šæ•°æ®è®¿é—®æŠ½è±¡å±‚

**PostgreSQLä¸­çš„DDDå®ç°**ï¼š

```sql
-- 1. å®ä½“å»ºæ¨¡ï¼šä½¿ç”¨ä¸»é”®æ ‡è¯†å®ä½“
CREATE TABLE users (
    user_id BIGSERIAL PRIMARY KEY,  -- å®ä½“æ ‡è¯†
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL
);

-- 2. å€¼å¯¹è±¡å»ºæ¨¡ï¼šä½¿ç”¨å¤åˆç±»å‹æˆ–JSONB
CREATE TYPE address_type AS (
    street TEXT,
    city VARCHAR(100),
    province VARCHAR(100),
    postal_code VARCHAR(10)
);

CREATE TABLE orders (
    order_id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES users(user_id),
    shipping_address address_type NOT NULL,  -- å€¼å¯¹è±¡
    billing_address address_type NOT NULL,   -- å€¼å¯¹è±¡
    created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL
);

-- æˆ–ä½¿ç”¨JSONBå­˜å‚¨å€¼å¯¹è±¡
CREATE TABLE orders_jsonb (
    order_id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES users(user_id),
    shipping_address JSONB NOT NULL,  -- å€¼å¯¹è±¡
    billing_address JSONB NOT NULL,   -- å€¼å¯¹è±¡
    created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL
);

-- 3. èšåˆå»ºæ¨¡ï¼šä½¿ç”¨äº‹åŠ¡è¾¹ç•Œå’Œçº¦æŸä¿è¯ä¸€è‡´æ€§
CREATE TABLE order_aggregate (
    order_id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES users(user_id),
    order_status VARCHAR(20) NOT NULL DEFAULT 'pending',
    total_amount NUMERIC(10,2) NOT NULL CHECK (total_amount >= 0),
    created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
    updated_at TIMESTAMPTZ DEFAULT NOW() NOT NULL
);

-- è®¢å•é¡¹ï¼ˆèšåˆå†…çš„å®ä½“ï¼‰
CREATE TABLE order_items (
    order_item_id BIGSERIAL PRIMARY KEY,
    order_id BIGINT NOT NULL REFERENCES order_aggregate(order_id) ON DELETE CASCADE,
    product_id BIGINT NOT NULL REFERENCES products(product_id),
    quantity INTEGER NOT NULL CHECK (quantity > 0),
    unit_price NUMERIC(10,2) NOT NULL CHECK (unit_price > 0),
    subtotal NUMERIC(10,2) GENERATED ALWAYS AS (quantity * unit_price) STORED
);

-- 4. é¢†åŸŸäº‹ä»¶å»ºæ¨¡ï¼šä½¿ç”¨è§¦å‘å™¨è®°å½•é¢†åŸŸäº‹ä»¶
CREATE TABLE domain_events (
    event_id BIGSERIAL PRIMARY KEY,
    aggregate_type VARCHAR(100) NOT NULL,
    aggregate_id BIGINT NOT NULL,
    event_type VARCHAR(100) NOT NULL,
    event_data JSONB NOT NULL,
    occurred_at TIMESTAMPTZ DEFAULT NOW() NOT NULL
);

CREATE INDEX idx_domain_events_aggregate ON domain_events(aggregate_type, aggregate_id);
CREATE INDEX idx_domain_events_type ON domain_events(event_type);
CREATE INDEX idx_domain_events_occurred_at ON domain_events(occurred_at DESC);

-- é¢†åŸŸäº‹ä»¶è§¦å‘å™¨ç¤ºä¾‹
CREATE OR REPLACE FUNCTION record_order_created_event()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO domain_events (aggregate_type, aggregate_id, event_type, event_data)
    VALUES ('Order', NEW.order_id, 'OrderCreated', jsonb_build_object(
        'order_id', NEW.order_id,
        'user_id', NEW.user_id,
        'total_amount', NEW.total_amount,
        'created_at', NEW.created_at
    ));
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER order_created_event
AFTER INSERT ON order_aggregate
FOR EACH ROW
EXECUTE FUNCTION record_order_created_event();
```

**DDDæœ€ä½³å®è·µ**ï¼š

1. **ç»Ÿä¸€è¯­è¨€ï¼ˆUbiquitous Languageï¼‰**ï¼šä½¿ç”¨ä¸šåŠ¡æœ¯è¯­å‘½åè¡¨å’Œå­—æ®µ
2. **èšåˆè¾¹ç•Œ**ï¼šé€šè¿‡å¤–é”®çº¦æŸå’Œçº§è”æ“ä½œå®šä¹‰èšåˆè¾¹ç•Œ
3. **é¢†åŸŸäº‹ä»¶**ï¼šä½¿ç”¨è§¦å‘å™¨æˆ–åº”ç”¨å±‚è®°å½•é¢†åŸŸäº‹ä»¶
4. **ä»“å‚¨æ¨¡å¼**ï¼šä½¿ç”¨è§†å›¾æˆ–å‡½æ•°å°è£…å¤æ‚æŸ¥è¯¢

### 6.6 ç»Ÿä¸€å…ƒæ¨¡å‹ï¼ˆU-Schemaï¼‰

**ç»Ÿä¸€å…ƒæ¨¡å‹ï¼ˆU-Schemaï¼‰**æ˜¯ä¸€ç§èƒ½å¤Ÿè¡¨ç¤ºå¤šç§æ•°æ®æ¨¡å‹ï¼ˆå…³ç³»å‹ã€æ–‡æ¡£å‹ã€é”®å€¼å‹ã€å›¾å‹ï¼‰çš„ç»Ÿä¸€è¡¨ç¤ºæ–¹æ³•ã€‚åœ¨PostgreSQLä¸­ï¼Œå¯ä»¥ä½¿ç”¨JSONBå’Œæ‰©å±•æ¥æ”¯æŒå¤šæ¨¡å‹æ•°æ®ã€‚

**PostgreSQLå¤šæ¨¡å‹æ”¯æŒ**ï¼š

```sql
-- 1. å…³ç³»æ¨¡å‹ï¼ˆä¼ ç»Ÿè¡¨ï¼‰
CREATE TABLE users_relational (
    user_id BIGSERIAL PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL
);

-- 2. æ–‡æ¡£æ¨¡å‹ï¼ˆJSONBï¼‰
CREATE TABLE users_document (
    user_id BIGSERIAL PRIMARY KEY,
    user_data JSONB NOT NULL
);

-- ç¤ºä¾‹æ•°æ®
INSERT INTO users_document (user_data) VALUES (
    '{
        "username": "john_doe",
        "email": "john@example.com",
        "profile": {
            "firstName": "John",
            "lastName": "Doe",
            "age": 30
        },
        "addresses": [
            {"type": "home", "street": "123 Main St", "city": "New York"},
            {"type": "work", "street": "456 Park Ave", "city": "New York"}
        ]
    }'::jsonb
);

-- 3. é”®å€¼æ¨¡å‹ï¼ˆä½¿ç”¨HSTOREæˆ–JSONBï¼‰
CREATE EXTENSION IF NOT EXISTS hstore;

CREATE TABLE users_keyvalue (
    user_id BIGSERIAL PRIMARY KEY,
    user_properties HSTORE
);

INSERT INTO users_keyvalue (user_properties) VALUES (
    'username => john_doe, email => john@example.com, age => 30'::hstore
);

-- 4. å›¾æ¨¡å‹ï¼ˆä½¿ç”¨é€’å½’CTEæˆ–pg_graphæ‰©å±•ï¼‰
-- ä½¿ç”¨é€’å½’CTEå®ç°å›¾æŸ¥è¯¢
CREATE TABLE graph_nodes (
    node_id BIGSERIAL PRIMARY KEY,
    node_type VARCHAR(50) NOT NULL,
    properties JSONB DEFAULT '{}'::jsonb
);

CREATE TABLE graph_edges (
    edge_id BIGSERIAL PRIMARY KEY,
    source_id BIGINT NOT NULL REFERENCES graph_nodes(node_id),
    target_id BIGINT NOT NULL REFERENCES graph_nodes(node_id),
    edge_type VARCHAR(50) NOT NULL,
    properties JSONB DEFAULT '{}'::jsonb,
    UNIQUE(source_id, target_id, edge_type)
);

-- å›¾æŸ¥è¯¢ï¼šæŸ¥æ‰¾ç”¨æˆ·çš„æœ‹å‹çš„æœ‹å‹
WITH RECURSIVE friend_graph AS (
    -- èµ·å§‹èŠ‚ç‚¹
    SELECT target_id AS friend_id, 1 AS depth
    FROM graph_edges
    WHERE source_id = 1 AND edge_type = 'FRIEND'

    UNION ALL

    -- é€’å½’ï¼šæœ‹å‹çš„æœ‹å‹
    SELECT e.target_id, fg.depth + 1
    FROM friend_graph fg
    JOIN graph_edges e ON e.source_id = fg.friend_id AND e.edge_type = 'FRIEND'
    WHERE fg.depth < 2
)
SELECT DISTINCT friend_id, depth
FROM friend_graph
ORDER BY depth, friend_id;
```

**ç»Ÿä¸€å…ƒæ¨¡å‹ä¼˜åŠ¿**ï¼š

- **çµæ´»æ€§**ï¼šæ”¯æŒå¤šç§æ•°æ®æ¨¡å‹
- **ä¸€è‡´æ€§**ï¼šç»Ÿä¸€çš„æŸ¥è¯¢æ¥å£
- **å¯æ‰©å±•æ€§**ï¼šæ˜“äºæ·»åŠ æ–°çš„æ•°æ®æ¨¡å‹æ”¯æŒ

---

## ä¸ƒã€å®è·µæ¡ˆä¾‹

### 7.1 ç”µå•†ç³»ç»Ÿå»ºæ¨¡

**ç”µå•†ç³»ç»Ÿå®Œæ•´å»ºæ¨¡ç¤ºä¾‹**ï¼š

```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    user_id BIGSERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    phone VARCHAR(20),
    created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
    updated_at TIMESTAMPTZ DEFAULT NOW() NOT NULL
);

-- åœ°å€è¡¨
CREATE TABLE addresses (
    address_id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES users(user_id) ON DELETE CASCADE,
    address_type VARCHAR(20) NOT NULL DEFAULT 'shipping',
    recipient_name VARCHAR(100) NOT NULL,
    phone VARCHAR(20) NOT NULL,
    province VARCHAR(50) NOT NULL,
    city VARCHAR(50) NOT NULL,
    district VARCHAR(50) NOT NULL,
    street TEXT NOT NULL,
    postal_code VARCHAR(10),
    is_default BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL
);

-- å•†å“è¡¨
CREATE TABLE products (
    product_id BIGSERIAL PRIMARY KEY,
    product_code VARCHAR(50) UNIQUE NOT NULL,
    name VARCHAR(200) NOT NULL,
    description TEXT,
    price NUMERIC(10,2) NOT NULL CHECK (price > 0),
    original_price NUMERIC(10,2),
    stock_quantity INTEGER DEFAULT 0 CHECK (stock_quantity >= 0),
    category_id BIGINT REFERENCES categories(category_id),
    brand_id BIGINT REFERENCES brands(brand_id),
    status VARCHAR(20) DEFAULT 'active' CHECK (status IN ('active', 'inactive', 'deleted')),
    created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
    updated_at TIMESTAMPTZ DEFAULT NOW() NOT NULL
);

-- è®¢å•è¡¨
CREATE TABLE orders (
    order_id BIGSERIAL PRIMARY KEY,
    order_number VARCHAR(50) UNIQUE NOT NULL,
    user_id BIGINT NOT NULL REFERENCES users(user_id),
    shipping_address_id BIGINT NOT NULL REFERENCES addresses(address_id),
    order_status VARCHAR(20) NOT NULL DEFAULT 'pending'
        CHECK (order_status IN ('pending', 'paid', 'shipped', 'delivered', 'cancelled', 'refunded')),
    total_amount NUMERIC(10,2) NOT NULL CHECK (total_amount >= 0),
    shipping_fee NUMERIC(10,2) DEFAULT 0 CHECK (shipping_fee >= 0),
    discount_amount NUMERIC(10,2) DEFAULT 0 CHECK (discount_amount >= 0),
    payment_method VARCHAR(50),
    payment_status VARCHAR(20) DEFAULT 'unpaid',
    created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
    updated_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
    paid_at TIMESTAMPTZ,
    shipped_at TIMESTAMPTZ,
    delivered_at TIMESTAMPTZ
);

-- è®¢å•é¡¹è¡¨
CREATE TABLE order_items (
    order_item_id BIGSERIAL PRIMARY KEY,
    order_id BIGINT NOT NULL REFERENCES orders(order_id) ON DELETE CASCADE,
    product_id BIGINT NOT NULL REFERENCES products(product_id),
    product_name VARCHAR(200) NOT NULL,  -- å†—ä½™å­—æ®µï¼Œä¿å­˜ä¸‹å•æ—¶çš„å•†å“åç§°
    product_price NUMERIC(10,2) NOT NULL,  -- å†—ä½™å­—æ®µï¼Œä¿å­˜ä¸‹å•æ—¶çš„ä»·æ ¼
    quantity INTEGER NOT NULL CHECK (quantity > 0),
    subtotal NUMERIC(10,2) GENERATED ALWAYS AS (quantity * product_price) STORED,
    created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_orders_user_id ON orders(user_id);
CREATE INDEX idx_orders_status ON orders(order_status);
CREATE INDEX idx_orders_created_at ON orders(created_at DESC);
CREATE INDEX idx_order_items_order_id ON order_items(order_id);
CREATE INDEX idx_order_items_product_id ON order_items(product_id);
```

### 7.2 å†…å®¹ç®¡ç†ç³»ç»Ÿå»ºæ¨¡

**å†…å®¹ç®¡ç†ç³»ç»Ÿå»ºæ¨¡ç¤ºä¾‹**ï¼š

```sql
-- æ–‡ç« è¡¨
CREATE TABLE articles (
    article_id BIGSERIAL PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    slug VARCHAR(200) UNIQUE NOT NULL,
    content TEXT NOT NULL,
    excerpt TEXT,
    author_id BIGINT NOT NULL REFERENCES users(user_id),
    category_id BIGINT REFERENCES categories(category_id),
    tags TEXT[] DEFAULT '{}',
    status VARCHAR(20) DEFAULT 'draft' CHECK (status IN ('draft', 'published', 'archived')),
    view_count INTEGER DEFAULT 0,
    like_count INTEGER DEFAULT 0,
    comment_count INTEGER DEFAULT 0,
    published_at TIMESTAMPTZ,
    created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
    updated_at TIMESTAMPTZ DEFAULT NOW() NOT NULL
);

-- è¯„è®ºè¡¨
CREATE TABLE comments (
    comment_id BIGSERIAL PRIMARY KEY,
    article_id BIGINT NOT NULL REFERENCES articles(article_id) ON DELETE CASCADE,
    user_id BIGINT REFERENCES users(user_id) ON DELETE SET NULL,
    parent_id BIGINT REFERENCES comments(comment_id) ON DELETE CASCADE,
    content TEXT NOT NULL,
    status VARCHAR(20) DEFAULT 'approved' CHECK (status IN ('pending', 'approved', 'rejected')),
    created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
    updated_at TIMESTAMPTZ DEFAULT NOW() NOT NULL
);

-- åˆ›å»ºå…¨æ–‡æœç´¢ç´¢å¼•
CREATE INDEX idx_articles_title_content ON articles USING GIN (
    to_tsvector('english', title || ' ' || COALESCE(content, ''))
);
CREATE INDEX idx_articles_tags ON articles USING GIN (tags);
```

### 7.3 å¤šç§Ÿæˆ·ç³»ç»Ÿå»ºæ¨¡

**å¤šç§Ÿæˆ·ç³»ç»Ÿå»ºæ¨¡ç¤ºä¾‹**ï¼š

```sql
-- ç§Ÿæˆ·è¡¨
CREATE TABLE tenants (
    tenant_id BIGSERIAL PRIMARY KEY,
    tenant_code VARCHAR(50) UNIQUE NOT NULL,
    name VARCHAR(200) NOT NULL,
    status VARCHAR(20) DEFAULT 'active',
    created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL
);

-- å¤šç§Ÿæˆ·ç”¨æˆ·è¡¨ï¼ˆæ¯ä¸ªç§Ÿæˆ·ç‹¬ç«‹çš„ç”¨æˆ·ï¼‰
CREATE TABLE tenant_users (
    user_id BIGSERIAL PRIMARY KEY,
    tenant_id BIGINT NOT NULL REFERENCES tenants(tenant_id) ON DELETE CASCADE,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL,
    UNIQUE (tenant_id, username),
    UNIQUE (tenant_id, email),
    created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL
);

-- å¤šç§Ÿæˆ·æ•°æ®è¡¨ï¼ˆæ¯ä¸ªè¡¨éƒ½åŒ…å«tenant_idï¼‰
CREATE TABLE tenant_orders (
    order_id BIGSERIAL,
    tenant_id BIGINT NOT NULL REFERENCES tenants(tenant_id) ON DELETE CASCADE,
    user_id BIGINT NOT NULL REFERENCES tenant_users(user_id) ON DELETE CASCADE,
    order_number VARCHAR(50) NOT NULL,
    total_amount NUMERIC(10,2) NOT NULL,
    PRIMARY KEY (order_id, tenant_id),
    UNIQUE (tenant_id, order_number),
    created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL
);

-- åˆ›å»ºåˆ†åŒºï¼ˆæŒ‰ç§Ÿæˆ·åˆ†åŒºï¼‰
CREATE TABLE tenant_orders (
    order_id BIGSERIAL,
    tenant_id BIGINT NOT NULL REFERENCES tenants(tenant_id),
    user_id BIGINT NOT NULL,
    order_number VARCHAR(50) NOT NULL,
    total_amount NUMERIC(10,2) NOT NULL,
    PRIMARY KEY (order_id, tenant_id)
) PARTITION BY LIST (tenant_id);

-- ä¸ºæ¯ä¸ªç§Ÿæˆ·åˆ›å»ºåˆ†åŒº
CREATE TABLE tenant_orders_1 PARTITION OF tenant_orders
    FOR VALUES IN (1);
CREATE TABLE tenant_orders_2 PARTITION OF tenant_orders
    FOR VALUES IN (2);
```

---

## å…«ã€PostgreSQL 18æ–°ç‰¹æ€§

### 8.1 è™šæ‹Ÿç”Ÿæˆåˆ—

**è™šæ‹Ÿç”Ÿæˆåˆ—**ç”¨äºè‡ªåŠ¨è®¡ç®—å­—æ®µã€‚

```sql
-- PostgreSQL 18: è™šæ‹Ÿç”Ÿæˆåˆ—
CREATE TABLE products (
    product_id BIGSERIAL PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    price NUMERIC(10,2) NOT NULL,
    discount_rate NUMERIC(5,2) DEFAULT 0,
    -- è™šæ‹Ÿç”Ÿæˆåˆ—ï¼šè‡ªåŠ¨è®¡ç®—æŠ˜æ‰£åä»·æ ¼
    final_price NUMERIC(10,2) GENERATED ALWAYS AS (
        price * (1 - discount_rate / 100)
    ) STORED,
    -- è™šæ‹Ÿç”Ÿæˆåˆ—ï¼šè‡ªåŠ¨è®¡ç®—æ˜¯å¦æ‰“æŠ˜
    is_discounted BOOLEAN GENERATED ALWAYS AS (
        discount_rate > 0
    ) STORED
);

-- å¯ä»¥ç´¢å¼•è™šæ‹Ÿç”Ÿæˆåˆ—
CREATE INDEX idx_products_final_price ON products(final_price);
CREATE INDEX idx_products_discounted ON products(is_discounted) WHERE is_discounted = TRUE;
```

### 8.2 æ”¹è¿›çš„åˆ†åŒº

**PostgreSQL 18åˆ†åŒºæ”¹è¿›**ï¼š

```sql
-- æ”¹è¿›çš„åˆ†åŒºç®¡ç†
-- è‡ªåŠ¨åˆ†åŒºåˆ›å»ºï¼ˆéœ€è¦æ‰©å±•æ”¯æŒï¼‰
-- æ›´å¥½çš„åˆ†åŒºè£å‰ª
-- æ”¹è¿›çš„åˆ†åŒºæ€§èƒ½
```

---

## ä¹ã€æœ€ä½³å®è·µ

1. **è®¾è®¡åŸåˆ™**ï¼š
   - éµå¾ªèŒƒå¼åŒ–è®¾è®¡ï¼Œé€‚åº¦åèŒƒå¼åŒ–
   - åˆç†ä½¿ç”¨æ•°æ®ç±»å‹
   - è®¾è®¡åˆé€‚çš„çº¦æŸä¿è¯æ•°æ®å®Œæ•´æ€§

2. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - ä¸ºå¸¸ç”¨æŸ¥è¯¢åˆ›å»ºç´¢å¼•
   - ä½¿ç”¨åˆ†åŒºç®¡ç†å¤§æ•°æ®è¡¨
   - ä½¿ç”¨ç‰©åŒ–è§†å›¾é¢„è®¡ç®—

3. **å¯ç»´æŠ¤æ€§**ï¼š
   - æ¸…æ™°çš„å‘½åè§„èŒƒ
   - å®Œæ•´çš„æ–‡æ¡£è¯´æ˜
   - åˆç†çš„è¡¨ç»“æ„è®¾è®¡

4. **æ‰©å±•æ€§**ï¼š
   - é¢„ç•™æ‰©å±•å­—æ®µ
   - ä½¿ç”¨JSONBå­˜å‚¨çµæ´»æ•°æ®
   - è®¾è®¡å¯æ‰©å±•çš„æ¶æ„

---

## åã€å‚è€ƒèµ„æº

### 10.1 å®˜æ–¹æ–‡æ¡£

- [PostgreSQLæ•°æ®ç±»å‹](https://www.postgresql.org/docs/current/datatype.html)
- [PostgreSQLçº¦æŸ](https://www.postgresql.org/docs/current/ddl-constraints.html)
- [PostgreSQLåˆ†åŒº](https://www.postgresql.org/docs/current/ddl-partitioning.html)

### 10.2 ç›¸å…³æ–‡æ¡£

- [å…³ç³»æ•°æ®æ¨¡å‹ä¸ç†è®º](../../01-æ ¸å¿ƒè¯¾ç¨‹/01.02-å…³ç³»æ•°æ®æ¨¡å‹ä¸ç†è®º.md) - å…³ç³»æ¨¡å‹ç†è®ºåŸºç¡€
- [æ•°æ®åˆ†æå®Œæ•´æŒ‡å—](./09.01-æ•°æ®åˆ†æå®Œæ•´æŒ‡å—.md) - æ•°æ®åˆ†æå®è·µ
- [æ•°æ®ä»“åº“è®¾è®¡æŒ‡å—](./09.03-æ•°æ®ä»“åº“è®¾è®¡æŒ‡å—.md) - æ•°æ®ä»“åº“å»ºæ¨¡

### 10.3 å¤–éƒ¨èµ„æº

- [æ•°æ®åº“è®¾è®¡æœ€ä½³å®è·µ](https://www.postgresql.org/docs/current/)
- [æ•°æ®å»ºæ¨¡æ•™ç¨‹](https://www.postgresql.org/docs/current/)

---

## åä¸€ã€äº¤å‰å¼•ç”¨

### ç›¸å…³æ–‡æ¡£

- â­â­â­ [æ•°æ®åˆ†æå®Œæ•´æŒ‡å—](./09.01-æ•°æ®åˆ†æå®Œæ•´æŒ‡å—.md) - æ•°æ®åˆ†æå®è·µã€åˆ—å­˜å‚¨ä¼˜åŒ– ğŸ†•
- â­â­â­ [æ•°æ®ä»“åº“è®¾è®¡æŒ‡å—](./09.03-æ•°æ®ä»“åº“è®¾è®¡æŒ‡å—.md) - æ•°æ®ä»“åº“å»ºæ¨¡ã€åˆ—å­˜å‚¨ä¼˜åŒ– ğŸ†•
- â­â­ [ETLæµç¨‹å®Œæ•´æŒ‡å—](./09.04-ETLæµç¨‹å®Œæ•´æŒ‡å—.md) - ETLæµç¨‹ä¸­çš„æ•°æ®å»ºæ¨¡
- â­â­ [æ•°æ®è´¨é‡ç®¡ç†æŒ‡å—](./09.05-æ•°æ®è´¨é‡ç®¡ç†æŒ‡å—.md) - æ•°æ®è´¨é‡ä¿è¯
- â­â­â­ [å­˜å‚¨ç®¡ç†ä¸æ•°æ®æŒä¹…åŒ–](../../01-æ ¸å¿ƒåŸºç¡€/01.06-å­˜å‚¨ç®¡ç†ä¸æ•°æ®æŒä¹…åŒ–.md) - åˆ—å­˜å‚¨æ¶æ„åˆ†æã€åˆ—å‹ç¼©æŠ€æœ¯è¯¦è§£ ğŸ†•
- â­â­ [æ‰©å±•ç³»ç»Ÿä¸æ’ä»¶å¼€å‘](../../03-é«˜çº§ç‰¹æ€§/03.01-æ‰©å±•ç³»ç»Ÿä¸æ’ä»¶å¼€å‘.md) - åˆ—å­˜å‚¨æ‰©å±•ï¼ˆcstore_fdwï¼‰ğŸ†•
- â­â­ [ç´¢å¼•ç»“æ„ä¸ä¼˜åŒ–](../../02-æŸ¥è¯¢å¤„ç†/02.02-ç´¢å¼•ç»“æ„ä¸ä¼˜åŒ–.md) - åˆ—å­˜å‚¨ç´¢å¼•ä¼˜åŒ– ğŸ†•
- â­â­ [æ‰§è¡Œè®¡åˆ’ä¸æ€§èƒ½è°ƒä¼˜](../../02-æŸ¥è¯¢å¤„ç†/02.04-æ‰§è¡Œè®¡åˆ’ä¸æ€§èƒ½è°ƒä¼˜.md) - åˆ—å­˜å‚¨æŸ¥è¯¢ä¼˜åŒ– ğŸ†•
- â­â­ [å…³ç³»æ•°æ®æ¨¡å‹ä¸ç†è®º](../../01-æ ¸å¿ƒè¯¾ç¨‹/01.02-å…³ç³»æ•°æ®æ¨¡å‹ä¸ç†è®º.md) - å…³ç³»æ¨¡å‹ç†è®ºåŸºç¡€
- â­ [SQLè¯­è¨€è§„èŒƒä¸æ ‡å‡†](../../01-æ ¸å¿ƒè¯¾ç¨‹/01.03-SQLè¯­è¨€è§„èŒƒä¸æ ‡å‡†.md) - SQLè¯­è¨€åŸºç¡€

### å¤–éƒ¨èµ„æº

- [PostgreSQLæ•°æ®ç±»å‹æ–‡æ¡£](https://www.postgresql.org/docs/current/datatype.html)
- [PostgreSQLçº¦æŸæ–‡æ¡£](https://www.postgresql.org/docs/current/ddl-constraints.html)
- [PostgreSQLåˆ†åŒºæ–‡æ¡£](https://www.postgresql.org/docs/current/ddl-partitioning.html)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.1
**æœ€åæ›´æ–°**: 2025-11-22
**PostgreSQLç‰ˆæœ¬**: 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x (å…¼å®¹)
**ç»´æŠ¤è€…**: Documentation Team
