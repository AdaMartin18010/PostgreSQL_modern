# PostgreSQL 18 éƒ¨ç½²æ¶æ„è®¾è®¡

> **ç‰ˆæœ¬**: v1.0
> **æœ€åæ›´æ–°**: 2025-01-15
> **ç‰ˆæœ¬è¦†ç›–**: PostgreSQL 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x (å…¼å®¹)
> **æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ“‘ ç›®å½•

- [PostgreSQL 18 éƒ¨ç½²æ¶æ„è®¾è®¡](#postgresql-18-éƒ¨ç½²æ¶æ„è®¾è®¡)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [ğŸ“Š æ€ç»´å¯¼å›¾](#-æ€ç»´å¯¼å›¾)
  - [ä¸€ã€æ¦‚è¿°](#ä¸€æ¦‚è¿°)
  - [äºŒã€çŸ¥è¯†çŸ©é˜µå¯¹æ¯”](#äºŒçŸ¥è¯†çŸ©é˜µå¯¹æ¯”)
    - [2.1 éƒ¨ç½²æ¶æ„å¯¹æ¯”](#21-éƒ¨ç½²æ¶æ„å¯¹æ¯”)
    - [2.2 é«˜å¯ç”¨æ–¹æ¡ˆå¯¹æ¯”](#22-é«˜å¯ç”¨æ–¹æ¡ˆå¯¹æ¯”)
  - [ä¸‰ã€å•æœºéƒ¨ç½²](#ä¸‰å•æœºéƒ¨ç½²)
    - [3.1 ç³»ç»Ÿè¦æ±‚](#31-ç³»ç»Ÿè¦æ±‚)
      - [3.1.1 ç¡¬ä»¶è¦æ±‚è¯¦è§£](#311-ç¡¬ä»¶è¦æ±‚è¯¦è§£)
      - [3.1.2 æ“ä½œç³»ç»Ÿè¦æ±‚](#312-æ“ä½œç³»ç»Ÿè¦æ±‚)
    - [3.2 å®‰è£…é…ç½®](#32-å®‰è£…é…ç½®)
    - [3.3 åŸºç¡€é…ç½®](#33-åŸºç¡€é…ç½®)
  - [å››ã€ä¸»ä»å¤åˆ¶æ¶æ„](#å››ä¸»ä»å¤åˆ¶æ¶æ„)
    - [4.1 æµå¤åˆ¶é…ç½®](#41-æµå¤åˆ¶é…ç½®)
    - [4.2 é€»è¾‘å¤åˆ¶é…ç½®](#42-é€»è¾‘å¤åˆ¶é…ç½®)
    - [4.3 å¤åˆ¶ç›‘æ§](#43-å¤åˆ¶ç›‘æ§)
  - [äº”ã€é›†ç¾¤æ¶æ„](#äº”é›†ç¾¤æ¶æ„)
    - [5.1 è¯»å†™åˆ†ç¦»](#51-è¯»å†™åˆ†ç¦»)
    - [5.2 è´Ÿè½½å‡è¡¡](#52-è´Ÿè½½å‡è¡¡)
    - [5.3 æ•…éšœåˆ‡æ¢](#53-æ•…éšœåˆ‡æ¢)
  - [å…­ã€åˆ†å¸ƒå¼æ¶æ„](#å…­åˆ†å¸ƒå¼æ¶æ„)
    - [6.1 åˆ†ç‰‡æ¶æ„](#61-åˆ†ç‰‡æ¶æ„)
    - [6.2 Citusé›†ç¾¤](#62-citusé›†ç¾¤)
    - [6.3 åˆ†å¸ƒå¼äº‹åŠ¡](#63-åˆ†å¸ƒå¼äº‹åŠ¡)
  - [ä¸ƒã€å®¹å™¨åŒ–éƒ¨ç½²](#ä¸ƒå®¹å™¨åŒ–éƒ¨ç½²)
    - [7.1 Dockeréƒ¨ç½²](#71-dockeréƒ¨ç½²)
    - [7.2 Kuberneteséƒ¨ç½²](#72-kuberneteséƒ¨ç½²)
    - [7.3 å®¹å™¨ç¼–æ’](#73-å®¹å™¨ç¼–æ’)
  - [å…«ã€äº‘åŸç”Ÿéƒ¨ç½²](#å…«äº‘åŸç”Ÿéƒ¨ç½²)
    - [8.1 äº‘æ•°æ®åº“æœåŠ¡](#81-äº‘æ•°æ®åº“æœåŠ¡)
    - [8.2 Serverlesséƒ¨ç½²](#82-serverlesséƒ¨ç½²)
    - [8.3 å¤šäº‘éƒ¨ç½²](#83-å¤šäº‘éƒ¨ç½²)
  - [ä¹ã€PostgreSQL 18æ–°ç‰¹æ€§](#ä¹postgresql-18æ–°ç‰¹æ€§)
    - [9.1 å¼‚æ­¥I/Oä¼˜åŒ–](#91-å¼‚æ­¥ioä¼˜åŒ–)
    - [9.2 è™šæ‹Ÿç”Ÿæˆåˆ—](#92-è™šæ‹Ÿç”Ÿæˆåˆ—)
    - [9.3 OAuth 2.0è®¤è¯](#93-oauth-20è®¤è¯)
  - [åã€æœ€ä½³å®è·µ](#åæœ€ä½³å®è·µ)
    - [10.1 æ¶æ„é€‰æ‹©åŸåˆ™](#101-æ¶æ„é€‰æ‹©åŸåˆ™)
    - [10.2 å®¹é‡è§„åˆ’](#102-å®¹é‡è§„åˆ’)
    - [10.3 å®‰å…¨é…ç½®](#103-å®‰å…¨é…ç½®)
  - [åä¸€ã€ç›¸å…³æ–‡æ¡£](#åä¸€ç›¸å…³æ–‡æ¡£)

---

## ğŸ“Š æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((éƒ¨ç½²æ¶æ„è®¾è®¡))
    å•æœºéƒ¨ç½²
      ç³»ç»Ÿè¦æ±‚
        ç¡¬ä»¶è¦æ±‚
        è½¯ä»¶è¦æ±‚
        ç¯å¢ƒé…ç½®
      å®‰è£…é…ç½®
        å®‰è£…æ–¹æ³•
        é…ç½®ä¼˜åŒ–
        åˆå§‹åŒ–è®¾ç½®
      åŸºç¡€é…ç½®
        å‚æ•°é…ç½®
        å®‰å…¨é…ç½®
        æ€§èƒ½é…ç½®
    ä¸»ä»å¤åˆ¶
      æµå¤åˆ¶
        æµå¤åˆ¶åŸç†
        é…ç½®æ–¹æ³•
        ç›‘æ§ç®¡ç†
      é€»è¾‘å¤åˆ¶
        é€»è¾‘å¤åˆ¶åŸç†
        é…ç½®æ–¹æ³•
        åº”ç”¨åœºæ™¯
      å¤åˆ¶ç›‘æ§
        å¤åˆ¶çŠ¶æ€
        å»¶è¿Ÿç›‘æ§
        æ•…éšœæ£€æµ‹
    é›†ç¾¤æ¶æ„
      è¯»å†™åˆ†ç¦»
        è¯»å†™åˆ†ç¦»åŸç†
        é…ç½®æ–¹æ³•
        è´Ÿè½½å‡è¡¡
      è´Ÿè½½å‡è¡¡
        è´Ÿè½½å‡è¡¡åŸç†
        é…ç½®æ–¹æ³•
        é«˜å¯ç”¨
      æ•…éšœåˆ‡æ¢
        æ•…éšœæ£€æµ‹
        è‡ªåŠ¨åˆ‡æ¢
        æ•°æ®ä¸€è‡´æ€§
    åˆ†å¸ƒå¼æ¶æ„
      åˆ†ç‰‡æ¶æ„
        åˆ†ç‰‡åŸç†
        åˆ†ç‰‡ç­–ç•¥
        åˆ†ç‰‡ç®¡ç†
      Citusé›†ç¾¤
        CitusåŸç†
        é…ç½®æ–¹æ³•
        åº”ç”¨åœºæ™¯
      åˆ†å¸ƒå¼äº‹åŠ¡
        åˆ†å¸ƒå¼äº‹åŠ¡åŸç†
        äº‹åŠ¡ç®¡ç†
        ä¸€è‡´æ€§ä¿è¯
    å®¹å™¨åŒ–éƒ¨ç½²
      Docker
        Dockeré…ç½®
        é•œåƒæ„å»º
        å®¹å™¨ç®¡ç†
      Kubernetes
        K8sé…ç½®
        éƒ¨ç½²ç®¡ç†
        æ‰©ç¼©å®¹
      å®¹å™¨ç¼–æ’
        ç¼–æ’å·¥å…·
        ç¼–æ’ç­–ç•¥
        ç›‘æ§ç®¡ç†
    äº‘åŸç”Ÿéƒ¨ç½²
      äº‘æ•°æ®åº“
        äº‘æœåŠ¡é€‰æ‹©
        é…ç½®ä¼˜åŒ–
        æˆæœ¬ä¼˜åŒ–
      Serverless
        ServerlessåŸç†
        é…ç½®æ–¹æ³•
        é€‚ç”¨åœºæ™¯
      å¤šäº‘éƒ¨ç½²
        å¤šäº‘ç­–ç•¥
        æ•°æ®åŒæ­¥
        æ•…éšœè½¬ç§»
    PostgreSQL 18
      å¼‚æ­¥I/O
        å¼‚æ­¥I/OåŸç†
        æ€§èƒ½æå‡
        é€‚ç”¨åœºæ™¯
      è™šæ‹Ÿç”Ÿæˆåˆ—
        ç”Ÿæˆåˆ—åŸç†
        åº”ç”¨åœºæ™¯
        æ€§èƒ½ä¼˜åŒ–
      OAuth 2.0
        OAuthåŸç†
        é…ç½®æ–¹æ³•
        å®‰å…¨ä¼˜åŠ¿
    æœ€ä½³å®è·µ
      æ¶æ„é€‰æ‹©
        é€‰æ‹©åŸåˆ™
        è¯„ä¼°æ–¹æ³•
        å†³ç­–æµç¨‹
      å®¹é‡è§„åˆ’
        å®¹é‡è¯„ä¼°
        èµ„æºè§„åˆ’
        æ‰©å±•ç­–ç•¥
      å®‰å…¨é…ç½®
        å®‰å…¨ç­–ç•¥
        é…ç½®æ–¹æ³•
        åˆè§„è¦æ±‚
```

**æ€ç»´å¯¼å›¾è¯´æ˜**ï¼š

æœ¬æ€ç»´å¯¼å›¾å±•ç¤ºäº†éƒ¨ç½²æ¶æ„è®¾è®¡çš„å®Œæ•´çŸ¥è¯†ä½“ç³»ï¼Œä»å•æœºéƒ¨ç½²åˆ°åˆ†å¸ƒå¼æ¶æ„ï¼Œä»å®¹å™¨åŒ–éƒ¨ç½²åˆ°äº‘åŸç”Ÿéƒ¨ç½²ï¼Œæ¯ä¸ªæ¨¡å—éƒ½åŒ…å«ç†è®ºåŸºç¡€ã€é…ç½®æ–¹æ³•å’Œå®è·µç»éªŒã€‚é€šè¿‡è¿™ä¸ªæ€ç»´å¯¼å›¾ï¼Œå¯ä»¥å¿«é€Ÿäº†è§£PostgreSQLéƒ¨ç½²æ¶æ„çš„å…¨è²Œï¼Œå¹¶æ ¹æ®å…·ä½“éœ€æ±‚æ·±å…¥ç›¸å…³ç« èŠ‚ã€‚

**ä½¿ç”¨å»ºè®®**ï¼š

- **è¿ç»´äººå‘˜**ï¼šé‡ç‚¹å…³æ³¨éƒ¨ç½²æ¶æ„çš„é…ç½®å’Œç®¡ç†ï¼Œç†è§£å¦‚ä½•éƒ¨ç½²å’Œç»´æŠ¤PostgreSQLç³»ç»Ÿ
- **æ¶æ„å¸ˆ**ï¼šé‡ç‚¹å…³æ³¨æ¶æ„é€‰æ‹©å’Œæœ€ä½³å®è·µï¼Œç†è§£å¦‚ä½•é€‰æ‹©æœ€é€‚åˆçš„éƒ¨ç½²æ¶æ„
- **æŠ€æœ¯è´Ÿè´£äºº**ï¼šé‡ç‚¹å…³æ³¨å®¹é‡è§„åˆ’å’Œå®‰å…¨é…ç½®ï¼Œç†è§£å¦‚ä½•è§„åˆ’å’Œç®¡ç†ç³»ç»Ÿèµ„æº

---

## ä¸€ã€æ¦‚è¿°

**æ–‡æ¡£è®¾è®¡ç†å¿µ**ï¼š

æœ¬æ–‡æ¡£ä¸ä»…å±•ç¤ºéƒ¨ç½²æ¶æ„çš„é…ç½®æ­¥éª¤ï¼Œæ›´é‡è¦çš„æ˜¯è§£é‡Š**ä¸ºä»€ä¹ˆ**éœ€è¦ä¸åŒçš„éƒ¨ç½²æ¶æ„ï¼Œ**å¦‚ä½•**é€‰æ‹©å’Œé…ç½®éƒ¨ç½²æ¶æ„ï¼Œä»¥åŠ**ä½•æ—¶**ä½¿ç”¨ç‰¹å®šçš„éƒ¨ç½²æ–¹æ¡ˆã€‚æ¯ä¸ªæ¶æ„æ–¹æ¡ˆéƒ½åŒ…å«ï¼š

1. **æ¶æ„åˆ†æ**ï¼šè§£é‡Šæ¶æ„çš„åŸç†å’Œç‰¹ç‚¹
2. **é…ç½®æ–¹æ³•**ï¼šè¯´æ˜å¦‚ä½•é…ç½®å’Œéƒ¨ç½²
3. **é€‚ç”¨åœºæ™¯**ï¼šåˆ†æé€‚ç”¨åœºæ™¯å’Œæƒè¡¡è€ƒè™‘
4. **æœ€ä½³å®è·µ**ï¼šæä¾›å®è·µç»éªŒå’Œä¼˜åŒ–å»ºè®®

**éƒ¨ç½²æ¶æ„è®¾è®¡çš„é‡è¦æ€§**ï¼š

éƒ¨ç½²æ¶æ„æ˜¯ç³»ç»Ÿè¿è¡Œçš„åŸºç¡€ï¼Œå®ƒç›´æ¥å½±å“ï¼š

1. **ç³»ç»Ÿå¯ç”¨æ€§**ï¼šåˆé€‚çš„éƒ¨ç½²æ¶æ„å¯ä»¥æé«˜ç³»ç»Ÿå¯ç”¨æ€§
   - **ç†è®ºä¾æ®**ï¼šé«˜å¯ç”¨æ¶æ„å¯ä»¥ä¿è¯ç³»ç»Ÿåœ¨æ•…éšœæ—¶ç»§ç»­è¿è¡Œ
   - **å®è·µä»·å€¼**ï¼šæé«˜ç³»ç»Ÿå¯ç”¨æ€§ï¼Œå‡å°‘æœåŠ¡ä¸­æ–­æ—¶é—´
   - **æ•ˆæœè¯„ä¼°**ï¼šç³»ç»Ÿå¯ç”¨æ€§æå‡10-30%ï¼Œæ•…éšœæ¢å¤æ—¶é—´å‡å°‘60-90%

2. **ç³»ç»Ÿæ€§èƒ½**ï¼šåˆé€‚çš„éƒ¨ç½²æ¶æ„å¯ä»¥ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½
   - **ç†è®ºä¾æ®**ï¼šåˆç†çš„æ¶æ„å¯ä»¥ä¼˜åŒ–èµ„æºåˆ©ç”¨å’Œè´Ÿè½½åˆ†å¸ƒ
   - **å®è·µä»·å€¼**ï¼šæå‡ç³»ç»Ÿæ€§èƒ½ï¼Œæ”¯æŒæ›´å¤šå¹¶å‘ç”¨æˆ·
   - **æ•ˆæœè¯„ä¼°**ï¼šç³»ç»Ÿæ€§èƒ½æå‡20-100%ï¼Œå¹¶å‘èƒ½åŠ›æå‡2-10å€

3. **ç³»ç»Ÿå¯æ‰©å±•æ€§**ï¼šåˆé€‚çš„éƒ¨ç½²æ¶æ„å¯ä»¥æé«˜ç³»ç»Ÿå¯æ‰©å±•æ€§
   - **ç†è®ºä¾æ®**ï¼šå¯æ‰©å±•æ¶æ„å¯ä»¥æ”¯æŒç³»ç»Ÿæ°´å¹³æ‰©å±•
   - **å®è·µä»·å€¼**ï¼šæ”¯æŒä¸šåŠ¡å¢é•¿ï¼Œé€‚åº”æ•°æ®é‡å¢é•¿
   - **æ•ˆæœè¯„ä¼°**ï¼šç³»ç»Ÿå¯æ‰©å±•æ€§æå‡50-200%ï¼Œæ”¯æŒæ›´å¤§è§„æ¨¡

4. **ç³»ç»Ÿæˆæœ¬**ï¼šåˆé€‚çš„éƒ¨ç½²æ¶æ„å¯ä»¥ä¼˜åŒ–ç³»ç»Ÿæˆæœ¬
   - **ç†è®ºä¾æ®**ï¼šåˆç†çš„æ¶æ„å¯ä»¥ä¼˜åŒ–èµ„æºåˆ©ç”¨ï¼Œé™ä½æˆæœ¬
   - **å®è·µä»·å€¼**ï¼šé™ä½ç¡¬ä»¶æˆæœ¬ã€è¿ç»´æˆæœ¬ã€å¼€å‘æˆæœ¬
   - **æ•ˆæœè¯„ä¼°**ï¼šç³»ç»Ÿæˆæœ¬é™ä½20-40%ï¼Œèµ„æºåˆ©ç”¨ç‡æå‡30-60%

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š

- **æ¶æ„å…¨é¢**ï¼šæ¶µç›–å•æœºã€ä¸»ä»ã€é›†ç¾¤ã€åˆ†å¸ƒå¼ç­‰å¤šç§æ¶æ„
  - **ç†è®ºä¾æ®**ï¼šä¸åŒåœºæ™¯éœ€è¦ä¸åŒçš„éƒ¨ç½²æ¶æ„
  - **å®è·µä»·å€¼**ï¼šå¸®åŠ©è¿ç»´äººå‘˜é€‰æ‹©æœ€é€‚åˆçš„éƒ¨ç½²æ¶æ„
  - **æ¶æ„ç±»å‹**ï¼šå•æœºã€ä¸»ä»ã€é›†ç¾¤ã€åˆ†å¸ƒå¼ã€å®¹å™¨åŒ–ã€äº‘åŸç”Ÿ

- **å®ç”¨æ€§å¼º**ï¼šæä¾›è¯¦ç»†çš„é…ç½®æ­¥éª¤å’Œæœ€ä½³å®è·µ
  - **ç†è®ºä¾æ®**ï¼šè¯¦ç»†çš„é…ç½®æ­¥éª¤å¯ä»¥å¸®åŠ©å¿«é€Ÿéƒ¨ç½²
  - **å®è·µä»·å€¼**ï¼šæä¾›å¯ç›´æ¥åº”ç”¨çš„é…ç½®æ–¹æ¡ˆ
  - **å®è·µå†…å®¹**ï¼šé…ç½®æ­¥éª¤ã€æœ€ä½³å®è·µã€ä¼˜åŒ–å»ºè®®

- **äº‘åŸç”Ÿ**ï¼šæ”¯æŒå®¹å™¨åŒ–å’Œäº‘åŸç”Ÿéƒ¨ç½²
  - **ç†è®ºä¾æ®**ï¼šäº‘åŸç”Ÿæ˜¯æœªæ¥éƒ¨ç½²çš„è¶‹åŠ¿
  - **å®è·µä»·å€¼**ï¼šæä¾›ç°ä»£åŒ–çš„éƒ¨ç½²æ–¹æ¡ˆ
  - **äº‘åŸç”ŸæŠ€æœ¯**ï¼šDockerã€Kubernetesã€Serverless

- **é«˜å¯ç”¨**ï¼šé‡ç‚¹å…³æ³¨é«˜å¯ç”¨å’Œå®¹ç¾æ–¹æ¡ˆ
  - **ç†è®ºä¾æ®**ï¼šé«˜å¯ç”¨æ˜¯ç”Ÿäº§ç¯å¢ƒçš„åŸºæœ¬è¦æ±‚
  - **å®è·µä»·å€¼**ï¼šä¿è¯ç³»ç»Ÿåœ¨æ•…éšœæ—¶ç»§ç»­è¿è¡Œ
  - **é«˜å¯ç”¨æ–¹æ¡ˆ**ï¼šä¸»ä»å¤åˆ¶ã€é›†ç¾¤æ¶æ„ã€æ•…éšœåˆ‡æ¢

æœ¬æ–‡æ¡£ä»‹ç»PostgreSQL 18çš„å„ç§éƒ¨ç½²æ¶æ„è®¾è®¡ï¼Œå¸®åŠ©è¿ç»´äººå‘˜é€‰æ‹©æœ€é€‚åˆçš„éƒ¨ç½²æ–¹æ¡ˆã€‚

**PostgreSQL 18 æ–°ç‰¹æ€§æ”¯æŒ**ï¼š

- âœ… **å¼‚æ­¥I/O**ï¼šæå‡I/Oå¯†é›†å‹æ“ä½œæ€§èƒ½
- âœ… **OAuth 2.0è®¤è¯**ï¼šæ”¯æŒç°ä»£è®¤è¯æ–¹å¼
- âœ… **æ”¹è¿›çš„å¤åˆ¶æ€§èƒ½**ï¼šé€»è¾‘å¤åˆ¶æ€§èƒ½æå‡38%

---

## äºŒã€çŸ¥è¯†çŸ©é˜µå¯¹æ¯”

### 2.1 éƒ¨ç½²æ¶æ„å¯¹æ¯”

| æ¶æ„ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ | å¤æ‚åº¦ | å¯ç”¨æ€§ | æ¨èåº¦ |
|-----|------|---------|--------|--------|--------|
| **å•æœºéƒ¨ç½²** | ç®€å•ã€ä½æˆæœ¬ | å¼€å‘ã€æµ‹è¯•ã€å°è§„æ¨¡åº”ç”¨ | â­ | â­â­ | â­â­â­ |
| **ä¸»ä»å¤åˆ¶** | è¯»å†™åˆ†ç¦»ã€å¤‡ä»½ | ä¸­å°è§„æ¨¡ç”Ÿäº§ç¯å¢ƒ | â­â­ | â­â­â­â­ | â­â­â­â­â­ |
| **é›†ç¾¤æ¶æ„** | é«˜å¯ç”¨ã€è´Ÿè½½å‡è¡¡ | å¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒ | â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ |
| **åˆ†å¸ƒå¼æ¶æ„** | æ°´å¹³æ‰©å±• | è¶…å¤§è§„æ¨¡ã€å¤šç§Ÿæˆ· | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­ |

### 2.2 é«˜å¯ç”¨æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | RTO | RPO | å¤æ‚åº¦ | æˆæœ¬ | æ¨èåº¦ |
|-----|-----|-----|--------|------|--------|
| **æµå¤åˆ¶+æ‰‹åŠ¨åˆ‡æ¢** | åˆ†é’Ÿçº§ | ç§’çº§ | â­â­ | ä½ | â­â­â­ |
| **æµå¤åˆ¶+è‡ªåŠ¨åˆ‡æ¢** | ç§’çº§ | ç§’çº§ | â­â­â­ | ä¸­ | â­â­â­â­ |
| **Patronié›†ç¾¤** | ç§’çº§ | ç§’çº§ | â­â­â­â­ | ä¸­ | â­â­â­â­â­ |
| **äº‘æ•°æ®åº“HA** | ç§’çº§ | ç§’çº§ | â­â­ | é«˜ | â­â­â­â­ |

---

## ä¸‰ã€å•æœºéƒ¨ç½²

### 3.1 ç³»ç»Ÿè¦æ±‚

#### 3.1.1 ç¡¬ä»¶è¦æ±‚è¯¦è§£

**ä¸ºä»€ä¹ˆéœ€è¦åˆç†çš„ç¡¬ä»¶é…ç½®**ï¼š

PostgreSQLçš„æ€§èƒ½å’Œç¨³å®šæ€§å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºç¡¬ä»¶é…ç½®ã€‚åˆç†çš„ç¡¬ä»¶é…ç½®å¯ä»¥ï¼š

1. **æå‡æ€§èƒ½**ï¼šCPUå’Œå†…å­˜ç›´æ¥å½±å“æŸ¥è¯¢æ€§èƒ½
2. **ä¿è¯ç¨³å®šæ€§**ï¼šå……è¶³çš„èµ„æºé¿å…ç³»ç»Ÿè¿‡è½½
3. **é™ä½æˆæœ¬**ï¼šåˆç†çš„é…ç½®é¿å…èµ„æºæµªè´¹

**CPUè¦æ±‚åˆ†æ**ï¼š

| CPUæ ¸å¿ƒæ•° | é€‚ç”¨åœºæ™¯ | å¹¶å‘è¿æ¥æ•° | æ¨èåº¦ |
|----------|---------|-----------|--------|
| **2æ ¸å¿ƒ** | å¼€å‘/æµ‹è¯•ç¯å¢ƒ | <50 | â­â­â­ |
| **4æ ¸å¿ƒ** | å°å‹ç”Ÿäº§ç¯å¢ƒ | 50-200 | â­â­â­â­ |
| **8æ ¸å¿ƒ** | ä¸­å‹ç”Ÿäº§ç¯å¢ƒ | 200-500 | â­â­â­â­â­ |
| **16æ ¸å¿ƒ+** | å¤§å‹ç”Ÿäº§ç¯å¢ƒ | 500+ | â­â­â­â­â­ |

**CPUé€‰æ‹©å»ºè®®**ï¼š

- **å¼€å‘/æµ‹è¯•**ï¼š2æ ¸å¿ƒè¶³å¤Ÿï¼Œæˆæœ¬ä½
- **å°å‹ç”Ÿäº§**ï¼š4æ ¸å¿ƒï¼Œå¹³è¡¡æ€§èƒ½å’Œæˆæœ¬
- **ä¸­å‹ç”Ÿäº§**ï¼š8æ ¸å¿ƒï¼Œæ”¯æŒè¾ƒé«˜å¹¶å‘
- **å¤§å‹ç”Ÿäº§**ï¼š16æ ¸å¿ƒ+ï¼Œæ”¯æŒé«˜å¹¶å‘å’Œå¤æ‚æŸ¥è¯¢

**å†…å­˜è¦æ±‚åˆ†æ**ï¼š

PostgreSQLä½¿ç”¨å…±äº«å†…å­˜ç¼“å­˜æ•°æ®ï¼Œå†…å­˜é…ç½®ç›´æ¥å½±å“æ€§èƒ½ï¼š

| å†…å­˜å¤§å° | é€‚ç”¨åœºæ™¯ | æ•°æ®é‡ | æ¨èåº¦ |
|---------|---------|--------|--------|
| **4GB** | å¼€å‘/æµ‹è¯•ç¯å¢ƒ | <10GB | â­â­â­ |
| **8GB** | å°å‹ç”Ÿäº§ç¯å¢ƒ | 10-50GB | â­â­â­â­ |
| **16GB** | ä¸­å‹ç”Ÿäº§ç¯å¢ƒ | 50-200GB | â­â­â­â­â­ |
| **32GB+** | å¤§å‹ç”Ÿäº§ç¯å¢ƒ | 200GB+ | â­â­â­â­â­ |

**å†…å­˜é…ç½®åŸåˆ™**ï¼š

- **shared_buffers**ï¼šé€šå¸¸è®¾ç½®ä¸ºæ€»å†…å­˜çš„25%ï¼ˆLinuxï¼‰æˆ–40%ï¼ˆWindowsï¼‰
- **work_mem**ï¼šæ¯ä¸ªè¿æ¥çš„å·¥ä½œå†…å­˜ï¼Œéœ€è¦æ ¹æ®å¹¶å‘æ•°è°ƒæ•´
- **maintenance_work_mem**ï¼šç»´æŠ¤æ“ä½œï¼ˆVACUUMã€CREATE INDEXï¼‰çš„å†…å­˜
- **æ€»å†…å­˜éœ€æ±‚**ï¼šshared_buffers + work_mem * max_connections + ç³»ç»Ÿå†…å­˜

**å†…å­˜é…ç½®ç¤ºä¾‹**ï¼š

```sql
-- åœºæ™¯ï¼š16GBå†…å­˜çš„æœåŠ¡å™¨é…ç½®
-- è®¡ç®—ï¼š
-- - shared_buffers: 16GB * 25% = 4GB
-- - work_mem: å‡è®¾max_connections=100ï¼Œwork_mem=64MBï¼Œæ€»éœ€æ±‚=6.4GB
-- - maintenance_work_mem: 1GB
-- - ç³»ç»Ÿå†…å­˜: 2GB
-- - æ€»è®¡: çº¦13.4GBï¼ˆåœ¨16GBèŒƒå›´å†…ï¼‰

-- é…ç½®ç¤ºä¾‹
shared_buffers = 4GB
work_mem = 64MB
maintenance_work_mem = 1GB
effective_cache_size = 12GB  -- å‘Šè¯‰ä¼˜åŒ–å™¨å¯ç”¨ç¼“å­˜å¤§å°
```

**ç£ç›˜è¦æ±‚åˆ†æ**ï¼š

ç£ç›˜æ˜¯æ•°æ®åº“æ€§èƒ½çš„å…³é”®ç“¶é¢ˆï¼Œé€‰æ‹©åˆé€‚çš„ç£ç›˜ç±»å‹å’Œé…ç½®è‡³å…³é‡è¦ï¼š

| ç£ç›˜ç±»å‹ | IOPS | å»¶è¿Ÿ | é€‚ç”¨åœºæ™¯ | æ¨èåº¦ |
|---------|------|------|---------|--------|
| **HDD** | 100-200 | 5-10ms | å½’æ¡£ã€å¤‡ä»½ | â­â­ |
| **SATA SSD** | 10,000-50,000 | 0.1-0.5ms | å°å‹ç”Ÿäº§ | â­â­â­â­ |
| **NVMe SSD** | 100,000-500,000 | 0.01-0.1ms | ä¸­å¤§å‹ç”Ÿäº§ | â­â­â­â­â­ |
| **NVMe PCIe 4.0** | 500,000+ | <0.01ms | é«˜æ€§èƒ½åœºæ™¯ | â­â­â­â­â­ |

**ç£ç›˜é…ç½®å»ºè®®**ï¼š

- **æ•°æ®ç›®å½•**ï¼šä½¿ç”¨SSDï¼Œæå‡I/Oæ€§èƒ½
- **WALç›®å½•**ï¼šä½¿ç”¨ç‹¬ç«‹SSDï¼Œæå‡å†™å…¥æ€§èƒ½
- **ä¸´æ—¶æ–‡ä»¶**ï¼šå¯ä»¥ä½¿ç”¨è¾ƒæ…¢çš„ç£ç›˜
- **å¤‡ä»½å­˜å‚¨**ï¼šå¯ä»¥ä½¿ç”¨HDDï¼Œé™ä½æˆæœ¬

**ç½‘ç»œè¦æ±‚åˆ†æ**ï¼š

ç½‘ç»œæ€§èƒ½å½±å“æ•°æ®åº“çš„å“åº”æ—¶é—´å’Œååé‡ï¼š

| ç½‘ç»œé€Ÿåº¦ | é€‚ç”¨åœºæ™¯ | å¹¶å‘è¿æ¥ | æ¨èåº¦ |
|---------|---------|---------|--------|
| **ç™¾å…†** | å¼€å‘/æµ‹è¯• | <10 | â­â­ |
| **åƒå…†** | å°å‹ç”Ÿäº§ | 10-100 | â­â­â­â­ |
| **ä¸‡å…†** | ä¸­å¤§å‹ç”Ÿäº§ | 100+ | â­â­â­â­â­ |

#### 3.1.2 æ“ä½œç³»ç»Ÿè¦æ±‚

**Linuxå‘è¡Œç‰ˆé€‰æ‹©**ï¼š

| å‘è¡Œç‰ˆ | ç‰ˆæœ¬è¦æ±‚ | ç‰¹ç‚¹ | æ¨èåº¦ |
|-------|---------|------|--------|
| **Ubuntu** | 20.04 LTS+ | æ˜“ç”¨ã€ç¤¾åŒºæ”¯æŒå¥½ | â­â­â­â­â­ |
| **CentOS/RHEL** | 8+ | ä¼ä¸šçº§ã€ç¨³å®šæ€§å¥½ | â­â­â­â­â­ |
| **Debian** | 11+ | ç¨³å®šã€èµ„æºå ç”¨å°‘ | â­â­â­â­ |
| **SUSE** | 15+ | ä¼ä¸šçº§ã€æ”¯æŒå¥½ | â­â­â­â­ |

**æ“ä½œç³»ç»Ÿé…ç½®ä¼˜åŒ–**ï¼š

```bash
# 1. å†…æ ¸å‚æ•°ä¼˜åŒ–ï¼ˆ/etc/sysctl.confï¼‰
# å…±äº«å†…å­˜é…ç½®
kernel.shmmax = 68719476736  # 64GB
kernel.shmall = 16777216     # 16GB pages

# ç½‘ç»œå‚æ•°ä¼˜åŒ–
net.core.somaxconn = 4096
net.ipv4.tcp_max_syn_backlog = 4096
net.ipv4.tcp_keepalive_time = 600
net.ipv4.tcp_keepalive_probes = 3
net.ipv4.tcp_keepalive_intvl = 15

# è™šæ‹Ÿå†…å­˜ä¼˜åŒ–
vm.swappiness = 1  # å‡å°‘swapä½¿ç”¨
vm.dirty_ratio = 15
vm.dirty_background_ratio = 5

# åº”ç”¨é…ç½®
sysctl -p  # ä½¿é…ç½®ç”Ÿæ•ˆ

# 2. æ–‡ä»¶ç³»ç»Ÿé…ç½®
# æ¨èä½¿ç”¨XFSæˆ–ext4æ–‡ä»¶ç³»ç»Ÿ
# æŒ‚è½½é€‰é¡¹ä¼˜åŒ–
# /etc/fstab
/dev/sdb1 /var/lib/postgresql xfs defaults,noatime,nodiratime 0 0

# 3. ç”¨æˆ·å’Œæƒé™é…ç½®
# åˆ›å»ºpostgresç”¨æˆ·
useradd -r -s /bin/bash -d /var/lib/postgresql postgres

# è®¾ç½®ulimit
# /etc/security/limits.conf
postgres soft nofile 65536
postgres hard nofile 65536
postgres soft nproc 32768
postgres hard nproc 32768
```

- macOSï¼š10.15+
- Windowsï¼šWindows 10/11, Windows Server 2016+

### 3.2 å®‰è£…é…ç½®

**Ubuntu/Debianå®‰è£…**ï¼š

```bash
# æ·»åŠ PostgreSQLå®˜æ–¹ä»“åº“
sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list'
wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -
sudo apt-get update

# å®‰è£…PostgreSQL 18
sudo apt-get install postgresql-18 postgresql-contrib-18

# å¯åŠ¨æœåŠ¡
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

**CentOS/RHELå®‰è£…**ï¼š

```bash
# å®‰è£…PostgreSQLä»“åº“
sudo yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-8-x86_64/pgdg-redhat-repo-latest.noarch.rpm

# å®‰è£…PostgreSQL 18
sudo yum install -y postgresql18-server postgresql18

# åˆå§‹åŒ–æ•°æ®åº“
sudo /usr/pgsql-18/bin/postgresql-18-setup initdb

# å¯åŠ¨æœåŠ¡
sudo systemctl start postgresql-18
sudo systemctl enable postgresql-18
```

### 3.3 åŸºç¡€é…ç½®

**postgresql.confé…ç½®**ï¼š

```conf
# è¿æ¥è®¾ç½®
max_connections = 100
listen_addresses = 'localhost'

# å†…å­˜è®¾ç½®
shared_buffers = 256MB
effective_cache_size = 1GB
work_mem = 16MB
maintenance_work_mem = 128MB

# WALè®¾ç½®
wal_buffers = 16MB
checkpoint_completion_target = 0.9

# æ—¥å¿—è®¾ç½®
logging_collector = on
log_directory = 'log'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_min_duration_statement = 1000

# PostgreSQL 18æ–°ç‰¹æ€§
max_io_concurrency = 10  # å¼‚æ­¥I/Oå¹¶å‘æ•°
```

**pg_hba.confé…ç½®**ï¼š

```conf
# æœ¬åœ°è¿æ¥
local   all             all                                     peer

# IPv4æœ¬åœ°è¿æ¥
host    all             all             127.0.0.1/32            scram-sha-256

# IPv4è¿œç¨‹è¿æ¥ï¼ˆç”Ÿäº§ç¯å¢ƒéœ€è¦æ›´ä¸¥æ ¼çš„é…ç½®ï¼‰
host    all             all             0.0.0.0/0               scram-sha-256
```

---

## å››ã€ä¸»ä»å¤åˆ¶æ¶æ„

### 4.1 æµå¤åˆ¶é…ç½®

**ä¸»åº“é…ç½®ï¼ˆpostgresql.confï¼‰**ï¼š

```conf
# å¯ç”¨WALå½’æ¡£
wal_level = replica
max_wal_senders = 3
wal_keep_size = 1GB

# å½’æ¡£é…ç½®
archive_mode = on
archive_command = 'cp %p /var/lib/postgresql/archive/%f'
```

**ä¸»åº“é…ç½®ï¼ˆpg_hba.confï¼‰**ï¼š

```conf
# å…è®¸ä»åº“è¿æ¥
host    replication     replicator      192.168.1.0/24         scram-sha-256
```

**åˆ›å»ºå¤åˆ¶ç”¨æˆ·**ï¼š

```sql
-- åœ¨ä¸»åº“åˆ›å»ºå¤åˆ¶ç”¨æˆ·
CREATE USER replicator WITH REPLICATION PASSWORD 'replicator_password';
```

**ä»åº“é…ç½®**ï¼š

```bash
# åœæ­¢PostgreSQLæœåŠ¡
sudo systemctl stop postgresql

# å¤‡ä»½æ•°æ®ç›®å½•
sudo mv /var/lib/postgresql/18/main /var/lib/postgresql/18/main.backup

# ä½¿ç”¨pg_basebackupåˆ›å»ºåŸºç¡€å¤‡ä»½
sudo -u postgres pg_basebackup \
    -h primary_host \
    -D /var/lib/postgresql/18/main \
    -U replicator \
    -P \
    -W \
    -R

# å¯åŠ¨PostgreSQLæœåŠ¡
sudo systemctl start postgresql
```

**ä»åº“è‡ªåŠ¨é…ç½®ï¼ˆPostgreSQL 12+ï¼‰**ï¼š

```conf
# postgresql.auto.confï¼ˆç”±pg_basebackup -Rè‡ªåŠ¨ç”Ÿæˆï¼‰
primary_conninfo = 'host=primary_host port=5432 user=replicator password=replicator_password'
primary_slot_name = 'replication_slot'
```

### 4.2 é€»è¾‘å¤åˆ¶é…ç½®

**å‘å¸ƒç«¯é…ç½®**ï¼š

```sql
-- åˆ›å»ºå‘å¸ƒ
CREATE PUBLICATION my_publication FOR TABLE users, orders;

-- æˆ–å‘å¸ƒæ‰€æœ‰è¡¨
CREATE PUBLICATION all_tables FOR ALL TABLES;
```

**è®¢é˜…ç«¯é…ç½®**ï¼š

```sql
-- åˆ›å»ºè®¢é˜…
CREATE SUBSCRIPTION my_subscription
CONNECTION 'host=primary_host port=5432 dbname=mydb user=replicator password=replicator_password'
PUBLICATION my_publication;

-- æŸ¥çœ‹è®¢é˜…çŠ¶æ€
SELECT * FROM pg_subscription;
SELECT * FROM pg_stat_subscription;
```

### 4.3 å¤åˆ¶ç›‘æ§

**ç›‘æ§æµå¤åˆ¶**ï¼š

```sql
-- æŸ¥çœ‹å¤åˆ¶çŠ¶æ€
SELECT * FROM pg_stat_replication;

-- æŸ¥çœ‹å¤åˆ¶å»¶è¿Ÿ
SELECT
    client_addr,
    state,
    sync_state,
    pg_wal_lsn_diff(pg_current_wal_lsn(), sent_lsn) AS sent_lag,
    pg_wal_lsn_diff(sent_lsn, write_lsn) AS write_lag,
    pg_wal_lsn_diff(write_lsn, flush_lsn) AS flush_lag,
    pg_wal_lsn_diff(flush_lsn, replay_lsn) AS replay_lag
FROM pg_stat_replication;
```

**ç›‘æ§é€»è¾‘å¤åˆ¶**ï¼š

```sql
-- æŸ¥çœ‹è®¢é˜…çŠ¶æ€
SELECT * FROM pg_stat_subscription;

-- æŸ¥çœ‹å¤åˆ¶æ§½
SELECT * FROM pg_replication_slots;
```

---

## äº”ã€é›†ç¾¤æ¶æ„

### 5.1 è¯»å†™åˆ†ç¦»

**ä½¿ç”¨pgBouncerå®ç°è¿æ¥æ± å’Œè¯»å†™åˆ†ç¦»**ï¼š

```ini
# pgbouncer.ini
[databases]
mydb = host=primary_host port=5432 dbname=mydb
mydb_ro = host=replica_host port=5432 dbname=mydb

[pgbouncer]
pool_mode = transaction
max_client_conn = 1000
default_pool_size = 25
```

**åº”ç”¨å±‚è¯»å†™åˆ†ç¦»**ï¼š

```python
# Pythonç¤ºä¾‹
from psycopg2 import pool

# å†™è¿æ¥æ± ï¼ˆä¸»åº“ï¼‰
write_pool = pool.SimpleConnectionPool(
    minconn=1, maxconn=10,
    host="primary_host", database="mydb"
)

# è¯»è¿æ¥æ± ï¼ˆä»åº“ï¼‰
read_pool = pool.SimpleConnectionPool(
    minconn=1, maxconn=20,
    host="replica_host", database="mydb"
)

# ä½¿ç”¨
def get_user(user_id):
    conn = read_pool.getconn()
    # è¯»æ“ä½œä½¿ç”¨ä»åº“
    ...

def create_user(user_data):
    conn = write_pool.getconn()
    # å†™æ“ä½œä½¿ç”¨ä¸»åº“
    ...
```

### 5.2 è´Ÿè½½å‡è¡¡

**ä½¿ç”¨HAProxyå®ç°è´Ÿè½½å‡è¡¡**ï¼š

```conf
# haproxy.cfg
global
    log /dev/log local0
    maxconn 4096

defaults
    log global
    mode tcp
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms

# PostgreSQLè¯»è´Ÿè½½å‡è¡¡
frontend pg_read
    bind *:5432
    default_backend pg_read_servers

backend pg_read_servers
    balance roundrobin
    option pgsql-check user postgres
    server pg1 replica1_host:5432 check
    server pg2 replica2_host:5432 check
    server pg3 replica3_host:5432 check

# PostgreSQLå†™ï¼ˆä¸»åº“ï¼‰
frontend pg_write
    bind *:5433
    default_backend pg_write_server

backend pg_write_server
    server pg_primary primary_host:5432 check
```

### 5.3 æ•…éšœåˆ‡æ¢

**ä½¿ç”¨Patroniå®ç°è‡ªåŠ¨æ•…éšœåˆ‡æ¢**ï¼š

```yaml
# patroni.yml
scope: postgres
namespace: /db/
name: postgresql1

restapi:
  listen: 0.0.0.0:8008
  connect_address: 192.168.1.10:8008

etcd3:
  hosts: 192.168.1.20:2379,192.168.1.21:2379,192.168.1.22:2379

bootstrap:
  dcs:
    ttl: 30
    loop_wait: 10
    retry_timeout: 30
    maximum_lag_on_failover: 1048576
  pg_hba:
    - host replication replicator 0.0.0.0/0 md5
    - host all all 0.0.0.0/0 md5
  users:
    replicator:
      password: replicator_password
      options:
        - replication

postgresql:
  listen: 0.0.0.0:5432
  connect_address: 192.168.1.10:5432
  data_dir: /var/lib/postgresql/18/main
  pgpass: /var/lib/postgresql/.pgpass
  parameters:
    max_connections: 100
    shared_buffers: 256MB
    wal_level: replica
    hot_standby: on
```

---

## å…­ã€åˆ†å¸ƒå¼æ¶æ„

### 6.1 åˆ†ç‰‡æ¶æ„

**åº”ç”¨å±‚åˆ†ç‰‡**ï¼š

```python
# åˆ†ç‰‡ç­–ç•¥ç¤ºä¾‹
def get_shard(user_id):
    """æ ¹æ®ç”¨æˆ·IDè·å–åˆ†ç‰‡"""
    shard_count = 4
    return user_id % shard_count

def get_connection(user_id):
    """è·å–å¯¹åº”åˆ†ç‰‡çš„è¿æ¥"""
    shard = get_shard(user_id)
    shard_hosts = {
        0: "shard0_host",
        1: "shard1_host",
        2: "shard2_host",
        3: "shard3_host"
    }
    return psycopg2.connect(host=shard_hosts[shard], ...)
```

### 6.2 Citusé›†ç¾¤

**Cituså®‰è£…é…ç½®**ï¼š

```sql
-- å®‰è£…Citusæ‰©å±•
CREATE EXTENSION citus;

-- æ·»åŠ å·¥ä½œèŠ‚ç‚¹
SELECT citus_add_node('worker1_host', 5432);
SELECT citus_add_node('worker2_host', 5432);
SELECT citus_add_node('worker3_host', 5432);

-- åˆ›å»ºåˆ†å¸ƒå¼è¡¨
SELECT create_distributed_table('users', 'id');
SELECT create_distributed_table('orders', 'user_id');

-- æŸ¥çœ‹é›†ç¾¤çŠ¶æ€
SELECT * FROM citus_get_active_worker_nodes();
```

### 6.3 åˆ†å¸ƒå¼äº‹åŠ¡

**ä¸¤é˜¶æ®µæäº¤**ï¼š

```sql
-- å‡†å¤‡é˜¶æ®µ
PREPARE TRANSACTION 'tx1';
PREPARE TRANSACTION 'tx2';

-- æäº¤é˜¶æ®µ
COMMIT PREPARED 'tx1';
COMMIT PREPARED 'tx2';
```

---

## ä¸ƒã€å®¹å™¨åŒ–éƒ¨ç½²

### 7.1 Dockeréƒ¨ç½²

**Docker Composeé…ç½®**ï¼š

```yaml
version: '3.8'

services:
  postgres:
    image: postgres:18
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: mydb
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./postgresql.conf:/etc/postgresql/postgresql.conf
    command: postgres -c config_file=/etc/postgresql/postgresql.conf
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 5

volumes:
  postgres_data:
```

### 7.2 Kuberneteséƒ¨ç½²

**StatefulSeté…ç½®**ï¼š

```yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: postgres
spec:
  serviceName: postgres
  replicas: 3
  selector:
    matchLabels:
      app: postgres
  template:
    metadata:
      labels:
        app: postgres
    spec:
      containers:
      - name: postgres
        image: postgres:18
        env:
        - name: POSTGRES_PASSWORD
          valueFrom:
            secretKeyRef:
              name: postgres-secret
              key: password
        volumeMounts:
        - name: postgres-data
          mountPath: /var/lib/postgresql/data
  volumeClaimTemplates:
  - metadata:
      name: postgres-data
    spec:
      accessModes: [ "ReadWriteOnce" ]
      resources:
        requests:
          storage: 100Gi
```

### 7.3 å®¹å™¨ç¼–æ’

**ä½¿ç”¨Helméƒ¨ç½²**ï¼š

```bash
# æ·»åŠ Bitnami Helmä»“åº“
helm repo add bitnami https://charts.bitnami.com/bitnami

# å®‰è£…PostgreSQL
helm install postgres bitnami/postgresql \
  --set auth.postgresPassword=postgres \
  --set auth.database=mydb \
  --set primary.persistence.size=100Gi
```

---

## å…«ã€äº‘åŸç”Ÿéƒ¨ç½²

### 8.1 äº‘æ•°æ®åº“æœåŠ¡

**AWS RDS PostgreSQL**ï¼š

```bash
# ä½¿ç”¨AWS CLIåˆ›å»ºRDSå®ä¾‹
aws rds create-db-instance \
    --db-instance-identifier my-postgres \
    --db-instance-class db.t3.medium \
    --engine postgres \
    --engine-version 18.0 \
    --master-username postgres \
    --master-user-password postgres \
    --allocated-storage 100 \
    --storage-type gp3 \
    --multi-az
```

**Azure Database for PostgreSQL**ï¼š

```bash
# ä½¿ç”¨Azure CLIåˆ›å»ºæ•°æ®åº“
az postgres flexible-server create \
    --resource-group my-resource-group \
    --name my-postgres-server \
    --location eastus \
    --admin-user postgres \
    --admin-password postgres \
    --sku-name Standard_B2s \
    --version 18 \
    --storage-size 128
```

### 8.2 Serverlesséƒ¨ç½²

**Neon Serverless PostgreSQL**ï¼š

```bash
# ä½¿ç”¨Neon CLIåˆ›å»ºé¡¹ç›®
neon projects create my-project

# è·å–è¿æ¥å­—ç¬¦ä¸²
neon connection-string my-project
```

### 8.3 å¤šäº‘éƒ¨ç½²

**è·¨äº‘éƒ¨ç½²ç­–ç•¥**ï¼š

- ä¸»åº“åœ¨ä¸€ä¸ªäº‘ï¼Œä»åº“åœ¨å¦ä¸€ä¸ªäº‘
- ä½¿ç”¨é€»è¾‘å¤åˆ¶åŒæ­¥æ•°æ®
- é…ç½®DNSå®ç°æ•…éšœåˆ‡æ¢

---

## ä¹ã€PostgreSQL 18æ–°ç‰¹æ€§

### 9.1 å¼‚æ­¥I/Oä¼˜åŒ–

**é…ç½®å¼‚æ­¥I/O**ï¼š

```conf
# postgresql.conf
# éœ€è¦Linux 5.1+å†…æ ¸æ”¯æŒio_uring
max_io_concurrency = 10

# æ£€æŸ¥ç³»ç»Ÿæ”¯æŒ
# Linux: uname -r (éœ€è¦5.1+)
# æ£€æŸ¥io_uring: grep io_uring /proc/filesystems
```

**æ€§èƒ½æå‡**ï¼š

- å‘é‡æ£€ç´¢I/Oæ€§èƒ½æå‡2-3å€
- å¤§æ–‡ä»¶å†™å…¥æ€§èƒ½æå‡
- å‡å°‘I/Oç­‰å¾…æ—¶é—´

### 9.2 è™šæ‹Ÿç”Ÿæˆåˆ—

**ä½¿ç”¨è™šæ‹Ÿç”Ÿæˆåˆ—**ï¼š

```sql
-- åˆ›å»ºå¸¦è™šæ‹Ÿç”Ÿæˆåˆ—çš„è¡¨
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    price DECIMAL(10,2),
    discount DECIMAL(5,2),
    final_price DECIMAL(10,2) GENERATED ALWAYS AS (
        price * (1 - discount / 100)
    ) STORED
);

-- å¯ä»¥ç´¢å¼•è™šæ‹Ÿç”Ÿæˆåˆ—
CREATE INDEX idx_products_final_price ON products(final_price);
```

### 9.3 OAuth 2.0è®¤è¯

**é…ç½®OAuth 2.0**ï¼š

```conf
# postgresql.conf
# å¯ç”¨OAuth 2.0è®¤è¯
oauth2_provider = 'google'
oauth2_client_id = 'your-client-id'
oauth2_client_secret = 'your-client-secret'
oauth2_redirect_uri = 'https://your-app.com/oauth/callback'
```

---

## åã€æœ€ä½³å®è·µ

### 10.1 æ¶æ„é€‰æ‹©åŸåˆ™

**é€‰æ‹©æŒ‡å—**ï¼š

- **å¼€å‘/æµ‹è¯•ç¯å¢ƒ**ï¼šå•æœºéƒ¨ç½²
- **ä¸­å°è§„æ¨¡ç”Ÿäº§**ï¼šä¸»ä»å¤åˆ¶
- **å¤§è§„æ¨¡ç”Ÿäº§**ï¼šé›†ç¾¤æ¶æ„ï¼ˆPatroniï¼‰
- **è¶…å¤§è§„æ¨¡/å¤šç§Ÿæˆ·**ï¼šåˆ†å¸ƒå¼æ¶æ„ï¼ˆCitusï¼‰

### 10.2 å®¹é‡è§„åˆ’

**å®¹é‡è§„åˆ’è€ƒè™‘å› ç´ **ï¼š

- æ•°æ®é‡å¢é•¿è¶‹åŠ¿
- å¹¶å‘è¿æ¥æ•°
- è¯»å†™æ¯”ä¾‹
- æ€§èƒ½è¦æ±‚
- å¯ç”¨æ€§è¦æ±‚

### 10.3 å®‰å…¨é…ç½®

**å®‰å…¨é…ç½®æ¸…å•**ï¼š

- ä½¿ç”¨å¼ºå¯†ç 
- é…ç½®SSL/TLS
- é™åˆ¶ç½‘ç»œè®¿é—®
- å®šæœŸæ›´æ–°è¡¥ä¸
- å¯ç”¨å®¡è®¡æ—¥å¿—
- é…ç½®é˜²ç«å¢™è§„åˆ™

---

## åä¸€ã€ç›¸å…³æ–‡æ¡£

- [ç›‘æ§ä¸å¯è§‚æµ‹æ€§](./02.02-ç›‘æ§ä¸å¯è§‚æµ‹æ€§.md)
- [æ€§èƒ½è°ƒä¼˜å®è·µ](./02.03-æ€§èƒ½è°ƒä¼˜å®è·µ.md)
- [æ•…éšœæ’æŸ¥ä¸æ¢å¤](./02.04-æ•…éšœæ’æŸ¥ä¸æ¢å¤.md)
- [PostgreSQL 18æ–°ç‰¹æ€§](../../02-ç‰ˆæœ¬ç‰¹æ€§/02.01-PostgreSQL-18-æ–°ç‰¹æ€§.md)
- [å•æœºéƒ¨ç½²ä¸é…ç½®](../../05-éƒ¨ç½²æ¶æ„/å•æœºéƒ¨ç½²/05.01-å•æœºéƒ¨ç½²ä¸é…ç½®.md)

---

**æœ€åæ›´æ–°**: 2025-01-15
**ç»´æŠ¤è€…**: PostgreSQL Documentation Team
