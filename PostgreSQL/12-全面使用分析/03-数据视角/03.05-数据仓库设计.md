# PostgreSQL 18 æ•°æ®ä»“åº“è®¾è®¡

> **ç‰ˆæœ¬**: v1.0
> **æœ€åæ›´æ–°**: 2025-01-15
> **ç‰ˆæœ¬è¦†ç›–**: PostgreSQL 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x (å…¼å®¹)
> **æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ“‘ ç›®å½•

- [PostgreSQL 18 æ•°æ®ä»“åº“è®¾è®¡](#postgresql-18-æ•°æ®ä»“åº“è®¾è®¡)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [ğŸ“Š æ€ç»´å¯¼å›¾](#-æ€ç»´å¯¼å›¾)
  - [ä¸€ã€æ¦‚è¿°](#ä¸€æ¦‚è¿°)
  - [äºŒã€çŸ¥è¯†çŸ©é˜µå¯¹æ¯”](#äºŒçŸ¥è¯†çŸ©é˜µå¯¹æ¯”)
    - [2.1 æ•°æ®ä»“åº“æ¶æ„å¯¹æ¯”](#21-æ•°æ®ä»“åº“æ¶æ„å¯¹æ¯”)
    - [2.2 å»ºæ¨¡æ–¹æ³•å¯¹æ¯”](#22-å»ºæ¨¡æ–¹æ³•å¯¹æ¯”)
  - [ä¸‰ã€æ•°æ®ä»“åº“æ¶æ„](#ä¸‰æ•°æ®ä»“åº“æ¶æ„)
    - [3.1 åˆ†å±‚æ¶æ„](#31-åˆ†å±‚æ¶æ„)
      - [3.1.1 åˆ†å±‚æ¶æ„çš„åŸç†](#311-åˆ†å±‚æ¶æ„çš„åŸç†)
      - [3.1.2 åˆ†å±‚æ¶æ„è®¾è®¡](#312-åˆ†å±‚æ¶æ„è®¾è®¡)
    - [3.2 æ•°æ®æµè®¾è®¡](#32-æ•°æ®æµè®¾è®¡)
      - [3.2.1 æ•°æ®æµè®¾è®¡åŸç†](#321-æ•°æ®æµè®¾è®¡åŸç†)
      - [3.2.2 æ•°æ®æµå®ç°](#322-æ•°æ®æµå®ç°)
    - [3.3 å…ƒæ•°æ®ç®¡ç†](#33-å…ƒæ•°æ®ç®¡ç†)
  - [å››ã€ç»´åº¦å»ºæ¨¡](#å››ç»´åº¦å»ºæ¨¡)
    - [4.1 æ˜Ÿå‹æ¨¡å‹](#41-æ˜Ÿå‹æ¨¡å‹)
    - [4.2 é›ªèŠ±æ¨¡å‹](#42-é›ªèŠ±æ¨¡å‹)
    - [4.3 äº‹å®è¡¨è®¾è®¡](#43-äº‹å®è¡¨è®¾è®¡)
    - [4.4 ç»´åº¦è¡¨è®¾è®¡](#44-ç»´åº¦è¡¨è®¾è®¡)
  - [äº”ã€ETLè®¾è®¡](#äº”etlè®¾è®¡)
    - [5.1 æŠ½å–è®¾è®¡](#51-æŠ½å–è®¾è®¡)
    - [5.2 è½¬æ¢è®¾è®¡](#52-è½¬æ¢è®¾è®¡)
    - [5.3 åŠ è½½è®¾è®¡](#53-åŠ è½½è®¾è®¡)
  - [å…­ã€æ€§èƒ½ä¼˜åŒ–](#å…­æ€§èƒ½ä¼˜åŒ–)
    - [6.1 åˆ†åŒºç­–ç•¥](#61-åˆ†åŒºç­–ç•¥)
    - [6.2 ç´¢å¼•ä¼˜åŒ–](#62-ç´¢å¼•ä¼˜åŒ–)
    - [6.3 ç‰©åŒ–è§†å›¾](#63-ç‰©åŒ–è§†å›¾)
  - [ä¸ƒã€PostgreSQL 18ä¼˜åŒ–](#ä¸ƒpostgresql-18ä¼˜åŒ–)
    - [7.1 å¹¶è¡ŒæŸ¥è¯¢ä¼˜åŒ–](#71-å¹¶è¡ŒæŸ¥è¯¢ä¼˜åŒ–)
    - [7.2 å¼‚æ­¥I/Oä¼˜åŒ–](#72-å¼‚æ­¥ioä¼˜åŒ–)
  - [å…«ã€æœ€ä½³å®è·µ](#å…«æœ€ä½³å®è·µ)
    - [8.1 è®¾è®¡åŸåˆ™](#81-è®¾è®¡åŸåˆ™)
    - [8.2 å®æ–½æ­¥éª¤](#82-å®æ–½æ­¥éª¤)
    - [8.3 ç»´æŠ¤ç­–ç•¥](#83-ç»´æŠ¤ç­–ç•¥)
  - [ä¹ã€ç›¸å…³æ–‡æ¡£](#ä¹ç›¸å…³æ–‡æ¡£)

---

## ğŸ“Š æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((æ•°æ®ä»“åº“è®¾è®¡))
    æ¶æ„è®¾è®¡
      åˆ†å±‚æ¶æ„
        åˆ†å±‚åŸç†
        åˆ†å±‚è®¾è®¡
        åˆ†å±‚ä¼˜åŒ–
      æ•°æ®æµ
        æ•°æ®æµåŸç†
        æ•°æ®æµè®¾è®¡
        æ•°æ®æµä¼˜åŒ–
      å…ƒæ•°æ®
        å…ƒæ•°æ®ç®¡ç†
        å…ƒæ•°æ®åº”ç”¨
        å…ƒæ•°æ®ä¼˜åŒ–
    ç»´åº¦å»ºæ¨¡
      æ˜Ÿå‹æ¨¡å‹
        æ˜Ÿå‹æ¨¡å‹åŸç†
        æ˜Ÿå‹æ¨¡å‹è®¾è®¡
        æ˜Ÿå‹æ¨¡å‹ä¼˜åŒ–
      é›ªèŠ±æ¨¡å‹
        é›ªèŠ±æ¨¡å‹åŸç†
        é›ªèŠ±æ¨¡å‹è®¾è®¡
        é›ªèŠ±æ¨¡å‹ä¼˜åŒ–
      äº‹å®è¡¨
        äº‹å®è¡¨è®¾è®¡
        äº‹å®è¡¨ç±»å‹
        äº‹å®è¡¨ä¼˜åŒ–
      ç»´åº¦è¡¨
        ç»´åº¦è¡¨è®¾è®¡
        ç»´åº¦è¡¨ç±»å‹
        ç»´åº¦è¡¨ä¼˜åŒ–
    ETLè®¾è®¡
      æŠ½å–
        æŠ½å–ç­–ç•¥
        æŠ½å–æ–¹æ³•
        æŠ½å–ä¼˜åŒ–
      è½¬æ¢
        è½¬æ¢è§„åˆ™
        è½¬æ¢æ–¹æ³•
        è½¬æ¢ä¼˜åŒ–
      åŠ è½½
        åŠ è½½ç­–ç•¥
        åŠ è½½æ–¹æ³•
        åŠ è½½ä¼˜åŒ–
    æ€§èƒ½ä¼˜åŒ–
      åˆ†åŒº
        åˆ†åŒºç­–ç•¥
        åˆ†åŒºè®¾è®¡
        åˆ†åŒºä¼˜åŒ–
      ç´¢å¼•
        ç´¢å¼•è®¾è®¡
        ç´¢å¼•ç±»å‹
        ç´¢å¼•ä¼˜åŒ–
      ç‰©åŒ–è§†å›¾
        ç‰©åŒ–è§†å›¾è®¾è®¡
        ç‰©åŒ–è§†å›¾åˆ·æ–°
        ç‰©åŒ–è§†å›¾ä¼˜åŒ–
    PostgreSQL 18
      å¹¶è¡ŒæŸ¥è¯¢
        å¹¶è¡ŒæŸ¥è¯¢åŸç†
        æ€§èƒ½æå‡
        é€‚ç”¨åœºæ™¯
      å¼‚æ­¥I/O
        å¼‚æ­¥I/OåŸç†
        æ€§èƒ½æå‡
        é€‚ç”¨åœºæ™¯
    æœ€ä½³å®è·µ
      è®¾è®¡åŸåˆ™
        è®¾è®¡åŸåˆ™
        è®¾è®¡æ–¹æ³•
        è®¾è®¡è¯„ä¼°
      å®æ–½æ­¥éª¤
        å®æ–½è®¡åˆ’
        å®æ–½æ­¥éª¤
        å®æ–½éªŒè¯
      ç»´æŠ¤ç­–ç•¥
        ç»´æŠ¤è®¡åˆ’
        ç»´æŠ¤æ–¹æ³•
        ç»´æŠ¤ä¼˜åŒ–
```

**æ€ç»´å¯¼å›¾è¯´æ˜**ï¼š

æœ¬æ€ç»´å¯¼å›¾å±•ç¤ºäº†æ•°æ®ä»“åº“è®¾è®¡çš„å®Œæ•´çŸ¥è¯†ä½“ç³»ï¼Œä»æ¶æ„è®¾è®¡åˆ°ç»´åº¦å»ºæ¨¡ï¼Œä»ETLè®¾è®¡åˆ°æ€§èƒ½ä¼˜åŒ–ï¼Œæ¯ä¸ªæ¨¡å—éƒ½åŒ…å«ç†è®ºåŸºç¡€ã€è®¾è®¡æ–¹æ³•å’Œå®è·µç»éªŒã€‚é€šè¿‡è¿™ä¸ªæ€ç»´å¯¼å›¾ï¼Œå¯ä»¥å¿«é€Ÿäº†è§£æ•°æ®ä»“åº“è®¾è®¡çš„å…¨è²Œï¼Œå¹¶æ ¹æ®å…·ä½“éœ€æ±‚æ·±å…¥ç›¸å…³ç« èŠ‚ã€‚

**ä½¿ç”¨å»ºè®®**ï¼š

- **æ•°æ®åˆ†æå¸ˆ**ï¼šé‡ç‚¹å…³æ³¨ç»´åº¦å»ºæ¨¡å’ŒETLè®¾è®¡ï¼Œç†è§£å¦‚ä½•è®¾è®¡é«˜æ•ˆçš„æ•°æ®ä»“åº“
- **æ¶æ„å¸ˆ**ï¼šé‡ç‚¹å…³æ³¨æ¶æ„è®¾è®¡å’Œæ€§èƒ½ä¼˜åŒ–ï¼Œç†è§£å¦‚ä½•è®¾è®¡å¯æ‰©å±•çš„æ•°æ®ä»“åº“æ¶æ„
- **æŠ€æœ¯è´Ÿè´£äºº**ï¼šé‡ç‚¹å…³æ³¨æœ€ä½³å®è·µå’ŒPostgreSQL 18æ–°ç‰¹æ€§ï¼Œç†è§£å¦‚ä½•å»ºç«‹é«˜æ•ˆçš„æ•°æ®ä»“åº“ä½“ç³»

---

## ä¸€ã€æ¦‚è¿°

**æ–‡æ¡£è®¾è®¡ç†å¿µ**ï¼š

æœ¬æ–‡æ¡£ä¸ä»…å±•ç¤ºæ•°æ®ä»“åº“è®¾è®¡çš„è¡¨ç»“æ„å’ŒETLä»£ç ï¼Œæ›´é‡è¦çš„æ˜¯è§£é‡Š**ä¸ºä»€ä¹ˆ**éœ€è¦æ•°æ®ä»“åº“ï¼Œ**å¦‚ä½•**è®¾è®¡æ•°æ®ä»“åº“ï¼Œä»¥åŠ**ä½•æ—¶**ä½¿ç”¨ç‰¹å®šçš„è®¾è®¡æ–¹æ³•ã€‚æ¯ä¸ªè®¾è®¡æ–¹æ¡ˆéƒ½åŒ…å«ï¼š

1. **è®¾è®¡ç†è®º**ï¼šè§£é‡Šæ•°æ®ä»“åº“è®¾è®¡çš„åŸç†å’Œæœºåˆ¶
2. **è®¾è®¡æ–¹æ³•**ï¼šè¯´æ˜å¦‚ä½•è¿›è¡Œæ•°æ®ä»“åº“è®¾è®¡
3. **æ€§èƒ½åˆ†æ**ï¼šåˆ†æè®¾è®¡æ–¹æ¡ˆçš„æ€§èƒ½å’Œä¼˜åŒ–æ–¹æ³•
4. **æœ€ä½³å®è·µ**ï¼šæä¾›å®è·µç»éªŒå’Œä¼˜åŒ–å»ºè®®

**æ•°æ®ä»“åº“è®¾è®¡çš„é‡è¦æ€§**ï¼š

æ•°æ®ä»“åº“è®¾è®¡æ˜¯æ•°æ®åˆ†æçš„åŸºç¡€ï¼Œå®ƒç›´æ¥å½±å“ï¼š

1. **åˆ†ææ€§èƒ½**ï¼šåˆç†çš„æ•°æ®ä»“åº“è®¾è®¡å¯ä»¥ä¼˜åŒ–åˆ†ææ€§èƒ½
   - **ç†è®ºä¾æ®**ï¼šæ•°æ®ä»“åº“è®¾è®¡å¯ä»¥ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ï¼Œæé«˜åˆ†ææ•ˆç‡
   - **å®è·µä»·å€¼**ï¼šæå‡åˆ†æé€Ÿåº¦ï¼Œæ”¯æŒå¤æ‚åˆ†ææŸ¥è¯¢
   - **æ•ˆæœè¯„ä¼°**ï¼šåˆ†ææŸ¥è¯¢æ€§èƒ½æå‡10-100å€ï¼Œåˆ†ææ•ˆç‡æå‡50-200%

2. **æ•°æ®è´¨é‡**ï¼šåˆç†çš„æ•°æ®ä»“åº“è®¾è®¡å¯ä»¥ä¿è¯æ•°æ®è´¨é‡
   - **ç†è®ºä¾æ®**ï¼šæ•°æ®ä»“åº“è®¾è®¡å¯ä»¥æ¸…æ´—å’Œæ•´åˆæ•°æ®ï¼Œä¿è¯æ•°æ®è´¨é‡
   - **å®è·µä»·å€¼**ï¼šæé«˜æ•°æ®å®Œæ•´æ€§ã€å‡†ç¡®æ€§ã€ä¸€è‡´æ€§
   - **æ•ˆæœè¯„ä¼°**ï¼šæ•°æ®è´¨é‡æå‡30-60%ï¼Œæ•°æ®é”™è¯¯å‡å°‘50-80%

3. **ç³»ç»Ÿå¯æ‰©å±•æ€§**ï¼šåˆç†çš„æ•°æ®ä»“åº“è®¾è®¡å¯ä»¥æé«˜ç³»ç»Ÿå¯æ‰©å±•æ€§
   - **ç†è®ºä¾æ®**ï¼šå¯æ‰©å±•çš„è®¾è®¡å¯ä»¥æ”¯æŒæ•°æ®é‡å¢é•¿
   - **å®è·µä»·å€¼**ï¼šæ”¯æŒä¸šåŠ¡å¢é•¿ï¼Œé€‚åº”æ•°æ®é‡å¢é•¿
   - **æ•ˆæœè¯„ä¼°**ï¼šç³»ç»Ÿå¯æ‰©å±•æ€§æå‡50-200%ï¼Œæ”¯æŒæ›´å¤§è§„æ¨¡

4. **ä¸šåŠ¡ä»·å€¼**ï¼šåˆç†çš„æ•°æ®ä»“åº“è®¾è®¡å¯ä»¥æä¾›ä¸šåŠ¡ä»·å€¼
   - **ç†è®ºä¾æ®**ï¼šæ•°æ®ä»“åº“å¯ä»¥æ•´åˆæ•°æ®ï¼Œæä¾›ä¸šåŠ¡æ´å¯Ÿ
   - **å®è·µä»·å€¼**ï¼šæ”¯æŒä¸šåŠ¡å†³ç­–ï¼Œæé«˜ä¸šåŠ¡æ•ˆç‡
   - **æ•ˆæœè¯„ä¼°**ï¼šä¸šåŠ¡å†³ç­–æ•ˆç‡æå‡40-70%ï¼Œä¸šåŠ¡ä»·å€¼æå‡æ˜¾è‘—

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š

- **æ¶æ„å®Œæ•´**ï¼šæ¶µç›–åˆ†å±‚æ¶æ„ã€æ•°æ®æµã€å…ƒæ•°æ®
  - **ç†è®ºä¾æ®**ï¼šå®Œæ•´çš„æ¶æ„å¯ä»¥ä¿è¯æ•°æ®ä»“åº“çš„å¯ç»´æŠ¤æ€§
  - **å®è·µä»·å€¼**ï¼šå¸®åŠ©æ•°æ®åˆ†æå¸ˆè®¾è®¡å®Œæ•´çš„æ•°æ®ä»“åº“æ¶æ„
  - **æ¶æ„ç»„ä»¶**ï¼šåˆ†å±‚æ¶æ„ã€æ•°æ®æµã€å…ƒæ•°æ®ç®¡ç†

- **å»ºæ¨¡è§„èŒƒ**ï¼šéµå¾ªç»´åº¦å»ºæ¨¡æœ€ä½³å®è·µ
  - **ç†è®ºä¾æ®**ï¼šç»´åº¦å»ºæ¨¡æ˜¯æ•°æ®ä»“åº“çš„æ ‡å‡†å»ºæ¨¡æ–¹æ³•
  - **å®è·µä»·å€¼**ï¼šæä¾›æ ‡å‡†åŒ–çš„å»ºæ¨¡æ–¹æ³•ï¼Œæé«˜å»ºæ¨¡æ•ˆç‡
  - **å»ºæ¨¡æ–¹æ³•**ï¼šæ˜Ÿå‹æ¨¡å‹ã€é›ªèŠ±æ¨¡å‹ã€äº‹å®è¡¨ã€ç»´åº¦è¡¨

- **æ€§èƒ½ä¼˜åŒ–**ï¼šå……åˆ†åˆ©ç”¨PostgreSQLç‰¹æ€§
  - **ç†è®ºä¾æ®**ï¼šPostgreSQLæä¾›äº†ä¸°å¯Œçš„æ€§èƒ½ä¼˜åŒ–ç‰¹æ€§
  - **å®è·µä»·å€¼**ï¼šåˆ©ç”¨PostgreSQLç‰¹æ€§ä¼˜åŒ–æ•°æ®ä»“åº“æ€§èƒ½
  - **ä¼˜åŒ–æ–¹æ³•**ï¼šåˆ†åŒºã€ç´¢å¼•ã€ç‰©åŒ–è§†å›¾ã€å¹¶è¡ŒæŸ¥è¯¢

- **PostgreSQL 18**ï¼šåˆ©ç”¨æ–°ç‰¹æ€§ä¼˜åŒ–æ€§èƒ½
  - **ç†è®ºä¾æ®**ï¼šæ–°ç‰¹æ€§å¯ä»¥æä¾›æ›´å¥½çš„æ€§èƒ½ä¼˜åŒ–èƒ½åŠ›
  - **å®è·µä»·å€¼**ï¼šPostgreSQL 18çš„æ–°ç‰¹æ€§æä¾›äº†æ›´å¥½çš„æ•°æ®ä»“åº“æ”¯æŒ
  - **æ–°ç‰¹æ€§**ï¼šå¹¶è¡ŒæŸ¥è¯¢ã€å¼‚æ­¥I/Oã€æ€§èƒ½æå‡

æœ¬æ–‡æ¡£ä»æ•°æ®è§†è§’ä»‹ç»PostgreSQL 18çš„æ•°æ®ä»“åº“è®¾è®¡æ–¹æ³•ï¼Œå¸®åŠ©æ•°æ®åˆ†æå¸ˆè®¾è®¡é«˜æ•ˆçš„æ•°æ®ä»“åº“ã€‚

---

## äºŒã€çŸ¥è¯†çŸ©é˜µå¯¹æ¯”

### 2.1 æ•°æ®ä»“åº“æ¶æ„å¯¹æ¯”

| æ¶æ„ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ | å¤æ‚åº¦ | æ¨èåº¦ |
|-----|------|---------|--------|--------|
| **ä¼ ç»Ÿæ•°æ®ä»“åº“** | é›†ä¸­å¼ | ä¼ä¸šçº§ | â­â­â­â­ | â­â­â­â­ |
| **æ•°æ®é›†å¸‚** | ä¸»é¢˜åŒ– | éƒ¨é—¨çº§ | â­â­â­ | â­â­â­â­ |
| **å®æ—¶æ•°æ®ä»“åº“** | ä½å»¶è¿Ÿ | å®æ—¶åˆ†æ | â­â­â­â­â­ | â­â­â­â­ |
| **æ•°æ®æ¹–** | åŸå§‹æ•°æ® | å¤§æ•°æ® | â­â­â­â­â­ | â­â­â­ |

### 2.2 å»ºæ¨¡æ–¹æ³•å¯¹æ¯”

| æ–¹æ³• | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ | æ€§èƒ½ | æ¨èåº¦ |
|-----|------|---------|------|--------|
| **æ˜Ÿå‹æ¨¡å‹** | ç®€å•é«˜æ•ˆ | é€šç”¨ | â­â­â­â­â­ | â­â­â­â­â­ |
| **é›ªèŠ±æ¨¡å‹** | è§„èŒƒåŒ– | å¤æ‚ç»´åº¦ | â­â­â­ | â­â­â­ |
| **æ··åˆæ¨¡å‹** | çµæ´» | å¤æ‚åœºæ™¯ | â­â­â­â­ | â­â­â­â­ |

---

## ä¸‰ã€æ•°æ®ä»“åº“æ¶æ„

### 3.1 åˆ†å±‚æ¶æ„

#### 3.1.1 åˆ†å±‚æ¶æ„çš„åŸç†

**ä¸ºä»€ä¹ˆéœ€è¦åˆ†å±‚æ¶æ„**ï¼š

æ•°æ®ä»“åº“åˆ†å±‚æ¶æ„æä¾›äº†æ¸…æ™°çš„æ•°æ®å¤„ç†æµç¨‹ï¼š

1. **èŒè´£æ¸…æ™°**ï¼šæ¯å±‚æœ‰æ˜ç¡®çš„èŒè´£
2. **æ•°æ®è´¨é‡**ï¼šé€å±‚æ¸…æ´—ï¼Œä¿è¯æ•°æ®è´¨é‡
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šé€å±‚æ±‡æ€»ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½
4. **çµæ´»æ‰©å±•**ï¼šå¯ä»¥ç‹¬ç«‹æ‰©å±•æ¯å±‚

**åˆ†å±‚æ¶æ„çš„ä¼˜åŠ¿**ï¼š

| ä¼˜åŠ¿ | è¯´æ˜ | å®é™…ä»·å€¼ |
|-----|------|---------|
| **èŒè´£æ¸…æ™°** | æ¯å±‚èŒè´£æ˜ç¡® | ä¾¿äºç»´æŠ¤å’Œç®¡ç† |
| **æ€§èƒ½ä¼˜åŒ–** | é€å±‚æ±‡æ€»ï¼Œæå‡æ€§èƒ½ | æŸ¥è¯¢æ€§èƒ½æå‡10-100å€ |
| **æ•°æ®è´¨é‡** | é€å±‚æ¸…æ´—ï¼Œä¿è¯è´¨é‡ | æ•°æ®è´¨é‡é€æ­¥æå‡ |
| **çµæ´»æ‰©å±•** | å¯ä»¥ç‹¬ç«‹æ‰©å±•æ¯å±‚ | æ”¯æŒçµæ´»æ‰©å±• |

#### 3.1.2 åˆ†å±‚æ¶æ„è®¾è®¡

**æ•°æ®ä»“åº“åˆ†å±‚**ï¼š

```text
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  æ•°æ®æº     â”‚
                    â”‚ (ä¸šåŠ¡ç³»ç»Ÿ)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ ETL
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚   ODSå±‚     â”‚
                    â”‚ (æ“ä½œæ•°æ®å­˜å‚¨)â”‚
                    â”‚ - åŸå§‹æ•°æ®   â”‚
                    â”‚ - æ¥è¿‘æºç³»ç»Ÿ â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ æ¸…æ´—è½¬æ¢
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚   DWDå±‚     â”‚
                    â”‚ (æ•°æ®ä»“åº“æ˜ç»†)â”‚
                    â”‚ - æ¸…æ´—åæ•°æ® â”‚
                    â”‚ - æ ‡å‡†åŒ–æ•°æ® â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ æ±‡æ€»èšåˆ
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚   DWSå±‚     â”‚
                    â”‚ (æ•°æ®ä»“åº“æ±‡æ€»)â”‚
                    â”‚ - æ±‡æ€»æ•°æ®   â”‚
                    â”‚ - ä¸»é¢˜æ•°æ®   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ åº”ç”¨åŠ å·¥
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚   ADSå±‚     â”‚
                    â”‚ (åº”ç”¨æ•°æ®æœåŠ¡)â”‚
                    â”‚ - åº”ç”¨æ•°æ®   â”‚
                    â”‚ - æŠ¥è¡¨æ•°æ®   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ æŸ¥è¯¢
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚  BIå·¥å…·     â”‚
                    â”‚ (æŠ¥è¡¨åˆ†æ)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å„å±‚èŒè´£è¯´æ˜**ï¼š

| å±‚çº§ | èŒè´£ | æ•°æ®ç‰¹ç‚¹ | å­˜å‚¨å‘¨æœŸ |
|-----|------|---------|---------|
| **ODSå±‚** | å­˜å‚¨åŸå§‹æ•°æ® | æ¥è¿‘æºç³»ç»Ÿï¼Œæœªæ¸…æ´— | 3-6ä¸ªæœˆ |
| **DWDå±‚** | å­˜å‚¨æ¸…æ´—åçš„æ˜ç»†æ•°æ® | æ ‡å‡†åŒ–ã€è§„èŒƒåŒ– | 1-3å¹´ |
| **DWSå±‚** | å­˜å‚¨æ±‡æ€»æ•°æ® | æŒ‰ä¸»é¢˜æ±‡æ€» | 3-5å¹´ |
| **ADSå±‚** | å­˜å‚¨åº”ç”¨æ•°æ® | é¢å‘åº”ç”¨ï¼Œé¢„è®¡ç®— | æŒ‰éœ€ |

### 3.2 æ•°æ®æµè®¾è®¡

#### 3.2.1 æ•°æ®æµè®¾è®¡åŸç†

**ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®æµè®¾è®¡**ï¼š

æ•°æ®æµè®¾è®¡å®šä¹‰äº†æ•°æ®åœ¨æ•°æ®ä»“åº“ä¸­çš„æµè½¬è¿‡ç¨‹ï¼š

1. **æ•°æ®è¿½è¸ª**ï¼šå¯ä»¥è¿½è¸ªæ•°æ®çš„æ¥æºå’Œå»å‘
2. **æ•°æ®è´¨é‡**ï¼šåœ¨æµè½¬è¿‡ç¨‹ä¸­ä¿è¯æ•°æ®è´¨é‡
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šä¼˜åŒ–æ•°æ®æµè½¬æ€§èƒ½
4. **é—®é¢˜å®šä½**ï¼šå¯ä»¥å¿«é€Ÿå®šä½æ•°æ®é—®é¢˜

#### 3.2.2 æ•°æ®æµå®ç°

**æ•°æ®æµç¤ºä¾‹**ï¼š

```sql
-- åœºæ™¯ï¼šè®¢å•æ•°æ®ä»æºç³»ç»Ÿåˆ°æ•°æ®ä»“åº“çš„æµè½¬
-- éœ€æ±‚ï¼šè®¾è®¡å®Œæ•´çš„æ•°æ®æµè½¬è¿‡ç¨‹
-- ç”¨é€”ï¼šæ•°æ®ä»“åº“ETLæµç¨‹

-- ODSå±‚ï¼šåŸå§‹æ•°æ®ï¼ˆæ“ä½œæ•°æ®å­˜å‚¨ï¼‰
-- ç‰¹ç‚¹ï¼šæ¥è¿‘æºç³»ç»Ÿï¼Œä¿ç•™åŸå§‹æ•°æ®
CREATE TABLE ods_orders (
    id BIGINT,
    user_id BIGINT,
    amount DECIMAL(10,2),
    created_at TIMESTAMP,
    source_system VARCHAR(50),  -- æºç³»ç»Ÿæ ‡è¯†
    load_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,  -- åŠ è½½æ—¶é—´
    PRIMARY KEY (id, source_system)
);

-- ODSå±‚è®¾è®¡è€ƒè™‘ï¼š
-- 1. ä¿ç•™åŸå§‹æ•°æ®ï¼šä¸è¿›è¡Œæ¸…æ´—ï¼Œä¿ç•™åŸå§‹çŠ¶æ€
-- 2. æºç³»ç»Ÿæ ‡è¯†ï¼šè®°å½•æ•°æ®æ¥æº
-- 3. åŠ è½½æ—¶é—´ï¼šè®°å½•æ•°æ®åŠ è½½æ—¶é—´
-- 4. æ”¯æŒå¤šæºï¼šå¯ä»¥å­˜å‚¨å¤šä¸ªæºç³»ç»Ÿçš„æ•°æ®

-- DWDå±‚ï¼šæ¸…æ´—åçš„æ˜ç»†æ•°æ®ï¼ˆæ•°æ®ä»“åº“æ˜ç»†ï¼‰
-- ç‰¹ç‚¹ï¼šæ¸…æ´—ã€æ ‡å‡†åŒ–ã€è§„èŒƒåŒ–
CREATE TABLE dwd_orders (
    order_id BIGINT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    amount DECIMAL(10,2) NOT NULL CHECK (amount > 0),
    order_date DATE NOT NULL,
    order_time TIMESTAMP NOT NULL,
    source_system VARCHAR(50) NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- DWDå±‚è®¾è®¡è€ƒè™‘ï¼š
-- 1. æ•°æ®æ¸…æ´—ï¼šå»é™¤æ— æ•ˆæ•°æ®ã€æ ‡å‡†åŒ–æ ¼å¼
-- 2. æ•°æ®éªŒè¯ï¼šä½¿ç”¨çº¦æŸä¿è¯æ•°æ®è´¨é‡
-- 3. æ—¶é—´ç»´åº¦ï¼šåˆ†ç¦»æ—¥æœŸå’Œæ—¶é—´
-- 4. æ•°æ®æ ‡å‡†åŒ–ï¼šç»Ÿä¸€æ•°æ®æ ¼å¼

-- DWSå±‚ï¼šæ±‡æ€»æ•°æ®ï¼ˆæ•°æ®ä»“åº“æ±‡æ€»ï¼‰
-- ç‰¹ç‚¹ï¼šæŒ‰ä¸»é¢˜æ±‡æ€»ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½
CREATE TABLE dws_user_orders_daily (
    user_id BIGINT NOT NULL,
    order_date DATE NOT NULL,
    order_count INTEGER NOT NULL DEFAULT 0,
    total_amount DECIMAL(15,2) NOT NULL DEFAULT 0,
    avg_amount DECIMAL(15,2) NOT NULL DEFAULT 0,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (user_id, order_date)
);

-- DWSå±‚è®¾è®¡è€ƒè™‘ï¼š
-- 1. æŒ‰ä¸»é¢˜æ±‡æ€»ï¼šæŒ‰ç”¨æˆ·ã€æ—¥æœŸç­‰ç»´åº¦æ±‡æ€»
-- 2. é¢„è®¡ç®—æŒ‡æ ‡ï¼šæå‰è®¡ç®—å¸¸ç”¨æŒ‡æ ‡
-- 3. æå‡æ€§èƒ½ï¼šæ±‡æ€»æ•°æ®æŸ¥è¯¢æ€§èƒ½å¥½
-- 4. å®šæœŸåˆ·æ–°ï¼šå®šæœŸä»DWDå±‚åˆ·æ–°æ•°æ®

-- ADSå±‚ï¼šåº”ç”¨æ•°æ®ï¼ˆåº”ç”¨æ•°æ®æœåŠ¡ï¼‰
-- ç‰¹ç‚¹ï¼šé¢å‘åº”ç”¨ï¼Œé¢„è®¡ç®—ï¼Œå¿«é€ŸæŸ¥è¯¢
CREATE TABLE ads_user_summary (
    user_id BIGINT PRIMARY KEY,
    total_orders INTEGER NOT NULL DEFAULT 0,
    total_amount DECIMAL(15,2) NOT NULL DEFAULT 0,
    avg_order_amount DECIMAL(15,2) NOT NULL DEFAULT 0,
    last_order_date DATE,
    first_order_date DATE,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- ADSå±‚è®¾è®¡è€ƒè™‘ï¼š
-- 1. é¢å‘åº”ç”¨ï¼šé’ˆå¯¹å…·ä½“åº”ç”¨éœ€æ±‚è®¾è®¡
-- 2. é¢„è®¡ç®—ï¼šæå‰è®¡ç®—åº”ç”¨éœ€è¦çš„æŒ‡æ ‡
-- 3. å¿«é€ŸæŸ¥è¯¢ï¼šæŸ¥è¯¢æ€§èƒ½æä½³
-- 4. å®æ—¶æ›´æ–°ï¼šå¯ä»¥å®æ—¶æˆ–å‡†å®æ—¶æ›´æ–°

-- DWSå±‚ï¼šæ±‡æ€»æ•°æ®
CREATE TABLE dws_daily_sales (
    sale_date DATE PRIMARY KEY,
    total_orders BIGINT,
    total_amount DECIMAL(12,2),
    avg_amount DECIMAL(10,2)
);

```

### 3.3 å…ƒæ•°æ®ç®¡ç†

**å…ƒæ•°æ®è¡¨è®¾è®¡**ï¼š

```sql
-- å…ƒæ•°æ®è¡¨
CREATE TABLE metadata_tables (
    table_name TEXT PRIMARY KEY,
    table_type TEXT,  -- 'fact', 'dimension', 'staging'
    description TEXT,
    source_system TEXT,
    update_frequency TEXT,
    last_updated TIMESTAMP
);
```

---

## å››ã€ç»´åº¦å»ºæ¨¡

### 4.1 æ˜Ÿå‹æ¨¡å‹

**æ˜Ÿå‹æ¨¡å‹ç¤ºä¾‹**ï¼š

```sql
-- äº‹å®è¡¨
CREATE TABLE fact_sales (
    sale_id BIGSERIAL PRIMARY KEY,
    date_id INTEGER NOT NULL,
    product_id INTEGER NOT NULL,
    customer_id INTEGER NOT NULL,
    store_id INTEGER NOT NULL,
    quantity INTEGER NOT NULL,
    amount DECIMAL(10,2) NOT NULL,
    discount DECIMAL(10,2) NOT NULL
);

-- ç»´åº¦è¡¨
CREATE TABLE dim_date (
    date_id SERIAL PRIMARY KEY,
    date DATE NOT NULL UNIQUE,
    year INTEGER NOT NULL,
    quarter INTEGER NOT NULL,
    month INTEGER NOT NULL,
    week INTEGER NOT NULL,
    day_of_week INTEGER NOT NULL,
    is_weekend BOOLEAN NOT NULL
);

CREATE TABLE dim_product (
    product_id SERIAL PRIMARY KEY,
    product_name VARCHAR(100) NOT NULL,
    category VARCHAR(50) NOT NULL,
    brand VARCHAR(50),
    price DECIMAL(10,2) NOT NULL
);

CREATE TABLE dim_customer (
    customer_id SERIAL PRIMARY KEY,
    customer_name VARCHAR(100) NOT NULL,
    city VARCHAR(50),
    state VARCHAR(50),
    country VARCHAR(50),
    customer_segment VARCHAR(50)
);

CREATE TABLE dim_store (
    store_id SERIAL PRIMARY KEY,
    store_name VARCHAR(100) NOT NULL,
    city VARCHAR(50),
    state VARCHAR(50),
    country VARCHAR(50)
);
```

### 4.2 é›ªèŠ±æ¨¡å‹

**é›ªèŠ±æ¨¡å‹ç¤ºä¾‹**ï¼š

```sql
-- è§„èŒƒåŒ–ç»´åº¦è¡¨
CREATE TABLE dim_product (
    product_id SERIAL PRIMARY KEY,
    product_name VARCHAR(100) NOT NULL,
    category_id INTEGER NOT NULL REFERENCES dim_category(category_id),
    brand_id INTEGER NOT NULL REFERENCES dim_brand(brand_id)
);

CREATE TABLE dim_category (
    category_id SERIAL PRIMARY KEY,
    category_name VARCHAR(50) NOT NULL,
    department_id INTEGER NOT NULL REFERENCES dim_department(department_id)
);

CREATE TABLE dim_department (
    department_id SERIAL PRIMARY KEY,
    department_name VARCHAR(50) NOT NULL
);
```

### 4.3 äº‹å®è¡¨è®¾è®¡

**äº‹å®è¡¨ç±»å‹**ï¼š

```sql
-- äº‹åŠ¡äº‹å®è¡¨
CREATE TABLE fact_transactions (
    transaction_id BIGSERIAL PRIMARY KEY,
    date_id INTEGER NOT NULL,
    account_id INTEGER NOT NULL,
    transaction_type VARCHAR(20) NOT NULL,
    amount DECIMAL(10,2) NOT NULL,
    balance DECIMAL(12,2) NOT NULL
);

-- å¿«ç…§äº‹å®è¡¨
CREATE TABLE fact_account_snapshot (
    snapshot_id BIGSERIAL PRIMARY KEY,
    date_id INTEGER NOT NULL,
    account_id INTEGER NOT NULL,
    balance DECIMAL(12,2) NOT NULL,
    transaction_count INTEGER NOT NULL
);
```

### 4.4 ç»´åº¦è¡¨è®¾è®¡

**SCDå¤„ç†**ï¼š

```sql
-- Type 1: è¦†ç›–
CREATE TABLE dim_customer_type1 (
    customer_id SERIAL PRIMARY KEY,
    customer_name VARCHAR(100) NOT NULL,
    email VARCHAR(100) NOT NULL,
    city VARCHAR(50)
);

-- Type 2: å†å²ç‰ˆæœ¬
CREATE TABLE dim_customer_type2 (
    customer_sk SERIAL PRIMARY KEY,
    customer_id INTEGER NOT NULL,
    customer_name VARCHAR(100) NOT NULL,
    email VARCHAR(100) NOT NULL,
    city VARCHAR(50),
    valid_from DATE NOT NULL,
    valid_to DATE,
    is_current BOOLEAN NOT NULL DEFAULT TRUE
);
```

---

## äº”ã€ETLè®¾è®¡

### 5.1 æŠ½å–è®¾è®¡

**å¢é‡æŠ½å–**ï¼š

```sql
-- å¢é‡æŠ½å–ï¼šåŸºäºæ—¶é—´æˆ³
INSERT INTO ods_orders
SELECT * FROM source_orders
WHERE updated_at > (
    SELECT MAX(load_time) FROM ods_orders
);
```

### 5.2 è½¬æ¢è®¾è®¡

**æ•°æ®è½¬æ¢**ï¼š

```sql
-- è½¬æ¢åˆ°DWDå±‚
INSERT INTO dwd_orders (order_id, user_id, amount, order_date, hour_of_day)
SELECT
    id,
    user_id,
    amount,
    created_at::DATE,
    EXTRACT(HOUR FROM created_at)
FROM ods_orders
WHERE load_time > CURRENT_DATE - INTERVAL '1 day';
```

### 5.3 åŠ è½½è®¾è®¡

**åŠ è½½åˆ°äº‹å®è¡¨**ï¼š

```sql
-- åŠ è½½åˆ°äº‹å®è¡¨
INSERT INTO fact_sales (date_id, product_id, customer_id, store_id, quantity, amount, discount)
SELECT
    d.date_id,
    p.product_id,
    c.customer_id,
    s.store_id,
    oi.quantity,
    oi.amount,
    oi.discount
FROM ods_order_items oi
JOIN ods_orders o ON oi.order_id = o.id
JOIN dim_date d ON o.created_at::DATE = d.date
JOIN dim_product p ON oi.product_id = p.product_id
JOIN dim_customer c ON o.user_id = c.customer_id
JOIN dim_store s ON o.store_id = s.store_id;
```

---

## å…­ã€æ€§èƒ½ä¼˜åŒ–

### 6.1 åˆ†åŒºç­–ç•¥

**æ—¶é—´åˆ†åŒº**ï¼š

```sql
-- äº‹å®è¡¨æŒ‰æ—¶é—´åˆ†åŒº
CREATE TABLE fact_sales (
    sale_id BIGSERIAL,
    date_id INTEGER NOT NULL,
    product_id INTEGER NOT NULL,
    customer_id INTEGER NOT NULL,
    quantity INTEGER NOT NULL,
    amount DECIMAL(10,2) NOT NULL
) PARTITION BY RANGE (date_id);

-- åˆ›å»ºæœˆåº¦åˆ†åŒº
CREATE TABLE fact_sales_2024_01 PARTITION OF fact_sales
    FOR VALUES FROM (20240101) TO (20240201);
```

### 6.2 ç´¢å¼•ä¼˜åŒ–

**ç´¢å¼•è®¾è®¡**ï¼š

```sql
-- äº‹å®è¡¨ç´¢å¼•
CREATE INDEX idx_fact_sales_date ON fact_sales(date_id);
CREATE INDEX idx_fact_sales_product ON fact_sales(product_id);
CREATE INDEX idx_fact_sales_customer ON fact_sales(customer_id);

-- ç»´åº¦è¡¨ç´¢å¼•
CREATE INDEX idx_dim_date_date ON dim_date(date);
CREATE UNIQUE INDEX idx_dim_product_product_id ON dim_product(product_id);
```

### 6.3 ç‰©åŒ–è§†å›¾

**ç‰©åŒ–è§†å›¾**ï¼š

```sql
-- åˆ›å»ºç‰©åŒ–è§†å›¾
CREATE MATERIALIZED VIEW mv_daily_sales AS
SELECT
    d.date,
    COUNT(*) as order_count,
    SUM(f.amount) as total_amount,
    AVG(f.amount) as avg_amount
FROM fact_sales f
JOIN dim_date d ON f.date_id = d.date_id
GROUP BY d.date;

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_mv_daily_sales_date ON mv_daily_sales(date);

-- åˆ·æ–°ç‰©åŒ–è§†å›¾
REFRESH MATERIALIZED VIEW CONCURRENTLY mv_daily_sales;
```

---

## ä¸ƒã€PostgreSQL 18ä¼˜åŒ–

### 7.1 å¹¶è¡ŒæŸ¥è¯¢ä¼˜åŒ–

**å¹¶è¡Œåˆ†ææŸ¥è¯¢**ï¼š

```sql
-- å¯ç”¨å¹¶è¡ŒæŸ¥è¯¢
SET max_parallel_workers_per_gather = 4;

-- å¹¶è¡Œèšåˆ
SELECT
    product_id,
    SUM(amount) as total_sales
FROM fact_sales
GROUP BY product_id;
```

### 7.2 å¼‚æ­¥I/Oä¼˜åŒ–

**å¼‚æ­¥I/Oé…ç½®**ï¼š

```conf
# postgresql.conf
max_io_concurrency = 10
```

---

## å…«ã€æœ€ä½³å®è·µ

### 8.1 è®¾è®¡åŸåˆ™

**è®¾è®¡åŸåˆ™**ï¼š

- é¢å‘ä¸»é¢˜
- é›†æˆæ€§
- éæ˜“å¤±æ€§
- æ—¶å˜æ€§

### 8.2 å®æ–½æ­¥éª¤

**å®æ–½æ­¥éª¤**ï¼š

1. éœ€æ±‚åˆ†æ
2. æ¶æ„è®¾è®¡
3. æ¨¡å‹è®¾è®¡
4. ETLå¼€å‘
5. æµ‹è¯•éªŒè¯
6. ä¸Šçº¿è¿è¡Œ

### 8.3 ç»´æŠ¤ç­–ç•¥

**ç»´æŠ¤ç­–ç•¥**ï¼š

- å®šæœŸåˆ·æ–°
- æ€§èƒ½ç›‘æ§
- å®¹é‡è§„åˆ’
- æ•°æ®è´¨é‡æ£€æŸ¥

---

## ä¹ã€ç›¸å…³æ–‡æ¡£

- [æ•°æ®å»ºæ¨¡æ–¹æ³•è®º](./03.01-æ•°æ®å»ºæ¨¡æ–¹æ³•è®º.md)
- [ETLæµç¨‹è®¾è®¡](./03.02-ETLæµç¨‹è®¾è®¡.md)
- [æ•°æ®åˆ†æä¸æŒ–æ˜](./03.03-æ•°æ®åˆ†æä¸æŒ–æ˜.md)
- [æ•°æ®ä»“åº“è®¾è®¡æŒ‡å—](../../09-åº”ç”¨è®¾è®¡/æ•°æ®æ¨¡å‹è®¾è®¡/09.03-æ•°æ®ä»“åº“è®¾è®¡æŒ‡å—.md)

---

**æœ€åæ›´æ–°**: 2025-01-15
**ç»´æŠ¤è€…**: PostgreSQL Documentation Team
