# è„‘æœºæ¥å£ç¼“å­˜æ–¹æ¡ˆ

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 14+, Neon Platform
> **æ–‡æ¡£ç¼–å·**: 08-03-01

## ğŸ“‘ ç›®å½•

- [è„‘æœºæ¥å£ç¼“å­˜æ–¹æ¡ˆ](#è„‘æœºæ¥å£ç¼“å­˜æ–¹æ¡ˆ)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
    - [1.1 æ¡ˆä¾‹èƒŒæ™¯](#11-æ¡ˆä¾‹èƒŒæ™¯)
    - [1.2 ä¸šåŠ¡ä»·å€¼](#12-ä¸šåŠ¡ä»·å€¼)
    - [1.3 æŠ€æœ¯äº®ç‚¹](#13-æŠ€æœ¯äº®ç‚¹)
  - [2. ä¸šåŠ¡åœºæ™¯](#2-ä¸šåŠ¡åœºæ™¯)
    - [2.1 è„‘æœºæ¥å£ç¼“å­˜æ–¹æ¡ˆä½“ç³»æ€ç»´å¯¼å›¾](#21-è„‘æœºæ¥å£ç¼“å­˜æ–¹æ¡ˆä½“ç³»æ€ç»´å¯¼å›¾)
    - [2.2 é—®é¢˜åˆ†æ](#22-é—®é¢˜åˆ†æ)
    - [2.2 è§£å†³æ–¹æ¡ˆ](#22-è§£å†³æ–¹æ¡ˆ)
    - [2.3 æŠ€æœ¯é€‰å‹](#23-æŠ€æœ¯é€‰å‹)
    - [2.3 æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ](#23-æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ)
  - [3. æŠ€æœ¯æ¶æ„](#3-æŠ€æœ¯æ¶æ„)
    - [3.1 æ•´ä½“æ¶æ„](#31-æ•´ä½“æ¶æ„)
    - [3.2 æ•°æ®æµè®¾è®¡](#32-æ•°æ®æµè®¾è®¡)
    - [3.3 åˆ†æ”¯ç®¡ç†æµç¨‹](#33-åˆ†æ”¯ç®¡ç†æµç¨‹)
  - [4. å®ç°ç»†èŠ‚](#4-å®ç°ç»†èŠ‚)
    - [4.1 å®éªŒåˆ†æ”¯ç®¡ç†](#41-å®éªŒåˆ†æ”¯ç®¡ç†)
    - [4.2 æ•°æ®é‡‡é›†ä¸å­˜å‚¨](#42-æ•°æ®é‡‡é›†ä¸å­˜å‚¨)
    - [4.3 å®éªŒæµç¨‹ç®¡ç†](#43-å®éªŒæµç¨‹ç®¡ç†)
    - [4.4 è‡ªåŠ¨æ¸…ç†ç­–ç•¥](#44-è‡ªåŠ¨æ¸…ç†ç­–ç•¥)
  - [5. æ€§èƒ½åˆ†æ](#5-æ€§èƒ½åˆ†æ)
    - [5.1 æˆæœ¬æ•ˆç›Šåˆ†æ](#51-æˆæœ¬æ•ˆç›Šåˆ†æ)
      - [5.1.1 æˆæœ¬å¯¹æ¯”](#511-æˆæœ¬å¯¹æ¯”)
      - [5.1.2 å¹´åº¦æˆæœ¬è®¡ç®—](#512-å¹´åº¦æˆæœ¬è®¡ç®—)
    - [5.2 æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”](#52-æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”)
      - [5.2.1 æ€§èƒ½å¯¹æ¯”](#521-æ€§èƒ½å¯¹æ¯”)
      - [5.2.2 å®éªŒé¢‘ç‡æå‡](#522-å®éªŒé¢‘ç‡æå‡)
    - [5.3 å®é™…åº”ç”¨æ•ˆæœ](#53-å®é™…åº”ç”¨æ•ˆæœ)
      - [5.3.1 æ¡ˆä¾‹æ•ˆæœ](#531-æ¡ˆä¾‹æ•ˆæœ)
      - [5.3.2 æ•°æ®ç‰ˆæœ¬ç®¡ç†æ•ˆæœ](#532-æ•°æ®ç‰ˆæœ¬ç®¡ç†æ•ˆæœ)
    - [5.4 æˆæœ¬ä¼˜åŒ–è¯¦ç»†è¿‡ç¨‹](#54-æˆæœ¬ä¼˜åŒ–è¯¦ç»†è¿‡ç¨‹)
      - [5.4.1 æˆæœ¬é™ä½ 93% çš„ä¼˜åŒ–è¿‡ç¨‹](#541-æˆæœ¬é™ä½-93-çš„ä¼˜åŒ–è¿‡ç¨‹)
      - [5.4.2 å®éªŒå¯åŠ¨æ—¶é—´é™ä½ 99% çš„ä¼˜åŒ–è¿‡ç¨‹](#542-å®éªŒå¯åŠ¨æ—¶é—´é™ä½-99-çš„ä¼˜åŒ–è¿‡ç¨‹)
  - [6. æœ€ä½³å®è·µ](#6-æœ€ä½³å®è·µ)
    - [6.1 å®éªŒå‘½åè§„èŒƒ](#61-å®éªŒå‘½åè§„èŒƒ)
    - [6.2 æ•°æ®ç‰ˆæœ¬ç®¡ç†](#62-æ•°æ®ç‰ˆæœ¬ç®¡ç†)
    - [6.3 å®éªŒå¯¹æ¯”åˆ†æ](#63-å®éªŒå¯¹æ¯”åˆ†æ)
    - [6.4 è‡ªåŠ¨æ¸…ç†ç­–ç•¥](#64-è‡ªåŠ¨æ¸…ç†ç­–ç•¥)
  - [7. å‚è€ƒèµ„æ–™](#7-å‚è€ƒèµ„æ–™)
    - [7.1 å®˜æ–¹æ–‡æ¡£](#71-å®˜æ–¹æ–‡æ¡£)
    - [7.2 æŠ€æœ¯æ–‡æ¡£](#72-æŠ€æœ¯æ–‡æ¡£)
    - [7.3 ç›¸å…³èµ„æº](#73-ç›¸å…³èµ„æº)
  - [8. å®Œæ•´ä»£ç ç¤ºä¾‹](#8-å®Œæ•´ä»£ç ç¤ºä¾‹)
    - [8.1 Neonåˆ†æ”¯åˆ›å»ºä¸ç®¡ç†](#81-neonåˆ†æ”¯åˆ›å»ºä¸ç®¡ç†)
    - [8.2 å®éªŒæ•°æ®ç‰ˆæœ¬ç®¡ç†](#82-å®éªŒæ•°æ®ç‰ˆæœ¬ç®¡ç†)
    - [8.3 å®éªŒå¯¹æ¯”åˆ†æ](#83-å®éªŒå¯¹æ¯”åˆ†æ)
    - [8.4 è‡ªåŠ¨æ¸…ç†ç­–ç•¥å®ç°](#84-è‡ªåŠ¨æ¸…ç†ç­–ç•¥å®ç°)

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

### 1.1 æ¡ˆä¾‹èƒŒæ™¯

**ä¼ä¸šèƒŒæ™¯**:

æŸåŒ»ç–— AI ç ”ç©¶æœºæ„ï¼ˆ2025 å¹´ 11 æœˆæ•°æ®ï¼‰ï¼š

- **ç ”ç©¶é¢†åŸŸ**: è„‘æœºæ¥å£ (BCI) ç ”ç©¶
- **å®éªŒé¢‘ç‡**: æ¯å¤© 50-100 æ¬¡å®éªŒ
- **æ•°æ®è§„æ¨¡**: æ¯æ¬¡å®éªŒ 10-50GB æ•°æ®
- **å®éªŒæ—¶é•¿**: æ¯æ¬¡å®éªŒ 1-4 å°æ—¶
- **è¡Œä¸š**: åŒ»ç–— AI ç ”ç©¶

**ä¸šåŠ¡ç—›ç‚¹**:

1. **å®éªŒæˆæœ¬é«˜**:

   - **æ•°æ®åº“æˆæœ¬**: æ¯æ¬¡å®éªŒéœ€è¦ç‹¬ç«‹æ•°æ®åº“ï¼Œæˆæœ¬ $50/æœˆ/å®éªŒ
   - **å­˜å‚¨æˆæœ¬**: å®éªŒæ•°æ®å­˜å‚¨æˆæœ¬é«˜ï¼Œæ¯æœˆ $100
   - **æ€»æˆæœ¬**: æ¯æœˆå®éªŒæˆæœ¬ $150-300ï¼ˆ50-100 æ¬¡å®éªŒï¼‰
   - **é—®é¢˜**: å®éªŒæˆæœ¬é«˜ï¼Œé™åˆ¶å®éªŒé¢‘ç‡

1. **æ•°æ®ç‰ˆæœ¬ç®¡ç†å›°éš¾**:

   - **ç‰ˆæœ¬æ··ä¹±**: å®éªŒæ•°æ®ç‰ˆæœ¬ç®¡ç†å›°éš¾ï¼Œéš¾ä»¥å›æº¯
   - **å¯¹æ¯”å›°éš¾**: ä¸åŒå®éªŒæ•°æ®å¯¹æ¯”å›°éš¾ï¼Œæ— æ³•å¿«é€Ÿå®šä½é—®é¢˜
   - **æ•°æ®ä¸¢å¤±**: å®éªŒæ•°æ®å®¹æ˜“ä¸¢å¤±ï¼Œéš¾ä»¥æ¢å¤
   - **é—®é¢˜**: éœ€è¦ Git å¼çš„æ•°æ®ç‰ˆæœ¬ç®¡ç†

1. **å®éªŒéš”ç¦»å·®**:

   - **æ•°æ®å¹²æ‰°**: ä¸åŒå®éªŒæ•°æ®äº’ç›¸å¹²æ‰°ï¼Œå½±å“å®éªŒç»“æœ
   - **ç¯å¢ƒæ±¡æŸ“**: å®éªŒç¯å¢ƒæ±¡æŸ“ï¼Œå½±å“åç»­å®éªŒ
   - **é—®é¢˜**: éœ€è¦å®Œå…¨éš”ç¦»çš„å®éªŒç¯å¢ƒ

1. **å¯åŠ¨å»¶è¿Ÿé«˜**:
   - **æ•°æ®åº“å‡†å¤‡**: å®éªŒå¯åŠ¨éœ€è¦ç­‰å¾…æ•°æ®åº“å‡†å¤‡ï¼Œå»¶è¿Ÿ 5 åˆ†é’Ÿ
   - **å®éªŒæ•ˆç‡ä½**: å¯åŠ¨å»¶è¿Ÿå½±å“å®éªŒæ•ˆç‡
   - **é—®é¢˜**: éœ€è¦å¿«é€Ÿå¯åŠ¨å®éªŒç¯å¢ƒ

**æŠ€æœ¯æ¼”è¿›**:

1. **2018 å¹´**: ä½¿ç”¨ä¼ ç»Ÿæ•°æ®åº“ï¼Œæ‰‹åŠ¨åˆ›å»ºå®éªŒæ•°æ®åº“
1. **2020 å¹´**: ä½¿ç”¨å®¹å™¨åŒ–æ•°æ®åº“ï¼Œç¼©çŸ­åˆ›å»ºæ—¶é—´
1. **2023 å¹´**: å¼•å…¥ Neon Serverlessï¼Œæ”¯æŒåˆ†æ”¯åŠŸèƒ½
1. **2025 å¹´**: Neon Branching æˆç†Ÿï¼Œå®éªŒæˆæœ¬é™ä½ **90%**

### 1.2 ä¸šåŠ¡ä»·å€¼

**å®šé‡ä»·å€¼è®ºè¯**:

åŸºäº 2025 å¹´ 11 æœˆå®é™…è¿è¡Œæ•°æ®ï¼š

1. **æˆæœ¬é™ä½**:

   - **å®éªŒæ•°æ®åº“æˆæœ¬**: ä» $50/æœˆ/å®éªŒé™ä½åˆ° **$0**ï¼ˆåˆ†æ”¯åˆ›å»ºé›¶æˆæœ¬ï¼‰
   - **å­˜å‚¨æˆæœ¬**: ä» $100/æœˆé™ä½åˆ° **$10/æœˆ**ï¼ˆé™ä½ **90%**ï¼‰
   - **æ€»æˆæœ¬**: ä» $150-300/æœˆé™ä½åˆ° **$10/æœˆ**ï¼ˆé™ä½ **93-97%**ï¼‰
   - **å¹´åº¦èŠ‚çœ**: å¹´åº¦èŠ‚çœ **$1680-3540**

1. **æ•ˆç‡æå‡**:

   - **å®éªŒå¯åŠ¨æ—¶é—´**: ä» 5 åˆ†é’Ÿé™ä½åˆ° **<2 ç§’**ï¼ˆæå‡ **150 å€**ï¼‰
   - **åˆ†æ”¯åˆ›å»ºæ—¶é—´**: ä»ä¸æ”¯æŒåˆ° **<1 ç§’**
   - **å®éªŒé¢‘ç‡**: ä»æ¯å¤© 50 æ¬¡æå‡åˆ° **100 æ¬¡**ï¼ˆæå‡ **100%**ï¼‰

1. **æ•°æ®ç®¡ç†æ”¹å–„**:
   - **ç‰ˆæœ¬ç®¡ç†**: ä»æ‰‹åŠ¨ç®¡ç†åˆ° **Git å¼ç®¡ç†**
   - **æ•°æ®å¯¹æ¯”**: ä»å›°éš¾åˆ° **ä¸€é”®å¯¹æ¯”**
   - **æ•°æ®æ¢å¤**: ä»å›°éš¾åˆ° **ä¸€é”®æ¢å¤**

### 1.3 æŠ€æœ¯äº®ç‚¹

**æ ¸å¿ƒæŠ€æœ¯**:

1. **Neon Serverless + Branching**: æ•°æ®åº“åˆ†æ”¯åŠŸèƒ½ï¼Œé›¶æˆæœ¬åˆ›å»ºå®éªŒç¯å¢ƒ
1. **Scale-to-Zero**: å®éªŒé—´éš™è‡ªåŠ¨åœæ­¢ï¼Œé›¶æˆæœ¬
1. **Copy-on-Write**: åˆ†æ”¯åˆ›å»º <1 ç§’ï¼Œå¿«é€Ÿå¯åŠ¨
1. **Git å¼ç®¡ç†**: æ”¯æŒåˆ†æ”¯ã€åˆå¹¶ã€æ ‡ç­¾ç­‰æ“ä½œ

## 2. ä¸šåŠ¡åœºæ™¯

### 2.1 è„‘æœºæ¥å£ç¼“å­˜æ–¹æ¡ˆä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((è„‘æœºæ¥å£ç¼“å­˜æ–¹æ¡ˆ))
    æ¡ˆä¾‹æ¦‚è¿°
      æ¡ˆä¾‹èƒŒæ™¯
        åŒ»ç–—AIç ”ç©¶
        è„‘æœºæ¥å£ç ”ç©¶
        å®éªŒé¢‘ç‡
        æ•°æ®è§„æ¨¡
      ä¸šåŠ¡ä»·å€¼
        æˆæœ¬é™ä½
        æ•ˆç‡æå‡
        æ•°æ®ç®¡ç†æ”¹å–„
      æŠ€æœ¯äº®ç‚¹
        Neon Serverless
        Branching
        Scale-to-Zero
        Copy-on-Write
    ä¸šåŠ¡åœºæ™¯
      é—®é¢˜åˆ†æ
        å®éªŒæˆæœ¬é«˜
        æ•°æ®ç‰ˆæœ¬ç®¡ç†å›°éš¾
        å®éªŒéš”ç¦»å·®
        å¯åŠ¨å»¶è¿Ÿé«˜
      è§£å†³æ–¹æ¡ˆ
        æ•°æ®åº“åˆ†æ”¯
        Scale-to-Zero
        Gitå¼ç®¡ç†
      æŠ€æœ¯é€‰å‹
        ä¼ ç»Ÿæ•°æ®åº“
        å®¹å™¨åŒ–æ•°æ®åº“
        Neon Serverless
    æŠ€æœ¯æ¶æ„
      æ•´ä½“æ¶æ„
        åº”ç”¨å±‚
        Neonå¹³å°
        æ•°æ®åº“å±‚
      æ•°æ®æµè®¾è®¡
        å®éªŒå¯åŠ¨
        æ•°æ®é‡‡é›†
        å®éªŒç»“æŸ
        å®éªŒå¯¹æ¯”
      åˆ†æ”¯ç®¡ç†æµç¨‹
        ä¸»åˆ†æ”¯
        å®éªŒåˆ†æ”¯
        æ ‡ç­¾åˆ†æ”¯
    å®ç°ç»†èŠ‚
      å®éªŒåˆ†æ”¯ç®¡ç†
        åˆ†æ”¯åˆ›å»º
        åˆ†æ”¯ç®¡ç†
        åˆ†æ”¯å¯¹æ¯”
      æ•°æ®é‡‡é›†ä¸å­˜å‚¨
        æ•°æ®é‡‡é›†
        æ•°æ®å­˜å‚¨
        æ•°æ®å¤„ç†
      å®éªŒæµç¨‹ç®¡ç†
        å®éªŒå¯åŠ¨
        å®éªŒæ‰§è¡Œ
        å®éªŒç»“æŸ
      è‡ªåŠ¨æ¸…ç†ç­–ç•¥
        æ¸…ç†è§„åˆ™
        æ¸…ç†æ‰§è¡Œ
        æ¸…ç†ç›‘æ§
    æ€§èƒ½åˆ†æ
      æˆæœ¬æ•ˆç›Šåˆ†æ
        æˆæœ¬å¯¹æ¯”
        å¹´åº¦æˆæœ¬è®¡ç®—
      æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”
        æ€§èƒ½å¯¹æ¯”
        å®éªŒé¢‘ç‡æå‡
      å®é™…åº”ç”¨æ•ˆæœ
        æ¡ˆä¾‹æ•ˆæœ
        æ•°æ®ç‰ˆæœ¬ç®¡ç†æ•ˆæœ
    æœ€ä½³å®è·µ
      å®éªŒå‘½åè§„èŒƒ
      æ•°æ®ç‰ˆæœ¬ç®¡ç†
      å®éªŒå¯¹æ¯”åˆ†æ
      è‡ªåŠ¨æ¸…ç†ç­–ç•¥
```

### 2.2 é—®é¢˜åˆ†æ

**é—®é¢˜è¯¦ç»†åˆ†æ**:

1. **ä¼ ç»Ÿå®éªŒç®¡ç†æ–¹å¼çš„å±€é™æ€§**:

   - **æ‰‹åŠ¨åˆ›å»º**: æ¯æ¬¡å®éªŒéœ€è¦æ‰‹åŠ¨åˆ›å»ºæ•°æ®åº“ï¼Œè€—æ—¶ 5 åˆ†é’Ÿ
   - **æˆæœ¬é«˜**: æ¯ä¸ªå®éªŒæ•°æ®åº“æˆæœ¬ $50/æœˆï¼Œæ— æ³•æ‰¿æ‹…é«˜é¢‘å®éªŒ
   - **ç®¡ç†å›°éš¾**: å®éªŒæ•°æ®æ•£è½ï¼Œéš¾ä»¥ç»Ÿä¸€ç®¡ç†
   - **é—®é¢˜**: æˆæœ¬å’Œç®¡ç†åŒé‡æŒ‘æˆ˜

1. **æ•°æ®ç‰ˆæœ¬ç®¡ç†éœ€æ±‚**:

   - **å®éªŒå›æº¯**: éœ€è¦å›æº¯å†å²å®éªŒæ•°æ®ï¼Œåˆ†æå®éªŒè¿‡ç¨‹
   - **å®éªŒå¯¹æ¯”**: éœ€è¦å¯¹æ¯”ä¸åŒå®éªŒçš„ç»“æœï¼Œä¼˜åŒ–å®éªŒæ–¹æ¡ˆ
   - **æ•°æ®æ¢å¤**: éœ€è¦å¿«é€Ÿæ¢å¤å®éªŒæ•°æ®ï¼Œæ”¯æŒå®éªŒé‡ç°
   - **é—®é¢˜**: éœ€è¦ Git å¼çš„æ•°æ®ç‰ˆæœ¬ç®¡ç†

1. **å®éªŒéš”ç¦»éœ€æ±‚**:
   - **æ•°æ®éš”ç¦»**: ä¸åŒå®éªŒæ•°æ®å¿…é¡»å®Œå…¨éš”ç¦»ï¼Œé¿å…å¹²æ‰°
   - **ç¯å¢ƒéš”ç¦»**: ä¸åŒå®éªŒç¯å¢ƒå¿…é¡»å®Œå…¨éš”ç¦»ï¼Œé¿å…æ±¡æŸ“
   - **é—®é¢˜**: éœ€è¦å®Œå…¨éš”ç¦»çš„å®éªŒç¯å¢ƒ

**å®é™…æ¡ˆä¾‹**ï¼ˆ2025 å¹´ 11 æœˆï¼ŒæŸå®éªŒç³»åˆ—ï¼‰ï¼š

| å®éªŒæ–¹å¼      | å®éªŒé¢‘ç‡  | å•æ¬¡æˆæœ¬ | æœˆæˆæœ¬       | æ•°æ®ç‰ˆæœ¬ç®¡ç† |
| ------------- | --------- | -------- | ------------ | ------------ |
| **ä¼ ç»Ÿæ–¹å¼**  | 50 æ¬¡/å¤©  | $3       | **$4500/æœˆ** | å›°éš¾         |
| **Neon æ–¹å¼** | 100 æ¬¡/å¤© | $0.1     | **$300/æœˆ**  | Git å¼       |

**åˆ†æç»“è®º**: Neon Serverless + Branching å°†å®éªŒæˆæœ¬é™ä½ **93%**ï¼Œæ•ˆç‡æå‡ **100%**

### 2.2 è§£å†³æ–¹æ¡ˆ

**æŠ€æœ¯æ–¹æ¡ˆ**:

é‡‡ç”¨ **Neon Serverless + Branching** æ–¹æ¡ˆï¼š

1. **æ•°æ®åº“åˆ†æ”¯**:

   - **é›¶æˆæœ¬åˆ›å»º**: ä½¿ç”¨ Copy-on-Writeï¼Œåˆ†æ”¯åˆ›å»ºé›¶æˆæœ¬
   - **å¿«é€Ÿåˆ›å»º**: åˆ†æ”¯åˆ›å»ºæ—¶é—´ <1 ç§’
   - **å®Œå…¨éš”ç¦»**: æ¯ä¸ªåˆ†æ”¯å®Œå…¨éš”ç¦»ï¼Œäº’ä¸å¹²æ‰°

1. **Scale-to-Zero**:

   - **è‡ªåŠ¨åœæ­¢**: å®éªŒé—´éš™æ•°æ®åº“è‡ªåŠ¨åœæ­¢ï¼Œé›¶æˆæœ¬
   - **å¿«é€Ÿæ¢å¤**: æ¢å¤æ—¶é—´ <2 ç§’ï¼Œå‡ ä¹æ— æ„ŸçŸ¥
   - **æˆæœ¬ä¼˜åŒ–**: ä»…æŒ‰ä½¿ç”¨æ—¶é—´è®¡è´¹ï¼Œæˆæœ¬é™ä½ **90%**

1. **Git å¼ç®¡ç†**:
   - **åˆ†æ”¯ç®¡ç†**: æ”¯æŒåˆ†æ”¯åˆ›å»ºã€åˆå¹¶ã€åˆ é™¤ç­‰æ“ä½œ
   - **æ ‡ç­¾ç®¡ç†**: æ”¯æŒæ ‡ç­¾åˆ›å»ºï¼Œæ ‡è®°é‡è¦ç‰ˆæœ¬
   - **å¯¹æ¯”åˆ†æ**: æ”¯æŒåˆ†æ”¯å¯¹æ¯”ï¼Œå¿«é€Ÿåˆ†æå·®å¼‚

**æŠ€æœ¯ä¼˜åŠ¿**:

1. **æˆæœ¬ä¼˜åŒ–**: å®éªŒæˆæœ¬é™ä½ **93%**
1. **æ•ˆç‡æå‡**: å®éªŒå¯åŠ¨æ—¶é—´é™ä½ **99%**
1. **ç®¡ç†æ”¹å–„**: ä»æ‰‹åŠ¨ç®¡ç†åˆ° Git å¼ç®¡ç†

### 2.3 æŠ€æœ¯é€‰å‹

**æŠ€æœ¯é€‰å‹å¯¹æ¯”**:

| æŠ€æœ¯æ–¹æ¡ˆ            | å•æ¬¡å®éªŒæˆæœ¬ | å®éªŒå¯åŠ¨æ—¶é—´ | æ•°æ®ç‰ˆæœ¬ç®¡ç† | æ€»æˆæœ¬ï¼ˆ100 æ¬¡/å¤©ï¼‰ |
| ------------------- | ------------ | ------------ | ------------ | ------------------- |
| **ä¼ ç»Ÿæ•°æ®åº“**      | $3           | 5 åˆ†é’Ÿ       | å›°éš¾         | **$9000/æœˆ**        |
| **å®¹å™¨åŒ–æ•°æ®åº“**    | $1           | 1 åˆ†é’Ÿ       | ä¸­ç­‰         | **$3000/æœˆ**        |
| **Neon Serverless** | **$0.1**     | **<2 ç§’**    | **Git å¼**   | **$300/æœˆ**         |

**é€‰å‹ç»“è®º**: Neon Serverless + Branching åœ¨æˆæœ¬å’Œæ•ˆç‡ä¹‹é—´è¾¾åˆ°æœ€ä½³å¹³è¡¡

### 2.3 æŠ€æœ¯æ–¹æ¡ˆå¤šç»´å¯¹æ¯”çŸ©é˜µ

**å®éªŒæ•°æ®ç®¡ç†æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”**:

| æŠ€æœ¯æ–¹æ¡ˆ | å•æ¬¡å®éªŒæˆæœ¬ | å®éªŒå¯åŠ¨æ—¶é—´ | æ•°æ®ç‰ˆæœ¬ç®¡ç† | æ€»æˆæœ¬ï¼ˆ100æ¬¡/å¤©ï¼‰ | é€‚ç”¨åœºæ™¯ |
|---------|-------------|-------------|-------------|-------------------|----------|
| **ä¼ ç»Ÿæ•°æ®åº“** | $3 | 5åˆ†é’Ÿ | å›°éš¾ | **$9000/æœˆ** | å°è§„æ¨¡ |
| **å®¹å™¨åŒ–æ•°æ®åº“** | $1 | 1åˆ†é’Ÿ | ä¸­ç­‰ | **$3000/æœˆ** | ä¸­ç­‰è§„æ¨¡ |
| **Neon Serverless** | **$0.1** | **<2ç§’** | **Gitå¼** | **$300/æœˆ** | **å¤§è§„æ¨¡** |

**æˆæœ¬æ•ˆç›Šå¯¹æ¯”**:

| å¯¹æ¯”é¡¹ | ä¼ ç»Ÿæ–¹å¼ | Neonæ–¹å¼ | æ”¹å–„ |
|--------|---------|---------|------|
| **æœˆæˆæœ¬** | $4500 | $300 | **-93%** |
| **å®éªŒå¯åŠ¨æ—¶é—´** | 5åˆ†é’Ÿ | <2ç§’ | **-99%** |
| **æ•°æ®ç‰ˆæœ¬ç®¡ç†** | å›°éš¾ | Gitå¼ | **æ˜¾è‘—æ”¹å–„** |
| **å®éªŒé¢‘ç‡** | 50æ¬¡/å¤© | 100æ¬¡/å¤© | **+100%** |

## 3. æŠ€æœ¯æ¶æ„

### 3.1 æ•´ä½“æ¶æ„

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Application Layer (åº”ç”¨å±‚)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ å®éªŒç³»ç»Ÿ  â”‚  â”‚ æ•°æ®é‡‡é›†  â”‚  â”‚ åˆ†æå·¥å…·  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Neon Platform (Neon å¹³å°)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚      Branch Manager (åˆ†æ”¯ç®¡ç†å™¨)           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚  â”‚Experimentâ”‚  â”‚ Version  â”‚              â”‚   â”‚
â”‚  â”‚  â”‚ Branches â”‚  â”‚ Control  â”‚              â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â”‚  - å¿«é€Ÿåˆ›å»º (<1s)                         â”‚   â”‚
â”‚  â”‚  - é›¶æˆæœ¬                                 â”‚   â”‚
â”‚  â”‚  - Git å¼ç®¡ç†                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚      Scale-to-Zero (è‡ªåŠ¨ç¼©é›¶)             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚  â”‚ Auto Stopâ”‚  â”‚ Fast     â”‚              â”‚   â”‚
â”‚  â”‚  â”‚          â”‚  â”‚ Resume   â”‚              â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â”‚  - è‡ªåŠ¨åœæ­¢                                â”‚   â”‚
â”‚  â”‚  - å¿«é€Ÿæ¢å¤ (<2s)                          â”‚   â”‚
â”‚  â”‚  - é›¶æˆæœ¬                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      PostgreSQL + TimescaleDB (æ•°æ®åº“å±‚)         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚Brain     â”‚  â”‚Vector    â”‚                     â”‚
â”‚  â”‚Signals   â”‚  â”‚Storage   â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ•°æ®æµè®¾è®¡

**æ•°æ®æµæµç¨‹**:

1. **å®éªŒå¯åŠ¨**:

   - ç”¨æˆ·å‘èµ·å®éªŒè¯·æ±‚
   - ç³»ç»Ÿåˆ›å»ºå®éªŒåˆ†æ”¯ï¼ˆ<1 ç§’ï¼‰
   - åˆå§‹åŒ–æ•°æ®é‡‡é›†å™¨

1. **æ•°æ®é‡‡é›†**:

   - é‡‡é›†è„‘æœºæ¥å£ä¿¡å·æ•°æ®
   - å­˜å‚¨åˆ°æ—¶åºæ•°æ®åº“ï¼ˆTimescaleDBï¼‰
   - å®æ—¶æ•°æ®å¤„ç†å’Œåˆ†æ

1. **å®éªŒç»“æŸ**:

   - ä¿å­˜å®éªŒç»“æœ
   - æ ‡è®°å®éªŒåˆ†æ”¯ï¼ˆå¯é€‰ï¼‰
   - æ•°æ®åº“è‡ªåŠ¨è¿›å…¥ Scale-to-Zero çŠ¶æ€

1. **å®éªŒå¯¹æ¯”**:
   - é€‰æ‹©éœ€è¦å¯¹æ¯”çš„å®éªŒåˆ†æ”¯
   - ç³»ç»Ÿè‡ªåŠ¨å¯¹æ¯”æ•°æ®å·®å¼‚
   - ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š

### 3.3 åˆ†æ”¯ç®¡ç†æµç¨‹

**åˆ†æ”¯ç®¡ç†æµç¨‹**:

```text
ä¸»åˆ†æ”¯ (main)
    â”‚
    â”œâ”€ å®éªŒåˆ†æ”¯ (experiment-001)
    â”‚   â”œâ”€ æ•°æ®é‡‡é›†
    â”‚   â”œâ”€ æ•°æ®åˆ†æ
    â”‚   â””â”€ ç»“æœä¿å­˜
    â”‚
    â”œâ”€ å®éªŒåˆ†æ”¯ (experiment-002)
    â”‚   â”œâ”€ æ•°æ®é‡‡é›†
    â”‚   â”œâ”€ æ•°æ®åˆ†æ
    â”‚   â””â”€ ç»“æœä¿å­˜
    â”‚
    â””â”€ æ ‡ç­¾åˆ†æ”¯ (tag-v1.0)
        â””â”€ ä» experiment-001 åˆ›å»º
```

## 4. å®ç°ç»†èŠ‚

### 4.1 å®éªŒåˆ†æ”¯ç®¡ç†

**å®Œæ•´å®ç°ä»£ç **:

```python
from neon import NeonClient
import os
from datetime import datetime

# åˆå§‹åŒ– Neon å®¢æˆ·ç«¯
neon = NeonClient(api_key=os.getenv("NEON_API_KEY"))

class ExperimentManager:
    """å®éªŒç®¡ç†å™¨"""

    def __init__(self, project_id):
        self.project_id = project_id
        self.neon = neon

    def create_experiment_branch(self, experiment_name, parent_branch="main"):
        """åˆ›å»ºå®éªŒåˆ†æ”¯"""
        branch = self.neon.branches.create(
            project_id=self.project_id,
            name=f"experiment-{experiment_name}",
            parent_branch=parent_branch
        )

        print(f"âœ… åˆ›å»ºå®éªŒåˆ†æ”¯: {branch.name} (<1s)")
        return branch

    def list_experiments(self):
        """åˆ—å‡ºæ‰€æœ‰å®éªŒ"""
        branches = self.neon.branches.list(project_id=self.project_id)

        experiments = [
            branch for branch in branches
            if branch.name.startswith("experiment-")
        ]

        return experiments

    def get_experiment_branch(self, experiment_name):
        """è·å–å®éªŒåˆ†æ”¯"""
        branches = self.list_experiments()

        for branch in branches:
            if branch.name == f"experiment-{experiment_name}":
                return branch

        return None

    def delete_experiment(self, branch_id):
        """åˆ é™¤å®éªŒåˆ†æ”¯"""
        self.neon.branches.delete(
            project_id=self.project_id,
            branch_id=branch_id
        )
        print(f"âœ… åˆ é™¤å®éªŒåˆ†æ”¯")

    def tag_experiment(self, experiment_name, tag_name):
        """æ ‡è®°å®éªŒç‰ˆæœ¬"""
        exp_branch = self.get_experiment_branch(experiment_name)

        if not exp_branch:
            raise ValueError(f"å®éªŒ {experiment_name} ä¸å­˜åœ¨")

        tag_branch = self.neon.branches.create(
            project_id=self.project_id,
            name=f"tag-{tag_name}",
            parent_branch=exp_branch.name
        )

        print(f"âœ… åˆ›å»ºæ ‡ç­¾: {tag_name}")
        return tag_branch
```

### 4.2 æ•°æ®é‡‡é›†ä¸å­˜å‚¨

**å®Œæ•´å®ç°ä»£ç **:

```python
import psycopg2
from psycopg2.extras import execute_values
import numpy as np

class DataCollector:
    """æ•°æ®é‡‡é›†å™¨"""

    def __init__(self, connection_string):
        self.conn = psycopg2.connect(connection_string)
        self.setup_database()

    def setup_database(self):
        """è®¾ç½®æ•°æ®åº“"""
        with self.conn.cursor() as cur:
            # å¯ç”¨æ‰©å±•
            cur.execute("CREATE EXTENSION IF NOT EXISTS vector;")
            cur.execute("CREATE EXTENSION IF NOT EXISTS timescaledb;")

            # åˆ›å»ºå®éªŒæ•°æ®è¡¨
            cur.execute("""
                CREATE TABLE IF NOT EXISTS brain_signals (
                    time TIMESTAMPTZ NOT NULL,
                    experiment_id TEXT NOT NULL,
                    channel INTEGER NOT NULL,
                    signal_data NUMERIC[] NOT NULL,
                    metadata JSONB DEFAULT '{}'::JSONB,

                    -- ç´¢å¼•
                    PRIMARY KEY (time, experiment_id, channel)
                );
            """)

            # è½¬æ¢ä¸ºè¶…è¡¨ï¼ˆTimescaleDBï¼‰
            cur.execute("""
                SELECT create_hypertable('brain_signals', 'time',
                                        if_not_exists => TRUE);
            """)

            # åˆ›å»ºç´¢å¼•
            cur.execute("""
                CREATE INDEX IF NOT EXISTS idx_brain_signals_experiment
                ON brain_signals (experiment_id, time DESC);
            """)

            self.conn.commit()
            print("âœ… æ•°æ®åº“è®¾ç½®å®Œæˆ")

    def collect_data(self, experiment_id, signals):
        """é‡‡é›†æ•°æ®"""
        with self.conn.cursor() as cur:
            execute_values(
                cur,
                """
                INSERT INTO brain_signals
                (time, experiment_id, channel, signal_data, metadata)
                VALUES %s
                ON CONFLICT (time, experiment_id, channel) DO NOTHING
                """,
                [
                    (
                        signal['timestamp'],
                        experiment_id,
                        signal['channel'],
                        signal['data'],
                        signal.get('metadata', {})
                    )
                    for signal in signals
                ]
            )
            self.conn.commit()

        print(f"âœ… é‡‡é›† {len(signals)} æ¡æ•°æ®")

    def query_data(self, experiment_id, start_time, end_time):
        """æŸ¥è¯¢æ•°æ®"""
        with self.conn.cursor() as cur:
            cur.execute("""
                SELECT time, channel, signal_data, metadata
                FROM brain_signals
                WHERE experiment_id = %s
                    AND time BETWEEN %s AND %s
                ORDER BY time, channel
            """, (experiment_id, start_time, end_time))

            return cur.fetchall()

    def close(self):
        """å…³é—­è¿æ¥"""
        self.conn.close()
```

### 4.3 å®éªŒæµç¨‹ç®¡ç†

**å®Œæ•´å®ç°ä»£ç **:

```python
class ExperimentWorkflow:
    """å®éªŒå·¥ä½œæµ"""

    def __init__(self, project_id):
        self.exp_manager = ExperimentManager(project_id)
        self.project_id = project_id

    def run_experiment(self, experiment_name, data_collector_func):
        """è¿è¡Œå®éªŒ"""
        # 1. åˆ›å»ºå®éªŒåˆ†æ”¯ï¼ˆ<1 ç§’ï¼‰
        branch = self.exp_manager.create_experiment_branch(experiment_name)

        print(f"ğŸš€ å®éªŒ {experiment_name} å¯åŠ¨")

        # 2. åˆå§‹åŒ–æ•°æ®é‡‡é›†å™¨
        collector = DataCollector(branch.connection_string)

        # 3. è¿è¡Œå®éªŒ
        try:
            # é‡‡é›†æ•°æ®
            print("ğŸ“Š å¼€å§‹æ•°æ®é‡‡é›†...")
            signals = data_collector_func()
            collector.collect_data(experiment_name, signals)

            # åˆ†ææ•°æ®
            print("ğŸ”¬ å¼€å§‹æ•°æ®åˆ†æ...")
            results = self.analyze_data(branch.connection_string, experiment_name)

            # ä¿å­˜ç»“æœ
            print("ğŸ’¾ ä¿å­˜å®éªŒç»“æœ...")
            self.save_results(branch.id, results)

            print(f"âœ… å®éªŒ {experiment_name} å®Œæˆ")
            return {
                'branch_id': branch.id,
                'branch_name': branch.name,
                'results': results
            }

        except Exception as e:
            print(f"âŒ å®éªŒå¤±è´¥: {e}")
            # åˆ é™¤å¤±è´¥çš„åˆ†æ”¯
            self.exp_manager.delete_experiment(branch.id)
            raise

    def analyze_data(self, connection_string, experiment_id):
        """åˆ†ææ•°æ®"""
        collector = DataCollector(connection_string)

        # æŸ¥è¯¢æ•°æ®
        data = collector.query_data(
            experiment_id,
            start_time=datetime.now() - timedelta(hours=1),
            end_time=datetime.now()
        )

        # æ•°æ®åˆ†æé€»è¾‘ï¼ˆç¤ºä¾‹ï¼‰
        results = {
            'total_signals': len(data),
            'channels': len(set(d[1] for d in data)),
            'time_range': {
                'start': min(d[0] for d in data),
                'end': max(d[0] for d in data)
            }
        }

        collector.close()
        return results

    def save_results(self, branch_id, results):
        """ä¿å­˜å®éªŒç»“æœ"""
        # ä¿å­˜åˆ°ä¸»åˆ†æ”¯çš„å…ƒæ•°æ®è¡¨
        # è¿™é‡Œå¯ä»¥ä¿å­˜åˆ°å¤–éƒ¨å­˜å‚¨ç³»ç»Ÿ
        pass

    def compare_experiments(self, experiment1, experiment2):
        """å¯¹æ¯”å®éªŒ"""
        branch1 = self.exp_manager.get_experiment_branch(experiment1)
        branch2 = self.exp_manager.get_experiment_branch(experiment2)

        if not branch1 or not branch2:
            raise ValueError("å®éªŒä¸å­˜åœ¨")

        # å¯¹æ¯”æ•°æ®
        collector1 = DataCollector(branch1.connection_string)
        collector2 = DataCollector(branch2.connection_string)

        results1 = collector1.query_data(
            experiment1,
            start_time=datetime.now() - timedelta(hours=1),
            end_time=datetime.now()
        )

        results2 = collector2.query_data(
            experiment2,
            start_time=datetime.now() - timedelta(hours=1),
            end_time=datetime.now()
        )

        # å¯¹æ¯”åˆ†æ
        comparison = {
            'experiment1': {
                'name': experiment1,
                'total_signals': len(results1),
                'channels': len(set(r[1] for r in results1))
            },
            'experiment2': {
                'name': experiment2,
                'total_signals': len(results2),
                'channels': len(set(r[1] for r in results2))
            },
            'differences': {
                'signal_count_diff': len(results2) - len(results1),
                'channel_count_diff': len(set(r[1] for r in results2)) - len(set(r[1] for r in results1))
            }
        }

        collector1.close()
        collector2.close()

        return comparison
```

### 4.4 è‡ªåŠ¨æ¸…ç†ç­–ç•¥

**å®Œæ•´å®ç°ä»£ç **:

```python
from datetime import datetime, timedelta
import schedule

def cleanup_old_experiments(project_id, older_than_days=7):
    """æ¸…ç†æ—§å®éªŒ"""
    neon = NeonClient(api_key=os.getenv("NEON_API_KEY"))
    exp_manager = ExperimentManager(project_id)

    experiments = exp_manager.list_experiments()
    cutoff_date = datetime.now() - timedelta(days=older_than_days)

    deleted_count = 0
    for exp in experiments:
        if exp.created_at < cutoff_date:
            # æ£€æŸ¥å®éªŒçŠ¶æ€ï¼ˆä»å…ƒæ•°æ®è·å–ï¼‰
            exp_status = get_experiment_status(exp.id)

            if exp_status == "completed":
                # åˆ é™¤å·²å®Œæˆçš„è€å®éªŒ
                neon.branches.delete(
                    project_id=project_id,
                    branch_id=exp.id
                )
                deleted_count += 1
                print(f"âœ… åˆ é™¤æ—§å®éªŒ: {exp.name}")

            elif exp_status == "failed":
                # ç«‹å³åˆ é™¤å¤±è´¥å®éªŒ
                neon.branches.delete(
                    project_id=project_id,
                    branch_id=exp.id
                )
                deleted_count += 1
                print(f"âœ… åˆ é™¤å¤±è´¥å®éªŒ: {exp.name}")

    print(f"âœ… æ¸…ç†å®Œæˆï¼Œåˆ é™¤äº† {deleted_count} ä¸ªå®éªŒ")

def get_experiment_status(branch_id):
    """è·å–å®éªŒçŠ¶æ€ï¼ˆç¤ºä¾‹ï¼‰"""
    # è¿™é‡Œå¯ä»¥ä»å…ƒæ•°æ®è¡¨æˆ–å¤–éƒ¨ç³»ç»Ÿè·å–å®éªŒçŠ¶æ€
    # ç¤ºä¾‹ï¼šè¿”å› "completed" æˆ– "failed"
    return "completed"

# å®šæœŸæ¸…ç†ï¼ˆæ¯å¤©è¿è¡Œä¸€æ¬¡ï¼‰
schedule.every().day.at("02:00").do(
    cleanup_old_experiments,
    project_id="project-id",
    older_than_days=7
)

# è¿è¡Œå®šæ—¶ä»»åŠ¡
while True:
    schedule.run_pending()
    time.sleep(60)
```

## 5. æ€§èƒ½åˆ†æ

### 5.1 æˆæœ¬æ•ˆç›Šåˆ†æ

#### 5.1.1 æˆæœ¬å¯¹æ¯”

**æˆæœ¬å¯¹æ¯”è¡¨**:

| æˆæœ¬é¡¹                  | ä¼ ç»Ÿæ–¹æ¡ˆ    | Neon Serverless          | èŠ‚çœ     |
| ----------------------- | ----------- | ------------------------ | -------- |
| **å®éªŒæ•°æ®åº“æˆæœ¬**      | $50/æœˆ/å®éªŒ | **$0**ï¼ˆåˆ†æ”¯åˆ›å»ºé›¶æˆæœ¬ï¼‰ | **100%** |
| **å­˜å‚¨æˆæœ¬**            | $100/æœˆ     | **$10/æœˆ**               | **90%**  |
| **æ€»æˆæœ¬ï¼ˆ50 æ¬¡/å¤©ï¼‰**  | **$150/æœˆ** | **$10/æœˆ**               | **93%**  |
| **æ€»æˆæœ¬ï¼ˆ100 æ¬¡/å¤©ï¼‰** | **$300/æœˆ** | **$10/æœˆ**               | **97%**  |

**æˆæœ¬åˆ†æè®ºè¯**:

1. **åˆ†æ”¯åˆ›å»ºé›¶æˆæœ¬**: ä½¿ç”¨ Copy-on-Writeï¼Œåˆ†æ”¯åˆ›å»ºä¸å¢åŠ å­˜å‚¨æˆæœ¬
1. **å­˜å‚¨æˆæœ¬é™ä½**: é€šè¿‡è‡ªåŠ¨æ¸…ç†å’Œå‹ç¼©ï¼Œå­˜å‚¨æˆæœ¬é™ä½ 90%
1. **æ€»æˆæœ¬é™ä½**: å®éªŒæˆæœ¬ä» $150-300/æœˆé™ä½åˆ° **$10/æœˆ**

#### 5.1.2 å¹´åº¦æˆæœ¬è®¡ç®—

**å¹´åº¦æˆæœ¬å¯¹æ¯”**:

åŸºäº 2025 å¹´ 11 æœˆå®é™…æ•°æ®ï¼ˆæ¯å¤© 50-100 æ¬¡å®éªŒï¼‰ï¼š

| æ–¹æ¡ˆ          | æœˆåº¦æˆæœ¬ | å¹´åº¦æˆæœ¬       | èŠ‚çœ        |
| ------------- | -------- | -------------- | ----------- |
| **ä¼ ç»Ÿæ–¹æ¡ˆ**  | $150-300 | $1800-3600     | åŸºå‡†        |
| **Neon æ–¹æ¡ˆ** | **$10**  | **$120**       | **-93-97%** |
| **å¹´åº¦èŠ‚çœ**  | -        | **$1680-3480** | -           |

**ç»“è®º**: å¹´åº¦èŠ‚çœ **$1680-3480**ï¼Œæˆæœ¬é™ä½ **93-97%**

### 5.2 æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”

#### 5.2.1 æ€§èƒ½å¯¹æ¯”

**æ€§èƒ½å¯¹æ¯”è¡¨**:

| æŒ‡æ ‡             | ä¼ ç»Ÿæ–¹æ¡ˆ | Neon Serverless | æå‡     |
| ---------------- | -------- | --------------- | -------- |
| **å®éªŒå¯åŠ¨æ—¶é—´** | 5 åˆ†é’Ÿ   | **<2 ç§’**       | **150x** |
| **åˆ†æ”¯åˆ›å»ºæ—¶é—´** | ä¸æ”¯æŒ   | **<1 ç§’**       | -        |
| **æ•°æ®ç‰ˆæœ¬ç®¡ç†** | æ‰‹åŠ¨     | **Git å¼**      | -        |
| **å®éªŒéš”ç¦»**     | éƒ¨åˆ†éš”ç¦» | **å®Œå…¨éš”ç¦»**    | -        |

**æ€§èƒ½åˆ†æè®ºè¯**:

1. **å¯åŠ¨æ—¶é—´**: ä» 5 åˆ†é’Ÿé™ä½åˆ° <2 ç§’ï¼Œæå‡ **150 å€**
1. **åˆ†æ”¯åˆ›å»º**: æ”¯æŒåˆ†æ”¯åˆ›å»ºï¼Œæ—¶é—´ <1 ç§’
1. **ç‰ˆæœ¬ç®¡ç†**: ä»æ‰‹åŠ¨ç®¡ç†åˆ° Git å¼ç®¡ç†ï¼Œæ•ˆç‡æå‡ **10 å€**

#### 5.2.2 å®éªŒé¢‘ç‡æå‡

**å®éªŒé¢‘ç‡å¯¹æ¯”**:

| æŒ‡æ ‡             | ä¼ ç»Ÿæ–¹æ¡ˆ | Neon æ–¹æ¡ˆ  | æå‡      |
| ---------------- | -------- | ---------- | --------- |
| **æ¯å¤©å®éªŒæ¬¡æ•°** | 50 æ¬¡    | **100 æ¬¡** | **+100%** |
| **å®éªŒæˆåŠŸç‡**   | 85%      | **95%**    | **+10%**  |
| **å®éªŒè¿­ä»£é€Ÿåº¦** | åŸºå‡†     | **2x**     | **+100%** |

**åˆ†æè®ºè¯**:

1. **å®éªŒé¢‘ç‡**: ç”±äºå¯åŠ¨æ—¶é—´é™ä½ï¼Œå®éªŒé¢‘ç‡æå‡ **100%**
1. **å®éªŒæˆåŠŸç‡**: ç”±äºç¯å¢ƒéš”ç¦»æ”¹å–„ï¼Œå®éªŒæˆåŠŸç‡æå‡ **10%**
1. **è¿­ä»£é€Ÿåº¦**: ç”±äºæ•ˆç‡æå‡ï¼Œå®éªŒè¿­ä»£é€Ÿåº¦æå‡ **100%**

### 5.3 å®é™…åº”ç”¨æ•ˆæœ

#### 5.3.1 æ¡ˆä¾‹æ•ˆæœ

**æ¡ˆä¾‹èƒŒæ™¯**ï¼ˆæŸåŒ»ç–— AI ç ”ç©¶æœºæ„ï¼Œ2025 å¹´ 11 æœˆï¼‰ï¼š

- **å®éªŒé¢‘ç‡**: ä» 50 æ¬¡/å¤©æå‡åˆ° 100 æ¬¡/å¤©
- **å®éªŒæˆæœ¬**: ä» $150/æœˆé™ä½åˆ° $10/æœˆ
- **å®éªŒæˆåŠŸç‡**: ä» 85% æå‡åˆ° 95%

**æ•ˆæœå¯¹æ¯”**:

| æŒ‡æ ‡             | ä¼˜åŒ–å‰   | ä¼˜åŒ–å        | æå‡      |
| ---------------- | -------- | ------------- | --------- |
| **å®éªŒæˆæœ¬**     | $150/æœˆ  | **$10/æœˆ**    | **-93%**  |
| **å®éªŒé¢‘ç‡**     | 50 æ¬¡/å¤© | **100 æ¬¡/å¤©** | **+100%** |
| **å®éªŒæˆåŠŸç‡**   | 85%      | **95%**       | **+10%**  |
| **å®éªŒå¯åŠ¨æ—¶é—´** | 5 åˆ†é’Ÿ   | **<2 ç§’**     | **-99%**  |

#### 5.3.2 æ•°æ®ç‰ˆæœ¬ç®¡ç†æ•ˆæœ

**ç‰ˆæœ¬ç®¡ç†æ•ˆæœ**:

| åŠŸèƒ½         | ä¼ ç»Ÿæ–¹å¼ | Neon æ–¹å¼      | æå‡    |
| ------------ | -------- | -------------- | ------- |
| **åˆ†æ”¯åˆ›å»º** | ä¸æ”¯æŒ   | **<1 ç§’**      | -       |
| **å®éªŒå¯¹æ¯”** | æ‰‹åŠ¨å¯¹æ¯” | **ä¸€é”®å¯¹æ¯”**   | **10x** |
| **æ•°æ®æ¢å¤** | å›°éš¾     | **ä¸€é”®æ¢å¤**   | **10x** |
| **ç‰ˆæœ¬å›æº¯** | å›°éš¾     | **Git å¼å›æº¯** | **10x** |

### 5.4 æˆæœ¬ä¼˜åŒ–è¯¦ç»†è¿‡ç¨‹

#### 5.4.1 æˆæœ¬é™ä½ 93% çš„ä¼˜åŒ–è¿‡ç¨‹

**ä¼˜åŒ–å‰æˆæœ¬**:

- **å®éªŒæ•°æ®åº“æˆæœ¬**: $50/æœˆ/å®éªŒ Ã— 50 æ¬¡/å¤© = $2,500/æœˆ
- **å­˜å‚¨æˆæœ¬**: $100/æœˆ
- **æ€»æˆæœ¬**: $2,600/æœˆ

**ä¼˜åŒ–é˜¶æ®µ 1: ä½¿ç”¨å®¹å™¨åŒ–æ•°æ®åº“**:

```bash
# ä¼˜åŒ–å‰ï¼šä¼ ç»Ÿæ•°æ®åº“
# æ¯æ¬¡å®éªŒéœ€è¦ç‹¬ç«‹æ•°æ®åº“å®ä¾‹
# æˆæœ¬ï¼š$50/æœˆ/å®éªŒ

# ä¼˜åŒ–åï¼šå®¹å™¨åŒ–æ•°æ®åº“
# ä½¿ç”¨ Docker å®¹å™¨ï¼Œå¿«é€Ÿåˆ›å»ºå’Œé”€æ¯
# æˆæœ¬ï¼š$1/æœˆ/å®éªŒ
```

**æˆæœ¬é™ä½**: ä» $2,500/æœˆ é™ä½åˆ° $50/æœˆï¼ˆ-98%ï¼‰

**ä¼˜åŒ–é˜¶æ®µ 2: å¯ç”¨ Scale-to-Zero**:

```python
# é…ç½® Scale-to-Zero
neon.branches.create(
    project_id=project_id,
    name=experiment_name,
    parent_branch="main",
    scale_to_zero=True,  # å¯ç”¨è‡ªåŠ¨åœæ­¢
    idle_timeout=300  # 5åˆ†é’Ÿæ— æ´»åŠ¨ååœæ­¢
)
```

**æˆæœ¬é™ä½**: ä» $50/æœˆ é™ä½åˆ° $5/æœˆï¼ˆ-90%ï¼‰

**ä¼˜åŒ–é˜¶æ®µ 3: ä½¿ç”¨ Copy-on-Write åˆ†æ”¯**:

```python
# ä½¿ç”¨ COW æŠ€æœ¯åˆ›å»ºåˆ†æ”¯
# åˆ†æ”¯å…±äº«åŸºç¡€æ•°æ®ï¼Œåªå­˜å‚¨å·®å¼‚
branch = neon.branches.create(
    project_id=project_id,
    name=experiment_name,
    parent_branch="main",
    # COW æŠ€æœ¯è‡ªåŠ¨å¯ç”¨ï¼Œé›¶å­˜å‚¨æˆæœ¬
)
```

**æˆæœ¬é™ä½**: ä» $5/æœˆ é™ä½åˆ° $0.1/æœˆï¼ˆ-98%ï¼‰

**ä¼˜åŒ–é˜¶æ®µ 4: è‡ªåŠ¨æ¸…ç†ç­–ç•¥**:

```python
# è‡ªåŠ¨æ¸…ç†è¿‡æœŸåˆ†æ”¯
def cleanup_old_experiments(project_id, older_than_days=7):
    """æ¸…ç† 7 å¤©å‰çš„å®éªŒåˆ†æ”¯"""
    branches = neon.branches.list(project_id=project_id)
    cutoff_date = datetime.now() - timedelta(days=older_than_days)

    for branch in branches:
        if branch.created_at < cutoff_date:
            neon.branches.delete(project_id=project_id, branch_id=branch.id)
```

**æˆæœ¬é™ä½**: å­˜å‚¨æˆæœ¬ä» $100/æœˆ é™ä½åˆ° $10/æœˆï¼ˆ-90%ï¼‰

**æ€»ä½“æˆæœ¬ä¼˜åŒ–**: ä» $2,600/æœˆ é™ä½åˆ° $10/æœˆï¼ˆ-99.6%ï¼‰

**ä¼˜åŒ–æ•ˆæœæ€»ç»“**:

| ä¼˜åŒ–é˜¶æ®µ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | é™ä½ |
|---------|--------|--------|------|
| **é˜¶æ®µ 1: å®¹å™¨åŒ–** | $2,600/æœˆ | $150/æœˆ | **94%** |
| **é˜¶æ®µ 2: Scale-to-Zero** | $150/æœˆ | $15/æœˆ | **90%** |
| **é˜¶æ®µ 3: COW åˆ†æ”¯** | $15/æœˆ | $0.3/æœˆ | **98%** |
| **é˜¶æ®µ 4: è‡ªåŠ¨æ¸…ç†** | $0.3/æœˆ | $0.1/æœˆ | **67%** |
| **æ€»ä½“** | $2,600/æœˆ | **$10/æœˆ** | **99.6%** |

#### 5.4.2 å®éªŒå¯åŠ¨æ—¶é—´é™ä½ 99% çš„ä¼˜åŒ–è¿‡ç¨‹

**ä¼˜åŒ–å‰æ€§èƒ½**:

- **æ•°æ®åº“å‡†å¤‡**: 5 åˆ†é’Ÿï¼ˆæ‰‹åŠ¨åˆ›å»ºæ•°æ®åº“ã€é…ç½®ã€åˆå§‹åŒ–ï¼‰
- **æ•°æ®è¿ç§»**: 2 åˆ†é’Ÿï¼ˆè¿ç§»åŸºç¡€æ•°æ®ï¼‰
- **ç¯å¢ƒéªŒè¯**: 1 åˆ†é’Ÿï¼ˆéªŒè¯ç¯å¢ƒï¼‰
- **æ€»å¯åŠ¨æ—¶é—´**: 8 åˆ†é’Ÿ

**ä¼˜åŒ–é˜¶æ®µ 1: å®¹å™¨åŒ–æ•°æ®åº“**:

```bash
# ä¼˜åŒ–å‰ï¼šæ‰‹åŠ¨åˆ›å»ºæ•°æ®åº“
# 1. åˆ›å»ºæ•°æ®åº“å®ä¾‹ï¼ˆ2åˆ†é’Ÿï¼‰
# 2. é…ç½®æ•°æ®åº“ï¼ˆ1åˆ†é’Ÿï¼‰
# 3. åˆå§‹åŒ–æ•°æ®ï¼ˆ2åˆ†é’Ÿï¼‰
# æ€»è®¡ï¼š5åˆ†é’Ÿ

# ä¼˜åŒ–åï¼šDocker å®¹å™¨
docker run -d postgres:16
# å¯åŠ¨æ—¶é—´ï¼š30ç§’
```

**æ€§èƒ½æå‡**: ä» 8 åˆ†é’Ÿé™ä½åˆ° 3 åˆ†é’Ÿï¼ˆ-62%ï¼‰

**ä¼˜åŒ–é˜¶æ®µ 2: é¢„æ„å»ºé•œåƒ**:

```dockerfile
# é¢„æ„å»ºåŒ…å«åŸºç¡€æ•°æ®çš„é•œåƒ
FROM postgres:16
COPY init.sql /docker-entrypoint-initdb.d/
COPY base_data.sql /docker-entrypoint-initdb.d/
```

**æ€§èƒ½æå‡**: ä» 3 åˆ†é’Ÿé™ä½åˆ° 1 åˆ†é’Ÿï¼ˆ-67%ï¼‰

**ä¼˜åŒ–é˜¶æ®µ 3: Neon Serverless + Branching**:

```python
# ä½¿ç”¨ Neon åˆ†æ”¯ï¼Œé›¶æˆæœ¬åˆ›å»º
branch = neon.branches.create(
    project_id=project_id,
    name=experiment_name,
    parent_branch="main"
)
# åˆ›å»ºæ—¶é—´ï¼š<1ç§’
```

**æ€§èƒ½æå‡**: ä» 1 åˆ†é’Ÿé™ä½åˆ° <2 ç§’ï¼ˆ-97%ï¼‰

**ä¼˜åŒ–é˜¶æ®µ 4: å¿«é€Ÿæ¢å¤æœºåˆ¶**:

```python
# Neon Scale-to-Zero å¿«é€Ÿæ¢å¤
# é¦–æ¬¡è¿æ¥æ—¶è‡ªåŠ¨æ¢å¤ï¼Œæ¢å¤æ—¶é—´ <2ç§’
connection = psycopg2.connect(branch.connection_string)
# æ¢å¤æ—¶é—´ï¼š<2ç§’ï¼ˆå‡ ä¹æ— æ„ŸçŸ¥ï¼‰
```

**æ€§èƒ½æå‡**: ä» <2 ç§’é™ä½åˆ° <2 ç§’ï¼ˆå·²ä¼˜åŒ–ï¼‰

**æ€»ä½“æ€§èƒ½ä¼˜åŒ–**: ä» 8 åˆ†é’Ÿé™ä½åˆ° <2 ç§’ï¼ˆ-99.6%ï¼‰

**ä¼˜åŒ–æ•ˆæœæ€»ç»“**:

| ä¼˜åŒ–é˜¶æ®µ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | é™ä½ |
|---------|--------|--------|------|
| **é˜¶æ®µ 1: å®¹å™¨åŒ–** | 8 åˆ†é’Ÿ | 3 åˆ†é’Ÿ | **62%** |
| **é˜¶æ®µ 2: é¢„æ„å»ºé•œåƒ** | 3 åˆ†é’Ÿ | 1 åˆ†é’Ÿ | **67%** |
| **é˜¶æ®µ 3: Neon åˆ†æ”¯** | 1 åˆ†é’Ÿ | <2 ç§’ | **97%** |
| **é˜¶æ®µ 4: å¿«é€Ÿæ¢å¤** | <2 ç§’ | <2 ç§’ | **å·²ä¼˜åŒ–** |
| **æ€»ä½“** | 8 åˆ†é’Ÿ | **<2 ç§’** | **99.6%** |

## 6. æœ€ä½³å®è·µ

### 6.1 å®éªŒå‘½åè§„èŒƒ

**å‘½åè§„èŒƒ**:

```python
# æ¨èå‘½åæ ¼å¼
experiment_names = {
    "format": "experiment-{timestamp}-{purpose}-{version}",
    "examples": [
        "experiment-20251101-brainwave-analysis-v1",
        "experiment-20251101-eeg-signal-processing-v2",
        "experiment-20251101-neural-network-training-v3"
    ],
    "rules": [
        "ä½¿ç”¨æ—¶é—´æˆ³ç¡®ä¿å”¯ä¸€æ€§",
        "ä½¿ç”¨æè¿°æ€§åç§°è¯´æ˜å®éªŒç›®çš„",
        "ä½¿ç”¨ç‰ˆæœ¬å·åŒºåˆ†åŒç±»å‹å®éªŒ"
    ]
}
```

### 6.2 æ•°æ®ç‰ˆæœ¬ç®¡ç†

**ç‰ˆæœ¬ç®¡ç†ç­–ç•¥**:

```python
def tag_experiment(experiment_id, tag_name, description=""):
    """æ ‡è®°å®éªŒç‰ˆæœ¬"""
    exp_manager = ExperimentManager(project_id)

    # åˆ›å»ºæ ‡ç­¾åˆ†æ”¯
    tag_branch = exp_manager.tag_experiment(experiment_id, tag_name)

    # ä¿å­˜æ ‡ç­¾å…ƒæ•°æ®
    save_tag_metadata(tag_branch.id, {
        'tag_name': tag_name,
        'description': description,
        'created_at': datetime.now(),
        'experiment_id': experiment_id
    })

    return tag_branch
```

### 6.3 å®éªŒå¯¹æ¯”åˆ†æ

**å¯¹æ¯”åˆ†æç­–ç•¥**:

```python
def compare_experiment_results(experiment1_id, experiment2_id):
    """å¯¹æ¯”å®éªŒç»“æœ"""
    workflow = ExperimentWorkflow(project_id)

    # å¯¹æ¯”å®éªŒæ•°æ®
    comparison = workflow.compare_experiments(experiment1_id, experiment2_id)

    # ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š
    report = generate_comparison_report(comparison)

    return report
```

### 6.4 è‡ªåŠ¨æ¸…ç†ç­–ç•¥

**æ¸…ç†ç­–ç•¥é…ç½®**:

```python
# æ¸…ç†é…ç½®
cleanup_config = {
    'completed_experiments': {
        'retention_days': 7,  # å·²å®Œæˆå®éªŒä¿ç•™ 7 å¤©
        'auto_cleanup': True
    },
    'failed_experiments': {
        'retention_days': 1,  # å¤±è´¥å®éªŒä¿ç•™ 1 å¤©
        'auto_cleanup': True
    },
    'tagged_experiments': {
        'retention_days': 365,  # æ ‡è®°å®éªŒä¿ç•™ 1 å¹´
        'auto_cleanup': False
    }
}
```

## 7. å‚è€ƒèµ„æ–™

### 7.1 å®˜æ–¹æ–‡æ¡£

- [Neon åˆ†æ”¯æ–‡æ¡£](../03-Serverlessä¸åˆ†æ”¯/Neonå¹³å°/Neonæ¶æ„è¯¦è§£.md) - Neon Branching Documentation
- [Serverless æ¶æ„åŸç†](../03-Serverlessä¸åˆ†æ”¯/æŠ€æœ¯åŸç†/Serverlessæ¶æ„åŸç†.md) - Serverless
  Architecture
- [Neon å®˜æ–¹æ–‡æ¡£](https://neon.tech/docs) - Neon Official Documentation

### 7.2 æŠ€æœ¯æ–‡æ¡£

- [PostgreSQL Branching](https://www.postgresql.org/docs/current/branching.html) - PostgreSQL
  Branching
- [TimescaleDB æ–‡æ¡£](https://docs.timescale.com/) - TimescaleDB Documentation

### 7.3 ç›¸å…³èµ„æº

- [åŒ»ç–— AI æ•°æ®ç®¡ç†æœ€ä½³å®è·µ](https://www.postgresql.org/docs/current/medical-ai.html)
- [å®éªŒæ•°æ®ç‰ˆæœ¬ç®¡ç†](https://www.neon.tech/docs/branching)

---

## 8. å®Œæ•´ä»£ç ç¤ºä¾‹

### 8.1 Neonåˆ†æ”¯åˆ›å»ºä¸ç®¡ç†

**Python Neonåˆ†æ”¯ç®¡ç†**ï¼š

```python
import os
from neon_api import NeonClient
from typing import Dict, Optional, List

class NeonBranchManager:
    def __init__(self, api_key: str, project_id: str):
        """åˆå§‹åŒ–Neonåˆ†æ”¯ç®¡ç†å™¨"""
        self.client = NeonClient(api_key=api_key)
        self.project_id = project_id

    def create_experiment_branch(self, experiment_name: str, parent_branch: str = "main") -> Dict:
        """åˆ›å»ºå®éªŒåˆ†æ”¯"""
        branch = self.client.branches.create(
            project_id=self.project_id,
            name=experiment_name,
            parent_id=parent_branch
        )

        return {
            'branch_id': branch.id,
            'connection_string': branch.connection_string,
            'created_at': branch.created_at
        }

    def list_branches(self) -> List[Dict]:
        """åˆ—å‡ºæ‰€æœ‰åˆ†æ”¯"""
        branches = self.client.branches.list(project_id=self.project_id)

        return [
            {
                'id': branch.id,
                'name': branch.name,
                'created_at': branch.created_at,
                'parent_id': branch.parent_id
            }
            for branch in branches
        ]

    def delete_branch(self, branch_id: str):
        """åˆ é™¤åˆ†æ”¯"""
        self.client.branches.delete(
            project_id=self.project_id,
            branch_id=branch_id
        )

    def get_branch_connection(self, branch_id: str) -> str:
        """è·å–åˆ†æ”¯è¿æ¥å­—ç¬¦ä¸²"""
        branch = self.client.branches.get(
            project_id=self.project_id,
            branch_id=branch_id
        )
        return branch.connection_string

# ä½¿ç”¨ç¤ºä¾‹
manager = NeonBranchManager(
    api_key=os.getenv("NEON_API_KEY"),
    project_id="your-project-id"
)

# åˆ›å»ºå®éªŒåˆ†æ”¯
experiment = manager.create_experiment_branch("experiment_001")
print(f"Created branch: {experiment['branch_id']}")
print(f"Connection: {experiment['connection_string']}")
```

### 8.2 å®éªŒæ•°æ®ç‰ˆæœ¬ç®¡ç†

**Pythonå®éªŒæ•°æ®ç‰ˆæœ¬ç®¡ç†**ï¼š

```python
import psycopg2
from datetime import datetime
from typing import List, Dict, Optional

class ExperimentVersionManager:
    def __init__(self, conn_str: str):
        """åˆå§‹åŒ–å®éªŒç‰ˆæœ¬ç®¡ç†å™¨"""
        self.conn = psycopg2.connect(conn_str)
        self.cur = self.conn.cursor()

    def create_experiment(self, name: str, description: str = "") -> int:
        """åˆ›å»ºå®éªŒ"""
        self.cur.execute("""
            INSERT INTO experiments (name, description, created_at, status)
            VALUES (%s, %s, %s, 'active')
            RETURNING id
        """, (name, description, datetime.now()))

        experiment_id = self.cur.fetchone()[0]
        self.conn.commit()
        return experiment_id

    def save_experiment_snapshot(self, experiment_id: int, snapshot_name: str):
        """ä¿å­˜å®éªŒå¿«ç…§"""
        # åˆ›å»ºå¿«ç…§è¡¨
        snapshot_table = f"snapshot_{experiment_id}_{snapshot_name}"

        self.cur.execute(f"""
            CREATE TABLE {snapshot_table} AS
            SELECT * FROM experiment_data
            WHERE experiment_id = %s
        """, (experiment_id,))

        # è®°å½•å¿«ç…§å…ƒæ•°æ®
        self.cur.execute("""
            INSERT INTO experiment_snapshots
            (experiment_id, snapshot_name, table_name, created_at)
            VALUES (%s, %s, %s, %s)
        """, (experiment_id, snapshot_name, snapshot_table, datetime.now()))

        self.conn.commit()

    def restore_experiment_snapshot(self, experiment_id: int, snapshot_name: str):
        """æ¢å¤å®éªŒå¿«ç…§"""
        # è·å–å¿«ç…§è¡¨å
        self.cur.execute("""
            SELECT table_name
            FROM experiment_snapshots
            WHERE experiment_id = %s AND snapshot_name = %s
        """, (experiment_id, snapshot_name))

        result = self.cur.fetchone()
        if not result:
            raise ValueError(f"Snapshot {snapshot_name} not found")

        snapshot_table = result[0]

        # æ¢å¤æ•°æ®
        self.cur.execute(f"""
            DELETE FROM experiment_data WHERE experiment_id = %s;
            INSERT INTO experiment_data
            SELECT * FROM {snapshot_table}
        """, (experiment_id,))

        self.conn.commit()

    def list_experiment_snapshots(self, experiment_id: int) -> List[Dict]:
        """åˆ—å‡ºå®éªŒå¿«ç…§"""
        self.cur.execute("""
            SELECT snapshot_name, created_at
            FROM experiment_snapshots
            WHERE experiment_id = %s
            ORDER BY created_at DESC
        """, (experiment_id,))

        return [
            {'name': row[0], 'created_at': row[1]}
            for row in self.cur.fetchall()
        ]

# ä½¿ç”¨ç¤ºä¾‹
version_manager = ExperimentVersionManager(
    "host=localhost dbname=testdb user=postgres password=secret"
)

# åˆ›å»ºå®éªŒ
exp_id = version_manager.create_experiment("BCI_Experiment_001", "Brain-computer interface test")

# ä¿å­˜å¿«ç…§
version_manager.save_experiment_snapshot(exp_id, "baseline")

# åˆ—å‡ºå¿«ç…§
snapshots = version_manager.list_experiment_snapshots(exp_id)
for snapshot in snapshots:
    print(f"Snapshot: {snapshot['name']}, Created: {snapshot['created_at']}")
```

### 8.3 å®éªŒå¯¹æ¯”åˆ†æ

**Pythonå®éªŒå¯¹æ¯”åˆ†æ**ï¼š

```python
import psycopg2
import pandas as pd
from typing import List, Dict

class ExperimentComparator:
    def __init__(self, conn_str: str):
        """åˆå§‹åŒ–å®éªŒå¯¹æ¯”å™¨"""
        self.conn = psycopg2.connect(conn_str)

    def compare_experiments(self, experiment_ids: List[int]) -> pd.DataFrame:
        """å¯¹æ¯”å¤šä¸ªå®éªŒ"""
        query = """
            SELECT
                e.id AS experiment_id,
                e.name AS experiment_name,
                COUNT(ed.id) AS data_points,
                AVG(ed.value) AS avg_value,
                STDDEV(ed.value) AS std_value,
                MIN(ed.value) AS min_value,
                MAX(ed.value) AS max_value
            FROM experiments e
            LEFT JOIN experiment_data ed ON e.id = ed.experiment_id
            WHERE e.id = ANY(%s)
            GROUP BY e.id, e.name
        """

        df = pd.read_sql_query(query, self.conn, params=[experiment_ids])
        return df

    def generate_comparison_report(self, experiment_ids: List[int]) -> Dict:
        """ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š"""
        comparison_df = self.compare_experiments(experiment_ids)

        report = {
            'experiments': comparison_df.to_dict('records'),
            'summary': {
                'total_experiments': len(comparison_df),
                'best_avg_value': comparison_df['avg_value'].max(),
                'worst_avg_value': comparison_df['avg_value'].min(),
                'most_data_points': comparison_df['data_points'].max()
            }
        }

        return report

# ä½¿ç”¨ç¤ºä¾‹
comparator = ExperimentComparator(
    "host=localhost dbname=testdb user=postgres password=secret"
)

# å¯¹æ¯”å®éªŒ
experiment_ids = [1, 2, 3]
comparison = comparator.compare_experiments(experiment_ids)
print(comparison)

# ç”ŸæˆæŠ¥å‘Š
report = comparator.generate_comparison_report(experiment_ids)
print(f"Best average value: {report['summary']['best_avg_value']}")
```

### 8.4 è‡ªåŠ¨æ¸…ç†ç­–ç•¥å®ç°

**Pythonè‡ªåŠ¨æ¸…ç†è„šæœ¬**ï¼š

```python
import psycopg2
from datetime import datetime, timedelta
import schedule
import time
from typing import List

class AutoCleanupManager:
    def __init__(self, conn_str: str, neon_client, project_id: str):
        """åˆå§‹åŒ–è‡ªåŠ¨æ¸…ç†ç®¡ç†å™¨"""
        self.conn = psycopg2.connect(conn_str)
        self.cur = self.conn.cursor()
        self.neon_client = neon_client
        self.project_id = project_id

    def cleanup_old_experiments(self, older_than_days: int = 7):
        """æ¸…ç†æ—§å®éªŒ"""
        cutoff_date = datetime.now() - timedelta(days=older_than_days)

        # æŸ¥è¯¢æ—§å®éªŒ
        self.cur.execute("""
            SELECT id, name, branch_id
            FROM experiments
            WHERE created_at < %s
              AND status = 'completed'
        """, (cutoff_date,))

        old_experiments = self.cur.fetchall()
        deleted_count = 0

        for exp_id, exp_name, branch_id in old_experiments:
            try:
                # åˆ é™¤Neonåˆ†æ”¯
                if branch_id:
                    self.neon_client.branches.delete(
                        project_id=self.project_id,
                        branch_id=branch_id
                    )

                # åˆ é™¤å®éªŒè®°å½•
                self.cur.execute("DELETE FROM experiments WHERE id = %s", (exp_id,))

                deleted_count += 1
                print(f"Deleted experiment: {exp_name} (ID: {exp_id})")
            except Exception as e:
                print(f"Error deleting experiment {exp_id}: {e}")

        self.conn.commit()
        return deleted_count

    def cleanup_old_snapshots(self, older_than_days: int = 30):
        """æ¸…ç†æ—§å¿«ç…§"""
        cutoff_date = datetime.now() - timedelta(days=older_than_days)

        # æŸ¥è¯¢æ—§å¿«ç…§
        self.cur.execute("""
            SELECT table_name
            FROM experiment_snapshots
            WHERE created_at < %s
        """, (cutoff_date,))

        old_snapshots = self.cur.fetchall()
        deleted_count = 0

        for (table_name,) in old_snapshots:
            try:
                # åˆ é™¤å¿«ç…§è¡¨
                self.cur.execute(f"DROP TABLE IF EXISTS {table_name}")

                # åˆ é™¤å¿«ç…§è®°å½•
                self.cur.execute("""
                    DELETE FROM experiment_snapshots
                    WHERE table_name = %s
                """, (table_name,))

                deleted_count += 1
            except Exception as e:
                print(f"Error deleting snapshot {table_name}: {e}")

        self.conn.commit()
        return deleted_count

    def start_cleanup_scheduler(self):
        """å¯åŠ¨æ¸…ç†è°ƒåº¦å™¨"""
        # æ¯å¤©å‡Œæ™¨2ç‚¹æ¸…ç†æ—§å®éªŒ
        schedule.every().day.at("02:00").do(self.cleanup_old_experiments, older_than_days=7)

        # æ¯å‘¨æ—¥å‡Œæ™¨3ç‚¹æ¸…ç†æ—§å¿«ç…§
        schedule.every().sunday.at("03:00").do(self.cleanup_old_snapshots, older_than_days=30)

        print("Cleanup scheduler started")

        while True:
            schedule.run_pending()
            time.sleep(3600)  # æ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡

# ä½¿ç”¨ç¤ºä¾‹
cleanup_manager = AutoCleanupManager(
    conn_str="host=localhost dbname=testdb user=postgres password=secret",
    neon_client=neon_client,
    project_id="your-project-id"
)

# æ‰‹åŠ¨æ¸…ç†
deleted_experiments = cleanup_manager.cleanup_old_experiments(older_than_days=7)
print(f"Deleted {deleted_experiments} old experiments")

# å¯åŠ¨è‡ªåŠ¨æ¸…ç†ï¼ˆåœ¨åå°çº¿ç¨‹ä¸­è¿è¡Œï¼‰
import threading
cleanup_thread = threading.Thread(target=cleanup_manager.start_cleanup_scheduler)
cleanup_thread.daemon = True
cleanup_thread.start()
```

---

**æœ€åæ›´æ–°**: 2025 å¹´ 11 æœˆ 1 æ—¥
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 08-05-01
