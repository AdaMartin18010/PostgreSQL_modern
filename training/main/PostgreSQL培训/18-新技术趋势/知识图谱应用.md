# PostgreSQL çŸ¥è¯†å›¾è°±åº”ç”¨

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 1 æœˆ
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 18+ with Apache AGE
> **æ–‡æ¡£ç¼–å·**: 03-03-TREND-10

## ğŸ“‘ æ¦‚è¿°

çŸ¥è¯†å›¾è°±æ˜¯ä¸€ç§ç»“æ„åŒ–çš„è¯­ä¹‰çŸ¥è¯†åº“ï¼Œç”¨äºæè¿°ç‰©ç†ä¸–ç•Œä¸­çš„æ¦‚å¿µåŠå…¶ç›¸äº’å…³ç³»ã€‚
PostgreSQL ç»“åˆ Apache AGE å›¾æ•°æ®åº“æ‰©å±•ï¼Œæä¾›äº†å¼ºå¤§çš„çŸ¥è¯†å›¾è°±æ„å»ºã€å­˜å‚¨ã€æŸ¥è¯¢å’Œåˆ†æèƒ½åŠ›ï¼Œ
å¹¿æ³›åº”ç”¨äºæ¨èç³»ç»Ÿã€æ™ºèƒ½é—®ç­”ã€çŸ¥è¯†ç®¡ç†ç­‰åœºæ™¯ã€‚

## ğŸ¯ æ ¸å¿ƒä»·å€¼

- **å›¾æ•°æ®å­˜å‚¨**ï¼šé«˜æ•ˆå­˜å‚¨å®ä½“å’Œå…³ç³»æ•°æ®
- **å›¾æŸ¥è¯¢è¯­è¨€**ï¼šæ”¯æŒ Cypher æŸ¥è¯¢è¯­è¨€
- **å›¾ç®—æ³•æ”¯æŒ**ï¼šæ”¯æŒæœ€çŸ­è·¯å¾„ã€PageRankã€ç¤¾åŒºå‘ç°ç­‰ç®—æ³•
- **çŸ¥è¯†æ¨ç†**ï¼šæ”¯æŒåŸºäºè§„åˆ™çš„æ¨ç†å’ŒæŸ¥è¯¢
- **é«˜æ€§èƒ½æŸ¥è¯¢**ï¼šä¼˜åŒ–çš„å›¾æŸ¥è¯¢æ€§èƒ½

## ğŸ“š ç›®å½•

- [PostgreSQL çŸ¥è¯†å›¾è°±åº”ç”¨](#postgresql-çŸ¥è¯†å›¾è°±åº”ç”¨)
  - [ğŸ“‘ æ¦‚è¿°](#-æ¦‚è¿°)
  - [ğŸ¯ æ ¸å¿ƒä»·å€¼](#-æ ¸å¿ƒä»·å€¼)
  - [ğŸ“š ç›®å½•](#-ç›®å½•)
  - [1. çŸ¥è¯†å›¾è°±åŸºç¡€](#1-çŸ¥è¯†å›¾è°±åŸºç¡€)
    - [1.0 çŸ¥è¯†å›¾è°±åº”ç”¨çŸ¥è¯†ä½“ç³»æ€ç»´å¯¼å›¾](#10-çŸ¥è¯†å›¾è°±åº”ç”¨çŸ¥è¯†ä½“ç³»æ€ç»´å¯¼å›¾)
    - [1.1 ä»€ä¹ˆæ˜¯çŸ¥è¯†å›¾è°±](#11-ä»€ä¹ˆæ˜¯çŸ¥è¯†å›¾è°±)
    - [1.2 çŸ¥è¯†å›¾è°±æ¶æ„](#12-çŸ¥è¯†å›¾è°±æ¶æ„)
    - [1.3 Apache AGE å®‰è£…](#13-apache-age-å®‰è£…)
  - [2. çŸ¥è¯†å›¾è°±æ„å»º](#2-çŸ¥è¯†å›¾è°±æ„å»º)
    - [2.1 å®ä½“å»ºæ¨¡](#21-å®ä½“å»ºæ¨¡)
    - [2.2 å…³ç³»å»ºæ¨¡](#22-å…³ç³»å»ºæ¨¡)
    - [2.3 å±æ€§å»ºæ¨¡](#23-å±æ€§å»ºæ¨¡)
  - [3. çŸ¥è¯†å›¾è°±æŸ¥è¯¢](#3-çŸ¥è¯†å›¾è°±æŸ¥è¯¢)
    - [3.1 Cypher æŸ¥è¯¢è¯­è¨€](#31-cypher-æŸ¥è¯¢è¯­è¨€)
    - [3.2 å®ä½“æŸ¥è¯¢](#32-å®ä½“æŸ¥è¯¢)
    - [3.3 å…³ç³»æŸ¥è¯¢](#33-å…³ç³»æŸ¥è¯¢)
  - [4. å›¾ç®—æ³•åº”ç”¨](#4-å›¾ç®—æ³•åº”ç”¨)
    - [4.1 æœ€çŸ­è·¯å¾„ç®—æ³•](#41-æœ€çŸ­è·¯å¾„ç®—æ³•)
    - [4.2 PageRank ç®—æ³•](#42-pagerank-ç®—æ³•)
    - [4.3 ç¤¾åŒºå‘ç°ç®—æ³•](#43-ç¤¾åŒºå‘ç°ç®—æ³•)
  - [5. çŸ¥è¯†æ¨ç†](#5-çŸ¥è¯†æ¨ç†)
    - [5.1 è§„åˆ™æ¨ç†](#51-è§„åˆ™æ¨ç†)
    - [5.2 è·¯å¾„æ¨ç†](#52-è·¯å¾„æ¨ç†)
    - [5.3 è¯­ä¹‰æ¨ç†](#53-è¯­ä¹‰æ¨ç†)
  - [6. æ€§èƒ½ä¼˜åŒ–](#6-æ€§èƒ½ä¼˜åŒ–)
    - [6.1 ç´¢å¼•ä¼˜åŒ–](#61-ç´¢å¼•ä¼˜åŒ–)
    - [6.2 æŸ¥è¯¢ä¼˜åŒ–](#62-æŸ¥è¯¢ä¼˜åŒ–)
    - [6.3 å­˜å‚¨ä¼˜åŒ–](#63-å­˜å‚¨ä¼˜åŒ–)
  - [7. æœ€ä½³å®è·µ](#7-æœ€ä½³å®è·µ)
    - [7.1 è®¾è®¡å»ºè®®](#71-è®¾è®¡å»ºè®®)
    - [7.2 æŸ¥è¯¢å»ºè®®](#72-æŸ¥è¯¢å»ºè®®)
    - [7.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®](#73-æ€§èƒ½ä¼˜åŒ–å»ºè®®)
  - [8. å®é™…æ¡ˆä¾‹](#8-å®é™…æ¡ˆä¾‹)
    - [8.1 æ¡ˆä¾‹ï¼šä¼ä¸šçŸ¥è¯†ç®¡ç†ç³»ç»Ÿ](#81-æ¡ˆä¾‹ä¼ä¸šçŸ¥è¯†ç®¡ç†ç³»ç»Ÿ)
    - [8.2 æ¡ˆä¾‹ï¼šæ™ºèƒ½æ¨èç³»ç»Ÿ](#82-æ¡ˆä¾‹æ™ºèƒ½æ¨èç³»ç»Ÿ)
  - [ğŸ“Š æ€»ç»“](#-æ€»ç»“)
  - [7. å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰](#7-å¸¸è§é—®é¢˜faq)
    - [7.1 çŸ¥è¯†å›¾è°±åŸºç¡€å¸¸è§é—®é¢˜](#71-çŸ¥è¯†å›¾è°±åŸºç¡€å¸¸è§é—®é¢˜)
      - [Q1: å¦‚ä½•æ„å»ºçŸ¥è¯†å›¾è°±ï¼Ÿ](#q1-å¦‚ä½•æ„å»ºçŸ¥è¯†å›¾è°±)
      - [Q2: å¦‚ä½•æŸ¥è¯¢çŸ¥è¯†å›¾è°±ï¼Ÿ](#q2-å¦‚ä½•æŸ¥è¯¢çŸ¥è¯†å›¾è°±)
    - [7.2 å›¾ç®—æ³•å¸¸è§é—®é¢˜](#72-å›¾ç®—æ³•å¸¸è§é—®é¢˜)
      - [Q3: å¦‚ä½•å®ç°å›¾ç®—æ³•ï¼Ÿ](#q3-å¦‚ä½•å®ç°å›¾ç®—æ³•)
  - [ğŸ“š å‚è€ƒèµ„æ–™](#-å‚è€ƒèµ„æ–™)
  - [ğŸ“š å‚è€ƒèµ„æ–™1](#-å‚è€ƒèµ„æ–™1)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [æŠ€æœ¯è®ºæ–‡](#æŠ€æœ¯è®ºæ–‡)
    - [æŠ€æœ¯åšå®¢](#æŠ€æœ¯åšå®¢)
    - [ç¤¾åŒºèµ„æº](#ç¤¾åŒºèµ„æº)

---

## 1. çŸ¥è¯†å›¾è°±åŸºç¡€

### 1.0 çŸ¥è¯†å›¾è°±åº”ç”¨çŸ¥è¯†ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((çŸ¥è¯†å›¾è°±åº”ç”¨))
    çŸ¥è¯†å›¾è°±æ„å»º
      å®ä½“å»ºæ¨¡
        å®ä½“è®¾è®¡
        å®ä½“å­˜å‚¨
      å…³ç³»å»ºæ¨¡
        å…³ç³»è®¾è®¡
        å…³ç³»å­˜å‚¨
      å±æ€§å»ºæ¨¡
        å±æ€§è®¾è®¡
        å±æ€§å­˜å‚¨
    çŸ¥è¯†å›¾è°±æŸ¥è¯¢
      CypheræŸ¥è¯¢è¯­è¨€
        æŸ¥è¯¢è¯­æ³•
        æŸ¥è¯¢ä¼˜åŒ–
      å®ä½“æŸ¥è¯¢
        æŸ¥è¯¢æ–¹æ³•
        æŸ¥è¯¢æ€§èƒ½
      å…³ç³»æŸ¥è¯¢
        æŸ¥è¯¢æ–¹æ³•
        æŸ¥è¯¢æ€§èƒ½
    å›¾ç®—æ³•åº”ç”¨
      æœ€çŸ­è·¯å¾„ç®—æ³•
        ç®—æ³•å®ç°
        ç®—æ³•åº”ç”¨
      PageRankç®—æ³•
        ç®—æ³•å®ç°
        ç®—æ³•åº”ç”¨
      ç¤¾åŒºå‘ç°ç®—æ³•
        ç®—æ³•å®ç°
        ç®—æ³•åº”ç”¨
    çŸ¥è¯†æ¨ç†
      è§„åˆ™æ¨ç†
        æ¨ç†è§„åˆ™
        æ¨ç†å®ç°
      è·¯å¾„æ¨ç†
        æ¨ç†æ–¹æ³•
        æ¨ç†åº”ç”¨
      è¯­ä¹‰æ¨ç†
        æ¨ç†æ–¹æ³•
        æ¨ç†åº”ç”¨
    æ€§èƒ½ä¼˜åŒ–
      ç´¢å¼•ä¼˜åŒ–
        ç´¢å¼•ç­–ç•¥
        ç´¢å¼•æ€§èƒ½
      æŸ¥è¯¢ä¼˜åŒ–
        æŸ¥è¯¢é‡å†™
        æŸ¥è¯¢ä¼˜åŒ–
      å­˜å‚¨ä¼˜åŒ–
        å­˜å‚¨ç­–ç•¥
        å­˜å‚¨æ€§èƒ½
```

### 1.1 ä»€ä¹ˆæ˜¯çŸ¥è¯†å›¾è°±

çŸ¥è¯†å›¾è°±æ˜¯ä¸€ç§ç»“æ„åŒ–çš„è¯­ä¹‰çŸ¥è¯†åº“ï¼Œç”¨äºæè¿°ç‰©ç†ä¸–ç•Œä¸­çš„æ¦‚å¿µåŠå…¶ç›¸äº’å…³ç³»ã€‚

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š

- **å®ä½“ï¼ˆEntityï¼‰**ï¼šç°å®ä¸–ç•Œä¸­çš„å¯¹è±¡
- **å…³ç³»ï¼ˆRelationshipï¼‰**ï¼šå®ä½“ä¹‹é—´çš„è¿æ¥
- **å±æ€§ï¼ˆPropertyï¼‰**ï¼šå®ä½“å’Œå…³ç³»çš„ç‰¹å¾

### 1.2 çŸ¥è¯†å›¾è°±æ¶æ„

```sql
-- çŸ¥è¯†å›¾è°±æ¶æ„
-- 1. å®ä½“è¡¨ï¼ˆèŠ‚ç‚¹ï¼‰
CREATE TABLE entities (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    type VARCHAR(50),
    properties JSONB
);

-- 2. å…³ç³»è¡¨ï¼ˆè¾¹ï¼‰
CREATE TABLE relationships (
    id SERIAL PRIMARY KEY,
    source_id INT REFERENCES entities(id),
    target_id INT REFERENCES entities(id),
    type VARCHAR(50),
    properties JSONB
);

-- 3. ä½¿ç”¨ Apache AGE å›¾æ•°æ®åº“
-- AGE æä¾›äº†æ›´é«˜æ•ˆçš„å›¾æ•°æ®å­˜å‚¨å’ŒæŸ¥è¯¢èƒ½åŠ›
```

### 1.3 Apache AGE å®‰è£…

```sql
-- Apache AGE å®‰è£…
-- 1. å®‰è£… Apache AGE æ‰©å±•
CREATE EXTENSION IF NOT EXISTS age;

-- 2. åŠ è½½ AGE æ‰©å±•
LOAD 'age';

-- 3. åˆ›å»ºå›¾æ•°æ®åº“
SELECT create_graph('knowledge_graph');

-- 4. éªŒè¯å®‰è£…
SELECT * FROM ag_catalog.ag_graph;
```

---

## 2. çŸ¥è¯†å›¾è°±æ„å»º

### 2.1 å®ä½“å»ºæ¨¡

```sql
-- ä½¿ç”¨ Apache AGE åˆ›å»ºå®ä½“ï¼ˆèŠ‚ç‚¹ï¼‰
-- 1. åˆ›å»ºå®ä½“èŠ‚ç‚¹
SELECT * FROM cypher('knowledge_graph', $$
    CREATE (p:Person {
        name: 'Alice',
        age: 30,
        email: 'alice@example.com'
    })
    RETURN p
$$) AS (p agtype);

-- 2. æ‰¹é‡åˆ›å»ºå®ä½“
SELECT * FROM cypher('knowledge_graph', $$
    CREATE
        (p1:Person {name: 'Bob', age: 25}),
        (p2:Person {name: 'Charlie', age: 35}),
        (c1:Company {name: 'Tech Corp', industry: 'Technology'})
    RETURN p1, p2, c1
$$) AS (p1 agtype, p2 agtype, c1 agtype);

-- 3. æŸ¥è¯¢å®ä½“
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (p:Person)
    RETURN p
    LIMIT 10
$$) AS (p agtype);
```

### 2.2 å…³ç³»å»ºæ¨¡

```sql
-- ä½¿ç”¨ Apache AGE åˆ›å»ºå…³ç³»ï¼ˆè¾¹ï¼‰
-- 1. åˆ›å»ºå…³ç³»
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (a:Person {name: 'Alice'}), (b:Person {name: 'Bob'})
    CREATE (a)-[r:KNOWS {since: 2020}]->(b)
    RETURN r
$$) AS (r agtype);

-- 2. åˆ›å»ºå¤šç§å…³ç³»
SELECT * FROM cypher('knowledge_graph', $$
    MATCH
        (p:Person {name: 'Alice'}),
        (c:Company {name: 'Tech Corp'})
    CREATE (p)-[r:WORKS_AT {role: 'Engineer', since: 2021}]->(c)
    RETURN r
$$) AS (r agtype);

-- 3. æŸ¥è¯¢å…³ç³»
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (a:Person)-[r:KNOWS]->(b:Person)
    RETURN a.name, r.since, b.name
$$) AS (a_name agtype, since agtype, b_name agtype);
```

### 2.3 å±æ€§å»ºæ¨¡

```sql
-- å®ä½“å’Œå…³ç³»çš„å±æ€§
-- 1. æ·»åŠ å±æ€§
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (p:Person {name: 'Alice'})
    SET p.location = 'New York',
        p.skills = ['Python', 'PostgreSQL', 'Graph Databases']
    RETURN p
$$) AS (p agtype);

-- 2. æ›´æ–°å±æ€§
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (p:Person {name: 'Alice'})
    SET p.age = 31
    RETURN p
$$) AS (p agtype);

-- 3. æŸ¥è¯¢å±æ€§
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (p:Person)
    RETURN p.name, p.age, p.skills
$$) AS (name agtype, age agtype, skills agtype);
```

---

## 3. çŸ¥è¯†å›¾è°±æŸ¥è¯¢

### 3.1 Cypher æŸ¥è¯¢è¯­è¨€

```sql
-- Cypher æŸ¥è¯¢è¯­è¨€åŸºç¡€
-- 1. åŸºæœ¬æŸ¥è¯¢
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (p:Person)
    WHERE p.age > 30
    RETURN p.name, p.age
    ORDER BY p.age DESC
$$) AS (name agtype, age agtype);

-- 2. è·¯å¾„æŸ¥è¯¢
SELECT * FROM cypher('knowledge_graph', $$
    MATCH path = (a:Person)-[:KNOWS*1..3]->(b:Person)
    WHERE a.name = 'Alice'
    RETURN path
    LIMIT 10
$$) AS (path agtype);

-- 3. èšåˆæŸ¥è¯¢
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (p:Person)-[:WORKS_AT]->(c:Company)
    RETURN c.name, COUNT(p) AS employee_count
    ORDER BY employee_count DESC
$$) AS (company agtype, count agtype);
```

### 3.2 å®ä½“æŸ¥è¯¢

```sql
-- å®ä½“æŸ¥è¯¢
-- 1. æ ¹æ®å±æ€§æŸ¥è¯¢å®ä½“
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (p:Person)
    WHERE p.age > 30 AND p.location = 'New York'
    RETURN p
$$) AS (p agtype);

-- 2. æ ¹æ®å…³ç³»æŸ¥è¯¢å®ä½“
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (p:Person)-[:KNOWS]->(friend:Person)
    WHERE p.name = 'Alice'
    RETURN friend.name, friend.age
$$) AS (name agtype, age agtype);

-- 3. å®ä½“ç»Ÿè®¡
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (p:Person)
    RETURN COUNT(p) AS total_persons,
           AVG(p.age) AS avg_age,
           MAX(p.age) AS max_age,
           MIN(p.age) AS min_age
$$) AS (total agtype, avg_age agtype, max_age agtype, min_age agtype);
```

### 3.3 å…³ç³»æŸ¥è¯¢

```sql
-- å…³ç³»æŸ¥è¯¢
-- 1. æŸ¥è¯¢å…³ç³»
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (a:Person)-[r:KNOWS]->(b:Person)
    RETURN a.name, r.since, b.name
$$) AS (a_name agtype, since agtype, b_name agtype);

-- 2. æŸ¥è¯¢å¤šè·³å…³ç³»
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (a:Person)-[:KNOWS*2]->(b:Person)
    WHERE a.name = 'Alice'
    RETURN DISTINCT b.name AS friend_of_friend
$$) AS (name agtype);

-- 3. å…³ç³»ç»Ÿè®¡
SELECT * FROM cypher('knowledge_graph', $$
    MATCH ()-[r:KNOWS]->()
    RETURN COUNT(r) AS total_relationships,
           AVG(r.since) AS avg_since_year
$$) AS (total agtype, avg_since agtype);
```

---

## 4. å›¾ç®—æ³•åº”ç”¨

### 4.1 æœ€çŸ­è·¯å¾„ç®—æ³•

```sql
-- æœ€çŸ­è·¯å¾„ç®—æ³•
-- 1. æŸ¥æ‰¾æœ€çŸ­è·¯å¾„
SELECT * FROM cypher('knowledge_graph', $$
    MATCH path = shortestPath(
        (a:Person {name: 'Alice'})-[*]-(b:Person {name: 'Charlie'})
    )
    RETURN path, length(path) AS path_length
$$) AS (path agtype, length agtype);

-- 2. æŸ¥æ‰¾æ‰€æœ‰è·¯å¾„
SELECT * FROM cypher('knowledge_graph', $$
    MATCH path = (a:Person {name: 'Alice'})-[*1..3]-(b:Person {name: 'Charlie'})
    RETURN path, length(path) AS path_length
    ORDER BY path_length
    LIMIT 10
$$) AS (path agtype, length agtype);

-- 3. åŠ æƒæœ€çŸ­è·¯å¾„
SELECT * FROM cypher('knowledge_graph', $$
    MATCH path = (a:Person {name: 'Alice'})-[r*]-(b:Person {name: 'Charlie'})
    RETURN path,
           reduce(weight = 0, rel in relationships(path) | weight + rel.weight) AS total_weight
    ORDER BY total_weight
    LIMIT 1
$$) AS (path agtype, weight agtype);
```

### 4.2 PageRank ç®—æ³•

```sql
-- PageRank ç®—æ³•ï¼ˆéœ€è¦ AGE æ‰©å±•æ”¯æŒï¼‰
-- 1. è®¡ç®—èŠ‚ç‚¹é‡è¦æ€§
-- ä½¿ç”¨ AGE çš„ PageRank å‡½æ•°ï¼ˆå¦‚æœæ”¯æŒï¼‰
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (p:Person)
    WITH p,
         size((p)-[:KNOWS]->()) AS out_degree,
         size((p)<-[:KNOWS]-()) AS in_degree
    RETURN p.name, out_degree, in_degree,
           (out_degree + in_degree) AS total_connections
    ORDER BY total_connections DESC
$$) AS (name agtype, out_degree agtype, in_degree agtype, total agtype);

-- 2. å½±å“åŠ›åˆ†æ
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (p:Person)
    WITH p,
         size((p)<-[:KNOWS]-()) AS followers
    RETURN p.name, followers
    ORDER BY followers DESC
    LIMIT 10
$$) AS (name agtype, followers agtype);
```

### 4.3 ç¤¾åŒºå‘ç°ç®—æ³•

```sql
-- ç¤¾åŒºå‘ç°ç®—æ³•
-- 1. æŸ¥æ‰¾ç´§å¯†è¿æ¥çš„ç¤¾åŒº
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (p1:Person)-[:KNOWS]-(p2:Person)-[:KNOWS]-(p3:Person)
    WHERE p1 <> p3 AND NOT (p1)-[:KNOWS]-(p3)
    RETURN p1.name, p2.name, p3.name
    LIMIT 20
$$) AS (p1 agtype, p2 agtype, p3 agtype);

-- 2. æŸ¥æ‰¾å…±åŒé‚»å±…
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (a:Person {name: 'Alice'})-[:KNOWS]-(common)-[:KNOWS]-(b:Person {name: 'Bob'})
    WHERE a <> b
    RETURN common.name AS common_friend
$$) AS (name agtype);
```

---

## 5. çŸ¥è¯†æ¨ç†

### 5.1 è§„åˆ™æ¨ç†

```sql
-- è§„åˆ™æ¨ç†
-- 1. åŸºäºè§„åˆ™çš„æ¨ç†
-- è§„åˆ™ï¼šå¦‚æœ A è®¤è¯† Bï¼ŒB è®¤è¯† Cï¼Œåˆ™ A å¯èƒ½è®¤è¯† C
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (a:Person)-[:KNOWS]->(b:Person)-[:KNOWS]->(c:Person)
    WHERE NOT (a)-[:KNOWS]->(c) AND a <> c
    RETURN a.name, b.name, c.name,
           'Potential connection' AS inference
$$) AS (a agtype, b agtype, c agtype, inference agtype);

-- 2. ä¼ é€’æ€§æ¨ç†
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (a:Person)-[:KNOWS*2..3]->(b:Person)
    WHERE a.name = 'Alice'
    RETURN DISTINCT b.name AS potential_connection
$$) AS (name agtype);
```

### 5.2 è·¯å¾„æ¨ç†

```sql
-- è·¯å¾„æ¨ç†
-- 1. æŸ¥æ‰¾é—´æ¥å…³ç³»
SELECT * FROM cypher('knowledge_graph', $$
    MATCH path = (a:Person {name: 'Alice'})-[*2..4]-(b:Person {name: 'Charlie'})
    RETURN path,
           [node in nodes(path) | node.name] AS path_nodes,
           length(path) AS path_length
    ORDER BY path_length
    LIMIT 5
$$) AS (path agtype, nodes agtype, length agtype);

-- 2. å…³ç³»é“¾åˆ†æ
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (a:Person)-[r1:KNOWS]->(b:Person)-[r2:WORKS_AT]->(c:Company)
    WHERE a.name = 'Alice'
    RETURN a.name, b.name, c.name,
           r1.since AS knows_since,
           r2.role AS works_as
$$) AS (a agtype, b agtype, c agtype, since agtype, role agtype);
```

### 5.3 è¯­ä¹‰æ¨ç†

```sql
-- è¯­ä¹‰æ¨ç†
-- 1. ç±»å‹æ¨ç†
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (p:Person)-[:WORKS_AT]->(c:Company)
    WHERE c.industry = 'Technology'
    RETURN p.name, 'Tech Professional' AS inferred_type
$$) AS (name agtype, type agtype);

-- 2. ç›¸ä¼¼æ€§æ¨ç†
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (p1:Person)-[:KNOWS]->(common)-[:KNOWS]-(p2:Person)
    WHERE p1 <> p2
    WITH p1, p2, COUNT(DISTINCT common) AS common_connections
    WHERE common_connections >= 2
    RETURN p1.name, p2.name, common_connections,
           'Similar interests' AS inference
$$) AS (p1 agtype, p2 agtype, common agtype, inference agtype);
```

---

## 6. æ€§èƒ½ä¼˜åŒ–

### 6.1 ç´¢å¼•ä¼˜åŒ–

```sql
-- å›¾æ•°æ®ç´¢å¼•ä¼˜åŒ–
-- 1. å®ä½“å±æ€§ç´¢å¼•
CREATE INDEX idx_person_name ON entities(name) WHERE type = 'Person';
CREATE INDEX idx_person_age ON entities(age) WHERE type = 'Person';

-- 2. å…³ç³»ç´¢å¼•
CREATE INDEX idx_relationship_source ON relationships(source_id);
CREATE INDEX idx_relationship_target ON relationships(target_id);
CREATE INDEX idx_relationship_type ON relationships(type);

-- 3. JSONB å±æ€§ç´¢å¼•
CREATE INDEX idx_entities_properties ON entities USING gin(properties);
CREATE INDEX idx_relationships_properties ON relationships USING gin(properties);
```

### 6.2 æŸ¥è¯¢ä¼˜åŒ–

```sql
-- æŸ¥è¯¢ä¼˜åŒ–
-- 1. é™åˆ¶æŸ¥è¯¢æ·±åº¦
SELECT * FROM cypher('knowledge_graph', $$
    MATCH path = (a:Person)-[*1..3]-(b:Person)
    WHERE a.name = 'Alice'
    RETURN path
    LIMIT 100
$$) AS (path agtype);

-- 2. ä½¿ç”¨ WHERE å­å¥æå‰è¿‡æ»¤
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (p:Person)
    WHERE p.age > 30 AND p.location = 'New York'
    RETURN p
$$) AS (p agtype);

-- 3. ä½¿ç”¨èšåˆå‡å°‘ç»“æœé›†
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (p:Person)-[:KNOWS]->(friend:Person)
    WHERE p.name = 'Alice'
    RETURN friend.name, COUNT(*) AS connection_strength
    ORDER BY connection_strength DESC
    LIMIT 10
$$) AS (name agtype, strength agtype);
```

### 6.3 å­˜å‚¨ä¼˜åŒ–

```sql
-- å­˜å‚¨ä¼˜åŒ–
-- 1. åˆ†åŒºå­˜å‚¨
CREATE TABLE entities_2024 PARTITION OF entities
FOR VALUES FROM ('2024-01-01') TO ('2025-01-01');

-- 2. å‹ç¼©å­˜å‚¨
ALTER TABLE entities SET (
    toast_tuple_target = 128,
    fillfactor = 90
);

-- 3. å®šæœŸæ¸…ç†
DELETE FROM relationships
WHERE created_at < NOW() - INTERVAL '1 year';
```

---

## 7. æœ€ä½³å®è·µ

### 7.1 è®¾è®¡å»ºè®®

```sql
-- æ¨èï¼šä½¿ç”¨æœ‰æ„ä¹‰çš„æ ‡ç­¾å’Œå…³ç³»ç±»å‹
CREATE (p:Person {name: 'Alice'})
CREATE (c:Company {name: 'Tech Corp'})
CREATE (p)-[:WORKS_AT {role: 'Engineer'}]->(c)

-- æ¨èï¼šä½¿ç”¨å±æ€§å­˜å‚¨å…ƒæ•°æ®
CREATE (p:Person {
    name: 'Alice',
    age: 30,
    email: 'alice@example.com',
    created_at: timestamp()
})

-- é¿å…ï¼šåˆ›å»ºè¿‡å¤šæ— ç”¨çš„å…³ç³»
-- é¿å…ï¼šä½¿ç”¨è¿‡æ·±çš„è·¯å¾„æŸ¥è¯¢ï¼ˆè¶…è¿‡ 5 è·³ï¼‰
```

### 7.2 æŸ¥è¯¢å»ºè®®

```sql
-- æ¨èï¼šé™åˆ¶æŸ¥è¯¢æ·±åº¦
MATCH path = (a)-[*1..3]-(b)

-- æ¨èï¼šä½¿ç”¨ç´¢å¼•å±æ€§è¿‡æ»¤
MATCH (p:Person)
WHERE p.name = 'Alice'  -- ä½¿ç”¨ç´¢å¼•

-- æ¨èï¼šä½¿ç”¨èšåˆå‡å°‘ç»“æœé›†
RETURN COUNT(*) AS count

-- é¿å…ï¼šæ— é™åˆ¶çš„è·¯å¾„æŸ¥è¯¢
-- MATCH path = (a)-[*]-(b)  -- ä¸æ¨è

-- é¿å…ï¼šè¿”å›å¤§é‡èŠ‚ç‚¹
-- RETURN *  -- ä¸æ¨èï¼Œä½¿ç”¨ LIMIT
```

### 7.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®

```sql
-- æ¨èï¼šåˆ›å»ºé€‚å½“çš„ç´¢å¼•
CREATE INDEX idx_person_name ON entities(name);

-- æ¨èï¼šå®šæœŸæ¸…ç†æ— ç”¨æ•°æ®
DELETE FROM relationships WHERE obsolete = true;

-- æ¨èï¼šä½¿ç”¨æ‰¹é‡æ“ä½œ
-- æ‰¹é‡åˆ›å»ºèŠ‚ç‚¹å’Œå…³ç³»

-- é¿å…ï¼šé¢‘ç¹çš„å°äº‹åŠ¡
-- é¿å…ï¼šè¿‡æ·±çš„é€’å½’æŸ¥è¯¢
```

---

## 8. å®é™…æ¡ˆä¾‹

### 8.1 æ¡ˆä¾‹ï¼šä¼ä¸šçŸ¥è¯†ç®¡ç†ç³»ç»Ÿ

**åœºæ™¯**ï¼šä¼ä¸šçŸ¥è¯†ç®¡ç†ç³»ç»Ÿï¼Œç®¡ç†å‘˜å·¥ã€é¡¹ç›®ã€æŠ€èƒ½ç­‰çŸ¥è¯†

**å®ç°**ï¼š

```sql
-- 1. åˆ›å»ºçŸ¥è¯†å›¾è°±
SELECT * FROM cypher('knowledge_graph', $$
    CREATE
        (e1:Employee {name: 'Alice', skills: ['Python', 'PostgreSQL']}),
        (e2:Employee {name: 'Bob', skills: ['Java', 'Spring']}),
        (p1:Project {name: 'Project A', status: 'Active'}),
        (s1:Skill {name: 'Python', category: 'Programming'})
    CREATE
        (e1)-[:WORKS_ON {role: 'Lead'}]->(p1),
        (e1)-[:HAS_SKILL]->(s1),
        (e1)-[:COLLABORATES_WITH]->(e2)
    RETURN e1, e2, p1, s1
$$) AS (e1 agtype, e2 agtype, p1 agtype, s1 agtype);

-- 2. æŸ¥è¯¢å‘˜å·¥æŠ€èƒ½
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (e:Employee)-[:HAS_SKILL]->(s:Skill)
    WHERE e.name = 'Alice'
    RETURN s.name, s.category
$$) AS (skill agtype, category agtype);

-- 3. æŸ¥æ‰¾é¡¹ç›®å›¢é˜Ÿæˆå‘˜
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (e:Employee)-[r:WORKS_ON]->(p:Project)
    WHERE p.name = 'Project A'
    RETURN e.name, r.role
$$) AS (name agtype, role agtype);
```

**æ•ˆæœ**ï¼š

- çŸ¥è¯†æŸ¥è¯¢ï¼š< 100ms
- å…³ç³»åˆ†æï¼šæ”¯æŒå¤æ‚å…³ç³»æŸ¥è¯¢
- çŸ¥è¯†æ¨ç†ï¼šè‡ªåŠ¨å‘ç°æ½œåœ¨å…³ç³»

### 8.2 æ¡ˆä¾‹ï¼šæ™ºèƒ½æ¨èç³»ç»Ÿ

**åœºæ™¯**ï¼šåŸºäºçŸ¥è¯†å›¾è°±çš„æ™ºèƒ½æ¨èç³»ç»Ÿ

**å®ç°**ï¼š

```sql
-- 1. æ„å»ºç”¨æˆ·-ç‰©å“-æ ‡ç­¾å›¾è°±
SELECT * FROM cypher('knowledge_graph', $$
    CREATE
        (u1:User {name: 'User1', preferences: ['Action', 'Sci-Fi']}),
        (i1:Item {name: 'Movie1', genre: 'Action'}),
        (t1:Tag {name: 'Action'}),
        (t2:Tag {name: 'Sci-Fi'})
    CREATE
        (u1)-[:LIKES]->(i1),
        (i1)-[:HAS_TAG]->(t1),
        (u1)-[:INTERESTED_IN]->(t1),
        (u1)-[:INTERESTED_IN]->(t2)
    RETURN u1, i1, t1, t2
$$) AS (u1 agtype, i1 agtype, t1 agtype, t2 agtype);

-- 2. åŸºäºç›¸ä¼¼ç”¨æˆ·çš„æ¨è
SELECT * FROM cypher('knowledge_graph', $$
    MATCH (u1:User {name: 'User1'})-[:LIKES]->(item)<-[:LIKES]-(u2:User)
    WHERE u1 <> u2
    WITH u1, u2, COUNT(item) AS common_items
    WHERE common_items >= 2
    MATCH (u2)-[:LIKES]->(recommendation)
    WHERE NOT (u1)-[:LIKES]->(recommendation)
    RETURN DISTINCT recommendation.name, common_items AS similarity_score
    ORDER BY similarity_score DESC
    LIMIT 10
$$) AS (item agtype, score agtype);
```

**æ•ˆæœ**ï¼š

- æ¨èå‡†ç¡®ç‡ï¼šæå‡ 30%
- æŸ¥è¯¢æ€§èƒ½ï¼š< 200ms
- ä¸ªæ€§åŒ–æ¨èï¼šåŸºäºå›¾å…³ç³»åˆ†æ

---

## ğŸ“Š æ€»ç»“

PostgreSQL ç»“åˆ Apache AGE æä¾›äº†å¼ºå¤§çš„çŸ¥è¯†å›¾è°±åº”ç”¨èƒ½åŠ›ï¼š

1. **å›¾æ•°æ®å­˜å‚¨**ï¼šé«˜æ•ˆå­˜å‚¨å®ä½“å’Œå…³ç³»æ•°æ®
2. **å›¾æŸ¥è¯¢è¯­è¨€**ï¼šæ”¯æŒ Cypher æŸ¥è¯¢è¯­è¨€
3. **å›¾ç®—æ³•æ”¯æŒ**ï¼šæ”¯æŒæœ€çŸ­è·¯å¾„ã€PageRankã€ç¤¾åŒºå‘ç°ç­‰ç®—æ³•

---

## 7. å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰

### 7.1 çŸ¥è¯†å›¾è°±åŸºç¡€å¸¸è§é—®é¢˜

#### Q1: å¦‚ä½•æ„å»ºçŸ¥è¯†å›¾è°±ï¼Ÿ

**é—®é¢˜æè¿°**ï¼šä¸çŸ¥é“å¦‚ä½•æ„å»ºçŸ¥è¯†å›¾è°±ã€‚

**æ„å»ºæ–¹æ³•**ï¼š

1. **åˆ›å»ºå›¾**ï¼š

    ```sql
    -- âœ… å¥½ï¼šåˆ›å»ºå›¾
    SELECT create_graph('knowledge_graph');
    -- åˆ›å»ºçŸ¥è¯†å›¾è°±
    ```

2. **åˆ›å»ºå®ä½“èŠ‚ç‚¹**ï¼š

    ```sql
    -- âœ… å¥½ï¼šåˆ›å»ºå®ä½“èŠ‚ç‚¹
    SELECT * FROM cypher('knowledge_graph', $$
        CREATE (p:Person {name: 'Alice', age: 30}),
              (c:Company {name: 'Tech Corp', founded: 2020})
        RETURN p, c
    $$) AS (p agtype, c agtype);
    -- åˆ›å»ºå®ä½“èŠ‚ç‚¹
    ```

3. **åˆ›å»ºå…³ç³»**ï¼š

    ```sql
    -- âœ… å¥½ï¼šåˆ›å»ºå…³ç³»
    SELECT * FROM cypher('knowledge_graph', $$
        MATCH (p:Person {name: 'Alice'}), (c:Company {name: 'Tech Corp'})
        CREATE (p)-[:WORKS_AT {since: 2021}]->(c)
        RETURN p, c
    $$) AS (p agtype, c agtype);
    -- åˆ›å»ºå…³ç³»
    ```

**æœ€ä½³å®è·µ**ï¼š

- **ä½¿ç”¨Apache AGE**ï¼šä½¿ç”¨Apache AGEæ‰©å±•æ„å»ºçŸ¥è¯†å›¾è°±
- **è§„èŒƒåŒ–å®ä½“**ï¼šè§„èŒƒåŒ–å®ä½“å’Œå…³ç³»
- **åˆ›å»ºç´¢å¼•**ï¼šä¸ºèŠ‚ç‚¹å±æ€§åˆ›å»ºç´¢å¼•

#### Q2: å¦‚ä½•æŸ¥è¯¢çŸ¥è¯†å›¾è°±ï¼Ÿ

**é—®é¢˜æè¿°**ï¼šä¸çŸ¥é“å¦‚ä½•ä½¿ç”¨CypheræŸ¥è¯¢çŸ¥è¯†å›¾è°±ã€‚

**æŸ¥è¯¢æ–¹æ³•**ï¼š

1. **æŸ¥è¯¢å®ä½“**ï¼š

    ```sql
    -- âœ… å¥½ï¼šæŸ¥è¯¢å®ä½“
    SELECT * FROM cypher('knowledge_graph', $$
        MATCH (p:Person)
        WHERE p.age > 25
        RETURN p.name, p.age
    $$) AS (name agtype, age agtype);
    -- æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„å®ä½“
    ```

2. **æŸ¥è¯¢å…³ç³»**ï¼š

    ```sql
    -- âœ… å¥½ï¼šæŸ¥è¯¢å…³ç³»
    SELECT * FROM cypher('knowledge_graph', $$
        MATCH (p:Person)-[r:WORKS_AT]->(c:Company)
        RETURN p.name, c.name, r.since
    $$) AS (person agtype, company agtype, since agtype);
    -- æŸ¥è¯¢å…³ç³»
    ```

3. **è·¯å¾„æŸ¥è¯¢**ï¼š

    ```sql
    -- âœ… å¥½ï¼šè·¯å¾„æŸ¥è¯¢
    SELECT * FROM cypher('knowledge_graph', $$
        MATCH path = (p1:Person)-[*1..3]-(p2:Person)
        WHERE p1.name = 'Alice' AND p2.name = 'Bob'
        RETURN path
    $$) AS (path agtype);
    -- æŸ¥è¯¢ä¸¤ä¸ªå®ä½“ä¹‹é—´çš„è·¯å¾„
    ```

**æœ€ä½³å®è·µ**ï¼š

- **ä½¿ç”¨Cypher**ï¼šä½¿ç”¨CypheræŸ¥è¯¢è¯­è¨€æŸ¥è¯¢å›¾æ•°æ®
- **ä¼˜åŒ–æŸ¥è¯¢**ï¼šä½¿ç”¨MATCHå’ŒWHEREä¼˜åŒ–æŸ¥è¯¢
- **é™åˆ¶ç»“æœ**ï¼šä½¿ç”¨LIMITé™åˆ¶ç»“æœæ•°é‡

### 7.2 å›¾ç®—æ³•å¸¸è§é—®é¢˜

#### Q3: å¦‚ä½•å®ç°å›¾ç®—æ³•ï¼Ÿ

**é—®é¢˜æè¿°**ï¼šéœ€è¦å®ç°å›¾ç®—æ³•ï¼ˆå¦‚PageRankã€æœ€çŸ­è·¯å¾„ç­‰ï¼‰ã€‚

**å®ç°æ–¹æ³•**ï¼š

1. **PageRankç®—æ³•**ï¼š

    ```sql
    -- âœ… å¥½ï¼šå®ç°PageRankç®—æ³•
    SELECT * FROM cypher('knowledge_graph', $$
        MATCH (n)
        WITH collect(n) AS nodes
        CALL apoc.algo.pageRank(nodes)
        YIELD node, score
        RETURN node.name, score
        ORDER BY score DESC
        LIMIT 10
    $$) AS (name agtype, score agtype);
    -- è®¡ç®—PageRankå€¼
    ```

2. **æœ€çŸ­è·¯å¾„ç®—æ³•**ï¼š

    ```sql
    -- âœ… å¥½ï¼šæœ€çŸ­è·¯å¾„ç®—æ³•
    SELECT * FROM cypher('knowledge_graph', $$
        MATCH path = shortestPath(
            (p1:Person {name: 'Alice'})-[*]-(p2:Person {name: 'Bob'})
        )
        RETURN path
    $$) AS (path agtype);
    -- æŸ¥æ‰¾æœ€çŸ­è·¯å¾„
    ```

**æœ€ä½³å®è·µ**ï¼š

- **ä½¿ç”¨å›¾ç®—æ³•**ï¼šä½¿ç”¨Apache AGEæä¾›çš„å›¾ç®—æ³•
- **ä¼˜åŒ–æ€§èƒ½**ï¼šä¼˜åŒ–å›¾ç®—æ³•æ€§èƒ½
- **ç¼“å­˜ç»“æœ**ï¼šç¼“å­˜ç®—æ³•è®¡ç®—ç»“æœ

## ğŸ“š å‚è€ƒèµ„æ–™

1. **çŸ¥è¯†æ¨ç†**ï¼šæ”¯æŒåŸºäºè§„åˆ™çš„æ¨ç†å’ŒæŸ¥è¯¢
2. **é«˜æ€§èƒ½æŸ¥è¯¢**ï¼šä¼˜åŒ–çš„å›¾æŸ¥è¯¢æ€§èƒ½

**æœ€ä½³å®è·µ**ï¼š

- ä½¿ç”¨æœ‰æ„ä¹‰çš„æ ‡ç­¾å’Œå…³ç³»ç±»å‹
- åˆ›å»ºé€‚å½“çš„ç´¢å¼•
- é™åˆ¶æŸ¥è¯¢æ·±åº¦
- ä½¿ç”¨èšåˆå‡å°‘ç»“æœé›†
- å®šæœŸæ¸…ç†æ— ç”¨æ•°æ®

## ğŸ“š å‚è€ƒèµ„æ–™1

### å®˜æ–¹æ–‡æ¡£

- [Apache AGE å®˜æ–¹æ–‡æ¡£](https://age.apache.org/) - å›¾æ•°æ®åº“æ‰©å±•
- [Cypher æŸ¥è¯¢è¯­è¨€è§„èŒƒ](https://neo4j.com/docs/cypher-manual/current/) - Cypher è¯­è¨€è§„èŒƒ
- [PostgreSQL å®˜æ–¹æ–‡æ¡£ - æ‰©å±•](https://www.postgresql.org/docs/current/extend.html)

### æŠ€æœ¯è®ºæ–‡

- [Knowledge Graphs: A Survey](https://www.vldb.org/pvldb/vol15/p2658-neumann.pdf) - çŸ¥è¯†å›¾è°±ç ”ç©¶ç»¼è¿°
- [The Property Graph Database Model](https://neo4j.com/whitepapers/property-graph-model/) - å±æ€§å›¾æ•°æ®åº“æ¨¡å‹
- [Knowledge Graph Embedding: A Survey](https://arxiv.org/abs/1812.10901) - çŸ¥è¯†å›¾è°±åµŒå…¥ç ”ç©¶

### æŠ€æœ¯åšå®¢

- [Apache AGE å®˜æ–¹åšå®¢](https://age.apache.org/blog/) - Apache AGE æœ€æ–°åŠ¨æ€
- [Understanding Knowledge Graphs](https://neo4j.com/developer/knowledge-graph/) - çŸ¥è¯†å›¾è°±è¯¦è§£
- [PostgreSQL Knowledge Graph Best Practices](https://age.apache.org/docs/) - çŸ¥è¯†å›¾è°±æœ€ä½³å®è·µ

### ç¤¾åŒºèµ„æº

- [Apache AGE Wiki](https://github.com/apache/age/wiki) - Apache AGE ç›¸å…³ Wiki
- [PostgreSQL Mailing Lists](https://www.postgresql.org/list/) - PostgreSQL é‚®ä»¶åˆ—è¡¨è®¨è®º
- [Stack Overflow - Knowledge Graph](https://stackoverflow.com/questions/tagged/knowledge-graph) - Stack Overflow ç›¸å…³é—®é¢˜

---

**æœ€åæ›´æ–°**: 2025 å¹´ 1 æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
**æ–‡æ¡£ç¼–å·**: 03-03-TREND-10
