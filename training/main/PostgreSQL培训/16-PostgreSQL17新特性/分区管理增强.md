# PostgreSQL 17 åˆ†åŒºç®¡ç†å¢å¼º

> **æ›´æ–°æ—¶é—´**: 2025 å¹´ 1 æœˆ
> **æŠ€æœ¯ç‰ˆæœ¬**: PostgreSQL 17+
> **æ–‡æ¡£ç¼–å·**: 03-03-17-08

## ğŸ“‘ æ¦‚è¿°

PostgreSQL 17 å¯¹åˆ†åŒºè¡¨ç®¡ç†è¿›è¡Œäº†é‡è¦å¢å¼ºï¼ŒåŒ…æ‹¬åˆ†åŒºæ“ä½œæ”¹è¿›ã€ç®¡ç†å·¥å…·å¢å¼ºã€è‡ªåŠ¨åŒ–åˆ†åŒºç®¡ç†ç­‰åŠŸèƒ½ï¼Œä½¿å¾—åˆ†åŒºè¡¨çš„ç®¡ç†æ›´åŠ ä¾¿æ·å’Œé«˜æ•ˆã€‚

## ğŸ¯ æ ¸å¿ƒä»·å€¼

- **åˆ†åŒºæ“ä½œæ”¹è¿›**ï¼šæ›´å¿«é€Ÿçš„åˆ†åŒºæ“ä½œ
- **ç®¡ç†å·¥å…·å¢å¼º**ï¼šæ›´å¼ºå¤§çš„ç®¡ç†å·¥å…·
- **è‡ªåŠ¨åŒ–ç®¡ç†**ï¼šæ”¯æŒè‡ªåŠ¨åŒ–åˆ†åŒºç®¡ç†
- **æ€§èƒ½ä¼˜åŒ–**ï¼šåˆ†åŒºæ“ä½œæ€§èƒ½æå‡
- **æ˜“ç”¨æ€§æå‡**ï¼šç®€åŒ–åˆ†åŒºç®¡ç†æµç¨‹

## ğŸ“š ç›®å½•

- [PostgreSQL 17 åˆ†åŒºç®¡ç†å¢å¼º](#postgresql-17-åˆ†åŒºç®¡ç†å¢å¼º)
  - [ğŸ“‘ æ¦‚è¿°](#-æ¦‚è¿°)
  - [ğŸ¯ æ ¸å¿ƒä»·å€¼](#-æ ¸å¿ƒä»·å€¼)
  - [ğŸ“š ç›®å½•](#-ç›®å½•)
  - [1. åˆ†åŒºç®¡ç†å¢å¼ºæ¦‚è¿°](#1-åˆ†åŒºç®¡ç†å¢å¼ºæ¦‚è¿°)
    - [1.0 PostgreSQL 17 åˆ†åŒºç®¡ç†å¢å¼ºçŸ¥è¯†ä½“ç³»æ€ç»´å¯¼å›¾](#10-postgresql-17-åˆ†åŒºç®¡ç†å¢å¼ºçŸ¥è¯†ä½“ç³»æ€ç»´å¯¼å›¾)
    - [1.0 åˆ†åŒºç®¡ç†å¢å¼ºå·¥ä½œåŸç†æ¦‚è¿°](#10-åˆ†åŒºç®¡ç†å¢å¼ºå·¥ä½œåŸç†æ¦‚è¿°)
    - [1.1 PostgreSQL 17 å¢å¼ºäº®ç‚¹](#11-postgresql-17-å¢å¼ºäº®ç‚¹)
    - [1.2 åŠŸèƒ½å¯¹æ¯”](#12-åŠŸèƒ½å¯¹æ¯”)
    - [1.3 åˆ†åŒºç®¡ç†å¢å¼ºå½¢å¼åŒ–å®šä¹‰](#13-åˆ†åŒºç®¡ç†å¢å¼ºå½¢å¼åŒ–å®šä¹‰)
    - [1.4 åˆ†åŒºç®¡ç†ç­–ç•¥å¯¹æ¯”çŸ©é˜µ](#14-åˆ†åŒºç®¡ç†ç­–ç•¥å¯¹æ¯”çŸ©é˜µ)
    - [1.5 åˆ†åŒºç®¡ç†ç­–ç•¥é€‰æ‹©å†³ç­–æµç¨‹](#15-åˆ†åŒºç®¡ç†ç­–ç•¥é€‰æ‹©å†³ç­–æµç¨‹)
    - [1.6 åˆ†åŒºç®¡ç†ç­–ç•¥é€‰æ‹©å†³ç­–è®ºè¯](#16-åˆ†åŒºç®¡ç†ç­–ç•¥é€‰æ‹©å†³ç­–è®ºè¯)
  - [2. åˆ†åŒºæ“ä½œæ”¹è¿›](#2-åˆ†åŒºæ“ä½œæ”¹è¿›)
    - [2.1 åˆ†åŒºæ·»åŠ ä¼˜åŒ–](#21-åˆ†åŒºæ·»åŠ ä¼˜åŒ–)
    - [2.2 åˆ†åŒºåˆ é™¤ä¼˜åŒ–](#22-åˆ†åŒºåˆ é™¤ä¼˜åŒ–)
    - [2.3 åˆ†åŒºåˆå¹¶ä¼˜åŒ–](#23-åˆ†åŒºåˆå¹¶ä¼˜åŒ–)
    - [2.4 åˆ†åŒºæ‹†åˆ†ä¼˜åŒ–](#24-åˆ†åŒºæ‹†åˆ†ä¼˜åŒ–)
  - [3. ç®¡ç†å·¥å…·å¢å¼º](#3-ç®¡ç†å·¥å…·å¢å¼º)
    - [3.1 åˆ†åŒºä¿¡æ¯æŸ¥è¯¢](#31-åˆ†åŒºä¿¡æ¯æŸ¥è¯¢)
    - [3.2 åˆ†åŒºç»Ÿè®¡ä¿¡æ¯](#32-åˆ†åŒºç»Ÿè®¡ä¿¡æ¯)
    - [3.3 åˆ†åŒºç»´æŠ¤å·¥å…·](#33-åˆ†åŒºç»´æŠ¤å·¥å…·)
  - [4. è‡ªåŠ¨åŒ–åˆ†åŒºç®¡ç†](#4-è‡ªåŠ¨åŒ–åˆ†åŒºç®¡ç†)
    - [4.1 è‡ªåŠ¨åˆ†åŒºåˆ›å»º](#41-è‡ªåŠ¨åˆ†åŒºåˆ›å»º)
    - [4.2 è‡ªåŠ¨åˆ†åŒºåˆ é™¤](#42-è‡ªåŠ¨åˆ†åŒºåˆ é™¤)
    - [4.3 åˆ†åŒºç­–ç•¥é…ç½®](#43-åˆ†åŒºç­–ç•¥é…ç½®)
  - [5. æœ€ä½³å®è·µ](#5-æœ€ä½³å®è·µ)
    - [5.1 åˆ†åŒºè®¾è®¡å»ºè®®](#51-åˆ†åŒºè®¾è®¡å»ºè®®)
    - [5.2 ç®¡ç†å»ºè®®](#52-ç®¡ç†å»ºè®®)
    - [5.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®](#53-æ€§èƒ½ä¼˜åŒ–å»ºè®®)
  - [6. å®é™…æ¡ˆä¾‹](#6-å®é™…æ¡ˆä¾‹)
    - [6.1 æ¡ˆä¾‹ï¼šæ—¶é—´åºåˆ—æ•°æ®åˆ†åŒºç®¡ç†ï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰](#61-æ¡ˆä¾‹æ—¶é—´åºåˆ—æ•°æ®åˆ†åŒºç®¡ç†çœŸå®æ¡ˆä¾‹)
    - [6.2 æ¡ˆä¾‹ï¼šå¤šç§Ÿæˆ·æ•°æ®åˆ†åŒºç®¡ç†](#62-æ¡ˆä¾‹å¤šç§Ÿæˆ·æ•°æ®åˆ†åŒºç®¡ç†)
  - [ğŸ“Š æ€»ç»“](#-æ€»ç»“)
  - [8. å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰](#8-å¸¸è§é—®é¢˜faq)
    - [8.1 åˆ†åŒºç®¡ç†åŸºç¡€å¸¸è§é—®é¢˜](#81-åˆ†åŒºç®¡ç†åŸºç¡€å¸¸è§é—®é¢˜)
      - [Q1: PostgreSQL 17çš„åˆ†åŒºç®¡ç†æœ‰å“ªäº›æ”¹è¿›ï¼Ÿ](#q1-postgresql-17çš„åˆ†åŒºç®¡ç†æœ‰å“ªäº›æ”¹è¿›)
      - [Q2: å¦‚ä½•æ·»åŠ æ–°åˆ†åŒºï¼Ÿ](#q2-å¦‚ä½•æ·»åŠ æ–°åˆ†åŒº)
      - [Q3: å¦‚ä½•åˆ é™¤åˆ†åŒºï¼Ÿ](#q3-å¦‚ä½•åˆ é™¤åˆ†åŒº)
    - [8.2 åˆ†åŒºç»´æŠ¤å¸¸è§é—®é¢˜](#82-åˆ†åŒºç»´æŠ¤å¸¸è§é—®é¢˜)
      - [Q4: å¦‚ä½•è‡ªåŠ¨ç®¡ç†åˆ†åŒºï¼Ÿ](#q4-å¦‚ä½•è‡ªåŠ¨ç®¡ç†åˆ†åŒº)
      - [Q5: åˆ†åŒºè¡¨éœ€è¦å®šæœŸç»´æŠ¤å—ï¼Ÿ](#q5-åˆ†åŒºè¡¨éœ€è¦å®šæœŸç»´æŠ¤å—)
    - [8.3 åˆ†åŒºæ€§èƒ½å¸¸è§é—®é¢˜](#83-åˆ†åŒºæ€§èƒ½å¸¸è§é—®é¢˜)
      - [Q6: åˆ†åŒºè¡¨æŸ¥è¯¢æ€§èƒ½å¦‚ä½•ä¼˜åŒ–ï¼Ÿ](#q6-åˆ†åŒºè¡¨æŸ¥è¯¢æ€§èƒ½å¦‚ä½•ä¼˜åŒ–)
      - [Q7: åˆ†åŒºæ•°é‡å¯¹æ€§èƒ½çš„å½±å“ï¼Ÿ](#q7-åˆ†åŒºæ•°é‡å¯¹æ€§èƒ½çš„å½±å“)
  - [9. å‚è€ƒèµ„æ–™](#9-å‚è€ƒèµ„æ–™)
    - [9.1 å‚è€ƒèµ„æ–™](#91-å‚è€ƒèµ„æ–™)
      - [9.1.1 å®˜æ–¹æ–‡æ¡£](#911-å®˜æ–¹æ–‡æ¡£)
      - [9.1.2 SQLæ ‡å‡†](#912-sqlæ ‡å‡†)
      - [9.1.3 æŠ€æœ¯è®ºæ–‡](#913-æŠ€æœ¯è®ºæ–‡)
      - [9.1.4 æŠ€æœ¯åšå®¢](#914-æŠ€æœ¯åšå®¢)
      - [9.1.5 ç¤¾åŒºèµ„æº](#915-ç¤¾åŒºèµ„æº)
      - [9.1.6 ç›¸å…³æ–‡æ¡£](#916-ç›¸å…³æ–‡æ¡£)

---

## 1. åˆ†åŒºç®¡ç†å¢å¼ºæ¦‚è¿°

### 1.0 PostgreSQL 17 åˆ†åŒºç®¡ç†å¢å¼ºçŸ¥è¯†ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((PostgreSQL 17åˆ†åŒºç®¡ç†å¢å¼º))
    åˆ†åŒºæ“ä½œæ”¹è¿›
      åˆ†åŒºæ·»åŠ ä¼˜åŒ–
        æ·»åŠ æ–¹æ³•
        æ€§èƒ½ä¼˜åŒ–
      åˆ†åŒºåˆ é™¤ä¼˜åŒ–
        åˆ é™¤æ–¹æ³•
        æ€§èƒ½ä¼˜åŒ–
      åˆ†åŒºåˆå¹¶ä¼˜åŒ–
        åˆå¹¶æ–¹æ³•
        æ€§èƒ½ä¼˜åŒ–
      åˆ†åŒºæ‹†åˆ†ä¼˜åŒ–
        æ‹†åˆ†æ–¹æ³•
        æ€§èƒ½ä¼˜åŒ–
    ç®¡ç†å·¥å…·å¢å¼º
      åˆ†åŒºä¿¡æ¯æŸ¥è¯¢
        æŸ¥è¯¢æ–¹æ³•
        ä¿¡æ¯å±•ç¤º
      åˆ†åŒºç»Ÿè®¡ä¿¡æ¯
        ç»Ÿè®¡æ”¶é›†
        ç»Ÿè®¡åˆ†æ
      åˆ†åŒºç»´æŠ¤å·¥å…·
        ç»´æŠ¤åŠŸèƒ½
        ç»´æŠ¤å·¥å…·
    è‡ªåŠ¨åŒ–åˆ†åŒºç®¡ç†
      è‡ªåŠ¨åˆ†åŒºåˆ›å»º
        åˆ›å»ºç­–ç•¥
        è‡ªåŠ¨åˆ›å»º
      è‡ªåŠ¨åˆ†åŒºåˆ é™¤
        åˆ é™¤ç­–ç•¥
        è‡ªåŠ¨åˆ é™¤
      åˆ†åŒºç­–ç•¥é…ç½®
        ç­–ç•¥é…ç½®
        ç­–ç•¥ç®¡ç†
```

### 1.0 åˆ†åŒºç®¡ç†å¢å¼ºå·¥ä½œåŸç†æ¦‚è¿°

**åˆ†åŒºç®¡ç†å¢å¼ºçš„æœ¬è´¨**ï¼š

PostgreSQL 17 çš„åˆ†åŒºç®¡ç†å¢å¼ºåŸºäºæ”¹è¿›çš„åˆ†åŒºæ“ä½œç®—æ³•ã€è‡ªåŠ¨åŒ–ç®¡ç†æœºåˆ¶å’Œå¢å¼ºçš„ç®¡ç†å·¥å…·ã€‚
åˆ†åŒºç®¡ç†æ˜¯æ•°æ®åº“ç®¡ç†çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œé€šè¿‡åˆç†çš„åˆ†åŒºç­–ç•¥å¯ä»¥æå‡æŸ¥è¯¢æ€§èƒ½ã€ç®€åŒ–æ•°æ®ç®¡ç†ã€‚
PostgreSQL 17 é€šè¿‡ä¼˜åŒ–åˆ†åŒºæ·»åŠ /åˆ é™¤æ“ä½œã€æ”¯æŒè‡ªåŠ¨åŒ–åˆ†åŒºç®¡ç†ã€å¢å¼ºåˆ†åŒºç»Ÿè®¡ä¿¡æ¯ï¼Œ
æ˜¾è‘—æå‡äº†åˆ†åŒºè¡¨çš„ç®¡ç†æ•ˆç‡å’Œæ€§èƒ½ã€‚

**åˆ†åŒºç®¡ç†å¢å¼ºæ‰§è¡Œæµç¨‹å›¾**ï¼š

```mermaid
flowchart TD
    A[åˆ†åŒºç®¡ç†éœ€æ±‚] --> B{æ“ä½œç±»å‹}
    B -->|æ·»åŠ åˆ†åŒº| C[åˆ†åŒºæ·»åŠ ä¼˜åŒ–]
    B -->|åˆ é™¤åˆ†åŒº| D[åˆ†åŒºåˆ é™¤ä¼˜åŒ–]
    B -->|åˆå¹¶åˆ†åŒº| E[åˆ†åŒºåˆå¹¶ä¼˜åŒ–]
    B -->|æ‹†åˆ†åˆ†åŒº| F[åˆ†åŒºæ‹†åˆ†ä¼˜åŒ–]
    C --> G[è‡ªåŠ¨åŒ–ç®¡ç†æ£€æŸ¥]
    D --> G
    E --> G
    F --> G
    G -->|éœ€è¦è‡ªåŠ¨åŒ–| H[è‡ªåŠ¨åˆ†åŒºåˆ›å»º/åˆ é™¤]
    G -->|æ‰‹åŠ¨ç®¡ç†| I[æ‰§è¡Œåˆ†åŒºæ“ä½œ]
    H --> J[æ›´æ–°ç»Ÿè®¡ä¿¡æ¯]
    I --> J
    J --> K[å®Œæˆåˆ†åŒºç®¡ç†]

    style B fill:#FFD700
    style G fill:#90EE90
    style H fill:#87CEEB
    style K fill:#87CEEB
```

**åˆ†åŒºç®¡ç†å¢å¼ºæ‰§è¡Œæ­¥éª¤**ï¼š

1. **è¯†åˆ«æ“ä½œç±»å‹**ï¼šç¡®å®šéœ€è¦æ‰§è¡Œçš„åˆ†åŒºæ“ä½œï¼ˆæ·»åŠ /åˆ é™¤/åˆå¹¶/æ‹†åˆ†ï¼‰
2. **ä¼˜åŒ–æ“ä½œç®—æ³•**ï¼šä½¿ç”¨æ”¹è¿›çš„ç®—æ³•æ‰§è¡Œåˆ†åŒºæ“ä½œ
3. **è‡ªåŠ¨åŒ–ç®¡ç†æ£€æŸ¥**ï¼šæ£€æŸ¥æ˜¯å¦éœ€è¦è‡ªåŠ¨åŒ–ç®¡ç†
4. **æ‰§è¡Œåˆ†åŒºæ“ä½œ**ï¼šæ‰§è¡Œåˆ†åŒºæ·»åŠ /åˆ é™¤/åˆå¹¶/æ‹†åˆ†æ“ä½œ
5. **æ›´æ–°ç»Ÿè®¡ä¿¡æ¯**ï¼šæ›´æ–°åˆ†åŒºç»Ÿè®¡ä¿¡æ¯
6. **å®Œæˆåˆ†åŒºç®¡ç†**ï¼šå®Œæˆåˆ†åŒºç®¡ç†æ“ä½œ

### 1.1 PostgreSQL 17 å¢å¼ºäº®ç‚¹

PostgreSQL 17 åœ¨åˆ†åŒºç®¡ç†æ–¹é¢çš„ä¸»è¦å¢å¼ºï¼š

- **åˆ†åŒºæ“ä½œæ€§èƒ½æå‡**ï¼šåˆ†åŒºæ·»åŠ /åˆ é™¤é€Ÿåº¦æå‡ 2-3 å€
- **è‡ªåŠ¨åŒ–ç®¡ç†**ï¼šæ”¯æŒè‡ªåŠ¨åˆ›å»ºå’Œåˆ é™¤åˆ†åŒº
- **ç®¡ç†å·¥å…·å¢å¼º**ï¼šæ›´å¼ºå¤§çš„åˆ†åŒºç®¡ç†å·¥å…·
- **ç»Ÿè®¡ä¿¡æ¯æ”¹è¿›**ï¼šæ›´è¯¦ç»†çš„åˆ†åŒºç»Ÿè®¡ä¿¡æ¯
- **æ“ä½œç®€åŒ–**ï¼šç®€åŒ–åˆ†åŒºç®¡ç†æ“ä½œæµç¨‹

### 1.2 åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | PostgreSQL 16 | PostgreSQL 17 |
|------|--------------|---------------|
| è‡ªåŠ¨åˆ†åŒºåˆ›å»º | âŒ | âœ… |
| è‡ªåŠ¨åˆ†åŒºåˆ é™¤ | âŒ | âœ… |
| åˆ†åŒºåˆå¹¶ | æ”¯æŒ | ä¼˜åŒ– |
| åˆ†åŒºæ‹†åˆ† | æ”¯æŒ | ä¼˜åŒ– |
| åˆ†åŒºç»Ÿè®¡ | åŸºç¡€ | å¢å¼º |

### 1.3 åˆ†åŒºç®¡ç†å¢å¼ºå½¢å¼åŒ–å®šä¹‰

**å®šä¹‰1ï¼ˆåˆ†åŒºç®¡ç†å¢å¼ºï¼‰**ï¼š

åˆ†åŒºç®¡ç†å¢å¼ºæ˜¯ä¸€ä¸ªå…­å…ƒç»„ `PME = (T, P, O, A, S, M)`ï¼Œå…¶ä¸­ï¼š

- **T** = {tâ‚, tâ‚‚, ..., tâ‚™} æ˜¯åˆ†åŒºè¡¨é›†åˆï¼Œæ¯ä¸ªè¡¨ táµ¢ åŒ…å«åˆ†åŒºé”® keyáµ¢ å’Œåˆ†åŒºç­–ç•¥ strategyáµ¢
- **P** = {pâ‚, pâ‚‚, ..., pâ‚˜} æ˜¯åˆ†åŒºé›†åˆï¼Œæ¯ä¸ªåˆ†åŒº pâ±¼ åŒ…å«åˆ†åŒºè¾¹ç•Œ boundaryâ±¼ å’Œåˆ†åŒºæ•°æ® dataâ±¼
- **O** = (add, delete, merge, split) æ˜¯åˆ†åŒºæ“ä½œé›†åˆ
- **A** = (auto_create, auto_delete, auto_maintain) æ˜¯è‡ªåŠ¨åŒ–ç®¡ç†ç­–ç•¥
- **S** = (statistics, monitoring, reporting) æ˜¯ç»Ÿè®¡ä¿¡æ¯é›†åˆ
- **M** = (performance, efficiency, usability) æ˜¯ç®¡ç†æŒ‡æ ‡é›†åˆ

**å®šä¹‰2ï¼ˆåˆ†åŒºæ·»åŠ ä¼˜åŒ–ï¼‰**ï¼š

åˆ†åŒºæ·»åŠ ä¼˜åŒ–æ˜¯ä¸€ä¸ªå‡½æ•° `PartitionAddOptimization: T Ã— P â†’ P_new`ï¼Œå…¶ä¸­ï¼š

- **è¾“å…¥**ï¼šåˆ†åŒºè¡¨ T å’Œæ–°åˆ†åŒº P
- **è¾“å‡º**ï¼šæ·»åŠ åçš„åˆ†åŒºé›†åˆ P_new
- **çº¦æŸ**ï¼š`P_new = OptimizeAdd(T, P)`

**åˆ†åŒºæ·»åŠ ç®—æ³•**ï¼š

```text
FUNCTION AddPartition(table, partition):
    IF IsCompatible(table.strategy, partition.boundary):
        partition = CreatePartition(table, partition.boundary)
        table.partitions.add(partition)
        UpdateStatistics(table)
        RETURN SUCCESS
    ELSE:
        RETURN ERROR
```

**åˆ†åŒºæ·»åŠ æ€§èƒ½ä¼˜åŒ–å®šç†**ï¼š

å¯¹äºåˆ†åŒºæ·»åŠ ä¼˜åŒ–ï¼Œæ€§èƒ½æå‡æ»¡è¶³ï¼š

```text
AddTime_old = O(n)
AddTime_new = O(log n)  // ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–
PerformanceGain = n / log n
```

**å®šä¹‰3ï¼ˆè‡ªåŠ¨åŒ–åˆ†åŒºç®¡ç†ï¼‰**ï¼š

è‡ªåŠ¨åŒ–åˆ†åŒºç®¡ç†æ˜¯ä¸€ä¸ªå‡½æ•° `AutoPartitionManagement: T Ã— Policy â†’ T_managed`ï¼Œå…¶ä¸­ï¼š

- **è¾“å…¥**ï¼šåˆ†åŒºè¡¨ T å’Œç®¡ç†ç­–ç•¥ Policy
- **è¾“å‡º**ï¼šç®¡ç†åçš„åˆ†åŒºè¡¨ T_managed
- **çº¦æŸ**ï¼š`T_managed = AutoManage(T, Policy)`

**è‡ªåŠ¨åŒ–ç®¡ç†ç®—æ³•**ï¼š

```text
FUNCTION AutoManagePartitions(table, policy):
    IF policy.auto_create:
        CreateFuturePartitions(table, policy.premake)
    IF policy.auto_delete:
        DeleteOldPartitions(table, policy.retention)
    UpdateStatistics(table)
    RETURN table
```

**è‡ªåŠ¨åŒ–ç®¡ç†æ•ˆç‡å®šç†**ï¼š

å¯¹äºè‡ªåŠ¨åŒ–åˆ†åŒºç®¡ç†ï¼Œæ•ˆç‡æå‡æ»¡è¶³ï¼š

```text
ManagementTime_old = O(n Ã— m)  // næ˜¯åˆ†åŒºæ•°ï¼Œmæ˜¯æ“ä½œæ•°
ManagementTime_new = O(n)      // è‡ªåŠ¨åŒ–ç®¡ç†
EfficiencyGain = n Ã— m / n = m
```

**å®šä¹‰4ï¼ˆåˆ†åŒºç»Ÿè®¡ä¿¡æ¯ï¼‰**ï¼š

åˆ†åŒºç»Ÿè®¡ä¿¡æ¯æ˜¯ä¸€ä¸ªå‡½æ•° `PartitionStatistics: T â†’ Stats`ï¼Œå…¶ä¸­ï¼š

- **è¾“å…¥**ï¼šåˆ†åŒºè¡¨ T
- **è¾“å‡º**ï¼šç»Ÿè®¡ä¿¡æ¯ Stats
- **çº¦æŸ**ï¼š`Stats = CollectStatistics(T)`

**ç»Ÿè®¡ä¿¡æ¯æ”¶é›†ç®—æ³•**ï¼š

```text
FUNCTION CollectStatistics(table):
    stats = {}
    FOR partition IN table.partitions:
        stats[partition] = {
            size: GetPartitionSize(partition),
            row_count: GetRowCount(partition),
            last_analyze: GetLastAnalyze(partition)
        }
    RETURN stats
```

### 1.4 åˆ†åŒºç®¡ç†ç­–ç•¥å¯¹æ¯”çŸ©é˜µ

| åˆ†åŒºç®¡ç†ç­–ç•¥ | è‡ªåŠ¨åŒ–ç¨‹åº¦ | æ€§èƒ½ | æ˜“ç”¨æ€§ | çµæ´»æ€§ | ç»´æŠ¤æˆæœ¬ | ç»¼åˆè¯„åˆ† |
|------------|-----------|------|--------|--------|---------|---------|
| **è‡ªåŠ¨åŒ–ç®¡ç†** | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | 4.6/5 |
| **åŠè‡ªåŠ¨ç®¡ç†** | â­â­â­â­ | â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | 4.2/5 |
| **æ‰‹åŠ¨ç®¡ç†** | â­â­ | â­â­â­ | â­â­ | â­â­â­â­â­ | â­â­ | 2.8/5 |

**è¯„åˆ†è¯´æ˜**ï¼š

- â­â­â­â­â­ï¼šä¼˜ç§€ï¼ˆ5åˆ†ï¼‰
- â­â­â­â­ï¼šè‰¯å¥½ï¼ˆ4åˆ†ï¼‰
- â­â­â­ï¼šä¸­ç­‰ï¼ˆ3åˆ†ï¼‰
- â­â­ï¼šä¸€èˆ¬ï¼ˆ2åˆ†ï¼‰
- â­ï¼šè¾ƒå·®ï¼ˆ1åˆ†ï¼‰

### 1.5 åˆ†åŒºç®¡ç†ç­–ç•¥é€‰æ‹©å†³ç­–æµç¨‹

```mermaid
flowchart TD
    A[å¼€å§‹ï¼šåˆ†åŒºç®¡ç†ç­–ç•¥é€‰æ‹©] --> B{åˆ†æåº”ç”¨éœ€æ±‚}
    B --> C{éœ€è¦è‡ªåŠ¨åŒ–?}
    B --> D{éœ€è¦çµæ´»æ€§?}
    B --> E{ç»´æŠ¤æˆæœ¬è¦æ±‚?}

    C -->|æ˜¯| F[è‡ªåŠ¨åŒ–ç®¡ç†]
    D -->|æ˜¯| G[åŠè‡ªåŠ¨ç®¡ç†]
    E -->|ä½| H[æ‰‹åŠ¨ç®¡ç†]
    C -->|å¦| I[æ‰‹åŠ¨ç®¡ç†]

    F --> J{æ€§èƒ½è¾¾æ ‡?}
    G --> J
    H --> J
    I --> J

    J -->|å¦| K[è°ƒæ•´ç®¡ç†ç­–ç•¥]
    J -->|æ˜¯| L[å®Œæˆé€‰æ‹©]

    K --> M[æé«˜è‡ªåŠ¨åŒ–ç¨‹åº¦]
    K --> N[é™ä½è‡ªåŠ¨åŒ–ç¨‹åº¦]

    M --> J
    N --> J

    style F fill:#90EE90
    style G fill:#90EE90
    style H fill:#90EE90
    style I fill:#90EE90
    style L fill:#87CEEB
```

### 1.6 åˆ†åŒºç®¡ç†ç­–ç•¥é€‰æ‹©å†³ç­–è®ºè¯

**é—®é¢˜**ï¼šå¦‚ä½•ä¸ºåˆ†åŒºè¡¨é€‰æ‹©æœ€ä¼˜çš„ç®¡ç†ç­–ç•¥ï¼Ÿ

**éœ€æ±‚åˆ†æ**ï¼š

1. **åº”ç”¨ç‰¹å¾**ï¼šæ—¶é—´åºåˆ—æ•°æ®ï¼Œéœ€è¦å®šæœŸåˆ›å»ºå’Œåˆ é™¤åˆ†åŒº
2. **è‡ªåŠ¨åŒ–è¦æ±‚**ï¼šéœ€è¦è‡ªåŠ¨åŒ–ç®¡ç†ï¼Œå‡å°‘äººå·¥å¹²é¢„
3. **æ€§èƒ½è¦æ±‚**ï¼šåˆ†åŒºæ“ä½œæ€§èƒ½ > 1000 TPS
4. **ç»´æŠ¤æˆæœ¬è¦æ±‚**ï¼šç»´æŠ¤æˆæœ¬ < 10% æ€»æˆæœ¬

**æ–¹æ¡ˆåˆ†æ**ï¼š

**æ–¹æ¡ˆ1ï¼šè‡ªåŠ¨åŒ–ç®¡ç†**:

- **æè¿°**ï¼šä½¿ç”¨pg_partmanç­‰å·¥å…·è¿›è¡Œè‡ªåŠ¨åŒ–åˆ†åŒºç®¡ç†
- **ä¼˜ç‚¹**ï¼š
  - è‡ªåŠ¨åŒ–ç¨‹åº¦ä¼˜ç§€ï¼ˆå®Œå…¨è‡ªåŠ¨åŒ–ï¼‰
  - æ˜“ç”¨æ€§ä¼˜ç§€ï¼ˆé…ç½®ç®€å•ï¼‰
  - ç»´æŠ¤æˆæœ¬ä½ï¼ˆè‡ªåŠ¨åŒ–ç»´æŠ¤ï¼‰
  - é€‚åˆæ—¶é—´åºåˆ—æ•°æ®
- **ç¼ºç‚¹**ï¼š
  - çµæ´»æ€§ä¸­ç­‰ï¼ˆéœ€è¦éµå¾ªå·¥å…·è§„åˆ™ï¼‰
- **é€‚ç”¨åœºæ™¯**ï¼šæ—¶é—´åºåˆ—æ•°æ®
- **æ€§èƒ½æ•°æ®**ï¼šè‡ªåŠ¨åŒ–ç¨‹åº¦ä¼˜ç§€ï¼Œæ˜“ç”¨æ€§ä¼˜ç§€ï¼Œç»´æŠ¤æˆæœ¬ä½
- **æˆæœ¬åˆ†æ**ï¼šå¼€å‘æˆæœ¬ä½ï¼Œç»´æŠ¤æˆæœ¬ä½ï¼Œé£é™©ä½

**æ–¹æ¡ˆ2ï¼šåŠè‡ªåŠ¨ç®¡ç†**:

- **æè¿°**ï¼šéƒ¨åˆ†è‡ªåŠ¨åŒ–ï¼Œéƒ¨åˆ†æ‰‹åŠ¨ç®¡ç†
- **ä¼˜ç‚¹**ï¼š
  - è‡ªåŠ¨åŒ–ç¨‹åº¦è‰¯å¥½ï¼ˆéƒ¨åˆ†è‡ªåŠ¨åŒ–ï¼‰
  - çµæ´»æ€§ä¼˜ç§€ï¼ˆå¯ä»¥è‡ªå®šä¹‰ï¼‰
  - é€‚åˆéœ€è¦çµæ´»æ€§çš„åœºæ™¯
- **ç¼ºç‚¹**ï¼š
  - æ˜“ç”¨æ€§ä¸­ç­‰ï¼ˆéœ€è¦éƒ¨åˆ†æ‰‹åŠ¨æ“ä½œï¼‰
  - ç»´æŠ¤æˆæœ¬ä¸­ç­‰ï¼ˆéœ€è¦éƒ¨åˆ†æ‰‹åŠ¨ç»´æŠ¤ï¼‰
- **é€‚ç”¨åœºæ™¯**ï¼šéœ€è¦çµæ´»æ€§çš„åœºæ™¯
- **æ€§èƒ½æ•°æ®**ï¼šè‡ªåŠ¨åŒ–ç¨‹åº¦è‰¯å¥½ï¼Œçµæ´»æ€§ä¼˜ç§€ï¼Œæ˜“ç”¨æ€§ä¸­ç­‰
- **æˆæœ¬åˆ†æ**ï¼šå¼€å‘æˆæœ¬ä¸­ç­‰ï¼Œç»´æŠ¤æˆæœ¬ä¸­ç­‰ï¼Œé£é™©ä¸­ç­‰

**æ–¹æ¡ˆ3ï¼šæ‰‹åŠ¨ç®¡ç†**:

- **æè¿°**ï¼šå®Œå…¨æ‰‹åŠ¨ç®¡ç†åˆ†åŒº
- **ä¼˜ç‚¹**ï¼š
  - çµæ´»æ€§ä¼˜ç§€ï¼ˆå®Œå…¨è‡ªå®šä¹‰ï¼‰
  - é€‚åˆç‰¹æ®Šéœ€æ±‚åœºæ™¯
- **ç¼ºç‚¹**ï¼š
  - è‡ªåŠ¨åŒ–ç¨‹åº¦å·®ï¼ˆå®Œå…¨æ‰‹åŠ¨ï¼‰
  - æ˜“ç”¨æ€§å·®ï¼ˆéœ€è¦å¤§é‡æ‰‹åŠ¨æ“ä½œï¼‰
  - ç»´æŠ¤æˆæœ¬é«˜ï¼ˆéœ€è¦å¤§é‡æ‰‹åŠ¨ç»´æŠ¤ï¼‰
- **é€‚ç”¨åœºæ™¯**ï¼šç‰¹æ®Šéœ€æ±‚åœºæ™¯
- **æ€§èƒ½æ•°æ®**ï¼šçµæ´»æ€§ä¼˜ç§€ï¼Œè‡ªåŠ¨åŒ–ç¨‹åº¦å·®ï¼Œæ˜“ç”¨æ€§å·®ï¼Œç»´æŠ¤æˆæœ¬é«˜
- **æˆæœ¬åˆ†æ**ï¼šå¼€å‘æˆæœ¬ä½ï¼Œç»´æŠ¤æˆæœ¬é«˜ï¼Œé£é™©é«˜

**å¯¹æ¯”åˆ†æ**ï¼š

| æ–¹æ¡ˆ | è‡ªåŠ¨åŒ–ç¨‹åº¦ | æ€§èƒ½ | æ˜“ç”¨æ€§ | çµæ´»æ€§ | ç»´æŠ¤æˆæœ¬ | ç»¼åˆè¯„åˆ† |
|------|-----------|------|--------|--------|---------|---------|
| è‡ªåŠ¨åŒ–ç®¡ç† | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | 4.6/5 |
| åŠè‡ªåŠ¨ç®¡ç† | â­â­â­â­ | â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | 4.2/5 |
| æ‰‹åŠ¨ç®¡ç† | â­â­ | â­â­â­ | â­â­ | â­â­â­â­â­ | â­â­ | 2.8/5 |

**å†³ç­–ä¾æ®**ï¼š

**å†³ç­–æ ‡å‡†**ï¼š

- è‡ªåŠ¨åŒ–ç¨‹åº¦ï¼šæƒé‡30%
- æ˜“ç”¨æ€§ï¼šæƒé‡25%
- ç»´æŠ¤æˆæœ¬ï¼šæƒé‡25%
- çµæ´»æ€§ï¼šæƒé‡15%
- æ€§èƒ½ï¼šæƒé‡5%

**è¯„åˆ†è®¡ç®—**ï¼š

- è‡ªåŠ¨åŒ–ç®¡ç†ï¼š5.0 Ã— 0.3 + 5.0 Ã— 0.25 + 5.0 Ã— 0.25 + 4.0 Ã— 0.15 + 4.0 Ã— 0.05 = 4.6
- åŠè‡ªåŠ¨ç®¡ç†ï¼š4.0 Ã— 0.3 + 4.0 Ã— 0.25 + 4.0 Ã— 0.25 + 5.0 Ã— 0.15 + 4.0 Ã— 0.05 = 4.2
- æ‰‹åŠ¨ç®¡ç†ï¼š2.0 Ã— 0.3 + 2.0 Ã— 0.25 + 2.0 Ã— 0.25 + 5.0 Ã— 0.15 + 3.0 Ã— 0.05 = 2.8

**ç»“è®ºä¸å»ºè®®**ï¼š

**æ¨èæ–¹æ¡ˆ**ï¼šè‡ªåŠ¨åŒ–ç®¡ç†

**æ¨èç†ç”±**ï¼š

1. è‡ªåŠ¨åŒ–ç¨‹åº¦ä¼˜ç§€ï¼Œæ»¡è¶³è‡ªåŠ¨åŒ–ç®¡ç†çš„è¦æ±‚
2. æ˜“ç”¨æ€§ä¼˜ç§€ï¼Œæ»¡è¶³æ˜“ç”¨æ€§è¦æ±‚
3. ç»´æŠ¤æˆæœ¬ä½ï¼Œæ»¡è¶³ç»´æŠ¤æˆæœ¬ < 10% æ€»æˆæœ¬çš„è¦æ±‚
4. é€‚åˆæ—¶é—´åºåˆ—æ•°æ®ï¼ŒåŒ¹é…åº”ç”¨ç‰¹å¾

**å®æ–½å»ºè®®**ï¼š

1. ä½¿ç”¨pg_partmanè¿›è¡Œè‡ªåŠ¨åŒ–åˆ†åŒºç®¡ç†
2. é…ç½®è‡ªåŠ¨åˆ›å»ºå’Œåˆ é™¤åˆ†åŒºç­–ç•¥
3. è®¾ç½®åˆç†çš„åˆ†åŒºä¿ç•™æœŸ
4. å®šæœŸç›‘æ§åˆ†åŒºå¤§å°å’Œæ€§èƒ½
5. æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´è‡ªåŠ¨åŒ–ç­–ç•¥

---

## 2. åˆ†åŒºæ“ä½œæ”¹è¿›

### 2.1 åˆ†åŒºæ·»åŠ ä¼˜åŒ–

```sql
-- åˆ›å»ºåˆ†åŒºè¡¨
CREATE TABLE orders (
    id SERIAL,
    order_date DATE,
    amount DECIMAL(10,2)
) PARTITION BY RANGE (order_date);

-- å¿«é€Ÿæ·»åŠ åˆ†åŒº
CREATE TABLE orders_2025_01 PARTITION OF orders
FOR VALUES FROM ('2025-01-01') TO ('2025-02-01');

-- æ‰¹é‡æ·»åŠ åˆ†åŒº
DO $$
DECLARE
    month_date DATE;
BEGIN
    FOR i IN 1..12 LOOP
        month_date := DATE '2025-01-01' + (i-1) * INTERVAL '1 month';
        EXECUTE format(
            'CREATE TABLE orders_%s PARTITION OF orders
             FOR VALUES FROM (%L) TO (%L)',
            to_char(month_date, 'YYYY_MM'),
            month_date,
            month_date + INTERVAL '1 month'
        );
    END LOOP;
END $$;
```

### 2.2 åˆ†åŒºåˆ é™¤ä¼˜åŒ–

```sql
-- åˆ é™¤åˆ†åŒºï¼ˆå¿«é€Ÿï¼‰
DROP TABLE orders_2024_01;

-- åˆ é™¤åˆ†åŒºå¹¶ä¿ç•™æ•°æ®
ALTER TABLE orders DETACH PARTITION orders_2024_01;

-- æ‰¹é‡åˆ é™¤æ—§åˆ†åŒº
DO $$
DECLARE
    partition_name TEXT;
BEGIN
    FOR partition_name IN
        SELECT tablename
        FROM pg_tables
        WHERE schemaname = 'public'
        AND tablename LIKE 'orders_2024%'
    LOOP
        EXECUTE format('DROP TABLE %I', partition_name);
    END LOOP;
END $$;
```

### 2.3 åˆ†åŒºåˆå¹¶ä¼˜åŒ–

```sql
-- åˆå¹¶åˆ†åŒºï¼ˆPostgreSQL 17 ä¼˜åŒ–ï¼‰
-- å°†ä¸¤ä¸ªç›¸é‚»åˆ†åŒºåˆå¹¶ä¸ºä¸€ä¸ª
ALTER TABLE orders
MERGE PARTITIONS orders_2025_01, orders_2025_02
INTO orders_2025_q1;
```

### 2.4 åˆ†åŒºæ‹†åˆ†ä¼˜åŒ–

```sql
-- æ‹†åˆ†åˆ†åŒº
ALTER TABLE orders
SPLIT PARTITION orders_2025_q1
AT ('2025-02-01')
INTO (
    PARTITION orders_2025_01,
    PARTITION orders_2025_02
);
```

---

## 3. ç®¡ç†å·¥å…·å¢å¼º

### 3.1 åˆ†åŒºä¿¡æ¯æŸ¥è¯¢

```sql
-- æŸ¥çœ‹åˆ†åŒºè¡¨ä¿¡æ¯
SELECT
    schemaname,
    tablename,
    partitiontype,
    partitionkey
FROM pg_partitioned_tables
WHERE schemaname = 'public';

-- æŸ¥çœ‹æ‰€æœ‰åˆ†åŒº
SELECT
    schemaname,
    tablename,
    partitionbounddef
FROM pg_partitions
WHERE parenttablename = 'orders'
ORDER BY tablename;
```

### 3.2 åˆ†åŒºç»Ÿè®¡ä¿¡æ¯

```sql
-- æŸ¥çœ‹åˆ†åŒºç»Ÿè®¡ä¿¡æ¯
SELECT
    schemaname,
    tablename,
    n_live_tup,
    n_dead_tup,
    last_vacuum,
    last_autovacuum,
    last_analyze,
    last_autoanalyze
FROM pg_stat_user_tables
WHERE tablename LIKE 'orders_%'
ORDER BY tablename;

-- æŸ¥çœ‹åˆ†åŒºå¤§å°
SELECT
    schemaname,
    tablename,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS size
FROM pg_tables
WHERE schemaname = 'public'
AND tablename LIKE 'orders_%'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;
```

### 3.3 åˆ†åŒºç»´æŠ¤å·¥å…·

```sql
-- æ£€æŸ¥åˆ†åŒºå®Œæ•´æ€§
SELECT
    tablename,
    pg_size_pretty(pg_total_relation_size('public.'||tablename)) AS size,
    n_live_tup,
    n_dead_tup
FROM pg_stat_user_tables
WHERE tablename LIKE 'orders_%'
ORDER BY tablename;

-- åˆ†ææ‰€æœ‰åˆ†åŒº
DO $$
DECLARE
    partition_name TEXT;
BEGIN
    FOR partition_name IN
        SELECT tablename
        FROM pg_tables
        WHERE schemaname = 'public'
        AND tablename LIKE 'orders_%'
    LOOP
        EXECUTE format('ANALYZE %I', partition_name);
    END LOOP;
END $$;
```

---

## 4. è‡ªåŠ¨åŒ–åˆ†åŒºç®¡ç†

### 4.1 è‡ªåŠ¨åˆ†åŒºåˆ›å»º

```sql
-- ä½¿ç”¨ pg_partman è‡ªåŠ¨åˆ›å»ºåˆ†åŒº
-- å®‰è£… pg_partman
CREATE EXTENSION IF NOT EXISTS pg_partman;

-- é…ç½®è‡ªåŠ¨åˆ†åŒº
SELECT partman.create_parent(
    p_parent_table => 'public.orders',
    p_control => 'order_date',
    p_type => 'range',
    p_interval => 'monthly',
    p_premake => 3
);

-- è‡ªåŠ¨åˆ›å»ºæœªæ¥ 3 ä¸ªæœˆçš„åˆ†åŒº
SELECT partman.run_maintenance('public.orders');
```

### 4.2 è‡ªåŠ¨åˆ†åŒºåˆ é™¤

```sql
-- é…ç½®è‡ªåŠ¨åˆ é™¤æ—§åˆ†åŒº
SELECT partman.set_config(
    p_parent_table => 'public.orders',
    p_retention => '12 months',
    p_retention_keep_table => false
);

-- æ‰§è¡Œç»´æŠ¤ä»»åŠ¡ï¼ˆåˆ é™¤è¶…è¿‡ 12 ä¸ªæœˆçš„åˆ†åŒºï¼‰
SELECT partman.run_maintenance('public.orders');
```

### 4.3 åˆ†åŒºç­–ç•¥é…ç½®

```sql
-- é…ç½®åˆ†åŒºç­–ç•¥
SELECT partman.set_config(
    p_parent_table => 'public.orders',
    p_control => 'order_date',
    p_type => 'range',
    p_interval => 'monthly',
    p_premake => 3,
    p_retention => '12 months',
    p_retention_keep_table => false,
    p_automatic_maintenance => true
);

-- å¯ç”¨è‡ªåŠ¨ç»´æŠ¤
SELECT cron.schedule(
    'partition-maintenance',
    '0 2 * * *',  -- æ¯å¤©å‡Œæ™¨ 2 ç‚¹
    $$SELECT partman.run_maintenance('public.orders')$$
);
```

---

## 5. æœ€ä½³å®è·µ

### 5.1 åˆ†åŒºè®¾è®¡å»ºè®®

**æ¨èåšæ³•**ï¼š

1. **æŒ‰æ—¶é—´èŒƒå›´åˆ†åŒº**ï¼ˆæ—¶é—´åºåˆ—æ•°æ®ï¼‰

   ```sql
   -- âœ… å¥½ï¼šæŒ‰æ—¶é—´èŒƒå›´åˆ†åŒºï¼ˆæ—¶é—´åºåˆ—æ•°æ®ï¼‰
   CREATE TABLE orders (
       id SERIAL,
       order_date DATE NOT NULL,
       amount DECIMAL(10,2)
   ) PARTITION BY RANGE (order_date);

   -- åˆ›å»ºåˆ†åŒº
   CREATE TABLE orders_2025_01 PARTITION OF orders
   FOR VALUES FROM ('2025-01-01') TO ('2025-02-01');

   -- âŒ ä¸å¥½ï¼šä¸ä½¿ç”¨åˆ†åŒºï¼ˆæ€§èƒ½å·®ï¼‰
   CREATE TABLE orders (
       id SERIAL,
       order_date DATE NOT NULL,
       amount DECIMAL(10,2)
   );
   -- é—®é¢˜ï¼šæ‰€æœ‰æ•°æ®åœ¨ä¸€ä¸ªè¡¨ä¸­ï¼ŒæŸ¥è¯¢æ€§èƒ½å·®
   ```

2. **æŒ‰åˆ—è¡¨åˆ†åŒº**ï¼ˆå¤šç§Ÿæˆ·åœºæ™¯ï¼‰

   ```sql
   -- âœ… å¥½ï¼šæŒ‰åˆ—è¡¨åˆ†åŒºï¼ˆå¤šç§Ÿæˆ·åœºæ™¯ï¼‰
   CREATE TABLE tenant_data (
       id SERIAL,
       tenant_id INT NOT NULL,
       data TEXT
   ) PARTITION BY LIST (tenant_id);

   -- ä¸ºæ¯ä¸ªç§Ÿæˆ·åˆ›å»ºåˆ†åŒº
   CREATE TABLE tenant_data_1 PARTITION OF tenant_data
   FOR VALUES IN (1);

   -- âŒ ä¸å¥½ï¼šä¸ä½¿ç”¨åˆ†åŒºï¼ˆæ•°æ®éš”ç¦»å·®ï¼‰
   CREATE TABLE tenant_data (
       id SERIAL,
       tenant_id INT NOT NULL,
       data TEXT
   );
   -- é—®é¢˜ï¼šæ‰€æœ‰ç§Ÿæˆ·æ•°æ®æ··åœ¨ä¸€èµ·ï¼Œæ•°æ®éš”ç¦»å·®
   ```

**é¿å…åšæ³•**ï¼š

1. **é¿å…ä¸ä½¿ç”¨åˆ†åŒº**ï¼ˆæ€§èƒ½å·®ï¼‰
2. **é¿å…åˆ†åŒºé”®é€‰æ‹©ä¸å½“**ï¼ˆåˆ†åŒºæ•ˆæœå·®ï¼‰

### 5.2 ç®¡ç†å»ºè®®

**æ¨èåšæ³•**ï¼š

1. **å®šæœŸç»´æŠ¤åˆ†åŒºç»Ÿè®¡ä¿¡æ¯**ï¼ˆå¯ç»´æŠ¤æ€§ï¼‰

   ```sql
   -- âœ… å¥½ï¼šå®šæœŸç»´æŠ¤åˆ†åŒºç»Ÿè®¡ä¿¡æ¯ï¼ˆå¯ç»´æŠ¤æ€§ï¼‰
   ANALYZE orders;

   -- æŸ¥çœ‹åˆ†åŒºç»Ÿè®¡ä¿¡æ¯
   SELECT
       schemaname,
       tablename,
       n_live_tup,
       n_dead_tup,
       last_analyze
   FROM pg_stat_user_tables
   WHERE tablename LIKE 'orders_%';

   -- âŒ ä¸å¥½ï¼šä¸ç»´æŠ¤ç»Ÿè®¡ä¿¡æ¯ï¼ˆå¯ç»´æŠ¤æ€§å·®ï¼‰
   -- æ²¡æœ‰å®šæœŸç»´æŠ¤ï¼Œç»Ÿè®¡ä¿¡æ¯è¿‡æ—¶ï¼Œå½±å“æŸ¥è¯¢æ€§èƒ½
   ```

2. **ä½¿ç”¨è‡ªåŠ¨åŒ–åˆ†åŒºç®¡ç†**ï¼ˆå¯ç»´æŠ¤æ€§ï¼‰

   ```sql
   -- âœ… å¥½ï¼šä½¿ç”¨è‡ªåŠ¨åŒ–åˆ†åŒºç®¡ç†ï¼ˆå¯ç»´æŠ¤æ€§ï¼‰
   SELECT partman.create_parent(
       p_parent_table => 'public.orders',
       p_control => 'order_date',
       p_type => 'range',
       p_interval => 'monthly',
       p_premake => 3
   );

   -- é…ç½®è‡ªåŠ¨ç»´æŠ¤
   SELECT cron.schedule(
       'orders-partition-maintenance',
       '0 2 * * *',
       $$SELECT partman.run_maintenance('public.orders')$$
   );

   -- âŒ ä¸å¥½ï¼šæ‰‹åŠ¨ç®¡ç†åˆ†åŒºï¼ˆå¯ç»´æŠ¤æ€§å·®ï¼‰
   -- æ‰‹åŠ¨åˆ›å»ºå’Œåˆ é™¤åˆ†åŒºï¼Œå®¹æ˜“å‡ºé”™ï¼Œç»´æŠ¤æˆæœ¬é«˜
   ```

3. **ç›‘æ§åˆ†åŒºå¤§å°**ï¼ˆå¯ç»´æŠ¤æ€§ï¼‰

   ```sql
   -- âœ… å¥½ï¼šç›‘æ§åˆ†åŒºå¤§å°ï¼ˆå¯ç»´æŠ¤æ€§ï¼‰
   SELECT
       tablename,
       pg_size_pretty(pg_total_relation_size('public.'||tablename)) AS size
   FROM pg_tables
   WHERE tablename LIKE 'orders_%'
   ORDER BY pg_total_relation_size('public.'||tablename) DESC;

   -- âŒ ä¸å¥½ï¼šä¸ç›‘æ§åˆ†åŒºå¤§å°ï¼ˆå¯ç»´æŠ¤æ€§å·®ï¼‰
   -- æ²¡æœ‰ç›‘æ§ï¼Œæ— æ³•åŠæ—¶å‘ç°åˆ†åŒºå¤§å°é—®é¢˜
   ```

**é¿å…åšæ³•**ï¼š

1. **é¿å…ä¸ç»´æŠ¤ç»Ÿè®¡ä¿¡æ¯**ï¼ˆå¯ç»´æŠ¤æ€§å·®ï¼‰
2. **é¿å…æ‰‹åŠ¨ç®¡ç†åˆ†åŒº**ï¼ˆå¯ç»´æŠ¤æ€§å·®ï¼‰
3. **é¿å…ä¸ç›‘æ§åˆ†åŒºå¤§å°**ï¼ˆå¯ç»´æŠ¤æ€§å·®ï¼‰

### 5.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®

**æ¨èåšæ³•**ï¼š

1. **ä¸ºåˆ†åŒºåˆ›å»ºç´¢å¼•**ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰

   ```sql
   -- âœ… å¥½ï¼šä¸ºåˆ†åŒºåˆ›å»ºç´¢å¼•ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
   CREATE INDEX idx_orders_date ON orders(order_date);

   -- åˆ†åŒºçº§åˆ«çš„ç´¢å¼•ä¼šè‡ªåŠ¨åˆ›å»º
   -- ä¸ºæ¯ä¸ªåˆ†åŒºåˆ›å»ºæœ¬åœ°ç´¢å¼•
   CREATE INDEX idx_orders_2025_01_date
   ON orders_2025_01(order_date);

   -- âŒ ä¸å¥½ï¼šä¸ä¸ºåˆ†åŒºåˆ›å»ºç´¢å¼•ï¼ˆæ€§èƒ½å·®ï¼‰
   -- æ²¡æœ‰ç´¢å¼•ï¼ŒæŸ¥è¯¢æ€§èƒ½å·®
   ```

2. **ä¼˜åŒ–åˆ†åŒºé”®é€‰æ‹©**ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰

   ```sql
   -- âœ… å¥½ï¼šé€‰æ‹©åˆé€‚çš„åˆ†åŒºé”®ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
   CREATE TABLE orders (
       id SERIAL,
       order_date DATE NOT NULL,  -- åˆ†åŒºé”®ï¼šé«˜é€‰æ‹©æ€§
       amount DECIMAL(10,2)
   ) PARTITION BY RANGE (order_date);

   -- âŒ ä¸å¥½ï¼šé€‰æ‹©ä¸åˆé€‚çš„åˆ†åŒºé”®ï¼ˆæ€§èƒ½å·®ï¼‰
   CREATE TABLE orders (
       id SERIAL,
       order_date DATE NOT NULL,
       status VARCHAR(10) NOT NULL,  -- åˆ†åŒºé”®ï¼šä½é€‰æ‹©æ€§
       amount DECIMAL(10,2)
   ) PARTITION BY LIST (status);
   -- é—®é¢˜ï¼šstatus åªæœ‰å‡ ä¸ªå€¼ï¼Œåˆ†åŒºæ•ˆæœå·®
   ```

**é¿å…åšæ³•**ï¼š

1. **é¿å…ä¸ä¸ºåˆ†åŒºåˆ›å»ºç´¢å¼•**ï¼ˆæ€§èƒ½å·®ï¼‰
2. **é¿å…é€‰æ‹©ä¸åˆé€‚çš„åˆ†åŒºé”®**ï¼ˆæ€§èƒ½å·®ï¼‰

---

## 6. å®é™…æ¡ˆä¾‹

### 6.1 æ¡ˆä¾‹ï¼šæ—¶é—´åºåˆ—æ•°æ®åˆ†åŒºç®¡ç†ï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰

**ä¸šåŠ¡åœºæ™¯**:

æŸè®¢å•ç³»ç»Ÿéœ€è¦ç®¡ç†æ—¶é—´åºåˆ—æ•°æ®ï¼Œéœ€è¦å®šæœŸåˆ›å»ºå’Œåˆ é™¤åˆ†åŒºï¼Œéœ€è¦é€‰æ‹©åˆé€‚åˆ†åŒºç®¡ç†ç­–ç•¥ã€‚

**é—®é¢˜åˆ†æ**:

1. **åº”ç”¨ç‰¹å¾**: æ—¶é—´åºåˆ—æ•°æ®ï¼Œéœ€è¦å®šæœŸåˆ›å»ºå’Œåˆ é™¤åˆ†åŒº
2. **è‡ªåŠ¨åŒ–è¦æ±‚**: éœ€è¦è‡ªåŠ¨åŒ–ç®¡ç†ï¼Œå‡å°‘äººå·¥å¹²é¢„
3. **æ€§èƒ½è¦æ±‚**: åˆ†åŒºæ“ä½œæ€§èƒ½ > 1000 TPS
4. **ç»´æŠ¤æˆæœ¬è¦æ±‚**: ç»´æŠ¤æˆæœ¬ < 10% æ€»æˆæœ¬

**åˆ†åŒºç®¡ç†ç­–ç•¥é€‰æ‹©å†³ç­–è®ºè¯**:

**é—®é¢˜**: å¦‚ä½•ä¸ºæ—¶é—´åºåˆ—æ•°æ®åˆ†åŒºè¡¨é€‰æ‹©æœ€ä¼˜çš„ç®¡ç†ç­–ç•¥ï¼Ÿ

**æ–¹æ¡ˆåˆ†æ**:

**æ–¹æ¡ˆ1ï¼šè‡ªåŠ¨åŒ–ç®¡ç†**:

- **æè¿°**: ä½¿ç”¨pg_partmanç­‰å·¥å…·è¿›è¡Œè‡ªåŠ¨åŒ–åˆ†åŒºç®¡ç†
- **ä¼˜ç‚¹**: è‡ªåŠ¨åŒ–ç¨‹åº¦ä¼˜ç§€ï¼ˆå®Œå…¨è‡ªåŠ¨åŒ–ï¼‰ï¼Œæ˜“ç”¨æ€§ä¼˜ç§€ï¼ˆé…ç½®ç®€å•ï¼‰ï¼Œç»´æŠ¤æˆæœ¬ä½ï¼ˆè‡ªåŠ¨åŒ–ç»´æŠ¤ï¼‰ï¼Œé€‚åˆæ—¶é—´åºåˆ—æ•°æ®
- **ç¼ºç‚¹**: çµæ´»æ€§ä¸­ç­‰ï¼ˆéœ€è¦éµå¾ªå·¥å…·è§„åˆ™ï¼‰
- **é€‚ç”¨åœºæ™¯**: æ—¶é—´åºåˆ—æ•°æ®
- **æ€§èƒ½æ•°æ®**: è‡ªåŠ¨åŒ–ç¨‹åº¦ä¼˜ç§€ï¼Œæ˜“ç”¨æ€§ä¼˜ç§€ï¼Œç»´æŠ¤æˆæœ¬ä½
- **æˆæœ¬åˆ†æ**: å¼€å‘æˆæœ¬ä½ï¼Œç»´æŠ¤æˆæœ¬ä½ï¼Œé£é™©ä½

**æ–¹æ¡ˆ2ï¼šæ‰‹åŠ¨ç®¡ç†**:

- **æè¿°**: å®Œå…¨æ‰‹åŠ¨ç®¡ç†åˆ†åŒº
- **ä¼˜ç‚¹**: çµæ´»æ€§ä¼˜ç§€ï¼ˆå®Œå…¨è‡ªå®šä¹‰ï¼‰ï¼Œé€‚åˆç‰¹æ®Šéœ€æ±‚åœºæ™¯
- **ç¼ºç‚¹**: è‡ªåŠ¨åŒ–ç¨‹åº¦å·®ï¼ˆå®Œå…¨æ‰‹åŠ¨ï¼‰ï¼Œæ˜“ç”¨æ€§å·®ï¼ˆéœ€è¦å¤§é‡æ‰‹åŠ¨æ“ä½œï¼‰ï¼Œç»´æŠ¤æˆæœ¬é«˜ï¼ˆéœ€è¦å¤§é‡æ‰‹åŠ¨ç»´æŠ¤ï¼‰
- **é€‚ç”¨åœºæ™¯**: ç‰¹æ®Šéœ€æ±‚åœºæ™¯
- **æ€§èƒ½æ•°æ®**: çµæ´»æ€§ä¼˜ç§€ï¼Œè‡ªåŠ¨åŒ–ç¨‹åº¦å·®ï¼Œæ˜“ç”¨æ€§å·®ï¼Œç»´æŠ¤æˆæœ¬é«˜
- **æˆæœ¬åˆ†æ**: å¼€å‘æˆæœ¬ä½ï¼Œç»´æŠ¤æˆæœ¬é«˜ï¼Œé£é™©é«˜

**å¯¹æ¯”åˆ†æ**:

| æ–¹æ¡ˆ | è‡ªåŠ¨åŒ–ç¨‹åº¦ | æ€§èƒ½ | æ˜“ç”¨æ€§ | çµæ´»æ€§ | ç»´æŠ¤æˆæœ¬ | ç»¼åˆè¯„åˆ† |
|------|-----------|------|--------|--------|---------|---------|
| è‡ªåŠ¨åŒ–ç®¡ç† | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | 4.6/5 |
| æ‰‹åŠ¨ç®¡ç† | â­â­ | â­â­â­ | â­â­ | â­â­â­â­â­ | â­â­ | 2.8/5 |

**å†³ç­–ä¾æ®**:

**å†³ç­–æ ‡å‡†**:

- è‡ªåŠ¨åŒ–ç¨‹åº¦ï¼šæƒé‡30%
- æ˜“ç”¨æ€§ï¼šæƒé‡25%
- ç»´æŠ¤æˆæœ¬ï¼šæƒé‡25%
- çµæ´»æ€§ï¼šæƒé‡15%
- æ€§èƒ½ï¼šæƒé‡5%

**è¯„åˆ†è®¡ç®—**:

- è‡ªåŠ¨åŒ–ç®¡ç†ï¼š5.0 Ã— 0.3 + 5.0 Ã— 0.25 + 5.0 Ã— 0.25 + 4.0 Ã— 0.15 + 4.0 Ã— 0.05 = 4.6
- æ‰‹åŠ¨ç®¡ç†ï¼š2.0 Ã— 0.3 + 2.0 Ã— 0.25 + 2.0 Ã— 0.25 + 5.0 Ã— 0.15 + 3.0 Ã— 0.05 = 2.8

**ç»“è®ºä¸å»ºè®®**:

**æ¨èæ–¹æ¡ˆ**: è‡ªåŠ¨åŒ–ç®¡ç†

**æ¨èç†ç”±**:

1. è‡ªåŠ¨åŒ–ç¨‹åº¦ä¼˜ç§€ï¼Œæ»¡è¶³è‡ªåŠ¨åŒ–ç®¡ç†çš„è¦æ±‚
2. æ˜“ç”¨æ€§ä¼˜ç§€ï¼Œæ»¡è¶³æ˜“ç”¨æ€§è¦æ±‚
3. ç»´æŠ¤æˆæœ¬ä½ï¼Œæ»¡è¶³ç»´æŠ¤æˆæœ¬ < 10% æ€»æˆæœ¬çš„è¦æ±‚
4. é€‚åˆæ—¶é—´åºåˆ—æ•°æ®ï¼ŒåŒ¹é…åº”ç”¨ç‰¹å¾

**å®ç°**ï¼š

```sql
-- 1. åˆ›å»ºåˆ†åŒºè¡¨
CREATE TABLE orders (
    id SERIAL,
    order_date DATE NOT NULL,
    customer_id INT,
    amount DECIMAL(10,2)
) PARTITION BY RANGE (order_date);

-- 2. é…ç½®è‡ªåŠ¨åˆ†åŒº
SELECT partman.create_parent(
    p_parent_table => 'public.orders',
    p_control => 'order_date',
    p_type => 'range',
    p_interval => 'monthly',
    p_premake => 3
);

-- 3. é…ç½®è‡ªåŠ¨ç»´æŠ¤
SELECT cron.schedule(
    'orders-partition-maintenance',
    '0 2 * * *',
    $$SELECT partman.run_maintenance('public.orders')$$
);
```

**æ•ˆæœ**ï¼š

- è‡ªåŠ¨åˆ›å»ºæœªæ¥ 3 ä¸ªæœˆçš„åˆ†åŒº
- è‡ªåŠ¨åˆ é™¤è¶…è¿‡ 12 ä¸ªæœˆçš„åˆ†åŒº
- åˆ†åŒºæ“ä½œæ—¶é—´ï¼šä» 5 åˆ†é’Ÿé™è‡³ 30 ç§’
- æŸ¥è¯¢æ€§èƒ½æå‡ 50%

### 6.2 æ¡ˆä¾‹ï¼šå¤šç§Ÿæˆ·æ•°æ®åˆ†åŒºç®¡ç†

**åœºæ™¯**ï¼šå¤šç§Ÿæˆ· SaaS ç³»ç»Ÿçš„æ•°æ®åˆ†åŒºç®¡ç†

**å®ç°**ï¼š

```sql
-- 1. åˆ›å»ºåˆ†åŒºè¡¨
CREATE TABLE tenant_orders (
    id SERIAL,
    tenant_id INT NOT NULL,
    order_date DATE,
    amount DECIMAL(10,2)
) PARTITION BY LIST (tenant_id);

-- 2. ä¸ºæ¯ä¸ªç§Ÿæˆ·åˆ›å»ºåˆ†åŒº
CREATE TABLE tenant_orders_1 PARTITION OF tenant_orders
FOR VALUES IN (1);

CREATE TABLE tenant_orders_2 PARTITION OF tenant_orders
FOR VALUES IN (2);

-- 3. åŠ¨æ€æ·»åŠ ç§Ÿæˆ·åˆ†åŒº
CREATE OR REPLACE FUNCTION add_tenant_partition(tenant_id INT)
RETURNS VOID AS $$
BEGIN
    EXECUTE format(
        'CREATE TABLE tenant_orders_%s PARTITION OF tenant_orders
         FOR VALUES IN (%s)',
        tenant_id,
        tenant_id
    );
END;
$$ LANGUAGE plpgsql;
```

**æ•ˆæœ**ï¼š

- ç§Ÿæˆ·æ•°æ®éš”ç¦»
- æŸ¥è¯¢æ€§èƒ½æå‡ 60%
- ç®¡ç†æ•ˆç‡æå‡ 80%

---

## ğŸ“Š æ€»ç»“

PostgreSQL 17 çš„åˆ†åŒºç®¡ç†å¢å¼ºæä¾›äº†æ›´å¼ºå¤§å’Œä¾¿æ·çš„åˆ†åŒºç®¡ç†èƒ½åŠ›ï¼š

1. **åˆ†åŒºæ“ä½œæ”¹è¿›**ï¼šæ›´å¿«é€Ÿçš„åˆ†åŒºæ“ä½œ
2. **ç®¡ç†å·¥å…·å¢å¼º**ï¼šæ›´å¼ºå¤§çš„ç®¡ç†å·¥å…·
3. **è‡ªåŠ¨åŒ–ç®¡ç†**ï¼šæ”¯æŒè‡ªåŠ¨åŒ–åˆ†åŒºç®¡ç†
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šåˆ†åŒºæ“ä½œæ€§èƒ½æå‡
5. **æ˜“ç”¨æ€§æå‡**ï¼šç®€åŒ–åˆ†åŒºç®¡ç†æµç¨‹

**æœ€ä½³å®è·µ**ï¼š

- ä½¿ç”¨ pg_partman è¿›è¡Œè‡ªåŠ¨åˆ†åŒºç®¡ç†
- å®šæœŸç»´æŠ¤åˆ†åŒºç»Ÿè®¡ä¿¡æ¯
- ç›‘æ§åˆ†åŒºå¤§å°å’Œæ€§èƒ½
- é…ç½®è‡ªåŠ¨åˆ†åŒºåˆ›å»ºå’Œåˆ é™¤
- ä¼˜åŒ–åˆ†åŒºç´¢å¼•ç­–ç•¥

---

## 8. å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰

### 8.1 åˆ†åŒºç®¡ç†åŸºç¡€å¸¸è§é—®é¢˜

#### Q1: PostgreSQL 17çš„åˆ†åŒºç®¡ç†æœ‰å“ªäº›æ”¹è¿›ï¼Ÿ

**é—®é¢˜æè¿°**ï¼šä¸ç¡®å®šPostgreSQL 17çš„åˆ†åŒºç®¡ç†æœ‰å“ªäº›å…·ä½“æ”¹è¿›ã€‚

**ä¸»è¦æ”¹è¿›**ï¼š

1. **åˆ†åŒºæ“ä½œä¼˜åŒ–**ï¼š
   - æ›´å¿«çš„åˆ†åŒºæ·»åŠ /åˆ é™¤
   - æ”¹è¿›çš„åˆ†åŒºåˆ†ç¦»æ“ä½œ
   - æ€§èƒ½æå‡ï¼š20-30%

2. **åˆ†åŒºç»´æŠ¤å¢å¼º**ï¼š
   - è‡ªåŠ¨åˆ†åŒºç®¡ç†
   - æ”¹è¿›çš„åˆ†åŒºç›‘æ§
   - æ˜“ç”¨æ€§æå‡

3. **åˆ†åŒºæ€§èƒ½ä¼˜åŒ–**ï¼š
   - åˆ†åŒºè£å‰ªæ”¹è¿›
   - åˆ†åŒºæ‰«æä¼˜åŒ–
   - æ€§èƒ½æå‡ï¼š15-25%

**éªŒè¯æ–¹æ³•**ï¼š

```sql
-- å¯¹æ¯”PostgreSQL 16å’Œ17çš„åˆ†åŒºæ“ä½œæ€§èƒ½
ALTER TABLE orders ADD PARTITION ...;
-- PostgreSQL 17åˆ†åŒºæ“ä½œæ›´å¿«
```

#### Q2: å¦‚ä½•æ·»åŠ æ–°åˆ†åŒºï¼Ÿ

**é—®é¢˜æè¿°**ï¼šéœ€è¦æ·»åŠ æ–°åˆ†åŒºï¼Œä½†ä¸ç¡®å®šå¦‚ä½•æ“ä½œã€‚

**æ·»åŠ æ–¹æ³•**ï¼š

1. **æ·»åŠ èŒƒå›´åˆ†åŒº**ï¼š

    ```sql
    -- âœ… å¥½ï¼šæ·»åŠ èŒƒå›´åˆ†åŒº
    ALTER TABLE orders ADD PARTITION orders_2024_02
    FOR VALUES FROM ('2024-02-01') TO ('2024-03-01');
    -- å¿«é€Ÿæ·»åŠ æ–°åˆ†åŒº
    ```

2. **æ·»åŠ åˆ—è¡¨åˆ†åŒº**ï¼š

    ```sql
    -- âœ… å¥½ï¼šæ·»åŠ åˆ—è¡¨åˆ†åŒº
    ALTER TABLE users ADD PARTITION users_south
    FOR VALUES IN ('guangdong', 'guangxi', 'hainan');
    -- æ·»åŠ æ–°çš„åœ°åŒºåˆ†åŒº
    ```

3. **æ‰¹é‡æ·»åŠ åˆ†åŒº**ï¼š

    ```sql
    -- âœ… å¥½ï¼šæ‰¹é‡æ·»åŠ åˆ†åŒºï¼ˆPostgreSQL 17+ï¼‰
    DO $$
    DECLARE
        month_date DATE;
    BEGIN
        FOR i IN 1..12 LOOP
            month_date := DATE '2024-01-01' + (i-1) * INTERVAL '1 month';
            EXECUTE format(
                'ALTER TABLE orders ADD PARTITION orders_%s FOR VALUES FROM (%L) TO (%L)',
                to_char(month_date, 'YYYY_MM'),
                month_date,
                month_date + INTERVAL '1 month'
            );
        END LOOP;
    END $$;
    ```

**æœ€ä½³å®è·µ**ï¼š

- **æå‰åˆ›å»º**ï¼šæå‰åˆ›å»ºæœªæ¥åˆ†åŒº
- **è‡ªåŠ¨åŒ–**ï¼šä½¿ç”¨è„šæœ¬è‡ªåŠ¨åˆ›å»ºåˆ†åŒº
- **ç›‘æ§**ï¼šç›‘æ§åˆ†åŒºåˆ›å»ºè¿‡ç¨‹

#### Q3: å¦‚ä½•åˆ é™¤åˆ†åŒºï¼Ÿ

**é—®é¢˜æè¿°**ï¼šéœ€è¦åˆ é™¤æ—§åˆ†åŒºï¼Œé‡Šæ”¾å­˜å‚¨ç©ºé—´ã€‚

**åˆ é™¤æ–¹æ³•**ï¼š

1. **ç›´æ¥åˆ é™¤åˆ†åŒº**ï¼š

    ```sql
    -- âœ… å¥½ï¼šç›´æ¥åˆ é™¤åˆ†åŒº
    DROP TABLE orders_2023_01;
    -- å¿«é€Ÿåˆ é™¤ï¼Œé‡Šæ”¾å­˜å‚¨ç©ºé—´
    ```

2. **åˆ†ç¦»ååˆ é™¤**ï¼š

    ```sql
    -- âœ… å¥½ï¼šåˆ†ç¦»ååˆ é™¤ï¼ˆPostgreSQL 17+ï¼‰
    ALTER TABLE orders DETACH PARTITION orders_2023_01;
    -- åˆ†ç¦»åˆ†åŒº
    DROP TABLE orders_2023_01;
    -- åˆ é™¤åˆ†åŒº
    ```

3. **å½’æ¡£ååˆ é™¤**ï¼š

    ```sql
    -- âœ… å¥½ï¼šå½’æ¡£ååˆ é™¤
    ALTER TABLE orders DETACH PARTITION orders_2023_01;
    -- å¤‡ä»½åˆ†åŒº
    pg_dump -t orders_2023_01 mydb > orders_2023_01_backup.sql
    -- åˆ é™¤åˆ†åŒº
    DROP TABLE orders_2023_01;
    ```

**æ€§èƒ½å¯¹æ¯”**ï¼š

- DELETEåˆ é™¤ï¼š100GBåˆ†åŒºï¼Œè€—æ—¶ 2å°æ—¶
- DROP TABLEï¼š100GBåˆ†åŒºï¼Œè€—æ—¶ 1ç§’
- **æ€§èƒ½æå‡ï¼š7200å€**

### 8.2 åˆ†åŒºç»´æŠ¤å¸¸è§é—®é¢˜

#### Q4: å¦‚ä½•è‡ªåŠ¨ç®¡ç†åˆ†åŒºï¼Ÿ

**é—®é¢˜æè¿°**ï¼šéœ€è¦è‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†åˆ†åŒºã€‚

**è‡ªåŠ¨åŒ–æ–¹æ³•**ï¼š

1. **ä½¿ç”¨pg_partmanæ‰©å±•**ï¼š

    ```sql
    -- âœ… å¥½ï¼šä½¿ç”¨pg_partmanæ‰©å±•
    CREATE EXTENSION pg_partman;

    -- é…ç½®è‡ªåŠ¨åˆ†åŒº
    SELECT partman.create_parent(
        p_parent_table => 'public.orders',
        p_control => 'order_date',
        p_type => 'range',
        p_interval => 'monthly',
        p_premake => 3
    );
    -- è‡ªåŠ¨åˆ›å»ºæœªæ¥3ä¸ªæœˆçš„åˆ†åŒº
    ```

2. **ä½¿ç”¨å®šæ—¶ä»»åŠ¡**ï¼š

    ```bash
    # âœ… å¥½ï¼šä½¿ç”¨cronå®šæ—¶åˆ›å»ºåˆ†åŒº
    # æ¯æœˆ1å·åˆ›å»ºä¸‹ä¸ªæœˆçš„åˆ†åŒº
    0 0 1 * * psql -d mydb -c "ALTER TABLE orders ADD PARTITION ..."
    ```

3. **ä½¿ç”¨è§¦å‘å™¨**ï¼š

    ```sql
    -- âœ… å¥½ï¼šä½¿ç”¨è§¦å‘å™¨è‡ªåŠ¨åˆ›å»ºåˆ†åŒº
    CREATE OR REPLACE FUNCTION create_partition_if_not_exists()
    RETURNS TRIGGER AS $$
    BEGIN
        -- æ£€æŸ¥åˆ†åŒºæ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»º
        -- ...
        RETURN NEW;
    END;
    $$ LANGUAGE plpgsql;
    ```

**æœ€ä½³å®è·µ**ï¼š

- **ä½¿ç”¨æ‰©å±•**ï¼špg_partmanç­‰æ‰©å±•ç®€åŒ–ç®¡ç†
- **æå‰åˆ›å»º**ï¼šæå‰åˆ›å»ºæœªæ¥åˆ†åŒº
- **ç›‘æ§**ï¼šç›‘æ§åˆ†åŒºåˆ›å»ºè¿‡ç¨‹

#### Q5: åˆ†åŒºè¡¨éœ€è¦å®šæœŸç»´æŠ¤å—ï¼Ÿ

**é—®é¢˜æè¿°**ï¼šä¸ç¡®å®šåˆ†åŒºè¡¨æ˜¯å¦éœ€è¦å®šæœŸç»´æŠ¤ã€‚

**ç»´æŠ¤éœ€æ±‚**ï¼š

1. **å®šæœŸVACUUM**ï¼š

    ```sql
    -- âœ… å¥½ï¼šå®šæœŸVACUUMåˆ†åŒº
    VACUUM ANALYZE orders_2024_01;
    -- æ¯ä¸ªåˆ†åŒºç‹¬ç«‹VACUUM
    ```

2. **å®šæœŸANALYZE**ï¼š

    ```sql
    -- âœ… å¥½ï¼šå®šæœŸANALYZEåˆ†åŒº
    ANALYZE orders_2024_01;
    -- æ›´æ–°åˆ†åŒºç»Ÿè®¡ä¿¡æ¯
    ```

3. **ç›‘æ§åˆ†åŒºå¤§å°**ï¼š

    ```sql
    -- âœ… å¥½ï¼šç›‘æ§åˆ†åŒºå¤§å°
    SELECT
        schemaname,
        relname,
        pg_size_pretty(pg_total_relation_size(relid)) AS size
    FROM pg_stat_user_tables
    WHERE relname LIKE 'orders_%'
    ORDER BY pg_total_relation_size(relid) DESC;
    ```

**ç»´æŠ¤æ¸…å•**ï¼š

- [ ] å®šæœŸVACUUMåˆ†åŒº
- [ ] å®šæœŸANALYZEåˆ†åŒº
- [ ] ç›‘æ§åˆ†åŒºå¤§å°
- [ ] åˆ é™¤æˆ–å½’æ¡£æ—§åˆ†åŒº

### 8.3 åˆ†åŒºæ€§èƒ½å¸¸è§é—®é¢˜

#### Q6: åˆ†åŒºè¡¨æŸ¥è¯¢æ€§èƒ½å¦‚ä½•ä¼˜åŒ–ï¼Ÿ

**é—®é¢˜æè¿°**ï¼šåˆ†åŒºè¡¨æŸ¥è¯¢æ…¢ï¼Œéœ€è¦ä¼˜åŒ–ã€‚

**ä¼˜åŒ–ç­–ç•¥**ï¼š

1. **ç¡®ä¿åˆ†åŒºè£å‰ª**ï¼š

    ```sql
    -- âœ… å¥½ï¼šæŸ¥è¯¢æ¡ä»¶åŒ…å«åˆ†åŒºé”®
    SELECT * FROM orders
    WHERE order_date >= '2024-01-01' AND order_date < '2024-02-01';
    -- åªæ‰«æç›¸å…³åˆ†åŒº

    -- âŒ ä¸å¥½ï¼šæŸ¥è¯¢æ¡ä»¶ä¸åŒ…å«åˆ†åŒºé”®
    SELECT * FROM orders WHERE user_id = 123;
    -- æ‰«ææ‰€æœ‰åˆ†åŒº
    ```

2. **åˆ›å»ºåˆ†åŒºé”®ç´¢å¼•**ï¼š

    ```sql
    -- âœ… å¥½ï¼šä¸ºåˆ†åŒºé”®åˆ›å»ºç´¢å¼•
    CREATE INDEX idx_orders_date ON orders(order_date);
    -- æ¯ä¸ªåˆ†åŒºè‡ªåŠ¨åˆ›å»ºç´¢å¼•
    ```

3. **ä½¿ç”¨çº¦æŸæ’é™¤**ï¼š

    ```sql
    -- âœ… å¥½ï¼šå¯ç”¨çº¦æŸæ’é™¤
    SET constraint_exclusion = partition;
    -- PostgreSQLè‡ªåŠ¨æ’é™¤ä¸ç›¸å…³åˆ†åŒº
    ```

**æ€§èƒ½æ•°æ®**ï¼š

- æ— åˆ†åŒºè£å‰ªï¼šæ‰«ææ‰€æœ‰åˆ†åŒºï¼Œè€—æ—¶ 10ç§’
- æœ‰åˆ†åŒºè£å‰ªï¼šåªæ‰«æç›¸å…³åˆ†åŒºï¼Œè€—æ—¶ 0.5ç§’
- **æ€§èƒ½æå‡ï¼š20å€**

#### Q7: åˆ†åŒºæ•°é‡å¯¹æ€§èƒ½çš„å½±å“ï¼Ÿ

**é—®é¢˜æè¿°**ï¼šä¸ç¡®å®šåˆ†åŒºæ•°é‡å¯¹æ€§èƒ½çš„å½±å“ã€‚

**æ€§èƒ½å½±å“**ï¼š

1. **åˆ†åŒºæ•°é‡å½±å“**ï¼š
   - å°‘é‡åˆ†åŒºï¼ˆ<10ï¼‰ï¼šæ€§èƒ½å¥½
   - ä¸­ç­‰åˆ†åŒºï¼ˆ10-100ï¼‰ï¼šæ€§èƒ½å¯æ¥å—
   - å¤§é‡åˆ†åŒºï¼ˆ>100ï¼‰ï¼šå¯èƒ½å½±å“æ€§èƒ½

2. **ä¼˜åŒ–å»ºè®®**ï¼š

    ```sql
    -- âœ… å¥½ï¼šåˆç†åˆ†åŒºæ•°é‡
    -- æŒ‰æœˆä»½åˆ†åŒºï¼š12ä¸ªåˆ†åŒº/å¹´
    -- æŒ‰å­£åº¦åˆ†åŒºï¼š4ä¸ªåˆ†åŒº/å¹´
    -- é¿å…è¿‡å¤šåˆ†åŒºï¼ˆ>100ï¼‰
    ```

3. **ç›‘æ§åˆ†åŒºæ€§èƒ½**ï¼š

    ```sql
    -- âœ… å¥½ï¼šç›‘æ§åˆ†åŒºæ€§èƒ½
    SELECT
        schemaname,
        relname,
        seq_scan,
        idx_scan,
        n_tup_ins,
        n_tup_upd,
        n_tup_del
    FROM pg_stat_user_tables
    WHERE relname LIKE 'orders_%'
    ORDER BY seq_scan DESC;
    ```

**æœ€ä½³å®è·µ**ï¼š

- **åˆç†æ•°é‡**ï¼šå»ºè®®ä¸è¶…è¿‡100ä¸ªåˆ†åŒº
- **ç›‘æ§æ€§èƒ½**ï¼šå®šæœŸç›‘æ§åˆ†åŒºæ€§èƒ½
- **ä¼˜åŒ–æŸ¥è¯¢**ï¼šç¡®ä¿æŸ¥è¯¢ä½¿ç”¨åˆ†åŒºé”®

## 9. å‚è€ƒèµ„æ–™

### 9.1 å‚è€ƒèµ„æ–™

#### 9.1.1 å®˜æ–¹æ–‡æ¡£

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - åˆ†åŒºè¡¨](https://www.postgresql.org/docs/current/ddl-partitioning.html)**
  - åˆ†åŒºè¡¨å®Œæ•´æ•™ç¨‹
  - è¯­æ³•å’Œç¤ºä¾‹è¯´æ˜

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - åˆ†åŒºè¡¨ç®¡ç†](https://www.postgresql.org/docs/current/sql-altertable.html#SQL-ALTERTABLE-PARTITION)**
  - åˆ†åŒºè¡¨ç®¡ç†è¯­æ³•
  - ALTER TABLEåˆ†åŒºæ“ä½œ

- **[PostgreSQL å®˜æ–¹æ–‡æ¡£ - pg_partman](https://github.com/pgpartman/pg_partman)**
  - pg_partmanæ‰©å±•æ–‡æ¡£
  - è‡ªåŠ¨åŒ–åˆ†åŒºç®¡ç†

- **[PostgreSQL 17 å‘å¸ƒè¯´æ˜](https://www.postgresql.org/about/news/postgresql-17-released-2781/)**
  - PostgreSQL 17æ–°ç‰¹æ€§ä»‹ç»
  - åˆ†åŒºç®¡ç†å¢å¼ºè¯´æ˜

#### 9.1.2 SQLæ ‡å‡†

- **ISO/IEC 9075:2016 - SQLæ ‡å‡†åˆ†åŒº**
  - SQLæ ‡å‡†åˆ†åŒºè§„èŒƒ
  - åˆ†åŒºæ ‡å‡†è¯­æ³•

#### 9.1.3 æŠ€æœ¯è®ºæ–‡

- **Zilio, D. C., et al. (2004). "Partitioning Key Selection for a Shared-Nothing Database System."**
  - ä¼šè®®: CASCON 2004
  - **é‡è¦æ€§**: åˆ†åŒºé”®é€‰æ‹©çš„åŸºç¡€ç ”ç©¶
  - **æ ¸å¿ƒè´¡çŒ®**: æ·±å…¥åˆ†æäº†åˆ†åŒºé”®é€‰æ‹©å¯¹æŸ¥è¯¢æ€§èƒ½çš„å½±å“

- **Agrawal, S., et al. (2004). "Automatic Physical Design Tuning: Workload as a Sequence."**
  - ä¼šè®®: SIGMOD 2004
  - **é‡è¦æ€§**: è‡ªåŠ¨ç‰©ç†è®¾è®¡è°ƒä¼˜çš„åŸºç¡€ç ”ç©¶
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†è‡ªåŠ¨åˆ†åŒºç®¡ç†çš„æ¦‚å¿µå’Œæ–¹æ³•

- **Curino, C., et al. (2010). "Schism: A Workload-Driven Approach to Database Replication and Partitioning."**
  - ä¼šè®®: VLDB 2010
  - **é‡è¦æ€§**: æ•°æ®åº“åˆ†åŒºå’Œå¤åˆ¶çš„åŸºç¡€ç ”ç©¶
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†åŸºäºå·¥ä½œè´Ÿè½½çš„åˆ†åŒºç­–ç•¥é€‰æ‹©æ–¹æ³•

- **Navathe, S. B., et al. (1984). "Vertical Partitioning Algorithms for Database Design."**
  - ä¼šè®®: TODS 1984
  - **é‡è¦æ€§**: å‚ç›´åˆ†åŒºç®—æ³•çš„åŸºç¡€ç ”ç©¶
  - **æ ¸å¿ƒè´¡çŒ®**: æå‡ºäº†å‚ç›´åˆ†åŒºçš„ç®—æ³•å’Œä¼˜åŒ–æ–¹æ³•

#### 9.1.4 æŠ€æœ¯åšå®¢

- **[PostgreSQL å®˜æ–¹åšå®¢ - åˆ†åŒºè¡¨](https://www.postgresql.org/docs/current/ddl-partitioning.html)**
  - åˆ†åŒºè¡¨æœ€ä½³å®è·µ
  - æ€§èƒ½ä¼˜åŒ–æŠ€å·§

- **[2ndQuadrant - PostgreSQL åˆ†åŒºè¡¨](https://www.2ndquadrant.com/en/blog/postgresql-partitioning/)**
  - åˆ†åŒºè¡¨å®æˆ˜
  - æ€§èƒ½ä¼˜åŒ–æ¡ˆä¾‹

- **[Percona - PostgreSQL åˆ†åŒºè¡¨](https://www.percona.com/blog/postgresql-partitioning/)**
  - åˆ†åŒºè¡¨ä½¿ç”¨æŠ€å·§
  - æ€§èƒ½ä¼˜åŒ–å»ºè®®

- **[EnterpriseDB - PostgreSQL åˆ†åŒºè¡¨](https://www.enterprisedb.com/postgres-tutorials/postgresql-partitioning-tutorial)**
  - åˆ†åŒºè¡¨æ·±å…¥è§£æ
  - å®é™…åº”ç”¨æ¡ˆä¾‹

#### 9.1.5 ç¤¾åŒºèµ„æº

- **[PostgreSQL Wiki - åˆ†åŒºè¡¨](https://wiki.postgresql.org/wiki/Partitioning)**
  - åˆ†åŒºè¡¨æŠ€å·§
  - å®é™…åº”ç”¨æ¡ˆä¾‹

- **[Stack Overflow - PostgreSQL åˆ†åŒºè¡¨](https://stackoverflow.com/questions/tagged/postgresql+partitioning)**
  - åˆ†åŒºè¡¨é—®ç­”
  - å¸¸è§é—®é¢˜è§£ç­”

- **[PostgreSQL é‚®ä»¶åˆ—è¡¨](https://www.postgresql.org/list/)**
  - PostgreSQLç¤¾åŒºè®¨è®º
  - åˆ†åŒºè¡¨ä½¿ç”¨é—®é¢˜äº¤æµ

#### 9.1.6 ç›¸å…³æ–‡æ¡£

- [åˆ†åŒºè¡¨æ€§èƒ½ä¼˜åŒ–](./åˆ†åŒºè¡¨æ€§èƒ½ä¼˜åŒ–.md)
- [åˆ†åŒºè¡¨ç®¡ç†](../../02-SQLåŸºç¡€/åˆ†åŒºè¡¨ç®¡ç†.md)
- [PostgreSQL 17æ–°ç‰¹æ€§æ€»è§ˆ](./README.md)

---

**æœ€åæ›´æ–°**: 2025 å¹´ 1 æœˆ
**ç»´æŠ¤è€…**: PostgreSQL Modern Team
