# 事务模型核心概念思维导图

> **文档编号**: MINDMAP-TRANSACTION-001
> **主题**: 事务模型核心概念思维导图
> **版本**: v1.0
> **创建日期**: 2024年
> **状态**: ✅ 已完成

---

## 📋 目录

- [事务模型核心概念思维导图](#事务模型核心概念思维导图)
  - [📋 目录](#-目录)
  - [📊 第一部分：事务模型知识体系](#-第一部分事务模型知识体系)
  - [📊 第二部分：MVCC事务模型](#-第二部分mvcc事务模型)
  - [📊 第三部分：分布式事务模型](#-第三部分分布式事务模型)
  - [📊 第四部分：事务隔离级别](#-第四部分事务隔离级别)
  - [📊 第五部分：事务协调机制](#-第五部分事务协调机制)
  - [🔗 相关文档](#-相关文档)

---

## 📊 第一部分：事务模型知识体系

```text
事务模型知识体系
│
├─ 本地事务模型
│   ├─ ACID属性
│   │   ├─ 原子性（Atomicity）
│   │   ├─ 一致性（Consistency）
│   │   ├─ 隔离性（Isolation）
│   │   └─ 持久性（Durability）
│   │
│   ├─ MVCC机制
│   │   ├─ 版本管理
│   │   ├─ 快照隔离
│   │   ├─ 可见性规则
│   │   └─ 版本链
│   │
│   └─ 锁机制
│       ├─ 行锁
│       ├─ 表锁
│       ├─ 共享锁
│       └─ 排他锁
│
├─ 分布式事务模型
│   ├─ 两阶段提交（2PC）
│   │   ├─ 准备阶段
│   │   ├─ 提交阶段
│   │   └─ 故障恢复
│   │
│   ├─ XA事务
│   │   ├─ XA协议
│   │   ├─ 事务管理器
│   │   └─ 资源管理器
│   │
│   ├─ Saga模式
│   │   ├─ 编排式Saga
│   │   ├─ 协同式Saga
│   │   └─ 补偿事务
│   │
│   └─ TCC模式
│       ├─ Try阶段
│       ├─ Confirm阶段
│       └─ Cancel阶段
│
└─ 最终一致性模型
    ├─ 事件驱动
    ├─ 消息队列
    └─ 补偿机制
```

---

## 📊 第二部分：MVCC事务模型

```text
MVCC事务模型
│
├─ 核心概念
│   ├─ 版本（Version）
│   │   ├─ xmin（创建事务ID）
│   │   ├─ xmax（删除事务ID）
│   │   └─ ctid（版本链指针）
│   │
│   ├─ 快照（Snapshot）
│   │   ├─ 活跃事务列表
│   │   ├─ 最小XID
│   │   └─ 最大XID
│   │
│   └─ 可见性（Visibility）
│       ├─ 可见性规则
│       ├─ 可见性判定
│       └─ 可见性一致性
│
├─ 版本链机制
│   ├─ 版本链结构
│   │   ├─ 头版本
│   │   ├─ 中间版本
│   │   └─ 尾版本
│   │
│   ├─ 版本链遍历
│   │   ├─ 前向遍历
│   │   ├─ 后向遍历
│   │   └─ 可见性检查
│   │
│   └─ 版本链优化
│       ├─ HOT更新
│       ├─ 版本链压缩
│       └─ 版本链清理
│
├─ 快照隔离
│   ├─ 快照创建
│   │   ├─ 事务开始时
│   │   ├─ 快照内容
│   │   └─ 快照一致性
│   │
│   ├─ 快照使用
│   │   ├─ 读取操作
│   │   ├─ 可见性判定
│   │   └─ 一致性保证
│   │
│   └─ 快照隔离级别
│       ├─ READ COMMITTED
│       ├─ REPEATABLE READ
│       └─ SERIALIZABLE
│
└─ MVCC与锁的配合
    ├─ 写-写冲突
    │   ├─ 行锁
    │   ├─ 表锁
    │   └─ 死锁检测
    │
    ├─ 读-写冲突
    │   ├─ MVCC处理
    │   ├─ 快照隔离
    │   └─ 无锁读取
    │
    └─ 写-读冲突
        ├─ MVCC处理
        ├─ 版本可见性
        └─ 一致性保证
```

---

## 📊 第三部分：分布式事务模型

```text
分布式事务模型
│
├─ 两阶段提交（2PC）
│   ├─ 阶段1：准备阶段
│   │   ├─ 协调者发送prepare
│   │   ├─ 参与者执行事务
│   │   ├─ 参与者返回vote
│   │   └─ 协调者收集vote
│   │
│   ├─ 阶段2：提交阶段
│   │   ├─ 全部同意 → commit
│   │   ├─ 任一拒绝 → abort
│   │   └─ 参与者执行commit/abort
│   │
│   └─ 故障处理
│       ├─ 协调者故障
│       ├─ 参与者故障
│       └─ 网络分区
│
├─ XA事务
│   ├─ XA协议
│   │   ├─ xa_start
│   │   ├─ xa_end
│   │   ├─ xa_prepare
│   │   ├─ xa_commit
│   │   └─ xa_rollback
│   │
│   ├─ 事务管理器（TM）
│   │   ├─ 事务协调
│   │   ├─ 故障恢复
│   │   └─ 日志管理
│   │
│   └─ 资源管理器（RM）
│       ├─ 本地事务
│       ├─ XA接口
│       └─ 两阶段提交
│
├─ Saga模式
│   ├─ 编排式Saga
│   │   ├─ 中央协调器
│   │   ├─ 事务编排
│   │   └─ 补偿事务
│   │
│   ├─ 协同式Saga
│   │   ├─ 事件驱动
│   │   ├─ 本地事务
│   │   └─ 补偿机制
│   │
│   └─ 补偿事务
│       ├─ 补偿策略
│       ├─ 补偿顺序
│       └─ 补偿保证
│
└─ TCC模式
    ├─ Try阶段
    │   ├─ 资源预留
    │   ├─ 业务检查
    │   └─ 状态记录
    │
    ├─ Confirm阶段
    │   ├─ 确认执行
    │   ├─ 资源提交
    │   └─ 状态更新
    │
    └─ Cancel阶段
        ├─ 取消执行
        ├─ 资源释放
        └─ 状态回滚
```

---

## 📊 第四部分：事务隔离级别

```text
事务隔离级别
│
├─ READ UNCOMMITTED
│   ├─ 特点
│   │   ├─ 允许读取未提交数据
│   │   ├─ 最低隔离级别
│   │   └─ 可能出现脏读
│   │
│   ├─ 异常
│   │   ├─ 脏读（Dirty Read）
│   │   └─ 不可重复读
│   │
│   └─ PostgreSQL实现
│       └─ 不支持（实际为READ COMMITTED）
│
├─ READ COMMITTED
│   ├─ 特点
│   │   ├─ 只读取已提交数据
│   │   ├─ 默认隔离级别
│   │   └─ 快照在每条语句时更新
│   │
│   ├─ 异常
│   │   ├─ 不可重复读
│   │   └─ 幻读
│   │
│   └─ PostgreSQL实现
│       ├─ 快照隔离
│       ├─ 语句级快照
│       └─ MVCC机制
│
├─ REPEATABLE READ
│   ├─ 特点
│   │   ├─ 快照在事务开始时确定
│   │   ├─ 事务期间快照不变
│   │   └─ 避免不可重复读
│   │
│   ├─ 异常
│   │   └─ 幻读（PostgreSQL中避免）
│   │
│   └─ PostgreSQL实现
│       ├─ 事务级快照
│       ├─ 快照隔离
│       └─ 幻读避免（通过快照）
│
└─ SERIALIZABLE
    ├─ 特点
    │   ├─ 最高隔离级别
    │   ├─ 可串行化执行
    │   └─ 避免所有异常
    │
    ├─ 异常
    │   └─ 无（理论上）
    │
    └─ PostgreSQL实现
        ├─ 快照隔离
        ├─ 冲突检测（SSI）
        └─ 串行化失败检测
```

---

## 📊 第五部分：事务协调机制

```text
事务协调机制
│
├─ 本地事务协调
│   ├─ MVCC协调
│   │   ├─ 版本管理
│   │   ├─ 快照分配
│   │   └─ 可见性判定
│   │
│   ├─ 锁协调
│   │   ├─ 锁获取
│   │   ├─ 锁释放
│   │   └─ 死锁检测
│   │
│   └─ WAL协调
│       ├─ WAL写入
│       ├─ 事务提交
│       └─ 故障恢复
│
├─ 分布式事务协调
│   ├─ 2PC协调
│   │   ├─ 准备阶段协调
│   │   ├─ 提交阶段协调
│   │   └─ 故障恢复协调
│   │
│   ├─ XA协调
│   │   ├─ 事务管理器
│   │   ├─ 资源管理器
│   │   └─ XA协议
│   │
│   └─ Saga协调
│       ├─ 编排式协调
│       ├─ 协同式协调
│       └─ 补偿协调
│
└─ 一致性协调
    ├─ 强一致性
    │   ├─ 同步复制
    │   ├─ 两阶段提交
    │   └─ 线性一致性
    │
    ├─ 最终一致性
    │   ├─ 异步复制
    │   ├─ 事件驱动
    │   └─ 补偿机制
    │
    └─ 混合一致性
        ├─ 部分同步
        ├─ 动态调整
        └─ 场景选择
```

---

## 🔗 相关文档

- **[事务模型目录](../../01-理论基础/事务模型/README.md)** - 事务模型文档索引
- **[MVCC与锁机制](../../01-理论基础/事务模型/MVCC_Lock_Transaction/mvcc_lock.md)** - MVCC与锁机制
- **[隔离级别深度分析](../../01-理论基础/事务模型/隔离级别深度分析.md)** - 隔离级别分析
- **[分布式事务最佳实践](../../01-理论基础/事务模型/分布式事务最佳实践.md)** - 分布式事务实践

---

**最后更新**: 2024年
**维护状态**: ✅ 已完成
**文档编号**: MINDMAP-TRANSACTION-001
